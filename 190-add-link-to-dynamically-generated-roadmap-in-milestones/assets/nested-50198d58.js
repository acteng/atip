var no=Object.defineProperty;var ro=(r,e,t)=>e in r?no(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ie=(r,e,t)=>(ro(r,typeof e!="symbol"?e+"":e,t),t);import{x as G,s as Y,y as Fe,S as V,i as K,M as io,b as oe,a as Me,d as N,m as B,k as $e,n as $,o as O,q as D,e as E,c as A,g as k,p as S,f as C,z as ae,B as ue,C as oo,D as Xt,E as tn,F as rt,G as gt,H as bt,I as yt,J as vt,K as yr,h as w,l as q,L as so,N as lo,O as ne,P as ao,w as or,Q as Ze,R as ve,T as Mn,U as cn,V as se,t as W,W as Ce,X as pn,Y as kt,Z as _e,_ as it,$ as Ve,a0 as $n,j as Oe,r as Re,a1 as wi,a2 as St,a3 as dn,a4 as vr,a5 as uo,a6 as fo,a7 as xe,a8 as co,a9 as po,aa as Ln,ab as Lt,ac as On,ad as Cn,ae as qn,af as ho,ag as wt,ah as sr,ai as Xe,aj as Et,ak as mo,al as lr,am as _o,an as go,ao as bo,ap as wr,aq as hn,ar as yo,as as vo,at as wo,A as ko,u as So}from"./authorities-5d586a3c.js";const at=[];function ot(r,e=G){let t;const n=new Set;function i(a){if(Y(r,a)&&(r=a,t)){const l=!at.length;for(const u of n)u[1](),at.push(u,r);if(l){for(let u=0;u<at.length;u+=2)at[u][0](at[u+1]);at.length=0}}}function o(a){i(a(r))}function s(a,l=G){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||G),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ae=ot(null),mn=ot(null),te=ot(Fe()),Ee=ot(null),Be=ot(null),Gt=ot(null),Ht=ot(null);function Wt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function kr(r){console.log(`Deleting intervention ${r}`),te.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Ee.set(null),Be.set(null),Gt.set(null),Ht.set(null)}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ki=Symbol("Comlink.proxy"),Eo=Symbol("Comlink.endpoint"),Mo=Symbol("Comlink.releaseProxy"),xn=Symbol("Comlink.finalizer"),nn=Symbol("Comlink.thrown"),Si=r=>typeof r=="object"&&r!==null||typeof r=="function",$o={canHandle:r=>Si(r)&&r[ki],serialize(r){const{port1:e,port2:t}=new MessageChannel;return ar(r,e),[t,[t]]},deserialize(r){return r.start(),$i(r)}},Lo={canHandle:r=>Si(r)&&nn in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},Ei=new Map([["proxy",$o],["throw",Lo]]);function Oo(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function ar(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!Oo(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(Qe);let u;try{const c=a.slice(0,-1).reduce((p,f)=>p[f],r),d=a.reduce((p,f)=>p[f],r);switch(s){case"GET":u=d;break;case"SET":c[a.slice(-1)[0]]=Qe(i.data.value),u=!0;break;case"APPLY":u=d.apply(c,l);break;case"CONSTRUCT":{const p=new d(...l);u=Po(p)}break;case"ENDPOINT":{const{port1:p,port2:f}=new MessageChannel;ar(r,f),u=xo(p,[p])}break;case"RELEASE":u=void 0;break;default:return}}catch(c){u={value:c,[nn]:0}}Promise.resolve(u).catch(c=>({value:c,[nn]:0})).then(c=>{const[d,p]=bn(c);e.postMessage(Object.assign(Object.assign({},d),{id:o}),p),s==="RELEASE"&&(e.removeEventListener("message",n),Mi(e),xn in r&&typeof r[xn]=="function"&&r[xn]())}).catch(c=>{const[d,p]=bn({value:new TypeError("Unserializable return value"),[nn]:0});e.postMessage(Object.assign(Object.assign({},d),{id:o}),p)})}),e.start&&e.start()}function Co(r){return r.constructor.name==="MessagePort"}function Mi(r){Co(r)&&r.close()}function $i(r,e){return Gn(r,[],e)}function Zt(r){if(r)throw new Error("Proxy has been released and is not useable")}function Li(r){return ht(r,{type:"RELEASE"}).then(()=>{Mi(r)})}const _n=new WeakMap,gn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(_n.get(r)||0)-1;_n.set(r,e),e===0&&Li(r)});function Ro(r,e){const t=(_n.get(e)||0)+1;_n.set(e,t),gn&&gn.register(r,e,r)}function Ao(r){gn&&gn.unregister(r)}function Gn(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(Zt(n),s===Mo)return()=>{Ao(i),Li(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=ht(r,{type:"GET",path:e.map(l=>l.toString())}).then(Qe);return a.then.bind(a)}return Gn(r,[...e,s])},set(o,s,a){Zt(n);const[l,u]=bn(a);return ht(r,{type:"SET",path:[...e,s].map(c=>c.toString()),value:l},u).then(Qe)},apply(o,s,a){Zt(n);const l=e[e.length-1];if(l===Eo)return ht(r,{type:"ENDPOINT"}).then(Qe);if(l==="bind")return Gn(r,e.slice(0,-1));const[u,c]=Sr(a);return ht(r,{type:"APPLY",path:e.map(d=>d.toString()),argumentList:u},c).then(Qe)},construct(o,s){Zt(n);const[a,l]=Sr(s);return ht(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(Qe)}});return Ro(i,r),i}function To(r){return Array.prototype.concat.apply([],r)}function Sr(r){const e=r.map(bn);return[e.map(t=>t[0]),To(e.map(t=>t[1]))]}const Oi=new WeakMap;function xo(r,e){return Oi.set(r,e),r}function Po(r){return Object.assign(r,{[ki]:!0})}function bn(r){for(const[e,t]of Ei)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},Oi.get(r)||[]]}function Qe(r){switch(r.type){case"HANDLER":return Ei.get(r.name).deserialize(r.value);case"RAW":return r.value}}function ht(r,e,t){return new Promise(n=>{const i=Fo();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function Fo(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Io(){return new Worker("/atip/190-add-link-to-dynamically-generated-roadmap-in-milestones/assets/worker-611e237b.js")}let ee;const Ci=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Ci.decode();let Tt=null;function Nt(){return(Tt===null||Tt.byteLength===0)&&(Tt=new Uint8Array(ee.memory.buffer)),Tt}function et(r,e){return r=r>>>0,Ci.decode(Nt().subarray(r,r+e))}const qe=new Array(128).fill(void 0);qe.push(void 0,null,!0,!1);let Bt=qe.length;function me(r){Bt===qe.length&&qe.push(qe.length+1);const e=Bt;return Bt=qe[e],qe[e]=r,e}function z(r){return qe[r]}let nt=0;const rn=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},No=typeof rn.encodeInto=="function"?function(r,e){return rn.encodeInto(r,e)}:function(r,e){const t=rn.encode(r);return e.set(t),{read:r.length,written:t.length}};function Pn(r,e,t){if(t===void 0){const a=rn.encode(r),l=e(a.length)>>>0;return Nt().subarray(l,l+a.length).set(a),nt=a.length,l}let n=r.length,i=e(n)>>>0;const o=Nt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3)>>>0;const a=Nt().subarray(i+s,i+n),l=No(r,a);s+=l.written}return nt=s,i}function Ot(r){return r==null}let xt=null;function ce(){return(xt===null||xt.byteLength===0)&&(xt=new Int32Array(ee.memory.buffer)),xt}function Bo(r){r<132||(qe[r]=Bt,Bt=r)}function Pt(r){const e=z(r);return Bo(r),e}let Ft=null;function Do(){return(Ft===null||Ft.byteLength===0)&&(Ft=new Float64Array(ee.memory.buffer)),Ft}let It=null;function jo(){return(It===null||It.byteLength===0)&&(It=new BigInt64Array(ee.memory.buffer)),It}function Hn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Hn(r[0]));for(let s=1;s<i;s++)o+=", "+Hn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Uo(r,e){const t=e(r.length*1)>>>0;return Nt().set(r,t/1),nt=r.length,t}function Fn(r,e){try{return r.apply(this,e)}catch(t){ee.__wbindgen_exn_store(me(t))}}let zn=class{static __wrap(e){e=e>>>0;const t=Object.create(zn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();ee.__wbg_routeinfo_free(e)}constructor(e){try{const o=ee.__wbindgen_add_to_stack_pointer(-16),s=Uo(e,ee.__wbindgen_malloc),a=nt;ee.routeinfo_new(o,s,a);var t=ce()[o/4+0],n=ce()[o/4+1],i=ce()[o/4+2];if(i)throw Pt(n);return zn.__wrap(t)}finally{ee.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const c=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_nameForRoute(c,this.__wbg_ptr,me(e));var i=ce()[c/4+0],o=ce()[c/4+1],s=ce()[c/4+2],a=ce()[c/4+3],l=i,u=o;if(a)throw l=0,u=0,Pt(s);return t=l,n=u,et(l,u)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const c=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_speedLimitForRoute(c,this.__wbg_ptr,me(e));var i=ce()[c/4+0],o=ce()[c/4+1],s=ce()[c/4+2],a=ce()[c/4+3],l=i,u=o;if(a)throw l=0,u=0,Pt(s);return t=l,n=u,et(l,u)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(t,n)}}allSpeedLimits(){let e,t;try{const u=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_allSpeedLimits(u,this.__wbg_ptr);var n=ce()[u/4+0],i=ce()[u/4+1],o=ce()[u/4+2],s=ce()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,Pt(o);return e=a,t=l,et(a,l)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(e,t)}}};async function qo(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Go(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=et(e,t);return me(n)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(et(e,t));return me(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=z(t),i=typeof n=="string"?n:void 0;var o=Ot(i)?0:Pn(i,ee.__wbindgen_malloc,ee.__wbindgen_realloc),s=nt;ce()[e/4+1]=s,ce()[e/4+0]=o},r.wbg.__wbindgen_object_drop_ref=function(e){Pt(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=z(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof z(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return me(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return z(e)===z(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=z(t),i=typeof n=="number"?n:void 0;Do()[e/8+1]=Ot(i)?0:i,ce()[e/4+0]=!Ot(i)},r.wbg.__wbindgen_is_object=function(e){const t=z(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return z(e)in z(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return me(t)},r.wbg.__wbindgen_is_undefined=function(e){return z(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return z(e)==z(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=z(e);return me(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=z(e)[z(t)];return me(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return me(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=z(t).stack,i=Pn(n,ee.__wbindgen_malloc,ee.__wbindgen_realloc),o=nt;ce()[e/4+1]=o,ce()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(et(e,t))}finally{ee.__wbindgen_free(n,i)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(z(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(z(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(z(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(z(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(z(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=z(e)[t>>>0];return me(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return z(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof z(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=z(e).next;return me(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return Fn(function(e){const t=z(e).next();return me(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return z(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=z(e).value;return me(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return me(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return Fn(function(e,t){const n=Reflect.get(z(e),z(t));return me(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return Fn(function(e,t){const n=z(e).call(z(t));return me(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(z(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=z(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(z(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(z(e));return me(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=z(e).buffer;return me(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(z(e));return me(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){z(e).set(z(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return z(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=z(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=z(t),i=typeof n=="bigint"?n:void 0;jo()[e/8+1]=Ot(i)?BigInt(0):i,ce()[e/4+0]=!Ot(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Hn(z(t)),i=Pn(n,ee.__wbindgen_malloc,ee.__wbindgen_realloc),o=nt;ce()[e/4+1]=o,ce()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(et(e,t))},r.wbg.__wbindgen_memory=function(){const e=ee.memory;return me(e)},r}function Ho(r,e){return ee=r.exports,Ri.__wbindgen_wasm_module=e,It=null,Ft=null,xt=null,Tt=null,ee}async function Ri(r){if(ee!==void 0)return ee;typeof r>"u"&&(r="/atip/190-add-link-to-dynamically-generated-roadmap-in-milestones/assets/route_info_bg.wasm");const e=Go();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await qo(await r,e);return Ho(t,n)}class zo{constructor(){ie(this,"inner");this.inner=null}async loadFile(e){await Ri(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new zn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.speedLimitForRoute(e)}allSpeedLimits(){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.allSpeedLimits()}}ar(zo);function Jo(r){let e,t,n,i,o,s,a,l,u,c,d,p,f;return{c(){e=E("p"),e.textContent="For each intervention:",t=A(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=A(),o=E("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=A(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=A(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,c=A(),d=E("p"),d.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,p=A(),f=E("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(h,g){k(h,e,g),k(h,t,g),k(h,n,g),k(h,i,g),k(h,o,g),k(h,s,g),k(h,a,g),k(h,l,g),k(h,u,g),k(h,c,g),k(h,d,g),k(h,p,g),k(h,f,g)},p:G,d(h){h&&S(e),h&&S(t),h&&S(n),h&&S(i),h&&S(o),h&&S(s),h&&S(a),h&&S(l),h&&S(u),h&&S(c),h&&S(d),h&&S(p),h&&S(f)}}}function Yo(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Jo]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new io({props:o}),oe.push(()=>Me(e,"open",i,r[0])),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Xo(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Wo extends V{constructor(e){super(),K(this,e,Xo,Yo,Y,{open:0})}}function Er(r){let e;const t=r[4].default,n=gt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&bt(n,t,i,i[3],e?vt(t,i[3],o,null):yt(i[3]),null)},i(i){e||($(n,i),e=!0)},o(i){O(n,i),e=!1},d(i){n&&n.d(i)}}}function Vo(r){let e,t,n=r[1]&&Er(r);return{c(){e=E("div"),n&&n.c(),C(e,"class","map svelte-12dpf1u")},m(i,o){k(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&$(n,1)):(n=Er(i),n.c(),$(n,1),n.m(e,null)):n&&(ae(),O(n,1,1,()=>{n=null}),ue())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){i&&S(e),n&&n.d(),r[5](null)}}}function Ko(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;oo("setCamera",!window.location.hash),Xt(()=>{s=new tn.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new tn.ScaleControl({})),s.addControl(new tn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ae.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),rt(()=>{s.remove()});function u(c){oe[c?"unshift":"push"](()=>{a=c,t(0,a)})}return r.$$set=c=>{"style"in c&&t(2,o=c.style),"$$scope"in c&&t(3,i=c.$$scope)},[a,l,o,i,n,u]}class Zo extends V{constructor(e){super(),K(this,e,Ko,Vo,Y,{style:2})}}const Qo=r=>({}),Mr=r=>({}),es=r=>({}),$r=r=>({}),ts=r=>({}),Lr=r=>({});function ns(r){let e,t,n,i,o,s,a,l,u,c,d,p;const f=r[3].nav,h=gt(f,r,r[2],Lr),g=r[3].sidebar,_=gt(g,r,r[2],$r),y=r[3].main,m=gt(y,r,r[2],Mr);return{c(){e=E("aside"),t=E("div"),n=E("nav"),h&&h.c(),i=A(),_&&_.c(),o=A(),s=E("button"),s.textContent="→",l=A(),u=E("main"),m&&m.c(),C(n,"class","svelte-1u7vg8a"),C(t,"class","sidebar-content content-container svelte-1u7vg8a"),C(s,"type","button"),C(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),C(e,"class",a=yr(r[0]?"":"collapsed")+" svelte-1u7vg8a"),C(u,"class","svelte-1u7vg8a")},m(b,v){k(b,e,v),w(e,t),w(t,n),h&&h.m(n,null),w(t,i),_&&_.m(t,null),w(e,o),w(e,s),k(b,l,v),k(b,u,v),m&&m.m(u,null),c=!0,d||(p=q(s,"click",r[1]),d=!0)},p(b,[v]){h&&h.p&&(!c||v&4)&&bt(h,f,b,b[2],c?vt(f,b[2],v,ts):yt(b[2]),Lr),_&&_.p&&(!c||v&4)&&bt(_,g,b,b[2],c?vt(g,b[2],v,es):yt(b[2]),$r),(!c||v&1&&a!==(a=yr(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&C(e,"class",a),m&&m.p&&(!c||v&4)&&bt(m,y,b,b[2],c?vt(y,b[2],v,Qo):yt(b[2]),Mr)},i(b){c||($(h,b),$(_,b),$(m,b),c=!0)},o(b){O(h,b),O(_,b),O(m,b),c=!1},d(b){b&&S(e),h&&h.d(b),_&&_.d(b),b&&S(l),b&&S(u),m&&m.d(b),d=!1,p()}}}function rs(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class is extends V{constructor(e){super(),K(this,e,rs,ns,Y,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function os(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(c){u=[6,c],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ke=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function ss(r,e){return r>e?1:r<e?-1:0}function He(r,e,t){for(var n=new Ke(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function In(r,e,t,n){var i=new Ke(r,e);if(t===null)return i.left=i.right=null,i;t=He(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Or(r,e,t){var n=null,i=null;if(e){e=He(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function ls(r,e,t){return e===null?r:(r===null||(e=He(r.key,e,t),e.left=r),e)}function Jn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Jn(r.left,o,!1,n,i),r.right&&Jn(r.right,o,!0,n,i)}}var ur=function(){function r(e){e===void 0&&(e=ss),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=In(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ke(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=He(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=He(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=He(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=He(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=He(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return us(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Wn(e,t,0,i-1,o),this._root===null)this._root=Yn(e,t,0,i),this._size=i;else{var s=fs(this.toList(),as(e,t),o);i=this._size+i,this._root=Xn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Jn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Or(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=In(t,n,a,i):s=In(t,n,s,i),this._root=ls(s,a,i)},r.prototype.split=function(e){return Or(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return os(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Yn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ke(s,a);return l.left=Yn(r,e,t,o),l.right=Yn(r,e,o+1,n),l}return null}function as(r,e){for(var t=new Ke(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ke(r[i],e[i]);return n.next=null,t.next}function us(r){for(var e=r,t=[],n=!1,i=new Ke(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Xn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Xn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Xn(r,i+1,t),s}return null}function fs(r,e,t){for(var n=new Ke(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Wn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Wn(r,e,t,a,i),Wn(r,e,a+1,n,i)}}function Te(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Cr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Le(r,e,t){return e&&Cr(r.prototype,e),t&&Cr(r,t),r}var Ct=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Vn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Je=Number.EPSILON;Je===void 0&&(Je=Math.pow(2,-52));var cs=Je*Je,Kn=function(e,t){if(-Je<e&&e<Je&&-Je<t&&t<Je)return 0;var n=e-t;return n*n<cs*e*t?0:e<t?-1:1},ps=function(){function r(){Te(this,r),this.reset()}return Le(r,[{key:"reset",value:function(){this.xRounder=new Rr,this.yRounder=new Rr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Rr=function(){function r(){Te(this,r),this.tree=new ur,this.round(0)}return Le(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Kn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Kn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),zt=new ps,Dt=function(e,t){return e.x*t.y-e.y*t.x},Ai=function(e,t){return e.x*t.x+e.y*t.y},Ar=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Dt(i,o);return Kn(s,0)},yn=function(e){return Math.sqrt(Ai(e,e))},ds=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Dt(o,i)/yn(o)/yn(i)},hs=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Ai(o,i)/yn(o)/yn(i)},Tr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},xr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},ms=function(e,t,n,i){if(t.x===0)return xr(n,i,e.x);if(i.x===0)return xr(e,t,n.x);if(t.y===0)return Tr(n,i,e.y);if(i.y===0)return Tr(e,t,n.y);var o=Dt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=Dt(s,t)/o,l=Dt(s,i)/o,u=e.x+l*t.x,c=n.x+a*i.x,d=e.y+l*t.y,p=n.y+a*i.y,f=(u+c)/2,h=(d+p)/2;return{x:f,y:h}},Ne=function(){Le(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:vn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Te(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Le(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:ds(n.point,t.point,l.point),cosine:hs(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,c=l.cosine,d=i.get(a),p=d.sine,f=d.cosine;return u>=0&&p>=0?c<f?1:c>f?-1:0:u<0&&p<0?c<f?-1:c>f?1:0:p<u?-1:p>u?1:0}}}]),r}(),_s=0,vn=function(){Le(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,c=t.rightSE.point.y,d=n.rightSE.point.y;if(i<o){if(u<l&&u<c)return 1;if(u>l&&u>c)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<d)return-1;if(l>u&&l>d)return 1;var h=n.comparePoint(t.leftSE.point);if(h!==0)return h;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>a){var y=t.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(s!==a){var m=c-l,b=s-i,v=d-u,M=a-o;if(m>b&&v<M)return 1;if(m<b&&v>M)return-1}return s>a?1:s<a||c<d?-1:c>d?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Te(this,r),this.id=++_s,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Le(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Vn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,c=Ct(n,l)&&this.comparePoint(l)===0,d=Ct(i,s)&&t.comparePoint(s)===0,p=Ct(n,u)&&this.comparePoint(u)===0,f=Ct(i,a)&&t.comparePoint(a)===0;if(d&&c)return f&&!p?a:!f&&p?u:null;if(d)return p&&s.x===u.x&&s.y===u.y?null:s;if(c)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&p)return null;if(f)return a;if(p)return u;var h=ms(s,this.vector(),l,t.vector());return h===null||!Ct(o,h)?null:zt.round(h.x,h.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Ne(t,!0),s=new Ne(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Ne.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ne.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var c=i.rings[l],d=i.windings[l],p=n.rings.indexOf(c);p===-1?(n.rings.push(c),n.windings.push(d)):n.windings[p]+=d}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],c=n.indexOf(l);c===-1?(n.push(l),i.push(u)):i[c]+=u}for(var d=[],p=[],f=0,h=n.length;f<h;f++)if(i[f]!==0){var g=n[f],_=g.poly;if(p.indexOf(_)===-1)if(g.isExterior)d.push(_);else{p.indexOf(_)===-1&&p.push(_);var y=d.indexOf(g.poly);y!==-1&&d.splice(y,1)}}for(var m=0,b=d.length;m<b;m++){var v=d[m].multiPoly;o.indexOf(v)===-1&&o.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Pe.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Pe.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(d){return d.length===1&&d[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Pe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Ne.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Ne(o,!0),c=new Ne(s,!1);return new r(u,c,[i],[a])}}]),r}(),Pr=function(){function r(e,t,n){if(Te(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=zt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=zt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(vn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(vn.fromRing(o,i,this))}return Le(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),gs=function(){function r(e,t){if(Te(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Pr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Pr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Le(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Fr=function(){function r(e,t){if(Te(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new gs(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Le(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),bs=function(){Le(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,c=[l],d=l.point,p=[];a=l,l=u,c.push(l),l.point!==d;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var h=c[0].point,g=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var _=null,y=0,m=p.length;y<m;y++)if(p[y].point===l.point){_=y;break}if(_!==null){var b=p.splice(_)[0],v=c.splice(b.index);v.unshift(v[0].otherSE),n.push(new r(v.reverse()));continue}p.push({index:c.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(c))}}return n}}]);function r(e){Te(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Le(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Ar(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Ar(l,t,u)===0&&n.shift(),n.push(n[0]);for(var c=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,f=[],h=d;h!=p;h+=c)f.push([n[h].x,n[h].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Ne.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Ir=function(){function r(e){Te(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Le(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),ys=function(){function r(e){Te(this,r),this.rings=e,this.polys=this._composePolys(e)}return Le(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Ir(s));else{var a=s.enclosingRing();a.poly||n.push(new Ir(a)),a.poly.addInterior(s)}}return n}}]),r}(),vs=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vn.compare;Te(this,r),this.queue=e,this.tree=new ur(t),this.segments=[]}return Le(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var c=null;if(l){var d=l.getIntersection(n);if(d!==null&&(n.isAnEndpoint(d)||(c=d),!l.isAnEndpoint(d)))for(var p=this._splitSafely(l,d),f=0,h=p.length;f<h;f++)i.push(p[f])}var g=null;if(u){var _=u.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(g=_),!u.isAnEndpoint(_)))for(var y=this._splitSafely(u,_),m=0,b=y.length;m<b;m++)i.push(y[m])}if(c!==null||g!==null){var v=null;if(c===null)v=g;else if(g===null)v=c;else{var M=Ne.comparePoints(c,g);v=M<=0?c:g}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var L=n.split(v),P=0,x=L.length;P<x;P++)i.push(L[P])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var I=l.getIntersection(u);if(I!==null){if(!l.isAnEndpoint(I))for(var T=this._splitSafely(l,I),U=0,Z=T.length;U<Z;U++)i.push(T[U]);if(!u.isAnEndpoint(I))for(var F=this._splitSafely(u,I),H=0,pe=F.length;H<pe;H++)i.push(F[H])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Nr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ws=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ks=function(){function r(){Te(this,r)}return Le(r,[{key:"run",value:function(t,n,i){Pe.type=t,zt.reset();for(var o=[new Fr(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Fr(i[s],!1));if(Pe.numMultiPolys=o.length,Pe.type==="difference")for(var l=o[0],u=1;u<o.length;)Vn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Pe.type==="intersection"){for(var c=0,d=o.length;c<d;c++)for(var p=o[c],f=c+1,h=o.length;f<h;f++)if(Vn(p.bbox,o[f].bbox)===null)return[]}for(var g=new ur(Ne.compare),_=0,y=o.length;_<y;_++)for(var m=o[_].getSweepEvents(),b=0,v=m.length;b<v;b++)if(g.insert(m[b]),g.size>Nr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new vs(g),L=g.size,P=g.pop();P;){var x=P.key;if(g.size===L){var I=x.segment;throw new Error("Unable to pop() ".concat(x.isLeft?"left":"right"," SweepEvent ")+"[".concat(x.point.x,", ").concat(x.point.y,"] from segment #").concat(I.id," ")+"[".concat(I.leftSE.point.x,", ").concat(I.leftSE.point.y,"] -> ")+"[".concat(I.rightSE.point.x,", ").concat(I.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Nr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>ws)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var T=M.process(x),U=0,Z=T.length;U<Z;U++){var F=T[U];F.consumedBy===void 0&&g.insert(F)}L=g.size,P=g.pop()}zt.reset();var H=bs.factory(M.segments),pe=new ys(H);return pe.getGeom()}}]),r}(),Pe=new ks,Ss=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Pe.run("union",e,n)},Es=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Pe.run("intersection",e,n)},Ms=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Pe.run("xor",e,n)},$s=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Pe.run("difference",e,n)},on={union:Ss,intersection:Es,xor:Ms,difference:$s};function Ls(r,e){var t=Cs(e),n=null;return r.type==="FeatureCollection"?n=Os(r):n=Ti(on.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function Os(r){var e=r.features.length===2?on.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):on.union.apply(on,r.features.map(function(t){return t.geometry.coordinates}));return Ti(e)}function Ti(r){return so(r)}function Cs(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return lo(t)}function Rs(r,e,t){let n;ne(r,Ae,s=>t(1,n=s));let{boundaryGeojson:i}=e;return ao("setCamera")&&n.fitBounds(or(i),{padding:20,animate:!1}),Ze(n,"boundary",Ls(i)),ve(n,{id:"boundary",source:"boundary",...Mn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class As extends V{constructor(e){super(),K(this,e,Rs,null,Y,{boundaryGeojson:0})}}const de={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Rn=10,Jt=10;function Ts(r,e,t){let n;ne(r,Ae,u=>t(2,n=u));let{layer:i}=e,{contents:o}=e,s=new tn.Popup({closeButton:!1,closeOnClick:!1});n.on("mousemove",a),n.on("mouseout",l),rt(()=>{n.off("mousemove",a),n.off("mouseout",l),s.remove()});function a(u){if(!n.getLayer(i)){s.remove();return}let c=n.queryRenderedFeatures(u.point,{layers:[i]});c.length>0?s.setLngLat(u.lngLat).setHTML(o(c[0].properties)).addTo(n):s.remove()}function l(){s.remove()}return r.$$set=u=>{"layer"in u&&t(0,i=u.layer),"contents"in u&&t(1,o=u.contents)},[i,o]}class xs extends V{constructor(e){super(),K(this,e,Ts,null,Y,{layer:0,contents:1})}}function Br(r,e,t){const n=r.slice();return n[3]=e[t],n}function Dr(r,e,t){const n=r.slice();return n[6]=e[t],n}function jr(r){let e;return{c(){e=E("td"),C(e,"class","svelte-11t6rxo"),se(e,"background-color",r[6])},m(t,n){k(t,e,n)},p(t,n){n&1&&se(e,"background-color",t[6])},d(t){t&&S(e)}}}function Ur(r){let e,t=r[3]+"",n;return{c(){e=E("td"),n=W(t),C(e,"class","svelte-11t6rxo"),se(e,"width",r[2])},m(i,o){k(i,e,o),w(e,n)},p(i,o){o&2&&t!==(t=i[3]+"")&&Ce(n,t)},d(i){i&&S(e)}}}function Ps(r){let e,t,n,i,o=r[0],s=[];for(let u=0;u<o.length;u+=1)s[u]=jr(Dr(r,o,u));let a=r[1],l=[];for(let u=0;u<a.length;u+=1)l[u]=Ur(Br(r,a,u));return{c(){e=E("table"),t=E("tr");for(let u=0;u<s.length;u+=1)s[u].c();n=A(),i=E("tr");for(let u=0;u<l.length;u+=1)l[u].c();C(t,"class","svelte-11t6rxo"),C(i,"class","svelte-11t6rxo"),C(e,"class","svelte-11t6rxo")},m(u,c){k(u,e,c),w(e,t);for(let d=0;d<s.length;d+=1)s[d].m(t,null);w(e,n),w(e,i);for(let d=0;d<l.length;d+=1)l[d].m(i,null)},p(u,[c]){if(c&1){o=u[0];let d;for(d=0;d<o.length;d+=1){const p=Dr(u,o,d);s[d]?s[d].p(p,c):(s[d]=jr(p),s[d].c(),s[d].m(t,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=o.length}if(c&6){a=u[1];let d;for(d=0;d<a.length;d+=1){const p=Br(u,a,d);l[d]?l[d].p(p,c):(l[d]=Ur(p),l[d].c(),l[d].m(i,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},i:G,o:G,d(u){u&&S(e),cn(s,u),cn(l,u)}}}function Fs(r,e,t){let{colors:n}=e,{labels:i}=e;if(n.length!=i.length)throw new Error("colors and labels must match");let o=`${100/n.length}%`;return r.$$set=s=>{"colors"in s&&t(0,n=s.colors),"labels"in s&&t(1,i=s.labels)},[n,i,o]}class Is extends V{constructor(e){super(),K(this,e,Fs,Ps,Y,{colors:0,labels:1})}}const Ns="/atip/190-add-link-to-dynamically-generated-roadmap-in-milestones/assets/help-d011708a.svg";function Bs(r){let e,t;return{c(){e=E("img"),pn(e.src,t=Ns)||C(e,"src",t),C(e,"title",r[0]),C(e,"alt",r[0])},m(n,i){k(n,e,i)},p(n,[i]){i&1&&C(e,"title",n[0]),i&1&&C(e,"alt",n[0])},i:G,o:G,d(n){n&&S(e)}}}function Ds(r,e,t){let{contents:n}=e;return r.$$set=i=>{"contents"in i&&t(0,n=i.contents)},[n]}class js extends V{constructor(e){super(),K(this,e,Ds,Bs,Y,{contents:0})}}function Us(r){let e,t,n,i,o,s,a;return t=new js({props:{contents:"Data comes from OpenStreetMap, and may not always be correct. Unexpected values are treated as unknown. Freehand route segments and off-road paths generally have no speed data."}}),i=new Is({props:{colors:r[0],labels:["< 20","20","30","40",">= 50"]}}),s=new xs({props:{layer:"speed-limits",contents:Gs}}),{c(){e=W(`(mph)
`),N(t.$$.fragment),n=A(),N(i.$$.fragment),o=A(),N(s.$$.fragment)},m(l,u){k(l,e,u),B(t,l,u),k(l,n,u),B(i,l,u),k(l,o,u),B(s,l,u),a=!0},p:G,i(l){a||($(t.$$.fragment,l),$(i.$$.fragment,l),$(s.$$.fragment,l),a=!0)},o(l){O(t.$$.fragment,l),O(i.$$.fragment,l),O(s.$$.fragment,l),a=!1},d(l){l&&S(e),D(t,l),l&&S(n),D(i,l),l&&S(o),D(s,l)}}}let qs="white",ut="speed-limits",Nn="speed-limits",Rt=.8;function Gs(r){return r.speed_limit?`${Math.round(r.speed_limit)} mph`:"Unknown"}function Hs(r,e,t){let n,i,o;ne(r,Ae,c=>t(2,n=c)),ne(r,mn,c=>t(3,i=c)),ne(r,te,c=>t(4,o=c));let{id:s}=e,a=["#00AB4D","#8ECA4D","#F7BB00","#BB0000","#470000"];const l=["case",["<",["get","speed_limit"],20],a[0],["==",["get","speed_limit"],20],a[1],["==",["get","speed_limit"],30],a[2],["==",["get","speed_limit"],40],a[3],[">=",["get","speed_limit"],50],a[4],qs],u=["case",["<",["get","speed_limit"],20],Rt,["==",["get","speed_limit"],20],Rt,["==",["get","speed_limit"],30],Rt,["==",["get","speed_limit"],40],Rt,[">=",["get","speed_limit"],50],Rt,0];return Ze(n,ut,Fe()),ve(n,{id:Nn,source:ut,...kt(l,Jt,u)}),Xt(async()=>{try{if(s){let c=o.features.find(p=>p.id==s),d=JSON.parse(await i.speedLimitForRoute(c.properties.waypoints));n.getSource(ut).setData(d)}else{let c=JSON.parse(await i.allSpeedLimits());n.getSource(ut).setData(c)}}catch(c){window.alert(`Couldn't calculate speed limits for route: ${c}`)}}),rt(()=>{n.getLayer(Nn)&&n.removeLayer(Nn),n.getSource(ut)&&n.removeSource(ut)}),r.$$set=c=>{"id"in c&&t(1,s=c.id)},[a,s]}class xi extends V{constructor(e){super(),K(this,e,Hs,Us,Y,{id:1})}}function qr(r){let e,t;return e=new xi({props:{id:r[0]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.id=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function zs(r){let e,t,n,i,o,s,a,l,u,c,d=r[1]=="speed limits"&&qr(r);return{c(){e=E("label"),t=W(`Show details:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",s=A(),d&&d.c(),a=_e(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,r[1]===void 0&&it(()=>r[2].call(n))},m(p,f){k(p,e,f),w(e,t),w(e,n),w(n,i),w(n,o),Ve(n,r[1]),k(p,s,f),d&&d.m(p,f),k(p,a,f),l=!0,u||(c=q(n,"change",r[2]),u=!0)},p(p,[f]){f&2&&Ve(n,p[1]),p[1]=="speed limits"?d?(d.p(p,f),f&2&&$(d,1)):(d=qr(p),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(ae(),O(d,1,1,()=>{d=null}),ue())},i(p){l||($(d),l=!0)},o(p){O(d),l=!1},d(p){p&&S(e),p&&S(s),d&&d.d(p),p&&S(a),u=!1,c()}}}function Js(r,e,t){let{id:n}=e,i="none";function o(){i=$n(this),t(1,i)}return r.$$set=s=>{"id"in s&&t(0,n=s.id)},[n,i,o]}class Ys extends V{constructor(e){super(),K(this,e,Js,zs,Y,{id:0})}}function Gr(r){let e,t=Hr(r[4])+"",n,i,o,s,a,l;return a=new Ys({props:{id:r[3]}}),{c(){e=W("Length: "),n=W(t),i=A(),o=E("br"),s=A(),N(a.$$.fragment)},m(u,c){k(u,e,c),k(u,n,c),k(u,i,c),k(u,o,c),k(u,s,c),B(a,u,c),l=!0},p(u,c){(!l||c&16)&&t!==(t=Hr(u[4])+"")&&Ce(n,t);const d={};c&8&&(d.id=u[3]),a.$set(d)},i(u){l||($(a.$$.fragment,u),l=!0)},o(u){O(a.$$.fragment,u),l=!1},d(u){u&&S(e),u&&S(n),u&&S(i),u&&S(o),u&&S(s),D(a,u)}}}function Xs(r){let e,t,n,i,o,s,a,l,u,c,d,p,f,h,g,_,y,m,b,v,M,L,P,x,I,T,U,Z,F,H,pe,we,ke,re,fe,je,Se,Q,le,st,lt,he,ge=r[4]&&Gr(r);return{c(){e=E("label"),t=W(`Name:
  `),n=E("button"),n.textContent="Auto-fill",i=A(),o=E("br"),s=A(),a=E("input"),l=A(),u=E("br"),c=A(),d=E("br"),p=A(),f=E("label"),h=E("input"),g=W(`
  Area`),_=A(),y=E("label"),m=E("input"),b=W(`
  Route`),v=A(),M=E("label"),L=E("input"),P=W(`
  Crossing`),x=A(),I=E("label"),T=E("input"),U=W(`
  Other`),Z=A(),F=E("br"),H=A(),pe=E("br"),we=A(),ke=E("label"),re=W("Description:"),fe=E("br"),je=A(),Se=E("textarea"),Q=A(),ge&&ge.c(),le=_e(),C(n,"type","button"),C(a,"type","text"),se(a,"width","100%"),C(h,"type","radio"),h.__value="area",h.value=h.__value,r[9][0].push(h),C(m,"type","radio"),m.__value="route",m.value=m.__value,r[9][0].push(m),C(L,"type","radio"),L.__value="crossing",L.value=L.__value,r[9][0].push(L),C(T,"type","radio"),T.__value="other",T.value=T.__value,r[9][0].push(T),se(Se,"width","100%"),C(Se,"rows","5"),C(Se,"class","svelte-15lna0i")},m(R,j){k(R,e,j),w(e,t),w(e,n),w(e,i),w(e,o),w(e,s),w(e,a),Oe(a,r[0]),k(R,l,j),k(R,u,j),k(R,c,j),k(R,d,j),k(R,p,j),k(R,f,j),w(f,h),h.checked=h.__value===r[1],w(f,g),k(R,_,j),k(R,y,j),w(y,m),m.checked=m.__value===r[1],w(y,b),k(R,v,j),k(R,M,j),w(M,L),L.checked=L.__value===r[1],w(M,P),k(R,x,j),k(R,I,j),w(I,T),T.checked=T.__value===r[1],w(I,U),k(R,Z,j),k(R,F,j),k(R,H,j),k(R,pe,j),k(R,we,j),k(R,ke,j),w(ke,re),w(ke,fe),w(ke,je),w(ke,Se),Oe(Se,r[2]),k(R,Q,j),ge&&ge.m(R,j),k(R,le,j),st=!0,lt||(he=[q(n,"click",r[6]),q(a,"input",r[7]),q(h,"change",r[8]),q(m,"change",r[10]),q(L,"change",r[11]),q(T,"change",r[12]),q(Se,"input",r[13])],lt=!0)},p(R,[j]){j&1&&a.value!==R[0]&&Oe(a,R[0]),j&2&&(h.checked=h.__value===R[1]),j&2&&(m.checked=m.__value===R[1]),j&2&&(L.checked=L.__value===R[1]),j&2&&(T.checked=T.__value===R[1]),j&4&&Oe(Se,R[2]),R[4]?ge?(ge.p(R,j),j&16&&$(ge,1)):(ge=Gr(R),ge.c(),$(ge,1),ge.m(le.parentNode,le)):ge&&(ae(),O(ge,1,1,()=>{ge=null}),ue())},i(R){st||($(ge),st=!0)},o(R){O(ge),st=!1},d(R){R&&S(e),R&&S(l),R&&S(u),R&&S(c),R&&S(d),R&&S(p),R&&S(f),r[9][0].splice(r[9][0].indexOf(h),1),R&&S(_),R&&S(y),r[9][0].splice(r[9][0].indexOf(m),1),R&&S(v),R&&S(M),r[9][0].splice(r[9][0].indexOf(L),1),R&&S(x),R&&S(I),r[9][0].splice(r[9][0].indexOf(T),1),R&&S(Z),R&&S(F),R&&S(H),R&&S(pe),R&&S(we),R&&S(ke),R&&S(Q),ge&&ge.d(R),R&&S(le),lt=!1,Re(he)}}}function Hr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Ws(r,e,t){let n,i;ne(r,mn,b=>t(14,n=b)),ne(r,te,b=>t(15,i=b));let{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function c(){let b=i.features.find(v=>v.id==o);try{t(0,s=await n.nameForRoute(b))}catch(v){window.alert(`Couldn't auto-name route: ${v}`)}}const d=[[]],p=()=>c();function f(){s=this.value,t(0,s)}function h(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function _(){a=this.__value,t(1,a)}function y(){a=this.__value,t(1,a)}function m(){l=this.value,t(2,l)}return r.$$set=b=>{"id"in b&&t(3,o=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(4,u=b.length_meters)},[s,a,l,o,u,c,p,f,h,d,g,_,y,m]}class Vs extends V{constructor(e){super(),K(this,e,Ws,Xs,Y,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}const Ks="Intervention",Zs=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],Qs={name:Ks,oneOf:Zs};function el(r){const e=r-1;return e*e*e+1}function Mt(r,{delay:e=0,duration:t=400,easing:n=el}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),c=parseFloat(i.marginBottom),d=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*c}px;border-top-width: ${f*d}px;border-bottom-width: ${f*p}px;`}}function Pi(r){return"members"in r}function Fi(r){return"oneOf"in r}function Ii(r){return typeof r=="string"}function Ni(r){return typeof r=="object"&&"value"in r}function tl(r){return"type"in r&&r.type=="number"}function Bi(r){return"type"in r&&r.type=="one-liner"}function Di(r){return"type"in r&&r.type=="textbox"}function ji(r){return"type"in r&&r.type=="checkbox"}function zr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Jr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Yr(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=W(t),C(e,"class","svelte-1b72l00")},m(i,o){k(i,e,o),w(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&Ce(n,t)},d(i){i&&S(e)}}}function nl(r){let e,t,n;return{c(){e=E("input"),C(e,"type","checkbox")},m(i,o){k(i,e,o),e.checked=r[0],t||(n=q(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:G,o:G,d(i){i&&S(e),t=!1,n()}}}function rl(r){let e,t,n;return{c(){e=E("textarea"),se(e,"width","100%"),C(e,"rows","5"),C(e,"class","svelte-1b72l00")},m(i,o){k(i,e,o),Oe(e,r[0]),t||(n=q(e,"input",r[13]),t=!0)},p(i,o){o&1&&Oe(e,i[0])},i:G,o:G,d(i){i&&S(e),t=!1,n()}}}function il(r){let e,t,n;return{c(){e=E("input"),C(e,"type","text"),se(e,"width","100%")},m(i,o){k(i,e,o),Oe(e,r[0]),t||(n=q(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Oe(e,i[0])},i:G,o:G,d(i){i&&S(e),t=!1,n()}}}function ol(r){let e,t,n;return{c(){e=E("input"),C(e,"type","number")},m(i,o){k(i,e,o),Oe(e,r[0]),t||(n=q(e,"input",r[11]),t=!0)},p(i,o){o&1&&wi(e.value)!==i[0]&&Oe(e,i[0])},i:G,o:G,d(i){i&&S(e),t=!1,n()}}}function sl(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=Wr(zr(r,n,s));const o=s=>O(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=_e()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);k(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=zr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=Wr(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(ae(),l=n.length;l<i.length;l+=1)o(l);ue()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)O(i[a]);t=!1},d(s){cn(i,s),s&&S(e)}}}function ll(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=Vr(Jr(r,n,s));const o=s=>O(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=_e()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);k(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Jr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=Vr(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(ae(),l=n.length;l<i.length;l+=1)o(l);ue()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)O(i[a]);t=!1},d(s){cn(i,s),s&&S(e)}}}function al(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,c,d,p,f=r[2]==r[15].name&&typeof r[0]=="object"&&Xr(r);return{c(){e=E("label"),t=E("input"),i=A(),s=W(o),a=E("br"),l=A(),f&&f.c(),u=_e(),C(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(h,g){k(h,e,g),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),k(h,l,g),f&&f.m(h,g),k(h,u,g),c=!0,d||(p=[q(t,"change",r[9]),q(t,"change",r[4])],d=!0)},p(h,g){(!c||g&2&&n!==(n=h[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),(!c||g&2)&&o!==(o=h[15].name+"")&&Ce(s,o),h[2]==h[15].name&&typeof h[0]=="object"?f?(f.p(h,g),g&7&&$(f,1)):(f=Xr(h),f.c(),$(f,1),f.m(u.parentNode,u)):f&&(ae(),O(f,1,1,()=>{f=null}),ue())},i(h){c||($(f),c=!0)},o(h){O(f),c=!1},d(h){h&&S(e),r[7][0].splice(r[7][0].indexOf(t),1),h&&S(l),f&&f.d(h),h&&S(u),d=!1,Re(p)}}}function ul(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,c;function d(h,g){return h[15].description?pl:cl}let p=d(r),f=p(r);return{c(){e=E("label"),t=E("input"),i=A(),s=W(o),a=A(),f.c(),l=A(),C(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(h,g){k(h,e,g),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),f.m(e,null),w(e,l),u||(c=[q(t,"change",r[8]),q(t,"change",r[3])],u=!0)},p(h,g){g&2&&n!==(n=h[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),g&2&&o!==(o=h[15].value+"")&&Ce(s,o),p===(p=d(h))&&f?f.p(h,g):(f.d(1),f=p(h),f&&(f.c(),f.m(e,l)))},i:G,o:G,d(h){h&&S(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Re(c)}}}function fl(r){let e,t,n,i,o=r[15]+"",s,a,l,u,c,d;return{c(){e=E("label"),t=E("input"),i=A(),s=W(o),a=A(),l=E("br"),u=A(),C(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(p,f){k(p,e,f),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),w(e,l),w(e,u),c||(d=[q(t,"change",r[6]),q(t,"change",r[3])],c=!0)},p(p,f){f&2&&n!==(n=p[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===p[2]),f&2&&o!==(o=p[15]+"")&&Ce(s,o)},i:G,o:G,d(p){p&&S(e),r[7][0].splice(r[7][0].indexOf(t),1),c=!1,Re(d)}}}function Xr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Vt({props:l}),oe.push(()=>Me(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),N(t.$$.fragment),i=A(),C(e,"class","svelte-1b72l00")},m(u,c){k(u,e,c),B(t,e,null),w(e,i),s=!0},p(u,c){r=u;const d={};c&2&&(d.spec=r[15]),!n&&c&3&&(n=!0,d.value=r[0][r[15].name],$e(()=>n=!1)),t.$set(d)},i(u){s||($(t.$$.fragment,u),it(()=>{o||(o=St(e,Mt,{duration:500},!0)),o.run(1)}),s=!0)},o(u){O(t.$$.fragment,u),o||(o=St(e,Mt,{duration:500},!1)),o.run(0),s=!1},d(u){u&&S(e),D(t),u&&o&&o.end()}}}function cl(r){let e;return{c(){e=E("br")},m(t,n){k(t,e,n)},p:G,d(t){t&&S(e)}}}function pl(r){let e,t,n=r[15].description+"",i,o;return{c(){e=E("p"),t=W("("),i=W(n),o=W(")"),C(e,"class","svelte-1b72l00")},m(s,a){k(s,e,a),w(e,t),w(e,i),w(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&Ce(i,n)},d(s){s&&S(e)}}}function Wr(r){let e,t,n,i,o,s;const a=[fl,ul,al],l=[];function u(c,d){return d&2&&(e=null),d&2&&(t=null),e==null&&(e=!!Ii(c[15])),e?0:(t==null&&(t=!!Ni(c[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=_e()},m(c,d){l[n].m(c,d),k(c,o,d),s=!0},p(c,d){let p=n;n=u(c,d),n===p?l[n].p(c,d):(ae(),O(l[p],1,1,()=>{l[p]=null}),ue(),i=l[n],i?i.p(c,d):(i=l[n]=a[n](c),i.c()),$(i,1),i.m(o.parentNode,o))},i(c){s||($(i),s=!0)},o(c){O(i),s=!1},d(c){l[n].d(c),c&&S(o)}}}function Vr(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function c(p){r[5](p,r[15])}let d={spec:r[15]};return r[0][r[15].name]!==void 0&&(d.value=r[0][r[15].name]),s=new Vt({props:d}),oe.push(()=>Me(s,"value",c,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),i=W(n),o=A(),N(s.$$.fragment),l=A(),C(e,"class","svelte-1b72l00")},m(p,f){k(p,e,f),w(e,t),w(t,i),w(e,o),B(s,e,null),w(e,l),u=!0},p(p,f){r=p,(!u||f&2)&&n!==(n=r[15].name+"")&&Ce(i,n);const h={};f&2&&(h.spec=r[15]),!a&&f&3&&(a=!0,h.value=r[0][r[15].name],$e(()=>a=!1)),s.$set(h)},i(p){u||($(s.$$.fragment,p),u=!0)},o(p){O(s.$$.fragment,p),u=!1},d(p){p&&S(e),D(s)}}}function dl(r){let e,t,n,i,o,s,a,l,u,c,d,p=r[1].description&&Yr(r);const f=[ll,sl,ol,il,rl,nl],h=[];function g(_,y){return y&2&&(t=null),y&2&&(n=null),y&2&&(i=null),y&2&&(o=null),y&2&&(s=null),y&2&&(a=null),t==null&&(t=!!Pi(_[1])),t?0:(n==null&&(n=!!Fi(_[1])),n?1:(i==null&&(i=!!tl(_[1])),i?2:(o==null&&(o=!!Bi(_[1])),o?3:(s==null&&(s=!!Di(_[1])),s?4:(a==null&&(a=!!ji(_[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=h[l]=f[l](r)),{c(){p&&p.c(),e=A(),u&&u.c(),c=_e()},m(_,y){p&&p.m(_,y),k(_,e,y),~l&&h[l].m(_,y),k(_,c,y),d=!0},p(_,[y]){_[1].description?p?p.p(_,y):(p=Yr(_),p.c(),p.m(e.parentNode,e)):p&&(p.d(1),p=null);let m=l;l=g(_,y),l===m?~l&&h[l].p(_,y):(u&&(ae(),O(h[m],1,1,()=>{h[m]=null}),ue()),~l?(u=h[l],u?u.p(_,y):(u=h[l]=f[l](_),u.c()),$(u,1),u.m(c.parentNode,c)):u=null)},i(_){d||($(u),d=!0)},o(_){O(u),d=!1},d(_){p&&p.d(_),_&&S(e),~l&&h[l].d(_),_&&S(c)}}}function hl(r,e,t){var m,b,v;let{spec:n}=e,{value:i}=e,o="";if(Pi(n)){i||(i={});for(let M of n.members)Bi(M)||Di(M)?i[m=M.name]||(i[m]=""):ji(M)?i[b=M.name]||(i[b]=!1):i[v=M.name]||(i[v]={})}else Fi(n)&&(i||(i={}),Ii(i)?o=i:Ni(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,L){r.$$.not_equal(i[L.name],M)&&(i[L.name]=M,t(0,i))}function c(){o=this.__value,t(2,o)}function d(){o=this.__value,t(2,o)}function p(){o=this.__value,t(2,o)}function f(M,L){r.$$.not_equal(i[L.name],M)&&(i[L.name]=M,t(0,i))}function h(){i=wi(this.value),t(0,i)}function g(){i=this.value,t(0,i)}function _(){i=this.value,t(0,i)}function y(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,c,l,d,p,f,h,g,_,y]}class Vt extends V{constructor(e){super(),K(this,e,hl,dl,Y,{spec:1,value:0})}}function ml(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Vt({props:o}),oe.push(()=>Me(e,"value",i,r[0].v2)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function _l(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=Qs;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class gl extends V{constructor(e){super(),K(this,e,_l,ml,Y,{props:0})}}const bl="Planning",yl=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],vl={name:bl,members:yl};function wl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Vt({props:o}),oe.push(()=>Me(e,"value",i,r[0].planning)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function kl(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=vl;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Sl extends V{constructor(e){super(),K(this,e,kl,wl,Y,{props:0})}}const El="CriticalIssue",Ml=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],$l={name:El,members:Ml};function Ll(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Vt({props:o}),oe.push(()=>Me(e,"value",i,r[0].criticals)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Ol(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=$l;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Cl extends V{constructor(e){super(),K(this,e,Ol,Ll,Y,{props:0})}}function Kr(r){let e,t,n,i,o;const s=r[10].default,a=gt(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),se(e,"border","solid 1px black"),se(e,"padding","10px")},m(l,u){k(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=q(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&bt(a,s,l,l[9],n?vt(s,l[9],u,null):yt(l[9]),null)},i(l){n||($(a,l),it(()=>{t||(t=St(e,Mt,{duration:100},!0)),t.run(1)}),n=!0)},o(l){O(a,l),t||(t=St(e,Mt,{duration:100},!1)),t.run(0),n=!1},d(l){l&&S(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Rl(r){let e,t,n,i,o,s,a,l,u,c,d=r[4]&&Kr(r);return{c(){e=E("button"),t=dn("svg"),n=dn("path"),i=A(),o=W(r[1]),s=A(),d&&d.c(),a=_e(),C(n,"d","M9 5l7 7-7 7"),C(t,"style","tran"),C(t,"width","20"),C(t,"height","20"),C(t,"fill","none"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"stroke-width","2"),C(t,"viewBox","0 0 24 24"),C(t,"stroke","currentColor"),C(t,"class","svelte-t7fpgu"),C(e,"aria-expanded",r[4]),C(e,"class","svelte-t7fpgu"),vr(e,"underlined",r[3])},m(p,f){k(p,e,f),w(e,t),w(t,n),w(e,i),w(e,o),k(p,s,f),d&&d.m(p,f),k(p,a,f),l=!0,u||(c=[q(e,"click",r[5]),q(e,"mouseenter",r[11]),q(e,"mouseleave",r[12])],u=!0)},p(p,[f]){(!l||f&2)&&Ce(o,p[1]),(!l||f&16)&&C(e,"aria-expanded",p[4]),(!l||f&8)&&vr(e,"underlined",p[3]),p[4]?d?(d.p(p,f),f&16&&$(d,1)):(d=Kr(p),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(ae(),O(d,1,1,()=>{d=null}),ue())},i(p){l||($(d),l=!0)},o(p){O(d),l=!1},d(p){p&&S(e),p&&S(s),d&&d.d(p),p&&S(a),u=!1,Re(c)}}}function Al(r,e,t){let n,i,o,s;ne(r,Be,m=>t(7,o=m)),ne(r,Ee,m=>t(8,s=m));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:c}=e;const d=()=>{Ee.update(m=>m==u?null:u),s==u&&(Ht.set(null),Ht.set(u))};let p;function f(){p==null||p.scrollIntoView({behavior:"smooth"})}const h=()=>Gt.set(u),g=()=>Gt.set(null);function _(m){oe[m?"unshift":"push"](()=>{p=m,t(2,p)})}const y=()=>f();return r.$$set=m=>{"id"in m&&t(0,u=m.id),"label"in m&&t(1,c=m.label),"$$scope"in m&&t(9,l=m.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,c,p,i,n,d,f,o,s,l,a,h,g,_,y]}class Tl extends V{constructor(e){super(),K(this,e,Al,Rl,Y,{id:0,label:1})}}function Zr(r,e,t){const n=r.slice();return n[13]=e[t],n[14]=e,n[15]=t,n}function xl(r){let e,t,n;function i(s){r[9](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Cl({props:o}),oe.push(()=>Me(e,"props",i,r[13].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Pl(r){let e,t,n;function i(s){r[8](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Sl({props:o}),oe.push(()=>Me(e,"props",i,r[13].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Fl(r){let e,t,n;function i(s){r[7](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new gl({props:o}),oe.push(()=>Me(e,"props",i,r[13].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Il(r){let e,t,n,i,o;function s(c){r[4](c,r[13])}function a(c){r[5](c,r[13])}function l(c){r[6](c,r[13])}let u={id:r[13].id,length_meters:r[13].properties.length_meters};return r[13].properties.name!==void 0&&(u.name=r[13].properties.name),r[13].properties.intervention_type!==void 0&&(u.intervention_type=r[13].properties.intervention_type),r[13].properties.description!==void 0&&(u.description=r[13].properties.description),e=new Vs({props:u}),oe.push(()=>Me(e,"name",s,r[13].properties.name)),oe.push(()=>Me(e,"intervention_type",a,r[13].properties.intervention_type)),oe.push(()=>Me(e,"description",l,r[13].properties.description)),{c(){N(e.$$.fragment)},m(c,d){B(e,c,d),o=!0},p(c,d){r=c;const p={};d&2&&(p.id=r[13].id),d&2&&(p.length_meters=r[13].properties.length_meters),!t&&d&2&&(t=!0,p.name=r[13].properties.name,$e(()=>t=!1)),!n&&d&2&&(n=!0,p.intervention_type=r[13].properties.intervention_type,$e(()=>n=!1)),!i&&d&2&&(i=!0,p.description=r[13].properties.description,$e(()=>i=!1)),e.$set(p)},i(c){o||($(e.$$.fragment,c),o=!0)},o(c){O(e.$$.fragment,c),o=!1},d(c){D(e,c)}}}function Nl(r){let e,t,n,i,o,s,a,l,u,c,d,p,f,h,g;const _=[Il,Fl,Pl,xl],y=[];function m(v,M){return v[0]=="v1"?0:v[0]=="v2"?1:v[0]=="planning"?2:v[0]=="criticals"?3:-1}~(e=m(r))&&(t=y[e]=_[e](r));function b(){return r[10](r[13])}return{c(){t&&t.c(),n=A(),i=E("br"),o=A(),s=E("br"),a=A(),l=E("div"),u=E("button"),u.textContent="Delete",c=A(),d=E("button"),d.textContent="Save",p=A(),C(u,"type","button"),C(d,"type","button"),se(l,"display","flex"),se(l,"justify-content","space-between")},m(v,M){~e&&y[e].m(v,M),k(v,n,M),k(v,i,M),k(v,o,M),k(v,s,M),k(v,a,M),k(v,l,M),w(l,u),w(l,c),w(l,d),k(v,p,M),f=!0,h||(g=[q(u,"click",b),q(d,"click",r[11])],h=!0)},p(v,M){r=v;let L=e;e=m(r),e===L?~e&&y[e].p(r,M):(t&&(ae(),O(y[L],1,1,()=>{y[L]=null}),ue()),~e?(t=y[e],t?t.p(r,M):(t=y[e]=_[e](r),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(v){f||($(t),f=!0)},o(v){O(t),f=!1},d(v){~e&&y[e].d(v),v&&S(n),v&&S(i),v&&S(o),v&&S(s),v&&S(a),v&&S(l),v&&S(p),h=!1,Re(g)}}}function Qr(r,e){let t,n,i;return n=new Tl({props:{id:e[13].id,label:e[15]+1+") "+e[2](e[13]),$$slots:{default:[Nl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=_e(),N(n.$$.fragment),this.first=t},m(o,s){k(o,t,s),B(n,o,s),i=!0},p(o,s){e=o;const a={};s&2&&(a.id=e[13].id),s&2&&(a.label=e[15]+1+") "+e[2](e[13])),s&65539&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){O(n.$$.fragment,o),i=!1},d(o){o&&S(t),D(n,o)}}}function Bl(r){let e=[],t=new Map,n,i,o,s,a=r[1].features;const l=u=>u[13].id;for(let u=0;u<a.length;u+=1){let c=Zr(r,a,u),d=l(c);t.set(d,e[u]=Qr(d,c))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=_e()},m(u,c){for(let d=0;d<e.length;d+=1)e[d].m(u,c);k(u,n,c),i=!0,o||(s=q(window,"keydown",r[3]),o=!0)},p(u,[c]){c&7&&(a=u[1].features,ae(),e=uo(e,c,l,1,u,a,t,n.parentNode,fo,Qr,n,Zr),ue())},i(u){if(!i){for(let c=0;c<a.length;c+=1)$(e[c]);i=!0}},o(u){for(let c=0;c<e.length;c+=1)O(e[c]);i=!1},d(u){for(let c=0;c<e.length;c+=1)e[c].d(u);u&&S(n),o=!1,s()}}}function Dl(r,e,t){let n,i;ne(r,Ee,_=>t(12,n=_)),ne(r,te,_=>t(1,i=_));let{schema:o}=e;function s(_){var m,b,v,M,L;if(o=="planning")return((m=_.properties.planning)==null?void 0:m.name)||"Untitled polygon";if(o=="v2")return((v=(b=_.properties.v2)==null?void 0:b.Route)==null?void 0:v.name)||((L=(M=_.properties.v2)==null?void 0:M.Crossing)==null?void 0:L.name)||"Untitled intervention";if(_.properties.name)return _.properties.name;var y=_.properties.intervention_type;return y=="other"&&(_.geometry.type=="Point"?y="point":_.geometry.type=="LineString"?y="line":y="polygon"),`Untitled ${y}`}function a(_){if(_.key=="Delete"){const y=_.target.tagName;if(y=="INPUT"||y=="TEXTAREA")return;_.preventDefault();const m=n;m&&kr(m)}}function l(_,y){r.$$.not_equal(y.properties.name,_)&&(y.properties.name=_,te.set(i))}function u(_,y){r.$$.not_equal(y.properties.intervention_type,_)&&(y.properties.intervention_type=_,te.set(i))}function c(_,y){r.$$.not_equal(y.properties.description,_)&&(y.properties.description=_,te.set(i))}function d(_,y){r.$$.not_equal(y.properties,_)&&(y.properties=_,te.set(i))}function p(_,y){r.$$.not_equal(y.properties,_)&&(y.properties=_,te.set(i))}function f(_,y){r.$$.not_equal(y.properties,_)&&(y.properties=_,te.set(i))}const h=_=>kr(_.id),g=()=>Ee.set(null);return r.$$set=_=>{"schema"in _&&t(0,o=_.schema)},[o,i,s,a,l,u,c,d,p,f,h,g]}class jl extends V{constructor(e){super(),K(this,e,Dl,Bl,Y,{schema:0})}}function ei(r){let e,t;return e=new xi({props:{id:void 0}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p:G,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ul(r){let e,t,n,i,o,s,a,l,u,c,d,p=r[1]=="speed limits"&&ei();return{c(){e=E("label"),t=W(`Show layer:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",a=A(),p&&p.c(),l=_e(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,n.disabled=s=r[0]!=null,r[1]===void 0&&it(()=>r[2].call(n))},m(f,h){k(f,e,h),w(e,t),w(e,n),w(n,i),w(n,o),Ve(n,r[1]),k(f,a,h),p&&p.m(f,h),k(f,l,h),u=!0,c||(d=q(n,"change",r[2]),c=!0)},p(f,[h]){(!u||h&1&&s!==(s=f[0]!=null))&&(n.disabled=s),h&2&&Ve(n,f[1]),f[1]=="speed limits"?p?(p.p(f,h),h&2&&$(p,1)):(p=ei(),p.c(),$(p,1),p.m(l.parentNode,l)):p&&(ae(),O(p,1,1,()=>{p=null}),ue())},i(f){u||($(p),u=!0)},o(f){O(p),u=!1},d(f){f&&S(e),f&&S(a),p&&p.d(f),f&&S(l),c=!1,d()}}}function ql(r,e,t){let n;ne(r,Ee,s=>t(0,n=s));let i="none";function o(){i=$n(this),t(1,i),t(0,n)}return r.$$.update=()=>{r.$$.dirty&1&&n&&t(1,i="none")},[n,i,o]}class Gl extends V{constructor(e){super(),K(this,e,ql,Ul,Y,{})}}function We(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function De(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Zn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function ze(r,e,t){t===void 0&&(t={});var n=We(r),i=We(e),o=xe(i[1]-n[1]),s=xe(i[0]-n[0]),a=xe(n[1]),l=xe(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return co(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function sn(r,e){return e===void 0&&(e={}),po(r,function(t,n){var i=n.geometry.coordinates;return t+ze(i[0],i[1],e)},0)}function Hl(r){let e,t,n,i,o,s,a,l,u,c,d,p,f,h,g,_,y,m,b,v=r[0].features.length+"",M,L,P,x,I,T,U,Z;return{c(){e=E("div"),t=E("label"),n=W(`Scheme name:
    `),i=E("input"),o=A(),s=E("br"),a=A(),l=E("div"),u=E("label"),c=E("input"),d=A(),p=E("button"),p.textContent="Load from GeoJSON",f=A(),h=E("button"),h.textContent="Export to GeoJSON",g=A(),_=E("br"),y=A(),m=E("div"),b=E("span"),M=W(v),L=W(" objects"),P=A(),x=E("button"),I=W("Clear all"),C(i,"type","text"),C(c,"type","file"),C(c,"id","load_geojson"),C(c,"class","svelte-lhyd1e"),C(p,"type","button"),C(h,"type","button"),C(h,"class","align-right svelte-lhyd1e"),C(x,"type","button"),C(x,"class","align-right svelte-lhyd1e"),x.disabled=T=r[0].features.length==0},m(F,H){k(F,e,H),w(e,t),w(t,n),w(t,i),Oe(i,r[0].scheme_name),k(F,o,H),k(F,s,H),k(F,a,H),k(F,l,H),w(l,u),w(u,c),w(u,d),w(u,p),w(l,f),w(l,h),k(F,g,H),k(F,_,H),k(F,y,H),k(F,m,H),w(m,b),w(b,M),w(b,L),w(m,P),w(m,x),w(x,I),U||(Z=[q(i,"input",r[8]),q(c,"change",r[3]),q(p,"click",Jl),q(h,"click",r[2]),q(x,"click",r[1])],U=!0)},p(F,[H]){H&1&&i.value!==F[0].scheme_name&&Oe(i,F[0].scheme_name),H&1&&v!==(v=F[0].features.length+"")&&Ce(M,v),H&1&&T!==(T=F[0].features.length==0)&&(x.disabled=T)},i:G,o:G,d(F){F&&S(e),F&&S(o),F&&S(s),F&&S(a),F&&S(l),F&&S(g),F&&S(_),F&&S(y),F&&S(m),U=!1,Re(Z)}}}function zl(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Jl(){document.getElementById("load_geojson").click()}function Yl(r,e,t){let n;ne(r,te,h=>t(0,n=h));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=!1;Xt(async()=>{let g=new URLSearchParams(window.location.search).get("geojsonUrl"),_=window.localStorage.getItem(s);if(g){console.log(`Loading GeoJSON from ${g}`);try{let m=await(await fetch(g)).text();te.set(p(JSON.parse(m)))}catch(y){console.log(`Failed to load from URL: ${y}`)}}else if(_)try{te.set(p(JSON.parse(_)))}catch(y){console.log(`Failed to load from local storage: ${y}`)}t(7,a=!0)});function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(te.update(h=>(delete h.scheme_name,h.features=[],h)),Ee.set(null),Be.set(null),Gt.set(null),Ht.set(null))}function u(){const h=JSON.parse(JSON.stringify(n));for(let g of h.features)delete g.properties.hide_while_editing;return h}function c(){let h=u();var g=s;h.authority=i,h.origin="atip-v1",h.scheme_name&&(g+="_"+h.scheme_name),g+=".txt",zl(g,JSON.stringify(h,null,"  "))}function d(h){const g=new FileReader;g.onload=y=>{try{te.set(p(JSON.parse(y.target.result)))}catch(m){window.alert(`Couldn't load scheme from a file: ${m}`)}};let _=h.target.files;g.readAsText(_[0])}function p(h){let g=1;for(let _ of h.features)_.properties||(_.properties={name:"",description:"",intervention_type:"other"}),_.geometry.type=="LineString"&&!_.properties.length_meters&&(_.properties.length_meters=sn(_,{units:"kilometers"})*1e3),_.id=g++;return h}function f(){n.scheme_name=this.value,te.set(n)}return r.$$set=h=>{"authorityName"in h&&t(4,i=h.authorityName),"schema"in h&&t(5,o=h.schema)},r.$$.update=()=>{r.$$.dirty&193&&a&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,c,d,i,o,s,a,f]}class Xl extends V{constructor(e){super(),K(this,e,Yl,Hl,Y,{authorityName:4,schema:5})}}const Wl="/atip/190-add-link-to-dynamically-generated-roadmap-in-milestones/assets/zoom_out_map-b2e1091a.svg";function Vl(r){let e,t,n,i,o;return{c(){e=E("button"),t=E("img"),pn(t.src,n=Wl)||C(t,"src",n),C(t,"alt","Zoom to show entire boundary"),C(e,"type","button"),C(e,"title","Zoom to show entire boundary"),C(e,"class","svelte-qzjsqo")},m(s,a){k(s,e,a),w(e,t),i||(o=q(e,"click",r[0]),i=!0)},p:G,i:G,o:G,d(s){s&&S(e),i=!1,o()}}}function Kl(r,e,t){let n;ne(r,Ae,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(or(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class Zl extends V{constructor(e){super(),K(this,e,Kl,Vl,Y,{boundaryGeojson:1})}}function Ql(r){let e,t,n,i,o,s,a;return{c(){e=E("div"),t=W(`Basemap:
  `),n=E("select"),i=E("option"),i.textContent="Streets",o=E("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&it(()=>r[2].call(n)),C(e,"class","svelte-1tbnm6i")},m(l,u){k(l,e,u),w(e,t),w(e,n),w(n,i),w(n,o),Ve(n,r[0]),s||(a=[q(n,"change",r[2]),q(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&Ve(n,l[0])},i:G,o:G,d(l){l&&S(e),s=!1,Re(a)}}}function ea(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=$n(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class ta extends V{constructor(e){super(),K(this,e,ea,Ql,Y,{style:0})}}function ti(r){let e,t,n;const i=r[3].default,o=gt(i,r,r[2],null);return{c(){e=E("div"),o&&o.c()},m(s,a){k(s,e,a),o&&o.m(e,null),n=!0},p(s,a){o&&o.p&&(!n||a&4)&&bt(o,i,s,s[2],n?vt(i,s[2],a,null):yt(s[2]),null)},i(s){n||($(o,s),it(()=>{t||(t=St(e,Mt,{duration:100},!0)),t.run(1)}),n=!0)},o(s){O(o,s),t||(t=St(e,Mt,{duration:100},!1)),t.run(0),n=!1},d(s){s&&S(e),o&&o.d(s),s&&t&&t.end()}}}function na(r){let e,t,n,i,o,s,a,l,u,c,d=r[0]&&ti(r);return{c(){e=E("button"),t=dn("svg"),n=dn("path"),i=A(),o=W(r[1]),s=A(),d&&d.c(),a=_e(),C(n,"d","M9 5l7 7-7 7"),C(t,"style","tran"),C(t,"width","20"),C(t,"height","20"),C(t,"fill","none"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"stroke-width","2"),C(t,"viewBox","0 0 24 24"),C(t,"stroke","currentColor"),C(t,"class","svelte-una9lq"),C(e,"aria-expanded",r[0]),C(e,"class","svelte-una9lq")},m(p,f){k(p,e,f),w(e,t),w(t,n),w(e,i),w(e,o),k(p,s,f),d&&d.m(p,f),k(p,a,f),l=!0,u||(c=q(e,"click",r[4]),u=!0)},p(p,[f]){(!l||f&2)&&Ce(o,p[1]),(!l||f&1)&&C(e,"aria-expanded",p[0]),p[0]?d?(d.p(p,f),f&1&&$(d,1)):(d=ti(p),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(ae(),O(d,1,1,()=>{d=null}),ue())},i(p){l||($(d),l=!0)},o(p){O(d),l=!1},d(p){p&&S(e),p&&S(s),d&&d.d(p),p&&S(a),u=!1,c()}}}function ra(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,o=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,i=l.$$scope)},[s,o,i,n,a]}class An extends V{constructor(e){super(),K(this,e,ra,na,Y,{label:1,open:0})}}function ia(r){let e,t,n,i,o,s,a,l,u,c,d,p,f,h,g;return{c(){e=E("li"),t=E("span"),n=W("Areas"),i=A(),o=E("li"),s=E("span"),a=W("Routes"),l=A(),u=E("li"),c=E("span"),d=W("Crossings"),p=A(),f=E("li"),h=E("span"),g=W("Other"),C(t,"class","svelte-l42ea0"),se(t,"background",de.area),C(s,"class","svelte-l42ea0"),se(s,"background",de.route),C(c,"class","svelte-l42ea0"),se(c,"background",de.crossing),C(h,"class","svelte-l42ea0"),se(h,"background",de.other)},m(_,y){k(_,e,y),w(e,t),w(e,n),k(_,i,y),k(_,o,y),w(o,s),w(o,a),k(_,l,y),k(_,u,y),w(u,c),w(u,d),k(_,p,y),k(_,f,y),w(f,h),w(f,g)},p:G,d(_){_&&S(e),_&&S(i),_&&S(o),_&&S(l),_&&S(u),_&&S(p),_&&S(f)}}}function oa(r){let e,t,n,i,o,s,a,l,u,c,d,p,f,h,g;return{c(){e=E("li"),t=E("span"),n=W("Preapp"),i=A(),o=E("li"),s=E("span"),a=W("Outline"),l=A(),u=E("li"),c=E("span"),d=W("Reserved matters"),p=A(),f=E("li"),h=E("span"),g=W("Local plan"),C(t,"class","svelte-l42ea0"),se(t,"background",de.preapp),C(s,"class","svelte-l42ea0"),se(s,"background",de.outline),C(c,"class","svelte-l42ea0"),se(c,"background",de["reserved matters"]),C(h,"class","svelte-l42ea0"),se(h,"background",de["local plan"])},m(_,y){k(_,e,y),w(e,t),w(e,n),k(_,i,y),k(_,o,y),w(o,s),w(o,a),k(_,l,y),k(_,u,y),w(u,c),w(u,d),k(_,p,y),k(_,f,y),w(f,h),w(f,g)},p:G,d(_){_&&S(e),_&&S(i),_&&S(o),_&&S(l),_&&S(u),_&&S(p),_&&S(f)}}}function sa(r){let e;function t(o,s){return o[0]=="planning"?oa:ia}let n=t(r),i=n(r);return{c(){e=E("ul"),i.c()},m(o,s){k(o,e,s),i.m(e,null)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&S(e),i.d()}}}function la(r){let e,t,n;return t=new An({props:{label:"Objects",open:!0,$$slots:{default:[sa]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),C(e,"class","svelte-l42ea0")},m(i,o){k(i,e,o),B(t,e,null),n=!0},p(i,[o]){const s={};o&3&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){O(t.$$.fragment,i),n=!1},d(i){i&&S(e),D(t)}}}function aa(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class ua extends V{constructor(e){super(),K(this,e,aa,la,Y,{schema:0})}}let ft="interventions";function fa(r,e,t){let n,i;ne(r,Ae,c=>t(1,n=c)),ne(r,te,c=>t(2,i=c));let{schema:o}=e;Ze(n,ft,i);const s=["match",["get","intervention_type"],"area",de.area,"route",de.route,"crossing",de.crossing,"other",de.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",de.preapp,"outline",de.outline,"reserved matters",de["reserved matters"],"local plan",de["local plan"],"white"],l=["!=","hide_while_editing",!0];return ve(n,{id:"interventions-points",source:ft,filter:["all",Ln,l,["!=","endpoint",!0]],...Lt(s,Rn)}),ve(n,{id:"interventions-lines",source:ft,filter:["all",On,l],...kt(s,Jt)}),ve(n,{id:"interventions-lines-endpoints",source:ft,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Jt,"circle-opacity":0,"circle-stroke-color":de.lineEndpointColor,"circle-stroke-width":2}}),ve(n,{id:"interventions-polygons",source:ft,filter:["all",Cn,l],...Mn(o=="planning"?a:s,.5)}),r.$$set=c=>{"schema"in c&&t(0,o=c.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let c=JSON.parse(JSON.stringify(i)),d=[];for(let p of c.features)if(p.geometry.type=="LineString")for(let f of[p.geometry.coordinates[0],p.geometry.coordinates[p.geometry.coordinates.length-1]])d.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});c.features=c.features.concat(d),n.getSource(ft).setData(c)}},[o,n,i]}class ca extends V{constructor(e){super(),K(this,e,fa,null,Y,{schema:0})}}let ct="hover";function pa(r,e,t){let n,i,o,s,a;return ne(r,Ae,l=>t(0,n=l)),ne(r,te,l=>t(1,i=l)),ne(r,Gt,l=>t(2,o=l)),ne(r,Be,l=>t(3,s=l)),ne(r,Ee,l=>t(4,a=l)),Ze(n,ct,Fe()),ve(n,{id:"hover-polygons",source:ct,filter:Cn,...kt(de.hovering,.5*Jt,1)}),ve(n,{id:"hover-lines",source:ct,filter:On,...kt(de.hovering,1.5*Jt,1)}),ve(n,{id:"hover-points",source:ct,filter:Ln,...Lt(de.hovering,1.5*Rn,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(ct).setData(i.features.find(u=>u.id==l)):n.getSource(ct).setData(Fe())}},[n,i,o,s,a]}class da extends V{constructor(e){super(),K(this,e,pa,null,Y,{})}}class fr{constructor(e,t){ie(this,"owner");ie(this,"map");ie(this,"mapHandlers",{});ie(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Qt="edit-point-mode";class ha{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"cursor");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new fr(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Ze(e,Qt,Fe()),ve(e,{id:"edit-point-mode",source:Qt,...Lt(de.hovering,Rn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=ma(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Qt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Fe();this.cursor&&e.features.push(this.cursor),this.map.getSource(Qt).setData(e)}}function ma(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Ui(r,e,t){if(t===void 0&&(t={}),t.final===!0)return _a(r,e);var n=We(r),i=We(e),o=xe(n[0]),s=xe(i[0]),a=xe(n[1]),l=xe(i[1]),u=Math.sin(s-o)*Math.cos(l),c=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return qn(Math.atan2(u,c))}function _a(r,e){var t=Ui(e,r);return t=(t+180)%360,t}function ni(r,e,t,n){n===void 0&&(n={});var i=We(r),o=xe(i[0]),s=xe(i[1]),a=xe(t),l=ho(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),d=qn(c),p=qn(u);return wt([d,p],n.properties)}function Qn(r){if(!r)throw new Error("geojson is required");var e=[];return sr(r,function(t){ga(t,e)}),Xe(e)}function ga(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=De(n);break;case"LineString":t=[De(n)]}t.forEach(function(i){var o=ba(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function ba(r,e){var t=[];return r.reduce(function(n,i){var o=Et([n,i],e);return o.bbox=ya(n,i),t.push(o),i}),t}function ya(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var $t={},va={get exports(){return $t},set exports(r){$t=r}},er={},wa={get exports(){return er},set exports(r){er=r}};(function(r,e){(function(t,n){r.exports=n()})(mo,function(){function t(m,b,v,M,L){(function P(x,I,T,U,Z){for(;U>T;){if(U-T>600){var F=U-T+1,H=I-T+1,pe=Math.log(F),we=.5*Math.exp(2*pe/3),ke=.5*Math.sqrt(pe*we*(F-we)/F)*(H-F/2<0?-1:1),re=Math.max(T,Math.floor(I-H*we/F+ke)),fe=Math.min(U,Math.floor(I+(F-H)*we/F+ke));P(x,I,re,fe,Z)}var je=x[I],Se=T,Q=U;for(n(x,T,I),Z(x[U],je)>0&&n(x,T,U);Se<Q;){for(n(x,Se,Q),Se++,Q--;Z(x[Se],je)<0;)Se++;for(;Z(x[Q],je)>0;)Q--}Z(x[T],je)===0?n(x,T,Q):n(x,++Q,U),Q<=I&&(T=Q+1),I<=Q&&(U=Q-1)}})(m,b,v||0,M||m.length-1,L||i)}function n(m,b,v){var M=m[b];m[b]=m[v],m[v]=M}function i(m,b){return m<b?-1:m>b?1:0}var o=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(m,b,v){if(!v)return b.indexOf(m);for(var M=0;M<b.length;M++)if(v(m,b[M]))return M;return-1}function a(m,b){l(m,0,m.children.length,b,m)}function l(m,b,v,M,L){L||(L=_(null)),L.minX=1/0,L.minY=1/0,L.maxX=-1/0,L.maxY=-1/0;for(var P=b;P<v;P++){var x=m.children[P];u(L,m.leaf?M(x):x)}return L}function u(m,b){return m.minX=Math.min(m.minX,b.minX),m.minY=Math.min(m.minY,b.minY),m.maxX=Math.max(m.maxX,b.maxX),m.maxY=Math.max(m.maxY,b.maxY),m}function c(m,b){return m.minX-b.minX}function d(m,b){return m.minY-b.minY}function p(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function f(m){return m.maxX-m.minX+(m.maxY-m.minY)}function h(m,b){return m.minX<=b.minX&&m.minY<=b.minY&&b.maxX<=m.maxX&&b.maxY<=m.maxY}function g(m,b){return b.minX<=m.maxX&&b.minY<=m.maxY&&b.maxX>=m.minX&&b.maxY>=m.minY}function _(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(m,b,v,M,L){for(var P=[b,v];P.length;)if(!((v=P.pop())-(b=P.pop())<=M)){var x=b+Math.ceil((v-b)/M/2)*M;t(m,x,b,v,L),P.push(b,x,x,v)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(m){var b=this.data,v=[];if(!g(m,b))return v;for(var M=this.toBBox,L=[];b;){for(var P=0;P<b.children.length;P++){var x=b.children[P],I=b.leaf?M(x):x;g(m,I)&&(b.leaf?v.push(x):h(m,I)?this._all(x,v):L.push(x))}b=L.pop()}return v},o.prototype.collides=function(m){var b=this.data;if(!g(m,b))return!1;for(var v=[];b;){for(var M=0;M<b.children.length;M++){var L=b.children[M],P=b.leaf?this.toBBox(L):L;if(g(m,P)){if(b.leaf||h(m,P))return!0;v.push(L)}}b=v.pop()}return!1},o.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var b=0;b<m.length;b++)this.insert(m[b]);return this}var v=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var M=this.data;this.data=v,v=M}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},o.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(m,b){if(!m)return this;for(var v,M,L,P=this.data,x=this.toBBox(m),I=[],T=[];P||I.length;){if(P||(P=I.pop(),M=I[I.length-1],v=T.pop(),L=!0),P.leaf){var U=s(m,P.children,b);if(U!==-1)return P.children.splice(U,1),I.push(P),this._condense(I),this}L||P.leaf||!h(P,x)?M?(v++,P=M.children[v],L=!1):P=null:(I.push(P),T.push(v),v=0,M=P,P=P.children[0])}return this},o.prototype.toBBox=function(m){return m},o.prototype.compareMinX=function(m,b){return m.minX-b.minX},o.prototype.compareMinY=function(m,b){return m.minY-b.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(m){return this.data=m,this},o.prototype._all=function(m,b){for(var v=[];m;)m.leaf?b.push.apply(b,m.children):v.push.apply(v,m.children),m=v.pop();return b},o.prototype._build=function(m,b,v,M){var L,P=v-b+1,x=this._maxEntries;if(P<=x)return a(L=_(m.slice(b,v+1)),this.toBBox),L;M||(M=Math.ceil(Math.log(P)/Math.log(x)),x=Math.ceil(P/Math.pow(x,M-1))),(L=_([])).leaf=!1,L.height=M;var I=Math.ceil(P/x),T=I*Math.ceil(Math.sqrt(x));y(m,b,v,T,this.compareMinX);for(var U=b;U<=v;U+=T){var Z=Math.min(U+T-1,v);y(m,U,Z,I,this.compareMinY);for(var F=U;F<=Z;F+=I){var H=Math.min(F+I-1,Z);L.children.push(this._build(m,F,H,M-1))}}return a(L,this.toBBox),L},o.prototype._chooseSubtree=function(m,b,v,M){for(;M.push(b),!b.leaf&&M.length-1!==v;){for(var L=1/0,P=1/0,x=void 0,I=0;I<b.children.length;I++){var T=b.children[I],U=p(T),Z=(F=m,H=T,(Math.max(H.maxX,F.maxX)-Math.min(H.minX,F.minX))*(Math.max(H.maxY,F.maxY)-Math.min(H.minY,F.minY))-U);Z<P?(P=Z,L=U<L?U:L,x=T):Z===P&&U<L&&(L=U,x=T)}b=x||b.children[0]}var F,H;return b},o.prototype._insert=function(m,b,v){var M=v?m:this.toBBox(m),L=[],P=this._chooseSubtree(M,this.data,b,L);for(P.children.push(m),u(P,M);b>=0&&L[b].children.length>this._maxEntries;)this._split(L,b),b--;this._adjustParentBBoxes(M,L,b)},o.prototype._split=function(m,b){var v=m[b],M=v.children.length,L=this._minEntries;this._chooseSplitAxis(v,L,M);var P=this._chooseSplitIndex(v,L,M),x=_(v.children.splice(P,v.children.length-P));x.height=v.height,x.leaf=v.leaf,a(v,this.toBBox),a(x,this.toBBox),b?m[b-1].children.push(x):this._splitRoot(v,x)},o.prototype._splitRoot=function(m,b){this.data=_([m,b]),this.data.height=m.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(m,b,v){for(var M,L,P,x,I,T,U,Z=1/0,F=1/0,H=b;H<=v-b;H++){var pe=l(m,0,H,this.toBBox),we=l(m,H,v,this.toBBox),ke=(L=pe,P=we,x=void 0,I=void 0,T=void 0,U=void 0,x=Math.max(L.minX,P.minX),I=Math.max(L.minY,P.minY),T=Math.min(L.maxX,P.maxX),U=Math.min(L.maxY,P.maxY),Math.max(0,T-x)*Math.max(0,U-I)),re=p(pe)+p(we);ke<Z?(Z=ke,M=H,F=re<F?re:F):ke===Z&&re<F&&(F=re,M=H)}return M||v-b},o.prototype._chooseSplitAxis=function(m,b,v){var M=m.leaf?this.compareMinX:c,L=m.leaf?this.compareMinY:d;this._allDistMargin(m,b,v,M)<this._allDistMargin(m,b,v,L)&&m.children.sort(M)},o.prototype._allDistMargin=function(m,b,v,M){m.children.sort(M);for(var L=this.toBBox,P=l(m,0,b,L),x=l(m,v-b,v,L),I=f(P)+f(x),T=b;T<v-b;T++){var U=m.children[T];u(P,m.leaf?L(U):U),I+=f(P)}for(var Z=v-b-1;Z>=b;Z--){var F=m.children[Z];u(x,m.leaf?L(F):F),I+=f(x)}return I},o.prototype._adjustParentBBoxes=function(m,b,v){for(var M=v;M>=0;M--)u(b[M],m)},o.prototype._condense=function(m){for(var b=m.length-1,v=void 0;b>=0;b--)m[b].children.length===0?b>0?(v=m[b-1].children).splice(v.indexOf(m[b]),1):this.clear():a(m[b],this.toBBox)},o})})(wa);const ka=lr(_o),Sa=lr(go),Ea=lr(bo);var Ie=er,qi=ka,Gi=Sa,pt=Ea.default,Ma=Gi.featureEach;Gi.coordEach;qi.polygon;var ri=qi.featureCollection;function Hi(r){var e=new Ie(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:pt(t),Ie.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:pt(i),n.push(i)}):Ma(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:pt(i),n.push(i)}),Ie.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:pt(t),Ie.prototype.remove.call(this,t,n)},e.clear=function(){return Ie.prototype.clear.call(this)},e.search=function(t){var n=Ie.prototype.search.call(this,this.toBBox(t));return ri(n)},e.collides=function(t){return Ie.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ie.prototype.all.call(this);return ri(t)},e.toJSON=function(){return Ie.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ie.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=pt(t);else if(t.type==="FeatureCollection")n=pt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}va.exports=Hi;$t.default=Hi;function zi(r,e){var t={},n=[];if(r.type==="LineString"&&(r=wr(r)),e.type==="LineString"&&(e=wr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=ii(r,e);return i&&n.push(i),Xe(n)}var o=$t();return o.load(Qn(e)),hn(Qn(r),function(s){hn(o.search(s),function(a){var l=ii(s,a);if(l){var u=De(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),Xe(n)}function ii(r,e){var t=De(r),n=De(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],c=n[1][0],d=n[1][1],p=(d-u)*(s-i)-(c-l)*(a-o),f=(c-l)*(o-u)-(d-u)*(i-l),h=(s-i)*(o-u)-(a-o)*(i-l);if(p===0)return f===0&&h===0,null;var g=f/p,_=h/p;if(g>=0&&g<=1&&_>=0&&_<=1){var y=i+g*(s-i),m=o+g*(a-o);return wt([y,m])}return null}function Yt(r,e,t){t===void 0&&(t={});var n=wt([1/0,1/0],{dist:1/0}),i=0;return sr(r,function(o){for(var s=De(o),a=0;a<s.length-1;a++){var l=wt(s[a]);l.properties.dist=ze(e,l,t);var u=wt(s[a+1]);u.properties.dist=ze(e,u,t);var c=ze(l,u,t),d=Math.max(l.properties.dist,u.properties.dist),p=Ui(l,u),f=ni(e,d,p+90,t),h=ni(e,d,p-90,t),g=zi(Et([f.geometry.coordinates,h.geometry.coordinates]),Et([l.geometry.coordinates,u.geometry.coordinates])),_=null;g.features.length>0&&(_=g.features[0],_.properties.dist=ze(e,_,t),_.properties.location=i+ze(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+c),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a),i+=c}}),n}const dt="edit-polygon-mode";class $a{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"points");ie(this,"cursor");ie(this,"hover");ie(this,"dragFrom");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new fr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Ze(e,dt,Fe()),ve(e,{id:"edit-polygon-fill",source:dt,filter:Cn,...Mn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),ve(e,{id:"edit-polygon-lines",source:dt,filter:On,...kt("black",8,.5)}),ve(e,{id:"edit-polygon-vertices",source:dt,filter:Ln,...Lt(de.hovering,Rn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(si(this.points).forEach((n,i)=>{t.push([i+1,Yt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(dt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Fe();this.points.forEach((n,i)=>{let o=oi(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(si(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(dt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=oi(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function oi(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function si(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let X;const Ge=new Array(32).fill(void 0);Ge.push(void 0,null,!0,!1);function J(r){return Ge[r]}let jt=Ge.length;function La(r){r<36||(Ge[r]=jt,jt=r)}function tr(r){const e=J(r);return La(r),e}const Ji=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Ji.decode();let ln=new Uint8Array;function Ut(){return ln.byteLength===0&&(ln=new Uint8Array(X.memory.buffer)),ln}function mt(r,e){return Ji.decode(Ut().subarray(r,r+e))}function be(r){jt===Ge.length&&Ge.push(Ge.length+1);const e=jt;return jt=Ge[e],Ge[e]=r,e}function Bn(r){return r==null}let an=new Float64Array;function Oa(){return an.byteLength===0&&(an=new Float64Array(X.memory.buffer)),an}let un=new Int32Array;function ye(){return un.byteLength===0&&(un=new Int32Array(X.memory.buffer)),un}let Ye=0;const fn=new TextEncoder("utf-8"),Ca=typeof fn.encodeInto=="function"?function(r,e){return fn.encodeInto(r,e)}:function(r,e){const t=fn.encode(r);return e.set(t),{read:r.length,written:t.length}};function en(r,e,t){if(t===void 0){const a=fn.encode(r),l=e(a.length);return Ut().subarray(l,l+a.length).set(a),Ye=a.length,l}let n=r.length,i=e(n);const o=Ut();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=Ut().subarray(i+s,i+n),l=Ca(r,a);s+=l.written}return Ye=s,i}function nr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=nr(r[0]));for(let s=1;s<i;s++)o+=", "+nr(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ra(r,e){const t=e(r.length*1);return Ut().set(r,t/1),Ye=r.length,t}function Dn(r,e){try{return r.apply(this,e)}catch(t){X.__wbindgen_exn_store(be(t))}}class wn{static __wrap(e){const t=Object.create(wn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();X.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=X.__wbindgen_add_to_stack_pointer(-16),s=Ra(e,X.__wbindgen_malloc),a=Ye;X.jsroutesnapper_new(o,s,a);var t=ye()[o/4+0],n=ye()[o/4+1],i=ye()[o/4+2];if(i)throw tr(n);return wn.__wrap(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){X.jsroutesnapper_setConfig(this.ptr,be(e))}toFinalFeature(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];let i;return e!==0&&(i=mt(e,t).slice(),X.__wbindgen_free(e,t*1)),i}finally{X.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_renderGeojson(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];return mt(e,t)}finally{X.__wbindgen_add_to_stack_pointer(16),X.__wbindgen_free(e,t)}}setSnapMode(e){X.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return X.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){X.jsroutesnapper_onClick(this.ptr)}onDragStart(){return X.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return X.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){X.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_editExisting(i,this.ptr,be(e));var t=ye()[i/4+0],n=ye()[i/4+1];if(n)throw tr(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}}async function Aa(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ta(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){tr(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(mt(e,t));return be(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=mt(e,t);return be(n)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;Oa()[e/8+1]=Bn(i)?0:i,ye()[e/4+0]=!Bn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=Bn(i)?0:en(i,X.__wbindgen_malloc,X.__wbindgen_realloc),s=Ye;ye()[e/4+1]=s,ye()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(J(t)),i=en(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=Ye;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return be(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=J(e)[J(t)];return be(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(J(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(J(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(J(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(J(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(J(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=J(e)[t>>>0];return be(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=J(e).next;return be(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Dn(function(e){const t=J(e).next();return be(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return J(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=J(e).value;return be(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return be(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Dn(function(e,t){const n=Reflect.get(J(e),J(t));return be(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Dn(function(e,t){const n=J(e).call(J(t));return be(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=J(e).buffer;return be(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(J(e));return be(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return be(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=en(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=Ye;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(mt(e,t))}finally{X.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=nr(J(t)),i=en(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=Ye;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(mt(e,t))},r.wbg.__wbindgen_memory=function(){const e=X.memory;return be(e)},r}function xa(r,e){return X=r.exports,Yi.__wbindgen_wasm_module=e,an=new Float64Array,un=new Int32Array,ln=new Uint8Array,X}async function Yi(r){typeof r>"u"&&(r="/atip/190-add-link-to-dynamically-generated-roadmap-in-milestones/assets/route_snapper_bg.wasm");const e=Ta();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Aa(await r,e);return xa(t,n)}const At="route-snapper",li=10,Pa=30;class Fa{constructor(e,t){ie(this,"map");ie(this,"inner");ie(this,"active");ie(this,"eventListenersSuccessRoute");ie(this,"eventListenersSuccessArea");ie(this,"eventListenersFailure");ie(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new wn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Ze(e,At,Fe()),ve(e,{id:"route-points",source:At,filter:Ln,...Lt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",li/2,li])}),ve(e,{id:"route-lines",source:At,filter:On,...kt("black",2.5)}),ve(e,{id:"route-polygons",source:At,filter:Cn,...Mn("black",.5)}),this.events=new fr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Pa,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(At).setData(JSON.parse(this.inner.renderGeojson()))}}function Ia(r){let e,t,n,i,o,s,a,l;return{c(){e=E("button"),t=E("img"),i=A(),o=W(r[2]),pn(t.src,n=r[3])||C(t,"src",n),C(t,"alt",r[2]),C(t,"class","svelte-1vvpkg9"),C(e,"type","button"),e.disabled=s=r[0]==r[1],C(e,"class","svelte-1vvpkg9")},m(u,c){k(u,e,c),w(e,t),w(e,i),w(e,o),a||(l=q(e,"click",r[5]),a=!0)},p(u,[c]){c&8&&!pn(t.src,n=u[3])&&C(t,"src",n),c&4&&C(t,"alt",u[2]),c&4&&Ce(o,u[2]),c&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:G,o:G,d(u){u&&S(e),a=!1,l()}}}function Na(r,e,t){let{mode:n}=e,{thisMode:i}=e,{label:o}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(i);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,i=u.thisMode),"label"in u&&t(2,o=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,i,o,s,a,l]}class tt extends V{constructor(e){super(),K(this,e,Na,Ia,Y,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function ai(r){let e;function t(o,s){return o[1]?Da:Ba}let n=t(r),i=n(r);return{c(){i.c(),e=_e()},m(o,s){i.m(o,s),k(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&S(e)}}}function Ba(r){let e;return{c(){e=E("p"),e.textContent="Click an object to fill out its attributes"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function Da(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another object"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function ja(r){let e,t=r[0]==_t&&ai(r);return{c(){t&&t.c(),e=_e()},m(n,i){t&&t.m(n,i),k(n,e,i)},p(n,[i]){n[0]==_t?t?t.p(n,i):(t=ai(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&S(e)}}}const _t="edit-attribute";function Xi(){}function Ua(r,e,t){let n,i,o,s;ne(r,Ae,f=>t(5,n=f)),ne(r,te,f=>t(6,i=f)),ne(r,Ht,f=>t(7,o=f)),ne(r,Ee,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){Ee.set(null)}n.on("mousemove",c),n.on("mouseout",d),n.on("click",p),rt(()=>{n.off("mousemove",c),n.off("mouseout",d),n.off("click",p)});function c(f){var h;if(a==_t){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Be.set(((h=g[0])==null?void 0:h.id)||null)}}function d(){a==_t&&Be.set(null)}function p(f){if(a==_t){let h=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});h.length>0?Ee.set(h[0].id):Ee.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let h=i.features.find(g=>g.id==f);h.geometry.type=="Point"?n.flyTo({center:h.geometry.coordinates,duration:500}):n.fitBounds(or(h),{padding:200,duration:500}),l(_t)}}},[a,s,l,Xi,u,n,i,o]}class qa extends V{constructor(e){super(),K(this,e,Ua,ja,Y,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Xi}get stop(){return this.$$.ctx[4]}}function Ga(r){let e,t;return{c:G,m(n,i){e||(t=q(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function Ha(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class Tn extends V{constructor(e){super(),K(this,e,Ha,Ga,Y,{tool:1})}}function za(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function Ja(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function Ya(r){let e,t,n,i,o,s,a,l,u,c;function d(h,g){return h[1]?Ja:za}let p=d(r),f=p(r);return a=new Tn({props:{tool:r[0]}}),{c(){e=E("ul"),f.c(),t=A(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=A(),o=E("button"),o.textContent="Cancel",s=A(),N(a.$$.fragment),C(o,"type","button")},m(h,g){k(h,e,g),f.m(e,null),w(e,t),w(e,n),k(h,i,g),k(h,o,g),k(h,s,g),B(a,h,g),l=!0,u||(c=q(o,"click",r[2]),u=!0)},p(h,[g]){p!==(p=d(h))&&(f.d(1),f=p(h),f&&(f.c(),f.m(e,t)));const _={};g&1&&(_.tool=h[0]),a.$set(_)},i(h){l||($(a.$$.fragment,h),l=!0)},o(h){O(a.$$.fragment,h),l=!1},d(h){h&&S(e),f.d(),h&&S(i),h&&S(o),h&&S(s),D(a,h),u=!1,c()}}}function Xa(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Wi extends V{constructor(e){super(),K(this,e,Xa,Ya,Y,{pointTool:0,editingExisting:1})}}function Wa(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},p:G,d(t){t&&S(e)}}}function Va(r){let e,t,n,i,o,s,a,l,u,c,d;return e=new An({props:{label:"Help",$$slots:{default:[Wa]},$$scope:{ctx:r}}}),l=new Tn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=A(),n=E("div"),i=E("button"),i.textContent="Finish",o=A(),s=E("button"),s.textContent="Cancel",a=A(),N(l.$$.fragment),C(i,"type","button"),C(s,"type","button"),se(n,"display","flex"),se(n,"justify-content","space-between")},m(p,f){B(e,p,f),k(p,t,f),k(p,n,f),w(n,i),w(n,o),w(n,s),k(p,a,f),B(l,p,f),u=!0,c||(d=[q(i,"click",r[1]),q(s,"click",r[2])],c=!0)},p(p,[f]){const h={};f&8&&(h.$$scope={dirty:f,ctx:p}),e.$set(h);const g={};f&1&&(g.tool=p[0]),l.$set(g)},i(p){u||($(e.$$.fragment,p),$(l.$$.fragment,p),u=!0)},o(p){O(e.$$.fragment,p),O(l.$$.fragment,p),u=!1},d(p){D(e,p),p&&S(t),p&&S(n),p&&S(a),D(l,p),c=!1,Re(d)}}}function Ka(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Vi extends V{constructor(e){super(),K(this,e,Ka,Va,Y,{polygonTool:0})}}function Za(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},p:G,d(t){t&&S(e)}}}function Qa(r){let e,t,n,i,o,s,a,l,u,c,d;return e=new An({props:{label:"Help",$$slots:{default:[Za]},$$scope:{ctx:r}}}),l=new Tn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=A(),n=E("div"),i=E("button"),i.textContent="Finish",o=A(),s=E("button"),s.textContent="Cancel",a=A(),N(l.$$.fragment),C(i,"type","button"),C(s,"type","button"),se(n,"display","flex"),se(n,"justify-content","space-between")},m(p,f){B(e,p,f),k(p,t,f),k(p,n,f),w(n,i),w(n,o),w(n,s),k(p,a,f),B(l,p,f),u=!0,c||(d=[q(i,"click",r[1]),q(s,"click",r[2])],c=!0)},p(p,[f]){const h={};f&8&&(h.$$scope={dirty:f,ctx:p}),e.$set(h);const g={};f&1&&(g.tool=p[0]),l.$set(g)},i(p){u||($(e.$$.fragment,p),$(l.$$.fragment,p),u=!0)},o(p){O(e.$$.fragment,p),O(l.$$.fragment,p),u=!1},d(p){D(e,p),p&&S(t),p&&S(n),p&&S(a),D(l,p),c=!1,Re(d)}}}function eu(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Ki extends V{constructor(e){super(),K(this,e,eu,Qa,Y,{routeTool:0})}}function tu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},p:G,d(t){t&&S(e)}}}function nu(r){let e,t,n,i,o,s,a,l,u,c,d,p,f,h,g;return e=new An({props:{label:"Help",$$slots:{default:[tu]},$$scope:{ctx:r}}}),p=new Tn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=A(),n=E("label"),i=E("input"),o=W(`
  Avoid doubling back`),s=A(),a=E("div"),l=E("button"),l.textContent="Finish",u=A(),c=E("button"),c.textContent="Cancel",d=A(),N(p.$$.fragment),C(i,"type","checkbox"),C(l,"type","button"),C(c,"type","button"),se(a,"display","flex"),se(a,"justify-content","space-between")},m(_,y){B(e,_,y),k(_,t,y),k(_,n,y),w(n,i),i.checked=r[1],w(n,o),k(_,s,y),k(_,a,y),w(a,l),w(a,u),w(a,c),k(_,d,y),B(p,_,y),f=!0,h||(g=[q(i,"change",r[2]),q(l,"click",r[3]),q(c,"click",r[4])],h=!0)},p(_,[y]){const m={};y&32&&(m.$$scope={dirty:y,ctx:_}),e.$set(m),y&2&&(i.checked=_[1]);const b={};y&1&&(b.tool=_[0]),p.$set(b)},i(_){f||($(e.$$.fragment,_),$(p.$$.fragment,_),f=!0)},o(_){O(e.$$.fragment,_),O(p.$$.fragment,_),f=!1},d(_){D(e,_),_&&S(t),_&&S(n),_&&S(s),_&&S(a),_&&S(d),D(p,_),h=!1,Re(g)}}}function ru(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class Zi extends V{constructor(e){super(),K(this,e,ru,nu,Y,{routeTool:0})}}function ui(r){let e,t,n,i;const o=[au,lu,su,ou,iu],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=_e()},m(l,u){s[e].m(l,u),k(l,n,u),i=!0},p(l,u){let c=e;e=a(l),e===c?s[e].p(l,u):(ae(),O(s[c],1,1,()=>{s[c]=null}),ue(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){i||($(t),i=!0)},o(l){O(t),i=!1},d(l){s[e].d(l),l&&S(n)}}}function iu(r){let e;return{c(){e=E("p"),e.textContent="Click an object to edit its geometry"},m(t,n){k(t,e,n)},p:G,i:G,o:G,d(t){t&&S(e)}}}function ou(r){let e,t;return e=new Zi({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function su(r){let e,t;return e=new Ki({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function lu(r){let e,t;return e=new Vi({props:{polygonTool:r[2]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function au(r){let e,t;return e=new Wi({props:{pointTool:r[1],editingExisting:!0}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function uu(r){let e,t,n=r[0]==Ue&&ui(r);return{c(){n&&n.c(),e=_e()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==Ue?n?(n.p(i,o),o&1&&$(n,1)):(n=ui(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ae(),O(n,1,1,()=>{n=null}),ue())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const Ue="edit-geometry";function Qi(){}function fu(r,e,t){let n;ne(r,Ae,g=>t(8,n=g));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function c(){l&&(o.stop(),s.stop(),a.stop(),te.update(g=>{let _=g.features.find(y=>y.id==l);return delete _.properties.hide_while_editing,g})),l=null,t(4,u=null),Be.set(null)}n.on("mousemove",d),n.on("mouseout",p),n.on("click",f),rt(()=>{n.off("mousemove",d),n.off("mouseout",p),n.off("click",f)}),a.addEventListenerSuccessRoute(g=>{i==Ue&&(te.update(_=>{let y=_.features.find(m=>m.id==l);return y.properties.length_meters=g.properties.length_meters,y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,_}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{i==Ue&&(te.update(_=>{let y=_.features.find(m=>m.id==l);return y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,_}),l=null,t(4,u=null))});for(let g of[o,s])g.addEventListenerSuccess(_=>{i==Ue&&(te.update(y=>{let m=y.features.find(b=>b.id==l);return m.geometry=_.geometry,delete m.properties.hide_while_editing,y}),l=null,t(4,u=null))});for(let g of[o,s,a])g.addEventListenerFailure(()=>{i==Ue&&(te.update(_=>{let y=_.features.find(m=>m.id==l);return delete y.properties.hide_while_editing,_}),l=null,t(4,u=null))});function d(g){var _;if(i==Ue&&l==null){let y=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Be.set(((_=y[0])==null?void 0:_.id)||null)}}function p(){i==Ue&&l==null&&Be.set(null)}function f(g){if(i==Ue&&l==null){let _=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&h(_[0].id)}}function h(g){Be.set(null);let _=null;te.update(m=>(_=m.features.find(b=>b.id==g),_.properties.hide_while_editing=!0,m));let y=_;l=g,y.geometry.type=="LineString"?(a.editExistingRoute(y),t(4,u="route")):y.geometry.type=="Polygon"?y.properties.waypoints?(a.editExistingArea(y),t(4,u="snap-polygon")):(s.editExisting(y),t(4,u="free-polygon")):y.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"pointTool"in g&&t(1,o=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[i,o,s,a,u,Qi,c]}class cu extends V{constructor(e){super(),K(this,e,fu,uu,Y,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Qi}get stop(){return this.$$.ctx[6]}}async function pu(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:c}=await n.read();if(u)break;s.push(c),o+=c.length;const d=100*o/i;e.style=`background: linear-gradient(to right, red ${d}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function du(r){let e,t;return e=new Zi({props:{routeTool:r[0]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function hu(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){k(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&S(e),r[7](null)}}}function mu(r){let e,t,n,i;const o=[hu,du],s=[];function a(l,u){return l[0]?l[1]==rr?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=_e()},m(l,u){~e&&s[e].m(l,u),k(l,n,u),i=!0},p(l,[u]){let c=e;e=a(l),e===c?~e&&s[e].p(l,u):(t&&(ae(),O(s[c],1,1,()=>{s[c]=null}),ue()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||($(t),i=!0)},o(l){O(t),i=!1},d(l){~e&&s[e].d(l),l&&S(n)}}}const rr="route";function _u(r,e,t){let n;ne(r,Ae,p=>t(8,n=p));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function c(){l==null||l.stop()}Xt(async()=>{await Yi(),console.log(`Grabbing ${s}`);try{const p=await pu(s,a);t(0,l=new Fa(n,p))}catch(p){console.log(`Route tool broke: ${p}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==rr&&o("edit-attribute")}),l.addEventListenerSuccessRoute(p=>{i==rr&&(te.update(f=>(p.id=Wt(f),p.properties.intervention_type="route",f.features.push(p),f)),o("edit-attribute"),Ee.set(p.id))})});function d(p){oe[p?"unshift":"push"](()=>{a=p,t(2,a)})}return r.$$set=p=>{"mode"in p&&t(1,i=p.mode),"changeMode"in p&&t(3,o=p.changeMode),"url"in p&&t(4,s=p.url),"routeTool"in p&&t(0,l=p.routeTool)},[l,i,a,o,s,u,c,d]}class gu extends V{constructor(e){super(),K(this,e,_u,mu,Y,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function fi(r){let e,t;return e=new Wi({props:{pointTool:r[1],editingExisting:!1}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function bu(r){let e,t,n=r[0]==kn&&fi(r);return{c(){n&&n.c(),e=_e()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==kn?n?(n.p(i,o),o&1&&$(n,1)):(n=fi(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ae(),O(n,1,1,()=>{n=null}),ue())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const kn="point";function yu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==kn&&(te.update(u=>(l.id=Wt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),Ee.set(l.id))}),o.addEventListenerFailure(()=>{n==kn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class vu extends V{constructor(e){super(),K(this,e,yu,bu,Y,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ci(r){let e,t;return e=new Vi({props:{polygonTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function wu(r){let e,t,n=r[0]==Sn&&ci(r);return{c(){n&&n.c(),e=_e()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==Sn?n?(n.p(i,o),o&1&&$(n,1)):(n=ci(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ae(),O(n,1,1,()=>{n=null}),ue())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const Sn="free-polygon";function ku(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Sn&&(te.update(u=>(l.id=Wt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Ee.set(l.id))}),o.addEventListenerFailure(()=>{n==Sn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Su extends V{constructor(e){super(),K(this,e,ku,wu,Y,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function pi(r){let e,t;return e=new Ki({props:{routeTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Eu(r){let e,t,n=r[0]==En&&pi(r);return{c(){n&&n.c(),e=_e()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==En?n?(n.p(i,o),o&1&&$(n,1)):(n=pi(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ae(),O(n,1,1,()=>{n=null}),ue())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const En="snap-polygon";function Mu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==En&&(te.update(u=>(l.id=Wt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Ee.set(l.id))}),o.addEventListenerFailure(()=>{n==En&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class $u extends V{constructor(e){super(),K(this,e,Mu,Eu,Y,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Lu(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=ze(r.slice(0,2),[n,t]),s=ze(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Ou(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return yo(r,function(s){Cu(s,o,n)}),r}function Cu(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Ru(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Zn(r),n=Zn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Ou(e,{precision:7});switch(n){case"Point":return ir(r,i);case"MultiPoint":return di(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return di(r,zi(r,i))}}function di(r,e){var t=[],n=$t();return sr(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=ir(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=Lu(vo(a)))}),n.load(Xe(t));else{var o=n.search(i);if(o.features.length){var s=eo(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),hn(ir(s,i),function(a){t.push(a),n.insert(a)})}}}),Xe(t)}function ir(r,e){var t=[],n=De(r)[0],i=De(r)[r.geometry.coordinates.length-1];if(jn(n,We(e))||jn(i,We(e)))return Xe([r]);var o=$t(),s=Qn(r);o.load(s);var a=o.search(e);if(!a.features.length)return Xe([r]);var l=eo(e,a),u=[n],c=wo(s,function(d,p,f){var h=De(p)[1],g=We(e);return f===l.id?(d.push(g),t.push(Et(d)),jn(g,h)?[g]:[g,h]):(d.push(h),d)},u);return c.length>1&&t.push(Et(c)),Xe(t)}function eo(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return hn(e,function(i){var o=Yt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function jn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Au(r,e,t){var n=De(t);if(Zn(t)!=="LineString")throw new Error("line must be a LineString");var i=Yt(t,r),o=Yt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),Et(a,t.properties)}function hi(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> on a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function Tu(r){let e,t,n,i=r[0]==qt&&hi();return{c(){i&&i.c(),e=_e()},m(o,s){i&&i.m(o,s),k(o,e,s),t||(n=q(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==qt?i||(i=hi(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:G,o:G,d(o){i&&i.d(o),o&&S(e),t=!1,n()}}}const qt="split-route",xu=10,Pu=30;let Un="split-route";function to(){}function mi(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Fu(r,e,t){let n,i;ne(r,te,g=>t(8,n=g)),ne(r,Ae,g=>t(6,i=g));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",c),i.on("click",d),rt(()=>{i.off("mousemove",c),i.off("click",d)}),Ze(i,Un,Fe()),ve(i,{id:"draw-split-route",source:Un,...Lt("black",xu,["case",["==",["get","snapped"],!0],1,.5])});function c(g){if(o!=qt)return;t(5,l=mi(g.lngLat.toArray(),!1)),u=null;const _=[g.point.x-Pu,g.point.y],y=i.unproject(g.point).distanceTo(i.unproject(_))/1e3;let m=[];for(let[b,v]of n.features.entries())if(v.geometry.type=="LineString"){let M=Yt(v.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=y&&m.push([b,M.geometry.coordinates,M.properties.dist])}m.sort((b,v)=>b[2]-v[2]),m.length>0&&(t(5,l=mi(m[0][1],!0)),u=m[0][0])}function d(){if(o==qt)if(u==null)s("edit-attribute");else{let g=Ru(n.features[u],l);if(g.features.length==2){let _=g.features[0],y=g.features[1];te.update(m=>(_.id=m.features[u].id,y.id=Wt(m),_.properties=JSON.parse(JSON.stringify(m.features[u].properties)),y.properties=JSON.parse(JSON.stringify(_.properties)),p(m.features[u],_,y,l),m.features.splice(u,1,_,y),m))}a()}}function p(g,_,y,m){_.properties.length_meters=sn(_,{units:"kilometers"})*1e3,y.properties.length_meters=sn(y,{units:"kilometers"})*1e3,_.properties.waypoints=[],y.properties.waypoints=[];let b=f(g,m),v=!0,M=0;for(let L of g.properties.waypoints){let P=f(g,wt([L.lon,L.lat]));if(v)if(P<b)_.properties.waypoints.push(L);else{let x=L.snapped&&g.properties.waypoints[M-1].snapped;_.properties.waypoints.push({lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1],snapped:x}),v=!1,y.properties.waypoints.push({lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1],snapped:x}),y.properties.waypoints.push(L)}else y.properties.waypoints.push(L);M++}}function f(g,_){let y=g.geometry.coordinates[0],m=Au(y,_,g);return sn(m,{units:"kilometers"})*1e3}function h(g){o==qt&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=Fe();l&&g.features.push(l),i.getSource(Un).setData(g)}},[o,h,s,to,a,l,i]}class Iu extends V{constructor(e){super(),K(this,e,Fu,Tu,Y,{mode:0,changeMode:2,start:3,stop:4})}get start(){return to}get stop(){return this.$$.ctx[4]}}const Nu="/atip/190-add-link-to-dynamically-generated-roadmap-in-milestones/assets/edit_attributes-29b396e1.svg",Bu="/atip/190-add-link-to-dynamically-generated-roadmap-in-milestones/assets/edit_geometry-02dad294.svg",Du="/atip/190-add-link-to-dynamically-generated-roadmap-in-milestones/assets/point-276f4055.svg",ju="/atip/190-add-link-to-dynamically-generated-roadmap-in-milestones/assets/polygon_snapped-18efbbea.svg",Uu="/atip/190-add-link-to-dynamically-generated-roadmap-in-milestones/assets/polygon_freehand-cf965967.svg",qu="/atip/190-add-link-to-dynamically-generated-roadmap-in-milestones/assets/route-d3c0ebad.svg",Gu="/atip/190-add-link-to-dynamically-generated-roadmap-in-milestones/assets/split_route-9e0ea2da.svg";function _i(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new cu({props:n}),r[15](e),{c(){N(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){O(e.$$.fragment,i),t=!1},d(i){r[15](null),D(e,i)}}}function gi(r){let e,t;return e=new tt({props:{mode:r[3],thisMode:"point",label:"New point",icon:Du,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function bi(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new $u({props:n}),r[18](e),{c(){N(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){O(e.$$.fragment,i),t=!1},d(i){r[18](null),D(e,i)}}}function yi(r){let e,t;return e=new tt({props:{mode:r[3],thisMode:"route",label:"New route",icon:qu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function vi(r){let e,t;return e=new tt({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:Gu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Hu(r){let e,t,n,i,o,s,a,l,u,c,d,p,f,h,g,_,y,m,b,v,M,L,P,x,I,T,U,Z,F,H,pe,we;n=new tt({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:Nu,changeMode:r[13]}});let ke={mode:r[3],changeMode:r[13]};o=new qa({props:ke}),r[14](o),l=new tt({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:Bu,changeMode:r[13]}});let re=r[2]&&_i(r),fe=r[1]!="planning"&&gi(r),je={mode:r[3],changeMode:r[13],pointTool:r[11]};f=new vu({props:je}),r[16](f),_=new tt({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:Uu,changeMode:r[13]}});let Se={mode:r[3],changeMode:r[13],polygonTool:r[12]};m=new Su({props:Se}),r[17](m),M=new tt({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:ju,changeMode:r[13]}});let Q=r[2]&&bi(r),le=r[1]!="planning"&&yi(r);function st(R){r[20](R)}let lt={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(lt.routeTool=r[2]),T=new gu({props:lt}),r[19](T),oe.push(()=>Me(T,"routeTool",st,r[2]));let he=r[1]!="planning"&&vi(r),ge={mode:r[3],changeMode:r[13]};return pe=new Iu({props:ge}),r[21](pe),{c(){e=E("div"),t=E("div"),N(n.$$.fragment),i=A(),N(o.$$.fragment),s=A(),a=E("div"),N(l.$$.fragment),u=A(),re&&re.c(),c=A(),d=E("div"),fe&&fe.c(),p=A(),N(f.$$.fragment),h=A(),g=E("div"),N(_.$$.fragment),y=A(),N(m.$$.fragment),b=A(),v=E("div"),N(M.$$.fragment),L=A(),Q&&Q.c(),P=A(),x=E("div"),le&&le.c(),I=A(),N(T.$$.fragment),Z=A(),F=E("div"),he&&he.c(),H=A(),N(pe.$$.fragment),C(e,"class","toolbox svelte-4s4d3o")},m(R,j){k(R,e,j),w(e,t),B(n,t,null),w(t,i),B(o,t,null),w(e,s),w(e,a),B(l,a,null),w(a,u),re&&re.m(a,null),w(e,c),w(e,d),fe&&fe.m(d,null),w(d,p),B(f,d,null),w(e,h),w(e,g),B(_,g,null),w(g,y),B(m,g,null),w(e,b),w(e,v),B(M,v,null),w(v,L),Q&&Q.m(v,null),w(e,P),w(e,x),le&&le.m(x,null),w(x,I),B(T,x,null),w(e,Z),w(e,F),he&&he.m(F,null),w(F,H),B(pe,F,null),we=!0},p(R,[j]){const cr={};j&8&&(cr.mode=R[3]),n.$set(cr);const pr={};j&8&&(pr.mode=R[3]),o.$set(pr);const dr={};j&8&&(dr.mode=R[3]),l.$set(dr),R[2]?re?(re.p(R,j),j&4&&$(re,1)):(re=_i(R),re.c(),$(re,1),re.m(a,null)):re&&(ae(),O(re,1,1,()=>{re=null}),ue()),R[1]!="planning"?fe?(fe.p(R,j),j&2&&$(fe,1)):(fe=gi(R),fe.c(),$(fe,1),fe.m(d,p)):fe&&(ae(),O(fe,1,1,()=>{fe=null}),ue());const hr={};j&8&&(hr.mode=R[3]),f.$set(hr);const mr={};j&8&&(mr.mode=R[3]),_.$set(mr);const _r={};j&8&&(_r.mode=R[3]),m.$set(_r);const gr={};j&8&&(gr.mode=R[3]),M.$set(gr),R[2]?Q?(Q.p(R,j),j&4&&$(Q,1)):(Q=bi(R),Q.c(),$(Q,1),Q.m(v,null)):Q&&(ae(),O(Q,1,1,()=>{Q=null}),ue()),R[1]!="planning"?le?(le.p(R,j),j&2&&$(le,1)):(le=yi(R),le.c(),$(le,1),le.m(x,I)):le&&(ae(),O(le,1,1,()=>{le=null}),ue());const Kt={};j&8&&(Kt.mode=R[3]),j&1&&(Kt.url=R[0]),!U&&j&4&&(U=!0,Kt.routeTool=R[2],$e(()=>U=!1)),T.$set(Kt),R[1]!="planning"?he?(he.p(R,j),j&2&&$(he,1)):(he=vi(R),he.c(),$(he,1),he.m(F,H)):he&&(ae(),O(he,1,1,()=>{he=null}),ue());const br={};j&8&&(br.mode=R[3]),pe.$set(br)},i(R){we||($(n.$$.fragment,R),$(o.$$.fragment,R),$(l.$$.fragment,R),$(re),$(fe),$(f.$$.fragment,R),$(_.$$.fragment,R),$(m.$$.fragment,R),$(M.$$.fragment,R),$(Q),$(le),$(T.$$.fragment,R),$(he),$(pe.$$.fragment,R),we=!0)},o(R){O(n.$$.fragment,R),O(o.$$.fragment,R),O(l.$$.fragment,R),O(re),O(fe),O(f.$$.fragment,R),O(_.$$.fragment,R),O(m.$$.fragment,R),O(M.$$.fragment,R),O(Q),O(le),O(T.$$.fragment,R),O(he),O(pe.$$.fragment,R),we=!1},d(R){R&&S(e),D(n),r[14](null),D(o),D(l),re&&re.d(),fe&&fe.d(),r[16](null),D(f),D(_),r[17](null),D(m),D(M),Q&&Q.d(),le&&le.d(),r[19](null),D(T),he&&he.d(),r[21](null),D(pe)}}}function zu(r,e,t){let n;ne(r,Ae,T=>t(22,n=T));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new ha(n),l=new $a(n),u="edit-attribute",c,d,p,f,h,g,_;function y(T){let U={"edit-attribute":c,"edit-geometry":d,route:p,point:f,"free-polygon":h,"snap-polygon":g,"split-route":_};if(u==T){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),U[u].stop(),t(3,u=T),console.log(`Starting new mode ${u}`),U[u].start()}rt(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function m(T){oe[T?"unshift":"push"](()=>{c=T,t(4,c)})}function b(T){oe[T?"unshift":"push"](()=>{d=T,t(5,d)})}function v(T){oe[T?"unshift":"push"](()=>{f=T,t(7,f)})}function M(T){oe[T?"unshift":"push"](()=>{h=T,t(8,h)})}function L(T){oe[T?"unshift":"push"](()=>{g=T,t(9,g)})}function P(T){oe[T?"unshift":"push"](()=>{p=T,t(6,p)})}function x(T){s=T,t(2,s)}function I(T){oe[T?"unshift":"push"](()=>{_=T,t(10,_)})}return r.$$set=T=>{"routeSnapperUrl"in T&&t(0,i=T.routeSnapperUrl),"schema"in T&&t(1,o=T.schema)},[i,o,s,u,c,d,p,f,h,g,_,a,l,y,m,b,v,M,L,P,x,I]}class Ju extends V{constructor(e){super(),K(this,e,zu,Hu,Y,{routeSnapperUrl:0,schema:1})}}function Yu(r){let e,t,n,i,o,s,a,l,u,c,d,p,f,h,g,_,y,m,b;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",i=A(),o=E("button"),o.textContent="About",s=A(),a=E("button"),a.textContent="Instructions",l=A(),u=E("br"),c=A(),d=E("label"),p=W(`ATIP schema:
      `),f=E("select"),h=E("option"),h.textContent="v1",g=E("option"),g.textContent="v2",_=E("option"),_.textContent="Housing developments",y=E("option"),y.textContent="Critical issues",C(n,"type","button"),C(o,"type","button"),C(a,"type","button"),h.__value="v1",h.value=h.__value,g.__value="v2",g.value=g.__value,_.__value="planning",_.value=_.__value,y.__value="criticals",y.value=y.__value,r[2]===void 0&&it(()=>r[11].call(f)),C(e,"slot","nav")},m(v,M){k(v,e,M),w(e,t),w(t,n),w(t,i),w(t,o),w(t,s),w(t,a),w(e,l),w(e,u),w(e,c),w(e,d),w(d,p),w(d,f),w(f,h),w(f,g),w(f,_),w(f,y),Ve(f,r[2]),m||(b=[q(n,"click",r[10]),q(o,"click",r[7]),q(a,"click",r[8]),q(f,"change",r[11]),q(f,"change",r[9])],m=!0)},p(v,M){M&4&&Ve(f,v[2])},d(v){v&&S(e),m=!1,Re(b)}}}function Xu(r){let e,t,n,i,o,s,a,l,u,c,d,p,f,h,g,_;return o=new Zl({props:{boundaryGeojson:r[4]}}),a=new Xl({props:{authorityName:r[5],schema:r[2]}}),d=new jl({props:{schema:r[2]}}),g=new Gl({}),{c(){e=E("div"),t=E("h1"),n=W(r[5]),i=A(),N(o.$$.fragment),s=A(),N(a.$$.fragment),l=A(),u=E("br"),c=A(),N(d.$$.fragment),p=A(),f=E("hr"),h=A(),N(g.$$.fragment),C(e,"slot","sidebar")},m(y,m){k(y,e,m),w(e,t),w(t,n),w(t,i),B(o,t,null),w(e,s),B(a,e,null),w(e,l),w(e,u),w(e,c),B(d,e,null),w(e,p),w(e,f),w(e,h),B(g,e,null),_=!0},p(y,m){const b={};m&16&&(b.boundaryGeojson=y[4]),o.$set(b);const v={};m&4&&(v.schema=y[2]),a.$set(v);const M={};m&4&&(M.schema=y[2]),d.$set(M)},i(y){_||($(o.$$.fragment,y),$(a.$$.fragment,y),$(d.$$.fragment,y),$(g.$$.fragment,y),_=!0)},o(y){O(o.$$.fragment,y),O(a.$$.fragment,y),O(d.$$.fragment,y),O(g.$$.fragment,y),_=!1},d(y){y&&S(e),D(o),D(a),D(d),D(g)}}}function Wu(r){let e,t,n,i,o,s,a,l,u,c,d,p;return e=new As({props:{boundaryGeojson:r[4]}}),n=new ca({props:{schema:r[2]}}),o=new da({}),a=new Ju({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new ta({props:{style:r[6]}}),d=new ua({props:{schema:r[2]}}),{c(){N(e.$$.fragment),t=A(),N(n.$$.fragment),i=A(),N(o.$$.fragment),s=A(),N(a.$$.fragment),l=A(),N(u.$$.fragment),c=A(),N(d.$$.fragment)},m(f,h){B(e,f,h),k(f,t,h),B(n,f,h),k(f,i,h),B(o,f,h),k(f,s,h),B(a,f,h),k(f,l,h),B(u,f,h),k(f,c,h),B(d,f,h),p=!0},p(f,h){const g={};h&16&&(g.boundaryGeojson=f[4]),e.$set(g);const _={};h&4&&(_.schema=f[2]),n.$set(_);const y={};h&8&&(y.routeSnapperUrl=f[3]),h&4&&(y.schema=f[2]),a.$set(y);const m={};h&4&&(m.schema=f[2]),d.$set(m)},i(f){p||($(e.$$.fragment,f),$(n.$$.fragment,f),$(o.$$.fragment,f),$(a.$$.fragment,f),$(u.$$.fragment,f),$(d.$$.fragment,f),p=!0)},o(f){O(e.$$.fragment,f),O(n.$$.fragment,f),O(o.$$.fragment,f),O(a.$$.fragment,f),O(u.$$.fragment,f),O(d.$$.fragment,f),p=!1},d(f){D(e,f),f&&S(t),D(n,f),f&&S(i),D(o,f),f&&S(s),D(a,f),f&&S(l),D(u,f),f&&S(c),D(d,f)}}}function Vu(r){let e,t,n;return t=new Zo({props:{style:r[6],$$slots:{default:[Wu]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),C(e,"slot","main")},m(i,o){k(i,e,o),B(t,e,null),n=!0},p(i,o){const s={};o&524316&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){O(t.$$.fragment,i),n=!1},d(i){i&&S(e),D(t)}}}function Ku(r){let e,t,n,i,o,s,a,l;e=new is({props:{$$slots:{main:[Vu],sidebar:[Xu],nav:[Yu]},$$scope:{ctx:r}}});function u(f){r[12](f)}let c={};r[0]!==void 0&&(c.open=r[0]),n=new ko({props:c}),oe.push(()=>Me(n,"open",u,r[0]));function d(f){r[13](f)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new Wo({props:p}),oe.push(()=>Me(s,"open",d,r[1])),{c(){N(e.$$.fragment),t=A(),N(n.$$.fragment),o=A(),N(s.$$.fragment)},m(f,h){B(e,f,h),k(f,t,h),B(n,f,h),k(f,o,h),B(s,f,h),l=!0},p(f,[h]){const g={};h&524316&&(g.$$scope={dirty:h,ctx:f}),e.$set(g);const _={};!i&&h&1&&(i=!0,_.open=f[0],$e(()=>i=!1)),n.$set(_);const y={};!a&&h&2&&(a=!0,y.open=f[1],$e(()=>a=!1)),s.$set(y)},i(f){l||($(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!0)},o(f){O(e.$$.fragment,f),O(n.$$.fragment,f),O(s.$$.fragment,f),l=!1},d(f){D(e,f),f&&S(t),D(n,f),f&&S(o),D(s,f)}}}function Zu(r,e,t){let n;ne(r,mn,L=>t(15,n=L));let i=!1,o=!1,s=window.location.hostname.includes("atip.uk");const a=new URLSearchParams(window.location.search);let l=a.get("authority"),u=a.get("style")||"streets",c=a.get("schema")||"v1";var d=`https://atip.uk/route-snappers/${l}.bin`,p=`https://atip.uk/route-info/${l}.bin`;s||(d=`https://atip.uk/route-snappers-dev/${l}.bin`,p=`https://atip.uk/route-info-dev/${l}.bin`);function f(){t(0,i=!i),t(1,o=!1)}function h(){t(1,o=!o),t(0,i=!1)}let g;Xt(async()=>{t(4,g=await _());const L=$i(new Io);mn.set(await new L),await n.loadFile(p)});async function _(){const P=await(await fetch(So)).text(),x=JSON.parse(P);return x.features=x.features.filter(I=>{var T;return((T=I.properties)==null?void 0:T.name)==l}),x}function y(){let L=new URLSearchParams(window.location.search);L.set("schema",c);let P=`${window.location.pathname}?${L.toString()}${window.location.hash}`;window.location.href=P}const m=()=>window.open("index.html");function b(){c=$n(this),t(2,c)}function v(L){i=L,t(0,i)}function M(L){o=L,t(1,o)}return[i,o,c,d,g,l,u,f,h,y,m,b,v,M]}class Qu extends V{constructor(e){super(),K(this,e,Zu,Ku,Y,{})}}new Qu({target:document.getElementById("app")});
