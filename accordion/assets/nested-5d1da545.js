var Wi=Object.defineProperty;var ji=(n,e,t)=>e in n?Wi(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ee=(n,e,t)=>(ji(n,typeof e!="symbol"?e+"":e,t),t),Vi=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var ct=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)};var de=(n,e,t)=>(Vi(n,e,"access private method"),t);import{S as oe,i as le,s as se,x as ce,y as Le,f as A,z as kt,g as M,h as S,B as ut,C as re,p as P,D as ye,E as Je,t as W,F as pe,e as T,c as z,G as L,H as Ze,l as X,n as I,I as Me,o as D,J as Pe,r as Ue,K as an,L as Yn,M as ht,N as he,O as Ae,P as Oe,Q as Ne,R as Fe,T as ne,b as fe,U as bi,V as _i,W as un,X as lr,Y as Hi,j as St,d as V,m as H,q as Z,Z as Zi,a as Ye,k as Xe,_ as Xt,$ as Qi,a0 as gn,a1 as Xn,a2 as sr,w as Jn,a3 as Ct,a4 as ft,a5 as yi,a6 as ar,a7 as Ki,a8 as $i,a9 as eo,aa as ur,ab as to,ac as no,ad as Un,A as ro,u as io}from"./authorities-15dda61b.js";function fr(n){let e,t;return{c(){e=Le("title"),t=W(n[1])},m(r,i){M(r,e,i),S(e,t)},p(r,i){i&2&&pe(t,r[1])},d(r){r&&P(e)}}}function oo(n){let e,t,r,i=n[1]&&fr(n),o=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],l={};for(let s=0;s<o.length;s+=1)l=ce(l,o[s]);return{c(){e=Le("svg"),i&&i.c(),t=Le("path"),r=Le("path"),A(t,"d","M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14C30,8.3,23.7,2,16,2z M14.9,8h2.2v11h-2.2V8z M16,25	c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22c0.8,0,1.5,0.7,1.5,1.5S16.8,25,16,25z"),A(r,"fill","none"),A(r,"d","M17.5,23.5c0,0.8-0.7,1.5-1.5,1.5c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22	C16.8,22,17.5,22.7,17.5,23.5z M17.1,8h-2.2v11h2.2V8z"),A(r,"data-icon-path","inner-path"),A(r,"opacity","0"),kt(e,l)},m(s,u){M(s,e,u),i&&i.m(e,null),S(e,t),S(e,r)},p(s,[u]){s[1]?i?i.p(s,u):(i=fr(s),i.c(),i.m(e,t)):i&&(i.d(1),i=null),kt(e,l=ut(o,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},u&1&&{width:s[0]},u&1&&{height:s[0]},u&4&&s[2],u&8&&s[3]]))},i:re,o:re,d(s){s&&P(e),i&&i.d()}}}function lo(n,e,t){let r,i;const o=["size","title"];let l=ye(e,o),{size:s=16}=e,{title:u=void 0}=e;return n.$$set=a=>{t(5,e=ce(ce({},e),Je(a))),t(3,l=ye(e,o)),"size"in a&&t(0,s=a.size),"title"in a&&t(1,u=a.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||u),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=Je(e),[s,u,i,l,r]}class so extends oe{constructor(e){super(),le(this,e,lo,oo,se,{size:0,title:1})}}const wi=so;function cr(n){let e,t;return{c(){e=Le("title"),t=W(n[1])},m(r,i){M(r,e,i),S(e,t)},p(r,i){i&2&&pe(t,r[1])},d(r){r&&P(e)}}}function ao(n){let e,t,r,i,o=n[1]&&cr(n),l=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],s={};for(let u=0;u<l.length;u+=1)s=ce(s,l[u]);return{c(){e=Le("svg"),o&&o.c(),t=Le("path"),r=Le("path"),i=Le("path"),A(t,"fill","none"),A(t,"d","M16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Zm-1.125-5h2.25V12h-2.25Z"),A(t,"data-icon-path","inner-path"),A(r,"d","M16.002,6.1714h-.004L4.6487,27.9966,4.6506,28H27.3494l.0019-.0034ZM14.875,12h2.25v9h-2.25ZM16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Z"),A(i,"d","M29,30H3a1,1,0,0,1-.8872-1.4614l13-25a1,1,0,0,1,1.7744,0l13,25A1,1,0,0,1,29,30ZM4.6507,28H27.3493l.002-.0033L16.002,6.1714h-.004L4.6487,27.9967Z"),kt(e,s)},m(u,a){M(u,e,a),o&&o.m(e,null),S(e,t),S(e,r),S(e,i)},p(u,[a]){u[1]?o?o.p(u,a):(o=cr(u),o.c(),o.m(e,t)):o&&(o.d(1),o=null),kt(e,s=ut(l,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:u[0]},a&1&&{height:u[0]},a&4&&u[2],a&8&&u[3]]))},i:re,o:re,d(u){u&&P(e),o&&o.d()}}}function uo(n,e,t){let r,i;const o=["size","title"];let l=ye(e,o),{size:s=16}=e,{title:u=void 0}=e;return n.$$set=a=>{t(5,e=ce(ce({},e),Je(a))),t(3,l=ye(e,o)),"size"in a&&t(0,s=a.size),"title"in a&&t(1,u=a.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||u),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=Je(e),[s,u,i,l,r]}class fo extends oe{constructor(e){super(),le(this,e,uo,ao,se,{size:0,title:1})}}const co=fo,ho=n=>({}),dr=n=>({});function hr(n){let e,t;const r=n[16].labelText,i=Ae(r,n,n[15],dr),o=i||po(n);return{c(){e=T("span"),o&&o.c(),L(e,"bx--visually-hidden",n[7])},m(l,s){M(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s&32768)&&Oe(i,r,l,l[15],t?Fe(r,l[15],s,ho):Ne(l[15]),dr):o&&o.p&&(!t||s&64)&&o.p(l,t?s:-1),(!t||s&128)&&L(e,"bx--visually-hidden",l[7])},i(l){t||(I(o,l),t=!0)},o(l){D(o,l),t=!1},d(l){l&&P(e),o&&o.d(l)}}}function po(n){let e;return{c(){e=W(n[6])},m(t,r){M(t,e,r)},p(t,r){r&64&&pe(e,t[6])},d(t){t&&P(e)}}}function mo(n){let e,t,r,i,o,l,s,u,a,c=(n[6]||n[13].labelText)&&hr(n),g=[n[12]],d={};for(let f=0;f<g.length;f+=1)d=ce(d,g[f]);return{c(){e=T("div"),t=T("input"),r=z(),i=T("label"),o=T("span"),l=z(),c&&c.c(),A(t,"type","radio"),A(t,"id",n[8]),A(t,"name",n[9]),t.checked=n[0],t.disabled=n[3],t.required=n[4],t.value=n[2],L(t,"bx--radio-button",!0),L(o,"bx--radio-button__appearance",!0),A(i,"for",n[8]),L(i,"bx--radio-button__label",!0),Ze(e,d),L(e,"bx--radio-button-wrapper",!0),L(e,"bx--radio-button-wrapper--label-left",n[5]==="left")},m(f,h){M(f,e,h),S(e,t),n[18](t),S(e,r),S(e,i),S(i,o),S(i,l),c&&c.m(i,null),s=!0,u||(a=[X(t,"change",n[17]),X(t,"change",n[19])],u=!0)},p(f,[h]){(!s||h&256)&&A(t,"id",f[8]),(!s||h&512)&&A(t,"name",f[9]),(!s||h&1)&&(t.checked=f[0]),(!s||h&8)&&(t.disabled=f[3]),(!s||h&16)&&(t.required=f[4]),(!s||h&4)&&(t.value=f[2]),f[6]||f[13].labelText?c?(c.p(f,h),h&8256&&I(c,1)):(c=hr(f),c.c(),I(c,1),c.m(i,null)):c&&(Me(),D(c,1,1,()=>{c=null}),Pe()),(!s||h&256)&&A(i,"for",f[8]),Ze(e,d=ut(g,[h&4096&&f[12]])),L(e,"bx--radio-button-wrapper",!0),L(e,"bx--radio-button-wrapper--label-left",f[5]==="left")},i(f){s||(I(c),s=!0)},o(f){D(c),s=!1},d(f){f&&P(e),n[18](null),c&&c.d(),u=!1,Ue(a)}}}function go(n,e,t){const r=["value","checked","disabled","required","labelPosition","labelText","hideLabel","id","name","ref"];let i=ye(e,r),o,{$$slots:l={},$$scope:s}=e;const u=an(l);let{value:a=""}=e,{checked:c=!1}=e,{disabled:g=!1}=e,{required:d=!1}=e,{labelPosition:f="right"}=e,{labelText:h=""}=e,{hideLabel:v=!1}=e,{id:k="ccs-"+Math.random().toString(36)}=e,{name:C=""}=e,{ref:m=null}=e;const p=Yn("RadioButtonGroup"),b=p?p.selectedValue:ht(c?a:void 0);he(n,b,x=>t(14,o=x)),p&&p.add({id:k,checked:c,disabled:g,value:a});function w(x){ne.call(this,n,x)}function _(x){fe[x?"unshift":"push"](()=>{m=x,t(1,m)})}const O=()=>{p&&p.update(a)};return n.$$set=x=>{e=ce(ce({},e),Je(x)),t(12,i=ye(e,r)),"value"in x&&t(2,a=x.value),"checked"in x&&t(0,c=x.checked),"disabled"in x&&t(3,g=x.disabled),"required"in x&&t(4,d=x.required),"labelPosition"in x&&t(5,f=x.labelPosition),"labelText"in x&&t(6,h=x.labelText),"hideLabel"in x&&t(7,v=x.hideLabel),"id"in x&&t(8,k=x.id),"name"in x&&t(9,C=x.name),"ref"in x&&t(1,m=x.ref),"$$scope"in x&&t(15,s=x.$$scope)},n.$$.update=()=>{n.$$.dirty&16388&&t(0,c=o===a)},[c,m,a,g,d,f,h,v,k,C,p,b,i,u,o,s,l,w,_,O]}class vo extends oe{constructor(e){super(),le(this,e,go,mo,se,{value:2,checked:0,disabled:3,required:4,labelPosition:5,labelText:6,hideLabel:7,id:8,name:9,ref:1})}}const Jt=vo;function bo(n){const e=n-1;return e*e*e+1}function pr(n,{delay:e=0,duration:t=400,easing:r=bo}={}){const i=getComputedStyle(n),o=+i.opacity,l=parseFloat(i.height),s=parseFloat(i.paddingTop),u=parseFloat(i.paddingBottom),a=parseFloat(i.marginTop),c=parseFloat(i.marginBottom),g=parseFloat(i.borderTopWidth),d=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:r,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*l}px;padding-top: ${f*s}px;padding-bottom: ${f*u}px;margin-top: ${f*a}px;margin-bottom: ${f*c}px;border-top-width: ${f*g}px;border-bottom-width: ${f*d}px;`}}function mr(n){let e,t;return{c(){e=Le("title"),t=W(n[1])},m(r,i){M(r,e,i),S(e,t)},p(r,i){i&2&&pe(t,r[1])},d(r){r&&P(e)}}}function _o(n){let e,t,r=n[1]&&mr(n),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],o={};for(let l=0;l<i.length;l+=1)o=ce(o,i[l]);return{c(){e=Le("svg"),r&&r.c(),t=Le("path"),A(t,"d","M30 28.6L3.4 2 2 3.4l10.1 10.1L4 21.6V28h6.4l8.1-8.1L28.6 30 30 28.6zM9.6 26H6v-3.6l7.5-7.5 3.6 3.6L9.6 26zM29.4 6.2L29.4 6.2l-3.6-3.6c-.8-.8-2-.8-2.8 0l0 0 0 0-8 8 1.4 1.4L20 8.4l3.6 3.6L20 15.6l1.4 1.4 8-8C30.2 8.2 30.2 7 29.4 6.2L29.4 6.2zM25 10.6L21.4 7l3-3L28 7.6 25 10.6z"),kt(e,o)},m(l,s){M(l,e,s),r&&r.m(e,null),S(e,t)},p(l,[s]){l[1]?r?r.p(l,s):(r=mr(l),r.c(),r.m(e,t)):r&&(r.d(1),r=null),kt(e,o=ut(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},s&1&&{width:l[0]},s&1&&{height:l[0]},s&4&&l[2],s&8&&l[3]]))},i:re,o:re,d(l){l&&P(e),r&&r.d()}}}function yo(n,e,t){let r,i;const o=["size","title"];let l=ye(e,o),{size:s=16}=e,{title:u=void 0}=e;return n.$$set=a=>{t(5,e=ce(ce({},e),Je(a))),t(3,l=ye(e,o)),"size"in a&&t(0,s=a.size),"title"in a&&t(1,u=a.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||u),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=Je(e),[s,u,i,l,r]}class wo extends oe{constructor(e){super(),le(this,e,yo,_o,se,{size:0,title:1})}}const ko=wo;function So(n){let e,t,r,i;const o=n[5].default,l=Ae(o,n,n[4],null);let s=[n[3]],u={};for(let a=0;a<s.length;a+=1)u=ce(u,s[a]);return{c(){e=T("ol"),l&&l.c(),Ze(e,u),L(e,"bx--list--ordered",!n[1]),L(e,"bx--list--ordered--native",n[1]),L(e,"bx--list--nested",n[0]),L(e,"bx--list--expressive",n[2])},m(a,c){M(a,e,c),l&&l.m(e,null),t=!0,r||(i=[X(e,"click",n[6]),X(e,"mouseover",n[7]),X(e,"mouseenter",n[8]),X(e,"mouseleave",n[9])],r=!0)},p(a,[c]){l&&l.p&&(!t||c&16)&&Oe(l,o,a,a[4],t?Fe(o,a[4],c,null):Ne(a[4]),null),Ze(e,u=ut(s,[c&8&&a[3]])),L(e,"bx--list--ordered",!a[1]),L(e,"bx--list--ordered--native",a[1]),L(e,"bx--list--nested",a[0]),L(e,"bx--list--expressive",a[2])},i(a){t||(I(l,a),t=!0)},o(a){D(l,a),t=!1},d(a){a&&P(e),l&&l.d(a),r=!1,Ue(i)}}}function Eo(n,e,t){const r=["nested","native","expressive"];let i=ye(e,r),{$$slots:o={},$$scope:l}=e,{nested:s=!1}=e,{native:u=!1}=e,{expressive:a=!1}=e;function c(h){ne.call(this,n,h)}function g(h){ne.call(this,n,h)}function d(h){ne.call(this,n,h)}function f(h){ne.call(this,n,h)}return n.$$set=h=>{e=ce(ce({},e),Je(h)),t(3,i=ye(e,r)),"nested"in h&&t(0,s=h.nested),"native"in h&&t(1,u=h.native),"expressive"in h&&t(2,a=h.expressive),"$$scope"in h&&t(4,l=h.$$scope)},[s,u,a,i,l,o,c,g,d,f]}class Mo extends oe{constructor(e){super(),le(this,e,Eo,So,se,{nested:0,native:1,expressive:2})}}const Po=Mo,xo=n=>({}),gr=n=>({});function vr(n){let e,t;const r=n[11].legendText,i=Ae(r,n,n[10],gr),o=i||Lo(n);return{c(){e=T("legend"),o&&o.c(),L(e,"bx--label",!0),L(e,"bx--visually-hidden",n[2])},m(l,s){M(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s&1024)&&Oe(i,r,l,l[10],t?Fe(r,l[10],s,xo):Ne(l[10]),gr):o&&o.p&&(!t||s&2)&&o.p(l,t?s:-1),(!t||s&4)&&L(e,"bx--visually-hidden",l[2])},i(l){t||(I(o,l),t=!0)},o(l){D(o,l),t=!1},d(l){l&&P(e),o&&o.d(l)}}}function Lo(n){let e;return{c(){e=W(n[1])},m(t,r){M(t,e,r)},p(t,r){r&2&&pe(e,t[1])},d(t){t&&P(e)}}}function To(n){let e,t,r,i,o,l,s=(n[1]||n[8].legendText)&&vr(n);const u=n[11].default,a=Ae(u,n,n[10],null);let c=[{id:n[5]},n[7]],g={};for(let d=0;d<c.length;d+=1)g=ce(g,c[d]);return{c(){e=T("div"),t=T("fieldset"),s&&s.c(),r=z(),a&&a.c(),t.disabled=n[0],L(t,"bx--radio-button-group",!0),L(t,"bx--radio-button-group--vertical",n[4]==="vertical"),L(t,"bx--radio-button-group--label-left",n[3]==="left"),L(t,"bx--radio-button-group--label-right",n[3]==="right"),Ze(e,g),L(e,"bx--form-item",!0)},m(d,f){M(d,e,f),S(e,t),s&&s.m(t,null),S(t,r),a&&a.m(t,null),i=!0,o||(l=[X(e,"click",n[12]),X(e,"mouseover",n[13]),X(e,"mouseenter",n[14]),X(e,"mouseleave",n[15])],o=!0)},p(d,[f]){d[1]||d[8].legendText?s?(s.p(d,f),f&258&&I(s,1)):(s=vr(d),s.c(),I(s,1),s.m(t,r)):s&&(Me(),D(s,1,1,()=>{s=null}),Pe()),a&&a.p&&(!i||f&1024)&&Oe(a,u,d,d[10],i?Fe(u,d[10],f,null):Ne(d[10]),null),(!i||f&1)&&(t.disabled=d[0]),(!i||f&16)&&L(t,"bx--radio-button-group--vertical",d[4]==="vertical"),(!i||f&8)&&L(t,"bx--radio-button-group--label-left",d[3]==="left"),(!i||f&8)&&L(t,"bx--radio-button-group--label-right",d[3]==="right"),Ze(e,g=ut(c,[(!i||f&32)&&{id:d[5]},f&128&&d[7]])),L(e,"bx--form-item",!0)},i(d){i||(I(s),I(a,d),i=!0)},o(d){D(s),D(a,d),i=!1},d(d){d&&P(e),s&&s.d(),a&&a.d(d),o=!1,Ue(l)}}}function Co(n,e,t){const r=["selected","disabled","legendText","hideLegend","labelPosition","orientation","id"];let i=ye(e,r),o,{$$slots:l={},$$scope:s}=e;const u=an(l);let{selected:a=void 0}=e,{disabled:c=!1}=e,{legendText:g=""}=e,{hideLegend:d=!1}=e,{labelPosition:f="right"}=e,{orientation:h="horizontal"}=e,{id:v=void 0}=e;const k=bi(),C=ht(a);he(n,C,_=>t(16,o=_)),_i("RadioButtonGroup",{selectedValue:C,add:({checked:_,value:O})=>{_&&C.set(O)},update:_=>{t(9,a=_)}}),un(()=>{lr(C,o=a,o)}),Hi(()=>{lr(C,o=a,o)}),C.subscribe(_=>{t(9,a=_),k("change",_)});function m(_){ne.call(this,n,_)}function p(_){ne.call(this,n,_)}function b(_){ne.call(this,n,_)}function w(_){ne.call(this,n,_)}return n.$$set=_=>{e=ce(ce({},e),Je(_)),t(7,i=ye(e,r)),"selected"in _&&t(9,a=_.selected),"disabled"in _&&t(0,c=_.disabled),"legendText"in _&&t(1,g=_.legendText),"hideLegend"in _&&t(2,d=_.hideLegend),"labelPosition"in _&&t(3,f=_.labelPosition),"orientation"in _&&t(4,h=_.orientation),"id"in _&&t(5,v=_.id),"$$scope"in _&&t(10,s=_.$$scope)},[c,g,d,f,h,v,C,i,u,a,s,l,m,p,b,w]}class Ro extends oe{constructor(e){super(),le(this,e,Co,To,se,{selected:9,disabled:0,legendText:1,hideLegend:2,labelPosition:3,orientation:4,id:5})}}const Ao=Ro,Oo=n=>({}),br=n=>({});function _r(n){let e,t,r,i;const o=n[20].labelText,l=Ae(o,n,n[19],br),s=l||No(n);let u=n[5]&&yr(n);return{c(){e=T("div"),t=T("label"),s&&s.c(),r=z(),u&&u.c(),A(t,"for",n[14]),L(t,"bx--label",!0),L(t,"bx--visually-hidden",n[11]),L(t,"bx--label--disabled",n[7]),L(e,"bx--text-area__label-wrapper",!0)},m(a,c){M(a,e,c),S(e,t),s&&s.m(t,null),S(e,r),u&&u.m(e,null),i=!0},p(a,c){l?l.p&&(!i||c[0]&524288)&&Oe(l,o,a,a[19],i?Fe(o,a[19],c,Oo):Ne(a[19]),br):s&&s.p&&(!i||c[0]&1024)&&s.p(a,i?c:[-1,-1]),(!i||c[0]&16384)&&A(t,"for",a[14]),(!i||c[0]&2048)&&L(t,"bx--visually-hidden",a[11]),(!i||c[0]&128)&&L(t,"bx--label--disabled",a[7]),a[5]?u?u.p(a,c):(u=yr(a),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},i(a){i||(I(s,a),i=!0)},o(a){D(s,a),i=!1},d(a){a&&P(e),s&&s.d(a),u&&u.d()}}}function No(n){let e;return{c(){e=W(n[10])},m(t,r){M(t,e,r)},p(t,r){r[0]&1024&&pe(e,t[10])},d(t){t&&P(e)}}}function yr(n){let e,t=n[0].length+"",r,i,o;return{c(){e=T("div"),r=W(t),i=W("/"),o=W(n[5]),L(e,"bx--label",!0),L(e,"bx--label--disabled",n[7])},m(l,s){M(l,e,s),S(e,r),S(e,i),S(e,o)},p(l,s){s[0]&1&&t!==(t=l[0].length+"")&&pe(r,t),s[0]&32&&pe(o,l[5]),s[0]&128&&L(e,"bx--label--disabled",l[7])},d(l){l&&P(e)}}}function wr(n){let e,t;return e=new wi({props:{class:"bx--text-area__invalid-icon"}}),{c(){V(e.$$.fragment)},m(r,i){H(e,r,i),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){Z(e,r)}}}function kr(n){let e,t;return{c(){e=T("div"),t=W(n[9]),L(e,"bx--form__helper-text",!0),L(e,"bx--form__helper-text--disabled",n[7])},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&512&&pe(t,r[9]),i[0]&128&&L(e,"bx--form__helper-text--disabled",r[7])},d(r){r&&P(e)}}}function Sr(n){let e,t;return{c(){e=T("div"),t=W(n[13]),A(e,"id",n[16]),L(e,"bx--form-requirement",!0)},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&8192&&pe(t,r[13]),i[0]&65536&&A(e,"id",r[16])},d(r){r&&P(e)}}}function Fo(n){let e,t,r,i,o,l,s,u,a,c,g,d,f,h,v=(n[10]||n[17].labelText)&&!n[11]&&_r(n),k=n[12]&&wr(),C=[{"aria-invalid":l=n[12]||void 0},{"aria-describedby":s=n[12]?n[16]:void 0},{disabled:n[7]},{id:n[14]},{name:n[15]},{cols:n[3]},{rows:n[4]},{placeholder:n[2]},{readOnly:n[8]},{maxlength:u=n[5]??void 0},n[18]],m={};for(let w=0;w<C.length;w+=1)m=ce(m,C[w]);let p=!n[12]&&n[9]&&kr(n),b=n[12]&&Sr(n);return{c(){e=T("div"),v&&v.c(),t=z(),r=T("div"),k&&k.c(),i=z(),o=T("textarea"),c=z(),p&&p.c(),g=z(),b&&b.c(),Ze(o,m),L(o,"bx--text-area",!0),L(o,"bx--text-area--light",n[6]),L(o,"bx--text-area--invalid",n[12]),A(r,"data-invalid",a=n[12]||void 0),L(r,"bx--text-area__wrapper",!0),L(e,"bx--form-item",!0)},m(w,_){M(w,e,_),v&&v.m(e,null),S(e,t),S(e,r),k&&k.m(r,null),S(r,i),S(r,o),o.autofocus&&o.focus(),n[32](o),St(o,n[0]),S(e,c),p&&p.m(e,null),S(e,g),b&&b.m(e,null),d=!0,f||(h=[X(o,"input",n[33]),X(o,"change",n[25]),X(o,"input",n[26]),X(o,"keydown",n[27]),X(o,"keyup",n[28]),X(o,"focus",n[29]),X(o,"blur",n[30]),X(o,"paste",n[31]),X(e,"click",n[21]),X(e,"mouseover",n[22]),X(e,"mouseenter",n[23]),X(e,"mouseleave",n[24])],f=!0)},p(w,_){(w[10]||w[17].labelText)&&!w[11]?v?(v.p(w,_),_[0]&134144&&I(v,1)):(v=_r(w),v.c(),I(v,1),v.m(e,t)):v&&(Me(),D(v,1,1,()=>{v=null}),Pe()),w[12]?k?_[0]&4096&&I(k,1):(k=wr(),k.c(),I(k,1),k.m(r,i)):k&&(Me(),D(k,1,1,()=>{k=null}),Pe()),Ze(o,m=ut(C,[(!d||_[0]&4096&&l!==(l=w[12]||void 0))&&{"aria-invalid":l},(!d||_[0]&69632&&s!==(s=w[12]?w[16]:void 0))&&{"aria-describedby":s},(!d||_[0]&128)&&{disabled:w[7]},(!d||_[0]&16384)&&{id:w[14]},(!d||_[0]&32768)&&{name:w[15]},(!d||_[0]&8)&&{cols:w[3]},(!d||_[0]&16)&&{rows:w[4]},(!d||_[0]&4)&&{placeholder:w[2]},(!d||_[0]&256)&&{readOnly:w[8]},(!d||_[0]&32&&u!==(u=w[5]??void 0))&&{maxlength:u},_[0]&262144&&w[18]])),_[0]&1&&St(o,w[0]),L(o,"bx--text-area",!0),L(o,"bx--text-area--light",w[6]),L(o,"bx--text-area--invalid",w[12]),(!d||_[0]&4096&&a!==(a=w[12]||void 0))&&A(r,"data-invalid",a),!w[12]&&w[9]?p?p.p(w,_):(p=kr(w),p.c(),p.m(e,g)):p&&(p.d(1),p=null),w[12]?b?b.p(w,_):(b=Sr(w),b.c(),b.m(e,null)):b&&(b.d(1),b=null)},i(w){d||(I(v),I(k),d=!0)},o(w){D(v),D(k),d=!1},d(w){w&&P(e),v&&v.d(),k&&k.d(),n[32](null),p&&p.d(),b&&b.d(),f=!1,Ue(h)}}}function Io(n,e,t){let r;const i=["value","placeholder","cols","rows","maxCount","light","disabled","readonly","helperText","labelText","hideLabel","invalid","invalidText","id","name","ref"];let o=ye(e,i),{$$slots:l={},$$scope:s}=e;const u=an(l);let{value:a=""}=e,{placeholder:c=""}=e,{cols:g=50}=e,{rows:d=4}=e,{maxCount:f=void 0}=e,{light:h=!1}=e,{disabled:v=!1}=e,{readonly:k=!1}=e,{helperText:C=""}=e,{labelText:m=""}=e,{hideLabel:p=!1}=e,{invalid:b=!1}=e,{invalidText:w=""}=e,{id:_="ccs-"+Math.random().toString(36)}=e,{name:O=void 0}=e,{ref:x=null}=e;function F(y){ne.call(this,n,y)}function q(y){ne.call(this,n,y)}function E(y){ne.call(this,n,y)}function B(y){ne.call(this,n,y)}function N(y){ne.call(this,n,y)}function R(y){ne.call(this,n,y)}function G(y){ne.call(this,n,y)}function J(y){ne.call(this,n,y)}function te(y){ne.call(this,n,y)}function $(y){ne.call(this,n,y)}function ee(y){ne.call(this,n,y)}function ae(y){fe[y?"unshift":"push"](()=>{x=y,t(1,x)})}function ie(){a=this.value,t(0,a)}return n.$$set=y=>{e=ce(ce({},e),Je(y)),t(18,o=ye(e,i)),"value"in y&&t(0,a=y.value),"placeholder"in y&&t(2,c=y.placeholder),"cols"in y&&t(3,g=y.cols),"rows"in y&&t(4,d=y.rows),"maxCount"in y&&t(5,f=y.maxCount),"light"in y&&t(6,h=y.light),"disabled"in y&&t(7,v=y.disabled),"readonly"in y&&t(8,k=y.readonly),"helperText"in y&&t(9,C=y.helperText),"labelText"in y&&t(10,m=y.labelText),"hideLabel"in y&&t(11,p=y.hideLabel),"invalid"in y&&t(12,b=y.invalid),"invalidText"in y&&t(13,w=y.invalidText),"id"in y&&t(14,_=y.id),"name"in y&&t(15,O=y.name),"ref"in y&&t(1,x=y.ref),"$$scope"in y&&t(19,s=y.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&16384&&t(16,r=`error-${_}`)},[a,x,c,g,d,f,h,v,k,C,m,p,b,w,_,O,r,u,o,s,l,F,q,E,B,N,R,G,J,te,$,ee,ae,ie]}class Bo extends oe{constructor(e){super(),le(this,e,Io,Fo,se,{value:0,placeholder:2,cols:3,rows:4,maxCount:5,light:6,disabled:7,readonly:8,helperText:9,labelText:10,hideLabel:11,invalid:12,invalidText:13,id:14,name:15,ref:1},null,[-1,-1])}}const zo=Bo,Go=n=>({}),Er=n=>({}),qo=n=>({}),Mr=n=>({});function Pr(n){let e,t,r,i=n[9]&&xr(n),o=!n[20]&&n[6]&&Lr(n);return{c(){e=T("div"),i&&i.c(),t=z(),o&&o.c(),L(e,"bx--text-input__label-helper-wrapper",!0)},m(l,s){M(l,e,s),i&&i.m(e,null),S(e,t),o&&o.m(e,null),r=!0},p(l,s){l[9]?i?(i.p(l,s),s[0]&512&&I(i,1)):(i=xr(l),i.c(),I(i,1),i.m(e,t)):i&&(Me(),D(i,1,1,()=>{i=null}),Pe()),!l[20]&&l[6]?o?o.p(l,s):(o=Lr(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(l){r||(I(i),r=!0)},o(l){D(i),r=!1},d(l){l&&P(e),i&&i.d(),o&&o.d()}}}function xr(n){let e,t;const r=n[26].labelText,i=Ae(r,n,n[25],Mr),o=i||Do(n);return{c(){e=T("label"),o&&o.c(),A(e,"for",n[7]),L(e,"bx--label",!0),L(e,"bx--visually-hidden",n[10]),L(e,"bx--label--disabled",n[5]),L(e,"bx--label--inline",n[16]),L(e,"bx--label--inline--sm",n[2]==="sm"),L(e,"bx--label--inline--xl",n[2]==="xl")},m(l,s){M(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s[0]&33554432)&&Oe(i,r,l,l[25],t?Fe(r,l[25],s,qo):Ne(l[25]),Mr):o&&o.p&&(!t||s[0]&512)&&o.p(l,t?s:[-1,-1]),(!t||s[0]&128)&&A(e,"for",l[7]),(!t||s[0]&1024)&&L(e,"bx--visually-hidden",l[10]),(!t||s[0]&32)&&L(e,"bx--label--disabled",l[5]),(!t||s[0]&65536)&&L(e,"bx--label--inline",l[16]),(!t||s[0]&4)&&L(e,"bx--label--inline--sm",l[2]==="sm"),(!t||s[0]&4)&&L(e,"bx--label--inline--xl",l[2]==="xl")},i(l){t||(I(o,l),t=!0)},o(l){D(o,l),t=!1},d(l){l&&P(e),o&&o.d(l)}}}function Do(n){let e;return{c(){e=W(n[9])},m(t,r){M(t,e,r)},p(t,r){r[0]&512&&pe(e,t[9])},d(t){t&&P(e)}}}function Lr(n){let e,t;return{c(){e=T("div"),t=W(n[6]),L(e,"bx--form__helper-text",!0),L(e,"bx--form__helper-text--disabled",n[5]),L(e,"bx--form__helper-text--inline",n[16])},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&64&&pe(t,r[6]),i[0]&32&&L(e,"bx--form__helper-text--disabled",r[5]),i[0]&65536&&L(e,"bx--form__helper-text--inline",r[16])},d(r){r&&P(e)}}}function Tr(n){let e,t;const r=n[26].labelText,i=Ae(r,n,n[25],Er),o=i||Yo(n);return{c(){e=T("label"),o&&o.c(),A(e,"for",n[7]),L(e,"bx--label",!0),L(e,"bx--visually-hidden",n[10]),L(e,"bx--label--disabled",n[5]),L(e,"bx--label--inline",n[16]),L(e,"bx--label--inline-sm",n[16]&&n[2]==="sm"),L(e,"bx--label--inline-xl",n[16]&&n[2]==="xl")},m(l,s){M(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s[0]&33554432)&&Oe(i,r,l,l[25],t?Fe(r,l[25],s,Go):Ne(l[25]),Er):o&&o.p&&(!t||s[0]&512)&&o.p(l,t?s:[-1,-1]),(!t||s[0]&128)&&A(e,"for",l[7]),(!t||s[0]&1024)&&L(e,"bx--visually-hidden",l[10]),(!t||s[0]&32)&&L(e,"bx--label--disabled",l[5]),(!t||s[0]&65536)&&L(e,"bx--label--inline",l[16]),(!t||s[0]&65540)&&L(e,"bx--label--inline-sm",l[16]&&l[2]==="sm"),(!t||s[0]&65540)&&L(e,"bx--label--inline-xl",l[16]&&l[2]==="xl")},i(l){t||(I(o,l),t=!0)},o(l){D(o,l),t=!1},d(l){l&&P(e),o&&o.d(l)}}}function Yo(n){let e;return{c(){e=W(n[9])},m(t,r){M(t,e,r)},p(t,r){r[0]&512&&pe(e,t[9])},d(t){t&&P(e)}}}function Cr(n){let e,t;return e=new wi({props:{class:"bx--text-input__invalid-icon"}}),{c(){V(e.$$.fragment)},m(r,i){H(e,r,i),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){Z(e,r)}}}function Rr(n){let e,t;return e=new co({props:{class:`bx--text-input__invalid-icon
            bx--text-input__invalid-icon--warning`}}),{c(){V(e.$$.fragment)},m(r,i){H(e,r,i),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){Z(e,r)}}}function Ar(n){let e,t;return e=new ko({props:{class:"bx--text-input__readonly-icon"}}),{c(){V(e.$$.fragment)},m(r,i){H(e,r,i),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){Z(e,r)}}}function Or(n){let e;return{c(){e=T("hr"),L(e,"bx--text-input__divider",!0)},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function Nr(n){let e,t;return{c(){e=T("div"),t=W(n[12]),A(e,"id",n[19]),L(e,"bx--form-requirement",!0)},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&4096&&pe(t,r[12]),i[0]&524288&&A(e,"id",r[19])},d(r){r&&P(e)}}}function Fr(n){let e,t;return{c(){e=T("div"),t=W(n[14]),A(e,"id",n[18]),L(e,"bx--form-requirement",!0)},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&16384&&pe(t,r[14]),i[0]&262144&&A(e,"id",r[18])},d(r){r&&P(e)}}}function Ir(n){let e,t;return{c(){e=T("div"),t=W(n[6]),L(e,"bx--form__helper-text",!0),L(e,"bx--form__helper-text--disabled",n[5]),L(e,"bx--form__helper-text--inline",n[16])},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&64&&pe(t,r[6]),i[0]&32&&L(e,"bx--form__helper-text--disabled",r[5]),i[0]&65536&&L(e,"bx--form__helper-text--inline",r[16])},d(r){r&&P(e)}}}function Br(n){let e,t;return{c(){e=T("div"),t=W(n[12]),A(e,"id",n[19]),L(e,"bx--form-requirement",!0)},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&4096&&pe(t,r[12]),i[0]&524288&&A(e,"id",r[19])},d(r){r&&P(e)}}}function zr(n){let e,t;return{c(){e=T("div"),t=W(n[14]),A(e,"id",n[18]),L(e,"bx--form-requirement",!0)},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&16384&&pe(t,r[14]),i[0]&262144&&A(e,"id",r[18])},d(r){r&&P(e)}}}function Xo(n){let e,t,r,i,o,l,s,u,a,c,g,d,f,h,v,k,C,m,p,b,w,_,O,x,F=n[16]&&Pr(n),q=!n[16]&&(n[9]||n[24].labelText)&&Tr(n),E=n[11]&&Cr(),B=!n[11]&&n[13]&&Rr(),N=n[17]&&Ar(),R=[{"data-invalid":c=n[11]||void 0},{"aria-invalid":g=n[11]||void 0},{"data-warn":d=n[13]||void 0},{"aria-describedby":f=n[11]?n[19]:n[13]?n[18]:void 0},{disabled:n[5]},{id:n[7]},{name:n[8]},{placeholder:n[3]},{required:n[15]},{readOnly:n[17]},n[23]],G={};for(let y=0;y<R.length;y+=1)G=ce(G,R[y]);let J=n[20]&&Or(),te=n[20]&&!n[16]&&n[11]&&Nr(n),$=n[20]&&!n[16]&&n[13]&&Fr(n),ee=!n[11]&&!n[13]&&!n[20]&&!n[16]&&n[6]&&Ir(n),ae=!n[20]&&n[11]&&Br(n),ie=!n[20]&&!n[11]&&n[13]&&zr(n);return{c(){e=T("div"),F&&F.c(),t=z(),q&&q.c(),r=z(),i=T("div"),o=T("div"),E&&E.c(),l=z(),B&&B.c(),s=z(),N&&N.c(),u=z(),a=T("input"),h=z(),J&&J.c(),v=z(),te&&te.c(),k=z(),$&&$.c(),p=z(),ee&&ee.c(),b=z(),ae&&ae.c(),w=z(),ie&&ie.c(),Ze(a,G),L(a,"bx--text-input",!0),L(a,"bx--text-input--light",n[4]),L(a,"bx--text-input--invalid",n[11]),L(a,"bx--text-input--warn",n[13]),L(a,"bx--text-input--sm",n[2]==="sm"),L(a,"bx--text-input--xl",n[2]==="xl"),A(o,"data-invalid",C=n[11]||void 0),A(o,"data-warn",m=n[13]||void 0),L(o,"bx--text-input__field-wrapper",!0),L(o,"bx--text-input__field-wrapper--warning",!n[11]&&n[13]),L(i,"bx--text-input__field-outer-wrapper",!0),L(i,"bx--text-input__field-outer-wrapper--inline",n[16]),L(e,"bx--form-item",!0),L(e,"bx--text-input-wrapper",!0),L(e,"bx--text-input-wrapper--inline",n[16]),L(e,"bx--text-input-wrapper--light",n[4]),L(e,"bx--text-input-wrapper--readonly",n[17])},m(y,U){M(y,e,U),F&&F.m(e,null),S(e,t),q&&q.m(e,null),S(e,r),S(e,i),S(i,o),E&&E.m(o,null),S(o,l),B&&B.m(o,null),S(o,s),N&&N.m(o,null),S(o,u),S(o,a),a.autofocus&&a.focus(),n[36](a),St(a,n[0]),S(o,h),J&&J.m(o,null),S(o,v),te&&te.m(o,null),S(o,k),$&&$.m(o,null),S(i,p),ee&&ee.m(i,null),S(i,b),ae&&ae.m(i,null),S(i,w),ie&&ie.m(i,null),_=!0,O||(x=[X(a,"input",n[37]),X(a,"change",n[22]),X(a,"input",n[21]),X(a,"keydown",n[31]),X(a,"keyup",n[32]),X(a,"focus",n[33]),X(a,"blur",n[34]),X(a,"paste",n[35]),X(e,"click",n[27]),X(e,"mouseover",n[28]),X(e,"mouseenter",n[29]),X(e,"mouseleave",n[30])],O=!0)},p(y,U){y[16]?F?(F.p(y,U),U[0]&65536&&I(F,1)):(F=Pr(y),F.c(),I(F,1),F.m(e,t)):F&&(Me(),D(F,1,1,()=>{F=null}),Pe()),!y[16]&&(y[9]||y[24].labelText)?q?(q.p(y,U),U[0]&16843264&&I(q,1)):(q=Tr(y),q.c(),I(q,1),q.m(e,r)):q&&(Me(),D(q,1,1,()=>{q=null}),Pe()),y[11]?E?U[0]&2048&&I(E,1):(E=Cr(),E.c(),I(E,1),E.m(o,l)):E&&(Me(),D(E,1,1,()=>{E=null}),Pe()),!y[11]&&y[13]?B?U[0]&10240&&I(B,1):(B=Rr(),B.c(),I(B,1),B.m(o,s)):B&&(Me(),D(B,1,1,()=>{B=null}),Pe()),y[17]?N?U[0]&131072&&I(N,1):(N=Ar(),N.c(),I(N,1),N.m(o,u)):N&&(Me(),D(N,1,1,()=>{N=null}),Pe()),Ze(a,G=ut(R,[(!_||U[0]&2048&&c!==(c=y[11]||void 0))&&{"data-invalid":c},(!_||U[0]&2048&&g!==(g=y[11]||void 0))&&{"aria-invalid":g},(!_||U[0]&8192&&d!==(d=y[13]||void 0))&&{"data-warn":d},(!_||U[0]&796672&&f!==(f=y[11]?y[19]:y[13]?y[18]:void 0))&&{"aria-describedby":f},(!_||U[0]&32)&&{disabled:y[5]},(!_||U[0]&128)&&{id:y[7]},(!_||U[0]&256)&&{name:y[8]},(!_||U[0]&8)&&{placeholder:y[3]},(!_||U[0]&32768)&&{required:y[15]},(!_||U[0]&131072)&&{readOnly:y[17]},U[0]&8388608&&y[23]])),U[0]&1&&a.value!==y[0]&&St(a,y[0]),L(a,"bx--text-input",!0),L(a,"bx--text-input--light",y[4]),L(a,"bx--text-input--invalid",y[11]),L(a,"bx--text-input--warn",y[13]),L(a,"bx--text-input--sm",y[2]==="sm"),L(a,"bx--text-input--xl",y[2]==="xl"),y[20]?J||(J=Or(),J.c(),J.m(o,v)):J&&(J.d(1),J=null),y[20]&&!y[16]&&y[11]?te?te.p(y,U):(te=Nr(y),te.c(),te.m(o,k)):te&&(te.d(1),te=null),y[20]&&!y[16]&&y[13]?$?$.p(y,U):($=Fr(y),$.c(),$.m(o,null)):$&&($.d(1),$=null),(!_||U[0]&2048&&C!==(C=y[11]||void 0))&&A(o,"data-invalid",C),(!_||U[0]&8192&&m!==(m=y[13]||void 0))&&A(o,"data-warn",m),(!_||U[0]&10240)&&L(o,"bx--text-input__field-wrapper--warning",!y[11]&&y[13]),!y[11]&&!y[13]&&!y[20]&&!y[16]&&y[6]?ee?ee.p(y,U):(ee=Ir(y),ee.c(),ee.m(i,b)):ee&&(ee.d(1),ee=null),!y[20]&&y[11]?ae?ae.p(y,U):(ae=Br(y),ae.c(),ae.m(i,w)):ae&&(ae.d(1),ae=null),!y[20]&&!y[11]&&y[13]?ie?ie.p(y,U):(ie=zr(y),ie.c(),ie.m(i,null)):ie&&(ie.d(1),ie=null),(!_||U[0]&65536)&&L(i,"bx--text-input__field-outer-wrapper--inline",y[16]),(!_||U[0]&65536)&&L(e,"bx--text-input-wrapper--inline",y[16]),(!_||U[0]&16)&&L(e,"bx--text-input-wrapper--light",y[4]),(!_||U[0]&131072)&&L(e,"bx--text-input-wrapper--readonly",y[17])},i(y){_||(I(F),I(q),I(E),I(B),I(N),_=!0)},o(y){D(F),D(q),D(E),D(B),D(N),_=!1},d(y){y&&P(e),F&&F.d(),q&&q.d(),E&&E.d(),B&&B.d(),N&&N.d(),n[36](null),J&&J.d(),te&&te.d(),$&&$.d(),ee&&ee.d(),ae&&ae.d(),ie&&ie.d(),O=!1,Ue(x)}}}function Jo(n,e,t){let r,i,o;const l=["size","value","placeholder","light","disabled","helperText","id","name","labelText","hideLabel","invalid","invalidText","warn","warnText","ref","required","inline","readonly"];let s=ye(e,l),{$$slots:u={},$$scope:a}=e;const c=an(u);let{size:g=void 0}=e,{value:d=""}=e,{placeholder:f=""}=e,{light:h=!1}=e,{disabled:v=!1}=e,{helperText:k=""}=e,{id:C="ccs-"+Math.random().toString(36)}=e,{name:m=void 0}=e,{labelText:p=""}=e,{hideLabel:b=!1}=e,{invalid:w=!1}=e,{invalidText:_=""}=e,{warn:O=!1}=e,{warnText:x=""}=e,{ref:F=null}=e,{required:q=!1}=e,{inline:E=!1}=e,{readonly:B=!1}=e;const N=Yn("Form"),R=bi();function G(Y){return s.type!=="number"?Y:Y!=""?Number(Y):null}const J=Y=>{t(0,d=G(Y.target.value)),R("input",d)},te=Y=>{R("change",G(Y.target.value))};function $(Y){ne.call(this,n,Y)}function ee(Y){ne.call(this,n,Y)}function ae(Y){ne.call(this,n,Y)}function ie(Y){ne.call(this,n,Y)}function y(Y){ne.call(this,n,Y)}function U(Y){ne.call(this,n,Y)}function Ge(Y){ne.call(this,n,Y)}function xt(Y){ne.call(this,n,Y)}function Yt(Y){ne.call(this,n,Y)}function pn(Y){fe[Y?"unshift":"push"](()=>{F=Y,t(1,F)})}function me(){d=this.value,t(0,d)}return n.$$set=Y=>{e=ce(ce({},e),Je(Y)),t(23,s=ye(e,l)),"size"in Y&&t(2,g=Y.size),"value"in Y&&t(0,d=Y.value),"placeholder"in Y&&t(3,f=Y.placeholder),"light"in Y&&t(4,h=Y.light),"disabled"in Y&&t(5,v=Y.disabled),"helperText"in Y&&t(6,k=Y.helperText),"id"in Y&&t(7,C=Y.id),"name"in Y&&t(8,m=Y.name),"labelText"in Y&&t(9,p=Y.labelText),"hideLabel"in Y&&t(10,b=Y.hideLabel),"invalid"in Y&&t(11,w=Y.invalid),"invalidText"in Y&&t(12,_=Y.invalidText),"warn"in Y&&t(13,O=Y.warn),"warnText"in Y&&t(14,x=Y.warnText),"ref"in Y&&t(1,F=Y.ref),"required"in Y&&t(15,q=Y.required),"inline"in Y&&t(16,E=Y.inline),"readonly"in Y&&t(17,B=Y.readonly),"$$scope"in Y&&t(25,a=Y.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&128&&t(19,i=`error-${C}`),n.$$.dirty[0]&128&&t(18,o=`warn-${C}`)},t(20,r=!!N&&N.isFluid),[d,F,g,f,h,v,k,C,m,p,b,w,_,O,x,q,E,B,o,i,r,J,te,s,c,a,u,$,ee,ae,ie,y,U,Ge,xt,Yt,pn,me]}class Uo extends oe{constructor(e){super(),le(this,e,Jo,Xo,se,{size:2,value:0,placeholder:3,light:4,disabled:5,helperText:6,id:7,name:8,labelText:9,hideLabel:10,invalid:11,invalidText:12,warn:13,warnText:14,ref:1,required:15,inline:16,readonly:17},null,[-1,-1])}}const Wo=Uo;function jo(n){let e;return{c(){e=W(`Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)`)},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function Vo(n){let e;return{c(){e=W(`Draw the intervention on the map, clicking the original point or 'Finish
      snapping' for the Polygon and Route tools respectively`)},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function Ho(n){let e;return{c(){e=W("Fill in the details that appear (Intervention type, name, description)")},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function Zo(n){let e;return{c(){e=W(`Click the "Save" button or "Delete" button to save or remove the
      intervention`)},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function Qo(n){let e,t,r,i,o,l,s,u;return e=new Xt({props:{$$slots:{default:[jo]},$$scope:{ctx:n}}}),r=new Xt({props:{$$slots:{default:[Vo]},$$scope:{ctx:n}}}),o=new Xt({props:{$$slots:{default:[Ho]},$$scope:{ctx:n}}}),s=new Xt({props:{$$slots:{default:[Zo]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment),t=z(),V(r.$$.fragment),i=z(),V(o.$$.fragment),l=z(),V(s.$$.fragment)},m(a,c){H(e,a,c),M(a,t,c),H(r,a,c),M(a,i,c),H(o,a,c),M(a,l,c),H(s,a,c),u=!0},p(a,c){const g={};c&4&&(g.$$scope={dirty:c,ctx:a}),e.$set(g);const d={};c&4&&(d.$$scope={dirty:c,ctx:a}),r.$set(d);const f={};c&4&&(f.$$scope={dirty:c,ctx:a}),o.$set(f);const h={};c&4&&(h.$$scope={dirty:c,ctx:a}),s.$set(h)},i(a){u||(I(e.$$.fragment,a),I(r.$$.fragment,a),I(o.$$.fragment,a),I(s.$$.fragment,a),u=!0)},o(a){D(e.$$.fragment,a),D(r.$$.fragment,a),D(o.$$.fragment,a),D(s.$$.fragment,a),u=!1},d(a){Z(e,a),a&&P(t),Z(r,a),a&&P(i),Z(o,a),a&&P(l),Z(s,a)}}}function Ko(n){let e,t,r,i,o,l,s,u,a,c,g,d,f,h,v,k,C,m,p,b,w,_,O,x,F,q;return o=new Po({props:{$$slots:{default:[Qo]},$$scope:{ctx:n}}}),{c(){e=T("p"),e.textContent="For each intervention:",t=z(),r=T("br"),i=z(),V(o.$$.fragment),l=z(),s=T("br"),u=z(),a=T("p"),a.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,c=z(),g=T("br"),d=z(),f=T("p"),f.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,h=z(),v=T("br"),k=z(),C=T("p"),C.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,m=z(),p=T("br"),b=z(),w=T("p"),w.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,_=z(),O=T("br"),x=z(),F=T("p"),F.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(E,B){M(E,e,B),M(E,t,B),M(E,r,B),M(E,i,B),H(o,E,B),M(E,l,B),M(E,s,B),M(E,u,B),M(E,a,B),M(E,c,B),M(E,g,B),M(E,d,B),M(E,f,B),M(E,h,B),M(E,v,B),M(E,k,B),M(E,C,B),M(E,m,B),M(E,p,B),M(E,b,B),M(E,w,B),M(E,_,B),M(E,O,B),M(E,x,B),M(E,F,B),q=!0},p(E,B){const N={};B&4&&(N.$$scope={dirty:B,ctx:E}),o.$set(N)},i(E){q||(I(o.$$.fragment,E),q=!0)},o(E){D(o.$$.fragment,E),q=!1},d(E){E&&P(e),E&&P(t),E&&P(r),E&&P(i),Z(o,E),E&&P(l),E&&P(s),E&&P(u),E&&P(a),E&&P(c),E&&P(g),E&&P(d),E&&P(f),E&&P(h),E&&P(v),E&&P(k),E&&P(C),E&&P(m),E&&P(p),E&&P(b),E&&P(w),E&&P(_),E&&P(O),E&&P(x),E&&P(F)}}}function $o(n){let e,t,r;function i(l){n[1](l)}let o={passiveModal:!0,modalHeading:"Instructions",$$slots:{default:[Ko]},$$scope:{ctx:n}};return n[0]!==void 0&&(o.open=n[0]),e=new Zi({props:o}),fe.push(()=>Ye(e,"open",i,n[0])),{c(){V(e.$$.fragment)},m(l,s){H(e,l,s),r=!0},p(l,[s]){const u={};s&4&&(u.$$scope={dirty:s,ctx:l}),!t&&s&1&&(t=!0,u.open=l[0],Xe(()=>t=!1)),e.$set(u)},i(l){r||(I(e.$$.fragment,l),r=!0)},o(l){D(e.$$.fragment,l),r=!1},d(l){Z(e,l)}}}function el(n,e,t){let{open:r}=e;function i(o){r=o,t(0,r)}return n.$$set=o=>{"open"in o&&t(0,r=o.open)},[r,i]}class tl extends oe{constructor(e){super(),le(this,e,el,$o,se,{open:0})}}const nl={"line-cap":"round","line-join":"round"},Wn=["==","$type","Polygon"],jn=["==","$type","LineString"],Vn=["==","$type","Point"];function $t(n,e,t=1){return{type:"line",layout:nl,paint:{"line-color":n,"line-width":e,"line-opacity":t}}}function Hn(n,e){return{type:"fill",paint:{"fill-color":n,"fill-opacity":e}}}function Dt(n,e,t=1){return{type:"circle",paint:{"circle-radius":e,"circle-color":n,"circle-opacity":t}}}function Pt(n,e,t){if(n.getSource(e)){let r=[];for(let i of n.getStyle().layers)i.source==e&&r.push(i.id);for(let i of r)n.removeLayer(i);n.removeSource(e)}n.addSource(e,t)}function Te(n,e,t=null){n.getLayer(e.id)&&n.removeLayer(e.id),t&&!n.getLayer(t)&&(t=null),n.addLayer(e,t)}function et(){return{type:"FeatureCollection",features:[]}}const Qe=ht(null),ue=ht(et()),Ce=ht(null),qe=ht(null),rl=ht(null),il=Qi(ue,n=>{let e=n.features.find(t=>t.properties.editing);return e?e.id:null});function fn(n){let e=new Set;for(let r of n.features)e.add(r.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Gr(n){let e;const t=n[4].default,r=Ae(t,n,n[3],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&8)&&Oe(r,t,i,i[3],e?Fe(t,i[3],o,null):Ne(i[3]),null)},i(i){e||(I(r,i),e=!0)},o(i){D(r,i),e=!1},d(i){r&&r.d(i)}}}function ol(n){let e,t,r=n[1]&&Gr(n);return{c(){e=T("div"),r&&r.c(),A(e,"class","map svelte-12dpf1u")},m(i,o){M(i,e,o),r&&r.m(e,null),n[5](e),t=!0},p(i,[o]){i[1]?r?(r.p(i,o),o&2&&I(r,1)):(r=Gr(i),r.c(),I(r,1),r.m(e,null)):r&&(Me(),D(r,1,1,()=>{r=null}),Pe())},i(i){t||(I(r),t=!0)},o(i){D(r),t=!1},d(i){i&&P(e),r&&r.d(),n[5](null)}}}function ll(n,e,t){let{$$slots:r={},$$scope:i}=e,{style:o}=e,l,s,u=!1;_i("setCamera",!window.location.hash),un(()=>{l=new gn.Map({container:s,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),l.addControl(new gn.ScaleControl({})),l.addControl(new gn.NavigationControl({visualizePitch:!0}),"bottom-right"),l.on("load",()=>{t(1,u=!0),Qe.set(l)}),new ResizeObserver(()=>{l.resize()}).observe(s)}),Xn(()=>{l.remove()});function a(c){fe[c?"unshift":"push"](()=>{s=c,t(0,s)})}return n.$$set=c=>{"style"in c&&t(2,o=c.style),"$$scope"in c&&t(3,i=c.$$scope)},[s,u,o,i,r,a]}class sl extends oe{constructor(e){super(),le(this,e,ll,ol,se,{style:2})}}const al=n=>({}),qr=n=>({}),ul=n=>({}),Dr=n=>({}),fl=n=>({}),Yr=n=>({});function cl(n){let e,t,r,i,o,l,s,u,a,c,g,d;const f=n[3].nav,h=Ae(f,n,n[2],Yr),v=n[3].sidebar,k=Ae(v,n,n[2],Dr),C=n[3].main,m=Ae(C,n,n[2],qr);return{c(){e=T("aside"),t=T("div"),r=T("nav"),h&&h.c(),i=z(),k&&k.c(),o=z(),l=T("button"),l.textContent="→",u=z(),a=T("main"),m&&m.c(),A(r,"class","svelte-1u7vg8a"),A(t,"class","sidebar-content content-container svelte-1u7vg8a"),A(l,"type","button"),A(l,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),A(e,"class",s=sr(n[0]?"":"collapsed")+" svelte-1u7vg8a"),A(a,"class","svelte-1u7vg8a")},m(p,b){M(p,e,b),S(e,t),S(t,r),h&&h.m(r,null),S(t,i),k&&k.m(t,null),S(e,o),S(e,l),M(p,u,b),M(p,a,b),m&&m.m(a,null),c=!0,g||(d=X(l,"click",n[1]),g=!0)},p(p,[b]){h&&h.p&&(!c||b&4)&&Oe(h,f,p,p[2],c?Fe(f,p[2],b,fl):Ne(p[2]),Yr),k&&k.p&&(!c||b&4)&&Oe(k,v,p,p[2],c?Fe(v,p[2],b,ul):Ne(p[2]),Dr),(!c||b&1&&s!==(s=sr(p[0]?"":"collapsed")+" svelte-1u7vg8a"))&&A(e,"class",s),m&&m.p&&(!c||b&4)&&Oe(m,C,p,p[2],c?Fe(C,p[2],b,al):Ne(p[2]),qr)},i(p){c||(I(h,p),I(k,p),I(m,p),c=!0)},o(p){D(h,p),D(k,p),D(m,p),c=!1},d(p){p&&P(e),h&&h.d(p),k&&k.d(p),p&&P(u),p&&P(a),m&&m.d(p),g=!1,d()}}}function dl(n,e,t){let{$$slots:r={},$$scope:i}=e,o=!0;function l(){t(0,o=!o)}return n.$$set=s=>{"$$scope"in s&&t(2,i=s.$$scope)},[o,l,i,r]}class hl extends oe{constructor(e){super(),le(this,e,dl,cl,se,{})}}var _e=63710088e-1,Zn={centimeters:_e*100,centimetres:_e*100,degrees:_e/111325,feet:_e*3.28084,inches:_e*39.37,kilometers:_e/1e3,kilometres:_e/1e3,meters:_e,metres:_e,miles:_e/1609.344,millimeters:_e*1e3,millimetres:_e*1e3,nauticalmiles:_e/1852,radians:1,yards:_e*1.0936},pl={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/_e,yards:1.0936133},Sn={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Be(n,e,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function ml(n,e,t){switch(n){case"Point":return we(e).geometry;case"LineString":return ke(e).geometry;case"Polygon":return cn(e).geometry;case"MultiPoint":return Si(e).geometry;case"MultiLineString":return ki(e).geometry;case"MultiPolygon":return Qn(e).geometry;default:throw new Error(n+" is invalid")}}function we(n,e,t){if(t===void 0&&(t={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!en(n[0])||!en(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return Be(r,e,t)}function gl(n,e,t){return t===void 0&&(t={}),Ie(n.map(function(r){return we(r,e)}),t)}function cn(n,e,t){t===void 0&&(t={});for(var r=0,i=n;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:n};return Be(s,e,t)}function vl(n,e,t){return t===void 0&&(t={}),Ie(n.map(function(r){return cn(r,e)}),t)}function ke(n,e,t){if(t===void 0&&(t={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:n};return Be(r,e,t)}function bl(n,e,t){return t===void 0&&(t={}),Ie(n.map(function(r){return ke(r,e)}),t)}function Ie(n,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function ki(n,e,t){t===void 0&&(t={});var r={type:"MultiLineString",coordinates:n};return Be(r,e,t)}function Si(n,e,t){t===void 0&&(t={});var r={type:"MultiPoint",coordinates:n};return Be(r,e,t)}function Qn(n,e,t){t===void 0&&(t={});var r={type:"MultiPolygon",coordinates:n};return Be(r,e,t)}function _l(n,e,t){t===void 0&&(t={});var r={type:"GeometryCollection",geometries:n};return Be(r,e,t)}function yl(n,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(n*t)/t}function Kn(n,e){e===void 0&&(e="kilometers");var t=Zn[e];if(!t)throw new Error(e+" units is invalid");return n*t}function dn(n,e){e===void 0&&(e="kilometers");var t=Zn[e];if(!t)throw new Error(e+" units is invalid");return n/t}function wl(n,e){return Nt(dn(n,e))}function kl(n){var e=n%360;return e<0&&(e+=360),e}function Nt(n){var e=n%(2*Math.PI);return e*180/Math.PI}function Re(n){var e=n%360;return e*Math.PI/180}function Sl(n,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(n>=0))throw new Error("length must be a positive number");return Kn(dn(n,e),t)}function El(n,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(n>=0))throw new Error("area must be a positive number");var r=Sn[e];if(!r)throw new Error("invalid original units");var i=Sn[t];if(!i)throw new Error("invalid final units");return n/r*i}function en(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function $n(n){return!!n&&n.constructor===Object}function Ml(n){if(!n)throw new Error("bbox is required");if(!Array.isArray(n))throw new Error("bbox must be an Array");if(n.length!==4&&n.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");n.forEach(function(e){if(!en(e))throw new Error("bbox must only contain numbers")})}function Pl(n){if(!n)throw new Error("id is required");if(["string","number"].indexOf(typeof n)===-1)throw new Error("id must be a number or a string")}const xl=Object.freeze(Object.defineProperty({__proto__:null,earthRadius:_e,factors:Zn,unitsFactors:pl,areaFactors:Sn,feature:Be,geometry:ml,point:we,points:gl,polygon:cn,polygons:vl,lineString:ke,lineStrings:bl,featureCollection:Ie,multiLineString:ki,multiPoint:Si,multiPolygon:Qn,geometryCollection:_l,round:yl,radiansToLength:Kn,lengthToRadians:dn,lengthToDegrees:wl,bearingToAzimuth:kl,radiansToDegrees:Nt,degreesToRadians:Re,convertLength:Sl,convertArea:El,isNumber:en,isObject:$n,validateBBox:Ml,validateId:Pl},Symbol.toStringTag,{value:"Module"}));/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Ll(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(a){return function(c){return u([a,c])}}function u(a){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(n,t)}catch(c){a=[6,c],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var at=function(){function n(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return n}();function Tl(n,e){return n>e?1:n<e?-1:0}function rt(n,e,t){for(var r=new at(null,null),i=r,o=r;;){var l=t(n,e.key);if(l<0){if(e.left===null)break;if(t(n,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}o.left=e,o=e,e=e.left}else if(l>0){if(e.right===null)break;if(t(n,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=r.right,e.right=r.left,e}function vn(n,e,t,r){var i=new at(n,e);if(t===null)return i.left=i.right=null,i;t=rt(n,t,r);var o=r(n,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Xr(n,e,t){var r=null,i=null;if(e){e=rt(n,e,t);var o=t(e.key,n);o===0?(r=e.left,i=e.right):o<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function Cl(n,e,t){return e===null?n:(n===null||(e=rt(n.key,e,t),e.left=n),e)}function En(n,e,t,r,i){if(n){r(""+e+(t?"└── ":"├── ")+i(n)+`
`);var o=e+(t?"    ":"│   ");n.left&&En(n.left,o,!1,r,i),n.right&&En(n.right,o,!0,r,i)}}var er=function(){function n(e){e===void 0&&(e=Tl),this._root=null,this._size=0,this._comparator=e}return n.prototype.insert=function(e,t){return this._size++,this._root=vn(e,t,this._root,this._comparator)},n.prototype.add=function(e,t){var r=new at(e,t);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,o=rt(e,this._root,i),l=i(e,o.key);return l===0?this._root=o:(l<0?(r.left=o.left,r.right=o,o.left=null):l>0&&(r.right=o.right,r.left=o,o.right=null),this._size++,this._root=r),this._root},n.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},n.prototype._remove=function(e,t,r){var i;if(t===null)return null;t=rt(e,t,r);var o=r(e,t.key);return o===0?(t.left===null?i=t.right:(i=rt(e,t.left,r),i.right=t.right),this._size--,i):t},n.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=rt(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},n.prototype.findStatic=function(e){for(var t=this._root,r=this._comparator;t;){var i=r(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},n.prototype.find=function(e){return this._root&&(this._root=rt(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},n.prototype.contains=function(e){for(var t=this._root,r=this._comparator;t;){var i=r(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},n.prototype.forEach=function(e,t){for(var r=this._root,i=[],o=!1;!o;)r!==null?(i.push(r),r=r.left):i.length!==0?(r=i.pop(),e.call(t,r),r=r.right):o=!0;return this},n.prototype.range=function(e,t,r,i){for(var o=[],l=this._comparator,s=this._root,u;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),u=l(s.key,t),u>0)break;if(l(s.key,e)>=0&&r.call(i,s))return this;s=s.right}return this},n.prototype.keys=function(){var e=[];return this.forEach(function(t){var r=t.key;return e.push(r)}),e},n.prototype.values=function(){var e=[];return this.forEach(function(t){var r=t.data;return e.push(r)}),e},n.prototype.min=function(){return this._root?this.minNode(this._root).key:null},n.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},n.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},n.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},n.prototype.at=function(e){for(var t=this._root,r=!1,i=0,o=[];!r;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else r=!0;return null},n.prototype.next=function(e){var t=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(r=t,t=t.left):t=t.right}return r},n.prototype.prev=function(e){var t=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(r=t,t=t.right)}return r},n.prototype.clear=function(){return this._root=null,this._size=0,this},n.prototype.toList=function(){return Al(this._root)},n.prototype.load=function(e,t,r){t===void 0&&(t=[]),r===void 0&&(r=!1);var i=e.length,o=this._comparator;if(r&&xn(e,t,0,i-1,o),this._root===null)this._root=Mn(e,t,0,i),this._size=i;else{var l=Ol(this.toList(),Rl(e,t),o);i=this._size+i,this._root=Pn({head:l},0,i)}return this},n.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var t=[];return En(this._root,"",!0,function(r){return t.push(r)},e),t.join("")},n.prototype.update=function(e,t,r){var i=this._comparator,o=Xr(e,this._root,i),l=o.left,s=o.right;i(e,t)<0?s=vn(t,r,s,i):l=vn(t,r,l,i),this._root=Cl(l,s,i)},n.prototype.split=function(e){return Xr(e,this._root,this._comparator)},n.prototype[Symbol.iterator]=function(){var e;return Ll(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},n}();function Mn(n,e,t,r){var i=r-t;if(i>0){var o=t+Math.floor(i/2),l=n[o],s=e[o],u=new at(l,s);return u.left=Mn(n,e,t,o),u.right=Mn(n,e,o+1,r),u}return null}function Rl(n,e){for(var t=new at(null,null),r=t,i=0;i<n.length;i++)r=r.next=new at(n[i],e[i]);return r.next=null,t.next}function Al(n){for(var e=n,t=[],r=!1,i=new at(null,null),o=i;!r;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):r=!0;return o.next=null,i.next}function Pn(n,e,t){var r=t-e;if(r>0){var i=e+Math.floor(r/2),o=Pn(n,e,i),l=n.head;return l.left=o,n.head=n.head.next,l.right=Pn(n,i+1,t),l}return null}function Ol(n,e,t){for(var r=new at(null,null),i=r,o=n,l=e;o!==null&&l!==null;)t(o.key,l.key)<0?(i.next=o,o=o.next):(i.next=l,l=l.next),i=i.next;return o!==null?i.next=o:l!==null&&(i.next=l),r.next}function xn(n,e,t,r,i){if(!(t>=r)){for(var o=n[t+r>>1],l=t-1,s=r+1;;){do l++;while(i(n[l],o)<0);do s--;while(i(n[s],o)>0);if(l>=s)break;var u=n[l];n[l]=n[s],n[s]=u,u=e[l],e[l]=e[s],e[s]=u}xn(n,e,t,s,i),xn(n,e,s+1,r,i)}}function ze(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Jr(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function Se(n,e,t){return e&&Jr(n.prototype,e),t&&Jr(n,t),n}var Tt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Ln=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var r=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,l=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:r,y:o},ur:{x:i,y:l}}},ot=Number.EPSILON;ot===void 0&&(ot=Math.pow(2,-52));var Nl=ot*ot,Tn=function(e,t){if(-ot<e&&e<ot&&-ot<t&&t<ot)return 0;var r=e-t;return r*r<Nl*e*t?0:e<t?-1:1},Fl=function(){function n(){ze(this,n),this.reset()}return Se(n,[{key:"reset",value:function(){this.xRounder=new Ur,this.yRounder=new Ur}},{key:"round",value:function(t,r){return{x:this.xRounder.round(t),y:this.yRounder.round(r)}}}]),n}(),Ur=function(){function n(){ze(this,n),this.tree=new er,this.round(0)}return Se(n,[{key:"round",value:function(t){var r=this.tree.add(t),i=this.tree.prev(r);if(i!==null&&Tn(r.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(r);return o!==null&&Tn(r.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),n}(),Ft=new Fl,Rt=function(e,t){return e.x*t.y-e.y*t.x},Ei=function(e,t){return e.x*t.x+e.y*t.y},Wr=function(e,t,r){var i={x:t.x-e.x,y:t.y-e.y},o={x:r.x-e.x,y:r.y-e.y},l=Rt(i,o);return Tn(l,0)},tn=function(e){return Math.sqrt(Ei(e,e))},Il=function(e,t,r){var i={x:t.x-e.x,y:t.y-e.y},o={x:r.x-e.x,y:r.y-e.y};return Rt(o,i)/tn(o)/tn(i)},Bl=function(e,t,r){var i={x:t.x-e.x,y:t.y-e.y},o={x:r.x-e.x,y:r.y-e.y};return Ei(o,i)/tn(o)/tn(i)},jr=function(e,t,r){return t.y===0?null:{x:e.x+t.x/t.y*(r-e.y),y:r}},Vr=function(e,t,r){return t.x===0?null:{x:r,y:e.y+t.y/t.x*(r-e.x)}},zl=function(e,t,r,i){if(t.x===0)return Vr(r,i,e.x);if(i.x===0)return Vr(e,t,r.x);if(t.y===0)return jr(r,i,e.y);if(i.y===0)return jr(e,t,r.y);var o=Rt(t,i);if(o==0)return null;var l={x:r.x-e.x,y:r.y-e.y},s=Rt(l,t)/o,u=Rt(l,i)/o,a=e.x+u*t.x,c=r.x+s*i.x,g=e.y+u*t.y,d=r.y+s*i.y,f=(a+c)/2,h=(g+d)/2;return{x:f,y:h}},je=function(){Se(n,null,[{key:"compare",value:function(t,r){var i=n.comparePoints(t.point,r.point);return i!==0?i:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:nn.compare(t.segment,r.segment))}},{key:"comparePoints",value:function(t,r){return t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0}}]);function n(e,t){ze(this,n),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Se(n,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var r=t.point.events,i=0,o=r.length;i<o;i++){var l=r[i];this.point.events.push(l),l.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,r=0;r<t;r++){var i=this.point.events[r];if(i.segment.consumedBy===void 0)for(var o=r+1;o<t;o++){var l=this.point.events[o];l.consumedBy===void 0&&i.otherSE.point.events===l.otherSE.point.events&&i.segment.consume(l.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],r=0,i=this.point.events.length;r<i;r++){var o=this.point.events[r];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var r=this,i=new Map,o=function(s){var u=s.otherSE;i.set(s,{sine:Il(r.point,t.point,u.point),cosine:Bl(r.point,t.point,u.point)})};return function(l,s){i.has(l)||o(l),i.has(s)||o(s);var u=i.get(l),a=u.sine,c=u.cosine,g=i.get(s),d=g.sine,f=g.cosine;return a>=0&&d>=0?c<f?1:c>f?-1:0:a<0&&d<0?c<f?-1:c>f?1:0:d<a?-1:d>a?1:0}}}]),n}(),Gl=0,nn=function(){Se(n,null,[{key:"compare",value:function(t,r){var i=t.leftSE.point.x,o=r.leftSE.point.x,l=t.rightSE.point.x,s=r.rightSE.point.x;if(s<i)return 1;if(l<o)return-1;var u=t.leftSE.point.y,a=r.leftSE.point.y,c=t.rightSE.point.y,g=r.rightSE.point.y;if(i<o){if(a<u&&a<c)return 1;if(a>u&&a>c)return-1;var d=t.comparePoint(r.leftSE.point);if(d<0)return 1;if(d>0)return-1;var f=r.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(u<a&&u<g)return-1;if(u>a&&u>g)return 1;var h=r.comparePoint(t.leftSE.point);if(h!==0)return h;var v=t.comparePoint(r.rightSE.point);return v<0?1:v>0?-1:1}if(u<a)return-1;if(u>a)return 1;if(l<s){var k=r.comparePoint(t.rightSE.point);if(k!==0)return k}if(l>s){var C=t.comparePoint(r.rightSE.point);if(C<0)return 1;if(C>0)return-1}if(l!==s){var m=c-u,p=l-i,b=g-a,w=s-o;if(m>p&&b<w)return 1;if(m<p&&b>w)return-1}return l>s?1:l<s||c<g?-1:c>g?1:t.id<r.id?-1:t.id>r.id?1:0}}]);function n(e,t,r,i){ze(this,n),this.id=++Gl,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=r,this.windings=i}return Se(n,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<r?t:r},ur:{x:this.rightSE.point.x,y:t>r?t:r}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var r=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(r.x===i.x)return t.x===r.x?0:t.x<r.x?1:-1;var l=(t.y-r.y)/o.y,s=r.x+l*o.x;if(t.x===s)return 0;var u=(t.x-r.x)/o.x,a=r.y+u*o.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var r=this.bbox(),i=t.bbox(),o=Ln(r,i);if(o===null)return null;var l=this.leftSE.point,s=this.rightSE.point,u=t.leftSE.point,a=t.rightSE.point,c=Tt(r,u)&&this.comparePoint(u)===0,g=Tt(i,l)&&t.comparePoint(l)===0,d=Tt(r,a)&&this.comparePoint(a)===0,f=Tt(i,s)&&t.comparePoint(s)===0;if(g&&c)return f&&!d?s:!f&&d?a:null;if(g)return d&&l.x===a.x&&l.y===a.y?null:l;if(c)return f&&s.x===u.x&&s.y===u.y?null:u;if(f&&d)return null;if(f)return s;if(d)return a;var h=zl(l,this.vector(),u,t.vector());return h===null||!Tt(o,h)?null:Ft.round(h.x,h.y)}},{key:"split",value:function(t){var r=[],i=t.events!==void 0,o=new je(t,!0),l=new je(t,!1),s=this.rightSE;this.replaceRightSE(l),r.push(l),r.push(o);var u=new n(o,s,this.rings.slice(),this.windings.slice());return je.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),je.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),l.checkForConsuming()),r}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var r=0,i=this.windings.length;r<i;r++)this.windings[r]*=-1}},{key:"consume",value:function(t){for(var r=this,i=t;r.consumedBy;)r=r.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=n.compare(r,i);if(o!==0){if(o>0){var l=r;r=i,i=l}if(r.prev===i){var s=r;r=i,i=s}for(var u=0,a=i.rings.length;u<a;u++){var c=i.rings[u],g=i.windings[u],d=r.rings.indexOf(c);d===-1?(r.rings.push(c),r.windings.push(g)):r.windings[d]+=g}i.rings=null,i.windings=null,i.consumedBy=r,i.leftSE.consumedBy=r.leftSE,i.rightSE.consumedBy=r.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var r=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,l=0,s=this.rings.length;l<s;l++){var u=this.rings[l],a=this.windings[l],c=r.indexOf(u);c===-1?(r.push(u),i.push(a)):i[c]+=a}for(var g=[],d=[],f=0,h=r.length;f<h;f++)if(i[f]!==0){var v=r[f],k=v.poly;if(d.indexOf(k)===-1)if(v.isExterior)g.push(k);else{d.indexOf(k)===-1&&d.push(k);var C=g.indexOf(v.poly);C!==-1&&g.splice(C,1)}}for(var m=0,p=g.length;m<p;m++){var b=g[m].multiPoly;o.indexOf(b)===-1&&o.push(b)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(De.type){case"union":{var i=t.length===0,o=r.length===0;this._isInResult=i!==o;break}case"intersection":{var l,s;t.length<r.length?(l=t.length,s=r.length):(l=r.length,s=t.length),this._isInResult=s===De.numMultiPolys&&l<s;break}case"xor":{var u=Math.abs(t.length-r.length);this._isInResult=u%2===1;break}case"difference":{var a=function(g){return g.length===1&&g[0].isSubject};this._isInResult=a(t)!==a(r);break}default:throw new Error("Unrecognized operation type found ".concat(De.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,r,i){var o,l,s,u=je.comparePoints(t,r);if(u<0)o=t,l=r,s=1;else if(u>0)o=r,l=t,s=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var a=new je(o,!0),c=new je(l,!1);return new n(a,c,[i],[s])}}]),n}(),Hr=function(){function n(e,t,r){if(ze(this,n),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Ft.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,l=1,s=e.length;l<s;l++){if(typeof e[l][0]!="number"||typeof e[l][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var u=Ft.round(e[l][0],e[l][1]);u.x===o.x&&u.y===o.y||(this.segments.push(nn.fromRing(o,u,this)),u.x<this.bbox.ll.x&&(this.bbox.ll.x=u.x),u.y<this.bbox.ll.y&&(this.bbox.ll.y=u.y),u.x>this.bbox.ur.x&&(this.bbox.ur.x=u.x),u.y>this.bbox.ur.y&&(this.bbox.ur.y=u.y),o=u)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(nn.fromRing(o,i,this))}return Se(n,[{key:"getSweepEvents",value:function(){for(var t=[],r=0,i=this.segments.length;r<i;r++){var o=this.segments[r];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),n}(),ql=function(){function n(e,t){if(ze(this,n),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Hr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var o=new Hr(e[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Se(n,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),r=0,i=this.interiorRings.length;r<i;r++)for(var o=this.interiorRings[r].getSweepEvents(),l=0,s=o.length;l<s;l++)t.push(o[l]);return t}}]),n}(),Zr=function(){function n(e,t){if(ze(this,n),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var o=new ql(e[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Se(n,[{key:"getSweepEvents",value:function(){for(var t=[],r=0,i=this.polys.length;r<i;r++)for(var o=this.polys[r].getSweepEvents(),l=0,s=o.length;l<s;l++)t.push(o[l]);return t}}]),n}(),Dl=function(){Se(n,null,[{key:"factory",value:function(t){for(var r=[],i=0,o=t.length;i<o;i++){var l=t[i];if(!(!l.isInResult()||l.ringOut)){for(var s=null,u=l.leftSE,a=l.rightSE,c=[u],g=u.point,d=[];s=u,u=a,c.push(u),u.point!==g;)for(;;){var f=u.getAvailableLinkedEvents();if(f.length===0){var h=c[0].point,v=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(v.x,", ").concat(v.y,"]."))}if(f.length===1){a=f[0].otherSE;break}for(var k=null,C=0,m=d.length;C<m;C++)if(d[C].point===u.point){k=C;break}if(k!==null){var p=d.splice(k)[0],b=c.splice(p.index);b.unshift(b[0].otherSE),r.push(new n(b.reverse()));continue}d.push({index:c.length,point:u.point});var w=u.getLeftmostComparator(s);a=f.sort(w)[0].otherSE;break}r.push(new n(c))}}return r}}]);function n(e){ze(this,n),this.events=e;for(var t=0,r=e.length;t<r;t++)e[t].segment.ringOut=this;this.poly=null}return Se(n,[{key:"getGeom",value:function(){for(var t=this.events[0].point,r=[t],i=1,o=this.events.length-1;i<o;i++){var l=this.events[i].point,s=this.events[i+1].point;Wr(l,t,s)!==0&&(r.push(l),t=l)}if(r.length===1)return null;var u=r[0],a=r[1];Wr(u,t,a)===0&&r.shift(),r.push(r[0]);for(var c=this.isExteriorRing()?1:-1,g=this.isExteriorRing()?0:r.length-1,d=this.isExteriorRing()?r.length:-1,f=[],h=g;h!=d;h+=c)f.push([r[h].x,r[h].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],r=1,i=this.events.length;r<i;r++){var o=this.events[r];je.compare(t,o)>0&&(t=o)}for(var l=t.segment.prevInResult(),s=l?l.prevInResult():null;;){if(!l)return null;if(!s)return l.ringOut;if(s.ringOut!==l.ringOut)return s.ringOut.enclosingRing()!==l.ringOut?l.ringOut:l.ringOut.enclosingRing();l=s.prevInResult(),s=l?l.prevInResult():null}}}]),n}(),Qr=function(){function n(e){ze(this,n),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Se(n,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var r=0,i=this.interiorRings.length;r<i;r++){var o=this.interiorRings[r].getGeom();o!==null&&t.push(o)}return t}}]),n}(),Yl=function(){function n(e){ze(this,n),this.rings=e,this.polys=this._composePolys(e)}return Se(n,[{key:"getGeom",value:function(){for(var t=[],r=0,i=this.polys.length;r<i;r++){var o=this.polys[r].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var r=[],i=0,o=t.length;i<o;i++){var l=t[i];if(!l.poly)if(l.isExteriorRing())r.push(new Qr(l));else{var s=l.enclosingRing();s.poly||r.push(new Qr(s)),s.poly.addInterior(l)}}return r}}]),n}(),Xl=function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nn.compare;ze(this,n),this.queue=e,this.tree=new er(t),this.segments=[]}return Se(n,[{key:"process",value:function(t){var r=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(r),i;var o=t.isLeft?this.tree.insert(r):this.tree.find(r);if(!o)throw new Error("Unable to find segment #".concat(r.id," ")+"[".concat(r.leftSE.point.x,", ").concat(r.leftSE.point.y,"] -> ")+"[".concat(r.rightSE.point.x,", ").concat(r.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var l=o,s=o,u=void 0,a=void 0;u===void 0;)l=this.tree.prev(l),l===null?u=null:l.key.consumedBy===void 0&&(u=l.key);for(;a===void 0;)s=this.tree.next(s),s===null?a=null:s.key.consumedBy===void 0&&(a=s.key);if(t.isLeft){var c=null;if(u){var g=u.getIntersection(r);if(g!==null&&(r.isAnEndpoint(g)||(c=g),!u.isAnEndpoint(g)))for(var d=this._splitSafely(u,g),f=0,h=d.length;f<h;f++)i.push(d[f])}var v=null;if(a){var k=a.getIntersection(r);if(k!==null&&(r.isAnEndpoint(k)||(v=k),!a.isAnEndpoint(k)))for(var C=this._splitSafely(a,k),m=0,p=C.length;m<p;m++)i.push(C[m])}if(c!==null||v!==null){var b=null;if(c===null)b=v;else if(v===null)b=c;else{var w=je.comparePoints(c,v);b=w<=0?c:v}this.queue.remove(r.rightSE),i.push(r.rightSE);for(var _=r.split(b),O=0,x=_.length;O<x;O++)i.push(_[O])}i.length>0?(this.tree.remove(r),i.push(t)):(this.segments.push(r),r.prev=u)}else{if(u&&a){var F=u.getIntersection(a);if(F!==null){if(!u.isAnEndpoint(F))for(var q=this._splitSafely(u,F),E=0,B=q.length;E<B;E++)i.push(q[E]);if(!a.isAnEndpoint(F))for(var N=this._splitSafely(a,F),R=0,G=N.length;R<G;R++)i.push(N[R])}}this.tree.remove(r)}return i}},{key:"_splitSafely",value:function(t,r){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(r);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),n}(),Kr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Jl=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Ul=function(){function n(){ze(this,n)}return Se(n,[{key:"run",value:function(t,r,i){De.type=t,Ft.reset();for(var o=[new Zr(r,!0)],l=0,s=i.length;l<s;l++)o.push(new Zr(i[l],!1));if(De.numMultiPolys=o.length,De.type==="difference")for(var u=o[0],a=1;a<o.length;)Ln(o[a].bbox,u.bbox)!==null?a++:o.splice(a,1);if(De.type==="intersection"){for(var c=0,g=o.length;c<g;c++)for(var d=o[c],f=c+1,h=o.length;f<h;f++)if(Ln(d.bbox,o[f].bbox)===null)return[]}for(var v=new er(je.compare),k=0,C=o.length;k<C;k++)for(var m=o[k].getSweepEvents(),p=0,b=m.length;p<b;p++)if(v.insert(m[p]),v.size>Kr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var w=new Xl(v),_=v.size,O=v.pop();O;){var x=O.key;if(v.size===_){var F=x.segment;throw new Error("Unable to pop() ".concat(x.isLeft?"left":"right"," SweepEvent ")+"[".concat(x.point.x,", ").concat(x.point.y,"] from segment #").concat(F.id," ")+"[".concat(F.leftSE.point.x,", ").concat(F.leftSE.point.y,"] -> ")+"[".concat(F.rightSE.point.x,", ").concat(F.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(v.size>Kr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(w.segments.length>Jl)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var q=w.process(x),E=0,B=q.length;E<B;E++){var N=q[E];N.consumedBy===void 0&&v.insert(N)}_=v.size,O=v.pop()}Ft.reset();var R=Dl.factory(w.segments),G=new Yl(R);return G.getGeom()}}]),n}(),De=new Ul,Wl=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return De.run("union",e,r)},jl=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return De.run("intersection",e,r)},Vl=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return De.run("xor",e,r)},Hl=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return De.run("difference",e,r)},jt={union:Wl,intersection:jl,xor:Vl,difference:Hl};function Zl(n,e){var t=Kl(e),r=null;return n.type==="FeatureCollection"?r=Ql(n):r=Mi(jt.union(n.geometry.coordinates)),r.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function Ql(n){var e=n.features.length===2?jt.union(n.features[0].geometry.coordinates,n.features[1].geometry.coordinates):jt.union.apply(jt,n.features.map(function(t){return t.geometry.coordinates}));return Mi(e)}function Mi(n){return Qn(n)}function Kl(n){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=n&&n.geometry.coordinates||e;return cn(t)}function $l(n,e,t){let r;he(n,Qe,l=>t(1,r=l));let{boundaryGeojson:i}=e;return Yn("setCamera")&&r.fitBounds(Jn(i),{padding:20,animate:!1}),Pt(r,"boundary",{type:"geojson",data:Zl(i)}),Te(r,{id:"boundary",source:"boundary",...Hn("black",.5)}),n.$$set=l=>{"boundaryGeojson"in l&&t(0,i=l.boundaryGeojson)},[i]}class es extends oe{constructor(e){super(),le(this,e,$l,null,se,{boundaryGeojson:0})}}function ts(n){let e,t,r,i,o,l,s,u;return e=new Jt({props:{labelText:"Area",value:"area"}}),r=new Jt({props:{labelText:"Route",value:"route"}}),o=new Jt({props:{labelText:"Crossing",value:"crossing"}}),s=new Jt({props:{labelText:"Other",value:"other"}}),{c(){V(e.$$.fragment),t=z(),V(r.$$.fragment),i=z(),V(o.$$.fragment),l=z(),V(s.$$.fragment)},m(a,c){H(e,a,c),M(a,t,c),H(r,a,c),M(a,i,c),H(o,a,c),M(a,l,c),H(s,a,c),u=!0},p:re,i(a){u||(I(e.$$.fragment,a),I(r.$$.fragment,a),I(o.$$.fragment,a),I(s.$$.fragment,a),u=!0)},o(a){D(e.$$.fragment,a),D(r.$$.fragment,a),D(o.$$.fragment,a),D(s.$$.fragment,a),u=!1},d(a){Z(e,a),a&&P(t),Z(r,a),a&&P(i),Z(o,a),a&&P(l),Z(s,a)}}}function $r(n){let e,t,r=ei(n[3])+"",i,o,l;return{c(){e=T("p"),t=W("Length: "),i=W(r),o=z(),l=T("br")},m(s,u){M(s,e,u),S(e,t),S(e,i),M(s,o,u),M(s,l,u)},p(s,u){u&8&&r!==(r=ei(s[3])+"")&&pe(i,r)},d(s){s&&P(e),s&&P(o),s&&P(l)}}}function ns(n){let e,t,r,i,o,l,s,u,a,c,g,d,f,h,v,k,C,m,p,b,w,_,O;function x(G){n[7](G)}let F={labelText:"Name"};n[0]!==void 0&&(F.value=n[0]),e=new Wo({props:F}),fe.push(()=>Ye(e,"value",x,n[0]));function q(G){n[8](G)}let E={$$slots:{default:[ts]},$$scope:{ctx:n}};n[1]!==void 0&&(E.selected=n[1]),l=new Ao({props:E}),fe.push(()=>Ye(l,"selected",q,n[1]));function B(G){n[9](G)}let N={labelText:"Description"};n[2]!==void 0&&(N.value=n[2]),g=new zo({props:N}),fe.push(()=>Ye(g,"value",B,n[2]));let R=n[3]&&$r(n);return{c(){V(e.$$.fragment),r=z(),i=T("br"),o=z(),V(l.$$.fragment),u=z(),a=T("br"),c=z(),V(g.$$.fragment),f=z(),h=T("br"),v=z(),R&&R.c(),k=z(),C=T("div"),m=T("button"),m.textContent="Delete",p=z(),b=T("button"),b.textContent="Save",A(m,"type","button"),A(b,"type","button"),Ct(b,"float","right")},m(G,J){H(e,G,J),M(G,r,J),M(G,i,J),M(G,o,J),H(l,G,J),M(G,u,J),M(G,a,J),M(G,c,J),H(g,G,J),M(G,f,J),M(G,h,J),M(G,v,J),R&&R.m(G,J),M(G,k,J),M(G,C,J),S(C,m),S(C,p),S(C,b),n[11](C),w=!0,_||(O=[X(m,"click",n[5]),X(b,"click",n[10])],_=!0)},p(G,[J]){const te={};!t&&J&1&&(t=!0,te.value=G[0],Xe(()=>t=!1)),e.$set(te);const $={};J&4096&&($.$$scope={dirty:J,ctx:G}),!s&&J&2&&(s=!0,$.selected=G[1],Xe(()=>s=!1)),l.$set($);const ee={};!d&&J&4&&(d=!0,ee.value=G[2],Xe(()=>d=!1)),g.$set(ee),G[3]?R?R.p(G,J):(R=$r(G),R.c(),R.m(k.parentNode,k)):R&&(R.d(1),R=null)},i(G){w||(I(e.$$.fragment,G),I(l.$$.fragment,G),I(g.$$.fragment,G),w=!0)},o(G){D(e.$$.fragment,G),D(l.$$.fragment,G),D(g.$$.fragment,G),w=!1},d(G){Z(e,G),G&&P(r),G&&P(i),G&&P(o),Z(l,G),G&&P(u),G&&P(a),G&&P(c),Z(g,G),G&&P(f),G&&P(h),G&&P(v),R&&R.d(G),G&&P(k),G&&P(C),n[11](null),_=!1,Ue(O)}}}function ei(n){return n<1e3?Math.round(n)+" m":(n/1e3).toFixed(1)+"km"}function rs(n,e,t){let{id:r}=e,{name:i}=e,{intervention_type:o}=e,{description:l}=e,{length_meters:s}=e,u;il.subscribe(v=>{r==v&&setTimeout(()=>u==null?void 0:u.scrollIntoView({behavior:"smooth"}),1)});function a(){ue.update(v=>(v.features=v.features.filter(k=>k.id!=r),v)),Ce.set(null),qe.set(null)}function c(v){i=v,t(0,i)}function g(v){o=v,t(1,o)}function d(v){l=v,t(2,l)}const f=()=>Ce.set(null);function h(v){fe[v?"unshift":"push"](()=>{u=v,t(4,u)})}return n.$$set=v=>{"id"in v&&t(6,r=v.id),"name"in v&&t(0,i=v.name),"intervention_type"in v&&t(1,o=v.intervention_type),"description"in v&&t(2,l=v.description),"length_meters"in v&&t(3,s=v.length_meters)},[i,o,l,s,u,a,r,c,g,d,f,h]}class is extends oe{constructor(e){super(),le(this,e,rs,ns,se,{id:6,name:0,intervention_type:1,description:2,length_meters:3})}}function ti(n){let e,t,r;const i=n[8].default,o=Ae(i,n,n[7],null);return{c(){e=T("div"),o&&o.c()},m(l,s){M(l,e,s),o&&o.m(e,null),r=!0},p(l,s){o&&o.p&&(!r||s&128)&&Oe(o,i,l,l[7],r?Fe(i,l[7],s,null):Ne(l[7]),null)},i(l){r||(I(o,l),yi(()=>{t||(t=ar(e,pr,{duration:300},!0)),t.run(1)}),r=!0)},o(l){D(o,l),t||(t=ar(e,pr,{duration:300},!1)),t.run(0),r=!1},d(l){l&&P(e),o&&o.d(l),l&&t&&t.end()}}}function os(n){let e,t,r,i,o,l,s,u,a,c,g=n[2]&&ti(n);return{c(){e=T("button"),t=Le("svg"),r=Le("path"),i=z(),o=W(n[0]),l=z(),g&&g.c(),s=ft(),A(r,"d","M9 5l7 7-7 7"),A(t,"style","tran"),A(t,"width","20"),A(t,"height","20"),A(t,"fill","none"),A(t,"stroke-linecap","round"),A(t,"stroke-linejoin","round"),A(t,"stroke-width","2"),A(t,"viewBox","0 0 24 24"),A(t,"stroke","currentColor"),A(t,"class","svelte-75u8ea"),A(e,"aria-expanded",n[2]),A(e,"class","svelte-75u8ea"),L(e,"underlined",n[1])},m(d,f){M(d,e,f),S(e,t),S(t,r),S(e,i),S(e,o),M(d,l,f),g&&g.m(d,f),M(d,s,f),u=!0,a||(c=[X(e,"click",n[3]),X(e,"mouseenter",n[9]),X(e,"mouseleave",n[10])],a=!0)},p(d,[f]){(!u||f&1)&&pe(o,d[0]),(!u||f&4)&&A(e,"aria-expanded",d[2]),(!u||f&2)&&L(e,"underlined",d[1]),d[2]?g?(g.p(d,f),f&4&&I(g,1)):(g=ti(d),g.c(),I(g,1),g.m(s.parentNode,s)):g&&(Me(),D(g,1,1,()=>{g=null}),Pe())},i(d){u||(I(g),u=!0)},o(d){D(g),u=!1},d(d){d&&P(e),d&&P(l),g&&g.d(d),d&&P(s),a=!1,Ue(c)}}}function ls(n,e,t){let r,i,o,l;he(n,qe,h=>t(5,o=h)),he(n,Ce,h=>t(6,l=h));let{$$slots:s={},$$scope:u}=e,{id:a}=e,{label:c}=e;const g=()=>{Ce.update(h=>h==a?null:a)};function d(h){ne.call(this,n,h)}function f(h){ne.call(this,n,h)}return n.$$set=h=>{"id"in h&&t(4,a=h.id),"label"in h&&t(0,c=h.label),"$$scope"in h&&t(7,u=h.$$scope)},n.$$.update=()=>{n.$$.dirty&80&&t(2,r=l==a),n.$$.dirty&48&&t(1,i=o==a)},[c,i,r,g,a,o,l,u,s,d,f]}class ss extends oe{constructor(e){super(),le(this,e,ls,os,se,{id:4,label:0})}}function ni(n,e,t){const r=n.slice();return r[10]=e[t],r[11]=e,r[12]=t,r}function as(n){let e,t,r,i,o,l;function s(g){n[3](g,n[10])}function u(g){n[4](g,n[10])}function a(g){n[5](g,n[10])}let c={id:n[10].id,length_meters:n[10].properties.length_meters};return n[10].properties.name!==void 0&&(c.name=n[10].properties.name),n[10].properties.intervention_type!==void 0&&(c.intervention_type=n[10].properties.intervention_type),n[10].properties.description!==void 0&&(c.description=n[10].properties.description),e=new is({props:c}),fe.push(()=>Ye(e,"name",s,n[10].properties.name)),fe.push(()=>Ye(e,"intervention_type",u,n[10].properties.intervention_type)),fe.push(()=>Ye(e,"description",a,n[10].properties.description)),{c(){V(e.$$.fragment),o=z()},m(g,d){H(e,g,d),M(g,o,d),l=!0},p(g,d){n=g;const f={};d&1&&(f.id=n[10].id),d&1&&(f.length_meters=n[10].properties.length_meters),!t&&d&1&&(t=!0,f.name=n[10].properties.name,Xe(()=>t=!1)),!r&&d&1&&(r=!0,f.intervention_type=n[10].properties.intervention_type,Xe(()=>r=!1)),!i&&d&1&&(i=!0,f.description=n[10].properties.description,Xe(()=>i=!1)),e.$set(f)},i(g){l||(I(e.$$.fragment,g),l=!0)},o(g){D(e.$$.fragment,g),l=!1},d(g){Z(e,g),g&&P(o)}}}function ri(n,e){let t,r,i;function o(){return e[6](e[10])}return r=new ss({props:{id:e[10].id,label:e[12]+1+") "+ii(e[10]),$$slots:{default:[as]},$$scope:{ctx:e}}}),r.$on("mouseenter",o),r.$on("mouseleave",e[7]),{key:n,first:null,c(){t=ft(),V(r.$$.fragment),this.first=t},m(l,s){M(l,t,s),H(r,l,s),i=!0},p(l,s){e=l;const u={};s&1&&(u.id=e[10].id),s&1&&(u.label=e[12]+1+") "+ii(e[10])),s&8193&&(u.$$scope={dirty:s,ctx:e}),r.$set(u)},i(l){i||(I(r.$$.fragment,l),i=!0)},o(l){D(r.$$.fragment,l),i=!1},d(l){l&&P(t),Z(r,l)}}}function us(n){let e=[],t=new Map,r,i,o,l,s=n[0].features;const u=a=>a[10].id;for(let a=0;a<s.length;a+=1){let c=ni(n,s,a),g=u(c);t.set(g,e[a]=ri(g,c))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=ft()},m(a,c){for(let g=0;g<e.length;g+=1)e[g].m(a,c);M(a,r,c),i=!0,o||(l=X(window,"keydown",n[2]),o=!0)},p(a,[c]){c&3&&(s=a[0].features,Me(),e=Ki(e,c,u,1,a,s,t,r.parentNode,$i,ri,r,ni),Pe())},i(a){if(!i){for(let c=0;c<s.length;c+=1)I(e[c]);i=!0}},o(a){for(let c=0;c<e.length;c+=1)D(e[c]);i=!1},d(a){for(let c=0;c<e.length;c+=1)e[c].d(a);a&&P(r),o=!1,l()}}}function ii(n){if(n.properties.name)return n.properties.name;var e=n.properties.intervention_type;return e=="other"&&(n.geometry.type=="Point"?e="point":n.geometry.type=="LineString"?e="line":e="polygon"),`Untitled ${e}`}function fs(n,e,t){let r,i;he(n,Ce,d=>t(8,r=d)),he(n,ue,d=>t(0,i=d));function o(d){r==null&&qe.set(d)}function l(d){if(d.key=="Delete"){const f=d.target.tagName;if(f=="INPUT"||f=="TEXTAREA")return;d.preventDefault();const h=r;h&&(ue.update(v=>(v.features=v.features.filter(k=>k.id!=h),v)),Ce.set(null))}}function s(d,f){n.$$.not_equal(f.properties.name,d)&&(f.properties.name=d,ue.set(i))}function u(d,f){n.$$.not_equal(f.properties.intervention_type,d)&&(f.properties.intervention_type=d,ue.set(i))}function a(d,f){n.$$.not_equal(f.properties.description,d)&&(f.properties.description=d,ue.set(i))}return[i,o,l,s,u,a,d=>o(d.id),()=>o(null)]}class cs extends oe{constructor(e){super(),le(this,e,fs,us,se,{})}}function st(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function He(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Cn(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function it(n,e,t){t===void 0&&(t={});var r=st(n),i=st(e),o=Re(i[1]-r[1]),l=Re(i[0]-r[0]),s=Re(r[1]),u=Re(i[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(s)*Math.cos(u);return Kn(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),t.units)}function pt(n,e,t){if(n!==null)for(var r,i,o,l,s,u,a,c=0,g=0,d,f=n.type,h=f==="FeatureCollection",v=f==="Feature",k=h?n.features.length:1,C=0;C<k;C++){a=h?n.features[C].geometry:v?n.geometry:n,d=a?a.type==="GeometryCollection":!1,s=d?a.geometries.length:1;for(var m=0;m<s;m++){var p=0,b=0;if(l=d?a.geometries[m]:a,l!==null){u=l.coordinates;var w=l.type;switch(c=t&&(w==="Polygon"||w==="MultiPolygon")?1:0,w){case null:break;case"Point":if(e(u,g,C,p,b)===!1)return!1;g++,p++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(e(u[r],g,C,p,b)===!1)return!1;g++,w==="MultiPoint"&&p++}w==="LineString"&&p++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-c;i++){if(e(u[r][i],g,C,p,b)===!1)return!1;g++}w==="MultiLineString"&&p++,w==="Polygon"&&b++}w==="Polygon"&&p++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(b=0,i=0;i<u[r].length;i++){for(o=0;o<u[r][i].length-c;o++){if(e(u[r][i][o],g,C,p,b)===!1)return!1;g++}b++}p++}break;case"GeometryCollection":for(r=0;r<l.geometries.length;r++)if(pt(l.geometries[r],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ds(n,e,t,r){var i=t;return pt(n,function(o,l,s,u,a){l===0&&t===void 0?i=o:i=e(i,o,l,s,u,a)},r),i}function Pi(n,e){var t;switch(n.type){case"FeatureCollection":for(t=0;t<n.features.length&&e(n.features[t].properties,t)!==!1;t++);break;case"Feature":e(n.properties,0);break}}function hs(n,e,t){var r=t;return Pi(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}function Et(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function xi(n,e,t){var r=t;return Et(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}function ps(n){var e=[];return pt(n,function(t){e.push(t)}),e}function tr(n,e){var t,r,i,o,l,s,u,a,c,g,d=0,f=n.type==="FeatureCollection",h=n.type==="Feature",v=f?n.features.length:1;for(t=0;t<v;t++){for(s=f?n.features[t].geometry:h?n.geometry:n,a=f?n.features[t].properties:h?n.properties:{},c=f?n.features[t].bbox:h?n.bbox:void 0,g=f?n.features[t].id:h?n.id:void 0,u=s?s.type==="GeometryCollection":!1,l=u?s.geometries.length:1,i=0;i<l;i++){if(o=u?s.geometries[i]:s,o===null){if(e(null,d,a,c,g)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,d,a,c,g)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],d,a,c,g)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}d++}}function ms(n,e,t){var r=t;return tr(n,function(i,o,l,s,u){o===0&&t===void 0?r=i:r=e(r,i,o,l,s,u)}),r}function mt(n,e){tr(n,function(t,r,i,o,l){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Be(t,i,{bbox:o,id:l}),r,0)===!1?!1:void 0}var u;switch(s){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon";break}for(var a=0;a<t.coordinates.length;a++){var c=t.coordinates[a],g={type:u,coordinates:c};if(e(Be(g,i),r,a)===!1)return!1}})}function gs(n,e,t){var r=t;return mt(n,function(i,o,l){o===0&&l===0&&t===void 0?r=i:r=e(r,i,o,l)}),r}function Li(n,e){mt(n,function(t,r,i){var o=0;if(t.geometry){var l=t.geometry.type;if(!(l==="Point"||l==="MultiPoint")){var s,u=0,a=0,c=0;if(pt(t,function(g,d,f,h,v){if(s===void 0||r>u||h>a||v>c){s=g,u=r,a=h,c=v,o=0;return}var k=ke([s,g],t.properties);if(e(k,r,i,v,o)===!1)return!1;o++,s=g})===!1)return!1}}})}function Ti(n,e,t){var r=t,i=!1;return Li(n,function(o,l,s,u,a){i===!1&&t===void 0?r=o:r=e(r,o,l,s,u,a),i=!0}),r}function Ci(n,e){if(!n)throw new Error("geojson is required");mt(n,function(t,r,i){if(t.geometry!==null){var o=t.geometry.type,l=t.geometry.coordinates;switch(o){case"LineString":if(e(t,r,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<l.length;s++)if(e(ke(l[s],t.properties),r,i,s)===!1)return!1;break}}})}function vs(n,e,t){var r=t;return Ci(n,function(i,o,l,s){o===0&&t===void 0?r=i:r=e(r,i,o,l,s)}),r}function bs(n,e){if(e=e||{},!$n(e))throw new Error("options is invalid");var t=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,l=e.properties,s;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),l=l||n.features[t].properties,s=n.features[t].geometry;break;case"Feature":l=l||n.properties,s=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=n;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var u=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=u.length+o-1),ke([u[o],u[o+1]],l,e);case"Polygon":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o-1),ke([u[i][o],u[i][o+1]],l,e);case"MultiLineString":return r<0&&(r=u.length+r),o<0&&(o=u[r].length+o-1),ke([u[r][o],u[r][o+1]],l,e);case"MultiPolygon":return r<0&&(r=u.length+r),i<0&&(i=u[r].length+i),o<0&&(o=u[r][i].length-o-1),ke([u[r][i][o],u[r][i][o+1]],l,e)}throw new Error("geojson is invalid")}function _s(n,e){if(e=e||{},!$n(e))throw new Error("options is invalid");var t=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,l=e.properties,s;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),l=l||n.features[t].properties,s=n.features[t].geometry;break;case"Feature":l=l||n.properties,s=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=n;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var u=s.coordinates;switch(s.type){case"Point":return we(u,l,e);case"MultiPoint":return r<0&&(r=u.length+r),we(u[r],l,e);case"LineString":return o<0&&(o=u.length+o),we(u[o],l,e);case"Polygon":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o),we(u[i][o],l,e);case"MultiLineString":return r<0&&(r=u.length+r),o<0&&(o=u[r].length+o),we(u[r][o],l,e);case"MultiPolygon":return r<0&&(r=u.length+r),i<0&&(i=u[r].length+i),o<0&&(o=u[r][i].length-o),we(u[r][i][o],l,e)}throw new Error("geojson is invalid")}const ys=Object.freeze(Object.defineProperty({__proto__:null,coordAll:ps,coordEach:pt,coordReduce:ds,featureEach:Et,featureReduce:xi,findPoint:_s,findSegment:bs,flattenEach:mt,flattenReduce:gs,geomEach:tr,geomReduce:ms,lineEach:Ci,lineReduce:vs,propEach:Pi,propReduce:hs,segmentEach:Li,segmentReduce:Ti},Symbol.toStringTag,{value:"Module"}));function Vt(n,e){return e===void 0&&(e={}),Ti(n,function(t,r){var i=r.geometry.coordinates;return t+it(i[0],i[1],e)},0)}function ws(n){let e,t,r,i,o,l,s,u,a,c,g,d,f,h,v,k,C,m,p,b=n[0].features.length+"",w,_,O,x,F,q,E,B;return{c(){e=T("div"),t=T("label"),r=W(`Scheme name:
    `),i=T("input"),o=z(),l=T("br"),s=z(),u=T("div"),a=T("label"),c=T("input"),g=z(),d=T("button"),d.textContent="Load from GeoJSON",f=z(),h=T("button"),h.textContent="Export to GeoJSON",v=z(),k=T("br"),C=z(),m=T("div"),p=T("span"),w=W(b),_=W(" interventions"),O=z(),x=T("button"),F=W("Clear all"),A(i,"type","text"),A(c,"type","file"),A(c,"id","load_geojson"),A(c,"class","svelte-lhyd1e"),A(d,"type","button"),A(h,"type","button"),A(h,"class","align-right svelte-lhyd1e"),A(x,"type","button"),A(x,"class","align-right svelte-lhyd1e"),x.disabled=q=n[0].features.length==0},m(N,R){M(N,e,R),S(e,t),S(t,r),S(t,i),St(i,n[0].scheme_name),M(N,o,R),M(N,l,R),M(N,s,R),M(N,u,R),S(u,a),S(a,c),S(a,g),S(a,d),S(u,f),S(u,h),M(N,v,R),M(N,k,R),M(N,C,R),M(N,m,R),S(m,p),S(p,w),S(p,_),S(m,O),S(m,x),S(x,F),E||(B=[X(i,"input",n[5]),X(c,"change",n[3]),X(d,"click",n[6]),X(h,"click",n[2]),X(x,"click",n[1])],E=!0)},p(N,[R]){R&1&&i.value!==N[0].scheme_name&&St(i,N[0].scheme_name),R&1&&b!==(b=N[0].features.length+"")&&pe(w,b),R&1&&q!==(q=N[0].features.length==0)&&(x.disabled=q)},i:re,o:re,d(N){N&&P(e),N&&P(o),N&&P(l),N&&P(s),N&&P(u),N&&P(v),N&&P(k),N&&P(C),N&&P(m),E=!1,Ue(B)}}}function ks(n,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",n),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Ss(n,e,t){let r;he(n,ue,f=>t(0,r=f));let{authorityName:i}=e,o=window.localStorage.getItem(i);if(o)try{ue.set(c(JSON.parse(o)))}catch(f){console.log(`Failed to load from local storage: ${f}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&ue.update(f=>(delete f.scheme_name,f.features=[],f))}function s(){const f=JSON.parse(JSON.stringify(r));for(let h of f.features)delete h.properties.editing,delete h.properties.hide_while_editing;return f}function u(){let f=s();var h=i;f.authority=i,f.origin="atip-v1",f.scheme_name&&(h+="_"+f.scheme_name),h+=".txt",ks(h,JSON.stringify(f,null,"  "))}function a(f){const h=new FileReader;h.onload=v=>{try{ue.set(c(JSON.parse(v.target.result)))}catch(k){window.alert(`Couldn't load scheme from a file: ${k}`)}},h.readAsText(f.target.files[0])}function c(f){let h=1;for(let v of f.features)v.geometry.type=="LineString"&&!v.properties.length_meters&&(v.properties.length_meters=Vt(v,{units:"kilometers"})*1e3),v.id=h++;return f}function g(){r.scheme_name=this.value,ue.set(r)}const d=()=>document.getElementById("load_geojson").click();return n.$$set=f=>{"authorityName"in f&&t(4,i=f.authorityName)},n.$$.update=()=>{n.$$.dirty&17&&r&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(i,JSON.stringify(s())))},[r,l,u,a,i,g,d]}class Es extends oe{constructor(e){super(),le(this,e,Ss,ws,se,{authorityName:4})}}const Ms="/atip/accordion/assets/zoom_out_map-b2e1091a.svg";function Ps(n){let e,t,r,i,o;return{c(){e=T("button"),t=T("img"),eo(t.src,r=Ms)||A(t,"src",r),A(t,"alt","Zoom to show entire boundary"),A(e,"type","button"),A(e,"title","Zoom to show entire boundary"),A(e,"class","svelte-qzjsqo")},m(l,s){M(l,e,s),S(e,t),i||(o=X(e,"click",n[0]),i=!0)},p:re,i:re,o:re,d(l){l&&P(e),i=!1,o()}}}function xs(n,e,t){let r;he(n,Qe,l=>t(2,r=l));let{boundaryGeojson:i}=e;function o(){r.fitBounds(Jn(i),{padding:20,animate:!0,duration:500})}return n.$$set=l=>{"boundaryGeojson"in l&&t(1,i=l.boundaryGeojson)},[o,i]}class Ls extends oe{constructor(e){super(),le(this,e,xs,Ps,se,{boundaryGeojson:1})}}function Ts(n){let e,t,r,i,o,l,s;return{c(){e=T("div"),t=W(`Basemap:
  `),r=T("select"),i=T("option"),i.textContent="Streets",o=T("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,n[0]===void 0&&yi(()=>n[2].call(r)),A(e,"class","svelte-1tbnm6i")},m(u,a){M(u,e,a),S(e,t),S(e,r),S(r,i),S(r,o),ur(r,n[0]),l||(s=[X(r,"change",n[2]),X(r,"change",n[1])],l=!0)},p(u,[a]){a&1&&ur(r,u[0])},i:re,o:re,d(u){u&&P(e),l=!1,Ue(s)}}}function Cs(n,e,t){let{style:r}=e;function i(){let l=new URLSearchParams(window.location.search);l.set("style",r);let s=`${window.location.pathname}?${l.toString()}${window.location.hash}`;window.location.href=s}function o(){r=to(this),t(0,r)}return n.$$set=l=>{"style"in l&&t(0,r=l.style)},[r,i,o]}class Rs extends oe{constructor(e){super(),le(this,e,Cs,Ts,se,{style:0})}}const xe={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",hovering:"black",lineEndpointColor:"black"},hn=10,rn=10;function As(n){let e,t,r,i,o,l,s,u,a,c,g,d,f,h,v,k,C,m,p;return{c(){e=T("div"),t=T("h1"),t.textContent="Interventions",r=z(),i=T("ul"),o=T("li"),l=T("span"),s=W("Areas"),u=z(),a=T("li"),c=T("span"),g=W("Routes"),d=z(),f=T("li"),h=T("span"),v=W("Crossings"),k=z(),C=T("li"),m=T("span"),p=W("Other"),A(t,"class","svelte-p551i1"),A(l,"class","svelte-p551i1"),Ct(l,"background",xe.area),A(c,"class","svelte-p551i1"),Ct(c,"background",xe.route),A(h,"class","svelte-p551i1"),Ct(h,"background",xe.crossing),A(m,"class","svelte-p551i1"),Ct(m,"background",xe.other),A(e,"class","svelte-p551i1")},m(b,w){M(b,e,w),S(e,t),S(e,r),S(e,i),S(i,o),S(o,l),S(o,s),S(i,u),S(i,a),S(a,c),S(a,g),S(i,d),S(i,f),S(f,h),S(f,v),S(i,k),S(i,C),S(C,m),S(C,p)},p:re,i:re,o:re,d(b){b&&P(e)}}}class Os extends oe{constructor(e){super(),le(this,e,null,As,se,{})}}let gt="interventions";function Ns(n,e,t){let r,i;he(n,Qe,u=>t(0,r=u)),he(n,ue,u=>t(1,i=u)),Pt(r,gt,{type:"geojson",data:i});const o=["match",["get","intervention_type"],"area",xe.area,"route",xe.route,"crossing",xe.crossing,"other",xe.other,"white"],l=["!=","hide_while_editing",!0];return Te(r,{id:"interventions-points",source:gt,filter:["all",Vn,l,["!=","endpoint",!0]],...Dt(o,hn)}),Te(r,{id:"interventions-lines",source:gt,filter:["all",jn,l],...$t(o,rn)},"route-lines"),Te(r,{id:"interventions-lines-endpoints",source:gt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*rn,"circle-opacity":0,"circle-stroke-color":xe.lineEndpointColor,"circle-stroke-width":2}}),Te(r,{id:"interventions-polygons",source:gt,filter:["all",Wn,l],...Hn(o,.5)},"hover-polygons"),n.$$.update=()=>{if(n.$$.dirty&3){let u=JSON.parse(JSON.stringify(i)),a=[];for(let c of u.features)if(c.geometry.type=="LineString")for(let g of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])a.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:g}});u.features=u.features.concat(a),r.getSource(gt).setData(u)}},[r,i]}class Fs extends oe{constructor(e){super(),le(this,e,Ns,null,se,{})}}let vt="hover";function Is(n,e,t){let r,i;return he(n,Qe,o=>t(0,r=o)),he(n,ue,o=>t(1,i=o)),Pt(r,vt,{type:"geojson",data:et()}),Te(r,{id:"hover-polygons",source:vt,filter:Wn,...$t(xe.hovering,.5*rn,1)}),Te(r,{id:"hover-lines",source:vt,filter:jn,...$t(xe.hovering,1.5*rn,1)},"interventions-lines"),Te(r,{id:"hover-points",source:vt,filter:Vn,...Dt(xe.hovering,1.5*hn,1)},"interventions-points"),qe.subscribe(o=>{o!=null?r.getSource(vt).setData(i.features.find(l=>l.id==o)):r.getSource(vt).setData(et())}),[]}class Bs extends oe{constructor(e){super(),le(this,e,Is,null,se,{})}}const Ut="edit-point-mode";var Bt,Rn;class zs{constructor(e){ct(this,Bt);Ee(this,"map");Ee(this,"active");Ee(this,"eventListeners");Ee(this,"cursor");this.map=e,this.active=!1,this.eventListeners=[],this.cursor=null,e.on("mousemove",t=>{this.active&&(this.cursor=Gs(t.lngLat.toArray()),de(this,Bt,Rn).call(this))}),e.on("click",()=>{if(this.active&&this.cursor){for(let t of this.eventListeners)t(this.cursor);this.stop()}}),Pt(e,Ut,{type:"geojson",data:et()}),Te(e,{id:"edit-point-mode",source:Ut,...Dt(xe.hovering,hn,1)})}addEventListener(e){this.eventListeners.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Ut)}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,de(this,Bt,Rn).call(this)}}Bt=new WeakSet,Rn=function(){let e=et();this.cursor&&e.features.push(this.cursor),this.map.getSource(Ut).setData(e)};function Gs(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function Ri(n,e,t){if(t===void 0&&(t={}),t.final===!0)return qs(n,e);var r=st(n),i=st(e),o=Re(r[0]),l=Re(i[0]),s=Re(r[1]),u=Re(i[1]),a=Math.sin(l-o)*Math.cos(u),c=Math.cos(s)*Math.sin(u)-Math.sin(s)*Math.cos(u)*Math.cos(l-o);return Nt(Math.atan2(a,c))}function qs(n,e){var t=Ri(e,n);return t=(t+180)%360,t}function oi(n,e,t,r){r===void 0&&(r={});var i=st(n),o=Re(i[0]),l=Re(i[1]),s=Re(t),u=dn(e,r.units),a=Math.asin(Math.sin(l)*Math.cos(u)+Math.cos(l)*Math.sin(u)*Math.cos(s)),c=o+Math.atan2(Math.sin(s)*Math.sin(u)*Math.cos(l),Math.cos(u)-Math.sin(l)*Math.sin(a)),g=Nt(c),d=Nt(a);return we([g,d],r.properties)}function An(n){if(!n)throw new Error("geojson is required");var e=[];return mt(n,function(t){Ds(t,e)}),Ie(e)}function Ds(n,e){var t=[],r=n.geometry;if(r!==null){switch(r.type){case"Polygon":t=He(r);break;case"LineString":t=[He(r)]}t.forEach(function(i){var o=Ys(i,n.properties);o.forEach(function(l){l.id=e.length,e.push(l)})})}}function Ys(n,e){var t=[];return n.reduce(function(r,i){var o=ke([r,i],e);return o.bbox=Xs(r,i),t.push(o),i}),t}function Xs(n,e){var t=n[0],r=n[1],i=e[0],o=e[1],l=t<i?t:i,s=r<o?r:o,u=t>i?t:i,a=r>o?r:o;return[l,s,u,a]}var Mt={},Js={get exports(){return Mt},set exports(n){Mt=n}},On={},Us={get exports(){return On},set exports(n){On=n}};(function(n,e){(function(t,r){n.exports=r()})(no,function(){function t(m,p,b,w,_){(function O(x,F,q,E,B){for(;E>q;){if(E-q>600){var N=E-q+1,R=F-q+1,G=Math.log(N),J=.5*Math.exp(2*G/3),te=.5*Math.sqrt(G*J*(N-J)/N)*(R-N/2<0?-1:1),$=Math.max(q,Math.floor(F-R*J/N+te)),ee=Math.min(E,Math.floor(F+(N-R)*J/N+te));O(x,F,$,ee,B)}var ae=x[F],ie=q,y=E;for(r(x,q,F),B(x[E],ae)>0&&r(x,q,E);ie<y;){for(r(x,ie,y),ie++,y--;B(x[ie],ae)<0;)ie++;for(;B(x[y],ae)>0;)y--}B(x[q],ae)===0?r(x,q,y):r(x,++y,E),y<=F&&(q=y+1),F<=y&&(E=y-1)}})(m,p,b||0,w||m.length-1,_||i)}function r(m,p,b){var w=m[p];m[p]=m[b],m[b]=w}function i(m,p){return m<p?-1:m>p?1:0}var o=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function l(m,p,b){if(!b)return p.indexOf(m);for(var w=0;w<p.length;w++)if(b(m,p[w]))return w;return-1}function s(m,p){u(m,0,m.children.length,p,m)}function u(m,p,b,w,_){_||(_=k(null)),_.minX=1/0,_.minY=1/0,_.maxX=-1/0,_.maxY=-1/0;for(var O=p;O<b;O++){var x=m.children[O];a(_,m.leaf?w(x):x)}return _}function a(m,p){return m.minX=Math.min(m.minX,p.minX),m.minY=Math.min(m.minY,p.minY),m.maxX=Math.max(m.maxX,p.maxX),m.maxY=Math.max(m.maxY,p.maxY),m}function c(m,p){return m.minX-p.minX}function g(m,p){return m.minY-p.minY}function d(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function f(m){return m.maxX-m.minX+(m.maxY-m.minY)}function h(m,p){return m.minX<=p.minX&&m.minY<=p.minY&&p.maxX<=m.maxX&&p.maxY<=m.maxY}function v(m,p){return p.minX<=m.maxX&&p.minY<=m.maxY&&p.maxX>=m.minX&&p.maxY>=m.minY}function k(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function C(m,p,b,w,_){for(var O=[p,b];O.length;)if(!((b=O.pop())-(p=O.pop())<=w)){var x=p+Math.ceil((b-p)/w/2)*w;t(m,x,p,b,_),O.push(p,x,x,b)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(m){var p=this.data,b=[];if(!v(m,p))return b;for(var w=this.toBBox,_=[];p;){for(var O=0;O<p.children.length;O++){var x=p.children[O],F=p.leaf?w(x):x;v(m,F)&&(p.leaf?b.push(x):h(m,F)?this._all(x,b):_.push(x))}p=_.pop()}return b},o.prototype.collides=function(m){var p=this.data;if(!v(m,p))return!1;for(var b=[];p;){for(var w=0;w<p.children.length;w++){var _=p.children[w],O=p.leaf?this.toBBox(_):_;if(v(m,O)){if(p.leaf||h(m,O))return!0;b.push(_)}}p=b.pop()}return!1},o.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var p=0;p<m.length;p++)this.insert(m[p]);return this}var b=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===b.height)this._splitRoot(this.data,b);else{if(this.data.height<b.height){var w=this.data;this.data=b,b=w}this._insert(b,this.data.height-b.height-1,!0)}else this.data=b;return this},o.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},o.prototype.clear=function(){return this.data=k([]),this},o.prototype.remove=function(m,p){if(!m)return this;for(var b,w,_,O=this.data,x=this.toBBox(m),F=[],q=[];O||F.length;){if(O||(O=F.pop(),w=F[F.length-1],b=q.pop(),_=!0),O.leaf){var E=l(m,O.children,p);if(E!==-1)return O.children.splice(E,1),F.push(O),this._condense(F),this}_||O.leaf||!h(O,x)?w?(b++,O=w.children[b],_=!1):O=null:(F.push(O),q.push(b),b=0,w=O,O=O.children[0])}return this},o.prototype.toBBox=function(m){return m},o.prototype.compareMinX=function(m,p){return m.minX-p.minX},o.prototype.compareMinY=function(m,p){return m.minY-p.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(m){return this.data=m,this},o.prototype._all=function(m,p){for(var b=[];m;)m.leaf?p.push.apply(p,m.children):b.push.apply(b,m.children),m=b.pop();return p},o.prototype._build=function(m,p,b,w){var _,O=b-p+1,x=this._maxEntries;if(O<=x)return s(_=k(m.slice(p,b+1)),this.toBBox),_;w||(w=Math.ceil(Math.log(O)/Math.log(x)),x=Math.ceil(O/Math.pow(x,w-1))),(_=k([])).leaf=!1,_.height=w;var F=Math.ceil(O/x),q=F*Math.ceil(Math.sqrt(x));C(m,p,b,q,this.compareMinX);for(var E=p;E<=b;E+=q){var B=Math.min(E+q-1,b);C(m,E,B,F,this.compareMinY);for(var N=E;N<=B;N+=F){var R=Math.min(N+F-1,B);_.children.push(this._build(m,N,R,w-1))}}return s(_,this.toBBox),_},o.prototype._chooseSubtree=function(m,p,b,w){for(;w.push(p),!p.leaf&&w.length-1!==b;){for(var _=1/0,O=1/0,x=void 0,F=0;F<p.children.length;F++){var q=p.children[F],E=d(q),B=(N=m,R=q,(Math.max(R.maxX,N.maxX)-Math.min(R.minX,N.minX))*(Math.max(R.maxY,N.maxY)-Math.min(R.minY,N.minY))-E);B<O?(O=B,_=E<_?E:_,x=q):B===O&&E<_&&(_=E,x=q)}p=x||p.children[0]}var N,R;return p},o.prototype._insert=function(m,p,b){var w=b?m:this.toBBox(m),_=[],O=this._chooseSubtree(w,this.data,p,_);for(O.children.push(m),a(O,w);p>=0&&_[p].children.length>this._maxEntries;)this._split(_,p),p--;this._adjustParentBBoxes(w,_,p)},o.prototype._split=function(m,p){var b=m[p],w=b.children.length,_=this._minEntries;this._chooseSplitAxis(b,_,w);var O=this._chooseSplitIndex(b,_,w),x=k(b.children.splice(O,b.children.length-O));x.height=b.height,x.leaf=b.leaf,s(b,this.toBBox),s(x,this.toBBox),p?m[p-1].children.push(x):this._splitRoot(b,x)},o.prototype._splitRoot=function(m,p){this.data=k([m,p]),this.data.height=m.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(m,p,b){for(var w,_,O,x,F,q,E,B=1/0,N=1/0,R=p;R<=b-p;R++){var G=u(m,0,R,this.toBBox),J=u(m,R,b,this.toBBox),te=(_=G,O=J,x=void 0,F=void 0,q=void 0,E=void 0,x=Math.max(_.minX,O.minX),F=Math.max(_.minY,O.minY),q=Math.min(_.maxX,O.maxX),E=Math.min(_.maxY,O.maxY),Math.max(0,q-x)*Math.max(0,E-F)),$=d(G)+d(J);te<B?(B=te,w=R,N=$<N?$:N):te===B&&$<N&&(N=$,w=R)}return w||b-p},o.prototype._chooseSplitAxis=function(m,p,b){var w=m.leaf?this.compareMinX:c,_=m.leaf?this.compareMinY:g;this._allDistMargin(m,p,b,w)<this._allDistMargin(m,p,b,_)&&m.children.sort(w)},o.prototype._allDistMargin=function(m,p,b,w){m.children.sort(w);for(var _=this.toBBox,O=u(m,0,p,_),x=u(m,b-p,b,_),F=f(O)+f(x),q=p;q<b-p;q++){var E=m.children[q];a(O,m.leaf?_(E):E),F+=f(O)}for(var B=b-p-1;B>=p;B--){var N=m.children[B];a(x,m.leaf?_(N):N),F+=f(x)}return F},o.prototype._adjustParentBBoxes=function(m,p,b){for(var w=b;w>=0;w--)a(p[w],m)},o.prototype._condense=function(m){for(var p=m.length-1,b=void 0;p>=0;p--)m[p].children.length===0?p>0?(b=m[p-1].children).splice(b.indexOf(m[p]),1):this.clear():s(m[p],this.toBBox)},o})})(Us);const Ws=Un(xl),js=Un(ys);function on(n){var e=[1/0,1/0,-1/0,-1/0];return pt(n,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}on.default=on;const Vs=Object.freeze(Object.defineProperty({__proto__:null,default:on},Symbol.toStringTag,{value:"Module"})),Hs=Un(Vs);var We=On,Ai=Ws,Oi=js,bt=Hs.default,Zs=Oi.featureEach;Oi.coordEach;Ai.polygon;var li=Ai.featureCollection;function Ni(n){var e=new We(n);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:bt(t),We.prototype.insert.call(this,t)},e.load=function(t){var r=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:bt(i),r.push(i)}):Zs(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:bt(i),r.push(i)}),We.prototype.load.call(this,r)},e.remove=function(t,r){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:bt(t),We.prototype.remove.call(this,t,r)},e.clear=function(){return We.prototype.clear.call(this)},e.search=function(t){var r=We.prototype.search.call(this,this.toBBox(t));return li(r)},e.collides=function(t){return We.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=We.prototype.all.call(this);return li(t)},e.toJSON=function(){return We.prototype.toJSON.call(this)},e.fromJSON=function(t){return We.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var r;if(t.bbox)r=t.bbox;else if(Array.isArray(t)&&t.length===4)r=t;else if(Array.isArray(t)&&t.length===6)r=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")r=bt(t);else if(t.type==="FeatureCollection")r=bt(t);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},e}Js.exports=Ni;Mt.default=Ni;function Fi(n,e){var t={},r=[];if(n.type==="LineString"&&(n=Be(n)),e.type==="LineString"&&(e=Be(e)),n.type==="Feature"&&e.type==="Feature"&&n.geometry!==null&&e.geometry!==null&&n.geometry.type==="LineString"&&e.geometry.type==="LineString"&&n.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=si(n,e);return i&&r.push(i),Ie(r)}var o=Mt();return o.load(An(e)),Et(An(n),function(l){Et(o.search(l),function(s){var u=si(l,s);if(u){var a=He(u).join(",");t[a]||(t[a]=!0,r.push(u))}})}),Ie(r)}function si(n,e){var t=He(n),r=He(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],l=t[1][0],s=t[1][1],u=r[0][0],a=r[0][1],c=r[1][0],g=r[1][1],d=(g-a)*(l-i)-(c-u)*(s-o),f=(c-u)*(o-a)-(g-a)*(i-u),h=(l-i)*(o-a)-(s-o)*(i-u);if(d===0)return f===0&&h===0,null;var v=f/d,k=h/d;if(v>=0&&v<=1&&k>=0&&k<=1){var C=i+v*(l-i),m=o+v*(s-o);return we([C,m])}return null}function It(n,e,t){t===void 0&&(t={});var r=we([1/0,1/0],{dist:1/0}),i=0;return mt(n,function(o){for(var l=He(o),s=0;s<l.length-1;s++){var u=we(l[s]);u.properties.dist=it(e,u,t);var a=we(l[s+1]);a.properties.dist=it(e,a,t);var c=it(u,a,t),g=Math.max(u.properties.dist,a.properties.dist),d=Ri(u,a),f=oi(e,g,d+90,t),h=oi(e,g,d-90,t),v=Fi(ke([f.geometry.coordinates,h.geometry.coordinates]),ke([u.geometry.coordinates,a.geometry.coordinates])),k=null;v.features.length>0&&(k=v.features[0],k.properties.dist=it(e,k,t),k.properties.location=i+it(u,k,t)),u.properties.dist<r.properties.dist&&(r=u,r.properties.index=s,r.properties.location=i),a.properties.dist<r.properties.dist&&(r=a,r.properties.index=s+1,r.properties.location=i+c),k&&k.properties.dist<r.properties.dist&&(r=k,r.properties.index=s),i+=c}}),r}const _t="edit-polygon-mode";var Ke,dt,zt,Nn,Gt,Fn;class Qs{constructor(e){ct(this,Ke);ct(this,zt);ct(this,Gt);Ee(this,"map");Ee(this,"active");Ee(this,"eventListeners");Ee(this,"points");Ee(this,"cursor");Ee(this,"hoverPolyon");Ee(this,"hoverPoint");Ee(this,"dragging");Ee(this,"dragFrom");this.map=e,this.active=!1,this.eventListeners=[],this.points=[],this.cursor=null,this.hoverPolyon=!1,this.hoverPoint=null,this.dragging=!1,this.dragFrom=null,e.on("mousemove",t=>{if(this.active&&!this.dragging)de(this,zt,Nn).call(this,t);else if(this.active&&this.dragging){if(this.hoverPolyon){let r=this.dragFrom[0]-t.lngLat.lng,i=this.dragFrom[1]-t.lngLat.lat;for(let o of this.points)o[0]-=r,o[1]-=i}else this.points[this.hoverPoint]=t.lngLat.toArray();this.dragFrom=t.lngLat.toArray(),de(this,Ke,dt).call(this)}}),e.on("click",t=>{if(this.active&&this.cursor){let r=[];if(ui(this.points).forEach((i,o)=>{r.push([o+1,It(i,this.cursor).properties.dist])}),r.sort((i,o)=>i[1]-o[1]),r.length>0){let i=r[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hoverPoint=i}else this.points.push(this.cursor.geometry.coordinates),this.hoverPoint=this.points.length-1;de(this,Ke,dt).call(this)}else this.active&&this.hoverPoint!=null&&(this.points.splice(this.hoverPoint,1),this.hoverPoint=null,de(this,Ke,dt).call(this),de(this,zt,Nn).call(this,t))}),e.on("mousedown",t=>{this.active&&!this.dragging&&(this.hoverPolyon||this.hoverPoint!=null)&&(t.preventDefault(),this.cursor=null,this.dragging=!0,this.dragFrom=t.lngLat.toArray())}),e.on("mouseup",()=>{this.active&&this.dragging&&(this.dragging=!1,this.dragFrom=null)}),document.addEventListener("keypress",t=>{if(this.active&&t.key=="Enter"){t.preventDefault();let r=de(this,Gt,Fn).call(this);if(r)for(let i of this.eventListeners)i(r);this.stop()}}),Pt(e,_t,{type:"geojson",data:et()}),Te(e,{id:"edit-polygon-fill",source:_t,filter:Wn,...Hn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Te(e,{id:"edit-polygon-lines",source:_t,filter:jn,...$t("black",8,.5)}),Te(e,{id:"edit-polygon-vertices",source:_t,filter:Vn,...Dt(xe.hovering,hn,["case",["boolean",["get","hover"],"false"],1,.5])})}addEventListener(e){this.eventListeners.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(_t)}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=e.geometry.coordinates[0],this.points.pop(),de(this,Ke,dt).call(this)}stop(){this.points=[],this.cursor=null,this.active=!1,this.hoverPolyon=!1,this.hoverPoint=null,this.dragging=!1,this.dragFrom=null,de(this,Ke,dt).call(this)}}Ke=new WeakSet,dt=function(){let e=et();this.points.forEach((r,i)=>{let o=ai(r);o.properties.hover=this.hoverPoint==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(ui(this.points));let t=de(this,Gt,Fn).call(this);t&&(t.properties.hover=this.hoverPolyon,e.features.push(t)),this.map.getSource(_t).setData(e)},zt=new WeakSet,Nn=function(e){this.cursor=null,this.hoverPolyon=!1,this.hoverPoint=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hoverPolyon=!0;break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hoverPoint=t.properties.idx;break}!this.hoverPolyon&&this.hoverPoint==null&&(this.cursor=ai(e.lngLat.toArray())),de(this,Ke,dt).call(this)},Gt=new WeakSet,Fn=function(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}};function ai(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function ui(n){let e=[];for(let t=0;t<n.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[t],n[t+1]]}});return n.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[n.length-1],n[0]]}}),e}function fi(n){let e;return{c(){e=T("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function Ks(n){let e,t=n[0]==yt&&fi();return{c(){t&&t.c(),e=ft()},m(r,i){t&&t.m(r,i),M(r,e,i)},p(r,[i]){r[0]==yt?t||(t=fi(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:re,o:re,d(r){t&&t.d(r),r&&P(e)}}}const yt="edit-attribute";function Ii(){}function $s(n,e,t){let r,i,o;he(n,Qe,a=>t(4,r=a)),he(n,ue,a=>t(5,i=a)),he(n,Ce,a=>t(6,o=a));let{mode:l}=e,{changeMode:s}=e;function u(){Ce.set(null)}return r.on("mousemove",a=>{if(l==yt&&o==null){let g=r.queryRenderedFeatures(a.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});var c=null;g.length>0&&(c=g[0].id),qe.set(c)}}),r.on("mouseout",()=>{l==yt&&o==null&&qe.set(null)}),r.on("click",a=>{if(l==yt){let c=r.queryRenderedFeatures(a.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});c.length>0?Ce.set(c[0].id):(Ce.set(null),qe.set(null))}}),rl.subscribe(a=>{if(a){let c=i.features.find(g=>g.id==a);c.geometry.type=="Point"?r.flyTo({center:c.geometry.coordinates}):r.fitBounds(Jn(c),{padding:200,animate:!0,duration:500}),s(yt)}}),n.$$set=a=>{"mode"in a&&t(0,l=a.mode),"changeMode"in a&&t(1,s=a.changeMode)},[l,s,Ii,u]}class ea extends oe{constructor(e){super(),le(this,e,$s,Ks,se,{mode:0,changeMode:1,start:2,stop:3})}get start(){return Ii}get stop(){return this.$$.ctx[3]}}function ci(n){let e;return{c(){e=T("p"),e.textContent="Click an intervention to edit its geometry"},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function ta(n){let e,t=n[0]==nt&&ci();return{c(){t&&t.c(),e=ft()},m(r,i){t&&t.m(r,i),M(r,e,i)},p(r,[i]){r[0]==nt?t||(t=ci(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:re,o:re,d(r){t&&t.d(r),r&&P(e)}}}const nt="edit-geometry";function Bi(){}function na(n,e,t){let r;he(n,Qe,d=>t(8,r=d));let{mode:i}=e,{routeSnapper:o}=e,{snapTool:l}=e,{pointTool:s}=e,{polygonTool:u}=e;function a(){c&&(o.stop(),s.stop(),u.stop(),ue.update(d=>{let f=d.features.find(h=>h.id==c);return delete f.properties.hide_while_editing,d})),c=null,qe.set(null)}let c=null;r.on("mousemove",d=>{if(i==nt&&c==null){let h=r.queryRenderedFeatures(d.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});var f=null;h.length>0&&(f=h[0].id),qe.set(f)}}),r.on("mouseout",()=>{i==nt&&c==null&&qe.set(null)}),r.on("click",d=>{if(i==nt&&c==null){let f=r.queryRenderedFeatures(d.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});f.length>0&&g(f[0].id)}}),l.addEventListener("new-route",d=>{if(i==nt){const f=d.detail;ue.update(h=>{let v=h.features.find(k=>k.id==c);return v.properties.length_meters=f.properties.length_meters,v.properties.waypoints=f.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=f.geometry,h}),c=null}}),l.addEventListener("no-new-route",()=>{i==nt&&(ue.update(d=>{let f=d.features.find(h=>h.id==c);return delete f.properties.hide_while_editing,d}),c=null)});for(let d of[s,u])d.addEventListener(f=>{i==nt&&(ue.update(h=>{let v=h.features.find(k=>k.id==c);return v.geometry=f.geometry,delete v.properties.hide_while_editing,h}),c=null)});function g(d){qe.set(null);let f;ue.update(h=>(f=h.features.find(v=>v.id==d),f.properties.hide_while_editing=!0,h)),c=d,f.geometry.type=="LineString"?o.editExisting(f):f.geometry.type=="Polygon"?u.editExisting(f):f.geometry.type=="Point"&&s.start()}return n.$$set=d=>{"mode"in d&&t(0,i=d.mode),"routeSnapper"in d&&t(1,o=d.routeSnapper),"snapTool"in d&&t(2,l=d.snapTool),"pointTool"in d&&t(3,s=d.pointTool),"polygonTool"in d&&t(4,u=d.polygonTool)},[i,o,l,s,u,Bi,a]}class ra extends oe{constructor(e){super(),le(this,e,na,ta,se,{mode:0,routeSnapper:1,snapTool:2,pointTool:3,polygonTool:4,start:5,stop:6})}get start(){return Bi}get stop(){return this.$$.ctx[6]}}let j;const zi=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});zi.decode();let Ht=new Uint8Array;function At(){return Ht.byteLength===0&&(Ht=new Uint8Array(j.memory.buffer)),Ht}function wt(n,e){return zi.decode(At().subarray(n,n+e))}const $e=new Array(32).fill(void 0);$e.push(void 0,null,!0,!1);let Ot=$e.length;function ge(n){Ot===$e.length&&$e.push($e.length+1);const e=Ot;return Ot=$e[e],$e[e]=n,e}function K(n){return $e[n]}function ia(n){n<36||($e[n]=Ot,Ot=n)}function In(n){const e=K(n);return ia(n),e}function bn(n){return n==null}let Zt=new Float64Array;function oa(){return Zt.byteLength===0&&(Zt=new Float64Array(j.memory.buffer)),Zt}let Qt=new Int32Array;function ve(){return Qt.byteLength===0&&(Qt=new Int32Array(j.memory.buffer)),Qt}let lt=0;const Kt=new TextEncoder("utf-8"),la=typeof Kt.encodeInto=="function"?function(n,e){return Kt.encodeInto(n,e)}:function(n,e){const t=Kt.encode(n);return e.set(t),{read:n.length,written:t.length}};function Wt(n,e,t){if(t===void 0){const s=Kt.encode(n),u=e(s.length);return At().subarray(u,u+s.length).set(s),lt=s.length,u}let r=n.length,i=e(r);const o=At();let l=0;for(;l<r;l++){const s=n.charCodeAt(l);if(s>127)break;o[i+l]=s}if(l!==r){l!==0&&(n=n.slice(l)),i=t(i,r,r=l+n.length*3);const s=At().subarray(i+l,i+r),u=la(n,s);l+=u.written}return lt=l,i}function Bn(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){const i=n.length;let o="[";i>0&&(o+=Bn(n[0]));for(let l=1;l<i;l++)o+=", "+Bn(n[l]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function sa(n,e){const t=e(n.length*1);return At().set(n,t/1),lt=n.length,t}function _n(n,e){try{return n.apply(this,e)}catch(t){j.__wbindgen_exn_store(ge(t))}}class ln{static __wrap(e){const t=Object.create(ln.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();j.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=j.__wbindgen_add_to_stack_pointer(-16),l=sa(e,j.__wbindgen_malloc),s=lt;j.jsroutesnapper_new(o,l,s);var t=ve()[o/4+0],r=ve()[o/4+1],i=ve()[o/4+2];if(i)throw In(r);return ln.__wrap(t)}finally{j.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){j.jsroutesnapper_setConfig(this.ptr,ge(e))}toFinalFeature(){try{const r=j.__wbindgen_add_to_stack_pointer(-16);j.jsroutesnapper_toFinalFeature(r,this.ptr);var e=ve()[r/4+0],t=ve()[r/4+1];let i;return e!==0&&(i=wt(e,t).slice(),j.__wbindgen_free(e,t*1)),i}finally{j.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const r=j.__wbindgen_add_to_stack_pointer(-16);j.jsroutesnapper_renderGeojson(r,this.ptr);var e=ve()[r/4+0],t=ve()[r/4+1];return wt(e,t)}finally{j.__wbindgen_add_to_stack_pointer(16),j.__wbindgen_free(e,t)}}setSnapMode(e){j.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,r){return j.jsroutesnapper_onMouseMove(this.ptr,e,t,r)!==0}onClick(){j.jsroutesnapper_onClick(this.ptr)}onDragStart(){return j.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return j.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){j.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=j.__wbindgen_add_to_stack_pointer(-16);j.jsroutesnapper_editExisting(i,this.ptr,ge(e));var t=ve()[i/4+0],r=ve()[i/4+1];if(r)throw In(t)}finally{j.__wbindgen_add_to_stack_pointer(16)}}}async function aa(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function ua(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,t){const r=wt(e,t);return ge(r)},n.wbg.__wbindgen_object_drop_ref=function(e){In(e)},n.wbg.__wbindgen_boolean_get=function(e){const t=K(e);return typeof t=="boolean"?t?1:0:2},n.wbg.__wbindgen_error_new=function(e,t){const r=new Error(wt(e,t));return ge(r)},n.wbg.__wbindgen_is_object=function(e){const t=K(e);return typeof t=="object"&&t!==null},n.wbg.__wbindgen_is_undefined=function(e){return K(e)===void 0},n.wbg.__wbindgen_in=function(e,t){return K(e)in K(t)},n.wbg.__wbindgen_number_get=function(e,t){const r=K(t),i=typeof r=="number"?r:void 0;oa()[e/8+1]=bn(i)?0:i,ve()[e/4+0]=!bn(i)},n.wbg.__wbindgen_jsval_loose_eq=function(e,t){return K(e)==K(t)},n.wbg.__wbindgen_string_get=function(e,t){const r=K(t),i=typeof r=="string"?r:void 0;var o=bn(i)?0:Wt(i,j.__wbindgen_malloc,j.__wbindgen_realloc),l=lt;ve()[e/4+1]=l,ve()[e/4+0]=o},n.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const r=String(K(t)),i=Wt(r,j.__wbindgen_malloc,j.__wbindgen_realloc),o=lt;ve()[e/4+1]=o,ve()[e/4+0]=i},n.wbg.__wbindgen_object_clone_ref=function(e){const t=K(e);return ge(t)},n.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const r=K(e)[K(t)];return ge(r)},n.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(K(e))},n.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const r=K(e)[t>>>0];return ge(r)},n.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return K(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof K(e)=="function"},n.wbg.__wbg_next_579e583d33566a86=function(e){const t=K(e).next;return ge(t)},n.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return _n(function(e){const t=K(e).next();return ge(t)},arguments)},n.wbg.__wbg_done_1b73b0672e15f234=function(e){return K(e).done},n.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=K(e).value;return ge(t)},n.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ge(Symbol.iterator)},n.wbg.__wbg_get_765201544a2b6869=function(){return _n(function(e,t){const r=Reflect.get(K(e),K(t));return ge(r)},arguments)},n.wbg.__wbg_call_97ae9d8645dc388b=function(){return _n(function(e,t){const r=K(e).call(K(t));return ge(r)},arguments)},n.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(K(e))},n.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=K(e)instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=K(e).buffer;return ge(t)},n.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(K(e));return ge(t)},n.wbg.__wbg_set_83db9690f9353e79=function(e,t,r){K(e).set(K(t),r>>>0)},n.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return K(e).length},n.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=K(e)instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=K(t).stack,i=Wt(r,j.__wbindgen_malloc,j.__wbindgen_realloc),o=lt;ve()[e/4+1]=o,ve()[e/4+0]=i},n.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(wt(e,t))}finally{j.__wbindgen_free(e,t)}},n.wbg.__wbindgen_debug_string=function(e,t){const r=Bn(K(t)),i=Wt(r,j.__wbindgen_malloc,j.__wbindgen_realloc),o=lt;ve()[e/4+1]=o,ve()[e/4+0]=i},n.wbg.__wbindgen_throw=function(e,t){throw new Error(wt(e,t))},n.wbg.__wbindgen_memory=function(){const e=j.memory;return ge(e)},n}function fa(n,e){return j=n.exports,Gi.__wbindgen_wasm_module=e,Zt=new Float64Array,Qt=new Int32Array,Ht=new Uint8Array,j}async function Gi(n){typeof n>"u"&&(n="/atip/accordion/assets/route_snapper_bg.wasm");const e=ua();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await aa(await n,e);return fa(t,r)}var qt,zn,Ve,tt;class ca{constructor(e,t,r){ct(this,qt);ct(this,Ve);this.controlDiv=r,this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new ln(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),console.log("JsRouteSnapper ready, waiting for idle event"),this.active=!1,this.loaded=!1,this.map.once("idle",()=>{console.log("JsRouteSnapper now usable"),this.map.addSource("route-snapper",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"route-points",type:"circle",source:"route-snapper",paint:{"circle-radius":["match",["get","type"],"unimportant",10/2,10],"circle-color":["match",["get","type"],"hovered","green","important","red","black"]},filter:["in","$type","Point"]}),this.map.addLayer({id:"route-lines",type:"line",source:"route-snapper",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":2.5},filter:["in","$type","LineString"]}),this.loaded=!0,this.map.on("mousemove",l=>{if(!this.active)return;const s={x:l.point.x-30,y:l.point.y},u=this.map.unproject(l.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(l.lngLat.lng,l.lngLat.lat,u)&&de(this,Ve,tt).call(this)}),this.map.on("click",()=>{this.active&&(this.inner.onClick(),de(this,Ve,tt).call(this))}),this.map.on("dragstart",l=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}),this.map.on("mouseup",l=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}),document.addEventListener("keypress",l=>{this.active&&l.key=="Enter"&&(l.preventDefault(),de(this,qt,zn).call(this))}),document.addEventListener("keydown",l=>{this.active&&l.key=="Shift"&&(l.preventDefault(),this.inner.setSnapMode(!1),de(this,Ve,tt).call(this))}),document.addEventListener("keyup",l=>{this.active&&l.key=="Shift"&&(l.preventDefault(),this.inner.setSnapMode(!0),de(this,Ve,tt).call(this))}),this.stop()})}isActive(){return this.active}tearDown(){this.loaded&&(this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeSource("route-snapper"))}editExisting(e){if(!this.loaded){console.error("editExisting called before the map idle event received. Not starting tool.");return}e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.start(),this.inner.editExisting(e.properties.waypoints),de(this,Ve,tt).call(this)}stop(){if(!this.loaded)return;this.active=!1,this.inner.clearState(),de(this,Ve,tt).call(this),this.controlDiv.innerHTML="";let e=document.createElement("button");e.innerText="Route tool",e.type="button",e.onclick=()=>{this.controlDiv.dispatchEvent(new CustomEvent("activate")),this.start()},this.controlDiv.appendChild(e)}start(){if(this.active)return;this.active=!0;let e=document.createElement("button");e.type="button",e.innerText="Finish route",e.onclick=()=>{de(this,qt,zn).call(this)};let t=document.createElement("button");t.type="button",t.innerText="Cancel",t.onclick=()=>{this.controlDiv.dispatchEvent(new CustomEvent("no-new-route")),this.stop()},this.controlDiv.innerHTML="";let r=document.createElement("div");r.style="display: flex; justify-content: space-evenly;",r.appendChild(e),r.appendChild(t),this.controlDiv.appendChild(r);let i=document.createElement("input");i.type="checkbox",i.id="avoidDoublingBack",i.onclick=()=>{this.inner.setConfig({avoid_doubling_back:i.checked}),de(this,Ve,tt).call(this)};let o=document.createElement("label");o.innerText="Avoid doubling back",o.for=i.id;let l=document.createElement("div");l.appendChild(i),l.appendChild(o),this.controlDiv.append(l);const s=document.createElement("ul");s.innerHTML="<li><b>Click</b> green points on the transport network</br>to create snapped routes</li><li>Hold <b>Shift</b> to draw a point anywhere</li><li><b>Click and drag</b> any point to move it</li><li><b>Click</b> a red waypoint to delete it</li><li>Press <b>Enter</b> to finish route</li>",this.controlDiv.appendChild(s)}}qt=new WeakSet,zn=function(){const e=this.inner.toFinalFeature();e?this.controlDiv.dispatchEvent(new CustomEvent("new-route",{detail:JSON.parse(e)})):this.controlDiv.dispatchEvent(new CustomEvent("no-new-route")),this.stop()},Ve=new WeakSet,tt=function(){this.loaded&&this.map.getSource("route-snapper").setData(JSON.parse(this.inner.renderGeojson()))};async function da(n,e){const t=await fetch(n),r=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,l=[];for(;;){const{done:a,value:c}=await r.read();if(a)break;l.push(c),o+=c.length;const g=100*o/i;e.style=`background: linear-gradient(to right, red ${g}%, transparent 0);`}let s=new Uint8Array(o),u=0;for(let a of l)s.set(a,u),u+=a.length;return s}function ha(n){let e,t;return{c(){e=T("div"),t=T("div"),t.textContent="Route tool loading..."},m(r,i){M(r,e,i),S(e,t),n[8](t),n[9](e)},p:re,i:re,o:re,d(r){r&&P(e),n[8](null),n[9](null)}}}const yn="route";function pa(n,e,t){let r;he(n,Qe,h=>t(10,r=h));let{mode:i}=e,{changeMode:o}=e,{url:l}=e,{snapTool:s}=e,u,{routeSnapper:a}=e;function c(){a.isActive()||a.start()}function g(){a==null||a.stop()}un(async()=>{await Gi(),console.log(`Grabbing ${l}`);try{const h=await da(l,u);t(2,a=new ca(r,h,s))}catch(h){console.log(`Route tool broke: ${h}`),t(0,s.innerHTML="Failed to load",s)}s.addEventListener("activate",()=>{o(yn)}),s.addEventListener("no-new-route",()=>{i==yn&&o("edit-attribute")}),s.addEventListener("new-route",h=>{if(i==yn){const v=h.detail;ue.update(k=>(v.id=fn(k),v.properties.intervention_type="route",k.features.push(v),k)),o("edit-attribute"),Ce.set(v.id)}})}),Xn(()=>{a==null||a.tearDown()});function d(h){fe[h?"unshift":"push"](()=>{u=h,t(1,u)})}function f(h){fe[h?"unshift":"push"](()=>{s=h,t(0,s)})}return n.$$set=h=>{"mode"in h&&t(3,i=h.mode),"changeMode"in h&&t(4,o=h.changeMode),"url"in h&&t(5,l=h.url),"snapTool"in h&&t(0,s=h.snapTool),"routeSnapper"in h&&t(2,a=h.routeSnapper)},[s,u,a,i,o,l,c,g,d,f]}class ma extends oe{constructor(e){super(),le(this,e,pa,ha,se,{mode:3,changeMode:4,url:5,snapTool:0,routeSnapper:2,start:6,stop:7})}get start(){return this.$$.ctx[6]}get stop(){return this.$$.ctx[7]}}function di(n){let e;return{c(){e=T("p"),e.textContent="Click to add a new point"},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function ga(n){let e,t=n[0]==Gn&&di();return{c(){t&&t.c(),e=ft()},m(r,i){t&&t.m(r,i),M(r,e,i)},p(r,[i]){r[0]==Gn?t||(t=di(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:re,o:re,d(r){t&&t.d(r),r&&P(e)}}}const Gn="point";function va(n,e,t){let{mode:r}=e,{changeMode:i}=e,{pointTool:o}=e;function l(){o.start()}function s(){o.stop()}return o.addEventListener(u=>{r==Gn&&(ue.update(a=>(u.id=fn(a),u.properties.intervention_type="other",a.features.push(u),a)),i("edit-attribute"),Ce.set(u.id))}),n.$$set=u=>{"mode"in u&&t(0,r=u.mode),"changeMode"in u&&t(1,i=u.changeMode),"pointTool"in u&&t(2,o=u.pointTool)},[r,i,o,l,s]}class ba extends oe{constructor(e){super(),le(this,e,va,ga,se,{mode:0,changeMode:1,pointTool:2,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function hi(n){let e;return{c(){e=T("p"),e.innerHTML="Click the map to add a vertex, or click a vertex to delete it. Press <strong>Enter</strong> to finish. Drag a vertex or the polygon to move."},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function _a(n){let e,t=n[0]==qn&&hi();return{c(){t&&t.c(),e=ft()},m(r,i){t&&t.m(r,i),M(r,e,i)},p(r,[i]){r[0]==qn?t||(t=hi(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:re,o:re,d(r){t&&t.d(r),r&&P(e)}}}const qn="polygon";function ya(n,e,t){let{mode:r}=e,{changeMode:i}=e,{polygonTool:o}=e;function l(){o.startNew()}function s(){o.stop()}return o.addEventListener(u=>{r==qn&&(ue.update(a=>(u.id=fn(a),u.properties.intervention_type="area",a.features.push(u),a)),i("edit-attribute"),Ce.set(u.id))}),n.$$set=u=>{"mode"in u&&t(0,r=u.mode),"changeMode"in u&&t(1,i=u.changeMode),"polygonTool"in u&&t(2,o=u.polygonTool)},[r,i,o,l,s]}class wa extends oe{constructor(e){super(),le(this,e,ya,_a,se,{mode:0,changeMode:1,polygonTool:2,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ka(n){var e=n[0],t=n[1],r=n[2],i=n[3],o=it(n.slice(0,2),[r,t]),l=it(n.slice(0,2),[e,i]);if(o>=l){var s=(t+i)/2;return[e,s-(r-e)/2,r,s+(r-e)/2]}else{var u=(e+r)/2;return[u-(i-t)/2,t,u+(i-t)/2,i]}}function Sa(n,e){e===void 0&&(e={});var t=e.precision,r=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,r=r==null||isNaN(r)?3:r,!n)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof r!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(n=JSON.parse(JSON.stringify(n)));var o=Math.pow(10,t);return pt(n,function(l){Ea(l,o,r)}),n}function Ea(n,e,t){n.length>t&&n.splice(t,n.length);for(var r=0;r<n.length;r++)n[r]=Math.round(n[r]*e)/e;return n}function Ma(n,e){if(!n)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Cn(n),r=Cn(e);if(t!=="LineString")throw new Error("line must be LineString");if(r==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(r==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Sa(e,{precision:7});switch(r){case"Point":return Dn(n,i);case"MultiPoint":return pi(n,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return pi(n,Fi(n,i))}}function pi(n,e){var t=[],r=Mt();return mt(e,function(i){if(t.forEach(function(s,u){s.id=u}),!t.length)t=Dn(n,i).features,t.forEach(function(s){s.bbox||(s.bbox=ka(on(s)))}),r.load(Ie(t));else{var o=r.search(i);if(o.features.length){var l=qi(i,o);t=t.filter(function(s){return s.id!==l.id}),r.remove(l),Et(Dn(l,i),function(s){t.push(s),r.insert(s)})}}}),Ie(t)}function Dn(n,e){var t=[],r=He(n)[0],i=He(n)[n.geometry.coordinates.length-1];if(wn(r,st(e))||wn(i,st(e)))return Ie([n]);var o=Mt(),l=An(n);o.load(l);var s=o.search(e);if(!s.features.length)return Ie([n]);var u=qi(e,s),a=[r],c=xi(l,function(g,d,f){var h=He(d)[1],v=st(e);return f===u.id?(g.push(v),t.push(ke(g)),wn(v,h)?[v]:[v,h]):(g.push(h),g)},a);return c.length>1&&t.push(ke(c)),Ie(t)}function qi(n,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,r=1/0;return Et(e,function(i){var o=It(i,n),l=o.properties.dist;l<r&&(t=i,r=l)}),t}function wn(n,e){return n[0]===e[0]&&n[1]===e[1]}function Pa(n,e,t){var r=He(t);if(Cn(t)!=="LineString")throw new Error("line must be a LineString");var i=It(t,n),o=It(t,e),l;i.properties.index<=o.properties.index?l=[i,o]:l=[o,i];for(var s=[l[0].geometry.coordinates],u=l[0].properties.index+1;u<l[1].properties.index+1;u++)s.push(r[u]);return s.push(l[1].geometry.coordinates),ke(s,t.properties)}function mi(n){let e;return{c(){e=T("p"),e.textContent="Click near a route to split it, or click on the map to cancel"},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function xa(n){let e,t=n[0]==sn&&mi();return{c(){t&&t.c(),e=ft()},m(r,i){t&&t.m(r,i),M(r,e,i)},p(r,[i]){r[0]==sn?t||(t=mi(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:re,o:re,d(r){t&&t.d(r),r&&P(e)}}}const sn="split-route",La=10,Ta=30;let kn="split-route";function Di(){}function gi(n,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:n}}}function Ca(n,e,t){let r,i;he(n,Qe,d=>t(5,r=d)),he(n,ue,d=>t(7,i=d));let{mode:o}=e,{changeMode:l}=e;function s(){t(4,u=null),a=null}let u=null,a=null;r.on("mousemove",d=>{if(o!=sn)return;t(4,u=gi(d.lngLat.toArray(),!1)),a=null;const f=[d.point.x-Ta,d.point.y],h=r.unproject(d.point).distanceTo(r.unproject(f))/1e3;let v=[];for(let[k,C]of i.features.entries())if(C.geometry.type=="LineString"){let m=It(C.geometry,u,{units:"kilometers"});m.properties.dist<=h&&v.push([k,m.geometry.coordinates,m.properties.dist])}v.sort((k,C)=>k[2]-C[2]),v.length>0&&(t(4,u=gi(v[0][1],!0)),a=v[0][0])}),r.on("click",()=>{if(o==sn)if(a==null)l("edit-attribute");else{let d=Ma(i.features[a],u);if(d.features.length==2){let f=d.features[0],h=d.features[1];ue.update(v=>(f.id=v.features[a].id,h.id=fn(v),f.properties=JSON.parse(JSON.stringify(v.features[a].properties)),h.properties=JSON.parse(JSON.stringify(f.properties)),c(v.features[a],f,h,u),v.features.splice(a,1,f,h),v))}s()}}),Pt(r,kn,{type:"geojson",data:et()}),Te(r,{id:"draw-split-route",source:kn,...Dt("black",La,["case",["==",["get","snapped"],!0],1,.5])});function c(d,f,h,v){f.properties.length_meters=Vt(f,{units:"kilometers"})*1e3,h.properties.length_meters=Vt(h,{units:"kilometers"})*1e3,f.properties.waypoints=[],h.properties.waypoints=[];let k=g(d,v),C=!0,m=0;for(let p of d.properties.waypoints){let b=g(d,we([p.lon,p.lat]));if(C)if(b<k)f.properties.waypoints.push(p);else{let w=p.snapped&&d.properties.waypoints[m-1].snapped;f.properties.waypoints.push({lon:v.geometry.coordinates[0],lat:v.geometry.coordinates[1],snapped:w}),C=!1,h.properties.waypoints.push({lon:v.geometry.coordinates[0],lat:v.geometry.coordinates[1],snapped:w}),h.properties.waypoints.push(p)}else h.properties.waypoints.push(p);m++}}function g(d,f){let h=d.geometry.coordinates[0],v=Pa(h,f,d);return Vt(v,{units:"kilometers"})*1e3}return n.$$set=d=>{"mode"in d&&t(0,o=d.mode),"changeMode"in d&&t(1,l=d.changeMode)},n.$$.update=()=>{if(n.$$.dirty&48){let d=et();u&&d.features.push(u),r.getSource(kn).setData(d)}},[o,l,Di,s,u,r]}class Ra extends oe{constructor(e){super(),le(this,e,Ca,xa,se,{mode:0,changeMode:1,start:2,stop:3})}get start(){return Di}get stop(){return this.$$.ctx[3]}}function vi(n){let e,t,r={mode:n[3],routeSnapper:n[1],snapTool:n[2],pointTool:n[10],polygonTool:n[11]};return e=new ra({props:r}),n[16](e),{c(){V(e.$$.fragment)},m(i,o){H(e,i,o),t=!0},p(i,o){const l={};o&8&&(l.mode=i[3]),o&2&&(l.routeSnapper=i[1]),o&4&&(l.snapTool=i[2]),e.$set(l)},i(i){t||(I(e.$$.fragment,i),t=!0)},o(i){D(e.$$.fragment,i),t=!1},d(i){n[16](null),Z(e,i)}}}function Aa(n){let e,t,r,i,o,l,s,u,a,c,g,d,f,h,v,k,C,m,p,b,w,_,O,x,F,q,E,B,N,R,G,J,te,$,ee,ae,ie,y,U,Ge,xt,Yt,pn={mode:n[3],changeMode:n[12]};s=new ea({props:pn}),n[14](s);let me=n[1]&&n[2]&&vi(n),Y={mode:n[3],changeMode:n[12],pointTool:n[10]};b=new ba({props:Y}),n[18](b);let Yi={mode:n[3],changeMode:n[12],polygonTool:n[11]};E=new wa({props:Yi}),n[20](E);function Xi(Q){n[22](Q)}function Ji(Q){n[23](Q)}let mn={mode:n[3],changeMode:n[12],url:n[0]};n[1]!==void 0&&(mn.routeSnapper=n[1]),n[2]!==void 0&&(mn.snapTool=n[2]),R=new ma({props:mn}),n[21](R),fe.push(()=>Ye(R,"routeSnapper",Xi,n[1])),fe.push(()=>Ye(R,"snapTool",Ji,n[2]));let Ui={mode:n[3],changeMode:n[12]};return U=new Ra({props:Ui}),n[25](U),{c(){e=T("div"),t=T("div"),r=T("button"),i=W("Edit attributes"),l=z(),V(s.$$.fragment),u=z(),a=T("div"),c=T("button"),g=W("Edit geometry"),f=z(),me&&me.c(),h=z(),v=T("div"),k=T("button"),C=W("New point"),p=z(),V(b.$$.fragment),w=z(),_=T("div"),O=T("button"),x=W("New polygon"),q=z(),V(E.$$.fragment),B=z(),N=T("div"),V(R.$$.fragment),te=z(),$=T("div"),ee=T("button"),ae=W("Split route"),y=z(),V(U.$$.fragment),A(r,"type","button"),r.disabled=o=n[3]=="edit-attribute",A(r,"class","svelte-cej5os"),A(c,"type","button"),c.disabled=d=n[3]=="edit-geometry",A(c,"class","svelte-cej5os"),A(k,"type","button"),k.disabled=m=n[3]=="point",A(k,"class","svelte-cej5os"),A(O,"type","button"),O.disabled=F=n[3]=="polygon",A(O,"class","svelte-cej5os"),A(ee,"type","button"),ee.disabled=ie=n[3]=="split-route",A(ee,"class","svelte-cej5os"),A(e,"class","toolbox svelte-cej5os")},m(Q,be){M(Q,e,be),S(e,t),S(t,r),S(r,i),S(t,l),H(s,t,null),S(e,u),S(e,a),S(a,c),S(c,g),S(a,f),me&&me.m(a,null),S(e,h),S(e,v),S(v,k),S(k,C),S(v,p),H(b,v,null),S(e,w),S(e,_),S(_,O),S(O,x),S(_,q),H(E,_,null),S(e,B),S(e,N),H(R,N,null),S(e,te),S(e,$),S($,ee),S(ee,ae),S($,y),H(U,$,null),Ge=!0,xt||(Yt=[X(r,"click",n[13]),X(c,"click",n[15]),X(k,"click",n[17]),X(O,"click",n[19]),X(ee,"click",n[24])],xt=!0)},p(Q,[be]){(!Ge||be&8&&o!==(o=Q[3]=="edit-attribute"))&&(r.disabled=o);const nr={};be&8&&(nr.mode=Q[3]),s.$set(nr),(!Ge||be&8&&d!==(d=Q[3]=="edit-geometry"))&&(c.disabled=d),Q[1]&&Q[2]?me?(me.p(Q,be),be&6&&I(me,1)):(me=vi(Q),me.c(),I(me,1),me.m(a,null)):me&&(Me(),D(me,1,1,()=>{me=null}),Pe()),(!Ge||be&8&&m!==(m=Q[3]=="point"))&&(k.disabled=m);const rr={};be&8&&(rr.mode=Q[3]),b.$set(rr),(!Ge||be&8&&F!==(F=Q[3]=="polygon"))&&(O.disabled=F);const ir={};be&8&&(ir.mode=Q[3]),E.$set(ir);const Lt={};be&8&&(Lt.mode=Q[3]),be&1&&(Lt.url=Q[0]),!G&&be&2&&(G=!0,Lt.routeSnapper=Q[1],Xe(()=>G=!1)),!J&&be&4&&(J=!0,Lt.snapTool=Q[2],Xe(()=>J=!1)),R.$set(Lt),(!Ge||be&8&&ie!==(ie=Q[3]=="split-route"))&&(ee.disabled=ie);const or={};be&8&&(or.mode=Q[3]),U.$set(or)},i(Q){Ge||(I(s.$$.fragment,Q),I(me),I(b.$$.fragment,Q),I(E.$$.fragment,Q),I(R.$$.fragment,Q),I(U.$$.fragment,Q),Ge=!0)},o(Q){D(s.$$.fragment,Q),D(me),D(b.$$.fragment,Q),D(E.$$.fragment,Q),D(R.$$.fragment,Q),D(U.$$.fragment,Q),Ge=!1},d(Q){Q&&P(e),n[14](null),Z(s),me&&me.d(),n[18](null),Z(b),n[20](null),Z(E),n[21](null),Z(R),n[25](null),Z(U),xt=!1,Ue(Yt)}}}function Oa(n,e,t){let r;he(n,Qe,R=>t(26,r=R));let{routeUrl:i}=e,o,l,s=new zs(r),u=new Qs(r),a="edit-attribute",c,g,d,f,h,v;function k(R){let G={"edit-attribute":c,"edit-geometry":g,route:d,point:f,polygon:h,"split-route":v};if(a==R){console.log(`Mode is already ${a}, not changing`);return}console.log(`Stopping old mode ${a}`),G[a].stop(),t(3,a=R),console.log(`Starting new mode ${a}`),G[a].start()}Xn(()=>{s==null||s.tearDown(),u==null||u.tearDown()});const C=()=>k("edit-attribute");function m(R){fe[R?"unshift":"push"](()=>{c=R,t(4,c)})}const p=()=>k("edit-geometry");function b(R){fe[R?"unshift":"push"](()=>{g=R,t(5,g)})}const w=()=>k("point");function _(R){fe[R?"unshift":"push"](()=>{f=R,t(7,f)})}const O=()=>k("polygon");function x(R){fe[R?"unshift":"push"](()=>{h=R,t(8,h)})}function F(R){fe[R?"unshift":"push"](()=>{d=R,t(6,d)})}function q(R){o=R,t(1,o)}function E(R){l=R,t(2,l)}const B=()=>k("split-route");function N(R){fe[R?"unshift":"push"](()=>{v=R,t(9,v)})}return n.$$set=R=>{"routeUrl"in R&&t(0,i=R.routeUrl)},[i,o,l,a,c,g,d,f,h,v,s,u,k,C,m,p,b,w,_,O,x,F,q,E,B,N]}class Na extends oe{constructor(e){super(),le(this,e,Oa,Aa,se,{routeUrl:0})}}function Fa(n){let e,t,r,i,o,l,s,u;return{c(){e=T("div"),t=T("button"),t.textContent="Home",r=z(),i=T("button"),i.textContent="About",o=z(),l=T("button"),l.textContent="Instructions",A(t,"type","button"),A(i,"type","button"),A(l,"type","button"),A(e,"slot","nav")},m(a,c){M(a,e,c),S(e,t),S(e,r),S(e,i),S(e,o),S(e,l),s||(u=[X(t,"click",n[8]),X(i,"click",n[6]),X(l,"click",n[7])],s=!0)},p:re,d(a){a&&P(e),s=!1,Ue(u)}}}function Ia(n){let e,t,r,i,o,l,s,u,a,c,g,d;return o=new Ls({props:{boundaryGeojson:n[3]}}),s=new Es({props:{authorityName:n[4]}}),g=new cs({}),{c(){e=T("div"),t=T("h1"),r=W(n[4]),i=z(),V(o.$$.fragment),l=z(),V(s.$$.fragment),u=z(),a=T("br"),c=z(),V(g.$$.fragment),A(e,"slot","sidebar")},m(f,h){M(f,e,h),S(e,t),S(t,r),S(t,i),H(o,t,null),S(e,l),H(s,e,null),S(e,u),S(e,a),S(e,c),H(g,e,null),d=!0},p(f,h){const v={};h&8&&(v.boundaryGeojson=f[3]),o.$set(v)},i(f){d||(I(o.$$.fragment,f),I(s.$$.fragment,f),I(g.$$.fragment,f),d=!0)},o(f){D(o.$$.fragment,f),D(s.$$.fragment,f),D(g.$$.fragment,f),d=!1},d(f){f&&P(e),Z(o),Z(s),Z(g)}}}function Ba(n){let e,t,r,i,o,l,s,u,a,c,g,d;return e=new es({props:{boundaryGeojson:n[3]}}),r=new Fs({}),o=new Bs({}),s=new Na({props:{routeUrl:n[2]}}),a=new Rs({props:{style:n[5]}}),g=new Os({}),{c(){V(e.$$.fragment),t=z(),V(r.$$.fragment),i=z(),V(o.$$.fragment),l=z(),V(s.$$.fragment),u=z(),V(a.$$.fragment),c=z(),V(g.$$.fragment)},m(f,h){H(e,f,h),M(f,t,h),H(r,f,h),M(f,i,h),H(o,f,h),M(f,l,h),H(s,f,h),M(f,u,h),H(a,f,h),M(f,c,h),H(g,f,h),d=!0},p(f,h){const v={};h&8&&(v.boundaryGeojson=f[3]),e.$set(v);const k={};h&4&&(k.routeUrl=f[2]),s.$set(k)},i(f){d||(I(e.$$.fragment,f),I(r.$$.fragment,f),I(o.$$.fragment,f),I(s.$$.fragment,f),I(a.$$.fragment,f),I(g.$$.fragment,f),d=!0)},o(f){D(e.$$.fragment,f),D(r.$$.fragment,f),D(o.$$.fragment,f),D(s.$$.fragment,f),D(a.$$.fragment,f),D(g.$$.fragment,f),d=!1},d(f){Z(e,f),f&&P(t),Z(r,f),f&&P(i),Z(o,f),f&&P(l),Z(s,f),f&&P(u),Z(a,f),f&&P(c),Z(g,f)}}}function za(n){let e,t,r;return t=new sl({props:{style:n[5],$$slots:{default:[Ba]},$$scope:{ctx:n}}}),{c(){e=T("div"),V(t.$$.fragment),A(e,"slot","main")},m(i,o){M(i,e,o),H(t,e,null),r=!0},p(i,o){const l={};o&16396&&(l.$$scope={dirty:o,ctx:i}),t.$set(l)},i(i){r||(I(t.$$.fragment,i),r=!0)},o(i){D(t.$$.fragment,i),r=!1},d(i){i&&P(e),Z(t)}}}function Ga(n){let e,t,r,i,o,l,s,u;e=new hl({props:{$$slots:{main:[za],sidebar:[Ia],nav:[Fa]},$$scope:{ctx:n}}});function a(f){n[9](f)}let c={};n[0]!==void 0&&(c.open=n[0]),r=new ro({props:c}),fe.push(()=>Ye(r,"open",a,n[0]));function g(f){n[10](f)}let d={};return n[1]!==void 0&&(d.open=n[1]),l=new tl({props:d}),fe.push(()=>Ye(l,"open",g,n[1])),{c(){V(e.$$.fragment),t=z(),V(r.$$.fragment),o=z(),V(l.$$.fragment)},m(f,h){H(e,f,h),M(f,t,h),H(r,f,h),M(f,o,h),H(l,f,h),u=!0},p(f,[h]){const v={};h&16396&&(v.$$scope={dirty:h,ctx:f}),e.$set(v);const k={};!i&&h&1&&(i=!0,k.open=f[0],Xe(()=>i=!1)),r.$set(k);const C={};!s&&h&2&&(s=!0,C.open=f[1],Xe(()=>s=!1)),l.$set(C)},i(f){u||(I(e.$$.fragment,f),I(r.$$.fragment,f),I(l.$$.fragment,f),u=!0)},o(f){D(e.$$.fragment,f),D(r.$$.fragment,f),D(l.$$.fragment,f),u=!1},d(f){Z(e,f),f&&P(t),Z(r,f),f&&P(o),Z(l,f)}}}function qa(n,e,t){let r=!1,i=!1,o=window.location.hostname.includes("atip.uk");const l=new URLSearchParams(window.location.search);let s=l.get("authority"),u=l.get("style")||"streets";var a=`https://atip.uk/route-snappers/${s}.bin`;o||(a=`https://atip.uk/route-snappers-dev/${s}.bin`);function c(){t(0,r=!r),t(1,i=!1)}function g(){t(1,i=!i),t(0,r=!1)}let d;un(async()=>{t(3,d=await f())});async function f(){const m=await(await fetch(io)).text(),p=JSON.parse(m);return p.features=p.features.filter(b=>b.properties.name==s),p}const h=()=>window.open("index.html");function v(C){r=C,t(0,r)}function k(C){i=C,t(1,i)}return[r,i,a,d,s,u,c,g,h,v,k]}class Da extends oe{constructor(e){super(),le(this,e,qa,Ga,se,{})}}new Da({target:document.getElementById("app")});
