var hi=Object.defineProperty;var di=(r,e,t)=>e in r?hi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var se=(r,e,t)=>(di(r,typeof e!="symbol"?e+"":e,t),t);import{S as ie,i as oe,s as re,M as mi,b as Se,a as ut,d as Z,m as Q,k as at,n as F,o as B,q as ee,e as w,c as x,g as y,x as K,p as b,y as Je,f as T,z as Ie,B as Be,C as gi,D as zn,E as kn,F as Wt,G as Dt,H as $t,I as Gt,J as jt,K as Vn,h as k,l as q,L as _i,N as vi,O as he,P as yi,w as Yn,Q as dt,R as Ee,T as gn,t as H,U as ce,j as Ne,r as We,V as Hn,W as ht,X as Fe,Y as Wr,Z as Vt,_ as Mt,$ as Zn,a0 as De,a1 as Qn,a2 as er,a3 as bi,a4 as wi,a5 as qe,a6 as ki,a7 as Si,a8 as Ei,a9 as _n,aa as At,ab as vn,ac as Xt,ad as yn,ae as Cn,af as Mi,ag as Ct,ah as Xn,ai as ft,aj as Rt,ak as xi,al as Un,am as Li,an as Ci,ao as Ri,ap as tr,aq as ln,ar as Ti,as as Ai,at as Pi,A as Oi,u as Fi}from"./authorities-40429f45.js";function Ni(r){let e,t,n,i,o,s,u,l,a,h,v,c,f;return{c(){e=w("p"),e.textContent="For each intervention:",t=x(),n=w("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=x(),o=w("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=x(),u=w("p"),u.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=x(),a=w("p"),a.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,h=x(),v=w("p"),v.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=x(),f=w("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(d,_){y(d,e,_),y(d,t,_),y(d,n,_),y(d,i,_),y(d,o,_),y(d,s,_),y(d,u,_),y(d,l,_),y(d,a,_),y(d,h,_),y(d,v,_),y(d,c,_),y(d,f,_)},p:K,d(d){d&&b(e),d&&b(t),d&&b(n),d&&b(i),d&&b(o),d&&b(s),d&&b(u),d&&b(l),d&&b(a),d&&b(h),d&&b(v),d&&b(c),d&&b(f)}}}function Ii(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Ni]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new mi({props:o}),Se.push(()=>ut(e,"open",i,r[0])),{c(){Z(e.$$.fragment)},m(s,u){Q(e,s,u),n=!0},p(s,[u]){const l={};u&4&&(l.$$scope={dirty:u,ctx:s}),!t&&u&1&&(t=!0,l.open=s[0],at(()=>t=!1)),e.$set(l)},i(s){n||(F(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){ee(e,s)}}}function Bi(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Di extends ie{constructor(e){super(),oe(this,e,Bi,Ii,re,{open:0})}}const bt=[];function Pt(r,e=K){let t;const n=new Set;function i(u){if(re(r,u)&&(r=u,t)){const l=!bt.length;for(const a of n)a[1](),bt.push(a,r);if(l){for(let a=0;a<bt.length;a+=2)bt[a][0](bt[a+1]);bt.length=0}}}function o(u){i(u(r))}function s(u,l=K){const a=[u,l];return n.add(a),n.size===1&&(t=e(i)||K),u(r),()=>{n.delete(a),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ke=Pt(null),ue=Pt(Je()),Ce=Pt(null),et=Pt(null),un=Pt(null),Rn=Pt(null);function Kt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Jn(r){ue.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Ce.set(null),et.set(null),un.set(null)}function nr(r){let e;const t=r[4].default,n=Dt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&$t(n,t,i,i[3],e?jt(t,i[3],o,null):Gt(i[3]),null)},i(i){e||(F(n,i),e=!0)},o(i){B(n,i),e=!1},d(i){n&&n.d(i)}}}function $i(r){let e,t,n=r[1]&&nr(r);return{c(){e=w("div"),n&&n.c(),T(e,"class","map svelte-12dpf1u")},m(i,o){y(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&F(n,1)):(n=nr(i),n.c(),F(n,1),n.m(e,null)):n&&(Ie(),B(n,1,1,()=>{n=null}),Be())},i(i){t||(F(n),t=!0)},o(i){B(n),t=!1},d(i){i&&b(e),n&&n.d(),r[5](null)}}}function Gi(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,u,l=!1;gi("setCamera",!window.location.hash),zn(()=>{s=new kn.Map({container:u,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new kn.ScaleControl({})),s.addControl(new kn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ke.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(u)}),Wt(()=>{s.remove()});function a(h){Se[h?"unshift":"push"](()=>{u=h,t(0,u)})}return r.$$set=h=>{"style"in h&&t(2,o=h.style),"$$scope"in h&&t(3,i=h.$$scope)},[u,l,o,i,n,a]}class ji extends ie{constructor(e){super(),oe(this,e,Gi,$i,re,{style:2})}}const qi=r=>({}),rr=r=>({}),zi=r=>({}),ir=r=>({}),Yi=r=>({}),or=r=>({});function Hi(r){let e,t,n,i,o,s,u,l,a,h,v,c;const f=r[3].nav,d=Dt(f,r,r[2],or),_=r[3].sidebar,g=Dt(_,r,r[2],ir),E=r[3].main,p=Dt(E,r,r[2],rr);return{c(){e=w("aside"),t=w("div"),n=w("nav"),d&&d.c(),i=x(),g&&g.c(),o=x(),s=w("button"),s.textContent="â†’",l=x(),a=w("main"),p&&p.c(),T(n,"class","svelte-1u7vg8a"),T(t,"class","sidebar-content content-container svelte-1u7vg8a"),T(s,"type","button"),T(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),T(e,"class",u=Vn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),T(a,"class","svelte-1u7vg8a")},m(m,S){y(m,e,S),k(e,t),k(t,n),d&&d.m(n,null),k(t,i),g&&g.m(t,null),k(e,o),k(e,s),y(m,l,S),y(m,a,S),p&&p.m(a,null),h=!0,v||(c=q(s,"click",r[1]),v=!0)},p(m,[S]){d&&d.p&&(!h||S&4)&&$t(d,f,m,m[2],h?jt(f,m[2],S,Yi):Gt(m[2]),or),g&&g.p&&(!h||S&4)&&$t(g,_,m,m[2],h?jt(_,m[2],S,zi):Gt(m[2]),ir),(!h||S&1&&u!==(u=Vn(m[0]?"":"collapsed")+" svelte-1u7vg8a"))&&T(e,"class",u),p&&p.p&&(!h||S&4)&&$t(p,E,m,m[2],h?jt(E,m[2],S,qi):Gt(m[2]),rr)},i(m){h||(F(d,m),F(g,m),F(p,m),h=!0)},o(m){B(d,m),B(g,m),B(p,m),h=!1},d(m){m&&b(e),d&&d.d(m),g&&g.d(m),m&&b(l),m&&b(a),p&&p.d(m),v=!1,c()}}}function Xi(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=u=>{"$$scope"in u&&t(2,i=u.$$scope)},[o,s,i,n]}class Ui extends ie{constructor(e){super(),oe(this,e,Xi,Hi,re,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Ji(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(h){return l([a,h])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(h){a=[6,h],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var pt=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Wi(r,e){return r>e?1:r<e?-1:0}function it(r,e,t){for(var n=new pt(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Sn(r,e,t,n){var i=new pt(r,e);if(t===null)return i.left=i.right=null,i;t=it(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function sr(r,e,t){var n=null,i=null;if(e){e=it(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Ki(r,e,t){return e===null?r:(r===null||(e=it(r.key,e,t),e.left=r),e)}function Tn(r,e,t,n,i){if(r){n(""+e+(t?"â””â”€â”€ ":"â”œâ”€â”€ ")+i(r)+`
`);var o=e+(t?"    ":"â”‚   ");r.left&&Tn(r.left,o,!1,n,i),r.right&&Tn(r.right,o,!0,n,i)}}var Wn=function(){function r(e){e===void 0&&(e=Wi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Sn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new pt(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=it(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=it(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=it(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=it(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=it(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,u=this._root,l;o.length!==0||u;)if(u)o.push(u),u=u.left;else{if(u=o.pop(),l=s(u.key,t),l>0)break;if(s(u.key,e)>=0&&n.call(i,u))return this;u=u.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Zi(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&On(e,t,0,i-1,o),this._root===null)this._root=An(e,t,0,i),this._size=i;else{var s=Qi(this.toList(),Vi(e,t),o);i=this._size+i,this._root=Pn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Tn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=sr(e,this._root,i),s=o.left,u=o.right;i(e,t)<0?u=Sn(t,n,u,i):s=Sn(t,n,s,i),this._root=Ki(s,u,i)},r.prototype.split=function(e){return sr(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Ji(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function An(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],u=e[o],l=new pt(s,u);return l.left=An(r,e,t,o),l.right=An(r,e,o+1,n),l}return null}function Vi(r,e){for(var t=new pt(null,null),n=t,i=0;i<r.length;i++)n=n.next=new pt(r[i],e[i]);return n.next=null,t.next}function Zi(r){for(var e=r,t=[],n=!1,i=new pt(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Pn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Pn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Pn(r,i+1,t),s}return null}function Qi(r,e,t){for(var n=new pt(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function On(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,u=n+1;;){do s++;while(i(r[s],o)<0);do u--;while(i(r[u],o)>0);if(s>=u)break;var l=r[s];r[s]=r[u],r[u]=l,l=e[s],e[s]=e[u],e[u]=l}On(r,e,t,u,i),On(r,e,u+1,n,i)}}function $e(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function lr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Re(r,e,t){return e&&lr(r.prototype,e),t&&lr(r,t),r}var It=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Fn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},st=Number.EPSILON;st===void 0&&(st=Math.pow(2,-52));var eo=st*st,Nn=function(e,t){if(-st<e&&e<st&&-st<t&&t<st)return 0;var n=e-t;return n*n<eo*e*t?0:e<t?-1:1},to=function(){function r(){$e(this,r),this.reset()}return Re(r,[{key:"reset",value:function(){this.xRounder=new ur,this.yRounder=new ur}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),ur=function(){function r(){$e(this,r),this.tree=new Wn,this.round(0)}return Re(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Nn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Nn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Ut=new to,qt=function(e,t){return e.x*t.y-e.y*t.x},Kr=function(e,t){return e.x*t.x+e.y*t.y},ar=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=qt(i,o);return Nn(s,0)},an=function(e){return Math.sqrt(Kr(e,e))},no=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return qt(o,i)/an(o)/an(i)},ro=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Kr(o,i)/an(o)/an(i)},fr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},cr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},io=function(e,t,n,i){if(t.x===0)return cr(n,i,e.x);if(i.x===0)return cr(e,t,n.x);if(t.y===0)return fr(n,i,e.y);if(i.y===0)return fr(e,t,n.y);var o=qt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},u=qt(s,t)/o,l=qt(s,i)/o,a=e.x+l*t.x,h=n.x+u*i.x,v=e.y+l*t.y,c=n.y+u*i.y,f=(a+h)/2,d=(v+c)/2;return{x:f,y:d}},Xe=function(){Re(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:fn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){$e(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Re(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(u){var l=u.otherSE;i.set(u,{sine:no(n.point,t.point,l.point),cosine:ro(n.point,t.point,l.point)})};return function(s,u){i.has(s)||o(s),i.has(u)||o(u);var l=i.get(s),a=l.sine,h=l.cosine,v=i.get(u),c=v.sine,f=v.cosine;return a>=0&&c>=0?h<f?1:h>f?-1:0:a<0&&c<0?h<f?-1:h>f?1:0:c<a?-1:c>a?1:0}}}]),r}(),oo=0,fn=function(){Re(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,u=n.rightSE.point.x;if(u<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,a=n.leftSE.point.y,h=t.rightSE.point.y,v=n.rightSE.point.y;if(i<o){if(a<l&&a<h)return 1;if(a>l&&a>h)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<a&&l<v)return-1;if(l>a&&l>v)return 1;var d=n.comparePoint(t.leftSE.point);if(d!==0)return d;var _=t.comparePoint(n.rightSE.point);return _<0?1:_>0?-1:1}if(l<a)return-1;if(l>a)return 1;if(s<u){var g=n.comparePoint(t.rightSE.point);if(g!==0)return g}if(s>u){var E=t.comparePoint(n.rightSE.point);if(E<0)return 1;if(E>0)return-1}if(s!==u){var p=h-l,m=s-i,S=v-a,C=u-o;if(p>m&&S<C)return 1;if(p<m&&S>C)return-1}return s>u?1:s<u||h<v?-1:h>v?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){$e(this,r),this.id=++oo,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Re(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,u=n.x+s*o.x;if(t.x===u)return 0;var l=(t.x-n.x)/o.x,a=n.y+l*o.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Fn(n,i);if(o===null)return null;var s=this.leftSE.point,u=this.rightSE.point,l=t.leftSE.point,a=t.rightSE.point,h=It(n,l)&&this.comparePoint(l)===0,v=It(i,s)&&t.comparePoint(s)===0,c=It(n,a)&&this.comparePoint(a)===0,f=It(i,u)&&t.comparePoint(u)===0;if(v&&h)return f&&!c?u:!f&&c?a:null;if(v)return c&&s.x===a.x&&s.y===a.y?null:s;if(h)return f&&u.x===l.x&&u.y===l.y?null:l;if(f&&c)return null;if(f)return u;if(c)return a;var d=io(s,this.vector(),l,t.vector());return d===null||!It(o,d)?null:Ut.round(d.x,d.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Xe(t,!0),s=new Xe(t,!1),u=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,u,this.rings.slice(),this.windings.slice());return Xe.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Xe.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var u=n;n=i,i=u}for(var l=0,a=i.rings.length;l<a;l++){var h=i.rings[l],v=i.windings[l],c=n.rings.indexOf(h);c===-1?(n.rings.push(h),n.windings.push(v)):n.windings[c]+=v}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,u=this.rings.length;s<u;s++){var l=this.rings[s],a=this.windings[s],h=n.indexOf(l);h===-1?(n.push(l),i.push(a)):i[h]+=a}for(var v=[],c=[],f=0,d=n.length;f<d;f++)if(i[f]!==0){var _=n[f],g=_.poly;if(c.indexOf(g)===-1)if(_.isExterior)v.push(g);else{c.indexOf(g)===-1&&c.push(g);var E=v.indexOf(_.poly);E!==-1&&v.splice(E,1)}}for(var p=0,m=v.length;p<m;p++){var S=v[p].multiPoly;o.indexOf(S)===-1&&o.push(S)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(ze.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,u;t.length<n.length?(s=t.length,u=n.length):(s=n.length,u=t.length),this._isInResult=u===ze.numMultiPolys&&s<u;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var a=function(v){return v.length===1&&v[0].isSubject};this._isInResult=a(t)!==a(n);break}default:throw new Error("Unrecognized operation type found ".concat(ze.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,u,l=Xe.comparePoints(t,n);if(l<0)o=t,s=n,u=1;else if(l>0)o=n,s=t,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var a=new Xe(o,!0),h=new Xe(s,!1);return new r(a,h,[i],[u])}}]),r}(),pr=function(){function r(e,t,n){if($e(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Ut.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,u=e.length;s<u;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Ut.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(fn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(fn.fromRing(o,i,this))}return Re(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),so=function(){function r(e,t){if($e(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new pr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new pr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Re(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),hr=function(){function r(e,t){if($e(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new so(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Re(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),lo=function(){Re(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var u=null,l=s.leftSE,a=s.rightSE,h=[l],v=l.point,c=[];u=l,l=a,h.push(l),l.point!==v;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var d=h[0].point,_=h[h.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(_.x,", ").concat(_.y,"]."))}if(f.length===1){a=f[0].otherSE;break}for(var g=null,E=0,p=c.length;E<p;E++)if(c[E].point===l.point){g=E;break}if(g!==null){var m=c.splice(g)[0],S=h.splice(m.index);S.unshift(S[0].otherSE),n.push(new r(S.reverse()));continue}c.push({index:h.length,point:l.point});var C=l.getLeftmostComparator(u);a=f.sort(C)[0].otherSE;break}n.push(new r(h))}}return n}}]);function r(e){$e(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Re(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,u=this.events[i+1].point;ar(s,t,u)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],a=n[1];ar(l,t,a)===0&&n.shift(),n.push(n[0]);for(var h=this.isExteriorRing()?1:-1,v=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],d=v;d!=c;d+=h)f.push([n[d].x,n[d].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Xe.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),u=s?s.prevInResult():null;;){if(!s)return null;if(!u)return s.ringOut;if(u.ringOut!==s.ringOut)return u.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=u.prevInResult(),u=s?s.prevInResult():null}}}]),r}(),dr=function(){function r(e){$e(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Re(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),uo=function(){function r(e){$e(this,r),this.rings=e,this.polys=this._composePolys(e)}return Re(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new dr(s));else{var u=s.enclosingRing();u.poly||n.push(new dr(u)),u.poly.addInterior(s)}}return n}}]),r}(),ao=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fn.compare;$e(this,r),this.queue=e,this.tree=new Wn(t),this.segments=[]}return Re(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,u=o,l=void 0,a=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;a===void 0;)u=this.tree.next(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);if(t.isLeft){var h=null;if(l){var v=l.getIntersection(n);if(v!==null&&(n.isAnEndpoint(v)||(h=v),!l.isAnEndpoint(v)))for(var c=this._splitSafely(l,v),f=0,d=c.length;f<d;f++)i.push(c[f])}var _=null;if(a){var g=a.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(_=g),!a.isAnEndpoint(g)))for(var E=this._splitSafely(a,g),p=0,m=E.length;p<m;p++)i.push(E[p])}if(h!==null||_!==null){var S=null;if(h===null)S=_;else if(_===null)S=h;else{var C=Xe.comparePoints(h,_);S=C<=0?h:_}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var A=n.split(S),R=0,L=A.length;R<L;R++)i.push(A[R])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&a){var I=l.getIntersection(a);if(I!==null){if(!l.isAnEndpoint(I))for(var $=this._splitSafely(l,I),D=0,X=$.length;D<X;D++)i.push($[D]);if(!a.isAnEndpoint(I))for(var O=this._splitSafely(a,I),z=0,te=O.length;z<te;z++)i.push(O[z])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),mr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,fo=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,co=function(){function r(){$e(this,r)}return Re(r,[{key:"run",value:function(t,n,i){ze.type=t,Ut.reset();for(var o=[new hr(n,!0)],s=0,u=i.length;s<u;s++)o.push(new hr(i[s],!1));if(ze.numMultiPolys=o.length,ze.type==="difference")for(var l=o[0],a=1;a<o.length;)Fn(o[a].bbox,l.bbox)!==null?a++:o.splice(a,1);if(ze.type==="intersection"){for(var h=0,v=o.length;h<v;h++)for(var c=o[h],f=h+1,d=o.length;f<d;f++)if(Fn(c.bbox,o[f].bbox)===null)return[]}for(var _=new Wn(Xe.compare),g=0,E=o.length;g<E;g++)for(var p=o[g].getSweepEvents(),m=0,S=p.length;m<S;m++)if(_.insert(p[m]),_.size>mr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var C=new ao(_),A=_.size,R=_.pop();R;){var L=R.key;if(_.size===A){var I=L.segment;throw new Error("Unable to pop() ".concat(L.isLeft?"left":"right"," SweepEvent ")+"[".concat(L.point.x,", ").concat(L.point.y,"] from segment #").concat(I.id," ")+"[".concat(I.leftSE.point.x,", ").concat(I.leftSE.point.y,"] -> ")+"[".concat(I.rightSE.point.x,", ").concat(I.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(_.size>mr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(C.segments.length>fo)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var $=C.process(L),D=0,X=$.length;D<X;D++){var O=$[D];O.consumedBy===void 0&&_.insert(O)}A=_.size,R=_.pop()}Ut.reset();var z=lo.factory(C.segments),te=new uo(z);return te.getGeom()}}]),r}(),ze=new co,po=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ze.run("union",e,n)},ho=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ze.run("intersection",e,n)},mo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ze.run("xor",e,n)},go=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ze.run("difference",e,n)},en={union:po,intersection:ho,xor:mo,difference:go};function _o(r,e){var t=yo(e),n=null;return r.type==="FeatureCollection"?n=vo(r):n=Vr(en.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function vo(r){var e=r.features.length===2?en.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):en.union.apply(en,r.features.map(function(t){return t.geometry.coordinates}));return Vr(e)}function Vr(r){return _i(r)}function yo(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return vi(t)}function bo(r,e,t){let n;he(r,Ke,s=>t(1,n=s));let{boundaryGeojson:i}=e;return yi("setCamera")&&n.fitBounds(Yn(i),{padding:20,animate:!1}),dt(n,"boundary",{type:"geojson",data:_o(i)}),Ee(n,{id:"boundary",source:"boundary",...gn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class wo extends ie{constructor(e){super(),oe(this,e,bo,null,re,{boundaryGeojson:0})}}function gr(r){let e,t=_r(r[4])+"",n,i,o,s,u;return{c(){e=H("Length: "),n=H(t),i=x(),o=w("br"),s=x(),u=w("br")},m(l,a){y(l,e,a),y(l,n,a),y(l,i,a),y(l,o,a),y(l,s,a),y(l,u,a)},p(l,a){a&16&&t!==(t=_r(l[4])+"")&&Hn(n,t)},d(l){l&&b(e),l&&b(n),l&&b(i),l&&b(o),l&&b(s),l&&b(u)}}}function ko(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_,g,E,p,m,S,C,A,R,L,I,$,D,X,O,z,te,de,G,le,_e,Me,ge,pe,ve,xe,ye,Le,Ge,ae,fe,Ve,Ye,V=r[4]&&gr(r);return{c(){e=w("label"),t=H("Name:"),n=w("br"),i=x(),o=w("input"),s=x(),u=w("br"),l=x(),a=w("br"),h=x(),v=w("label"),c=w("input"),f=H(`
  Area`),d=x(),_=w("label"),g=w("input"),E=H(`
  Route`),p=x(),m=w("label"),S=w("input"),C=H(`
  Crossing`),A=x(),R=w("label"),L=w("input"),I=H(`
  Other`),$=x(),D=w("br"),X=x(),O=w("br"),z=x(),te=w("label"),de=H("Description:"),G=w("br"),le=x(),_e=w("textarea"),Me=x(),ge=w("br"),pe=x(),ve=w("br"),xe=x(),V&&V.c(),ye=x(),Le=w("div"),Ge=w("button"),Ge.textContent="Delete",ae=x(),fe=w("button"),fe.textContent="Save",T(o,"type","text"),ce(o,"width","100%"),T(c,"type","radio"),c.__value="area",c.value=c.__value,r[7][0].push(c),T(g,"type","radio"),g.__value="route",g.value=g.__value,r[7][0].push(g),T(S,"type","radio"),S.__value="crossing",S.value=S.__value,r[7][0].push(S),T(L,"type","radio"),L.__value="other",L.value=L.__value,r[7][0].push(L),ce(_e,"width","100%"),T(_e,"rows","5"),T(_e,"class","svelte-15lna0i"),T(Ge,"type","button"),T(fe,"type","button"),ce(Le,"display","flex"),ce(Le,"justify-content","space-between")},m(P,U){y(P,e,U),k(e,t),k(e,n),k(e,i),k(e,o),Ne(o,r[0]),y(P,s,U),y(P,u,U),y(P,l,U),y(P,a,U),y(P,h,U),y(P,v,U),k(v,c),c.checked=c.__value===r[1],k(v,f),y(P,d,U),y(P,_,U),k(_,g),g.checked=g.__value===r[1],k(_,E),y(P,p,U),y(P,m,U),k(m,S),S.checked=S.__value===r[1],k(m,C),y(P,A,U),y(P,R,U),k(R,L),L.checked=L.__value===r[1],k(R,I),y(P,$,U),y(P,D,U),y(P,X,U),y(P,O,U),y(P,z,U),y(P,te,U),k(te,de),k(te,G),k(te,le),k(te,_e),Ne(_e,r[2]),y(P,Me,U),y(P,ge,U),y(P,pe,U),y(P,ve,U),y(P,xe,U),V&&V.m(P,U),y(P,ye,U),y(P,Le,U),k(Le,Ge),k(Le,ae),k(Le,fe),Ve||(Ye=[q(o,"input",r[5]),q(c,"change",r[6]),q(g,"change",r[8]),q(S,"change",r[9]),q(L,"change",r[10]),q(_e,"input",r[11]),q(Ge,"click",r[12]),q(fe,"click",r[13])],Ve=!0)},p(P,[U]){U&1&&o.value!==P[0]&&Ne(o,P[0]),U&2&&(c.checked=c.__value===P[1]),U&2&&(g.checked=g.__value===P[1]),U&2&&(S.checked=S.__value===P[1]),U&2&&(L.checked=L.__value===P[1]),U&4&&Ne(_e,P[2]),P[4]?V?V.p(P,U):(V=gr(P),V.c(),V.m(ye.parentNode,ye)):V&&(V.d(1),V=null)},i:K,o:K,d(P){P&&b(e),P&&b(s),P&&b(u),P&&b(l),P&&b(a),P&&b(h),P&&b(v),r[7][0].splice(r[7][0].indexOf(c),1),P&&b(d),P&&b(_),r[7][0].splice(r[7][0].indexOf(g),1),P&&b(p),P&&b(m),r[7][0].splice(r[7][0].indexOf(S),1),P&&b(A),P&&b(R),r[7][0].splice(r[7][0].indexOf(L),1),P&&b($),P&&b(D),P&&b(X),P&&b(O),P&&b(z),P&&b(te),P&&b(Me),P&&b(ge),P&&b(pe),P&&b(ve),P&&b(xe),V&&V.d(P),P&&b(ye),P&&b(Le),Ve=!1,We(Ye)}}}function _r(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function So(r,e,t){let{id:n}=e,{name:i}=e,{intervention_type:o}=e,{description:s}=e,{length_meters:u}=e;const l=[[]];function a(){i=this.value,t(0,i)}function h(){o=this.__value,t(1,o)}function v(){o=this.__value,t(1,o)}function c(){o=this.__value,t(1,o)}function f(){o=this.__value,t(1,o)}function d(){s=this.value,t(2,s)}const _=()=>Jn(n),g=()=>Ce.set(null);return r.$$set=E=>{"id"in E&&t(3,n=E.id),"name"in E&&t(0,i=E.name),"intervention_type"in E&&t(1,o=E.intervention_type),"description"in E&&t(2,s=E.description),"length_meters"in E&&t(4,u=E.length_meters)},[i,o,s,n,u,a,h,l,v,c,f,d,_,g]}class Eo extends ie{constructor(e){super(),oe(this,e,So,ko,re,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}function vr(r,e,t){const n=r.slice();return n[15]=e[t],n}function yr(r,e,t){const n=r.slice();return n[15]=e[t],n}function br(r,e,t){const n=r.slice();return n[15]=e[t],n}function wr(r,e,t){const n=r.slice();return n[15]=e[t],n}function kr(r){let e,t=r[15]+"",n;return{c(){e=w("option"),n=H(t),e.__value=r[15],e.value=e.__value},m(i,o){y(i,e,o),k(e,n)},p:K,d(i){i&&b(e)}}}function Sr(r){let e,t=r[15]+"",n;return{c(){e=w("option"),n=H(t),e.__value=r[15],e.value=e.__value},m(i,o){y(i,e,o),k(e,n)},p:K,d(i){i&&b(e)}}}function Er(r){let e,t=r[15]+"",n;return{c(){e=w("option"),n=H(t),e.__value=r[15],e.value=e.__value},m(i,o){y(i,e,o),k(e,n)},p:K,d(i){i&&b(e)}}}function Mr(r){let e,t=r[15]+"",n;return{c(){e=w("option"),n=H(t),e.__value=r[15],e.value=e.__value},m(i,o){y(i,e,o),k(e,n)},p:K,d(i){i&&b(e)}}}function Mo(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_,g,E,p,m,S,C,A,R,L,I,$,D,X,O,z,te,de,G,le,_e,Me,ge,pe,ve,xe,ye,Le,Ge,ae,fe,Ve,Ye,V,P,U,mt,be,Ot,Y,ne,tt,Ft,nt,rt,Nt,gt=r[2],Te=[];for(let M=0;M<gt.length;M+=1)Te[M]=kr(wr(r,gt,M));let _t=r[3],Ae=[];for(let M=0;M<_t.length;M+=1)Ae[M]=Sr(br(r,_t,M));let vt=r[4],Pe=[];for(let M=0;M<vt.length;M+=1)Pe[M]=Er(yr(r,vt,M));let yt=r[5],Oe=[];for(let M=0;M<yt.length;M+=1)Oe[M]=Mr(vr(r,yt,M));return{c(){e=w("label"),t=H("Name:"),n=w("br"),i=x(),o=w("input"),s=x(),u=w("br"),l=x(),a=w("br"),h=x(),v=w("label"),c=H(`Reference type:
  `),f=w("select");for(let M=0;M<Te.length;M+=1)Te[M].c();d=x(),_=w("br"),g=x(),E=w("br"),p=x(),m=w("label"),S=H("Notes:"),C=w("br"),A=x(),R=w("textarea"),L=x(),I=w("br"),$=x(),D=w("br"),X=x(),O=w("label"),z=H(`Size:
  `),te=w("input"),de=x(),G=w("select");for(let M=0;M<Ae.length;M+=1)Ae[M].c();le=x(),_e=w("br"),Me=x(),ge=w("br"),pe=x(),ve=w("label"),xe=H(`ATE Triage:
  `),ye=w("select");for(let M=0;M<Pe.length;M+=1)Pe[M].c();Le=x(),Ge=w("br"),ae=x(),fe=w("br"),Ve=x(),Ye=w("label"),V=H(`ATE Recommendation:
  `),P=w("select");for(let M=0;M<Oe.length;M+=1)Oe[M].c();U=x(),mt=w("br"),be=x(),Ot=w("br"),Y=x(),ne=w("div"),tt=w("button"),tt.textContent="Delete",Ft=x(),nt=w("button"),nt.textContent="Save",T(o,"type","text"),ce(o,"width","100%"),r[0].planning.reference_type===void 0&&ht(()=>r[7].call(f)),ce(R,"width","100%"),T(R,"rows","5"),T(R,"class","svelte-15lna0i"),T(te,"type","number"),T(te,"min","0"),T(te,"max","1000"),r[0].planning.size_units===void 0&&ht(()=>r[10].call(G)),r[0].planning.triage===void 0&&ht(()=>r[11].call(ye)),r[0].planning.recommendation===void 0&&ht(()=>r[12].call(P)),T(tt,"type","button"),T(nt,"type","button"),ce(ne,"display","flex"),ce(ne,"justify-content","space-between")},m(M,j){y(M,e,j),k(e,t),k(e,n),k(e,i),k(e,o),Ne(o,r[0].planning.name),y(M,s,j),y(M,u,j),y(M,l,j),y(M,a,j),y(M,h,j),y(M,v,j),k(v,c),k(v,f);for(let N=0;N<Te.length;N+=1)Te[N].m(f,null);Fe(f,r[0].planning.reference_type),y(M,d,j),y(M,_,j),y(M,g,j),y(M,E,j),y(M,p,j),y(M,m,j),k(m,S),k(m,C),k(m,A),k(m,R),Ne(R,r[0].planning.notes),y(M,L,j),y(M,I,j),y(M,$,j),y(M,D,j),y(M,X,j),y(M,O,j),k(O,z),k(O,te),Ne(te,r[0].planning.size),k(O,de),k(O,G);for(let N=0;N<Ae.length;N+=1)Ae[N].m(G,null);Fe(G,r[0].planning.size_units),y(M,le,j),y(M,_e,j),y(M,Me,j),y(M,ge,j),y(M,pe,j),y(M,ve,j),k(ve,xe),k(ve,ye);for(let N=0;N<Pe.length;N+=1)Pe[N].m(ye,null);Fe(ye,r[0].planning.triage),y(M,Le,j),y(M,Ge,j),y(M,ae,j),y(M,fe,j),y(M,Ve,j),y(M,Ye,j),k(Ye,V),k(Ye,P);for(let N=0;N<Oe.length;N+=1)Oe[N].m(P,null);Fe(P,r[0].planning.recommendation),y(M,U,j),y(M,mt,j),y(M,be,j),y(M,Ot,j),y(M,Y,j),y(M,ne,j),k(ne,tt),k(ne,Ft),k(ne,nt),rt||(Nt=[q(o,"input",r[6]),q(f,"change",r[7]),q(R,"input",r[8]),q(te,"input",r[9]),q(G,"change",r[10]),q(ye,"change",r[11]),q(P,"change",r[12]),q(tt,"click",r[13]),q(nt,"click",r[14])],rt=!0)},p(M,[j]){if(j&5&&o.value!==M[0].planning.name&&Ne(o,M[0].planning.name),j&4){gt=M[2];let N;for(N=0;N<gt.length;N+=1){const je=wr(M,gt,N);Te[N]?Te[N].p(je,j):(Te[N]=kr(je),Te[N].c(),Te[N].m(f,null))}for(;N<Te.length;N+=1)Te[N].d(1);Te.length=gt.length}if(j&5&&Fe(f,M[0].planning.reference_type),j&5&&Ne(R,M[0].planning.notes),j&5&&Wr(te.value)!==M[0].planning.size&&Ne(te,M[0].planning.size),j&8){_t=M[3];let N;for(N=0;N<_t.length;N+=1){const je=br(M,_t,N);Ae[N]?Ae[N].p(je,j):(Ae[N]=Sr(je),Ae[N].c(),Ae[N].m(G,null))}for(;N<Ae.length;N+=1)Ae[N].d(1);Ae.length=_t.length}if(j&5&&Fe(G,M[0].planning.size_units),j&16){vt=M[4];let N;for(N=0;N<vt.length;N+=1){const je=yr(M,vt,N);Pe[N]?Pe[N].p(je,j):(Pe[N]=Er(je),Pe[N].c(),Pe[N].m(ye,null))}for(;N<Pe.length;N+=1)Pe[N].d(1);Pe.length=vt.length}if(j&5&&Fe(ye,M[0].planning.triage),j&32){yt=M[5];let N;for(N=0;N<yt.length;N+=1){const je=vr(M,yt,N);Oe[N]?Oe[N].p(je,j):(Oe[N]=Mr(je),Oe[N].c(),Oe[N].m(P,null))}for(;N<Oe.length;N+=1)Oe[N].d(1);Oe.length=yt.length}j&5&&Fe(P,M[0].planning.recommendation)},i:K,o:K,d(M){M&&b(e),M&&b(s),M&&b(u),M&&b(l),M&&b(a),M&&b(h),M&&b(v),Vt(Te,M),M&&b(d),M&&b(_),M&&b(g),M&&b(E),M&&b(p),M&&b(m),M&&b(L),M&&b(I),M&&b($),M&&b(D),M&&b(X),M&&b(O),Vt(Ae,M),M&&b(le),M&&b(_e),M&&b(Me),M&&b(ge),M&&b(pe),M&&b(ve),Vt(Pe,M),M&&b(Le),M&&b(Ge),M&&b(ae),M&&b(fe),M&&b(Ve),M&&b(Ye),Vt(Oe,M),M&&b(U),M&&b(mt),M&&b(be),M&&b(Ot),M&&b(Y),M&&b(ne),rt=!1,We(Nt)}}}function xo(r,e,t){let{id:n}=e,{props:i}=e;i.planning||(i.planning={name:"",notes:"",reference_type:"preapp",size:0,size_units:"number of units",triage:"No Comment",recommendation:"No Comment"});const o=["preapp","outline","reserved matters","local plan"],s=["number of units","floorspace (Gross Floor Area)","area (Hectare)"],u=["No Comment","Standing Advice","Toolkit Assessment"],l=["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"];function a(){i.planning.name=this.value,t(0,i),t(2,o)}function h(){i.planning.reference_type=Mt(this),t(0,i),t(2,o)}function v(){i.planning.notes=this.value,t(0,i),t(2,o)}function c(){i.planning.size=Wr(this.value),t(0,i),t(2,o)}function f(){i.planning.size_units=Mt(this),t(0,i),t(2,o)}function d(){i.planning.triage=Mt(this),t(0,i),t(2,o)}function _(){i.planning.recommendation=Mt(this),t(0,i),t(2,o)}const g=()=>Jn(n),E=()=>Ce.set(null);return r.$$set=p=>{"id"in p&&t(1,n=p.id),"props"in p&&t(0,i=p.props)},[i,n,o,s,u,l,a,h,v,c,f,d,_,g,E]}class Lo extends ie{constructor(e){super(),oe(this,e,xo,Mo,re,{id:1,props:0})}}function Co(r){const e=r-1;return e*e*e+1}function xr(r,{delay:e=0,duration:t=400,easing:n=Co}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),u=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),a=parseFloat(i.marginTop),h=parseFloat(i.marginBottom),v=parseFloat(i.borderTopWidth),c=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*u}px;padding-bottom: ${f*l}px;margin-top: ${f*a}px;margin-bottom: ${f*h}px;border-top-width: ${f*v}px;border-bottom-width: ${f*c}px;`}}function Lr(r){let e,t,n,i,o;const s=r[10].default,u=Dt(s,r,r[9],null);return{c(){e=w("div"),u&&u.c(),ce(e,"border","solid 1px black"),ce(e,"padding","10px")},m(l,a){y(l,e,a),u&&u.m(e,null),r[13](e),n=!0,i||(o=q(e,"introend",r[14]),i=!0)},p(l,a){u&&u.p&&(!n||a&512)&&$t(u,s,l,l[9],n?jt(s,l[9],a,null):Gt(l[9]),null)},i(l){n||(F(u,l),ht(()=>{t||(t=er(e,xr,{duration:100},!0)),t.run(1)}),n=!0)},o(l){B(u,l),t||(t=er(e,xr,{duration:100},!1)),t.run(0),n=!1},d(l){l&&b(e),u&&u.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Ro(r){let e,t,n,i,o,s,u,l,a,h,v=r[4]&&Lr(r);return{c(){e=w("button"),t=Zn("svg"),n=Zn("path"),i=x(),o=H(r[1]),s=x(),v&&v.c(),u=De(),T(n,"d","M9 5l7 7-7 7"),T(t,"style","tran"),T(t,"width","20"),T(t,"height","20"),T(t,"fill","none"),T(t,"stroke-linecap","round"),T(t,"stroke-linejoin","round"),T(t,"stroke-width","2"),T(t,"viewBox","0 0 24 24"),T(t,"stroke","currentColor"),T(t,"class","svelte-t7fpgu"),T(e,"aria-expanded",r[4]),T(e,"class","svelte-t7fpgu"),Qn(e,"underlined",r[3])},m(c,f){y(c,e,f),k(e,t),k(t,n),k(e,i),k(e,o),y(c,s,f),v&&v.m(c,f),y(c,u,f),l=!0,a||(h=[q(e,"click",r[5]),q(e,"mouseenter",r[11]),q(e,"mouseleave",r[12])],a=!0)},p(c,[f]){(!l||f&2)&&Hn(o,c[1]),(!l||f&16)&&T(e,"aria-expanded",c[4]),(!l||f&8)&&Qn(e,"underlined",c[3]),c[4]?v?(v.p(c,f),f&16&&F(v,1)):(v=Lr(c),v.c(),F(v,1),v.m(u.parentNode,u)):v&&(Ie(),B(v,1,1,()=>{v=null}),Be())},i(c){l||(F(v),l=!0)},o(c){B(v),l=!1},d(c){c&&b(e),c&&b(s),v&&v.d(c),c&&b(u),a=!1,We(h)}}}function To(r,e,t){let n,i,o,s;he(r,et,p=>t(7,o=p)),he(r,Ce,p=>t(8,s=p));let{$$slots:u={},$$scope:l}=e,{id:a}=e,{label:h}=e;const v=()=>{Ce.update(p=>p==a?null:a),s==a&&(Rn.set(null),Rn.set(a))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const d=()=>un.set(a),_=()=>un.set(null);function g(p){Se[p?"unshift":"push"](()=>{c=p,t(2,c)})}const E=()=>f();return r.$$set=p=>{"id"in p&&t(0,a=p.id),"label"in p&&t(1,h=p.label),"$$scope"in p&&t(9,l=p.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==a),r.$$.dirty&129&&t(3,i=o==a)},[a,h,c,i,n,v,f,o,s,l,u,d,_,g,E]}class Ao extends ie{constructor(e){super(),oe(this,e,To,Ro,re,{id:0,label:1})}}function Cr(r,e,t){const n=r.slice();return n[9]=e[t],n[10]=e,n[11]=t,n}function Po(r){let e,t,n,i,o;function s(h){r[5](h,r[9])}function u(h){r[6](h,r[9])}function l(h){r[7](h,r[9])}let a={id:r[9].id,length_meters:r[9].properties.length_meters};return r[9].properties.name!==void 0&&(a.name=r[9].properties.name),r[9].properties.intervention_type!==void 0&&(a.intervention_type=r[9].properties.intervention_type),r[9].properties.description!==void 0&&(a.description=r[9].properties.description),e=new Eo({props:a}),Se.push(()=>ut(e,"name",s,r[9].properties.name)),Se.push(()=>ut(e,"intervention_type",u,r[9].properties.intervention_type)),Se.push(()=>ut(e,"description",l,r[9].properties.description)),{c(){Z(e.$$.fragment)},m(h,v){Q(e,h,v),o=!0},p(h,v){r=h;const c={};v&2&&(c.id=r[9].id),v&2&&(c.length_meters=r[9].properties.length_meters),!t&&v&2&&(t=!0,c.name=r[9].properties.name,at(()=>t=!1)),!n&&v&2&&(n=!0,c.intervention_type=r[9].properties.intervention_type,at(()=>n=!1)),!i&&v&2&&(i=!0,c.description=r[9].properties.description,at(()=>i=!1)),e.$set(c)},i(h){o||(F(e.$$.fragment,h),o=!0)},o(h){B(e.$$.fragment,h),o=!1},d(h){ee(e,h)}}}function Oo(r){let e,t,n;function i(s){r[4](s,r[9])}let o={id:r[9].id};return r[9].properties!==void 0&&(o.props=r[9].properties),e=new Lo({props:o}),Se.push(()=>ut(e,"props",i,r[9].properties)),{c(){Z(e.$$.fragment)},m(s,u){Q(e,s,u),n=!0},p(s,u){r=s;const l={};u&2&&(l.id=r[9].id),!t&&u&2&&(t=!0,l.props=r[9].properties,at(()=>t=!1)),e.$set(l)},i(s){n||(F(e.$$.fragment,s),n=!0)},o(s){B(e.$$.fragment,s),n=!1},d(s){ee(e,s)}}}function Fo(r){let e,t,n,i;const o=[Oo,Po],s=[];function u(l,a){return l[0]?0:1}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=x()},m(l,a){s[e].m(l,a),y(l,n,a),i=!0},p(l,a){let h=e;e=u(l),e===h?s[e].p(l,a):(Ie(),B(s[h],1,1,()=>{s[h]=null}),Be(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),F(t,1),t.m(n.parentNode,n))},i(l){i||(F(t),i=!0)},o(l){B(t),i=!1},d(l){s[e].d(l),l&&b(n)}}}function Rr(r,e){let t,n,i;return n=new Ao({props:{id:e[9].id,label:e[11]+1+") "+e[2](e[9]),$$slots:{default:[Fo]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=De(),Z(n.$$.fragment),this.first=t},m(o,s){y(o,t,s),Q(n,o,s),i=!0},p(o,s){e=o;const u={};s&2&&(u.id=e[9].id),s&2&&(u.label=e[11]+1+") "+e[2](e[9])),s&4099&&(u.$$scope={dirty:s,ctx:e}),n.$set(u)},i(o){i||(F(n.$$.fragment,o),i=!0)},o(o){B(n.$$.fragment,o),i=!1},d(o){o&&b(t),ee(n,o)}}}function No(r){let e=[],t=new Map,n,i,o,s,u=r[1].features;const l=a=>a[9].id;for(let a=0;a<u.length;a+=1){let h=Cr(r,u,a),v=l(h);t.set(v,e[a]=Rr(v,h))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=De()},m(a,h){for(let v=0;v<e.length;v+=1)e[v].m(a,h);y(a,n,h),i=!0,o||(s=q(window,"keydown",r[3]),o=!0)},p(a,[h]){h&7&&(u=a[1].features,Ie(),e=bi(e,h,l,1,a,u,t,n.parentNode,wi,Rr,n,Cr),Be())},i(a){if(!i){for(let h=0;h<u.length;h+=1)F(e[h]);i=!0}},o(a){for(let h=0;h<e.length;h+=1)B(e[h]);i=!1},d(a){for(let h=0;h<e.length;h+=1)e[h].d(a);a&&b(n),o=!1,s()}}}function Io(r,e,t){let n,i;he(r,Ce,c=>t(8,n=c)),he(r,ue,c=>t(1,i=c));let{planningMode:o}=e;function s(c){var d;if(o)return((d=c.properties.planning)==null?void 0:d.name)||"Untitled polygon";if(c.properties.name)return c.properties.name;var f=c.properties.intervention_type;return f=="other"&&(c.geometry.type=="Point"?f="point":c.geometry.type=="LineString"?f="line":f="polygon"),`Untitled ${f}`}function u(c){if(c.key=="Delete"){const f=c.target.tagName;if(f=="INPUT"||f=="TEXTAREA")return;c.preventDefault();const d=n;d&&Jn(d)}}function l(c,f){r.$$.not_equal(f.properties,c)&&(f.properties=c,ue.set(i))}function a(c,f){r.$$.not_equal(f.properties.name,c)&&(f.properties.name=c,ue.set(i))}function h(c,f){r.$$.not_equal(f.properties.intervention_type,c)&&(f.properties.intervention_type=c,ue.set(i))}function v(c,f){r.$$.not_equal(f.properties.description,c)&&(f.properties.description=c,ue.set(i))}return r.$$set=c=>{"planningMode"in c&&t(0,o=c.planningMode)},[o,i,s,u,l,a,h,v]}class Bo extends ie{constructor(e){super(),oe(this,e,Io,No,re,{planningMode:0})}}function ct(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ue(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function In(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function ot(r,e,t){t===void 0&&(t={});var n=ct(r),i=ct(e),o=qe(i[1]-n[1]),s=qe(i[0]-n[0]),u=qe(n[1]),l=qe(i[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return ki(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),t.units)}function tn(r,e){return e===void 0&&(e={}),Si(r,function(t,n){var i=n.geometry.coordinates;return t+ot(i[0],i[1],e)},0)}function Do(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_,g,E,p,m,S=r[0].features.length+"",C,A,R,L,I,$,D,X;return{c(){e=w("div"),t=w("label"),n=H(`Scheme name:
    `),i=w("input"),o=x(),s=w("br"),u=x(),l=w("div"),a=w("label"),h=w("input"),v=x(),c=w("button"),c.textContent="Load from GeoJSON",f=x(),d=w("button"),d.textContent="Export to GeoJSON",_=x(),g=w("br"),E=x(),p=w("div"),m=w("span"),C=H(S),A=H(" interventions"),R=x(),L=w("button"),I=H("Clear all"),T(i,"type","text"),T(h,"type","file"),T(h,"id","load_geojson"),T(h,"class","svelte-lhyd1e"),T(c,"type","button"),T(d,"type","button"),T(d,"class","align-right svelte-lhyd1e"),T(L,"type","button"),T(L,"class","align-right svelte-lhyd1e"),L.disabled=$=r[0].features.length==0},m(O,z){y(O,e,z),k(e,t),k(t,n),k(t,i),Ne(i,r[0].scheme_name),y(O,o,z),y(O,s,z),y(O,u,z),y(O,l,z),k(l,a),k(a,h),k(a,v),k(a,c),k(l,f),k(l,d),y(O,_,z),y(O,g,z),y(O,E,z),y(O,p,z),k(p,m),k(m,C),k(m,A),k(p,R),k(p,L),k(L,I),D||(X=[q(i,"input",r[7]),q(h,"change",r[3]),q(c,"click",Go),q(d,"click",r[2]),q(L,"click",r[1])],D=!0)},p(O,[z]){z&1&&i.value!==O[0].scheme_name&&Ne(i,O[0].scheme_name),z&1&&S!==(S=O[0].features.length+"")&&Hn(C,S),z&1&&$!==($=O[0].features.length==0)&&(L.disabled=$)},i:K,o:K,d(O){O&&b(e),O&&b(o),O&&b(s),O&&b(u),O&&b(l),O&&b(_),O&&b(g),O&&b(E),O&&b(p),D=!1,We(X)}}}function $o(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Go(){document.getElementById("load_geojson").click()}function jo(r,e,t){let n;he(r,ue,d=>t(0,n=d));let{authorityName:i}=e,{planningMode:o}=e,s=i;o&&(s+="_planning");let u=window.localStorage.getItem(s);if(u)try{ue.set(c(JSON.parse(u)))}catch(d){console.log(`Failed to load from local storage: ${d}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&ue.update(d=>(delete d.scheme_name,d.features=[],d))}function a(){const d=JSON.parse(JSON.stringify(n));for(let _ of d.features)delete _.properties.hide_while_editing;return d}function h(){let d=a();var _=s;d.authority=i,d.origin="atip-v1",d.scheme_name&&(_+="_"+d.scheme_name),_+=".txt",$o(_,JSON.stringify(d,null,"  "))}function v(d){const _=new FileReader;_.onload=E=>{try{ue.set(c(JSON.parse(E.target.result)))}catch(p){window.alert(`Couldn't load scheme from a file: ${p}`)}};let g=d.target.files;_.readAsText(g[0])}function c(d){let _=1;for(let g of d.features)g.properties||(g.properties={name:"",description:"",intervention_type:"other"}),g.geometry.type=="LineString"&&!g.properties.length_meters&&(g.properties.length_meters=tn(g,{units:"kilometers"})*1e3),g.id=_++;return d}function f(){n.scheme_name=this.value,ue.set(n)}return r.$$set=d=>{"authorityName"in d&&t(4,i=d.authorityName),"planningMode"in d&&t(5,o=d.planningMode)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(a())))},[n,l,h,v,i,o,s,f]}class qo extends ie{constructor(e){super(),oe(this,e,jo,Do,re,{authorityName:4,planningMode:5})}}const zo="/atip/area_snap/assets/zoom_out_map-b2e1091a.svg";function Yo(r){let e,t,n,i,o;return{c(){e=w("button"),t=w("img"),Ei(t.src,n=zo)||T(t,"src",n),T(t,"alt","Zoom to show entire boundary"),T(e,"type","button"),T(e,"title","Zoom to show entire boundary"),T(e,"class","svelte-qzjsqo")},m(s,u){y(s,e,u),k(e,t),i||(o=q(e,"click",r[0]),i=!0)},p:K,i:K,o:K,d(s){s&&b(e),i=!1,o()}}}function Ho(r,e,t){let n;he(r,Ke,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(Yn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class Xo extends ie{constructor(e){super(),oe(this,e,Ho,Yo,re,{boundaryGeojson:1})}}function Uo(r){let e,t,n,i,o,s,u;return{c(){e=w("div"),t=H(`Basemap:
  `),n=w("select"),i=w("option"),i.textContent="Streets",o=w("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&ht(()=>r[2].call(n)),T(e,"class","svelte-1tbnm6i")},m(l,a){y(l,e,a),k(e,t),k(e,n),k(n,i),k(n,o),Fe(n,r[0]),s||(u=[q(n,"change",r[2]),q(n,"change",r[1])],s=!0)},p(l,[a]){a&1&&Fe(n,l[0])},i:K,o:K,d(l){l&&b(e),s=!1,We(u)}}}function Jo(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let u=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=u}function o(){n=Mt(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Wo extends ie{constructor(e){super(),oe(this,e,Jo,Uo,re,{style:0})}}const me={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},bn=10,cn=10;function Ko(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_;return{c(){e=w("li"),t=w("span"),n=H("Areas"),i=x(),o=w("li"),s=w("span"),u=H("Routes"),l=x(),a=w("li"),h=w("span"),v=H("Crossings"),c=x(),f=w("li"),d=w("span"),_=H("Other"),T(t,"class","svelte-p551i1"),ce(t,"background",me.area),T(s,"class","svelte-p551i1"),ce(s,"background",me.route),T(h,"class","svelte-p551i1"),ce(h,"background",me.crossing),T(d,"class","svelte-p551i1"),ce(d,"background",me.other)},m(g,E){y(g,e,E),k(e,t),k(e,n),y(g,i,E),y(g,o,E),k(o,s),k(o,u),y(g,l,E),y(g,a,E),k(a,h),k(a,v),y(g,c,E),y(g,f,E),k(f,d),k(f,_)},p:K,d(g){g&&b(e),g&&b(i),g&&b(o),g&&b(l),g&&b(a),g&&b(c),g&&b(f)}}}function Vo(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_;return{c(){e=w("li"),t=w("span"),n=H("Preapp"),i=x(),o=w("li"),s=w("span"),u=H("Outline"),l=x(),a=w("li"),h=w("span"),v=H("Reserved matters"),c=x(),f=w("li"),d=w("span"),_=H("Local plan"),T(t,"class","svelte-p551i1"),ce(t,"background",me.preapp),T(s,"class","svelte-p551i1"),ce(s,"background",me.outline),T(h,"class","svelte-p551i1"),ce(h,"background",me["reserved matters"]),T(d,"class","svelte-p551i1"),ce(d,"background",me["local plan"])},m(g,E){y(g,e,E),k(e,t),k(e,n),y(g,i,E),y(g,o,E),k(o,s),k(o,u),y(g,l,E),y(g,a,E),k(a,h),k(a,v),y(g,c,E),y(g,f,E),k(f,d),k(f,_)},p:K,d(g){g&&b(e),g&&b(i),g&&b(o),g&&b(l),g&&b(a),g&&b(c),g&&b(f)}}}function Zo(r){let e,t,n,i;function o(l,a){return l[0]?Vo:Ko}let s=o(r),u=s(r);return{c(){e=w("div"),t=w("h1"),t.textContent="Interventions",n=x(),i=w("ul"),u.c(),T(t,"class","svelte-p551i1"),T(e,"class","svelte-p551i1")},m(l,a){y(l,e,a),k(e,t),k(e,n),k(e,i),u.m(i,null)},p(l,[a]){s===(s=o(l))&&u?u.p(l,a):(u.d(1),u=s(l),u&&(u.c(),u.m(i,null)))},i:K,o:K,d(l){l&&b(e),u.d()}}}function Qo(r,e,t){let{planningMode:n}=e;return r.$$set=i=>{"planningMode"in i&&t(0,n=i.planningMode)},[n]}class es extends ie{constructor(e){super(),oe(this,e,Qo,Zo,re,{planningMode:0})}}let wt="interventions";function ts(r,e,t){let n,i;he(r,Ke,h=>t(1,n=h)),he(r,ue,h=>t(2,i=h));let{planningMode:o}=e;dt(n,wt,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",me.area,"route",me.route,"crossing",me.crossing,"other",me.other,"white"],u=["match",["get","reference_type",["get","planning"]],"preapp",me.preapp,"outline",me.outline,"reserved matters",me["reserved matters"],"local plan",me["local plan"],"white"],l=["!=","hide_while_editing",!0];return Ee(n,{id:"interventions-points",source:wt,filter:["all",_n,l,["!=","endpoint",!0]],...At(s,bn)}),Ee(n,{id:"interventions-lines",source:wt,filter:["all",vn,l],...Xt(s,cn)},"route-lines"),Ee(n,{id:"interventions-lines-endpoints",source:wt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*cn,"circle-opacity":0,"circle-stroke-color":me.lineEndpointColor,"circle-stroke-width":2}}),Ee(n,{id:"interventions-polygons",source:wt,filter:["all",yn,l],...gn(o?u:s,.5)},"hover-polygons"),r.$$set=h=>{"planningMode"in h&&t(0,o=h.planningMode)},r.$$.update=()=>{if(r.$$.dirty&6){let h=JSON.parse(JSON.stringify(i)),v=[];for(let c of h.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])v.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});h.features=h.features.concat(v),n.getSource(wt).setData(h)}},[o,n,i]}class ns extends ie{constructor(e){super(),oe(this,e,ts,null,re,{planningMode:0})}}let kt="hover";function rs(r,e,t){let n,i,o,s,u;return he(r,Ke,l=>t(0,n=l)),he(r,ue,l=>t(1,i=l)),he(r,un,l=>t(2,o=l)),he(r,et,l=>t(3,s=l)),he(r,Ce,l=>t(4,u=l)),dt(n,kt,{type:"geojson",data:Je()}),Ee(n,{id:"hover-polygons",source:kt,filter:yn,...Xt(me.hovering,.5*cn,1)}),Ee(n,{id:"hover-lines",source:kt,filter:vn,...Xt(me.hovering,1.5*cn,1)},"interventions-lines"),Ee(n,{id:"hover-points",source:kt,filter:_n,...At(me.hovering,1.5*bn,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=u||s||o;l!=null?n.getSource(kt).setData(i.features.find(a=>a.id==l)):n.getSource(kt).setData(Je())}},[n,i,o,s,u]}class is extends ie{constructor(e){super(),oe(this,e,rs,null,re,{})}}class Kn{constructor(e,t){se(this,"owner");se(this,"map");se(this,"mapHandlers",{});se(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Zt="edit-point-mode";class os{constructor(e){se(this,"map");se(this,"active");se(this,"eventListenersSuccess");se(this,"eventListenersFailure");se(this,"cursor");se(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new Kn(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),dt(e,Zt,{type:"geojson",data:Je()}),Ee(e,{id:"edit-point-mode",source:Zt,...At(me.hovering,bn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=ss(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Zt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Je();this.cursor&&e.features.push(this.cursor),this.map.getSource(Zt).setData(e)}}function ss(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Zr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return ls(r,e);var n=ct(r),i=ct(e),o=qe(n[0]),s=qe(i[0]),u=qe(n[1]),l=qe(i[1]),a=Math.sin(s-o)*Math.cos(l),h=Math.cos(u)*Math.sin(l)-Math.sin(u)*Math.cos(l)*Math.cos(s-o);return Cn(Math.atan2(a,h))}function ls(r,e){var t=Zr(e,r);return t=(t+180)%360,t}function Tr(r,e,t,n){n===void 0&&(n={});var i=ct(r),o=qe(i[0]),s=qe(i[1]),u=qe(t),l=Mi(e,n.units),a=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(u)),h=o+Math.atan2(Math.sin(u)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(a)),v=Cn(h),c=Cn(a);return Ct([v,c],n.properties)}function Bn(r){if(!r)throw new Error("geojson is required");var e=[];return Xn(r,function(t){us(t,e)}),ft(e)}function us(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ue(n);break;case"LineString":t=[Ue(n)]}t.forEach(function(i){var o=as(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function as(r,e){var t=[];return r.reduce(function(n,i){var o=Rt([n,i],e);return o.bbox=fs(n,i),t.push(o),i}),t}function fs(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,u=n<o?n:o,l=t>i?t:i,a=n>o?n:o;return[s,u,l,a]}var Tt={},cs={get exports(){return Tt},set exports(r){Tt=r}},Dn={},ps={get exports(){return Dn},set exports(r){Dn=r}};(function(r,e){(function(t,n){r.exports=n()})(xi,function(){function t(p,m,S,C,A){(function R(L,I,$,D,X){for(;D>$;){if(D-$>600){var O=D-$+1,z=I-$+1,te=Math.log(O),de=.5*Math.exp(2*te/3),G=.5*Math.sqrt(te*de*(O-de)/O)*(z-O/2<0?-1:1),le=Math.max($,Math.floor(I-z*de/O+G)),_e=Math.min(D,Math.floor(I+(O-z)*de/O+G));R(L,I,le,_e,X)}var Me=L[I],ge=$,pe=D;for(n(L,$,I),X(L[D],Me)>0&&n(L,$,D);ge<pe;){for(n(L,ge,pe),ge++,pe--;X(L[ge],Me)<0;)ge++;for(;X(L[pe],Me)>0;)pe--}X(L[$],Me)===0?n(L,$,pe):n(L,++pe,D),pe<=I&&($=pe+1),I<=pe&&(D=pe-1)}})(p,m,S||0,C||p.length-1,A||i)}function n(p,m,S){var C=p[m];p[m]=p[S],p[S]=C}function i(p,m){return p<m?-1:p>m?1:0}var o=function(p){p===void 0&&(p=9),this._maxEntries=Math.max(4,p),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(p,m,S){if(!S)return m.indexOf(p);for(var C=0;C<m.length;C++)if(S(p,m[C]))return C;return-1}function u(p,m){l(p,0,p.children.length,m,p)}function l(p,m,S,C,A){A||(A=g(null)),A.minX=1/0,A.minY=1/0,A.maxX=-1/0,A.maxY=-1/0;for(var R=m;R<S;R++){var L=p.children[R];a(A,p.leaf?C(L):L)}return A}function a(p,m){return p.minX=Math.min(p.minX,m.minX),p.minY=Math.min(p.minY,m.minY),p.maxX=Math.max(p.maxX,m.maxX),p.maxY=Math.max(p.maxY,m.maxY),p}function h(p,m){return p.minX-m.minX}function v(p,m){return p.minY-m.minY}function c(p){return(p.maxX-p.minX)*(p.maxY-p.minY)}function f(p){return p.maxX-p.minX+(p.maxY-p.minY)}function d(p,m){return p.minX<=m.minX&&p.minY<=m.minY&&m.maxX<=p.maxX&&m.maxY<=p.maxY}function _(p,m){return m.minX<=p.maxX&&m.minY<=p.maxY&&m.maxX>=p.minX&&m.maxY>=p.minY}function g(p){return{children:p,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(p,m,S,C,A){for(var R=[m,S];R.length;)if(!((S=R.pop())-(m=R.pop())<=C)){var L=m+Math.ceil((S-m)/C/2)*C;t(p,L,m,S,A),R.push(m,L,L,S)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(p){var m=this.data,S=[];if(!_(p,m))return S;for(var C=this.toBBox,A=[];m;){for(var R=0;R<m.children.length;R++){var L=m.children[R],I=m.leaf?C(L):L;_(p,I)&&(m.leaf?S.push(L):d(p,I)?this._all(L,S):A.push(L))}m=A.pop()}return S},o.prototype.collides=function(p){var m=this.data;if(!_(p,m))return!1;for(var S=[];m;){for(var C=0;C<m.children.length;C++){var A=m.children[C],R=m.leaf?this.toBBox(A):A;if(_(p,R)){if(m.leaf||d(p,R))return!0;S.push(A)}}m=S.pop()}return!1},o.prototype.load=function(p){if(!p||!p.length)return this;if(p.length<this._minEntries){for(var m=0;m<p.length;m++)this.insert(p[m]);return this}var S=this._build(p.slice(),0,p.length-1,0);if(this.data.children.length)if(this.data.height===S.height)this._splitRoot(this.data,S);else{if(this.data.height<S.height){var C=this.data;this.data=S,S=C}this._insert(S,this.data.height-S.height-1,!0)}else this.data=S;return this},o.prototype.insert=function(p){return p&&this._insert(p,this.data.height-1),this},o.prototype.clear=function(){return this.data=g([]),this},o.prototype.remove=function(p,m){if(!p)return this;for(var S,C,A,R=this.data,L=this.toBBox(p),I=[],$=[];R||I.length;){if(R||(R=I.pop(),C=I[I.length-1],S=$.pop(),A=!0),R.leaf){var D=s(p,R.children,m);if(D!==-1)return R.children.splice(D,1),I.push(R),this._condense(I),this}A||R.leaf||!d(R,L)?C?(S++,R=C.children[S],A=!1):R=null:(I.push(R),$.push(S),S=0,C=R,R=R.children[0])}return this},o.prototype.toBBox=function(p){return p},o.prototype.compareMinX=function(p,m){return p.minX-m.minX},o.prototype.compareMinY=function(p,m){return p.minY-m.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(p){return this.data=p,this},o.prototype._all=function(p,m){for(var S=[];p;)p.leaf?m.push.apply(m,p.children):S.push.apply(S,p.children),p=S.pop();return m},o.prototype._build=function(p,m,S,C){var A,R=S-m+1,L=this._maxEntries;if(R<=L)return u(A=g(p.slice(m,S+1)),this.toBBox),A;C||(C=Math.ceil(Math.log(R)/Math.log(L)),L=Math.ceil(R/Math.pow(L,C-1))),(A=g([])).leaf=!1,A.height=C;var I=Math.ceil(R/L),$=I*Math.ceil(Math.sqrt(L));E(p,m,S,$,this.compareMinX);for(var D=m;D<=S;D+=$){var X=Math.min(D+$-1,S);E(p,D,X,I,this.compareMinY);for(var O=D;O<=X;O+=I){var z=Math.min(O+I-1,X);A.children.push(this._build(p,O,z,C-1))}}return u(A,this.toBBox),A},o.prototype._chooseSubtree=function(p,m,S,C){for(;C.push(m),!m.leaf&&C.length-1!==S;){for(var A=1/0,R=1/0,L=void 0,I=0;I<m.children.length;I++){var $=m.children[I],D=c($),X=(O=p,z=$,(Math.max(z.maxX,O.maxX)-Math.min(z.minX,O.minX))*(Math.max(z.maxY,O.maxY)-Math.min(z.minY,O.minY))-D);X<R?(R=X,A=D<A?D:A,L=$):X===R&&D<A&&(A=D,L=$)}m=L||m.children[0]}var O,z;return m},o.prototype._insert=function(p,m,S){var C=S?p:this.toBBox(p),A=[],R=this._chooseSubtree(C,this.data,m,A);for(R.children.push(p),a(R,C);m>=0&&A[m].children.length>this._maxEntries;)this._split(A,m),m--;this._adjustParentBBoxes(C,A,m)},o.prototype._split=function(p,m){var S=p[m],C=S.children.length,A=this._minEntries;this._chooseSplitAxis(S,A,C);var R=this._chooseSplitIndex(S,A,C),L=g(S.children.splice(R,S.children.length-R));L.height=S.height,L.leaf=S.leaf,u(S,this.toBBox),u(L,this.toBBox),m?p[m-1].children.push(L):this._splitRoot(S,L)},o.prototype._splitRoot=function(p,m){this.data=g([p,m]),this.data.height=p.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(p,m,S){for(var C,A,R,L,I,$,D,X=1/0,O=1/0,z=m;z<=S-m;z++){var te=l(p,0,z,this.toBBox),de=l(p,z,S,this.toBBox),G=(A=te,R=de,L=void 0,I=void 0,$=void 0,D=void 0,L=Math.max(A.minX,R.minX),I=Math.max(A.minY,R.minY),$=Math.min(A.maxX,R.maxX),D=Math.min(A.maxY,R.maxY),Math.max(0,$-L)*Math.max(0,D-I)),le=c(te)+c(de);G<X?(X=G,C=z,O=le<O?le:O):G===X&&le<O&&(O=le,C=z)}return C||S-m},o.prototype._chooseSplitAxis=function(p,m,S){var C=p.leaf?this.compareMinX:h,A=p.leaf?this.compareMinY:v;this._allDistMargin(p,m,S,C)<this._allDistMargin(p,m,S,A)&&p.children.sort(C)},o.prototype._allDistMargin=function(p,m,S,C){p.children.sort(C);for(var A=this.toBBox,R=l(p,0,m,A),L=l(p,S-m,S,A),I=f(R)+f(L),$=m;$<S-m;$++){var D=p.children[$];a(R,p.leaf?A(D):D),I+=f(R)}for(var X=S-m-1;X>=m;X--){var O=p.children[X];a(L,p.leaf?A(O):O),I+=f(L)}return I},o.prototype._adjustParentBBoxes=function(p,m,S){for(var C=S;C>=0;C--)a(m[C],p)},o.prototype._condense=function(p){for(var m=p.length-1,S=void 0;m>=0;m--)p[m].children.length===0?m>0?(S=p[m-1].children).splice(S.indexOf(p[m]),1):this.clear():u(p[m],this.toBBox)},o})})(ps);const hs=Un(Li),ds=Un(Ci),ms=Un(Ri);var He=Dn,Qr=hs,ei=ds,St=ms.default,gs=ei.featureEach;ei.coordEach;Qr.polygon;var Ar=Qr.featureCollection;function ti(r){var e=new He(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:St(t),He.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:St(i),n.push(i)}):gs(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:St(i),n.push(i)}),He.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:St(t),He.prototype.remove.call(this,t,n)},e.clear=function(){return He.prototype.clear.call(this)},e.search=function(t){var n=He.prototype.search.call(this,this.toBBox(t));return Ar(n)},e.collides=function(t){return He.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=He.prototype.all.call(this);return Ar(t)},e.toJSON=function(){return He.prototype.toJSON.call(this)},e.fromJSON=function(t){return He.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=St(t);else if(t.type==="FeatureCollection")n=St(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}cs.exports=ti;Tt.default=ti;function ni(r,e){var t={},n=[];if(r.type==="LineString"&&(r=tr(r)),e.type==="LineString"&&(e=tr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Pr(r,e);return i&&n.push(i),ft(n)}var o=Tt();return o.load(Bn(e)),ln(Bn(r),function(s){ln(o.search(s),function(u){var l=Pr(s,u);if(l){var a=Ue(l).join(",");t[a]||(t[a]=!0,n.push(l))}})}),ft(n)}function Pr(r,e){var t=Ue(r),n=Ue(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],u=t[1][1],l=n[0][0],a=n[0][1],h=n[1][0],v=n[1][1],c=(v-a)*(s-i)-(h-l)*(u-o),f=(h-l)*(o-a)-(v-a)*(i-l),d=(s-i)*(o-a)-(u-o)*(i-l);if(c===0)return f===0&&d===0,null;var _=f/c,g=d/c;if(_>=0&&_<=1&&g>=0&&g<=1){var E=i+_*(s-i),p=o+_*(u-o);return Ct([E,p])}return null}function Jt(r,e,t){t===void 0&&(t={});var n=Ct([1/0,1/0],{dist:1/0}),i=0;return Xn(r,function(o){for(var s=Ue(o),u=0;u<s.length-1;u++){var l=Ct(s[u]);l.properties.dist=ot(e,l,t);var a=Ct(s[u+1]);a.properties.dist=ot(e,a,t);var h=ot(l,a,t),v=Math.max(l.properties.dist,a.properties.dist),c=Zr(l,a),f=Tr(e,v,c+90,t),d=Tr(e,v,c-90,t),_=ni(Rt([f.geometry.coordinates,d.geometry.coordinates]),Rt([l.geometry.coordinates,a.geometry.coordinates])),g=null;_.features.length>0&&(g=_.features[0],g.properties.dist=ot(e,g,t),g.properties.location=i+ot(l,g,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=u,n.properties.location=i),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=u+1,n.properties.location=i+h),g&&g.properties.dist<n.properties.dist&&(n=g,n.properties.index=u),i+=h}}),n}const Et="edit-polygon-mode";class _s{constructor(e){se(this,"map");se(this,"active");se(this,"eventListenersSuccess");se(this,"eventListenersFailure");se(this,"points");se(this,"cursor");se(this,"hover");se(this,"dragFrom");se(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new Kn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),dt(e,Et,{type:"geojson",data:Je()}),Ee(e,{id:"edit-polygon-fill",source:Et,filter:yn,...gn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Ee(e,{id:"edit-polygon-lines",source:Et,filter:vn,...Xt("black",8,.5)}),Ee(e,{id:"edit-polygon-vertices",source:Et,filter:_n,...At(me.hovering,bn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Fr(this.points).forEach((n,i)=>{t.push([i+1,Jt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(Et),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Je();this.points.forEach((n,i)=>{let o=Or(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Fr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(Et).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Or(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Or(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Fr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let W;const Qe=new Array(32).fill(void 0);Qe.push(void 0,null,!0,!1);function J(r){return Qe[r]}let zt=Qe.length;function vs(r){r<36||(Qe[r]=zt,zt=r)}function $n(r){const e=J(r);return vs(r),e}const ri=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});ri.decode();let nn=new Uint8Array;function Yt(){return nn.byteLength===0&&(nn=new Uint8Array(W.memory.buffer)),nn}function xt(r,e){return ri.decode(Yt().subarray(r,r+e))}function we(r){zt===Qe.length&&Qe.push(Qe.length+1);const e=zt;return zt=Qe[e],Qe[e]=r,e}function En(r){return r==null}let rn=new Float64Array;function ys(){return rn.byteLength===0&&(rn=new Float64Array(W.memory.buffer)),rn}let on=new Int32Array;function ke(){return on.byteLength===0&&(on=new Int32Array(W.memory.buffer)),on}let lt=0;const sn=new TextEncoder("utf-8"),bs=typeof sn.encodeInto=="function"?function(r,e){return sn.encodeInto(r,e)}:function(r,e){const t=sn.encode(r);return e.set(t),{read:r.length,written:t.length}};function Qt(r,e,t){if(t===void 0){const u=sn.encode(r),l=e(u.length);return Yt().subarray(l,l+u.length).set(u),lt=u.length,l}let n=r.length,i=e(n);const o=Yt();let s=0;for(;s<n;s++){const u=r.charCodeAt(s);if(u>127)break;o[i+s]=u}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const u=Yt().subarray(i+s,i+n),l=bs(r,u);s+=l.written}return lt=s,i}function Gn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Gn(r[0]));for(let s=1;s<i;s++)o+=", "+Gn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function ws(r,e){const t=e(r.length*1);return Yt().set(r,t/1),lt=r.length,t}function Mn(r,e){try{return r.apply(this,e)}catch(t){W.__wbindgen_exn_store(we(t))}}class pn{static __wrap(e){const t=Object.create(pn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();W.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=W.__wbindgen_add_to_stack_pointer(-16),s=ws(e,W.__wbindgen_malloc),u=lt;W.jsroutesnapper_new(o,s,u);var t=ke()[o/4+0],n=ke()[o/4+1],i=ke()[o/4+2];if(i)throw $n(n);return pn.__wrap(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){W.jsroutesnapper_setConfig(this.ptr,we(e))}toFinalFeature(){try{const n=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ke()[n/4+0],t=ke()[n/4+1];let i;return e!==0&&(i=xt(e,t).slice(),W.__wbindgen_free(e,t*1)),i}finally{W.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_renderGeojson(n,this.ptr);var e=ke()[n/4+0],t=ke()[n/4+1];return xt(e,t)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,t)}}setSnapMode(e){W.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return W.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){W.jsroutesnapper_onClick(this.ptr)}onDragStart(){return W.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return W.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){W.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_editExisting(i,this.ptr,we(e));var t=ke()[i/4+0],n=ke()[i/4+1];if(n)throw $n(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}}async function ks(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ss(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){$n(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(xt(e,t));return we(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=xt(e,t);return we(n)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;ys()[e/8+1]=En(i)?0:i,ke()[e/4+0]=!En(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=En(i)?0:Qt(i,W.__wbindgen_malloc,W.__wbindgen_realloc),s=lt;ke()[e/4+1]=s,ke()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(J(t)),i=Qt(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=lt;ke()[e/4+1]=o,ke()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return we(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=J(e)[J(t)];return we(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(J(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(J(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(J(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(J(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(J(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=J(e)[t>>>0];return we(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=J(e).next;return we(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Mn(function(e){const t=J(e).next();return we(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return J(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=J(e).value;return we(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return we(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Mn(function(e,t){const n=Reflect.get(J(e),J(t));return we(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Mn(function(e,t){const n=J(e).call(J(t));return we(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=J(e).buffer;return we(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(J(e));return we(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return we(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=Qt(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=lt;ke()[e/4+1]=o,ke()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(xt(e,t))}finally{W.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=Gn(J(t)),i=Qt(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=lt;ke()[e/4+1]=o,ke()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(xt(e,t))},r.wbg.__wbindgen_memory=function(){const e=W.memory;return we(e)},r}function Es(r,e){return W=r.exports,ii.__wbindgen_wasm_module=e,rn=new Float64Array,on=new Int32Array,nn=new Uint8Array,W}async function ii(r){typeof r>"u"&&(r="/atip/area_snap/assets/route_snapper_bg.wasm");const e=Ss();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await ks(await r,e);return Es(t,n)}const Bt="route-snapper",Nr=10,Ms=30;class xs{constructor(e,t){se(this,"map");se(this,"inner");se(this,"active");se(this,"eventListenersSuccessRoute");se(this,"eventListenersSuccessArea");se(this,"eventListenersFailure");se(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new pn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],dt(e,Bt,{type:"geojson",data:Je()}),Ee(e,{id:"route-points",source:Bt,filter:_n,...At(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Nr/2,Nr])}),Ee(e,{id:"route-lines",source:Bt,filter:vn,...Xt("black",2.5)}),Ee(e,{id:"route-polygons",source:Bt,filter:yn,...gn("black",.5)}),this.events=new Kn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Ms,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Bt).setData(JSON.parse(this.inner.renderGeojson()))}}function Ir(r){let e;function t(o,s){return o[1]?Cs:Ls}let n=t(r),i=n(r);return{c(){i.c(),e=De()},m(o,s){i.m(o,s),y(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&b(e)}}}function Ls(r){let e;return{c(){e=w("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){y(t,e,n)},d(t){t&&b(e)}}}function Cs(r){let e;return{c(){e=w("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){y(t,e,n)},d(t){t&&b(e)}}}function Rs(r){let e,t=r[0]==Lt&&Ir(r);return{c(){t&&t.c(),e=De()},m(n,i){t&&t.m(n,i),y(n,e,i)},p(n,[i]){n[0]==Lt?t?t.p(n,i):(t=Ir(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:K,o:K,d(n){t&&t.d(n),n&&b(e)}}}const Lt="edit-attribute";function oi(){}function Ts(r,e,t){let n,i,o,s;he(r,Ke,f=>t(5,n=f)),he(r,ue,f=>t(6,i=f)),he(r,Rn,f=>t(7,o=f)),he(r,Ce,f=>t(1,s=f));let{mode:u}=e,{changeMode:l}=e;function a(){Ce.set(null)}n.on("mousemove",h),n.on("mouseout",v),n.on("click",c),Wt(()=>{n.off("mousemove",h),n.off("mouseout",v),n.off("click",c)});function h(f){var d;if(u==Lt){let _=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});et.set(((d=_[0])==null?void 0:d.id)||null)}}function v(){u==Lt&&et.set(null)}function c(f){if(u==Lt){let d=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});d.length>0?Ce.set(d[0].id):Ce.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,u=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let d=i.features.find(_=>_.id==f);d.geometry.type=="Point"?n.flyTo({center:d.geometry.coordinates,duration:500}):n.fitBounds(Yn(d),{padding:200,duration:500}),l(Lt)}}},[u,s,l,oi,a,n,i,o]}class As extends ie{constructor(e){super(),oe(this,e,Ts,Rs,re,{mode:0,changeMode:2,start:3,stop:4})}get start(){return oi}get stop(){return this.$$.ctx[4]}}function Ps(r){let e,t;return{c:K,m(n,i){e||(t=q(window,"keydown",r[0]),e=!0)},p:K,i:K,o:K,d(n){e=!1,t()}}}function Os(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class wn extends ie{constructor(e){super(),oe(this,e,Os,Ps,re,{tool:1})}}function Fs(r){let e;return{c(){e=w("p"),e.textContent="Click to add a new point"},m(t,n){y(t,e,n)},d(t){t&&b(e)}}}function Ns(r){let e;return{c(){e=w("p"),e.textContent="Click to move the point here"},m(t,n){y(t,e,n)},d(t){t&&b(e)}}}function Is(r){let e,t,n,i,o,s,u,l,a;function h(f,d){return f[1]?Ns:Fs}let v=h(r),c=v(r);return s=new wn({props:{tool:r[0]}}),{c(){c.c(),e=x(),t=w("p"),t.innerHTML="Press <b>Escape</b> to cancel",n=x(),i=w("button"),i.textContent="Cancel",o=x(),Z(s.$$.fragment),T(i,"type","button")},m(f,d){c.m(f,d),y(f,e,d),y(f,t,d),y(f,n,d),y(f,i,d),y(f,o,d),Q(s,f,d),u=!0,l||(a=q(i,"click",r[2]),l=!0)},p(f,[d]){v!==(v=h(f))&&(c.d(1),c=v(f),c&&(c.c(),c.m(e.parentNode,e)));const _={};d&1&&(_.tool=f[0]),s.$set(_)},i(f){u||(F(s.$$.fragment,f),u=!0)},o(f){B(s.$$.fragment,f),u=!1},d(f){c.d(f),f&&b(e),f&&b(t),f&&b(n),f&&b(i),f&&b(o),ee(s,f),l=!1,a()}}}function Bs(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class si extends ie{constructor(e){super(),oe(this,e,Bs,Is,re,{pointTool:0,editingExisting:1})}}function Ds(r){let e,t,n,i,o,s,u,l,a,h,v;return l=new wn({props:{tool:r[0]}}),{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=x(),n=w("div"),i=w("button"),i.textContent="Finish",o=x(),s=w("button"),s.textContent="Cancel",u=x(),Z(l.$$.fragment),T(i,"type","button"),T(s,"type","button"),ce(n,"display","flex"),ce(n,"justify-content","space-between")},m(c,f){y(c,e,f),y(c,t,f),y(c,n,f),k(n,i),k(n,o),k(n,s),y(c,u,f),Q(l,c,f),a=!0,h||(v=[q(i,"click",r[1]),q(s,"click",r[2])],h=!0)},p(c,[f]){const d={};f&1&&(d.tool=c[0]),l.$set(d)},i(c){a||(F(l.$$.fragment,c),a=!0)},o(c){B(l.$$.fragment,c),a=!1},d(c){c&&b(e),c&&b(t),c&&b(n),c&&b(u),ee(l,c),h=!1,We(v)}}}function $s(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class li extends ie{constructor(e){super(),oe(this,e,$s,Ds,re,{polygonTool:0})}}function Gs(r){let e,t,n,i,o,s,u,l,a,h,v;return l=new wn({props:{tool:r[0]}}),{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish area</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=x(),n=w("div"),i=w("button"),i.textContent="Finish",o=x(),s=w("button"),s.textContent="Cancel",u=x(),Z(l.$$.fragment),T(i,"type","button"),T(s,"type","button"),ce(n,"display","flex"),ce(n,"justify-content","space-between")},m(c,f){y(c,e,f),y(c,t,f),y(c,n,f),k(n,i),k(n,o),k(n,s),y(c,u,f),Q(l,c,f),a=!0,h||(v=[q(i,"click",r[1]),q(s,"click",r[2])],h=!0)},p(c,[f]){const d={};f&1&&(d.tool=c[0]),l.$set(d)},i(c){a||(F(l.$$.fragment,c),a=!0)},o(c){B(l.$$.fragment,c),a=!1},d(c){c&&b(e),c&&b(t),c&&b(n),c&&b(u),ee(l,c),h=!1,We(v)}}}function js(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class ui extends ie{constructor(e){super(),oe(this,e,js,Gs,re,{routeTool:0})}}function qs(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_;return c=new wn({props:{tool:r[0]}}),{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=x(),n=w("label"),i=w("input"),o=H(`
  Avoid doubling back`),s=x(),u=w("div"),l=w("button"),l.textContent="Finish",a=x(),h=w("button"),h.textContent="Cancel",v=x(),Z(c.$$.fragment),T(i,"type","checkbox"),T(l,"type","button"),T(h,"type","button"),ce(u,"display","flex"),ce(u,"justify-content","space-between")},m(g,E){y(g,e,E),y(g,t,E),y(g,n,E),k(n,i),i.checked=r[1],k(n,o),y(g,s,E),y(g,u,E),k(u,l),k(u,a),k(u,h),y(g,v,E),Q(c,g,E),f=!0,d||(_=[q(i,"change",r[2]),q(l,"click",r[3]),q(h,"click",r[4])],d=!0)},p(g,[E]){E&2&&(i.checked=g[1]);const p={};E&1&&(p.tool=g[0]),c.$set(p)},i(g){f||(F(c.$$.fragment,g),f=!0)},o(g){B(c.$$.fragment,g),f=!1},d(g){g&&b(e),g&&b(t),g&&b(n),g&&b(s),g&&b(u),g&&b(v),ee(c,g),d=!1,We(_)}}}function zs(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),u=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,u]}class ai extends ie{constructor(e){super(),oe(this,e,zs,qs,re,{routeTool:0})}}function Br(r){let e,t,n,i;const o=[Js,Us,Xs,Hs,Ys],s=[];function u(l,a){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=De()},m(l,a){s[e].m(l,a),y(l,n,a),i=!0},p(l,a){let h=e;e=u(l),e===h?s[e].p(l,a):(Ie(),B(s[h],1,1,()=>{s[h]=null}),Be(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),F(t,1),t.m(n.parentNode,n))},i(l){i||(F(t),i=!0)},o(l){B(t),i=!1},d(l){s[e].d(l),l&&b(n)}}}function Ys(r){let e;return{c(){e=w("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){y(t,e,n)},p:K,i:K,o:K,d(t){t&&b(e)}}}function Hs(r){let e,t;return e=new ai({props:{routeTool:r[3]}}),{c(){Z(e.$$.fragment)},m(n,i){Q(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ee(e,n)}}}function Xs(r){let e,t;return e=new ui({props:{routeTool:r[3]}}),{c(){Z(e.$$.fragment)},m(n,i){Q(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ee(e,n)}}}function Us(r){let e,t;return e=new li({props:{polygonTool:r[2]}}),{c(){Z(e.$$.fragment)},m(n,i){Q(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ee(e,n)}}}function Js(r){let e,t;return e=new si({props:{pointTool:r[1],editingExisting:!0}}),{c(){Z(e.$$.fragment)},m(n,i){Q(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ee(e,n)}}}function Ws(r){let e,t,n=r[0]==Ze&&Br(r);return{c(){n&&n.c(),e=De()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==Ze?n?(n.p(i,o),o&1&&F(n,1)):(n=Br(i),n.c(),F(n,1),n.m(e.parentNode,e)):n&&(Ie(),B(n,1,1,()=>{n=null}),Be())},i(i){t||(F(n),t=!0)},o(i){B(n),t=!1},d(i){n&&n.d(i),i&&b(e)}}}const Ze="edit-geometry";function fi(){}function Ks(r,e,t){let n;he(r,Ke,_=>t(8,n=_));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:u}=e,l=null,a=null;function h(){l&&(o.stop(),s.stop(),u.stop(),ue.update(_=>{let g=_.features.find(E=>E.id==l);return delete g.properties.hide_while_editing,_})),l=null,t(4,a=null),et.set(null)}n.on("mousemove",v),n.on("mouseout",c),n.on("click",f),Wt(()=>{n.off("mousemove",v),n.off("mouseout",c),n.off("click",f)}),u.addEventListenerSuccessRoute(_=>{i==Ze&&(ue.update(g=>{let E=g.features.find(p=>p.id==l);return E.properties.length_meters=_.properties.length_meters,E.properties.waypoints=_.properties.waypoints,delete E.properties.hide_while_editing,E.geometry=_.geometry,g}),l=null,t(4,a=null))}),u.addEventListenerSuccessArea(_=>{i==Ze&&(ue.update(g=>{let E=g.features.find(p=>p.id==l);return E.properties.waypoints=_.properties.waypoints,delete E.properties.hide_while_editing,E.geometry=_.geometry,g}),l=null,t(4,a=null))});for(let _ of[o,s])_.addEventListenerSuccess(g=>{i==Ze&&(ue.update(E=>{let p=E.features.find(m=>m.id==l);return p.geometry=g.geometry,delete p.properties.hide_while_editing,E}),l=null,t(4,a=null))});for(let _ of[o,s,u])_.addEventListenerFailure(()=>{i==Ze&&(ue.update(g=>{let E=g.features.find(p=>p.id==l);return delete E.properties.hide_while_editing,g}),l=null,t(4,a=null))});function v(_){var g;if(i==Ze&&l==null){let E=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});et.set(((g=E[0])==null?void 0:g.id)||null)}}function c(){i==Ze&&l==null&&et.set(null)}function f(_){if(i==Ze&&l==null){let g=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0&&d(g[0].id)}}function d(_){et.set(null);let g=null;ue.update(p=>(g=p.features.find(m=>m.id==_),g.properties.hide_while_editing=!0,p));let E=g;l=_,E.geometry.type=="LineString"?(u.editExistingRoute(E),t(4,a="route")):E.geometry.type=="Polygon"?E.properties.waypoints?(u.editExistingArea(E),t(4,a="snap-polygon")):(s.editExisting(E),t(4,a="free-polygon")):E.geometry.type=="Point"&&(o.start(),t(4,a="point"))}return r.$$set=_=>{"mode"in _&&t(0,i=_.mode),"pointTool"in _&&t(1,o=_.pointTool),"polygonTool"in _&&t(2,s=_.polygonTool),"routeTool"in _&&t(3,u=_.routeTool)},[i,o,s,u,a,fi,h]}class Vs extends ie{constructor(e){super(),oe(this,e,Ks,Ws,re,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return fi}get stop(){return this.$$.ctx[6]}}async function Zs(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:a,value:h}=await n.read();if(a)break;s.push(h),o+=h.length;const v=100*o/i;e.style=`background: linear-gradient(to right, red ${v}%, transparent 0);`}let u=new Uint8Array(o),l=0;for(let a of s)u.set(a,l),l+=a.length;return u}function Qs(r){let e,t;return e=new ai({props:{routeTool:r[0]}}),{c(){Z(e.$$.fragment)},m(n,i){Q(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ee(e,n)}}}function el(r){let e;return{c(){e=w("div"),e.textContent="Route tool loading..."},m(t,n){y(t,e,n),r[7](e)},p:K,i:K,o:K,d(t){t&&b(e),r[7](null)}}}function tl(r){let e,t,n,i;const o=[el,Qs],s=[];function u(l,a){return l[0]?l[1]==jn?1:-1:0}return~(e=u(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=De()},m(l,a){~e&&s[e].m(l,a),y(l,n,a),i=!0},p(l,[a]){let h=e;e=u(l),e===h?~e&&s[e].p(l,a):(t&&(Ie(),B(s[h],1,1,()=>{s[h]=null}),Be()),~e?(t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),F(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(F(t),i=!0)},o(l){B(t),i=!1},d(l){~e&&s[e].d(l),l&&b(n)}}}const jn="route";function nl(r,e,t){let n;he(r,Ke,c=>t(8,n=c));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,u,{routeTool:l}=e;function a(){l.isActive()||l.startRoute()}function h(){l==null||l.stop()}zn(async()=>{await ii(),console.log(`Grabbing ${s}`);try{const c=await Zs(s,u);t(0,l=new xs(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,u.innerHTML="Failed to load",u);return}l.addEventListenerFailure(()=>{i==jn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{i==jn&&(ue.update(f=>(c.id=Kt(f),c.properties.intervention_type="route",f.features.push(c),f)),o("edit-attribute"),Ce.set(c.id))})});function v(c){Se[c?"unshift":"push"](()=>{u=c,t(2,u)})}return r.$$set=c=>{"mode"in c&&t(1,i=c.mode),"changeMode"in c&&t(3,o=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,i,u,o,s,a,h,v]}class rl extends ie{constructor(e){super(),oe(this,e,nl,tl,re,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Dr(r){let e,t;return e=new si({props:{pointTool:r[1],editingExisting:!1}}),{c(){Z(e.$$.fragment)},m(n,i){Q(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ee(e,n)}}}function il(r){let e,t,n=r[0]==hn&&Dr(r);return{c(){n&&n.c(),e=De()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==hn?n?(n.p(i,o),o&1&&F(n,1)):(n=Dr(i),n.c(),F(n,1),n.m(e.parentNode,e)):n&&(Ie(),B(n,1,1,()=>{n=null}),Be())},i(i){t||(F(n),t=!0)},o(i){B(n),t=!1},d(i){n&&n.d(i),i&&b(e)}}}const hn="point";function ol(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==hn&&(ue.update(a=>(l.id=Kt(a),l.properties.intervention_type="other",a.features.push(l),a)),i("edit-attribute"),Ce.set(l.id))}),o.addEventListenerFailure(()=>{n==hn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,u]}class sl extends ie{constructor(e){super(),oe(this,e,ol,il,re,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function $r(r){let e,t;return e=new li({props:{polygonTool:r[1]}}),{c(){Z(e.$$.fragment)},m(n,i){Q(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ee(e,n)}}}function ll(r){let e,t,n=r[0]==dn&&$r(r);return{c(){n&&n.c(),e=De()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==dn?n?(n.p(i,o),o&1&&F(n,1)):(n=$r(i),n.c(),F(n,1),n.m(e.parentNode,e)):n&&(Ie(),B(n,1,1,()=>{n=null}),Be())},i(i){t||(F(n),t=!0)},o(i){B(n),t=!1},d(i){n&&n.d(i),i&&b(e)}}}const dn="free-polygon";function ul(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==dn&&(ue.update(a=>(l.id=Kt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),Ce.set(l.id))}),o.addEventListenerFailure(()=>{n==dn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,u]}class al extends ie{constructor(e){super(),oe(this,e,ul,ll,re,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Gr(r){let e,t;return e=new ui({props:{routeTool:r[1]}}),{c(){Z(e.$$.fragment)},m(n,i){Q(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){B(e.$$.fragment,n),t=!1},d(n){ee(e,n)}}}function fl(r){let e,t,n=r[0]==mn&&Gr(r);return{c(){n&&n.c(),e=De()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==mn?n?(n.p(i,o),o&1&&F(n,1)):(n=Gr(i),n.c(),F(n,1),n.m(e.parentNode,e)):n&&(Ie(),B(n,1,1,()=>{n=null}),Be())},i(i){t||(F(n),t=!0)},o(i){B(n),t=!1},d(i){n&&n.d(i),i&&b(e)}}}const mn="snap-polygon";function cl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function u(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==mn&&(ue.update(a=>(l.id=Kt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),Ce.set(l.id))}),o.addEventListenerFailure(()=>{n==mn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,u]}class pl extends ie{constructor(e){super(),oe(this,e,cl,fl,re,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function hl(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=ot(r.slice(0,2),[n,t]),s=ot(r.slice(0,2),[e,i]);if(o>=s){var u=(t+i)/2;return[e,u-(n-e)/2,n,u+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function dl(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return Ti(r,function(s){ml(s,o,n)}),r}function ml(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function gl(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=In(r),n=In(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=dl(e,{precision:7});switch(n){case"Point":return qn(r,i);case"MultiPoint":return jr(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return jr(r,ni(r,i))}}function jr(r,e){var t=[],n=Tt();return Xn(e,function(i){if(t.forEach(function(u,l){u.id=l}),!t.length)t=qn(r,i).features,t.forEach(function(u){u.bbox||(u.bbox=hl(Ai(u)))}),n.load(ft(t));else{var o=n.search(i);if(o.features.length){var s=ci(i,o);t=t.filter(function(u){return u.id!==s.id}),n.remove(s),ln(qn(s,i),function(u){t.push(u),n.insert(u)})}}}),ft(t)}function qn(r,e){var t=[],n=Ue(r)[0],i=Ue(r)[r.geometry.coordinates.length-1];if(xn(n,ct(e))||xn(i,ct(e)))return ft([r]);var o=Tt(),s=Bn(r);o.load(s);var u=o.search(e);if(!u.features.length)return ft([r]);var l=ci(e,u),a=[n],h=Pi(s,function(v,c,f){var d=Ue(c)[1],_=ct(e);return f===l.id?(v.push(_),t.push(Rt(v)),xn(_,d)?[_]:[_,d]):(v.push(d),v)},a);return h.length>1&&t.push(Rt(h)),ft(t)}function ci(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return ln(e,function(i){var o=Jt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function xn(r,e){return r[0]===e[0]&&r[1]===e[1]}function _l(r,e,t){var n=Ue(t);if(In(t)!=="LineString")throw new Error("line must be a LineString");var i=Jt(t,r),o=Jt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var u=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)u.push(n[l]);return u.push(s[1].geometry.coordinates),Rt(u,t.properties)}function qr(r){let e;return{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){y(t,e,n)},d(t){t&&b(e)}}}function vl(r){let e,t,n,i=r[0]==Ht&&qr();return{c(){i&&i.c(),e=De()},m(o,s){i&&i.m(o,s),y(o,e,s),t||(n=q(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Ht?i||(i=qr(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:K,o:K,d(o){i&&i.d(o),o&&b(e),t=!1,n()}}}const Ht="split-route",yl=10,bl=30;let Ln="split-route";function pi(){}function zr(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function wl(r,e,t){let n,i;he(r,ue,_=>t(8,n=_)),he(r,Ke,_=>t(6,i=_));let{mode:o}=e,{changeMode:s}=e;function u(){t(5,l=null),a=null}let l=null,a=null;i.on("mousemove",h),i.on("click",v),Wt(()=>{i.off("mousemove",h),i.off("click",v)}),dt(i,Ln,{type:"geojson",data:Je()}),Ee(i,{id:"draw-split-route",source:Ln,...At("black",yl,["case",["==",["get","snapped"],!0],1,.5])});function h(_){if(o!=Ht)return;t(5,l=zr(_.lngLat.toArray(),!1)),a=null;const g=[_.point.x-bl,_.point.y],E=i.unproject(_.point).distanceTo(i.unproject(g))/1e3;let p=[];for(let[m,S]of n.features.entries())if(S.geometry.type=="LineString"){let C=Jt(S.geometry,l,{units:"kilometers"});C.properties.dist!=null&&C.properties.dist<=E&&p.push([m,C.geometry.coordinates,C.properties.dist])}p.sort((m,S)=>m[2]-S[2]),p.length>0&&(t(5,l=zr(p[0][1],!0)),a=p[0][0])}function v(){if(o==Ht)if(a==null)s("edit-attribute");else{let _=gl(n.features[a],l);if(_.features.length==2){let g=_.features[0],E=_.features[1];ue.update(p=>(g.id=p.features[a].id,E.id=Kt(p),g.properties=JSON.parse(JSON.stringify(p.features[a].properties)),E.properties=JSON.parse(JSON.stringify(g.properties)),c(p.features[a],g,E,l),p.features.splice(a,1,g,E),p))}u()}}function c(_,g,E,p){g.properties.length_meters=tn(g,{units:"kilometers"})*1e3,E.properties.length_meters=tn(E,{units:"kilometers"})*1e3,g.properties.waypoints=[],E.properties.waypoints=[];let m=f(_,p),S=!0,C=0;for(let A of _.properties.waypoints){let R=f(_,Ct([A.lon,A.lat]));if(S)if(R<m)g.properties.waypoints.push(A);else{let L=A.snapped&&_.properties.waypoints[C-1].snapped;g.properties.waypoints.push({lon:p.geometry.coordinates[0],lat:p.geometry.coordinates[1],snapped:L}),S=!1,E.properties.waypoints.push({lon:p.geometry.coordinates[0],lat:p.geometry.coordinates[1],snapped:L}),E.properties.waypoints.push(A)}else E.properties.waypoints.push(A);C++}}function f(_,g){let E=_.geometry.coordinates[0],p=_l(E,g,_);return tn(p,{units:"kilometers"})*1e3}function d(_){o==Ht&&_.key=="Escape"&&(s("edit-attribute"),_.preventDefault())}return r.$$set=_=>{"mode"in _&&t(0,o=_.mode),"changeMode"in _&&t(2,s=_.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let _=Je();l&&_.features.push(l),i.getSource(Ln).setData(_)}},[o,d,s,pi,u,l,i]}class kl extends ie{constructor(e){super(),oe(this,e,wl,vl,re,{mode:0,changeMode:2,start:3,stop:4})}get start(){return pi}get stop(){return this.$$.ctx[4]}}function Yr(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new Vs({props:n}),r[17](e),{c(){Z(e.$$.fragment)},m(i,o){Q(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(F(e.$$.fragment,i),t=!0)},o(i){B(e.$$.fragment,i),t=!1},d(i){r[17](null),ee(e,i)}}}function Hr(r){let e,t,n,i,o;return{c(){e=w("button"),t=H("New point"),T(e,"type","button"),e.disabled=n=r[3]=="point",T(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),k(e,t),i||(o=q(e,"click",r[18]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&b(e),i=!1,o()}}}function Xr(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new pl({props:n}),r[23](e),{c(){Z(e.$$.fragment)},m(i,o){Q(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(F(e.$$.fragment,i),t=!0)},o(i){B(e.$$.fragment,i),t=!1},d(i){r[23](null),ee(e,i)}}}function Ur(r){let e,t,n,i,o;return{c(){e=w("button"),t=H("New route"),T(e,"type","button"),e.disabled=n=r[3]=="route",T(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),k(e,t),i||(o=q(e,"click",r[24]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&b(e),i=!1,o()}}}function Jr(r){let e,t,n,i,o;return{c(){e=w("button"),t=H("Split route"),T(e,"type","button"),e.disabled=n=r[3]=="split-route",T(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),k(e,t),i||(o=q(e,"click",r[27]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&b(e),i=!1,o()}}}function Sl(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_,g,E,p,m,S,C,A,R,L,I,$,D,X,O,z,te,de,G,le,_e,Me,ge,pe,ve,xe,ye,Le,Ge={mode:r[3],changeMode:r[13]};u=new As({props:Ge}),r[15](u);let ae=r[2]&&Yr(r),fe=!r[1]&&Hr(r),Ve={mode:r[3],changeMode:r[13],pointTool:r[11]};E=new sl({props:Ve}),r[19](E);let Ye={mode:r[3],changeMode:r[13],polygonTool:r[12]};L=new al({props:Ye}),r[21](L);let V=r[2]&&Xr(r),P=!r[1]&&Ur(r);function U(Y){r[26](Y)}let mt={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(mt.routeTool=r[2]),le=new rl({props:mt}),r[25](le),Se.push(()=>ut(le,"routeTool",U,r[2]));let be=!r[1]&&Jr(r),Ot={mode:r[3],changeMode:r[13]};return ve=new kl({props:Ot}),r[28](ve),{c(){e=w("div"),t=w("div"),n=w("button"),i=H("Edit attributes"),s=x(),Z(u.$$.fragment),l=x(),a=w("div"),h=w("button"),v=H("Edit geometry"),f=x(),ae&&ae.c(),d=x(),_=w("div"),fe&&fe.c(),g=x(),Z(E.$$.fragment),p=x(),m=w("div"),S=w("button"),C=H("New polygon (freehand)"),R=x(),Z(L.$$.fragment),I=x(),$=w("div"),D=w("button"),X=H("New polygon (snapped)"),z=x(),V&&V.c(),te=x(),de=w("div"),P&&P.c(),G=x(),Z(le.$$.fragment),Me=x(),ge=w("div"),be&&be.c(),pe=x(),Z(ve.$$.fragment),T(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",T(n,"class","svelte-cej5os"),T(h,"type","button"),h.disabled=c=r[3]=="edit-geometry",T(h,"class","svelte-cej5os"),T(S,"type","button"),S.disabled=A=r[3]=="free-polygon",T(S,"class","svelte-cej5os"),T(D,"type","button"),D.disabled=O=r[3]=="snap-polygon",T(D,"class","svelte-cej5os"),T(e,"class","toolbox svelte-cej5os")},m(Y,ne){y(Y,e,ne),k(e,t),k(t,n),k(n,i),k(t,s),Q(u,t,null),k(e,l),k(e,a),k(a,h),k(h,v),k(a,f),ae&&ae.m(a,null),k(e,d),k(e,_),fe&&fe.m(_,null),k(_,g),Q(E,_,null),k(e,p),k(e,m),k(m,S),k(S,C),k(m,R),Q(L,m,null),k(e,I),k(e,$),k($,D),k(D,X),k($,z),V&&V.m($,null),k(e,te),k(e,de),P&&P.m(de,null),k(de,G),Q(le,de,null),k(e,Me),k(e,ge),be&&be.m(ge,null),k(ge,pe),Q(ve,ge,null),xe=!0,ye||(Le=[q(n,"click",r[14]),q(h,"click",r[16]),q(S,"click",r[20]),q(D,"click",r[22])],ye=!0)},p(Y,[ne]){(!xe||ne&8&&o!==(o=Y[3]=="edit-attribute"))&&(n.disabled=o);const tt={};ne&8&&(tt.mode=Y[3]),u.$set(tt),(!xe||ne&8&&c!==(c=Y[3]=="edit-geometry"))&&(h.disabled=c),Y[2]?ae?(ae.p(Y,ne),ne&4&&F(ae,1)):(ae=Yr(Y),ae.c(),F(ae,1),ae.m(a,null)):ae&&(Ie(),B(ae,1,1,()=>{ae=null}),Be()),Y[1]?fe&&(fe.d(1),fe=null):fe?fe.p(Y,ne):(fe=Hr(Y),fe.c(),fe.m(_,g));const Ft={};ne&8&&(Ft.mode=Y[3]),E.$set(Ft),(!xe||ne&8&&A!==(A=Y[3]=="free-polygon"))&&(S.disabled=A);const nt={};ne&8&&(nt.mode=Y[3]),L.$set(nt),(!xe||ne&8&&O!==(O=Y[3]=="snap-polygon"))&&(D.disabled=O),Y[2]?V?(V.p(Y,ne),ne&4&&F(V,1)):(V=Xr(Y),V.c(),F(V,1),V.m($,null)):V&&(Ie(),B(V,1,1,()=>{V=null}),Be()),Y[1]?P&&(P.d(1),P=null):P?P.p(Y,ne):(P=Ur(Y),P.c(),P.m(de,G));const rt={};ne&8&&(rt.mode=Y[3]),ne&1&&(rt.url=Y[0]),!_e&&ne&4&&(_e=!0,rt.routeTool=Y[2],at(()=>_e=!1)),le.$set(rt),Y[1]?be&&(be.d(1),be=null):be?be.p(Y,ne):(be=Jr(Y),be.c(),be.m(ge,pe));const Nt={};ne&8&&(Nt.mode=Y[3]),ve.$set(Nt)},i(Y){xe||(F(u.$$.fragment,Y),F(ae),F(E.$$.fragment,Y),F(L.$$.fragment,Y),F(V),F(le.$$.fragment,Y),F(ve.$$.fragment,Y),xe=!0)},o(Y){B(u.$$.fragment,Y),B(ae),B(E.$$.fragment,Y),B(L.$$.fragment,Y),B(V),B(le.$$.fragment,Y),B(ve.$$.fragment,Y),xe=!1},d(Y){Y&&b(e),r[15](null),ee(u),ae&&ae.d(),fe&&fe.d(),r[19](null),ee(E),r[21](null),ee(L),V&&V.d(),P&&P.d(),r[25](null),ee(le),be&&be.d(),r[28](null),ee(ve),ye=!1,We(Le)}}}function El(r,e,t){let n;he(r,Ke,G=>t(29,n=G));let{routeUrl:i}=e,{planningMode:o}=e,s,u=new os(n),l=new _s(n),a="edit-attribute",h,v,c,f,d,_,g;function E(G){let le={"edit-attribute":h,"edit-geometry":v,route:c,point:f,"free-polygon":d,"snap-polygon":_,"split-route":g};if(a==G){console.log(`Mode is already ${a}, not changing`);return}console.log(`Stopping old mode ${a}`),le[a].stop(),t(3,a=G),console.log(`Starting new mode ${a}`),le[a].start()}Wt(()=>{u==null||u.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const p=()=>E("edit-attribute");function m(G){Se[G?"unshift":"push"](()=>{h=G,t(4,h)})}const S=()=>E("edit-geometry");function C(G){Se[G?"unshift":"push"](()=>{v=G,t(5,v)})}const A=()=>E("point");function R(G){Se[G?"unshift":"push"](()=>{f=G,t(7,f)})}const L=()=>E("free-polygon");function I(G){Se[G?"unshift":"push"](()=>{d=G,t(8,d)})}const $=()=>E("snap-polygon");function D(G){Se[G?"unshift":"push"](()=>{_=G,t(9,_)})}const X=()=>E("route");function O(G){Se[G?"unshift":"push"](()=>{c=G,t(6,c)})}function z(G){s=G,t(2,s)}const te=()=>E("split-route");function de(G){Se[G?"unshift":"push"](()=>{g=G,t(10,g)})}return r.$$set=G=>{"routeUrl"in G&&t(0,i=G.routeUrl),"planningMode"in G&&t(1,o=G.planningMode)},[i,o,s,a,h,v,c,f,d,_,g,u,l,E,p,m,S,C,A,R,L,I,$,D,X,O,z,te,de]}class Ml extends ie{constructor(e){super(),oe(this,e,El,Sl,re,{routeUrl:0,planningMode:1})}}function xl(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_,g,E;return{c(){e=w("div"),t=w("div"),n=w("button"),n.textContent="Home",i=x(),o=w("button"),o.textContent="About",s=x(),u=w("button"),u.textContent="Instructions",l=x(),a=w("br"),h=x(),v=w("label"),c=H(`ATIP mode:
      `),f=w("select"),d=w("option"),d.textContent="Design",_=w("option"),_.textContent="Planning",T(n,"type","button"),T(o,"type","button"),T(u,"type","button"),d.__value="design",d.value=d.__value,_.__value="planning",_.value=_.__value,r[2]===void 0&&ht(()=>r[12].call(f)),T(e,"slot","nav")},m(p,m){y(p,e,m),k(e,t),k(t,n),k(t,i),k(t,o),k(t,s),k(t,u),k(e,l),k(e,a),k(e,h),k(e,v),k(v,c),k(v,f),k(f,d),k(f,_),Fe(f,r[2]),g||(E=[q(n,"click",r[11]),q(o,"click",r[8]),q(u,"click",r[9]),q(f,"change",r[12]),q(f,"change",r[10])],g=!0)},p(p,m){m&4&&Fe(f,p[2])},d(p){p&&b(e),g=!1,We(E)}}}function Ll(r){let e,t,n,i,o,s,u,l,a,h,v,c;return o=new Xo({props:{boundaryGeojson:r[4]}}),u=new qo({props:{authorityName:r[5],planningMode:r[7]}}),v=new Bo({props:{planningMode:r[7]}}),{c(){e=w("div"),t=w("h1"),n=H(r[5]),i=x(),Z(o.$$.fragment),s=x(),Z(u.$$.fragment),l=x(),a=w("br"),h=x(),Z(v.$$.fragment),T(e,"slot","sidebar")},m(f,d){y(f,e,d),k(e,t),k(t,n),k(t,i),Q(o,t,null),k(e,s),Q(u,e,null),k(e,l),k(e,a),k(e,h),Q(v,e,null),c=!0},p(f,d){const _={};d&16&&(_.boundaryGeojson=f[4]),o.$set(_)},i(f){c||(F(o.$$.fragment,f),F(u.$$.fragment,f),F(v.$$.fragment,f),c=!0)},o(f){B(o.$$.fragment,f),B(u.$$.fragment,f),B(v.$$.fragment,f),c=!1},d(f){f&&b(e),ee(o),ee(u),ee(v)}}}function Cl(r){let e,t,n,i,o,s,u,l,a,h,v,c;return e=new wo({props:{boundaryGeojson:r[4]}}),n=new ns({props:{planningMode:r[7]}}),o=new is({}),u=new Ml({props:{routeUrl:r[3],planningMode:r[7]}}),a=new Wo({props:{style:r[6]}}),v=new es({props:{planningMode:r[7]}}),{c(){Z(e.$$.fragment),t=x(),Z(n.$$.fragment),i=x(),Z(o.$$.fragment),s=x(),Z(u.$$.fragment),l=x(),Z(a.$$.fragment),h=x(),Z(v.$$.fragment)},m(f,d){Q(e,f,d),y(f,t,d),Q(n,f,d),y(f,i,d),Q(o,f,d),y(f,s,d),Q(u,f,d),y(f,l,d),Q(a,f,d),y(f,h,d),Q(v,f,d),c=!0},p(f,d){const _={};d&16&&(_.boundaryGeojson=f[4]),e.$set(_);const g={};d&8&&(g.routeUrl=f[3]),u.$set(g)},i(f){c||(F(e.$$.fragment,f),F(n.$$.fragment,f),F(o.$$.fragment,f),F(u.$$.fragment,f),F(a.$$.fragment,f),F(v.$$.fragment,f),c=!0)},o(f){B(e.$$.fragment,f),B(n.$$.fragment,f),B(o.$$.fragment,f),B(u.$$.fragment,f),B(a.$$.fragment,f),B(v.$$.fragment,f),c=!1},d(f){ee(e,f),f&&b(t),ee(n,f),f&&b(i),ee(o,f),f&&b(s),ee(u,f),f&&b(l),ee(a,f),f&&b(h),ee(v,f)}}}function Rl(r){let e,t,n;return t=new ji({props:{style:r[6],$$slots:{default:[Cl]},$$scope:{ctx:r}}}),{c(){e=w("div"),Z(t.$$.fragment),T(e,"slot","main")},m(i,o){y(i,e,o),Q(t,e,null),n=!0},p(i,o){const s={};o&262168&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(F(t.$$.fragment,i),n=!0)},o(i){B(t.$$.fragment,i),n=!1},d(i){i&&b(e),ee(t)}}}function Tl(r){let e,t,n,i,o,s,u,l;e=new Ui({props:{$$slots:{main:[Rl],sidebar:[Ll],nav:[xl]},$$scope:{ctx:r}}});function a(f){r[13](f)}let h={};r[0]!==void 0&&(h.open=r[0]),n=new Oi({props:h}),Se.push(()=>ut(n,"open",a,r[0]));function v(f){r[14](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Di({props:c}),Se.push(()=>ut(s,"open",v,r[1])),{c(){Z(e.$$.fragment),t=x(),Z(n.$$.fragment),o=x(),Z(s.$$.fragment)},m(f,d){Q(e,f,d),y(f,t,d),Q(n,f,d),y(f,o,d),Q(s,f,d),l=!0},p(f,[d]){const _={};d&262172&&(_.$$scope={dirty:d,ctx:f}),e.$set(_);const g={};!i&&d&1&&(i=!0,g.open=f[0],at(()=>i=!1)),n.$set(g);const E={};!u&&d&2&&(u=!0,E.open=f[1],at(()=>u=!1)),s.$set(E)},i(f){l||(F(e.$$.fragment,f),F(n.$$.fragment,f),F(s.$$.fragment,f),l=!0)},o(f){B(e.$$.fragment,f),B(n.$$.fragment,f),B(s.$$.fragment,f),l=!1},d(f){ee(e,f),f&&b(t),ee(n,f),f&&b(o),ee(s,f)}}}function Al(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let u=s.get("authority"),l=s.get("style")||"streets",a=s.has("planning"),h=a?"planning":"design";var v=`https://atip.uk/route-snappers/${u}.bin`;o||(v=`https://atip.uk/route-snappers-dev/${u}.bin`);function c(){t(0,n=!n),t(1,i=!1)}function f(){t(1,i=!i),t(0,n=!1)}let d;zn(async()=>{t(4,d=await _())});async function _(){const A=await(await fetch(Fi)).text(),R=JSON.parse(A);return R.features=R.features.filter(L=>{var I;return((I=L.properties)==null?void 0:I.name)==u}),R}function g(){let C=new URLSearchParams(window.location.search);h=="design"?C.delete("planning"):C.set("planning","");let A=`${window.location.pathname}?${C.toString()}${window.location.hash}`;window.location.href=A}const E=()=>window.open("index.html");function p(){h=Mt(this),t(2,h)}function m(C){n=C,t(0,n)}function S(C){i=C,t(1,i)}return[n,i,h,v,d,u,l,a,c,f,g,E,p,m,S]}class Pl extends ie{constructor(e){super(),oe(this,e,Al,Tl,re,{})}}new Pl({target:document.getElementById("app")});
