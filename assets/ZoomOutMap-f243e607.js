import{r as pe,o as q,n as $,S as j,i as E,s as z,e as h,t as I,j as ee,ah as _e,f as m,g as v,h as b,ai as te,l as T,L as O,p as w,ag as ye,G as ve,aq as J,c as B,av as se,ar as N,as as Z,at as V,z as H,B as we,E as ne,D as le,C as ke,J as Se,I as Ce,H as oe,ao as ie,K as $e,ad as Le,a5 as me,a6 as ge,al as ae,aw as W,M as he,d as Me,m as Ie,q as Oe,a4 as F,ax as Be,u as qe,b as De,ac as ze,w as Fe}from"./maplibre_helpers-549cabd3.js";function ft(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function pt(s,e){q(s,1,1,()=>{e.delete(s.key)})}function _t(s,e,n,t,l,o,i,r,c,a,u,g){let f=s.length,p=o.length,y=f;const k={};for(;y--;)k[s[y].key]=y;const d=[],_=new Map,A=new Map,X=[];for(y=p;y--;){const S=g(l,o,y),L=n(S);let M=i.get(L);M?t&&X.push(()=>M.p(S,e)):(M=a(L,S),M.c()),_.set(L,d[y]=M),L in k&&A.set(L,Math.abs(y-k[L]))}const Y=new Set,x=new Set;function K(S){$(S,1),S.m(r,u),i.set(S.key,S),u=S.first,p--}for(;f&&p;){const S=d[p-1],L=s[f-1],M=S.key,G=L.key;S===L?(u=S.first,f--,p--):_.has(G)?!i.has(M)||Y.has(M)?K(S):x.has(G)?f--:A.get(M)>A.get(G)?(x.add(M),K(S)):(Y.add(G),f--):(c(L,i),f--)}for(;f--;){const S=s[f];_.has(S.key)||c(S,i)}for(;p;)K(d[p-1]);return pe(X),d}function je(s){let e,n,t,l,o,i,r;return{c(){e=h("div"),n=I(`Basemap:
  `),t=h("select"),l=h("option"),l.textContent="Streets",o=h("option"),o.textContent="Satellite",l.__value="streets",ee(l,l.__value),o.__value="hybrid",ee(o,o.__value),s[0]===void 0&&_e(()=>s[2].call(t)),m(e,"class","svelte-1tbnm6i")},m(c,a){v(c,e,a),b(e,n),b(e,t),b(t,l),b(t,o),te(t,s[0],!0),i||(r=[T(t,"change",s[2]),T(t,"change",s[1])],i=!0)},p(c,[a]){a&1&&te(t,c[0])},i:O,o:O,d(c){c&&w(e),i=!1,pe(r)}}}function Ee(s,e,n){let{style:t}=e;function l(){let i=new URLSearchParams(window.location.search);i.set("style",t);let r=`${window.location.pathname}?${i.toString()}${window.location.hash}`;window.location.href=r}function o(){t=ye(this),n(0,t)}return s.$$set=i=>{"style"in i&&n(0,t=i.style)},[t,l,o]}class mt extends j{constructor(e){super(),E(this,e,Ee,je,z,{style:0})}}const R=[];function D(s,e=O){let n;const t=new Set;function l(r){if(z(s,r)&&(s=r,n)){const c=!R.length;for(const a of t)a[1](),R.push(a,s);if(c){for(let a=0;a<R.length;a+=2)R[a][0](R[a+1]);R.length=0}}}function o(r){l(r(s))}function i(r,c=O){const a=[r,c];return t.add(a),t.size===1&&(n=e(l,o)||O),r(s),()=>{t.delete(a),t.size===0&&n&&(n(),n=null)}}return{set:l,update:o,subscribe:i}}function Pe(s){return s=="google"||s=="bing"}function gt(s){return{v1:"Scheme Design",v2:"Experimental Scheme Design",planning:"Development Planning",criticals:"Critical Issues"}[s]}const U=D(null),ht=D(null),be=D(ve()),Re=D(null),Te=D(null),Ge=D(null),We=D(null),Je=D(Ne());Je.subscribe(s=>window.localStorage.setItem("userSettings",JSON.stringify(s)));const bt=D("edit-attribute"),yt=D(!1);function vt(s){let e=new Set;for(let t of s.features)e.add(t.id);let n=e.size+1;for(;e.has(n);)n++;return n}function wt(s){console.log(`Deleting intervention ${s}`),be.update(e=>(e.features=e.features.filter(n=>n.id!=s),e)),Re.set(null),Te.set(null),Ge.set(null),We.set(null)}function Ne(){let s={streetViewImagery:"google",avoidDoublingBack:!1};try{let e=JSON.parse(window.localStorage.getItem("userSettings")||"{}");Pe(e.streetViewImagery)&&(s.streetViewImagery=e.streetViewImagery),typeof e.avoidDoublingBack=="boolean"&&(s.avoidDoublingBack=e.avoidDoublingBack)}catch(e){console.log(`Couldn't parse userSettings from local storage: ${e}`)}return s}const Ze=s=>({}),re=s=>({}),Ve=s=>({}),ce=s=>({});function He(s){let e,n,t,l,o,i,r,c,a,u,g;const f=s[3].sidebar,p=J(f,s,s[2],ce),y=s[3].main,k=J(y,s,s[2],re);return{c(){e=h("div"),n=h("aside"),t=h("div"),p&&p.c(),l=B(),o=h("button"),o.textContent="â†’",r=B(),c=h("main"),k&&k.c(),m(t,"class","sidebar-content content-container svelte-ect12w"),m(o,"type","button"),m(o,"class","sidebar-toggle rounded-rect svelte-ect12w"),m(n,"class",i=se(s[0]?"":"collapsed")+" svelte-ect12w"),m(c,"class","svelte-ect12w"),m(e,"class","overall-layout svelte-ect12w")},m(d,_){v(d,e,_),b(e,n),b(n,t),p&&p.m(t,null),b(n,l),b(n,o),b(e,r),b(e,c),k&&k.m(c,null),a=!0,u||(g=T(o,"click",s[1]),u=!0)},p(d,[_]){p&&p.p&&(!a||_&4)&&N(p,f,d,d[2],a?V(f,d[2],_,Ve):Z(d[2]),ce),(!a||_&1&&i!==(i=se(d[0]?"":"collapsed")+" svelte-ect12w"))&&m(n,"class",i),k&&k.p&&(!a||_&4)&&N(k,y,d,d[2],a?V(y,d[2],_,Ze):Z(d[2]),re)},i(d){a||($(p,d),$(k,d),a=!0)},o(d){q(p,d),q(k,d),a=!1},d(d){d&&w(e),p&&p.d(d),k&&k.d(d),u=!1,g()}}}function Ue(s,e,n){let{$$slots:t={},$$scope:l}=e,o=!0;function i(){n(0,o=!o)}return s.$$set=r=>{"$$scope"in r&&n(2,l=r.$$scope)},[o,i,l,t]}class kt extends j{constructor(e){super(),E(this,e,Ue,He,z,{})}}const C={area:"#D94324",route:"#555F5E",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Ae=10,Q=10;let P="interventions";function Ke(s,e,n){let t,l;H(s,U,u=>n(1,t=u)),H(s,be,u=>n(2,l=u));let{schema:o}=e;we(t,P,l);const i=["match",["get","intervention_type"],"area",C.area,"route",C.route,"crossing",C.crossing,"other",C.other,"white"],r=["match",["get","reference_type",["get","planning"]],"preapp",C.preapp,"outline",C.outline,"reserved matters",C["reserved matters"],"local plan",C["local plan"],"white"],c=["!=","hide_while_editing",!0];return ne(t,{id:"interventions-points",source:P,filter:["all",Se,c,["!=","endpoint",!0]],color:i,radius:Ae}),le(t,{id:"interventions-lines",source:P,filter:["all",Ce,c],color:i,width:Q}),ne(t,{id:"interventions-lines-endpoints",source:P,filter:["==","endpoint",!0],radius:.5*Q,opacity:0,strokeColor:C.lineEndpointColor,strokeWidth:2}),ke(t,{id:"interventions-polygons",source:P,filter:["all",oe,c],color:o=="planning"?r:i,opacity:.2}),le(t,{id:"interventions-polygon-outlines",source:P,filter:["all",oe,c],color:o=="planning"?r:i,opacity:.5,width:.7*Q}),s.$$set=u=>{"schema"in u&&n(0,o=u.schema)},s.$$.update=()=>{if(s.$$.dirty&6){let u=JSON.parse(JSON.stringify(l)),g=[];for(let f of u.features)if(f.geometry.type=="LineString"&&!f.properties.hide_while_editing)for(let p of[f.geometry.coordinates[0],f.geometry.coordinates[f.geometry.coordinates.length-1]])g.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:p}});u.features=u.features.concat(g),t.getSource(P).setData(u)}},[o,t,l]}class St extends j{constructor(e){super(),E(this,e,Ke,null,z,{schema:0})}}function Qe(s){const e=s-1;return e*e*e+1}function ue(s,{delay:e=0,duration:n=400,easing:t=Qe,axis:l="y"}={}){const o=getComputedStyle(s),i=+o.opacity,r=l==="y"?"height":"width",c=parseFloat(o[r]),a=l==="y"?["top","bottom"]:["left","right"],u=a.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),g=parseFloat(o[`padding${u[0]}`]),f=parseFloat(o[`padding${u[1]}`]),p=parseFloat(o[`margin${u[0]}`]),y=parseFloat(o[`margin${u[1]}`]),k=parseFloat(o[`border${u[0]}Width`]),d=parseFloat(o[`border${u[1]}Width`]);return{delay:e,duration:n,easing:t,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*i};${r}: ${_*c}px;padding-${a[0]}: ${_*g}px;padding-${a[1]}: ${_*f}px;margin-${a[0]}: ${_*p}px;margin-${a[1]}: ${_*y}px;border-${a[0]}-width: ${_*k}px;border-${a[1]}-width: ${_*d}px;`}}function de(s){let e,n,t;const l=s[3].default,o=J(l,s,s[2],null);return{c(){e=h("div"),o&&o.c()},m(i,r){v(i,e,r),o&&o.m(e,null),t=!0},p(i,r){o&&o.p&&(!t||r&4)&&N(o,l,i,i[2],t?V(l,i[2],r,null):Z(i[2]),null)},i(i){t||($(o,i),i&&_e(()=>{t&&(n||(n=ae(e,ue,{duration:100},!0)),n.run(1))}),t=!0)},o(i){q(o,i),i&&(n||(n=ae(e,ue,{duration:100},!1)),n.run(0)),t=!1},d(i){i&&w(e),o&&o.d(i),i&&n&&n.end()}}}function Xe(s){let e,n,t,l,o,i,r,c,a,u,g=s[0]&&de(s);return{c(){e=h("button"),n=ie("svg"),t=ie("path"),l=B(),o=I(s[1]),i=B(),g&&g.c(),r=$e(),m(t,"d","M9 5l7 7-7 7"),m(n,"style","tran"),m(n,"width","20"),m(n,"height","20"),m(n,"fill","none"),m(n,"stroke-linecap","round"),m(n,"stroke-linejoin","round"),m(n,"stroke-width","2"),m(n,"viewBox","0 0 24 24"),m(n,"stroke","currentColor"),m(n,"class","svelte-una9lq"),m(e,"aria-expanded",s[0]),m(e,"class","svelte-una9lq")},m(f,p){v(f,e,p),b(e,n),b(n,t),b(e,l),b(e,o),v(f,i,p),g&&g.m(f,p),v(f,r,p),c=!0,a||(u=T(e,"click",s[4]),a=!0)},p(f,[p]){(!c||p&2)&&Le(o,f[1]),(!c||p&1)&&m(e,"aria-expanded",f[0]),f[0]?g?(g.p(f,p),p&1&&$(g,1)):(g=de(f),g.c(),$(g,1),g.m(r.parentNode,r)):g&&(me(),q(g,1,1,()=>{g=null}),ge())},i(f){c||($(g),c=!0)},o(f){q(g),c=!1},d(f){f&&(w(e),w(i),w(r)),g&&g.d(f),a=!1,u()}}}function Ye(s,e,n){let{$$slots:t={},$$scope:l}=e,{label:o}=e,{open:i=!1}=e;const r=()=>n(0,i=!i);return s.$$set=c=>{"label"in c&&n(1,o=c.label),"open"in c&&n(0,i=c.open),"$$scope"in c&&n(2,l=c.$$scope)},[i,o,l,t,r]}class xe extends j{constructor(e){super(),E(this,e,Ye,Xe,z,{label:1,open:0})}}function et(s,e,n){let t;H(s,U,a=>n(2,t=a));let{layers:l}=e,{contents:o}=e,i=new W.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"none"});t.on("mousemove",r),t.on("mouseout",c),he(()=>{t.off("mousemove",r),t.off("mouseout",c),i.remove()});function r(a){if(!l.every(g=>t.getLayer(g))){i.remove();return}let u=t.queryRenderedFeatures(a.point,{layers:l});u.length>0?i.setLngLat(a.lngLat).setHTML(o(u[0].properties)).addTo(t):i.remove()}function c(){i.remove()}return s.$$set=a=>{"layers"in a&&n(0,l=a.layers),"contents"in a&&n(1,o=a.contents)},[l,o]}class Ct extends j{constructor(e){super(),E(this,e,et,null,z,{layers:0,contents:1})}}function tt(s){let e,n,t,l,o,i,r,c,a,u,g,f,p,y,k;return{c(){e=h("li"),n=h("span"),t=I("Areas"),l=B(),o=h("li"),i=h("span"),r=I("Routes"),c=B(),a=h("li"),u=h("span"),g=I("Crossings"),f=B(),p=h("li"),y=h("span"),k=I("Other"),m(n,"class","svelte-l42ea0"),F(n,"background",C.area),m(i,"class","svelte-l42ea0"),F(i,"background",C.route),m(u,"class","svelte-l42ea0"),F(u,"background",C.crossing),m(y,"class","svelte-l42ea0"),F(y,"background",C.other)},m(d,_){v(d,e,_),b(e,n),b(e,t),v(d,l,_),v(d,o,_),b(o,i),b(o,r),v(d,c,_),v(d,a,_),b(a,u),b(a,g),v(d,f,_),v(d,p,_),b(p,y),b(p,k)},p:O,d(d){d&&(w(e),w(l),w(o),w(c),w(a),w(f),w(p))}}}function st(s){let e,n,t,l,o,i,r,c,a,u,g,f,p,y,k;return{c(){e=h("li"),n=h("span"),t=I("Preapp"),l=B(),o=h("li"),i=h("span"),r=I("Outline"),c=B(),a=h("li"),u=h("span"),g=I("Reserved matters"),f=B(),p=h("li"),y=h("span"),k=I("Local plan"),m(n,"class","svelte-l42ea0"),F(n,"background",C.preapp),m(i,"class","svelte-l42ea0"),F(i,"background",C.outline),m(u,"class","svelte-l42ea0"),F(u,"background",C["reserved matters"]),m(y,"class","svelte-l42ea0"),F(y,"background",C["local plan"])},m(d,_){v(d,e,_),b(e,n),b(e,t),v(d,l,_),v(d,o,_),b(o,i),b(o,r),v(d,c,_),v(d,a,_),b(a,u),b(a,g),v(d,f,_),v(d,p,_),b(p,y),b(p,k)},p:O,d(d){d&&(w(e),w(l),w(o),w(c),w(a),w(f),w(p))}}}function nt(s){let e;function n(o,i){return o[0]=="planning"?st:tt}let t=n(s),l=t(s);return{c(){e=h("ul"),l.c()},m(o,i){v(o,e,i),l.m(e,null)},p(o,i){t===(t=n(o))&&l?l.p(o,i):(l.d(1),l=t(o),l&&(l.c(),l.m(e,null)))},d(o){o&&w(e),l.d()}}}function lt(s){let e,n,t;return n=new xe({props:{label:"Objects",open:!0,$$slots:{default:[nt]},$$scope:{ctx:s}}}),{c(){e=h("div"),Me(n.$$.fragment),m(e,"class","svelte-l42ea0")},m(l,o){v(l,e,o),Ie(n,e,null),t=!0},p(l,[o]){const i={};o&3&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||($(n.$$.fragment,l),t=!0)},o(l){q(n.$$.fragment,l),t=!1},d(l){l&&w(e),Oe(n)}}}function ot(s,e,n){let{schema:t}=e;return s.$$set=l=>{"schema"in l&&n(0,t=l.schema)},[t]}class $t extends j{constructor(e){super(),E(this,e,ot,lt,z,{schema:0})}}function fe(s){let e;const n=s[4].default,t=J(n,s,s[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&N(t,n,l,l[3],e?V(n,l[3],o,null):Z(l[3]),null)},i(l){e||($(t,l),e=!0)},o(l){q(t,l),e=!1},d(l){t&&t.d(l)}}}function it(s){let e,n,t=s[1]&&fe(s);return{c(){e=h("div"),t&&t.c(),m(e,"class","map svelte-12dpf1u")},m(l,o){v(l,e,o),t&&t.m(e,null),s[5](e),n=!0},p(l,[o]){l[1]?t?(t.p(l,o),o&2&&$(t,1)):(t=fe(l),t.c(),$(t,1),t.m(e,null)):t&&(me(),q(t,1,1,()=>{t=null}),ge())},i(l){n||($(t),n=!0)},o(l){q(t),n=!1},d(l){l&&w(e),t&&t.d(),s[5](null)}}}function at(s,e,n){let{$$slots:t={},$$scope:l}=e,{style:o}=e,i,r,c=!1;Be("setCamera",!window.location.hash),qe(()=>{i=new W.Map({container:r,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),i.addControl(new W.ScaleControl({})),i.addControl(new W.NavigationControl({visualizePitch:!0}),"bottom-right"),i.on("load",()=>{n(1,c=!0),U.set(i)}),new ResizeObserver(()=>{i.resize()}).observe(r)}),he(()=>{i.remove()});function a(u){De[u?"unshift":"push"](()=>{r=u,n(0,r)})}return s.$$set=u=>{"style"in u&&n(2,o=u.style),"$$scope"in u&&n(3,l=u.$$scope)},[r,c,o,l,t,a]}class Lt extends j{constructor(e){super(),E(this,e,at,it,z,{style:2})}}const rt="/atip/assets/zoom_out_map-b2e1091a.svg";function ct(s){let e,n,t,l,o;return{c(){e=h("button"),n=h("img"),ze(n.src,t=rt)||m(n,"src",t),m(n,"alt","Zoom to show entire boundary"),m(e,"type","button"),m(e,"title","Zoom to show entire boundary"),m(e,"class","svelte-qzjsqo")},m(i,r){v(i,e,r),b(e,n),l||(o=T(e,"click",s[0]),l=!0)},p:O,i:O,o:O,d(i){i&&w(e),l=!1,o()}}}function ut(s,e,n){let t;H(s,U,i=>n(2,t=i));let{boundaryGeojson:l}=e;function o(){t.fitBounds(Fe(l),{padding:20,animate:!0,duration:500})}return s.$$set=i=>{"boundaryGeojson"in i&&n(1,l=i.boundaryGeojson)},[o,l]}class Mt extends j{constructor(e){super(),E(this,e,ut,ct,z,{boundaryGeojson:1})}}export{mt as B,xe as C,St as I,kt as L,Ct as M,Mt as Z,Te as a,Ae as b,C as c,bt as d,ft as e,Re as f,be as g,ue as h,yt as i,_t as j,pt as k,Q as l,U as m,vt as n,We as o,wt as p,gt as q,ht as r,Ge as s,Lt as t,Je as u,$t as v};
