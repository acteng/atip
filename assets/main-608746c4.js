import{S as X,i as Y,s as x,c as we,a as Q,e as b,b as ue,d as I,l as H,u as ye,g as $e,f as Ae,h as Se,t as M,j as F,k as T,m as re,n as ve,o as fe,p as P,q as y,r as h,v as _,w as ee,x as ce,y as Ee,z as Me,A as W,B as Be,C as Fe,F as Ie,D as Z,E as de,G as Te,H as j,I as C,J as Le,K as _e,L as J,M as Ne,N as je,O as Ce,P as Je,Q as Oe}from"./maplibre_helpers-09c65b90.js";import{i as De}from"./all-cc94300b.js";import{a as Pe,A as Ge}from"./About-59e5ef48.js";function qe(n){let t,e,l,u;const c=n[2].default,s=we(c,n,n[1],null);let f=[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},n[0]],i={};for(let o=0;o<f.length;o+=1)i=Q(i,f[o]);return{c(){t=b("button"),s&&s.c(),ue(t,i)},m(o,a){I(o,t,a),s&&s.m(t,null),t.autofocus&&t.focus(),e=!0,l||(u=H(t,"click",n[3]),l=!0)},p(o,[a]){s&&s.p&&(!e||a&2)&&ye(s,c,o,o[1],e?Ae(c,o[1],a,null):$e(o[1]),null),ue(t,i=Se(f,[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},a&1&&o[0]]))},i(o){e||(M(s,o),e=!0)},o(o){F(s,o),e=!1},d(o){o&&T(t),s&&s.d(o),l=!1,u()}}}function Re(n,t,e){let{$$slots:l={},$$scope:u}=t;function c(s){ve.call(this,n,s)}return n.$$set=s=>{e(0,t=Q(Q({},t),re(s))),"$$scope"in s&&e(1,u=s.$$scope)},t=re(t),[t,u,l,c]}class Ue extends X{constructor(t){super(),Y(this,t,Re,qe,x,{})}}function he(n,t,e){const l=n.slice();return l[7]=t[e][0],l[8]=t[e][1],l}function pe(n){let t,e,l,u,c=!1,s,f,i=n[8]+"",o,a,d,B,L,$;return B=Me(n[6][0]),{c(){t=b("div"),e=b("input"),s=y(),f=b("label"),o=P(i),d=y(),h(e,"class","govuk-radios__input"),h(e,"id",l=n[2]+n[7]),h(e,"type","radio"),e.__value=u=n[7],W(e,e.__value),h(f,"class","govuk-label govuk-radios__label"),h(f,"for",a=n[2]+n[7]),h(t,"class","govuk-radios__item"),B.p(e)},m(v,E){I(v,t,E),_(t,e),e.checked=e.__value===n[0],_(t,s),_(t,f),_(f,o),_(t,d),L||($=[H(e,"change",n[5]),H(e,"change",n[4])],L=!0)},p(v,E){E&12&&l!==(l=v[2]+v[7])&&h(e,"id",l),E&8&&u!==(u=v[7])&&(e.__value=u,W(e,e.__value),c=!0),(c||E&9)&&(e.checked=e.__value===v[0]),E&8&&i!==(i=v[8]+"")&&ee(o,i),E&12&&a!==(a=v[2]+v[7])&&h(f,"for",a)},d(v){v&&T(t),B.r(),L=!1,Be($)}}}function Ve(n){let t,e,l,u,c,s,f=fe(n[3]),i=[];for(let o=0;o<f.length;o+=1)i[o]=pe(he(n,f,o));return{c(){t=b("div"),e=b("fieldset"),l=b("legend"),u=P(n[1]),c=y(),s=b("div");for(let o=0;o<i.length;o+=1)i[o].c();h(l,"class","govuk-fieldset__legend"),h(s,"class","govuk-radios"),h(s,"data-module","govuk-radios"),h(e,"class","govuk-fieldset"),h(t,"class","govuk-form-group")},m(o,a){I(o,t,a),_(t,e),_(e,l),_(l,u),_(e,c),_(e,s);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(s,null)},p(o,[a]){if(a&2&&ee(u,o[1]),a&13){f=fe(o[3]);let d;for(d=0;d<f.length;d+=1){const B=he(o,f,d);i[d]?i[d].p(B,a):(i[d]=pe(B),i[d].c(),i[d].m(s,null))}for(;d<i.length;d+=1)i[d].d(1);i.length=f.length}},i:ce,o:ce,d(o){o&&T(t),Ee(i,o)}}}function He(n,t,e){let{legend:l}=t,{id:u}=t,{choices:c}=t,{value:s}=t;const f=[[]];function i(a){ve.call(this,n,a)}function o(){s=this.__value,e(0,s)}return n.$$set=a=>{"legend"in a&&e(1,l=a.legend),"id"in a&&e(2,u=a.id),"choices"in a&&e(3,c=a.choices),"value"in a&&e(0,s=a.value)},[s,l,u,c,i,o,f]}class We extends X{constructor(t){super(),Y(this,t,He,Ve,x,{legend:1,id:2,choices:3,value:0})}}async function ze(){const t=await(await fetch(Pe)).text();return JSON.parse(t)}function Ke(n){let t;return{c(){t=P("About")},m(e,l){I(e,t,l)},d(e){e&&T(t)}}}function ge(n){let t,e;return t=new je({props:{errorMessage:n[2]}}),{c(){j(t.$$.fragment)},m(l,u){C(t,l,u),e=!0},p(l,u){const c={};u&4&&(c.errorMessage=l[2]),t.$set(c)},i(l){e||(M(t.$$.fragment,l),e=!0)},o(l){F(t.$$.fragment,l),e=!1},d(l){J(t,l)}}}function Qe(n){let t,e,l,u,c;return{c(){t=b("input"),e=y(),l=b("datalist"),h(t,"class","govuk-input govuk-input--width-20"),h(t,"id","inputValue"),h(t,"data-testid","transport-authority"),h(t,"list","authorities-list"),h(l,"id","authorities-list")},m(s,f){I(s,t,f),W(t,n[0]),I(s,e,f),I(s,l,f),n[12](l),u||(c=H(t,"input",n[11]),u=!0)},p(s,f){f&1&&t.value!==s[0]&&W(t,s[0])},d(s){s&&(T(t),T(e),T(l)),n[12](null),u=!1,c()}}}function Ze(n){let t;return{c(){t=P("Start")},m(e,l){I(e,t,l)},d(e){e&&T(t)}}}function me(n){let t,e;return{c(){t=b("i"),e=P(n[5])},m(l,u){I(l,t,u),_(t,e)},p(l,u){u&32&&ee(e,l[5])},d(l){l&&T(t)}}}function Xe(n){let t,e,l,u,c,s,f,i,o,a,d,B,L,$,v,E,O,G,q,R,p,g,N,k,S,z,U;c=new Fe({props:{$$slots:{default:[Ke]},$$scope:{ctx:n}}}),c.$on("click",n[10]);let m=n[2]&&ge(n);i=new Ie({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[Qe]},$$scope:{ctx:n}}}),a=new Ue({props:{disabled:!n[6],$$slots:{default:[Ze]},$$scope:{ctx:n}}}),a.$on("click",n[9]);function be(r){n[13](r)}let te={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]]};n[4]!==void 0&&(te.value=n[4]),$=new We({props:te}),Z.push(()=>de($,"value",be)),$.$on("change",n[7]);let A=n[5]&&me(n),ne=Ye;p=new Te({props:{label:"Or upload an ATIP GeoJSON file",loadFile:n[8],id:"load-geojson"}});function ke(r){n[14](r)}let le={};return n[1]!==void 0&&(le.open=n[1]),S=new Ge({props:le}),Z.push(()=>de(S,"open",ke)),{c(){t=b("div"),e=b("div"),l=b("h1"),l.textContent="Welcome to ATIP v2",u=y(),j(c.$$.fragment),s=y(),m&&m.c(),f=y(),j(i.$$.fragment),o=y(),j(a.$$.fragment),d=y(),B=b("hr"),L=y(),j($.$$.fragment),E=y(),A&&A.c(),O=y(),G=b("hr"),q=y(),R=y(),j(p.$$.fragment),g=y(),N=b("div"),N.innerHTML='<div id="map" class="svelte-lyn11h"></div>',k=y(),j(S.$$.fragment),h(l,"class","govuk-heading-l"),h(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),h(N,"class","govuk-grid-column-one-half"),h(t,"class","govuk-grid-row")},m(r,w){I(r,t,w),_(t,e),_(e,l),_(e,u),C(c,e,null),_(e,s),m&&m.m(e,null),_(e,f),C(i,e,null),_(e,o),C(a,e,null),_(e,d),_(e,B),_(e,L),C($,e,null),_(e,E),A&&A.m(e,null),_(e,O),_(e,G),_(e,q),_(e,R),C(p,e,null),_(t,g),_(t,N),I(r,k,w),C(S,r,w),U=!0},p(r,[w]){const ae={};w&262144&&(ae.$$scope={dirty:w,ctx:r}),c.$set(ae),r[2]?m?(m.p(r,w),w&4&&M(m,1)):(m=ge(r),m.c(),M(m,1),m.m(e,f)):m&&(Ce(),F(m,1,1,()=>{m=null}),Le());const oe={};w&262153&&(oe.$$scope={dirty:w,ctx:r}),i.$set(oe);const K={};w&64&&(K.disabled=!r[6]),w&262144&&(K.$$scope={dirty:w,ctx:r}),a.$set(K);const se={};!v&&w&16&&(v=!0,se.value=r[4],_e(()=>v=!1)),$.$set(se),r[5]?A?A.p(r,w):(A=me(r),A.c(),A.m(e,O)):A&&(A.d(1),A=null);const ie={};!z&&w&2&&(z=!0,ie.open=r[1],_e(()=>z=!1)),S.$set(ie)},i(r){U||(M(c.$$.fragment,r),M(m),M(i.$$.fragment,r),M(a.$$.fragment,r),M($.$$.fragment,r),M(ne),M(p.$$.fragment,r),M(S.$$.fragment,r),U=!0)},o(r){F(c.$$.fragment,r),F(m),F(i.$$.fragment,r),F(a.$$.fragment,r),F($.$$.fragment,r),F(ne),F(p.$$.fragment,r),F(S.$$.fragment,r),U=!1},d(r){r&&(T(t),T(k)),J(c),m&&m.d(),J(i),J(a),J($),A&&A.d(),J(p),J(S,r)}}}let Ye="",V="boundary",D="boundary-layer";function xe(n){if(n.features.length>0){let t=n.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function et(n,t,e){let l,u=!1,s=new URLSearchParams(window.location.search).get("error")||"",f,i,o=new Set,a=null,d="TA";function B(){a==null||a.setFilter(D,["==",["get","level"],d])}let L=null;Ne(async()=>{De();const p=await ze();for(let k of p.features){let S=document.createElement("option");S.value=k.properties.name,i.appendChild(S),o.add(k.properties.name)}a=new Je.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let g=null;function N(){g!==null&&a.setFeatureState({source:V,id:g},{hover:!1})}a.on("load",function(){a.fitBounds(Oe(p),{padding:20,animate:!1}),a.addSource(V,{type:"geojson",data:p,generateId:!0}),a.addLayer({id:D,source:V,filter:["==",["get","level"],d],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),a.on("mousemove",D,k=>{k.features.length>0&&(N(),g=k.features[0].id,e(5,L=k.features[0].properties.name),a.setFeatureState({source:V,id:g},{hover:!0}))}),a.on("mouseleave",D,()=>{N(),g=null,e(5,L=null)}),a.on("click",D,function(k){let S=k.features[0].properties.name;window.location.href=`scheme.html?authority=${S}`})})});function $(p){try{let g=JSON.parse(p);if(!g.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!o.has(g.authority))throw new Error(`Unknown authority ${g.authority}`);let N=g.authority,k=xe(g);k!="v1"&&(N+=`_${k}`),window.localStorage.setItem(N,JSON.stringify(g)),window.location.href=`scheme.html?authority=${g.authority}&schema=${k}`}catch(g){e(2,s=`Couldn't load scheme from a file: ${g}`)}}function v(){window.location.href=`scheme.html?authority=${f}`}const E=()=>e(1,u=!u);function O(){f=this.value,e(0,f)}function G(p){Z[p?"unshift":"push"](()=>{i=p,e(3,i)})}function q(p){d=p,e(4,d)}function R(p){u=p,e(1,u)}return n.$$.update=()=>{n.$$.dirty&1&&e(6,l=o.has(f))},[f,u,s,i,d,L,l,B,$,v,E,O,G,q,R]}class tt extends X{constructor(t){super(),Y(this,t,et,Xe,x,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new tt({target:document.getElementById("app")});
