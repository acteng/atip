import{S as ie,i as ue,s as fe,a as pe,F as de,b as z,c as te,d as ce,e as A,f as _,g as I,h as S,j as F,k as f,m as M,t as w,l as k,n as me,o as ne,p as T,q as j,r as he,u as H,E as ge,v as ae,w as $e,x as _e,y as be,z as ve,A as we,B as ye,C as ke}from"./data_getter-0e031b4d.js";import{D as Ae,R as Se,A as Ee}from"./About-e7416650.js";function Be(a){let t;return{c(){t=H("About")},m(e,o){F(e,t,o)},d(e){e&&T(t)}}}function oe(a){let t,e;return t=new ge({props:{errorMessage:a[2]}}),{c(){I(t.$$.fragment)},m(o,l){M(t,o,l),e=!0},p(o,l){const d={};l&4&&(d.errorMessage=o[2]),t.$set(d)},i(o){e||(w(t.$$.fragment,o),e=!0)},o(o){k(t.$$.fragment,o),e=!1},d(o){j(t,o)}}}function Fe(a){let t,e,o,l,d;return{c(){t=A("input"),e=_(),o=A("datalist"),S(t,"class","govuk-input govuk-input--width-20"),S(t,"id","inputValue"),S(t,"data-testid","transport-authority"),S(t,"list","authorities-list"),S(o,"id","authorities-list")},m(m,c){F(m,t,c),ae(t,a[0]),F(m,e,c),F(m,o,c),a[12](o),l||(d=$e(t,"input",a[11]),l=!0)},p(m,c){c&1&&t.value!==m[0]&&ae(t,m[0])},d(m){m&&(T(t),T(e),T(o)),a[12](null),l=!1,d()}}}function Te(a){let t;return{c(){t=H("Start")},m(e,o){F(e,t,o)},d(e){e&&T(t)}}}function se(a){let t,e;return{c(){t=A("i"),e=H(a[5])},m(o,l){F(o,t,l),f(t,e)},p(o,l){l&32&&_e(e,o[5])},d(o){o&&T(t)}}}function Ie(a){let t,e,o,l,d,m,c,b,C,g,E,O,L,v,D,P,N,R,q,G,r,s,$,y,u,B,V;d=new pe({props:{$$slots:{default:[Be]},$$scope:{ctx:a}}}),d.$on("click",a[10]);let i=a[2]&&oe(a);b=new de({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[Fe]},$$scope:{ctx:a}}}),g=new Ae({props:{disabled:!a[6],$$slots:{default:[Te]},$$scope:{ctx:a}}}),g.$on("click",a[9]);function le(n){a[13](n)}let Z={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]],inlineSmall:!0};a[4]!==void 0&&(Z.value=a[4]),v=new Se({props:Z}),z.push(()=>te(v,"value",le)),v.$on("change",a[7]);let h=a[5]&&se(a),K=Me;r=new ce({props:{label:"Or upload an ATIP GeoJSON file",loadFile:a[8],id:"load-geojson"}});function re(n){a[14](n)}let Q={};return a[1]!==void 0&&(Q.open=a[1]),u=new Ee({props:Q}),z.push(()=>te(u,"open",re)),{c(){t=A("div"),e=A("div"),o=A("h1"),o.textContent="Welcome to ATIP v2",l=_(),I(d.$$.fragment),m=_(),i&&i.c(),c=_(),I(b.$$.fragment),C=_(),I(g.$$.fragment),E=_(),O=A("hr"),L=_(),I(v.$$.fragment),P=_(),h&&h.c(),N=_(),R=A("hr"),q=_(),G=_(),I(r.$$.fragment),s=_(),$=A("div"),$.innerHTML='<div id="map" class="svelte-lyn11h"></div>',y=_(),I(u.$$.fragment),S(o,"class","govuk-heading-l"),S(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),S($,"class","govuk-grid-column-one-half"),S(t,"class","govuk-grid-row")},m(n,p){F(n,t,p),f(t,e),f(e,o),f(e,l),M(d,e,null),f(e,m),i&&i.m(e,null),f(e,c),M(b,e,null),f(e,C),M(g,e,null),f(e,E),f(e,O),f(e,L),M(v,e,null),f(e,P),h&&h.m(e,null),f(e,N),f(e,R),f(e,q),f(e,G),M(r,e,null),f(t,s),f(t,$),F(n,y,p),M(u,n,p),V=!0},p(n,[p]){const X={};p&262144&&(X.$$scope={dirty:p,ctx:n}),d.$set(X),n[2]?i?(i.p(n,p),p&4&&w(i,1)):(i=oe(n),i.c(),w(i,1),i.m(e,c)):i&&(be(),k(i,1,1,()=>{i=null}),me());const Y={};p&262153&&(Y.$$scope={dirty:p,ctx:n}),b.$set(Y);const W={};p&64&&(W.disabled=!n[6]),p&262144&&(W.$$scope={dirty:p,ctx:n}),g.$set(W);const x={};!D&&p&16&&(D=!0,x.value=n[4],ne(()=>D=!1)),v.$set(x),n[5]?h?h.p(n,p):(h=se(n),h.c(),h.m(e,N)):h&&(h.d(1),h=null);const ee={};!B&&p&2&&(B=!0,ee.open=n[1],ne(()=>B=!1)),u.$set(ee)},i(n){V||(w(d.$$.fragment,n),w(i),w(b.$$.fragment,n),w(g.$$.fragment,n),w(v.$$.fragment,n),w(K),w(r.$$.fragment,n),w(u.$$.fragment,n),V=!0)},o(n){k(d.$$.fragment,n),k(i),k(b.$$.fragment,n),k(g.$$.fragment,n),k(v.$$.fragment,n),k(K),k(r.$$.fragment,n),k(u.$$.fragment,n),V=!1},d(n){n&&(T(t),T(y)),j(d),i&&i.d(),j(b),j(g),j(v),h&&h.d(),j(r),j(u,n)}}}let Me="",U="boundary",J="boundary-layer";function je(a){if(a.features.length>0){let t=a.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function Ce(a,t,e){let o,l=!1,m=new URLSearchParams(window.location.search).get("error")||"",c,b,C=new Set,g=null,E="TA";function O(){g==null||g.setFilter(J,["==",["get","level"],E])}let L=null;he(async()=>{ve();const r=await we();for(let u of r.features){let B=document.createElement("option");B.value=u.properties.name,b.appendChild(B),C.add(u.properties.name)}let s=new ye.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});g=s;let $=null;function y(){$!==null&&s.setFeatureState({source:U,id:$},{hover:!1})}s.on("load",function(){s.fitBounds(ke(r),{padding:20,animate:!1}),s.addSource(U,{type:"geojson",data:r,generateId:!0}),s.addLayer({id:J,source:U,filter:["==",["get","level"],E],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),s.on("mousemove",J,u=>{u.features.length>0&&(y(),$=u.features[0].id,e(5,L=u.features[0].properties.name),s.setFeatureState({source:U,id:$},{hover:!0}))}),s.on("mouseleave",J,()=>{y(),$=null,e(5,L=null)}),s.on("click",J,function(u){let B=u.features[0].properties.name;window.location.href=`scheme.html?authority=${B}`})})});function v(r){try{let s=JSON.parse(r);if(!s.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!C.has(s.authority))throw new Error(`Unknown authority ${s.authority}`);let $=s.authority,y=je(s);y!="v1"&&($+=`_${y}`),window.localStorage.setItem($,JSON.stringify(s)),window.location.href=`scheme.html?authority=${s.authority}&schema=${y}`}catch(s){e(2,m=`Couldn't load scheme from a file: ${s}`)}}function D(){window.location.href=`scheme.html?authority=${c}`}const P=()=>e(1,l=!l);function N(){c=this.value,e(0,c)}function R(r){z[r?"unshift":"push"](()=>{b=r,e(3,b)})}function q(r){E=r,e(4,E)}function G(r){l=r,e(1,l)}return a.$$.update=()=>{a.$$.dirty&1&&e(6,o=C.has(c))},[c,l,m,b,E,L,o,O,v,D,P,N,R,q,G]}class Le extends ie{constructor(t){super(),ue(this,t,Ce,Ie,fe,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Le({target:document.getElementById("app")});
