import{S as de,i as ce,s as ge,L as he,a as _e,E as re,F as be,R as ve,b as Q,c as oe,M as we,e as S,d as c,f as ye,g,h as A,j as M,k as u,m as h,l as le,t as _,n as b,o as E,p as v,q as ie,r as ue,u as Se,v as N,w as fe,x as Ae,G as ke,y as Ce,z as Fe,A as Le,B as Me,C as Ee,D as je,H as pe}from"./index-74435e9c.js";import{D as Be}from"./DefaultButton-62e2e95c.js";import{A as Ie}from"./About-9bd1e5a9.js";import{F as Ne,a as De}from"./Popup-81d0ad63.js";import{P as Oe}from"./Popup-30b8c028.js";function Te(s){let t;return{c(){t=N("About")},m(e,n){M(e,t,n)},d(e){e&&E(t)}}}function Ge(s){let t,e,n,o,a;return{c(){t=S("input"),e=c(),n=S("datalist"),A(t,"class","govuk-input govuk-input--width-20"),A(t,"id","inputValue"),A(t,"data-testid","transport-authority"),A(t,"list","authorities-list"),A(n,"id","authorities-list")},m(l,i){M(l,t,i),fe(t,s[0]),M(l,e,i),M(l,n,i),s[13](n),o||(a=Ae(t,"input",s[12]),o=!0)},p(l,i){i&1&&t.value!==l[0]&&fe(t,l[0])},d(l){l&&(E(t),E(e),E(n)),s[13](null),o=!1,a()}}}function Je(s){let t;return{c(){t=N("Start")},m(e,n){M(e,t,n)},d(e){e&&E(t)}}}function Pe(s){let t,e=s[19].name+"",n,o,a=s[19].level+"",l,i;return{c(){t=S("p"),n=N(e),o=N(" ("),l=N(a),i=N(")")},m(p,m){M(p,t,m),u(t,n),u(t,o),u(t,l),u(t,i)},p(p,m){m&524288&&e!==(e=p[19].name+"")&&pe(n,e),m&524288&&a!==(a=p[19].level+"")&&pe(l,a)},d(p){p&&E(t)}}}function Ve(s){let t,e;return t=new Oe({props:{$$slots:{default:[Pe,({props:n})=>({19:n}),({props:n})=>n?524288:0]},$$scope:{ctx:s}}}),{c(){g(t.$$.fragment)},m(n,o){h(t,n,o),e=!0},p(n,o){const a={};o&1572864&&(a.$$scope={dirty:o,ctx:n}),t.$set(a)},i(n){e||(_(t.$$.fragment,n),e=!0)},o(n){b(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function He(s){let t,e,n,o;return t=new De({props:{id:"boundaries",filter:["==",["get","level"],s[1]],paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":Me(0,.5)},manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[Ve]},$$scope:{ctx:s}}}),t.$on("click",s[8]),n=new Ee({props:{id:"boundaries-outline",filter:["==",["get","level"],s[1]],paint:{"line-color":"rgb(200, 100, 240)","line-width":2.5},manageHoverState:!0}}),{c(){g(t.$$.fragment),e=c(),g(n.$$.fragment)},m(a,l){h(t,a,l),M(a,e,l),h(n,a,l),o=!0},p(a,l){const i={};l&2&&(i.filter=["==",["get","level"],a[1]]),l&1048576&&(i.$$scope={dirty:l,ctx:a}),t.$set(i);const p={};l&2&&(p.filter=["==",["get","level"],a[1]]),n.$set(p)},i(a){o||(_(t.$$.fragment,a),_(n.$$.fragment,a),o=!0)},o(a){b(t.$$.fragment,a),b(n.$$.fragment,a),o=!1},d(a){a&&E(e),v(t,a),v(n,a)}}}function Re(s){let t,e;return t=new ke({props:{data:s[2],generateId:!0,$$slots:{default:[He]},$$scope:{ctx:s}}}),{c(){g(t.$$.fragment)},m(n,o){h(t,n,o),e=!0},p(n,o){const a={};o&4&&(a.data=n[2]),o&1048578&&(a.$$scope={dirty:o,ctx:n}),t.$set(a)},i(n){e||(_(t.$$.fragment,n),e=!0)},o(n){b(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function qe(s){let t,e,n,o,a,l,i,p,m,j,y,D,w,J,k,P,V,H,C,O,R,f,d,L,T,F,X,q,G,I,U,B,W,z;i=new he({}),m=new _e({props:{$$slots:{default:[Te]},$$scope:{ctx:s}}}),m.$on("click",s[11]),y=new re({props:{errorMessage:s[4]}}),w=new be({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[Ge]},$$scope:{ctx:s}}}),k=new Be({props:{disabled:!s[6],$$slots:{default:[Je]},$$scope:{ctx:s}}}),k.$on("click",s[9]);function me(r){s[14](r)}let Y={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]],inlineSmall:!0};s[1]!==void 0&&(Y.value=s[1]),C=new ve({props:Y}),Q.push(()=>oe(C,"value",me)),L=new re({props:{errorMessage:ze}}),F=new Ne({props:{label:"Or upload an ATIP GeoJSON file",loadFile:s[7],id:"load-geojson"}}),I=new we({props:{style:"streets",startBounds:[-5.96,49.89,2.31,55.94],$$slots:{default:[Re]},$$scope:{ctx:s}}});function $e(r){s[15](r)}let Z={};return s[3]!==void 0&&(Z.open=s[3]),B=new Ie({props:Z}),Q.push(()=>oe(B,"open",$e)),{c(){t=S("div"),e=S("div"),n=S("h1"),n.textContent="Welcome to ATIP Scheme Sketcher v2",o=c(),a=S("p"),a.textContent=`App version: ${ye()}`,l=c(),g(i.$$.fragment),p=c(),g(m.$$.fragment),j=c(),g(y.$$.fragment),D=c(),g(w.$$.fragment),J=c(),g(k.$$.fragment),P=c(),V=S("hr"),H=c(),g(C.$$.fragment),R=c(),f=S("hr"),d=c(),g(L.$$.fragment),T=c(),g(F.$$.fragment),X=c(),q=S("div"),G=S("div"),g(I.$$.fragment),U=c(),g(B.$$.fragment),A(n,"class","govuk-heading-l"),A(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),A(G,"id","map"),A(G,"class","svelte-lyn11h"),A(q,"class","govuk-grid-column-one-half"),A(t,"class","govuk-grid-row")},m(r,$){M(r,t,$),u(t,e),u(e,n),u(e,o),u(e,a),u(e,l),h(i,e,null),u(e,p),h(m,e,null),u(e,j),h(y,e,null),u(e,D),h(w,e,null),u(e,J),h(k,e,null),u(e,P),u(e,V),u(e,H),h(C,e,null),u(e,R),u(e,f),u(e,d),h(L,e,null),u(e,T),h(F,e,null),u(t,X),u(t,q),u(q,G),h(I,G,null),M(r,U,$),h(B,r,$),z=!0},p(r,[$]){const x={};$&1048576&&(x.$$scope={dirty:$,ctx:r}),m.$set(x);const ee={};$&16&&(ee.errorMessage=r[4]),y.$set(ee);const te={};$&1048609&&(te.$$scope={dirty:$,ctx:r}),w.$set(te);const K={};$&64&&(K.disabled=!r[6]),$&1048576&&(K.$$scope={dirty:$,ctx:r}),k.$set(K);const ne={};!O&&$&2&&(O=!0,ne.value=r[1],le(()=>O=!1)),C.$set(ne);const se={};$&1048582&&(se.$$scope={dirty:$,ctx:r}),I.$set(se);const ae={};!W&&$&8&&(W=!0,ae.open=r[3],le(()=>W=!1)),B.$set(ae)},i(r){z||(_(i.$$.fragment,r),_(m.$$.fragment,r),_(y.$$.fragment,r),_(w.$$.fragment,r),_(k.$$.fragment,r),_(C.$$.fragment,r),_(L.$$.fragment,r),_(F.$$.fragment,r),_(I.$$.fragment,r),_(B.$$.fragment,r),z=!0)},o(r){b(i.$$.fragment,r),b(m.$$.fragment,r),b(y.$$.fragment,r),b(w.$$.fragment,r),b(k.$$.fragment,r),b(C.$$.fragment,r),b(L.$$.fragment,r),b(F.$$.fragment,r),b(I.$$.fragment,r),b(B.$$.fragment,r),z=!1},d(r){r&&(E(t),E(U)),v(i),v(m),v(y),v(w),v(k),v(C),v(L),v(F),v(I),v(B,r)}}}let ze="";function Ue(s){if(s.features.length>0){let t=s.features[0].properties;for(let e of["pipeline"])if(t&&e in t)return e}return"v1"}function We(s,t,e){let n,o,a;ie(s,ue,f=>e(16,o=f)),ie(s,je,f=>e(10,a=f));let l={type:"FeatureCollection",features:[]},i=!1;const p=new URLSearchParams(window.location.search);p.get("schema")&&ue.set(p.get("schema"));let m=p.get("error")||"",j,y,D=new Set,w="TA";Se(async()=>{Ce(),e(2,l=await Fe());for(let f of l.features){let d=document.createElement("option");d.value=f.properties.full_name,d.label=`${f.properties.name} (${f.properties.level})`,y.appendChild(d),D.add(f.properties.full_name)}});function J(f){try{let d=JSON.parse(f),L=Le(d.features,l);if(!L)throw new Error("Can't figure out the authority boundary that fully contains this scheme");d.authority=L;let T=d.authority,F=Ue(d);F!="v1"&&(T+=`_${F}`),window.localStorage.setItem(T,JSON.stringify(d)),window.location.href=`scheme.html?authority=${d.authority}&schema=${F}`}catch(d){e(4,m=`Couldn't load scheme from a file: ${d}`)}}function k(f){window.location.href=`scheme.html?authority=${f.detail.features[0].properties.full_name}&schema=${o}`}function P(){window.location.href=`scheme.html?authority=${j}&schema=${o}`}const V=()=>e(3,i=!i);function H(){j=this.value,e(0,j)}function C(f){Q[f?"unshift":"push"](()=>{y=f,e(5,y)})}function O(f){w=f,e(1,w)}function R(f){i=f,e(3,i)}return s.$$.update=()=>{s.$$.dirty&1&&e(6,n=D.has(j)),s.$$.dirty&1026&&(a==null||a.setFilter("boundaries",["==",["get","level"],w])),s.$$.dirty&1026&&(a==null||a.setFilter("boundaries-outline",["==",["get","level"],w]))},[j,w,l,i,m,y,n,J,k,P,a,V,H,C,O,R]}class Ke extends de{constructor(t){super(),ce(this,t,We,qe,ge,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Ke({target:document.getElementById("app")});
