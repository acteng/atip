import{S as ie,i as ue,s as fe,a as pe,F as de,b as z,c as te,d as ce,e as A,f as _,g as M,h as S,j as B,k as f,m as T,t as w,l as k,n as me,o as ne,p as F,q as I,r as he,u as H,E as ge,v as ae,w as $e,x as _e,y as be,z as ve,A as we,B as ye}from"./maplibre_helpers-f13ef804.js";import{a as ke,D as Ae,R as Se,A as Ee}from"./About-7d63c4c1.js";async function Be(){const t=await(await fetch(ke)).text();return JSON.parse(t)}function Fe(n){let t;return{c(){t=H("About")},m(e,o){B(e,t,o)},d(e){e&&F(t)}}}function oe(n){let t,e;return t=new ge({props:{errorMessage:n[2]}}),{c(){M(t.$$.fragment)},m(o,r){T(t,o,r),e=!0},p(o,r){const c={};r&4&&(c.errorMessage=o[2]),t.$set(c)},i(o){e||(w(t.$$.fragment,o),e=!0)},o(o){k(t.$$.fragment,o),e=!1},d(o){I(t,o)}}}function Me(n){let t,e,o,r,c;return{c(){t=A("input"),e=_(),o=A("datalist"),S(t,"class","govuk-input govuk-input--width-20"),S(t,"id","inputValue"),S(t,"data-testid","transport-authority"),S(t,"list","authorities-list"),S(o,"id","authorities-list")},m(h,m){B(h,t,m),ae(t,n[0]),B(h,e,m),B(h,o,m),n[12](o),r||(c=$e(t,"input",n[11]),r=!0)},p(h,m){m&1&&t.value!==h[0]&&ae(t,h[0])},d(h){h&&(F(t),F(e),F(o)),n[12](null),r=!1,c()}}}function Te(n){let t;return{c(){t=H("Start")},m(e,o){B(e,t,o)},d(e){e&&F(t)}}}function se(n){let t,e;return{c(){t=A("i"),e=H(n[5])},m(o,r){B(o,t,r),f(t,e)},p(o,r){r&32&&_e(e,o[5])},d(o){o&&F(t)}}}function Ie(n){let t,e,o,r,c,h,m,b,j,s,E,J,L,v,N,O,C,P,R,q,l,i,y,p,$,V,G;c=new pe({props:{$$slots:{default:[Fe]},$$scope:{ctx:n}}}),c.$on("click",n[10]);let u=n[2]&&oe(n);b=new de({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[Me]},$$scope:{ctx:n}}}),s=new Ae({props:{disabled:!n[6],$$slots:{default:[Te]},$$scope:{ctx:n}}}),s.$on("click",n[9]);function re(a){n[13](a)}let Z={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]],inlineSmall:!0};n[4]!==void 0&&(Z.value=n[4]),v=new Se({props:Z}),z.push(()=>te(v,"value",re)),v.$on("change",n[7]);let g=n[5]&&se(n),K=je;l=new ce({props:{label:"Or upload an ATIP GeoJSON file",loadFile:n[8],id:"load-geojson"}});function le(a){n[14](a)}let Q={};return n[1]!==void 0&&(Q.open=n[1]),$=new Ee({props:Q}),z.push(()=>te($,"open",le)),{c(){t=A("div"),e=A("div"),o=A("h1"),o.textContent="Welcome to ATIP v2",r=_(),M(c.$$.fragment),h=_(),u&&u.c(),m=_(),M(b.$$.fragment),j=_(),M(s.$$.fragment),E=_(),J=A("hr"),L=_(),M(v.$$.fragment),O=_(),g&&g.c(),C=_(),P=A("hr"),R=_(),q=_(),M(l.$$.fragment),i=_(),y=A("div"),y.innerHTML='<div id="map" class="svelte-lyn11h"></div>',p=_(),M($.$$.fragment),S(o,"class","govuk-heading-l"),S(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),S(y,"class","govuk-grid-column-one-half"),S(t,"class","govuk-grid-row")},m(a,d){B(a,t,d),f(t,e),f(e,o),f(e,r),T(c,e,null),f(e,h),u&&u.m(e,null),f(e,m),T(b,e,null),f(e,j),T(s,e,null),f(e,E),f(e,J),f(e,L),T(v,e,null),f(e,O),g&&g.m(e,null),f(e,C),f(e,P),f(e,R),f(e,q),T(l,e,null),f(t,i),f(t,y),B(a,p,d),T($,a,d),G=!0},p(a,[d]){const X={};d&262144&&(X.$$scope={dirty:d,ctx:a}),c.$set(X),a[2]?u?(u.p(a,d),d&4&&w(u,1)):(u=oe(a),u.c(),w(u,1),u.m(e,m)):u&&(be(),k(u,1,1,()=>{u=null}),me());const Y={};d&262153&&(Y.$$scope={dirty:d,ctx:a}),b.$set(Y);const W={};d&64&&(W.disabled=!a[6]),d&262144&&(W.$$scope={dirty:d,ctx:a}),s.$set(W);const x={};!N&&d&16&&(N=!0,x.value=a[4],ne(()=>N=!1)),v.$set(x),a[5]?g?g.p(a,d):(g=se(a),g.c(),g.m(e,C)):g&&(g.d(1),g=null);const ee={};!V&&d&2&&(V=!0,ee.open=a[1],ne(()=>V=!1)),$.$set(ee)},i(a){G||(w(c.$$.fragment,a),w(u),w(b.$$.fragment,a),w(s.$$.fragment,a),w(v.$$.fragment,a),w(K),w(l.$$.fragment,a),w($.$$.fragment,a),G=!0)},o(a){k(c.$$.fragment,a),k(u),k(b.$$.fragment,a),k(s.$$.fragment,a),k(v.$$.fragment,a),k(K),k(l.$$.fragment,a),k($.$$.fragment,a),G=!1},d(a){a&&(F(t),F(p)),I(c),u&&u.d(),I(b),I(s),I(v),g&&g.d(),I(l),I($,a)}}}let je="",U="boundary",D="boundary-layer";function Le(n){if(n.features.length>0){let t=n.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function Ne(n,t,e){let o,r=!1,h=new URLSearchParams(window.location.search).get("error")||"",m,b,j=new Set,s=null,E="TA";function J(){s==null||s.setFilter(D,["==",["get","level"],E])}let L=null;he(async()=>{ve();const l=await Be();for(let p of l.features){let $=document.createElement("option");$.value=p.properties.name,b.appendChild($),j.add(p.properties.name)}s=new we.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let i=null;function y(){i!==null&&s.setFeatureState({source:U,id:i},{hover:!1})}s.on("load",function(){s.fitBounds(ye(l),{padding:20,animate:!1}),s.addSource(U,{type:"geojson",data:l,generateId:!0}),s.addLayer({id:D,source:U,filter:["==",["get","level"],E],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),s.on("mousemove",D,p=>{p.features.length>0&&(y(),i=p.features[0].id,e(5,L=p.features[0].properties.name),s.setFeatureState({source:U,id:i},{hover:!0}))}),s.on("mouseleave",D,()=>{y(),i=null,e(5,L=null)}),s.on("click",D,function(p){let $=p.features[0].properties.name;window.location.href=`scheme.html?authority=${$}`})})});function v(l){try{let i=JSON.parse(l);if(!i.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!j.has(i.authority))throw new Error(`Unknown authority ${i.authority}`);let y=i.authority,p=Le(i);p!="v1"&&(y+=`_${p}`),window.localStorage.setItem(y,JSON.stringify(i)),window.location.href=`scheme.html?authority=${i.authority}&schema=${p}`}catch(i){e(2,h=`Couldn't load scheme from a file: ${i}`)}}function N(){window.location.href=`scheme.html?authority=${m}`}const O=()=>e(1,r=!r);function C(){m=this.value,e(0,m)}function P(l){z[l?"unshift":"push"](()=>{b=l,e(3,b)})}function R(l){E=l,e(4,E)}function q(l){r=l,e(1,r)}return n.$$.update=()=>{n.$$.dirty&1&&e(6,o=j.has(m))},[m,r,h,b,E,L,o,J,v,N,O,C,P,R,q]}class Ce extends ie{constructor(t){super(),ue(this,t,Ne,Ie,fe,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Ce({target:document.getElementById("app")});
