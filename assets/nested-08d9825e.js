var ai=Object.defineProperty;var fi=(r,e,t)=>e in r?ai(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var oe=(r,e,t)=>(fi(r,typeof e!="symbol"?e+"":e,t),t);import{S as re,i as ie,s as ne,M as ci,b as be,a as Ze,d as W,m as V,k as Qe,n as A,o as F,q as K,e as S,c as L,g as b,x as U,p as w,y as He,f as T,z as Te,B as Ce,C as pi,D as Nn,E as dn,F as jt,G as Ct,H as At,I as Pt,J as Ft,K as jn,h as k,l as j,L as hi,N as di,O as ce,P as mi,w as $n,Q as ft,R as Oe,T as un,t as Y,U as Le,V as _e,j as $e,r as qe,W as et,X as _t,Y as at,Z as Ne,_ as Hr,$ as gt,a0 as zn,a1 as Yn,a2 as Hn,a3 as _i,a4 as gi,a5 as De,a6 as vi,a7 as yi,a8 as bi,a9 as an,aa as St,ab as fn,ac as Dt,ad as cn,ae as bn,af as wi,ag as bt,ah as In,ai as ot,aj as wt,ak as ki,al as Bn,am as Si,an as Ei,ao as Mi,ap as Un,aq as Zt,ar as xi,as as Li,at as Ri,A as Oi,u as Ti}from"./authorities-838a60c2.js";function Ci(r){let e,t,n,i,o,s,u,l,a,f,m,p,c;return{c(){e=S("p"),e.textContent="For each intervention:",t=L(),n=S("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=L(),o=S("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=L(),u=S("p"),u.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=L(),a=S("p"),a.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,f=L(),m=S("p"),m.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,p=L(),c=S("p"),c.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(g,d){b(g,e,d),b(g,t,d),b(g,n,d),b(g,i,d),b(g,o,d),b(g,s,d),b(g,u,d),b(g,l,d),b(g,a,d),b(g,f,d),b(g,m,d),b(g,p,d),b(g,c,d)},p:U,d(g){g&&w(e),g&&w(t),g&&w(n),g&&w(i),g&&w(o),g&&w(s),g&&w(u),g&&w(l),g&&w(a),g&&w(f),g&&w(m),g&&w(p),g&&w(c)}}}function Ai(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Ci]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new ci({props:o}),be.push(()=>Ze(e,"open",i,r[0])),{c(){W(e.$$.fragment)},m(s,u){V(e,s,u),n=!0},p(s,[u]){const l={};u&4&&(l.$$scope={dirty:u,ctx:s}),!t&&u&1&&(t=!0,l.open=s[0],Qe(()=>t=!1)),e.$set(l)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){F(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function Pi(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Fi extends re{constructor(e){super(),ie(this,e,Pi,Ai,ne,{open:0})}}const ct=[];function Et(r,e=U){let t;const n=new Set;function i(u){if(ne(r,u)&&(r=u,t)){const l=!ct.length;for(const a of n)a[1](),ct.push(a,r);if(l){for(let a=0;a<ct.length;a+=2)ct[a][0](ct[a+1]);ct.length=0}}}function o(u){i(u(r))}function s(u,l=U){const a=[u,l];return n.add(a),n.size===1&&(t=e(i)||U),u(r),()=>{n.delete(a),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ue=Et(null),se=Et(He()),Fe=Et(null),Ke=Et(null),Qt=Et(null),wn=Et(null);function zt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Xn(r){se.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Fe.set(null),Ke.set(null),Qt.set(null)}function Jn(r){let e;const t=r[4].default,n=Ct(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&At(n,t,i,i[3],e?Ft(t,i[3],o,null):Pt(i[3]),null)},i(i){e||(A(n,i),e=!0)},o(i){F(n,i),e=!1},d(i){n&&n.d(i)}}}function Ni(r){let e,t,n=r[1]&&Jn(r);return{c(){e=S("div"),n&&n.c(),T(e,"class","map svelte-12dpf1u")},m(i,o){b(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&A(n,1)):(n=Jn(i),n.c(),A(n,1),n.m(e,null)):n&&(Te(),F(n,1,1,()=>{n=null}),Ce())},i(i){t||(A(n),t=!0)},o(i){F(n),t=!1},d(i){i&&w(e),n&&n.d(),r[5](null)}}}function $i(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,u,l=!1;pi("setCamera",!window.location.hash),Nn(()=>{s=new dn.Map({container:u,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new dn.ScaleControl({})),s.addControl(new dn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ue.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(u)}),jt(()=>{s.remove()});function a(f){be[f?"unshift":"push"](()=>{u=f,t(0,u)})}return r.$$set=f=>{"style"in f&&t(2,o=f.style),"$$scope"in f&&t(3,i=f.$$scope)},[u,l,o,i,n,a]}class Ii extends re{constructor(e){super(),ie(this,e,$i,Ni,ne,{style:2})}}const Bi=r=>({}),Wn=r=>({}),Di=r=>({}),Vn=r=>({}),Gi=r=>({}),Kn=r=>({});function qi(r){let e,t,n,i,o,s,u,l,a,f,m,p;const c=r[3].nav,g=Ct(c,r,r[2],Kn),d=r[3].sidebar,_=Ct(d,r,r[2],Vn),E=r[3].main,h=Ct(E,r,r[2],Wn);return{c(){e=S("aside"),t=S("div"),n=S("nav"),g&&g.c(),i=L(),_&&_.c(),o=L(),s=S("button"),s.textContent="â†’",l=L(),a=S("main"),h&&h.c(),T(n,"class","svelte-1u7vg8a"),T(t,"class","sidebar-content content-container svelte-1u7vg8a"),T(s,"type","button"),T(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),T(e,"class",u=jn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),T(a,"class","svelte-1u7vg8a")},m(v,y){b(v,e,y),k(e,t),k(t,n),g&&g.m(n,null),k(t,i),_&&_.m(t,null),k(e,o),k(e,s),b(v,l,y),b(v,a,y),h&&h.m(a,null),f=!0,m||(p=j(s,"click",r[1]),m=!0)},p(v,[y]){g&&g.p&&(!f||y&4)&&At(g,c,v,v[2],f?Ft(c,v[2],y,Gi):Pt(v[2]),Kn),_&&_.p&&(!f||y&4)&&At(_,d,v,v[2],f?Ft(d,v[2],y,Di):Pt(v[2]),Vn),(!f||y&1&&u!==(u=jn(v[0]?"":"collapsed")+" svelte-1u7vg8a"))&&T(e,"class",u),h&&h.p&&(!f||y&4)&&At(h,E,v,v[2],f?Ft(E,v[2],y,Bi):Pt(v[2]),Wn)},i(v){f||(A(g,v),A(_,v),A(h,v),f=!0)},o(v){F(g,v),F(_,v),F(h,v),f=!1},d(v){v&&w(e),g&&g.d(v),_&&_.d(v),v&&w(l),v&&w(a),h&&h.d(v),m=!1,p()}}}function ji(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=u=>{"$$scope"in u&&t(2,i=u.$$scope)},[o,s,i,n]}class zi extends re{constructor(e){super(),ie(this,e,ji,qi,ne,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Yi(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(f){return l([a,f])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(f){a=[6,f],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var lt=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Hi(r,e){return r>e?1:r<e?-1:0}function tt(r,e,t){for(var n=new lt(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function mn(r,e,t,n){var i=new lt(r,e);if(t===null)return i.left=i.right=null,i;t=tt(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Zn(r,e,t){var n=null,i=null;if(e){e=tt(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Ui(r,e,t){return e===null?r:(r===null||(e=tt(r.key,e,t),e.left=r),e)}function kn(r,e,t,n,i){if(r){n(""+e+(t?"â””â”€â”€ ":"â”œâ”€â”€ ")+i(r)+`
`);var o=e+(t?"    ":"â”‚   ");r.left&&kn(r.left,o,!1,n,i),r.right&&kn(r.right,o,!0,n,i)}}var Dn=function(){function r(e){e===void 0&&(e=Hi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=mn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new lt(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=tt(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=tt(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=tt(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=tt(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=tt(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,u=this._root,l;o.length!==0||u;)if(u)o.push(u),u=u.left;else{if(u=o.pop(),l=s(u.key,t),l>0)break;if(s(u.key,e)>=0&&n.call(i,u))return this;u=u.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Ji(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Mn(e,t,0,i-1,o),this._root===null)this._root=Sn(e,t,0,i),this._size=i;else{var s=Wi(this.toList(),Xi(e,t),o);i=this._size+i,this._root=En({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return kn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Zn(e,this._root,i),s=o.left,u=o.right;i(e,t)<0?u=mn(t,n,u,i):s=mn(t,n,s,i),this._root=Ui(s,u,i)},r.prototype.split=function(e){return Zn(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Yi(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Sn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],u=e[o],l=new lt(s,u);return l.left=Sn(r,e,t,o),l.right=Sn(r,e,o+1,n),l}return null}function Xi(r,e){for(var t=new lt(null,null),n=t,i=0;i<r.length;i++)n=n.next=new lt(r[i],e[i]);return n.next=null,t.next}function Ji(r){for(var e=r,t=[],n=!1,i=new lt(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function En(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=En(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=En(r,i+1,t),s}return null}function Wi(r,e,t){for(var n=new lt(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Mn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,u=n+1;;){do s++;while(i(r[s],o)<0);do u--;while(i(r[u],o)>0);if(s>=u)break;var l=r[s];r[s]=r[u],r[u]=l,l=e[s],e[s]=e[u],e[u]=l}Mn(r,e,t,u,i),Mn(r,e,u+1,n,i)}}function Ie(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Qn(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Pe(r,e,t){return e&&Qn(r.prototype,e),t&&Qn(r,t),r}var Ot=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},xn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},rt=Number.EPSILON;rt===void 0&&(rt=Math.pow(2,-52));var Vi=rt*rt,Ln=function(e,t){if(-rt<e&&e<rt&&-rt<t&&t<rt)return 0;var n=e-t;return n*n<Vi*e*t?0:e<t?-1:1},Ki=function(){function r(){Ie(this,r),this.reset()}return Pe(r,[{key:"reset",value:function(){this.xRounder=new er,this.yRounder=new er}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),er=function(){function r(){Ie(this,r),this.tree=new Dn,this.round(0)}return Pe(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Ln(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Ln(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Gt=new Ki,Nt=function(e,t){return e.x*t.y-e.y*t.x},Ur=function(e,t){return e.x*t.x+e.y*t.y},tr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Nt(i,o);return Ln(s,0)},en=function(e){return Math.sqrt(Ur(e,e))},Zi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Nt(o,i)/en(o)/en(i)},Qi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Ur(o,i)/en(o)/en(i)},nr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},rr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},eo=function(e,t,n,i){if(t.x===0)return rr(n,i,e.x);if(i.x===0)return rr(e,t,n.x);if(t.y===0)return nr(n,i,e.y);if(i.y===0)return nr(e,t,n.y);var o=Nt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},u=Nt(s,t)/o,l=Nt(s,i)/o,a=e.x+l*t.x,f=n.x+u*i.x,m=e.y+l*t.y,p=n.y+u*i.y,c=(a+f)/2,g=(m+p)/2;return{x:c,y:g}},ze=function(){Pe(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:tn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Ie(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Pe(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(u){var l=u.otherSE;i.set(u,{sine:Zi(n.point,t.point,l.point),cosine:Qi(n.point,t.point,l.point)})};return function(s,u){i.has(s)||o(s),i.has(u)||o(u);var l=i.get(s),a=l.sine,f=l.cosine,m=i.get(u),p=m.sine,c=m.cosine;return a>=0&&p>=0?f<c?1:f>c?-1:0:a<0&&p<0?f<c?-1:f>c?1:0:p<a?-1:p>a?1:0}}}]),r}(),to=0,tn=function(){Pe(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,u=n.rightSE.point.x;if(u<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,a=n.leftSE.point.y,f=t.rightSE.point.y,m=n.rightSE.point.y;if(i<o){if(a<l&&a<f)return 1;if(a>l&&a>f)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var c=n.comparePoint(t.rightSE.point);return c!==0?c:-1}if(i>o){if(l<a&&l<m)return-1;if(l>a&&l>m)return 1;var g=n.comparePoint(t.leftSE.point);if(g!==0)return g;var d=t.comparePoint(n.rightSE.point);return d<0?1:d>0?-1:1}if(l<a)return-1;if(l>a)return 1;if(s<u){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>u){var E=t.comparePoint(n.rightSE.point);if(E<0)return 1;if(E>0)return-1}if(s!==u){var h=f-l,v=s-i,y=m-a,x=u-o;if(h>v&&y<x)return 1;if(h<v&&y>x)return-1}return s>u?1:s<u||f<m?-1:f>m?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Ie(this,r),this.id=++to,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Pe(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,u=n.x+s*o.x;if(t.x===u)return 0;var l=(t.x-n.x)/o.x,a=n.y+l*o.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=xn(n,i);if(o===null)return null;var s=this.leftSE.point,u=this.rightSE.point,l=t.leftSE.point,a=t.rightSE.point,f=Ot(n,l)&&this.comparePoint(l)===0,m=Ot(i,s)&&t.comparePoint(s)===0,p=Ot(n,a)&&this.comparePoint(a)===0,c=Ot(i,u)&&t.comparePoint(u)===0;if(m&&f)return c&&!p?u:!c&&p?a:null;if(m)return p&&s.x===a.x&&s.y===a.y?null:s;if(f)return c&&u.x===l.x&&u.y===l.y?null:l;if(c&&p)return null;if(c)return u;if(p)return a;var g=eo(s,this.vector(),l,t.vector());return g===null||!Ot(o,g)?null:Gt.round(g.x,g.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new ze(t,!0),s=new ze(t,!1),u=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,u,this.rings.slice(),this.windings.slice());return ze.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),ze.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var u=n;n=i,i=u}for(var l=0,a=i.rings.length;l<a;l++){var f=i.rings[l],m=i.windings[l],p=n.rings.indexOf(f);p===-1?(n.rings.push(f),n.windings.push(m)):n.windings[p]+=m}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,u=this.rings.length;s<u;s++){var l=this.rings[s],a=this.windings[s],f=n.indexOf(l);f===-1?(n.push(l),i.push(a)):i[f]+=a}for(var m=[],p=[],c=0,g=n.length;c<g;c++)if(i[c]!==0){var d=n[c],_=d.poly;if(p.indexOf(_)===-1)if(d.isExterior)m.push(_);else{p.indexOf(_)===-1&&p.push(_);var E=m.indexOf(d.poly);E!==-1&&m.splice(E,1)}}for(var h=0,v=m.length;h<v;h++){var y=m[h].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ge.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,u;t.length<n.length?(s=t.length,u=n.length):(s=n.length,u=t.length),this._isInResult=u===Ge.numMultiPolys&&s<u;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var a=function(m){return m.length===1&&m[0].isSubject};this._isInResult=a(t)!==a(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ge.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,u,l=ze.comparePoints(t,n);if(l<0)o=t,s=n,u=1;else if(l>0)o=n,s=t,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var a=new ze(o,!0),f=new ze(s,!1);return new r(a,f,[i],[u])}}]),r}(),ir=function(){function r(e,t,n){if(Ie(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Gt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,u=e.length;s<u;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Gt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(tn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(tn.fromRing(o,i,this))}return Pe(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),no=function(){function r(e,t){if(Ie(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ir(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new ir(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Pe(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),or=function(){function r(e,t){if(Ie(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new no(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Pe(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),ro=function(){Pe(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var u=null,l=s.leftSE,a=s.rightSE,f=[l],m=l.point,p=[];u=l,l=a,f.push(l),l.point!==m;)for(;;){var c=l.getAvailableLinkedEvents();if(c.length===0){var g=f[0].point,d=f[f.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(g.x,",")+" ".concat(g.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(c.length===1){a=c[0].otherSE;break}for(var _=null,E=0,h=p.length;E<h;E++)if(p[E].point===l.point){_=E;break}if(_!==null){var v=p.splice(_)[0],y=f.splice(v.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}p.push({index:f.length,point:l.point});var x=l.getLeftmostComparator(u);a=c.sort(x)[0].otherSE;break}n.push(new r(f))}}return n}}]);function r(e){Ie(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Pe(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,u=this.events[i+1].point;tr(s,t,u)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],a=n[1];tr(l,t,a)===0&&n.shift(),n.push(n[0]);for(var f=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,c=[],g=m;g!=p;g+=f)c.push([n[g].x,n[g].y]);return c}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];ze.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),u=s?s.prevInResult():null;;){if(!s)return null;if(!u)return s.ringOut;if(u.ringOut!==s.ringOut)return u.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=u.prevInResult(),u=s?s.prevInResult():null}}}]),r}(),sr=function(){function r(e){Ie(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Pe(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),io=function(){function r(e){Ie(this,r),this.rings=e,this.polys=this._composePolys(e)}return Pe(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new sr(s));else{var u=s.enclosingRing();u.poly||n.push(new sr(u)),u.poly.addInterior(s)}}return n}}]),r}(),oo=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:tn.compare;Ie(this,r),this.queue=e,this.tree=new Dn(t),this.segments=[]}return Pe(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,u=o,l=void 0,a=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;a===void 0;)u=this.tree.next(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);if(t.isLeft){var f=null;if(l){var m=l.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(f=m),!l.isAnEndpoint(m)))for(var p=this._splitSafely(l,m),c=0,g=p.length;c<g;c++)i.push(p[c])}var d=null;if(a){var _=a.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(d=_),!a.isAnEndpoint(_)))for(var E=this._splitSafely(a,_),h=0,v=E.length;h<v;h++)i.push(E[h])}if(f!==null||d!==null){var y=null;if(f===null)y=d;else if(d===null)y=f;else{var x=ze.comparePoints(f,d);y=x<=0?f:d}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var O=n.split(y),C=0,R=O.length;C<R;C++)i.push(O[C])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&a){var I=l.getIntersection(a);if(I!==null){if(!l.isAnEndpoint(I))for(var D=this._splitSafely(l,I),B=0,X=D.length;B<X;B++)i.push(D[B]);if(!a.isAnEndpoint(I))for(var P=this._splitSafely(a,I),z=0,te=P.length;z<te;z++)i.push(P[z])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),lr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,so=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,lo=function(){function r(){Ie(this,r)}return Pe(r,[{key:"run",value:function(t,n,i){Ge.type=t,Gt.reset();for(var o=[new or(n,!0)],s=0,u=i.length;s<u;s++)o.push(new or(i[s],!1));if(Ge.numMultiPolys=o.length,Ge.type==="difference")for(var l=o[0],a=1;a<o.length;)xn(o[a].bbox,l.bbox)!==null?a++:o.splice(a,1);if(Ge.type==="intersection"){for(var f=0,m=o.length;f<m;f++)for(var p=o[f],c=f+1,g=o.length;c<g;c++)if(xn(p.bbox,o[c].bbox)===null)return[]}for(var d=new Dn(ze.compare),_=0,E=o.length;_<E;_++)for(var h=o[_].getSweepEvents(),v=0,y=h.length;v<y;v++)if(d.insert(h[v]),d.size>lr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var x=new oo(d),O=d.size,C=d.pop();C;){var R=C.key;if(d.size===O){var I=R.segment;throw new Error("Unable to pop() ".concat(R.isLeft?"left":"right"," SweepEvent ")+"[".concat(R.point.x,", ").concat(R.point.y,"] from segment #").concat(I.id," ")+"[".concat(I.leftSE.point.x,", ").concat(I.leftSE.point.y,"] -> ")+"[".concat(I.rightSE.point.x,", ").concat(I.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(d.size>lr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(x.segments.length>so)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var D=x.process(R),B=0,X=D.length;B<X;B++){var P=D[B];P.consumedBy===void 0&&d.insert(P)}O=d.size,C=d.pop()}Gt.reset();var z=ro.factory(x.segments),te=new io(z);return te.getGeom()}}]),r}(),Ge=new lo,uo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ge.run("union",e,n)},ao=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ge.run("intersection",e,n)},fo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ge.run("xor",e,n)},co=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ge.run("difference",e,n)},Ut={union:uo,intersection:ao,xor:fo,difference:co};function po(r,e){var t=mo(e),n=null;return r.type==="FeatureCollection"?n=ho(r):n=Xr(Ut.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function ho(r){var e=r.features.length===2?Ut.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Ut.union.apply(Ut,r.features.map(function(t){return t.geometry.coordinates}));return Xr(e)}function Xr(r){return hi(r)}function mo(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return di(t)}function _o(r,e,t){let n;ce(r,Ue,s=>t(1,n=s));let{boundaryGeojson:i}=e;return mi("setCamera")&&n.fitBounds($n(i),{padding:20,animate:!1}),ft(n,"boundary",{type:"geojson",data:po(i)}),Oe(n,{id:"boundary",source:"boundary",...un("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class go extends re{constructor(e){super(),ie(this,e,_o,null,ne,{boundaryGeojson:0})}}function ur(r){let e,t=ar(r[3])+"",n;return{c(){e=Y("Length: "),n=Y(t)},m(i,o){b(i,e,o),b(i,n,o)},p(i,o){o&8&&t!==(t=ar(i[3])+"")&&et(n,t)},d(i){i&&w(e),i&&w(n)}}}function vo(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,g,d,_,E,h,v,y,x,O,C,R,I,D,B,X,P,z,te,pe,G,le,we,Ae,he,ae,Me,ue=r[3]&&ur(r);return{c(){e=S("label"),t=Y("Name:"),n=S("br"),i=L(),o=S("input"),s=L(),u=S("br"),l=L(),a=S("br"),f=L(),m=S("label"),p=S("input"),c=Y(`
  Area`),g=L(),d=S("label"),_=S("input"),E=Y(`
  Route`),h=L(),v=S("label"),y=S("input"),x=Y(`
  Crossing`),O=L(),C=S("label"),R=S("input"),I=Y(`
  Other`),D=L(),B=S("br"),X=L(),P=S("br"),z=L(),te=S("label"),pe=Y("Description:"),G=S("br"),le=L(),we=S("textarea"),Ae=L(),ue&&ue.c(),he=Le(),T(o,"type","text"),_e(o,"width","100%"),T(p,"type","radio"),p.__value="area",p.value=p.__value,r[6][0].push(p),T(_,"type","radio"),_.__value="route",_.value=_.__value,r[6][0].push(_),T(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[6][0].push(y),T(R,"type","radio"),R.__value="other",R.value=R.__value,r[6][0].push(R),_e(we,"width","100%"),T(we,"rows","5"),T(we,"class","svelte-15lna0i")},m(N,Q){b(N,e,Q),k(e,t),k(e,n),k(e,i),k(e,o),$e(o,r[0]),b(N,s,Q),b(N,u,Q),b(N,l,Q),b(N,a,Q),b(N,f,Q),b(N,m,Q),k(m,p),p.checked=p.__value===r[1],k(m,c),b(N,g,Q),b(N,d,Q),k(d,_),_.checked=_.__value===r[1],k(d,E),b(N,h,Q),b(N,v,Q),k(v,y),y.checked=y.__value===r[1],k(v,x),b(N,O,Q),b(N,C,Q),k(C,R),R.checked=R.__value===r[1],k(C,I),b(N,D,Q),b(N,B,Q),b(N,X,Q),b(N,P,Q),b(N,z,Q),b(N,te,Q),k(te,pe),k(te,G),k(te,le),k(te,we),$e(we,r[2]),b(N,Ae,Q),ue&&ue.m(N,Q),b(N,he,Q),ae||(Me=[j(o,"input",r[4]),j(p,"change",r[5]),j(_,"change",r[7]),j(y,"change",r[8]),j(R,"change",r[9]),j(we,"input",r[10])],ae=!0)},p(N,[Q]){Q&1&&o.value!==N[0]&&$e(o,N[0]),Q&2&&(p.checked=p.__value===N[1]),Q&2&&(_.checked=_.__value===N[1]),Q&2&&(y.checked=y.__value===N[1]),Q&2&&(R.checked=R.__value===N[1]),Q&4&&$e(we,N[2]),N[3]?ue?ue.p(N,Q):(ue=ur(N),ue.c(),ue.m(he.parentNode,he)):ue&&(ue.d(1),ue=null)},i:U,o:U,d(N){N&&w(e),N&&w(s),N&&w(u),N&&w(l),N&&w(a),N&&w(f),N&&w(m),r[6][0].splice(r[6][0].indexOf(p),1),N&&w(g),N&&w(d),r[6][0].splice(r[6][0].indexOf(_),1),N&&w(h),N&&w(v),r[6][0].splice(r[6][0].indexOf(y),1),N&&w(O),N&&w(C),r[6][0].splice(r[6][0].indexOf(R),1),N&&w(D),N&&w(B),N&&w(X),N&&w(P),N&&w(z),N&&w(te),N&&w(Ae),ue&&ue.d(N),N&&w(he),ae=!1,qe(Me)}}}function ar(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function yo(r,e,t){let{name:n}=e,{intervention_type:i}=e,{description:o}=e,{length_meters:s}=e;const u=[[]];function l(){n=this.value,t(0,n)}function a(){i=this.__value,t(1,i)}function f(){i=this.__value,t(1,i)}function m(){i=this.__value,t(1,i)}function p(){i=this.__value,t(1,i)}function c(){o=this.value,t(2,o)}return r.$$set=g=>{"name"in g&&t(0,n=g.name),"intervention_type"in g&&t(1,i=g.intervention_type),"description"in g&&t(2,o=g.description),"length_meters"in g&&t(3,s=g.length_meters)},[n,i,o,s,l,a,u,f,m,p,c]}class bo extends re{constructor(e){super(),ie(this,e,yo,vo,ne,{name:0,intervention_type:1,description:2,length_meters:3})}}const wo="Route",ko=[{name:"RouteType",oneOf:[{name:"OnRoad",members:[{name:"Type",oneOf:["FullSeparation","Stepped","PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}],So={name:wo,members:ko};function fr(r,e,t){const n=r.slice();return n[1]=e[t],n}function cr(r,e,t){const n=r.slice();return n[1]=e[t],n}function Eo(r){let e,t=r[0].name+"",n,i,o;return{c(){e=S("label"),n=Y(t),i=Y(`:
    `),o=S("input"),T(o,"type","number")},m(s,u){b(s,e,u),k(e,n),k(e,i),k(e,o)},p(s,u){u&1&&t!==(t=s[0].name+"")&&et(n,t)},i:U,o:U,d(s){s&&w(e)}}}function Mo(r){let e,t=r[0].name+"",n,i,o,s,u=r[0].oneOf,l=[];for(let f=0;f<u.length;f+=1)l[f]=pr(fr(r,u,f));const a=f=>F(l[f],1,1,()=>{l[f]=null});return{c(){e=S("h1"),n=Y(t),i=L();for(let f=0;f<l.length;f+=1)l[f].c();o=Le()},m(f,m){b(f,e,m),k(e,n),b(f,i,m);for(let p=0;p<l.length;p+=1)l[p].m(f,m);b(f,o,m),s=!0},p(f,m){if((!s||m&1)&&t!==(t=f[0].name+"")&&et(n,t),m&1){u=f[0].oneOf;let p;for(p=0;p<u.length;p+=1){const c=fr(f,u,p);l[p]?(l[p].p(c,m),A(l[p],1)):(l[p]=pr(c),l[p].c(),A(l[p],1),l[p].m(o.parentNode,o))}for(Te(),p=u.length;p<l.length;p+=1)a(p);Ce()}},i(f){if(!s){for(let m=0;m<u.length;m+=1)A(l[m]);s=!0}},o(f){l=l.filter(Boolean);for(let m=0;m<l.length;m+=1)F(l[m]);s=!1},d(f){f&&w(e),f&&w(i),_t(l,f),f&&w(o)}}}function xo(r){let e,t=r[0].name+"",n,i,o,s,u=r[0].members,l=[];for(let f=0;f<u.length;f+=1)l[f]=hr(cr(r,u,f));const a=f=>F(l[f],1,1,()=>{l[f]=null});return{c(){e=S("h1"),n=Y(t),i=L();for(let f=0;f<l.length;f+=1)l[f].c();o=Le()},m(f,m){b(f,e,m),k(e,n),b(f,i,m);for(let p=0;p<l.length;p+=1)l[p].m(f,m);b(f,o,m),s=!0},p(f,m){if((!s||m&1)&&t!==(t=f[0].name+"")&&et(n,t),m&1){u=f[0].members;let p;for(p=0;p<u.length;p+=1){const c=cr(f,u,p);l[p]?(l[p].p(c,m),A(l[p],1)):(l[p]=hr(c),l[p].c(),A(l[p],1),l[p].m(o.parentNode,o))}for(Te(),p=u.length;p<l.length;p+=1)a(p);Ce()}},i(f){if(!s){for(let m=0;m<u.length;m+=1)A(l[m]);s=!0}},o(f){l=l.filter(Boolean);for(let m=0;m<l.length;m+=1)F(l[m]);s=!1},d(f){f&&w(e),f&&w(i),_t(l,f),f&&w(o)}}}function Lo(r){let e,t,n;return{c(){e=S("h1"),t=Y("Error: Field component instantiated for plain string, why? "),n=Y(r[0])},m(i,o){b(i,e,o),k(e,t),k(e,n)},p(i,o){o&1&&et(n,i[0])},i:U,o:U,d(i){i&&w(e)}}}function Ro(r){let e,t,n,i,o=r[1].name+"",s,u,l,a;return l=new Gn({props:{spec:r[1]}}),{c(){e=S("label"),t=S("input"),i=L(),s=Y(o),u=L(),W(l.$$.fragment),T(t,"type","radio"),t.value=n=r[1].name},m(f,m){b(f,e,m),k(e,t),k(e,i),k(e,s),b(f,u,m),V(l,f,m),a=!0},p(f,m){(!a||m&1&&n!==(n=f[1].name))&&(t.value=n),(!a||m&1)&&o!==(o=f[1].name+"")&&et(s,o);const p={};m&1&&(p.spec=f[1]),l.$set(p)},i(f){a||(A(l.$$.fragment,f),a=!0)},o(f){F(l.$$.fragment,f),a=!1},d(f){f&&w(e),f&&w(u),K(l,f)}}}function Oo(r){let e,t,n,i,o=r[1]+"",s,u;return{c(){e=S("label"),t=S("input"),i=L(),s=Y(o),u=L(),T(t,"type","radio"),t.value=n=r[1]},m(l,a){b(l,e,a),k(e,t),k(e,i),k(e,s),k(e,u)},p(l,a){a&1&&n!==(n=l[1])&&(t.value=n),a&1&&o!==(o=l[1]+"")&&et(s,o)},i:U,o:U,d(l){l&&w(e)}}}function pr(r){let e,t,n,i;const o=[Oo,Ro],s=[];function u(l,a){return typeof l[1]=="string"?0:1}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=Le()},m(l,a){s[e].m(l,a),b(l,n,a),i=!0},p(l,a){let f=e;e=u(l),e===f?s[e].p(l,a):(Te(),F(s[f],1,1,()=>{s[f]=null}),Ce(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),A(t,1),t.m(n.parentNode,n))},i(l){i||(A(t),i=!0)},o(l){F(t),i=!1},d(l){s[e].d(l),l&&w(n)}}}function hr(r){let e,t;return e=new Gn({props:{spec:r[1]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.spec=n[1]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function To(r){let e,t,n,i;const o=[Lo,xo,Mo,Eo],s=[];function u(l,a){return typeof l[0]=="string"?0:"members"in l[0]?1:"oneOf"in l[0]?2:l[0].type=="number"?3:-1}return~(e=u(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=Le()},m(l,a){~e&&s[e].m(l,a),b(l,n,a),i=!0},p(l,[a]){let f=e;e=u(l),e===f?~e&&s[e].p(l,a):(t&&(Te(),F(s[f],1,1,()=>{s[f]=null}),Ce()),~e?(t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),A(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(A(t),i=!0)},o(l){F(t),i=!1},d(l){~e&&s[e].d(l),l&&w(n)}}}function Co(r,e,t){let{spec:n}=e;return r.$$set=i=>{"spec"in i&&t(0,n=i.spec)},[n]}class Gn extends re{constructor(e){super(),ie(this,e,Co,To,ne,{spec:0})}}function Ao(r){let e,t;return e=new Gn({props:{spec:r[0]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p:U,i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function Po(r,e,t){let{props:n}=e;n.v2||(n.v2={name:""});let i=So;return r.$$set=o=>{"props"in o&&t(1,n=o.props)},[i,n]}class Fo extends re{constructor(e){super(),ie(this,e,Po,Ao,ne,{props:1})}}function dr(r,e,t){const n=r.slice();return n[12]=e[t],n}function mr(r,e,t){const n=r.slice();return n[12]=e[t],n}function _r(r,e,t){const n=r.slice();return n[12]=e[t],n}function gr(r,e,t){const n=r.slice();return n[12]=e[t],n}function vr(r){let e,t=r[12]+"",n;return{c(){e=S("option"),n=Y(t),e.__value=r[12],e.value=e.__value},m(i,o){b(i,e,o),k(e,n)},p:U,d(i){i&&w(e)}}}function yr(r){let e,t=r[12]+"",n;return{c(){e=S("option"),n=Y(t),e.__value=r[12],e.value=e.__value},m(i,o){b(i,e,o),k(e,n)},p:U,d(i){i&&w(e)}}}function br(r){let e,t=r[12]+"",n;return{c(){e=S("option"),n=Y(t),e.__value=r[12],e.value=e.__value},m(i,o){b(i,e,o),k(e,n)},p:U,d(i){i&&w(e)}}}function wr(r){let e,t=r[12]+"",n;return{c(){e=S("option"),n=Y(t),e.__value=r[12],e.value=e.__value},m(i,o){b(i,e,o),k(e,n)},p:U,d(i){i&&w(e)}}}function No(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,g,d,_,E,h,v,y,x,O,C,R,I,D,B,X,P,z,te,pe,G,le,we,Ae,he,ae,Me,ue,N,Q,Mt,de,ke,xt,ut,ge,fe,Lt,Rt,ve=r[1],Re=[];for(let M=0;M<ve.length;M+=1)Re[M]=vr(gr(r,ve,M));let q=r[2],ee=[];for(let M=0;M<q.length;M+=1)ee[M]=yr(_r(r,q,M));let Xe=r[3],xe=[];for(let M=0;M<Xe.length;M+=1)xe[M]=br(mr(r,Xe,M));let Je=r[4],ye=[];for(let M=0;M<Je.length;M+=1)ye[M]=wr(dr(r,Je,M));return{c(){e=S("label"),t=Y("Name:"),n=S("br"),i=L(),o=S("input"),s=L(),u=S("br"),l=L(),a=S("br"),f=L(),m=S("label"),p=Y(`Reference type:
  `),c=S("select");for(let M=0;M<Re.length;M+=1)Re[M].c();g=L(),d=S("br"),_=L(),E=S("br"),h=L(),v=S("label"),y=Y("Notes:"),x=S("br"),O=L(),C=S("textarea"),R=L(),I=S("br"),D=L(),B=S("br"),X=L(),P=S("label"),z=Y(`Size:
  `),te=S("input"),pe=L(),G=S("select");for(let M=0;M<ee.length;M+=1)ee[M].c();le=L(),we=S("br"),Ae=L(),he=S("br"),ae=L(),Me=S("label"),ue=Y(`ATE Triage:
  `),N=S("select");for(let M=0;M<xe.length;M+=1)xe[M].c();Q=L(),Mt=S("br"),de=L(),ke=S("br"),xt=L(),ut=S("label"),ge=Y(`ATE Recommendation:
  `),fe=S("select");for(let M=0;M<ye.length;M+=1)ye[M].c();T(o,"type","text"),_e(o,"width","100%"),r[0].planning.reference_type===void 0&&at(()=>r[6].call(c)),_e(C,"width","100%"),T(C,"rows","5"),T(C,"class","svelte-15lna0i"),T(te,"type","number"),T(te,"min","0"),T(te,"max","1000"),r[0].planning.size_units===void 0&&at(()=>r[9].call(G)),r[0].planning.triage===void 0&&at(()=>r[10].call(N)),r[0].planning.recommendation===void 0&&at(()=>r[11].call(fe))},m(M,H){b(M,e,H),k(e,t),k(e,n),k(e,i),k(e,o),$e(o,r[0].planning.name),b(M,s,H),b(M,u,H),b(M,l,H),b(M,a,H),b(M,f,H),b(M,m,H),k(m,p),k(m,c);for(let $=0;$<Re.length;$+=1)Re[$].m(c,null);Ne(c,r[0].planning.reference_type),b(M,g,H),b(M,d,H),b(M,_,H),b(M,E,H),b(M,h,H),b(M,v,H),k(v,y),k(v,x),k(v,O),k(v,C),$e(C,r[0].planning.notes),b(M,R,H),b(M,I,H),b(M,D,H),b(M,B,H),b(M,X,H),b(M,P,H),k(P,z),k(P,te),$e(te,r[0].planning.size),k(P,pe),k(P,G);for(let $=0;$<ee.length;$+=1)ee[$].m(G,null);Ne(G,r[0].planning.size_units),b(M,le,H),b(M,we,H),b(M,Ae,H),b(M,he,H),b(M,ae,H),b(M,Me,H),k(Me,ue),k(Me,N);for(let $=0;$<xe.length;$+=1)xe[$].m(N,null);Ne(N,r[0].planning.triage),b(M,Q,H),b(M,Mt,H),b(M,de,H),b(M,ke,H),b(M,xt,H),b(M,ut,H),k(ut,ge),k(ut,fe);for(let $=0;$<ye.length;$+=1)ye[$].m(fe,null);Ne(fe,r[0].planning.recommendation),Lt||(Rt=[j(o,"input",r[5]),j(c,"change",r[6]),j(C,"input",r[7]),j(te,"input",r[8]),j(G,"change",r[9]),j(N,"change",r[10]),j(fe,"change",r[11])],Lt=!0)},p(M,[H]){if(H&3&&o.value!==M[0].planning.name&&$e(o,M[0].planning.name),H&2){ve=M[1];let $;for($=0;$<ve.length;$+=1){const Be=gr(M,ve,$);Re[$]?Re[$].p(Be,H):(Re[$]=vr(Be),Re[$].c(),Re[$].m(c,null))}for(;$<Re.length;$+=1)Re[$].d(1);Re.length=ve.length}if(H&3&&Ne(c,M[0].planning.reference_type),H&3&&$e(C,M[0].planning.notes),H&3&&Hr(te.value)!==M[0].planning.size&&$e(te,M[0].planning.size),H&4){q=M[2];let $;for($=0;$<q.length;$+=1){const Be=_r(M,q,$);ee[$]?ee[$].p(Be,H):(ee[$]=yr(Be),ee[$].c(),ee[$].m(G,null))}for(;$<ee.length;$+=1)ee[$].d(1);ee.length=q.length}if(H&3&&Ne(G,M[0].planning.size_units),H&8){Xe=M[3];let $;for($=0;$<Xe.length;$+=1){const Be=mr(M,Xe,$);xe[$]?xe[$].p(Be,H):(xe[$]=br(Be),xe[$].c(),xe[$].m(N,null))}for(;$<xe.length;$+=1)xe[$].d(1);xe.length=Xe.length}if(H&3&&Ne(N,M[0].planning.triage),H&16){Je=M[4];let $;for($=0;$<Je.length;$+=1){const Be=dr(M,Je,$);ye[$]?ye[$].p(Be,H):(ye[$]=wr(Be),ye[$].c(),ye[$].m(fe,null))}for(;$<ye.length;$+=1)ye[$].d(1);ye.length=Je.length}H&3&&Ne(fe,M[0].planning.recommendation)},i:U,o:U,d(M){M&&w(e),M&&w(s),M&&w(u),M&&w(l),M&&w(a),M&&w(f),M&&w(m),_t(Re,M),M&&w(g),M&&w(d),M&&w(_),M&&w(E),M&&w(h),M&&w(v),M&&w(R),M&&w(I),M&&w(D),M&&w(B),M&&w(X),M&&w(P),_t(ee,M),M&&w(le),M&&w(we),M&&w(Ae),M&&w(he),M&&w(ae),M&&w(Me),_t(xe,M),M&&w(Q),M&&w(Mt),M&&w(de),M&&w(ke),M&&w(xt),M&&w(ut),_t(ye,M),Lt=!1,qe(Rt)}}}function $o(r,e,t){let{props:n}=e;n.planning||(n.planning={name:"",notes:"",reference_type:"preapp",size:0,size_units:"number of units",triage:"No Comment",recommendation:"No Comment"});const i=["preapp","outline","reserved matters","local plan"],o=["number of units","floorspace (Gross Floor Area)","area (Hectare)"],s=["No Comment","Standing Advice","Toolkit Assessment"],u=["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"];function l(){n.planning.name=this.value,t(0,n),t(1,i)}function a(){n.planning.reference_type=gt(this),t(0,n),t(1,i)}function f(){n.planning.notes=this.value,t(0,n),t(1,i)}function m(){n.planning.size=Hr(this.value),t(0,n),t(1,i)}function p(){n.planning.size_units=gt(this),t(0,n),t(1,i)}function c(){n.planning.triage=gt(this),t(0,n),t(1,i)}function g(){n.planning.recommendation=gt(this),t(0,n),t(1,i)}return r.$$set=d=>{"props"in d&&t(0,n=d.props)},[n,i,o,s,u,l,a,f,m,p,c,g]}class Io extends re{constructor(e){super(),ie(this,e,$o,No,ne,{props:0})}}function Bo(r){const e=r-1;return e*e*e+1}function kr(r,{delay:e=0,duration:t=400,easing:n=Bo}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),u=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),a=parseFloat(i.marginTop),f=parseFloat(i.marginBottom),m=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:c=>`overflow: hidden;opacity: ${Math.min(c*20,1)*o};height: ${c*s}px;padding-top: ${c*u}px;padding-bottom: ${c*l}px;margin-top: ${c*a}px;margin-bottom: ${c*f}px;border-top-width: ${c*m}px;border-bottom-width: ${c*p}px;`}}function Sr(r){let e,t,n,i,o;const s=r[10].default,u=Ct(s,r,r[9],null);return{c(){e=S("div"),u&&u.c(),_e(e,"border","solid 1px black"),_e(e,"padding","10px")},m(l,a){b(l,e,a),u&&u.m(e,null),r[13](e),n=!0,i||(o=j(e,"introend",r[14]),i=!0)},p(l,a){u&&u.p&&(!n||a&512)&&At(u,s,l,l[9],n?Ft(s,l[9],a,null):Pt(l[9]),null)},i(l){n||(A(u,l),at(()=>{t||(t=Hn(e,kr,{duration:100},!0)),t.run(1)}),n=!0)},o(l){F(u,l),t||(t=Hn(e,kr,{duration:100},!1)),t.run(0),n=!1},d(l){l&&w(e),u&&u.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Do(r){let e,t,n,i,o,s,u,l,a,f,m=r[4]&&Sr(r);return{c(){e=S("button"),t=zn("svg"),n=zn("path"),i=L(),o=Y(r[1]),s=L(),m&&m.c(),u=Le(),T(n,"d","M9 5l7 7-7 7"),T(t,"style","tran"),T(t,"width","20"),T(t,"height","20"),T(t,"fill","none"),T(t,"stroke-linecap","round"),T(t,"stroke-linejoin","round"),T(t,"stroke-width","2"),T(t,"viewBox","0 0 24 24"),T(t,"stroke","currentColor"),T(t,"class","svelte-t7fpgu"),T(e,"aria-expanded",r[4]),T(e,"class","svelte-t7fpgu"),Yn(e,"underlined",r[3])},m(p,c){b(p,e,c),k(e,t),k(t,n),k(e,i),k(e,o),b(p,s,c),m&&m.m(p,c),b(p,u,c),l=!0,a||(f=[j(e,"click",r[5]),j(e,"mouseenter",r[11]),j(e,"mouseleave",r[12])],a=!0)},p(p,[c]){(!l||c&2)&&et(o,p[1]),(!l||c&16)&&T(e,"aria-expanded",p[4]),(!l||c&8)&&Yn(e,"underlined",p[3]),p[4]?m?(m.p(p,c),c&16&&A(m,1)):(m=Sr(p),m.c(),A(m,1),m.m(u.parentNode,u)):m&&(Te(),F(m,1,1,()=>{m=null}),Ce())},i(p){l||(A(m),l=!0)},o(p){F(m),l=!1},d(p){p&&w(e),p&&w(s),m&&m.d(p),p&&w(u),a=!1,qe(f)}}}function Go(r,e,t){let n,i,o,s;ce(r,Ke,h=>t(7,o=h)),ce(r,Fe,h=>t(8,s=h));let{$$slots:u={},$$scope:l}=e,{id:a}=e,{label:f}=e;const m=()=>{Fe.update(h=>h==a?null:a),s==a&&(wn.set(null),wn.set(a))};let p;function c(){p==null||p.scrollIntoView({behavior:"smooth"})}const g=()=>Qt.set(a),d=()=>Qt.set(null);function _(h){be[h?"unshift":"push"](()=>{p=h,t(2,p)})}const E=()=>c();return r.$$set=h=>{"id"in h&&t(0,a=h.id),"label"in h&&t(1,f=h.label),"$$scope"in h&&t(9,l=h.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==a),r.$$.dirty&129&&t(3,i=o==a)},[a,f,p,i,n,m,c,o,s,l,u,g,d,_,E]}class qo extends re{constructor(e){super(),ie(this,e,Go,Do,ne,{id:0,label:1})}}function Er(r,e,t){const n=r.slice();return n[12]=e[t],n[13]=e,n[14]=t,n}function jo(r){let e,t,n;function i(s){r[8](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new Io({props:o}),be.push(()=>Ze(e,"props",i,r[12].properties)),{c(){W(e.$$.fragment)},m(s,u){V(e,s,u),n=!0},p(s,u){r=s;const l={};!t&&u&2&&(t=!0,l.props=r[12].properties,Qe(()=>t=!1)),e.$set(l)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){F(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function zo(r){let e,t,n;function i(s){r[7](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new Fo({props:o}),be.push(()=>Ze(e,"props",i,r[12].properties)),{c(){W(e.$$.fragment)},m(s,u){V(e,s,u),n=!0},p(s,u){r=s;const l={};!t&&u&2&&(t=!0,l.props=r[12].properties,Qe(()=>t=!1)),e.$set(l)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){F(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function Yo(r){let e,t,n,i,o;function s(f){r[4](f,r[12])}function u(f){r[5](f,r[12])}function l(f){r[6](f,r[12])}let a={length_meters:r[12].properties.length_meters};return r[12].properties.name!==void 0&&(a.name=r[12].properties.name),r[12].properties.intervention_type!==void 0&&(a.intervention_type=r[12].properties.intervention_type),r[12].properties.description!==void 0&&(a.description=r[12].properties.description),e=new bo({props:a}),be.push(()=>Ze(e,"name",s,r[12].properties.name)),be.push(()=>Ze(e,"intervention_type",u,r[12].properties.intervention_type)),be.push(()=>Ze(e,"description",l,r[12].properties.description)),{c(){W(e.$$.fragment)},m(f,m){V(e,f,m),o=!0},p(f,m){r=f;const p={};m&2&&(p.length_meters=r[12].properties.length_meters),!t&&m&2&&(t=!0,p.name=r[12].properties.name,Qe(()=>t=!1)),!n&&m&2&&(n=!0,p.intervention_type=r[12].properties.intervention_type,Qe(()=>n=!1)),!i&&m&2&&(i=!0,p.description=r[12].properties.description,Qe(()=>i=!1)),e.$set(p)},i(f){o||(A(e.$$.fragment,f),o=!0)},o(f){F(e.$$.fragment,f),o=!1},d(f){K(e,f)}}}function Ho(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,g,d;const _=[Yo,zo,jo],E=[];function h(y,x){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:-1}~(e=h(r))&&(t=E[e]=_[e](r));function v(){return r[9](r[12])}return{c(){t&&t.c(),n=L(),i=S("br"),o=L(),s=S("br"),u=L(),l=S("div"),a=S("button"),a.textContent="Delete",f=L(),m=S("button"),m.textContent="Save",p=L(),T(a,"type","button"),T(m,"type","button"),_e(l,"display","flex"),_e(l,"justify-content","space-between")},m(y,x){~e&&E[e].m(y,x),b(y,n,x),b(y,i,x),b(y,o,x),b(y,s,x),b(y,u,x),b(y,l,x),k(l,a),k(l,f),k(l,m),b(y,p,x),c=!0,g||(d=[j(a,"click",v),j(m,"click",r[10])],g=!0)},p(y,x){r=y;let O=e;e=h(r),e===O?~e&&E[e].p(r,x):(t&&(Te(),F(E[O],1,1,()=>{E[O]=null}),Ce()),~e?(t=E[e],t?t.p(r,x):(t=E[e]=_[e](r),t.c()),A(t,1),t.m(n.parentNode,n)):t=null)},i(y){c||(A(t),c=!0)},o(y){F(t),c=!1},d(y){~e&&E[e].d(y),y&&w(n),y&&w(i),y&&w(o),y&&w(s),y&&w(u),y&&w(l),y&&w(p),g=!1,qe(d)}}}function Mr(r,e){let t,n,i;return n=new qo({props:{id:e[12].id,label:e[14]+1+") "+e[2](e[12]),$$slots:{default:[Ho]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=Le(),W(n.$$.fragment),this.first=t},m(o,s){b(o,t,s),V(n,o,s),i=!0},p(o,s){e=o;const u={};s&2&&(u.id=e[12].id),s&2&&(u.label=e[14]+1+") "+e[2](e[12])),s&32771&&(u.$$scope={dirty:s,ctx:e}),n.$set(u)},i(o){i||(A(n.$$.fragment,o),i=!0)},o(o){F(n.$$.fragment,o),i=!1},d(o){o&&w(t),K(n,o)}}}function Uo(r){let e=[],t=new Map,n,i,o,s,u=r[1].features;const l=a=>a[12].id;for(let a=0;a<u.length;a+=1){let f=Er(r,u,a),m=l(f);t.set(m,e[a]=Mr(m,f))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=Le()},m(a,f){for(let m=0;m<e.length;m+=1)e[m].m(a,f);b(a,n,f),i=!0,o||(s=j(window,"keydown",r[3]),o=!0)},p(a,[f]){f&7&&(u=a[1].features,Te(),e=_i(e,f,l,1,a,u,t,n.parentNode,gi,Mr,n,Er),Ce())},i(a){if(!i){for(let f=0;f<u.length;f+=1)A(e[f]);i=!0}},o(a){for(let f=0;f<e.length;f+=1)F(e[f]);i=!1},d(a){for(let f=0;f<e.length;f+=1)e[f].d(a);a&&w(n),o=!1,s()}}}function Xo(r,e,t){let n,i;ce(r,Fe,d=>t(11,n=d)),ce(r,se,d=>t(1,i=d));let{schema:o}=e;function s(d){var E;if(o=="planning")return((E=d.properties.planning)==null?void 0:E.name)||"Untitled polygon";if(d.properties.name)return d.properties.name;var _=d.properties.intervention_type;return _=="other"&&(d.geometry.type=="Point"?_="point":d.geometry.type=="LineString"?_="line":_="polygon"),`Untitled ${_}`}function u(d){if(d.key=="Delete"){const _=d.target.tagName;if(_=="INPUT"||_=="TEXTAREA")return;d.preventDefault();const E=n;E&&Xn(E)}}function l(d,_){r.$$.not_equal(_.properties.name,d)&&(_.properties.name=d,se.set(i))}function a(d,_){r.$$.not_equal(_.properties.intervention_type,d)&&(_.properties.intervention_type=d,se.set(i))}function f(d,_){r.$$.not_equal(_.properties.description,d)&&(_.properties.description=d,se.set(i))}function m(d,_){r.$$.not_equal(_.properties,d)&&(_.properties=d,se.set(i))}function p(d,_){r.$$.not_equal(_.properties,d)&&(_.properties=d,se.set(i))}const c=d=>Xn(d.id),g=()=>Fe.set(null);return r.$$set=d=>{"schema"in d&&t(0,o=d.schema)},[o,i,s,u,l,a,f,m,p,c,g]}class Jo extends re{constructor(e){super(),ie(this,e,Xo,Uo,ne,{schema:0})}}function st(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ye(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Rn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function nt(r,e,t){t===void 0&&(t={});var n=st(r),i=st(e),o=De(i[1]-n[1]),s=De(i[0]-n[0]),u=De(n[1]),l=De(i[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return vi(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),t.units)}function Xt(r,e){return e===void 0&&(e={}),yi(r,function(t,n){var i=n.geometry.coordinates;return t+nt(i[0],i[1],e)},0)}function Wo(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,g,d,_,E,h,v,y=r[0].features.length+"",x,O,C,R,I,D,B,X;return{c(){e=S("div"),t=S("label"),n=Y(`Scheme name:
    `),i=S("input"),o=L(),s=S("br"),u=L(),l=S("div"),a=S("label"),f=S("input"),m=L(),p=S("button"),p.textContent="Load from GeoJSON",c=L(),g=S("button"),g.textContent="Export to GeoJSON",d=L(),_=S("br"),E=L(),h=S("div"),v=S("span"),x=Y(y),O=Y(" interventions"),C=L(),R=S("button"),I=Y("Clear all"),T(i,"type","text"),T(f,"type","file"),T(f,"id","load_geojson"),T(f,"class","svelte-lhyd1e"),T(p,"type","button"),T(g,"type","button"),T(g,"class","align-right svelte-lhyd1e"),T(R,"type","button"),T(R,"class","align-right svelte-lhyd1e"),R.disabled=D=r[0].features.length==0},m(P,z){b(P,e,z),k(e,t),k(t,n),k(t,i),$e(i,r[0].scheme_name),b(P,o,z),b(P,s,z),b(P,u,z),b(P,l,z),k(l,a),k(a,f),k(a,m),k(a,p),k(l,c),k(l,g),b(P,d,z),b(P,_,z),b(P,E,z),b(P,h,z),k(h,v),k(v,x),k(v,O),k(h,C),k(h,R),k(R,I),B||(X=[j(i,"input",r[7]),j(f,"change",r[3]),j(p,"click",Ko),j(g,"click",r[2]),j(R,"click",r[1])],B=!0)},p(P,[z]){z&1&&i.value!==P[0].scheme_name&&$e(i,P[0].scheme_name),z&1&&y!==(y=P[0].features.length+"")&&et(x,y),z&1&&D!==(D=P[0].features.length==0)&&(R.disabled=D)},i:U,o:U,d(P){P&&w(e),P&&w(o),P&&w(s),P&&w(u),P&&w(l),P&&w(d),P&&w(_),P&&w(E),P&&w(h),B=!1,qe(X)}}}function Vo(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Ko(){document.getElementById("load_geojson").click()}function Zo(r,e,t){let n;ce(r,se,g=>t(0,n=g));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let u=window.localStorage.getItem(s);if(u)try{se.set(p(JSON.parse(u)))}catch(g){console.log(`Failed to load from local storage: ${g}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&se.update(g=>(delete g.scheme_name,g.features=[],g))}function a(){const g=JSON.parse(JSON.stringify(n));for(let d of g.features)delete d.properties.hide_while_editing;return g}function f(){let g=a();var d=s;g.authority=i,g.origin="atip-v1",g.scheme_name&&(d+="_"+g.scheme_name),d+=".txt",Vo(d,JSON.stringify(g,null,"  "))}function m(g){const d=new FileReader;d.onload=E=>{try{se.set(p(JSON.parse(E.target.result)))}catch(h){window.alert(`Couldn't load scheme from a file: ${h}`)}};let _=g.target.files;d.readAsText(_[0])}function p(g){let d=1;for(let _ of g.features)_.properties||(_.properties={name:"",description:"",intervention_type:"other"}),_.geometry.type=="LineString"&&!_.properties.length_meters&&(_.properties.length_meters=Xt(_,{units:"kilometers"})*1e3),_.id=d++;return g}function c(){n.scheme_name=this.value,se.set(n)}return r.$$set=g=>{"authorityName"in g&&t(4,i=g.authorityName),"schema"in g&&t(5,o=g.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(a())))},[n,l,f,m,i,o,s,c]}class Qo extends re{constructor(e){super(),ie(this,e,Zo,Wo,ne,{authorityName:4,schema:5})}}const es="/atip/assets/zoom_out_map-b2e1091a.svg";function ts(r){let e,t,n,i,o;return{c(){e=S("button"),t=S("img"),bi(t.src,n=es)||T(t,"src",n),T(t,"alt","Zoom to show entire boundary"),T(e,"type","button"),T(e,"title","Zoom to show entire boundary"),T(e,"class","svelte-qzjsqo")},m(s,u){b(s,e,u),k(e,t),i||(o=j(e,"click",r[0]),i=!0)},p:U,i:U,o:U,d(s){s&&w(e),i=!1,o()}}}function ns(r,e,t){let n;ce(r,Ue,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds($n(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class rs extends re{constructor(e){super(),ie(this,e,ns,ts,ne,{boundaryGeojson:1})}}function is(r){let e,t,n,i,o,s,u;return{c(){e=S("div"),t=Y(`Basemap:
  `),n=S("select"),i=S("option"),i.textContent="Streets",o=S("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&at(()=>r[2].call(n)),T(e,"class","svelte-1tbnm6i")},m(l,a){b(l,e,a),k(e,t),k(e,n),k(n,i),k(n,o),Ne(n,r[0]),s||(u=[j(n,"change",r[2]),j(n,"change",r[1])],s=!0)},p(l,[a]){a&1&&Ne(n,l[0])},i:U,o:U,d(l){l&&w(e),s=!1,qe(u)}}}function os(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let u=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=u}function o(){n=gt(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class ss extends re{constructor(e){super(),ie(this,e,os,is,ne,{style:0})}}const me={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},pn=10,nn=10;function ls(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,g,d;return{c(){e=S("li"),t=S("span"),n=Y("Areas"),i=L(),o=S("li"),s=S("span"),u=Y("Routes"),l=L(),a=S("li"),f=S("span"),m=Y("Crossings"),p=L(),c=S("li"),g=S("span"),d=Y("Other"),T(t,"class","svelte-p551i1"),_e(t,"background",me.area),T(s,"class","svelte-p551i1"),_e(s,"background",me.route),T(f,"class","svelte-p551i1"),_e(f,"background",me.crossing),T(g,"class","svelte-p551i1"),_e(g,"background",me.other)},m(_,E){b(_,e,E),k(e,t),k(e,n),b(_,i,E),b(_,o,E),k(o,s),k(o,u),b(_,l,E),b(_,a,E),k(a,f),k(a,m),b(_,p,E),b(_,c,E),k(c,g),k(c,d)},p:U,d(_){_&&w(e),_&&w(i),_&&w(o),_&&w(l),_&&w(a),_&&w(p),_&&w(c)}}}function us(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,g,d;return{c(){e=S("li"),t=S("span"),n=Y("Preapp"),i=L(),o=S("li"),s=S("span"),u=Y("Outline"),l=L(),a=S("li"),f=S("span"),m=Y("Reserved matters"),p=L(),c=S("li"),g=S("span"),d=Y("Local plan"),T(t,"class","svelte-p551i1"),_e(t,"background",me.preapp),T(s,"class","svelte-p551i1"),_e(s,"background",me.outline),T(f,"class","svelte-p551i1"),_e(f,"background",me["reserved matters"]),T(g,"class","svelte-p551i1"),_e(g,"background",me["local plan"])},m(_,E){b(_,e,E),k(e,t),k(e,n),b(_,i,E),b(_,o,E),k(o,s),k(o,u),b(_,l,E),b(_,a,E),k(a,f),k(a,m),b(_,p,E),b(_,c,E),k(c,g),k(c,d)},p:U,d(_){_&&w(e),_&&w(i),_&&w(o),_&&w(l),_&&w(a),_&&w(p),_&&w(c)}}}function as(r){let e,t,n,i;function o(l,a){return l[0]=="planning"?us:ls}let s=o(r),u=s(r);return{c(){e=S("div"),t=S("h1"),t.textContent="Interventions",n=L(),i=S("ul"),u.c(),T(t,"class","svelte-p551i1"),T(e,"class","svelte-p551i1")},m(l,a){b(l,e,a),k(e,t),k(e,n),k(e,i),u.m(i,null)},p(l,[a]){s===(s=o(l))&&u?u.p(l,a):(u.d(1),u=s(l),u&&(u.c(),u.m(i,null)))},i:U,o:U,d(l){l&&w(e),u.d()}}}function fs(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class cs extends re{constructor(e){super(),ie(this,e,fs,as,ne,{schema:0})}}let pt="interventions";function ps(r,e,t){let n,i;ce(r,Ue,f=>t(1,n=f)),ce(r,se,f=>t(2,i=f));let{schema:o}=e;ft(n,pt,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",me.area,"route",me.route,"crossing",me.crossing,"other",me.other,"white"],u=["match",["get","reference_type",["get","planning"]],"preapp",me.preapp,"outline",me.outline,"reserved matters",me["reserved matters"],"local plan",me["local plan"],"white"],l=["!=","hide_while_editing",!0];return Oe(n,{id:"interventions-points",source:pt,filter:["all",an,l,["!=","endpoint",!0]],...St(s,pn)}),Oe(n,{id:"interventions-lines",source:pt,filter:["all",fn,l],...Dt(s,nn)},"route-lines"),Oe(n,{id:"interventions-lines-endpoints",source:pt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*nn,"circle-opacity":0,"circle-stroke-color":me.lineEndpointColor,"circle-stroke-width":2}}),Oe(n,{id:"interventions-polygons",source:pt,filter:["all",cn,l],...un(o=="planning"?u:s,.5)},"hover-polygons"),r.$$set=f=>{"schema"in f&&t(0,o=f.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let f=JSON.parse(JSON.stringify(i)),m=[];for(let p of f.features)if(p.geometry.type=="LineString")for(let c of[p.geometry.coordinates[0],p.geometry.coordinates[p.geometry.coordinates.length-1]])m.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:c}});f.features=f.features.concat(m),n.getSource(pt).setData(f)}},[o,n,i]}class hs extends re{constructor(e){super(),ie(this,e,ps,null,ne,{schema:0})}}let ht="hover";function ds(r,e,t){let n,i,o,s,u;return ce(r,Ue,l=>t(0,n=l)),ce(r,se,l=>t(1,i=l)),ce(r,Qt,l=>t(2,o=l)),ce(r,Ke,l=>t(3,s=l)),ce(r,Fe,l=>t(4,u=l)),ft(n,ht,{type:"geojson",data:He()}),Oe(n,{id:"hover-polygons",source:ht,filter:cn,...Dt(me.hovering,.5*nn,1)}),Oe(n,{id:"hover-lines",source:ht,filter:fn,...Dt(me.hovering,1.5*nn,1)},"interventions-lines"),Oe(n,{id:"hover-points",source:ht,filter:an,...St(me.hovering,1.5*pn,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=u||s||o;l!=null?n.getSource(ht).setData(i.features.find(a=>a.id==l)):n.getSource(ht).setData(He())}},[n,i,o,s,u]}class ms extends re{constructor(e){super(),ie(this,e,ds,null,ne,{})}}class qn{constructor(e,t){oe(this,"owner");oe(this,"map");oe(this,"mapHandlers",{});oe(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Yt="edit-point-mode";class _s{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"cursor");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new qn(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),ft(e,Yt,{type:"geojson",data:He()}),Oe(e,{id:"edit-point-mode",source:Yt,...St(me.hovering,pn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=gs(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Yt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=He();this.cursor&&e.features.push(this.cursor),this.map.getSource(Yt).setData(e)}}function gs(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Jr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return vs(r,e);var n=st(r),i=st(e),o=De(n[0]),s=De(i[0]),u=De(n[1]),l=De(i[1]),a=Math.sin(s-o)*Math.cos(l),f=Math.cos(u)*Math.sin(l)-Math.sin(u)*Math.cos(l)*Math.cos(s-o);return bn(Math.atan2(a,f))}function vs(r,e){var t=Jr(e,r);return t=(t+180)%360,t}function xr(r,e,t,n){n===void 0&&(n={});var i=st(r),o=De(i[0]),s=De(i[1]),u=De(t),l=wi(e,n.units),a=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(u)),f=o+Math.atan2(Math.sin(u)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(a)),m=bn(f),p=bn(a);return bt([m,p],n.properties)}function On(r){if(!r)throw new Error("geojson is required");var e=[];return In(r,function(t){ys(t,e)}),ot(e)}function ys(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ye(n);break;case"LineString":t=[Ye(n)]}t.forEach(function(i){var o=bs(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function bs(r,e){var t=[];return r.reduce(function(n,i){var o=wt([n,i],e);return o.bbox=ws(n,i),t.push(o),i}),t}function ws(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,u=n<o?n:o,l=t>i?t:i,a=n>o?n:o;return[s,u,l,a]}var kt={},ks={get exports(){return kt},set exports(r){kt=r}},Tn={},Ss={get exports(){return Tn},set exports(r){Tn=r}};(function(r,e){(function(t,n){r.exports=n()})(ki,function(){function t(h,v,y,x,O){(function C(R,I,D,B,X){for(;B>D;){if(B-D>600){var P=B-D+1,z=I-D+1,te=Math.log(P),pe=.5*Math.exp(2*te/3),G=.5*Math.sqrt(te*pe*(P-pe)/P)*(z-P/2<0?-1:1),le=Math.max(D,Math.floor(I-z*pe/P+G)),we=Math.min(B,Math.floor(I+(P-z)*pe/P+G));C(R,I,le,we,X)}var Ae=R[I],he=D,ae=B;for(n(R,D,I),X(R[B],Ae)>0&&n(R,D,B);he<ae;){for(n(R,he,ae),he++,ae--;X(R[he],Ae)<0;)he++;for(;X(R[ae],Ae)>0;)ae--}X(R[D],Ae)===0?n(R,D,ae):n(R,++ae,B),ae<=I&&(D=ae+1),I<=ae&&(B=ae-1)}})(h,v,y||0,x||h.length-1,O||i)}function n(h,v,y){var x=h[v];h[v]=h[y],h[y]=x}function i(h,v){return h<v?-1:h>v?1:0}var o=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(h,v,y){if(!y)return v.indexOf(h);for(var x=0;x<v.length;x++)if(y(h,v[x]))return x;return-1}function u(h,v){l(h,0,h.children.length,v,h)}function l(h,v,y,x,O){O||(O=_(null)),O.minX=1/0,O.minY=1/0,O.maxX=-1/0,O.maxY=-1/0;for(var C=v;C<y;C++){var R=h.children[C];a(O,h.leaf?x(R):R)}return O}function a(h,v){return h.minX=Math.min(h.minX,v.minX),h.minY=Math.min(h.minY,v.minY),h.maxX=Math.max(h.maxX,v.maxX),h.maxY=Math.max(h.maxY,v.maxY),h}function f(h,v){return h.minX-v.minX}function m(h,v){return h.minY-v.minY}function p(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function c(h){return h.maxX-h.minX+(h.maxY-h.minY)}function g(h,v){return h.minX<=v.minX&&h.minY<=v.minY&&v.maxX<=h.maxX&&v.maxY<=h.maxY}function d(h,v){return v.minX<=h.maxX&&v.minY<=h.maxY&&v.maxX>=h.minX&&v.maxY>=h.minY}function _(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(h,v,y,x,O){for(var C=[v,y];C.length;)if(!((y=C.pop())-(v=C.pop())<=x)){var R=v+Math.ceil((y-v)/x/2)*x;t(h,R,v,y,O),C.push(v,R,R,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(h){var v=this.data,y=[];if(!d(h,v))return y;for(var x=this.toBBox,O=[];v;){for(var C=0;C<v.children.length;C++){var R=v.children[C],I=v.leaf?x(R):R;d(h,I)&&(v.leaf?y.push(R):g(h,I)?this._all(R,y):O.push(R))}v=O.pop()}return y},o.prototype.collides=function(h){var v=this.data;if(!d(h,v))return!1;for(var y=[];v;){for(var x=0;x<v.children.length;x++){var O=v.children[x],C=v.leaf?this.toBBox(O):O;if(d(h,C)){if(v.leaf||g(h,C))return!0;y.push(O)}}v=y.pop()}return!1},o.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var v=0;v<h.length;v++)this.insert(h[v]);return this}var y=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var x=this.data;this.data=y,y=x}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(h,v){if(!h)return this;for(var y,x,O,C=this.data,R=this.toBBox(h),I=[],D=[];C||I.length;){if(C||(C=I.pop(),x=I[I.length-1],y=D.pop(),O=!0),C.leaf){var B=s(h,C.children,v);if(B!==-1)return C.children.splice(B,1),I.push(C),this._condense(I),this}O||C.leaf||!g(C,R)?x?(y++,C=x.children[y],O=!1):C=null:(I.push(C),D.push(y),y=0,x=C,C=C.children[0])}return this},o.prototype.toBBox=function(h){return h},o.prototype.compareMinX=function(h,v){return h.minX-v.minX},o.prototype.compareMinY=function(h,v){return h.minY-v.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(h){return this.data=h,this},o.prototype._all=function(h,v){for(var y=[];h;)h.leaf?v.push.apply(v,h.children):y.push.apply(y,h.children),h=y.pop();return v},o.prototype._build=function(h,v,y,x){var O,C=y-v+1,R=this._maxEntries;if(C<=R)return u(O=_(h.slice(v,y+1)),this.toBBox),O;x||(x=Math.ceil(Math.log(C)/Math.log(R)),R=Math.ceil(C/Math.pow(R,x-1))),(O=_([])).leaf=!1,O.height=x;var I=Math.ceil(C/R),D=I*Math.ceil(Math.sqrt(R));E(h,v,y,D,this.compareMinX);for(var B=v;B<=y;B+=D){var X=Math.min(B+D-1,y);E(h,B,X,I,this.compareMinY);for(var P=B;P<=X;P+=I){var z=Math.min(P+I-1,X);O.children.push(this._build(h,P,z,x-1))}}return u(O,this.toBBox),O},o.prototype._chooseSubtree=function(h,v,y,x){for(;x.push(v),!v.leaf&&x.length-1!==y;){for(var O=1/0,C=1/0,R=void 0,I=0;I<v.children.length;I++){var D=v.children[I],B=p(D),X=(P=h,z=D,(Math.max(z.maxX,P.maxX)-Math.min(z.minX,P.minX))*(Math.max(z.maxY,P.maxY)-Math.min(z.minY,P.minY))-B);X<C?(C=X,O=B<O?B:O,R=D):X===C&&B<O&&(O=B,R=D)}v=R||v.children[0]}var P,z;return v},o.prototype._insert=function(h,v,y){var x=y?h:this.toBBox(h),O=[],C=this._chooseSubtree(x,this.data,v,O);for(C.children.push(h),a(C,x);v>=0&&O[v].children.length>this._maxEntries;)this._split(O,v),v--;this._adjustParentBBoxes(x,O,v)},o.prototype._split=function(h,v){var y=h[v],x=y.children.length,O=this._minEntries;this._chooseSplitAxis(y,O,x);var C=this._chooseSplitIndex(y,O,x),R=_(y.children.splice(C,y.children.length-C));R.height=y.height,R.leaf=y.leaf,u(y,this.toBBox),u(R,this.toBBox),v?h[v-1].children.push(R):this._splitRoot(y,R)},o.prototype._splitRoot=function(h,v){this.data=_([h,v]),this.data.height=h.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(h,v,y){for(var x,O,C,R,I,D,B,X=1/0,P=1/0,z=v;z<=y-v;z++){var te=l(h,0,z,this.toBBox),pe=l(h,z,y,this.toBBox),G=(O=te,C=pe,R=void 0,I=void 0,D=void 0,B=void 0,R=Math.max(O.minX,C.minX),I=Math.max(O.minY,C.minY),D=Math.min(O.maxX,C.maxX),B=Math.min(O.maxY,C.maxY),Math.max(0,D-R)*Math.max(0,B-I)),le=p(te)+p(pe);G<X?(X=G,x=z,P=le<P?le:P):G===X&&le<P&&(P=le,x=z)}return x||y-v},o.prototype._chooseSplitAxis=function(h,v,y){var x=h.leaf?this.compareMinX:f,O=h.leaf?this.compareMinY:m;this._allDistMargin(h,v,y,x)<this._allDistMargin(h,v,y,O)&&h.children.sort(x)},o.prototype._allDistMargin=function(h,v,y,x){h.children.sort(x);for(var O=this.toBBox,C=l(h,0,v,O),R=l(h,y-v,y,O),I=c(C)+c(R),D=v;D<y-v;D++){var B=h.children[D];a(C,h.leaf?O(B):B),I+=c(C)}for(var X=y-v-1;X>=v;X--){var P=h.children[X];a(R,h.leaf?O(P):P),I+=c(R)}return I},o.prototype._adjustParentBBoxes=function(h,v,y){for(var x=y;x>=0;x--)a(v[x],h)},o.prototype._condense=function(h){for(var v=h.length-1,y=void 0;v>=0;v--)h[v].children.length===0?v>0?(y=h[v-1].children).splice(y.indexOf(h[v]),1):this.clear():u(h[v],this.toBBox)},o})})(Ss);const Es=Bn(Si),Ms=Bn(Ei),xs=Bn(Mi);var je=Tn,Wr=Es,Vr=Ms,dt=xs.default,Ls=Vr.featureEach;Vr.coordEach;Wr.polygon;var Lr=Wr.featureCollection;function Kr(r){var e=new je(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:dt(t),je.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:dt(i),n.push(i)}):Ls(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:dt(i),n.push(i)}),je.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:dt(t),je.prototype.remove.call(this,t,n)},e.clear=function(){return je.prototype.clear.call(this)},e.search=function(t){var n=je.prototype.search.call(this,this.toBBox(t));return Lr(n)},e.collides=function(t){return je.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=je.prototype.all.call(this);return Lr(t)},e.toJSON=function(){return je.prototype.toJSON.call(this)},e.fromJSON=function(t){return je.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=dt(t);else if(t.type==="FeatureCollection")n=dt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}ks.exports=Kr;kt.default=Kr;function Zr(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Un(r)),e.type==="LineString"&&(e=Un(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Rr(r,e);return i&&n.push(i),ot(n)}var o=kt();return o.load(On(e)),Zt(On(r),function(s){Zt(o.search(s),function(u){var l=Rr(s,u);if(l){var a=Ye(l).join(",");t[a]||(t[a]=!0,n.push(l))}})}),ot(n)}function Rr(r,e){var t=Ye(r),n=Ye(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],u=t[1][1],l=n[0][0],a=n[0][1],f=n[1][0],m=n[1][1],p=(m-a)*(s-i)-(f-l)*(u-o),c=(f-l)*(o-a)-(m-a)*(i-l),g=(s-i)*(o-a)-(u-o)*(i-l);if(p===0)return c===0&&g===0,null;var d=c/p,_=g/p;if(d>=0&&d<=1&&_>=0&&_<=1){var E=i+d*(s-i),h=o+d*(u-o);return bt([E,h])}return null}function qt(r,e,t){t===void 0&&(t={});var n=bt([1/0,1/0],{dist:1/0}),i=0;return In(r,function(o){for(var s=Ye(o),u=0;u<s.length-1;u++){var l=bt(s[u]);l.properties.dist=nt(e,l,t);var a=bt(s[u+1]);a.properties.dist=nt(e,a,t);var f=nt(l,a,t),m=Math.max(l.properties.dist,a.properties.dist),p=Jr(l,a),c=xr(e,m,p+90,t),g=xr(e,m,p-90,t),d=Zr(wt([c.geometry.coordinates,g.geometry.coordinates]),wt([l.geometry.coordinates,a.geometry.coordinates])),_=null;d.features.length>0&&(_=d.features[0],_.properties.dist=nt(e,_,t),_.properties.location=i+nt(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=u,n.properties.location=i),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=u+1,n.properties.location=i+f),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=u),i+=f}}),n}const mt="edit-polygon-mode";class Rs{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"points");oe(this,"cursor");oe(this,"hover");oe(this,"dragFrom");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new qn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),ft(e,mt,{type:"geojson",data:He()}),Oe(e,{id:"edit-polygon-fill",source:mt,filter:cn,...un("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Oe(e,{id:"edit-polygon-lines",source:mt,filter:fn,...Dt("black",8,.5)}),Oe(e,{id:"edit-polygon-vertices",source:mt,filter:an,...St(me.hovering,pn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Tr(this.points).forEach((n,i)=>{t.push([i+1,qt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(mt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=He();this.points.forEach((n,i)=>{let o=Or(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Tr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(mt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Or(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Or(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Tr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let Z;const Ve=new Array(32).fill(void 0);Ve.push(void 0,null,!0,!1);function J(r){return Ve[r]}let $t=Ve.length;function Os(r){r<36||(Ve[r]=$t,$t=r)}function Cn(r){const e=J(r);return Os(r),e}const Qr=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Qr.decode();let Jt=new Uint8Array;function It(){return Jt.byteLength===0&&(Jt=new Uint8Array(Z.memory.buffer)),Jt}function vt(r,e){return Qr.decode(It().subarray(r,r+e))}function Se(r){$t===Ve.length&&Ve.push(Ve.length+1);const e=$t;return $t=Ve[e],Ve[e]=r,e}function _n(r){return r==null}let Wt=new Float64Array;function Ts(){return Wt.byteLength===0&&(Wt=new Float64Array(Z.memory.buffer)),Wt}let Vt=new Int32Array;function Ee(){return Vt.byteLength===0&&(Vt=new Int32Array(Z.memory.buffer)),Vt}let it=0;const Kt=new TextEncoder("utf-8"),Cs=typeof Kt.encodeInto=="function"?function(r,e){return Kt.encodeInto(r,e)}:function(r,e){const t=Kt.encode(r);return e.set(t),{read:r.length,written:t.length}};function Ht(r,e,t){if(t===void 0){const u=Kt.encode(r),l=e(u.length);return It().subarray(l,l+u.length).set(u),it=u.length,l}let n=r.length,i=e(n);const o=It();let s=0;for(;s<n;s++){const u=r.charCodeAt(s);if(u>127)break;o[i+s]=u}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const u=It().subarray(i+s,i+n),l=Cs(r,u);s+=l.written}return it=s,i}function An(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=An(r[0]));for(let s=1;s<i;s++)o+=", "+An(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function As(r,e){const t=e(r.length*1);return It().set(r,t/1),it=r.length,t}function gn(r,e){try{return r.apply(this,e)}catch(t){Z.__wbindgen_exn_store(Se(t))}}class rn{static __wrap(e){const t=Object.create(rn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Z.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=Z.__wbindgen_add_to_stack_pointer(-16),s=As(e,Z.__wbindgen_malloc),u=it;Z.jsroutesnapper_new(o,s,u);var t=Ee()[o/4+0],n=Ee()[o/4+1],i=Ee()[o/4+2];if(i)throw Cn(n);return rn.__wrap(t)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){Z.jsroutesnapper_setConfig(this.ptr,Se(e))}toFinalFeature(){try{const n=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_toFinalFeature(n,this.ptr);var e=Ee()[n/4+0],t=Ee()[n/4+1];let i;return e!==0&&(i=vt(e,t).slice(),Z.__wbindgen_free(e,t*1)),i}finally{Z.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_renderGeojson(n,this.ptr);var e=Ee()[n/4+0],t=Ee()[n/4+1];return vt(e,t)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(e,t)}}setSnapMode(e){Z.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return Z.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){Z.jsroutesnapper_onClick(this.ptr)}onDragStart(){return Z.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return Z.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){Z.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_editExisting(i,this.ptr,Se(e));var t=Ee()[i/4+0],n=Ee()[i/4+1];if(n)throw Cn(t)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}}async function Ps(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Fs(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Cn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(vt(e,t));return Se(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=vt(e,t);return Se(n)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;Ts()[e/8+1]=_n(i)?0:i,Ee()[e/4+0]=!_n(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=_n(i)?0:Ht(i,Z.__wbindgen_malloc,Z.__wbindgen_realloc),s=it;Ee()[e/4+1]=s,Ee()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(J(t)),i=Ht(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return Se(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=J(e)[J(t)];return Se(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(J(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(J(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(J(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(J(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(J(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=J(e)[t>>>0];return Se(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=J(e).next;return Se(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return gn(function(e){const t=J(e).next();return Se(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return J(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=J(e).value;return Se(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return Se(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return gn(function(e,t){const n=Reflect.get(J(e),J(t));return Se(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return gn(function(e,t){const n=J(e).call(J(t));return Se(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=J(e).buffer;return Se(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(J(e));return Se(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Se(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=Ht(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(vt(e,t))}finally{Z.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=An(J(t)),i=Ht(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(vt(e,t))},r.wbg.__wbindgen_memory=function(){const e=Z.memory;return Se(e)},r}function Ns(r,e){return Z=r.exports,ei.__wbindgen_wasm_module=e,Wt=new Float64Array,Vt=new Int32Array,Jt=new Uint8Array,Z}async function ei(r){typeof r>"u"&&(r="/atip/assets/route_snapper_bg.wasm");const e=Fs();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Ps(await r,e);return Ns(t,n)}const Tt="route-snapper",Cr=10,$s=30;class Is{constructor(e,t){oe(this,"map");oe(this,"inner");oe(this,"active");oe(this,"eventListenersSuccessRoute");oe(this,"eventListenersSuccessArea");oe(this,"eventListenersFailure");oe(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new rn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],ft(e,Tt,{type:"geojson",data:He()}),Oe(e,{id:"route-points",source:Tt,filter:an,...St(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Cr/2,Cr])}),Oe(e,{id:"route-lines",source:Tt,filter:fn,...Dt("black",2.5)}),Oe(e,{id:"route-polygons",source:Tt,filter:cn,...un("black",.5)}),this.events=new qn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-$s,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Tt).setData(JSON.parse(this.inner.renderGeojson()))}}function Ar(r){let e;function t(o,s){return o[1]?Ds:Bs}let n=t(r),i=n(r);return{c(){i.c(),e=Le()},m(o,s){i.m(o,s),b(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&w(e)}}}function Bs(r){let e;return{c(){e=S("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function Ds(r){let e;return{c(){e=S("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function Gs(r){let e,t=r[0]==yt&&Ar(r);return{c(){t&&t.c(),e=Le()},m(n,i){t&&t.m(n,i),b(n,e,i)},p(n,[i]){n[0]==yt?t?t.p(n,i):(t=Ar(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&w(e)}}}const yt="edit-attribute";function ti(){}function qs(r,e,t){let n,i,o,s;ce(r,Ue,c=>t(5,n=c)),ce(r,se,c=>t(6,i=c)),ce(r,wn,c=>t(7,o=c)),ce(r,Fe,c=>t(1,s=c));let{mode:u}=e,{changeMode:l}=e;function a(){Fe.set(null)}n.on("mousemove",f),n.on("mouseout",m),n.on("click",p),jt(()=>{n.off("mousemove",f),n.off("mouseout",m),n.off("click",p)});function f(c){var g;if(u==yt){let d=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ke.set(((g=d[0])==null?void 0:g.id)||null)}}function m(){u==yt&&Ke.set(null)}function p(c){if(u==yt){let g=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0?Fe.set(g[0].id):Fe.set(null)}}return r.$$set=c=>{"mode"in c&&t(0,u=c.mode),"changeMode"in c&&t(2,l=c.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let c=o;if(c){let g=i.features.find(d=>d.id==c);g.geometry.type=="Point"?n.flyTo({center:g.geometry.coordinates,duration:500}):n.fitBounds($n(g),{padding:200,duration:500}),l(yt)}}},[u,s,l,ti,a,n,i,o]}class js extends re{constructor(e){super(),ie(this,e,qs,Gs,ne,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ti}get stop(){return this.$$.ctx[4]}}function zs(r){let e,t;return{c:U,m(n,i){e||(t=j(window,"keydown",r[0]),e=!0)},p:U,i:U,o:U,d(n){e=!1,t()}}}function Ys(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class hn extends re{constructor(e){super(),ie(this,e,Ys,zs,ne,{tool:1})}}function Hs(r){let e;return{c(){e=S("p"),e.textContent="Click to add a new point"},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function Us(r){let e;return{c(){e=S("p"),e.textContent="Click to move the point here"},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function Xs(r){let e,t,n,i,o,s,u,l,a;function f(c,g){return c[1]?Us:Hs}let m=f(r),p=m(r);return s=new hn({props:{tool:r[0]}}),{c(){p.c(),e=L(),t=S("p"),t.innerHTML="Press <b>Escape</b> to cancel",n=L(),i=S("button"),i.textContent="Cancel",o=L(),W(s.$$.fragment),T(i,"type","button")},m(c,g){p.m(c,g),b(c,e,g),b(c,t,g),b(c,n,g),b(c,i,g),b(c,o,g),V(s,c,g),u=!0,l||(a=j(i,"click",r[2]),l=!0)},p(c,[g]){m!==(m=f(c))&&(p.d(1),p=m(c),p&&(p.c(),p.m(e.parentNode,e)));const d={};g&1&&(d.tool=c[0]),s.$set(d)},i(c){u||(A(s.$$.fragment,c),u=!0)},o(c){F(s.$$.fragment,c),u=!1},d(c){p.d(c),c&&w(e),c&&w(t),c&&w(n),c&&w(i),c&&w(o),K(s,c),l=!1,a()}}}function Js(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class ni extends re{constructor(e){super(),ie(this,e,Js,Xs,ne,{pointTool:0,editingExisting:1})}}function Ws(r){let e,t,n,i,o,s,u,l,a,f,m;return l=new hn({props:{tool:r[0]}}),{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=L(),n=S("div"),i=S("button"),i.textContent="Finish",o=L(),s=S("button"),s.textContent="Cancel",u=L(),W(l.$$.fragment),T(i,"type","button"),T(s,"type","button"),_e(n,"display","flex"),_e(n,"justify-content","space-between")},m(p,c){b(p,e,c),b(p,t,c),b(p,n,c),k(n,i),k(n,o),k(n,s),b(p,u,c),V(l,p,c),a=!0,f||(m=[j(i,"click",r[1]),j(s,"click",r[2])],f=!0)},p(p,[c]){const g={};c&1&&(g.tool=p[0]),l.$set(g)},i(p){a||(A(l.$$.fragment,p),a=!0)},o(p){F(l.$$.fragment,p),a=!1},d(p){p&&w(e),p&&w(t),p&&w(n),p&&w(u),K(l,p),f=!1,qe(m)}}}function Vs(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class ri extends re{constructor(e){super(),ie(this,e,Vs,Ws,ne,{polygonTool:0})}}function Ks(r){let e,t,n,i,o,s,u,l,a,f,m;return l=new hn({props:{tool:r[0]}}),{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish area</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=L(),n=S("div"),i=S("button"),i.textContent="Finish",o=L(),s=S("button"),s.textContent="Cancel",u=L(),W(l.$$.fragment),T(i,"type","button"),T(s,"type","button"),_e(n,"display","flex"),_e(n,"justify-content","space-between")},m(p,c){b(p,e,c),b(p,t,c),b(p,n,c),k(n,i),k(n,o),k(n,s),b(p,u,c),V(l,p,c),a=!0,f||(m=[j(i,"click",r[1]),j(s,"click",r[2])],f=!0)},p(p,[c]){const g={};c&1&&(g.tool=p[0]),l.$set(g)},i(p){a||(A(l.$$.fragment,p),a=!0)},o(p){F(l.$$.fragment,p),a=!1},d(p){p&&w(e),p&&w(t),p&&w(n),p&&w(u),K(l,p),f=!1,qe(m)}}}function Zs(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class ii extends re{constructor(e){super(),ie(this,e,Zs,Ks,ne,{routeTool:0})}}function Qs(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,g,d;return p=new hn({props:{tool:r[0]}}),{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=L(),n=S("label"),i=S("input"),o=Y(`
  Avoid doubling back`),s=L(),u=S("div"),l=S("button"),l.textContent="Finish",a=L(),f=S("button"),f.textContent="Cancel",m=L(),W(p.$$.fragment),T(i,"type","checkbox"),T(l,"type","button"),T(f,"type","button"),_e(u,"display","flex"),_e(u,"justify-content","space-between")},m(_,E){b(_,e,E),b(_,t,E),b(_,n,E),k(n,i),i.checked=r[1],k(n,o),b(_,s,E),b(_,u,E),k(u,l),k(u,a),k(u,f),b(_,m,E),V(p,_,E),c=!0,g||(d=[j(i,"change",r[2]),j(l,"click",r[3]),j(f,"click",r[4])],g=!0)},p(_,[E]){E&2&&(i.checked=_[1]);const h={};E&1&&(h.tool=_[0]),p.$set(h)},i(_){c||(A(p.$$.fragment,_),c=!0)},o(_){F(p.$$.fragment,_),c=!1},d(_){_&&w(e),_&&w(t),_&&w(n),_&&w(s),_&&w(u),_&&w(m),K(p,_),g=!1,qe(d)}}}function el(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),u=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,u]}class oi extends re{constructor(e){super(),ie(this,e,el,Qs,ne,{routeTool:0})}}function Pr(r){let e,t,n,i;const o=[ol,il,rl,nl,tl],s=[];function u(l,a){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=Le()},m(l,a){s[e].m(l,a),b(l,n,a),i=!0},p(l,a){let f=e;e=u(l),e===f?s[e].p(l,a):(Te(),F(s[f],1,1,()=>{s[f]=null}),Ce(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),A(t,1),t.m(n.parentNode,n))},i(l){i||(A(t),i=!0)},o(l){F(t),i=!1},d(l){s[e].d(l),l&&w(n)}}}function tl(r){let e;return{c(){e=S("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){b(t,e,n)},p:U,i:U,o:U,d(t){t&&w(e)}}}function nl(r){let e,t;return e=new oi({props:{routeTool:r[3]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function rl(r){let e,t;return e=new ii({props:{routeTool:r[3]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function il(r){let e,t;return e=new ri({props:{polygonTool:r[2]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function ol(r){let e,t;return e=new ni({props:{pointTool:r[1],editingExisting:!0}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function sl(r){let e,t,n=r[0]==We&&Pr(r);return{c(){n&&n.c(),e=Le()},m(i,o){n&&n.m(i,o),b(i,e,o),t=!0},p(i,[o]){i[0]==We?n?(n.p(i,o),o&1&&A(n,1)):(n=Pr(i),n.c(),A(n,1),n.m(e.parentNode,e)):n&&(Te(),F(n,1,1,()=>{n=null}),Ce())},i(i){t||(A(n),t=!0)},o(i){F(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const We="edit-geometry";function si(){}function ll(r,e,t){let n;ce(r,Ue,d=>t(8,n=d));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:u}=e,l=null,a=null;function f(){l&&(o.stop(),s.stop(),u.stop(),se.update(d=>{let _=d.features.find(E=>E.id==l);return delete _.properties.hide_while_editing,d})),l=null,t(4,a=null),Ke.set(null)}n.on("mousemove",m),n.on("mouseout",p),n.on("click",c),jt(()=>{n.off("mousemove",m),n.off("mouseout",p),n.off("click",c)}),u.addEventListenerSuccessRoute(d=>{i==We&&(se.update(_=>{let E=_.features.find(h=>h.id==l);return E.properties.length_meters=d.properties.length_meters,E.properties.waypoints=d.properties.waypoints,delete E.properties.hide_while_editing,E.geometry=d.geometry,_}),l=null,t(4,a=null))}),u.addEventListenerSuccessArea(d=>{i==We&&(se.update(_=>{let E=_.features.find(h=>h.id==l);return E.properties.waypoints=d.properties.waypoints,delete E.properties.hide_while_editing,E.geometry=d.geometry,_}),l=null,t(4,a=null))});for(let d of[o,s])d.addEventListenerSuccess(_=>{i==We&&(se.update(E=>{let h=E.features.find(v=>v.id==l);return h.geometry=_.geometry,delete h.properties.hide_while_editing,E}),l=null,t(4,a=null))});for(let d of[o,s,u])d.addEventListenerFailure(()=>{i==We&&(se.update(_=>{let E=_.features.find(h=>h.id==l);return delete E.properties.hide_while_editing,_}),l=null,t(4,a=null))});function m(d){var _;if(i==We&&l==null){let E=n.queryRenderedFeatures(d.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ke.set(((_=E[0])==null?void 0:_.id)||null)}}function p(){i==We&&l==null&&Ke.set(null)}function c(d){if(i==We&&l==null){let _=n.queryRenderedFeatures(d.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&g(_[0].id)}}function g(d){Ke.set(null);let _=null;se.update(h=>(_=h.features.find(v=>v.id==d),_.properties.hide_while_editing=!0,h));let E=_;l=d,E.geometry.type=="LineString"?(u.editExistingRoute(E),t(4,a="route")):E.geometry.type=="Polygon"?E.properties.waypoints?(u.editExistingArea(E),t(4,a="snap-polygon")):(s.editExisting(E),t(4,a="free-polygon")):E.geometry.type=="Point"&&(o.start(),t(4,a="point"))}return r.$$set=d=>{"mode"in d&&t(0,i=d.mode),"pointTool"in d&&t(1,o=d.pointTool),"polygonTool"in d&&t(2,s=d.polygonTool),"routeTool"in d&&t(3,u=d.routeTool)},[i,o,s,u,a,si,f]}class ul extends re{constructor(e){super(),ie(this,e,ll,sl,ne,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return si}get stop(){return this.$$.ctx[6]}}async function al(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:a,value:f}=await n.read();if(a)break;s.push(f),o+=f.length;const m=100*o/i;e.style=`background: linear-gradient(to right, red ${m}%, transparent 0);`}let u=new Uint8Array(o),l=0;for(let a of s)u.set(a,l),l+=a.length;return u}function fl(r){let e,t;return e=new oi({props:{routeTool:r[0]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function cl(r){let e;return{c(){e=S("div"),e.textContent="Route tool loading..."},m(t,n){b(t,e,n),r[7](e)},p:U,i:U,o:U,d(t){t&&w(e),r[7](null)}}}function pl(r){let e,t,n,i;const o=[cl,fl],s=[];function u(l,a){return l[0]?l[1]==Pn?1:-1:0}return~(e=u(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=Le()},m(l,a){~e&&s[e].m(l,a),b(l,n,a),i=!0},p(l,[a]){let f=e;e=u(l),e===f?~e&&s[e].p(l,a):(t&&(Te(),F(s[f],1,1,()=>{s[f]=null}),Ce()),~e?(t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),A(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(A(t),i=!0)},o(l){F(t),i=!1},d(l){~e&&s[e].d(l),l&&w(n)}}}const Pn="route";function hl(r,e,t){let n;ce(r,Ue,p=>t(8,n=p));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,u,{routeTool:l}=e;function a(){l.isActive()||l.startRoute()}function f(){l==null||l.stop()}Nn(async()=>{await ei(),console.log(`Grabbing ${s}`);try{const p=await al(s,u);t(0,l=new Is(n,p))}catch(p){console.log(`Route tool broke: ${p}`),t(2,u.innerHTML="Failed to load",u);return}l.addEventListenerFailure(()=>{i==Pn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(p=>{i==Pn&&(se.update(c=>(p.id=zt(c),p.properties.intervention_type="route",c.features.push(p),c)),o("edit-attribute"),Fe.set(p.id))})});function m(p){be[p?"unshift":"push"](()=>{u=p,t(2,u)})}return r.$$set=p=>{"mode"in p&&t(1,i=p.mode),"changeMode"in p&&t(3,o=p.changeMode),"url"in p&&t(4,s=p.url),"routeTool"in p&&t(0,l=p.routeTool)},[l,i,u,o,s,a,f,m]}class dl extends re{constructor(e){super(),ie(this,e,hl,pl,ne,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Fr(r){let e,t;return e=new ni({props:{pointTool:r[1],editingExisting:!1}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function ml(r){let e,t,n=r[0]==on&&Fr(r);return{c(){n&&n.c(),e=Le()},m(i,o){n&&n.m(i,o),b(i,e,o),t=!0},p(i,[o]){i[0]==on?n?(n.p(i,o),o&1&&A(n,1)):(n=Fr(i),n.c(),A(n,1),n.m(e.parentNode,e)):n&&(Te(),F(n,1,1,()=>{n=null}),Ce())},i(i){t||(A(n),t=!0)},o(i){F(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const on="point";function _l(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==on&&(se.update(a=>(l.id=zt(a),l.properties.intervention_type="other",a.features.push(l),a)),i("edit-attribute"),Fe.set(l.id))}),o.addEventListenerFailure(()=>{n==on&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,u]}class gl extends re{constructor(e){super(),ie(this,e,_l,ml,ne,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Nr(r){let e,t;return e=new ri({props:{polygonTool:r[1]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function vl(r){let e,t,n=r[0]==sn&&Nr(r);return{c(){n&&n.c(),e=Le()},m(i,o){n&&n.m(i,o),b(i,e,o),t=!0},p(i,[o]){i[0]==sn?n?(n.p(i,o),o&1&&A(n,1)):(n=Nr(i),n.c(),A(n,1),n.m(e.parentNode,e)):n&&(Te(),F(n,1,1,()=>{n=null}),Ce())},i(i){t||(A(n),t=!0)},o(i){F(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const sn="free-polygon";function yl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==sn&&(se.update(a=>(l.id=zt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),Fe.set(l.id))}),o.addEventListenerFailure(()=>{n==sn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,u]}class bl extends re{constructor(e){super(),ie(this,e,yl,vl,ne,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function $r(r){let e,t;return e=new ii({props:{routeTool:r[1]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function wl(r){let e,t,n=r[0]==ln&&$r(r);return{c(){n&&n.c(),e=Le()},m(i,o){n&&n.m(i,o),b(i,e,o),t=!0},p(i,[o]){i[0]==ln?n?(n.p(i,o),o&1&&A(n,1)):(n=$r(i),n.c(),A(n,1),n.m(e.parentNode,e)):n&&(Te(),F(n,1,1,()=>{n=null}),Ce())},i(i){t||(A(n),t=!0)},o(i){F(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const ln="snap-polygon";function kl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function u(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==ln&&(se.update(a=>(l.id=zt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),Fe.set(l.id))}),o.addEventListenerFailure(()=>{n==ln&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,u]}class Sl extends re{constructor(e){super(),ie(this,e,kl,wl,ne,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function El(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=nt(r.slice(0,2),[n,t]),s=nt(r.slice(0,2),[e,i]);if(o>=s){var u=(t+i)/2;return[e,u-(n-e)/2,n,u+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Ml(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return xi(r,function(s){xl(s,o,n)}),r}function xl(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Ll(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Rn(r),n=Rn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Ml(e,{precision:7});switch(n){case"Point":return Fn(r,i);case"MultiPoint":return Ir(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Ir(r,Zr(r,i))}}function Ir(r,e){var t=[],n=kt();return In(e,function(i){if(t.forEach(function(u,l){u.id=l}),!t.length)t=Fn(r,i).features,t.forEach(function(u){u.bbox||(u.bbox=El(Li(u)))}),n.load(ot(t));else{var o=n.search(i);if(o.features.length){var s=li(i,o);t=t.filter(function(u){return u.id!==s.id}),n.remove(s),Zt(Fn(s,i),function(u){t.push(u),n.insert(u)})}}}),ot(t)}function Fn(r,e){var t=[],n=Ye(r)[0],i=Ye(r)[r.geometry.coordinates.length-1];if(vn(n,st(e))||vn(i,st(e)))return ot([r]);var o=kt(),s=On(r);o.load(s);var u=o.search(e);if(!u.features.length)return ot([r]);var l=li(e,u),a=[n],f=Ri(s,function(m,p,c){var g=Ye(p)[1],d=st(e);return c===l.id?(m.push(d),t.push(wt(m)),vn(d,g)?[d]:[d,g]):(m.push(g),m)},a);return f.length>1&&t.push(wt(f)),ot(t)}function li(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return Zt(e,function(i){var o=qt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function vn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Rl(r,e,t){var n=Ye(t);if(Rn(t)!=="LineString")throw new Error("line must be a LineString");var i=qt(t,r),o=qt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var u=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)u.push(n[l]);return u.push(s[1].geometry.coordinates),wt(u,t.properties)}function Br(r){let e;return{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function Ol(r){let e,t,n,i=r[0]==Bt&&Br();return{c(){i&&i.c(),e=Le()},m(o,s){i&&i.m(o,s),b(o,e,s),t||(n=j(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Bt?i||(i=Br(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:U,o:U,d(o){i&&i.d(o),o&&w(e),t=!1,n()}}}const Bt="split-route",Tl=10,Cl=30;let yn="split-route";function ui(){}function Dr(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Al(r,e,t){let n,i;ce(r,se,d=>t(8,n=d)),ce(r,Ue,d=>t(6,i=d));let{mode:o}=e,{changeMode:s}=e;function u(){t(5,l=null),a=null}let l=null,a=null;i.on("mousemove",f),i.on("click",m),jt(()=>{i.off("mousemove",f),i.off("click",m)}),ft(i,yn,{type:"geojson",data:He()}),Oe(i,{id:"draw-split-route",source:yn,...St("black",Tl,["case",["==",["get","snapped"],!0],1,.5])});function f(d){if(o!=Bt)return;t(5,l=Dr(d.lngLat.toArray(),!1)),a=null;const _=[d.point.x-Cl,d.point.y],E=i.unproject(d.point).distanceTo(i.unproject(_))/1e3;let h=[];for(let[v,y]of n.features.entries())if(y.geometry.type=="LineString"){let x=qt(y.geometry,l,{units:"kilometers"});x.properties.dist!=null&&x.properties.dist<=E&&h.push([v,x.geometry.coordinates,x.properties.dist])}h.sort((v,y)=>v[2]-y[2]),h.length>0&&(t(5,l=Dr(h[0][1],!0)),a=h[0][0])}function m(){if(o==Bt)if(a==null)s("edit-attribute");else{let d=Ll(n.features[a],l);if(d.features.length==2){let _=d.features[0],E=d.features[1];se.update(h=>(_.id=h.features[a].id,E.id=zt(h),_.properties=JSON.parse(JSON.stringify(h.features[a].properties)),E.properties=JSON.parse(JSON.stringify(_.properties)),p(h.features[a],_,E,l),h.features.splice(a,1,_,E),h))}u()}}function p(d,_,E,h){_.properties.length_meters=Xt(_,{units:"kilometers"})*1e3,E.properties.length_meters=Xt(E,{units:"kilometers"})*1e3,_.properties.waypoints=[],E.properties.waypoints=[];let v=c(d,h),y=!0,x=0;for(let O of d.properties.waypoints){let C=c(d,bt([O.lon,O.lat]));if(y)if(C<v)_.properties.waypoints.push(O);else{let R=O.snapped&&d.properties.waypoints[x-1].snapped;_.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:R}),y=!1,E.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:R}),E.properties.waypoints.push(O)}else E.properties.waypoints.push(O);x++}}function c(d,_){let E=d.geometry.coordinates[0],h=Rl(E,_,d);return Xt(h,{units:"kilometers"})*1e3}function g(d){o==Bt&&d.key=="Escape"&&(s("edit-attribute"),d.preventDefault())}return r.$$set=d=>{"mode"in d&&t(0,o=d.mode),"changeMode"in d&&t(2,s=d.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let d=He();l&&d.features.push(l),i.getSource(yn).setData(d)}},[o,g,s,ui,u,l,i]}class Pl extends re{constructor(e){super(),ie(this,e,Al,Ol,ne,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ui}get stop(){return this.$$.ctx[4]}}function Gr(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new ul({props:n}),r[17](e),{c(){W(e.$$.fragment)},m(i,o){V(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){F(e.$$.fragment,i),t=!1},d(i){r[17](null),K(e,i)}}}function qr(r){let e,t,n,i,o;return{c(){e=S("button"),t=Y("New point"),T(e,"type","button"),e.disabled=n=r[3]=="point",T(e,"class","svelte-cej5os")},m(s,u){b(s,e,u),k(e,t),i||(o=j(e,"click",r[18]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function jr(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Sl({props:n}),r[23](e),{c(){W(e.$$.fragment)},m(i,o){V(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){F(e.$$.fragment,i),t=!1},d(i){r[23](null),K(e,i)}}}function zr(r){let e,t,n,i,o;return{c(){e=S("button"),t=Y("New route"),T(e,"type","button"),e.disabled=n=r[3]=="route",T(e,"class","svelte-cej5os")},m(s,u){b(s,e,u),k(e,t),i||(o=j(e,"click",r[24]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function Yr(r){let e,t,n,i,o;return{c(){e=S("button"),t=Y("Split route"),T(e,"type","button"),e.disabled=n=r[3]=="split-route",T(e,"class","svelte-cej5os")},m(s,u){b(s,e,u),k(e,t),i||(o=j(e,"click",r[27]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function Fl(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,g,d,_,E,h,v,y,x,O,C,R,I,D,B,X,P,z,te,pe,G,le,we,Ae,he,ae,Me,ue,N,Q,Mt={mode:r[3],changeMode:r[13]};u=new js({props:Mt}),r[15](u);let de=r[2]&&Gr(r),ke=r[1]!="planning"&&qr(r),xt={mode:r[3],changeMode:r[13],pointTool:r[11]};E=new gl({props:xt}),r[19](E);let ut={mode:r[3],changeMode:r[13],polygonTool:r[12]};R=new bl({props:ut}),r[21](R);let ge=r[2]&&jr(r),fe=r[1]!="planning"&&zr(r);function Lt(q){r[26](q)}let Rt={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(Rt.routeTool=r[2]),le=new dl({props:Rt}),r[25](le),be.push(()=>Ze(le,"routeTool",Lt,r[2]));let ve=r[1]!="planning"&&Yr(r),Re={mode:r[3],changeMode:r[13]};return Me=new Pl({props:Re}),r[28](Me),{c(){e=S("div"),t=S("div"),n=S("button"),i=Y("Edit attributes"),s=L(),W(u.$$.fragment),l=L(),a=S("div"),f=S("button"),m=Y("Edit geometry"),c=L(),de&&de.c(),g=L(),d=S("div"),ke&&ke.c(),_=L(),W(E.$$.fragment),h=L(),v=S("div"),y=S("button"),x=Y("New polygon (freehand)"),C=L(),W(R.$$.fragment),I=L(),D=S("div"),B=S("button"),X=Y("New polygon (snapped)"),z=L(),ge&&ge.c(),te=L(),pe=S("div"),fe&&fe.c(),G=L(),W(le.$$.fragment),Ae=L(),he=S("div"),ve&&ve.c(),ae=L(),W(Me.$$.fragment),T(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",T(n,"class","svelte-cej5os"),T(f,"type","button"),f.disabled=p=r[3]=="edit-geometry",T(f,"class","svelte-cej5os"),T(y,"type","button"),y.disabled=O=r[3]=="free-polygon",T(y,"class","svelte-cej5os"),T(B,"type","button"),B.disabled=P=r[3]=="snap-polygon",T(B,"class","svelte-cej5os"),T(e,"class","toolbox svelte-cej5os")},m(q,ee){b(q,e,ee),k(e,t),k(t,n),k(n,i),k(t,s),V(u,t,null),k(e,l),k(e,a),k(a,f),k(f,m),k(a,c),de&&de.m(a,null),k(e,g),k(e,d),ke&&ke.m(d,null),k(d,_),V(E,d,null),k(e,h),k(e,v),k(v,y),k(y,x),k(v,C),V(R,v,null),k(e,I),k(e,D),k(D,B),k(B,X),k(D,z),ge&&ge.m(D,null),k(e,te),k(e,pe),fe&&fe.m(pe,null),k(pe,G),V(le,pe,null),k(e,Ae),k(e,he),ve&&ve.m(he,null),k(he,ae),V(Me,he,null),ue=!0,N||(Q=[j(n,"click",r[14]),j(f,"click",r[16]),j(y,"click",r[20]),j(B,"click",r[22])],N=!0)},p(q,[ee]){(!ue||ee&8&&o!==(o=q[3]=="edit-attribute"))&&(n.disabled=o);const Xe={};ee&8&&(Xe.mode=q[3]),u.$set(Xe),(!ue||ee&8&&p!==(p=q[3]=="edit-geometry"))&&(f.disabled=p),q[2]?de?(de.p(q,ee),ee&4&&A(de,1)):(de=Gr(q),de.c(),A(de,1),de.m(a,null)):de&&(Te(),F(de,1,1,()=>{de=null}),Ce()),q[1]!="planning"?ke?ke.p(q,ee):(ke=qr(q),ke.c(),ke.m(d,_)):ke&&(ke.d(1),ke=null);const xe={};ee&8&&(xe.mode=q[3]),E.$set(xe),(!ue||ee&8&&O!==(O=q[3]=="free-polygon"))&&(y.disabled=O);const Je={};ee&8&&(Je.mode=q[3]),R.$set(Je),(!ue||ee&8&&P!==(P=q[3]=="snap-polygon"))&&(B.disabled=P),q[2]?ge?(ge.p(q,ee),ee&4&&A(ge,1)):(ge=jr(q),ge.c(),A(ge,1),ge.m(D,null)):ge&&(Te(),F(ge,1,1,()=>{ge=null}),Ce()),q[1]!="planning"?fe?fe.p(q,ee):(fe=zr(q),fe.c(),fe.m(pe,G)):fe&&(fe.d(1),fe=null);const ye={};ee&8&&(ye.mode=q[3]),ee&1&&(ye.url=q[0]),!we&&ee&4&&(we=!0,ye.routeTool=q[2],Qe(()=>we=!1)),le.$set(ye),q[1]!="planning"?ve?ve.p(q,ee):(ve=Yr(q),ve.c(),ve.m(he,ae)):ve&&(ve.d(1),ve=null);const M={};ee&8&&(M.mode=q[3]),Me.$set(M)},i(q){ue||(A(u.$$.fragment,q),A(de),A(E.$$.fragment,q),A(R.$$.fragment,q),A(ge),A(le.$$.fragment,q),A(Me.$$.fragment,q),ue=!0)},o(q){F(u.$$.fragment,q),F(de),F(E.$$.fragment,q),F(R.$$.fragment,q),F(ge),F(le.$$.fragment,q),F(Me.$$.fragment,q),ue=!1},d(q){q&&w(e),r[15](null),K(u),de&&de.d(),ke&&ke.d(),r[19](null),K(E),r[21](null),K(R),ge&&ge.d(),fe&&fe.d(),r[25](null),K(le),ve&&ve.d(),r[28](null),K(Me),N=!1,qe(Q)}}}function Nl(r,e,t){let n;ce(r,Ue,G=>t(29,n=G));let{routeUrl:i}=e,{schema:o}=e,s,u=new _s(n),l=new Rs(n),a="edit-attribute",f,m,p,c,g,d,_;function E(G){let le={"edit-attribute":f,"edit-geometry":m,route:p,point:c,"free-polygon":g,"snap-polygon":d,"split-route":_};if(a==G){console.log(`Mode is already ${a}, not changing`);return}console.log(`Stopping old mode ${a}`),le[a].stop(),t(3,a=G),console.log(`Starting new mode ${a}`),le[a].start()}jt(()=>{u==null||u.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const h=()=>E("edit-attribute");function v(G){be[G?"unshift":"push"](()=>{f=G,t(4,f)})}const y=()=>E("edit-geometry");function x(G){be[G?"unshift":"push"](()=>{m=G,t(5,m)})}const O=()=>E("point");function C(G){be[G?"unshift":"push"](()=>{c=G,t(7,c)})}const R=()=>E("free-polygon");function I(G){be[G?"unshift":"push"](()=>{g=G,t(8,g)})}const D=()=>E("snap-polygon");function B(G){be[G?"unshift":"push"](()=>{d=G,t(9,d)})}const X=()=>E("route");function P(G){be[G?"unshift":"push"](()=>{p=G,t(6,p)})}function z(G){s=G,t(2,s)}const te=()=>E("split-route");function pe(G){be[G?"unshift":"push"](()=>{_=G,t(10,_)})}return r.$$set=G=>{"routeUrl"in G&&t(0,i=G.routeUrl),"schema"in G&&t(1,o=G.schema)},[i,o,s,a,f,m,p,c,g,d,_,u,l,E,h,v,y,x,O,C,R,I,D,B,X,P,z,te,pe]}class $l extends re{constructor(e){super(),ie(this,e,Nl,Fl,ne,{routeUrl:0,schema:1})}}function Il(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,g,d,_,E,h;return{c(){e=S("div"),t=S("div"),n=S("button"),n.textContent="Home",i=L(),o=S("button"),o.textContent="About",s=L(),u=S("button"),u.textContent="Instructions",l=L(),a=S("br"),f=L(),m=S("label"),p=Y(`ATIP schema:
      `),c=S("select"),g=S("option"),g.textContent="Design (v1)",d=S("option"),d.textContent="Design (v2)",_=S("option"),_.textContent="Planning",T(n,"type","button"),T(o,"type","button"),T(u,"type","button"),g.__value="v1",g.value=g.__value,d.__value="v2",d.value=d.__value,_.__value="planning",_.value=_.__value,r[2]===void 0&&at(()=>r[11].call(c)),T(e,"slot","nav")},m(v,y){b(v,e,y),k(e,t),k(t,n),k(t,i),k(t,o),k(t,s),k(t,u),k(e,l),k(e,a),k(e,f),k(e,m),k(m,p),k(m,c),k(c,g),k(c,d),k(c,_),Ne(c,r[2]),E||(h=[j(n,"click",r[10]),j(o,"click",r[7]),j(u,"click",r[8]),j(c,"change",r[11]),j(c,"change",r[9])],E=!0)},p(v,y){y&4&&Ne(c,v[2])},d(v){v&&w(e),E=!1,qe(h)}}}function Bl(r){let e,t,n,i,o,s,u,l,a,f,m,p;return o=new rs({props:{boundaryGeojson:r[4]}}),u=new Qo({props:{authorityName:r[5],schema:r[2]}}),m=new Jo({props:{schema:r[2]}}),{c(){e=S("div"),t=S("h1"),n=Y(r[5]),i=L(),W(o.$$.fragment),s=L(),W(u.$$.fragment),l=L(),a=S("br"),f=L(),W(m.$$.fragment),T(e,"slot","sidebar")},m(c,g){b(c,e,g),k(e,t),k(t,n),k(t,i),V(o,t,null),k(e,s),V(u,e,null),k(e,l),k(e,a),k(e,f),V(m,e,null),p=!0},p(c,g){const d={};g&16&&(d.boundaryGeojson=c[4]),o.$set(d);const _={};g&4&&(_.schema=c[2]),u.$set(_);const E={};g&4&&(E.schema=c[2]),m.$set(E)},i(c){p||(A(o.$$.fragment,c),A(u.$$.fragment,c),A(m.$$.fragment,c),p=!0)},o(c){F(o.$$.fragment,c),F(u.$$.fragment,c),F(m.$$.fragment,c),p=!1},d(c){c&&w(e),K(o),K(u),K(m)}}}function Dl(r){let e,t,n,i,o,s,u,l,a,f,m,p;return e=new go({props:{boundaryGeojson:r[4]}}),n=new hs({props:{schema:r[2]}}),o=new ms({}),u=new $l({props:{routeUrl:r[3],schema:r[2]}}),a=new ss({props:{style:r[6]}}),m=new cs({props:{schema:r[2]}}),{c(){W(e.$$.fragment),t=L(),W(n.$$.fragment),i=L(),W(o.$$.fragment),s=L(),W(u.$$.fragment),l=L(),W(a.$$.fragment),f=L(),W(m.$$.fragment)},m(c,g){V(e,c,g),b(c,t,g),V(n,c,g),b(c,i,g),V(o,c,g),b(c,s,g),V(u,c,g),b(c,l,g),V(a,c,g),b(c,f,g),V(m,c,g),p=!0},p(c,g){const d={};g&16&&(d.boundaryGeojson=c[4]),e.$set(d);const _={};g&4&&(_.schema=c[2]),n.$set(_);const E={};g&8&&(E.routeUrl=c[3]),g&4&&(E.schema=c[2]),u.$set(E);const h={};g&4&&(h.schema=c[2]),m.$set(h)},i(c){p||(A(e.$$.fragment,c),A(n.$$.fragment,c),A(o.$$.fragment,c),A(u.$$.fragment,c),A(a.$$.fragment,c),A(m.$$.fragment,c),p=!0)},o(c){F(e.$$.fragment,c),F(n.$$.fragment,c),F(o.$$.fragment,c),F(u.$$.fragment,c),F(a.$$.fragment,c),F(m.$$.fragment,c),p=!1},d(c){K(e,c),c&&w(t),K(n,c),c&&w(i),K(o,c),c&&w(s),K(u,c),c&&w(l),K(a,c),c&&w(f),K(m,c)}}}function Gl(r){let e,t,n;return t=new Ii({props:{style:r[6],$$slots:{default:[Dl]},$$scope:{ctx:r}}}),{c(){e=S("div"),W(t.$$.fragment),T(e,"slot","main")},m(i,o){b(i,e,o),V(t,e,null),n=!0},p(i,o){const s={};o&131100&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(A(t.$$.fragment,i),n=!0)},o(i){F(t.$$.fragment,i),n=!1},d(i){i&&w(e),K(t)}}}function ql(r){let e,t,n,i,o,s,u,l;e=new zi({props:{$$slots:{main:[Gl],sidebar:[Bl],nav:[Il]},$$scope:{ctx:r}}});function a(c){r[12](c)}let f={};r[0]!==void 0&&(f.open=r[0]),n=new Oi({props:f}),be.push(()=>Ze(n,"open",a,r[0]));function m(c){r[13](c)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new Fi({props:p}),be.push(()=>Ze(s,"open",m,r[1])),{c(){W(e.$$.fragment),t=L(),W(n.$$.fragment),o=L(),W(s.$$.fragment)},m(c,g){V(e,c,g),b(c,t,g),V(n,c,g),b(c,o,g),V(s,c,g),l=!0},p(c,[g]){const d={};g&131100&&(d.$$scope={dirty:g,ctx:c}),e.$set(d);const _={};!i&&g&1&&(i=!0,_.open=c[0],Qe(()=>i=!1)),n.$set(_);const E={};!u&&g&2&&(u=!0,E.open=c[1],Qe(()=>u=!1)),s.$set(E)},i(c){l||(A(e.$$.fragment,c),A(n.$$.fragment,c),A(s.$$.fragment,c),l=!0)},o(c){F(e.$$.fragment,c),F(n.$$.fragment,c),F(s.$$.fragment,c),l=!1},d(c){K(e,c),c&&w(t),K(n,c),c&&w(o),K(s,c)}}}function jl(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let u=s.get("authority"),l=s.get("style")||"streets",a=s.get("schema")||"v1";var f=`https://atip.uk/route-snappers/${u}.bin`;o||(f=`https://atip.uk/route-snappers-dev/${u}.bin`);function m(){t(0,n=!n),t(1,i=!1)}function p(){t(1,i=!i),t(0,n=!1)}let c;Nn(async()=>{t(4,c=await g())});async function g(){const x=await(await fetch(Ti)).text(),O=JSON.parse(x);return O.features=O.features.filter(C=>{var R;return((R=C.properties)==null?void 0:R.name)==u}),O}function d(){let y=new URLSearchParams(window.location.search);y.set("schema",a);let x=`${window.location.pathname}?${y.toString()}${window.location.hash}`;window.location.href=x}const _=()=>window.open("index.html");function E(){a=gt(this),t(2,a)}function h(y){n=y,t(0,n)}function v(y){i=y,t(1,i)}return[n,i,a,f,c,u,l,m,p,d,_,E,h,v]}class zl extends re{constructor(e){super(),ie(this,e,jl,ql,ne,{})}}new zl({target:document.getElementById("app")});
