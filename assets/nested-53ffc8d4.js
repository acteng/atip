var Ur=(f,u,h)=>{if(!u.has(f))throw TypeError("Cannot "+h)};var _e=(f,u,h)=>{if(u.has(f))throw TypeError("Cannot add the same private member more than once");u instanceof WeakSet?u.add(f):u.set(f,h)};var H=(f,u,h)=>(Ur(f,u,"access private method"),h);import{c as gt,m as Pn,g as Mo,a as Gr}from"./authorities-f5046e46.js";var Tn={},Jr={get exports(){return Tn},set exports(f){Tn=f}};(function(f,u){(function(h,v){f.exports=v()})(gt,function(){var h=function(e,t){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},o={on:function(r,a,g){if(n[r]===void 0)throw new Error("Invalid event type: "+r);n[r].push({selector:a,fn:g})},render:function(r){t.store.featureChanged(r)}},s=function(r,a){for(var g=n[r],p=g.length;p--;){var b=g[p];if(b.selector(a)){b.fn.call(o,a)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(o),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),t.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(r){s("drag",r)},click:function(r){s("click",r)},mousemove:function(r){s("mousemove",r)},mousedown:function(r){s("mousedown",r)},mouseup:function(r){s("mouseup",r)},mouseout:function(r){s("mouseout",r)},keydown:function(r){s("keydown",r)},keyup:function(r){s("keyup",r)},touchstart:function(r){s("touchstart",r)},touchmove:function(r){s("touchmove",r)},touchend:function(r){s("touchend",r)},tap:function(r){s("tap",r)}}},v=6378137;function E(e){var t=0;if(e&&e.length>0){t+=Math.abs(L(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(L(e[n]))}return t}function L(e){var t,n,o,s,r,a,g=0,p=e.length;if(p>2){for(a=0;a<p;a++)a===p-2?(o=p-2,s=p-1,r=0):a===p-1?(o=p-1,s=0,r=1):(o=a,s=a+1,r=a+2),t=e[o],n=e[s],g+=(M(e[r][0])-M(t[0]))*Math.sin(M(n[1]));g=g*v*v/2}return g}function M(e){return e*Math.PI/180}var O={geometry:function e(t){var n,o=0;switch(t.type){case"Polygon":return E(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)o+=E(t.coordinates[n]);return o;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<t.geometries.length;n++)o+=e(t.geometries[n]);return o}},ring:L},Y="mapboxgl-ctrl",re="mapbox-gl-draw_ctrl-draw-btn",xe="mapbox-gl-draw_line",se="mapbox-gl-draw_polygon",Ne="mapbox-gl-draw_point",Ao="mapbox-gl-draw_trash",Do="mapbox-gl-draw_combine",No="mapbox-gl-draw_uncombine",$o="mapboxgl-ctrl-group",Rn="active",Bo="mapbox-gl-draw_boxselect",Ye="mapbox-gl-draw-hot",it="mapbox-gl-draw-cold",$e="add",Be="move",Ro="drag",Et="pointer",on="none",ne={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Z="Feature",Ce="Polygon",Ze="LineString",oe="Point",Ee="FeatureCollection",Un="Multi",Uo="MultiPoint",Go="MultiLineString",Jo="MultiPolygon",k={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},rn="draw.create",Vo="draw.delete",Gn="draw.update",zo="draw.selectionchange",Wo="draw.modechange",qo="draw.actionable",Ho="draw.render",Yo="draw.combine",Zo="draw.uncombine",Ko="move",Xo="change_coordinates",Re="feature",an="midpoint",at="vertex",he="true",Me="false",Qo=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Jn={Point:0,LineString:1,Polygon:2};function er(e,t){var n=Jn[e.geometry.type]-Jn[t.geometry.type];return n===0&&e.geometry.type===Ce?e.area-t.area:n}function ce(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(var t=0,n=e.length;t<n;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}ce.prototype.add=function(e){return this.has(e)||(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length),this},ce.prototype.delete=function(e){return this.has(e)===!1||(this._length--,delete this._items[e],delete this._nums[e]),this},ce.prototype.has=function(e){return(typeof e=="string"||typeof e=="number")&&(this._items[e]!==void 0||this._nums[e]!==void 0)},ce.prototype.values=function(){var e=this,t=[];return Object.keys(this._items).forEach(function(n){t.push({k:n,v:e._items[n]})}),Object.keys(this._nums).forEach(function(n){t.push({k:JSON.parse(n),v:e._nums[n]})}),t.sort(function(n,o){return n.v-o.v}).map(function(n){return n.k})},ce.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var tr=[Re,an,at],st={click:function(e,t,n){return Vn(e,t,n,n.options.clickBuffer)},touch:function(e,t,n){return Vn(e,t,n,n.options.touchBuffer)}};function Vn(e,t,n,o){if(n.map===null)return[];var s=e?function(b,c){return c===void 0&&(c=0),[[b.point.x-c,b.point.y-c],[b.point.x+c,b.point.y+c]]}(e,o):t,r={};n.options.styles&&(r.layers=n.options.styles.map(function(b){return b.id}));var a=n.map.queryRenderedFeatures(s,r).filter(function(b){return tr.indexOf(b.properties.meta)!==-1}),g=new ce,p=[];return a.forEach(function(b){var c=b.properties.id;g.has(c)||(g.add(c),p.push(b))}),function(b){return b.map(function(c){return c.geometry.type===Ce&&(c.area=O.geometry({type:Z,property:{},geometry:c.geometry})),c}).sort(er).map(function(c){return delete c.area,c})}(p)}function sn(e,t){var n=st.click(e,null,t),o={mouse:on};return n[0]&&(o.mouse=n[0].properties.active===he?Be:Et,o.feature=n[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(o.mouse=$e),t.ui.queueMapClasses(o),t.ui.updateMapClasses(),n[0]}function zn(e,t){var n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)}function Wn(e,t,n){n===void 0&&(n={});var o=n.fineTolerance!=null?n.fineTolerance:4,s=n.grossTolerance!=null?n.grossTolerance:12,r=n.interval!=null?n.interval:500;e.point=e.point||t.point,e.time=e.time||t.time;var a=zn(e.point,t.point);return a<o||a<s&&t.time-e.time<r}function qn(e,t,n){n===void 0&&(n={});var o=n.tolerance!=null?n.tolerance:25,s=n.interval!=null?n.interval:250;return e.point=e.point||t.point,e.time=e.time||t.time,zn(e.point,t.point)<o&&t.time-e.time<s}function cn(e,t){return e(t={exports:{}},t.exports),t.exports}var un=cn(function(e){var t=e.exports=function(n,o){if(o||(o=16),n===void 0&&(n=128),n<=0)return"0";for(var s=Math.log(Math.pow(2,n))/Math.log(o),r=2;s===1/0;r*=2)s=Math.log(Math.pow(2,n/r))/Math.log(o)*r;var a=s-Math.floor(s),g="";for(r=0;r<Math.floor(s);r++)g=Math.floor(Math.random()*o).toString(o)+g;if(a){var p=Math.pow(o,a);g=Math.floor(Math.random()*p).toString(o)+g}var b=parseInt(g,o);return b!==1/0&&b>=Math.pow(2,n)?t(n,o):g};t.rack=function(n,o,s){var r=function(g){var p=0;do{if(p++>10){if(!s)throw new Error("too many ID collisions, use more bits");n+=s}var b=t(n,o)}while(Object.hasOwnProperty.call(a,b));return a[b]=g,b},a=r.hats={};return r.get=function(g){return r.hats[g]},r.set=function(g,p){return r.hats[g]=p,r},r.bits=n||128,r.base=o||16,r}}),K=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||un(),this.type=t.geometry.type};K.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},K.prototype.incomingCoords=function(e){this.setCoordinates(e)},K.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},K.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},K.prototype.setProperty=function(e,t){this.properties[e]=t},K.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Z,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},K.prototype.internal=function(e){var t={id:this.id,meta:Re,"meta:type":this.type,active:Me,mode:e};if(this.ctx.options.userProperties)for(var n in this.properties)t["user_"+n]=this.properties[n];return{type:Z,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Ue=function(e,t){K.call(this,e,t)};(Ue.prototype=Object.create(K.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Ue.prototype.updateCoordinate=function(e,t,n){this.coordinates=arguments.length===3?[t,n]:[e,t],this.changed()},Ue.prototype.getCoordinate=function(){return this.getCoordinates()};var ge=function(e,t){K.call(this,e,t)};(ge.prototype=Object.create(K.prototype)).isValid=function(){return this.coordinates.length>1},ge.prototype.addCoordinate=function(e,t,n){this.changed();var o=parseInt(e,10);this.coordinates.splice(o,0,[t,n])},ge.prototype.getCoordinate=function(e){var t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},ge.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},ge.prototype.updateCoordinate=function(e,t,n){var o=parseInt(e,10);this.coordinates[o]=[t,n],this.changed()};var ie=function(e,t){K.call(this,e,t),this.coordinates=this.coordinates.map(function(n){return n.slice(0,-1)})};(ie.prototype=Object.create(K.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(e){return e.length>2})},ie.prototype.incomingCoords=function(e){this.coordinates=e.map(function(t){return t.slice(0,-1)}),this.changed()},ie.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},ie.prototype.addCoordinate=function(e,t,n){this.changed();var o=e.split(".").map(function(s){return parseInt(s,10)});this.coordinates[o[0]].splice(o[1],0,[t,n])},ie.prototype.removeCoordinate=function(e){this.changed();var t=e.split(".").map(function(o){return parseInt(o,10)}),n=this.coordinates[t[0]];n&&(n.splice(t[1],1),n.length<3&&this.coordinates.splice(t[0],1))},ie.prototype.getCoordinate=function(e){var t=e.split(".").map(function(o){return parseInt(o,10)}),n=this.coordinates[t[0]];return JSON.parse(JSON.stringify(n[t[1]]))},ie.prototype.getCoordinates=function(){return this.coordinates.map(function(e){return e.concat([e[0]])})},ie.prototype.updateCoordinate=function(e,t,n){this.changed();var o=e.split("."),s=parseInt(o[0],10),r=parseInt(o[1],10);this.coordinates[s]===void 0&&(this.coordinates[s]=[]),this.coordinates[s][r]=[t,n]};var nr={MultiPoint:Ue,MultiLineString:ge,MultiPolygon:ie},Mt=function(e,t,n,o,s){var r=n.split("."),a=parseInt(r[0],10),g=r[1]?r.slice(1).join("."):null;return e[a][t](g,o,s)},ee=function(e,t){if(K.call(this,e,t),delete this.coordinates,this.model=nr[t.geometry.type],this.model===void 0)throw new TypeError(t.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(t.geometry.coordinates)};function P(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}(ee.prototype=Object.create(K.prototype))._coordinatesToFeatures=function(e){var t=this,n=this.model.bind(this);return e.map(function(o){return new n(t.ctx,{id:un(),type:Z,properties:{},geometry:{coordinates:o,type:t.type.replace("Multi","")}})})},ee.prototype.isValid=function(){return this.features.every(function(e){return e.isValid()})},ee.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},ee.prototype.getCoordinate=function(e){return Mt(this.features,"getCoordinate",e)},ee.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(e){return e.type===Ce?e.getCoordinates():e.coordinates})))},ee.prototype.updateCoordinate=function(e,t,n){Mt(this.features,"updateCoordinate",e,t,n),this.changed()},ee.prototype.addCoordinate=function(e,t,n){Mt(this.features,"addCoordinate",e,t,n),this.changed()},ee.prototype.removeCoordinate=function(e){Mt(this.features,"removeCoordinate",e),this.changed()},ee.prototype.getFeatures=function(){return this.features},P.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},P.prototype.setSelectedCoordinates=function(e){var t=this;this._ctx.store.setSelectedCoordinates(e),e.reduce(function(n,o){return n[o.feature_id]===void 0&&(n[o.feature_id]=!0,t._ctx.store.get(o.feature_id).changed()),n},{})},P.prototype.getSelected=function(){return this._ctx.store.getSelected()},P.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},P.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},P.prototype.getFeature=function(e){return this._ctx.store.get(e)},P.prototype.select=function(e){return this._ctx.store.select(e)},P.prototype.deselect=function(e){return this._ctx.store.deselect(e)},P.prototype.deleteFeature=function(e,t){return t===void 0&&(t={}),this._ctx.store.delete(e,t)},P.prototype.addFeature=function(e){return this._ctx.store.add(e)},P.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},P.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},P.prototype.setActionableState=function(e){e===void 0&&(e={});var t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)},P.prototype.changeMode=function(e,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),this._ctx.events.changeMode(e,t,n)},P.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},P.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},P.prototype.featuresAt=function(e,t,n){if(n===void 0&&(n="click"),n!=="click"&&n!=="touch")throw new Error("invalid buffer type");return st[n](e,t,this._ctx)},P.prototype.newFeature=function(e){var t=e.geometry.type;return t===oe?new Ue(this._ctx,e):t===Ze?new ge(this._ctx,e):t===Ce?new ie(this._ctx,e):new ee(this._ctx,e)},P.prototype.isInstanceOf=function(e,t){if(e===oe)return t instanceof Ue;if(e===Ze)return t instanceof ge;if(e===Ce)return t instanceof ie;if(e==="MultiFeature")return t instanceof ee;throw new Error("Unknown feature class: "+e)},P.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)},P.prototype.onSetup=function(){},P.prototype.onDrag=function(){},P.prototype.onClick=function(){},P.prototype.onMouseMove=function(){},P.prototype.onMouseDown=function(){},P.prototype.onMouseUp=function(){},P.prototype.onMouseOut=function(){},P.prototype.onKeyUp=function(){},P.prototype.onKeyDown=function(){},P.prototype.onTouchStart=function(){},P.prototype.onTouchMove=function(){},P.prototype.onTouchEnd=function(){},P.prototype.onTap=function(){},P.prototype.onStop=function(){},P.prototype.onTrash=function(){},P.prototype.onCombineFeature=function(){},P.prototype.onUncombineFeature=function(){},P.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Hn={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},or=Object.keys(Hn);function rr(e){var t=Object.keys(e);return function(n,o){o===void 0&&(o={});var s={},r=t.reduce(function(a,g){return a[g]=e[g],a},new P(n));return{start:function(){var a=this;s=r.onSetup(o),or.forEach(function(g){var p,b=Hn[g],c=function(){return!1};e[b]&&(c=function(){return!0}),a.on(g,c,(p=b,function(y){return r[p](s,y)}))})},stop:function(){r.onStop(s)},trash:function(){r.onTrash(s)},combineFeatures:function(){r.onCombineFeatures(s)},uncombineFeatures:function(){r.onUncombineFeatures(s)},render:function(a,g){r.toDisplayFeatures(s,a,g)}}}}function It(e){return[].concat(e).filter(function(t){return t!==void 0})}function ir(){var e=this;if(!(e.ctx.map&&e.ctx.map.getSource(Ye)!==void 0))return p();var t=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:t});var n=[],o=[];e.isDirty?o=e.getAllIds():(n=e.getChangedIds().filter(function(b){return e.get(b)!==void 0}),o=e.sources.hot.filter(function(b){return b.properties.id&&n.indexOf(b.properties.id)===-1&&e.get(b.properties.id)!==void 0}).map(function(b){return b.properties.id})),e.sources.hot=[];var s=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(function(b){var c=b.properties.id||b.properties.parent;return n.indexOf(c)===-1});var r=s!==e.sources.cold.length||o.length>0;function a(b,c){var y=e.get(b).internal(t);e.ctx.events.currentModeRender(y,function(_){e.sources[c].push(_)})}if(n.forEach(function(b){return a(b,"hot")}),o.forEach(function(b){return a(b,"cold")}),r&&e.ctx.map.getSource(it).setData({type:Ee,features:e.sources.cold}),e.ctx.map.getSource(Ye).setData({type:Ee,features:e.sources.hot}),e._emitSelectionChange&&(e.ctx.map.fire(zo,{features:e.getSelected().map(function(b){return b.toGeoJSON()}),points:e.getSelectedCoordinates().map(function(b){return{type:Z,properties:{},geometry:{type:oe,coordinates:b.coordinates}}})}),e._emitSelectionChange=!1),e._deletedFeaturesToEmit.length){var g=e._deletedFeaturesToEmit.map(function(b){return b.toGeoJSON()});e._deletedFeaturesToEmit=[],e.ctx.map.fire(Vo,{features:g})}function p(){e.isDirty=!1,e.clearChangedIds()}p(),e.ctx.map.fire(Ho,{})}function B(e){var t,n=this;this._features={},this._featureIds=new ce,this._selectedFeatureIds=new ce,this._selectedCoordinates=[],this._changedFeatureIds=new ce,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=function(){t||(t=requestAnimationFrame(function(){t=null,ir.call(n)}))},this.isDirty=!1}function Yn(e,t){var n=e._selectedCoordinates.filter(function(o){return e._selectedFeatureIds.has(o.feature_id)});e._selectedCoordinates.length===n.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=n}B.prototype.createRenderBatch=function(){var e=this,t=this.render,n=0;return this.render=function(){n++},function(){e.render=t,n>0&&e.render()}},B.prototype.setDirty=function(){return this.isDirty=!0,this},B.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this},B.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},B.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},B.prototype.getAllIds=function(){return this._featureIds.values()},B.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this},B.prototype.delete=function(e,t){var n=this;return t===void 0&&(t={}),It(e).forEach(function(o){n._featureIds.has(o)&&(n._featureIds.delete(o),n._selectedFeatureIds.delete(o),t.silent||n._deletedFeaturesToEmit.indexOf(n._features[o])===-1&&n._deletedFeaturesToEmit.push(n._features[o]),delete n._features[o],n.isDirty=!0)}),Yn(this,t),this},B.prototype.get=function(e){return this._features[e]},B.prototype.getAll=function(){var e=this;return Object.keys(this._features).map(function(t){return e._features[t]})},B.prototype.select=function(e,t){var n=this;return t===void 0&&(t={}),It(e).forEach(function(o){n._selectedFeatureIds.has(o)||(n._selectedFeatureIds.add(o),n._changedFeatureIds.add(o),t.silent||(n._emitSelectionChange=!0))}),this},B.prototype.deselect=function(e,t){var n=this;return t===void 0&&(t={}),It(e).forEach(function(o){n._selectedFeatureIds.has(o)&&(n._selectedFeatureIds.delete(o),n._changedFeatureIds.add(o),t.silent||(n._emitSelectionChange=!0))}),Yn(this,t),this},B.prototype.clearSelected=function(e){return e===void 0&&(e={}),this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},B.prototype.setSelected=function(e,t){var n=this;return t===void 0&&(t={}),e=It(e),this.deselect(this._selectedFeatureIds.values().filter(function(o){return e.indexOf(o)===-1}),{silent:t.silent}),this.select(e.filter(function(o){return!n._selectedFeatureIds.has(o)}),{silent:t.silent}),this},B.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},B.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},B.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},B.prototype.getSelected=function(){var e=this;return this._selectedFeatureIds.values().map(function(t){return e.get(t)})},B.prototype.getSelectedCoordinates=function(){var e=this;return this._selectedCoordinates.map(function(t){return{coordinates:e.get(t.feature_id).getCoordinate(t.coord_path)}})},B.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},B.prototype.setFeatureProperty=function(e,t,n){this.get(e).setProperty(t,n),this.featureChanged(e)},B.prototype.storeMapConfig=function(){var e=this;Qo.forEach(function(t){e.ctx.map[t]&&(e._mapInitialConfig[t]=e.ctx.map[t].isEnabled())})},B.prototype.restoreMapConfig=function(){var e=this;Object.keys(this._mapInitialConfig).forEach(function(t){e._mapInitialConfig[t]?e.ctx.map[t].enable():e.ctx.map[t].disable()})},B.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]===void 0||this._mapInitialConfig[e]};var Ie=function(){for(var e=arguments,t={},n=0;n<arguments.length;n++){var o=e[n];for(var s in o)ar.call(o,s)&&(t[s]=o[s])}return t},ar=Object.prototype.hasOwnProperty,sr=["mode","feature","mouse"];function cr(e){var t=null,n=null,o={onRemove:function(){return e.map.off("load",o.connect),clearInterval(n),o.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect:function(){e.map.off("load",o.connect),clearInterval(n),o.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd:function(s){var r=s.fire;return s.fire=function(a,g){var p=arguments;return r.length===1&&arguments.length!==1&&(p=[Ie({},{type:a},g)]),r.apply(s,p)},e.map=s,e.events=function(a){var g=Object.keys(a.options.modes).reduce(function(d,w){return d[w]=rr(a.options.modes[w]),d},{}),p={},b={},c={},y=null,_=null;c.drag=function(d,w){w({point:d.point,time:new Date().getTime()})?(a.ui.queueMapClasses({mouse:Ro}),_.drag(d)):d.originalEvent.stopPropagation()},c.mousedrag=function(d){c.drag(d,function(w){return!Wn(p,w)})},c.touchdrag=function(d){c.drag(d,function(w){return!qn(b,w)})},c.mousemove=function(d){if((d.originalEvent.buttons!==void 0?d.originalEvent.buttons:d.originalEvent.which)===1)return c.mousedrag(d);var w=sn(d,a);d.featureTarget=w,_.mousemove(d)},c.mousedown=function(d){p={time:new Date().getTime(),point:d.point};var w=sn(d,a);d.featureTarget=w,_.mousedown(d)},c.mouseup=function(d){var w=sn(d,a);d.featureTarget=w,Wn(p,{point:d.point,time:new Date().getTime()})?_.click(d):_.mouseup(d)},c.mouseout=function(d){_.mouseout(d)},c.touchstart=function(d){if(d.originalEvent.preventDefault(),a.options.touchEnabled){b={time:new Date().getTime(),point:d.point};var w=st.touch(d,null,a)[0];d.featureTarget=w,_.touchstart(d)}},c.touchmove=function(d){if(d.originalEvent.preventDefault(),a.options.touchEnabled)return _.touchmove(d),c.touchdrag(d)},c.touchend=function(d){if(d.originalEvent.preventDefault(),a.options.touchEnabled){var w=st.touch(d,null,a)[0];d.featureTarget=w,qn(b,{time:new Date().getTime(),point:d.point})?_.tap(d):_.touchend(d)}};var S=function(d){return!(d===8||d===46||d>=48&&d<=57)};function I(d,w,A){A===void 0&&(A={}),_.stop();var j=g[d];if(j===void 0)throw new Error(d+" is not valid");y=d;var U=j(a,w);_=h(U,a),A.silent||a.map.fire(Wo,{mode:d}),a.store.setDirty(),a.store.render()}c.keydown=function(d){(d.srcElement||d.target).classList[0]==="mapboxgl-canvas"&&(d.keyCode!==8&&d.keyCode!==46||!a.options.controls.trash?S(d.keyCode)?_.keydown(d):d.keyCode===49&&a.options.controls.point?I(k.DRAW_POINT):d.keyCode===50&&a.options.controls.line_string?I(k.DRAW_LINE_STRING):d.keyCode===51&&a.options.controls.polygon&&I(k.DRAW_POLYGON):(d.preventDefault(),_.trash()))},c.keyup=function(d){S(d.keyCode)&&_.keyup(d)},c.zoomend=function(){a.store.changeZoom()},c.data=function(d){if(d.dataType==="style"){var w=a.setup,A=a.map,j=a.options,U=a.store;j.styles.some(function(x){return A.getLayer(x.id)})||(w.addLayers(),U.setDirty(),U.render())}};var J={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){y=a.options.defaultMode,_=h(g[y](a),a)},changeMode:I,actionable:function(d){var w=!1;Object.keys(d).forEach(function(A){if(J[A]===void 0)throw new Error("Invalid action type");J[A]!==d[A]&&(w=!0),J[A]=d[A]}),w&&a.map.fire(qo,{actions:J})},currentModeName:function(){return y},currentModeRender:function(d,w){return _.render(d,w)},fire:function(d,w){c[d]&&c[d](w)},addEventListeners:function(){a.map.on("mousemove",c.mousemove),a.map.on("mousedown",c.mousedown),a.map.on("mouseup",c.mouseup),a.map.on("data",c.data),a.map.on("touchmove",c.touchmove),a.map.on("touchstart",c.touchstart),a.map.on("touchend",c.touchend),a.container.addEventListener("mouseout",c.mouseout),a.options.keybindings&&(a.container.addEventListener("keydown",c.keydown),a.container.addEventListener("keyup",c.keyup))},removeEventListeners:function(){a.map.off("mousemove",c.mousemove),a.map.off("mousedown",c.mousedown),a.map.off("mouseup",c.mouseup),a.map.off("data",c.data),a.map.off("touchmove",c.touchmove),a.map.off("touchstart",c.touchstart),a.map.off("touchend",c.touchend),a.container.removeEventListener("mouseout",c.mouseout),a.options.keybindings&&(a.container.removeEventListener("keydown",c.keydown),a.container.removeEventListener("keyup",c.keyup))},trash:function(d){_.trash(d)},combineFeatures:function(){_.combineFeatures()},uncombineFeatures:function(){_.uncombineFeatures()},getMode:function(){return y}}}(e),e.ui=function(a){var g={},p=null,b={mode:null,feature:null,mouse:null},c={mode:null,feature:null,mouse:null};function y(d){c=Ie(c,d)}function _(){var d,w;if(a.container){var A=[],j=[];sr.forEach(function(U){c[U]!==b[U]&&(A.push(U+"-"+b[U]),c[U]!==null&&j.push(U+"-"+c[U]))}),A.length>0&&(d=a.container.classList).remove.apply(d,A),j.length>0&&(w=a.container.classList).add.apply(w,j),b=Ie(b,c)}}function S(d,w){w===void 0&&(w={});var A=document.createElement("button");return A.className=re+" "+w.className,A.setAttribute("title",w.title),w.container.appendChild(A),A.addEventListener("click",function(j){if(j.preventDefault(),j.stopPropagation(),j.target===p)return I(),void w.onDeactivate();J(d),w.onActivate()},!0),A}function I(){p&&(p.classList.remove(Rn),p=null)}function J(d){I();var w=g[d];w&&w&&d!=="trash"&&(w.classList.add(Rn),p=w)}return{setActiveButton:J,queueMapClasses:y,updateMapClasses:_,clearMapClasses:function(){y({mode:null,feature:null,mouse:null}),_()},addButtons:function(){var d=a.options.controls,w=document.createElement("div");return w.className=$o+" "+Y,d&&(d[ne.LINE]&&(g[ne.LINE]=S(ne.LINE,{container:w,className:xe,title:"LineString tool "+(a.options.keybindings?"(l)":""),onActivate:function(){return a.events.changeMode(k.DRAW_LINE_STRING)},onDeactivate:function(){return a.events.trash()}})),d[ne.POLYGON]&&(g[ne.POLYGON]=S(ne.POLYGON,{container:w,className:se,title:"Polygon tool "+(a.options.keybindings?"(p)":""),onActivate:function(){return a.events.changeMode(k.DRAW_POLYGON)},onDeactivate:function(){return a.events.trash()}})),d[ne.POINT]&&(g[ne.POINT]=S(ne.POINT,{container:w,className:Ne,title:"Marker tool "+(a.options.keybindings?"(m)":""),onActivate:function(){return a.events.changeMode(k.DRAW_POINT)},onDeactivate:function(){return a.events.trash()}})),d.trash&&(g.trash=S("trash",{container:w,className:Ao,title:"Delete",onActivate:function(){a.events.trash()}})),d.combine_features&&(g.combine_features=S("combineFeatures",{container:w,className:Do,title:"Combine",onActivate:function(){a.events.combineFeatures()}})),d.uncombine_features&&(g.uncombine_features=S("uncombineFeatures",{container:w,className:No,title:"Uncombine",onActivate:function(){a.events.uncombineFeatures()}}))),w},removeButtons:function(){Object.keys(g).forEach(function(d){var w=g[d];w.parentNode&&w.parentNode.removeChild(w),delete g[d]})}}}(e),e.container=s.getContainer(),e.store=new B(e),t=e.ui.addButtons(),e.options.boxSelect&&(s.boxZoom.disable(),s.dragPan.disable(),s.dragPan.enable()),s.loaded()?o.connect():(s.on("load",o.connect),n=setInterval(function(){s.loaded()&&o.connect()},16)),e.events.start(),t},addLayers:function(){e.map.addSource(it,{data:{type:Ee,features:[]},type:"geojson"}),e.map.addSource(Ye,{data:{type:Ee,features:[]},type:"geojson"}),e.options.styles.forEach(function(s){e.map.addLayer(s)}),e.store.setDirty(!0),e.store.render()},removeLayers:function(){e.options.styles.forEach(function(s){e.map.getLayer(s.id)&&e.map.removeLayer(s.id)}),e.map.getSource(it)&&e.map.removeSource(it),e.map.getSource(Ye)&&e.map.removeSource(Ye)}};return e.setup=o,o}function ln(e){return function(t){var n=t.featureTarget;return!!n&&!!n.properties&&n.properties.meta===e}}function Ke(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===he&&e.featureTarget.properties.meta===Re}function Zn(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===Me&&e.featureTarget.properties.meta===Re}function dn(e){return e.featureTarget===void 0}function Lt(e){var t=e.featureTarget;return!!t&&!!t.properties&&t.properties.meta===at}function pn(e){return!!e.originalEvent&&e.originalEvent.shiftKey===!0}function fn(e){return e.keyCode===27}function hn(e){return e.keyCode===13}var ur=Xe;function Xe(e,t){this.x=e,this.y=t}function gn(e,t){var n=t.getBoundingClientRect();return new ur(e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0))}function ct(e,t,n,o){return{type:Z,properties:{meta:at,parent:e,coord_path:n,active:o?he:Me},geometry:{type:oe,coordinates:t}}}function yn(e,t,n){t===void 0&&(t={}),n===void 0&&(n=null);var o,s=e.geometry,r=s.type,a=s.coordinates,g=e.properties&&e.properties.id,p=[];function b(y,_){var S="",I=null;y.forEach(function(J,d){var w=_!=null?_+"."+d:String(d),A=ct(g,J,w,c(w));if(t.midpoints&&I){var j=function(x,Ve,Pe){var T=Ve.geometry.coordinates,ue=Pe.geometry.coordinates;if(T[1]>85||T[1]<-85||ue[1]>85||ue[1]<-85)return null;var te={lng:(T[0]+ue[0])/2,lat:(T[1]+ue[1])/2};return{type:Z,properties:{meta:an,parent:x,lng:te.lng,lat:te.lat,coord_path:Pe.properties.coord_path},geometry:{type:oe,coordinates:[te.lng,te.lat]}}}(g,I,A);j&&p.push(j)}I=A;var U=JSON.stringify(J);S!==U&&p.push(A),d===0&&(S=U)})}function c(y){return!!t.selectedPaths&&t.selectedPaths.indexOf(y)!==-1}return r===oe?p.push(ct(g,a,n,c(n))):r===Ce?a.forEach(function(y,_){b(y,n!==null?n+"."+_:String(_))}):r===Ze?b(a,n):r.indexOf(Un)===0&&(o=r.replace(Un,""),a.forEach(function(y,_){var S={type:Z,properties:e.properties,geometry:{type:o,coordinates:y}};p=p.concat(yn(S,t,_))})),p}Xe.prototype={clone:function(){return new Xe(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),o=t*this.x-n*this.y,s=n*this.x+t*this.y;return this.x=o,this.y=s,this},_rotateAround:function(e,t){var n=Math.cos(e),o=Math.sin(e),s=t.x+n*(this.x-t.x)-o*(this.y-t.y),r=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=s,this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Xe.convert=function(e){return e instanceof Xe?e:Array.isArray(e)?new Xe(e[0],e[1]):e};var Qe=function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},Pt=function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()},0)},Kn=function(e){if(!e||!e.type)return null;var t=lr[e.type];if(!t)return null;if(t==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(t==="feature")return{type:"FeatureCollection",features:[e]};if(t==="featurecollection")return e},lr={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function Ft(e){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.reduce(function(t,n){return t.concat(Ft(n))},[]),e;case"Feature":return e.geometry?Ft(e.geometry).map(function(t){var n={type:"Feature",properties:JSON.parse(JSON.stringify(e.properties)),geometry:t};return e.id!==void 0&&(n.id=e.id),n}):[e];case"MultiPoint":return e.coordinates.map(function(t){return{type:"Point",coordinates:t}});case"MultiPolygon":return e.coordinates.map(function(t){return{type:"Polygon",coordinates:t}});case"MultiLineString":return e.coordinates.map(function(t){return{type:"LineString",coordinates:t}});case"GeometryCollection":return e.geometries.map(Ft).reduce(function(t,n){return t.concat(n)},[]);case"Point":case"Polygon":case"LineString":return[e]}}var dr=function(e){if(!e)return[];var t=Ft(Kn(e)),n=[];return t.features.forEach(function(o){o.geometry&&(n=n.concat(function s(r){return Array.isArray(r)&&r.length&&typeof r[0]=="number"?[r]:r.reduce(function(a,g){return Array.isArray(g)&&Array.isArray(g[0])?a.concat(s(g)):(a.push(g),a)},[])}(o.geometry.coordinates)))}),n},pr=cn(function(e){var t=e.exports=function(c){return new n(c)};function n(c){this.value=c}function o(c,y,_){var S=[],I=[],J=!0;return function d(w){var A=_?s(w):w,j={},U=!0,x={node:A,node_:w,path:[].concat(S),parent:I[I.length-1],parents:I,key:S.slice(-1)[0],isRoot:S.length===0,level:S.length,circular:null,update:function(T,ue){x.isRoot||(x.parent.node[x.key]=T),x.node=T,ue&&(U=!1)},delete:function(T){delete x.parent.node[x.key],T&&(U=!1)},remove:function(T){g(x.parent.node)?x.parent.node.splice(x.key,1):delete x.parent.node[x.key],T&&(U=!1)},keys:null,before:function(T){j.before=T},after:function(T){j.after=T},pre:function(T){j.pre=T},post:function(T){j.post=T},stop:function(){J=!1},block:function(){U=!1}};if(!J)return x;function Ve(){if(typeof x.node=="object"&&x.node!==null){x.keys&&x.node_===x.node||(x.keys=r(x.node)),x.isLeaf=x.keys.length==0;for(var T=0;T<I.length;T++)if(I[T].node_===w){x.circular=I[T];break}}else x.isLeaf=!0,x.keys=null;x.notLeaf=!x.isLeaf,x.notRoot=!x.isRoot}Ve();var Pe=y.call(x,x.node);return Pe!==void 0&&x.update&&x.update(Pe),j.before&&j.before.call(x,x.node),U&&(typeof x.node!="object"||x.node===null||x.circular||(I.push(x),Ve(),p(x.keys,function(T,ue){S.push(T),j.pre&&j.pre.call(x,x.node[T],T);var te=d(x.node[T]);_&&b.call(x.node,T)&&(x.node[T]=te.node),te.isLast=ue==x.keys.length-1,te.isFirst=ue==0,j.post&&j.post.call(x,te),S.pop()}),I.pop()),j.after&&j.after.call(x,x.node)),x}(c).node}function s(c){if(typeof c=="object"&&c!==null){var y;if(g(c))y=[];else if(a(c)==="[object Date]")y=new Date(c.getTime?c.getTime():c);else if(function(I){return a(I)==="[object RegExp]"}(c))y=new RegExp(c);else if(function(I){return a(I)==="[object Error]"}(c))y={message:c.message};else if(function(I){return a(I)==="[object Boolean]"}(c))y=new Boolean(c);else if(function(I){return a(I)==="[object Number]"}(c))y=new Number(c);else if(function(I){return a(I)==="[object String]"}(c))y=new String(c);else if(Object.create&&Object.getPrototypeOf)y=Object.create(Object.getPrototypeOf(c));else if(c.constructor===Object)y={};else{var _=c.constructor&&c.constructor.prototype||c.__proto__||{},S=function(){};S.prototype=_,y=new S}return p(r(c),function(I){y[I]=c[I]}),y}return c}n.prototype.get=function(c){for(var y=this.value,_=0;_<c.length;_++){var S=c[_];if(!y||!b.call(y,S)){y=void 0;break}y=y[S]}return y},n.prototype.has=function(c){for(var y=this.value,_=0;_<c.length;_++){var S=c[_];if(!y||!b.call(y,S))return!1;y=y[S]}return!0},n.prototype.set=function(c,y){for(var _=this.value,S=0;S<c.length-1;S++){var I=c[S];b.call(_,I)||(_[I]={}),_=_[I]}return _[c[S]]=y,y},n.prototype.map=function(c){return o(this.value,c,!0)},n.prototype.forEach=function(c){return this.value=o(this.value,c,!1),this.value},n.prototype.reduce=function(c,y){var _=arguments.length===1,S=_?this.value:y;return this.forEach(function(I){this.isRoot&&_||(S=c.call(this,S,I))}),S},n.prototype.paths=function(){var c=[];return this.forEach(function(y){c.push(this.path)}),c},n.prototype.nodes=function(){var c=[];return this.forEach(function(y){c.push(this.node)}),c},n.prototype.clone=function(){var c=[],y=[];return function _(S){for(var I=0;I<c.length;I++)if(c[I]===S)return y[I];if(typeof S=="object"&&S!==null){var J=s(S);return c.push(S),y.push(J),p(r(S),function(d){J[d]=_(S[d])}),c.pop(),y.pop(),J}return S}(this.value)};var r=Object.keys||function(c){var y=[];for(var _ in c)y.push(_);return y};function a(c){return Object.prototype.toString.call(c)}var g=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"},p=function(c,y){if(c.forEach)return c.forEach(y);for(var _=0;_<c.length;_++)y(c[_],_,c)};p(r(n.prototype),function(c){t[c]=function(y){var _=[].slice.call(arguments,1),S=new n(y);return S[c].apply(S,_)}});var b=Object.hasOwnProperty||function(c,y){return y in c}}),fr=X;function X(e){if(!(this instanceof X))return new X(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}X.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this},X.prototype.equals=function(e){var t;return t=e instanceof X?e.bbox():e,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]},X.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},X.prototype.union=function(e){var t;return this._valid=!0,t=e instanceof X?e.bbox():e,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this},X.prototype.bbox=function(){return this._valid?this._bbox:null},X.prototype.contains=function(e){if(!e)return this._fastContains();if(!this._valid)return null;var t=e[0],n=e[1];return this._bbox[0]<=t&&this._bbox[1]<=n&&this._bbox[2]>=t&&this._bbox[3]>=n},X.prototype.intersect=function(e){return this._valid?(t=e instanceof X?e.bbox():e,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])):null;var t},X.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",e)},X.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Xn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},hr=Object.keys(Xn),mn=function(e){return vn(e).bbox()};function vn(e){for(var t=fr(),n=dr(e),o=0;o<n.length;o++)t.include(n[o]);return t}mn.polygon=function(e){return vn(e).polygon()},mn.bboxify=function(e){return pr(e).map(function(t){t&&hr.some(function(n){return!!t[n]&&Xn[n].indexOf(t.type)!==-1})&&(t.bbox=vn(t).bbox(),this.update(t))})};function Qn(e,t){var n=-90,o=90,s=-90,r=90,a=270,g=-270;e.forEach(function(b){var c=mn(b),y=c[1],_=c[3],S=c[0],I=c[2];y>n&&(n=y),_<o&&(o=_),_>s&&(s=_),y<r&&(r=y),S<a&&(a=S),I>g&&(g=I)});var p=t;return n+p.lat>85&&(p.lat=85-n),s+p.lat>90&&(p.lat=90-s),o+p.lat<-85&&(p.lat=-85-o),r+p.lat<-90&&(p.lat=-90-r),a+p.lng<=-270&&(p.lng+=360*Math.ceil(Math.abs(p.lng)/360)),g+p.lng>=270&&(p.lng-=360*Math.ceil(Math.abs(p.lng)/360)),p}function eo(e,t){var n=Qn(e.map(function(o){return o.toGeoJSON()}),t);e.forEach(function(o){var s,r=o.getCoordinates(),a=function(p){var b={lng:p[0]+n.lng,lat:p[1]+n.lat};return[b.lng,b.lat]},g=function(p){return p.map(function(b){return a(b)})};o.type===oe?s=a(r):o.type===Ze||o.type===Uo?s=r.map(a):o.type===Ce||o.type===Go?s=r.map(g):o.type===Jo&&(s=r.map(function(p){return p.map(function(b){return g(b)})})),o.incomingCoords(s)})}var q={onSetup:function(e){var t=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter(function(o){return t.getFeature(o)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),n},fireUpdate:function(){this.map.fire(Gn,{action:Ko,features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(){var e=this,t=this.getSelected(),n=t.filter(function(g){return e.isInstanceOf("MultiFeature",g)}),o=!1;if(t.length>1){o=!0;var s=t[0].type.replace("Multi","");t.forEach(function(g){g.type.replace("Multi","")!==s&&(o=!1)})}var r=n.length>0,a=t.length>0;this.setActionableState({combineFeatures:o,uncombineFeatures:r,trash:a})},getUniqueIds:function(e){return e.length?e.map(function(t){return t.properties.id}).filter(function(t){return t!==void 0}).reduce(function(t,n){return t.add(n),t},new ce).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){Qe(this)},onMouseMove:function(e){return this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};q.onTap=q.onClick=function(e,t){return dn(t)?this.clickAnywhere(e,t):ln(at)(t)?this.clickOnVertex(e,t):function(n){return!!n.featureTarget&&!!n.featureTarget.properties&&n.featureTarget.properties.meta===Re}(t)?this.clickOnFeature(e,t):void 0},q.clickAnywhere=function(e){var t=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach(function(o){return t.doRender(o)})),Qe(this),this.stopExtendedInteractions(e)},q.clickOnVertex=function(e,t){this.changeMode(k.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:Be})},q.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},q.clickOnFeature=function(e,t){var n=this;Pt(this),this.stopExtendedInteractions(e);var o=pn(t),s=this.getSelectedIds(),r=t.featureTarget.properties.id,a=this.isSelected(r);if(!o&&a&&this.getFeature(r).type!==oe)return this.changeMode(k.DIRECT_SELECT,{featureId:r});a&&o?(this.deselect(r),this.updateUIClasses({mouse:Et}),s.length===1&&Qe(this)):!a&&o?(this.select(r),this.updateUIClasses({mouse:Be})):a||o||(s.forEach(function(g){return n.doRender(g)}),this.setSelected(r),this.updateUIClasses({mouse:Be})),this.doRender(r)},q.onMouseDown=function(e,t){return Ke(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&function(n){return!!n.originalEvent&&!!n.originalEvent.shiftKey&&n.originalEvent.button===0}(t)?this.startBoxSelect(e,t):void 0},q.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=gn(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},q.onTouchStart=function(e,t){if(Ke(t))return this.startOnActiveFeature(e,t)},q.onDrag=function(e,t){return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},q.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:$e}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(Bo),this.map.getContainer().appendChild(e.boxSelectElement));var n=gn(t.originalEvent,this.map.getContainer()),o=Math.min(e.boxSelectStartLocation.x,n.x),s=Math.max(e.boxSelectStartLocation.x,n.x),r=Math.min(e.boxSelectStartLocation.y,n.y),a=Math.max(e.boxSelectStartLocation.y,n.y),g="translate("+o+"px, "+r+"px)";e.boxSelectElement.style.transform=g,e.boxSelectElement.style.WebkitTransform=g,e.boxSelectElement.style.width=s-o+"px",e.boxSelectElement.style.height=a-r+"px"},q.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();var n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};eo(this.getSelected(),n),e.dragMoveLocation=t.lngLat},q.onMouseUp=function(e,t){var n=this;if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){var o=[e.boxSelectStartLocation,gn(t.originalEvent,this.map.getContainer())],s=this.featuresAt(null,o,"click"),r=this.getUniqueIds(s).filter(function(a){return!n.isSelected(a)});r.length&&(this.select(r),r.forEach(function(a){return n.doRender(a)}),this.updateUIClasses({mouse:Be}))}this.stopExtendedInteractions(e)},q.toDisplayFeatures=function(e,t,n){t.properties.active=this.isSelected(t.properties.id)?he:Me,n(t),this.fireActionable(),t.properties.active===he&&t.geometry.type!==oe&&yn(t).forEach(n)},q.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},q.onCombineFeatures=function(){var e=this.getSelected();if(!(e.length===0||e.length<2)){for(var t=[],n=[],o=e[0].type.replace("Multi",""),s=0;s<e.length;s++){var r=e[s];if(r.type.replace("Multi","")!==o)return;r.type.includes("Multi")?r.getCoordinates().forEach(function(g){t.push(g)}):t.push(r.getCoordinates()),n.push(r.toGeoJSON())}if(n.length>1){var a=this.newFeature({type:Z,properties:n[0].properties,geometry:{type:"Multi"+o,coordinates:t}});this.addFeature(a),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([a.id]),this.map.fire(Yo,{createdFeatures:[a.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},q.onUncombineFeatures=function(){var e=this,t=this.getSelected();if(t.length!==0){for(var n=[],o=[],s=function(a){var g=t[a];e.isInstanceOf("MultiFeature",g)&&(g.getFeatures().forEach(function(p){e.addFeature(p),p.properties=g.properties,n.push(p.toGeoJSON()),e.select([p.id])}),e.deleteFeature(g.id,{silent:!0}),o.push(g.toGeoJSON()))},r=0;r<t.length;r++)s(r);n.length>1&&this.map.fire(Zo,{createdFeatures:n,deletedFeatures:o}),this.fireActionable()}};var to=ln(at),gr=ln(an),Le={fireUpdate:function(){this.map.fire(Gn,{action:Xo,features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,t){this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},stopDragging:function(e){this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){this.startDragging(e,t);var n=t.featureTarget.properties,o=e.selectedCoordPaths.indexOf(n.coord_path);pn(t)||o!==-1?pn(t)&&o===-1&&e.selectedCoordPaths.push(n.coord_path):e.selectedCoordPaths=[n.coord_path];var s=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(s)},onMidpoint:function(e,t){this.startDragging(e,t);var n=t.featureTarget.properties;e.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),e.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(e,t){return t.map(function(n){return{feature_id:e,coord_path:n}})},onFeature:function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)},dragFeature:function(e,t,n){eo(this.getSelected(),n),e.dragMoveLocation=t.lngLat},dragVertex:function(e,t,n){for(var o=e.selectedCoordPaths.map(function(g){return e.feature.getCoordinate(g)}),s=Qn(o.map(function(g){return{type:Z,properties:{},geometry:{type:oe,coordinates:g}}}),n),r=0;r<o.length;r++){var a=o[r];e.feature.updateCoordinate(e.selectedCoordPaths[r],a[0]+s.lng,a[1]+s.lat)}},clickNoTarget:function(){this.changeMode(k.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(k.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){var t=e.featureId,n=this.getFeature(t);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===oe)throw new TypeError("direct_select mode doesn't handle point features");var o={featureId:t,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,o.selectedCoordPaths)),this.setSelected(t),Pt(this),this.setActionableState({trash:!0}),o},onStop:function(){Qe(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,t,n){e.featureId===t.properties.id?(t.properties.active=he,n(t),yn(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(n)):(t.properties.active=Me,n(t)),this.fireActionable(e)},onTrash:function(e){e.selectedCoordPaths.sort(function(t,n){return n.localeCompare(t,"en",{numeric:!0})}).forEach(function(t){return e.feature.removeCoordinate(t)}),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(k.SIMPLE_SELECT,{}))},onMouseMove:function(e,t){var n=Ke(t),o=to(t),s=e.selectedCoordPaths.length===0;return n&&s||o&&!s?this.updateUIClasses({mouse:Be}):this.updateUIClasses({mouse:on}),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}};Le.onTouchStart=Le.onMouseDown=function(e,t){return to(t)?this.onVertex(e,t):Ke(t)?this.onFeature(e,t):gr(t)?this.onMidpoint(e,t):void 0},Le.onDrag=function(e,t){if(e.canDragMove===!0){e.dragMoving=!0,t.originalEvent.stopPropagation();var n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,n):this.dragFeature(e,t,n),e.dragMoveLocation=t.lngLat}},Le.onClick=function(e,t){return dn(t)?this.clickNoTarget(e,t):Ke(t)?this.clickActiveFeature(e,t):Zn(t)?this.clickInactive(e,t):void this.stopDragging(e)},Le.onTap=function(e,t){return dn(t)?this.clickNoTarget(e,t):Ke(t)?this.clickActiveFeature(e,t):Zn(t)?this.clickInactive(e,t):void 0},Le.onTouchEnd=Le.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};var de={};function bn(e,t){return!!e.lngLat&&e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]}de.onSetup=function(){var e=this.newFeature({type:Z,properties:{},geometry:{type:oe,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:$e}),this.activateUIButton(ne.POINT),this.setActionableState({trash:!0}),{point:e}},de.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)},de.onTap=de.onClick=function(e,t){this.updateUIClasses({mouse:Be}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.map.fire(rn,{features:[e.point.toGeoJSON()]}),this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.point.id]})},de.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},de.toDisplayFeatures=function(e,t,n){var o=t.properties.id===e.point.id;if(t.properties.active=o?he:Me,!o)return n(t)},de.onTrash=de.stopDrawingAndRemove,de.onKeyUp=function(e,t){if(fn(t)||hn(t))return this.stopDrawingAndRemove(e,t)};var Ge={onSetup:function(){var e=this.newFeature({type:Z,properties:{},geometry:{type:Ce,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),Pt(this),this.updateUIClasses({mouse:$e}),this.activateUIButton(ne.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&bn(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:$e}),e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Lt(t)&&this.updateUIClasses({mouse:Et})}};Ge.onTap=Ge.onClick=function(e,t){return Lt(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},Ge.onKeyUp=function(e,t){fn(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)):hn(t)&&this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},Ge.onStop=function(e){this.updateUIClasses({mouse:on}),Qe(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate("0."+e.currentVertexPosition),e.polygon.isValid()?this.map.fire(rn,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT,{},{silent:!0})))},Ge.toDisplayFeatures=function(e,t,n){var o=t.properties.id===e.polygon.id;if(t.properties.active=o?he:Me,!o)return n(t);if(t.geometry.coordinates.length!==0){var s=t.geometry.coordinates[0].length;if(!(s<3)){if(t.properties.meta=Re,n(ct(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),s>3){var r=t.geometry.coordinates[0].length-3;n(ct(e.polygon.id,t.geometry.coordinates[0][r],"0."+r,!1))}if(s<=4){var a=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:Z,properties:t.properties,geometry:{coordinates:a,type:Ze}}),s===3)return}return n(t)}}},Ge.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)};var Je={onSetup:function(e){var t,n,o=(e=e||{}).featureId,s="forward";if(o){if(!(t=this.getFeature(o)))throw new Error("Could not find a feature with the provided featureId");var r=e.from;if(r&&r.type==="Feature"&&r.geometry&&r.geometry.type==="Point"&&(r=r.geometry),r&&r.type==="Point"&&r.coordinates&&r.coordinates.length===2&&(r=r.coordinates),!r||!Array.isArray(r))throw new Error("Please use the `from` property to indicate which point to continue the line from");var a=t.coordinates.length-1;if(t.coordinates[a][0]===r[0]&&t.coordinates[a][1]===r[1])n=a+1,t.addCoordinate.apply(t,[n].concat(t.coordinates[a]));else{if(t.coordinates[0][0]!==r[0]||t.coordinates[0][1]!==r[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");s="backwards",n=0,t.addCoordinate.apply(t,[n].concat(t.coordinates[0]))}}else t=this.newFeature({type:Z,properties:{},geometry:{type:Ze,coordinates:[]}}),n=0,this.addFeature(t);return this.clearSelectedFeatures(),Pt(this),this.updateUIClasses({mouse:$e}),this.activateUIButton(ne.LINE),this.setActionableState({trash:!0}),{line:t,currentVertexPosition:n,direction:s}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&bn(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&bn(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:$e}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Lt(t)&&this.updateUIClasses({mouse:Et})}};Je.onTap=Je.onClick=function(e,t){if(Lt(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},Je.onKeyUp=function(e,t){hn(t)?this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.line.id]}):fn(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT))},Je.onStop=function(e){Qe(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(""+e.currentVertexPosition),e.line.isValid()?this.map.fire(rn,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT,{},{silent:!0})))},Je.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)},Je.toDisplayFeatures=function(e,t,n){var o=t.properties.id===e.line.id;if(t.properties.active=o?he:Me,!o)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=Re,n(ct(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],""+(e.direction==="forward"?t.geometry.coordinates.length-2:1),!1)),n(t))};var no={simple_select:q,direct_select:Le,draw_point:de,draw_polygon:Ge,draw_line_string:Je},yr={defaultMode:k.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:no,controls:{},userProperties:!1},mr={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},vr={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function oo(e,t){return e.map(function(n){return n.source?n:Ie(n,{id:n.id+"."+t,source:t==="hot"?Ye:it})})}var br=cn(function(e,t){var n="[object Arguments]",o="[object Map]",s="[object Object]",r="[object Set]",a=/^\[object .+?Constructor\]$/,g=/^(?:0|[1-9]\d*)$/,p={};p["[object Float32Array]"]=p["[object Float64Array]"]=p["[object Int8Array]"]=p["[object Int16Array]"]=p["[object Int32Array]"]=p["[object Uint8Array]"]=p["[object Uint8ClampedArray]"]=p["[object Uint16Array]"]=p["[object Uint32Array]"]=!0,p[n]=p["[object Array]"]=p["[object ArrayBuffer]"]=p["[object Boolean]"]=p["[object DataView]"]=p["[object Date]"]=p["[object Error]"]=p["[object Function]"]=p[o]=p["[object Number]"]=p[s]=p["[object RegExp]"]=p[r]=p["[object String]"]=p["[object WeakMap]"]=!1;var b=typeof gt=="object"&&gt&&gt.Object===Object&&gt,c=typeof self=="object"&&self&&self.Object===Object&&self,y=b||c||Function("return this")(),_=t&&!t.nodeType&&t,S=_&&e&&!e.nodeType&&e,I=S&&S.exports===_,J=I&&b.process,d=function(){try{return J&&J.binding&&J.binding("util")}catch{}}(),w=d&&d.isTypedArray;function A(i,l){for(var m=-1,C=i==null?0:i.length;++m<C;)if(l(i[m],m,i))return!0;return!1}function j(i){var l=-1,m=Array(i.size);return i.forEach(function(C,R){m[++l]=[R,C]}),m}function U(i){var l=-1,m=Array(i.size);return i.forEach(function(C){m[++l]=C}),m}var x,Ve,Pe,T=Array.prototype,ue=Function.prototype,te=Object.prototype,_n=y["__core-js_shared__"],io=ue.toString,pe=te.hasOwnProperty,ao=(x=/[^.]+$/.exec(_n&&_n.keys&&_n.keys.IE_PROTO||""))?"Symbol(src)_1."+x:"",so=te.toString,xr=RegExp("^"+io.call(pe).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),co=I?y.Buffer:void 0,kt=y.Symbol,uo=y.Uint8Array,lo=te.propertyIsEnumerable,Cr=T.splice,ze=kt?kt.toStringTag:void 0,po=Object.getOwnPropertySymbols,Er=co?co.isBuffer:void 0,Mr=(Ve=Object.keys,Pe=Object,function(i){return Ve(Pe(i))}),wn=et(y,"DataView"),ut=et(y,"Map"),Sn=et(y,"Promise"),xn=et(y,"Set"),Cn=et(y,"WeakMap"),lt=et(Object,"create"),Ir=He(wn),Lr=He(ut),Pr=He(Sn),Fr=He(xn),kr=He(Cn),fo=kt?kt.prototype:void 0,En=fo?fo.valueOf:void 0;function We(i){var l=-1,m=i==null?0:i.length;for(this.clear();++l<m;){var C=i[l];this.set(C[0],C[1])}}function ye(i){var l=-1,m=i==null?0:i.length;for(this.clear();++l<m;){var C=i[l];this.set(C[0],C[1])}}function qe(i){var l=-1,m=i==null?0:i.length;for(this.clear();++l<m;){var C=i[l];this.set(C[0],C[1])}}function Tt(i){var l=-1,m=i==null?0:i.length;for(this.__data__=new qe;++l<m;)this.add(i[l])}function Fe(i){var l=this.__data__=new ye(i);this.size=l.size}function Tr(i,l){var m=At(i),C=!m&&Nr(i),R=!m&&!C&&Mn(i),F=!m&&!C&&!R&&So(i),G=m||C||R||F,V=G?function(W,fe){for(var me=-1,Q=Array(W);++me<W;)Q[me]=fe(me);return Q}(i.length,String):[],le=V.length;for(var z in i)!l&&!pe.call(i,z)||G&&(z=="length"||R&&(z=="offset"||z=="parent")||F&&(z=="buffer"||z=="byteLength"||z=="byteOffset")||Dr(z,le))||V.push(z);return V}function jt(i,l){for(var m=i.length;m--;)if(vo(i[m][0],l))return m;return-1}function dt(i){return i==null?i===void 0?"[object Undefined]":"[object Null]":ze&&ze in Object(i)?function(l){var m=pe.call(l,ze),C=l[ze];try{l[ze]=void 0;var R=!0}catch{}var F=so.call(l);return R&&(m?l[ze]=C:delete l[ze]),F}(i):function(l){return so.call(l)}(i)}function ho(i){return pt(i)&&dt(i)==n}function go(i,l,m,C,R){return i===l||(i==null||l==null||!pt(i)&&!pt(l)?i!=i&&l!=l:function(F,G,V,le,z,W){var fe=At(F),me=At(G),Q=fe?"[object Array]":ke(F),ve=me?"[object Array]":ke(G),tt=(Q=Q==n?s:Q)==s,Dt=(ve=ve==n?s:ve)==s,nt=Q==ve;if(nt&&Mn(F)){if(!Mn(G))return!1;fe=!0,tt=!1}if(nt&&!tt)return W||(W=new Fe),fe||So(F)?yo(F,G,V,le,z,W):function(N,D,Nt,Te,In,ae,be){switch(Nt){case"[object DataView]":if(N.byteLength!=D.byteLength||N.byteOffset!=D.byteOffset)return!1;N=N.buffer,D=D.buffer;case"[object ArrayBuffer]":return!(N.byteLength!=D.byteLength||!ae(new uo(N),new uo(D)));case"[object Boolean]":case"[object Date]":case"[object Number]":return vo(+N,+D);case"[object Error]":return N.name==D.name&&N.message==D.message;case"[object RegExp]":case"[object String]":return N==D+"";case o:var je=j;case r:var ht=1&Te;if(je||(je=U),N.size!=D.size&&!ht)return!1;var $t=be.get(N);if($t)return $t==D;Te|=2,be.set(N,D);var ot=yo(je(N),je(D),Te,In,ae,be);return be.delete(N),ot;case"[object Symbol]":if(En)return En.call(N)==En.call(D)}return!1}(F,G,Q,V,le,z,W);if(!(1&V)){var ft=tt&&pe.call(F,"__wrapped__"),xo=Dt&&pe.call(G,"__wrapped__");if(ft||xo){var Br=ft?F.value():F,Rr=xo?G.value():G;return W||(W=new Fe),z(Br,Rr,V,le,W)}}return nt?(W||(W=new Fe),function(N,D,Nt,Te,In,ae){var be=1&Nt,je=mo(N),ht=je.length,$t=mo(D).length;if(ht!=$t&&!be)return!1;for(var ot=ht;ot--;){var Oe=je[ot];if(!(be?Oe in D:pe.call(D,Oe)))return!1}var Co=ae.get(N);if(Co&&ae.get(D))return Co==D;var Bt=!0;ae.set(N,D),ae.set(D,N);for(var Ln=be;++ot<ht;){Oe=je[ot];var Rt=N[Oe],Ut=D[Oe];if(Te)var Eo=be?Te(Ut,Rt,Oe,D,N,ae):Te(Rt,Ut,Oe,N,D,ae);if(!(Eo===void 0?Rt===Ut||In(Rt,Ut,Nt,Te,ae):Eo)){Bt=!1;break}Ln||(Ln=Oe=="constructor")}if(Bt&&!Ln){var Gt=N.constructor,Jt=D.constructor;Gt==Jt||!("constructor"in N)||!("constructor"in D)||typeof Gt=="function"&&Gt instanceof Gt&&typeof Jt=="function"&&Jt instanceof Jt||(Bt=!1)}return ae.delete(N),ae.delete(D),Bt}(F,G,V,le,z,W)):!1}(i,l,m,C,go,R))}function jr(i){return!(!wo(i)||function(l){return!!ao&&ao in l}(i))&&(bo(i)?xr:a).test(He(i))}function Or(i){if(m=(l=i)&&l.constructor,C=typeof m=="function"&&m.prototype||te,l!==C)return Mr(i);var l,m,C,R=[];for(var F in Object(i))pe.call(i,F)&&F!="constructor"&&R.push(F);return R}function yo(i,l,m,C,R,F){var G=1&m,V=i.length,le=l.length;if(V!=le&&!(G&&le>V))return!1;var z=F.get(i);if(z&&F.get(l))return z==l;var W=-1,fe=!0,me=2&m?new Tt:void 0;for(F.set(i,l),F.set(l,i);++W<V;){var Q=i[W],ve=l[W];if(C)var tt=G?C(ve,Q,W,l,i,F):C(Q,ve,W,i,l,F);if(tt!==void 0){if(tt)continue;fe=!1;break}if(me){if(!A(l,function(Dt,nt){if(ft=nt,!me.has(ft)&&(Q===Dt||R(Q,Dt,m,C,F)))return me.push(nt);var ft})){fe=!1;break}}else if(Q!==ve&&!R(Q,ve,m,C,F)){fe=!1;break}}return F.delete(i),F.delete(l),fe}function mo(i){return function(l,m,C){var R=m(l);return At(l)?R:function(F,G){for(var V=-1,le=G.length,z=F.length;++V<le;)F[z+V]=G[V];return F}(R,C(l))}(i,$r,Ar)}function Ot(i,l){var m,C,R=i.__data__;return((C=typeof(m=l))=="string"||C=="number"||C=="symbol"||C=="boolean"?m!=="__proto__":m===null)?R[typeof l=="string"?"string":"hash"]:R.map}function et(i,l){var m=function(C,R){return C==null?void 0:C[R]}(i,l);return jr(m)?m:void 0}We.prototype.clear=function(){this.__data__=lt?lt(null):{},this.size=0},We.prototype.delete=function(i){var l=this.has(i)&&delete this.__data__[i];return this.size-=l?1:0,l},We.prototype.get=function(i){var l=this.__data__;if(lt){var m=l[i];return m==="__lodash_hash_undefined__"?void 0:m}return pe.call(l,i)?l[i]:void 0},We.prototype.has=function(i){var l=this.__data__;return lt?l[i]!==void 0:pe.call(l,i)},We.prototype.set=function(i,l){var m=this.__data__;return this.size+=this.has(i)?0:1,m[i]=lt&&l===void 0?"__lodash_hash_undefined__":l,this},ye.prototype.clear=function(){this.__data__=[],this.size=0},ye.prototype.delete=function(i){var l=this.__data__,m=jt(l,i);return!(m<0)&&(m==l.length-1?l.pop():Cr.call(l,m,1),--this.size,!0)},ye.prototype.get=function(i){var l=this.__data__,m=jt(l,i);return m<0?void 0:l[m][1]},ye.prototype.has=function(i){return jt(this.__data__,i)>-1},ye.prototype.set=function(i,l){var m=this.__data__,C=jt(m,i);return C<0?(++this.size,m.push([i,l])):m[C][1]=l,this},qe.prototype.clear=function(){this.size=0,this.__data__={hash:new We,map:new(ut||ye),string:new We}},qe.prototype.delete=function(i){var l=Ot(this,i).delete(i);return this.size-=l?1:0,l},qe.prototype.get=function(i){return Ot(this,i).get(i)},qe.prototype.has=function(i){return Ot(this,i).has(i)},qe.prototype.set=function(i,l){var m=Ot(this,i),C=m.size;return m.set(i,l),this.size+=m.size==C?0:1,this},Tt.prototype.add=Tt.prototype.push=function(i){return this.__data__.set(i,"__lodash_hash_undefined__"),this},Tt.prototype.has=function(i){return this.__data__.has(i)},Fe.prototype.clear=function(){this.__data__=new ye,this.size=0},Fe.prototype.delete=function(i){var l=this.__data__,m=l.delete(i);return this.size=l.size,m},Fe.prototype.get=function(i){return this.__data__.get(i)},Fe.prototype.has=function(i){return this.__data__.has(i)},Fe.prototype.set=function(i,l){var m=this.__data__;if(m instanceof ye){var C=m.__data__;if(!ut||C.length<199)return C.push([i,l]),this.size=++m.size,this;m=this.__data__=new qe(C)}return m.set(i,l),this.size=m.size,this};var Ar=po?function(i){return i==null?[]:(i=Object(i),function(l,m){for(var C=-1,R=l==null?0:l.length,F=0,G=[];++C<R;){var V=l[C];m(V,C,l)&&(G[F++]=V)}return G}(po(i),function(l){return lo.call(i,l)}))}:function(){return[]},ke=dt;function Dr(i,l){return!!(l=l??9007199254740991)&&(typeof i=="number"||g.test(i))&&i>-1&&i%1==0&&i<l}function He(i){if(i!=null){try{return io.call(i)}catch{}try{return i+""}catch{}}return""}function vo(i,l){return i===l||i!=i&&l!=l}(wn&&ke(new wn(new ArrayBuffer(1)))!="[object DataView]"||ut&&ke(new ut)!=o||Sn&&ke(Sn.resolve())!="[object Promise]"||xn&&ke(new xn)!=r||Cn&&ke(new Cn)!="[object WeakMap]")&&(ke=function(i){var l=dt(i),m=l==s?i.constructor:void 0,C=m?He(m):"";if(C)switch(C){case Ir:return"[object DataView]";case Lr:return o;case Pr:return"[object Promise]";case Fr:return r;case kr:return"[object WeakMap]"}return l});var Nr=ho(function(){return arguments}())?ho:function(i){return pt(i)&&pe.call(i,"callee")&&!lo.call(i,"callee")},At=Array.isArray,Mn=Er||function(){return!1};function bo(i){if(!wo(i))return!1;var l=dt(i);return l=="[object Function]"||l=="[object GeneratorFunction]"||l=="[object AsyncFunction]"||l=="[object Proxy]"}function _o(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=9007199254740991}function wo(i){var l=typeof i;return i!=null&&(l=="object"||l=="function")}function pt(i){return i!=null&&typeof i=="object"}var So=w?function(i){return function(l){return i(l)}}(w):function(i){return pt(i)&&_o(i.length)&&!!p[dt(i)]};function $r(i){return(l=i)!=null&&_o(l.length)&&!bo(l)?Tr(i):Or(i);var l}e.exports=function(i,l){return go(i,l)}}),_r={Polygon:ie,LineString:ge,Point:Ue,MultiPolygon:ee,MultiLineString:ee,MultiPoint:ee};function wr(e,t){return t.modes=k,t.getFeatureIdsAt=function(n){return st.click({point:n},null,e).map(function(o){return o.properties.id})},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:Ee,features:e.store.getSelectedIds().map(function(n){return e.store.get(n)}).map(function(n){return n.toGeoJSON()})}},t.getSelectedPoints=function(){return{type:Ee,features:e.store.getSelectedCoordinates().map(function(n){return{type:Z,properties:{},geometry:{type:oe,coordinates:n.coordinates}}})}},t.set=function(n){if(n.type===void 0||n.type!==Ee||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");var o=e.store.createRenderBatch(),s=e.store.getAllIds().slice(),r=t.add(n),a=new ce(r);return(s=s.filter(function(g){return!a.has(g)})).length&&t.delete(s),o(),r},t.add=function(n){var o=JSON.parse(JSON.stringify(Kn(n))).features.map(function(s){if(s.id=s.id||un(),s.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(s.id)===void 0||e.store.get(s.id).type!==s.geometry.type){var r=_r[s.geometry.type];if(r===void 0)throw new Error("Invalid geometry type: "+s.geometry.type+".");var a=new r(e,s);e.store.add(a)}else{var g=e.store.get(s.id);g.properties=s.properties,br(g.getCoordinates(),s.geometry.coordinates)||g.incomingCoords(s.geometry.coordinates)}return s.id});return e.store.render(),o},t.get=function(n){var o=e.store.get(n);if(o)return o.toGeoJSON()},t.getAll=function(){return{type:Ee,features:e.store.getAll().map(function(n){return n.toGeoJSON()})}},t.delete=function(n){return e.store.delete(n,{silent:!0}),t.getMode()!==k.DIRECT_SELECT||e.store.getSelectedIds().length?e.store.render():e.events.changeMode(k.SIMPLE_SELECT,void 0,{silent:!0}),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:!0}),t.getMode()===k.DIRECT_SELECT?e.events.changeMode(k.SIMPLE_SELECT,void 0,{silent:!0}):e.store.render(),t},t.changeMode=function(n,o){return o===void 0&&(o={}),n===k.SIMPLE_SELECT&&t.getMode()===k.SIMPLE_SELECT?(s=o.featureIds||[],r=e.store.getSelectedIds(),s.length===r.length&&JSON.stringify(s.map(function(a){return a}).sort())===JSON.stringify(r.map(function(a){return a}).sort())||(e.store.setSelected(o.featureIds,{silent:!0}),e.store.render()),t):(n===k.DIRECT_SELECT&&t.getMode()===k.DIRECT_SELECT&&o.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(n,o,{silent:!0}),t);var s,r},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:!0}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:!0}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:!0}),t},t.setFeatureProperty=function(n,o,s){return e.store.setFeatureProperty(n,o,s),t},t}var Sr=function(e,t){var n={options:e=function(s){s===void 0&&(s={});var r=Ie(s);return s.controls||(r.controls={}),s.displayControlsDefault===!1?r.controls=Ie(vr,s.controls):r.controls=Ie(mr,s.controls),(r=Ie(yr,r)).styles=oo(r.styles,"cold").concat(oo(r.styles,"hot")),r}(e)};t=wr(n,t),n.api=t;var o=cr(n);return t.onAdd=o.onAdd,t.onRemove=o.onRemove,t.types=ne,t.options=e,t};function ro(e){Sr(e,this)}return ro.modes=no,ro})})(Jr);let $;const Po=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Po.decode();let zt=new Uint8Array;function yt(){return zt.byteLength===0&&(zt=new Uint8Array($.memory.buffer)),zt}function mt(f,u){return Po.decode(yt().subarray(f,f+u))}const Se=new Array(32).fill(void 0);Se.push(void 0,null,!0,!1);let vt=Se.length;function Io(f){vt===Se.length&&Se.push(Se.length+1);const u=vt;return vt=Se[u],Se[u]=f,u}function jn(f){return Se[f]}function Vr(f){f<36||(Se[f]=vt,vt=f)}function Fo(f){const u=jn(f);return Vr(f),u}let _t=0;function zr(f,u){const h=u(f.length*1);return yt().set(f,h/1),_t=f.length,h}let Wt=new Int32Array;function we(){return Wt.byteLength===0&&(Wt=new Int32Array($.memory.buffer)),Wt}const qt=new TextEncoder("utf-8"),Wr=typeof qt.encodeInto=="function"?function(f,u){return qt.encodeInto(f,u)}:function(f,u){const h=qt.encode(f);return u.set(h),{read:f.length,written:h.length}};function qr(f,u,h){if(h===void 0){const O=qt.encode(f),Y=u(O.length);return yt().subarray(Y,Y+O.length).set(O),_t=O.length,Y}let v=f.length,E=u(v);const L=yt();let M=0;for(;M<v;M++){const O=f.charCodeAt(M);if(O>127)break;L[E+M]=O}if(M!==v){M!==0&&(f=f.slice(M)),E=h(E,v,v=M+f.length*3);const O=yt().subarray(E+M,E+v),Y=Wr(f,O);M+=Y.written}return _t=M,E}class Ht{static __wrap(u){const h=Object.create(Ht.prototype);return h.ptr=u,h}__destroy_into_raw(){const u=this.ptr;return this.ptr=0,u}free(){const u=this.__destroy_into_raw();$.__wbg_jsroutesnapper_free(u)}constructor(u){try{const L=$.__wbindgen_add_to_stack_pointer(-16),M=zr(u,$.__wbindgen_malloc),O=_t;$.jsroutesnapper_new(L,M,O);var h=we()[L/4+0],v=we()[L/4+1],E=we()[L/4+2];if(E)throw Fo(v);return Ht.__wrap(h)}finally{$.__wbindgen_add_to_stack_pointer(16)}}toFinalFeature(){try{const v=$.__wbindgen_add_to_stack_pointer(-16);$.jsroutesnapper_toFinalFeature(v,this.ptr);var u=we()[v/4+0],h=we()[v/4+1];let E;return u!==0&&(E=mt(u,h).slice(),$.__wbindgen_free(u,h*1)),E}finally{$.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const v=$.__wbindgen_add_to_stack_pointer(-16);$.jsroutesnapper_renderGeojson(v,this.ptr);var u=we()[v/4+0],h=we()[v/4+1];return mt(u,h)}finally{$.__wbindgen_add_to_stack_pointer(16),$.__wbindgen_free(u,h)}}setSnapMode(u){$.jsroutesnapper_setSnapMode(this.ptr,u)}onMouseMove(u,h,v){return $.jsroutesnapper_onMouseMove(this.ptr,u,h,v)!==0}onClick(){$.jsroutesnapper_onClick(this.ptr)}onDragStart(){return $.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return $.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){$.jsroutesnapper_clearState(this.ptr)}}async function Hr(f,u){if(typeof Response=="function"&&f instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(f,u)}catch(v){if(f.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",v);else throw v}const h=await f.arrayBuffer();return await WebAssembly.instantiate(h,u)}else{const h=await WebAssembly.instantiate(f,u);return h instanceof WebAssembly.Instance?{instance:h,module:f}:h}}function Yr(){const f={};return f.wbg={},f.wbg.__wbindgen_string_new=function(u,h){const v=mt(u,h);return Io(v)},f.wbg.__wbindgen_object_drop_ref=function(u){Fo(u)},f.wbg.__wbg_log_4b5638ad60bdc54a=function(u){console.log(jn(u))},f.wbg.__wbg_new_abda76e883ba8a5f=function(){const u=new Error;return Io(u)},f.wbg.__wbg_stack_658279fe44541cf6=function(u,h){const v=jn(h).stack,E=qr(v,$.__wbindgen_malloc,$.__wbindgen_realloc),L=_t;we()[u/4+1]=L,we()[u/4+0]=E},f.wbg.__wbg_error_f851667af71bcfc6=function(u,h){try{console.error(mt(u,h))}finally{$.__wbindgen_free(u,h)}},f.wbg.__wbindgen_throw=function(u,h){throw new Error(mt(u,h))},f}function Zr(f,u){return $=f.exports,ko.__wbindgen_wasm_module=u,Wt=new Int32Array,zt=new Uint8Array,$}async function ko(f){typeof f>"u"&&(f="/atip/assets/route_snapper_bg.wasm");const u=Yr();(typeof f=="string"||typeof Request=="function"&&f instanceof Request||typeof URL=="function"&&f instanceof URL)&&(f=fetch(f));const{instance:h,module:v}=await Hr(await f,u);return Zr(h,v)}var wt,On,en,To,St,An,De,rt;class Kr{constructor(u,h,v){_e(this,wt);_e(this,en);_e(this,St);_e(this,De);this.controlDiv=v,this.map=u,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Ht(h),console.timeEnd("Deserialize and setup JsRouteSnapper"),console.log("JsRouteSnapper ready, waiting for idle event"),this.active=!1,this.map.once("idle",()=>{console.log("JsRouteSnapper now usable"),this.map.addSource("route-snapper",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"route-points",type:"circle",source:"route-snapper",paint:{"circle-radius":10,"circle-color":["match",["get","type"],"hovered","green","important","red","black"],"circle-opacity":["match",["get","type"],"unimportant",0,1],"circle-stroke-width":["match",["get","type"],"unimportant",2,0],"circle-stroke-color":"black"},filter:["in","$type","Point"]}),this.map.addLayer({id:"route-lines",type:"line",source:"route-snapper",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":2.5},filter:["in","$type","LineString"]}),this.map.on("mousemove",L=>{if(!this.active)return;const M={x:L.point.x-10,y:L.point.y},O=this.map.unproject(L.point).distanceTo(this.map.unproject(M));this.inner.onMouseMove(L.lngLat.lng,L.lngLat.lat,O)&&H(this,De,rt).call(this)}),this.map.on("click",()=>{this.active&&(this.inner.onClick(),H(this,De,rt).call(this))}),this.map.on("dragstart",L=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}),this.map.on("mouseup",L=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}),document.addEventListener("keypress",L=>{this.active&&L.key=="Enter"&&(L.preventDefault(),H(this,St,An).call(this))}),document.addEventListener("keydown",L=>{this.active&&L.key=="Shift"&&(L.preventDefault(),this.inner.setSnapMode(!1),H(this,De,rt).call(this))}),document.addEventListener("keyup",L=>{this.active&&L.key=="Shift"&&(L.preventDefault(),this.inner.setSnapMode(!0),H(this,De,rt).call(this))}),H(this,wt,On).call(this)})}}wt=new WeakSet,On=function(){this.active=!1,this.inner.clearState(),H(this,De,rt).call(this),this.controlDiv.innerHTML="";var u=document.createElement("button");u.innerText="Route tool",u.type="button",u.onclick=()=>{H(this,en,To).call(this)},this.controlDiv.appendChild(u)},en=new WeakSet,To=function(){this.active=!0,this.controlDiv.innerHTML="";var u=document.createElement("button");u.type="button",u.innerText="Finish route",u.onclick=()=>{H(this,St,An).call(this)},this.controlDiv.appendChild(u);const h=document.createElement("ul");h.innerHTML="<li><b>Click</b> green points on the transport network</br>to create snapped routes</li><li>Hold <b>Shift</b> to draw a point anywhere</li><li><b>Click and drag</b> any point to move it</li><li><b>Click</b> a red waypoint to delete it</li><li>Press <b>Enter</b> to finish route</li>",this.controlDiv.appendChild(h)},St=new WeakSet,An=function(){const u=this.inner.toFinalFeature();u&&this.controlDiv.dispatchEvent(new CustomEvent("new-route",{detail:JSON.parse(u)})),H(this,wt,On).call(this)},De=new WeakSet,rt=function(){this.map.getSource("route-snapper").setData(JSON.parse(this.inner.renderGeojson()))};async function Xr(f,u){const h=await fetch(f),v=h.body.getReader(),E=h.headers.get("Content-Length"),L=document.getElementById(u);let M=0,O=[];for(;;){const{done:xe,value:se}=await v.read();if(xe)break;O.push(se),M+=se.length;const Ne=100*M/E;L.style=`background: linear-gradient(to right, red ${Ne}%, transparent 0);`}let Y=new Uint8Array(M),re=0;for(let xe of O)Y.set(xe,re),re+=xe.length;return Y}function Qr(f,u,h,v){var E='<div style="display: flex; justify-content: space-between;">';for(const L of v){const M=f[h]==L?"checked":"";E+=`<input type="radio" id="${L}" name="${u}" ${M}>`;const O=L.charAt(0).toUpperCase()+L.slice(1);E+=`<label for="${L}">${O}</label>`}return E+="</div>",E}const ei=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],Vt="black",Fn="yellow",kn="red",Yt=7,Zt=10,ti={"line-cap":"round","line-join":"round"},Kt=["==","$type","Polygon"],Dn=["==","$type","LineString"],Xt=["==","$type","Point"];function bt(f,u,h=1){return{type:"line",layout:ti,paint:{"line-color":f,"line-width":u,"line-opacity":h}}}function Nn(f,u){return{type:"fill",paint:{"fill-color":f,"fill-opacity":u}}}function Qt(f,u,h=1){return{type:"circle",paint:{"circle-radius":u,"circle-color":f,"circle-opacity":h}}}const ni=[{id:"boundary",source:"boundary",...bt("black",3,.5)},{id:"hover-polygons",source:"hover",filter:Kt,...Nn(Fn,.5)},{id:"hover-lines",source:"hover",filter:Dn,...bt(Fn,1.5*Zt,1)},{id:"hover-points",source:"hover",filter:Xt,...Qt(Fn,1.5*Yt,.5)},{id:"editing-polygons",source:"editing",filter:Kt,...Nn(kn,.5)},{id:"editing-lines",source:"editing",filter:Dn,...bt(kn,1.5*Zt)},{id:"editing-points",source:"editing",filter:Xt,...Qt(kn,1.5*Yt)}],oi=ei.concat([{id:"base-points",filter:["all",Xt,["==","meta","feature"]],...Qt(Vt,Yt)},{id:"draggable-points",filter:["all",Xt,["!=","meta","feature"]],...Qt("blue",1.5*Yt)},{id:"base-line",filter:Dn,...bt(Vt,Zt)},{id:"base-polygon-fill",filter:Kt,...Nn(Vt,.1)},{id:"base-polygon-outline",filter:Kt,...bt(Vt,Zt/2)}]);var tn,jo,xt,$n,nn,Oo,Ct,Bn;class ri{constructor(){_e(this,tn);_e(this,xt);_e(this,nn);_e(this,Ct);const u=new URLSearchParams(window.location.search);this.authority=u.get("authority"),this.currentFilename=`${this.authority}.geojson`,document.getElementById("authority").innerText=this.authority;const h=!window.location.hash;this.map=new Pn.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL",hash:!0}),this.drawControls=new Tn({displayControlsDefault:!1,controls:{point:!0,polygon:!0},styles:oi}),this.currentlyEditing=null,H(this,nn,Oo).call(this,h),document.getElementById("export").onclick=()=>{const v=this.toGeojson();var E=this.authority;v.scheme_name&&(E+="_"+v.scheme_name),E+=".geojson",ii(E,JSON.stringify(v))},document.getElementById("load_geojson").onchange=v=>{H(this,tn,jo).call(this,v)}}toGeojson(){var u=this.drawControls.getAll();return u.scheme_name=document.getElementById("scheme_name").value||"",u.authority=this.authority,u}saveToLocalStorage(){window.localStorage.setItem(this.currentFilename,JSON.stringify(this.toGeojson()))}openForm(u){const h=u.id;this.currentlyEditing=h,document.getElementById(`accordian-btn-${h}`).classList.add("active-accordian");const v=document.getElementById(`accordian-contents-${h}`);v.style.maxHeight=v.scrollHeight+"px",this.map.getSource("editing").setData({type:"FeatureCollection",features:[u]}),this.map.getSource("hover").setData(Ae())}closeForm(){const u=this.currentlyEditing;u&&(document.getElementById(`accordian-btn-${u}`).classList.remove("active-accordian"),document.getElementById(`accordian-contents-${u}`).style.maxHeight=null),this.currentlyEditing=null,this.map.getSource("editing").setData(Ae())}updateSidebar(){const u=document.getElementById("intervention_list");u.innerHTML="";const h=document.createElement("div"),v=document.createElement("span");v.innerText=`${this.drawControls.getAll().features.length} interventions`,h.appendChild(v);const E=document.createElement("button");E.className="underlined-button",E.innerText="Clear all",E.onclick=()=>{confirm("Do you want to clear the current scheme? (You should save it first!)")&&(this.drawControls.set(Ae()),this.saveToLocalStorage(),this.updateSidebar(),document.getElementById("scheme_name").value="",this.map.getSource("hover").setData(Ae()),this.map.getSource("editing").setData(Ae()))},E.className="align-right",h.appendChild(E),u.appendChild(h),u.appendChild(document.createElement("br"));var L=1;for(const M of this.drawControls.getAll().features){M.properties;const O=document.createElement("button");O.id=`accordian-btn-${M.id}`,O.className="accordian",O.innerText=`${L}) ${Lo(M)}`,O.onmouseover=()=>{this.map.getSource("hover").setData({type:"FeatureCollection",features:[M]})},O.onmouseout=()=>{this.map.getSource("hover").setData(Ae())},O.onclick=()=>{this.currentlyEditing==M.id?this.closeForm():(this.closeForm(),this.openForm(M),M.geometry.type=="Point"?this.map.flyTo({center:M.geometry.coordinates}):this.map.fitBounds(Mo(M),{padding:200,animate:!0,duration:500}),M.geometry.type!="Point"&&this.drawControls.changeMode("direct_select",{featureId:M.id}))},u.appendChild(O);const Y=document.createElement("div");Y.id=`accordian-contents-${M.id}`,Y.className="accordian-contents",u.appendChild(Y),si(Y,M);const re=M.id;for(const se of["intervention_name","intervention_description"]){const Ne=document.getElementById(`${se}-${re}`);Ne.oninput=()=>{this.drawControls.setFeatureProperty(re,se,Ne.value),this.saveToLocalStorage(),se=="intervention_name"&&(M.properties.intervention_name=Ne.value,O.innerText=`${L}) ${Lo(M)}`)}}const xe=document.querySelectorAll(`input[name="intervention_type-${re}"]`);for(const se of xe)se.onchange=()=>{this.drawControls.setFeatureProperty(re,"intervention_type",se.id),this.saveToLocalStorage()};document.getElementById(`save-${re}`).onclick=()=>{this.closeForm(),this.drawControls.changeMode("simple_select")},document.getElementById(`delete-${re}`).onclick=()=>{this.drawControls.delete(re),this.closeForm(),this.updateSidebar(),this.saveToLocalStorage()},L+=1}}}tn=new WeakSet,jo=function(u){const h=new FileReader;h.onload=v=>{try{H(this,xt,$n).call(this,v.target.result),this.saveToLocalStorage()}catch(E){console.log(`Couldn't load from a file: ${E}`),window.alert(`Couldn't load scheme from a file: ${E}`)}},h.readAsText(u.target.files[0])},xt=new WeakSet,$n=function(u){const h=JSON.parse(u);this.drawControls.set(h),this.updateSidebar();const v=document.getElementById("scheme_name");v.value=h.scheme_name||"",v.oninput=()=>{this.saveToLocalStorage()}},nn=new WeakSet,Oo=function(u){this.map.on("load",async()=>{const h=await ai(this.authority);u&&this.map.fitBounds(Mo(h),{padding:20,animate:!1}),this.map.addSource("boundary",{type:"geojson",data:h}),this.map.addSource("hover",{type:"geojson",data:Ae()}),this.map.addSource("editing",{type:"geojson",data:Ae()});for(const E of ni)this.map.addLayer(E);this.map.addControl(this.drawControls),this.map.addControl(new Pn.ScaleControl),this.map.addControl(new Pn.NavigationControl,"bottom-right");const v=window.localStorage.getItem(this.currentFilename);v&&H(this,xt,$n).call(this,v),this.map.on("draw.selectionchange",E=>{if(E.features.length===1){const M=E.features[0];if(M.properties.intervention_type===void 0){var L="other";M.geometry.type=="Polygon"&&(L="area"),this.drawControls.setFeatureProperty(M.id,"intervention_type",L),M.properties.intervention_type=L}this.saveToLocalStorage(),this.updateSidebar(),this.openForm(M)}else this.closeForm()}),this.map.on("draw.update",E=>{this.map.getSource("editing").setData({type:"FeatureCollection",features:[E.features[0]]})}),this.previousHoverEntry=null,this.map.on("mousemove",E=>{var L=null;if(this.currentlyEditing===null){const M=this.drawControls.getFeatureIdsAt(E.point);M.length>0&&(L=M[0])}H(this,Ct,Bn).call(this,L)}),this.map.on("mouseout",()=>{H(this,Ct,Bn).call(this,null)}),this.routeSnapper=await ci(this)}),document.addEventListener("keydown",h=>{h.key=="Delete"&&this.currentlyEditing!=null&&(this.drawControls.delete(this.currentlyEditing),this.closeForm(),this.updateSidebar(),this.saveToLocalStorage())})},Ct=new WeakSet,Bn=function(u){u!=this.previousHoverEntry&&(this.previousHoverEntry&&this.previousHoverEntry!=this.currentlyEditing&&document.getElementById(`accordian-btn-${this.previousHoverEntry}`).classList.remove("active-accordian"),u&&document.getElementById(`accordian-btn-${u}`).classList.add("active-accordian"),this.previousHoverEntry=u)};function ii(f,u){var h=document.createElement("a");h.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(u)),h.setAttribute("download",f),document.body.appendChild(h),h.click(),document.body.removeChild(h)}async function ai(f){const h=await(await fetch(Gr)).text(),v=JSON.parse(h);return v.features=v.features.filter(E=>E.properties.name==f),v}function Ae(){return{type:"FeatureCollection",features:[]}}function si(f,u){const h=u.properties,v=u.id;f.innerHTML=`
  <br/>

  <div>
    <label for="intervention_name-${v}">Name</label><br/>
    <input type="text" id="intervention_name-${v}" size="30">
  </div>

  <br/>

  ${Qr(h,"intervention_type-"+v,"intervention_type",["area","route","crossing","other"])}

  <br/>

  <div>
    <label for="intervention_description-${v}">Description</label><br/>
	  <textarea id="intervention_description-${v}" rows="3" cols="40"></textarea>
  </div>

  <br/>

  <div>
    <button type="button" id="delete-${v}">Delete</button>
    <button type="button" id="save-${v}" class="align-right">Save</button>
  </div>

  <br/>
  `,h.intervention_name&&(document.getElementById(`intervention_name-${v}`).value=h.intervention_name),h.intervention_description&&(document.getElementById(`intervention_description-${v}`).innerText=h.intervention_description)}async function ci(f){await ko();const u=`https://play.abstreet.org/route-snappers/${f.authority}.bin`;console.log(`Grabbing ${u}`);try{const h=await Xr(u,"snap-progress");window.routeSnapper=new Kr(f.map,h,document.getElementById("snap-tool"))}catch(h){console.log(`Route tool broke: ${h}`),document.getElementById("snap-tool").innerHTML="Failed to load"}document.getElementById("snap-tool").addEventListener("new-route",h=>{const v=h.detail,E=f.drawControls.add(v);v.id=E[0],v.properties.intervention_type="route",f.drawControls.setFeatureProperty(v.id,"intervention_type","route"),f.updateSidebar(),f.openForm(v),f.saveToLocalStorage(),f.drawControls.changeMode("direct_select",{featureId:v.id})})}function Lo(f){if(f.properties.intervention_name)return f.properties.intervention_name;var u=f.properties.intervention_type;return u=="other"&&(f.geometry.type=="Point"?u="point":f.geometry.type=="LineString"?u="line":u="polygon"),`Untitled ${u}`}window.app=new ri;
