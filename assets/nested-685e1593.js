var hi=Object.defineProperty;var di=(r,e,t)=>e in r?hi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var oe=(r,e,t)=>(di(r,typeof e!="symbol"?e+"":e,t),t);import{S as re,i as ie,s as ne,M as mi,b as ge,a as Be,d as W,m as V,k as De,n as P,o as F,q as K,e as S,c as L,g as y,x as U,p as w,y as Xe,f as T,z as Re,B as Te,C as _i,D as Bn,E as gn,F as Gt,G as At,H as Pt,I as Ft,J as Nt,K as Hn,h as E,l as q,L as gi,N as vi,O as ce,P as bi,w as Dn,Q as at,R as Pe,T as fn,t as H,U as Me,V as pe,j as Ae,r as Ie,W as ft,X as cn,Y as _t,Z as nt,_ as Zt,$ as $e,a0 as gt,a1 as Un,a2 as Xn,a3 as yi,a4 as wi,a5 as Ge,a6 as ki,a7 as Si,a8 as Ei,a9 as pn,aa as St,ab as hn,ac as Dt,ad as dn,ae as Sn,af as Mi,ag as yt,ah as qn,ai as ot,aj as wt,ak as Li,al as jn,am as Oi,an as Ri,ao as Ti,ap as Jn,aq as Qt,ar as Ci,as as Ai,at as Pi,A as Fi,u as Ni}from"./authorities-a0a05a66.js";function xi(r){let e,t,n,i,o,s,u,l,a,p,g,c,f;return{c(){e=S("p"),e.textContent="For each intervention:",t=L(),n=S("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=L(),o=S("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=L(),u=S("p"),u.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=L(),a=S("p"),a.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=L(),g=S("p"),g.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=L(),f=S("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(h,m){y(h,e,m),y(h,t,m),y(h,n,m),y(h,i,m),y(h,o,m),y(h,s,m),y(h,u,m),y(h,l,m),y(h,a,m),y(h,p,m),y(h,g,m),y(h,c,m),y(h,f,m)},p:U,d(h){h&&w(e),h&&w(t),h&&w(n),h&&w(i),h&&w(o),h&&w(s),h&&w(u),h&&w(l),h&&w(a),h&&w(p),h&&w(g),h&&w(c),h&&w(f)}}}function Ii(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[xi]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new mi({props:o}),ge.push(()=>Be(e,"open",i,r[0])),{c(){W(e.$$.fragment)},m(s,u){V(e,s,u),n=!0},p(s,[u]){const l={};u&4&&(l.$$scope={dirty:u,ctx:s}),!t&&u&1&&(t=!0,l.open=s[0],De(()=>t=!1)),e.$set(l)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){F(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function $i(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Bi extends re{constructor(e){super(),ie(this,e,$i,Ii,ne,{open:0})}}const ct=[];function Et(r,e=U){let t;const n=new Set;function i(u){if(ne(r,u)&&(r=u,t)){const l=!ct.length;for(const a of n)a[1](),ct.push(a,r);if(l){for(let a=0;a<ct.length;a+=2)ct[a][0](ct[a+1]);ct.length=0}}}function o(u){i(u(r))}function s(u,l=U){const a=[u,l];return n.add(a),n.size===1&&(t=e(i)||U),u(r),()=>{n.delete(a),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Je=Et(null),se=Et(Xe()),xe=Et(null),Qe=Et(null),en=Et(null),En=Et(null);function zt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Wn(r){se.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),xe.set(null),Qe.set(null),en.set(null)}function Vn(r){let e;const t=r[4].default,n=At(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Pt(n,t,i,i[3],e?Nt(t,i[3],o,null):Ft(i[3]),null)},i(i){e||(P(n,i),e=!0)},o(i){F(n,i),e=!1},d(i){n&&n.d(i)}}}function Di(r){let e,t,n=r[1]&&Vn(r);return{c(){e=S("div"),n&&n.c(),T(e,"class","map svelte-12dpf1u")},m(i,o){y(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&P(n,1)):(n=Vn(i),n.c(),P(n,1),n.m(e,null)):n&&(Re(),F(n,1,1,()=>{n=null}),Te())},i(i){t||(P(n),t=!0)},o(i){F(n),t=!1},d(i){i&&w(e),n&&n.d(),r[5](null)}}}function qi(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,u,l=!1;_i("setCamera",!window.location.hash),Bn(()=>{s=new gn.Map({container:u,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new gn.ScaleControl({})),s.addControl(new gn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Je.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(u)}),Gt(()=>{s.remove()});function a(p){ge[p?"unshift":"push"](()=>{u=p,t(0,u)})}return r.$$set=p=>{"style"in p&&t(2,o=p.style),"$$scope"in p&&t(3,i=p.$$scope)},[u,l,o,i,n,a]}class ji extends re{constructor(e){super(),ie(this,e,qi,Di,ne,{style:2})}}const Gi=r=>({}),Kn=r=>({}),zi=r=>({}),Zn=r=>({}),Yi=r=>({}),Qn=r=>({});function Hi(r){let e,t,n,i,o,s,u,l,a,p,g,c;const f=r[3].nav,h=At(f,r,r[2],Qn),m=r[3].sidebar,_=At(m,r,r[2],Zn),k=r[3].main,d=At(k,r,r[2],Kn);return{c(){e=S("aside"),t=S("div"),n=S("nav"),h&&h.c(),i=L(),_&&_.c(),o=L(),s=S("button"),s.textContent="→",l=L(),a=S("main"),d&&d.c(),T(n,"class","svelte-1u7vg8a"),T(t,"class","sidebar-content content-container svelte-1u7vg8a"),T(s,"type","button"),T(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),T(e,"class",u=Hn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),T(a,"class","svelte-1u7vg8a")},m(v,b){y(v,e,b),E(e,t),E(t,n),h&&h.m(n,null),E(t,i),_&&_.m(t,null),E(e,o),E(e,s),y(v,l,b),y(v,a,b),d&&d.m(a,null),p=!0,g||(c=q(s,"click",r[1]),g=!0)},p(v,[b]){h&&h.p&&(!p||b&4)&&Pt(h,f,v,v[2],p?Nt(f,v[2],b,Yi):Ft(v[2]),Qn),_&&_.p&&(!p||b&4)&&Pt(_,m,v,v[2],p?Nt(m,v[2],b,zi):Ft(v[2]),Zn),(!p||b&1&&u!==(u=Hn(v[0]?"":"collapsed")+" svelte-1u7vg8a"))&&T(e,"class",u),d&&d.p&&(!p||b&4)&&Pt(d,k,v,v[2],p?Nt(k,v[2],b,Gi):Ft(v[2]),Kn)},i(v){p||(P(h,v),P(_,v),P(d,v),p=!0)},o(v){F(h,v),F(_,v),F(d,v),p=!1},d(v){v&&w(e),h&&h.d(v),_&&_.d(v),v&&w(l),v&&w(a),d&&d.d(v),g=!1,c()}}}function Ui(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=u=>{"$$scope"in u&&t(2,i=u.$$scope)},[o,s,i,n]}class Xi extends re{constructor(e){super(),ie(this,e,Ui,Hi,ne,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Ji(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(p){return l([a,p])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(p){a=[6,p],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var lt=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Wi(r,e){return r>e?1:r<e?-1:0}function et(r,e,t){for(var n=new lt(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function vn(r,e,t,n){var i=new lt(r,e);if(t===null)return i.left=i.right=null,i;t=et(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function er(r,e,t){var n=null,i=null;if(e){e=et(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Vi(r,e,t){return e===null?r:(r===null||(e=et(r.key,e,t),e.left=r),e)}function Mn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Mn(r.left,o,!1,n,i),r.right&&Mn(r.right,o,!0,n,i)}}var Gn=function(){function r(e){e===void 0&&(e=Wi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=vn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new lt(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=et(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=et(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=et(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=et(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=et(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,u=this._root,l;o.length!==0||u;)if(u)o.push(u),u=u.left;else{if(u=o.pop(),l=s(u.key,t),l>0)break;if(s(u.key,e)>=0&&n.call(i,u))return this;u=u.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Zi(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Rn(e,t,0,i-1,o),this._root===null)this._root=Ln(e,t,0,i),this._size=i;else{var s=Qi(this.toList(),Ki(e,t),o);i=this._size+i,this._root=On({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Mn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=er(e,this._root,i),s=o.left,u=o.right;i(e,t)<0?u=vn(t,n,u,i):s=vn(t,n,s,i),this._root=Vi(s,u,i)},r.prototype.split=function(e){return er(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Ji(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Ln(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],u=e[o],l=new lt(s,u);return l.left=Ln(r,e,t,o),l.right=Ln(r,e,o+1,n),l}return null}function Ki(r,e){for(var t=new lt(null,null),n=t,i=0;i<r.length;i++)n=n.next=new lt(r[i],e[i]);return n.next=null,t.next}function Zi(r){for(var e=r,t=[],n=!1,i=new lt(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function On(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=On(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=On(r,i+1,t),s}return null}function Qi(r,e,t){for(var n=new lt(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Rn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,u=n+1;;){do s++;while(i(r[s],o)<0);do u--;while(i(r[u],o)>0);if(s>=u)break;var l=r[s];r[s]=r[u],r[u]=l,l=e[s],e[s]=e[u],e[u]=l}Rn(r,e,t,u,i),Rn(r,e,u+1,n,i)}}function qe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function tr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Ne(r,e,t){return e&&tr(r.prototype,e),t&&tr(r,t),r}var Tt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Tn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},rt=Number.EPSILON;rt===void 0&&(rt=Math.pow(2,-52));var eo=rt*rt,Cn=function(e,t){if(-rt<e&&e<rt&&-rt<t&&t<rt)return 0;var n=e-t;return n*n<eo*e*t?0:e<t?-1:1},to=function(){function r(){qe(this,r),this.reset()}return Ne(r,[{key:"reset",value:function(){this.xRounder=new nr,this.yRounder=new nr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),nr=function(){function r(){qe(this,r),this.tree=new Gn,this.round(0)}return Ne(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Cn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Cn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),qt=new to,xt=function(e,t){return e.x*t.y-e.y*t.x},Xr=function(e,t){return e.x*t.x+e.y*t.y},rr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=xt(i,o);return Cn(s,0)},tn=function(e){return Math.sqrt(Xr(e,e))},no=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return xt(o,i)/tn(o)/tn(i)},ro=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Xr(o,i)/tn(o)/tn(i)},ir=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},or=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},io=function(e,t,n,i){if(t.x===0)return or(n,i,e.x);if(i.x===0)return or(e,t,n.x);if(t.y===0)return ir(n,i,e.y);if(i.y===0)return ir(e,t,n.y);var o=xt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},u=xt(s,t)/o,l=xt(s,i)/o,a=e.x+l*t.x,p=n.x+u*i.x,g=e.y+l*t.y,c=n.y+u*i.y,f=(a+p)/2,h=(g+c)/2;return{x:f,y:h}},He=function(){Ne(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:nn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){qe(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Ne(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(u){var l=u.otherSE;i.set(u,{sine:no(n.point,t.point,l.point),cosine:ro(n.point,t.point,l.point)})};return function(s,u){i.has(s)||o(s),i.has(u)||o(u);var l=i.get(s),a=l.sine,p=l.cosine,g=i.get(u),c=g.sine,f=g.cosine;return a>=0&&c>=0?p<f?1:p>f?-1:0:a<0&&c<0?p<f?-1:p>f?1:0:c<a?-1:c>a?1:0}}}]),r}(),oo=0,nn=function(){Ne(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,u=n.rightSE.point.x;if(u<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,a=n.leftSE.point.y,p=t.rightSE.point.y,g=n.rightSE.point.y;if(i<o){if(a<l&&a<p)return 1;if(a>l&&a>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<a&&l<g)return-1;if(l>a&&l>g)return 1;var h=n.comparePoint(t.leftSE.point);if(h!==0)return h;var m=t.comparePoint(n.rightSE.point);return m<0?1:m>0?-1:1}if(l<a)return-1;if(l>a)return 1;if(s<u){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>u){var k=t.comparePoint(n.rightSE.point);if(k<0)return 1;if(k>0)return-1}if(s!==u){var d=p-l,v=s-i,b=g-a,O=u-o;if(d>v&&b<O)return 1;if(d<v&&b>O)return-1}return s>u?1:s<u||p<g?-1:p>g?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){qe(this,r),this.id=++oo,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Ne(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,u=n.x+s*o.x;if(t.x===u)return 0;var l=(t.x-n.x)/o.x,a=n.y+l*o.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Tn(n,i);if(o===null)return null;var s=this.leftSE.point,u=this.rightSE.point,l=t.leftSE.point,a=t.rightSE.point,p=Tt(n,l)&&this.comparePoint(l)===0,g=Tt(i,s)&&t.comparePoint(s)===0,c=Tt(n,a)&&this.comparePoint(a)===0,f=Tt(i,u)&&t.comparePoint(u)===0;if(g&&p)return f&&!c?u:!f&&c?a:null;if(g)return c&&s.x===a.x&&s.y===a.y?null:s;if(p)return f&&u.x===l.x&&u.y===l.y?null:l;if(f&&c)return null;if(f)return u;if(c)return a;var h=io(s,this.vector(),l,t.vector());return h===null||!Tt(o,h)?null:qt.round(h.x,h.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new He(t,!0),s=new He(t,!1),u=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,u,this.rings.slice(),this.windings.slice());return He.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),He.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var u=n;n=i,i=u}for(var l=0,a=i.rings.length;l<a;l++){var p=i.rings[l],g=i.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(g)):n.windings[c]+=g}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,u=this.rings.length;s<u;s++){var l=this.rings[s],a=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),i.push(a)):i[p]+=a}for(var g=[],c=[],f=0,h=n.length;f<h;f++)if(i[f]!==0){var m=n[f],_=m.poly;if(c.indexOf(_)===-1)if(m.isExterior)g.push(_);else{c.indexOf(_)===-1&&c.push(_);var k=g.indexOf(m.poly);k!==-1&&g.splice(k,1)}}for(var d=0,v=g.length;d<v;d++){var b=g[d].multiPoly;o.indexOf(b)===-1&&o.push(b)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(ze.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,u;t.length<n.length?(s=t.length,u=n.length):(s=n.length,u=t.length),this._isInResult=u===ze.numMultiPolys&&s<u;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var a=function(g){return g.length===1&&g[0].isSubject};this._isInResult=a(t)!==a(n);break}default:throw new Error("Unrecognized operation type found ".concat(ze.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,u,l=He.comparePoints(t,n);if(l<0)o=t,s=n,u=1;else if(l>0)o=n,s=t,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var a=new He(o,!0),p=new He(s,!1);return new r(a,p,[i],[u])}}]),r}(),sr=function(){function r(e,t,n){if(qe(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=qt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,u=e.length;s<u;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=qt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(nn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(nn.fromRing(o,i,this))}return Ne(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),so=function(){function r(e,t){if(qe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new sr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new sr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Ne(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),lr=function(){function r(e,t){if(qe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new so(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Ne(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),lo=function(){Ne(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var u=null,l=s.leftSE,a=s.rightSE,p=[l],g=l.point,c=[];u=l,l=a,p.push(l),l.point!==g;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var h=p[0].point,m=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(m.x,", ").concat(m.y,"]."))}if(f.length===1){a=f[0].otherSE;break}for(var _=null,k=0,d=c.length;k<d;k++)if(c[k].point===l.point){_=k;break}if(_!==null){var v=c.splice(_)[0],b=p.splice(v.index);b.unshift(b[0].otherSE),n.push(new r(b.reverse()));continue}c.push({index:p.length,point:l.point});var O=l.getLeftmostComparator(u);a=f.sort(O)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){qe(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Ne(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,u=this.events[i+1].point;rr(s,t,u)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],a=n[1];rr(l,t,a)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,g=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],h=g;h!=c;h+=p)f.push([n[h].x,n[h].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];He.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),u=s?s.prevInResult():null;;){if(!s)return null;if(!u)return s.ringOut;if(u.ringOut!==s.ringOut)return u.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=u.prevInResult(),u=s?s.prevInResult():null}}}]),r}(),ur=function(){function r(e){qe(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Ne(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),uo=function(){function r(e){qe(this,r),this.rings=e,this.polys=this._composePolys(e)}return Ne(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new ur(s));else{var u=s.enclosingRing();u.poly||n.push(new ur(u)),u.poly.addInterior(s)}}return n}}]),r}(),ao=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nn.compare;qe(this,r),this.queue=e,this.tree=new Gn(t),this.segments=[]}return Ne(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,u=o,l=void 0,a=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;a===void 0;)u=this.tree.next(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);if(t.isLeft){var p=null;if(l){var g=l.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(p=g),!l.isAnEndpoint(g)))for(var c=this._splitSafely(l,g),f=0,h=c.length;f<h;f++)i.push(c[f])}var m=null;if(a){var _=a.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(m=_),!a.isAnEndpoint(_)))for(var k=this._splitSafely(a,_),d=0,v=k.length;d<v;d++)i.push(k[d])}if(p!==null||m!==null){var b=null;if(p===null)b=m;else if(m===null)b=p;else{var O=He.comparePoints(p,m);b=O<=0?p:m}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var C=n.split(b),A=0,R=C.length;A<R;A++)i.push(C[A])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&a){var $=l.getIntersection(a);if($!==null){if(!l.isAnEndpoint($))for(var D=this._splitSafely(l,$),B=0,X=D.length;B<X;B++)i.push(D[B]);if(!a.isAnEndpoint($))for(var N=this._splitSafely(a,$),z=0,te=N.length;z<te;z++)i.push(N[z])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),ar=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,fo=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,co=function(){function r(){qe(this,r)}return Ne(r,[{key:"run",value:function(t,n,i){ze.type=t,qt.reset();for(var o=[new lr(n,!0)],s=0,u=i.length;s<u;s++)o.push(new lr(i[s],!1));if(ze.numMultiPolys=o.length,ze.type==="difference")for(var l=o[0],a=1;a<o.length;)Tn(o[a].bbox,l.bbox)!==null?a++:o.splice(a,1);if(ze.type==="intersection"){for(var p=0,g=o.length;p<g;p++)for(var c=o[p],f=p+1,h=o.length;f<h;f++)if(Tn(c.bbox,o[f].bbox)===null)return[]}for(var m=new Gn(He.compare),_=0,k=o.length;_<k;_++)for(var d=o[_].getSweepEvents(),v=0,b=d.length;v<b;v++)if(m.insert(d[v]),m.size>ar)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var O=new ao(m),C=m.size,A=m.pop();A;){var R=A.key;if(m.size===C){var $=R.segment;throw new Error("Unable to pop() ".concat(R.isLeft?"left":"right"," SweepEvent ")+"[".concat(R.point.x,", ").concat(R.point.y,"] from segment #").concat($.id," ")+"[".concat($.leftSE.point.x,", ").concat($.leftSE.point.y,"] -> ")+"[".concat($.rightSE.point.x,", ").concat($.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(m.size>ar)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(O.segments.length>fo)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var D=O.process(R),B=0,X=D.length;B<X;B++){var N=D[B];N.consumedBy===void 0&&m.insert(N)}C=m.size,A=m.pop()}qt.reset();var z=lo.factory(O.segments),te=new uo(z);return te.getGeom()}}]),r}(),ze=new co,po=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ze.run("union",e,n)},ho=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ze.run("intersection",e,n)},mo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ze.run("xor",e,n)},_o=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ze.run("difference",e,n)},Ut={union:po,intersection:ho,xor:mo,difference:_o};function go(r,e){var t=bo(e),n=null;return r.type==="FeatureCollection"?n=vo(r):n=Jr(Ut.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function vo(r){var e=r.features.length===2?Ut.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Ut.union.apply(Ut,r.features.map(function(t){return t.geometry.coordinates}));return Jr(e)}function Jr(r){return gi(r)}function bo(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return vi(t)}function yo(r,e,t){let n;ce(r,Je,s=>t(1,n=s));let{boundaryGeojson:i}=e;return bi("setCamera")&&n.fitBounds(Dn(i),{padding:20,animate:!1}),at(n,"boundary",{type:"geojson",data:go(i)}),Pe(n,{id:"boundary",source:"boundary",...fn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class wo extends re{constructor(e){super(),ie(this,e,yo,null,ne,{boundaryGeojson:0})}}function fr(r){let e,t=cr(r[3])+"",n;return{c(){e=H("Length: "),n=H(t)},m(i,o){y(i,e,o),y(i,n,o)},p(i,o){o&8&&t!==(t=cr(i[3])+"")&&ft(n,t)},d(i){i&&w(e),i&&w(n)}}}function ko(r){let e,t,n,i,o,s,u,l,a,p,g,c,f,h,m,_,k,d,v,b,O,C,A,R,$,D,B,X,N,z,te,he,j,le,we,Fe,de,ae,Le,ue=r[3]&&fr(r);return{c(){e=S("label"),t=H("Name:"),n=S("br"),i=L(),o=S("input"),s=L(),u=S("br"),l=L(),a=S("br"),p=L(),g=S("label"),c=S("input"),f=H(`
  Area`),h=L(),m=S("label"),_=S("input"),k=H(`
  Route`),d=L(),v=S("label"),b=S("input"),O=H(`
  Crossing`),C=L(),A=S("label"),R=S("input"),$=H(`
  Other`),D=L(),B=S("br"),X=L(),N=S("br"),z=L(),te=S("label"),he=H("Description:"),j=S("br"),le=L(),we=S("textarea"),Fe=L(),ue&&ue.c(),de=Me(),T(o,"type","text"),pe(o,"width","100%"),T(c,"type","radio"),c.__value="area",c.value=c.__value,r[6][0].push(c),T(_,"type","radio"),_.__value="route",_.value=_.__value,r[6][0].push(_),T(b,"type","radio"),b.__value="crossing",b.value=b.__value,r[6][0].push(b),T(R,"type","radio"),R.__value="other",R.value=R.__value,r[6][0].push(R),pe(we,"width","100%"),T(we,"rows","5"),T(we,"class","svelte-15lna0i")},m(x,Q){y(x,e,Q),E(e,t),E(e,n),E(e,i),E(e,o),Ae(o,r[0]),y(x,s,Q),y(x,u,Q),y(x,l,Q),y(x,a,Q),y(x,p,Q),y(x,g,Q),E(g,c),c.checked=c.__value===r[1],E(g,f),y(x,h,Q),y(x,m,Q),E(m,_),_.checked=_.__value===r[1],E(m,k),y(x,d,Q),y(x,v,Q),E(v,b),b.checked=b.__value===r[1],E(v,O),y(x,C,Q),y(x,A,Q),E(A,R),R.checked=R.__value===r[1],E(A,$),y(x,D,Q),y(x,B,Q),y(x,X,Q),y(x,N,Q),y(x,z,Q),y(x,te,Q),E(te,he),E(te,j),E(te,le),E(te,we),Ae(we,r[2]),y(x,Fe,Q),ue&&ue.m(x,Q),y(x,de,Q),ae||(Le=[q(o,"input",r[4]),q(c,"change",r[5]),q(_,"change",r[7]),q(b,"change",r[8]),q(R,"change",r[9]),q(we,"input",r[10])],ae=!0)},p(x,[Q]){Q&1&&o.value!==x[0]&&Ae(o,x[0]),Q&2&&(c.checked=c.__value===x[1]),Q&2&&(_.checked=_.__value===x[1]),Q&2&&(b.checked=b.__value===x[1]),Q&2&&(R.checked=R.__value===x[1]),Q&4&&Ae(we,x[2]),x[3]?ue?ue.p(x,Q):(ue=fr(x),ue.c(),ue.m(de.parentNode,de)):ue&&(ue.d(1),ue=null)},i:U,o:U,d(x){x&&w(e),x&&w(s),x&&w(u),x&&w(l),x&&w(a),x&&w(p),x&&w(g),r[6][0].splice(r[6][0].indexOf(c),1),x&&w(h),x&&w(m),r[6][0].splice(r[6][0].indexOf(_),1),x&&w(d),x&&w(v),r[6][0].splice(r[6][0].indexOf(b),1),x&&w(C),x&&w(A),r[6][0].splice(r[6][0].indexOf(R),1),x&&w(D),x&&w(B),x&&w(X),x&&w(N),x&&w(z),x&&w(te),x&&w(Fe),ue&&ue.d(x),x&&w(de),ae=!1,Ie(Le)}}}function cr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function So(r,e,t){let{name:n}=e,{intervention_type:i}=e,{description:o}=e,{length_meters:s}=e;const u=[[]];function l(){n=this.value,t(0,n)}function a(){i=this.__value,t(1,i)}function p(){i=this.__value,t(1,i)}function g(){i=this.__value,t(1,i)}function c(){i=this.__value,t(1,i)}function f(){o=this.value,t(2,o)}return r.$$set=h=>{"name"in h&&t(0,n=h.name),"intervention_type"in h&&t(1,i=h.intervention_type),"description"in h&&t(2,o=h.description),"length_meters"in h&&t(3,s=h.length_meters)},[n,i,o,s,l,a,u,p,g,c,f]}class Eo extends re{constructor(e){super(),ie(this,e,So,ko,ne,{name:0,intervention_type:1,description:2,length_meters:3})}}const Mo="Route",Lo=[{name:"name",type:"one-liner"},{name:"RouteType",oneOf:[{name:"OnRoad",members:[{name:"OnRoadType",oneOf:["FullSeparation","Stepped","PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}],Oo={name:Mo,members:Lo};function Ro(r){const e=r-1;return e*e*e+1}function rn(r,{delay:e=0,duration:t=400,easing:n=Ro}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),u=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),a=parseFloat(i.marginTop),p=parseFloat(i.marginBottom),g=parseFloat(i.borderTopWidth),c=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*u}px;padding-bottom: ${f*l}px;margin-top: ${f*a}px;margin-bottom: ${f*p}px;border-top-width: ${f*g}px;border-bottom-width: ${f*c}px;`}}function Wr(r){return"members"in r}function Vr(r){return"oneOf"in r}function To(r){return"type"in r&&r.type=="number"}function Kr(r){return"type"in r&&r.type=="one-liner"}function pr(r,e,t){const n=r.slice();return n[12]=e[t],n[15]=e,n[16]=t,n}function hr(r,e,t){const n=r.slice();return n[12]=e[t],n[13]=e,n[14]=t,n}function Co(r){let e,t,n;return{c(){e=S("input"),T(e,"type","text"),pe(e,"width","100%")},m(i,o){y(i,e,o),Ae(e,r[0]),t||(n=q(e,"input",r[11]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Ae(e,i[0])},i:U,o:U,d(i){i&&w(e),t=!1,n()}}}function Ao(r){let e,t,n;return{c(){e=S("input"),T(e,"type","number")},m(i,o){y(i,e,o),Ae(e,r[0]),t||(n=q(e,"input",r[10]),t=!0)},p(i,o){o&1&&cn(e.value)!==i[0]&&Ae(e,i[0])},i:U,o:U,d(i){i&&w(e),t=!1,n()}}}function Po(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=mr(pr(r,n,s));const o=s=>F(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=Me()},m(s,u){for(let l=0;l<i.length;l+=1)i[l].m(s,u);y(s,e,u),t=!0},p(s,u){if(u&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const a=pr(s,n,l);i[l]?(i[l].p(a,u),P(i[l],1)):(i[l]=mr(a),i[l].c(),P(i[l],1),i[l].m(e.parentNode,e))}for(Re(),l=n.length;l<i.length;l+=1)o(l);Te()}},i(s){if(!t){for(let u=0;u<n.length;u+=1)P(i[u]);t=!0}},o(s){i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)F(i[u]);t=!1},d(s){_t(i,s),s&&w(e)}}}function Fo(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=_r(hr(r,n,s));const o=s=>F(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=Me()},m(s,u){for(let l=0;l<i.length;l+=1)i[l].m(s,u);y(s,e,u),t=!0},p(s,u){if(u&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const a=hr(s,n,l);i[l]?(i[l].p(a,u),P(i[l],1)):(i[l]=_r(a),i[l].c(),P(i[l],1),i[l].m(e.parentNode,e))}for(Re(),l=n.length;l<i.length;l+=1)o(l);Te()}},i(s){if(!t){for(let u=0;u<n.length;u+=1)P(i[u]);t=!0}},o(s){i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)F(i[u]);t=!1},d(s){_t(i,s),s&&w(e)}}}function No(r){let e,t,n;return{c(){e=S("h1"),t=H("Error: Field component instantiated for plain string, why? "),n=H(r[1])},m(i,o){y(i,e,o),E(e,t),E(e,n)},p(i,o){o&2&&ft(n,i[1])},i:U,o:U,d(i){i&&w(e)}}}function xo(r){let e,t,n,i,o=r[12].name+"",s,u,l,a,p,g,c,f=r[2]==r[12].name&&typeof r[0]=="object"&&dr(r);return{c(){e=S("label"),t=S("input"),i=L(),s=H(o),u=S("br"),l=L(),f&&f.c(),a=Me(),T(t,"type","radio"),t.__value=n=r[12].name,t.value=t.__value,r[7][0].push(t)},m(h,m){y(h,e,m),E(e,t),t.checked=t.__value===r[2],E(e,i),E(e,s),E(e,u),y(h,l,m),f&&f.m(h,m),y(h,a,m),p=!0,g||(c=[q(t,"change",r[8]),q(t,"change",r[4])],g=!0)},p(h,m){(!p||m&2&&n!==(n=h[12].name))&&(t.__value=n,t.value=t.__value),m&4&&(t.checked=t.__value===h[2]),(!p||m&2)&&o!==(o=h[12].name+"")&&ft(s,o),h[2]==h[12].name&&typeof h[0]=="object"?f?(f.p(h,m),m&7&&P(f,1)):(f=dr(h),f.c(),P(f,1),f.m(a.parentNode,a)):f&&(Re(),F(f,1,1,()=>{f=null}),Te())},i(h){p||(P(f),p=!0)},o(h){F(f),p=!1},d(h){h&&w(e),r[7][0].splice(r[7][0].indexOf(t),1),h&&w(l),f&&f.d(h),h&&w(a),g=!1,Ie(c)}}}function Io(r){let e,t,n,i,o=r[12]+"",s,u,l,a,p;return{c(){e=S("label"),t=S("input"),i=L(),s=H(o),u=S("br"),l=L(),T(t,"type","radio"),t.__value=n=r[12],t.value=t.__value,r[7][0].push(t)},m(g,c){y(g,e,c),E(e,t),t.checked=t.__value===r[2],E(e,i),E(e,s),E(e,u),E(e,l),a||(p=[q(t,"change",r[6]),q(t,"change",r[3])],a=!0)},p(g,c){c&2&&n!==(n=g[12])&&(t.__value=n,t.value=t.__value),c&4&&(t.checked=t.__value===g[2]),c&2&&o!==(o=g[12]+"")&&ft(s,o)},i:U,o:U,d(g){g&&w(e),r[7][0].splice(r[7][0].indexOf(t),1),a=!1,Ie(p)}}}function dr(r){let e,t,n,i,o,s;function u(a){r[9](a,r[12])}let l={spec:r[12]};return r[0][r[12].name]!==void 0&&(l.value=r[0][r[12].name]),t=new zn({props:l}),ge.push(()=>Be(t,"value",u,r[0][r[12].name])),{c(){e=S("div"),W(t.$$.fragment),i=L(),T(e,"class","svelte-gt6imv")},m(a,p){y(a,e,p),V(t,e,null),E(e,i),s=!0},p(a,p){r=a;const g={};p&2&&(g.spec=r[12]),!n&&p&3&&(n=!0,g.value=r[0][r[12].name],De(()=>n=!1)),t.$set(g)},i(a){s||(P(t.$$.fragment,a),nt(()=>{o||(o=Zt(e,rn,{duration:500},!0)),o.run(1)}),s=!0)},o(a){F(t.$$.fragment,a),o||(o=Zt(e,rn,{duration:500},!1)),o.run(0),s=!1},d(a){a&&w(e),K(t),a&&o&&o.end()}}}function mr(r){let e,t,n,i;const o=[Io,xo],s=[];function u(l,a){return typeof l[12]=="string"?0:1}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=Me()},m(l,a){s[e].m(l,a),y(l,n,a),i=!0},p(l,a){let p=e;e=u(l),e===p?s[e].p(l,a):(Re(),F(s[p],1,1,()=>{s[p]=null}),Te(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),P(t,1),t.m(n.parentNode,n))},i(l){i||(P(t),i=!0)},o(l){F(t),i=!1},d(l){s[e].d(l),l&&w(n)}}}function _r(r){let e,t,n=r[12].name+"",i,o,s,u,l,a;function p(c){r[5](c,r[12])}let g={spec:r[12]};return r[0][r[12].name]!==void 0&&(g.value=r[0][r[12].name]),s=new zn({props:g}),ge.push(()=>Be(s,"value",p,r[0][r[12].name])),{c(){e=S("div"),t=S("h3"),i=H(n),o=L(),W(s.$$.fragment),l=L(),T(e,"class","svelte-gt6imv")},m(c,f){y(c,e,f),E(e,t),E(t,i),E(e,o),V(s,e,null),E(e,l),a=!0},p(c,f){r=c,(!a||f&2)&&n!==(n=r[12].name+"")&&ft(i,n);const h={};f&2&&(h.spec=r[12]),!u&&f&3&&(u=!0,h.value=r[0][r[12].name],De(()=>u=!1)),s.$set(h)},i(c){a||(P(s.$$.fragment,c),a=!0)},o(c){F(s.$$.fragment,c),a=!1},d(c){c&&w(e),K(s)}}}function $o(r){let e,t,n,i,o,s,u,l;const a=[No,Fo,Po,Ao,Co],p=[];function g(c,f){return f&2&&(e=null),f&2&&(t=null),f&2&&(n=null),f&2&&(i=null),typeof c[1]=="string"?0:(e==null&&(e=!!Wr(c[1])),e?1:(t==null&&(t=!!Vr(c[1])),t?2:(n==null&&(n=!!To(c[1])),n?3:(i==null&&(i=!!Kr(c[1])),i?4:-1))))}return~(o=g(r,-1))&&(s=p[o]=a[o](r)),{c(){s&&s.c(),u=Me()},m(c,f){~o&&p[o].m(c,f),y(c,u,f),l=!0},p(c,[f]){let h=o;o=g(c,f),o===h?~o&&p[o].p(c,f):(s&&(Re(),F(p[h],1,1,()=>{p[h]=null}),Te()),~o?(s=p[o],s?s.p(c,f):(s=p[o]=a[o](c),s.c()),P(s,1),s.m(u.parentNode,u)):s=null)},i(c){l||(P(s),l=!0)},o(c){F(s),l=!1},d(c){~o&&p[o].d(c),c&&w(u)}}}function Bo(r,e,t){var m,_;let{spec:n}=e,{value:i}=e,o="";if(Wr(n)){i||(i={});for(let k of n.members)Kr(k)?i[m=k.name]||(i[m]=""):i[_=k.name]||(i[_]={})}else Vr(n)&&(i||(i={}),o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function u(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function a(k,d){r.$$.not_equal(i[d.name],k)&&(i[d.name]=k,t(0,i))}function p(){o=this.__value,t(2,o)}function g(){o=this.__value,t(2,o)}function c(k,d){r.$$.not_equal(i[d.name],k)&&(i[d.name]=k,t(0,i))}function f(){i=cn(this.value),t(0,i)}function h(){i=this.value,t(0,i)}return r.$$set=k=>{"spec"in k&&t(1,n=k.spec),"value"in k&&t(0,i=k.value)},[i,n,o,s,u,a,p,l,g,c,f,h]}class zn extends re{constructor(e){super(),ie(this,e,Bo,$o,ne,{spec:1,value:0})}}function Do(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new zn({props:o}),ge.push(()=>Be(e,"value",i,r[0].v2)),{c(){W(e.$$.fragment)},m(s,u){V(e,s,u),n=!0},p(s,[u]){const l={};!t&&u&1&&(t=!0,l.value=s[0].v2,De(()=>t=!1)),e.$set(l)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){F(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function qo(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=Oo;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class jo extends re{constructor(e){super(),ie(this,e,qo,Do,ne,{props:0})}}function gr(r,e,t){const n=r.slice();return n[12]=e[t],n}function vr(r,e,t){const n=r.slice();return n[12]=e[t],n}function br(r,e,t){const n=r.slice();return n[12]=e[t],n}function yr(r,e,t){const n=r.slice();return n[12]=e[t],n}function wr(r){let e,t=r[12]+"",n;return{c(){e=S("option"),n=H(t),e.__value=r[12],e.value=e.__value},m(i,o){y(i,e,o),E(e,n)},p:U,d(i){i&&w(e)}}}function kr(r){let e,t=r[12]+"",n;return{c(){e=S("option"),n=H(t),e.__value=r[12],e.value=e.__value},m(i,o){y(i,e,o),E(e,n)},p:U,d(i){i&&w(e)}}}function Sr(r){let e,t=r[12]+"",n;return{c(){e=S("option"),n=H(t),e.__value=r[12],e.value=e.__value},m(i,o){y(i,e,o),E(e,n)},p:U,d(i){i&&w(e)}}}function Er(r){let e,t=r[12]+"",n;return{c(){e=S("option"),n=H(t),e.__value=r[12],e.value=e.__value},m(i,o){y(i,e,o),E(e,n)},p:U,d(i){i&&w(e)}}}function Go(r){let e,t,n,i,o,s,u,l,a,p,g,c,f,h,m,_,k,d,v,b,O,C,A,R,$,D,B,X,N,z,te,he,j,le,we,Fe,de,ae,Le,ue,x,Q,Mt,me,ke,Lt,ut,ve,fe,Ot,Rt,be=r[1],Ce=[];for(let M=0;M<be.length;M+=1)Ce[M]=wr(yr(r,be,M));let G=r[2],ee=[];for(let M=0;M<G.length;M+=1)ee[M]=kr(br(r,G,M));let We=r[3],Oe=[];for(let M=0;M<We.length;M+=1)Oe[M]=Sr(vr(r,We,M));let Ve=r[4],ye=[];for(let M=0;M<Ve.length;M+=1)ye[M]=Er(gr(r,Ve,M));return{c(){e=S("label"),t=H("Name:"),n=S("br"),i=L(),o=S("input"),s=L(),u=S("br"),l=L(),a=S("br"),p=L(),g=S("label"),c=H(`Reference type:
  `),f=S("select");for(let M=0;M<Ce.length;M+=1)Ce[M].c();h=L(),m=S("br"),_=L(),k=S("br"),d=L(),v=S("label"),b=H("Notes:"),O=S("br"),C=L(),A=S("textarea"),R=L(),$=S("br"),D=L(),B=S("br"),X=L(),N=S("label"),z=H(`Size:
  `),te=S("input"),he=L(),j=S("select");for(let M=0;M<ee.length;M+=1)ee[M].c();le=L(),we=S("br"),Fe=L(),de=S("br"),ae=L(),Le=S("label"),ue=H(`ATE Triage:
  `),x=S("select");for(let M=0;M<Oe.length;M+=1)Oe[M].c();Q=L(),Mt=S("br"),me=L(),ke=S("br"),Lt=L(),ut=S("label"),ve=H(`ATE Recommendation:
  `),fe=S("select");for(let M=0;M<ye.length;M+=1)ye[M].c();T(o,"type","text"),pe(o,"width","100%"),r[0].planning.reference_type===void 0&&nt(()=>r[6].call(f)),pe(A,"width","100%"),T(A,"rows","5"),T(A,"class","svelte-15lna0i"),T(te,"type","number"),T(te,"min","0"),T(te,"max","1000"),r[0].planning.size_units===void 0&&nt(()=>r[9].call(j)),r[0].planning.triage===void 0&&nt(()=>r[10].call(x)),r[0].planning.recommendation===void 0&&nt(()=>r[11].call(fe))},m(M,Y){y(M,e,Y),E(e,t),E(e,n),E(e,i),E(e,o),Ae(o,r[0].planning.name),y(M,s,Y),y(M,u,Y),y(M,l,Y),y(M,a,Y),y(M,p,Y),y(M,g,Y),E(g,c),E(g,f);for(let I=0;I<Ce.length;I+=1)Ce[I].m(f,null);$e(f,r[0].planning.reference_type),y(M,h,Y),y(M,m,Y),y(M,_,Y),y(M,k,Y),y(M,d,Y),y(M,v,Y),E(v,b),E(v,O),E(v,C),E(v,A),Ae(A,r[0].planning.notes),y(M,R,Y),y(M,$,Y),y(M,D,Y),y(M,B,Y),y(M,X,Y),y(M,N,Y),E(N,z),E(N,te),Ae(te,r[0].planning.size),E(N,he),E(N,j);for(let I=0;I<ee.length;I+=1)ee[I].m(j,null);$e(j,r[0].planning.size_units),y(M,le,Y),y(M,we,Y),y(M,Fe,Y),y(M,de,Y),y(M,ae,Y),y(M,Le,Y),E(Le,ue),E(Le,x);for(let I=0;I<Oe.length;I+=1)Oe[I].m(x,null);$e(x,r[0].planning.triage),y(M,Q,Y),y(M,Mt,Y),y(M,me,Y),y(M,ke,Y),y(M,Lt,Y),y(M,ut,Y),E(ut,ve),E(ut,fe);for(let I=0;I<ye.length;I+=1)ye[I].m(fe,null);$e(fe,r[0].planning.recommendation),Ot||(Rt=[q(o,"input",r[5]),q(f,"change",r[6]),q(A,"input",r[7]),q(te,"input",r[8]),q(j,"change",r[9]),q(x,"change",r[10]),q(fe,"change",r[11])],Ot=!0)},p(M,[Y]){if(Y&3&&o.value!==M[0].planning.name&&Ae(o,M[0].planning.name),Y&2){be=M[1];let I;for(I=0;I<be.length;I+=1){const je=yr(M,be,I);Ce[I]?Ce[I].p(je,Y):(Ce[I]=wr(je),Ce[I].c(),Ce[I].m(f,null))}for(;I<Ce.length;I+=1)Ce[I].d(1);Ce.length=be.length}if(Y&3&&$e(f,M[0].planning.reference_type),Y&3&&Ae(A,M[0].planning.notes),Y&3&&cn(te.value)!==M[0].planning.size&&Ae(te,M[0].planning.size),Y&4){G=M[2];let I;for(I=0;I<G.length;I+=1){const je=br(M,G,I);ee[I]?ee[I].p(je,Y):(ee[I]=kr(je),ee[I].c(),ee[I].m(j,null))}for(;I<ee.length;I+=1)ee[I].d(1);ee.length=G.length}if(Y&3&&$e(j,M[0].planning.size_units),Y&8){We=M[3];let I;for(I=0;I<We.length;I+=1){const je=vr(M,We,I);Oe[I]?Oe[I].p(je,Y):(Oe[I]=Sr(je),Oe[I].c(),Oe[I].m(x,null))}for(;I<Oe.length;I+=1)Oe[I].d(1);Oe.length=We.length}if(Y&3&&$e(x,M[0].planning.triage),Y&16){Ve=M[4];let I;for(I=0;I<Ve.length;I+=1){const je=gr(M,Ve,I);ye[I]?ye[I].p(je,Y):(ye[I]=Er(je),ye[I].c(),ye[I].m(fe,null))}for(;I<ye.length;I+=1)ye[I].d(1);ye.length=Ve.length}Y&3&&$e(fe,M[0].planning.recommendation)},i:U,o:U,d(M){M&&w(e),M&&w(s),M&&w(u),M&&w(l),M&&w(a),M&&w(p),M&&w(g),_t(Ce,M),M&&w(h),M&&w(m),M&&w(_),M&&w(k),M&&w(d),M&&w(v),M&&w(R),M&&w($),M&&w(D),M&&w(B),M&&w(X),M&&w(N),_t(ee,M),M&&w(le),M&&w(we),M&&w(Fe),M&&w(de),M&&w(ae),M&&w(Le),_t(Oe,M),M&&w(Q),M&&w(Mt),M&&w(me),M&&w(ke),M&&w(Lt),M&&w(ut),_t(ye,M),Ot=!1,Ie(Rt)}}}function zo(r,e,t){let{props:n}=e;n.planning||(n.planning={name:"",notes:"",reference_type:"preapp",size:0,size_units:"number of units",triage:"No Comment",recommendation:"No Comment"});const i=["preapp","outline","reserved matters","local plan"],o=["number of units","floorspace (Gross Floor Area)","area (Hectare)"],s=["No Comment","Standing Advice","Toolkit Assessment"],u=["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"];function l(){n.planning.name=this.value,t(0,n),t(1,i)}function a(){n.planning.reference_type=gt(this),t(0,n),t(1,i)}function p(){n.planning.notes=this.value,t(0,n),t(1,i)}function g(){n.planning.size=cn(this.value),t(0,n),t(1,i)}function c(){n.planning.size_units=gt(this),t(0,n),t(1,i)}function f(){n.planning.triage=gt(this),t(0,n),t(1,i)}function h(){n.planning.recommendation=gt(this),t(0,n),t(1,i)}return r.$$set=m=>{"props"in m&&t(0,n=m.props)},[n,i,o,s,u,l,a,p,g,c,f,h]}class Yo extends re{constructor(e){super(),ie(this,e,zo,Go,ne,{props:0})}}function Mr(r){let e,t,n,i,o;const s=r[10].default,u=At(s,r,r[9],null);return{c(){e=S("div"),u&&u.c(),pe(e,"border","solid 1px black"),pe(e,"padding","10px")},m(l,a){y(l,e,a),u&&u.m(e,null),r[13](e),n=!0,i||(o=q(e,"introend",r[14]),i=!0)},p(l,a){u&&u.p&&(!n||a&512)&&Pt(u,s,l,l[9],n?Nt(s,l[9],a,null):Ft(l[9]),null)},i(l){n||(P(u,l),nt(()=>{t||(t=Zt(e,rn,{duration:100},!0)),t.run(1)}),n=!0)},o(l){F(u,l),t||(t=Zt(e,rn,{duration:100},!1)),t.run(0),n=!1},d(l){l&&w(e),u&&u.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Ho(r){let e,t,n,i,o,s,u,l,a,p,g=r[4]&&Mr(r);return{c(){e=S("button"),t=Un("svg"),n=Un("path"),i=L(),o=H(r[1]),s=L(),g&&g.c(),u=Me(),T(n,"d","M9 5l7 7-7 7"),T(t,"style","tran"),T(t,"width","20"),T(t,"height","20"),T(t,"fill","none"),T(t,"stroke-linecap","round"),T(t,"stroke-linejoin","round"),T(t,"stroke-width","2"),T(t,"viewBox","0 0 24 24"),T(t,"stroke","currentColor"),T(t,"class","svelte-t7fpgu"),T(e,"aria-expanded",r[4]),T(e,"class","svelte-t7fpgu"),Xn(e,"underlined",r[3])},m(c,f){y(c,e,f),E(e,t),E(t,n),E(e,i),E(e,o),y(c,s,f),g&&g.m(c,f),y(c,u,f),l=!0,a||(p=[q(e,"click",r[5]),q(e,"mouseenter",r[11]),q(e,"mouseleave",r[12])],a=!0)},p(c,[f]){(!l||f&2)&&ft(o,c[1]),(!l||f&16)&&T(e,"aria-expanded",c[4]),(!l||f&8)&&Xn(e,"underlined",c[3]),c[4]?g?(g.p(c,f),f&16&&P(g,1)):(g=Mr(c),g.c(),P(g,1),g.m(u.parentNode,u)):g&&(Re(),F(g,1,1,()=>{g=null}),Te())},i(c){l||(P(g),l=!0)},o(c){F(g),l=!1},d(c){c&&w(e),c&&w(s),g&&g.d(c),c&&w(u),a=!1,Ie(p)}}}function Uo(r,e,t){let n,i,o,s;ce(r,Qe,d=>t(7,o=d)),ce(r,xe,d=>t(8,s=d));let{$$slots:u={},$$scope:l}=e,{id:a}=e,{label:p}=e;const g=()=>{xe.update(d=>d==a?null:a),s==a&&(En.set(null),En.set(a))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const h=()=>en.set(a),m=()=>en.set(null);function _(d){ge[d?"unshift":"push"](()=>{c=d,t(2,c)})}const k=()=>f();return r.$$set=d=>{"id"in d&&t(0,a=d.id),"label"in d&&t(1,p=d.label),"$$scope"in d&&t(9,l=d.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==a),r.$$.dirty&129&&t(3,i=o==a)},[a,p,c,i,n,g,f,o,s,l,u,h,m,_,k]}class Xo extends re{constructor(e){super(),ie(this,e,Uo,Ho,ne,{id:0,label:1})}}function Lr(r,e,t){const n=r.slice();return n[12]=e[t],n[13]=e,n[14]=t,n}function Jo(r){let e,t,n;function i(s){r[8](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new Yo({props:o}),ge.push(()=>Be(e,"props",i,r[12].properties)),{c(){W(e.$$.fragment)},m(s,u){V(e,s,u),n=!0},p(s,u){r=s;const l={};!t&&u&2&&(t=!0,l.props=r[12].properties,De(()=>t=!1)),e.$set(l)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){F(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function Wo(r){let e,t,n;function i(s){r[7](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new jo({props:o}),ge.push(()=>Be(e,"props",i,r[12].properties)),{c(){W(e.$$.fragment)},m(s,u){V(e,s,u),n=!0},p(s,u){r=s;const l={};!t&&u&2&&(t=!0,l.props=r[12].properties,De(()=>t=!1)),e.$set(l)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){F(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function Vo(r){let e,t,n,i,o;function s(p){r[4](p,r[12])}function u(p){r[5](p,r[12])}function l(p){r[6](p,r[12])}let a={length_meters:r[12].properties.length_meters};return r[12].properties.name!==void 0&&(a.name=r[12].properties.name),r[12].properties.intervention_type!==void 0&&(a.intervention_type=r[12].properties.intervention_type),r[12].properties.description!==void 0&&(a.description=r[12].properties.description),e=new Eo({props:a}),ge.push(()=>Be(e,"name",s,r[12].properties.name)),ge.push(()=>Be(e,"intervention_type",u,r[12].properties.intervention_type)),ge.push(()=>Be(e,"description",l,r[12].properties.description)),{c(){W(e.$$.fragment)},m(p,g){V(e,p,g),o=!0},p(p,g){r=p;const c={};g&2&&(c.length_meters=r[12].properties.length_meters),!t&&g&2&&(t=!0,c.name=r[12].properties.name,De(()=>t=!1)),!n&&g&2&&(n=!0,c.intervention_type=r[12].properties.intervention_type,De(()=>n=!1)),!i&&g&2&&(i=!0,c.description=r[12].properties.description,De(()=>i=!1)),e.$set(c)},i(p){o||(P(e.$$.fragment,p),o=!0)},o(p){F(e.$$.fragment,p),o=!1},d(p){K(e,p)}}}function Ko(r){let e,t,n,i,o,s,u,l,a,p,g,c,f,h,m;const _=[Vo,Wo,Jo],k=[];function d(b,O){return b[0]=="v1"?0:b[0]=="v2"?1:b[0]=="planning"?2:-1}~(e=d(r))&&(t=k[e]=_[e](r));function v(){return r[9](r[12])}return{c(){t&&t.c(),n=L(),i=S("br"),o=L(),s=S("br"),u=L(),l=S("div"),a=S("button"),a.textContent="Delete",p=L(),g=S("button"),g.textContent="Save",c=L(),T(a,"type","button"),T(g,"type","button"),pe(l,"display","flex"),pe(l,"justify-content","space-between")},m(b,O){~e&&k[e].m(b,O),y(b,n,O),y(b,i,O),y(b,o,O),y(b,s,O),y(b,u,O),y(b,l,O),E(l,a),E(l,p),E(l,g),y(b,c,O),f=!0,h||(m=[q(a,"click",v),q(g,"click",r[10])],h=!0)},p(b,O){r=b;let C=e;e=d(r),e===C?~e&&k[e].p(r,O):(t&&(Re(),F(k[C],1,1,()=>{k[C]=null}),Te()),~e?(t=k[e],t?t.p(r,O):(t=k[e]=_[e](r),t.c()),P(t,1),t.m(n.parentNode,n)):t=null)},i(b){f||(P(t),f=!0)},o(b){F(t),f=!1},d(b){~e&&k[e].d(b),b&&w(n),b&&w(i),b&&w(o),b&&w(s),b&&w(u),b&&w(l),b&&w(c),h=!1,Ie(m)}}}function Or(r,e){let t,n,i;return n=new Xo({props:{id:e[12].id,label:e[14]+1+") "+e[2](e[12]),$$slots:{default:[Ko]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=Me(),W(n.$$.fragment),this.first=t},m(o,s){y(o,t,s),V(n,o,s),i=!0},p(o,s){e=o;const u={};s&2&&(u.id=e[12].id),s&2&&(u.label=e[14]+1+") "+e[2](e[12])),s&32771&&(u.$$scope={dirty:s,ctx:e}),n.$set(u)},i(o){i||(P(n.$$.fragment,o),i=!0)},o(o){F(n.$$.fragment,o),i=!1},d(o){o&&w(t),K(n,o)}}}function Zo(r){let e=[],t=new Map,n,i,o,s,u=r[1].features;const l=a=>a[12].id;for(let a=0;a<u.length;a+=1){let p=Lr(r,u,a),g=l(p);t.set(g,e[a]=Or(g,p))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=Me()},m(a,p){for(let g=0;g<e.length;g+=1)e[g].m(a,p);y(a,n,p),i=!0,o||(s=q(window,"keydown",r[3]),o=!0)},p(a,[p]){p&7&&(u=a[1].features,Re(),e=yi(e,p,l,1,a,u,t,n.parentNode,wi,Or,n,Lr),Te())},i(a){if(!i){for(let p=0;p<u.length;p+=1)P(e[p]);i=!0}},o(a){for(let p=0;p<e.length;p+=1)F(e[p]);i=!1},d(a){for(let p=0;p<e.length;p+=1)e[p].d(a);a&&w(n),o=!1,s()}}}function Qo(r,e,t){let n,i;ce(r,xe,m=>t(11,n=m)),ce(r,se,m=>t(1,i=m));let{schema:o}=e;function s(m){var k,d;if(o=="planning")return((k=m.properties.planning)==null?void 0:k.name)||"Untitled polygon";if(o=="v2"&&((d=m.properties.v2)!=null&&d.name))return m.properties.v2.name;if(m.properties.name)return m.properties.name;var _=m.properties.intervention_type;return _=="other"&&(m.geometry.type=="Point"?_="point":m.geometry.type=="LineString"?_="line":_="polygon"),`Untitled ${_}`}function u(m){if(m.key=="Delete"){const _=m.target.tagName;if(_=="INPUT"||_=="TEXTAREA")return;m.preventDefault();const k=n;k&&Wn(k)}}function l(m,_){r.$$.not_equal(_.properties.name,m)&&(_.properties.name=m,se.set(i))}function a(m,_){r.$$.not_equal(_.properties.intervention_type,m)&&(_.properties.intervention_type=m,se.set(i))}function p(m,_){r.$$.not_equal(_.properties.description,m)&&(_.properties.description=m,se.set(i))}function g(m,_){r.$$.not_equal(_.properties,m)&&(_.properties=m,se.set(i))}function c(m,_){r.$$.not_equal(_.properties,m)&&(_.properties=m,se.set(i))}const f=m=>Wn(m.id),h=()=>xe.set(null);return r.$$set=m=>{"schema"in m&&t(0,o=m.schema)},[o,i,s,u,l,a,p,g,c,f,h]}class es extends re{constructor(e){super(),ie(this,e,Qo,Zo,ne,{schema:0})}}function st(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ue(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function An(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function tt(r,e,t){t===void 0&&(t={});var n=st(r),i=st(e),o=Ge(i[1]-n[1]),s=Ge(i[0]-n[0]),u=Ge(n[1]),l=Ge(i[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return ki(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),t.units)}function Xt(r,e){return e===void 0&&(e={}),Si(r,function(t,n){var i=n.geometry.coordinates;return t+tt(i[0],i[1],e)},0)}function ts(r){let e,t,n,i,o,s,u,l,a,p,g,c,f,h,m,_,k,d,v,b=r[0].features.length+"",O,C,A,R,$,D,B,X;return{c(){e=S("div"),t=S("label"),n=H(`Scheme name:
    `),i=S("input"),o=L(),s=S("br"),u=L(),l=S("div"),a=S("label"),p=S("input"),g=L(),c=S("button"),c.textContent="Load from GeoJSON",f=L(),h=S("button"),h.textContent="Export to GeoJSON",m=L(),_=S("br"),k=L(),d=S("div"),v=S("span"),O=H(b),C=H(" interventions"),A=L(),R=S("button"),$=H("Clear all"),T(i,"type","text"),T(p,"type","file"),T(p,"id","load_geojson"),T(p,"class","svelte-lhyd1e"),T(c,"type","button"),T(h,"type","button"),T(h,"class","align-right svelte-lhyd1e"),T(R,"type","button"),T(R,"class","align-right svelte-lhyd1e"),R.disabled=D=r[0].features.length==0},m(N,z){y(N,e,z),E(e,t),E(t,n),E(t,i),Ae(i,r[0].scheme_name),y(N,o,z),y(N,s,z),y(N,u,z),y(N,l,z),E(l,a),E(a,p),E(a,g),E(a,c),E(l,f),E(l,h),y(N,m,z),y(N,_,z),y(N,k,z),y(N,d,z),E(d,v),E(v,O),E(v,C),E(d,A),E(d,R),E(R,$),B||(X=[q(i,"input",r[7]),q(p,"change",r[3]),q(c,"click",rs),q(h,"click",r[2]),q(R,"click",r[1])],B=!0)},p(N,[z]){z&1&&i.value!==N[0].scheme_name&&Ae(i,N[0].scheme_name),z&1&&b!==(b=N[0].features.length+"")&&ft(O,b),z&1&&D!==(D=N[0].features.length==0)&&(R.disabled=D)},i:U,o:U,d(N){N&&w(e),N&&w(o),N&&w(s),N&&w(u),N&&w(l),N&&w(m),N&&w(_),N&&w(k),N&&w(d),B=!1,Ie(X)}}}function ns(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function rs(){document.getElementById("load_geojson").click()}function is(r,e,t){let n;ce(r,se,h=>t(0,n=h));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let u=window.localStorage.getItem(s);if(u)try{se.set(c(JSON.parse(u)))}catch(h){console.log(`Failed to load from local storage: ${h}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&se.update(h=>(delete h.scheme_name,h.features=[],h))}function a(){const h=JSON.parse(JSON.stringify(n));for(let m of h.features)delete m.properties.hide_while_editing;return h}function p(){let h=a();var m=s;h.authority=i,h.origin="atip-v1",h.scheme_name&&(m+="_"+h.scheme_name),m+=".txt",ns(m,JSON.stringify(h,null,"  "))}function g(h){const m=new FileReader;m.onload=k=>{try{se.set(c(JSON.parse(k.target.result)))}catch(d){window.alert(`Couldn't load scheme from a file: ${d}`)}};let _=h.target.files;m.readAsText(_[0])}function c(h){let m=1;for(let _ of h.features)_.properties||(_.properties={name:"",description:"",intervention_type:"other"}),_.geometry.type=="LineString"&&!_.properties.length_meters&&(_.properties.length_meters=Xt(_,{units:"kilometers"})*1e3),_.id=m++;return h}function f(){n.scheme_name=this.value,se.set(n)}return r.$$set=h=>{"authorityName"in h&&t(4,i=h.authorityName),"schema"in h&&t(5,o=h.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(a())))},[n,l,p,g,i,o,s,f]}class os extends re{constructor(e){super(),ie(this,e,is,ts,ne,{authorityName:4,schema:5})}}const ss="/atip/assets/zoom_out_map-b2e1091a.svg";function ls(r){let e,t,n,i,o;return{c(){e=S("button"),t=S("img"),Ei(t.src,n=ss)||T(t,"src",n),T(t,"alt","Zoom to show entire boundary"),T(e,"type","button"),T(e,"title","Zoom to show entire boundary"),T(e,"class","svelte-qzjsqo")},m(s,u){y(s,e,u),E(e,t),i||(o=q(e,"click",r[0]),i=!0)},p:U,i:U,o:U,d(s){s&&w(e),i=!1,o()}}}function us(r,e,t){let n;ce(r,Je,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(Dn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class as extends re{constructor(e){super(),ie(this,e,us,ls,ne,{boundaryGeojson:1})}}function fs(r){let e,t,n,i,o,s,u;return{c(){e=S("div"),t=H(`Basemap:
  `),n=S("select"),i=S("option"),i.textContent="Streets",o=S("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&nt(()=>r[2].call(n)),T(e,"class","svelte-1tbnm6i")},m(l,a){y(l,e,a),E(e,t),E(e,n),E(n,i),E(n,o),$e(n,r[0]),s||(u=[q(n,"change",r[2]),q(n,"change",r[1])],s=!0)},p(l,[a]){a&1&&$e(n,l[0])},i:U,o:U,d(l){l&&w(e),s=!1,Ie(u)}}}function cs(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let u=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=u}function o(){n=gt(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class ps extends re{constructor(e){super(),ie(this,e,cs,fs,ne,{style:0})}}const _e={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},mn=10,on=10;function hs(r){let e,t,n,i,o,s,u,l,a,p,g,c,f,h,m;return{c(){e=S("li"),t=S("span"),n=H("Areas"),i=L(),o=S("li"),s=S("span"),u=H("Routes"),l=L(),a=S("li"),p=S("span"),g=H("Crossings"),c=L(),f=S("li"),h=S("span"),m=H("Other"),T(t,"class","svelte-p551i1"),pe(t,"background",_e.area),T(s,"class","svelte-p551i1"),pe(s,"background",_e.route),T(p,"class","svelte-p551i1"),pe(p,"background",_e.crossing),T(h,"class","svelte-p551i1"),pe(h,"background",_e.other)},m(_,k){y(_,e,k),E(e,t),E(e,n),y(_,i,k),y(_,o,k),E(o,s),E(o,u),y(_,l,k),y(_,a,k),E(a,p),E(a,g),y(_,c,k),y(_,f,k),E(f,h),E(f,m)},p:U,d(_){_&&w(e),_&&w(i),_&&w(o),_&&w(l),_&&w(a),_&&w(c),_&&w(f)}}}function ds(r){let e,t,n,i,o,s,u,l,a,p,g,c,f,h,m;return{c(){e=S("li"),t=S("span"),n=H("Preapp"),i=L(),o=S("li"),s=S("span"),u=H("Outline"),l=L(),a=S("li"),p=S("span"),g=H("Reserved matters"),c=L(),f=S("li"),h=S("span"),m=H("Local plan"),T(t,"class","svelte-p551i1"),pe(t,"background",_e.preapp),T(s,"class","svelte-p551i1"),pe(s,"background",_e.outline),T(p,"class","svelte-p551i1"),pe(p,"background",_e["reserved matters"]),T(h,"class","svelte-p551i1"),pe(h,"background",_e["local plan"])},m(_,k){y(_,e,k),E(e,t),E(e,n),y(_,i,k),y(_,o,k),E(o,s),E(o,u),y(_,l,k),y(_,a,k),E(a,p),E(a,g),y(_,c,k),y(_,f,k),E(f,h),E(f,m)},p:U,d(_){_&&w(e),_&&w(i),_&&w(o),_&&w(l),_&&w(a),_&&w(c),_&&w(f)}}}function ms(r){let e,t,n,i;function o(l,a){return l[0]=="planning"?ds:hs}let s=o(r),u=s(r);return{c(){e=S("div"),t=S("h1"),t.textContent="Interventions",n=L(),i=S("ul"),u.c(),T(t,"class","svelte-p551i1"),T(e,"class","svelte-p551i1")},m(l,a){y(l,e,a),E(e,t),E(e,n),E(e,i),u.m(i,null)},p(l,[a]){s===(s=o(l))&&u?u.p(l,a):(u.d(1),u=s(l),u&&(u.c(),u.m(i,null)))},i:U,o:U,d(l){l&&w(e),u.d()}}}function _s(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class gs extends re{constructor(e){super(),ie(this,e,_s,ms,ne,{schema:0})}}let pt="interventions";function vs(r,e,t){let n,i;ce(r,Je,p=>t(1,n=p)),ce(r,se,p=>t(2,i=p));let{schema:o}=e;at(n,pt,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",_e.area,"route",_e.route,"crossing",_e.crossing,"other",_e.other,"white"],u=["match",["get","reference_type",["get","planning"]],"preapp",_e.preapp,"outline",_e.outline,"reserved matters",_e["reserved matters"],"local plan",_e["local plan"],"white"],l=["!=","hide_while_editing",!0];return Pe(n,{id:"interventions-points",source:pt,filter:["all",pn,l,["!=","endpoint",!0]],...St(s,mn)}),Pe(n,{id:"interventions-lines",source:pt,filter:["all",hn,l],...Dt(s,on)},"route-lines"),Pe(n,{id:"interventions-lines-endpoints",source:pt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*on,"circle-opacity":0,"circle-stroke-color":_e.lineEndpointColor,"circle-stroke-width":2}}),Pe(n,{id:"interventions-polygons",source:pt,filter:["all",dn,l],...fn(o=="planning"?u:s,.5)},"hover-polygons"),r.$$set=p=>{"schema"in p&&t(0,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(i)),g=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])g.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(g),n.getSource(pt).setData(p)}},[o,n,i]}class bs extends re{constructor(e){super(),ie(this,e,vs,null,ne,{schema:0})}}let ht="hover";function ys(r,e,t){let n,i,o,s,u;return ce(r,Je,l=>t(0,n=l)),ce(r,se,l=>t(1,i=l)),ce(r,en,l=>t(2,o=l)),ce(r,Qe,l=>t(3,s=l)),ce(r,xe,l=>t(4,u=l)),at(n,ht,{type:"geojson",data:Xe()}),Pe(n,{id:"hover-polygons",source:ht,filter:dn,...Dt(_e.hovering,.5*on,1)}),Pe(n,{id:"hover-lines",source:ht,filter:hn,...Dt(_e.hovering,1.5*on,1)},"interventions-lines"),Pe(n,{id:"hover-points",source:ht,filter:pn,...St(_e.hovering,1.5*mn,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=u||s||o;l!=null?n.getSource(ht).setData(i.features.find(a=>a.id==l)):n.getSource(ht).setData(Xe())}},[n,i,o,s,u]}class ws extends re{constructor(e){super(),ie(this,e,ys,null,ne,{})}}class Yn{constructor(e,t){oe(this,"owner");oe(this,"map");oe(this,"mapHandlers",{});oe(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Yt="edit-point-mode";class ks{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"cursor");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new Yn(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),at(e,Yt,{type:"geojson",data:Xe()}),Pe(e,{id:"edit-point-mode",source:Yt,...St(_e.hovering,mn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=Ss(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Yt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Xe();this.cursor&&e.features.push(this.cursor),this.map.getSource(Yt).setData(e)}}function Ss(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Zr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Es(r,e);var n=st(r),i=st(e),o=Ge(n[0]),s=Ge(i[0]),u=Ge(n[1]),l=Ge(i[1]),a=Math.sin(s-o)*Math.cos(l),p=Math.cos(u)*Math.sin(l)-Math.sin(u)*Math.cos(l)*Math.cos(s-o);return Sn(Math.atan2(a,p))}function Es(r,e){var t=Zr(e,r);return t=(t+180)%360,t}function Rr(r,e,t,n){n===void 0&&(n={});var i=st(r),o=Ge(i[0]),s=Ge(i[1]),u=Ge(t),l=Mi(e,n.units),a=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(u)),p=o+Math.atan2(Math.sin(u)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(a)),g=Sn(p),c=Sn(a);return yt([g,c],n.properties)}function Pn(r){if(!r)throw new Error("geojson is required");var e=[];return qn(r,function(t){Ms(t,e)}),ot(e)}function Ms(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ue(n);break;case"LineString":t=[Ue(n)]}t.forEach(function(i){var o=Ls(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Ls(r,e){var t=[];return r.reduce(function(n,i){var o=wt([n,i],e);return o.bbox=Os(n,i),t.push(o),i}),t}function Os(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,u=n<o?n:o,l=t>i?t:i,a=n>o?n:o;return[s,u,l,a]}var kt={},Rs={get exports(){return kt},set exports(r){kt=r}},Fn={},Ts={get exports(){return Fn},set exports(r){Fn=r}};(function(r,e){(function(t,n){r.exports=n()})(Li,function(){function t(d,v,b,O,C){(function A(R,$,D,B,X){for(;B>D;){if(B-D>600){var N=B-D+1,z=$-D+1,te=Math.log(N),he=.5*Math.exp(2*te/3),j=.5*Math.sqrt(te*he*(N-he)/N)*(z-N/2<0?-1:1),le=Math.max(D,Math.floor($-z*he/N+j)),we=Math.min(B,Math.floor($+(N-z)*he/N+j));A(R,$,le,we,X)}var Fe=R[$],de=D,ae=B;for(n(R,D,$),X(R[B],Fe)>0&&n(R,D,B);de<ae;){for(n(R,de,ae),de++,ae--;X(R[de],Fe)<0;)de++;for(;X(R[ae],Fe)>0;)ae--}X(R[D],Fe)===0?n(R,D,ae):n(R,++ae,B),ae<=$&&(D=ae+1),$<=ae&&(B=ae-1)}})(d,v,b||0,O||d.length-1,C||i)}function n(d,v,b){var O=d[v];d[v]=d[b],d[b]=O}function i(d,v){return d<v?-1:d>v?1:0}var o=function(d){d===void 0&&(d=9),this._maxEntries=Math.max(4,d),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(d,v,b){if(!b)return v.indexOf(d);for(var O=0;O<v.length;O++)if(b(d,v[O]))return O;return-1}function u(d,v){l(d,0,d.children.length,v,d)}function l(d,v,b,O,C){C||(C=_(null)),C.minX=1/0,C.minY=1/0,C.maxX=-1/0,C.maxY=-1/0;for(var A=v;A<b;A++){var R=d.children[A];a(C,d.leaf?O(R):R)}return C}function a(d,v){return d.minX=Math.min(d.minX,v.minX),d.minY=Math.min(d.minY,v.minY),d.maxX=Math.max(d.maxX,v.maxX),d.maxY=Math.max(d.maxY,v.maxY),d}function p(d,v){return d.minX-v.minX}function g(d,v){return d.minY-v.minY}function c(d){return(d.maxX-d.minX)*(d.maxY-d.minY)}function f(d){return d.maxX-d.minX+(d.maxY-d.minY)}function h(d,v){return d.minX<=v.minX&&d.minY<=v.minY&&v.maxX<=d.maxX&&v.maxY<=d.maxY}function m(d,v){return v.minX<=d.maxX&&v.minY<=d.maxY&&v.maxX>=d.minX&&v.maxY>=d.minY}function _(d){return{children:d,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function k(d,v,b,O,C){for(var A=[v,b];A.length;)if(!((b=A.pop())-(v=A.pop())<=O)){var R=v+Math.ceil((b-v)/O/2)*O;t(d,R,v,b,C),A.push(v,R,R,b)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(d){var v=this.data,b=[];if(!m(d,v))return b;for(var O=this.toBBox,C=[];v;){for(var A=0;A<v.children.length;A++){var R=v.children[A],$=v.leaf?O(R):R;m(d,$)&&(v.leaf?b.push(R):h(d,$)?this._all(R,b):C.push(R))}v=C.pop()}return b},o.prototype.collides=function(d){var v=this.data;if(!m(d,v))return!1;for(var b=[];v;){for(var O=0;O<v.children.length;O++){var C=v.children[O],A=v.leaf?this.toBBox(C):C;if(m(d,A)){if(v.leaf||h(d,A))return!0;b.push(C)}}v=b.pop()}return!1},o.prototype.load=function(d){if(!d||!d.length)return this;if(d.length<this._minEntries){for(var v=0;v<d.length;v++)this.insert(d[v]);return this}var b=this._build(d.slice(),0,d.length-1,0);if(this.data.children.length)if(this.data.height===b.height)this._splitRoot(this.data,b);else{if(this.data.height<b.height){var O=this.data;this.data=b,b=O}this._insert(b,this.data.height-b.height-1,!0)}else this.data=b;return this},o.prototype.insert=function(d){return d&&this._insert(d,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(d,v){if(!d)return this;for(var b,O,C,A=this.data,R=this.toBBox(d),$=[],D=[];A||$.length;){if(A||(A=$.pop(),O=$[$.length-1],b=D.pop(),C=!0),A.leaf){var B=s(d,A.children,v);if(B!==-1)return A.children.splice(B,1),$.push(A),this._condense($),this}C||A.leaf||!h(A,R)?O?(b++,A=O.children[b],C=!1):A=null:($.push(A),D.push(b),b=0,O=A,A=A.children[0])}return this},o.prototype.toBBox=function(d){return d},o.prototype.compareMinX=function(d,v){return d.minX-v.minX},o.prototype.compareMinY=function(d,v){return d.minY-v.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(d){return this.data=d,this},o.prototype._all=function(d,v){for(var b=[];d;)d.leaf?v.push.apply(v,d.children):b.push.apply(b,d.children),d=b.pop();return v},o.prototype._build=function(d,v,b,O){var C,A=b-v+1,R=this._maxEntries;if(A<=R)return u(C=_(d.slice(v,b+1)),this.toBBox),C;O||(O=Math.ceil(Math.log(A)/Math.log(R)),R=Math.ceil(A/Math.pow(R,O-1))),(C=_([])).leaf=!1,C.height=O;var $=Math.ceil(A/R),D=$*Math.ceil(Math.sqrt(R));k(d,v,b,D,this.compareMinX);for(var B=v;B<=b;B+=D){var X=Math.min(B+D-1,b);k(d,B,X,$,this.compareMinY);for(var N=B;N<=X;N+=$){var z=Math.min(N+$-1,X);C.children.push(this._build(d,N,z,O-1))}}return u(C,this.toBBox),C},o.prototype._chooseSubtree=function(d,v,b,O){for(;O.push(v),!v.leaf&&O.length-1!==b;){for(var C=1/0,A=1/0,R=void 0,$=0;$<v.children.length;$++){var D=v.children[$],B=c(D),X=(N=d,z=D,(Math.max(z.maxX,N.maxX)-Math.min(z.minX,N.minX))*(Math.max(z.maxY,N.maxY)-Math.min(z.minY,N.minY))-B);X<A?(A=X,C=B<C?B:C,R=D):X===A&&B<C&&(C=B,R=D)}v=R||v.children[0]}var N,z;return v},o.prototype._insert=function(d,v,b){var O=b?d:this.toBBox(d),C=[],A=this._chooseSubtree(O,this.data,v,C);for(A.children.push(d),a(A,O);v>=0&&C[v].children.length>this._maxEntries;)this._split(C,v),v--;this._adjustParentBBoxes(O,C,v)},o.prototype._split=function(d,v){var b=d[v],O=b.children.length,C=this._minEntries;this._chooseSplitAxis(b,C,O);var A=this._chooseSplitIndex(b,C,O),R=_(b.children.splice(A,b.children.length-A));R.height=b.height,R.leaf=b.leaf,u(b,this.toBBox),u(R,this.toBBox),v?d[v-1].children.push(R):this._splitRoot(b,R)},o.prototype._splitRoot=function(d,v){this.data=_([d,v]),this.data.height=d.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(d,v,b){for(var O,C,A,R,$,D,B,X=1/0,N=1/0,z=v;z<=b-v;z++){var te=l(d,0,z,this.toBBox),he=l(d,z,b,this.toBBox),j=(C=te,A=he,R=void 0,$=void 0,D=void 0,B=void 0,R=Math.max(C.minX,A.minX),$=Math.max(C.minY,A.minY),D=Math.min(C.maxX,A.maxX),B=Math.min(C.maxY,A.maxY),Math.max(0,D-R)*Math.max(0,B-$)),le=c(te)+c(he);j<X?(X=j,O=z,N=le<N?le:N):j===X&&le<N&&(N=le,O=z)}return O||b-v},o.prototype._chooseSplitAxis=function(d,v,b){var O=d.leaf?this.compareMinX:p,C=d.leaf?this.compareMinY:g;this._allDistMargin(d,v,b,O)<this._allDistMargin(d,v,b,C)&&d.children.sort(O)},o.prototype._allDistMargin=function(d,v,b,O){d.children.sort(O);for(var C=this.toBBox,A=l(d,0,v,C),R=l(d,b-v,b,C),$=f(A)+f(R),D=v;D<b-v;D++){var B=d.children[D];a(A,d.leaf?C(B):B),$+=f(A)}for(var X=b-v-1;X>=v;X--){var N=d.children[X];a(R,d.leaf?C(N):N),$+=f(R)}return $},o.prototype._adjustParentBBoxes=function(d,v,b){for(var O=b;O>=0;O--)a(v[O],d)},o.prototype._condense=function(d){for(var v=d.length-1,b=void 0;v>=0;v--)d[v].children.length===0?v>0?(b=d[v-1].children).splice(b.indexOf(d[v]),1):this.clear():u(d[v],this.toBBox)},o})})(Ts);const Cs=jn(Oi),As=jn(Ri),Ps=jn(Ti);var Ye=Fn,Qr=Cs,ei=As,dt=Ps.default,Fs=ei.featureEach;ei.coordEach;Qr.polygon;var Tr=Qr.featureCollection;function ti(r){var e=new Ye(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:dt(t),Ye.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:dt(i),n.push(i)}):Fs(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:dt(i),n.push(i)}),Ye.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:dt(t),Ye.prototype.remove.call(this,t,n)},e.clear=function(){return Ye.prototype.clear.call(this)},e.search=function(t){var n=Ye.prototype.search.call(this,this.toBBox(t));return Tr(n)},e.collides=function(t){return Ye.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ye.prototype.all.call(this);return Tr(t)},e.toJSON=function(){return Ye.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ye.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=dt(t);else if(t.type==="FeatureCollection")n=dt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Rs.exports=ti;kt.default=ti;function ni(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Jn(r)),e.type==="LineString"&&(e=Jn(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Cr(r,e);return i&&n.push(i),ot(n)}var o=kt();return o.load(Pn(e)),Qt(Pn(r),function(s){Qt(o.search(s),function(u){var l=Cr(s,u);if(l){var a=Ue(l).join(",");t[a]||(t[a]=!0,n.push(l))}})}),ot(n)}function Cr(r,e){var t=Ue(r),n=Ue(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],u=t[1][1],l=n[0][0],a=n[0][1],p=n[1][0],g=n[1][1],c=(g-a)*(s-i)-(p-l)*(u-o),f=(p-l)*(o-a)-(g-a)*(i-l),h=(s-i)*(o-a)-(u-o)*(i-l);if(c===0)return f===0&&h===0,null;var m=f/c,_=h/c;if(m>=0&&m<=1&&_>=0&&_<=1){var k=i+m*(s-i),d=o+m*(u-o);return yt([k,d])}return null}function jt(r,e,t){t===void 0&&(t={});var n=yt([1/0,1/0],{dist:1/0}),i=0;return qn(r,function(o){for(var s=Ue(o),u=0;u<s.length-1;u++){var l=yt(s[u]);l.properties.dist=tt(e,l,t);var a=yt(s[u+1]);a.properties.dist=tt(e,a,t);var p=tt(l,a,t),g=Math.max(l.properties.dist,a.properties.dist),c=Zr(l,a),f=Rr(e,g,c+90,t),h=Rr(e,g,c-90,t),m=ni(wt([f.geometry.coordinates,h.geometry.coordinates]),wt([l.geometry.coordinates,a.geometry.coordinates])),_=null;m.features.length>0&&(_=m.features[0],_.properties.dist=tt(e,_,t),_.properties.location=i+tt(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=u,n.properties.location=i),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=u+1,n.properties.location=i+p),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=u),i+=p}}),n}const mt="edit-polygon-mode";class Ns{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"points");oe(this,"cursor");oe(this,"hover");oe(this,"dragFrom");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new Yn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),at(e,mt,{type:"geojson",data:Xe()}),Pe(e,{id:"edit-polygon-fill",source:mt,filter:dn,...fn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Pe(e,{id:"edit-polygon-lines",source:mt,filter:hn,...Dt("black",8,.5)}),Pe(e,{id:"edit-polygon-vertices",source:mt,filter:pn,...St(_e.hovering,mn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Pr(this.points).forEach((n,i)=>{t.push([i+1,jt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(mt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Xe();this.points.forEach((n,i)=>{let o=Ar(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Pr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(mt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Ar(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Ar(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Pr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let Z;const Ze=new Array(32).fill(void 0);Ze.push(void 0,null,!0,!1);function J(r){return Ze[r]}let It=Ze.length;function xs(r){r<36||(Ze[r]=It,It=r)}function Nn(r){const e=J(r);return xs(r),e}const ri=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});ri.decode();let Jt=new Uint8Array;function $t(){return Jt.byteLength===0&&(Jt=new Uint8Array(Z.memory.buffer)),Jt}function vt(r,e){return ri.decode($t().subarray(r,r+e))}function Se(r){It===Ze.length&&Ze.push(Ze.length+1);const e=It;return It=Ze[e],Ze[e]=r,e}function bn(r){return r==null}let Wt=new Float64Array;function Is(){return Wt.byteLength===0&&(Wt=new Float64Array(Z.memory.buffer)),Wt}let Vt=new Int32Array;function Ee(){return Vt.byteLength===0&&(Vt=new Int32Array(Z.memory.buffer)),Vt}let it=0;const Kt=new TextEncoder("utf-8"),$s=typeof Kt.encodeInto=="function"?function(r,e){return Kt.encodeInto(r,e)}:function(r,e){const t=Kt.encode(r);return e.set(t),{read:r.length,written:t.length}};function Ht(r,e,t){if(t===void 0){const u=Kt.encode(r),l=e(u.length);return $t().subarray(l,l+u.length).set(u),it=u.length,l}let n=r.length,i=e(n);const o=$t();let s=0;for(;s<n;s++){const u=r.charCodeAt(s);if(u>127)break;o[i+s]=u}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const u=$t().subarray(i+s,i+n),l=$s(r,u);s+=l.written}return it=s,i}function xn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=xn(r[0]));for(let s=1;s<i;s++)o+=", "+xn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Bs(r,e){const t=e(r.length*1);return $t().set(r,t/1),it=r.length,t}function yn(r,e){try{return r.apply(this,e)}catch(t){Z.__wbindgen_exn_store(Se(t))}}class sn{static __wrap(e){const t=Object.create(sn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Z.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=Z.__wbindgen_add_to_stack_pointer(-16),s=Bs(e,Z.__wbindgen_malloc),u=it;Z.jsroutesnapper_new(o,s,u);var t=Ee()[o/4+0],n=Ee()[o/4+1],i=Ee()[o/4+2];if(i)throw Nn(n);return sn.__wrap(t)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){Z.jsroutesnapper_setConfig(this.ptr,Se(e))}toFinalFeature(){try{const n=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_toFinalFeature(n,this.ptr);var e=Ee()[n/4+0],t=Ee()[n/4+1];let i;return e!==0&&(i=vt(e,t).slice(),Z.__wbindgen_free(e,t*1)),i}finally{Z.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_renderGeojson(n,this.ptr);var e=Ee()[n/4+0],t=Ee()[n/4+1];return vt(e,t)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(e,t)}}setSnapMode(e){Z.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return Z.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){Z.jsroutesnapper_onClick(this.ptr)}onDragStart(){return Z.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return Z.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){Z.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_editExisting(i,this.ptr,Se(e));var t=Ee()[i/4+0],n=Ee()[i/4+1];if(n)throw Nn(t)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}}async function Ds(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function qs(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Nn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(vt(e,t));return Se(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=vt(e,t);return Se(n)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;Is()[e/8+1]=bn(i)?0:i,Ee()[e/4+0]=!bn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=bn(i)?0:Ht(i,Z.__wbindgen_malloc,Z.__wbindgen_realloc),s=it;Ee()[e/4+1]=s,Ee()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(J(t)),i=Ht(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return Se(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=J(e)[J(t)];return Se(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(J(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(J(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(J(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(J(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(J(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=J(e)[t>>>0];return Se(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=J(e).next;return Se(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return yn(function(e){const t=J(e).next();return Se(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return J(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=J(e).value;return Se(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return Se(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return yn(function(e,t){const n=Reflect.get(J(e),J(t));return Se(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return yn(function(e,t){const n=J(e).call(J(t));return Se(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=J(e).buffer;return Se(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(J(e));return Se(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Se(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=Ht(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(vt(e,t))}finally{Z.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=xn(J(t)),i=Ht(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(vt(e,t))},r.wbg.__wbindgen_memory=function(){const e=Z.memory;return Se(e)},r}function js(r,e){return Z=r.exports,ii.__wbindgen_wasm_module=e,Wt=new Float64Array,Vt=new Int32Array,Jt=new Uint8Array,Z}async function ii(r){typeof r>"u"&&(r="/atip/assets/route_snapper_bg.wasm");const e=qs();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Ds(await r,e);return js(t,n)}const Ct="route-snapper",Fr=10,Gs=30;class zs{constructor(e,t){oe(this,"map");oe(this,"inner");oe(this,"active");oe(this,"eventListenersSuccessRoute");oe(this,"eventListenersSuccessArea");oe(this,"eventListenersFailure");oe(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new sn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],at(e,Ct,{type:"geojson",data:Xe()}),Pe(e,{id:"route-points",source:Ct,filter:pn,...St(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Fr/2,Fr])}),Pe(e,{id:"route-lines",source:Ct,filter:hn,...Dt("black",2.5)}),Pe(e,{id:"route-polygons",source:Ct,filter:dn,...fn("black",.5)}),this.events=new Yn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Gs,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Ct).setData(JSON.parse(this.inner.renderGeojson()))}}function Nr(r){let e;function t(o,s){return o[1]?Hs:Ys}let n=t(r),i=n(r);return{c(){i.c(),e=Me()},m(o,s){i.m(o,s),y(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&w(e)}}}function Ys(r){let e;return{c(){e=S("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function Hs(r){let e;return{c(){e=S("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function Us(r){let e,t=r[0]==bt&&Nr(r);return{c(){t&&t.c(),e=Me()},m(n,i){t&&t.m(n,i),y(n,e,i)},p(n,[i]){n[0]==bt?t?t.p(n,i):(t=Nr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&w(e)}}}const bt="edit-attribute";function oi(){}function Xs(r,e,t){let n,i,o,s;ce(r,Je,f=>t(5,n=f)),ce(r,se,f=>t(6,i=f)),ce(r,En,f=>t(7,o=f)),ce(r,xe,f=>t(1,s=f));let{mode:u}=e,{changeMode:l}=e;function a(){xe.set(null)}n.on("mousemove",p),n.on("mouseout",g),n.on("click",c),Gt(()=>{n.off("mousemove",p),n.off("mouseout",g),n.off("click",c)});function p(f){var h;if(u==bt){let m=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Qe.set(((h=m[0])==null?void 0:h.id)||null)}}function g(){u==bt&&Qe.set(null)}function c(f){if(u==bt){let h=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});h.length>0?xe.set(h[0].id):xe.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,u=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let h=i.features.find(m=>m.id==f);h.geometry.type=="Point"?n.flyTo({center:h.geometry.coordinates,duration:500}):n.fitBounds(Dn(h),{padding:200,duration:500}),l(bt)}}},[u,s,l,oi,a,n,i,o]}class Js extends re{constructor(e){super(),ie(this,e,Xs,Us,ne,{mode:0,changeMode:2,start:3,stop:4})}get start(){return oi}get stop(){return this.$$.ctx[4]}}function Ws(r){let e,t;return{c:U,m(n,i){e||(t=q(window,"keydown",r[0]),e=!0)},p:U,i:U,o:U,d(n){e=!1,t()}}}function Vs(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class _n extends re{constructor(e){super(),ie(this,e,Vs,Ws,ne,{tool:1})}}function Ks(r){let e;return{c(){e=S("p"),e.textContent="Click to add a new point"},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function Zs(r){let e;return{c(){e=S("p"),e.textContent="Click to move the point here"},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function Qs(r){let e,t,n,i,o,s,u,l,a;function p(f,h){return f[1]?Zs:Ks}let g=p(r),c=g(r);return s=new _n({props:{tool:r[0]}}),{c(){c.c(),e=L(),t=S("p"),t.innerHTML="Press <b>Escape</b> to cancel",n=L(),i=S("button"),i.textContent="Cancel",o=L(),W(s.$$.fragment),T(i,"type","button")},m(f,h){c.m(f,h),y(f,e,h),y(f,t,h),y(f,n,h),y(f,i,h),y(f,o,h),V(s,f,h),u=!0,l||(a=q(i,"click",r[2]),l=!0)},p(f,[h]){g!==(g=p(f))&&(c.d(1),c=g(f),c&&(c.c(),c.m(e.parentNode,e)));const m={};h&1&&(m.tool=f[0]),s.$set(m)},i(f){u||(P(s.$$.fragment,f),u=!0)},o(f){F(s.$$.fragment,f),u=!1},d(f){c.d(f),f&&w(e),f&&w(t),f&&w(n),f&&w(i),f&&w(o),K(s,f),l=!1,a()}}}function el(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class si extends re{constructor(e){super(),ie(this,e,el,Qs,ne,{pointTool:0,editingExisting:1})}}function tl(r){let e,t,n,i,o,s,u,l,a,p,g;return l=new _n({props:{tool:r[0]}}),{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=L(),n=S("div"),i=S("button"),i.textContent="Finish",o=L(),s=S("button"),s.textContent="Cancel",u=L(),W(l.$$.fragment),T(i,"type","button"),T(s,"type","button"),pe(n,"display","flex"),pe(n,"justify-content","space-between")},m(c,f){y(c,e,f),y(c,t,f),y(c,n,f),E(n,i),E(n,o),E(n,s),y(c,u,f),V(l,c,f),a=!0,p||(g=[q(i,"click",r[1]),q(s,"click",r[2])],p=!0)},p(c,[f]){const h={};f&1&&(h.tool=c[0]),l.$set(h)},i(c){a||(P(l.$$.fragment,c),a=!0)},o(c){F(l.$$.fragment,c),a=!1},d(c){c&&w(e),c&&w(t),c&&w(n),c&&w(u),K(l,c),p=!1,Ie(g)}}}function nl(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class li extends re{constructor(e){super(),ie(this,e,nl,tl,ne,{polygonTool:0})}}function rl(r){let e,t,n,i,o,s,u,l,a,p,g;return l=new _n({props:{tool:r[0]}}),{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish area</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=L(),n=S("div"),i=S("button"),i.textContent="Finish",o=L(),s=S("button"),s.textContent="Cancel",u=L(),W(l.$$.fragment),T(i,"type","button"),T(s,"type","button"),pe(n,"display","flex"),pe(n,"justify-content","space-between")},m(c,f){y(c,e,f),y(c,t,f),y(c,n,f),E(n,i),E(n,o),E(n,s),y(c,u,f),V(l,c,f),a=!0,p||(g=[q(i,"click",r[1]),q(s,"click",r[2])],p=!0)},p(c,[f]){const h={};f&1&&(h.tool=c[0]),l.$set(h)},i(c){a||(P(l.$$.fragment,c),a=!0)},o(c){F(l.$$.fragment,c),a=!1},d(c){c&&w(e),c&&w(t),c&&w(n),c&&w(u),K(l,c),p=!1,Ie(g)}}}function il(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class ui extends re{constructor(e){super(),ie(this,e,il,rl,ne,{routeTool:0})}}function ol(r){let e,t,n,i,o,s,u,l,a,p,g,c,f,h,m;return c=new _n({props:{tool:r[0]}}),{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=L(),n=S("label"),i=S("input"),o=H(`
  Avoid doubling back`),s=L(),u=S("div"),l=S("button"),l.textContent="Finish",a=L(),p=S("button"),p.textContent="Cancel",g=L(),W(c.$$.fragment),T(i,"type","checkbox"),T(l,"type","button"),T(p,"type","button"),pe(u,"display","flex"),pe(u,"justify-content","space-between")},m(_,k){y(_,e,k),y(_,t,k),y(_,n,k),E(n,i),i.checked=r[1],E(n,o),y(_,s,k),y(_,u,k),E(u,l),E(u,a),E(u,p),y(_,g,k),V(c,_,k),f=!0,h||(m=[q(i,"change",r[2]),q(l,"click",r[3]),q(p,"click",r[4])],h=!0)},p(_,[k]){k&2&&(i.checked=_[1]);const d={};k&1&&(d.tool=_[0]),c.$set(d)},i(_){f||(P(c.$$.fragment,_),f=!0)},o(_){F(c.$$.fragment,_),f=!1},d(_){_&&w(e),_&&w(t),_&&w(n),_&&w(s),_&&w(u),_&&w(g),K(c,_),h=!1,Ie(m)}}}function sl(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),u=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,u]}class ai extends re{constructor(e){super(),ie(this,e,sl,ol,ne,{routeTool:0})}}function xr(r){let e,t,n,i;const o=[cl,fl,al,ul,ll],s=[];function u(l,a){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=Me()},m(l,a){s[e].m(l,a),y(l,n,a),i=!0},p(l,a){let p=e;e=u(l),e===p?s[e].p(l,a):(Re(),F(s[p],1,1,()=>{s[p]=null}),Te(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),P(t,1),t.m(n.parentNode,n))},i(l){i||(P(t),i=!0)},o(l){F(t),i=!1},d(l){s[e].d(l),l&&w(n)}}}function ll(r){let e;return{c(){e=S("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){y(t,e,n)},p:U,i:U,o:U,d(t){t&&w(e)}}}function ul(r){let e,t;return e=new ai({props:{routeTool:r[3]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function al(r){let e,t;return e=new ui({props:{routeTool:r[3]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function fl(r){let e,t;return e=new li({props:{polygonTool:r[2]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function cl(r){let e,t;return e=new si({props:{pointTool:r[1],editingExisting:!0}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function pl(r){let e,t,n=r[0]==Ke&&xr(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==Ke?n?(n.p(i,o),o&1&&P(n,1)):(n=xr(i),n.c(),P(n,1),n.m(e.parentNode,e)):n&&(Re(),F(n,1,1,()=>{n=null}),Te())},i(i){t||(P(n),t=!0)},o(i){F(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const Ke="edit-geometry";function fi(){}function hl(r,e,t){let n;ce(r,Je,m=>t(8,n=m));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:u}=e,l=null,a=null;function p(){l&&(o.stop(),s.stop(),u.stop(),se.update(m=>{let _=m.features.find(k=>k.id==l);return delete _.properties.hide_while_editing,m})),l=null,t(4,a=null),Qe.set(null)}n.on("mousemove",g),n.on("mouseout",c),n.on("click",f),Gt(()=>{n.off("mousemove",g),n.off("mouseout",c),n.off("click",f)}),u.addEventListenerSuccessRoute(m=>{i==Ke&&(se.update(_=>{let k=_.features.find(d=>d.id==l);return k.properties.length_meters=m.properties.length_meters,k.properties.waypoints=m.properties.waypoints,delete k.properties.hide_while_editing,k.geometry=m.geometry,_}),l=null,t(4,a=null))}),u.addEventListenerSuccessArea(m=>{i==Ke&&(se.update(_=>{let k=_.features.find(d=>d.id==l);return k.properties.waypoints=m.properties.waypoints,delete k.properties.hide_while_editing,k.geometry=m.geometry,_}),l=null,t(4,a=null))});for(let m of[o,s])m.addEventListenerSuccess(_=>{i==Ke&&(se.update(k=>{let d=k.features.find(v=>v.id==l);return d.geometry=_.geometry,delete d.properties.hide_while_editing,k}),l=null,t(4,a=null))});for(let m of[o,s,u])m.addEventListenerFailure(()=>{i==Ke&&(se.update(_=>{let k=_.features.find(d=>d.id==l);return delete k.properties.hide_while_editing,_}),l=null,t(4,a=null))});function g(m){var _;if(i==Ke&&l==null){let k=n.queryRenderedFeatures(m.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Qe.set(((_=k[0])==null?void 0:_.id)||null)}}function c(){i==Ke&&l==null&&Qe.set(null)}function f(m){if(i==Ke&&l==null){let _=n.queryRenderedFeatures(m.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&h(_[0].id)}}function h(m){Qe.set(null);let _=null;se.update(d=>(_=d.features.find(v=>v.id==m),_.properties.hide_while_editing=!0,d));let k=_;l=m,k.geometry.type=="LineString"?(u.editExistingRoute(k),t(4,a="route")):k.geometry.type=="Polygon"?k.properties.waypoints?(u.editExistingArea(k),t(4,a="snap-polygon")):(s.editExisting(k),t(4,a="free-polygon")):k.geometry.type=="Point"&&(o.start(),t(4,a="point"))}return r.$$set=m=>{"mode"in m&&t(0,i=m.mode),"pointTool"in m&&t(1,o=m.pointTool),"polygonTool"in m&&t(2,s=m.polygonTool),"routeTool"in m&&t(3,u=m.routeTool)},[i,o,s,u,a,fi,p]}class dl extends re{constructor(e){super(),ie(this,e,hl,pl,ne,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return fi}get stop(){return this.$$.ctx[6]}}async function ml(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:a,value:p}=await n.read();if(a)break;s.push(p),o+=p.length;const g=100*o/i;e.style=`background: linear-gradient(to right, red ${g}%, transparent 0);`}let u=new Uint8Array(o),l=0;for(let a of s)u.set(a,l),l+=a.length;return u}function _l(r){let e,t;return e=new ai({props:{routeTool:r[0]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function gl(r){let e;return{c(){e=S("div"),e.textContent="Route tool loading..."},m(t,n){y(t,e,n),r[7](e)},p:U,i:U,o:U,d(t){t&&w(e),r[7](null)}}}function vl(r){let e,t,n,i;const o=[gl,_l],s=[];function u(l,a){return l[0]?l[1]==In?1:-1:0}return~(e=u(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=Me()},m(l,a){~e&&s[e].m(l,a),y(l,n,a),i=!0},p(l,[a]){let p=e;e=u(l),e===p?~e&&s[e].p(l,a):(t&&(Re(),F(s[p],1,1,()=>{s[p]=null}),Te()),~e?(t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),P(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(P(t),i=!0)},o(l){F(t),i=!1},d(l){~e&&s[e].d(l),l&&w(n)}}}const In="route";function bl(r,e,t){let n;ce(r,Je,c=>t(8,n=c));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,u,{routeTool:l}=e;function a(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}Bn(async()=>{await ii(),console.log(`Grabbing ${s}`);try{const c=await ml(s,u);t(0,l=new zs(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,u.innerHTML="Failed to load",u);return}l.addEventListenerFailure(()=>{i==In&&o("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{i==In&&(se.update(f=>(c.id=zt(f),c.properties.intervention_type="route",f.features.push(c),f)),o("edit-attribute"),xe.set(c.id))})});function g(c){ge[c?"unshift":"push"](()=>{u=c,t(2,u)})}return r.$$set=c=>{"mode"in c&&t(1,i=c.mode),"changeMode"in c&&t(3,o=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,i,u,o,s,a,p,g]}class yl extends re{constructor(e){super(),ie(this,e,bl,vl,ne,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Ir(r){let e,t;return e=new si({props:{pointTool:r[1],editingExisting:!1}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function wl(r){let e,t,n=r[0]==ln&&Ir(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==ln?n?(n.p(i,o),o&1&&P(n,1)):(n=Ir(i),n.c(),P(n,1),n.m(e.parentNode,e)):n&&(Re(),F(n,1,1,()=>{n=null}),Te())},i(i){t||(P(n),t=!0)},o(i){F(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const ln="point";function kl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==ln&&(se.update(a=>(l.id=zt(a),l.properties.intervention_type="other",a.features.push(l),a)),i("edit-attribute"),xe.set(l.id))}),o.addEventListenerFailure(()=>{n==ln&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,u]}class Sl extends re{constructor(e){super(),ie(this,e,kl,wl,ne,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function $r(r){let e,t;return e=new li({props:{polygonTool:r[1]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function El(r){let e,t,n=r[0]==un&&$r(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==un?n?(n.p(i,o),o&1&&P(n,1)):(n=$r(i),n.c(),P(n,1),n.m(e.parentNode,e)):n&&(Re(),F(n,1,1,()=>{n=null}),Te())},i(i){t||(P(n),t=!0)},o(i){F(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const un="free-polygon";function Ml(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==un&&(se.update(a=>(l.id=zt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),xe.set(l.id))}),o.addEventListenerFailure(()=>{n==un&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,u]}class Ll extends re{constructor(e){super(),ie(this,e,Ml,El,ne,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Br(r){let e,t;return e=new ui({props:{routeTool:r[1]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){F(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function Ol(r){let e,t,n=r[0]==an&&Br(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==an?n?(n.p(i,o),o&1&&P(n,1)):(n=Br(i),n.c(),P(n,1),n.m(e.parentNode,e)):n&&(Re(),F(n,1,1,()=>{n=null}),Te())},i(i){t||(P(n),t=!0)},o(i){F(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const an="snap-polygon";function Rl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function u(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==an&&(se.update(a=>(l.id=zt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),xe.set(l.id))}),o.addEventListenerFailure(()=>{n==an&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,u]}class Tl extends re{constructor(e){super(),ie(this,e,Rl,Ol,ne,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Cl(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=tt(r.slice(0,2),[n,t]),s=tt(r.slice(0,2),[e,i]);if(o>=s){var u=(t+i)/2;return[e,u-(n-e)/2,n,u+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Al(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return Ci(r,function(s){Pl(s,o,n)}),r}function Pl(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Fl(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=An(r),n=An(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Al(e,{precision:7});switch(n){case"Point":return $n(r,i);case"MultiPoint":return Dr(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Dr(r,ni(r,i))}}function Dr(r,e){var t=[],n=kt();return qn(e,function(i){if(t.forEach(function(u,l){u.id=l}),!t.length)t=$n(r,i).features,t.forEach(function(u){u.bbox||(u.bbox=Cl(Ai(u)))}),n.load(ot(t));else{var o=n.search(i);if(o.features.length){var s=ci(i,o);t=t.filter(function(u){return u.id!==s.id}),n.remove(s),Qt($n(s,i),function(u){t.push(u),n.insert(u)})}}}),ot(t)}function $n(r,e){var t=[],n=Ue(r)[0],i=Ue(r)[r.geometry.coordinates.length-1];if(wn(n,st(e))||wn(i,st(e)))return ot([r]);var o=kt(),s=Pn(r);o.load(s);var u=o.search(e);if(!u.features.length)return ot([r]);var l=ci(e,u),a=[n],p=Pi(s,function(g,c,f){var h=Ue(c)[1],m=st(e);return f===l.id?(g.push(m),t.push(wt(g)),wn(m,h)?[m]:[m,h]):(g.push(h),g)},a);return p.length>1&&t.push(wt(p)),ot(t)}function ci(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return Qt(e,function(i){var o=jt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function wn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Nl(r,e,t){var n=Ue(t);if(An(t)!=="LineString")throw new Error("line must be a LineString");var i=jt(t,r),o=jt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var u=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)u.push(n[l]);return u.push(s[1].geometry.coordinates),wt(u,t.properties)}function qr(r){let e;return{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function xl(r){let e,t,n,i=r[0]==Bt&&qr();return{c(){i&&i.c(),e=Me()},m(o,s){i&&i.m(o,s),y(o,e,s),t||(n=q(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Bt?i||(i=qr(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:U,o:U,d(o){i&&i.d(o),o&&w(e),t=!1,n()}}}const Bt="split-route",Il=10,$l=30;let kn="split-route";function pi(){}function jr(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Bl(r,e,t){let n,i;ce(r,se,m=>t(8,n=m)),ce(r,Je,m=>t(6,i=m));let{mode:o}=e,{changeMode:s}=e;function u(){t(5,l=null),a=null}let l=null,a=null;i.on("mousemove",p),i.on("click",g),Gt(()=>{i.off("mousemove",p),i.off("click",g)}),at(i,kn,{type:"geojson",data:Xe()}),Pe(i,{id:"draw-split-route",source:kn,...St("black",Il,["case",["==",["get","snapped"],!0],1,.5])});function p(m){if(o!=Bt)return;t(5,l=jr(m.lngLat.toArray(),!1)),a=null;const _=[m.point.x-$l,m.point.y],k=i.unproject(m.point).distanceTo(i.unproject(_))/1e3;let d=[];for(let[v,b]of n.features.entries())if(b.geometry.type=="LineString"){let O=jt(b.geometry,l,{units:"kilometers"});O.properties.dist!=null&&O.properties.dist<=k&&d.push([v,O.geometry.coordinates,O.properties.dist])}d.sort((v,b)=>v[2]-b[2]),d.length>0&&(t(5,l=jr(d[0][1],!0)),a=d[0][0])}function g(){if(o==Bt)if(a==null)s("edit-attribute");else{let m=Fl(n.features[a],l);if(m.features.length==2){let _=m.features[0],k=m.features[1];se.update(d=>(_.id=d.features[a].id,k.id=zt(d),_.properties=JSON.parse(JSON.stringify(d.features[a].properties)),k.properties=JSON.parse(JSON.stringify(_.properties)),c(d.features[a],_,k,l),d.features.splice(a,1,_,k),d))}u()}}function c(m,_,k,d){_.properties.length_meters=Xt(_,{units:"kilometers"})*1e3,k.properties.length_meters=Xt(k,{units:"kilometers"})*1e3,_.properties.waypoints=[],k.properties.waypoints=[];let v=f(m,d),b=!0,O=0;for(let C of m.properties.waypoints){let A=f(m,yt([C.lon,C.lat]));if(b)if(A<v)_.properties.waypoints.push(C);else{let R=C.snapped&&m.properties.waypoints[O-1].snapped;_.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:R}),b=!1,k.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:R}),k.properties.waypoints.push(C)}else k.properties.waypoints.push(C);O++}}function f(m,_){let k=m.geometry.coordinates[0],d=Nl(k,_,m);return Xt(d,{units:"kilometers"})*1e3}function h(m){o==Bt&&m.key=="Escape"&&(s("edit-attribute"),m.preventDefault())}return r.$$set=m=>{"mode"in m&&t(0,o=m.mode),"changeMode"in m&&t(2,s=m.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let m=Xe();l&&m.features.push(l),i.getSource(kn).setData(m)}},[o,h,s,pi,u,l,i]}class Dl extends re{constructor(e){super(),ie(this,e,Bl,xl,ne,{mode:0,changeMode:2,start:3,stop:4})}get start(){return pi}get stop(){return this.$$.ctx[4]}}function Gr(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new dl({props:n}),r[17](e),{c(){W(e.$$.fragment)},m(i,o){V(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){F(e.$$.fragment,i),t=!1},d(i){r[17](null),K(e,i)}}}function zr(r){let e,t,n,i,o;return{c(){e=S("button"),t=H("New point"),T(e,"type","button"),e.disabled=n=r[3]=="point",T(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),E(e,t),i||(o=q(e,"click",r[18]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function Yr(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Tl({props:n}),r[23](e),{c(){W(e.$$.fragment)},m(i,o){V(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){F(e.$$.fragment,i),t=!1},d(i){r[23](null),K(e,i)}}}function Hr(r){let e,t,n,i,o;return{c(){e=S("button"),t=H("New route"),T(e,"type","button"),e.disabled=n=r[3]=="route",T(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),E(e,t),i||(o=q(e,"click",r[24]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function Ur(r){let e,t,n,i,o;return{c(){e=S("button"),t=H("Split route"),T(e,"type","button"),e.disabled=n=r[3]=="split-route",T(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),E(e,t),i||(o=q(e,"click",r[27]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function ql(r){let e,t,n,i,o,s,u,l,a,p,g,c,f,h,m,_,k,d,v,b,O,C,A,R,$,D,B,X,N,z,te,he,j,le,we,Fe,de,ae,Le,ue,x,Q,Mt={mode:r[3],changeMode:r[13]};u=new Js({props:Mt}),r[15](u);let me=r[2]&&Gr(r),ke=r[1]!="planning"&&zr(r),Lt={mode:r[3],changeMode:r[13],pointTool:r[11]};k=new Sl({props:Lt}),r[19](k);let ut={mode:r[3],changeMode:r[13],polygonTool:r[12]};R=new Ll({props:ut}),r[21](R);let ve=r[2]&&Yr(r),fe=r[1]!="planning"&&Hr(r);function Ot(G){r[26](G)}let Rt={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(Rt.routeTool=r[2]),le=new yl({props:Rt}),r[25](le),ge.push(()=>Be(le,"routeTool",Ot,r[2]));let be=r[1]!="planning"&&Ur(r),Ce={mode:r[3],changeMode:r[13]};return Le=new Dl({props:Ce}),r[28](Le),{c(){e=S("div"),t=S("div"),n=S("button"),i=H("Edit attributes"),s=L(),W(u.$$.fragment),l=L(),a=S("div"),p=S("button"),g=H("Edit geometry"),f=L(),me&&me.c(),h=L(),m=S("div"),ke&&ke.c(),_=L(),W(k.$$.fragment),d=L(),v=S("div"),b=S("button"),O=H("New polygon (freehand)"),A=L(),W(R.$$.fragment),$=L(),D=S("div"),B=S("button"),X=H("New polygon (snapped)"),z=L(),ve&&ve.c(),te=L(),he=S("div"),fe&&fe.c(),j=L(),W(le.$$.fragment),Fe=L(),de=S("div"),be&&be.c(),ae=L(),W(Le.$$.fragment),T(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",T(n,"class","svelte-cej5os"),T(p,"type","button"),p.disabled=c=r[3]=="edit-geometry",T(p,"class","svelte-cej5os"),T(b,"type","button"),b.disabled=C=r[3]=="free-polygon",T(b,"class","svelte-cej5os"),T(B,"type","button"),B.disabled=N=r[3]=="snap-polygon",T(B,"class","svelte-cej5os"),T(e,"class","toolbox svelte-cej5os")},m(G,ee){y(G,e,ee),E(e,t),E(t,n),E(n,i),E(t,s),V(u,t,null),E(e,l),E(e,a),E(a,p),E(p,g),E(a,f),me&&me.m(a,null),E(e,h),E(e,m),ke&&ke.m(m,null),E(m,_),V(k,m,null),E(e,d),E(e,v),E(v,b),E(b,O),E(v,A),V(R,v,null),E(e,$),E(e,D),E(D,B),E(B,X),E(D,z),ve&&ve.m(D,null),E(e,te),E(e,he),fe&&fe.m(he,null),E(he,j),V(le,he,null),E(e,Fe),E(e,de),be&&be.m(de,null),E(de,ae),V(Le,de,null),ue=!0,x||(Q=[q(n,"click",r[14]),q(p,"click",r[16]),q(b,"click",r[20]),q(B,"click",r[22])],x=!0)},p(G,[ee]){(!ue||ee&8&&o!==(o=G[3]=="edit-attribute"))&&(n.disabled=o);const We={};ee&8&&(We.mode=G[3]),u.$set(We),(!ue||ee&8&&c!==(c=G[3]=="edit-geometry"))&&(p.disabled=c),G[2]?me?(me.p(G,ee),ee&4&&P(me,1)):(me=Gr(G),me.c(),P(me,1),me.m(a,null)):me&&(Re(),F(me,1,1,()=>{me=null}),Te()),G[1]!="planning"?ke?ke.p(G,ee):(ke=zr(G),ke.c(),ke.m(m,_)):ke&&(ke.d(1),ke=null);const Oe={};ee&8&&(Oe.mode=G[3]),k.$set(Oe),(!ue||ee&8&&C!==(C=G[3]=="free-polygon"))&&(b.disabled=C);const Ve={};ee&8&&(Ve.mode=G[3]),R.$set(Ve),(!ue||ee&8&&N!==(N=G[3]=="snap-polygon"))&&(B.disabled=N),G[2]?ve?(ve.p(G,ee),ee&4&&P(ve,1)):(ve=Yr(G),ve.c(),P(ve,1),ve.m(D,null)):ve&&(Re(),F(ve,1,1,()=>{ve=null}),Te()),G[1]!="planning"?fe?fe.p(G,ee):(fe=Hr(G),fe.c(),fe.m(he,j)):fe&&(fe.d(1),fe=null);const ye={};ee&8&&(ye.mode=G[3]),ee&1&&(ye.url=G[0]),!we&&ee&4&&(we=!0,ye.routeTool=G[2],De(()=>we=!1)),le.$set(ye),G[1]!="planning"?be?be.p(G,ee):(be=Ur(G),be.c(),be.m(de,ae)):be&&(be.d(1),be=null);const M={};ee&8&&(M.mode=G[3]),Le.$set(M)},i(G){ue||(P(u.$$.fragment,G),P(me),P(k.$$.fragment,G),P(R.$$.fragment,G),P(ve),P(le.$$.fragment,G),P(Le.$$.fragment,G),ue=!0)},o(G){F(u.$$.fragment,G),F(me),F(k.$$.fragment,G),F(R.$$.fragment,G),F(ve),F(le.$$.fragment,G),F(Le.$$.fragment,G),ue=!1},d(G){G&&w(e),r[15](null),K(u),me&&me.d(),ke&&ke.d(),r[19](null),K(k),r[21](null),K(R),ve&&ve.d(),fe&&fe.d(),r[25](null),K(le),be&&be.d(),r[28](null),K(Le),x=!1,Ie(Q)}}}function jl(r,e,t){let n;ce(r,Je,j=>t(29,n=j));let{routeUrl:i}=e,{schema:o}=e,s,u=new ks(n),l=new Ns(n),a="edit-attribute",p,g,c,f,h,m,_;function k(j){let le={"edit-attribute":p,"edit-geometry":g,route:c,point:f,"free-polygon":h,"snap-polygon":m,"split-route":_};if(a==j){console.log(`Mode is already ${a}, not changing`);return}console.log(`Stopping old mode ${a}`),le[a].stop(),t(3,a=j),console.log(`Starting new mode ${a}`),le[a].start()}Gt(()=>{u==null||u.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const d=()=>k("edit-attribute");function v(j){ge[j?"unshift":"push"](()=>{p=j,t(4,p)})}const b=()=>k("edit-geometry");function O(j){ge[j?"unshift":"push"](()=>{g=j,t(5,g)})}const C=()=>k("point");function A(j){ge[j?"unshift":"push"](()=>{f=j,t(7,f)})}const R=()=>k("free-polygon");function $(j){ge[j?"unshift":"push"](()=>{h=j,t(8,h)})}const D=()=>k("snap-polygon");function B(j){ge[j?"unshift":"push"](()=>{m=j,t(9,m)})}const X=()=>k("route");function N(j){ge[j?"unshift":"push"](()=>{c=j,t(6,c)})}function z(j){s=j,t(2,s)}const te=()=>k("split-route");function he(j){ge[j?"unshift":"push"](()=>{_=j,t(10,_)})}return r.$$set=j=>{"routeUrl"in j&&t(0,i=j.routeUrl),"schema"in j&&t(1,o=j.schema)},[i,o,s,a,p,g,c,f,h,m,_,u,l,k,d,v,b,O,C,A,R,$,D,B,X,N,z,te,he]}class Gl extends re{constructor(e){super(),ie(this,e,jl,ql,ne,{routeUrl:0,schema:1})}}function zl(r){let e,t,n,i,o,s,u,l,a,p,g,c,f,h,m,_,k,d;return{c(){e=S("div"),t=S("div"),n=S("button"),n.textContent="Home",i=L(),o=S("button"),o.textContent="About",s=L(),u=S("button"),u.textContent="Instructions",l=L(),a=S("br"),p=L(),g=S("label"),c=H(`ATIP schema:
      `),f=S("select"),h=S("option"),h.textContent="Design (v1)",m=S("option"),m.textContent="Design (v2)",_=S("option"),_.textContent="Planning",T(n,"type","button"),T(o,"type","button"),T(u,"type","button"),h.__value="v1",h.value=h.__value,m.__value="v2",m.value=m.__value,_.__value="planning",_.value=_.__value,r[2]===void 0&&nt(()=>r[11].call(f)),T(e,"slot","nav")},m(v,b){y(v,e,b),E(e,t),E(t,n),E(t,i),E(t,o),E(t,s),E(t,u),E(e,l),E(e,a),E(e,p),E(e,g),E(g,c),E(g,f),E(f,h),E(f,m),E(f,_),$e(f,r[2]),k||(d=[q(n,"click",r[10]),q(o,"click",r[7]),q(u,"click",r[8]),q(f,"change",r[11]),q(f,"change",r[9])],k=!0)},p(v,b){b&4&&$e(f,v[2])},d(v){v&&w(e),k=!1,Ie(d)}}}function Yl(r){let e,t,n,i,o,s,u,l,a,p,g,c;return o=new as({props:{boundaryGeojson:r[4]}}),u=new os({props:{authorityName:r[5],schema:r[2]}}),g=new es({props:{schema:r[2]}}),{c(){e=S("div"),t=S("h1"),n=H(r[5]),i=L(),W(o.$$.fragment),s=L(),W(u.$$.fragment),l=L(),a=S("br"),p=L(),W(g.$$.fragment),T(e,"slot","sidebar")},m(f,h){y(f,e,h),E(e,t),E(t,n),E(t,i),V(o,t,null),E(e,s),V(u,e,null),E(e,l),E(e,a),E(e,p),V(g,e,null),c=!0},p(f,h){const m={};h&16&&(m.boundaryGeojson=f[4]),o.$set(m);const _={};h&4&&(_.schema=f[2]),u.$set(_);const k={};h&4&&(k.schema=f[2]),g.$set(k)},i(f){c||(P(o.$$.fragment,f),P(u.$$.fragment,f),P(g.$$.fragment,f),c=!0)},o(f){F(o.$$.fragment,f),F(u.$$.fragment,f),F(g.$$.fragment,f),c=!1},d(f){f&&w(e),K(o),K(u),K(g)}}}function Hl(r){let e,t,n,i,o,s,u,l,a,p,g,c;return e=new wo({props:{boundaryGeojson:r[4]}}),n=new bs({props:{schema:r[2]}}),o=new ws({}),u=new Gl({props:{routeUrl:r[3],schema:r[2]}}),a=new ps({props:{style:r[6]}}),g=new gs({props:{schema:r[2]}}),{c(){W(e.$$.fragment),t=L(),W(n.$$.fragment),i=L(),W(o.$$.fragment),s=L(),W(u.$$.fragment),l=L(),W(a.$$.fragment),p=L(),W(g.$$.fragment)},m(f,h){V(e,f,h),y(f,t,h),V(n,f,h),y(f,i,h),V(o,f,h),y(f,s,h),V(u,f,h),y(f,l,h),V(a,f,h),y(f,p,h),V(g,f,h),c=!0},p(f,h){const m={};h&16&&(m.boundaryGeojson=f[4]),e.$set(m);const _={};h&4&&(_.schema=f[2]),n.$set(_);const k={};h&8&&(k.routeUrl=f[3]),h&4&&(k.schema=f[2]),u.$set(k);const d={};h&4&&(d.schema=f[2]),g.$set(d)},i(f){c||(P(e.$$.fragment,f),P(n.$$.fragment,f),P(o.$$.fragment,f),P(u.$$.fragment,f),P(a.$$.fragment,f),P(g.$$.fragment,f),c=!0)},o(f){F(e.$$.fragment,f),F(n.$$.fragment,f),F(o.$$.fragment,f),F(u.$$.fragment,f),F(a.$$.fragment,f),F(g.$$.fragment,f),c=!1},d(f){K(e,f),f&&w(t),K(n,f),f&&w(i),K(o,f),f&&w(s),K(u,f),f&&w(l),K(a,f),f&&w(p),K(g,f)}}}function Ul(r){let e,t,n;return t=new ji({props:{style:r[6],$$slots:{default:[Hl]},$$scope:{ctx:r}}}),{c(){e=S("div"),W(t.$$.fragment),T(e,"slot","main")},m(i,o){y(i,e,o),V(t,e,null),n=!0},p(i,o){const s={};o&131100&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(P(t.$$.fragment,i),n=!0)},o(i){F(t.$$.fragment,i),n=!1},d(i){i&&w(e),K(t)}}}function Xl(r){let e,t,n,i,o,s,u,l;e=new Xi({props:{$$slots:{main:[Ul],sidebar:[Yl],nav:[zl]},$$scope:{ctx:r}}});function a(f){r[12](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new Fi({props:p}),ge.push(()=>Be(n,"open",a,r[0]));function g(f){r[13](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Bi({props:c}),ge.push(()=>Be(s,"open",g,r[1])),{c(){W(e.$$.fragment),t=L(),W(n.$$.fragment),o=L(),W(s.$$.fragment)},m(f,h){V(e,f,h),y(f,t,h),V(n,f,h),y(f,o,h),V(s,f,h),l=!0},p(f,[h]){const m={};h&131100&&(m.$$scope={dirty:h,ctx:f}),e.$set(m);const _={};!i&&h&1&&(i=!0,_.open=f[0],De(()=>i=!1)),n.$set(_);const k={};!u&&h&2&&(u=!0,k.open=f[1],De(()=>u=!1)),s.$set(k)},i(f){l||(P(e.$$.fragment,f),P(n.$$.fragment,f),P(s.$$.fragment,f),l=!0)},o(f){F(e.$$.fragment,f),F(n.$$.fragment,f),F(s.$$.fragment,f),l=!1},d(f){K(e,f),f&&w(t),K(n,f),f&&w(o),K(s,f)}}}function Jl(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let u=s.get("authority"),l=s.get("style")||"streets",a=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${u}.bin`;o||(p=`https://atip.uk/route-snappers-dev/${u}.bin`);function g(){t(0,n=!n),t(1,i=!1)}function c(){t(1,i=!i),t(0,n=!1)}let f;Bn(async()=>{t(4,f=await h())});async function h(){const O=await(await fetch(Ni)).text(),C=JSON.parse(O);return C.features=C.features.filter(A=>{var R;return((R=A.properties)==null?void 0:R.name)==u}),C}function m(){let b=new URLSearchParams(window.location.search);b.set("schema",a);let O=`${window.location.pathname}?${b.toString()}${window.location.hash}`;window.location.href=O}const _=()=>window.open("index.html");function k(){a=gt(this),t(2,a)}function d(b){n=b,t(0,n)}function v(b){i=b,t(1,i)}return[n,i,a,p,f,u,l,g,c,m,_,k,d,v]}class Wl extends re{constructor(e){super(),ie(this,e,Jl,Xl,ne,{})}}new Wl({target:document.getElementById("app")});
