var ii=Object.defineProperty;var oi=(r,e,t)=>e in r?ii(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var oe=(r,e,t)=>(oi(r,typeof e!="symbol"?e+"":e,t),t);import{S as re,i as ie,s as ne,M as si,b as be,a as Ye,d as I,m as B,k as He,n as L,o as T,q as D,e as k,c as M,g as y,x as W,p as w,y as Xe,f as P,z as Fe,B as Ne,C as li,D as Fn,E as dn,F as Gt,G as Lt,H as Rt,I as Tt,J as At,K as qn,h as S,l as Y,L as ui,N as ai,O as ce,P as fi,w as Nn,Q as at,R as Ce,T as ln,t as J,U as Pe,V as pe,j as Te,r as qe,W as un,X as ut,Y as Oe,Z as Gr,_ as jt,$ as mt,a0 as jn,a1 as zn,a2 as Yn,a3 as ci,a4 as pi,a5 as De,a6 as hi,a7 as di,a8 as mi,a9 as an,aa as wt,ab as fn,ac as It,ad as cn,ae as yn,af as gi,ag as vt,ah as In,ai as it,aj as bt,ak as _i,al as Bn,am as vi,an as bi,ao as yi,ap as Hn,aq as Kt,ar as wi,as as ki,at as $i,A as Si,u as Ei}from"./authorities-0eef0671.js";function Mi(r){let e,t,n,i,o,s,u,l,a,c,_,p,f;return{c(){e=k("p"),e.textContent="For each intervention:",t=M(),n=k("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=M(),o=k("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=M(),u=k("p"),u.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=M(),a=k("p"),a.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,c=M(),_=k("p"),_.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,p=M(),f=k("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(d,m){y(d,e,m),y(d,t,m),y(d,n,m),y(d,i,m),y(d,o,m),y(d,s,m),y(d,u,m),y(d,l,m),y(d,a,m),y(d,c,m),y(d,_,m),y(d,p,m),y(d,f,m)},p:W,d(d){d&&w(e),d&&w(t),d&&w(n),d&&w(i),d&&w(o),d&&w(s),d&&w(u),d&&w(l),d&&w(a),d&&w(c),d&&w(_),d&&w(p),d&&w(f)}}}function xi(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Mi]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new si({props:o}),be.push(()=>Ye(e,"open",i,r[0])),{c(){I(e.$$.fragment)},m(s,u){B(e,s,u),n=!0},p(s,[u]){const l={};u&4&&(l.$$scope={dirty:u,ctx:s}),!t&&u&1&&(t=!0,l.open=s[0],He(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Ci(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Li extends re{constructor(e){super(),ie(this,e,Ci,xi,ne,{open:0})}}const ft=[];function kt(r,e=W){let t;const n=new Set;function i(u){if(ne(r,u)&&(r=u,t)){const l=!ft.length;for(const a of n)a[1](),ft.push(a,r);if(l){for(let a=0;a<ft.length;a+=2)ft[a][0](ft[a+1]);ft.length=0}}}function o(u){i(u(r))}function s(u,l=W){const a=[u,l];return n.add(a),n.size===1&&(t=e(i)||W),u(r),()=>{n.delete(a),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Je=kt(null),se=kt(Xe()),Ae=kt(null),Qe=kt(null),Zt=kt(null),wn=kt(null);function qt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Un(r){se.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Ae.set(null),Qe.set(null),Zt.set(null)}function Xn(r){let e;const t=r[4].default,n=Lt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Rt(n,t,i,i[3],e?At(t,i[3],o,null):Tt(i[3]),null)},i(i){e||(L(n,i),e=!0)},o(i){T(n,i),e=!1},d(i){n&&n.d(i)}}}function Ri(r){let e,t,n=r[1]&&Xn(r);return{c(){e=k("div"),n&&n.c(),P(e,"class","map svelte-12dpf1u")},m(i,o){y(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&L(n,1)):(n=Xn(i),n.c(),L(n,1),n.m(e,null)):n&&(Fe(),T(n,1,1,()=>{n=null}),Ne())},i(i){t||(L(n),t=!0)},o(i){T(n),t=!1},d(i){i&&w(e),n&&n.d(),r[5](null)}}}function Ti(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,u,l=!1;li("setCamera",!window.location.hash),Fn(()=>{s=new dn.Map({container:u,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new dn.ScaleControl({})),s.addControl(new dn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Je.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(u)}),Gt(()=>{s.remove()});function a(c){be[c?"unshift":"push"](()=>{u=c,t(0,u)})}return r.$$set=c=>{"style"in c&&t(2,o=c.style),"$$scope"in c&&t(3,i=c.$$scope)},[u,l,o,i,n,a]}class Ai extends re{constructor(e){super(),ie(this,e,Ti,Ri,ne,{style:2})}}const Pi=r=>({}),Jn=r=>({}),Oi=r=>({}),Wn=r=>({}),Fi=r=>({}),Vn=r=>({});function Ni(r){let e,t,n,i,o,s,u,l,a,c,_,p;const f=r[3].nav,d=Lt(f,r,r[2],Vn),m=r[3].sidebar,g=Lt(m,r,r[2],Wn),$=r[3].main,h=Lt($,r,r[2],Jn);return{c(){e=k("aside"),t=k("div"),n=k("nav"),d&&d.c(),i=M(),g&&g.c(),o=M(),s=k("button"),s.textContent="→",l=M(),a=k("main"),h&&h.c(),P(n,"class","svelte-1u7vg8a"),P(t,"class","sidebar-content content-container svelte-1u7vg8a"),P(s,"type","button"),P(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),P(e,"class",u=qn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),P(a,"class","svelte-1u7vg8a")},m(v,b){y(v,e,b),S(e,t),S(t,n),d&&d.m(n,null),S(t,i),g&&g.m(t,null),S(e,o),S(e,s),y(v,l,b),y(v,a,b),h&&h.m(a,null),c=!0,_||(p=Y(s,"click",r[1]),_=!0)},p(v,[b]){d&&d.p&&(!c||b&4)&&Rt(d,f,v,v[2],c?At(f,v[2],b,Fi):Tt(v[2]),Vn),g&&g.p&&(!c||b&4)&&Rt(g,m,v,v[2],c?At(m,v[2],b,Oi):Tt(v[2]),Wn),(!c||b&1&&u!==(u=qn(v[0]?"":"collapsed")+" svelte-1u7vg8a"))&&P(e,"class",u),h&&h.p&&(!c||b&4)&&Rt(h,$,v,v[2],c?At($,v[2],b,Pi):Tt(v[2]),Jn)},i(v){c||(L(d,v),L(g,v),L(h,v),c=!0)},o(v){T(d,v),T(g,v),T(h,v),c=!1},d(v){v&&w(e),d&&d.d(v),g&&g.d(v),v&&w(l),v&&w(a),h&&h.d(v),_=!1,p()}}}function Ii(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=u=>{"$$scope"in u&&t(2,i=u.$$scope)},[o,s,i,n]}class Bi extends re{constructor(e){super(),ie(this,e,Ii,Ni,ne,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Di(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(c){return l([a,c])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(c){a=[6,c],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var st=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Gi(r,e){return r>e?1:r<e?-1:0}function et(r,e,t){for(var n=new st(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function mn(r,e,t,n){var i=new st(r,e);if(t===null)return i.left=i.right=null,i;t=et(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Kn(r,e,t){var n=null,i=null;if(e){e=et(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function qi(r,e,t){return e===null?r:(r===null||(e=et(r.key,e,t),e.left=r),e)}function kn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&kn(r.left,o,!1,n,i),r.right&&kn(r.right,o,!0,n,i)}}var Dn=function(){function r(e){e===void 0&&(e=Gi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=mn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new st(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=et(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=et(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=et(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=et(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=et(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,u=this._root,l;o.length!==0||u;)if(u)o.push(u),u=u.left;else{if(u=o.pop(),l=s(u.key,t),l>0)break;if(s(u.key,e)>=0&&n.call(i,u))return this;u=u.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return zi(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&En(e,t,0,i-1,o),this._root===null)this._root=$n(e,t,0,i),this._size=i;else{var s=Yi(this.toList(),ji(e,t),o);i=this._size+i,this._root=Sn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return kn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Kn(e,this._root,i),s=o.left,u=o.right;i(e,t)<0?u=mn(t,n,u,i):s=mn(t,n,s,i),this._root=qi(s,u,i)},r.prototype.split=function(e){return Kn(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Di(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function $n(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],u=e[o],l=new st(s,u);return l.left=$n(r,e,t,o),l.right=$n(r,e,o+1,n),l}return null}function ji(r,e){for(var t=new st(null,null),n=t,i=0;i<r.length;i++)n=n.next=new st(r[i],e[i]);return n.next=null,t.next}function zi(r){for(var e=r,t=[],n=!1,i=new st(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Sn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Sn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Sn(r,i+1,t),s}return null}function Yi(r,e,t){for(var n=new st(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function En(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,u=n+1;;){do s++;while(i(r[s],o)<0);do u--;while(i(r[u],o)>0);if(s>=u)break;var l=r[s];r[s]=r[u],r[u]=l,l=e[s],e[s]=e[u],e[u]=l}En(r,e,t,u,i),En(r,e,u+1,n,i)}}function Ie(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Zn(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Re(r,e,t){return e&&Zn(r.prototype,e),t&&Zn(r,t),r}var xt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Mn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},nt=Number.EPSILON;nt===void 0&&(nt=Math.pow(2,-52));var Hi=nt*nt,xn=function(e,t){if(-nt<e&&e<nt&&-nt<t&&t<nt)return 0;var n=e-t;return n*n<Hi*e*t?0:e<t?-1:1},Ui=function(){function r(){Ie(this,r),this.reset()}return Re(r,[{key:"reset",value:function(){this.xRounder=new Qn,this.yRounder=new Qn}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Qn=function(){function r(){Ie(this,r),this.tree=new Dn,this.round(0)}return Re(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&xn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&xn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Bt=new Ui,Pt=function(e,t){return e.x*t.y-e.y*t.x},qr=function(e,t){return e.x*t.x+e.y*t.y},er=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Pt(i,o);return xn(s,0)},Qt=function(e){return Math.sqrt(qr(e,e))},Xi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Pt(o,i)/Qt(o)/Qt(i)},Ji=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return qr(o,i)/Qt(o)/Qt(i)},tr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},nr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},Wi=function(e,t,n,i){if(t.x===0)return nr(n,i,e.x);if(i.x===0)return nr(e,t,n.x);if(t.y===0)return tr(n,i,e.y);if(i.y===0)return tr(e,t,n.y);var o=Pt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},u=Pt(s,t)/o,l=Pt(s,i)/o,a=e.x+l*t.x,c=n.x+u*i.x,_=e.y+l*t.y,p=n.y+u*i.y,f=(a+c)/2,d=(_+p)/2;return{x:f,y:d}},ze=function(){Re(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:en.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Ie(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Re(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(u){var l=u.otherSE;i.set(u,{sine:Xi(n.point,t.point,l.point),cosine:Ji(n.point,t.point,l.point)})};return function(s,u){i.has(s)||o(s),i.has(u)||o(u);var l=i.get(s),a=l.sine,c=l.cosine,_=i.get(u),p=_.sine,f=_.cosine;return a>=0&&p>=0?c<f?1:c>f?-1:0:a<0&&p<0?c<f?-1:c>f?1:0:p<a?-1:p>a?1:0}}}]),r}(),Vi=0,en=function(){Re(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,u=n.rightSE.point.x;if(u<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,a=n.leftSE.point.y,c=t.rightSE.point.y,_=n.rightSE.point.y;if(i<o){if(a<l&&a<c)return 1;if(a>l&&a>c)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<a&&l<_)return-1;if(l>a&&l>_)return 1;var d=n.comparePoint(t.leftSE.point);if(d!==0)return d;var m=t.comparePoint(n.rightSE.point);return m<0?1:m>0?-1:1}if(l<a)return-1;if(l>a)return 1;if(s<u){var g=n.comparePoint(t.rightSE.point);if(g!==0)return g}if(s>u){var $=t.comparePoint(n.rightSE.point);if($<0)return 1;if($>0)return-1}if(s!==u){var h=c-l,v=s-i,b=_-a,x=u-o;if(h>v&&b<x)return 1;if(h<v&&b>x)return-1}return s>u?1:s<u||c<_?-1:c>_?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Ie(this,r),this.id=++Vi,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Re(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,u=n.x+s*o.x;if(t.x===u)return 0;var l=(t.x-n.x)/o.x,a=n.y+l*o.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Mn(n,i);if(o===null)return null;var s=this.leftSE.point,u=this.rightSE.point,l=t.leftSE.point,a=t.rightSE.point,c=xt(n,l)&&this.comparePoint(l)===0,_=xt(i,s)&&t.comparePoint(s)===0,p=xt(n,a)&&this.comparePoint(a)===0,f=xt(i,u)&&t.comparePoint(u)===0;if(_&&c)return f&&!p?u:!f&&p?a:null;if(_)return p&&s.x===a.x&&s.y===a.y?null:s;if(c)return f&&u.x===l.x&&u.y===l.y?null:l;if(f&&p)return null;if(f)return u;if(p)return a;var d=Wi(s,this.vector(),l,t.vector());return d===null||!xt(o,d)?null:Bt.round(d.x,d.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new ze(t,!0),s=new ze(t,!1),u=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,u,this.rings.slice(),this.windings.slice());return ze.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),ze.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var u=n;n=i,i=u}for(var l=0,a=i.rings.length;l<a;l++){var c=i.rings[l],_=i.windings[l],p=n.rings.indexOf(c);p===-1?(n.rings.push(c),n.windings.push(_)):n.windings[p]+=_}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,u=this.rings.length;s<u;s++){var l=this.rings[s],a=this.windings[s],c=n.indexOf(l);c===-1?(n.push(l),i.push(a)):i[c]+=a}for(var _=[],p=[],f=0,d=n.length;f<d;f++)if(i[f]!==0){var m=n[f],g=m.poly;if(p.indexOf(g)===-1)if(m.isExterior)_.push(g);else{p.indexOf(g)===-1&&p.push(g);var $=_.indexOf(m.poly);$!==-1&&_.splice($,1)}}for(var h=0,v=_.length;h<v;h++){var b=_[h].multiPoly;o.indexOf(b)===-1&&o.push(b)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ge.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,u;t.length<n.length?(s=t.length,u=n.length):(s=n.length,u=t.length),this._isInResult=u===Ge.numMultiPolys&&s<u;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var a=function(_){return _.length===1&&_[0].isSubject};this._isInResult=a(t)!==a(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ge.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,u,l=ze.comparePoints(t,n);if(l<0)o=t,s=n,u=1;else if(l>0)o=n,s=t,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var a=new ze(o,!0),c=new ze(s,!1);return new r(a,c,[i],[u])}}]),r}(),rr=function(){function r(e,t,n){if(Ie(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Bt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,u=e.length;s<u;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Bt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(en.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(en.fromRing(o,i,this))}return Re(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),Ki=function(){function r(e,t){if(Ie(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new rr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new rr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Re(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),ir=function(){function r(e,t){if(Ie(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new Ki(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Re(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),Zi=function(){Re(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var u=null,l=s.leftSE,a=s.rightSE,c=[l],_=l.point,p=[];u=l,l=a,c.push(l),l.point!==_;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var d=c[0].point,m=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(m.x,", ").concat(m.y,"]."))}if(f.length===1){a=f[0].otherSE;break}for(var g=null,$=0,h=p.length;$<h;$++)if(p[$].point===l.point){g=$;break}if(g!==null){var v=p.splice(g)[0],b=c.splice(v.index);b.unshift(b[0].otherSE),n.push(new r(b.reverse()));continue}p.push({index:c.length,point:l.point});var x=l.getLeftmostComparator(u);a=f.sort(x)[0].otherSE;break}n.push(new r(c))}}return n}}]);function r(e){Ie(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Re(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,u=this.events[i+1].point;er(s,t,u)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],a=n[1];er(l,t,a)===0&&n.shift(),n.push(n[0]);for(var c=this.isExteriorRing()?1:-1,_=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,f=[],d=_;d!=p;d+=c)f.push([n[d].x,n[d].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];ze.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),u=s?s.prevInResult():null;;){if(!s)return null;if(!u)return s.ringOut;if(u.ringOut!==s.ringOut)return u.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=u.prevInResult(),u=s?s.prevInResult():null}}}]),r}(),or=function(){function r(e){Ie(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Re(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),Qi=function(){function r(e){Ie(this,r),this.rings=e,this.polys=this._composePolys(e)}return Re(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new or(s));else{var u=s.enclosingRing();u.poly||n.push(new or(u)),u.poly.addInterior(s)}}return n}}]),r}(),eo=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:en.compare;Ie(this,r),this.queue=e,this.tree=new Dn(t),this.segments=[]}return Re(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,u=o,l=void 0,a=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;a===void 0;)u=this.tree.next(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);if(t.isLeft){var c=null;if(l){var _=l.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(c=_),!l.isAnEndpoint(_)))for(var p=this._splitSafely(l,_),f=0,d=p.length;f<d;f++)i.push(p[f])}var m=null;if(a){var g=a.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(m=g),!a.isAnEndpoint(g)))for(var $=this._splitSafely(a,g),h=0,v=$.length;h<v;h++)i.push($[h])}if(c!==null||m!==null){var b=null;if(c===null)b=m;else if(m===null)b=c;else{var x=ze.comparePoints(c,m);b=x<=0?c:m}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var R=n.split(b),A=0,C=R.length;A<C;A++)i.push(R[A])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&a){var G=l.getIntersection(a);if(G!==null){if(!l.isAnEndpoint(G))for(var j=this._splitSafely(l,G),q=0,V=j.length;q<V;q++)i.push(j[q]);if(!a.isAnEndpoint(G))for(var O=this._splitSafely(a,G),U=0,te=O.length;U<te;U++)i.push(O[U])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),sr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,to=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,no=function(){function r(){Ie(this,r)}return Re(r,[{key:"run",value:function(t,n,i){Ge.type=t,Bt.reset();for(var o=[new ir(n,!0)],s=0,u=i.length;s<u;s++)o.push(new ir(i[s],!1));if(Ge.numMultiPolys=o.length,Ge.type==="difference")for(var l=o[0],a=1;a<o.length;)Mn(o[a].bbox,l.bbox)!==null?a++:o.splice(a,1);if(Ge.type==="intersection"){for(var c=0,_=o.length;c<_;c++)for(var p=o[c],f=c+1,d=o.length;f<d;f++)if(Mn(p.bbox,o[f].bbox)===null)return[]}for(var m=new Dn(ze.compare),g=0,$=o.length;g<$;g++)for(var h=o[g].getSweepEvents(),v=0,b=h.length;v<b;v++)if(m.insert(h[v]),m.size>sr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var x=new eo(m),R=m.size,A=m.pop();A;){var C=A.key;if(m.size===R){var G=C.segment;throw new Error("Unable to pop() ".concat(C.isLeft?"left":"right"," SweepEvent ")+"[".concat(C.point.x,", ").concat(C.point.y,"] from segment #").concat(G.id," ")+"[".concat(G.leftSE.point.x,", ").concat(G.leftSE.point.y,"] -> ")+"[".concat(G.rightSE.point.x,", ").concat(G.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(m.size>sr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(x.segments.length>to)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var j=x.process(C),q=0,V=j.length;q<V;q++){var O=j[q];O.consumedBy===void 0&&m.insert(O)}R=m.size,A=m.pop()}Bt.reset();var U=Zi.factory(x.segments),te=new Qi(U);return te.getGeom()}}]),r}(),Ge=new no,ro=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ge.run("union",e,n)},io=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ge.run("intersection",e,n)},oo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ge.run("xor",e,n)},so=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ge.run("difference",e,n)},Ht={union:ro,intersection:io,xor:oo,difference:so};function lo(r,e){var t=ao(e),n=null;return r.type==="FeatureCollection"?n=uo(r):n=jr(Ht.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function uo(r){var e=r.features.length===2?Ht.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Ht.union.apply(Ht,r.features.map(function(t){return t.geometry.coordinates}));return jr(e)}function jr(r){return ui(r)}function ao(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return ai(t)}function fo(r,e,t){let n;ce(r,Je,s=>t(1,n=s));let{boundaryGeojson:i}=e;return fi("setCamera")&&n.fitBounds(Nn(i),{padding:20,animate:!1}),at(n,"boundary",{type:"geojson",data:lo(i)}),Ce(n,{id:"boundary",source:"boundary",...ln("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class co extends re{constructor(e){super(),ie(this,e,fo,null,ne,{boundaryGeojson:0})}}function lr(r){let e,t=ur(r[3])+"",n;return{c(){e=J("Length: "),n=J(t)},m(i,o){y(i,e,o),y(i,n,o)},p(i,o){o&8&&t!==(t=ur(i[3])+"")&&un(n,t)},d(i){i&&w(e),i&&w(n)}}}function po(r){let e,t,n,i,o,s,u,l,a,c,_,p,f,d,m,g,$,h,v,b,x,R,A,C,G,j,q,V,O,U,te,he,z,le,we,Le,de,ae,Ee,ue=r[3]&&lr(r);return{c(){e=k("label"),t=J("Name:"),n=k("br"),i=M(),o=k("input"),s=M(),u=k("br"),l=M(),a=k("br"),c=M(),_=k("label"),p=k("input"),f=J(`
  Area`),d=M(),m=k("label"),g=k("input"),$=J(`
  Route`),h=M(),v=k("label"),b=k("input"),x=J(`
  Crossing`),R=M(),A=k("label"),C=k("input"),G=J(`
  Other`),j=M(),q=k("br"),V=M(),O=k("br"),U=M(),te=k("label"),he=J("Description:"),z=k("br"),le=M(),we=k("textarea"),Le=M(),ue&&ue.c(),de=Pe(),P(o,"type","text"),pe(o,"width","100%"),P(p,"type","radio"),p.__value="area",p.value=p.__value,r[6][0].push(p),P(g,"type","radio"),g.__value="route",g.value=g.__value,r[6][0].push(g),P(b,"type","radio"),b.__value="crossing",b.value=b.__value,r[6][0].push(b),P(C,"type","radio"),C.__value="other",C.value=C.__value,r[6][0].push(C),pe(we,"width","100%"),P(we,"rows","5"),P(we,"class","svelte-15lna0i")},m(F,Q){y(F,e,Q),S(e,t),S(e,n),S(e,i),S(e,o),Te(o,r[0]),y(F,s,Q),y(F,u,Q),y(F,l,Q),y(F,a,Q),y(F,c,Q),y(F,_,Q),S(_,p),p.checked=p.__value===r[1],S(_,f),y(F,d,Q),y(F,m,Q),S(m,g),g.checked=g.__value===r[1],S(m,$),y(F,h,Q),y(F,v,Q),S(v,b),b.checked=b.__value===r[1],S(v,x),y(F,R,Q),y(F,A,Q),S(A,C),C.checked=C.__value===r[1],S(A,G),y(F,j,Q),y(F,q,Q),y(F,V,Q),y(F,O,Q),y(F,U,Q),y(F,te,Q),S(te,he),S(te,z),S(te,le),S(te,we),Te(we,r[2]),y(F,Le,Q),ue&&ue.m(F,Q),y(F,de,Q),ae||(Ee=[Y(o,"input",r[4]),Y(p,"change",r[5]),Y(g,"change",r[7]),Y(b,"change",r[8]),Y(C,"change",r[9]),Y(we,"input",r[10])],ae=!0)},p(F,[Q]){Q&1&&o.value!==F[0]&&Te(o,F[0]),Q&2&&(p.checked=p.__value===F[1]),Q&2&&(g.checked=g.__value===F[1]),Q&2&&(b.checked=b.__value===F[1]),Q&2&&(C.checked=C.__value===F[1]),Q&4&&Te(we,F[2]),F[3]?ue?ue.p(F,Q):(ue=lr(F),ue.c(),ue.m(de.parentNode,de)):ue&&(ue.d(1),ue=null)},i:W,o:W,d(F){F&&w(e),F&&w(s),F&&w(u),F&&w(l),F&&w(a),F&&w(c),F&&w(_),r[6][0].splice(r[6][0].indexOf(p),1),F&&w(d),F&&w(m),r[6][0].splice(r[6][0].indexOf(g),1),F&&w(h),F&&w(v),r[6][0].splice(r[6][0].indexOf(b),1),F&&w(R),F&&w(A),r[6][0].splice(r[6][0].indexOf(C),1),F&&w(j),F&&w(q),F&&w(V),F&&w(O),F&&w(U),F&&w(te),F&&w(Le),ue&&ue.d(F),F&&w(de),ae=!1,qe(Ee)}}}function ur(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function ho(r,e,t){let{name:n}=e,{intervention_type:i}=e,{description:o}=e,{length_meters:s}=e;const u=[[]];function l(){n=this.value,t(0,n)}function a(){i=this.__value,t(1,i)}function c(){i=this.__value,t(1,i)}function _(){i=this.__value,t(1,i)}function p(){i=this.__value,t(1,i)}function f(){o=this.value,t(2,o)}return r.$$set=d=>{"name"in d&&t(0,n=d.name),"intervention_type"in d&&t(1,i=d.intervention_type),"description"in d&&t(2,o=d.description),"length_meters"in d&&t(3,s=d.length_meters)},[n,i,o,s,l,a,u,c,_,p,f]}class mo extends re{constructor(e){super(),ie(this,e,ho,po,ne,{name:0,intervention_type:1,description:2,length_meters:3})}}function go(r){let e,t,n,i,o,s,u;return{c(){e=k("label"),t=J(r[1]),n=k("br"),i=M(),o=k("input"),P(o,"type","text"),pe(o,"width","100%")},m(l,a){y(l,e,a),S(e,t),S(e,n),S(e,i),S(e,o),Te(o,r[0]),s||(u=Y(o,"input",r[2]),s=!0)},p(l,[a]){a&2&&un(t,l[1]),a&1&&o.value!==l[0]&&Te(o,l[0])},i:W,o:W,d(l){l&&w(e),s=!1,u()}}}function _o(r,e,t){let{label:n}=e,{value:i}=e;function o(){i=this.value,t(0,i)}return r.$$set=s=>{"label"in s&&t(1,n=s.label),"value"in s&&t(0,i=s.value)},[i,n,o]}class vo extends re{constructor(e){super(),ie(this,e,_o,go,ne,{label:1,value:0})}}function bo(r){let e,t,n,i,o,s;return e=new Case({props:{label:"TrafficCalming"}}),n=new Case({props:{label:"ModalFilters"}}),o=new Case({props:{label:"LowSpeed"}}),{c(){I(e.$$.fragment),t=M(),I(n.$$.fragment),i=M(),I(o.$$.fragment)},m(u,l){B(e,u,l),y(u,t,l),B(n,u,l),y(u,i,l),B(o,u,l),s=!0},p:W,i(u){s||(L(e.$$.fragment,u),L(n.$$.fragment,u),L(o.$$.fragment,u),s=!0)},o(u){T(e.$$.fragment,u),T(n.$$.fragment,u),T(o.$$.fragment,u),s=!1},d(u){D(e,u),u&&w(t),D(n,u),u&&w(i),D(o,u)}}}function yo(r){let e,t;return e=new Radio({props:{label:"Reason",$$slots:{default:[bo]},$$scope:{ctx:r}}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function wo(r){let e,t,n,i,o,s,u,l,a,c,_,p;return e=new Case({props:{label:"FullSeparation"}}),n=new Case({props:{label:"Stepped"}}),o=new Case({props:{label:"PartSeparation"}}),u=new Case({props:{label:"MandatoryLane"}}),a=new Case({props:{label:"AdvisoryLane"}}),_=new Case({props:{label:"NoSeparation",$$slots:{default:[yo]},$$scope:{ctx:r}}}),{c(){I(e.$$.fragment),t=M(),I(n.$$.fragment),i=M(),I(o.$$.fragment),s=M(),I(u.$$.fragment),l=M(),I(a.$$.fragment),c=M(),I(_.$$.fragment)},m(f,d){B(e,f,d),y(f,t,d),B(n,f,d),y(f,i,d),B(o,f,d),y(f,s,d),B(u,f,d),y(f,l,d),B(a,f,d),y(f,c,d),B(_,f,d),p=!0},p(f,d){const m={};d&4&&(m.$$scope={dirty:d,ctx:f}),_.$set(m)},i(f){p||(L(e.$$.fragment,f),L(n.$$.fragment,f),L(o.$$.fragment,f),L(u.$$.fragment,f),L(a.$$.fragment,f),L(_.$$.fragment,f),p=!0)},o(f){T(e.$$.fragment,f),T(n.$$.fragment,f),T(o.$$.fragment,f),T(u.$$.fragment,f),T(a.$$.fragment,f),T(_.$$.fragment,f),p=!1},d(f){D(e,f),f&&w(t),D(n,f),f&&w(i),D(o,f),f&&w(s),D(u,f),f&&w(l),D(a,f),f&&w(c),D(_,f)}}}function ko(r){let e,t,n,i,o,s,u,l;return e=new Case({props:{label:"ReallocateEntireLane"}}),n=new Case({props:{label:"RoadDiet"}}),o=new Case({props:{label:"PavementDiet"}}),u=new Case({props:{label:"ReallocateVerge"}}),{c(){I(e.$$.fragment),t=M(),I(n.$$.fragment),i=M(),I(o.$$.fragment),s=M(),I(u.$$.fragment)},m(a,c){B(e,a,c),y(a,t,c),B(n,a,c),y(a,i,c),B(o,a,c),y(a,s,c),B(u,a,c),l=!0},p:W,i(a){l||(L(e.$$.fragment,a),L(n.$$.fragment,a),L(o.$$.fragment,a),L(u.$$.fragment,a),l=!0)},o(a){T(e.$$.fragment,a),T(n.$$.fragment,a),T(o.$$.fragment,a),T(u.$$.fragment,a),l=!1},d(a){D(e,a),a&&w(t),D(n,a),a&&w(i),D(o,a),a&&w(s),D(u,a)}}}function $o(r){let e,t,n,i;return e=new Radio({props:{label:"Type",$$slots:{default:[wo]},$$scope:{ctx:r}}}),n=new Radio({props:{label:"SourceOfSpace",$$slots:{default:[ko]},$$scope:{ctx:r}}}),{c(){I(e.$$.fragment),t=M(),I(n.$$.fragment)},m(o,s){B(e,o,s),y(o,t,s),B(n,o,s),i=!0},p(o,s){const u={};s&4&&(u.$$scope={dirty:s,ctx:o}),e.$set(u);const l={};s&4&&(l.$$scope={dirty:s,ctx:o}),n.$set(l)},i(o){i||(L(e.$$.fragment,o),L(n.$$.fragment,o),i=!0)},o(o){T(e.$$.fragment,o),T(n.$$.fragment,o),i=!1},d(o){D(e,o),o&&w(t),D(n,o)}}}function So(r){let e,t,n,i;return e=new Case({props:{label:"ThroughPark"}}),n=new Case({props:{label:"CanalTowpath"}}),{c(){I(e.$$.fragment),t=M(),I(n.$$.fragment)},m(o,s){B(e,o,s),y(o,t,s),B(n,o,s),i=!0},p:W,i(o){i||(L(e.$$.fragment,o),L(n.$$.fragment,o),i=!0)},o(o){T(e.$$.fragment,o),T(n.$$.fragment,o),i=!1},d(o){D(e,o),o&&w(t),D(n,o)}}}function Eo(r){let e,t;return e=new Radio({props:{label:"Type",$$slots:{default:[So]},$$scope:{ctx:r}}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Mo(r){let e,t,n,i;return e=new Case({props:{label:"OnRoad",$$slots:{default:[$o]},$$scope:{ctx:r}}}),n=new Case({props:{label:"OffRoad",$$slots:{default:[Eo]},$$scope:{ctx:r}}}),{c(){I(e.$$.fragment),t=M(),I(n.$$.fragment)},m(o,s){B(e,o,s),y(o,t,s),B(n,o,s),i=!0},p(o,s){const u={};s&4&&(u.$$scope={dirty:s,ctx:o}),e.$set(u);const l={};s&4&&(l.$$scope={dirty:s,ctx:o}),n.$set(l)},i(o){i||(L(e.$$.fragment,o),L(n.$$.fragment,o),i=!0)},o(o){T(e.$$.fragment,o),T(n.$$.fragment,o),i=!1},d(o){D(e,o),o&&w(t),D(n,o)}}}function xo(r){let e,t,n,i;return e=new NumberInput({props:{label:"width_footpath"}}),n=new NumberInput({props:{label:"width_cyclepath"}}),{c(){I(e.$$.fragment),t=M(),I(n.$$.fragment)},m(o,s){B(e,o,s),y(o,t,s),B(n,o,s),i=!0},p:W,i(o){i||(L(e.$$.fragment,o),L(n.$$.fragment,o),i=!0)},o(o){T(e.$$.fragment,o),T(n.$$.fragment,o),i=!1},d(o){D(e,o),o&&w(t),D(n,o)}}}function Co(r){let e,t,n,i,o,s,u,l;return e=new Case({props:{label:"Footpath"}}),n=new Case({props:{label:"Cyclepath"}}),o=new Case({props:{label:"SharedUseNoSeparation"}}),u=new Case({props:{label:"SharedUseWithSeparation",$$slots:{default:[xo]},$$scope:{ctx:r}}}),{c(){I(e.$$.fragment),t=M(),I(n.$$.fragment),i=M(),I(o.$$.fragment),s=M(),I(u.$$.fragment)},m(a,c){B(e,a,c),y(a,t,c),B(n,a,c),y(a,i,c),B(o,a,c),y(a,s,c),B(u,a,c),l=!0},p(a,c){const _={};c&4&&(_.$$scope={dirty:c,ctx:a}),u.$set(_)},i(a){l||(L(e.$$.fragment,a),L(n.$$.fragment,a),L(o.$$.fragment,a),L(u.$$.fragment,a),l=!0)},o(a){T(e.$$.fragment,a),T(n.$$.fragment,a),T(o.$$.fragment,a),T(u.$$.fragment,a),l=!1},d(a){D(e,a),a&&w(t),D(n,a),a&&w(i),D(o,a),a&&w(s),D(u,a)}}}function Lo(r){let e,t,n,i,o,s,u;function l(c){r[1](c)}let a={label:"Name"};return r[0].v2.name!==void 0&&(a.value=r[0].v2.name),e=new vo({props:a}),be.push(()=>Ye(e,"value",l,r[0].v2.name)),i=new Radio({props:{label:"RouteType",$$slots:{default:[Mo]},$$scope:{ctx:r}}}),s=new Radio({props:{label:"Users",$$slots:{default:[Co]},$$scope:{ctx:r}}}),{c(){I(e.$$.fragment),n=M(),I(i.$$.fragment),o=M(),I(s.$$.fragment)},m(c,_){B(e,c,_),y(c,n,_),B(i,c,_),y(c,o,_),B(s,c,_),u=!0},p(c,[_]){const p={};!t&&_&1&&(t=!0,p.value=c[0].v2.name,He(()=>t=!1)),e.$set(p);const f={};_&4&&(f.$$scope={dirty:_,ctx:c}),i.$set(f);const d={};_&4&&(d.$$scope={dirty:_,ctx:c}),s.$set(d)},i(c){u||(L(e.$$.fragment,c),L(i.$$.fragment,c),L(s.$$.fragment,c),u=!0)},o(c){T(e.$$.fragment,c),T(i.$$.fragment,c),T(s.$$.fragment,c),u=!1},d(c){D(e,c),c&&w(n),D(i,c),c&&w(o),D(s,c)}}}function Ro(r,e,t){let{props:n}=e;n.v2||(n.v2={name:""});function i(o){r.$$.not_equal(n.v2.name,o)&&(n.v2.name=o,t(0,n))}return r.$$set=o=>{"props"in o&&t(0,n=o.props)},[n,i]}class To extends re{constructor(e){super(),ie(this,e,Ro,Lo,ne,{props:0})}}function ar(r,e,t){const n=r.slice();return n[12]=e[t],n}function fr(r,e,t){const n=r.slice();return n[12]=e[t],n}function cr(r,e,t){const n=r.slice();return n[12]=e[t],n}function pr(r,e,t){const n=r.slice();return n[12]=e[t],n}function hr(r){let e,t=r[12]+"",n;return{c(){e=k("option"),n=J(t),e.__value=r[12],e.value=e.__value},m(i,o){y(i,e,o),S(e,n)},p:W,d(i){i&&w(e)}}}function dr(r){let e,t=r[12]+"",n;return{c(){e=k("option"),n=J(t),e.__value=r[12],e.value=e.__value},m(i,o){y(i,e,o),S(e,n)},p:W,d(i){i&&w(e)}}}function mr(r){let e,t=r[12]+"",n;return{c(){e=k("option"),n=J(t),e.__value=r[12],e.value=e.__value},m(i,o){y(i,e,o),S(e,n)},p:W,d(i){i&&w(e)}}}function gr(r){let e,t=r[12]+"",n;return{c(){e=k("option"),n=J(t),e.__value=r[12],e.value=e.__value},m(i,o){y(i,e,o),S(e,n)},p:W,d(i){i&&w(e)}}}function Ao(r){let e,t,n,i,o,s,u,l,a,c,_,p,f,d,m,g,$,h,v,b,x,R,A,C,G,j,q,V,O,U,te,he,z,le,we,Le,de,ae,Ee,ue,F,Q,$t,me,ke,St,lt,_e,fe,Et,Mt,ve=r[1],xe=[];for(let E=0;E<ve.length;E+=1)xe[E]=hr(pr(r,ve,E));let H=r[2],ee=[];for(let E=0;E<H.length;E+=1)ee[E]=dr(cr(r,H,E));let We=r[3],Me=[];for(let E=0;E<We.length;E+=1)Me[E]=mr(fr(r,We,E));let Ve=r[4],ye=[];for(let E=0;E<Ve.length;E+=1)ye[E]=gr(ar(r,Ve,E));return{c(){e=k("label"),t=J("Name:"),n=k("br"),i=M(),o=k("input"),s=M(),u=k("br"),l=M(),a=k("br"),c=M(),_=k("label"),p=J(`Reference type:
  `),f=k("select");for(let E=0;E<xe.length;E+=1)xe[E].c();d=M(),m=k("br"),g=M(),$=k("br"),h=M(),v=k("label"),b=J("Notes:"),x=k("br"),R=M(),A=k("textarea"),C=M(),G=k("br"),j=M(),q=k("br"),V=M(),O=k("label"),U=J(`Size:
  `),te=k("input"),he=M(),z=k("select");for(let E=0;E<ee.length;E+=1)ee[E].c();le=M(),we=k("br"),Le=M(),de=k("br"),ae=M(),Ee=k("label"),ue=J(`ATE Triage:
  `),F=k("select");for(let E=0;E<Me.length;E+=1)Me[E].c();Q=M(),$t=k("br"),me=M(),ke=k("br"),St=M(),lt=k("label"),_e=J(`ATE Recommendation:
  `),fe=k("select");for(let E=0;E<ye.length;E+=1)ye[E].c();P(o,"type","text"),pe(o,"width","100%"),r[0].planning.reference_type===void 0&&ut(()=>r[6].call(f)),pe(A,"width","100%"),P(A,"rows","5"),P(A,"class","svelte-15lna0i"),P(te,"type","number"),P(te,"min","0"),P(te,"max","1000"),r[0].planning.size_units===void 0&&ut(()=>r[9].call(z)),r[0].planning.triage===void 0&&ut(()=>r[10].call(F)),r[0].planning.recommendation===void 0&&ut(()=>r[11].call(fe))},m(E,X){y(E,e,X),S(e,t),S(e,n),S(e,i),S(e,o),Te(o,r[0].planning.name),y(E,s,X),y(E,u,X),y(E,l,X),y(E,a,X),y(E,c,X),y(E,_,X),S(_,p),S(_,f);for(let N=0;N<xe.length;N+=1)xe[N].m(f,null);Oe(f,r[0].planning.reference_type),y(E,d,X),y(E,m,X),y(E,g,X),y(E,$,X),y(E,h,X),y(E,v,X),S(v,b),S(v,x),S(v,R),S(v,A),Te(A,r[0].planning.notes),y(E,C,X),y(E,G,X),y(E,j,X),y(E,q,X),y(E,V,X),y(E,O,X),S(O,U),S(O,te),Te(te,r[0].planning.size),S(O,he),S(O,z);for(let N=0;N<ee.length;N+=1)ee[N].m(z,null);Oe(z,r[0].planning.size_units),y(E,le,X),y(E,we,X),y(E,Le,X),y(E,de,X),y(E,ae,X),y(E,Ee,X),S(Ee,ue),S(Ee,F);for(let N=0;N<Me.length;N+=1)Me[N].m(F,null);Oe(F,r[0].planning.triage),y(E,Q,X),y(E,$t,X),y(E,me,X),y(E,ke,X),y(E,St,X),y(E,lt,X),S(lt,_e),S(lt,fe);for(let N=0;N<ye.length;N+=1)ye[N].m(fe,null);Oe(fe,r[0].planning.recommendation),Et||(Mt=[Y(o,"input",r[5]),Y(f,"change",r[6]),Y(A,"input",r[7]),Y(te,"input",r[8]),Y(z,"change",r[9]),Y(F,"change",r[10]),Y(fe,"change",r[11])],Et=!0)},p(E,[X]){if(X&3&&o.value!==E[0].planning.name&&Te(o,E[0].planning.name),X&2){ve=E[1];let N;for(N=0;N<ve.length;N+=1){const Be=pr(E,ve,N);xe[N]?xe[N].p(Be,X):(xe[N]=hr(Be),xe[N].c(),xe[N].m(f,null))}for(;N<xe.length;N+=1)xe[N].d(1);xe.length=ve.length}if(X&3&&Oe(f,E[0].planning.reference_type),X&3&&Te(A,E[0].planning.notes),X&3&&Gr(te.value)!==E[0].planning.size&&Te(te,E[0].planning.size),X&4){H=E[2];let N;for(N=0;N<H.length;N+=1){const Be=cr(E,H,N);ee[N]?ee[N].p(Be,X):(ee[N]=dr(Be),ee[N].c(),ee[N].m(z,null))}for(;N<ee.length;N+=1)ee[N].d(1);ee.length=H.length}if(X&3&&Oe(z,E[0].planning.size_units),X&8){We=E[3];let N;for(N=0;N<We.length;N+=1){const Be=fr(E,We,N);Me[N]?Me[N].p(Be,X):(Me[N]=mr(Be),Me[N].c(),Me[N].m(F,null))}for(;N<Me.length;N+=1)Me[N].d(1);Me.length=We.length}if(X&3&&Oe(F,E[0].planning.triage),X&16){Ve=E[4];let N;for(N=0;N<Ve.length;N+=1){const Be=ar(E,Ve,N);ye[N]?ye[N].p(Be,X):(ye[N]=gr(Be),ye[N].c(),ye[N].m(fe,null))}for(;N<ye.length;N+=1)ye[N].d(1);ye.length=Ve.length}X&3&&Oe(fe,E[0].planning.recommendation)},i:W,o:W,d(E){E&&w(e),E&&w(s),E&&w(u),E&&w(l),E&&w(a),E&&w(c),E&&w(_),jt(xe,E),E&&w(d),E&&w(m),E&&w(g),E&&w($),E&&w(h),E&&w(v),E&&w(C),E&&w(G),E&&w(j),E&&w(q),E&&w(V),E&&w(O),jt(ee,E),E&&w(le),E&&w(we),E&&w(Le),E&&w(de),E&&w(ae),E&&w(Ee),jt(Me,E),E&&w(Q),E&&w($t),E&&w(me),E&&w(ke),E&&w(St),E&&w(lt),jt(ye,E),Et=!1,qe(Mt)}}}function Po(r,e,t){let{props:n}=e;n.planning||(n.planning={name:"",notes:"",reference_type:"preapp",size:0,size_units:"number of units",triage:"No Comment",recommendation:"No Comment"});const i=["preapp","outline","reserved matters","local plan"],o=["number of units","floorspace (Gross Floor Area)","area (Hectare)"],s=["No Comment","Standing Advice","Toolkit Assessment"],u=["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"];function l(){n.planning.name=this.value,t(0,n),t(1,i)}function a(){n.planning.reference_type=mt(this),t(0,n),t(1,i)}function c(){n.planning.notes=this.value,t(0,n),t(1,i)}function _(){n.planning.size=Gr(this.value),t(0,n),t(1,i)}function p(){n.planning.size_units=mt(this),t(0,n),t(1,i)}function f(){n.planning.triage=mt(this),t(0,n),t(1,i)}function d(){n.planning.recommendation=mt(this),t(0,n),t(1,i)}return r.$$set=m=>{"props"in m&&t(0,n=m.props)},[n,i,o,s,u,l,a,c,_,p,f,d]}class Oo extends re{constructor(e){super(),ie(this,e,Po,Ao,ne,{props:0})}}function Fo(r){const e=r-1;return e*e*e+1}function _r(r,{delay:e=0,duration:t=400,easing:n=Fo}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),u=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),a=parseFloat(i.marginTop),c=parseFloat(i.marginBottom),_=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*u}px;padding-bottom: ${f*l}px;margin-top: ${f*a}px;margin-bottom: ${f*c}px;border-top-width: ${f*_}px;border-bottom-width: ${f*p}px;`}}function vr(r){let e,t,n,i,o;const s=r[10].default,u=Lt(s,r,r[9],null);return{c(){e=k("div"),u&&u.c(),pe(e,"border","solid 1px black"),pe(e,"padding","10px")},m(l,a){y(l,e,a),u&&u.m(e,null),r[13](e),n=!0,i||(o=Y(e,"introend",r[14]),i=!0)},p(l,a){u&&u.p&&(!n||a&512)&&Rt(u,s,l,l[9],n?At(s,l[9],a,null):Tt(l[9]),null)},i(l){n||(L(u,l),ut(()=>{t||(t=Yn(e,_r,{duration:100},!0)),t.run(1)}),n=!0)},o(l){T(u,l),t||(t=Yn(e,_r,{duration:100},!1)),t.run(0),n=!1},d(l){l&&w(e),u&&u.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function No(r){let e,t,n,i,o,s,u,l,a,c,_=r[4]&&vr(r);return{c(){e=k("button"),t=jn("svg"),n=jn("path"),i=M(),o=J(r[1]),s=M(),_&&_.c(),u=Pe(),P(n,"d","M9 5l7 7-7 7"),P(t,"style","tran"),P(t,"width","20"),P(t,"height","20"),P(t,"fill","none"),P(t,"stroke-linecap","round"),P(t,"stroke-linejoin","round"),P(t,"stroke-width","2"),P(t,"viewBox","0 0 24 24"),P(t,"stroke","currentColor"),P(t,"class","svelte-t7fpgu"),P(e,"aria-expanded",r[4]),P(e,"class","svelte-t7fpgu"),zn(e,"underlined",r[3])},m(p,f){y(p,e,f),S(e,t),S(t,n),S(e,i),S(e,o),y(p,s,f),_&&_.m(p,f),y(p,u,f),l=!0,a||(c=[Y(e,"click",r[5]),Y(e,"mouseenter",r[11]),Y(e,"mouseleave",r[12])],a=!0)},p(p,[f]){(!l||f&2)&&un(o,p[1]),(!l||f&16)&&P(e,"aria-expanded",p[4]),(!l||f&8)&&zn(e,"underlined",p[3]),p[4]?_?(_.p(p,f),f&16&&L(_,1)):(_=vr(p),_.c(),L(_,1),_.m(u.parentNode,u)):_&&(Fe(),T(_,1,1,()=>{_=null}),Ne())},i(p){l||(L(_),l=!0)},o(p){T(_),l=!1},d(p){p&&w(e),p&&w(s),_&&_.d(p),p&&w(u),a=!1,qe(c)}}}function Io(r,e,t){let n,i,o,s;ce(r,Qe,h=>t(7,o=h)),ce(r,Ae,h=>t(8,s=h));let{$$slots:u={},$$scope:l}=e,{id:a}=e,{label:c}=e;const _=()=>{Ae.update(h=>h==a?null:a),s==a&&(wn.set(null),wn.set(a))};let p;function f(){p==null||p.scrollIntoView({behavior:"smooth"})}const d=()=>Zt.set(a),m=()=>Zt.set(null);function g(h){be[h?"unshift":"push"](()=>{p=h,t(2,p)})}const $=()=>f();return r.$$set=h=>{"id"in h&&t(0,a=h.id),"label"in h&&t(1,c=h.label),"$$scope"in h&&t(9,l=h.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==a),r.$$.dirty&129&&t(3,i=o==a)},[a,c,p,i,n,_,f,o,s,l,u,d,m,g,$]}class Bo extends re{constructor(e){super(),ie(this,e,Io,No,ne,{id:0,label:1})}}function br(r,e,t){const n=r.slice();return n[12]=e[t],n[13]=e,n[14]=t,n}function Do(r){let e,t,n;function i(s){r[8](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new Oo({props:o}),be.push(()=>Ye(e,"props",i,r[12].properties)),{c(){I(e.$$.fragment)},m(s,u){B(e,s,u),n=!0},p(s,u){r=s;const l={};!t&&u&2&&(t=!0,l.props=r[12].properties,He(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Go(r){let e,t,n;function i(s){r[7](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new To({props:o}),be.push(()=>Ye(e,"props",i,r[12].properties)),{c(){I(e.$$.fragment)},m(s,u){B(e,s,u),n=!0},p(s,u){r=s;const l={};!t&&u&2&&(t=!0,l.props=r[12].properties,He(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function qo(r){let e,t,n,i,o;function s(c){r[4](c,r[12])}function u(c){r[5](c,r[12])}function l(c){r[6](c,r[12])}let a={length_meters:r[12].properties.length_meters};return r[12].properties.name!==void 0&&(a.name=r[12].properties.name),r[12].properties.intervention_type!==void 0&&(a.intervention_type=r[12].properties.intervention_type),r[12].properties.description!==void 0&&(a.description=r[12].properties.description),e=new mo({props:a}),be.push(()=>Ye(e,"name",s,r[12].properties.name)),be.push(()=>Ye(e,"intervention_type",u,r[12].properties.intervention_type)),be.push(()=>Ye(e,"description",l,r[12].properties.description)),{c(){I(e.$$.fragment)},m(c,_){B(e,c,_),o=!0},p(c,_){r=c;const p={};_&2&&(p.length_meters=r[12].properties.length_meters),!t&&_&2&&(t=!0,p.name=r[12].properties.name,He(()=>t=!1)),!n&&_&2&&(n=!0,p.intervention_type=r[12].properties.intervention_type,He(()=>n=!1)),!i&&_&2&&(i=!0,p.description=r[12].properties.description,He(()=>i=!1)),e.$set(p)},i(c){o||(L(e.$$.fragment,c),o=!0)},o(c){T(e.$$.fragment,c),o=!1},d(c){D(e,c)}}}function jo(r){let e,t,n,i,o,s,u,l,a,c,_,p,f,d,m;const g=[qo,Go,Do],$=[];function h(b,x){return b[0]=="v1"?0:b[0]=="v2"?1:b[0]=="planning"?2:-1}~(e=h(r))&&(t=$[e]=g[e](r));function v(){return r[9](r[12])}return{c(){t&&t.c(),n=M(),i=k("br"),o=M(),s=k("br"),u=M(),l=k("div"),a=k("button"),a.textContent="Delete",c=M(),_=k("button"),_.textContent="Save",p=M(),P(a,"type","button"),P(_,"type","button"),pe(l,"display","flex"),pe(l,"justify-content","space-between")},m(b,x){~e&&$[e].m(b,x),y(b,n,x),y(b,i,x),y(b,o,x),y(b,s,x),y(b,u,x),y(b,l,x),S(l,a),S(l,c),S(l,_),y(b,p,x),f=!0,d||(m=[Y(a,"click",v),Y(_,"click",r[10])],d=!0)},p(b,x){r=b;let R=e;e=h(r),e===R?~e&&$[e].p(r,x):(t&&(Fe(),T($[R],1,1,()=>{$[R]=null}),Ne()),~e?(t=$[e],t?t.p(r,x):(t=$[e]=g[e](r),t.c()),L(t,1),t.m(n.parentNode,n)):t=null)},i(b){f||(L(t),f=!0)},o(b){T(t),f=!1},d(b){~e&&$[e].d(b),b&&w(n),b&&w(i),b&&w(o),b&&w(s),b&&w(u),b&&w(l),b&&w(p),d=!1,qe(m)}}}function yr(r,e){let t,n,i;return n=new Bo({props:{id:e[12].id,label:e[14]+1+") "+e[2](e[12]),$$slots:{default:[jo]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=Pe(),I(n.$$.fragment),this.first=t},m(o,s){y(o,t,s),B(n,o,s),i=!0},p(o,s){e=o;const u={};s&2&&(u.id=e[12].id),s&2&&(u.label=e[14]+1+") "+e[2](e[12])),s&32771&&(u.$$scope={dirty:s,ctx:e}),n.$set(u)},i(o){i||(L(n.$$.fragment,o),i=!0)},o(o){T(n.$$.fragment,o),i=!1},d(o){o&&w(t),D(n,o)}}}function zo(r){let e=[],t=new Map,n,i,o,s,u=r[1].features;const l=a=>a[12].id;for(let a=0;a<u.length;a+=1){let c=br(r,u,a),_=l(c);t.set(_,e[a]=yr(_,c))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=Pe()},m(a,c){for(let _=0;_<e.length;_+=1)e[_].m(a,c);y(a,n,c),i=!0,o||(s=Y(window,"keydown",r[3]),o=!0)},p(a,[c]){c&7&&(u=a[1].features,Fe(),e=ci(e,c,l,1,a,u,t,n.parentNode,pi,yr,n,br),Ne())},i(a){if(!i){for(let c=0;c<u.length;c+=1)L(e[c]);i=!0}},o(a){for(let c=0;c<e.length;c+=1)T(e[c]);i=!1},d(a){for(let c=0;c<e.length;c+=1)e[c].d(a);a&&w(n),o=!1,s()}}}function Yo(r,e,t){let n,i;ce(r,Ae,m=>t(11,n=m)),ce(r,se,m=>t(1,i=m));let{schema:o}=e;function s(m){var $;if(o=="planning")return(($=m.properties.planning)==null?void 0:$.name)||"Untitled polygon";if(m.properties.name)return m.properties.name;var g=m.properties.intervention_type;return g=="other"&&(m.geometry.type=="Point"?g="point":m.geometry.type=="LineString"?g="line":g="polygon"),`Untitled ${g}`}function u(m){if(m.key=="Delete"){const g=m.target.tagName;if(g=="INPUT"||g=="TEXTAREA")return;m.preventDefault();const $=n;$&&Un($)}}function l(m,g){r.$$.not_equal(g.properties.name,m)&&(g.properties.name=m,se.set(i))}function a(m,g){r.$$.not_equal(g.properties.intervention_type,m)&&(g.properties.intervention_type=m,se.set(i))}function c(m,g){r.$$.not_equal(g.properties.description,m)&&(g.properties.description=m,se.set(i))}function _(m,g){r.$$.not_equal(g.properties,m)&&(g.properties=m,se.set(i))}function p(m,g){r.$$.not_equal(g.properties,m)&&(g.properties=m,se.set(i))}const f=m=>Un(m.id),d=()=>Ae.set(null);return r.$$set=m=>{"schema"in m&&t(0,o=m.schema)},[o,i,s,u,l,a,c,_,p,f,d]}class Ho extends re{constructor(e){super(),ie(this,e,Yo,zo,ne,{schema:0})}}function ot(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ue(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Cn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function tt(r,e,t){t===void 0&&(t={});var n=ot(r),i=ot(e),o=De(i[1]-n[1]),s=De(i[0]-n[0]),u=De(n[1]),l=De(i[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return hi(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),t.units)}function Ut(r,e){return e===void 0&&(e={}),di(r,function(t,n){var i=n.geometry.coordinates;return t+tt(i[0],i[1],e)},0)}function Uo(r){let e,t,n,i,o,s,u,l,a,c,_,p,f,d,m,g,$,h,v,b=r[0].features.length+"",x,R,A,C,G,j,q,V;return{c(){e=k("div"),t=k("label"),n=J(`Scheme name:
    `),i=k("input"),o=M(),s=k("br"),u=M(),l=k("div"),a=k("label"),c=k("input"),_=M(),p=k("button"),p.textContent="Load from GeoJSON",f=M(),d=k("button"),d.textContent="Export to GeoJSON",m=M(),g=k("br"),$=M(),h=k("div"),v=k("span"),x=J(b),R=J(" interventions"),A=M(),C=k("button"),G=J("Clear all"),P(i,"type","text"),P(c,"type","file"),P(c,"id","load_geojson"),P(c,"class","svelte-lhyd1e"),P(p,"type","button"),P(d,"type","button"),P(d,"class","align-right svelte-lhyd1e"),P(C,"type","button"),P(C,"class","align-right svelte-lhyd1e"),C.disabled=j=r[0].features.length==0},m(O,U){y(O,e,U),S(e,t),S(t,n),S(t,i),Te(i,r[0].scheme_name),y(O,o,U),y(O,s,U),y(O,u,U),y(O,l,U),S(l,a),S(a,c),S(a,_),S(a,p),S(l,f),S(l,d),y(O,m,U),y(O,g,U),y(O,$,U),y(O,h,U),S(h,v),S(v,x),S(v,R),S(h,A),S(h,C),S(C,G),q||(V=[Y(i,"input",r[7]),Y(c,"change",r[3]),Y(p,"click",Jo),Y(d,"click",r[2]),Y(C,"click",r[1])],q=!0)},p(O,[U]){U&1&&i.value!==O[0].scheme_name&&Te(i,O[0].scheme_name),U&1&&b!==(b=O[0].features.length+"")&&un(x,b),U&1&&j!==(j=O[0].features.length==0)&&(C.disabled=j)},i:W,o:W,d(O){O&&w(e),O&&w(o),O&&w(s),O&&w(u),O&&w(l),O&&w(m),O&&w(g),O&&w($),O&&w(h),q=!1,qe(V)}}}function Xo(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Jo(){document.getElementById("load_geojson").click()}function Wo(r,e,t){let n;ce(r,se,d=>t(0,n=d));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let u=window.localStorage.getItem(s);if(u)try{se.set(p(JSON.parse(u)))}catch(d){console.log(`Failed to load from local storage: ${d}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&se.update(d=>(delete d.scheme_name,d.features=[],d))}function a(){const d=JSON.parse(JSON.stringify(n));for(let m of d.features)delete m.properties.hide_while_editing;return d}function c(){let d=a();var m=s;d.authority=i,d.origin="atip-v1",d.scheme_name&&(m+="_"+d.scheme_name),m+=".txt",Xo(m,JSON.stringify(d,null,"  "))}function _(d){const m=new FileReader;m.onload=$=>{try{se.set(p(JSON.parse($.target.result)))}catch(h){window.alert(`Couldn't load scheme from a file: ${h}`)}};let g=d.target.files;m.readAsText(g[0])}function p(d){let m=1;for(let g of d.features)g.properties||(g.properties={name:"",description:"",intervention_type:"other"}),g.geometry.type=="LineString"&&!g.properties.length_meters&&(g.properties.length_meters=Ut(g,{units:"kilometers"})*1e3),g.id=m++;return d}function f(){n.scheme_name=this.value,se.set(n)}return r.$$set=d=>{"authorityName"in d&&t(4,i=d.authorityName),"schema"in d&&t(5,o=d.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(a())))},[n,l,c,_,i,o,s,f]}class Vo extends re{constructor(e){super(),ie(this,e,Wo,Uo,ne,{authorityName:4,schema:5})}}const Ko="/atip/assets/zoom_out_map-b2e1091a.svg";function Zo(r){let e,t,n,i,o;return{c(){e=k("button"),t=k("img"),mi(t.src,n=Ko)||P(t,"src",n),P(t,"alt","Zoom to show entire boundary"),P(e,"type","button"),P(e,"title","Zoom to show entire boundary"),P(e,"class","svelte-qzjsqo")},m(s,u){y(s,e,u),S(e,t),i||(o=Y(e,"click",r[0]),i=!0)},p:W,i:W,o:W,d(s){s&&w(e),i=!1,o()}}}function Qo(r,e,t){let n;ce(r,Je,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(Nn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class es extends re{constructor(e){super(),ie(this,e,Qo,Zo,ne,{boundaryGeojson:1})}}function ts(r){let e,t,n,i,o,s,u;return{c(){e=k("div"),t=J(`Basemap:
  `),n=k("select"),i=k("option"),i.textContent="Streets",o=k("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&ut(()=>r[2].call(n)),P(e,"class","svelte-1tbnm6i")},m(l,a){y(l,e,a),S(e,t),S(e,n),S(n,i),S(n,o),Oe(n,r[0]),s||(u=[Y(n,"change",r[2]),Y(n,"change",r[1])],s=!0)},p(l,[a]){a&1&&Oe(n,l[0])},i:W,o:W,d(l){l&&w(e),s=!1,qe(u)}}}function ns(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let u=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=u}function o(){n=mt(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class rs extends re{constructor(e){super(),ie(this,e,ns,ts,ne,{style:0})}}const ge={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},pn=10,tn=10;function is(r){let e,t,n,i,o,s,u,l,a,c,_,p,f,d,m;return{c(){e=k("li"),t=k("span"),n=J("Areas"),i=M(),o=k("li"),s=k("span"),u=J("Routes"),l=M(),a=k("li"),c=k("span"),_=J("Crossings"),p=M(),f=k("li"),d=k("span"),m=J("Other"),P(t,"class","svelte-p551i1"),pe(t,"background",ge.area),P(s,"class","svelte-p551i1"),pe(s,"background",ge.route),P(c,"class","svelte-p551i1"),pe(c,"background",ge.crossing),P(d,"class","svelte-p551i1"),pe(d,"background",ge.other)},m(g,$){y(g,e,$),S(e,t),S(e,n),y(g,i,$),y(g,o,$),S(o,s),S(o,u),y(g,l,$),y(g,a,$),S(a,c),S(a,_),y(g,p,$),y(g,f,$),S(f,d),S(f,m)},p:W,d(g){g&&w(e),g&&w(i),g&&w(o),g&&w(l),g&&w(a),g&&w(p),g&&w(f)}}}function os(r){let e,t,n,i,o,s,u,l,a,c,_,p,f,d,m;return{c(){e=k("li"),t=k("span"),n=J("Preapp"),i=M(),o=k("li"),s=k("span"),u=J("Outline"),l=M(),a=k("li"),c=k("span"),_=J("Reserved matters"),p=M(),f=k("li"),d=k("span"),m=J("Local plan"),P(t,"class","svelte-p551i1"),pe(t,"background",ge.preapp),P(s,"class","svelte-p551i1"),pe(s,"background",ge.outline),P(c,"class","svelte-p551i1"),pe(c,"background",ge["reserved matters"]),P(d,"class","svelte-p551i1"),pe(d,"background",ge["local plan"])},m(g,$){y(g,e,$),S(e,t),S(e,n),y(g,i,$),y(g,o,$),S(o,s),S(o,u),y(g,l,$),y(g,a,$),S(a,c),S(a,_),y(g,p,$),y(g,f,$),S(f,d),S(f,m)},p:W,d(g){g&&w(e),g&&w(i),g&&w(o),g&&w(l),g&&w(a),g&&w(p),g&&w(f)}}}function ss(r){let e,t,n,i;function o(l,a){return l[0]=="planning"?os:is}let s=o(r),u=s(r);return{c(){e=k("div"),t=k("h1"),t.textContent="Interventions",n=M(),i=k("ul"),u.c(),P(t,"class","svelte-p551i1"),P(e,"class","svelte-p551i1")},m(l,a){y(l,e,a),S(e,t),S(e,n),S(e,i),u.m(i,null)},p(l,[a]){s===(s=o(l))&&u?u.p(l,a):(u.d(1),u=s(l),u&&(u.c(),u.m(i,null)))},i:W,o:W,d(l){l&&w(e),u.d()}}}function ls(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class us extends re{constructor(e){super(),ie(this,e,ls,ss,ne,{schema:0})}}let ct="interventions";function as(r,e,t){let n,i;ce(r,Je,c=>t(1,n=c)),ce(r,se,c=>t(2,i=c));let{schema:o}=e;at(n,ct,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",ge.area,"route",ge.route,"crossing",ge.crossing,"other",ge.other,"white"],u=["match",["get","reference_type",["get","planning"]],"preapp",ge.preapp,"outline",ge.outline,"reserved matters",ge["reserved matters"],"local plan",ge["local plan"],"white"],l=["!=","hide_while_editing",!0];return Ce(n,{id:"interventions-points",source:ct,filter:["all",an,l,["!=","endpoint",!0]],...wt(s,pn)}),Ce(n,{id:"interventions-lines",source:ct,filter:["all",fn,l],...It(s,tn)},"route-lines"),Ce(n,{id:"interventions-lines-endpoints",source:ct,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*tn,"circle-opacity":0,"circle-stroke-color":ge.lineEndpointColor,"circle-stroke-width":2}}),Ce(n,{id:"interventions-polygons",source:ct,filter:["all",cn,l],...ln(o=="planning"?u:s,.5)},"hover-polygons"),r.$$set=c=>{"schema"in c&&t(0,o=c.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let c=JSON.parse(JSON.stringify(i)),_=[];for(let p of c.features)if(p.geometry.type=="LineString")for(let f of[p.geometry.coordinates[0],p.geometry.coordinates[p.geometry.coordinates.length-1]])_.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});c.features=c.features.concat(_),n.getSource(ct).setData(c)}},[o,n,i]}class fs extends re{constructor(e){super(),ie(this,e,as,null,ne,{schema:0})}}let pt="hover";function cs(r,e,t){let n,i,o,s,u;return ce(r,Je,l=>t(0,n=l)),ce(r,se,l=>t(1,i=l)),ce(r,Zt,l=>t(2,o=l)),ce(r,Qe,l=>t(3,s=l)),ce(r,Ae,l=>t(4,u=l)),at(n,pt,{type:"geojson",data:Xe()}),Ce(n,{id:"hover-polygons",source:pt,filter:cn,...It(ge.hovering,.5*tn,1)}),Ce(n,{id:"hover-lines",source:pt,filter:fn,...It(ge.hovering,1.5*tn,1)},"interventions-lines"),Ce(n,{id:"hover-points",source:pt,filter:an,...wt(ge.hovering,1.5*pn,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=u||s||o;l!=null?n.getSource(pt).setData(i.features.find(a=>a.id==l)):n.getSource(pt).setData(Xe())}},[n,i,o,s,u]}class ps extends re{constructor(e){super(),ie(this,e,cs,null,ne,{})}}class Gn{constructor(e,t){oe(this,"owner");oe(this,"map");oe(this,"mapHandlers",{});oe(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const zt="edit-point-mode";class hs{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"cursor");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new Gn(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),at(e,zt,{type:"geojson",data:Xe()}),Ce(e,{id:"edit-point-mode",source:zt,...wt(ge.hovering,pn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=ds(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(zt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Xe();this.cursor&&e.features.push(this.cursor),this.map.getSource(zt).setData(e)}}function ds(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function zr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return ms(r,e);var n=ot(r),i=ot(e),o=De(n[0]),s=De(i[0]),u=De(n[1]),l=De(i[1]),a=Math.sin(s-o)*Math.cos(l),c=Math.cos(u)*Math.sin(l)-Math.sin(u)*Math.cos(l)*Math.cos(s-o);return yn(Math.atan2(a,c))}function ms(r,e){var t=zr(e,r);return t=(t+180)%360,t}function wr(r,e,t,n){n===void 0&&(n={});var i=ot(r),o=De(i[0]),s=De(i[1]),u=De(t),l=gi(e,n.units),a=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(u)),c=o+Math.atan2(Math.sin(u)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(a)),_=yn(c),p=yn(a);return vt([_,p],n.properties)}function Ln(r){if(!r)throw new Error("geojson is required");var e=[];return In(r,function(t){gs(t,e)}),it(e)}function gs(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ue(n);break;case"LineString":t=[Ue(n)]}t.forEach(function(i){var o=_s(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function _s(r,e){var t=[];return r.reduce(function(n,i){var o=bt([n,i],e);return o.bbox=vs(n,i),t.push(o),i}),t}function vs(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,u=n<o?n:o,l=t>i?t:i,a=n>o?n:o;return[s,u,l,a]}var yt={},bs={get exports(){return yt},set exports(r){yt=r}},Rn={},ys={get exports(){return Rn},set exports(r){Rn=r}};(function(r,e){(function(t,n){r.exports=n()})(_i,function(){function t(h,v,b,x,R){(function A(C,G,j,q,V){for(;q>j;){if(q-j>600){var O=q-j+1,U=G-j+1,te=Math.log(O),he=.5*Math.exp(2*te/3),z=.5*Math.sqrt(te*he*(O-he)/O)*(U-O/2<0?-1:1),le=Math.max(j,Math.floor(G-U*he/O+z)),we=Math.min(q,Math.floor(G+(O-U)*he/O+z));A(C,G,le,we,V)}var Le=C[G],de=j,ae=q;for(n(C,j,G),V(C[q],Le)>0&&n(C,j,q);de<ae;){for(n(C,de,ae),de++,ae--;V(C[de],Le)<0;)de++;for(;V(C[ae],Le)>0;)ae--}V(C[j],Le)===0?n(C,j,ae):n(C,++ae,q),ae<=G&&(j=ae+1),G<=ae&&(q=ae-1)}})(h,v,b||0,x||h.length-1,R||i)}function n(h,v,b){var x=h[v];h[v]=h[b],h[b]=x}function i(h,v){return h<v?-1:h>v?1:0}var o=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(h,v,b){if(!b)return v.indexOf(h);for(var x=0;x<v.length;x++)if(b(h,v[x]))return x;return-1}function u(h,v){l(h,0,h.children.length,v,h)}function l(h,v,b,x,R){R||(R=g(null)),R.minX=1/0,R.minY=1/0,R.maxX=-1/0,R.maxY=-1/0;for(var A=v;A<b;A++){var C=h.children[A];a(R,h.leaf?x(C):C)}return R}function a(h,v){return h.minX=Math.min(h.minX,v.minX),h.minY=Math.min(h.minY,v.minY),h.maxX=Math.max(h.maxX,v.maxX),h.maxY=Math.max(h.maxY,v.maxY),h}function c(h,v){return h.minX-v.minX}function _(h,v){return h.minY-v.minY}function p(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function f(h){return h.maxX-h.minX+(h.maxY-h.minY)}function d(h,v){return h.minX<=v.minX&&h.minY<=v.minY&&v.maxX<=h.maxX&&v.maxY<=h.maxY}function m(h,v){return v.minX<=h.maxX&&v.minY<=h.maxY&&v.maxX>=h.minX&&v.maxY>=h.minY}function g(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function $(h,v,b,x,R){for(var A=[v,b];A.length;)if(!((b=A.pop())-(v=A.pop())<=x)){var C=v+Math.ceil((b-v)/x/2)*x;t(h,C,v,b,R),A.push(v,C,C,b)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(h){var v=this.data,b=[];if(!m(h,v))return b;for(var x=this.toBBox,R=[];v;){for(var A=0;A<v.children.length;A++){var C=v.children[A],G=v.leaf?x(C):C;m(h,G)&&(v.leaf?b.push(C):d(h,G)?this._all(C,b):R.push(C))}v=R.pop()}return b},o.prototype.collides=function(h){var v=this.data;if(!m(h,v))return!1;for(var b=[];v;){for(var x=0;x<v.children.length;x++){var R=v.children[x],A=v.leaf?this.toBBox(R):R;if(m(h,A)){if(v.leaf||d(h,A))return!0;b.push(R)}}v=b.pop()}return!1},o.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var v=0;v<h.length;v++)this.insert(h[v]);return this}var b=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===b.height)this._splitRoot(this.data,b);else{if(this.data.height<b.height){var x=this.data;this.data=b,b=x}this._insert(b,this.data.height-b.height-1,!0)}else this.data=b;return this},o.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},o.prototype.clear=function(){return this.data=g([]),this},o.prototype.remove=function(h,v){if(!h)return this;for(var b,x,R,A=this.data,C=this.toBBox(h),G=[],j=[];A||G.length;){if(A||(A=G.pop(),x=G[G.length-1],b=j.pop(),R=!0),A.leaf){var q=s(h,A.children,v);if(q!==-1)return A.children.splice(q,1),G.push(A),this._condense(G),this}R||A.leaf||!d(A,C)?x?(b++,A=x.children[b],R=!1):A=null:(G.push(A),j.push(b),b=0,x=A,A=A.children[0])}return this},o.prototype.toBBox=function(h){return h},o.prototype.compareMinX=function(h,v){return h.minX-v.minX},o.prototype.compareMinY=function(h,v){return h.minY-v.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(h){return this.data=h,this},o.prototype._all=function(h,v){for(var b=[];h;)h.leaf?v.push.apply(v,h.children):b.push.apply(b,h.children),h=b.pop();return v},o.prototype._build=function(h,v,b,x){var R,A=b-v+1,C=this._maxEntries;if(A<=C)return u(R=g(h.slice(v,b+1)),this.toBBox),R;x||(x=Math.ceil(Math.log(A)/Math.log(C)),C=Math.ceil(A/Math.pow(C,x-1))),(R=g([])).leaf=!1,R.height=x;var G=Math.ceil(A/C),j=G*Math.ceil(Math.sqrt(C));$(h,v,b,j,this.compareMinX);for(var q=v;q<=b;q+=j){var V=Math.min(q+j-1,b);$(h,q,V,G,this.compareMinY);for(var O=q;O<=V;O+=G){var U=Math.min(O+G-1,V);R.children.push(this._build(h,O,U,x-1))}}return u(R,this.toBBox),R},o.prototype._chooseSubtree=function(h,v,b,x){for(;x.push(v),!v.leaf&&x.length-1!==b;){for(var R=1/0,A=1/0,C=void 0,G=0;G<v.children.length;G++){var j=v.children[G],q=p(j),V=(O=h,U=j,(Math.max(U.maxX,O.maxX)-Math.min(U.minX,O.minX))*(Math.max(U.maxY,O.maxY)-Math.min(U.minY,O.minY))-q);V<A?(A=V,R=q<R?q:R,C=j):V===A&&q<R&&(R=q,C=j)}v=C||v.children[0]}var O,U;return v},o.prototype._insert=function(h,v,b){var x=b?h:this.toBBox(h),R=[],A=this._chooseSubtree(x,this.data,v,R);for(A.children.push(h),a(A,x);v>=0&&R[v].children.length>this._maxEntries;)this._split(R,v),v--;this._adjustParentBBoxes(x,R,v)},o.prototype._split=function(h,v){var b=h[v],x=b.children.length,R=this._minEntries;this._chooseSplitAxis(b,R,x);var A=this._chooseSplitIndex(b,R,x),C=g(b.children.splice(A,b.children.length-A));C.height=b.height,C.leaf=b.leaf,u(b,this.toBBox),u(C,this.toBBox),v?h[v-1].children.push(C):this._splitRoot(b,C)},o.prototype._splitRoot=function(h,v){this.data=g([h,v]),this.data.height=h.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(h,v,b){for(var x,R,A,C,G,j,q,V=1/0,O=1/0,U=v;U<=b-v;U++){var te=l(h,0,U,this.toBBox),he=l(h,U,b,this.toBBox),z=(R=te,A=he,C=void 0,G=void 0,j=void 0,q=void 0,C=Math.max(R.minX,A.minX),G=Math.max(R.minY,A.minY),j=Math.min(R.maxX,A.maxX),q=Math.min(R.maxY,A.maxY),Math.max(0,j-C)*Math.max(0,q-G)),le=p(te)+p(he);z<V?(V=z,x=U,O=le<O?le:O):z===V&&le<O&&(O=le,x=U)}return x||b-v},o.prototype._chooseSplitAxis=function(h,v,b){var x=h.leaf?this.compareMinX:c,R=h.leaf?this.compareMinY:_;this._allDistMargin(h,v,b,x)<this._allDistMargin(h,v,b,R)&&h.children.sort(x)},o.prototype._allDistMargin=function(h,v,b,x){h.children.sort(x);for(var R=this.toBBox,A=l(h,0,v,R),C=l(h,b-v,b,R),G=f(A)+f(C),j=v;j<b-v;j++){var q=h.children[j];a(A,h.leaf?R(q):q),G+=f(A)}for(var V=b-v-1;V>=v;V--){var O=h.children[V];a(C,h.leaf?R(O):O),G+=f(C)}return G},o.prototype._adjustParentBBoxes=function(h,v,b){for(var x=b;x>=0;x--)a(v[x],h)},o.prototype._condense=function(h){for(var v=h.length-1,b=void 0;v>=0;v--)h[v].children.length===0?v>0?(b=h[v-1].children).splice(b.indexOf(h[v]),1):this.clear():u(h[v],this.toBBox)},o})})(ys);const ws=Bn(vi),ks=Bn(bi),$s=Bn(yi);var je=Rn,Yr=ws,Hr=ks,ht=$s.default,Ss=Hr.featureEach;Hr.coordEach;Yr.polygon;var kr=Yr.featureCollection;function Ur(r){var e=new je(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ht(t),je.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ht(i),n.push(i)}):Ss(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ht(i),n.push(i)}),je.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ht(t),je.prototype.remove.call(this,t,n)},e.clear=function(){return je.prototype.clear.call(this)},e.search=function(t){var n=je.prototype.search.call(this,this.toBBox(t));return kr(n)},e.collides=function(t){return je.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=je.prototype.all.call(this);return kr(t)},e.toJSON=function(){return je.prototype.toJSON.call(this)},e.fromJSON=function(t){return je.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ht(t);else if(t.type==="FeatureCollection")n=ht(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}bs.exports=Ur;yt.default=Ur;function Xr(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Hn(r)),e.type==="LineString"&&(e=Hn(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=$r(r,e);return i&&n.push(i),it(n)}var o=yt();return o.load(Ln(e)),Kt(Ln(r),function(s){Kt(o.search(s),function(u){var l=$r(s,u);if(l){var a=Ue(l).join(",");t[a]||(t[a]=!0,n.push(l))}})}),it(n)}function $r(r,e){var t=Ue(r),n=Ue(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],u=t[1][1],l=n[0][0],a=n[0][1],c=n[1][0],_=n[1][1],p=(_-a)*(s-i)-(c-l)*(u-o),f=(c-l)*(o-a)-(_-a)*(i-l),d=(s-i)*(o-a)-(u-o)*(i-l);if(p===0)return f===0&&d===0,null;var m=f/p,g=d/p;if(m>=0&&m<=1&&g>=0&&g<=1){var $=i+m*(s-i),h=o+m*(u-o);return vt([$,h])}return null}function Dt(r,e,t){t===void 0&&(t={});var n=vt([1/0,1/0],{dist:1/0}),i=0;return In(r,function(o){for(var s=Ue(o),u=0;u<s.length-1;u++){var l=vt(s[u]);l.properties.dist=tt(e,l,t);var a=vt(s[u+1]);a.properties.dist=tt(e,a,t);var c=tt(l,a,t),_=Math.max(l.properties.dist,a.properties.dist),p=zr(l,a),f=wr(e,_,p+90,t),d=wr(e,_,p-90,t),m=Xr(bt([f.geometry.coordinates,d.geometry.coordinates]),bt([l.geometry.coordinates,a.geometry.coordinates])),g=null;m.features.length>0&&(g=m.features[0],g.properties.dist=tt(e,g,t),g.properties.location=i+tt(l,g,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=u,n.properties.location=i),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=u+1,n.properties.location=i+c),g&&g.properties.dist<n.properties.dist&&(n=g,n.properties.index=u),i+=c}}),n}const dt="edit-polygon-mode";class Es{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"points");oe(this,"cursor");oe(this,"hover");oe(this,"dragFrom");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new Gn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),at(e,dt,{type:"geojson",data:Xe()}),Ce(e,{id:"edit-polygon-fill",source:dt,filter:cn,...ln("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Ce(e,{id:"edit-polygon-lines",source:dt,filter:fn,...It("black",8,.5)}),Ce(e,{id:"edit-polygon-vertices",source:dt,filter:an,...wt(ge.hovering,pn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Er(this.points).forEach((n,i)=>{t.push([i+1,Dt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(dt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Xe();this.points.forEach((n,i)=>{let o=Sr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Er(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(dt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Sr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Sr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Er(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let Z;const Ze=new Array(32).fill(void 0);Ze.push(void 0,null,!0,!1);function K(r){return Ze[r]}let Ot=Ze.length;function Ms(r){r<36||(Ze[r]=Ot,Ot=r)}function Tn(r){const e=K(r);return Ms(r),e}const Jr=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Jr.decode();let Xt=new Uint8Array;function Ft(){return Xt.byteLength===0&&(Xt=new Uint8Array(Z.memory.buffer)),Xt}function gt(r,e){return Jr.decode(Ft().subarray(r,r+e))}function $e(r){Ot===Ze.length&&Ze.push(Ze.length+1);const e=Ot;return Ot=Ze[e],Ze[e]=r,e}function gn(r){return r==null}let Jt=new Float64Array;function xs(){return Jt.byteLength===0&&(Jt=new Float64Array(Z.memory.buffer)),Jt}let Wt=new Int32Array;function Se(){return Wt.byteLength===0&&(Wt=new Int32Array(Z.memory.buffer)),Wt}let rt=0;const Vt=new TextEncoder("utf-8"),Cs=typeof Vt.encodeInto=="function"?function(r,e){return Vt.encodeInto(r,e)}:function(r,e){const t=Vt.encode(r);return e.set(t),{read:r.length,written:t.length}};function Yt(r,e,t){if(t===void 0){const u=Vt.encode(r),l=e(u.length);return Ft().subarray(l,l+u.length).set(u),rt=u.length,l}let n=r.length,i=e(n);const o=Ft();let s=0;for(;s<n;s++){const u=r.charCodeAt(s);if(u>127)break;o[i+s]=u}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const u=Ft().subarray(i+s,i+n),l=Cs(r,u);s+=l.written}return rt=s,i}function An(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=An(r[0]));for(let s=1;s<i;s++)o+=", "+An(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ls(r,e){const t=e(r.length*1);return Ft().set(r,t/1),rt=r.length,t}function _n(r,e){try{return r.apply(this,e)}catch(t){Z.__wbindgen_exn_store($e(t))}}class nn{static __wrap(e){const t=Object.create(nn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Z.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=Z.__wbindgen_add_to_stack_pointer(-16),s=Ls(e,Z.__wbindgen_malloc),u=rt;Z.jsroutesnapper_new(o,s,u);var t=Se()[o/4+0],n=Se()[o/4+1],i=Se()[o/4+2];if(i)throw Tn(n);return nn.__wrap(t)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){Z.jsroutesnapper_setConfig(this.ptr,$e(e))}toFinalFeature(){try{const n=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_toFinalFeature(n,this.ptr);var e=Se()[n/4+0],t=Se()[n/4+1];let i;return e!==0&&(i=gt(e,t).slice(),Z.__wbindgen_free(e,t*1)),i}finally{Z.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_renderGeojson(n,this.ptr);var e=Se()[n/4+0],t=Se()[n/4+1];return gt(e,t)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(e,t)}}setSnapMode(e){Z.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return Z.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){Z.jsroutesnapper_onClick(this.ptr)}onDragStart(){return Z.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return Z.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){Z.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_editExisting(i,this.ptr,$e(e));var t=Se()[i/4+0],n=Se()[i/4+1];if(n)throw Tn(t)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}}async function Rs(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ts(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Tn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=K(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(gt(e,t));return $e(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=gt(e,t);return $e(n)},r.wbg.__wbindgen_is_object=function(e){const t=K(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return K(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return K(e)in K(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=K(t),i=typeof n=="number"?n:void 0;xs()[e/8+1]=gn(i)?0:i,Se()[e/4+0]=!gn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return K(e)==K(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=K(t),i=typeof n=="string"?n:void 0;var o=gn(i)?0:Yt(i,Z.__wbindgen_malloc,Z.__wbindgen_realloc),s=rt;Se()[e/4+1]=s,Se()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(K(t)),i=Yt(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=rt;Se()[e/4+1]=o,Se()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=K(e);return $e(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=K(e)[K(t)];return $e(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(K(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(K(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(K(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(K(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(K(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=K(e)[t>>>0];return $e(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return K(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof K(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=K(e).next;return $e(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return _n(function(e){const t=K(e).next();return $e(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return K(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=K(e).value;return $e(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return $e(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return _n(function(e,t){const n=Reflect.get(K(e),K(t));return $e(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return _n(function(e,t){const n=K(e).call(K(t));return $e(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(K(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=K(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=K(e).buffer;return $e(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(K(e));return $e(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){K(e).set(K(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return K(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=K(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return $e(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=K(t).stack,i=Yt(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=rt;Se()[e/4+1]=o,Se()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(gt(e,t))}finally{Z.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=An(K(t)),i=Yt(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=rt;Se()[e/4+1]=o,Se()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(gt(e,t))},r.wbg.__wbindgen_memory=function(){const e=Z.memory;return $e(e)},r}function As(r,e){return Z=r.exports,Wr.__wbindgen_wasm_module=e,Jt=new Float64Array,Wt=new Int32Array,Xt=new Uint8Array,Z}async function Wr(r){typeof r>"u"&&(r="/atip/assets/route_snapper_bg.wasm");const e=Ts();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Rs(await r,e);return As(t,n)}const Ct="route-snapper",Mr=10,Ps=30;class Os{constructor(e,t){oe(this,"map");oe(this,"inner");oe(this,"active");oe(this,"eventListenersSuccessRoute");oe(this,"eventListenersSuccessArea");oe(this,"eventListenersFailure");oe(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new nn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],at(e,Ct,{type:"geojson",data:Xe()}),Ce(e,{id:"route-points",source:Ct,filter:an,...wt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Mr/2,Mr])}),Ce(e,{id:"route-lines",source:Ct,filter:fn,...It("black",2.5)}),Ce(e,{id:"route-polygons",source:Ct,filter:cn,...ln("black",.5)}),this.events=new Gn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Ps,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Ct).setData(JSON.parse(this.inner.renderGeojson()))}}function xr(r){let e;function t(o,s){return o[1]?Ns:Fs}let n=t(r),i=n(r);return{c(){i.c(),e=Pe()},m(o,s){i.m(o,s),y(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&w(e)}}}function Fs(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function Ns(r){let e;return{c(){e=k("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function Is(r){let e,t=r[0]==_t&&xr(r);return{c(){t&&t.c(),e=Pe()},m(n,i){t&&t.m(n,i),y(n,e,i)},p(n,[i]){n[0]==_t?t?t.p(n,i):(t=xr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:W,o:W,d(n){t&&t.d(n),n&&w(e)}}}const _t="edit-attribute";function Vr(){}function Bs(r,e,t){let n,i,o,s;ce(r,Je,f=>t(5,n=f)),ce(r,se,f=>t(6,i=f)),ce(r,wn,f=>t(7,o=f)),ce(r,Ae,f=>t(1,s=f));let{mode:u}=e,{changeMode:l}=e;function a(){Ae.set(null)}n.on("mousemove",c),n.on("mouseout",_),n.on("click",p),Gt(()=>{n.off("mousemove",c),n.off("mouseout",_),n.off("click",p)});function c(f){var d;if(u==_t){let m=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Qe.set(((d=m[0])==null?void 0:d.id)||null)}}function _(){u==_t&&Qe.set(null)}function p(f){if(u==_t){let d=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});d.length>0?Ae.set(d[0].id):Ae.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,u=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let d=i.features.find(m=>m.id==f);d.geometry.type=="Point"?n.flyTo({center:d.geometry.coordinates,duration:500}):n.fitBounds(Nn(d),{padding:200,duration:500}),l(_t)}}},[u,s,l,Vr,a,n,i,o]}class Ds extends re{constructor(e){super(),ie(this,e,Bs,Is,ne,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Vr}get stop(){return this.$$.ctx[4]}}function Gs(r){let e,t;return{c:W,m(n,i){e||(t=Y(window,"keydown",r[0]),e=!0)},p:W,i:W,o:W,d(n){e=!1,t()}}}function qs(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class hn extends re{constructor(e){super(),ie(this,e,qs,Gs,ne,{tool:1})}}function js(r){let e;return{c(){e=k("p"),e.textContent="Click to add a new point"},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function zs(r){let e;return{c(){e=k("p"),e.textContent="Click to move the point here"},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function Ys(r){let e,t,n,i,o,s,u,l,a;function c(f,d){return f[1]?zs:js}let _=c(r),p=_(r);return s=new hn({props:{tool:r[0]}}),{c(){p.c(),e=M(),t=k("p"),t.innerHTML="Press <b>Escape</b> to cancel",n=M(),i=k("button"),i.textContent="Cancel",o=M(),I(s.$$.fragment),P(i,"type","button")},m(f,d){p.m(f,d),y(f,e,d),y(f,t,d),y(f,n,d),y(f,i,d),y(f,o,d),B(s,f,d),u=!0,l||(a=Y(i,"click",r[2]),l=!0)},p(f,[d]){_!==(_=c(f))&&(p.d(1),p=_(f),p&&(p.c(),p.m(e.parentNode,e)));const m={};d&1&&(m.tool=f[0]),s.$set(m)},i(f){u||(L(s.$$.fragment,f),u=!0)},o(f){T(s.$$.fragment,f),u=!1},d(f){p.d(f),f&&w(e),f&&w(t),f&&w(n),f&&w(i),f&&w(o),D(s,f),l=!1,a()}}}function Hs(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Kr extends re{constructor(e){super(),ie(this,e,Hs,Ys,ne,{pointTool:0,editingExisting:1})}}function Us(r){let e,t,n,i,o,s,u,l,a,c,_;return l=new hn({props:{tool:r[0]}}),{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=M(),n=k("div"),i=k("button"),i.textContent="Finish",o=M(),s=k("button"),s.textContent="Cancel",u=M(),I(l.$$.fragment),P(i,"type","button"),P(s,"type","button"),pe(n,"display","flex"),pe(n,"justify-content","space-between")},m(p,f){y(p,e,f),y(p,t,f),y(p,n,f),S(n,i),S(n,o),S(n,s),y(p,u,f),B(l,p,f),a=!0,c||(_=[Y(i,"click",r[1]),Y(s,"click",r[2])],c=!0)},p(p,[f]){const d={};f&1&&(d.tool=p[0]),l.$set(d)},i(p){a||(L(l.$$.fragment,p),a=!0)},o(p){T(l.$$.fragment,p),a=!1},d(p){p&&w(e),p&&w(t),p&&w(n),p&&w(u),D(l,p),c=!1,qe(_)}}}function Xs(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Zr extends re{constructor(e){super(),ie(this,e,Xs,Us,ne,{polygonTool:0})}}function Js(r){let e,t,n,i,o,s,u,l,a,c,_;return l=new hn({props:{tool:r[0]}}),{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish area</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=M(),n=k("div"),i=k("button"),i.textContent="Finish",o=M(),s=k("button"),s.textContent="Cancel",u=M(),I(l.$$.fragment),P(i,"type","button"),P(s,"type","button"),pe(n,"display","flex"),pe(n,"justify-content","space-between")},m(p,f){y(p,e,f),y(p,t,f),y(p,n,f),S(n,i),S(n,o),S(n,s),y(p,u,f),B(l,p,f),a=!0,c||(_=[Y(i,"click",r[1]),Y(s,"click",r[2])],c=!0)},p(p,[f]){const d={};f&1&&(d.tool=p[0]),l.$set(d)},i(p){a||(L(l.$$.fragment,p),a=!0)},o(p){T(l.$$.fragment,p),a=!1},d(p){p&&w(e),p&&w(t),p&&w(n),p&&w(u),D(l,p),c=!1,qe(_)}}}function Ws(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Qr extends re{constructor(e){super(),ie(this,e,Ws,Js,ne,{routeTool:0})}}function Vs(r){let e,t,n,i,o,s,u,l,a,c,_,p,f,d,m;return p=new hn({props:{tool:r[0]}}),{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=M(),n=k("label"),i=k("input"),o=J(`
  Avoid doubling back`),s=M(),u=k("div"),l=k("button"),l.textContent="Finish",a=M(),c=k("button"),c.textContent="Cancel",_=M(),I(p.$$.fragment),P(i,"type","checkbox"),P(l,"type","button"),P(c,"type","button"),pe(u,"display","flex"),pe(u,"justify-content","space-between")},m(g,$){y(g,e,$),y(g,t,$),y(g,n,$),S(n,i),i.checked=r[1],S(n,o),y(g,s,$),y(g,u,$),S(u,l),S(u,a),S(u,c),y(g,_,$),B(p,g,$),f=!0,d||(m=[Y(i,"change",r[2]),Y(l,"click",r[3]),Y(c,"click",r[4])],d=!0)},p(g,[$]){$&2&&(i.checked=g[1]);const h={};$&1&&(h.tool=g[0]),p.$set(h)},i(g){f||(L(p.$$.fragment,g),f=!0)},o(g){T(p.$$.fragment,g),f=!1},d(g){g&&w(e),g&&w(t),g&&w(n),g&&w(s),g&&w(u),g&&w(_),D(p,g),d=!1,qe(m)}}}function Ks(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),u=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,u]}class ei extends re{constructor(e){super(),ie(this,e,Ks,Vs,ne,{routeTool:0})}}function Cr(r){let e,t,n,i;const o=[nl,tl,el,Qs,Zs],s=[];function u(l,a){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=Pe()},m(l,a){s[e].m(l,a),y(l,n,a),i=!0},p(l,a){let c=e;e=u(l),e===c?s[e].p(l,a):(Fe(),T(s[c],1,1,()=>{s[c]=null}),Ne(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),L(t,1),t.m(n.parentNode,n))},i(l){i||(L(t),i=!0)},o(l){T(t),i=!1},d(l){s[e].d(l),l&&w(n)}}}function Zs(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){y(t,e,n)},p:W,i:W,o:W,d(t){t&&w(e)}}}function Qs(r){let e,t;return e=new ei({props:{routeTool:r[3]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function el(r){let e,t;return e=new Qr({props:{routeTool:r[3]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function tl(r){let e,t;return e=new Zr({props:{polygonTool:r[2]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function nl(r){let e,t;return e=new Kr({props:{pointTool:r[1],editingExisting:!0}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function rl(r){let e,t,n=r[0]==Ke&&Cr(r);return{c(){n&&n.c(),e=Pe()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==Ke?n?(n.p(i,o),o&1&&L(n,1)):(n=Cr(i),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(Fe(),T(n,1,1,()=>{n=null}),Ne())},i(i){t||(L(n),t=!0)},o(i){T(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const Ke="edit-geometry";function ti(){}function il(r,e,t){let n;ce(r,Je,m=>t(8,n=m));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:u}=e,l=null,a=null;function c(){l&&(o.stop(),s.stop(),u.stop(),se.update(m=>{let g=m.features.find($=>$.id==l);return delete g.properties.hide_while_editing,m})),l=null,t(4,a=null),Qe.set(null)}n.on("mousemove",_),n.on("mouseout",p),n.on("click",f),Gt(()=>{n.off("mousemove",_),n.off("mouseout",p),n.off("click",f)}),u.addEventListenerSuccessRoute(m=>{i==Ke&&(se.update(g=>{let $=g.features.find(h=>h.id==l);return $.properties.length_meters=m.properties.length_meters,$.properties.waypoints=m.properties.waypoints,delete $.properties.hide_while_editing,$.geometry=m.geometry,g}),l=null,t(4,a=null))}),u.addEventListenerSuccessArea(m=>{i==Ke&&(se.update(g=>{let $=g.features.find(h=>h.id==l);return $.properties.waypoints=m.properties.waypoints,delete $.properties.hide_while_editing,$.geometry=m.geometry,g}),l=null,t(4,a=null))});for(let m of[o,s])m.addEventListenerSuccess(g=>{i==Ke&&(se.update($=>{let h=$.features.find(v=>v.id==l);return h.geometry=g.geometry,delete h.properties.hide_while_editing,$}),l=null,t(4,a=null))});for(let m of[o,s,u])m.addEventListenerFailure(()=>{i==Ke&&(se.update(g=>{let $=g.features.find(h=>h.id==l);return delete $.properties.hide_while_editing,g}),l=null,t(4,a=null))});function _(m){var g;if(i==Ke&&l==null){let $=n.queryRenderedFeatures(m.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Qe.set(((g=$[0])==null?void 0:g.id)||null)}}function p(){i==Ke&&l==null&&Qe.set(null)}function f(m){if(i==Ke&&l==null){let g=n.queryRenderedFeatures(m.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0&&d(g[0].id)}}function d(m){Qe.set(null);let g=null;se.update(h=>(g=h.features.find(v=>v.id==m),g.properties.hide_while_editing=!0,h));let $=g;l=m,$.geometry.type=="LineString"?(u.editExistingRoute($),t(4,a="route")):$.geometry.type=="Polygon"?$.properties.waypoints?(u.editExistingArea($),t(4,a="snap-polygon")):(s.editExisting($),t(4,a="free-polygon")):$.geometry.type=="Point"&&(o.start(),t(4,a="point"))}return r.$$set=m=>{"mode"in m&&t(0,i=m.mode),"pointTool"in m&&t(1,o=m.pointTool),"polygonTool"in m&&t(2,s=m.polygonTool),"routeTool"in m&&t(3,u=m.routeTool)},[i,o,s,u,a,ti,c]}class ol extends re{constructor(e){super(),ie(this,e,il,rl,ne,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return ti}get stop(){return this.$$.ctx[6]}}async function sl(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:a,value:c}=await n.read();if(a)break;s.push(c),o+=c.length;const _=100*o/i;e.style=`background: linear-gradient(to right, red ${_}%, transparent 0);`}let u=new Uint8Array(o),l=0;for(let a of s)u.set(a,l),l+=a.length;return u}function ll(r){let e,t;return e=new ei({props:{routeTool:r[0]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ul(r){let e;return{c(){e=k("div"),e.textContent="Route tool loading..."},m(t,n){y(t,e,n),r[7](e)},p:W,i:W,o:W,d(t){t&&w(e),r[7](null)}}}function al(r){let e,t,n,i;const o=[ul,ll],s=[];function u(l,a){return l[0]?l[1]==Pn?1:-1:0}return~(e=u(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=Pe()},m(l,a){~e&&s[e].m(l,a),y(l,n,a),i=!0},p(l,[a]){let c=e;e=u(l),e===c?~e&&s[e].p(l,a):(t&&(Fe(),T(s[c],1,1,()=>{s[c]=null}),Ne()),~e?(t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),L(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(L(t),i=!0)},o(l){T(t),i=!1},d(l){~e&&s[e].d(l),l&&w(n)}}}const Pn="route";function fl(r,e,t){let n;ce(r,Je,p=>t(8,n=p));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,u,{routeTool:l}=e;function a(){l.isActive()||l.startRoute()}function c(){l==null||l.stop()}Fn(async()=>{await Wr(),console.log(`Grabbing ${s}`);try{const p=await sl(s,u);t(0,l=new Os(n,p))}catch(p){console.log(`Route tool broke: ${p}`),t(2,u.innerHTML="Failed to load",u);return}l.addEventListenerFailure(()=>{i==Pn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(p=>{i==Pn&&(se.update(f=>(p.id=qt(f),p.properties.intervention_type="route",f.features.push(p),f)),o("edit-attribute"),Ae.set(p.id))})});function _(p){be[p?"unshift":"push"](()=>{u=p,t(2,u)})}return r.$$set=p=>{"mode"in p&&t(1,i=p.mode),"changeMode"in p&&t(3,o=p.changeMode),"url"in p&&t(4,s=p.url),"routeTool"in p&&t(0,l=p.routeTool)},[l,i,u,o,s,a,c,_]}class cl extends re{constructor(e){super(),ie(this,e,fl,al,ne,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Lr(r){let e,t;return e=new Kr({props:{pointTool:r[1],editingExisting:!1}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function pl(r){let e,t,n=r[0]==rn&&Lr(r);return{c(){n&&n.c(),e=Pe()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==rn?n?(n.p(i,o),o&1&&L(n,1)):(n=Lr(i),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(Fe(),T(n,1,1,()=>{n=null}),Ne())},i(i){t||(L(n),t=!0)},o(i){T(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const rn="point";function hl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==rn&&(se.update(a=>(l.id=qt(a),l.properties.intervention_type="other",a.features.push(l),a)),i("edit-attribute"),Ae.set(l.id))}),o.addEventListenerFailure(()=>{n==rn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,u]}class dl extends re{constructor(e){super(),ie(this,e,hl,pl,ne,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Rr(r){let e,t;return e=new Zr({props:{polygonTool:r[1]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ml(r){let e,t,n=r[0]==on&&Rr(r);return{c(){n&&n.c(),e=Pe()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==on?n?(n.p(i,o),o&1&&L(n,1)):(n=Rr(i),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(Fe(),T(n,1,1,()=>{n=null}),Ne())},i(i){t||(L(n),t=!0)},o(i){T(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const on="free-polygon";function gl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==on&&(se.update(a=>(l.id=qt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),Ae.set(l.id))}),o.addEventListenerFailure(()=>{n==on&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,u]}class _l extends re{constructor(e){super(),ie(this,e,gl,ml,ne,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Tr(r){let e,t;return e=new Qr({props:{routeTool:r[1]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function vl(r){let e,t,n=r[0]==sn&&Tr(r);return{c(){n&&n.c(),e=Pe()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==sn?n?(n.p(i,o),o&1&&L(n,1)):(n=Tr(i),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(Fe(),T(n,1,1,()=>{n=null}),Ne())},i(i){t||(L(n),t=!0)},o(i){T(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const sn="snap-polygon";function bl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function u(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==sn&&(se.update(a=>(l.id=qt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),Ae.set(l.id))}),o.addEventListenerFailure(()=>{n==sn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,u]}class yl extends re{constructor(e){super(),ie(this,e,bl,vl,ne,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function wl(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=tt(r.slice(0,2),[n,t]),s=tt(r.slice(0,2),[e,i]);if(o>=s){var u=(t+i)/2;return[e,u-(n-e)/2,n,u+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function kl(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return wi(r,function(s){$l(s,o,n)}),r}function $l(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Sl(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Cn(r),n=Cn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=kl(e,{precision:7});switch(n){case"Point":return On(r,i);case"MultiPoint":return Ar(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Ar(r,Xr(r,i))}}function Ar(r,e){var t=[],n=yt();return In(e,function(i){if(t.forEach(function(u,l){u.id=l}),!t.length)t=On(r,i).features,t.forEach(function(u){u.bbox||(u.bbox=wl(ki(u)))}),n.load(it(t));else{var o=n.search(i);if(o.features.length){var s=ni(i,o);t=t.filter(function(u){return u.id!==s.id}),n.remove(s),Kt(On(s,i),function(u){t.push(u),n.insert(u)})}}}),it(t)}function On(r,e){var t=[],n=Ue(r)[0],i=Ue(r)[r.geometry.coordinates.length-1];if(vn(n,ot(e))||vn(i,ot(e)))return it([r]);var o=yt(),s=Ln(r);o.load(s);var u=o.search(e);if(!u.features.length)return it([r]);var l=ni(e,u),a=[n],c=$i(s,function(_,p,f){var d=Ue(p)[1],m=ot(e);return f===l.id?(_.push(m),t.push(bt(_)),vn(m,d)?[m]:[m,d]):(_.push(d),_)},a);return c.length>1&&t.push(bt(c)),it(t)}function ni(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return Kt(e,function(i){var o=Dt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function vn(r,e){return r[0]===e[0]&&r[1]===e[1]}function El(r,e,t){var n=Ue(t);if(Cn(t)!=="LineString")throw new Error("line must be a LineString");var i=Dt(t,r),o=Dt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var u=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)u.push(n[l]);return u.push(s[1].geometry.coordinates),bt(u,t.properties)}function Pr(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function Ml(r){let e,t,n,i=r[0]==Nt&&Pr();return{c(){i&&i.c(),e=Pe()},m(o,s){i&&i.m(o,s),y(o,e,s),t||(n=Y(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Nt?i||(i=Pr(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:W,o:W,d(o){i&&i.d(o),o&&w(e),t=!1,n()}}}const Nt="split-route",xl=10,Cl=30;let bn="split-route";function ri(){}function Or(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Ll(r,e,t){let n,i;ce(r,se,m=>t(8,n=m)),ce(r,Je,m=>t(6,i=m));let{mode:o}=e,{changeMode:s}=e;function u(){t(5,l=null),a=null}let l=null,a=null;i.on("mousemove",c),i.on("click",_),Gt(()=>{i.off("mousemove",c),i.off("click",_)}),at(i,bn,{type:"geojson",data:Xe()}),Ce(i,{id:"draw-split-route",source:bn,...wt("black",xl,["case",["==",["get","snapped"],!0],1,.5])});function c(m){if(o!=Nt)return;t(5,l=Or(m.lngLat.toArray(),!1)),a=null;const g=[m.point.x-Cl,m.point.y],$=i.unproject(m.point).distanceTo(i.unproject(g))/1e3;let h=[];for(let[v,b]of n.features.entries())if(b.geometry.type=="LineString"){let x=Dt(b.geometry,l,{units:"kilometers"});x.properties.dist!=null&&x.properties.dist<=$&&h.push([v,x.geometry.coordinates,x.properties.dist])}h.sort((v,b)=>v[2]-b[2]),h.length>0&&(t(5,l=Or(h[0][1],!0)),a=h[0][0])}function _(){if(o==Nt)if(a==null)s("edit-attribute");else{let m=Sl(n.features[a],l);if(m.features.length==2){let g=m.features[0],$=m.features[1];se.update(h=>(g.id=h.features[a].id,$.id=qt(h),g.properties=JSON.parse(JSON.stringify(h.features[a].properties)),$.properties=JSON.parse(JSON.stringify(g.properties)),p(h.features[a],g,$,l),h.features.splice(a,1,g,$),h))}u()}}function p(m,g,$,h){g.properties.length_meters=Ut(g,{units:"kilometers"})*1e3,$.properties.length_meters=Ut($,{units:"kilometers"})*1e3,g.properties.waypoints=[],$.properties.waypoints=[];let v=f(m,h),b=!0,x=0;for(let R of m.properties.waypoints){let A=f(m,vt([R.lon,R.lat]));if(b)if(A<v)g.properties.waypoints.push(R);else{let C=R.snapped&&m.properties.waypoints[x-1].snapped;g.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:C}),b=!1,$.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:C}),$.properties.waypoints.push(R)}else $.properties.waypoints.push(R);x++}}function f(m,g){let $=m.geometry.coordinates[0],h=El($,g,m);return Ut(h,{units:"kilometers"})*1e3}function d(m){o==Nt&&m.key=="Escape"&&(s("edit-attribute"),m.preventDefault())}return r.$$set=m=>{"mode"in m&&t(0,o=m.mode),"changeMode"in m&&t(2,s=m.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let m=Xe();l&&m.features.push(l),i.getSource(bn).setData(m)}},[o,d,s,ri,u,l,i]}class Rl extends re{constructor(e){super(),ie(this,e,Ll,Ml,ne,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ri}get stop(){return this.$$.ctx[4]}}function Fr(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new ol({props:n}),r[17](e),{c(){I(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){T(e.$$.fragment,i),t=!1},d(i){r[17](null),D(e,i)}}}function Nr(r){let e,t,n,i,o;return{c(){e=k("button"),t=J("New point"),P(e,"type","button"),e.disabled=n=r[3]=="point",P(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),S(e,t),i||(o=Y(e,"click",r[18]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function Ir(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new yl({props:n}),r[23](e),{c(){I(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){T(e.$$.fragment,i),t=!1},d(i){r[23](null),D(e,i)}}}function Br(r){let e,t,n,i,o;return{c(){e=k("button"),t=J("New route"),P(e,"type","button"),e.disabled=n=r[3]=="route",P(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),S(e,t),i||(o=Y(e,"click",r[24]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function Dr(r){let e,t,n,i,o;return{c(){e=k("button"),t=J("Split route"),P(e,"type","button"),e.disabled=n=r[3]=="split-route",P(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),S(e,t),i||(o=Y(e,"click",r[27]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function Tl(r){let e,t,n,i,o,s,u,l,a,c,_,p,f,d,m,g,$,h,v,b,x,R,A,C,G,j,q,V,O,U,te,he,z,le,we,Le,de,ae,Ee,ue,F,Q,$t={mode:r[3],changeMode:r[13]};u=new Ds({props:$t}),r[15](u);let me=r[2]&&Fr(r),ke=r[1]!="planning"&&Nr(r),St={mode:r[3],changeMode:r[13],pointTool:r[11]};$=new dl({props:St}),r[19]($);let lt={mode:r[3],changeMode:r[13],polygonTool:r[12]};C=new _l({props:lt}),r[21](C);let _e=r[2]&&Ir(r),fe=r[1]!="planning"&&Br(r);function Et(H){r[26](H)}let Mt={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(Mt.routeTool=r[2]),le=new cl({props:Mt}),r[25](le),be.push(()=>Ye(le,"routeTool",Et,r[2]));let ve=r[1]!="planning"&&Dr(r),xe={mode:r[3],changeMode:r[13]};return Ee=new Rl({props:xe}),r[28](Ee),{c(){e=k("div"),t=k("div"),n=k("button"),i=J("Edit attributes"),s=M(),I(u.$$.fragment),l=M(),a=k("div"),c=k("button"),_=J("Edit geometry"),f=M(),me&&me.c(),d=M(),m=k("div"),ke&&ke.c(),g=M(),I($.$$.fragment),h=M(),v=k("div"),b=k("button"),x=J("New polygon (freehand)"),A=M(),I(C.$$.fragment),G=M(),j=k("div"),q=k("button"),V=J("New polygon (snapped)"),U=M(),_e&&_e.c(),te=M(),he=k("div"),fe&&fe.c(),z=M(),I(le.$$.fragment),Le=M(),de=k("div"),ve&&ve.c(),ae=M(),I(Ee.$$.fragment),P(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",P(n,"class","svelte-cej5os"),P(c,"type","button"),c.disabled=p=r[3]=="edit-geometry",P(c,"class","svelte-cej5os"),P(b,"type","button"),b.disabled=R=r[3]=="free-polygon",P(b,"class","svelte-cej5os"),P(q,"type","button"),q.disabled=O=r[3]=="snap-polygon",P(q,"class","svelte-cej5os"),P(e,"class","toolbox svelte-cej5os")},m(H,ee){y(H,e,ee),S(e,t),S(t,n),S(n,i),S(t,s),B(u,t,null),S(e,l),S(e,a),S(a,c),S(c,_),S(a,f),me&&me.m(a,null),S(e,d),S(e,m),ke&&ke.m(m,null),S(m,g),B($,m,null),S(e,h),S(e,v),S(v,b),S(b,x),S(v,A),B(C,v,null),S(e,G),S(e,j),S(j,q),S(q,V),S(j,U),_e&&_e.m(j,null),S(e,te),S(e,he),fe&&fe.m(he,null),S(he,z),B(le,he,null),S(e,Le),S(e,de),ve&&ve.m(de,null),S(de,ae),B(Ee,de,null),ue=!0,F||(Q=[Y(n,"click",r[14]),Y(c,"click",r[16]),Y(b,"click",r[20]),Y(q,"click",r[22])],F=!0)},p(H,[ee]){(!ue||ee&8&&o!==(o=H[3]=="edit-attribute"))&&(n.disabled=o);const We={};ee&8&&(We.mode=H[3]),u.$set(We),(!ue||ee&8&&p!==(p=H[3]=="edit-geometry"))&&(c.disabled=p),H[2]?me?(me.p(H,ee),ee&4&&L(me,1)):(me=Fr(H),me.c(),L(me,1),me.m(a,null)):me&&(Fe(),T(me,1,1,()=>{me=null}),Ne()),H[1]!="planning"?ke?ke.p(H,ee):(ke=Nr(H),ke.c(),ke.m(m,g)):ke&&(ke.d(1),ke=null);const Me={};ee&8&&(Me.mode=H[3]),$.$set(Me),(!ue||ee&8&&R!==(R=H[3]=="free-polygon"))&&(b.disabled=R);const Ve={};ee&8&&(Ve.mode=H[3]),C.$set(Ve),(!ue||ee&8&&O!==(O=H[3]=="snap-polygon"))&&(q.disabled=O),H[2]?_e?(_e.p(H,ee),ee&4&&L(_e,1)):(_e=Ir(H),_e.c(),L(_e,1),_e.m(j,null)):_e&&(Fe(),T(_e,1,1,()=>{_e=null}),Ne()),H[1]!="planning"?fe?fe.p(H,ee):(fe=Br(H),fe.c(),fe.m(he,z)):fe&&(fe.d(1),fe=null);const ye={};ee&8&&(ye.mode=H[3]),ee&1&&(ye.url=H[0]),!we&&ee&4&&(we=!0,ye.routeTool=H[2],He(()=>we=!1)),le.$set(ye),H[1]!="planning"?ve?ve.p(H,ee):(ve=Dr(H),ve.c(),ve.m(de,ae)):ve&&(ve.d(1),ve=null);const E={};ee&8&&(E.mode=H[3]),Ee.$set(E)},i(H){ue||(L(u.$$.fragment,H),L(me),L($.$$.fragment,H),L(C.$$.fragment,H),L(_e),L(le.$$.fragment,H),L(Ee.$$.fragment,H),ue=!0)},o(H){T(u.$$.fragment,H),T(me),T($.$$.fragment,H),T(C.$$.fragment,H),T(_e),T(le.$$.fragment,H),T(Ee.$$.fragment,H),ue=!1},d(H){H&&w(e),r[15](null),D(u),me&&me.d(),ke&&ke.d(),r[19](null),D($),r[21](null),D(C),_e&&_e.d(),fe&&fe.d(),r[25](null),D(le),ve&&ve.d(),r[28](null),D(Ee),F=!1,qe(Q)}}}function Al(r,e,t){let n;ce(r,Je,z=>t(29,n=z));let{routeUrl:i}=e,{schema:o}=e,s,u=new hs(n),l=new Es(n),a="edit-attribute",c,_,p,f,d,m,g;function $(z){let le={"edit-attribute":c,"edit-geometry":_,route:p,point:f,"free-polygon":d,"snap-polygon":m,"split-route":g};if(a==z){console.log(`Mode is already ${a}, not changing`);return}console.log(`Stopping old mode ${a}`),le[a].stop(),t(3,a=z),console.log(`Starting new mode ${a}`),le[a].start()}Gt(()=>{u==null||u.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const h=()=>$("edit-attribute");function v(z){be[z?"unshift":"push"](()=>{c=z,t(4,c)})}const b=()=>$("edit-geometry");function x(z){be[z?"unshift":"push"](()=>{_=z,t(5,_)})}const R=()=>$("point");function A(z){be[z?"unshift":"push"](()=>{f=z,t(7,f)})}const C=()=>$("free-polygon");function G(z){be[z?"unshift":"push"](()=>{d=z,t(8,d)})}const j=()=>$("snap-polygon");function q(z){be[z?"unshift":"push"](()=>{m=z,t(9,m)})}const V=()=>$("route");function O(z){be[z?"unshift":"push"](()=>{p=z,t(6,p)})}function U(z){s=z,t(2,s)}const te=()=>$("split-route");function he(z){be[z?"unshift":"push"](()=>{g=z,t(10,g)})}return r.$$set=z=>{"routeUrl"in z&&t(0,i=z.routeUrl),"schema"in z&&t(1,o=z.schema)},[i,o,s,a,c,_,p,f,d,m,g,u,l,$,h,v,b,x,R,A,C,G,j,q,V,O,U,te,he]}class Pl extends re{constructor(e){super(),ie(this,e,Al,Tl,ne,{routeUrl:0,schema:1})}}function Ol(r){let e,t,n,i,o,s,u,l,a,c,_,p,f,d,m,g,$,h;return{c(){e=k("div"),t=k("div"),n=k("button"),n.textContent="Home",i=M(),o=k("button"),o.textContent="About",s=M(),u=k("button"),u.textContent="Instructions",l=M(),a=k("br"),c=M(),_=k("label"),p=J(`ATIP schema:
      `),f=k("select"),d=k("option"),d.textContent="Design (v1)",m=k("option"),m.textContent="Design (v2)",g=k("option"),g.textContent="Planning",P(n,"type","button"),P(o,"type","button"),P(u,"type","button"),d.__value="v1",d.value=d.__value,m.__value="v2",m.value=m.__value,g.__value="planning",g.value=g.__value,r[2]===void 0&&ut(()=>r[11].call(f)),P(e,"slot","nav")},m(v,b){y(v,e,b),S(e,t),S(t,n),S(t,i),S(t,o),S(t,s),S(t,u),S(e,l),S(e,a),S(e,c),S(e,_),S(_,p),S(_,f),S(f,d),S(f,m),S(f,g),Oe(f,r[2]),$||(h=[Y(n,"click",r[10]),Y(o,"click",r[7]),Y(u,"click",r[8]),Y(f,"change",r[11]),Y(f,"change",r[9])],$=!0)},p(v,b){b&4&&Oe(f,v[2])},d(v){v&&w(e),$=!1,qe(h)}}}function Fl(r){let e,t,n,i,o,s,u,l,a,c,_,p;return o=new es({props:{boundaryGeojson:r[4]}}),u=new Vo({props:{authorityName:r[5],schema:r[2]}}),_=new Ho({props:{schema:r[2]}}),{c(){e=k("div"),t=k("h1"),n=J(r[5]),i=M(),I(o.$$.fragment),s=M(),I(u.$$.fragment),l=M(),a=k("br"),c=M(),I(_.$$.fragment),P(e,"slot","sidebar")},m(f,d){y(f,e,d),S(e,t),S(t,n),S(t,i),B(o,t,null),S(e,s),B(u,e,null),S(e,l),S(e,a),S(e,c),B(_,e,null),p=!0},p(f,d){const m={};d&16&&(m.boundaryGeojson=f[4]),o.$set(m);const g={};d&4&&(g.schema=f[2]),u.$set(g);const $={};d&4&&($.schema=f[2]),_.$set($)},i(f){p||(L(o.$$.fragment,f),L(u.$$.fragment,f),L(_.$$.fragment,f),p=!0)},o(f){T(o.$$.fragment,f),T(u.$$.fragment,f),T(_.$$.fragment,f),p=!1},d(f){f&&w(e),D(o),D(u),D(_)}}}function Nl(r){let e,t,n,i,o,s,u,l,a,c,_,p;return e=new co({props:{boundaryGeojson:r[4]}}),n=new fs({props:{schema:r[2]}}),o=new ps({}),u=new Pl({props:{routeUrl:r[3],schema:r[2]}}),a=new rs({props:{style:r[6]}}),_=new us({props:{schema:r[2]}}),{c(){I(e.$$.fragment),t=M(),I(n.$$.fragment),i=M(),I(o.$$.fragment),s=M(),I(u.$$.fragment),l=M(),I(a.$$.fragment),c=M(),I(_.$$.fragment)},m(f,d){B(e,f,d),y(f,t,d),B(n,f,d),y(f,i,d),B(o,f,d),y(f,s,d),B(u,f,d),y(f,l,d),B(a,f,d),y(f,c,d),B(_,f,d),p=!0},p(f,d){const m={};d&16&&(m.boundaryGeojson=f[4]),e.$set(m);const g={};d&4&&(g.schema=f[2]),n.$set(g);const $={};d&8&&($.routeUrl=f[3]),d&4&&($.schema=f[2]),u.$set($);const h={};d&4&&(h.schema=f[2]),_.$set(h)},i(f){p||(L(e.$$.fragment,f),L(n.$$.fragment,f),L(o.$$.fragment,f),L(u.$$.fragment,f),L(a.$$.fragment,f),L(_.$$.fragment,f),p=!0)},o(f){T(e.$$.fragment,f),T(n.$$.fragment,f),T(o.$$.fragment,f),T(u.$$.fragment,f),T(a.$$.fragment,f),T(_.$$.fragment,f),p=!1},d(f){D(e,f),f&&w(t),D(n,f),f&&w(i),D(o,f),f&&w(s),D(u,f),f&&w(l),D(a,f),f&&w(c),D(_,f)}}}function Il(r){let e,t,n;return t=new Ai({props:{style:r[6],$$slots:{default:[Nl]},$$scope:{ctx:r}}}),{c(){e=k("div"),I(t.$$.fragment),P(e,"slot","main")},m(i,o){y(i,e,o),B(t,e,null),n=!0},p(i,o){const s={};o&131100&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(L(t.$$.fragment,i),n=!0)},o(i){T(t.$$.fragment,i),n=!1},d(i){i&&w(e),D(t)}}}function Bl(r){let e,t,n,i,o,s,u,l;e=new Bi({props:{$$slots:{main:[Il],sidebar:[Fl],nav:[Ol]},$$scope:{ctx:r}}});function a(f){r[12](f)}let c={};r[0]!==void 0&&(c.open=r[0]),n=new Si({props:c}),be.push(()=>Ye(n,"open",a,r[0]));function _(f){r[13](f)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new Li({props:p}),be.push(()=>Ye(s,"open",_,r[1])),{c(){I(e.$$.fragment),t=M(),I(n.$$.fragment),o=M(),I(s.$$.fragment)},m(f,d){B(e,f,d),y(f,t,d),B(n,f,d),y(f,o,d),B(s,f,d),l=!0},p(f,[d]){const m={};d&131100&&(m.$$scope={dirty:d,ctx:f}),e.$set(m);const g={};!i&&d&1&&(i=!0,g.open=f[0],He(()=>i=!1)),n.$set(g);const $={};!u&&d&2&&(u=!0,$.open=f[1],He(()=>u=!1)),s.$set($)},i(f){l||(L(e.$$.fragment,f),L(n.$$.fragment,f),L(s.$$.fragment,f),l=!0)},o(f){T(e.$$.fragment,f),T(n.$$.fragment,f),T(s.$$.fragment,f),l=!1},d(f){D(e,f),f&&w(t),D(n,f),f&&w(o),D(s,f)}}}function Dl(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let u=s.get("authority"),l=s.get("style")||"streets",a=s.get("schema")||"v1";var c=`https://atip.uk/route-snappers/${u}.bin`;o||(c=`https://atip.uk/route-snappers-dev/${u}.bin`);function _(){t(0,n=!n),t(1,i=!1)}function p(){t(1,i=!i),t(0,n=!1)}let f;Fn(async()=>{t(4,f=await d())});async function d(){const x=await(await fetch(Ei)).text(),R=JSON.parse(x);return R.features=R.features.filter(A=>{var C;return((C=A.properties)==null?void 0:C.name)==u}),R}function m(){let b=new URLSearchParams(window.location.search);b.set("schema",a);let x=`${window.location.pathname}?${b.toString()}${window.location.hash}`;window.location.href=x}const g=()=>window.open("index.html");function $(){a=mt(this),t(2,a)}function h(b){n=b,t(0,n)}function v(b){i=b,t(1,i)}return[n,i,a,c,f,u,l,_,p,m,g,$,h,v]}class Gl extends re{constructor(e){super(),ie(this,e,Dl,Bl,ne,{})}}new Gl({target:document.getElementById("app")});
