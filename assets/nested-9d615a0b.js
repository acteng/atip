var ai=Object.defineProperty;var fi=(r,e,t)=>e in r?ai(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ie=(r,e,t)=>(fi(r,typeof e!="symbol"?e+"":e,t),t);import{S as se,i as le,s as oe,M as ci,b as ye,a as it,d as Q,m as ee,k as ot,n as B,o as j,q as te,e as w,c as L,g as y,x as V,p as b,y as qe,f as O,z as ze,B as Ye,C as pi,D as Gn,E as vn,F as Rt,G as Nt,H as It,I as Bt,J as Dt,K as Kn,h as S,l as z,L as hi,N as di,O as ce,P as mi,w as jn,Q as ft,R as we,T as fn,t as X,U as he,j as Oe,r as We,V as qn,W as at,X as Ce,Y as Xr,Z as Xt,_ as kt,$ as Vn,a0 as Be,a1 as Zn,a2 as Qn,a3 as gi,a4 as _i,a5 as Ne,a6 as vi,a7 as yi,a8 as bi,a9 as cn,aa as At,ab as pn,ac as Yt,ad as hn,ae as En,af as wi,ag as Mt,ah as zn,ai as st,aj as xt,ak as ki,al as Yn,am as Si,an as Ei,ao as Mi,ap as er,aq as tn,ar as xi,as as Li,at as Ri,A as Ai,u as Ci}from"./authorities-28a0919a.js";function Oi(r){let e,t,n,i,o,s,u,l,a,h,v,c,f;return{c(){e=w("p"),e.textContent="For each intervention:",t=L(),n=w("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=L(),o=w("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=L(),u=w("p"),u.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=L(),a=w("p"),a.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,h=L(),v=w("p"),v.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=L(),f=w("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(d,_){y(d,e,_),y(d,t,_),y(d,n,_),y(d,i,_),y(d,o,_),y(d,s,_),y(d,u,_),y(d,l,_),y(d,a,_),y(d,h,_),y(d,v,_),y(d,c,_),y(d,f,_)},p:V,d(d){d&&b(e),d&&b(t),d&&b(n),d&&b(i),d&&b(o),d&&b(s),d&&b(u),d&&b(l),d&&b(a),d&&b(h),d&&b(v),d&&b(c),d&&b(f)}}}function Pi(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Oi]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new ci({props:o}),ye.push(()=>it(e,"open",i,r[0])),{c(){Q(e.$$.fragment)},m(s,u){ee(e,s,u),n=!0},p(s,[u]){const l={};u&4&&(l.$$scope={dirty:u,ctx:s}),!t&&u&1&&(t=!0,l.open=s[0],ot(()=>t=!1)),e.$set(l)},i(s){n||(B(e.$$.fragment,s),n=!0)},o(s){j(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function Ti(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Fi extends se{constructor(e){super(),le(this,e,Ti,Pi,oe,{open:0})}}const _t=[];function Ct(r,e=V){let t;const n=new Set;function i(u){if(oe(r,u)&&(r=u,t)){const l=!_t.length;for(const a of n)a[1](),_t.push(a,r);if(l){for(let a=0;a<_t.length;a+=2)_t[a][0](_t[a+1]);_t.length=0}}}function o(u){i(u(r))}function s(u,l=V){const a=[u,l];return n.add(a),n.size===1&&(t=e(i)||V),u(r),()=>{n.delete(a),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const $e=Ct(null),fe=Ct(qe()),Ae=Ct(null),Je=Ct(null),nn=Ct(null),Mn=Ct(null);function dn(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function $n(r){fe.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Ae.set(null),Je.set(null),nn.set(null)}function tr(r){let e;const t=r[4].default,n=Nt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&It(n,t,i,i[3],e?Dt(t,i[3],o,null):Bt(i[3]),null)},i(i){e||(B(n,i),e=!0)},o(i){j(n,i),e=!1},d(i){n&&n.d(i)}}}function Ni(r){let e,t,n=r[1]&&tr(r);return{c(){e=w("div"),n&&n.c(),O(e,"class","map svelte-12dpf1u")},m(i,o){y(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&B(n,1)):(n=tr(i),n.c(),B(n,1),n.m(e,null)):n&&(ze(),j(n,1,1,()=>{n=null}),Ye())},i(i){t||(B(n),t=!0)},o(i){j(n),t=!1},d(i){i&&b(e),n&&n.d(),r[5](null)}}}function Ii(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,u,l=!1;pi("setCamera",!window.location.hash),Gn(()=>{s=new vn.Map({container:u,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new vn.ScaleControl({})),s.addControl(new vn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),$e.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(u)}),Rt(()=>{s.remove()});function a(h){ye[h?"unshift":"push"](()=>{u=h,t(0,u)})}return r.$$set=h=>{"style"in h&&t(2,o=h.style),"$$scope"in h&&t(3,i=h.$$scope)},[u,l,o,i,n,a]}class Bi extends se{constructor(e){super(),le(this,e,Ii,Ni,oe,{style:2})}}const Di=r=>({}),nr=r=>({}),Gi=r=>({}),rr=r=>({}),ji=r=>({}),ir=r=>({});function qi(r){let e,t,n,i,o,s,u,l,a,h,v,c;const f=r[3].nav,d=Nt(f,r,r[2],ir),_=r[3].sidebar,g=Nt(_,r,r[2],rr),E=r[3].main,p=Nt(E,r,r[2],nr);return{c(){e=w("aside"),t=w("div"),n=w("nav"),d&&d.c(),i=L(),g&&g.c(),o=L(),s=w("button"),s.textContent="â†’",l=L(),a=w("main"),p&&p.c(),O(n,"class","svelte-1u7vg8a"),O(t,"class","sidebar-content content-container svelte-1u7vg8a"),O(s,"type","button"),O(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),O(e,"class",u=Kn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),O(a,"class","svelte-1u7vg8a")},m(m,k){y(m,e,k),S(e,t),S(t,n),d&&d.m(n,null),S(t,i),g&&g.m(t,null),S(e,o),S(e,s),y(m,l,k),y(m,a,k),p&&p.m(a,null),h=!0,v||(c=z(s,"click",r[1]),v=!0)},p(m,[k]){d&&d.p&&(!h||k&4)&&It(d,f,m,m[2],h?Dt(f,m[2],k,ji):Bt(m[2]),ir),g&&g.p&&(!h||k&4)&&It(g,_,m,m[2],h?Dt(_,m[2],k,Gi):Bt(m[2]),rr),(!h||k&1&&u!==(u=Kn(m[0]?"":"collapsed")+" svelte-1u7vg8a"))&&O(e,"class",u),p&&p.p&&(!h||k&4)&&It(p,E,m,m[2],h?Dt(E,m[2],k,Di):Bt(m[2]),nr)},i(m){h||(B(d,m),B(g,m),B(p,m),h=!0)},o(m){j(d,m),j(g,m),j(p,m),h=!1},d(m){m&&b(e),d&&d.d(m),g&&g.d(m),m&&b(l),m&&b(a),p&&p.d(m),v=!1,c()}}}function zi(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=u=>{"$$scope"in u&&t(2,i=u.$$scope)},[o,s,i,n]}class Yi extends se{constructor(e){super(),le(this,e,zi,qi,oe,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function $i(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(h){return l([a,h])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(h){a=[6,h],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var ut=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Hi(r,e){return r>e?1:r<e?-1:0}function et(r,e,t){for(var n=new ut(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function yn(r,e,t,n){var i=new ut(r,e);if(t===null)return i.left=i.right=null,i;t=et(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function or(r,e,t){var n=null,i=null;if(e){e=et(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Xi(r,e,t){return e===null?r:(r===null||(e=et(r.key,e,t),e.left=r),e)}function xn(r,e,t,n,i){if(r){n(""+e+(t?"â””â”€â”€ ":"â”œâ”€â”€ ")+i(r)+`
`);var o=e+(t?"    ":"â”‚   ");r.left&&xn(r.left,o,!1,n,i),r.right&&xn(r.right,o,!0,n,i)}}var Hn=function(){function r(e){e===void 0&&(e=Hi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=yn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new ut(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=et(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=et(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=et(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=et(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=et(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,u=this._root,l;o.length!==0||u;)if(u)o.push(u),u=u.left;else{if(u=o.pop(),l=s(u.key,t),l>0)break;if(s(u.key,e)>=0&&n.call(i,u))return this;u=u.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Ji(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&An(e,t,0,i-1,o),this._root===null)this._root=Ln(e,t,0,i),this._size=i;else{var s=Wi(this.toList(),Ui(e,t),o);i=this._size+i,this._root=Rn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return xn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=or(e,this._root,i),s=o.left,u=o.right;i(e,t)<0?u=yn(t,n,u,i):s=yn(t,n,s,i),this._root=Xi(s,u,i)},r.prototype.split=function(e){return or(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return $i(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Ln(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],u=e[o],l=new ut(s,u);return l.left=Ln(r,e,t,o),l.right=Ln(r,e,o+1,n),l}return null}function Ui(r,e){for(var t=new ut(null,null),n=t,i=0;i<r.length;i++)n=n.next=new ut(r[i],e[i]);return n.next=null,t.next}function Ji(r){for(var e=r,t=[],n=!1,i=new ut(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Rn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Rn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Rn(r,i+1,t),s}return null}function Wi(r,e,t){for(var n=new ut(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function An(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,u=n+1;;){do s++;while(i(r[s],o)<0);do u--;while(i(r[u],o)>0);if(s>=u)break;var l=r[s];r[s]=r[u],r[u]=l,l=e[s],e[s]=e[u],e[u]=l}An(r,e,t,u,i),An(r,e,u+1,n,i)}}function Pe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function sr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Ee(r,e,t){return e&&sr(r.prototype,e),t&&sr(r,t),r}var Tt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Cn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},nt=Number.EPSILON;nt===void 0&&(nt=Math.pow(2,-52));var Ki=nt*nt,On=function(e,t){if(-nt<e&&e<nt&&-nt<t&&t<nt)return 0;var n=e-t;return n*n<Ki*e*t?0:e<t?-1:1},Vi=function(){function r(){Pe(this,r),this.reset()}return Ee(r,[{key:"reset",value:function(){this.xRounder=new lr,this.yRounder=new lr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),lr=function(){function r(){Pe(this,r),this.tree=new Hn,this.round(0)}return Ee(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&On(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&On(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),$t=new Vi,Gt=function(e,t){return e.x*t.y-e.y*t.x},Ur=function(e,t){return e.x*t.x+e.y*t.y},ur=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Gt(i,o);return On(s,0)},rn=function(e){return Math.sqrt(Ur(e,e))},Zi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Gt(o,i)/rn(o)/rn(i)},Qi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Ur(o,i)/rn(o)/rn(i)},ar=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},fr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},eo=function(e,t,n,i){if(t.x===0)return fr(n,i,e.x);if(i.x===0)return fr(e,t,n.x);if(t.y===0)return ar(n,i,e.y);if(i.y===0)return ar(e,t,n.y);var o=Gt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},u=Gt(s,t)/o,l=Gt(s,i)/o,a=e.x+l*t.x,h=n.x+u*i.x,v=e.y+l*t.y,c=n.y+u*i.y,f=(a+h)/2,d=(v+c)/2;return{x:f,y:d}},Ge=function(){Ee(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:on.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Pe(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Ee(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(u){var l=u.otherSE;i.set(u,{sine:Zi(n.point,t.point,l.point),cosine:Qi(n.point,t.point,l.point)})};return function(s,u){i.has(s)||o(s),i.has(u)||o(u);var l=i.get(s),a=l.sine,h=l.cosine,v=i.get(u),c=v.sine,f=v.cosine;return a>=0&&c>=0?h<f?1:h>f?-1:0:a<0&&c<0?h<f?-1:h>f?1:0:c<a?-1:c>a?1:0}}}]),r}(),to=0,on=function(){Ee(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,u=n.rightSE.point.x;if(u<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,a=n.leftSE.point.y,h=t.rightSE.point.y,v=n.rightSE.point.y;if(i<o){if(a<l&&a<h)return 1;if(a>l&&a>h)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<a&&l<v)return-1;if(l>a&&l>v)return 1;var d=n.comparePoint(t.leftSE.point);if(d!==0)return d;var _=t.comparePoint(n.rightSE.point);return _<0?1:_>0?-1:1}if(l<a)return-1;if(l>a)return 1;if(s<u){var g=n.comparePoint(t.rightSE.point);if(g!==0)return g}if(s>u){var E=t.comparePoint(n.rightSE.point);if(E<0)return 1;if(E>0)return-1}if(s!==u){var p=h-l,m=s-i,k=v-a,R=u-o;if(p>m&&k<R)return 1;if(p<m&&k>R)return-1}return s>u?1:s<u||h<v?-1:h>v?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Pe(this,r),this.id=++to,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Ee(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,u=n.x+s*o.x;if(t.x===u)return 0;var l=(t.x-n.x)/o.x,a=n.y+l*o.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Cn(n,i);if(o===null)return null;var s=this.leftSE.point,u=this.rightSE.point,l=t.leftSE.point,a=t.rightSE.point,h=Tt(n,l)&&this.comparePoint(l)===0,v=Tt(i,s)&&t.comparePoint(s)===0,c=Tt(n,a)&&this.comparePoint(a)===0,f=Tt(i,u)&&t.comparePoint(u)===0;if(v&&h)return f&&!c?u:!f&&c?a:null;if(v)return c&&s.x===a.x&&s.y===a.y?null:s;if(h)return f&&u.x===l.x&&u.y===l.y?null:l;if(f&&c)return null;if(f)return u;if(c)return a;var d=eo(s,this.vector(),l,t.vector());return d===null||!Tt(o,d)?null:$t.round(d.x,d.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Ge(t,!0),s=new Ge(t,!1),u=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,u,this.rings.slice(),this.windings.slice());return Ge.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ge.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var u=n;n=i,i=u}for(var l=0,a=i.rings.length;l<a;l++){var h=i.rings[l],v=i.windings[l],c=n.rings.indexOf(h);c===-1?(n.rings.push(h),n.windings.push(v)):n.windings[c]+=v}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,u=this.rings.length;s<u;s++){var l=this.rings[s],a=this.windings[s],h=n.indexOf(l);h===-1?(n.push(l),i.push(a)):i[h]+=a}for(var v=[],c=[],f=0,d=n.length;f<d;f++)if(i[f]!==0){var _=n[f],g=_.poly;if(c.indexOf(g)===-1)if(_.isExterior)v.push(g);else{c.indexOf(g)===-1&&c.push(g);var E=v.indexOf(_.poly);E!==-1&&v.splice(E,1)}}for(var p=0,m=v.length;p<m;p++){var k=v[p].multiPoly;o.indexOf(k)===-1&&o.push(k)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ie.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,u;t.length<n.length?(s=t.length,u=n.length):(s=n.length,u=t.length),this._isInResult=u===Ie.numMultiPolys&&s<u;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var a=function(v){return v.length===1&&v[0].isSubject};this._isInResult=a(t)!==a(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ie.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,u,l=Ge.comparePoints(t,n);if(l<0)o=t,s=n,u=1;else if(l>0)o=n,s=t,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var a=new Ge(o,!0),h=new Ge(s,!1);return new r(a,h,[i],[u])}}]),r}(),cr=function(){function r(e,t,n){if(Pe(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=$t.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,u=e.length;s<u;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=$t.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(on.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(on.fromRing(o,i,this))}return Ee(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),no=function(){function r(e,t){if(Pe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new cr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new cr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Ee(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),pr=function(){function r(e,t){if(Pe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new no(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Ee(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),ro=function(){Ee(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var u=null,l=s.leftSE,a=s.rightSE,h=[l],v=l.point,c=[];u=l,l=a,h.push(l),l.point!==v;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var d=h[0].point,_=h[h.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(_.x,", ").concat(_.y,"]."))}if(f.length===1){a=f[0].otherSE;break}for(var g=null,E=0,p=c.length;E<p;E++)if(c[E].point===l.point){g=E;break}if(g!==null){var m=c.splice(g)[0],k=h.splice(m.index);k.unshift(k[0].otherSE),n.push(new r(k.reverse()));continue}c.push({index:h.length,point:l.point});var R=l.getLeftmostComparator(u);a=f.sort(R)[0].otherSE;break}n.push(new r(h))}}return n}}]);function r(e){Pe(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Ee(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,u=this.events[i+1].point;ur(s,t,u)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],a=n[1];ur(l,t,a)===0&&n.shift(),n.push(n[0]);for(var h=this.isExteriorRing()?1:-1,v=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],d=v;d!=c;d+=h)f.push([n[d].x,n[d].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Ge.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),u=s?s.prevInResult():null;;){if(!s)return null;if(!u)return s.ringOut;if(u.ringOut!==s.ringOut)return u.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=u.prevInResult(),u=s?s.prevInResult():null}}}]),r}(),hr=function(){function r(e){Pe(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Ee(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),io=function(){function r(e){Pe(this,r),this.rings=e,this.polys=this._composePolys(e)}return Ee(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new hr(s));else{var u=s.enclosingRing();u.poly||n.push(new hr(u)),u.poly.addInterior(s)}}return n}}]),r}(),oo=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:on.compare;Pe(this,r),this.queue=e,this.tree=new Hn(t),this.segments=[]}return Ee(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,u=o,l=void 0,a=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;a===void 0;)u=this.tree.next(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);if(t.isLeft){var h=null;if(l){var v=l.getIntersection(n);if(v!==null&&(n.isAnEndpoint(v)||(h=v),!l.isAnEndpoint(v)))for(var c=this._splitSafely(l,v),f=0,d=c.length;f<d;f++)i.push(c[f])}var _=null;if(a){var g=a.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(_=g),!a.isAnEndpoint(g)))for(var E=this._splitSafely(a,g),p=0,m=E.length;p<m;p++)i.push(E[p])}if(h!==null||_!==null){var k=null;if(h===null)k=_;else if(_===null)k=h;else{var R=Ge.comparePoints(h,_);k=R<=0?h:_}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var C=n.split(k),A=0,x=C.length;A<x;A++)i.push(C[A])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&a){var I=l.getIntersection(a);if(I!==null){if(!l.isAnEndpoint(I))for(var D=this._splitSafely(l,I),G=0,$=D.length;G<$;G++)i.push(D[G]);if(!a.isAnEndpoint(I))for(var F=this._splitSafely(a,I),P=0,K=F.length;P<K;P++)i.push(F[P])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),dr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,so=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,lo=function(){function r(){Pe(this,r)}return Ee(r,[{key:"run",value:function(t,n,i){Ie.type=t,$t.reset();for(var o=[new pr(n,!0)],s=0,u=i.length;s<u;s++)o.push(new pr(i[s],!1));if(Ie.numMultiPolys=o.length,Ie.type==="difference")for(var l=o[0],a=1;a<o.length;)Cn(o[a].bbox,l.bbox)!==null?a++:o.splice(a,1);if(Ie.type==="intersection"){for(var h=0,v=o.length;h<v;h++)for(var c=o[h],f=h+1,d=o.length;f<d;f++)if(Cn(c.bbox,o[f].bbox)===null)return[]}for(var _=new Hn(Ge.compare),g=0,E=o.length;g<E;g++)for(var p=o[g].getSweepEvents(),m=0,k=p.length;m<k;m++)if(_.insert(p[m]),_.size>dr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var R=new oo(_),C=_.size,A=_.pop();A;){var x=A.key;if(_.size===C){var I=x.segment;throw new Error("Unable to pop() ".concat(x.isLeft?"left":"right"," SweepEvent ")+"[".concat(x.point.x,", ").concat(x.point.y,"] from segment #").concat(I.id," ")+"[".concat(I.leftSE.point.x,", ").concat(I.leftSE.point.y,"] -> ")+"[".concat(I.rightSE.point.x,", ").concat(I.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(_.size>dr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(R.segments.length>so)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var D=R.process(x),G=0,$=D.length;G<$;G++){var F=D[G];F.consumedBy===void 0&&_.insert(F)}C=_.size,A=_.pop()}$t.reset();var P=ro.factory(R.segments),K=new io(P);return K.getGeom()}}]),r}(),Ie=new lo,uo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ie.run("union",e,n)},ao=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ie.run("intersection",e,n)},fo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ie.run("xor",e,n)},co=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ie.run("difference",e,n)},Wt={union:uo,intersection:ao,xor:fo,difference:co};function po(r,e){var t=mo(e),n=null;return r.type==="FeatureCollection"?n=ho(r):n=Jr(Wt.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function ho(r){var e=r.features.length===2?Wt.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Wt.union.apply(Wt,r.features.map(function(t){return t.geometry.coordinates}));return Jr(e)}function Jr(r){return hi(r)}function mo(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return di(t)}function go(r,e,t){let n;ce(r,$e,s=>t(1,n=s));let{boundaryGeojson:i}=e;return mi("setCamera")&&n.fitBounds(jn(i),{padding:20,animate:!1}),ft(n,"boundary",{type:"geojson",data:po(i)}),we(n,{id:"boundary",source:"boundary",...fn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class _o extends se{constructor(e){super(),le(this,e,go,null,oe,{boundaryGeojson:0})}}function mr(r){let e,t=gr(r[4])+"",n,i,o,s,u;return{c(){e=X("Length: "),n=X(t),i=L(),o=w("br"),s=L(),u=w("br")},m(l,a){y(l,e,a),y(l,n,a),y(l,i,a),y(l,o,a),y(l,s,a),y(l,u,a)},p(l,a){a&16&&t!==(t=gr(l[4])+"")&&qn(n,t)},d(l){l&&b(e),l&&b(n),l&&b(i),l&&b(o),l&&b(s),l&&b(u)}}}function vo(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_,g,E,p,m,k,R,C,A,x,I,D,G,$,F,P,K,ve,ne,de,me,ke,Se,W,ue,Ke,be,re,Te,He,ae,Xe,Y,Z=r[4]&&mr(r);return{c(){e=w("label"),t=X("Name:"),n=w("br"),i=L(),o=w("input"),s=L(),u=w("br"),l=L(),a=w("br"),h=L(),v=w("label"),c=w("input"),f=X(`
  Area`),d=L(),_=w("label"),g=w("input"),E=X(`
  Route`),p=L(),m=w("label"),k=w("input"),R=X(`
  Crossing`),C=L(),A=w("label"),x=w("input"),I=X(`
  Other`),D=L(),G=w("br"),$=L(),F=w("br"),P=L(),K=w("label"),ve=X("Description:"),ne=w("br"),de=L(),me=w("textarea"),ke=L(),Se=w("br"),W=L(),ue=w("br"),Ke=L(),Z&&Z.c(),be=L(),re=w("div"),Te=w("button"),Te.textContent="Delete",He=L(),ae=w("button"),ae.textContent="Save",O(o,"type","text"),he(o,"width","100%"),O(c,"type","radio"),c.__value="area",c.value=c.__value,r[7][0].push(c),O(g,"type","radio"),g.__value="route",g.value=g.__value,r[7][0].push(g),O(k,"type","radio"),k.__value="crossing",k.value=k.__value,r[7][0].push(k),O(x,"type","radio"),x.__value="other",x.value=x.__value,r[7][0].push(x),he(me,"width","100%"),O(me,"rows","5"),O(me,"class","svelte-15lna0i"),O(Te,"type","button"),O(ae,"type","button"),he(re,"display","flex"),he(re,"justify-content","space-between")},m(T,H){y(T,e,H),S(e,t),S(e,n),S(e,i),S(e,o),Oe(o,r[0]),y(T,s,H),y(T,u,H),y(T,l,H),y(T,a,H),y(T,h,H),y(T,v,H),S(v,c),c.checked=c.__value===r[1],S(v,f),y(T,d,H),y(T,_,H),S(_,g),g.checked=g.__value===r[1],S(_,E),y(T,p,H),y(T,m,H),S(m,k),k.checked=k.__value===r[1],S(m,R),y(T,C,H),y(T,A,H),S(A,x),x.checked=x.__value===r[1],S(A,I),y(T,D,H),y(T,G,H),y(T,$,H),y(T,F,H),y(T,P,H),y(T,K,H),S(K,ve),S(K,ne),S(K,de),S(K,me),Oe(me,r[2]),y(T,ke,H),y(T,Se,H),y(T,W,H),y(T,ue,H),y(T,Ke,H),Z&&Z.m(T,H),y(T,be,H),y(T,re,H),S(re,Te),S(re,He),S(re,ae),Xe||(Y=[z(o,"input",r[5]),z(c,"change",r[6]),z(g,"change",r[8]),z(k,"change",r[9]),z(x,"change",r[10]),z(me,"input",r[11]),z(Te,"click",r[12]),z(ae,"click",r[13])],Xe=!0)},p(T,[H]){H&1&&o.value!==T[0]&&Oe(o,T[0]),H&2&&(c.checked=c.__value===T[1]),H&2&&(g.checked=g.__value===T[1]),H&2&&(k.checked=k.__value===T[1]),H&2&&(x.checked=x.__value===T[1]),H&4&&Oe(me,T[2]),T[4]?Z?Z.p(T,H):(Z=mr(T),Z.c(),Z.m(be.parentNode,be)):Z&&(Z.d(1),Z=null)},i:V,o:V,d(T){T&&b(e),T&&b(s),T&&b(u),T&&b(l),T&&b(a),T&&b(h),T&&b(v),r[7][0].splice(r[7][0].indexOf(c),1),T&&b(d),T&&b(_),r[7][0].splice(r[7][0].indexOf(g),1),T&&b(p),T&&b(m),r[7][0].splice(r[7][0].indexOf(k),1),T&&b(C),T&&b(A),r[7][0].splice(r[7][0].indexOf(x),1),T&&b(D),T&&b(G),T&&b($),T&&b(F),T&&b(P),T&&b(K),T&&b(ke),T&&b(Se),T&&b(W),T&&b(ue),T&&b(Ke),Z&&Z.d(T),T&&b(be),T&&b(re),Xe=!1,We(Y)}}}function gr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function yo(r,e,t){let{id:n}=e,{name:i}=e,{intervention_type:o}=e,{description:s}=e,{length_meters:u}=e;const l=[[]];function a(){i=this.value,t(0,i)}function h(){o=this.__value,t(1,o)}function v(){o=this.__value,t(1,o)}function c(){o=this.__value,t(1,o)}function f(){o=this.__value,t(1,o)}function d(){s=this.value,t(2,s)}const _=()=>$n(n),g=()=>Ae.set(null);return r.$$set=E=>{"id"in E&&t(3,n=E.id),"name"in E&&t(0,i=E.name),"intervention_type"in E&&t(1,o=E.intervention_type),"description"in E&&t(2,s=E.description),"length_meters"in E&&t(4,u=E.length_meters)},[i,o,s,n,u,a,h,l,v,c,f,d,_,g]}class bo extends se{constructor(e){super(),le(this,e,yo,vo,oe,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}function _r(r,e,t){const n=r.slice();return n[15]=e[t],n}function vr(r,e,t){const n=r.slice();return n[15]=e[t],n}function yr(r,e,t){const n=r.slice();return n[15]=e[t],n}function br(r,e,t){const n=r.slice();return n[15]=e[t],n}function wr(r){let e,t=r[15]+"",n;return{c(){e=w("option"),n=X(t),e.__value=r[15],e.value=e.__value},m(i,o){y(i,e,o),S(e,n)},p:V,d(i){i&&b(e)}}}function kr(r){let e,t=r[15]+"",n;return{c(){e=w("option"),n=X(t),e.__value=r[15],e.value=e.__value},m(i,o){y(i,e,o),S(e,n)},p:V,d(i){i&&b(e)}}}function Sr(r){let e,t=r[15]+"",n;return{c(){e=w("option"),n=X(t),e.__value=r[15],e.value=e.__value},m(i,o){y(i,e,o),S(e,n)},p:V,d(i){i&&b(e)}}}function Er(r){let e,t=r[15]+"",n;return{c(){e=w("option"),n=X(t),e.__value=r[15],e.value=e.__value},m(i,o){y(i,e,o),S(e,n)},p:V,d(i){i&&b(e)}}}function wo(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_,g,E,p,m,k,R,C,A,x,I,D,G,$,F,P,K,ve,ne,de,me,ke,Se,W,ue,Ke,be,re,Te,He,ae,Xe,Y,Z,T,H,ct,Ve,pt,gn,Ze,Ot,Jn,Pt,_n,Wn,ht=r[2],Me=[];for(let M=0;M<ht.length;M+=1)Me[M]=wr(br(r,ht,M));let dt=r[3],xe=[];for(let M=0;M<dt.length;M+=1)xe[M]=kr(yr(r,dt,M));let mt=r[4],Le=[];for(let M=0;M<mt.length;M+=1)Le[M]=Sr(vr(r,mt,M));let gt=r[5],Re=[];for(let M=0;M<gt.length;M+=1)Re[M]=Er(_r(r,gt,M));return{c(){e=w("label"),t=X("Name:"),n=w("br"),i=L(),o=w("input"),s=L(),u=w("br"),l=L(),a=w("br"),h=L(),v=w("label"),c=X(`Reference type:
  `),f=w("select");for(let M=0;M<Me.length;M+=1)Me[M].c();d=L(),_=w("br"),g=L(),E=w("br"),p=L(),m=w("label"),k=X("Notes:"),R=w("br"),C=L(),A=w("textarea"),x=L(),I=w("br"),D=L(),G=w("br"),$=L(),F=w("label"),P=X(`Size:
  `),K=w("input"),ve=L(),ne=w("select");for(let M=0;M<xe.length;M+=1)xe[M].c();de=L(),me=w("br"),ke=L(),Se=w("br"),W=L(),ue=w("label"),Ke=X(`ATE Triage:
  `),be=w("select");for(let M=0;M<Le.length;M+=1)Le[M].c();re=L(),Te=w("br"),He=L(),ae=w("br"),Xe=L(),Y=w("label"),Z=X(`ATE Recommendation:
  `),T=w("select");for(let M=0;M<Re.length;M+=1)Re[M].c();H=L(),ct=w("br"),Ve=L(),pt=w("br"),gn=L(),Ze=w("div"),Ot=w("button"),Ot.textContent="Delete",Jn=L(),Pt=w("button"),Pt.textContent="Save",O(o,"type","text"),he(o,"width","100%"),r[0].planning.reference_type===void 0&&at(()=>r[7].call(f)),he(A,"width","100%"),O(A,"rows","5"),O(A,"class","svelte-15lna0i"),O(K,"type","number"),O(K,"min","0"),O(K,"max","1000"),r[0].planning.size_units===void 0&&at(()=>r[10].call(ne)),r[0].planning.triage===void 0&&at(()=>r[11].call(be)),r[0].planning.recommendation===void 0&&at(()=>r[12].call(T)),O(Ot,"type","button"),O(Pt,"type","button"),he(Ze,"display","flex"),he(Ze,"justify-content","space-between")},m(M,q){y(M,e,q),S(e,t),S(e,n),S(e,i),S(e,o),Oe(o,r[0].planning.name),y(M,s,q),y(M,u,q),y(M,l,q),y(M,a,q),y(M,h,q),y(M,v,q),S(v,c),S(v,f);for(let N=0;N<Me.length;N+=1)Me[N].m(f,null);Ce(f,r[0].planning.reference_type),y(M,d,q),y(M,_,q),y(M,g,q),y(M,E,q),y(M,p,q),y(M,m,q),S(m,k),S(m,R),S(m,C),S(m,A),Oe(A,r[0].planning.notes),y(M,x,q),y(M,I,q),y(M,D,q),y(M,G,q),y(M,$,q),y(M,F,q),S(F,P),S(F,K),Oe(K,r[0].planning.size),S(F,ve),S(F,ne);for(let N=0;N<xe.length;N+=1)xe[N].m(ne,null);Ce(ne,r[0].planning.size_units),y(M,de,q),y(M,me,q),y(M,ke,q),y(M,Se,q),y(M,W,q),y(M,ue,q),S(ue,Ke),S(ue,be);for(let N=0;N<Le.length;N+=1)Le[N].m(be,null);Ce(be,r[0].planning.triage),y(M,re,q),y(M,Te,q),y(M,He,q),y(M,ae,q),y(M,Xe,q),y(M,Y,q),S(Y,Z),S(Y,T);for(let N=0;N<Re.length;N+=1)Re[N].m(T,null);Ce(T,r[0].planning.recommendation),y(M,H,q),y(M,ct,q),y(M,Ve,q),y(M,pt,q),y(M,gn,q),y(M,Ze,q),S(Ze,Ot),S(Ze,Jn),S(Ze,Pt),_n||(Wn=[z(o,"input",r[6]),z(f,"change",r[7]),z(A,"input",r[8]),z(K,"input",r[9]),z(ne,"change",r[10]),z(be,"change",r[11]),z(T,"change",r[12]),z(Ot,"click",r[13]),z(Pt,"click",r[14])],_n=!0)},p(M,[q]){if(q&5&&o.value!==M[0].planning.name&&Oe(o,M[0].planning.name),q&4){ht=M[2];let N;for(N=0;N<ht.length;N+=1){const Fe=br(M,ht,N);Me[N]?Me[N].p(Fe,q):(Me[N]=wr(Fe),Me[N].c(),Me[N].m(f,null))}for(;N<Me.length;N+=1)Me[N].d(1);Me.length=ht.length}if(q&5&&Ce(f,M[0].planning.reference_type),q&5&&Oe(A,M[0].planning.notes),q&5&&Xr(K.value)!==M[0].planning.size&&Oe(K,M[0].planning.size),q&8){dt=M[3];let N;for(N=0;N<dt.length;N+=1){const Fe=yr(M,dt,N);xe[N]?xe[N].p(Fe,q):(xe[N]=kr(Fe),xe[N].c(),xe[N].m(ne,null))}for(;N<xe.length;N+=1)xe[N].d(1);xe.length=dt.length}if(q&5&&Ce(ne,M[0].planning.size_units),q&16){mt=M[4];let N;for(N=0;N<mt.length;N+=1){const Fe=vr(M,mt,N);Le[N]?Le[N].p(Fe,q):(Le[N]=Sr(Fe),Le[N].c(),Le[N].m(be,null))}for(;N<Le.length;N+=1)Le[N].d(1);Le.length=mt.length}if(q&5&&Ce(be,M[0].planning.triage),q&32){gt=M[5];let N;for(N=0;N<gt.length;N+=1){const Fe=_r(M,gt,N);Re[N]?Re[N].p(Fe,q):(Re[N]=Er(Fe),Re[N].c(),Re[N].m(T,null))}for(;N<Re.length;N+=1)Re[N].d(1);Re.length=gt.length}q&5&&Ce(T,M[0].planning.recommendation)},i:V,o:V,d(M){M&&b(e),M&&b(s),M&&b(u),M&&b(l),M&&b(a),M&&b(h),M&&b(v),Xt(Me,M),M&&b(d),M&&b(_),M&&b(g),M&&b(E),M&&b(p),M&&b(m),M&&b(x),M&&b(I),M&&b(D),M&&b(G),M&&b($),M&&b(F),Xt(xe,M),M&&b(de),M&&b(me),M&&b(ke),M&&b(Se),M&&b(W),M&&b(ue),Xt(Le,M),M&&b(re),M&&b(Te),M&&b(He),M&&b(ae),M&&b(Xe),M&&b(Y),Xt(Re,M),M&&b(H),M&&b(ct),M&&b(Ve),M&&b(pt),M&&b(gn),M&&b(Ze),_n=!1,We(Wn)}}}function ko(r,e,t){let{id:n}=e,{props:i}=e;i.planning||(i.planning={name:"",notes:"",reference_type:"preapp",size:0,size_units:"number of units",triage:"No Comment",recommendation:"No Comment"});const o=["preapp","outline","reserved matters","local plan"],s=["number of units","floorspace (Gross Floor Area)","area (Hectare)"],u=["No Comment","Standing Advice","Toolkit Assessment"],l=["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"];function a(){i.planning.name=this.value,t(0,i),t(2,o)}function h(){i.planning.reference_type=kt(this),t(0,i),t(2,o)}function v(){i.planning.notes=this.value,t(0,i),t(2,o)}function c(){i.planning.size=Xr(this.value),t(0,i),t(2,o)}function f(){i.planning.size_units=kt(this),t(0,i),t(2,o)}function d(){i.planning.triage=kt(this),t(0,i),t(2,o)}function _(){i.planning.recommendation=kt(this),t(0,i),t(2,o)}const g=()=>$n(n),E=()=>Ae.set(null);return r.$$set=p=>{"id"in p&&t(1,n=p.id),"props"in p&&t(0,i=p.props)},[i,n,o,s,u,l,a,h,v,c,f,d,_,g,E]}class So extends se{constructor(e){super(),le(this,e,ko,wo,oe,{id:1,props:0})}}function Eo(r){const e=r-1;return e*e*e+1}function Mr(r,{delay:e=0,duration:t=400,easing:n=Eo}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),u=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),a=parseFloat(i.marginTop),h=parseFloat(i.marginBottom),v=parseFloat(i.borderTopWidth),c=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*u}px;padding-bottom: ${f*l}px;margin-top: ${f*a}px;margin-bottom: ${f*h}px;border-top-width: ${f*v}px;border-bottom-width: ${f*c}px;`}}function xr(r){let e,t,n,i,o;const s=r[10].default,u=Nt(s,r,r[9],null);return{c(){e=w("div"),u&&u.c(),he(e,"border","solid 1px black"),he(e,"padding","10px")},m(l,a){y(l,e,a),u&&u.m(e,null),r[13](e),n=!0,i||(o=z(e,"introend",r[14]),i=!0)},p(l,a){u&&u.p&&(!n||a&512)&&It(u,s,l,l[9],n?Dt(s,l[9],a,null):Bt(l[9]),null)},i(l){n||(B(u,l),at(()=>{t||(t=Qn(e,Mr,{duration:100},!0)),t.run(1)}),n=!0)},o(l){j(u,l),t||(t=Qn(e,Mr,{duration:100},!1)),t.run(0),n=!1},d(l){l&&b(e),u&&u.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Mo(r){let e,t,n,i,o,s,u,l,a,h,v=r[4]&&xr(r);return{c(){e=w("button"),t=Vn("svg"),n=Vn("path"),i=L(),o=X(r[1]),s=L(),v&&v.c(),u=Be(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-t7fpgu"),O(e,"aria-expanded",r[4]),O(e,"class","svelte-t7fpgu"),Zn(e,"underlined",r[3])},m(c,f){y(c,e,f),S(e,t),S(t,n),S(e,i),S(e,o),y(c,s,f),v&&v.m(c,f),y(c,u,f),l=!0,a||(h=[z(e,"click",r[5]),z(e,"mouseenter",r[11]),z(e,"mouseleave",r[12])],a=!0)},p(c,[f]){(!l||f&2)&&qn(o,c[1]),(!l||f&16)&&O(e,"aria-expanded",c[4]),(!l||f&8)&&Zn(e,"underlined",c[3]),c[4]?v?(v.p(c,f),f&16&&B(v,1)):(v=xr(c),v.c(),B(v,1),v.m(u.parentNode,u)):v&&(ze(),j(v,1,1,()=>{v=null}),Ye())},i(c){l||(B(v),l=!0)},o(c){j(v),l=!1},d(c){c&&b(e),c&&b(s),v&&v.d(c),c&&b(u),a=!1,We(h)}}}function xo(r,e,t){let n,i,o,s;ce(r,Je,p=>t(7,o=p)),ce(r,Ae,p=>t(8,s=p));let{$$slots:u={},$$scope:l}=e,{id:a}=e,{label:h}=e;const v=()=>{Ae.update(p=>p==a?null:a),s==a&&(Mn.set(null),Mn.set(a))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const d=()=>nn.set(a),_=()=>nn.set(null);function g(p){ye[p?"unshift":"push"](()=>{c=p,t(2,c)})}const E=()=>f();return r.$$set=p=>{"id"in p&&t(0,a=p.id),"label"in p&&t(1,h=p.label),"$$scope"in p&&t(9,l=p.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==a),r.$$.dirty&129&&t(3,i=o==a)},[a,h,c,i,n,v,f,o,s,l,u,d,_,g,E]}class Lo extends se{constructor(e){super(),le(this,e,xo,Mo,oe,{id:0,label:1})}}function Lr(r,e,t){const n=r.slice();return n[9]=e[t],n[10]=e,n[11]=t,n}function Ro(r){let e,t,n,i,o;function s(h){r[5](h,r[9])}function u(h){r[6](h,r[9])}function l(h){r[7](h,r[9])}let a={id:r[9].id,length_meters:r[9].properties.length_meters};return r[9].properties.name!==void 0&&(a.name=r[9].properties.name),r[9].properties.intervention_type!==void 0&&(a.intervention_type=r[9].properties.intervention_type),r[9].properties.description!==void 0&&(a.description=r[9].properties.description),e=new bo({props:a}),ye.push(()=>it(e,"name",s,r[9].properties.name)),ye.push(()=>it(e,"intervention_type",u,r[9].properties.intervention_type)),ye.push(()=>it(e,"description",l,r[9].properties.description)),{c(){Q(e.$$.fragment)},m(h,v){ee(e,h,v),o=!0},p(h,v){r=h;const c={};v&2&&(c.id=r[9].id),v&2&&(c.length_meters=r[9].properties.length_meters),!t&&v&2&&(t=!0,c.name=r[9].properties.name,ot(()=>t=!1)),!n&&v&2&&(n=!0,c.intervention_type=r[9].properties.intervention_type,ot(()=>n=!1)),!i&&v&2&&(i=!0,c.description=r[9].properties.description,ot(()=>i=!1)),e.$set(c)},i(h){o||(B(e.$$.fragment,h),o=!0)},o(h){j(e.$$.fragment,h),o=!1},d(h){te(e,h)}}}function Ao(r){let e,t,n;function i(s){r[4](s,r[9])}let o={id:r[9].id};return r[9].properties!==void 0&&(o.props=r[9].properties),e=new So({props:o}),ye.push(()=>it(e,"props",i,r[9].properties)),{c(){Q(e.$$.fragment)},m(s,u){ee(e,s,u),n=!0},p(s,u){r=s;const l={};u&2&&(l.id=r[9].id),!t&&u&2&&(t=!0,l.props=r[9].properties,ot(()=>t=!1)),e.$set(l)},i(s){n||(B(e.$$.fragment,s),n=!0)},o(s){j(e.$$.fragment,s),n=!1},d(s){te(e,s)}}}function Co(r){let e,t,n,i;const o=[Ao,Ro],s=[];function u(l,a){return l[0]?0:1}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=L()},m(l,a){s[e].m(l,a),y(l,n,a),i=!0},p(l,a){let h=e;e=u(l),e===h?s[e].p(l,a):(ze(),j(s[h],1,1,()=>{s[h]=null}),Ye(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),B(t,1),t.m(n.parentNode,n))},i(l){i||(B(t),i=!0)},o(l){j(t),i=!1},d(l){s[e].d(l),l&&b(n)}}}function Rr(r,e){let t,n,i;return n=new Lo({props:{id:e[9].id,label:e[11]+1+") "+e[2](e[9]),$$slots:{default:[Co]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=Be(),Q(n.$$.fragment),this.first=t},m(o,s){y(o,t,s),ee(n,o,s),i=!0},p(o,s){e=o;const u={};s&2&&(u.id=e[9].id),s&2&&(u.label=e[11]+1+") "+e[2](e[9])),s&4099&&(u.$$scope={dirty:s,ctx:e}),n.$set(u)},i(o){i||(B(n.$$.fragment,o),i=!0)},o(o){j(n.$$.fragment,o),i=!1},d(o){o&&b(t),te(n,o)}}}function Oo(r){let e=[],t=new Map,n,i,o,s,u=r[1].features;const l=a=>a[9].id;for(let a=0;a<u.length;a+=1){let h=Lr(r,u,a),v=l(h);t.set(v,e[a]=Rr(v,h))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=Be()},m(a,h){for(let v=0;v<e.length;v+=1)e[v].m(a,h);y(a,n,h),i=!0,o||(s=z(window,"keydown",r[3]),o=!0)},p(a,[h]){h&7&&(u=a[1].features,ze(),e=gi(e,h,l,1,a,u,t,n.parentNode,_i,Rr,n,Lr),Ye())},i(a){if(!i){for(let h=0;h<u.length;h+=1)B(e[h]);i=!0}},o(a){for(let h=0;h<e.length;h+=1)j(e[h]);i=!1},d(a){for(let h=0;h<e.length;h+=1)e[h].d(a);a&&b(n),o=!1,s()}}}function Po(r,e,t){let n,i;ce(r,Ae,c=>t(8,n=c)),ce(r,fe,c=>t(1,i=c));let{planningMode:o}=e;function s(c){var d;if(o)return((d=c.properties.planning)==null?void 0:d.name)||"Untitled polygon";if(c.properties.name)return c.properties.name;var f=c.properties.intervention_type;return f=="other"&&(c.geometry.type=="Point"?f="point":c.geometry.type=="LineString"?f="line":f="polygon"),`Untitled ${f}`}function u(c){if(c.key=="Delete"){const f=c.target.tagName;if(f=="INPUT"||f=="TEXTAREA")return;c.preventDefault();const d=n;d&&$n(d)}}function l(c,f){r.$$.not_equal(f.properties,c)&&(f.properties=c,fe.set(i))}function a(c,f){r.$$.not_equal(f.properties.name,c)&&(f.properties.name=c,fe.set(i))}function h(c,f){r.$$.not_equal(f.properties.intervention_type,c)&&(f.properties.intervention_type=c,fe.set(i))}function v(c,f){r.$$.not_equal(f.properties.description,c)&&(f.properties.description=c,fe.set(i))}return r.$$set=c=>{"planningMode"in c&&t(0,o=c.planningMode)},[o,i,s,u,l,a,h,v]}class To extends se{constructor(e){super(),le(this,e,Po,Oo,oe,{planningMode:0})}}function lt(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function je(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Pn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function tt(r,e,t){t===void 0&&(t={});var n=lt(r),i=lt(e),o=Ne(i[1]-n[1]),s=Ne(i[0]-n[0]),u=Ne(n[1]),l=Ne(i[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return vi(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),t.units)}function Kt(r,e){return e===void 0&&(e={}),yi(r,function(t,n){var i=n.geometry.coordinates;return t+tt(i[0],i[1],e)},0)}function Fo(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_,g,E,p,m,k=r[0].features.length+"",R,C,A,x,I,D,G,$;return{c(){e=w("div"),t=w("label"),n=X(`Scheme name:
    `),i=w("input"),o=L(),s=w("br"),u=L(),l=w("div"),a=w("label"),h=w("input"),v=L(),c=w("button"),c.textContent="Load from GeoJSON",f=L(),d=w("button"),d.textContent="Export to GeoJSON",_=L(),g=w("br"),E=L(),p=w("div"),m=w("span"),R=X(k),C=X(" interventions"),A=L(),x=w("button"),I=X("Clear all"),O(i,"type","text"),O(h,"type","file"),O(h,"id","load_geojson"),O(h,"class","svelte-lhyd1e"),O(c,"type","button"),O(d,"type","button"),O(d,"class","align-right svelte-lhyd1e"),O(x,"type","button"),O(x,"class","align-right svelte-lhyd1e"),x.disabled=D=r[0].features.length==0},m(F,P){y(F,e,P),S(e,t),S(t,n),S(t,i),Oe(i,r[0].scheme_name),y(F,o,P),y(F,s,P),y(F,u,P),y(F,l,P),S(l,a),S(a,h),S(a,v),S(a,c),S(l,f),S(l,d),y(F,_,P),y(F,g,P),y(F,E,P),y(F,p,P),S(p,m),S(m,R),S(m,C),S(p,A),S(p,x),S(x,I),G||($=[z(i,"input",r[7]),z(h,"change",r[3]),z(c,"click",Io),z(d,"click",r[2]),z(x,"click",r[1])],G=!0)},p(F,[P]){P&1&&i.value!==F[0].scheme_name&&Oe(i,F[0].scheme_name),P&1&&k!==(k=F[0].features.length+"")&&qn(R,k),P&1&&D!==(D=F[0].features.length==0)&&(x.disabled=D)},i:V,o:V,d(F){F&&b(e),F&&b(o),F&&b(s),F&&b(u),F&&b(l),F&&b(_),F&&b(g),F&&b(E),F&&b(p),G=!1,We($)}}}function No(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Io(){document.getElementById("load_geojson").click()}function Bo(r,e,t){let n;ce(r,fe,d=>t(0,n=d));let{authorityName:i}=e,{planningMode:o}=e,s=i;o&&(s+="_planning");let u=window.localStorage.getItem(s);if(u)try{fe.set(c(JSON.parse(u)))}catch(d){console.log(`Failed to load from local storage: ${d}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&fe.update(d=>(delete d.scheme_name,d.features=[],d))}function a(){const d=JSON.parse(JSON.stringify(n));for(let _ of d.features)delete _.properties.hide_while_editing;return d}function h(){let d=a();var _=s;d.authority=i,d.origin="atip-v1",d.scheme_name&&(_+="_"+d.scheme_name),_+=".txt",No(_,JSON.stringify(d,null,"  "))}function v(d){const _=new FileReader;_.onload=E=>{try{fe.set(c(JSON.parse(E.target.result)))}catch(p){window.alert(`Couldn't load scheme from a file: ${p}`)}};let g=d.target.files;_.readAsText(g[0])}function c(d){let _=1;for(let g of d.features)g.properties||(g.properties={name:"",description:"",intervention_type:"other"}),g.geometry.type=="LineString"&&!g.properties.length_meters&&(g.properties.length_meters=Kt(g,{units:"kilometers"})*1e3),g.id=_++;return d}function f(){n.scheme_name=this.value,fe.set(n)}return r.$$set=d=>{"authorityName"in d&&t(4,i=d.authorityName),"planningMode"in d&&t(5,o=d.planningMode)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(a())))},[n,l,h,v,i,o,s,f]}class Do extends se{constructor(e){super(),le(this,e,Bo,Fo,oe,{authorityName:4,planningMode:5})}}const Go="/atip/assets/zoom_out_map-b2e1091a.svg";function jo(r){let e,t,n,i,o;return{c(){e=w("button"),t=w("img"),bi(t.src,n=Go)||O(t,"src",n),O(t,"alt","Zoom to show entire boundary"),O(e,"type","button"),O(e,"title","Zoom to show entire boundary"),O(e,"class","svelte-qzjsqo")},m(s,u){y(s,e,u),S(e,t),i||(o=z(e,"click",r[0]),i=!0)},p:V,i:V,o:V,d(s){s&&b(e),i=!1,o()}}}function qo(r,e,t){let n;ce(r,$e,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(jn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class zo extends se{constructor(e){super(),le(this,e,qo,jo,oe,{boundaryGeojson:1})}}function Yo(r){let e,t,n,i,o,s,u;return{c(){e=w("div"),t=X(`Basemap:
  `),n=w("select"),i=w("option"),i.textContent="Streets",o=w("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&at(()=>r[2].call(n)),O(e,"class","svelte-1tbnm6i")},m(l,a){y(l,e,a),S(e,t),S(e,n),S(n,i),S(n,o),Ce(n,r[0]),s||(u=[z(n,"change",r[2]),z(n,"change",r[1])],s=!0)},p(l,[a]){a&1&&Ce(n,l[0])},i:V,o:V,d(l){l&&b(e),s=!1,We(u)}}}function $o(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let u=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=u}function o(){n=kt(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Ho extends se{constructor(e){super(),le(this,e,$o,Yo,oe,{style:0})}}const pe={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},mn=10,sn=10;function Xo(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_;return{c(){e=w("li"),t=w("span"),n=X("Areas"),i=L(),o=w("li"),s=w("span"),u=X("Routes"),l=L(),a=w("li"),h=w("span"),v=X("Crossings"),c=L(),f=w("li"),d=w("span"),_=X("Other"),O(t,"class","svelte-p551i1"),he(t,"background",pe.area),O(s,"class","svelte-p551i1"),he(s,"background",pe.route),O(h,"class","svelte-p551i1"),he(h,"background",pe.crossing),O(d,"class","svelte-p551i1"),he(d,"background",pe.other)},m(g,E){y(g,e,E),S(e,t),S(e,n),y(g,i,E),y(g,o,E),S(o,s),S(o,u),y(g,l,E),y(g,a,E),S(a,h),S(a,v),y(g,c,E),y(g,f,E),S(f,d),S(f,_)},p:V,d(g){g&&b(e),g&&b(i),g&&b(o),g&&b(l),g&&b(a),g&&b(c),g&&b(f)}}}function Uo(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_;return{c(){e=w("li"),t=w("span"),n=X("Preapp"),i=L(),o=w("li"),s=w("span"),u=X("Outline"),l=L(),a=w("li"),h=w("span"),v=X("Reserved matters"),c=L(),f=w("li"),d=w("span"),_=X("Local plan"),O(t,"class","svelte-p551i1"),he(t,"background",pe.preapp),O(s,"class","svelte-p551i1"),he(s,"background",pe.outline),O(h,"class","svelte-p551i1"),he(h,"background",pe["reserved matters"]),O(d,"class","svelte-p551i1"),he(d,"background",pe["local plan"])},m(g,E){y(g,e,E),S(e,t),S(e,n),y(g,i,E),y(g,o,E),S(o,s),S(o,u),y(g,l,E),y(g,a,E),S(a,h),S(a,v),y(g,c,E),y(g,f,E),S(f,d),S(f,_)},p:V,d(g){g&&b(e),g&&b(i),g&&b(o),g&&b(l),g&&b(a),g&&b(c),g&&b(f)}}}function Jo(r){let e,t,n,i;function o(l,a){return l[0]?Uo:Xo}let s=o(r),u=s(r);return{c(){e=w("div"),t=w("h1"),t.textContent="Interventions",n=L(),i=w("ul"),u.c(),O(t,"class","svelte-p551i1"),O(e,"class","svelte-p551i1")},m(l,a){y(l,e,a),S(e,t),S(e,n),S(e,i),u.m(i,null)},p(l,[a]){s===(s=o(l))&&u?u.p(l,a):(u.d(1),u=s(l),u&&(u.c(),u.m(i,null)))},i:V,o:V,d(l){l&&b(e),u.d()}}}function Wo(r,e,t){let{planningMode:n}=e;return r.$$set=i=>{"planningMode"in i&&t(0,n=i.planningMode)},[n]}class Ko extends se{constructor(e){super(),le(this,e,Wo,Jo,oe,{planningMode:0})}}let vt="interventions";function Vo(r,e,t){let n,i;ce(r,$e,h=>t(1,n=h)),ce(r,fe,h=>t(2,i=h));let{planningMode:o}=e;ft(n,vt,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",pe.area,"route",pe.route,"crossing",pe.crossing,"other",pe.other,"white"],u=["match",["get","reference_type",["get","planning"]],"preapp",pe.preapp,"outline",pe.outline,"reserved matters",pe["reserved matters"],"local plan",pe["local plan"],"white"],l=["!=","hide_while_editing",!0];return we(n,{id:"interventions-points",source:vt,filter:["all",cn,l,["!=","endpoint",!0]],...At(s,mn)}),we(n,{id:"interventions-lines",source:vt,filter:["all",pn,l],...Yt(s,sn)},"route-lines"),we(n,{id:"interventions-lines-endpoints",source:vt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*sn,"circle-opacity":0,"circle-stroke-color":pe.lineEndpointColor,"circle-stroke-width":2}}),we(n,{id:"interventions-polygons",source:vt,filter:["all",hn,l],...fn(o?u:s,.5)},"hover-polygons"),r.$$set=h=>{"planningMode"in h&&t(0,o=h.planningMode)},r.$$.update=()=>{if(r.$$.dirty&6){let h=JSON.parse(JSON.stringify(i)),v=[];for(let c of h.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])v.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});h.features=h.features.concat(v),n.getSource(vt).setData(h)}},[o,n,i]}class Zo extends se{constructor(e){super(),le(this,e,Vo,null,oe,{planningMode:0})}}let yt="hover";function Qo(r,e,t){let n,i,o,s,u;return ce(r,$e,l=>t(0,n=l)),ce(r,fe,l=>t(1,i=l)),ce(r,nn,l=>t(2,o=l)),ce(r,Je,l=>t(3,s=l)),ce(r,Ae,l=>t(4,u=l)),ft(n,yt,{type:"geojson",data:qe()}),we(n,{id:"hover-polygons",source:yt,filter:hn,...Yt(pe.hovering,.5*sn,1)}),we(n,{id:"hover-lines",source:yt,filter:pn,...Yt(pe.hovering,1.5*sn,1)},"interventions-lines"),we(n,{id:"hover-points",source:yt,filter:cn,...At(pe.hovering,1.5*mn,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=u||s||o;l!=null?n.getSource(yt).setData(i.features.find(a=>a.id==l)):n.getSource(yt).setData(qe())}},[n,i,o,s,u]}class es extends se{constructor(e){super(),le(this,e,Qo,null,oe,{})}}class Xn{constructor(e,t){ie(this,"owner");ie(this,"map");ie(this,"mapHandlers",{});ie(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Ut="edit-point-mode";class ts{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"cursor");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new Xn(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),ft(e,Ut,{type:"geojson",data:qe()}),we(e,{id:"edit-point-mode",source:Ut,...At(pe.hovering,mn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=ns(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Ut),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=qe();this.cursor&&e.features.push(this.cursor),this.map.getSource(Ut).setData(e)}}function ns(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Wr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return rs(r,e);var n=lt(r),i=lt(e),o=Ne(n[0]),s=Ne(i[0]),u=Ne(n[1]),l=Ne(i[1]),a=Math.sin(s-o)*Math.cos(l),h=Math.cos(u)*Math.sin(l)-Math.sin(u)*Math.cos(l)*Math.cos(s-o);return En(Math.atan2(a,h))}function rs(r,e){var t=Wr(e,r);return t=(t+180)%360,t}function Ar(r,e,t,n){n===void 0&&(n={});var i=lt(r),o=Ne(i[0]),s=Ne(i[1]),u=Ne(t),l=wi(e,n.units),a=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(u)),h=o+Math.atan2(Math.sin(u)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(a)),v=En(h),c=En(a);return Mt([v,c],n.properties)}function Tn(r){if(!r)throw new Error("geojson is required");var e=[];return zn(r,function(t){is(t,e)}),st(e)}function is(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=je(n);break;case"LineString":t=[je(n)]}t.forEach(function(i){var o=os(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function os(r,e){var t=[];return r.reduce(function(n,i){var o=xt([n,i],e);return o.bbox=ss(n,i),t.push(o),i}),t}function ss(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,u=n<o?n:o,l=t>i?t:i,a=n>o?n:o;return[s,u,l,a]}var Lt={},ls={get exports(){return Lt},set exports(r){Lt=r}},Fn={},us={get exports(){return Fn},set exports(r){Fn=r}};(function(r,e){(function(t,n){r.exports=n()})(ki,function(){function t(p,m,k,R,C){(function A(x,I,D,G,$){for(;G>D;){if(G-D>600){var F=G-D+1,P=I-D+1,K=Math.log(F),ve=.5*Math.exp(2*K/3),ne=.5*Math.sqrt(K*ve*(F-ve)/F)*(P-F/2<0?-1:1),de=Math.max(D,Math.floor(I-P*ve/F+ne)),me=Math.min(G,Math.floor(I+(F-P)*ve/F+ne));A(x,I,de,me,$)}var ke=x[I],Se=D,W=G;for(n(x,D,I),$(x[G],ke)>0&&n(x,D,G);Se<W;){for(n(x,Se,W),Se++,W--;$(x[Se],ke)<0;)Se++;for(;$(x[W],ke)>0;)W--}$(x[D],ke)===0?n(x,D,W):n(x,++W,G),W<=I&&(D=W+1),I<=W&&(G=W-1)}})(p,m,k||0,R||p.length-1,C||i)}function n(p,m,k){var R=p[m];p[m]=p[k],p[k]=R}function i(p,m){return p<m?-1:p>m?1:0}var o=function(p){p===void 0&&(p=9),this._maxEntries=Math.max(4,p),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(p,m,k){if(!k)return m.indexOf(p);for(var R=0;R<m.length;R++)if(k(p,m[R]))return R;return-1}function u(p,m){l(p,0,p.children.length,m,p)}function l(p,m,k,R,C){C||(C=g(null)),C.minX=1/0,C.minY=1/0,C.maxX=-1/0,C.maxY=-1/0;for(var A=m;A<k;A++){var x=p.children[A];a(C,p.leaf?R(x):x)}return C}function a(p,m){return p.minX=Math.min(p.minX,m.minX),p.minY=Math.min(p.minY,m.minY),p.maxX=Math.max(p.maxX,m.maxX),p.maxY=Math.max(p.maxY,m.maxY),p}function h(p,m){return p.minX-m.minX}function v(p,m){return p.minY-m.minY}function c(p){return(p.maxX-p.minX)*(p.maxY-p.minY)}function f(p){return p.maxX-p.minX+(p.maxY-p.minY)}function d(p,m){return p.minX<=m.minX&&p.minY<=m.minY&&m.maxX<=p.maxX&&m.maxY<=p.maxY}function _(p,m){return m.minX<=p.maxX&&m.minY<=p.maxY&&m.maxX>=p.minX&&m.maxY>=p.minY}function g(p){return{children:p,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(p,m,k,R,C){for(var A=[m,k];A.length;)if(!((k=A.pop())-(m=A.pop())<=R)){var x=m+Math.ceil((k-m)/R/2)*R;t(p,x,m,k,C),A.push(m,x,x,k)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(p){var m=this.data,k=[];if(!_(p,m))return k;for(var R=this.toBBox,C=[];m;){for(var A=0;A<m.children.length;A++){var x=m.children[A],I=m.leaf?R(x):x;_(p,I)&&(m.leaf?k.push(x):d(p,I)?this._all(x,k):C.push(x))}m=C.pop()}return k},o.prototype.collides=function(p){var m=this.data;if(!_(p,m))return!1;for(var k=[];m;){for(var R=0;R<m.children.length;R++){var C=m.children[R],A=m.leaf?this.toBBox(C):C;if(_(p,A)){if(m.leaf||d(p,A))return!0;k.push(C)}}m=k.pop()}return!1},o.prototype.load=function(p){if(!p||!p.length)return this;if(p.length<this._minEntries){for(var m=0;m<p.length;m++)this.insert(p[m]);return this}var k=this._build(p.slice(),0,p.length-1,0);if(this.data.children.length)if(this.data.height===k.height)this._splitRoot(this.data,k);else{if(this.data.height<k.height){var R=this.data;this.data=k,k=R}this._insert(k,this.data.height-k.height-1,!0)}else this.data=k;return this},o.prototype.insert=function(p){return p&&this._insert(p,this.data.height-1),this},o.prototype.clear=function(){return this.data=g([]),this},o.prototype.remove=function(p,m){if(!p)return this;for(var k,R,C,A=this.data,x=this.toBBox(p),I=[],D=[];A||I.length;){if(A||(A=I.pop(),R=I[I.length-1],k=D.pop(),C=!0),A.leaf){var G=s(p,A.children,m);if(G!==-1)return A.children.splice(G,1),I.push(A),this._condense(I),this}C||A.leaf||!d(A,x)?R?(k++,A=R.children[k],C=!1):A=null:(I.push(A),D.push(k),k=0,R=A,A=A.children[0])}return this},o.prototype.toBBox=function(p){return p},o.prototype.compareMinX=function(p,m){return p.minX-m.minX},o.prototype.compareMinY=function(p,m){return p.minY-m.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(p){return this.data=p,this},o.prototype._all=function(p,m){for(var k=[];p;)p.leaf?m.push.apply(m,p.children):k.push.apply(k,p.children),p=k.pop();return m},o.prototype._build=function(p,m,k,R){var C,A=k-m+1,x=this._maxEntries;if(A<=x)return u(C=g(p.slice(m,k+1)),this.toBBox),C;R||(R=Math.ceil(Math.log(A)/Math.log(x)),x=Math.ceil(A/Math.pow(x,R-1))),(C=g([])).leaf=!1,C.height=R;var I=Math.ceil(A/x),D=I*Math.ceil(Math.sqrt(x));E(p,m,k,D,this.compareMinX);for(var G=m;G<=k;G+=D){var $=Math.min(G+D-1,k);E(p,G,$,I,this.compareMinY);for(var F=G;F<=$;F+=I){var P=Math.min(F+I-1,$);C.children.push(this._build(p,F,P,R-1))}}return u(C,this.toBBox),C},o.prototype._chooseSubtree=function(p,m,k,R){for(;R.push(m),!m.leaf&&R.length-1!==k;){for(var C=1/0,A=1/0,x=void 0,I=0;I<m.children.length;I++){var D=m.children[I],G=c(D),$=(F=p,P=D,(Math.max(P.maxX,F.maxX)-Math.min(P.minX,F.minX))*(Math.max(P.maxY,F.maxY)-Math.min(P.minY,F.minY))-G);$<A?(A=$,C=G<C?G:C,x=D):$===A&&G<C&&(C=G,x=D)}m=x||m.children[0]}var F,P;return m},o.prototype._insert=function(p,m,k){var R=k?p:this.toBBox(p),C=[],A=this._chooseSubtree(R,this.data,m,C);for(A.children.push(p),a(A,R);m>=0&&C[m].children.length>this._maxEntries;)this._split(C,m),m--;this._adjustParentBBoxes(R,C,m)},o.prototype._split=function(p,m){var k=p[m],R=k.children.length,C=this._minEntries;this._chooseSplitAxis(k,C,R);var A=this._chooseSplitIndex(k,C,R),x=g(k.children.splice(A,k.children.length-A));x.height=k.height,x.leaf=k.leaf,u(k,this.toBBox),u(x,this.toBBox),m?p[m-1].children.push(x):this._splitRoot(k,x)},o.prototype._splitRoot=function(p,m){this.data=g([p,m]),this.data.height=p.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(p,m,k){for(var R,C,A,x,I,D,G,$=1/0,F=1/0,P=m;P<=k-m;P++){var K=l(p,0,P,this.toBBox),ve=l(p,P,k,this.toBBox),ne=(C=K,A=ve,x=void 0,I=void 0,D=void 0,G=void 0,x=Math.max(C.minX,A.minX),I=Math.max(C.minY,A.minY),D=Math.min(C.maxX,A.maxX),G=Math.min(C.maxY,A.maxY),Math.max(0,D-x)*Math.max(0,G-I)),de=c(K)+c(ve);ne<$?($=ne,R=P,F=de<F?de:F):ne===$&&de<F&&(F=de,R=P)}return R||k-m},o.prototype._chooseSplitAxis=function(p,m,k){var R=p.leaf?this.compareMinX:h,C=p.leaf?this.compareMinY:v;this._allDistMargin(p,m,k,R)<this._allDistMargin(p,m,k,C)&&p.children.sort(R)},o.prototype._allDistMargin=function(p,m,k,R){p.children.sort(R);for(var C=this.toBBox,A=l(p,0,m,C),x=l(p,k-m,k,C),I=f(A)+f(x),D=m;D<k-m;D++){var G=p.children[D];a(A,p.leaf?C(G):G),I+=f(A)}for(var $=k-m-1;$>=m;$--){var F=p.children[$];a(x,p.leaf?C(F):F),I+=f(x)}return I},o.prototype._adjustParentBBoxes=function(p,m,k){for(var R=k;R>=0;R--)a(m[R],p)},o.prototype._condense=function(p){for(var m=p.length-1,k=void 0;m>=0;m--)p[m].children.length===0?m>0?(k=p[m-1].children).splice(k.indexOf(p[m]),1):this.clear():u(p[m],this.toBBox)},o})})(us);const as=Yn(Si),fs=Yn(Ei),cs=Yn(Mi);var De=Fn,Kr=as,Vr=fs,bt=cs.default,ps=Vr.featureEach;Vr.coordEach;Kr.polygon;var Cr=Kr.featureCollection;function Zr(r){var e=new De(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:bt(t),De.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:bt(i),n.push(i)}):ps(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:bt(i),n.push(i)}),De.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:bt(t),De.prototype.remove.call(this,t,n)},e.clear=function(){return De.prototype.clear.call(this)},e.search=function(t){var n=De.prototype.search.call(this,this.toBBox(t));return Cr(n)},e.collides=function(t){return De.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=De.prototype.all.call(this);return Cr(t)},e.toJSON=function(){return De.prototype.toJSON.call(this)},e.fromJSON=function(t){return De.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=bt(t);else if(t.type==="FeatureCollection")n=bt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}ls.exports=Zr;Lt.default=Zr;function Qr(r,e){var t={},n=[];if(r.type==="LineString"&&(r=er(r)),e.type==="LineString"&&(e=er(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Or(r,e);return i&&n.push(i),st(n)}var o=Lt();return o.load(Tn(e)),tn(Tn(r),function(s){tn(o.search(s),function(u){var l=Or(s,u);if(l){var a=je(l).join(",");t[a]||(t[a]=!0,n.push(l))}})}),st(n)}function Or(r,e){var t=je(r),n=je(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],u=t[1][1],l=n[0][0],a=n[0][1],h=n[1][0],v=n[1][1],c=(v-a)*(s-i)-(h-l)*(u-o),f=(h-l)*(o-a)-(v-a)*(i-l),d=(s-i)*(o-a)-(u-o)*(i-l);if(c===0)return f===0&&d===0,null;var _=f/c,g=d/c;if(_>=0&&_<=1&&g>=0&&g<=1){var E=i+_*(s-i),p=o+_*(u-o);return Mt([E,p])}return null}function Ht(r,e,t){t===void 0&&(t={});var n=Mt([1/0,1/0],{dist:1/0}),i=0;return zn(r,function(o){for(var s=je(o),u=0;u<s.length-1;u++){var l=Mt(s[u]);l.properties.dist=tt(e,l,t);var a=Mt(s[u+1]);a.properties.dist=tt(e,a,t);var h=tt(l,a,t),v=Math.max(l.properties.dist,a.properties.dist),c=Wr(l,a),f=Ar(e,v,c+90,t),d=Ar(e,v,c-90,t),_=Qr(xt([f.geometry.coordinates,d.geometry.coordinates]),xt([l.geometry.coordinates,a.geometry.coordinates])),g=null;_.features.length>0&&(g=_.features[0],g.properties.dist=tt(e,g,t),g.properties.location=i+tt(l,g,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=u,n.properties.location=i),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=u+1,n.properties.location=i+h),g&&g.properties.dist<n.properties.dist&&(n=g,n.properties.index=u),i+=h}}),n}const wt="edit-polygon-mode";class hs{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"points");ie(this,"cursor");ie(this,"hover");ie(this,"dragFrom");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new Xn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),ft(e,wt,{type:"geojson",data:qe()}),we(e,{id:"edit-polygon-fill",source:wt,filter:hn,...fn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),we(e,{id:"edit-polygon-lines",source:wt,filter:pn,...Yt("black",8,.5)}),we(e,{id:"edit-polygon-vertices",source:wt,filter:cn,...At(pe.hovering,mn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Tr(this.points).forEach((n,i)=>{t.push([i+1,Ht(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(wt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=qe();this.points.forEach((n,i)=>{let o=Pr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Tr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(wt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Pr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Pr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Tr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let J;const Ue=new Array(32).fill(void 0);Ue.push(void 0,null,!0,!1);function U(r){return Ue[r]}let jt=Ue.length;function ds(r){r<36||(Ue[r]=jt,jt=r)}function Nn(r){const e=U(r);return ds(r),e}const ei=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});ei.decode();let Vt=new Uint8Array;function qt(){return Vt.byteLength===0&&(Vt=new Uint8Array(J.memory.buffer)),Vt}function St(r,e){return ei.decode(qt().subarray(r,r+e))}function ge(r){jt===Ue.length&&Ue.push(Ue.length+1);const e=jt;return jt=Ue[e],Ue[e]=r,e}function bn(r){return r==null}let Zt=new Float64Array;function ms(){return Zt.byteLength===0&&(Zt=new Float64Array(J.memory.buffer)),Zt}let Qt=new Int32Array;function _e(){return Qt.byteLength===0&&(Qt=new Int32Array(J.memory.buffer)),Qt}let rt=0;const en=new TextEncoder("utf-8"),gs=typeof en.encodeInto=="function"?function(r,e){return en.encodeInto(r,e)}:function(r,e){const t=en.encode(r);return e.set(t),{read:r.length,written:t.length}};function Jt(r,e,t){if(t===void 0){const u=en.encode(r),l=e(u.length);return qt().subarray(l,l+u.length).set(u),rt=u.length,l}let n=r.length,i=e(n);const o=qt();let s=0;for(;s<n;s++){const u=r.charCodeAt(s);if(u>127)break;o[i+s]=u}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const u=qt().subarray(i+s,i+n),l=gs(r,u);s+=l.written}return rt=s,i}function In(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=In(r[0]));for(let s=1;s<i;s++)o+=", "+In(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function _s(r,e){const t=e(r.length*1);return qt().set(r,t/1),rt=r.length,t}function wn(r,e){try{return r.apply(this,e)}catch(t){J.__wbindgen_exn_store(ge(t))}}class ln{static __wrap(e){const t=Object.create(ln.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();J.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=J.__wbindgen_add_to_stack_pointer(-16),s=_s(e,J.__wbindgen_malloc),u=rt;J.jsroutesnapper_new(o,s,u);var t=_e()[o/4+0],n=_e()[o/4+1],i=_e()[o/4+2];if(i)throw Nn(n);return ln.__wrap(t)}finally{J.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){J.jsroutesnapper_setConfig(this.ptr,ge(e))}toFinalFeature(){try{const n=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_toFinalFeature(n,this.ptr);var e=_e()[n/4+0],t=_e()[n/4+1];let i;return e!==0&&(i=St(e,t).slice(),J.__wbindgen_free(e,t*1)),i}finally{J.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_renderGeojson(n,this.ptr);var e=_e()[n/4+0],t=_e()[n/4+1];return St(e,t)}finally{J.__wbindgen_add_to_stack_pointer(16),J.__wbindgen_free(e,t)}}setSnapMode(e){J.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return J.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){J.jsroutesnapper_onClick(this.ptr)}onDragStart(){return J.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return J.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){J.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_editExisting(i,this.ptr,ge(e));var t=_e()[i/4+0],n=_e()[i/4+1];if(n)throw Nn(t)}finally{J.__wbindgen_add_to_stack_pointer(16)}}}async function vs(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function ys(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Nn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=U(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(St(e,t));return ge(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=St(e,t);return ge(n)},r.wbg.__wbindgen_is_object=function(e){const t=U(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return U(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return U(e)in U(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=U(t),i=typeof n=="number"?n:void 0;ms()[e/8+1]=bn(i)?0:i,_e()[e/4+0]=!bn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return U(e)==U(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=U(t),i=typeof n=="string"?n:void 0;var o=bn(i)?0:Jt(i,J.__wbindgen_malloc,J.__wbindgen_realloc),s=rt;_e()[e/4+1]=s,_e()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(U(t)),i=Jt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),o=rt;_e()[e/4+1]=o,_e()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=U(e);return ge(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=U(e)[U(t)];return ge(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(U(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(U(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(U(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(U(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(U(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=U(e)[t>>>0];return ge(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return U(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof U(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=U(e).next;return ge(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return wn(function(e){const t=U(e).next();return ge(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return U(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=U(e).value;return ge(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ge(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return wn(function(e,t){const n=Reflect.get(U(e),U(t));return ge(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return wn(function(e,t){const n=U(e).call(U(t));return ge(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(U(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=U(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=U(e).buffer;return ge(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(U(e));return ge(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){U(e).set(U(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return U(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=U(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=U(t).stack,i=Jt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),o=rt;_e()[e/4+1]=o,_e()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(St(e,t))}finally{J.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=In(U(t)),i=Jt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),o=rt;_e()[e/4+1]=o,_e()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(St(e,t))},r.wbg.__wbindgen_memory=function(){const e=J.memory;return ge(e)},r}function bs(r,e){return J=r.exports,ti.__wbindgen_wasm_module=e,Zt=new Float64Array,Qt=new Int32Array,Vt=new Uint8Array,J}async function ti(r){typeof r>"u"&&(r="/atip/assets/route_snapper_bg.wasm");const e=ys();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await vs(await r,e);return bs(t,n)}const Ft="route-snapper",Fr=10,ws=30;class ks{constructor(e,t){ie(this,"map");ie(this,"inner");ie(this,"active");ie(this,"eventListenersSuccessRoute");ie(this,"eventListenersSuccessArea");ie(this,"eventListenersFailure");ie(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new ln(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],ft(e,Ft,{type:"geojson",data:qe()}),we(e,{id:"route-points",source:Ft,filter:cn,...At(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Fr/2,Fr])}),we(e,{id:"route-lines",source:Ft,filter:pn,...Yt("black",2.5)}),we(e,{id:"route-polygons",source:Ft,filter:hn,...fn("black",.5)}),this.events=new Xn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-ws,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Ft).setData(JSON.parse(this.inner.renderGeojson()))}}function Nr(r){let e;function t(o,s){return o[1]?Es:Ss}let n=t(r),i=n(r);return{c(){i.c(),e=Be()},m(o,s){i.m(o,s),y(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&b(e)}}}function Ss(r){let e;return{c(){e=w("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){y(t,e,n)},d(t){t&&b(e)}}}function Es(r){let e;return{c(){e=w("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){y(t,e,n)},d(t){t&&b(e)}}}function Ms(r){let e,t=r[0]==Et&&Nr(r);return{c(){t&&t.c(),e=Be()},m(n,i){t&&t.m(n,i),y(n,e,i)},p(n,[i]){n[0]==Et?t?t.p(n,i):(t=Nr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:V,o:V,d(n){t&&t.d(n),n&&b(e)}}}const Et="edit-attribute";function ni(){}function xs(r,e,t){let n,i,o,s;ce(r,$e,f=>t(5,n=f)),ce(r,fe,f=>t(6,i=f)),ce(r,Mn,f=>t(7,o=f)),ce(r,Ae,f=>t(1,s=f));let{mode:u}=e,{changeMode:l}=e;function a(){Ae.set(null)}n.on("mousemove",h),n.on("mouseout",v),n.on("click",c),Rt(()=>{n.off("mousemove",h),n.off("mouseout",v),n.off("click",c)});function h(f){var d;if(u==Et){let _=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Je.set(((d=_[0])==null?void 0:d.id)||null)}}function v(){u==Et&&Je.set(null)}function c(f){if(u==Et){let d=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});d.length>0?Ae.set(d[0].id):Ae.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,u=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let d=i.features.find(_=>_.id==f);d.geometry.type=="Point"?n.flyTo({center:d.geometry.coordinates,duration:500}):n.fitBounds(jn(d),{padding:200,duration:500}),l(Et)}}},[u,s,l,ni,a,n,i,o]}class Ls extends se{constructor(e){super(),le(this,e,xs,Ms,oe,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ni}get stop(){return this.$$.ctx[4]}}function Rs(r){let e,t;return{c:V,m(n,i){e||(t=z(window,"keydown",r[0]),e=!0)},p:V,i:V,o:V,d(n){e=!1,t()}}}function As(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class Un extends se{constructor(e){super(),le(this,e,As,Rs,oe,{tool:1})}}function Cs(r){let e;return{c(){e=w("p"),e.textContent="Click to add a new point"},m(t,n){y(t,e,n)},d(t){t&&b(e)}}}function Os(r){let e;return{c(){e=w("p"),e.textContent="Click to move the point here"},m(t,n){y(t,e,n)},d(t){t&&b(e)}}}function Ps(r){let e,t,n,i,o,s,u,l,a;function h(f,d){return f[1]?Os:Cs}let v=h(r),c=v(r);return s=new Un({props:{tool:r[0]}}),{c(){c.c(),e=L(),t=w("p"),t.innerHTML="Press <b>Escape</b> to cancel",n=L(),i=w("button"),i.textContent="Cancel",o=L(),Q(s.$$.fragment),O(i,"type","button")},m(f,d){c.m(f,d),y(f,e,d),y(f,t,d),y(f,n,d),y(f,i,d),y(f,o,d),ee(s,f,d),u=!0,l||(a=z(i,"click",r[2]),l=!0)},p(f,[d]){v!==(v=h(f))&&(c.d(1),c=v(f),c&&(c.c(),c.m(e.parentNode,e)));const _={};d&1&&(_.tool=f[0]),s.$set(_)},i(f){u||(B(s.$$.fragment,f),u=!0)},o(f){j(s.$$.fragment,f),u=!1},d(f){c.d(f),f&&b(e),f&&b(t),f&&b(n),f&&b(i),f&&b(o),te(s,f),l=!1,a()}}}function Ts(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class ri extends se{constructor(e){super(),le(this,e,Ts,Ps,oe,{pointTool:0,editingExisting:1})}}function Fs(r){let e,t,n,i,o,s,u,l,a,h,v;return l=new Un({props:{tool:r[0]}}),{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=L(),n=w("div"),i=w("button"),i.textContent="Finish",o=L(),s=w("button"),s.textContent="Cancel",u=L(),Q(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),he(n,"display","flex"),he(n,"justify-content","space-between")},m(c,f){y(c,e,f),y(c,t,f),y(c,n,f),S(n,i),S(n,o),S(n,s),y(c,u,f),ee(l,c,f),a=!0,h||(v=[z(i,"click",r[1]),z(s,"click",r[2])],h=!0)},p(c,[f]){const d={};f&1&&(d.tool=c[0]),l.$set(d)},i(c){a||(B(l.$$.fragment,c),a=!0)},o(c){j(l.$$.fragment,c),a=!1},d(c){c&&b(e),c&&b(t),c&&b(n),c&&b(u),te(l,c),h=!1,We(v)}}}function Ns(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class ii extends se{constructor(e){super(),le(this,e,Ns,Fs,oe,{polygonTool:0})}}function Is(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_;return c=new Un({props:{tool:r[0]}}),{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=L(),n=w("label"),i=w("input"),o=X(`
  Avoid doubling back`),s=L(),u=w("div"),l=w("button"),l.textContent="Finish",a=L(),h=w("button"),h.textContent="Cancel",v=L(),Q(c.$$.fragment),O(i,"type","checkbox"),O(l,"type","button"),O(h,"type","button"),he(u,"display","flex"),he(u,"justify-content","space-between")},m(g,E){y(g,e,E),y(g,t,E),y(g,n,E),S(n,i),i.checked=r[1],S(n,o),y(g,s,E),y(g,u,E),S(u,l),S(u,a),S(u,h),y(g,v,E),ee(c,g,E),f=!0,d||(_=[z(i,"change",r[2]),z(l,"click",r[3]),z(h,"click",r[4])],d=!0)},p(g,[E]){E&2&&(i.checked=g[1]);const p={};E&1&&(p.tool=g[0]),c.$set(p)},i(g){f||(B(c.$$.fragment,g),f=!0)},o(g){j(c.$$.fragment,g),f=!1},d(g){g&&b(e),g&&b(t),g&&b(n),g&&b(s),g&&b(u),g&&b(v),te(c,g),d=!1,We(_)}}}function Bs(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),u=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,u]}class oi extends se{constructor(e){super(),le(this,e,Bs,Is,oe,{routeTool:0})}}function Ir(r){let e,t,n,i;const o=[qs,js,Gs,Ds],s=[];function u(l,a){return l[4]=="point"?0:l[4]=="polygon"?1:l[4]=="route"?2:3}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=Be()},m(l,a){s[e].m(l,a),y(l,n,a),i=!0},p(l,a){let h=e;e=u(l),e===h?s[e].p(l,a):(ze(),j(s[h],1,1,()=>{s[h]=null}),Ye(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),B(t,1),t.m(n.parentNode,n))},i(l){i||(B(t),i=!0)},o(l){j(t),i=!1},d(l){s[e].d(l),l&&b(n)}}}function Ds(r){let e;return{c(){e=w("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){y(t,e,n)},p:V,i:V,o:V,d(t){t&&b(e)}}}function Gs(r){let e,t;return e=new oi({props:{routeTool:r[3]}}),{c(){Q(e.$$.fragment)},m(n,i){ee(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(B(e.$$.fragment,n),t=!0)},o(n){j(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function js(r){let e,t;return e=new ii({props:{polygonTool:r[2]}}),{c(){Q(e.$$.fragment)},m(n,i){ee(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(B(e.$$.fragment,n),t=!0)},o(n){j(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function qs(r){let e,t;return e=new ri({props:{pointTool:r[1],editingExisting:!0}}),{c(){Q(e.$$.fragment)},m(n,i){ee(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(B(e.$$.fragment,n),t=!0)},o(n){j(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function zs(r){let e,t,n=r[0]==Qe&&Ir(r);return{c(){n&&n.c(),e=Be()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==Qe?n?(n.p(i,o),o&1&&B(n,1)):(n=Ir(i),n.c(),B(n,1),n.m(e.parentNode,e)):n&&(ze(),j(n,1,1,()=>{n=null}),Ye())},i(i){t||(B(n),t=!0)},o(i){j(n),t=!1},d(i){n&&n.d(i),i&&b(e)}}}const Qe="edit-geometry";function si(){}function Ys(r,e,t){let n;ce(r,$e,_=>t(8,n=_));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:u}=e,l=null,a=null;function h(){l&&(o.stop(),s.stop(),u.stop(),fe.update(_=>{let g=_.features.find(E=>E.id==l);return delete g.properties.hide_while_editing,_})),l=null,t(4,a=null),Je.set(null)}n.on("mousemove",v),n.on("mouseout",c),n.on("click",f),Rt(()=>{n.off("mousemove",v),n.off("mouseout",c),n.off("click",f)}),u.addEventListenerSuccessRoute(_=>{i==Qe&&(fe.update(g=>{let E=g.features.find(p=>p.id==l);return E.properties.length_meters=_.properties.length_meters,E.properties.waypoints=_.properties.waypoints,delete E.properties.hide_while_editing,E.geometry=_.geometry,g}),l=null,t(4,a=null))});for(let _ of[o,s])_.addEventListenerSuccess(g=>{i==Qe&&(fe.update(E=>{let p=E.features.find(m=>m.id==l);return p.geometry=g.geometry,delete p.properties.hide_while_editing,E}),l=null,t(4,a=null))});for(let _ of[o,s,u])_.addEventListenerFailure(()=>{i==Qe&&(fe.update(g=>{let E=g.features.find(p=>p.id==l);return delete E.properties.hide_while_editing,g}),l=null,t(4,a=null))});function v(_){var g;if(i==Qe&&l==null){let E=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Je.set(((g=E[0])==null?void 0:g.id)||null)}}function c(){i==Qe&&l==null&&Je.set(null)}function f(_){if(i==Qe&&l==null){let g=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0&&d(g[0].id)}}function d(_){Je.set(null);let g=null;fe.update(p=>(g=p.features.find(m=>m.id==_),g.properties.hide_while_editing=!0,p));let E=g;l=_,E.geometry.type=="LineString"?(u.editExistingRoute(E),t(4,a="route")):E.geometry.type=="Polygon"?(s.editExisting(E),t(4,a="polygon")):E.geometry.type=="Point"&&(o.start(),t(4,a="point"))}return r.$$set=_=>{"mode"in _&&t(0,i=_.mode),"pointTool"in _&&t(1,o=_.pointTool),"polygonTool"in _&&t(2,s=_.polygonTool),"routeTool"in _&&t(3,u=_.routeTool)},[i,o,s,u,a,si,h]}class $s extends se{constructor(e){super(),le(this,e,Ys,zs,oe,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return si}get stop(){return this.$$.ctx[6]}}async function Hs(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:a,value:h}=await n.read();if(a)break;s.push(h),o+=h.length;const v=100*o/i;e.style=`background: linear-gradient(to right, red ${v}%, transparent 0);`}let u=new Uint8Array(o),l=0;for(let a of s)u.set(a,l),l+=a.length;return u}function Xs(r){let e,t;return e=new oi({props:{routeTool:r[0]}}),{c(){Q(e.$$.fragment)},m(n,i){ee(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(B(e.$$.fragment,n),t=!0)},o(n){j(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Us(r){let e;return{c(){e=w("div"),e.textContent="Route tool loading..."},m(t,n){y(t,e,n),r[7](e)},p:V,i:V,o:V,d(t){t&&b(e),r[7](null)}}}function Js(r){let e,t,n,i;const o=[Us,Xs],s=[];function u(l,a){return l[0]?l[1]==Bn?1:-1:0}return~(e=u(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=Be()},m(l,a){~e&&s[e].m(l,a),y(l,n,a),i=!0},p(l,[a]){let h=e;e=u(l),e===h?~e&&s[e].p(l,a):(t&&(ze(),j(s[h],1,1,()=>{s[h]=null}),Ye()),~e?(t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),B(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(B(t),i=!0)},o(l){j(t),i=!1},d(l){~e&&s[e].d(l),l&&b(n)}}}const Bn="route";function Ws(r,e,t){let n;ce(r,$e,c=>t(8,n=c));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,u,{routeTool:l}=e;function a(){l.isActive()||l.startRoute()}function h(){l==null||l.stop()}Gn(async()=>{await ti(),console.log(`Grabbing ${s}`);try{const c=await Hs(s,u);t(0,l=new ks(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,u.innerHTML="Failed to load",u);return}l.addEventListenerFailure(()=>{i==Bn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{i==Bn&&(fe.update(f=>(c.id=dn(f),c.properties.intervention_type="route",f.features.push(c),f)),o("edit-attribute"),Ae.set(c.id))})}),Rt(()=>{l==null||l.tearDown()});function v(c){ye[c?"unshift":"push"](()=>{u=c,t(2,u)})}return r.$$set=c=>{"mode"in c&&t(1,i=c.mode),"changeMode"in c&&t(3,o=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,i,u,o,s,a,h,v]}class Ks extends se{constructor(e){super(),le(this,e,Ws,Js,oe,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Br(r){let e,t;return e=new ri({props:{pointTool:r[1],editingExisting:!1}}),{c(){Q(e.$$.fragment)},m(n,i){ee(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(B(e.$$.fragment,n),t=!0)},o(n){j(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function Vs(r){let e,t,n=r[0]==un&&Br(r);return{c(){n&&n.c(),e=Be()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==un?n?(n.p(i,o),o&1&&B(n,1)):(n=Br(i),n.c(),B(n,1),n.m(e.parentNode,e)):n&&(ze(),j(n,1,1,()=>{n=null}),Ye())},i(i){t||(B(n),t=!0)},o(i){j(n),t=!1},d(i){n&&n.d(i),i&&b(e)}}}const un="point";function Zs(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==un&&(fe.update(a=>(l.id=dn(a),l.properties.intervention_type="other",a.features.push(l),a)),i("edit-attribute"),Ae.set(l.id))}),o.addEventListenerFailure(()=>{n==un&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,u]}class Qs extends se{constructor(e){super(),le(this,e,Zs,Vs,oe,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Dr(r){let e,t;return e=new ii({props:{polygonTool:r[1]}}),{c(){Q(e.$$.fragment)},m(n,i){ee(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(B(e.$$.fragment,n),t=!0)},o(n){j(e.$$.fragment,n),t=!1},d(n){te(e,n)}}}function el(r){let e,t,n=r[0]==an&&Dr(r);return{c(){n&&n.c(),e=Be()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==an?n?(n.p(i,o),o&1&&B(n,1)):(n=Dr(i),n.c(),B(n,1),n.m(e.parentNode,e)):n&&(ze(),j(n,1,1,()=>{n=null}),Ye())},i(i){t||(B(n),t=!0)},o(i){j(n),t=!1},d(i){n&&n.d(i),i&&b(e)}}}const an="free-polygon";function tl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==an&&(fe.update(a=>(l.id=dn(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),Ae.set(l.id))}),o.addEventListenerFailure(()=>{n==an&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,u]}class nl extends se{constructor(e){super(),le(this,e,tl,el,oe,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function rl(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=tt(r.slice(0,2),[n,t]),s=tt(r.slice(0,2),[e,i]);if(o>=s){var u=(t+i)/2;return[e,u-(n-e)/2,n,u+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function il(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return xi(r,function(s){ol(s,o,n)}),r}function ol(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function sl(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Pn(r),n=Pn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=il(e,{precision:7});switch(n){case"Point":return Dn(r,i);case"MultiPoint":return Gr(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Gr(r,Qr(r,i))}}function Gr(r,e){var t=[],n=Lt();return zn(e,function(i){if(t.forEach(function(u,l){u.id=l}),!t.length)t=Dn(r,i).features,t.forEach(function(u){u.bbox||(u.bbox=rl(Li(u)))}),n.load(st(t));else{var o=n.search(i);if(o.features.length){var s=li(i,o);t=t.filter(function(u){return u.id!==s.id}),n.remove(s),tn(Dn(s,i),function(u){t.push(u),n.insert(u)})}}}),st(t)}function Dn(r,e){var t=[],n=je(r)[0],i=je(r)[r.geometry.coordinates.length-1];if(kn(n,lt(e))||kn(i,lt(e)))return st([r]);var o=Lt(),s=Tn(r);o.load(s);var u=o.search(e);if(!u.features.length)return st([r]);var l=li(e,u),a=[n],h=Ri(s,function(v,c,f){var d=je(c)[1],_=lt(e);return f===l.id?(v.push(_),t.push(xt(v)),kn(_,d)?[_]:[_,d]):(v.push(d),v)},a);return h.length>1&&t.push(xt(h)),st(t)}function li(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return tn(e,function(i){var o=Ht(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function kn(r,e){return r[0]===e[0]&&r[1]===e[1]}function ll(r,e,t){var n=je(t);if(Pn(t)!=="LineString")throw new Error("line must be a LineString");var i=Ht(t,r),o=Ht(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var u=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)u.push(n[l]);return u.push(s[1].geometry.coordinates),xt(u,t.properties)}function jr(r){let e;return{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){y(t,e,n)},d(t){t&&b(e)}}}function ul(r){let e,t,n,i=r[0]==zt&&jr();return{c(){i&&i.c(),e=Be()},m(o,s){i&&i.m(o,s),y(o,e,s),t||(n=z(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==zt?i||(i=jr(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:V,o:V,d(o){i&&i.d(o),o&&b(e),t=!1,n()}}}const zt="split-route",al=10,fl=30;let Sn="split-route";function ui(){}function qr(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function cl(r,e,t){let n,i;ce(r,fe,_=>t(8,n=_)),ce(r,$e,_=>t(6,i=_));let{mode:o}=e,{changeMode:s}=e;function u(){t(5,l=null),a=null}let l=null,a=null;i.on("mousemove",h),i.on("click",v),Rt(()=>{i.off("mousemove",h),i.off("click",v)}),ft(i,Sn,{type:"geojson",data:qe()}),we(i,{id:"draw-split-route",source:Sn,...At("black",al,["case",["==",["get","snapped"],!0],1,.5])});function h(_){if(o!=zt)return;t(5,l=qr(_.lngLat.toArray(),!1)),a=null;const g=[_.point.x-fl,_.point.y],E=i.unproject(_.point).distanceTo(i.unproject(g))/1e3;let p=[];for(let[m,k]of n.features.entries())if(k.geometry.type=="LineString"){let R=Ht(k.geometry,l,{units:"kilometers"});R.properties.dist!=null&&R.properties.dist<=E&&p.push([m,R.geometry.coordinates,R.properties.dist])}p.sort((m,k)=>m[2]-k[2]),p.length>0&&(t(5,l=qr(p[0][1],!0)),a=p[0][0])}function v(){if(o==zt)if(a==null)s("edit-attribute");else{let _=sl(n.features[a],l);if(_.features.length==2){let g=_.features[0],E=_.features[1];fe.update(p=>(g.id=p.features[a].id,E.id=dn(p),g.properties=JSON.parse(JSON.stringify(p.features[a].properties)),E.properties=JSON.parse(JSON.stringify(g.properties)),c(p.features[a],g,E,l),p.features.splice(a,1,g,E),p))}u()}}function c(_,g,E,p){g.properties.length_meters=Kt(g,{units:"kilometers"})*1e3,E.properties.length_meters=Kt(E,{units:"kilometers"})*1e3,g.properties.waypoints=[],E.properties.waypoints=[];let m=f(_,p),k=!0,R=0;for(let C of _.properties.waypoints){let A=f(_,Mt([C.lon,C.lat]));if(k)if(A<m)g.properties.waypoints.push(C);else{let x=C.snapped&&_.properties.waypoints[R-1].snapped;g.properties.waypoints.push({lon:p.geometry.coordinates[0],lat:p.geometry.coordinates[1],snapped:x}),k=!1,E.properties.waypoints.push({lon:p.geometry.coordinates[0],lat:p.geometry.coordinates[1],snapped:x}),E.properties.waypoints.push(C)}else E.properties.waypoints.push(C);R++}}function f(_,g){let E=_.geometry.coordinates[0],p=ll(E,g,_);return Kt(p,{units:"kilometers"})*1e3}function d(_){o==zt&&_.key=="Escape"&&(s("edit-attribute"),_.preventDefault())}return r.$$set=_=>{"mode"in _&&t(0,o=_.mode),"changeMode"in _&&t(2,s=_.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let _=qe();l&&_.features.push(l),i.getSource(Sn).setData(_)}},[o,d,s,ui,u,l,i]}class pl extends se{constructor(e){super(),le(this,e,cl,ul,oe,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ui}get stop(){return this.$$.ctx[4]}}function zr(r){let e,t,n={mode:r[3],pointTool:r[10],polygonTool:r[11],routeTool:r[2]};return e=new $s({props:n}),r[16](e),{c(){Q(e.$$.fragment)},m(i,o){ee(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(B(e.$$.fragment,i),t=!0)},o(i){j(e.$$.fragment,i),t=!1},d(i){r[16](null),te(e,i)}}}function Yr(r){let e,t,n,i,o;return{c(){e=w("button"),t=X("New point"),O(e,"type","button"),e.disabled=n=r[3]=="point",O(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),S(e,t),i||(o=z(e,"click",r[17]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&b(e),i=!1,o()}}}function $r(r){let e,t,n,i,o;return{c(){e=w("button"),t=X("New route"),O(e,"type","button"),e.disabled=n=r[3]=="route",O(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),S(e,t),i||(o=z(e,"click",r[21]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&b(e),i=!1,o()}}}function Hr(r){let e,t,n,i,o;return{c(){e=w("button"),t=X("Split route"),O(e,"type","button"),e.disabled=n=r[3]=="split-route",O(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),S(e,t),i||(o=z(e,"click",r[24]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&b(e),i=!1,o()}}}function hl(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_,g,E,p,m,k,R,C,A,x,I,D,G,$,F,P,K,ve,ne,de,me,ke,Se={mode:r[3],changeMode:r[12]};u=new Ls({props:Se}),r[14](u);let W=r[2]&&zr(r),ue=!r[1]&&Yr(r),Ke={mode:r[3],changeMode:r[12],pointTool:r[10]};E=new Qs({props:Ke}),r[18](E);let be={mode:r[3],changeMode:r[12],polygonTool:r[11]};x=new nl({props:be}),r[20](x);let re=!r[1]&&$r(r);function Te(Y){r[23](Y)}let He={mode:r[3],changeMode:r[12],url:r[0]};r[2]!==void 0&&(He.routeTool=r[2]),$=new Ks({props:He}),r[22]($),ye.push(()=>it($,"routeTool",Te,r[2]));let ae=!r[1]&&Hr(r),Xe={mode:r[3],changeMode:r[12]};return ne=new pl({props:Xe}),r[25](ne),{c(){e=w("div"),t=w("div"),n=w("button"),i=X("Edit attributes"),s=L(),Q(u.$$.fragment),l=L(),a=w("div"),h=w("button"),v=X("Edit geometry"),f=L(),W&&W.c(),d=L(),_=w("div"),ue&&ue.c(),g=L(),Q(E.$$.fragment),p=L(),m=w("div"),k=w("button"),R=X("New polygon"),A=L(),Q(x.$$.fragment),I=L(),D=w("div"),re&&re.c(),G=L(),Q($.$$.fragment),P=L(),K=w("div"),ae&&ae.c(),ve=L(),Q(ne.$$.fragment),O(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",O(n,"class","svelte-cej5os"),O(h,"type","button"),h.disabled=c=r[3]=="edit-geometry",O(h,"class","svelte-cej5os"),O(k,"type","button"),k.disabled=C=r[3]=="free-polygon",O(k,"class","svelte-cej5os"),O(e,"class","toolbox svelte-cej5os")},m(Y,Z){y(Y,e,Z),S(e,t),S(t,n),S(n,i),S(t,s),ee(u,t,null),S(e,l),S(e,a),S(a,h),S(h,v),S(a,f),W&&W.m(a,null),S(e,d),S(e,_),ue&&ue.m(_,null),S(_,g),ee(E,_,null),S(e,p),S(e,m),S(m,k),S(k,R),S(m,A),ee(x,m,null),S(e,I),S(e,D),re&&re.m(D,null),S(D,G),ee($,D,null),S(e,P),S(e,K),ae&&ae.m(K,null),S(K,ve),ee(ne,K,null),de=!0,me||(ke=[z(n,"click",r[13]),z(h,"click",r[15]),z(k,"click",r[19])],me=!0)},p(Y,[Z]){(!de||Z&8&&o!==(o=Y[3]=="edit-attribute"))&&(n.disabled=o);const T={};Z&8&&(T.mode=Y[3]),u.$set(T),(!de||Z&8&&c!==(c=Y[3]=="edit-geometry"))&&(h.disabled=c),Y[2]?W?(W.p(Y,Z),Z&4&&B(W,1)):(W=zr(Y),W.c(),B(W,1),W.m(a,null)):W&&(ze(),j(W,1,1,()=>{W=null}),Ye()),Y[1]?ue&&(ue.d(1),ue=null):ue?ue.p(Y,Z):(ue=Yr(Y),ue.c(),ue.m(_,g));const H={};Z&8&&(H.mode=Y[3]),E.$set(H),(!de||Z&8&&C!==(C=Y[3]=="free-polygon"))&&(k.disabled=C);const ct={};Z&8&&(ct.mode=Y[3]),x.$set(ct),Y[1]?re&&(re.d(1),re=null):re?re.p(Y,Z):(re=$r(Y),re.c(),re.m(D,G));const Ve={};Z&8&&(Ve.mode=Y[3]),Z&1&&(Ve.url=Y[0]),!F&&Z&4&&(F=!0,Ve.routeTool=Y[2],ot(()=>F=!1)),$.$set(Ve),Y[1]?ae&&(ae.d(1),ae=null):ae?ae.p(Y,Z):(ae=Hr(Y),ae.c(),ae.m(K,ve));const pt={};Z&8&&(pt.mode=Y[3]),ne.$set(pt)},i(Y){de||(B(u.$$.fragment,Y),B(W),B(E.$$.fragment,Y),B(x.$$.fragment,Y),B($.$$.fragment,Y),B(ne.$$.fragment,Y),de=!0)},o(Y){j(u.$$.fragment,Y),j(W),j(E.$$.fragment,Y),j(x.$$.fragment,Y),j($.$$.fragment,Y),j(ne.$$.fragment,Y),de=!1},d(Y){Y&&b(e),r[14](null),te(u),W&&W.d(),ue&&ue.d(),r[18](null),te(E),r[20](null),te(x),re&&re.d(),r[22](null),te($),ae&&ae.d(),r[25](null),te(ne),me=!1,We(ke)}}}function dl(r,e,t){let n;ce(r,$e,P=>t(26,n=P));let{routeUrl:i}=e,{planningMode:o}=e,s,u=new ts(n),l=new hs(n),a="edit-attribute",h,v,c,f,d,_;function g(P){let K={"edit-attribute":h,"edit-geometry":v,route:c,point:f,polygon:d,"split-route":_};if(a==P){console.log(`Mode is already ${a}, not changing`);return}console.log(`Stopping old mode ${a}`),K[a].stop(),t(3,a=P),console.log(`Starting new mode ${a}`),K[a].start()}Rt(()=>{u==null||u.tearDown(),l==null||l.tearDown()});const E=()=>g("edit-attribute");function p(P){ye[P?"unshift":"push"](()=>{h=P,t(4,h)})}const m=()=>g("edit-geometry");function k(P){ye[P?"unshift":"push"](()=>{v=P,t(5,v)})}const R=()=>g("point");function C(P){ye[P?"unshift":"push"](()=>{f=P,t(7,f)})}const A=()=>g("free-polygon");function x(P){ye[P?"unshift":"push"](()=>{d=P,t(8,d)})}const I=()=>g("route");function D(P){ye[P?"unshift":"push"](()=>{c=P,t(6,c)})}function G(P){s=P,t(2,s)}const $=()=>g("split-route");function F(P){ye[P?"unshift":"push"](()=>{_=P,t(9,_)})}return r.$$set=P=>{"routeUrl"in P&&t(0,i=P.routeUrl),"planningMode"in P&&t(1,o=P.planningMode)},[i,o,s,a,h,v,c,f,d,_,u,l,g,E,p,m,k,R,C,A,x,I,D,G,$,F]}class ml extends se{constructor(e){super(),le(this,e,dl,hl,oe,{routeUrl:0,planningMode:1})}}function gl(r){let e,t,n,i,o,s,u,l,a,h,v,c,f,d,_,g,E;return{c(){e=w("div"),t=w("div"),n=w("button"),n.textContent="Home",i=L(),o=w("button"),o.textContent="About",s=L(),u=w("button"),u.textContent="Instructions",l=L(),a=w("br"),h=L(),v=w("label"),c=X(`ATIP mode:
      `),f=w("select"),d=w("option"),d.textContent="Design",_=w("option"),_.textContent="Planning",O(n,"type","button"),O(o,"type","button"),O(u,"type","button"),d.__value="design",d.value=d.__value,_.__value="planning",_.value=_.__value,r[2]===void 0&&at(()=>r[12].call(f)),O(e,"slot","nav")},m(p,m){y(p,e,m),S(e,t),S(t,n),S(t,i),S(t,o),S(t,s),S(t,u),S(e,l),S(e,a),S(e,h),S(e,v),S(v,c),S(v,f),S(f,d),S(f,_),Ce(f,r[2]),g||(E=[z(n,"click",r[11]),z(o,"click",r[8]),z(u,"click",r[9]),z(f,"change",r[12]),z(f,"change",r[10])],g=!0)},p(p,m){m&4&&Ce(f,p[2])},d(p){p&&b(e),g=!1,We(E)}}}function _l(r){let e,t,n,i,o,s,u,l,a,h,v,c;return o=new zo({props:{boundaryGeojson:r[4]}}),u=new Do({props:{authorityName:r[5],planningMode:r[7]}}),v=new To({props:{planningMode:r[7]}}),{c(){e=w("div"),t=w("h1"),n=X(r[5]),i=L(),Q(o.$$.fragment),s=L(),Q(u.$$.fragment),l=L(),a=w("br"),h=L(),Q(v.$$.fragment),O(e,"slot","sidebar")},m(f,d){y(f,e,d),S(e,t),S(t,n),S(t,i),ee(o,t,null),S(e,s),ee(u,e,null),S(e,l),S(e,a),S(e,h),ee(v,e,null),c=!0},p(f,d){const _={};d&16&&(_.boundaryGeojson=f[4]),o.$set(_)},i(f){c||(B(o.$$.fragment,f),B(u.$$.fragment,f),B(v.$$.fragment,f),c=!0)},o(f){j(o.$$.fragment,f),j(u.$$.fragment,f),j(v.$$.fragment,f),c=!1},d(f){f&&b(e),te(o),te(u),te(v)}}}function vl(r){let e,t,n,i,o,s,u,l,a,h,v,c;return e=new _o({props:{boundaryGeojson:r[4]}}),n=new Zo({props:{planningMode:r[7]}}),o=new es({}),u=new ml({props:{routeUrl:r[3],planningMode:r[7]}}),a=new Ho({props:{style:r[6]}}),v=new Ko({props:{planningMode:r[7]}}),{c(){Q(e.$$.fragment),t=L(),Q(n.$$.fragment),i=L(),Q(o.$$.fragment),s=L(),Q(u.$$.fragment),l=L(),Q(a.$$.fragment),h=L(),Q(v.$$.fragment)},m(f,d){ee(e,f,d),y(f,t,d),ee(n,f,d),y(f,i,d),ee(o,f,d),y(f,s,d),ee(u,f,d),y(f,l,d),ee(a,f,d),y(f,h,d),ee(v,f,d),c=!0},p(f,d){const _={};d&16&&(_.boundaryGeojson=f[4]),e.$set(_);const g={};d&8&&(g.routeUrl=f[3]),u.$set(g)},i(f){c||(B(e.$$.fragment,f),B(n.$$.fragment,f),B(o.$$.fragment,f),B(u.$$.fragment,f),B(a.$$.fragment,f),B(v.$$.fragment,f),c=!0)},o(f){j(e.$$.fragment,f),j(n.$$.fragment,f),j(o.$$.fragment,f),j(u.$$.fragment,f),j(a.$$.fragment,f),j(v.$$.fragment,f),c=!1},d(f){te(e,f),f&&b(t),te(n,f),f&&b(i),te(o,f),f&&b(s),te(u,f),f&&b(l),te(a,f),f&&b(h),te(v,f)}}}function yl(r){let e,t,n;return t=new Bi({props:{style:r[6],$$slots:{default:[vl]},$$scope:{ctx:r}}}),{c(){e=w("div"),Q(t.$$.fragment),O(e,"slot","main")},m(i,o){y(i,e,o),ee(t,e,null),n=!0},p(i,o){const s={};o&262168&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(B(t.$$.fragment,i),n=!0)},o(i){j(t.$$.fragment,i),n=!1},d(i){i&&b(e),te(t)}}}function bl(r){let e,t,n,i,o,s,u,l;e=new Yi({props:{$$slots:{main:[yl],sidebar:[_l],nav:[gl]},$$scope:{ctx:r}}});function a(f){r[13](f)}let h={};r[0]!==void 0&&(h.open=r[0]),n=new Ai({props:h}),ye.push(()=>it(n,"open",a,r[0]));function v(f){r[14](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Fi({props:c}),ye.push(()=>it(s,"open",v,r[1])),{c(){Q(e.$$.fragment),t=L(),Q(n.$$.fragment),o=L(),Q(s.$$.fragment)},m(f,d){ee(e,f,d),y(f,t,d),ee(n,f,d),y(f,o,d),ee(s,f,d),l=!0},p(f,[d]){const _={};d&262172&&(_.$$scope={dirty:d,ctx:f}),e.$set(_);const g={};!i&&d&1&&(i=!0,g.open=f[0],ot(()=>i=!1)),n.$set(g);const E={};!u&&d&2&&(u=!0,E.open=f[1],ot(()=>u=!1)),s.$set(E)},i(f){l||(B(e.$$.fragment,f),B(n.$$.fragment,f),B(s.$$.fragment,f),l=!0)},o(f){j(e.$$.fragment,f),j(n.$$.fragment,f),j(s.$$.fragment,f),l=!1},d(f){te(e,f),f&&b(t),te(n,f),f&&b(o),te(s,f)}}}function wl(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let u=s.get("authority"),l=s.get("style")||"streets",a=s.has("planning"),h=a?"planning":"design";var v=`https://atip.uk/route-snappers/${u}.bin`;o||(v=`https://atip.uk/route-snappers-dev/${u}.bin`);function c(){t(0,n=!n),t(1,i=!1)}function f(){t(1,i=!i),t(0,n=!1)}let d;Gn(async()=>{t(4,d=await _())});async function _(){const C=await(await fetch(Ci)).text(),A=JSON.parse(C);return A.features=A.features.filter(x=>{var I;return((I=x.properties)==null?void 0:I.name)==u}),A}function g(){let R=new URLSearchParams(window.location.search);h=="design"?R.delete("planning"):R.set("planning","");let C=`${window.location.pathname}?${R.toString()}${window.location.hash}`;window.location.href=C}const E=()=>window.open("index.html");function p(){h=kt(this),t(2,h)}function m(R){n=R,t(0,n)}function k(R){i=R,t(1,i)}return[n,i,h,v,d,u,l,a,c,f,g,E,p,m,k]}class kl extends se{constructor(e){super(),le(this,e,wl,bl,oe,{})}}new kl({target:document.getElementById("app")});
