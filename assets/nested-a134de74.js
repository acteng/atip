var li=Object.defineProperty;var ai=(r,e,t)=>e in r?li(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var te=(r,e,t)=>(ai(r,typeof e!="symbol"?e+"":e,t),t);import{S as Z,i as Q,s as K,M as ui,b as ne,a as we,d as Y,m as H,k as ke,n as R,o as A,q as U,e as k,c as T,g as S,x as G,p as E,y as De,f as C,z as ve,B as ye,C as fi,D as Sn,E as tn,F as Et,G as ht,H as dt,I as mt,J as gt,K as $n,h as w,l as B,L as ci,N as pi,O as ie,P as hi,w as En,Q as Ze,R as be,T as zt,t as X,U as _e,V as ae,j as Re,r as Te,W as He,X as Tr,Y as Rr,Z as Wt,_ as Nt,$ as Fn,a0 as Nn,a1 as di,a2 as mi,a3 as $e,a4 as gi,a5 as _i,a6 as vi,a7 as It,a8 as xr,a9 as Vt,aa as ut,ab as Kt,ac as wt,ad as Zt,ae as an,af as yi,ag as st,ah as Mn,ai as We,aj as lt,ak as bi,al as On,am as wi,an as ki,ao as Si,ap as In,aq as Bt,ar as Ei,as as Mi,at as Oi,A as Li,u as Ci}from"./authorities-aeb2ee2e.js";function Ti(r){let e,t,n,i,o,s,a,l,u,p,_,c,f;return{c(){e=k("p"),e.textContent="For each intervention:",t=T(),n=k("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=T(),o=k("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=T(),a=k("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=T(),u=k("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=T(),_=k("p"),_.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=T(),f=k("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(h,g){S(h,e,g),S(h,t,g),S(h,n,g),S(h,i,g),S(h,o,g),S(h,s,g),S(h,a,g),S(h,l,g),S(h,u,g),S(h,p,g),S(h,_,g),S(h,c,g),S(h,f,g)},p:G,d(h){h&&E(e),h&&E(t),h&&E(n),h&&E(i),h&&E(o),h&&E(s),h&&E(a),h&&E(l),h&&E(u),h&&E(p),h&&E(_),h&&E(c),h&&E(f)}}}function Ri(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Ti]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new ui({props:o}),ne.push(()=>we(e,"open",i,r[0])),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],ke(()=>t=!1)),e.$set(l)},i(s){n||(R(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function xi(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Ai extends Z{constructor(e){super(),Q(this,e,xi,Ri,K,{open:0})}}const Qe=[];function ft(r,e=G){let t;const n=new Set;function i(a){if(K(r,a)&&(r=a,t)){const l=!Qe.length;for(const u of n)u[1](),Qe.push(u,r);if(l){for(let u=0;u<Qe.length;u+=2)Qe[u][0](Qe[u+1]);Qe.length=0}}}function o(a){i(a(r))}function s(a,l=G){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||G),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const je=ft(null),ee=ft(De()),Ce=ft(null),Ye=ft(null),Dt=ft(null),un=ft(null);function Mt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Bn(r){ee.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Ce.set(null),Ye.set(null),Dt.set(null)}function Dn(r){let e;const t=r[4].default,n=ht(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&dt(n,t,i,i[3],e?gt(t,i[3],o,null):mt(i[3]),null)},i(i){e||(R(n,i),e=!0)},o(i){A(n,i),e=!1},d(i){n&&n.d(i)}}}function Pi(r){let e,t,n=r[1]&&Dn(r);return{c(){e=k("div"),n&&n.c(),C(e,"class","map svelte-12dpf1u")},m(i,o){S(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&R(n,1)):(n=Dn(i),n.c(),R(n,1),n.m(e,null)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(R(n),t=!0)},o(i){A(n),t=!1},d(i){i&&E(e),n&&n.d(),r[5](null)}}}function $i(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;fi("setCamera",!window.location.hash),Sn(()=>{s=new tn.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new tn.ScaleControl({})),s.addControl(new tn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),je.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),Et(()=>{s.remove()});function u(p){ne[p?"unshift":"push"](()=>{a=p,t(0,a)})}return r.$$set=p=>{"style"in p&&t(2,o=p.style),"$$scope"in p&&t(3,i=p.$$scope)},[a,l,o,i,n,u]}class Fi extends Z{constructor(e){super(),Q(this,e,$i,Pi,K,{style:2})}}const Ni=r=>({}),jn=r=>({}),Ii=r=>({}),qn=r=>({}),Bi=r=>({}),Gn=r=>({});function Di(r){let e,t,n,i,o,s,a,l,u,p,_,c;const f=r[3].nav,h=ht(f,r,r[2],Gn),g=r[3].sidebar,d=ht(g,r,r[2],qn),y=r[3].main,m=ht(y,r,r[2],jn);return{c(){e=k("aside"),t=k("div"),n=k("nav"),h&&h.c(),i=T(),d&&d.c(),o=T(),s=k("button"),s.textContent="→",l=T(),u=k("main"),m&&m.c(),C(n,"class","svelte-1u7vg8a"),C(t,"class","sidebar-content content-container svelte-1u7vg8a"),C(s,"type","button"),C(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),C(e,"class",a=$n(r[0]?"":"collapsed")+" svelte-1u7vg8a"),C(u,"class","svelte-1u7vg8a")},m(v,b){S(v,e,b),w(e,t),w(t,n),h&&h.m(n,null),w(t,i),d&&d.m(t,null),w(e,o),w(e,s),S(v,l,b),S(v,u,b),m&&m.m(u,null),p=!0,_||(c=B(s,"click",r[1]),_=!0)},p(v,[b]){h&&h.p&&(!p||b&4)&&dt(h,f,v,v[2],p?gt(f,v[2],b,Bi):mt(v[2]),Gn),d&&d.p&&(!p||b&4)&&dt(d,g,v,v[2],p?gt(g,v[2],b,Ii):mt(v[2]),qn),(!p||b&1&&a!==(a=$n(v[0]?"":"collapsed")+" svelte-1u7vg8a"))&&C(e,"class",a),m&&m.p&&(!p||b&4)&&dt(m,y,v,v[2],p?gt(y,v[2],b,Ni):mt(v[2]),jn)},i(v){p||(R(h,v),R(d,v),R(m,v),p=!0)},o(v){A(h,v),A(d,v),A(m,v),p=!1},d(v){v&&E(e),h&&h.d(v),d&&d.d(v),v&&E(l),v&&E(u),m&&m.d(v),_=!1,c()}}}function ji(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class qi extends Z{constructor(e){super(),Q(this,e,ji,Di,K,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Gi(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ke=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Yi(r,e){return r>e?1:r<e?-1:0}function Ue(r,e,t){for(var n=new Ke(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function nn(r,e,t,n){var i=new Ke(r,e);if(t===null)return i.left=i.right=null,i;t=Ue(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Yn(r,e,t){var n=null,i=null;if(e){e=Ue(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Hi(r,e,t){return e===null?r:(r===null||(e=Ue(r.key,e,t),e.left=r),e)}function fn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&fn(r.left,o,!1,n,i),r.right&&fn(r.right,o,!0,n,i)}}var Ln=function(){function r(e){e===void 0&&(e=Yi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=nn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ke(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ue(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ue(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ue(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ue(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ue(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Ji(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&hn(e,t,0,i-1,o),this._root===null)this._root=cn(e,t,0,i),this._size=i;else{var s=Xi(this.toList(),Ui(e,t),o);i=this._size+i,this._root=pn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return fn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Yn(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=nn(t,n,a,i):s=nn(t,n,s,i),this._root=Hi(s,a,i)},r.prototype.split=function(e){return Yn(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Gi(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function cn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ke(s,a);return l.left=cn(r,e,t,o),l.right=cn(r,e,o+1,n),l}return null}function Ui(r,e){for(var t=new Ke(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ke(r[i],e[i]);return n.next=null,t.next}function Ji(r){for(var e=r,t=[],n=!1,i=new Ke(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function pn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=pn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=pn(r,i+1,t),s}return null}function Xi(r,e,t){for(var n=new Ke(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function hn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}hn(r,e,t,a,i),hn(r,e,a+1,n,i)}}function xe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Hn(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Se(r,e,t){return e&&Hn(r.prototype,e),t&&Hn(r,t),r}var ct=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},dn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Xe=Number.EPSILON;Xe===void 0&&(Xe=Math.pow(2,-52));var zi=Xe*Xe,mn=function(e,t){if(-Xe<e&&e<Xe&&-Xe<t&&t<Xe)return 0;var n=e-t;return n*n<zi*e*t?0:e<t?-1:1},Wi=function(){function r(){xe(this,r),this.reset()}return Se(r,[{key:"reset",value:function(){this.xRounder=new Un,this.yRounder=new Un}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Un=function(){function r(){xe(this,r),this.tree=new Ln,this.round(0)}return Se(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&mn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&mn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),kt=new Wi,_t=function(e,t){return e.x*t.y-e.y*t.x},Ar=function(e,t){return e.x*t.x+e.y*t.y},Jn=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=_t(i,o);return mn(s,0)},jt=function(e){return Math.sqrt(Ar(e,e))},Vi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return _t(o,i)/jt(o)/jt(i)},Ki=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Ar(o,i)/jt(o)/jt(i)},Xn=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},zn=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},Zi=function(e,t,n,i){if(t.x===0)return zn(n,i,e.x);if(i.x===0)return zn(e,t,n.x);if(t.y===0)return Xn(n,i,e.y);if(i.y===0)return Xn(e,t,n.y);var o=_t(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=_t(s,t)/o,l=_t(s,i)/o,u=e.x+l*t.x,p=n.x+a*i.x,_=e.y+l*t.y,c=n.y+a*i.y,f=(u+p)/2,h=(_+c)/2;return{x:f,y:h}},Ie=function(){Se(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:qt.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){xe(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Se(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:Vi(n.point,t.point,l.point),cosine:Ki(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,p=l.cosine,_=i.get(a),c=_.sine,f=_.cosine;return u>=0&&c>=0?p<f?1:p>f?-1:0:u<0&&c<0?p<f?-1:p>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),Qi=0,qt=function(){Se(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,_=n.rightSE.point.y;if(i<o){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<_)return-1;if(l>u&&l>_)return 1;var h=n.comparePoint(t.leftSE.point);if(h!==0)return h;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var d=n.comparePoint(t.rightSE.point);if(d!==0)return d}if(s>a){var y=t.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(s!==a){var m=p-l,v=s-i,b=_-u,M=a-o;if(m>v&&b<M)return 1;if(m<v&&b>M)return-1}return s>a?1:s<a||p<_?-1:p>_?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){xe(this,r),this.id=++Qi,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Se(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=dn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=ct(n,l)&&this.comparePoint(l)===0,_=ct(i,s)&&t.comparePoint(s)===0,c=ct(n,u)&&this.comparePoint(u)===0,f=ct(i,a)&&t.comparePoint(a)===0;if(_&&p)return f&&!c?a:!f&&c?u:null;if(_)return c&&s.x===u.x&&s.y===u.y?null:s;if(p)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var h=Zi(s,this.vector(),l,t.vector());return h===null||!ct(o,h)?null:kt.round(h.x,h.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Ie(t,!0),s=new Ie(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Ie.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ie.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var p=i.rings[l],_=i.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(_)):n.windings[c]+=_}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),i.push(u)):i[p]+=u}for(var _=[],c=[],f=0,h=n.length;f<h;f++)if(i[f]!==0){var g=n[f],d=g.poly;if(c.indexOf(d)===-1)if(g.isExterior)_.push(d);else{c.indexOf(d)===-1&&c.push(d);var y=_.indexOf(g.poly);y!==-1&&_.splice(y,1)}}for(var m=0,v=_.length;m<v;m++){var b=_[m].multiPoly;o.indexOf(b)===-1&&o.push(b)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Fe.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Fe.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(_){return _.length===1&&_[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Fe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Ie.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Ie(o,!0),p=new Ie(s,!1);return new r(u,p,[i],[a])}}]),r}(),Wn=function(){function r(e,t,n){if(xe(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=kt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=kt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(qt.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(qt.fromRing(o,i,this))}return Se(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),eo=function(){function r(e,t){if(xe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Wn(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Wn(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Se(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Vn=function(){function r(e,t){if(xe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new eo(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Se(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),to=function(){Se(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],_=l.point,c=[];a=l,l=u,p.push(l),l.point!==_;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var h=p[0].point,g=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var d=null,y=0,m=c.length;y<m;y++)if(c[y].point===l.point){d=y;break}if(d!==null){var v=c.splice(d)[0],b=p.splice(v.index);b.unshift(b[0].otherSE),n.push(new r(b.reverse()));continue}c.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){xe(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Se(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Jn(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Jn(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,_=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],h=_;h!=c;h+=p)f.push([n[h].x,n[h].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Ie.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Kn=function(){function r(e){xe(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Se(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),no=function(){function r(e){xe(this,r),this.rings=e,this.polys=this._composePolys(e)}return Se(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Kn(s));else{var a=s.enclosingRing();a.poly||n.push(new Kn(a)),a.poly.addInterior(s)}}return n}}]),r}(),ro=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qt.compare;xe(this,r),this.queue=e,this.tree=new Ln(t),this.segments=[]}return Se(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var _=l.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(p=_),!l.isAnEndpoint(_)))for(var c=this._splitSafely(l,_),f=0,h=c.length;f<h;f++)i.push(c[f])}var g=null;if(u){var d=u.getIntersection(n);if(d!==null&&(n.isAnEndpoint(d)||(g=d),!u.isAnEndpoint(d)))for(var y=this._splitSafely(u,d),m=0,v=y.length;m<v;m++)i.push(y[m])}if(p!==null||g!==null){var b=null;if(p===null)b=g;else if(g===null)b=p;else{var M=Ie.comparePoints(p,g);b=M<=0?p:g}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var O=n.split(b),x=0,L=O.length;x<L;x++)i.push(O[x])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var F=l.getIntersection(u);if(F!==null){if(!l.isAnEndpoint(F))for(var I=this._splitSafely(l,F),N=0,W=I.length;N<W;N++)i.push(I[N]);if(!u.isAnEndpoint(F))for(var P=this._splitSafely(u,F),D=0,oe=P.length;D<oe;D++)i.push(P[D])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Zn=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,io=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,oo=function(){function r(){xe(this,r)}return Se(r,[{key:"run",value:function(t,n,i){Fe.type=t,kt.reset();for(var o=[new Vn(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Vn(i[s],!1));if(Fe.numMultiPolys=o.length,Fe.type==="difference")for(var l=o[0],u=1;u<o.length;)dn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Fe.type==="intersection"){for(var p=0,_=o.length;p<_;p++)for(var c=o[p],f=p+1,h=o.length;f<h;f++)if(dn(c.bbox,o[f].bbox)===null)return[]}for(var g=new Ln(Ie.compare),d=0,y=o.length;d<y;d++)for(var m=o[d].getSweepEvents(),v=0,b=m.length;v<b;v++)if(g.insert(m[v]),g.size>Zn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new ro(g),O=g.size,x=g.pop();x;){var L=x.key;if(g.size===O){var F=L.segment;throw new Error("Unable to pop() ".concat(L.isLeft?"left":"right"," SweepEvent ")+"[".concat(L.point.x,", ").concat(L.point.y,"] from segment #").concat(F.id," ")+"[".concat(F.leftSE.point.x,", ").concat(F.leftSE.point.y,"] -> ")+"[".concat(F.rightSE.point.x,", ").concat(F.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Zn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>io)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var I=M.process(L),N=0,W=I.length;N<W;N++){var P=I[N];P.consumedBy===void 0&&g.insert(P)}O=g.size,x=g.pop()}kt.reset();var D=to.factory(M.segments),oe=new no(D);return oe.getGeom()}}]),r}(),Fe=new oo,so=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Fe.run("union",e,n)},lo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Fe.run("intersection",e,n)},ao=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Fe.run("xor",e,n)},uo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Fe.run("difference",e,n)},Rt={union:so,intersection:lo,xor:ao,difference:uo};function fo(r,e){var t=po(e),n=null;return r.type==="FeatureCollection"?n=co(r):n=Pr(Rt.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function co(r){var e=r.features.length===2?Rt.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Rt.union.apply(Rt,r.features.map(function(t){return t.geometry.coordinates}));return Pr(e)}function Pr(r){return ci(r)}function po(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return pi(t)}function ho(r,e,t){let n;ie(r,je,s=>t(1,n=s));let{boundaryGeojson:i}=e;return hi("setCamera")&&n.fitBounds(En(i),{padding:20,animate:!1}),Ze(n,"boundary",{type:"geojson",data:fo(i)}),be(n,{id:"boundary",source:"boundary",...zt("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class mo extends Z{constructor(e){super(),Q(this,e,ho,null,K,{boundaryGeojson:0})}}function Qn(r){let e,t=er(r[3])+"",n;return{c(){e=X("Length: "),n=X(t)},m(i,o){S(i,e,o),S(i,n,o)},p(i,o){o&8&&t!==(t=er(i[3])+"")&&He(n,t)},d(i){i&&E(e),i&&E(n)}}}function go(r){let e,t,n,i,o,s,a,l,u,p,_,c,f,h,g,d,y,m,v,b,M,O,x,L,F,I,N,W,P,D,oe,fe,j,se,Ee,Ae,pe,ce,Pe,re=r[3]&&Qn(r);return{c(){e=k("label"),t=X("Name:"),n=k("br"),i=T(),o=k("input"),s=T(),a=k("br"),l=T(),u=k("br"),p=T(),_=k("label"),c=k("input"),f=X(`
  Area`),h=T(),g=k("label"),d=k("input"),y=X(`
  Route`),m=T(),v=k("label"),b=k("input"),M=X(`
  Crossing`),O=T(),x=k("label"),L=k("input"),F=X(`
  Other`),I=T(),N=k("br"),W=T(),P=k("br"),D=T(),oe=k("label"),fe=X("Description:"),j=k("br"),se=T(),Ee=k("textarea"),Ae=T(),re&&re.c(),pe=_e(),C(o,"type","text"),ae(o,"width","100%"),C(c,"type","radio"),c.__value="area",c.value=c.__value,r[6][0].push(c),C(d,"type","radio"),d.__value="route",d.value=d.__value,r[6][0].push(d),C(b,"type","radio"),b.__value="crossing",b.value=b.__value,r[6][0].push(b),C(L,"type","radio"),L.__value="other",L.value=L.__value,r[6][0].push(L),ae(Ee,"width","100%"),C(Ee,"rows","5"),C(Ee,"class","svelte-15lna0i")},m($,V){S($,e,V),w(e,t),w(e,n),w(e,i),w(e,o),Re(o,r[0]),S($,s,V),S($,a,V),S($,l,V),S($,u,V),S($,p,V),S($,_,V),w(_,c),c.checked=c.__value===r[1],w(_,f),S($,h,V),S($,g,V),w(g,d),d.checked=d.__value===r[1],w(g,y),S($,m,V),S($,v,V),w(v,b),b.checked=b.__value===r[1],w(v,M),S($,O,V),S($,x,V),w(x,L),L.checked=L.__value===r[1],w(x,F),S($,I,V),S($,N,V),S($,W,V),S($,P,V),S($,D,V),S($,oe,V),w(oe,fe),w(oe,j),w(oe,se),w(oe,Ee),Re(Ee,r[2]),S($,Ae,V),re&&re.m($,V),S($,pe,V),ce||(Pe=[B(o,"input",r[4]),B(c,"change",r[5]),B(d,"change",r[7]),B(b,"change",r[8]),B(L,"change",r[9]),B(Ee,"input",r[10])],ce=!0)},p($,[V]){V&1&&o.value!==$[0]&&Re(o,$[0]),V&2&&(c.checked=c.__value===$[1]),V&2&&(d.checked=d.__value===$[1]),V&2&&(b.checked=b.__value===$[1]),V&2&&(L.checked=L.__value===$[1]),V&4&&Re(Ee,$[2]),$[3]?re?re.p($,V):(re=Qn($),re.c(),re.m(pe.parentNode,pe)):re&&(re.d(1),re=null)},i:G,o:G,d($){$&&E(e),$&&E(s),$&&E(a),$&&E(l),$&&E(u),$&&E(p),$&&E(_),r[6][0].splice(r[6][0].indexOf(c),1),$&&E(h),$&&E(g),r[6][0].splice(r[6][0].indexOf(d),1),$&&E(m),$&&E(v),r[6][0].splice(r[6][0].indexOf(b),1),$&&E(O),$&&E(x),r[6][0].splice(r[6][0].indexOf(L),1),$&&E(I),$&&E(N),$&&E(W),$&&E(P),$&&E(D),$&&E(oe),$&&E(Ae),re&&re.d($),$&&E(pe),ce=!1,Te(Pe)}}}function er(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function _o(r,e,t){let{name:n}=e,{intervention_type:i}=e,{description:o}=e,{length_meters:s}=e;const a=[[]];function l(){n=this.value,t(0,n)}function u(){i=this.__value,t(1,i)}function p(){i=this.__value,t(1,i)}function _(){i=this.__value,t(1,i)}function c(){i=this.__value,t(1,i)}function f(){o=this.value,t(2,o)}return r.$$set=h=>{"name"in h&&t(0,n=h.name),"intervention_type"in h&&t(1,i=h.intervention_type),"description"in h&&t(2,o=h.description),"length_meters"in h&&t(3,s=h.length_meters)},[n,i,o,s,l,u,a,p,_,c,f]}class vo extends Z{constructor(e){super(),Q(this,e,_o,go,K,{name:0,intervention_type:1,description:2,length_meters:3})}}const yo="Intervention",bo=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],wo={name:yo,oneOf:bo};function ko(r){const e=r-1;return e*e*e+1}function Gt(r,{delay:e=0,duration:t=400,easing:n=ko}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),p=parseFloat(i.marginBottom),_=parseFloat(i.borderTopWidth),c=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*p}px;border-top-width: ${f*_}px;border-bottom-width: ${f*c}px;`}}function $r(r){return"members"in r}function Fr(r){return"oneOf"in r}function Nr(r){return typeof r=="string"}function Ir(r){return typeof r=="object"&&"value"in r}function So(r){return"type"in r&&r.type=="number"}function Br(r){return"type"in r&&r.type=="one-liner"}function Dr(r){return"type"in r&&r.type=="textbox"}function jr(r){return"type"in r&&r.type=="checkbox"}function tr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function nr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function rr(r){let e,t=r[1].description+"",n;return{c(){e=k("p"),n=X(t),C(e,"class","svelte-1b72l00")},m(i,o){S(i,e,o),w(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&He(n,t)},d(i){i&&E(e)}}}function Eo(r){let e,t,n;return{c(){e=k("input"),C(e,"type","checkbox")},m(i,o){S(i,e,o),e.checked=r[0],t||(n=B(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:G,o:G,d(i){i&&E(e),t=!1,n()}}}function Mo(r){let e,t,n;return{c(){e=k("textarea"),ae(e,"width","100%"),C(e,"rows","5"),C(e,"class","svelte-1b72l00")},m(i,o){S(i,e,o),Re(e,r[0]),t||(n=B(e,"input",r[13]),t=!0)},p(i,o){o&1&&Re(e,i[0])},i:G,o:G,d(i){i&&E(e),t=!1,n()}}}function Oo(r){let e,t,n;return{c(){e=k("input"),C(e,"type","text"),ae(e,"width","100%")},m(i,o){S(i,e,o),Re(e,r[0]),t||(n=B(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Re(e,i[0])},i:G,o:G,d(i){i&&E(e),t=!1,n()}}}function Lo(r){let e,t,n;return{c(){e=k("input"),C(e,"type","number")},m(i,o){S(i,e,o),Re(e,r[0]),t||(n=B(e,"input",r[11]),t=!0)},p(i,o){o&1&&Tr(e.value)!==i[0]&&Re(e,i[0])},i:G,o:G,d(i){i&&E(e),t=!1,n()}}}function Co(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=or(tr(r,n,s));const o=s=>A(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=_e()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);S(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=tr(s,n,l);i[l]?(i[l].p(u,a),R(i[l],1)):(i[l]=or(u),i[l].c(),R(i[l],1),i[l].m(e.parentNode,e))}for(ve(),l=n.length;l<i.length;l+=1)o(l);ye()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)R(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)A(i[a]);t=!1},d(s){Rr(i,s),s&&E(e)}}}function To(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=sr(nr(r,n,s));const o=s=>A(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=_e()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);S(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=nr(s,n,l);i[l]?(i[l].p(u,a),R(i[l],1)):(i[l]=sr(u),i[l].c(),R(i[l],1),i[l].m(e.parentNode,e))}for(ve(),l=n.length;l<i.length;l+=1)o(l);ye()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)R(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)A(i[a]);t=!1},d(s){Rr(i,s),s&&E(e)}}}function Ro(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,p,_,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&ir(r);return{c(){e=k("label"),t=k("input"),i=T(),s=X(o),a=k("br"),l=T(),f&&f.c(),u=_e(),C(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(h,g){S(h,e,g),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),S(h,l,g),f&&f.m(h,g),S(h,u,g),p=!0,_||(c=[B(t,"change",r[9]),B(t,"change",r[4])],_=!0)},p(h,g){(!p||g&2&&n!==(n=h[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),(!p||g&2)&&o!==(o=h[15].name+"")&&He(s,o),h[2]==h[15].name&&typeof h[0]=="object"?f?(f.p(h,g),g&7&&R(f,1)):(f=ir(h),f.c(),R(f,1),f.m(u.parentNode,u)):f&&(ve(),A(f,1,1,()=>{f=null}),ye())},i(h){p||(R(f),p=!0)},o(h){A(f),p=!1},d(h){h&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),h&&E(l),f&&f.d(h),h&&E(u),_=!1,Te(c)}}}function xo(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,p;function _(h,g){return h[15].description?$o:Po}let c=_(r),f=c(r);return{c(){e=k("label"),t=k("input"),i=T(),s=X(o),a=T(),f.c(),l=T(),C(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(h,g){S(h,e,g),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),f.m(e,null),w(e,l),u||(p=[B(t,"change",r[8]),B(t,"change",r[3])],u=!0)},p(h,g){g&2&&n!==(n=h[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),g&2&&o!==(o=h[15].value+"")&&He(s,o),c===(c=_(h))&&f?f.p(h,g):(f.d(1),f=c(h),f&&(f.c(),f.m(e,l)))},i:G,o:G,d(h){h&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Te(p)}}}function Ao(r){let e,t,n,i,o=r[15]+"",s,a,l,u,p,_;return{c(){e=k("label"),t=k("input"),i=T(),s=X(o),a=T(),l=k("br"),u=T(),C(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){S(c,e,f),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),w(e,l),w(e,u),p||(_=[B(t,"change",r[6]),B(t,"change",r[3])],p=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&o!==(o=c[15]+"")&&He(s,o)},i:G,o:G,d(c){c&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,Te(_)}}}function ir(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Ot({props:l}),ne.push(()=>we(t,"value",a,r[0][r[15].name])),{c(){e=k("div"),Y(t.$$.fragment),i=T(),C(e,"class","svelte-1b72l00")},m(u,p){S(u,e,p),H(t,e,null),w(e,i),s=!0},p(u,p){r=u;const _={};p&2&&(_.spec=r[15]),!n&&p&3&&(n=!0,_.value=r[0][r[15].name],ke(()=>n=!1)),t.$set(_)},i(u){s||(R(t.$$.fragment,u),Wt(()=>{o||(o=Nt(e,Gt,{duration:500},!0)),o.run(1)}),s=!0)},o(u){A(t.$$.fragment,u),o||(o=Nt(e,Gt,{duration:500},!1)),o.run(0),s=!1},d(u){u&&E(e),U(t),u&&o&&o.end()}}}function Po(r){let e;return{c(){e=k("br")},m(t,n){S(t,e,n)},p:G,d(t){t&&E(e)}}}function $o(r){let e,t,n=r[15].description+"",i,o;return{c(){e=k("p"),t=X("("),i=X(n),o=X(")"),C(e,"class","svelte-1b72l00")},m(s,a){S(s,e,a),w(e,t),w(e,i),w(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&He(i,n)},d(s){s&&E(e)}}}function or(r){let e,t,n,i,o,s;const a=[Ao,xo,Ro],l=[];function u(p,_){return _&2&&(e=null),_&2&&(t=null),e==null&&(e=!!Nr(p[15])),e?0:(t==null&&(t=!!Ir(p[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=_e()},m(p,_){l[n].m(p,_),S(p,o,_),s=!0},p(p,_){let c=n;n=u(p,_),n===c?l[n].p(p,_):(ve(),A(l[c],1,1,()=>{l[c]=null}),ye(),i=l[n],i?i.p(p,_):(i=l[n]=a[n](p),i.c()),R(i,1),i.m(o.parentNode,o))},i(p){s||(R(i),s=!0)},o(p){A(i),s=!1},d(p){l[n].d(p),p&&E(o)}}}function sr(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function p(c){r[5](c,r[15])}let _={spec:r[15]};return r[0][r[15].name]!==void 0&&(_.value=r[0][r[15].name]),s=new Ot({props:_}),ne.push(()=>we(s,"value",p,r[0][r[15].name])),{c(){e=k("div"),t=k("h3"),i=X(n),o=T(),Y(s.$$.fragment),l=T(),C(e,"class","svelte-1b72l00")},m(c,f){S(c,e,f),w(e,t),w(t,i),w(e,o),H(s,e,null),w(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&He(i,n);const h={};f&2&&(h.spec=r[15]),!a&&f&3&&(a=!0,h.value=r[0][r[15].name],ke(()=>a=!1)),s.$set(h)},i(c){u||(R(s.$$.fragment,c),u=!0)},o(c){A(s.$$.fragment,c),u=!1},d(c){c&&E(e),U(s)}}}function Fo(r){let e,t,n,i,o,s,a,l,u,p,_,c=r[1].description&&rr(r);const f=[To,Co,Lo,Oo,Mo,Eo],h=[];function g(d,y){return y&2&&(t=null),y&2&&(n=null),y&2&&(i=null),y&2&&(o=null),y&2&&(s=null),y&2&&(a=null),t==null&&(t=!!$r(d[1])),t?0:(n==null&&(n=!!Fr(d[1])),n?1:(i==null&&(i=!!So(d[1])),i?2:(o==null&&(o=!!Br(d[1])),o?3:(s==null&&(s=!!Dr(d[1])),s?4:(a==null&&(a=!!jr(d[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=h[l]=f[l](r)),{c(){c&&c.c(),e=T(),u&&u.c(),p=_e()},m(d,y){c&&c.m(d,y),S(d,e,y),~l&&h[l].m(d,y),S(d,p,y),_=!0},p(d,[y]){d[1].description?c?c.p(d,y):(c=rr(d),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let m=l;l=g(d,y),l===m?~l&&h[l].p(d,y):(u&&(ve(),A(h[m],1,1,()=>{h[m]=null}),ye()),~l?(u=h[l],u?u.p(d,y):(u=h[l]=f[l](d),u.c()),R(u,1),u.m(p.parentNode,p)):u=null)},i(d){_||(R(u),_=!0)},o(d){A(u),_=!1},d(d){c&&c.d(d),d&&E(e),~l&&h[l].d(d),d&&E(p)}}}function No(r,e,t){var m,v,b;let{spec:n}=e,{value:i}=e,o="";if($r(n)){i||(i={});for(let M of n.members)Br(M)||Dr(M)?i[m=M.name]||(i[m]=""):jr(M)?i[v=M.name]||(i[v]=!1):i[b=M.name]||(i[b]={})}else Fr(n)&&(i||(i={}),Nr(i)?o=i:Ir(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,O){r.$$.not_equal(i[O.name],M)&&(i[O.name]=M,t(0,i))}function p(){o=this.__value,t(2,o)}function _(){o=this.__value,t(2,o)}function c(){o=this.__value,t(2,o)}function f(M,O){r.$$.not_equal(i[O.name],M)&&(i[O.name]=M,t(0,i))}function h(){i=Tr(this.value),t(0,i)}function g(){i=this.value,t(0,i)}function d(){i=this.value,t(0,i)}function y(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,p,l,_,c,f,h,g,d,y]}class Ot extends Z{constructor(e){super(),Q(this,e,No,Fo,K,{spec:1,value:0})}}function Io(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Ot({props:o}),ne.push(()=>we(e,"value",i,r[0].v2)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,ke(()=>t=!1)),e.$set(l)},i(s){n||(R(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Bo(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=wo;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Do extends Z{constructor(e){super(),Q(this,e,Bo,Io,K,{props:0})}}const jo="Planning",qo=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],Go={name:jo,members:qo};function Yo(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Ot({props:o}),ne.push(()=>we(e,"value",i,r[0].planning)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,ke(()=>t=!1)),e.$set(l)},i(s){n||(R(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Ho(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=Go;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Uo extends Z{constructor(e){super(),Q(this,e,Ho,Yo,K,{props:0})}}const Jo="CriticalIssue",Xo=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],zo={name:Jo,members:Xo};function Wo(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Ot({props:o}),ne.push(()=>we(e,"value",i,r[0].criticals)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,ke(()=>t=!1)),e.$set(l)},i(s){n||(R(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Vo(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=zo;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Ko extends Z{constructor(e){super(),Q(this,e,Vo,Wo,K,{props:0})}}function lr(r){let e,t,n,i,o;const s=r[10].default,a=ht(s,r,r[9],null);return{c(){e=k("div"),a&&a.c(),ae(e,"border","solid 1px black"),ae(e,"padding","10px")},m(l,u){S(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=B(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&dt(a,s,l,l[9],n?gt(s,l[9],u,null):mt(l[9]),null)},i(l){n||(R(a,l),Wt(()=>{t||(t=Nt(e,Gt,{duration:100},!0)),t.run(1)}),n=!0)},o(l){A(a,l),t||(t=Nt(e,Gt,{duration:100},!1)),t.run(0),n=!1},d(l){l&&E(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Zo(r){let e,t,n,i,o,s,a,l,u,p,_=r[4]&&lr(r);return{c(){e=k("button"),t=Fn("svg"),n=Fn("path"),i=T(),o=X(r[1]),s=T(),_&&_.c(),a=_e(),C(n,"d","M9 5l7 7-7 7"),C(t,"style","tran"),C(t,"width","20"),C(t,"height","20"),C(t,"fill","none"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"stroke-width","2"),C(t,"viewBox","0 0 24 24"),C(t,"stroke","currentColor"),C(t,"class","svelte-t7fpgu"),C(e,"aria-expanded",r[4]),C(e,"class","svelte-t7fpgu"),Nn(e,"underlined",r[3])},m(c,f){S(c,e,f),w(e,t),w(t,n),w(e,i),w(e,o),S(c,s,f),_&&_.m(c,f),S(c,a,f),l=!0,u||(p=[B(e,"click",r[5]),B(e,"mouseenter",r[11]),B(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&He(o,c[1]),(!l||f&16)&&C(e,"aria-expanded",c[4]),(!l||f&8)&&Nn(e,"underlined",c[3]),c[4]?_?(_.p(c,f),f&16&&R(_,1)):(_=lr(c),_.c(),R(_,1),_.m(a.parentNode,a)):_&&(ve(),A(_,1,1,()=>{_=null}),ye())},i(c){l||(R(_),l=!0)},o(c){A(_),l=!1},d(c){c&&E(e),c&&E(s),_&&_.d(c),c&&E(a),u=!1,Te(p)}}}function Qo(r,e,t){let n,i,o,s;ie(r,Ye,m=>t(7,o=m)),ie(r,Ce,m=>t(8,s=m));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const _=()=>{Ce.update(m=>m==u?null:u),s==u&&(un.set(null),un.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const h=()=>Dt.set(u),g=()=>Dt.set(null);function d(m){ne[m?"unshift":"push"](()=>{c=m,t(2,c)})}const y=()=>f();return r.$$set=m=>{"id"in m&&t(0,u=m.id),"label"in m&&t(1,p=m.label),"$$scope"in m&&t(9,l=m.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,p,c,i,n,_,f,o,s,l,a,h,g,d,y]}class es extends Z{constructor(e){super(),Q(this,e,Qo,Zo,K,{id:0,label:1})}}function ar(r,e,t){const n=r.slice();return n[13]=e[t],n[14]=e,n[15]=t,n}function ts(r){let e,t,n;function i(s){r[9](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Ko({props:o}),ne.push(()=>we(e,"props",i,r[13].properties)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,ke(()=>t=!1)),e.$set(l)},i(s){n||(R(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function ns(r){let e,t,n;function i(s){r[8](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Uo({props:o}),ne.push(()=>we(e,"props",i,r[13].properties)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,ke(()=>t=!1)),e.$set(l)},i(s){n||(R(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function rs(r){let e,t,n;function i(s){r[7](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Do({props:o}),ne.push(()=>we(e,"props",i,r[13].properties)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,ke(()=>t=!1)),e.$set(l)},i(s){n||(R(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function is(r){let e,t,n,i,o;function s(p){r[4](p,r[13])}function a(p){r[5](p,r[13])}function l(p){r[6](p,r[13])}let u={length_meters:r[13].properties.length_meters};return r[13].properties.name!==void 0&&(u.name=r[13].properties.name),r[13].properties.intervention_type!==void 0&&(u.intervention_type=r[13].properties.intervention_type),r[13].properties.description!==void 0&&(u.description=r[13].properties.description),e=new vo({props:u}),ne.push(()=>we(e,"name",s,r[13].properties.name)),ne.push(()=>we(e,"intervention_type",a,r[13].properties.intervention_type)),ne.push(()=>we(e,"description",l,r[13].properties.description)),{c(){Y(e.$$.fragment)},m(p,_){H(e,p,_),o=!0},p(p,_){r=p;const c={};_&2&&(c.length_meters=r[13].properties.length_meters),!t&&_&2&&(t=!0,c.name=r[13].properties.name,ke(()=>t=!1)),!n&&_&2&&(n=!0,c.intervention_type=r[13].properties.intervention_type,ke(()=>n=!1)),!i&&_&2&&(i=!0,c.description=r[13].properties.description,ke(()=>i=!1)),e.$set(c)},i(p){o||(R(e.$$.fragment,p),o=!0)},o(p){A(e.$$.fragment,p),o=!1},d(p){U(e,p)}}}function os(r){let e,t,n,i,o,s,a,l,u,p,_,c,f,h,g;const d=[is,rs,ns,ts],y=[];function m(b,M){return b[0]=="v1"?0:b[0]=="v2"?1:b[0]=="planning"?2:b[0]=="criticals"?3:-1}~(e=m(r))&&(t=y[e]=d[e](r));function v(){return r[10](r[13])}return{c(){t&&t.c(),n=T(),i=k("br"),o=T(),s=k("br"),a=T(),l=k("div"),u=k("button"),u.textContent="Delete",p=T(),_=k("button"),_.textContent="Save",c=T(),C(u,"type","button"),C(_,"type","button"),ae(l,"display","flex"),ae(l,"justify-content","space-between")},m(b,M){~e&&y[e].m(b,M),S(b,n,M),S(b,i,M),S(b,o,M),S(b,s,M),S(b,a,M),S(b,l,M),w(l,u),w(l,p),w(l,_),S(b,c,M),f=!0,h||(g=[B(u,"click",v),B(_,"click",r[11])],h=!0)},p(b,M){r=b;let O=e;e=m(r),e===O?~e&&y[e].p(r,M):(t&&(ve(),A(y[O],1,1,()=>{y[O]=null}),ye()),~e?(t=y[e],t?t.p(r,M):(t=y[e]=d[e](r),t.c()),R(t,1),t.m(n.parentNode,n)):t=null)},i(b){f||(R(t),f=!0)},o(b){A(t),f=!1},d(b){~e&&y[e].d(b),b&&E(n),b&&E(i),b&&E(o),b&&E(s),b&&E(a),b&&E(l),b&&E(c),h=!1,Te(g)}}}function ur(r,e){let t,n,i;return n=new es({props:{id:e[13].id,label:e[15]+1+") "+e[2](e[13]),$$slots:{default:[os]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=_e(),Y(n.$$.fragment),this.first=t},m(o,s){S(o,t,s),H(n,o,s),i=!0},p(o,s){e=o;const a={};s&2&&(a.id=e[13].id),s&2&&(a.label=e[15]+1+") "+e[2](e[13])),s&65539&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||(R(n.$$.fragment,o),i=!0)},o(o){A(n.$$.fragment,o),i=!1},d(o){o&&E(t),U(n,o)}}}function ss(r){let e=[],t=new Map,n,i,o,s,a=r[1].features;const l=u=>u[13].id;for(let u=0;u<a.length;u+=1){let p=ar(r,a,u),_=l(p);t.set(_,e[u]=ur(_,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=_e()},m(u,p){for(let _=0;_<e.length;_+=1)e[_].m(u,p);S(u,n,p),i=!0,o||(s=B(window,"keydown",r[3]),o=!0)},p(u,[p]){p&7&&(a=u[1].features,ve(),e=di(e,p,l,1,u,a,t,n.parentNode,mi,ur,n,ar),ye())},i(u){if(!i){for(let p=0;p<a.length;p+=1)R(e[p]);i=!0}},o(u){for(let p=0;p<e.length;p+=1)A(e[p]);i=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&E(n),o=!1,s()}}}function ls(r,e,t){let n,i;ie(r,Ce,d=>t(12,n=d)),ie(r,ee,d=>t(1,i=d));let{schema:o}=e;function s(d){var m,v,b,M,O;if(o=="planning")return((m=d.properties.planning)==null?void 0:m.name)||"Untitled polygon";if(o=="v2")return((b=(v=d.properties.v2)==null?void 0:v.Route)==null?void 0:b.name)||((O=(M=d.properties.v2)==null?void 0:M.Crossing)==null?void 0:O.name)||"Untitled intervention";if(d.properties.name)return d.properties.name;var y=d.properties.intervention_type;return y=="other"&&(d.geometry.type=="Point"?y="point":d.geometry.type=="LineString"?y="line":y="polygon"),`Untitled ${y}`}function a(d){if(d.key=="Delete"){const y=d.target.tagName;if(y=="INPUT"||y=="TEXTAREA")return;d.preventDefault();const m=n;m&&Bn(m)}}function l(d,y){r.$$.not_equal(y.properties.name,d)&&(y.properties.name=d,ee.set(i))}function u(d,y){r.$$.not_equal(y.properties.intervention_type,d)&&(y.properties.intervention_type=d,ee.set(i))}function p(d,y){r.$$.not_equal(y.properties.description,d)&&(y.properties.description=d,ee.set(i))}function _(d,y){r.$$.not_equal(y.properties,d)&&(y.properties=d,ee.set(i))}function c(d,y){r.$$.not_equal(y.properties,d)&&(y.properties=d,ee.set(i))}function f(d,y){r.$$.not_equal(y.properties,d)&&(y.properties=d,ee.set(i))}const h=d=>Bn(d.id),g=()=>Ce.set(null);return r.$$set=d=>{"schema"in d&&t(0,o=d.schema)},[o,i,s,a,l,u,p,_,c,f,h,g]}class as extends Z{constructor(e){super(),Q(this,e,ls,ss,K,{schema:0})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Be(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function gn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Je(r,e,t){t===void 0&&(t={});var n=Ve(r),i=Ve(e),o=$e(i[1]-n[1]),s=$e(i[0]-n[0]),a=$e(n[1]),l=$e(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return gi(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function xt(r,e){return e===void 0&&(e={}),_i(r,function(t,n){var i=n.geometry.coordinates;return t+Je(i[0],i[1],e)},0)}function us(r){let e,t,n,i,o,s,a,l,u,p,_,c,f,h,g,d,y,m,v,b=r[0].features.length+"",M,O,x,L,F,I,N,W;return{c(){e=k("div"),t=k("label"),n=X(`Scheme name:
    `),i=k("input"),o=T(),s=k("br"),a=T(),l=k("div"),u=k("label"),p=k("input"),_=T(),c=k("button"),c.textContent="Load from GeoJSON",f=T(),h=k("button"),h.textContent="Export to GeoJSON",g=T(),d=k("br"),y=T(),m=k("div"),v=k("span"),M=X(b),O=X(" interventions"),x=T(),L=k("button"),F=X("Clear all"),C(i,"type","text"),C(p,"type","file"),C(p,"id","load_geojson"),C(p,"class","svelte-lhyd1e"),C(c,"type","button"),C(h,"type","button"),C(h,"class","align-right svelte-lhyd1e"),C(L,"type","button"),C(L,"class","align-right svelte-lhyd1e"),L.disabled=I=r[0].features.length==0},m(P,D){S(P,e,D),w(e,t),w(t,n),w(t,i),Re(i,r[0].scheme_name),S(P,o,D),S(P,s,D),S(P,a,D),S(P,l,D),w(l,u),w(u,p),w(u,_),w(u,c),w(l,f),w(l,h),S(P,g,D),S(P,d,D),S(P,y,D),S(P,m,D),w(m,v),w(v,M),w(v,O),w(m,x),w(m,L),w(L,F),N||(W=[B(i,"input",r[7]),B(p,"change",r[3]),B(c,"click",cs),B(h,"click",r[2]),B(L,"click",r[1])],N=!0)},p(P,[D]){D&1&&i.value!==P[0].scheme_name&&Re(i,P[0].scheme_name),D&1&&b!==(b=P[0].features.length+"")&&He(M,b),D&1&&I!==(I=P[0].features.length==0)&&(L.disabled=I)},i:G,o:G,d(P){P&&E(e),P&&E(o),P&&E(s),P&&E(a),P&&E(l),P&&E(g),P&&E(d),P&&E(y),P&&E(m),N=!1,Te(W)}}}function fs(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function cs(){document.getElementById("load_geojson").click()}function ps(r,e,t){let n;ie(r,ee,h=>t(0,n=h));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=window.localStorage.getItem(s);if(a)try{ee.set(c(JSON.parse(a)))}catch(h){console.log(`Failed to load from local storage: ${h}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&ee.update(h=>(delete h.scheme_name,h.features=[],h))}function u(){const h=JSON.parse(JSON.stringify(n));for(let g of h.features)delete g.properties.hide_while_editing;return h}function p(){let h=u();var g=s;h.authority=i,h.origin="atip-v1",h.scheme_name&&(g+="_"+h.scheme_name),g+=".txt",fs(g,JSON.stringify(h,null,"  "))}function _(h){const g=new FileReader;g.onload=y=>{try{ee.set(c(JSON.parse(y.target.result)))}catch(m){window.alert(`Couldn't load scheme from a file: ${m}`)}};let d=h.target.files;g.readAsText(d[0])}function c(h){let g=1;for(let d of h.features)d.properties||(d.properties={name:"",description:"",intervention_type:"other"}),d.geometry.type=="LineString"&&!d.properties.length_meters&&(d.properties.length_meters=xt(d,{units:"kilometers"})*1e3),d.id=g++;return h}function f(){n.scheme_name=this.value,ee.set(n)}return r.$$set=h=>{"authorityName"in h&&t(4,i=h.authorityName),"schema"in h&&t(5,o=h.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,p,_,i,o,s,f]}class hs extends Z{constructor(e){super(),Q(this,e,ps,us,K,{authorityName:4,schema:5})}}const ds="/atip/assets/zoom_out_map-b2e1091a.svg";function ms(r){let e,t,n,i,o;return{c(){e=k("button"),t=k("img"),vi(t.src,n=ds)||C(t,"src",n),C(t,"alt","Zoom to show entire boundary"),C(e,"type","button"),C(e,"title","Zoom to show entire boundary"),C(e,"class","svelte-qzjsqo")},m(s,a){S(s,e,a),w(e,t),i||(o=B(e,"click",r[0]),i=!0)},p:G,i:G,o:G,d(s){s&&E(e),i=!1,o()}}}function gs(r,e,t){let n;ie(r,je,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(En(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class _s extends Z{constructor(e){super(),Q(this,e,gs,ms,K,{boundaryGeojson:1})}}function vs(r){let e,t,n,i,o,s,a;return{c(){e=k("div"),t=X(`Basemap:
  `),n=k("select"),i=k("option"),i.textContent="Streets",o=k("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&Wt(()=>r[2].call(n)),C(e,"class","svelte-1tbnm6i")},m(l,u){S(l,e,u),w(e,t),w(e,n),w(n,i),w(n,o),It(n,r[0]),s||(a=[B(n,"change",r[2]),B(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&It(n,l[0])},i:G,o:G,d(l){l&&E(e),s=!1,Te(a)}}}function ys(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=xr(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class bs extends Z{constructor(e){super(),Q(this,e,ys,vs,K,{style:0})}}const le={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Qt=10,Yt=10;function ws(r){let e,t,n,i,o,s,a,l,u,p,_,c,f,h,g;return{c(){e=k("li"),t=k("span"),n=X("Areas"),i=T(),o=k("li"),s=k("span"),a=X("Routes"),l=T(),u=k("li"),p=k("span"),_=X("Crossings"),c=T(),f=k("li"),h=k("span"),g=X("Other"),C(t,"class","svelte-p551i1"),ae(t,"background",le.area),C(s,"class","svelte-p551i1"),ae(s,"background",le.route),C(p,"class","svelte-p551i1"),ae(p,"background",le.crossing),C(h,"class","svelte-p551i1"),ae(h,"background",le.other)},m(d,y){S(d,e,y),w(e,t),w(e,n),S(d,i,y),S(d,o,y),w(o,s),w(o,a),S(d,l,y),S(d,u,y),w(u,p),w(u,_),S(d,c,y),S(d,f,y),w(f,h),w(f,g)},p:G,d(d){d&&E(e),d&&E(i),d&&E(o),d&&E(l),d&&E(u),d&&E(c),d&&E(f)}}}function ks(r){let e,t,n,i,o,s,a,l,u,p,_,c,f,h,g;return{c(){e=k("li"),t=k("span"),n=X("Preapp"),i=T(),o=k("li"),s=k("span"),a=X("Outline"),l=T(),u=k("li"),p=k("span"),_=X("Reserved matters"),c=T(),f=k("li"),h=k("span"),g=X("Local plan"),C(t,"class","svelte-p551i1"),ae(t,"background",le.preapp),C(s,"class","svelte-p551i1"),ae(s,"background",le.outline),C(p,"class","svelte-p551i1"),ae(p,"background",le["reserved matters"]),C(h,"class","svelte-p551i1"),ae(h,"background",le["local plan"])},m(d,y){S(d,e,y),w(e,t),w(e,n),S(d,i,y),S(d,o,y),w(o,s),w(o,a),S(d,l,y),S(d,u,y),w(u,p),w(u,_),S(d,c,y),S(d,f,y),w(f,h),w(f,g)},p:G,d(d){d&&E(e),d&&E(i),d&&E(o),d&&E(l),d&&E(u),d&&E(c),d&&E(f)}}}function Ss(r){let e,t,n,i;function o(l,u){return l[0]=="planning"?ks:ws}let s=o(r),a=s(r);return{c(){e=k("div"),t=k("h1"),t.textContent="Interventions",n=T(),i=k("ul"),a.c(),C(t,"class","svelte-p551i1"),C(e,"class","svelte-p551i1")},m(l,u){S(l,e,u),w(e,t),w(e,n),w(e,i),a.m(i,null)},p(l,[u]){s===(s=o(l))&&a?a.p(l,u):(a.d(1),a=s(l),a&&(a.c(),a.m(i,null)))},i:G,o:G,d(l){l&&E(e),a.d()}}}function Es(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class Ms extends Z{constructor(e){super(),Q(this,e,Es,Ss,K,{schema:0})}}let et="interventions";function Os(r,e,t){let n,i;ie(r,je,p=>t(1,n=p)),ie(r,ee,p=>t(2,i=p));let{schema:o}=e;Ze(n,et,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",le.area,"route",le.route,"crossing",le.crossing,"other",le.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",le.preapp,"outline",le.outline,"reserved matters",le["reserved matters"],"local plan",le["local plan"],"white"],l=["!=","hide_while_editing",!0];return be(n,{id:"interventions-points",source:et,filter:["all",Vt,l,["!=","endpoint",!0]],...ut(s,Qt)}),be(n,{id:"interventions-lines",source:et,filter:["all",Kt,l],...wt(s,Yt)},"route-lines"),be(n,{id:"interventions-lines-endpoints",source:et,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Yt,"circle-opacity":0,"circle-stroke-color":le.lineEndpointColor,"circle-stroke-width":2}}),be(n,{id:"interventions-polygons",source:et,filter:["all",Zt,l],...zt(o=="planning"?a:s,.5)},"hover-polygons"),r.$$set=p=>{"schema"in p&&t(0,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(i)),_=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])_.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(_),n.getSource(et).setData(p)}},[o,n,i]}class Ls extends Z{constructor(e){super(),Q(this,e,Os,null,K,{schema:0})}}let tt="hover";function Cs(r,e,t){let n,i,o,s,a;return ie(r,je,l=>t(0,n=l)),ie(r,ee,l=>t(1,i=l)),ie(r,Dt,l=>t(2,o=l)),ie(r,Ye,l=>t(3,s=l)),ie(r,Ce,l=>t(4,a=l)),Ze(n,tt,{type:"geojson",data:De()}),be(n,{id:"hover-polygons",source:tt,filter:Zt,...wt(le.hovering,.5*Yt,1)}),be(n,{id:"hover-lines",source:tt,filter:Kt,...wt(le.hovering,1.5*Yt,1)},"interventions-lines"),be(n,{id:"hover-points",source:tt,filter:Vt,...ut(le.hovering,1.5*Qt,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(tt).setData(i.features.find(u=>u.id==l)):n.getSource(tt).setData(De())}},[n,i,o,s,a]}class Ts extends Z{constructor(e){super(),Q(this,e,Cs,null,K,{})}}class Cn{constructor(e,t){te(this,"owner");te(this,"map");te(this,"mapHandlers",{});te(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Ct="edit-point-mode";class Rs{constructor(e){te(this,"map");te(this,"active");te(this,"eventListenersSuccess");te(this,"eventListenersFailure");te(this,"cursor");te(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new Cn(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Ze(e,Ct,{type:"geojson",data:De()}),be(e,{id:"edit-point-mode",source:Ct,...ut(le.hovering,Qt,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=xs(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Ct),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=De();this.cursor&&e.features.push(this.cursor),this.map.getSource(Ct).setData(e)}}function xs(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function qr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return As(r,e);var n=Ve(r),i=Ve(e),o=$e(n[0]),s=$e(i[0]),a=$e(n[1]),l=$e(i[1]),u=Math.sin(s-o)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return an(Math.atan2(u,p))}function As(r,e){var t=qr(e,r);return t=(t+180)%360,t}function fr(r,e,t,n){n===void 0&&(n={});var i=Ve(r),o=$e(i[0]),s=$e(i[1]),a=$e(t),l=yi(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),_=an(p),c=an(u);return st([_,c],n.properties)}function _n(r){if(!r)throw new Error("geojson is required");var e=[];return Mn(r,function(t){Ps(t,e)}),We(e)}function Ps(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Be(n);break;case"LineString":t=[Be(n)]}t.forEach(function(i){var o=$s(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function $s(r,e){var t=[];return r.reduce(function(n,i){var o=lt([n,i],e);return o.bbox=Fs(n,i),t.push(o),i}),t}function Fs(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var at={},Ns={get exports(){return at},set exports(r){at=r}},vn={},Is={get exports(){return vn},set exports(r){vn=r}};(function(r,e){(function(t,n){r.exports=n()})(bi,function(){function t(m,v,b,M,O){(function x(L,F,I,N,W){for(;N>I;){if(N-I>600){var P=N-I+1,D=F-I+1,oe=Math.log(P),fe=.5*Math.exp(2*oe/3),j=.5*Math.sqrt(oe*fe*(P-fe)/P)*(D-P/2<0?-1:1),se=Math.max(I,Math.floor(F-D*fe/P+j)),Ee=Math.min(N,Math.floor(F+(P-D)*fe/P+j));x(L,F,se,Ee,W)}var Ae=L[F],pe=I,ce=N;for(n(L,I,F),W(L[N],Ae)>0&&n(L,I,N);pe<ce;){for(n(L,pe,ce),pe++,ce--;W(L[pe],Ae)<0;)pe++;for(;W(L[ce],Ae)>0;)ce--}W(L[I],Ae)===0?n(L,I,ce):n(L,++ce,N),ce<=F&&(I=ce+1),F<=ce&&(N=ce-1)}})(m,v,b||0,M||m.length-1,O||i)}function n(m,v,b){var M=m[v];m[v]=m[b],m[b]=M}function i(m,v){return m<v?-1:m>v?1:0}var o=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(m,v,b){if(!b)return v.indexOf(m);for(var M=0;M<v.length;M++)if(b(m,v[M]))return M;return-1}function a(m,v){l(m,0,m.children.length,v,m)}function l(m,v,b,M,O){O||(O=d(null)),O.minX=1/0,O.minY=1/0,O.maxX=-1/0,O.maxY=-1/0;for(var x=v;x<b;x++){var L=m.children[x];u(O,m.leaf?M(L):L)}return O}function u(m,v){return m.minX=Math.min(m.minX,v.minX),m.minY=Math.min(m.minY,v.minY),m.maxX=Math.max(m.maxX,v.maxX),m.maxY=Math.max(m.maxY,v.maxY),m}function p(m,v){return m.minX-v.minX}function _(m,v){return m.minY-v.minY}function c(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function f(m){return m.maxX-m.minX+(m.maxY-m.minY)}function h(m,v){return m.minX<=v.minX&&m.minY<=v.minY&&v.maxX<=m.maxX&&v.maxY<=m.maxY}function g(m,v){return v.minX<=m.maxX&&v.minY<=m.maxY&&v.maxX>=m.minX&&v.maxY>=m.minY}function d(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(m,v,b,M,O){for(var x=[v,b];x.length;)if(!((b=x.pop())-(v=x.pop())<=M)){var L=v+Math.ceil((b-v)/M/2)*M;t(m,L,v,b,O),x.push(v,L,L,b)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(m){var v=this.data,b=[];if(!g(m,v))return b;for(var M=this.toBBox,O=[];v;){for(var x=0;x<v.children.length;x++){var L=v.children[x],F=v.leaf?M(L):L;g(m,F)&&(v.leaf?b.push(L):h(m,F)?this._all(L,b):O.push(L))}v=O.pop()}return b},o.prototype.collides=function(m){var v=this.data;if(!g(m,v))return!1;for(var b=[];v;){for(var M=0;M<v.children.length;M++){var O=v.children[M],x=v.leaf?this.toBBox(O):O;if(g(m,x)){if(v.leaf||h(m,x))return!0;b.push(O)}}v=b.pop()}return!1},o.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var v=0;v<m.length;v++)this.insert(m[v]);return this}var b=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===b.height)this._splitRoot(this.data,b);else{if(this.data.height<b.height){var M=this.data;this.data=b,b=M}this._insert(b,this.data.height-b.height-1,!0)}else this.data=b;return this},o.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},o.prototype.clear=function(){return this.data=d([]),this},o.prototype.remove=function(m,v){if(!m)return this;for(var b,M,O,x=this.data,L=this.toBBox(m),F=[],I=[];x||F.length;){if(x||(x=F.pop(),M=F[F.length-1],b=I.pop(),O=!0),x.leaf){var N=s(m,x.children,v);if(N!==-1)return x.children.splice(N,1),F.push(x),this._condense(F),this}O||x.leaf||!h(x,L)?M?(b++,x=M.children[b],O=!1):x=null:(F.push(x),I.push(b),b=0,M=x,x=x.children[0])}return this},o.prototype.toBBox=function(m){return m},o.prototype.compareMinX=function(m,v){return m.minX-v.minX},o.prototype.compareMinY=function(m,v){return m.minY-v.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(m){return this.data=m,this},o.prototype._all=function(m,v){for(var b=[];m;)m.leaf?v.push.apply(v,m.children):b.push.apply(b,m.children),m=b.pop();return v},o.prototype._build=function(m,v,b,M){var O,x=b-v+1,L=this._maxEntries;if(x<=L)return a(O=d(m.slice(v,b+1)),this.toBBox),O;M||(M=Math.ceil(Math.log(x)/Math.log(L)),L=Math.ceil(x/Math.pow(L,M-1))),(O=d([])).leaf=!1,O.height=M;var F=Math.ceil(x/L),I=F*Math.ceil(Math.sqrt(L));y(m,v,b,I,this.compareMinX);for(var N=v;N<=b;N+=I){var W=Math.min(N+I-1,b);y(m,N,W,F,this.compareMinY);for(var P=N;P<=W;P+=F){var D=Math.min(P+F-1,W);O.children.push(this._build(m,P,D,M-1))}}return a(O,this.toBBox),O},o.prototype._chooseSubtree=function(m,v,b,M){for(;M.push(v),!v.leaf&&M.length-1!==b;){for(var O=1/0,x=1/0,L=void 0,F=0;F<v.children.length;F++){var I=v.children[F],N=c(I),W=(P=m,D=I,(Math.max(D.maxX,P.maxX)-Math.min(D.minX,P.minX))*(Math.max(D.maxY,P.maxY)-Math.min(D.minY,P.minY))-N);W<x?(x=W,O=N<O?N:O,L=I):W===x&&N<O&&(O=N,L=I)}v=L||v.children[0]}var P,D;return v},o.prototype._insert=function(m,v,b){var M=b?m:this.toBBox(m),O=[],x=this._chooseSubtree(M,this.data,v,O);for(x.children.push(m),u(x,M);v>=0&&O[v].children.length>this._maxEntries;)this._split(O,v),v--;this._adjustParentBBoxes(M,O,v)},o.prototype._split=function(m,v){var b=m[v],M=b.children.length,O=this._minEntries;this._chooseSplitAxis(b,O,M);var x=this._chooseSplitIndex(b,O,M),L=d(b.children.splice(x,b.children.length-x));L.height=b.height,L.leaf=b.leaf,a(b,this.toBBox),a(L,this.toBBox),v?m[v-1].children.push(L):this._splitRoot(b,L)},o.prototype._splitRoot=function(m,v){this.data=d([m,v]),this.data.height=m.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(m,v,b){for(var M,O,x,L,F,I,N,W=1/0,P=1/0,D=v;D<=b-v;D++){var oe=l(m,0,D,this.toBBox),fe=l(m,D,b,this.toBBox),j=(O=oe,x=fe,L=void 0,F=void 0,I=void 0,N=void 0,L=Math.max(O.minX,x.minX),F=Math.max(O.minY,x.minY),I=Math.min(O.maxX,x.maxX),N=Math.min(O.maxY,x.maxY),Math.max(0,I-L)*Math.max(0,N-F)),se=c(oe)+c(fe);j<W?(W=j,M=D,P=se<P?se:P):j===W&&se<P&&(P=se,M=D)}return M||b-v},o.prototype._chooseSplitAxis=function(m,v,b){var M=m.leaf?this.compareMinX:p,O=m.leaf?this.compareMinY:_;this._allDistMargin(m,v,b,M)<this._allDistMargin(m,v,b,O)&&m.children.sort(M)},o.prototype._allDistMargin=function(m,v,b,M){m.children.sort(M);for(var O=this.toBBox,x=l(m,0,v,O),L=l(m,b-v,b,O),F=f(x)+f(L),I=v;I<b-v;I++){var N=m.children[I];u(x,m.leaf?O(N):N),F+=f(x)}for(var W=b-v-1;W>=v;W--){var P=m.children[W];u(L,m.leaf?O(P):P),F+=f(L)}return F},o.prototype._adjustParentBBoxes=function(m,v,b){for(var M=b;M>=0;M--)u(v[M],m)},o.prototype._condense=function(m){for(var v=m.length-1,b=void 0;v>=0;v--)m[v].children.length===0?v>0?(b=m[v-1].children).splice(b.indexOf(m[v]),1):this.clear():a(m[v],this.toBBox)},o})})(Is);const Bs=On(wi),Ds=On(ki),js=On(Si);var Ne=vn,Gr=Bs,Yr=Ds,nt=js.default,qs=Yr.featureEach;Yr.coordEach;Gr.polygon;var cr=Gr.featureCollection;function Hr(r){var e=new Ne(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:nt(t),Ne.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:nt(i),n.push(i)}):qs(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:nt(i),n.push(i)}),Ne.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:nt(t),Ne.prototype.remove.call(this,t,n)},e.clear=function(){return Ne.prototype.clear.call(this)},e.search=function(t){var n=Ne.prototype.search.call(this,this.toBBox(t));return cr(n)},e.collides=function(t){return Ne.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ne.prototype.all.call(this);return cr(t)},e.toJSON=function(){return Ne.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ne.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=nt(t);else if(t.type==="FeatureCollection")n=nt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ns.exports=Hr;at.default=Hr;function Ur(r,e){var t={},n=[];if(r.type==="LineString"&&(r=In(r)),e.type==="LineString"&&(e=In(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=pr(r,e);return i&&n.push(i),We(n)}var o=at();return o.load(_n(e)),Bt(_n(r),function(s){Bt(o.search(s),function(a){var l=pr(s,a);if(l){var u=Be(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function pr(r,e){var t=Be(r),n=Be(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],_=n[1][1],c=(_-u)*(s-i)-(p-l)*(a-o),f=(p-l)*(o-u)-(_-u)*(i-l),h=(s-i)*(o-u)-(a-o)*(i-l);if(c===0)return f===0&&h===0,null;var g=f/c,d=h/c;if(g>=0&&g<=1&&d>=0&&d<=1){var y=i+g*(s-i),m=o+g*(a-o);return st([y,m])}return null}function St(r,e,t){t===void 0&&(t={});var n=st([1/0,1/0],{dist:1/0}),i=0;return Mn(r,function(o){for(var s=Be(o),a=0;a<s.length-1;a++){var l=st(s[a]);l.properties.dist=Je(e,l,t);var u=st(s[a+1]);u.properties.dist=Je(e,u,t);var p=Je(l,u,t),_=Math.max(l.properties.dist,u.properties.dist),c=qr(l,u),f=fr(e,_,c+90,t),h=fr(e,_,c-90,t),g=Ur(lt([f.geometry.coordinates,h.geometry.coordinates]),lt([l.geometry.coordinates,u.geometry.coordinates])),d=null;g.features.length>0&&(d=g.features[0],d.properties.dist=Je(e,d,t),d.properties.location=i+Je(l,d,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+p),d&&d.properties.dist<n.properties.dist&&(n=d,n.properties.index=a),i+=p}}),n}const rt="edit-polygon-mode";class Gs{constructor(e){te(this,"map");te(this,"active");te(this,"eventListenersSuccess");te(this,"eventListenersFailure");te(this,"points");te(this,"cursor");te(this,"hover");te(this,"dragFrom");te(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new Cn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Ze(e,rt,{type:"geojson",data:De()}),be(e,{id:"edit-polygon-fill",source:rt,filter:Zt,...zt("red",["case",["boolean",["get","hover"],"false"],1,.5])}),be(e,{id:"edit-polygon-lines",source:rt,filter:Kt,...wt("black",8,.5)}),be(e,{id:"edit-polygon-vertices",source:rt,filter:Vt,...ut(le.hovering,Qt,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(dr(this.points).forEach((n,i)=>{t.push([i+1,St(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(rt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=De();this.points.forEach((n,i)=>{let o=hr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(dr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(rt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=hr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function hr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function dr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let z;const Ge=new Array(32).fill(void 0);Ge.push(void 0,null,!0,!1);function J(r){return Ge[r]}let vt=Ge.length;function Ys(r){r<36||(Ge[r]=vt,vt=r)}function yn(r){const e=J(r);return Ys(r),e}const Jr=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Jr.decode();let At=new Uint8Array;function yt(){return At.byteLength===0&&(At=new Uint8Array(z.memory.buffer)),At}function it(r,e){return Jr.decode(yt().subarray(r,r+e))}function me(r){vt===Ge.length&&Ge.push(Ge.length+1);const e=vt;return vt=Ge[e],Ge[e]=r,e}function rn(r){return r==null}let Pt=new Float64Array;function Hs(){return Pt.byteLength===0&&(Pt=new Float64Array(z.memory.buffer)),Pt}let $t=new Int32Array;function ge(){return $t.byteLength===0&&($t=new Int32Array(z.memory.buffer)),$t}let ze=0;const Ft=new TextEncoder("utf-8"),Us=typeof Ft.encodeInto=="function"?function(r,e){return Ft.encodeInto(r,e)}:function(r,e){const t=Ft.encode(r);return e.set(t),{read:r.length,written:t.length}};function Tt(r,e,t){if(t===void 0){const a=Ft.encode(r),l=e(a.length);return yt().subarray(l,l+a.length).set(a),ze=a.length,l}let n=r.length,i=e(n);const o=yt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=yt().subarray(i+s,i+n),l=Us(r,a);s+=l.written}return ze=s,i}function bn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=bn(r[0]));for(let s=1;s<i;s++)o+=", "+bn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Js(r,e){const t=e(r.length*1);return yt().set(r,t/1),ze=r.length,t}function on(r,e){try{return r.apply(this,e)}catch(t){z.__wbindgen_exn_store(me(t))}}class Ht{static __wrap(e){const t=Object.create(Ht.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();z.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=z.__wbindgen_add_to_stack_pointer(-16),s=Js(e,z.__wbindgen_malloc),a=ze;z.jsroutesnapper_new(o,s,a);var t=ge()[o/4+0],n=ge()[o/4+1],i=ge()[o/4+2];if(i)throw yn(n);return Ht.__wrap(t)}finally{z.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){z.jsroutesnapper_setConfig(this.ptr,me(e))}toFinalFeature(){try{const n=z.__wbindgen_add_to_stack_pointer(-16);z.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ge()[n/4+0],t=ge()[n/4+1];let i;return e!==0&&(i=it(e,t).slice(),z.__wbindgen_free(e,t*1)),i}finally{z.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=z.__wbindgen_add_to_stack_pointer(-16);z.jsroutesnapper_renderGeojson(n,this.ptr);var e=ge()[n/4+0],t=ge()[n/4+1];return it(e,t)}finally{z.__wbindgen_add_to_stack_pointer(16),z.__wbindgen_free(e,t)}}setSnapMode(e){z.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return z.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){z.jsroutesnapper_onClick(this.ptr)}onDragStart(){return z.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return z.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){z.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=z.__wbindgen_add_to_stack_pointer(-16);z.jsroutesnapper_editExisting(i,this.ptr,me(e));var t=ge()[i/4+0],n=ge()[i/4+1];if(n)throw yn(t)}finally{z.__wbindgen_add_to_stack_pointer(16)}}}async function Xs(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function zs(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){yn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(it(e,t));return me(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=it(e,t);return me(n)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;Hs()[e/8+1]=rn(i)?0:i,ge()[e/4+0]=!rn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=rn(i)?0:Tt(i,z.__wbindgen_malloc,z.__wbindgen_realloc),s=ze;ge()[e/4+1]=s,ge()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(J(t)),i=Tt(n,z.__wbindgen_malloc,z.__wbindgen_realloc),o=ze;ge()[e/4+1]=o,ge()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return me(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=J(e)[J(t)];return me(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(J(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(J(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(J(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(J(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(J(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=J(e)[t>>>0];return me(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=J(e).next;return me(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return on(function(e){const t=J(e).next();return me(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return J(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=J(e).value;return me(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return me(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return on(function(e,t){const n=Reflect.get(J(e),J(t));return me(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return on(function(e,t){const n=J(e).call(J(t));return me(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=J(e).buffer;return me(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(J(e));return me(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return me(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=Tt(n,z.__wbindgen_malloc,z.__wbindgen_realloc),o=ze;ge()[e/4+1]=o,ge()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(it(e,t))}finally{z.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=bn(J(t)),i=Tt(n,z.__wbindgen_malloc,z.__wbindgen_realloc),o=ze;ge()[e/4+1]=o,ge()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(it(e,t))},r.wbg.__wbindgen_memory=function(){const e=z.memory;return me(e)},r}function Ws(r,e){return z=r.exports,Xr.__wbindgen_wasm_module=e,Pt=new Float64Array,$t=new Int32Array,At=new Uint8Array,z}async function Xr(r){typeof r>"u"&&(r="/atip/assets/route_snapper_bg.wasm");const e=zs();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Xs(await r,e);return Ws(t,n)}const pt="route-snapper",mr=10,Vs=30;class Ks{constructor(e,t){te(this,"map");te(this,"inner");te(this,"active");te(this,"eventListenersSuccessRoute");te(this,"eventListenersSuccessArea");te(this,"eventListenersFailure");te(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Ht(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Ze(e,pt,{type:"geojson",data:De()}),be(e,{id:"route-points",source:pt,filter:Vt,...ut(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",mr/2,mr])}),be(e,{id:"route-lines",source:pt,filter:Kt,...wt("black",2.5)}),be(e,{id:"route-polygons",source:pt,filter:Zt,...zt("black",.5)}),this.events=new Cn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Vs,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(pt).setData(JSON.parse(this.inner.renderGeojson()))}}function gr(r){let e;function t(o,s){return o[1]?Qs:Zs}let n=t(r),i=n(r);return{c(){i.c(),e=_e()},m(o,s){i.m(o,s),S(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&E(e)}}}function Zs(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Qs(r){let e;return{c(){e=k("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function el(r){let e,t=r[0]==ot&&gr(r);return{c(){t&&t.c(),e=_e()},m(n,i){t&&t.m(n,i),S(n,e,i)},p(n,[i]){n[0]==ot?t?t.p(n,i):(t=gr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&E(e)}}}const ot="edit-attribute";function zr(){}function tl(r,e,t){let n,i,o,s;ie(r,je,f=>t(5,n=f)),ie(r,ee,f=>t(6,i=f)),ie(r,un,f=>t(7,o=f)),ie(r,Ce,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){Ce.set(null)}n.on("mousemove",p),n.on("mouseout",_),n.on("click",c),Et(()=>{n.off("mousemove",p),n.off("mouseout",_),n.off("click",c)});function p(f){var h;if(a==ot){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ye.set(((h=g[0])==null?void 0:h.id)||null)}}function _(){a==ot&&Ye.set(null)}function c(f){if(a==ot){let h=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});h.length>0?Ce.set(h[0].id):Ce.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let h=i.features.find(g=>g.id==f);h.geometry.type=="Point"?n.flyTo({center:h.geometry.coordinates,duration:500}):n.fitBounds(En(h),{padding:200,duration:500}),l(ot)}}},[a,s,l,zr,u,n,i,o]}class nl extends Z{constructor(e){super(),Q(this,e,tl,el,K,{mode:0,changeMode:2,start:3,stop:4})}get start(){return zr}get stop(){return this.$$.ctx[4]}}function rl(r){let e,t;return{c:G,m(n,i){e||(t=B(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function il(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class en extends Z{constructor(e){super(),Q(this,e,il,rl,K,{tool:1})}}function ol(r){let e;return{c(){e=k("p"),e.textContent="Click to add a new point"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function sl(r){let e;return{c(){e=k("p"),e.textContent="Click to move the point here"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function ll(r){let e,t,n,i,o,s,a,l,u;function p(f,h){return f[1]?sl:ol}let _=p(r),c=_(r);return s=new en({props:{tool:r[0]}}),{c(){c.c(),e=T(),t=k("p"),t.innerHTML="Press <b>Escape</b> to cancel",n=T(),i=k("button"),i.textContent="Cancel",o=T(),Y(s.$$.fragment),C(i,"type","button")},m(f,h){c.m(f,h),S(f,e,h),S(f,t,h),S(f,n,h),S(f,i,h),S(f,o,h),H(s,f,h),a=!0,l||(u=B(i,"click",r[2]),l=!0)},p(f,[h]){_!==(_=p(f))&&(c.d(1),c=_(f),c&&(c.c(),c.m(e.parentNode,e)));const g={};h&1&&(g.tool=f[0]),s.$set(g)},i(f){a||(R(s.$$.fragment,f),a=!0)},o(f){A(s.$$.fragment,f),a=!1},d(f){c.d(f),f&&E(e),f&&E(t),f&&E(n),f&&E(i),f&&E(o),U(s,f),l=!1,u()}}}function al(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Wr extends Z{constructor(e){super(),Q(this,e,al,ll,K,{pointTool:0,editingExisting:1})}}function ul(r){let e,t,n,i,o,s,a,l,u,p,_;return l=new en({props:{tool:r[0]}}),{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=T(),n=k("div"),i=k("button"),i.textContent="Finish",o=T(),s=k("button"),s.textContent="Cancel",a=T(),Y(l.$$.fragment),C(i,"type","button"),C(s,"type","button"),ae(n,"display","flex"),ae(n,"justify-content","space-between")},m(c,f){S(c,e,f),S(c,t,f),S(c,n,f),w(n,i),w(n,o),w(n,s),S(c,a,f),H(l,c,f),u=!0,p||(_=[B(i,"click",r[1]),B(s,"click",r[2])],p=!0)},p(c,[f]){const h={};f&1&&(h.tool=c[0]),l.$set(h)},i(c){u||(R(l.$$.fragment,c),u=!0)},o(c){A(l.$$.fragment,c),u=!1},d(c){c&&E(e),c&&E(t),c&&E(n),c&&E(a),U(l,c),p=!1,Te(_)}}}function fl(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Vr extends Z{constructor(e){super(),Q(this,e,fl,ul,K,{polygonTool:0})}}function cl(r){let e,t,n,i,o,s,a,l,u,p,_;return l=new en({props:{tool:r[0]}}),{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish area</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=T(),n=k("div"),i=k("button"),i.textContent="Finish",o=T(),s=k("button"),s.textContent="Cancel",a=T(),Y(l.$$.fragment),C(i,"type","button"),C(s,"type","button"),ae(n,"display","flex"),ae(n,"justify-content","space-between")},m(c,f){S(c,e,f),S(c,t,f),S(c,n,f),w(n,i),w(n,o),w(n,s),S(c,a,f),H(l,c,f),u=!0,p||(_=[B(i,"click",r[1]),B(s,"click",r[2])],p=!0)},p(c,[f]){const h={};f&1&&(h.tool=c[0]),l.$set(h)},i(c){u||(R(l.$$.fragment,c),u=!0)},o(c){A(l.$$.fragment,c),u=!1},d(c){c&&E(e),c&&E(t),c&&E(n),c&&E(a),U(l,c),p=!1,Te(_)}}}function pl(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Kr extends Z{constructor(e){super(),Q(this,e,pl,cl,K,{routeTool:0})}}function hl(r){let e,t,n,i,o,s,a,l,u,p,_,c,f,h,g;return c=new en({props:{tool:r[0]}}),{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=T(),n=k("label"),i=k("input"),o=X(`
  Avoid doubling back`),s=T(),a=k("div"),l=k("button"),l.textContent="Finish",u=T(),p=k("button"),p.textContent="Cancel",_=T(),Y(c.$$.fragment),C(i,"type","checkbox"),C(l,"type","button"),C(p,"type","button"),ae(a,"display","flex"),ae(a,"justify-content","space-between")},m(d,y){S(d,e,y),S(d,t,y),S(d,n,y),w(n,i),i.checked=r[1],w(n,o),S(d,s,y),S(d,a,y),w(a,l),w(a,u),w(a,p),S(d,_,y),H(c,d,y),f=!0,h||(g=[B(i,"change",r[2]),B(l,"click",r[3]),B(p,"click",r[4])],h=!0)},p(d,[y]){y&2&&(i.checked=d[1]);const m={};y&1&&(m.tool=d[0]),c.$set(m)},i(d){f||(R(c.$$.fragment,d),f=!0)},o(d){A(c.$$.fragment,d),f=!1},d(d){d&&E(e),d&&E(t),d&&E(n),d&&E(s),d&&E(a),d&&E(_),U(c,d),h=!1,Te(g)}}}function dl(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class Zr extends Z{constructor(e){super(),Q(this,e,dl,hl,K,{routeTool:0})}}function _r(r){let e,t,n,i;const o=[yl,vl,_l,gl,ml],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=_e()},m(l,u){s[e].m(l,u),S(l,n,u),i=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(ve(),A(s[p],1,1,()=>{s[p]=null}),ye(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),R(t,1),t.m(n.parentNode,n))},i(l){i||(R(t),i=!0)},o(l){A(t),i=!1},d(l){s[e].d(l),l&&E(n)}}}function ml(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){S(t,e,n)},p:G,i:G,o:G,d(t){t&&E(e)}}}function gl(r){let e,t;return e=new Zr({props:{routeTool:r[3]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function _l(r){let e,t;return e=new Kr({props:{routeTool:r[3]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function vl(r){let e,t;return e=new Vr({props:{polygonTool:r[2]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function yl(r){let e,t;return e=new Wr({props:{pointTool:r[1],editingExisting:!0}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function bl(r){let e,t,n=r[0]==qe&&_r(r);return{c(){n&&n.c(),e=_e()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==qe?n?(n.p(i,o),o&1&&R(n,1)):(n=_r(i),n.c(),R(n,1),n.m(e.parentNode,e)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(R(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const qe="edit-geometry";function Qr(){}function wl(r,e,t){let n;ie(r,je,g=>t(8,n=g));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(o.stop(),s.stop(),a.stop(),ee.update(g=>{let d=g.features.find(y=>y.id==l);return delete d.properties.hide_while_editing,g})),l=null,t(4,u=null),Ye.set(null)}n.on("mousemove",_),n.on("mouseout",c),n.on("click",f),Et(()=>{n.off("mousemove",_),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(g=>{i==qe&&(ee.update(d=>{let y=d.features.find(m=>m.id==l);return y.properties.length_meters=g.properties.length_meters,y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,d}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{i==qe&&(ee.update(d=>{let y=d.features.find(m=>m.id==l);return y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,d}),l=null,t(4,u=null))});for(let g of[o,s])g.addEventListenerSuccess(d=>{i==qe&&(ee.update(y=>{let m=y.features.find(v=>v.id==l);return m.geometry=d.geometry,delete m.properties.hide_while_editing,y}),l=null,t(4,u=null))});for(let g of[o,s,a])g.addEventListenerFailure(()=>{i==qe&&(ee.update(d=>{let y=d.features.find(m=>m.id==l);return delete y.properties.hide_while_editing,d}),l=null,t(4,u=null))});function _(g){var d;if(i==qe&&l==null){let y=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ye.set(((d=y[0])==null?void 0:d.id)||null)}}function c(){i==qe&&l==null&&Ye.set(null)}function f(g){if(i==qe&&l==null){let d=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});d.length>0&&h(d[0].id)}}function h(g){Ye.set(null);let d=null;ee.update(m=>(d=m.features.find(v=>v.id==g),d.properties.hide_while_editing=!0,m));let y=d;l=g,y.geometry.type=="LineString"?(a.editExistingRoute(y),t(4,u="route")):y.geometry.type=="Polygon"?y.properties.waypoints?(a.editExistingArea(y),t(4,u="snap-polygon")):(s.editExisting(y),t(4,u="free-polygon")):y.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"pointTool"in g&&t(1,o=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[i,o,s,a,u,Qr,p]}class kl extends Z{constructor(e){super(),Q(this,e,wl,bl,K,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Qr}get stop(){return this.$$.ctx[6]}}async function Sl(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),o+=p.length;const _=100*o/i;e.style=`background: linear-gradient(to right, red ${_}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function El(r){let e,t;return e=new Zr({props:{routeTool:r[0]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Ml(r){let e;return{c(){e=k("div"),e.textContent="Route tool loading..."},m(t,n){S(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&E(e),r[7](null)}}}function Ol(r){let e,t,n,i;const o=[Ml,El],s=[];function a(l,u){return l[0]?l[1]==wn?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=_e()},m(l,u){~e&&s[e].m(l,u),S(l,n,u),i=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(ve(),A(s[p],1,1,()=>{s[p]=null}),ye()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),R(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(R(t),i=!0)},o(l){A(t),i=!1},d(l){~e&&s[e].d(l),l&&E(n)}}}const wn="route";function Ll(r,e,t){let n;ie(r,je,c=>t(8,n=c));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}Sn(async()=>{await Xr(),console.log(`Grabbing ${s}`);try{const c=await Sl(s,a);t(0,l=new Ks(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==wn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{i==wn&&(ee.update(f=>(c.id=Mt(f),c.properties.intervention_type="route",f.features.push(c),f)),o("edit-attribute"),Ce.set(c.id))})});function _(c){ne[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,i=c.mode),"changeMode"in c&&t(3,o=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,i,a,o,s,u,p,_]}class Cl extends Z{constructor(e){super(),Q(this,e,Ll,Ol,K,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function vr(r){let e,t;return e=new Wr({props:{pointTool:r[1],editingExisting:!1}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Tl(r){let e,t,n=r[0]==Ut&&vr(r);return{c(){n&&n.c(),e=_e()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Ut?n?(n.p(i,o),o&1&&R(n,1)):(n=vr(i),n.c(),R(n,1),n.m(e.parentNode,e)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(R(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const Ut="point";function Rl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Ut&&(ee.update(u=>(l.id=Mt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),Ce.set(l.id))}),o.addEventListenerFailure(()=>{n==Ut&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class xl extends Z{constructor(e){super(),Q(this,e,Rl,Tl,K,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function yr(r){let e,t;return e=new Vr({props:{polygonTool:r[1]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Al(r){let e,t,n=r[0]==Jt&&yr(r);return{c(){n&&n.c(),e=_e()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Jt?n?(n.p(i,o),o&1&&R(n,1)):(n=yr(i),n.c(),R(n,1),n.m(e.parentNode,e)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(R(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const Jt="free-polygon";function Pl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Jt&&(ee.update(u=>(l.id=Mt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Ce.set(l.id))}),o.addEventListenerFailure(()=>{n==Jt&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class $l extends Z{constructor(e){super(),Q(this,e,Pl,Al,K,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function br(r){let e,t;return e=new Kr({props:{routeTool:r[1]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Fl(r){let e,t,n=r[0]==Xt&&br(r);return{c(){n&&n.c(),e=_e()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Xt?n?(n.p(i,o),o&1&&R(n,1)):(n=br(i),n.c(),R(n,1),n.m(e.parentNode,e)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(R(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const Xt="snap-polygon";function Nl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==Xt&&(ee.update(u=>(l.id=Mt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Ce.set(l.id))}),o.addEventListenerFailure(()=>{n==Xt&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class Il extends Z{constructor(e){super(),Q(this,e,Nl,Fl,K,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Bl(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Je(r.slice(0,2),[n,t]),s=Je(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Dl(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return Ei(r,function(s){jl(s,o,n)}),r}function jl(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function ql(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=gn(r),n=gn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Dl(e,{precision:7});switch(n){case"Point":return kn(r,i);case"MultiPoint":return wr(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return wr(r,Ur(r,i))}}function wr(r,e){var t=[],n=at();return Mn(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=kn(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=Bl(Mi(a)))}),n.load(We(t));else{var o=n.search(i);if(o.features.length){var s=ei(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),Bt(kn(s,i),function(a){t.push(a),n.insert(a)})}}}),We(t)}function kn(r,e){var t=[],n=Be(r)[0],i=Be(r)[r.geometry.coordinates.length-1];if(sn(n,Ve(e))||sn(i,Ve(e)))return We([r]);var o=at(),s=_n(r);o.load(s);var a=o.search(e);if(!a.features.length)return We([r]);var l=ei(e,a),u=[n],p=Oi(s,function(_,c,f){var h=Be(c)[1],g=Ve(e);return f===l.id?(_.push(g),t.push(lt(_)),sn(g,h)?[g]:[g,h]):(_.push(h),_)},u);return p.length>1&&t.push(lt(p)),We(t)}function ei(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return Bt(e,function(i){var o=St(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function sn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Gl(r,e,t){var n=Be(t);if(gn(t)!=="LineString")throw new Error("line must be a LineString");var i=St(t,r),o=St(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),lt(a,t.properties)}function kr(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Yl(r){let e,t,n,i=r[0]==bt&&kr();return{c(){i&&i.c(),e=_e()},m(o,s){i&&i.m(o,s),S(o,e,s),t||(n=B(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==bt?i||(i=kr(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:G,o:G,d(o){i&&i.d(o),o&&E(e),t=!1,n()}}}const bt="split-route",Hl=10,Ul=30;let ln="split-route";function ti(){}function Sr(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Jl(r,e,t){let n,i;ie(r,ee,g=>t(8,n=g)),ie(r,je,g=>t(6,i=g));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",p),i.on("click",_),Et(()=>{i.off("mousemove",p),i.off("click",_)}),Ze(i,ln,{type:"geojson",data:De()}),be(i,{id:"draw-split-route",source:ln,...ut("black",Hl,["case",["==",["get","snapped"],!0],1,.5])});function p(g){if(o!=bt)return;t(5,l=Sr(g.lngLat.toArray(),!1)),u=null;const d=[g.point.x-Ul,g.point.y],y=i.unproject(g.point).distanceTo(i.unproject(d))/1e3;let m=[];for(let[v,b]of n.features.entries())if(b.geometry.type=="LineString"){let M=St(b.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=y&&m.push([v,M.geometry.coordinates,M.properties.dist])}m.sort((v,b)=>v[2]-b[2]),m.length>0&&(t(5,l=Sr(m[0][1],!0)),u=m[0][0])}function _(){if(o==bt)if(u==null)s("edit-attribute");else{let g=ql(n.features[u],l);if(g.features.length==2){let d=g.features[0],y=g.features[1];ee.update(m=>(d.id=m.features[u].id,y.id=Mt(m),d.properties=JSON.parse(JSON.stringify(m.features[u].properties)),y.properties=JSON.parse(JSON.stringify(d.properties)),c(m.features[u],d,y,l),m.features.splice(u,1,d,y),m))}a()}}function c(g,d,y,m){d.properties.length_meters=xt(d,{units:"kilometers"})*1e3,y.properties.length_meters=xt(y,{units:"kilometers"})*1e3,d.properties.waypoints=[],y.properties.waypoints=[];let v=f(g,m),b=!0,M=0;for(let O of g.properties.waypoints){let x=f(g,st([O.lon,O.lat]));if(b)if(x<v)d.properties.waypoints.push(O);else{let L=O.snapped&&g.properties.waypoints[M-1].snapped;d.properties.waypoints.push({lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1],snapped:L}),b=!1,y.properties.waypoints.push({lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1],snapped:L}),y.properties.waypoints.push(O)}else y.properties.waypoints.push(O);M++}}function f(g,d){let y=g.geometry.coordinates[0],m=Gl(y,d,g);return xt(m,{units:"kilometers"})*1e3}function h(g){o==bt&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=De();l&&g.features.push(l),i.getSource(ln).setData(g)}},[o,h,s,ti,a,l,i]}class Xl extends Z{constructor(e){super(),Q(this,e,Jl,Yl,K,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ti}get stop(){return this.$$.ctx[4]}}function Er(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new kl({props:n}),r[17](e),{c(){Y(e.$$.fragment)},m(i,o){H(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(R(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){r[17](null),U(e,i)}}}function Mr(r){let e,t,n,i,o;return{c(){e=k("button"),t=X("New point"),C(e,"type","button"),e.disabled=n=r[3]=="point",C(e,"class","svelte-cej5os")},m(s,a){S(s,e,a),w(e,t),i||(o=B(e,"click",r[18]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function Or(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Il({props:n}),r[23](e),{c(){Y(e.$$.fragment)},m(i,o){H(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(R(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){r[23](null),U(e,i)}}}function Lr(r){let e,t,n,i,o;return{c(){e=k("button"),t=X("New route"),C(e,"type","button"),e.disabled=n=r[3]=="route",C(e,"class","svelte-cej5os")},m(s,a){S(s,e,a),w(e,t),i||(o=B(e,"click",r[24]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function Cr(r){let e,t,n,i,o;return{c(){e=k("button"),t=X("Split route"),C(e,"type","button"),e.disabled=n=r[3]=="split-route",C(e,"class","svelte-cej5os")},m(s,a){S(s,e,a),w(e,t),i||(o=B(e,"click",r[27]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function zl(r){let e,t,n,i,o,s,a,l,u,p,_,c,f,h,g,d,y,m,v,b,M,O,x,L,F,I,N,W,P,D,oe,fe,j,se,Ee,Ae,pe,ce,Pe,re,$,V,ni={mode:r[3],changeMode:r[13]};a=new nl({props:ni}),r[15](a);let he=r[2]&&Er(r),Me=r[1]!="planning"&&Mr(r),ri={mode:r[3],changeMode:r[13],pointTool:r[11]};y=new xl({props:ri}),r[19](y);let ii={mode:r[3],changeMode:r[13],polygonTool:r[12]};L=new $l({props:ii}),r[21](L);let de=r[2]&&Or(r),Oe=r[1]!="planning"&&Lr(r);function oi(q){r[26](q)}let Tn={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(Tn.routeTool=r[2]),se=new Cl({props:Tn}),r[25](se),ne.push(()=>we(se,"routeTool",oi,r[2]));let Le=r[1]!="planning"&&Cr(r),si={mode:r[3],changeMode:r[13]};return Pe=new Xl({props:si}),r[28](Pe),{c(){e=k("div"),t=k("div"),n=k("button"),i=X("Edit attributes"),s=T(),Y(a.$$.fragment),l=T(),u=k("div"),p=k("button"),_=X("Edit geometry"),f=T(),he&&he.c(),h=T(),g=k("div"),Me&&Me.c(),d=T(),Y(y.$$.fragment),m=T(),v=k("div"),b=k("button"),M=X("New polygon (freehand)"),x=T(),Y(L.$$.fragment),F=T(),I=k("div"),N=k("button"),W=X("New polygon (snapped)"),D=T(),de&&de.c(),oe=T(),fe=k("div"),Oe&&Oe.c(),j=T(),Y(se.$$.fragment),Ae=T(),pe=k("div"),Le&&Le.c(),ce=T(),Y(Pe.$$.fragment),C(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",C(n,"class","svelte-cej5os"),C(p,"type","button"),p.disabled=c=r[3]=="edit-geometry",C(p,"class","svelte-cej5os"),C(b,"type","button"),b.disabled=O=r[3]=="free-polygon",C(b,"class","svelte-cej5os"),C(N,"type","button"),N.disabled=P=r[3]=="snap-polygon",C(N,"class","svelte-cej5os"),C(e,"class","toolbox svelte-cej5os")},m(q,ue){S(q,e,ue),w(e,t),w(t,n),w(n,i),w(t,s),H(a,t,null),w(e,l),w(e,u),w(u,p),w(p,_),w(u,f),he&&he.m(u,null),w(e,h),w(e,g),Me&&Me.m(g,null),w(g,d),H(y,g,null),w(e,m),w(e,v),w(v,b),w(b,M),w(v,x),H(L,v,null),w(e,F),w(e,I),w(I,N),w(N,W),w(I,D),de&&de.m(I,null),w(e,oe),w(e,fe),Oe&&Oe.m(fe,null),w(fe,j),H(se,fe,null),w(e,Ae),w(e,pe),Le&&Le.m(pe,null),w(pe,ce),H(Pe,pe,null),re=!0,$||(V=[B(n,"click",r[14]),B(p,"click",r[16]),B(b,"click",r[20]),B(N,"click",r[22])],$=!0)},p(q,[ue]){(!re||ue&8&&o!==(o=q[3]=="edit-attribute"))&&(n.disabled=o);const Rn={};ue&8&&(Rn.mode=q[3]),a.$set(Rn),(!re||ue&8&&c!==(c=q[3]=="edit-geometry"))&&(p.disabled=c),q[2]?he?(he.p(q,ue),ue&4&&R(he,1)):(he=Er(q),he.c(),R(he,1),he.m(u,null)):he&&(ve(),A(he,1,1,()=>{he=null}),ye()),q[1]!="planning"?Me?Me.p(q,ue):(Me=Mr(q),Me.c(),Me.m(g,d)):Me&&(Me.d(1),Me=null);const xn={};ue&8&&(xn.mode=q[3]),y.$set(xn),(!re||ue&8&&O!==(O=q[3]=="free-polygon"))&&(b.disabled=O);const An={};ue&8&&(An.mode=q[3]),L.$set(An),(!re||ue&8&&P!==(P=q[3]=="snap-polygon"))&&(N.disabled=P),q[2]?de?(de.p(q,ue),ue&4&&R(de,1)):(de=Or(q),de.c(),R(de,1),de.m(I,null)):de&&(ve(),A(de,1,1,()=>{de=null}),ye()),q[1]!="planning"?Oe?Oe.p(q,ue):(Oe=Lr(q),Oe.c(),Oe.m(fe,j)):Oe&&(Oe.d(1),Oe=null);const Lt={};ue&8&&(Lt.mode=q[3]),ue&1&&(Lt.url=q[0]),!Ee&&ue&4&&(Ee=!0,Lt.routeTool=q[2],ke(()=>Ee=!1)),se.$set(Lt),q[1]!="planning"?Le?Le.p(q,ue):(Le=Cr(q),Le.c(),Le.m(pe,ce)):Le&&(Le.d(1),Le=null);const Pn={};ue&8&&(Pn.mode=q[3]),Pe.$set(Pn)},i(q){re||(R(a.$$.fragment,q),R(he),R(y.$$.fragment,q),R(L.$$.fragment,q),R(de),R(se.$$.fragment,q),R(Pe.$$.fragment,q),re=!0)},o(q){A(a.$$.fragment,q),A(he),A(y.$$.fragment,q),A(L.$$.fragment,q),A(de),A(se.$$.fragment,q),A(Pe.$$.fragment,q),re=!1},d(q){q&&E(e),r[15](null),U(a),he&&he.d(),Me&&Me.d(),r[19](null),U(y),r[21](null),U(L),de&&de.d(),Oe&&Oe.d(),r[25](null),U(se),Le&&Le.d(),r[28](null),U(Pe),$=!1,Te(V)}}}function Wl(r,e,t){let n;ie(r,je,j=>t(29,n=j));let{routeUrl:i}=e,{schema:o}=e,s,a=new Rs(n),l=new Gs(n),u="edit-attribute",p,_,c,f,h,g,d;function y(j){let se={"edit-attribute":p,"edit-geometry":_,route:c,point:f,"free-polygon":h,"snap-polygon":g,"split-route":d};if(u==j){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),se[u].stop(),t(3,u=j),console.log(`Starting new mode ${u}`),se[u].start()}Et(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const m=()=>y("edit-attribute");function v(j){ne[j?"unshift":"push"](()=>{p=j,t(4,p)})}const b=()=>y("edit-geometry");function M(j){ne[j?"unshift":"push"](()=>{_=j,t(5,_)})}const O=()=>y("point");function x(j){ne[j?"unshift":"push"](()=>{f=j,t(7,f)})}const L=()=>y("free-polygon");function F(j){ne[j?"unshift":"push"](()=>{h=j,t(8,h)})}const I=()=>y("snap-polygon");function N(j){ne[j?"unshift":"push"](()=>{g=j,t(9,g)})}const W=()=>y("route");function P(j){ne[j?"unshift":"push"](()=>{c=j,t(6,c)})}function D(j){s=j,t(2,s)}const oe=()=>y("split-route");function fe(j){ne[j?"unshift":"push"](()=>{d=j,t(10,d)})}return r.$$set=j=>{"routeUrl"in j&&t(0,i=j.routeUrl),"schema"in j&&t(1,o=j.schema)},[i,o,s,u,p,_,c,f,h,g,d,a,l,y,m,v,b,M,O,x,L,F,I,N,W,P,D,oe,fe]}class Vl extends Z{constructor(e){super(),Q(this,e,Wl,zl,K,{routeUrl:0,schema:1})}}function Kl(r){let e,t,n,i,o,s,a,l,u,p,_,c,f,h,g,d,y,m,v;return{c(){e=k("div"),t=k("div"),n=k("button"),n.textContent="Home",i=T(),o=k("button"),o.textContent="About",s=T(),a=k("button"),a.textContent="Instructions",l=T(),u=k("br"),p=T(),_=k("label"),c=X(`ATIP schema:
      `),f=k("select"),h=k("option"),h.textContent="v1",g=k("option"),g.textContent="v2",d=k("option"),d.textContent="Housing developments",y=k("option"),y.textContent="Critical issues",C(n,"type","button"),C(o,"type","button"),C(a,"type","button"),h.__value="v1",h.value=h.__value,g.__value="v2",g.value=g.__value,d.__value="planning",d.value=d.__value,y.__value="criticals",y.value=y.__value,r[2]===void 0&&Wt(()=>r[11].call(f)),C(e,"slot","nav")},m(b,M){S(b,e,M),w(e,t),w(t,n),w(t,i),w(t,o),w(t,s),w(t,a),w(e,l),w(e,u),w(e,p),w(e,_),w(_,c),w(_,f),w(f,h),w(f,g),w(f,d),w(f,y),It(f,r[2]),m||(v=[B(n,"click",r[10]),B(o,"click",r[7]),B(a,"click",r[8]),B(f,"change",r[11]),B(f,"change",r[9])],m=!0)},p(b,M){M&4&&It(f,b[2])},d(b){b&&E(e),m=!1,Te(v)}}}function Zl(r){let e,t,n,i,o,s,a,l,u,p,_,c;return o=new _s({props:{boundaryGeojson:r[4]}}),a=new hs({props:{authorityName:r[5],schema:r[2]}}),_=new as({props:{schema:r[2]}}),{c(){e=k("div"),t=k("h1"),n=X(r[5]),i=T(),Y(o.$$.fragment),s=T(),Y(a.$$.fragment),l=T(),u=k("br"),p=T(),Y(_.$$.fragment),C(e,"slot","sidebar")},m(f,h){S(f,e,h),w(e,t),w(t,n),w(t,i),H(o,t,null),w(e,s),H(a,e,null),w(e,l),w(e,u),w(e,p),H(_,e,null),c=!0},p(f,h){const g={};h&16&&(g.boundaryGeojson=f[4]),o.$set(g);const d={};h&4&&(d.schema=f[2]),a.$set(d);const y={};h&4&&(y.schema=f[2]),_.$set(y)},i(f){c||(R(o.$$.fragment,f),R(a.$$.fragment,f),R(_.$$.fragment,f),c=!0)},o(f){A(o.$$.fragment,f),A(a.$$.fragment,f),A(_.$$.fragment,f),c=!1},d(f){f&&E(e),U(o),U(a),U(_)}}}function Ql(r){let e,t,n,i,o,s,a,l,u,p,_,c;return e=new mo({props:{boundaryGeojson:r[4]}}),n=new Ls({props:{schema:r[2]}}),o=new Ts({}),a=new Vl({props:{routeUrl:r[3],schema:r[2]}}),u=new bs({props:{style:r[6]}}),_=new Ms({props:{schema:r[2]}}),{c(){Y(e.$$.fragment),t=T(),Y(n.$$.fragment),i=T(),Y(o.$$.fragment),s=T(),Y(a.$$.fragment),l=T(),Y(u.$$.fragment),p=T(),Y(_.$$.fragment)},m(f,h){H(e,f,h),S(f,t,h),H(n,f,h),S(f,i,h),H(o,f,h),S(f,s,h),H(a,f,h),S(f,l,h),H(u,f,h),S(f,p,h),H(_,f,h),c=!0},p(f,h){const g={};h&16&&(g.boundaryGeojson=f[4]),e.$set(g);const d={};h&4&&(d.schema=f[2]),n.$set(d);const y={};h&8&&(y.routeUrl=f[3]),h&4&&(y.schema=f[2]),a.$set(y);const m={};h&4&&(m.schema=f[2]),_.$set(m)},i(f){c||(R(e.$$.fragment,f),R(n.$$.fragment,f),R(o.$$.fragment,f),R(a.$$.fragment,f),R(u.$$.fragment,f),R(_.$$.fragment,f),c=!0)},o(f){A(e.$$.fragment,f),A(n.$$.fragment,f),A(o.$$.fragment,f),A(a.$$.fragment,f),A(u.$$.fragment,f),A(_.$$.fragment,f),c=!1},d(f){U(e,f),f&&E(t),U(n,f),f&&E(i),U(o,f),f&&E(s),U(a,f),f&&E(l),U(u,f),f&&E(p),U(_,f)}}}function ea(r){let e,t,n;return t=new Fi({props:{style:r[6],$$slots:{default:[Ql]},$$scope:{ctx:r}}}),{c(){e=k("div"),Y(t.$$.fragment),C(e,"slot","main")},m(i,o){S(i,e,o),H(t,e,null),n=!0},p(i,o){const s={};o&131100&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(R(t.$$.fragment,i),n=!0)},o(i){A(t.$$.fragment,i),n=!1},d(i){i&&E(e),U(t)}}}function ta(r){let e,t,n,i,o,s,a,l;e=new qi({props:{$$slots:{main:[ea],sidebar:[Zl],nav:[Kl]},$$scope:{ctx:r}}});function u(f){r[12](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new Li({props:p}),ne.push(()=>we(n,"open",u,r[0]));function _(f){r[13](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Ai({props:c}),ne.push(()=>we(s,"open",_,r[1])),{c(){Y(e.$$.fragment),t=T(),Y(n.$$.fragment),o=T(),Y(s.$$.fragment)},m(f,h){H(e,f,h),S(f,t,h),H(n,f,h),S(f,o,h),H(s,f,h),l=!0},p(f,[h]){const g={};h&131100&&(g.$$scope={dirty:h,ctx:f}),e.$set(g);const d={};!i&&h&1&&(i=!0,d.open=f[0],ke(()=>i=!1)),n.$set(d);const y={};!a&&h&2&&(a=!0,y.open=f[1],ke(()=>a=!1)),s.$set(y)},i(f){l||(R(e.$$.fragment,f),R(n.$$.fragment,f),R(s.$$.fragment,f),l=!0)},o(f){A(e.$$.fragment,f),A(n.$$.fragment,f),A(s.$$.fragment,f),l=!1},d(f){U(e,f),f&&E(t),U(n,f),f&&E(o),U(s,f)}}}function na(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${a}.bin`;o||(p=`https://atip.uk/route-snappers-dev/${a}.bin`);function _(){t(0,n=!n),t(1,i=!1)}function c(){t(1,i=!i),t(0,n=!1)}let f;Sn(async()=>{t(4,f=await h())});async function h(){const M=await(await fetch(Ci)).text(),O=JSON.parse(M);return O.features=O.features.filter(x=>{var L;return((L=x.properties)==null?void 0:L.name)==a}),O}function g(){let b=new URLSearchParams(window.location.search);b.set("schema",u);let M=`${window.location.pathname}?${b.toString()}${window.location.hash}`;window.location.href=M}const d=()=>window.open("index.html");function y(){u=xr(this),t(2,u)}function m(b){n=b,t(0,n)}function v(b){i=b,t(1,i)}return[n,i,u,p,f,a,l,_,c,g,d,y,m,v]}class ra extends Z{constructor(e){super(),Q(this,e,na,ta,K,{})}}new ra({target:document.getElementById("app")});
