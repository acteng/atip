var Yo=Object.defineProperty;var Jo=(r,e,t)=>e in r?Yo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var oe=(r,e,t)=>(Jo(r,typeof e!="symbol"?e+"":e,t),t);import{S as Q,i as ee,s as Z,M as Xo,b as le,a as Ee,d as B,m as j,k as Me,n as $,o as C,q as D,e as E,c as R,g as w,x as H,p as k,y as De,f as L,z as he,B as de,C as Wo,D as gn,E as En,F as Dt,G as ft,H as ct,I as pt,J as ht,K as pr,h as S,l as U,L as Vo,N as Ko,O as ae,P as Zo,w as Zn,Q as tt,R as ve,T as _n,t as V,U as me,V as ce,j as Le,r as Ce,W as Pe,X as ao,Y as uo,Z as qt,_ as mt,$ as nn,a0 as hr,a1 as Qo,a2 as ei,a3 as Te,a4 as ti,a5 as ni,a6 as In,a7 as rn,a8 as fo,a9 as bn,aa as yt,ab as yn,ac as xt,ad as vn,ae as Pn,af as ri,ag as dt,ah as Qn,ai as We,aj as gt,ak as oi,al as er,am as ii,an as si,ao as li,ap as dr,aq as on,ar as ai,as as ui,at as fi,A as ci,u as pi}from"./authorities-e6733802.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const co=Symbol("Comlink.proxy"),hi=Symbol("Comlink.endpoint"),di=Symbol("Comlink.releaseProxy"),Mn=Symbol("Comlink.finalizer"),Xt=Symbol("Comlink.thrown"),po=r=>typeof r=="object"&&r!==null||typeof r=="function",mi={canHandle:r=>po(r)&&r[co],serialize(r){const{port1:e,port2:t}=new MessageChannel;return tr(r,e),[t,[t]]},deserialize(r){return r.start(),go(r)}},gi={canHandle:r=>po(r)&&Xt in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},ho=new Map([["proxy",mi],["throw",gi]]);function _i(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function tr(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!_i(t,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:s,path:a}=Object.assign({path:[]},o.data),l=(o.data.argumentList||[]).map(Ze);let u;try{const p=a.slice(0,-1).reduce((c,f)=>c[f],r),m=a.reduce((c,f)=>c[f],r);switch(s){case"GET":u=m;break;case"SET":p[a.slice(-1)[0]]=Ze(o.data.value),u=!0;break;case"APPLY":u=m.apply(p,l);break;case"CONSTRUCT":{const c=new m(...l);u=Si(c)}break;case"ENDPOINT":{const{port1:c,port2:f}=new MessageChannel;tr(r,f),u=ki(c,[c])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[Xt]:0}}Promise.resolve(u).catch(p=>({value:p,[Xt]:0})).then(p=>{const[m,c]=an(p);e.postMessage(Object.assign(Object.assign({},m),{id:i}),c),s==="RELEASE"&&(e.removeEventListener("message",n),mo(e),Mn in r&&typeof r[Mn]=="function"&&r[Mn]())}).catch(p=>{const[m,c]=an({value:new TypeError("Unserializable return value"),[Xt]:0});e.postMessage(Object.assign(Object.assign({},m),{id:i}),c)})}),e.start&&e.start()}function bi(r){return r.constructor.name==="MessagePort"}function mo(r){bi(r)&&r.close()}function go(r,e){return xn(r,[],e)}function zt(r){if(r)throw new Error("Proxy has been released and is not useable")}function _o(r){return lt(r,{type:"RELEASE"}).then(()=>{mo(r)})}const sn=new WeakMap,ln="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(sn.get(r)||0)-1;sn.set(r,e),e===0&&_o(r)});function yi(r,e){const t=(sn.get(e)||0)+1;sn.set(e,t),ln&&ln.register(r,e,r)}function vi(r){ln&&ln.unregister(r)}function xn(r,e=[],t=function(){}){let n=!1;const o=new Proxy(t,{get(i,s){if(zt(n),s===di)return()=>{vi(o),_o(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>o};const a=lt(r,{type:"GET",path:e.map(l=>l.toString())}).then(Ze);return a.then.bind(a)}return xn(r,[...e,s])},set(i,s,a){zt(n);const[l,u]=an(a);return lt(r,{type:"SET",path:[...e,s].map(p=>p.toString()),value:l},u).then(Ze)},apply(i,s,a){zt(n);const l=e[e.length-1];if(l===hi)return lt(r,{type:"ENDPOINT"}).then(Ze);if(l==="bind")return xn(r,e.slice(0,-1));const[u,p]=mr(a);return lt(r,{type:"APPLY",path:e.map(m=>m.toString()),argumentList:u},p).then(Ze)},construct(i,s){zt(n);const[a,l]=mr(s);return lt(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(Ze)}});return yi(o,r),o}function wi(r){return Array.prototype.concat.apply([],r)}function mr(r){const e=r.map(an);return[e.map(t=>t[0]),wi(e.map(t=>t[1]))]}const bo=new WeakMap;function ki(r,e){return bo.set(r,e),r}function Si(r){return Object.assign(r,{[co]:!0})}function an(r){for(const[e,t]of ho)if(t.canHandle(r)){const[n,o]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:r},bo.get(r)||[]]}function Ze(r){switch(r.type){case"HANDLER":return ho.get(r.name).deserialize(r.value);case"RAW":return r.value}}function lt(r,e,t){return new Promise(n=>{const o=Ei();r.addEventListener("message",function i(s){!s.data||!s.data.id||s.data.id!==o||(r.removeEventListener("message",i),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:o},e),t)})}function Ei(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Mi(){return new Worker("/atip/assets/worker-727833d3.js")}let se;const yo=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&yo.decode();let Et=null;function Ct(){return(Et===null||Et.byteLength===0)&&(Et=new Uint8Array(se.memory.buffer)),Et}function Mt(r,e){return r=r>>>0,yo.decode(Ct().subarray(r,r+e))}const Ge=new Array(128).fill(void 0);Ge.push(void 0,null,!0,!1);let At=Ge.length;function ge(r){At===Ge.length&&Ge.push(Ge.length+1);const e=At;return At=Ge[e],Ge[e]=r,e}function X(r){return Ge[r]}let et=0;const Wt=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},$i=typeof Wt.encodeInto=="function"?function(r,e){return Wt.encodeInto(r,e)}:function(r,e){const t=Wt.encode(r);return e.set(t),{read:r.length,written:t.length}};function $n(r,e,t){if(t===void 0){const a=Wt.encode(r),l=e(a.length)>>>0;return Ct().subarray(l,l+a.length).set(a),et=a.length,l}let n=r.length,o=e(n)>>>0;const i=Ct();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;i[o+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),o=t(o,n,n=s+r.length*3)>>>0;const a=Ct().subarray(o+s,o+n),l=$i(r,a);s+=l.written}return et=s,o}function wt(r){return r==null}let $t=null;function ke(){return($t===null||$t.byteLength===0)&&($t=new Int32Array(se.memory.buffer)),$t}function Oi(r){r<132||(Ge[r]=At,At=r)}function Fn(r){const e=X(r);return Oi(r),e}let Ot=null;function Li(){return(Ot===null||Ot.byteLength===0)&&(Ot=new Float64Array(se.memory.buffer)),Ot}let Lt=null;function Ci(){return(Lt===null||Lt.byteLength===0)&&(Lt=new BigInt64Array(se.memory.buffer)),Lt}function Nn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let i="[";o>0&&(i+=Nn(r[0]));for(let s=1;s<o;s++)i+=", "+Nn(r[s]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ai(r,e){const t=e(r.length*1)>>>0;return Ct().set(r,t/1),et=r.length,t}function On(r,e){try{return r.apply(this,e)}catch(t){se.__wbindgen_exn_store(ge(t))}}let Bn=class{static __wrap(e){e=e>>>0;const t=Object.create(Bn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();se.__wbg_routeinfo_free(e)}constructor(e){try{const i=se.__wbindgen_add_to_stack_pointer(-16),s=Ai(e,se.__wbindgen_malloc),a=et;se.routeinfo_new(i,s,a);var t=ke()[i/4+0],n=ke()[i/4+1],o=ke()[i/4+2];if(o)throw Fn(n);return Bn.__wrap(t)}finally{se.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const p=se.__wbindgen_add_to_stack_pointer(-16);se.routeinfo_nameForRoute(p,this.__wbg_ptr,ge(e));var o=ke()[p/4+0],i=ke()[p/4+1],s=ke()[p/4+2],a=ke()[p/4+3],l=o,u=i;if(a)throw l=0,u=0,Fn(s);return t=l,n=u,Mt(l,u)}finally{se.__wbindgen_add_to_stack_pointer(16),se.__wbindgen_free(t,n)}}};async function Ri(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ti(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Mt(e,t);return ge(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=X(t),o=typeof n=="string"?n:void 0;var i=wt(o)?0:$n(o,se.__wbindgen_malloc,se.__wbindgen_realloc),s=et;ke()[e/4+1]=s,ke()[e/4+0]=i},r.wbg.__wbindgen_object_drop_ref=function(e){Fn(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Mt(e,t));return ge(n)},r.wbg.__wbindgen_boolean_get=function(e){const t=X(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof X(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return ge(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return X(e)===X(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=X(t),o=typeof n=="number"?n:void 0;Li()[e/8+1]=wt(o)?0:o,ke()[e/4+0]=!wt(o)},r.wbg.__wbindgen_is_object=function(e){const t=X(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return X(e)in X(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ge(t)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return X(e)==X(t)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=X(t).stack,o=$n(n,se.__wbindgen_malloc,se.__wbindgen_realloc),i=et;ke()[e/4+1]=i,ke()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(Mt(e,t))}finally{se.__wbindgen_free(n,o)}},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(X(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=X(e)[t>>>0];return ge(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return X(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof X(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=X(e).next;return ge(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return On(function(e){const t=X(e).next();return ge(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return X(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=X(e).value;return ge(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return ge(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return On(function(e,t){const n=Reflect.get(X(e),X(t));return ge(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return On(function(e,t){const n=X(e).call(X(t));return ge(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(X(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=X(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(X(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(X(e));return ge(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=X(e).buffer;return ge(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(X(e));return ge(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){X(e).set(X(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return X(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=X(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=X(t),o=typeof n=="bigint"?n:void 0;Ci()[e/8+1]=wt(o)?BigInt(0):o,ke()[e/4+0]=!wt(o)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Nn(X(t)),o=$n(n,se.__wbindgen_malloc,se.__wbindgen_realloc),i=et;ke()[e/4+1]=i,ke()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Mt(e,t))},r.wbg.__wbindgen_memory=function(){const e=se.memory;return ge(e)},r}function Ii(r,e){return se=r.exports,vo.__wbindgen_wasm_module=e,Lt=null,Ot=null,$t=null,Et=null,se}async function vo(r){if(se!==void 0)return se;typeof r>"u"&&(r="/atip/assets/route_info_bg.wasm");const e=Ti();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Ri(await r,e);return Ii(t,n)}class Pi{constructor(){oe(this,"inner");this.inner=null}async loadFile(e){await vo(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new Bn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.nameForRoute(e)}}tr(Pi);function xi(r){let e,t,n,o,i,s,a,l,u,p,m,c,f;return{c(){e=E("p"),e.textContent="For each intervention:",t=R(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,o=R(),i=E("p"),i.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=R(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=R(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=R(),m=E("p"),m.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=R(),f=E("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(d,_){w(d,e,_),w(d,t,_),w(d,n,_),w(d,o,_),w(d,i,_),w(d,s,_),w(d,a,_),w(d,l,_),w(d,u,_),w(d,p,_),w(d,m,_),w(d,c,_),w(d,f,_)},p:H,d(d){d&&k(e),d&&k(t),d&&k(n),d&&k(o),d&&k(i),d&&k(s),d&&k(a),d&&k(l),d&&k(u),d&&k(p),d&&k(m),d&&k(c),d&&k(f)}}}function Fi(r){let e,t,n;function o(s){r[1](s)}let i={title:"Instructions",$$slots:{default:[xi]},$$scope:{ctx:r}};return r[0]!==void 0&&(i.open=r[0]),e=new Xo({props:i}),le.push(()=>Ee(e,"open",o,r[0])),{c(){B(e.$$.fragment)},m(s,a){j(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Ni(r,e,t){let{open:n}=e;function o(i){n=i,t(0,n)}return r.$$set=i=>{"open"in i&&t(0,n=i.open)},[n,o]}class Bi extends Q{constructor(e){super(),ee(this,e,Ni,Fi,Z,{open:0})}}const nt=[];function vt(r,e=H){let t;const n=new Set;function o(a){if(Z(r,a)&&(r=a,t)){const l=!nt.length;for(const u of n)u[1](),nt.push(u,r);if(l){for(let u=0;u<nt.length;u+=2)nt[u][0](nt[u+1]);nt.length=0}}}function i(a){o(a(r))}function s(a,l=H){const u=[a,l];return n.add(u),n.size===1&&(t=e(o)||H),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:o,update:i,subscribe:s}}const qe=vt(null),te=vt(De()),Se=vt(null),Be=vt(null),Ft=vt(null),Nt=vt(null);function Ut(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function gr(r){console.log(`Deleting intervention ${r}`),te.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Se.set(null),Be.set(null),Ft.set(null),Nt.set(null)}function _r(r){let e;const t=r[4].default,n=ft(t,r,r[3],null);return{c(){n&&n.c()},m(o,i){n&&n.m(o,i),e=!0},p(o,i){n&&n.p&&(!e||i&8)&&ct(n,t,o,o[3],e?ht(t,o[3],i,null):pt(o[3]),null)},i(o){e||($(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function ji(r){let e,t,n=r[1]&&_r(r);return{c(){e=E("div"),n&&n.c(),L(e,"class","map svelte-12dpf1u")},m(o,i){w(o,e,i),n&&n.m(e,null),r[5](e),t=!0},p(o,[i]){o[1]?n?(n.p(o,i),i&2&&$(n,1)):(n=_r(o),n.c(),$(n,1),n.m(e,null)):n&&(he(),C(n,1,1,()=>{n=null}),de())},i(o){t||($(n),t=!0)},o(o){C(n),t=!1},d(o){o&&k(e),n&&n.d(),r[5](null)}}}function Di(r,e,t){let{$$slots:n={},$$scope:o}=e,{style:i}=e,s,a,l=!1;Wo("setCamera",!window.location.hash),gn(()=>{s=new En.Map({container:a,style:`https://api.maptiler.com/maps/${i}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new En.ScaleControl({})),s.addControl(new En.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),qe.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),Dt(()=>{s.remove()});function u(p){le[p?"unshift":"push"](()=>{a=p,t(0,a)})}return r.$$set=p=>{"style"in p&&t(2,i=p.style),"$$scope"in p&&t(3,o=p.$$scope)},[a,l,i,o,n,u]}class qi extends Q{constructor(e){super(),ee(this,e,Di,ji,Z,{style:2})}}const Ui=r=>({}),br=r=>({}),Gi=r=>({}),yr=r=>({}),Hi=r=>({}),vr=r=>({});function zi(r){let e,t,n,o,i,s,a,l,u,p,m,c;const f=r[3].nav,d=ft(f,r,r[2],vr),_=r[3].sidebar,g=ft(_,r,r[2],yr),y=r[3].main,h=ft(y,r,r[2],br);return{c(){e=E("aside"),t=E("div"),n=E("nav"),d&&d.c(),o=R(),g&&g.c(),i=R(),s=E("button"),s.textContent="→",l=R(),u=E("main"),h&&h.c(),L(n,"class","svelte-1u7vg8a"),L(t,"class","sidebar-content content-container svelte-1u7vg8a"),L(s,"type","button"),L(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),L(e,"class",a=pr(r[0]?"":"collapsed")+" svelte-1u7vg8a"),L(u,"class","svelte-1u7vg8a")},m(b,v){w(b,e,v),S(e,t),S(t,n),d&&d.m(n,null),S(t,o),g&&g.m(t,null),S(e,i),S(e,s),w(b,l,v),w(b,u,v),h&&h.m(u,null),p=!0,m||(c=U(s,"click",r[1]),m=!0)},p(b,[v]){d&&d.p&&(!p||v&4)&&ct(d,f,b,b[2],p?ht(f,b[2],v,Hi):pt(b[2]),vr),g&&g.p&&(!p||v&4)&&ct(g,_,b,b[2],p?ht(_,b[2],v,Gi):pt(b[2]),yr),(!p||v&1&&a!==(a=pr(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&L(e,"class",a),h&&h.p&&(!p||v&4)&&ct(h,y,b,b[2],p?ht(y,b[2],v,Ui):pt(b[2]),br)},i(b){p||($(d,b),$(g,b),$(h,b),p=!0)},o(b){C(d,b),C(g,b),C(h,b),p=!1},d(b){b&&k(e),d&&d.d(b),g&&g.d(b),b&&k(l),b&&k(u),h&&h.d(b),m=!1,c()}}}function Yi(r,e,t){let{$$slots:n={},$$scope:o}=e,i=!0;function s(){t(0,i=!i)}return r.$$set=a=>{"$$scope"in a&&t(2,o=a.$$scope)},[i,s,o,n]}class Ji extends Q{constructor(e){super(),ee(this,e,Yi,zi,Z,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Xi(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,o=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){t.label=u[1];break}if(u[0]===6&&t.label<i[1]){t.label=i[1],i=u;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(u);break}i[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ke=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Wi(r,e){return r>e?1:r<e?-1:0}function ze(r,e,t){for(var n=new Ke(null,null),o=n,i=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}i.left=e,i=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}o.right=e,o=e,e=e.right}else break}return o.right=e.left,i.left=e.right,e.left=n.right,e.right=n.left,e}function Ln(r,e,t,n){var o=new Ke(r,e);if(t===null)return o.left=o.right=null,o;t=ze(r,t,n);var i=n(r,t.key);return i<0?(o.left=t.left,o.right=t,t.left=null):i>=0&&(o.right=t.right,o.left=t,t.right=null),o}function wr(r,e,t){var n=null,o=null;if(e){e=ze(r,e,t);var i=t(e.key,r);i===0?(n=e.left,o=e.right):i<0?(o=e.right,e.right=null,n=e):(n=e.left,e.left=null,o=e)}return{left:n,right:o}}function Vi(r,e,t){return e===null?r:(r===null||(e=ze(r.key,e,t),e.left=r),e)}function jn(r,e,t,n,o){if(r){n(""+e+(t?"└── ":"├── ")+o(r)+`
`);var i=e+(t?"    ":"│   ");r.left&&jn(r.left,i,!1,n,o),r.right&&jn(r.right,i,!0,n,o)}}var nr=function(){function r(e){e===void 0&&(e=Wi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Ln(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ke(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var o=this._comparator,i=ze(e,this._root,o),s=o(e,i.key);return s===0?this._root=i:(s<0?(n.left=i.left,n.right=i,i.left=null):s>0&&(n.right=i.right,n.left=i,i.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var o;if(t===null)return null;t=ze(e,t,n);var i=n(e,t.key);return i===0?(t.left===null?o=t.right:(o=ze(e,t.left,n),o.right=t.right),this._size--,o):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ze(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return t;o<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ze(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return!0;o<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,o=[],i=!1;!i;)n!==null?(o.push(n),n=n.left):o.length!==0?(n=o.pop(),e.call(t,n),n=n.right):i=!0;return this},r.prototype.range=function(e,t,n,o){for(var i=[],s=this._comparator,a=this._root,l;i.length!==0||a;)if(a)i.push(a),a=a.left;else{if(a=i.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(o,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,o=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),o===e)return t;o++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var o=this._comparator;t;){var i=o(e.key,t.key);if(i===0)break;i<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var o=this._comparator;t;){var i=o(e.key,t.key);if(i===0)break;i<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Zi(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var o=e.length,i=this._comparator;if(n&&Un(e,t,0,o-1,i),this._root===null)this._root=Dn(e,t,0,o),this._size=o;else{var s=Qi(this.toList(),Ki(e,t),i);o=this._size+o,this._root=qn({head:s},0,o)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return jn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var o=this._comparator,i=wr(e,this._root,o),s=i.left,a=i.right;o(e,t)<0?a=Ln(t,n,a,o):s=Ln(t,n,s,o),this._root=Vi(s,a,o)},r.prototype.split=function(e){return wr(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Xi(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Dn(r,e,t,n){var o=n-t;if(o>0){var i=t+Math.floor(o/2),s=r[i],a=e[i],l=new Ke(s,a);return l.left=Dn(r,e,t,i),l.right=Dn(r,e,i+1,n),l}return null}function Ki(r,e){for(var t=new Ke(null,null),n=t,o=0;o<r.length;o++)n=n.next=new Ke(r[o],e[o]);return n.next=null,t.next}function Zi(r){for(var e=r,t=[],n=!1,o=new Ke(null,null),i=o;!n;)e?(t.push(e),e=e.left):t.length>0?(e=i=i.next=t.pop(),e=e.right):n=!0;return i.next=null,o.next}function qn(r,e,t){var n=t-e;if(n>0){var o=e+Math.floor(n/2),i=qn(r,e,o),s=r.head;return s.left=i,r.head=r.head.next,s.right=qn(r,o+1,t),s}return null}function Qi(r,e,t){for(var n=new Ke(null,null),o=n,i=r,s=e;i!==null&&s!==null;)t(i.key,s.key)<0?(o.next=i,i=i.next):(o.next=s,s=s.next),o=o.next;return i!==null?o.next=i:s!==null&&(o.next=s),n.next}function Un(r,e,t,n,o){if(!(t>=n)){for(var i=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(o(r[s],i)<0);do a--;while(o(r[a],i)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Un(r,e,t,a,o),Un(r,e,a+1,n,o)}}function Ae(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function kr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function $e(r,e,t){return e&&kr(r.prototype,e),t&&kr(r,t),r}var kt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Gn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,o=e.ur.x<t.ur.x?e.ur.x:t.ur.x,i=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:i},ur:{x:o,y:s}}},Je=Number.EPSILON;Je===void 0&&(Je=Math.pow(2,-52));var es=Je*Je,Hn=function(e,t){if(-Je<e&&e<Je&&-Je<t&&t<Je)return 0;var n=e-t;return n*n<es*e*t?0:e<t?-1:1},ts=function(){function r(){Ae(this,r),this.reset()}return $e(r,[{key:"reset",value:function(){this.xRounder=new Sr,this.yRounder=new Sr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Sr=function(){function r(){Ae(this,r),this.tree=new nr,this.round(0)}return $e(r,[{key:"round",value:function(t){var n=this.tree.add(t),o=this.tree.prev(n);if(o!==null&&Hn(n.key,o.key)===0)return this.tree.remove(t),o.key;var i=this.tree.next(n);return i!==null&&Hn(n.key,i.key)===0?(this.tree.remove(t),i.key):t}}]),r}(),Bt=new ts,Rt=function(e,t){return e.x*t.y-e.y*t.x},wo=function(e,t){return e.x*t.x+e.y*t.y},Er=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y},s=Rt(o,i);return Hn(s,0)},un=function(e){return Math.sqrt(wo(e,e))},ns=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return Rt(i,o)/un(i)/un(o)},rs=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return wo(i,o)/un(i)/un(o)},Mr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},$r=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},os=function(e,t,n,o){if(t.x===0)return $r(n,o,e.x);if(o.x===0)return $r(e,t,n.x);if(t.y===0)return Mr(n,o,e.y);if(o.y===0)return Mr(e,t,n.y);var i=Rt(t,o);if(i==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=Rt(s,t)/i,l=Rt(s,o)/i,u=e.x+l*t.x,p=n.x+a*o.x,m=e.y+l*t.y,c=n.y+a*o.y,f=(u+p)/2,d=(m+c)/2;return{x:f,y:d}},Ne=function(){$e(r,null,[{key:"compare",value:function(t,n){var o=r.comparePoints(t.point,n.point);return o!==0?o:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:fn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Ae(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return $e(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,o=0,i=n.length;o<i;o++){var s=n[o];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var o=this.point.events[n];if(o.segment.consumedBy===void 0)for(var i=n+1;i<t;i++){var s=this.point.events[i];s.consumedBy===void 0&&o.otherSE.point.events===s.otherSE.point.events&&o.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,o=this.point.events.length;n<o;n++){var i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,o=new Map,i=function(a){var l=a.otherSE;o.set(a,{sine:ns(n.point,t.point,l.point),cosine:rs(n.point,t.point,l.point)})};return function(s,a){o.has(s)||i(s),o.has(a)||i(a);var l=o.get(s),u=l.sine,p=l.cosine,m=o.get(a),c=m.sine,f=m.cosine;return u>=0&&c>=0?p<f?1:p>f?-1:0:u<0&&c<0?p<f?-1:p>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),is=0,fn=function(){$e(r,null,[{key:"compare",value:function(t,n){var o=t.leftSE.point.x,i=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<o)return 1;if(s<i)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,m=n.rightSE.point.y;if(o<i){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(o>i){if(l<u&&l<m)return-1;if(l>u&&l>m)return 1;var d=n.comparePoint(t.leftSE.point);if(d!==0)return d;var _=t.comparePoint(n.rightSE.point);return _<0?1:_>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var g=n.comparePoint(t.rightSE.point);if(g!==0)return g}if(s>a){var y=t.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(s!==a){var h=p-l,b=s-o,v=m-u,M=a-i;if(h>b&&v<M)return 1;if(h<b&&v>M)return-1}return s>a?1:s<a||p<m?-1:p>m?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,o){Ae(this,r),this.id=++is,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=o}return $e(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,o=this.rightSE.point,i=this.vector();if(n.x===o.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/i.y,a=n.x+s*i.x;if(t.x===a)return 0;var l=(t.x-n.x)/i.x,u=n.y+l*i.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),o=t.bbox(),i=Gn(n,o);if(i===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=kt(n,l)&&this.comparePoint(l)===0,m=kt(o,s)&&t.comparePoint(s)===0,c=kt(n,u)&&this.comparePoint(u)===0,f=kt(o,a)&&t.comparePoint(a)===0;if(m&&p)return f&&!c?a:!f&&c?u:null;if(m)return c&&s.x===u.x&&s.y===u.y?null:s;if(p)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var d=os(s,this.vector(),l,t.vector());return d===null||!kt(i,d)?null:Bt.round(d.x,d.y)}},{key:"split",value:function(t){var n=[],o=t.events!==void 0,i=new Ne(t,!0),s=new Ne(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(i);var l=new r(i,a,this.rings.slice(),this.windings.slice());return Ne.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ne.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(i.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,o=this.windings.length;n<o;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,o=t;n.consumedBy;)n=n.consumedBy;for(;o.consumedBy;)o=o.consumedBy;var i=r.compare(n,o);if(i!==0){if(i>0){var s=n;n=o,o=s}if(n.prev===o){var a=n;n=o,o=a}for(var l=0,u=o.rings.length;l<u;l++){var p=o.rings[l],m=o.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(m)):n.windings[c]+=m}o.rings=null,o.windings=null,o.consumedBy=n,o.leftSE.consumedBy=n.leftSE,o.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,o=this._afterState.windings,i=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),o.push(u)):o[p]+=u}for(var m=[],c=[],f=0,d=n.length;f<d;f++)if(o[f]!==0){var _=n[f],g=_.poly;if(c.indexOf(g)===-1)if(_.isExterior)m.push(g);else{c.indexOf(g)===-1&&c.push(g);var y=m.indexOf(_.poly);y!==-1&&m.splice(y,1)}}for(var h=0,b=m.length;h<b;h++){var v=m[h].multiPoly;i.indexOf(v)===-1&&i.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ie.type){case"union":{var o=t.length===0,i=n.length===0;this._isInResult=o!==i;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Ie.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(m){return m.length===1&&m[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ie.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,o){var i,s,a,l=Ne.comparePoints(t,n);if(l<0)i=t,s=n,a=1;else if(l>0)i=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Ne(i,!0),p=new Ne(s,!1);return new r(u,p,[o],[a])}}]),r}(),Or=function(){function r(e,t,n){if(Ae(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=Bt.round(e[0][0],e[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var i=o,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Bt.round(e[s][0],e[s][1]);l.x===i.x&&l.y===i.y||(this.segments.push(fn.fromRing(i,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),i=l)}(o.x!==i.x||o.y!==i.y)&&this.segments.push(fn.fromRing(i,o,this))}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,o=this.segments.length;n<o;n++){var i=this.segments[n];t.push(i.leftSE),t.push(i.rightSE)}return t}}]),r}(),ss=function(){function r(e,t){if(Ae(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Or(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,o=e.length;n<o;n++){var i=new Or(e[n],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,o=this.interiorRings.length;n<o;n++)for(var i=this.interiorRings[n].getSweepEvents(),s=0,a=i.length;s<a;s++)t.push(i[s]);return t}}]),r}(),Lr=function(){function r(e,t){if(Ae(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,o=e.length;n<o;n++){var i=new ss(e[n],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,o=this.polys.length;n<o;n++)for(var i=this.polys[n].getSweepEvents(),s=0,a=i.length;s<a;s++)t.push(i[s]);return t}}]),r}(),ls=function(){$e(r,null,[{key:"factory",value:function(t){for(var n=[],o=0,i=t.length;o<i;o++){var s=t[o];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],m=l.point,c=[];a=l,l=u,p.push(l),l.point!==m;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var d=p[0].point,_=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(_.x,", ").concat(_.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var g=null,y=0,h=c.length;y<h;y++)if(c[y].point===l.point){g=y;break}if(g!==null){var b=c.splice(g)[0],v=p.splice(b.index);v.unshift(v[0].otherSE),n.push(new r(v.reverse()));continue}c.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Ae(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return $e(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],o=1,i=this.events.length-1;o<i;o++){var s=this.events[o].point,a=this.events[o+1].point;Er(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Er(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],d=m;d!=c;d+=p)f.push([n[d].x,n[d].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,o=this.events.length;n<o;n++){var i=this.events[n];Ne.compare(t,i)>0&&(t=i)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Cr=function(){function r(e){Ae(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return $e(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,o=this.interiorRings.length;n<o;n++){var i=this.interiorRings[n].getGeom();i!==null&&t.push(i)}return t}}]),r}(),as=function(){function r(e){Ae(this,r),this.rings=e,this.polys=this._composePolys(e)}return $e(r,[{key:"getGeom",value:function(){for(var t=[],n=0,o=this.polys.length;n<o;n++){var i=this.polys[n].getGeom();i!==null&&t.push(i)}return t}},{key:"_composePolys",value:function(t){for(var n=[],o=0,i=t.length;o<i;o++){var s=t[o];if(!s.poly)if(s.isExteriorRing())n.push(new Cr(s));else{var a=s.enclosingRing();a.poly||n.push(new Cr(a)),a.poly.addInterior(s)}}return n}}]),r}(),us=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fn.compare;Ae(this,r),this.queue=e,this.tree=new nr(t),this.segments=[]}return $e(r,[{key:"process",value:function(t){var n=t.segment,o=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),o;var i=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!i)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=i,a=i,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var m=l.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(p=m),!l.isAnEndpoint(m)))for(var c=this._splitSafely(l,m),f=0,d=c.length;f<d;f++)o.push(c[f])}var _=null;if(u){var g=u.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(_=g),!u.isAnEndpoint(g)))for(var y=this._splitSafely(u,g),h=0,b=y.length;h<b;h++)o.push(y[h])}if(p!==null||_!==null){var v=null;if(p===null)v=_;else if(_===null)v=p;else{var M=Ne.comparePoints(p,_);v=M<=0?p:_}this.queue.remove(n.rightSE),o.push(n.rightSE);for(var O=n.split(v),I=0,A=O.length;I<A;I++)o.push(O[I])}o.length>0?(this.tree.remove(n),o.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var x=l.getIntersection(u);if(x!==null){if(!l.isAnEndpoint(x))for(var T=this._splitSafely(l,x),N=0,W=T.length;N<W;N++)o.push(T[N]);if(!u.isAnEndpoint(x))for(var P=this._splitSafely(u,x),z=0,ie=P.length;z<ie;z++)o.push(P[z])}}this.tree.remove(n)}return o}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var o=t.rightSE;this.queue.remove(o);var i=t.split(n);return i.push(o),t.consumedBy===void 0&&this.tree.insert(t),i}}]),r}(),Ar=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,fs=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,cs=function(){function r(){Ae(this,r)}return $e(r,[{key:"run",value:function(t,n,o){Ie.type=t,Bt.reset();for(var i=[new Lr(n,!0)],s=0,a=o.length;s<a;s++)i.push(new Lr(o[s],!1));if(Ie.numMultiPolys=i.length,Ie.type==="difference")for(var l=i[0],u=1;u<i.length;)Gn(i[u].bbox,l.bbox)!==null?u++:i.splice(u,1);if(Ie.type==="intersection"){for(var p=0,m=i.length;p<m;p++)for(var c=i[p],f=p+1,d=i.length;f<d;f++)if(Gn(c.bbox,i[f].bbox)===null)return[]}for(var _=new nr(Ne.compare),g=0,y=i.length;g<y;g++)for(var h=i[g].getSweepEvents(),b=0,v=h.length;b<v;b++)if(_.insert(h[b]),_.size>Ar)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new us(_),O=_.size,I=_.pop();I;){var A=I.key;if(_.size===O){var x=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(x.id," ")+"[".concat(x.leftSE.point.x,", ").concat(x.leftSE.point.y,"] -> ")+"[".concat(x.rightSE.point.x,", ").concat(x.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(_.size>Ar)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>fs)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var T=M.process(A),N=0,W=T.length;N<W;N++){var P=T[N];P.consumedBy===void 0&&_.insert(P)}O=_.size,I=_.pop()}Bt.reset();var z=ls.factory(M.segments),ie=new as(z);return ie.getGeom()}}]),r}(),Ie=new cs,ps=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Ie.run("union",e,n)},hs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Ie.run("intersection",e,n)},ds=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Ie.run("xor",e,n)},ms=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Ie.run("difference",e,n)},Vt={union:ps,intersection:hs,xor:ds,difference:ms};function gs(r,e){var t=bs(e),n=null;return r.type==="FeatureCollection"?n=_s(r):n=ko(Vt.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(o){t.geometry.coordinates.push(o[0])}),t}function _s(r){var e=r.features.length===2?Vt.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Vt.union.apply(Vt,r.features.map(function(t){return t.geometry.coordinates}));return ko(e)}function ko(r){return Vo(r)}function bs(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return Ko(t)}function ys(r,e,t){let n;ae(r,qe,s=>t(1,n=s));let{boundaryGeojson:o}=e;return Zo("setCamera")&&n.fitBounds(Zn(o),{padding:20,animate:!1}),tt(n,"boundary",{type:"geojson",data:gs(o)}),ve(n,{id:"boundary",source:"boundary",..._n("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,o=s.boundaryGeojson)},[o]}class vs extends Q{constructor(e){super(),ee(this,e,ys,null,Z,{boundaryGeojson:0})}}function Rr(r){let e,t=Tr(r[3])+"",n,o,i,s,a,l;return{c(){e=V("Length: "),n=V(t),o=R(),i=E("br"),s=E("button"),s.textContent="Auto-fill details",L(s,"type","button")},m(u,p){w(u,e,p),w(u,n,p),w(u,o,p),w(u,i,p),w(u,s,p),a||(l=U(s,"click",r[14]),a=!0)},p(u,p){p&8&&t!==(t=Tr(u[3])+"")&&Pe(n,t)},d(u){u&&k(e),u&&k(n),u&&k(o),u&&k(i),u&&k(s),a=!1,l()}}}function ws(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,_,g,y,h,b,v,M,O,I,A,x,T,N,W,P,z,ie,we,Re,re,ne,xe,Oe,K,pe,ye=r[3]&&Rr(r);return{c(){e=E("label"),t=V("Name:"),n=E("br"),o=R(),i=E("input"),s=R(),a=E("br"),l=R(),u=E("br"),p=R(),m=E("label"),c=E("input"),f=V(`
  Area`),d=R(),_=E("label"),g=E("input"),y=V(`
  Route`),h=R(),b=E("label"),v=E("input"),M=V(`
  Crossing`),O=R(),I=E("label"),A=E("input"),x=V(`
  Other`),T=R(),N=E("br"),W=R(),P=E("br"),z=R(),ie=E("label"),we=V("Description:"),Re=E("br"),re=R(),ne=E("textarea"),xe=R(),ye&&ye.c(),Oe=me(),L(i,"type","text"),ce(i,"width","100%"),L(c,"type","radio"),c.__value="area",c.value=c.__value,r[9][0].push(c),L(g,"type","radio"),g.__value="route",g.value=g.__value,r[9][0].push(g),L(v,"type","radio"),v.__value="crossing",v.value=v.__value,r[9][0].push(v),L(A,"type","radio"),A.__value="other",A.value=A.__value,r[9][0].push(A),ce(ne,"width","100%"),L(ne,"rows","5"),L(ne,"class","svelte-15lna0i")},m(F,G){w(F,e,G),S(e,t),S(e,n),S(e,o),S(e,i),Le(i,r[0]),w(F,s,G),w(F,a,G),w(F,l,G),w(F,u,G),w(F,p,G),w(F,m,G),S(m,c),c.checked=c.__value===r[1],S(m,f),w(F,d,G),w(F,_,G),S(_,g),g.checked=g.__value===r[1],S(_,y),w(F,h,G),w(F,b,G),S(b,v),v.checked=v.__value===r[1],S(b,M),w(F,O,G),w(F,I,G),S(I,A),A.checked=A.__value===r[1],S(I,x),w(F,T,G),w(F,N,G),w(F,W,G),w(F,P,G),w(F,z,G),w(F,ie,G),S(ie,we),S(ie,Re),S(ie,re),S(ie,ne),Le(ne,r[2]),w(F,xe,G),ye&&ye.m(F,G),w(F,Oe,G),K||(pe=[U(i,"input",r[7]),U(c,"change",r[8]),U(g,"change",r[10]),U(v,"change",r[11]),U(A,"change",r[12]),U(ne,"input",r[13])],K=!0)},p(F,[G]){G&1&&i.value!==F[0]&&Le(i,F[0]),G&2&&(c.checked=c.__value===F[1]),G&2&&(g.checked=g.__value===F[1]),G&2&&(v.checked=v.__value===F[1]),G&2&&(A.checked=A.__value===F[1]),G&4&&Le(ne,F[2]),F[3]?ye?ye.p(F,G):(ye=Rr(F),ye.c(),ye.m(Oe.parentNode,Oe)):ye&&(ye.d(1),ye=null)},i:H,o:H,d(F){F&&k(e),F&&k(s),F&&k(a),F&&k(l),F&&k(u),F&&k(p),F&&k(m),r[9][0].splice(r[9][0].indexOf(c),1),F&&k(d),F&&k(_),r[9][0].splice(r[9][0].indexOf(g),1),F&&k(h),F&&k(b),r[9][0].splice(r[9][0].indexOf(v),1),F&&k(O),F&&k(I),r[9][0].splice(r[9][0].indexOf(A),1),F&&k(T),F&&k(N),F&&k(W),F&&k(P),F&&k(z),F&&k(ie),F&&k(xe),ye&&ye.d(F),F&&k(Oe),K=!1,Ce(pe)}}}function Tr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function ks(r,e,t){let n;ae(r,te,b=>t(15,n=b));let{routeInfo:o}=e,{id:i}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function p(){let b=n.features.find(v=>v.id==i);try{t(0,s=await o.nameForRoute(b))}catch(v){window.alert(`Couldn't auto-name route: ${v}`)}}const m=[[]];function c(){s=this.value,t(0,s)}function f(){a=this.__value,t(1,a)}function d(){a=this.__value,t(1,a)}function _(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function y(){l=this.value,t(2,l)}const h=()=>p();return r.$$set=b=>{"routeInfo"in b&&t(5,o=b.routeInfo),"id"in b&&t(6,i=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(3,u=b.length_meters)},[s,a,l,u,p,o,i,c,f,m,d,_,g,y,h]}class Ss extends Q{constructor(e){super(),ee(this,e,ks,ws,Z,{routeInfo:5,id:6,name:0,intervention_type:1,description:2,length_meters:3})}}const Es="Intervention",Ms=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],$s={name:Es,oneOf:Ms};function Os(r){const e=r-1;return e*e*e+1}function _t(r,{delay:e=0,duration:t=400,easing:n=Os}={}){const o=getComputedStyle(r),i=+o.opacity,s=parseFloat(o.height),a=parseFloat(o.paddingTop),l=parseFloat(o.paddingBottom),u=parseFloat(o.marginTop),p=parseFloat(o.marginBottom),m=parseFloat(o.borderTopWidth),c=parseFloat(o.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*i};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*p}px;border-top-width: ${f*m}px;border-bottom-width: ${f*c}px;`}}function So(r){return"members"in r}function Eo(r){return"oneOf"in r}function Mo(r){return typeof r=="string"}function $o(r){return typeof r=="object"&&"value"in r}function Ls(r){return"type"in r&&r.type=="number"}function Oo(r){return"type"in r&&r.type=="one-liner"}function Lo(r){return"type"in r&&r.type=="textbox"}function Co(r){return"type"in r&&r.type=="checkbox"}function Ir(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Pr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function xr(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=V(t),L(e,"class","svelte-1b72l00")},m(o,i){w(o,e,i),S(e,n)},p(o,i){i&2&&t!==(t=o[1].description+"")&&Pe(n,t)},d(o){o&&k(e)}}}function Cs(r){let e,t,n;return{c(){e=E("input"),L(e,"type","checkbox")},m(o,i){w(o,e,i),e.checked=r[0],t||(n=U(e,"change",r[14]),t=!0)},p(o,i){i&1&&(e.checked=o[0])},i:H,o:H,d(o){o&&k(e),t=!1,n()}}}function As(r){let e,t,n;return{c(){e=E("textarea"),ce(e,"width","100%"),L(e,"rows","5"),L(e,"class","svelte-1b72l00")},m(o,i){w(o,e,i),Le(e,r[0]),t||(n=U(e,"input",r[13]),t=!0)},p(o,i){i&1&&Le(e,o[0])},i:H,o:H,d(o){o&&k(e),t=!1,n()}}}function Rs(r){let e,t,n;return{c(){e=E("input"),L(e,"type","text"),ce(e,"width","100%")},m(o,i){w(o,e,i),Le(e,r[0]),t||(n=U(e,"input",r[12]),t=!0)},p(o,i){i&1&&e.value!==o[0]&&Le(e,o[0])},i:H,o:H,d(o){o&&k(e),t=!1,n()}}}function Ts(r){let e,t,n;return{c(){e=E("input"),L(e,"type","number")},m(o,i){w(o,e,i),Le(e,r[0]),t||(n=U(e,"input",r[11]),t=!0)},p(o,i){i&1&&ao(e.value)!==o[0]&&Le(e,o[0])},i:H,o:H,d(o){o&&k(e),t=!1,n()}}}function Is(r){let e,t,n=r[1].oneOf,o=[];for(let s=0;s<n.length;s+=1)o[s]=Nr(Ir(r,n,s));const i=s=>C(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=me()},m(s,a){for(let l=0;l<o.length;l+=1)o[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Ir(s,n,l);o[l]?(o[l].p(u,a),$(o[l],1)):(o[l]=Nr(u),o[l].c(),$(o[l],1),o[l].m(e.parentNode,e))}for(he(),l=n.length;l<o.length;l+=1)i(l);de()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)C(o[a]);t=!1},d(s){uo(o,s),s&&k(e)}}}function Ps(r){let e,t,n=r[1].members,o=[];for(let s=0;s<n.length;s+=1)o[s]=Br(Pr(r,n,s));const i=s=>C(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=me()},m(s,a){for(let l=0;l<o.length;l+=1)o[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Pr(s,n,l);o[l]?(o[l].p(u,a),$(o[l],1)):(o[l]=Br(u),o[l].c(),$(o[l],1),o[l].m(e.parentNode,e))}for(he(),l=n.length;l<o.length;l+=1)i(l);de()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)C(o[a]);t=!1},d(s){uo(o,s),s&&k(e)}}}function xs(r){let e,t,n,o,i=r[15].name+"",s,a,l,u,p,m,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&Fr(r);return{c(){e=E("label"),t=E("input"),o=R(),s=V(i),a=E("br"),l=R(),f&&f.c(),u=me(),L(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(d,_){w(d,e,_),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),w(d,l,_),f&&f.m(d,_),w(d,u,_),p=!0,m||(c=[U(t,"change",r[9]),U(t,"change",r[4])],m=!0)},p(d,_){(!p||_&2&&n!==(n=d[15].name))&&(t.__value=n,t.value=t.__value),_&4&&(t.checked=t.__value===d[2]),(!p||_&2)&&i!==(i=d[15].name+"")&&Pe(s,i),d[2]==d[15].name&&typeof d[0]=="object"?f?(f.p(d,_),_&7&&$(f,1)):(f=Fr(d),f.c(),$(f,1),f.m(u.parentNode,u)):f&&(he(),C(f,1,1,()=>{f=null}),de())},i(d){p||($(f),p=!0)},o(d){C(f),p=!1},d(d){d&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),d&&k(l),f&&f.d(d),d&&k(u),m=!1,Ce(c)}}}function Fs(r){let e,t,n,o,i=r[15].value+"",s,a,l,u,p;function m(d,_){return d[15].description?js:Bs}let c=m(r),f=c(r);return{c(){e=E("label"),t=E("input"),o=R(),s=V(i),a=R(),f.c(),l=R(),L(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(d,_){w(d,e,_),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),f.m(e,null),S(e,l),u||(p=[U(t,"change",r[8]),U(t,"change",r[3])],u=!0)},p(d,_){_&2&&n!==(n=d[15].value)&&(t.__value=n,t.value=t.__value),_&4&&(t.checked=t.__value===d[2]),_&2&&i!==(i=d[15].value+"")&&Pe(s,i),c===(c=m(d))&&f?f.p(d,_):(f.d(1),f=c(d),f&&(f.c(),f.m(e,l)))},i:H,o:H,d(d){d&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Ce(p)}}}function Ns(r){let e,t,n,o,i=r[15]+"",s,a,l,u,p,m;return{c(){e=E("label"),t=E("input"),o=R(),s=V(i),a=R(),l=E("br"),u=R(),L(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){w(c,e,f),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),S(e,l),S(e,u),p||(m=[U(t,"change",r[6]),U(t,"change",r[3])],p=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&i!==(i=c[15]+"")&&Pe(s,i)},i:H,o:H,d(c){c&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,Ce(m)}}}function Fr(r){let e,t,n,o,i,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Gt({props:l}),le.push(()=>Ee(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),B(t.$$.fragment),o=R(),L(e,"class","svelte-1b72l00")},m(u,p){w(u,e,p),j(t,e,null),S(e,o),s=!0},p(u,p){r=u;const m={};p&2&&(m.spec=r[15]),!n&&p&3&&(n=!0,m.value=r[0][r[15].name],Me(()=>n=!1)),t.$set(m)},i(u){s||($(t.$$.fragment,u),qt(()=>{i||(i=mt(e,_t,{duration:500},!0)),i.run(1)}),s=!0)},o(u){C(t.$$.fragment,u),i||(i=mt(e,_t,{duration:500},!1)),i.run(0),s=!1},d(u){u&&k(e),D(t),u&&i&&i.end()}}}function Bs(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function js(r){let e,t,n=r[15].description+"",o,i;return{c(){e=E("p"),t=V("("),o=V(n),i=V(")"),L(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,o),S(e,i)},p(s,a){a&2&&n!==(n=s[15].description+"")&&Pe(o,n)},d(s){s&&k(e)}}}function Nr(r){let e,t,n,o,i,s;const a=[Ns,Fs,xs],l=[];function u(p,m){return m&2&&(e=null),m&2&&(t=null),e==null&&(e=!!Mo(p[15])),e?0:(t==null&&(t=!!$o(p[15])),t?1:2)}return n=u(r,-1),o=l[n]=a[n](r),{c(){o.c(),i=me()},m(p,m){l[n].m(p,m),w(p,i,m),s=!0},p(p,m){let c=n;n=u(p,m),n===c?l[n].p(p,m):(he(),C(l[c],1,1,()=>{l[c]=null}),de(),o=l[n],o?o.p(p,m):(o=l[n]=a[n](p),o.c()),$(o,1),o.m(i.parentNode,i))},i(p){s||($(o),s=!0)},o(p){C(o),s=!1},d(p){l[n].d(p),p&&k(i)}}}function Br(r){let e,t,n=r[15].name+"",o,i,s,a,l,u;function p(c){r[5](c,r[15])}let m={spec:r[15]};return r[0][r[15].name]!==void 0&&(m.value=r[0][r[15].name]),s=new Gt({props:m}),le.push(()=>Ee(s,"value",p,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),o=V(n),i=R(),B(s.$$.fragment),l=R(),L(e,"class","svelte-1b72l00")},m(c,f){w(c,e,f),S(e,t),S(t,o),S(e,i),j(s,e,null),S(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&Pe(o,n);const d={};f&2&&(d.spec=r[15]),!a&&f&3&&(a=!0,d.value=r[0][r[15].name],Me(()=>a=!1)),s.$set(d)},i(c){u||($(s.$$.fragment,c),u=!0)},o(c){C(s.$$.fragment,c),u=!1},d(c){c&&k(e),D(s)}}}function Ds(r){let e,t,n,o,i,s,a,l,u,p,m,c=r[1].description&&xr(r);const f=[Ps,Is,Ts,Rs,As,Cs],d=[];function _(g,y){return y&2&&(t=null),y&2&&(n=null),y&2&&(o=null),y&2&&(i=null),y&2&&(s=null),y&2&&(a=null),t==null&&(t=!!So(g[1])),t?0:(n==null&&(n=!!Eo(g[1])),n?1:(o==null&&(o=!!Ls(g[1])),o?2:(i==null&&(i=!!Oo(g[1])),i?3:(s==null&&(s=!!Lo(g[1])),s?4:(a==null&&(a=!!Co(g[1])),a?5:-1)))))}return~(l=_(r,-1))&&(u=d[l]=f[l](r)),{c(){c&&c.c(),e=R(),u&&u.c(),p=me()},m(g,y){c&&c.m(g,y),w(g,e,y),~l&&d[l].m(g,y),w(g,p,y),m=!0},p(g,[y]){g[1].description?c?c.p(g,y):(c=xr(g),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let h=l;l=_(g,y),l===h?~l&&d[l].p(g,y):(u&&(he(),C(d[h],1,1,()=>{d[h]=null}),de()),~l?(u=d[l],u?u.p(g,y):(u=d[l]=f[l](g),u.c()),$(u,1),u.m(p.parentNode,p)):u=null)},i(g){m||($(u),m=!0)},o(g){C(u),m=!1},d(g){c&&c.d(g),g&&k(e),~l&&d[l].d(g),g&&k(p)}}}function qs(r,e,t){var h,b,v;let{spec:n}=e,{value:o}=e,i="";if(So(n)){o||(o={});for(let M of n.members)Oo(M)||Lo(M)?o[h=M.name]||(o[h]=""):Co(M)?o[b=M.name]||(o[b]=!1):o[v=M.name]||(o[v]={})}else Eo(n)&&(o||(o={}),Mo(o)?i=o:$o(o)?i=o.value:i=Object.keys(o)[0]||"");function s(){t(0,o=i)}function a(){t(0,o={}),t(0,o[i]={},o)}const l=[[]];function u(M,O){r.$$.not_equal(o[O.name],M)&&(o[O.name]=M,t(0,o))}function p(){i=this.__value,t(2,i)}function m(){i=this.__value,t(2,i)}function c(){i=this.__value,t(2,i)}function f(M,O){r.$$.not_equal(o[O.name],M)&&(o[O.name]=M,t(0,o))}function d(){o=ao(this.value),t(0,o)}function _(){o=this.value,t(0,o)}function g(){o=this.value,t(0,o)}function y(){o=this.checked,t(0,o)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,o=M.value)},[o,n,i,s,a,u,p,l,m,c,f,d,_,g,y]}class Gt extends Q{constructor(e){super(),ee(this,e,qs,Ds,Z,{spec:1,value:0})}}function Us(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].v2!==void 0&&(i.value=r[0].v2),e=new Gt({props:i}),le.push(()=>Ee(e,"value",o,r[0].v2)),{c(){B(e.$$.fragment)},m(s,a){j(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Gs(r,e,t){let{props:n}=e;n.v2||(n.v2={});let o=$s;function i(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class Hs extends Q{constructor(e){super(),ee(this,e,Gs,Us,Z,{props:0})}}const zs="Planning",Ys=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],Js={name:zs,members:Ys};function Xs(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].planning!==void 0&&(i.value=r[0].planning),e=new Gt({props:i}),le.push(()=>Ee(e,"value",o,r[0].planning)),{c(){B(e.$$.fragment)},m(s,a){j(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Ws(r,e,t){let{props:n}=e;n.planning||(n.planning={});let o=Js;function i(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class Vs extends Q{constructor(e){super(),ee(this,e,Ws,Xs,Z,{props:0})}}const Ks="CriticalIssue",Zs=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],Qs={name:Ks,members:Zs};function el(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].criticals!==void 0&&(i.value=r[0].criticals),e=new Gt({props:i}),le.push(()=>Ee(e,"value",o,r[0].criticals)),{c(){B(e.$$.fragment)},m(s,a){j(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function tl(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let o=Qs;function i(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class nl extends Q{constructor(e){super(),ee(this,e,tl,el,Z,{props:0})}}function jr(r){let e,t,n,o,i;const s=r[10].default,a=ft(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),ce(e,"border","solid 1px black"),ce(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,o||(i=U(e,"introend",r[14]),o=!0)},p(l,u){a&&a.p&&(!n||u&512)&&ct(a,s,l,l[9],n?ht(s,l[9],u,null):pt(l[9]),null)},i(l){n||($(a,l),qt(()=>{t||(t=mt(e,_t,{duration:100},!0)),t.run(1)}),n=!0)},o(l){C(a,l),t||(t=mt(e,_t,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),o=!1,i()}}}function rl(r){let e,t,n,o,i,s,a,l,u,p,m=r[4]&&jr(r);return{c(){e=E("button"),t=nn("svg"),n=nn("path"),o=R(),i=V(r[1]),s=R(),m&&m.c(),a=me(),L(n,"d","M9 5l7 7-7 7"),L(t,"style","tran"),L(t,"width","20"),L(t,"height","20"),L(t,"fill","none"),L(t,"stroke-linecap","round"),L(t,"stroke-linejoin","round"),L(t,"stroke-width","2"),L(t,"viewBox","0 0 24 24"),L(t,"stroke","currentColor"),L(t,"class","svelte-t7fpgu"),L(e,"aria-expanded",r[4]),L(e,"class","svelte-t7fpgu"),hr(e,"underlined",r[3])},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,o),S(e,i),w(c,s,f),m&&m.m(c,f),w(c,a,f),l=!0,u||(p=[U(e,"click",r[5]),U(e,"mouseenter",r[11]),U(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&Pe(i,c[1]),(!l||f&16)&&L(e,"aria-expanded",c[4]),(!l||f&8)&&hr(e,"underlined",c[3]),c[4]?m?(m.p(c,f),f&16&&$(m,1)):(m=jr(c),m.c(),$(m,1),m.m(a.parentNode,a)):m&&(he(),C(m,1,1,()=>{m=null}),de())},i(c){l||($(m),l=!0)},o(c){C(m),l=!1},d(c){c&&k(e),c&&k(s),m&&m.d(c),c&&k(a),u=!1,Ce(p)}}}function ol(r,e,t){let n,o,i,s;ae(r,Be,h=>t(7,i=h)),ae(r,Se,h=>t(8,s=h));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const m=()=>{Se.update(h=>h==u?null:u),s==u&&(Nt.set(null),Nt.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const d=()=>Ft.set(u),_=()=>Ft.set(null);function g(h){le[h?"unshift":"push"](()=>{c=h,t(2,c)})}const y=()=>f();return r.$$set=h=>{"id"in h&&t(0,u=h.id),"label"in h&&t(1,p=h.label),"$$scope"in h&&t(9,l=h.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,o=i==u)},[u,p,c,o,n,m,f,i,s,l,a,d,_,g,y]}class il extends Q{constructor(e){super(),ee(this,e,ol,rl,Z,{id:0,label:1})}}function Dr(r,e,t){const n=r.slice();return n[14]=e[t],n[15]=e,n[16]=t,n}function sl(r){let e,t,n;function o(s){r[10](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new nl({props:i}),le.push(()=>Ee(e,"props",o,r[14].properties)),{c(){B(e.$$.fragment)},m(s,a){j(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function ll(r){let e,t,n;function o(s){r[9](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new Vs({props:i}),le.push(()=>Ee(e,"props",o,r[14].properties)),{c(){B(e.$$.fragment)},m(s,a){j(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function al(r){let e,t,n;function o(s){r[8](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new Hs({props:i}),le.push(()=>Ee(e,"props",o,r[14].properties)),{c(){B(e.$$.fragment)},m(s,a){j(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function ul(r){let e,t,n,o,i;function s(p){r[5](p,r[14])}function a(p){r[6](p,r[14])}function l(p){r[7](p,r[14])}let u={routeInfo:r[1],id:r[14].id,length_meters:r[14].properties.length_meters};return r[14].properties.name!==void 0&&(u.name=r[14].properties.name),r[14].properties.intervention_type!==void 0&&(u.intervention_type=r[14].properties.intervention_type),r[14].properties.description!==void 0&&(u.description=r[14].properties.description),e=new Ss({props:u}),le.push(()=>Ee(e,"name",s,r[14].properties.name)),le.push(()=>Ee(e,"intervention_type",a,r[14].properties.intervention_type)),le.push(()=>Ee(e,"description",l,r[14].properties.description)),{c(){B(e.$$.fragment)},m(p,m){j(e,p,m),i=!0},p(p,m){r=p;const c={};m&2&&(c.routeInfo=r[1]),m&4&&(c.id=r[14].id),m&4&&(c.length_meters=r[14].properties.length_meters),!t&&m&4&&(t=!0,c.name=r[14].properties.name,Me(()=>t=!1)),!n&&m&4&&(n=!0,c.intervention_type=r[14].properties.intervention_type,Me(()=>n=!1)),!o&&m&4&&(o=!0,c.description=r[14].properties.description,Me(()=>o=!1)),e.$set(c)},i(p){i||($(e.$$.fragment,p),i=!0)},o(p){C(e.$$.fragment,p),i=!1},d(p){D(e,p)}}}function fl(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,_;const g=[ul,al,ll,sl],y=[];function h(v,M){return v[0]=="v1"?0:v[0]=="v2"?1:v[0]=="planning"?2:v[0]=="criticals"?3:-1}~(e=h(r))&&(t=y[e]=g[e](r));function b(){return r[11](r[14])}return{c(){t&&t.c(),n=R(),o=E("br"),i=R(),s=E("br"),a=R(),l=E("div"),u=E("button"),u.textContent="Delete",p=R(),m=E("button"),m.textContent="Save",c=R(),L(u,"type","button"),L(m,"type","button"),ce(l,"display","flex"),ce(l,"justify-content","space-between")},m(v,M){~e&&y[e].m(v,M),w(v,n,M),w(v,o,M),w(v,i,M),w(v,s,M),w(v,a,M),w(v,l,M),S(l,u),S(l,p),S(l,m),w(v,c,M),f=!0,d||(_=[U(u,"click",b),U(m,"click",r[12])],d=!0)},p(v,M){r=v;let O=e;e=h(r),e===O?~e&&y[e].p(r,M):(t&&(he(),C(y[O],1,1,()=>{y[O]=null}),de()),~e?(t=y[e],t?t.p(r,M):(t=y[e]=g[e](r),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(v){f||($(t),f=!0)},o(v){C(t),f=!1},d(v){~e&&y[e].d(v),v&&k(n),v&&k(o),v&&k(i),v&&k(s),v&&k(a),v&&k(l),v&&k(c),d=!1,Ce(_)}}}function qr(r,e){let t,n,o;return n=new il({props:{id:e[14].id,label:e[16]+1+") "+e[3](e[14]),$$slots:{default:[fl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=me(),B(n.$$.fragment),this.first=t},m(i,s){w(i,t,s),j(n,i,s),o=!0},p(i,s){e=i;const a={};s&4&&(a.id=e[14].id),s&4&&(a.label=e[16]+1+") "+e[3](e[14])),s&131079&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(i){o||($(n.$$.fragment,i),o=!0)},o(i){C(n.$$.fragment,i),o=!1},d(i){i&&k(t),D(n,i)}}}function cl(r){let e=[],t=new Map,n,o,i,s,a=r[2].features;const l=u=>u[14].id;for(let u=0;u<a.length;u+=1){let p=Dr(r,a,u),m=l(p);t.set(m,e[u]=qr(m,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=me()},m(u,p){for(let m=0;m<e.length;m+=1)e[m].m(u,p);w(u,n,p),o=!0,i||(s=U(window,"keydown",r[4]),i=!0)},p(u,[p]){p&15&&(a=u[2].features,he(),e=Qo(e,p,l,1,u,a,t,n.parentNode,ei,qr,n,Dr),de())},i(u){if(!o){for(let p=0;p<a.length;p+=1)$(e[p]);o=!0}},o(u){for(let p=0;p<e.length;p+=1)C(e[p]);o=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&k(n),i=!1,s()}}}function pl(r,e,t){let n,o;ae(r,Se,y=>t(13,n=y)),ae(r,te,y=>t(2,o=y));let{schema:i}=e,{routeInfo:s}=e;function a(y){var b,v,M,O,I;if(i=="planning")return((b=y.properties.planning)==null?void 0:b.name)||"Untitled polygon";if(i=="v2")return((M=(v=y.properties.v2)==null?void 0:v.Route)==null?void 0:M.name)||((I=(O=y.properties.v2)==null?void 0:O.Crossing)==null?void 0:I.name)||"Untitled intervention";if(y.properties.name)return y.properties.name;var h=y.properties.intervention_type;return h=="other"&&(y.geometry.type=="Point"?h="point":y.geometry.type=="LineString"?h="line":h="polygon"),`Untitled ${h}`}function l(y){if(y.key=="Delete"){const h=y.target.tagName;if(h=="INPUT"||h=="TEXTAREA")return;y.preventDefault();const b=n;b&&gr(b)}}function u(y,h){r.$$.not_equal(h.properties.name,y)&&(h.properties.name=y,te.set(o))}function p(y,h){r.$$.not_equal(h.properties.intervention_type,y)&&(h.properties.intervention_type=y,te.set(o))}function m(y,h){r.$$.not_equal(h.properties.description,y)&&(h.properties.description=y,te.set(o))}function c(y,h){r.$$.not_equal(h.properties,y)&&(h.properties=y,te.set(o))}function f(y,h){r.$$.not_equal(h.properties,y)&&(h.properties=y,te.set(o))}function d(y,h){r.$$.not_equal(h.properties,y)&&(h.properties=y,te.set(o))}const _=y=>gr(y.id),g=()=>Se.set(null);return r.$$set=y=>{"schema"in y&&t(0,i=y.schema),"routeInfo"in y&&t(1,s=y.routeInfo)},[i,s,o,a,l,u,p,m,c,f,d,_,g]}class hl extends Q{constructor(e){super(),ee(this,e,pl,cl,Z,{schema:0,routeInfo:1})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function je(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function zn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ye(r,e,t){t===void 0&&(t={});var n=Ve(r),o=Ve(e),i=Te(o[1]-n[1]),s=Te(o[0]-n[0]),a=Te(n[1]),l=Te(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return ti(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Kt(r,e){return e===void 0&&(e={}),ni(r,function(t,n){var o=n.geometry.coordinates;return t+Ye(o[0],o[1],e)},0)}function dl(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,_,g,y,h,b,v=r[0].features.length+"",M,O,I,A,x,T,N,W;return{c(){e=E("div"),t=E("label"),n=V(`Scheme name:
    `),o=E("input"),i=R(),s=E("br"),a=R(),l=E("div"),u=E("label"),p=E("input"),m=R(),c=E("button"),c.textContent="Load from GeoJSON",f=R(),d=E("button"),d.textContent="Export to GeoJSON",_=R(),g=E("br"),y=R(),h=E("div"),b=E("span"),M=V(v),O=V(" objects"),I=R(),A=E("button"),x=V("Clear all"),L(o,"type","text"),L(p,"type","file"),L(p,"id","load_geojson"),L(p,"class","svelte-lhyd1e"),L(c,"type","button"),L(d,"type","button"),L(d,"class","align-right svelte-lhyd1e"),L(A,"type","button"),L(A,"class","align-right svelte-lhyd1e"),A.disabled=T=r[0].features.length==0},m(P,z){w(P,e,z),S(e,t),S(t,n),S(t,o),Le(o,r[0].scheme_name),w(P,i,z),w(P,s,z),w(P,a,z),w(P,l,z),S(l,u),S(u,p),S(u,m),S(u,c),S(l,f),S(l,d),w(P,_,z),w(P,g,z),w(P,y,z),w(P,h,z),S(h,b),S(b,M),S(b,O),S(h,I),S(h,A),S(A,x),N||(W=[U(o,"input",r[7]),U(p,"change",r[3]),U(c,"click",gl),U(d,"click",r[2]),U(A,"click",r[1])],N=!0)},p(P,[z]){z&1&&o.value!==P[0].scheme_name&&Le(o,P[0].scheme_name),z&1&&v!==(v=P[0].features.length+"")&&Pe(M,v),z&1&&T!==(T=P[0].features.length==0)&&(A.disabled=T)},i:H,o:H,d(P){P&&k(e),P&&k(i),P&&k(s),P&&k(a),P&&k(l),P&&k(_),P&&k(g),P&&k(y),P&&k(h),N=!1,Ce(W)}}}function ml(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function gl(){document.getElementById("load_geojson").click()}function _l(r,e,t){let n;ae(r,te,f=>t(0,n=f));let{authorityName:o}=e,{schema:i}=e,s=o;i!="v1"&&(s+=`_${i}`),gn(async()=>{let d=new URLSearchParams(window.location.search).get("geojsonUrl"),_=window.localStorage.getItem(s);if(d){console.log(`Loading GeoJSON from ${d}`);try{let y=await(await fetch(d)).text();te.set(m(JSON.parse(y)))}catch(g){console.log(`Failed to load from URL: ${g}`)}}else if(_)try{te.set(m(JSON.parse(_)))}catch(g){console.log(`Failed to load from local storage: ${g}`)}});function a(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(te.update(f=>(delete f.scheme_name,f.features=[],f)),Se.set(null),Be.set(null),Ft.set(null),Nt.set(null))}function l(){const f=JSON.parse(JSON.stringify(n));for(let d of f.features)delete d.properties.hide_while_editing;return f}function u(){let f=l();var d=s;f.authority=o,f.origin="atip-v1",f.scheme_name&&(d+="_"+f.scheme_name),d+=".txt",ml(d,JSON.stringify(f,null,"  "))}function p(f){const d=new FileReader;d.onload=g=>{try{te.set(m(JSON.parse(g.target.result)))}catch(y){window.alert(`Couldn't load scheme from a file: ${y}`)}};let _=f.target.files;d.readAsText(_[0])}function m(f){let d=1;for(let _ of f.features)_.properties||(_.properties={name:"",description:"",intervention_type:"other"}),_.geometry.type=="LineString"&&!_.properties.length_meters&&(_.properties.length_meters=Kt(_,{units:"kilometers"})*1e3),_.id=d++;return f}function c(){n.scheme_name=this.value,te.set(n)}return r.$$set=f=>{"authorityName"in f&&t(4,o=f.authorityName),"schema"in f&&t(5,i=f.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(l())))},[n,a,u,p,o,i,s,c]}class bl extends Q{constructor(e){super(),ee(this,e,_l,dl,Z,{authorityName:4,schema:5})}}const yl="/atip/assets/zoom_out_map-b2e1091a.svg";function vl(r){let e,t,n,o,i;return{c(){e=E("button"),t=E("img"),In(t.src,n=yl)||L(t,"src",n),L(t,"alt","Zoom to show entire boundary"),L(e,"type","button"),L(e,"title","Zoom to show entire boundary"),L(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),o||(i=U(e,"click",r[0]),o=!0)},p:H,i:H,o:H,d(s){s&&k(e),o=!1,i()}}}function wl(r,e,t){let n;ae(r,qe,s=>t(2,n=s));let{boundaryGeojson:o}=e;function i(){n.fitBounds(Zn(o),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,o=s.boundaryGeojson)},[i,o]}class kl extends Q{constructor(e){super(),ee(this,e,wl,vl,Z,{boundaryGeojson:1})}}function Sl(r){let e,t,n,o,i,s,a;return{c(){e=E("div"),t=V(`Basemap:
  `),n=E("select"),o=E("option"),o.textContent="Streets",i=E("option"),i.textContent="Satellite",o.__value="streets",o.value=o.__value,i.__value="hybrid",i.value=i.__value,r[0]===void 0&&qt(()=>r[2].call(n)),L(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,o),S(n,i),rn(n,r[0]),s||(a=[U(n,"change",r[2]),U(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&rn(n,l[0])},i:H,o:H,d(l){l&&k(e),s=!1,Ce(a)}}}function El(r,e,t){let{style:n}=e;function o(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function i(){n=fo(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,o,i]}class Ml extends Q{constructor(e){super(),ee(this,e,El,Sl,Z,{style:0})}}const fe={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},wn=10,cn=10;function Ur(r){let e,t,n;const o=r[3].default,i=ft(o,r,r[2],null);return{c(){e=E("div"),i&&i.c()},m(s,a){w(s,e,a),i&&i.m(e,null),n=!0},p(s,a){i&&i.p&&(!n||a&4)&&ct(i,o,s,s[2],n?ht(o,s[2],a,null):pt(s[2]),null)},i(s){n||($(i,s),qt(()=>{t||(t=mt(e,_t,{duration:100},!0)),t.run(1)}),n=!0)},o(s){C(i,s),t||(t=mt(e,_t,{duration:100},!1)),t.run(0),n=!1},d(s){s&&k(e),i&&i.d(s),s&&t&&t.end()}}}function $l(r){let e,t,n,o,i,s,a,l,u,p,m=r[0]&&Ur(r);return{c(){e=E("button"),t=nn("svg"),n=nn("path"),o=R(),i=V(r[1]),s=R(),m&&m.c(),a=me(),L(n,"d","M9 5l7 7-7 7"),L(t,"style","tran"),L(t,"width","20"),L(t,"height","20"),L(t,"fill","none"),L(t,"stroke-linecap","round"),L(t,"stroke-linejoin","round"),L(t,"stroke-width","2"),L(t,"viewBox","0 0 24 24"),L(t,"stroke","currentColor"),L(t,"class","svelte-una9lq"),L(e,"aria-expanded",r[0]),L(e,"class","svelte-una9lq")},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,o),S(e,i),w(c,s,f),m&&m.m(c,f),w(c,a,f),l=!0,u||(p=U(e,"click",r[4]),u=!0)},p(c,[f]){(!l||f&2)&&Pe(i,c[1]),(!l||f&1)&&L(e,"aria-expanded",c[0]),c[0]?m?(m.p(c,f),f&1&&$(m,1)):(m=Ur(c),m.c(),$(m,1),m.m(a.parentNode,a)):m&&(he(),C(m,1,1,()=>{m=null}),de())},i(c){l||($(m),l=!0)},o(c){C(m),l=!1},d(c){c&&k(e),c&&k(s),m&&m.d(c),c&&k(a),u=!1,p()}}}function Ol(r,e,t){let{$$slots:n={},$$scope:o}=e,{label:i}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,i=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,o=l.$$scope)},[s,i,o,n,a]}class kn extends Q{constructor(e){super(),ee(this,e,Ol,$l,Z,{label:1,open:0})}}function Ll(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,_;return{c(){e=E("li"),t=E("span"),n=V("Areas"),o=R(),i=E("li"),s=E("span"),a=V("Routes"),l=R(),u=E("li"),p=E("span"),m=V("Crossings"),c=R(),f=E("li"),d=E("span"),_=V("Other"),L(t,"class","svelte-l42ea0"),ce(t,"background",fe.area),L(s,"class","svelte-l42ea0"),ce(s,"background",fe.route),L(p,"class","svelte-l42ea0"),ce(p,"background",fe.crossing),L(d,"class","svelte-l42ea0"),ce(d,"background",fe.other)},m(g,y){w(g,e,y),S(e,t),S(e,n),w(g,o,y),w(g,i,y),S(i,s),S(i,a),w(g,l,y),w(g,u,y),S(u,p),S(u,m),w(g,c,y),w(g,f,y),S(f,d),S(f,_)},p:H,d(g){g&&k(e),g&&k(o),g&&k(i),g&&k(l),g&&k(u),g&&k(c),g&&k(f)}}}function Cl(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,_;return{c(){e=E("li"),t=E("span"),n=V("Preapp"),o=R(),i=E("li"),s=E("span"),a=V("Outline"),l=R(),u=E("li"),p=E("span"),m=V("Reserved matters"),c=R(),f=E("li"),d=E("span"),_=V("Local plan"),L(t,"class","svelte-l42ea0"),ce(t,"background",fe.preapp),L(s,"class","svelte-l42ea0"),ce(s,"background",fe.outline),L(p,"class","svelte-l42ea0"),ce(p,"background",fe["reserved matters"]),L(d,"class","svelte-l42ea0"),ce(d,"background",fe["local plan"])},m(g,y){w(g,e,y),S(e,t),S(e,n),w(g,o,y),w(g,i,y),S(i,s),S(i,a),w(g,l,y),w(g,u,y),S(u,p),S(u,m),w(g,c,y),w(g,f,y),S(f,d),S(f,_)},p:H,d(g){g&&k(e),g&&k(o),g&&k(i),g&&k(l),g&&k(u),g&&k(c),g&&k(f)}}}function Al(r){let e;function t(i,s){return i[0]=="planning"?Cl:Ll}let n=t(r),o=n(r);return{c(){e=E("ul"),o.c()},m(i,s){w(i,e,s),o.m(e,null)},p(i,s){n===(n=t(i))&&o?o.p(i,s):(o.d(1),o=n(i),o&&(o.c(),o.m(e,null)))},d(i){i&&k(e),o.d()}}}function Rl(r){let e,t,n;return t=new kn({props:{label:"Objects",open:!0,$$slots:{default:[Al]},$$scope:{ctx:r}}}),{c(){e=E("div"),B(t.$$.fragment),L(e,"class","svelte-l42ea0")},m(o,i){w(o,e,i),j(t,e,null),n=!0},p(o,[i]){const s={};i&3&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||($(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),D(t)}}}function Tl(r,e,t){let{schema:n}=e;return r.$$set=o=>{"schema"in o&&t(0,n=o.schema)},[n]}class Il extends Q{constructor(e){super(),ee(this,e,Tl,Rl,Z,{schema:0})}}let rt="interventions";function Pl(r,e,t){let n,o;ae(r,qe,p=>t(1,n=p)),ae(r,te,p=>t(2,o=p));let{schema:i}=e;tt(n,rt,{type:"geojson",data:o});const s=["match",["get","intervention_type"],"area",fe.area,"route",fe.route,"crossing",fe.crossing,"other",fe.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",fe.preapp,"outline",fe.outline,"reserved matters",fe["reserved matters"],"local plan",fe["local plan"],"white"],l=["!=","hide_while_editing",!0];return ve(n,{id:"interventions-points",source:rt,filter:["all",bn,l,["!=","endpoint",!0]],...yt(s,wn)}),ve(n,{id:"interventions-lines",source:rt,filter:["all",yn,l],...xt(s,cn)}),ve(n,{id:"interventions-lines-endpoints",source:rt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*cn,"circle-opacity":0,"circle-stroke-color":fe.lineEndpointColor,"circle-stroke-width":2}}),ve(n,{id:"interventions-polygons",source:rt,filter:["all",vn,l],..._n(i=="planning"?a:s,.5)}),r.$$set=p=>{"schema"in p&&t(0,i=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(o)),m=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])m.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(m),n.getSource(rt).setData(p)}},[i,n,o]}class xl extends Q{constructor(e){super(),ee(this,e,Pl,null,Z,{schema:0})}}let ot="hover";function Fl(r,e,t){let n,o,i,s,a;return ae(r,qe,l=>t(0,n=l)),ae(r,te,l=>t(1,o=l)),ae(r,Ft,l=>t(2,i=l)),ae(r,Be,l=>t(3,s=l)),ae(r,Se,l=>t(4,a=l)),tt(n,ot,{type:"geojson",data:De()}),ve(n,{id:"hover-polygons",source:ot,filter:vn,...xt(fe.hovering,.5*cn,1)}),ve(n,{id:"hover-lines",source:ot,filter:yn,...xt(fe.hovering,1.5*cn,1)}),ve(n,{id:"hover-points",source:ot,filter:bn,...yt(fe.hovering,1.5*wn,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||i;l!=null?n.getSource(ot).setData(o.features.find(u=>u.id==l)):n.getSource(ot).setData(De())}},[n,o,i,s,a]}class Nl extends Q{constructor(e){super(),ee(this,e,Fl,null,Z,{})}}class rr{constructor(e,t){oe(this,"owner");oe(this,"map");oe(this,"mapHandlers",{});oe(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Yt="edit-point-mode";class Bl{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"cursor");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new rr(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),tt(e,Yt,{type:"geojson",data:De()}),ve(e,{id:"edit-point-mode",source:Yt,...yt(fe.hovering,wn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=jl(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Yt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=De();this.cursor&&e.features.push(this.cursor),this.map.getSource(Yt).setData(e)}}function jl(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Ao(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Dl(r,e);var n=Ve(r),o=Ve(e),i=Te(n[0]),s=Te(o[0]),a=Te(n[1]),l=Te(o[1]),u=Math.sin(s-i)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-i);return Pn(Math.atan2(u,p))}function Dl(r,e){var t=Ao(e,r);return t=(t+180)%360,t}function Gr(r,e,t,n){n===void 0&&(n={});var o=Ve(r),i=Te(o[0]),s=Te(o[1]),a=Te(t),l=ri(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=i+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),m=Pn(p),c=Pn(u);return dt([m,c],n.properties)}function Yn(r){if(!r)throw new Error("geojson is required");var e=[];return Qn(r,function(t){ql(t,e)}),We(e)}function ql(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=je(n);break;case"LineString":t=[je(n)]}t.forEach(function(o){var i=Ul(o,r.properties);i.forEach(function(s){s.id=e.length,e.push(s)})})}}function Ul(r,e){var t=[];return r.reduce(function(n,o){var i=gt([n,o],e);return i.bbox=Gl(n,o),t.push(i),o}),t}function Gl(r,e){var t=r[0],n=r[1],o=e[0],i=e[1],s=t<o?t:o,a=n<i?n:i,l=t>o?t:o,u=n>i?n:i;return[s,a,l,u]}var bt={},Hl={get exports(){return bt},set exports(r){bt=r}},Jn={},zl={get exports(){return Jn},set exports(r){Jn=r}};(function(r,e){(function(t,n){r.exports=n()})(oi,function(){function t(h,b,v,M,O){(function I(A,x,T,N,W){for(;N>T;){if(N-T>600){var P=N-T+1,z=x-T+1,ie=Math.log(P),we=.5*Math.exp(2*ie/3),Re=.5*Math.sqrt(ie*we*(P-we)/P)*(z-P/2<0?-1:1),re=Math.max(T,Math.floor(x-z*we/P+Re)),ne=Math.min(N,Math.floor(x+(P-z)*we/P+Re));I(A,x,re,ne,W)}var xe=A[x],Oe=T,K=N;for(n(A,T,x),W(A[N],xe)>0&&n(A,T,N);Oe<K;){for(n(A,Oe,K),Oe++,K--;W(A[Oe],xe)<0;)Oe++;for(;W(A[K],xe)>0;)K--}W(A[T],xe)===0?n(A,T,K):n(A,++K,N),K<=x&&(T=K+1),x<=K&&(N=K-1)}})(h,b,v||0,M||h.length-1,O||o)}function n(h,b,v){var M=h[b];h[b]=h[v],h[v]=M}function o(h,b){return h<b?-1:h>b?1:0}var i=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(h,b,v){if(!v)return b.indexOf(h);for(var M=0;M<b.length;M++)if(v(h,b[M]))return M;return-1}function a(h,b){l(h,0,h.children.length,b,h)}function l(h,b,v,M,O){O||(O=g(null)),O.minX=1/0,O.minY=1/0,O.maxX=-1/0,O.maxY=-1/0;for(var I=b;I<v;I++){var A=h.children[I];u(O,h.leaf?M(A):A)}return O}function u(h,b){return h.minX=Math.min(h.minX,b.minX),h.minY=Math.min(h.minY,b.minY),h.maxX=Math.max(h.maxX,b.maxX),h.maxY=Math.max(h.maxY,b.maxY),h}function p(h,b){return h.minX-b.minX}function m(h,b){return h.minY-b.minY}function c(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function f(h){return h.maxX-h.minX+(h.maxY-h.minY)}function d(h,b){return h.minX<=b.minX&&h.minY<=b.minY&&b.maxX<=h.maxX&&b.maxY<=h.maxY}function _(h,b){return b.minX<=h.maxX&&b.minY<=h.maxY&&b.maxX>=h.minX&&b.maxY>=h.minY}function g(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(h,b,v,M,O){for(var I=[b,v];I.length;)if(!((v=I.pop())-(b=I.pop())<=M)){var A=b+Math.ceil((v-b)/M/2)*M;t(h,A,b,v,O),I.push(b,A,A,v)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(h){var b=this.data,v=[];if(!_(h,b))return v;for(var M=this.toBBox,O=[];b;){for(var I=0;I<b.children.length;I++){var A=b.children[I],x=b.leaf?M(A):A;_(h,x)&&(b.leaf?v.push(A):d(h,x)?this._all(A,v):O.push(A))}b=O.pop()}return v},i.prototype.collides=function(h){var b=this.data;if(!_(h,b))return!1;for(var v=[];b;){for(var M=0;M<b.children.length;M++){var O=b.children[M],I=b.leaf?this.toBBox(O):O;if(_(h,I)){if(b.leaf||d(h,I))return!0;v.push(O)}}b=v.pop()}return!1},i.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var b=0;b<h.length;b++)this.insert(h[b]);return this}var v=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var M=this.data;this.data=v,v=M}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},i.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},i.prototype.clear=function(){return this.data=g([]),this},i.prototype.remove=function(h,b){if(!h)return this;for(var v,M,O,I=this.data,A=this.toBBox(h),x=[],T=[];I||x.length;){if(I||(I=x.pop(),M=x[x.length-1],v=T.pop(),O=!0),I.leaf){var N=s(h,I.children,b);if(N!==-1)return I.children.splice(N,1),x.push(I),this._condense(x),this}O||I.leaf||!d(I,A)?M?(v++,I=M.children[v],O=!1):I=null:(x.push(I),T.push(v),v=0,M=I,I=I.children[0])}return this},i.prototype.toBBox=function(h){return h},i.prototype.compareMinX=function(h,b){return h.minX-b.minX},i.prototype.compareMinY=function(h,b){return h.minY-b.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(h){return this.data=h,this},i.prototype._all=function(h,b){for(var v=[];h;)h.leaf?b.push.apply(b,h.children):v.push.apply(v,h.children),h=v.pop();return b},i.prototype._build=function(h,b,v,M){var O,I=v-b+1,A=this._maxEntries;if(I<=A)return a(O=g(h.slice(b,v+1)),this.toBBox),O;M||(M=Math.ceil(Math.log(I)/Math.log(A)),A=Math.ceil(I/Math.pow(A,M-1))),(O=g([])).leaf=!1,O.height=M;var x=Math.ceil(I/A),T=x*Math.ceil(Math.sqrt(A));y(h,b,v,T,this.compareMinX);for(var N=b;N<=v;N+=T){var W=Math.min(N+T-1,v);y(h,N,W,x,this.compareMinY);for(var P=N;P<=W;P+=x){var z=Math.min(P+x-1,W);O.children.push(this._build(h,P,z,M-1))}}return a(O,this.toBBox),O},i.prototype._chooseSubtree=function(h,b,v,M){for(;M.push(b),!b.leaf&&M.length-1!==v;){for(var O=1/0,I=1/0,A=void 0,x=0;x<b.children.length;x++){var T=b.children[x],N=c(T),W=(P=h,z=T,(Math.max(z.maxX,P.maxX)-Math.min(z.minX,P.minX))*(Math.max(z.maxY,P.maxY)-Math.min(z.minY,P.minY))-N);W<I?(I=W,O=N<O?N:O,A=T):W===I&&N<O&&(O=N,A=T)}b=A||b.children[0]}var P,z;return b},i.prototype._insert=function(h,b,v){var M=v?h:this.toBBox(h),O=[],I=this._chooseSubtree(M,this.data,b,O);for(I.children.push(h),u(I,M);b>=0&&O[b].children.length>this._maxEntries;)this._split(O,b),b--;this._adjustParentBBoxes(M,O,b)},i.prototype._split=function(h,b){var v=h[b],M=v.children.length,O=this._minEntries;this._chooseSplitAxis(v,O,M);var I=this._chooseSplitIndex(v,O,M),A=g(v.children.splice(I,v.children.length-I));A.height=v.height,A.leaf=v.leaf,a(v,this.toBBox),a(A,this.toBBox),b?h[b-1].children.push(A):this._splitRoot(v,A)},i.prototype._splitRoot=function(h,b){this.data=g([h,b]),this.data.height=h.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(h,b,v){for(var M,O,I,A,x,T,N,W=1/0,P=1/0,z=b;z<=v-b;z++){var ie=l(h,0,z,this.toBBox),we=l(h,z,v,this.toBBox),Re=(O=ie,I=we,A=void 0,x=void 0,T=void 0,N=void 0,A=Math.max(O.minX,I.minX),x=Math.max(O.minY,I.minY),T=Math.min(O.maxX,I.maxX),N=Math.min(O.maxY,I.maxY),Math.max(0,T-A)*Math.max(0,N-x)),re=c(ie)+c(we);Re<W?(W=Re,M=z,P=re<P?re:P):Re===W&&re<P&&(P=re,M=z)}return M||v-b},i.prototype._chooseSplitAxis=function(h,b,v){var M=h.leaf?this.compareMinX:p,O=h.leaf?this.compareMinY:m;this._allDistMargin(h,b,v,M)<this._allDistMargin(h,b,v,O)&&h.children.sort(M)},i.prototype._allDistMargin=function(h,b,v,M){h.children.sort(M);for(var O=this.toBBox,I=l(h,0,b,O),A=l(h,v-b,v,O),x=f(I)+f(A),T=b;T<v-b;T++){var N=h.children[T];u(I,h.leaf?O(N):N),x+=f(I)}for(var W=v-b-1;W>=b;W--){var P=h.children[W];u(A,h.leaf?O(P):P),x+=f(A)}return x},i.prototype._adjustParentBBoxes=function(h,b,v){for(var M=v;M>=0;M--)u(b[M],h)},i.prototype._condense=function(h){for(var b=h.length-1,v=void 0;b>=0;b--)h[b].children.length===0?b>0?(v=h[b-1].children).splice(v.indexOf(h[b]),1):this.clear():a(h[b],this.toBBox)},i})})(zl);const Yl=er(ii),Jl=er(si),Xl=er(li);var Fe=Jn,Ro=Yl,To=Jl,it=Xl.default,Wl=To.featureEach;To.coordEach;Ro.polygon;var Hr=Ro.featureCollection;function Io(r){var e=new Fe(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:it(t),Fe.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:it(o),n.push(o)}):Wl(t,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:it(o),n.push(o)}),Fe.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:it(t),Fe.prototype.remove.call(this,t,n)},e.clear=function(){return Fe.prototype.clear.call(this)},e.search=function(t){var n=Fe.prototype.search.call(this,this.toBBox(t));return Hr(n)},e.collides=function(t){return Fe.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Fe.prototype.all.call(this);return Hr(t)},e.toJSON=function(){return Fe.prototype.toJSON.call(this)},e.fromJSON=function(t){return Fe.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=it(t);else if(t.type==="FeatureCollection")n=it(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Hl.exports=Io;bt.default=Io;function Po(r,e){var t={},n=[];if(r.type==="LineString"&&(r=dr(r)),e.type==="LineString"&&(e=dr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=zr(r,e);return o&&n.push(o),We(n)}var i=bt();return i.load(Yn(e)),on(Yn(r),function(s){on(i.search(s),function(a){var l=zr(s,a);if(l){var u=je(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function zr(r,e){var t=je(r),n=je(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=t[0][0],i=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],m=n[1][1],c=(m-u)*(s-o)-(p-l)*(a-i),f=(p-l)*(i-u)-(m-u)*(o-l),d=(s-o)*(i-u)-(a-i)*(o-l);if(c===0)return f===0&&d===0,null;var _=f/c,g=d/c;if(_>=0&&_<=1&&g>=0&&g<=1){var y=o+_*(s-o),h=i+_*(a-i);return dt([y,h])}return null}function jt(r,e,t){t===void 0&&(t={});var n=dt([1/0,1/0],{dist:1/0}),o=0;return Qn(r,function(i){for(var s=je(i),a=0;a<s.length-1;a++){var l=dt(s[a]);l.properties.dist=Ye(e,l,t);var u=dt(s[a+1]);u.properties.dist=Ye(e,u,t);var p=Ye(l,u,t),m=Math.max(l.properties.dist,u.properties.dist),c=Ao(l,u),f=Gr(e,m,c+90,t),d=Gr(e,m,c-90,t),_=Po(gt([f.geometry.coordinates,d.geometry.coordinates]),gt([l.geometry.coordinates,u.geometry.coordinates])),g=null;_.features.length>0&&(g=_.features[0],g.properties.dist=Ye(e,g,t),g.properties.location=o+Ye(l,g,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=o),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=o+p),g&&g.properties.dist<n.properties.dist&&(n=g,n.properties.index=a),o+=p}}),n}const st="edit-polygon-mode";class Vl{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"points");oe(this,"cursor");oe(this,"hover");oe(this,"dragFrom");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new rr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),tt(e,st,{type:"geojson",data:De()}),ve(e,{id:"edit-polygon-fill",source:st,filter:vn,..._n("red",["case",["boolean",["get","hover"],"false"],1,.5])}),ve(e,{id:"edit-polygon-lines",source:st,filter:yn,...xt("black",8,.5)}),ve(e,{id:"edit-polygon-vertices",source:st,filter:bn,...yt(fe.hovering,wn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let o of this.points)o[0]-=t,o[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Jr(this.points).forEach((n,o)=>{t.push([o+1,jt(n,this.cursor).properties.dist])}),t.sort((n,o)=>n[1]-o[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(st),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=De();this.points.forEach((n,o)=>{let i=Yr(n);i.properties.hover=this.hover==o,i.properties.idx=o,e.features.push(i)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Jr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(st).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Yr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Yr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Jr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let J;const He=new Array(32).fill(void 0);He.push(void 0,null,!0,!1);function Y(r){return He[r]}let Tt=He.length;function Kl(r){r<36||(He[r]=Tt,Tt=r)}function Xn(r){const e=Y(r);return Kl(r),e}const xo=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});xo.decode();let Zt=new Uint8Array;function It(){return Zt.byteLength===0&&(Zt=new Uint8Array(J.memory.buffer)),Zt}function at(r,e){return xo.decode(It().subarray(r,r+e))}function _e(r){Tt===He.length&&He.push(He.length+1);const e=Tt;return Tt=He[e],He[e]=r,e}function Cn(r){return r==null}let Qt=new Float64Array;function Zl(){return Qt.byteLength===0&&(Qt=new Float64Array(J.memory.buffer)),Qt}let en=new Int32Array;function be(){return en.byteLength===0&&(en=new Int32Array(J.memory.buffer)),en}let Xe=0;const tn=new TextEncoder("utf-8"),Ql=typeof tn.encodeInto=="function"?function(r,e){return tn.encodeInto(r,e)}:function(r,e){const t=tn.encode(r);return e.set(t),{read:r.length,written:t.length}};function Jt(r,e,t){if(t===void 0){const a=tn.encode(r),l=e(a.length);return It().subarray(l,l+a.length).set(a),Xe=a.length,l}let n=r.length,o=e(n);const i=It();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;i[o+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),o=t(o,n,n=s+r.length*3);const a=It().subarray(o+s,o+n),l=Ql(r,a);s+=l.written}return Xe=s,o}function Wn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let i="[";o>0&&(i+=Wn(r[0]));for(let s=1;s<o;s++)i+=", "+Wn(r[s]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function ea(r,e){const t=e(r.length*1);return It().set(r,t/1),Xe=r.length,t}function An(r,e){try{return r.apply(this,e)}catch(t){J.__wbindgen_exn_store(_e(t))}}class pn{static __wrap(e){const t=Object.create(pn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();J.__wbg_jsroutesnapper_free(e)}constructor(e){try{const i=J.__wbindgen_add_to_stack_pointer(-16),s=ea(e,J.__wbindgen_malloc),a=Xe;J.jsroutesnapper_new(i,s,a);var t=be()[i/4+0],n=be()[i/4+1],o=be()[i/4+2];if(o)throw Xn(n);return pn.__wrap(t)}finally{J.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){J.jsroutesnapper_setConfig(this.ptr,_e(e))}toFinalFeature(){try{const n=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_toFinalFeature(n,this.ptr);var e=be()[n/4+0],t=be()[n/4+1];let o;return e!==0&&(o=at(e,t).slice(),J.__wbindgen_free(e,t*1)),o}finally{J.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_renderGeojson(n,this.ptr);var e=be()[n/4+0],t=be()[n/4+1];return at(e,t)}finally{J.__wbindgen_add_to_stack_pointer(16),J.__wbindgen_free(e,t)}}setSnapMode(e){J.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return J.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){J.jsroutesnapper_onClick(this.ptr)}onDragStart(){return J.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return J.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){J.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const o=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_editExisting(o,this.ptr,_e(e));var t=be()[o/4+0],n=be()[o/4+1];if(n)throw Xn(t)}finally{J.__wbindgen_add_to_stack_pointer(16)}}}async function ta(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function na(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Xn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=Y(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(at(e,t));return _e(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=at(e,t);return _e(n)},r.wbg.__wbindgen_is_object=function(e){const t=Y(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Y(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Y(e)in Y(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=Y(t),o=typeof n=="number"?n:void 0;Zl()[e/8+1]=Cn(o)?0:o,be()[e/4+0]=!Cn(o)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Y(e)==Y(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Y(t),o=typeof n=="string"?n:void 0;var i=Cn(o)?0:Jt(o,J.__wbindgen_malloc,J.__wbindgen_realloc),s=Xe;be()[e/4+1]=s,be()[e/4+0]=i},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(Y(t)),o=Jt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),i=Xe;be()[e/4+1]=i,be()[e/4+0]=o},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Y(e);return _e(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=Y(e)[Y(t)];return _e(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(Y(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(Y(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(Y(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(Y(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(Y(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=Y(e)[t>>>0];return _e(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return Y(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Y(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=Y(e).next;return _e(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return An(function(e){const t=Y(e).next();return _e(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return Y(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=Y(e).value;return _e(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return _e(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return An(function(e,t){const n=Reflect.get(Y(e),Y(t));return _e(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return An(function(e,t){const n=Y(e).call(Y(t));return _e(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(Y(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=Y(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=Y(e).buffer;return _e(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(Y(e));return _e(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){Y(e).set(Y(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return Y(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=Y(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return _e(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Y(t).stack,o=Jt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),i=Xe;be()[e/4+1]=i,be()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(at(e,t))}finally{J.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=Wn(Y(t)),o=Jt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),i=Xe;be()[e/4+1]=i,be()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(at(e,t))},r.wbg.__wbindgen_memory=function(){const e=J.memory;return _e(e)},r}function ra(r,e){return J=r.exports,Fo.__wbindgen_wasm_module=e,Qt=new Float64Array,en=new Int32Array,Zt=new Uint8Array,J}async function Fo(r){typeof r>"u"&&(r="/atip/assets/route_snapper_bg.wasm");const e=na();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await ta(await r,e);return ra(t,n)}const St="route-snapper",Xr=10,oa=30;class ia{constructor(e,t){oe(this,"map");oe(this,"inner");oe(this,"active");oe(this,"eventListenersSuccessRoute");oe(this,"eventListenersSuccessArea");oe(this,"eventListenersFailure");oe(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new pn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],tt(e,St,{type:"geojson",data:De()}),ve(e,{id:"route-points",source:St,filter:bn,...yt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Xr/2,Xr])}),ve(e,{id:"route-lines",source:St,filter:yn,...xt("black",2.5)}),ve(e,{id:"route-polygons",source:St,filter:vn,..._n("black",.5)}),this.events=new rr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-oa,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(St).setData(JSON.parse(this.inner.renderGeojson()))}}function sa(r){let e,t,n,o,i,s,a,l;return{c(){e=E("button"),t=E("img"),o=R(),i=V(r[2]),In(t.src,n=r[3])||L(t,"src",n),L(t,"alt",r[2]),L(t,"class","svelte-1vvpkg9"),L(e,"type","button"),e.disabled=s=r[0]==r[1],L(e,"class","svelte-1vvpkg9")},m(u,p){w(u,e,p),S(e,t),S(e,o),S(e,i),a||(l=U(e,"click",r[5]),a=!0)},p(u,[p]){p&8&&!In(t.src,n=u[3])&&L(t,"src",n),p&4&&L(t,"alt",u[2]),p&4&&Pe(i,u[2]),p&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:H,o:H,d(u){u&&k(e),a=!1,l()}}}function la(r,e,t){let{mode:n}=e,{thisMode:o}=e,{label:i}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(o);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,o=u.thisMode),"label"in u&&t(2,i=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,o,i,s,a,l]}class Qe extends Q{constructor(e){super(),ee(this,e,la,sa,Z,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function Wr(r){let e;function t(i,s){return i[1]?ua:aa}let n=t(r),o=n(r);return{c(){o.c(),e=me()},m(i,s){o.m(i,s),w(i,e,s)},p(i,s){n!==(n=t(i))&&(o.d(1),o=n(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){o.d(i),i&&k(e)}}}function aa(r){let e;return{c(){e=E("p"),e.textContent="Click an object to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function ua(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another object"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function fa(r){let e,t=r[0]==ut&&Wr(r);return{c(){t&&t.c(),e=me()},m(n,o){t&&t.m(n,o),w(n,e,o)},p(n,[o]){n[0]==ut?t?t.p(n,o):(t=Wr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:H,o:H,d(n){t&&t.d(n),n&&k(e)}}}const ut="edit-attribute";function No(){}function ca(r,e,t){let n,o,i,s;ae(r,qe,f=>t(5,n=f)),ae(r,te,f=>t(6,o=f)),ae(r,Nt,f=>t(7,i=f)),ae(r,Se,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){Se.set(null)}n.on("mousemove",p),n.on("mouseout",m),n.on("click",c),Dt(()=>{n.off("mousemove",p),n.off("mouseout",m),n.off("click",c)});function p(f){var d;if(a==ut){let _=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Be.set(((d=_[0])==null?void 0:d.id)||null)}}function m(){a==ut&&Be.set(null)}function c(f){if(a==ut){let d=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});d.length>0?Se.set(d[0].id):Se.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=i;if(f){let d=o.features.find(_=>_.id==f);d.geometry.type=="Point"?n.flyTo({center:d.geometry.coordinates,duration:500}):n.fitBounds(Zn(d),{padding:200,duration:500}),l(ut)}}},[a,s,l,No,u,n,o,i]}class pa extends Q{constructor(e){super(),ee(this,e,ca,fa,Z,{mode:0,changeMode:2,start:3,stop:4})}get start(){return No}get stop(){return this.$$.ctx[4]}}function ha(r){let e,t;return{c:H,m(n,o){e||(t=U(window,"keydown",r[0]),e=!0)},p:H,i:H,o:H,d(n){e=!1,t()}}}function da(r,e,t){let{tool:n}=e;function o(i){i.key=="Escape"&&(n.cancel(),i.preventDefault())}return r.$$set=i=>{"tool"in i&&t(1,n=i.tool)},[o,n]}class Sn extends Q{constructor(e){super(),ee(this,e,da,ha,Z,{tool:1})}}function ma(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function ga(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function _a(r){let e,t,n,o,i,s,a,l,u,p;function m(d,_){return d[1]?ga:ma}let c=m(r),f=c(r);return a=new Sn({props:{tool:r[0]}}),{c(){e=E("ul"),f.c(),t=R(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",o=R(),i=E("button"),i.textContent="Cancel",s=R(),B(a.$$.fragment),L(i,"type","button")},m(d,_){w(d,e,_),f.m(e,null),S(e,t),S(e,n),w(d,o,_),w(d,i,_),w(d,s,_),j(a,d,_),l=!0,u||(p=U(i,"click",r[2]),u=!0)},p(d,[_]){c!==(c=m(d))&&(f.d(1),f=c(d),f&&(f.c(),f.m(e,t)));const g={};_&1&&(g.tool=d[0]),a.$set(g)},i(d){l||($(a.$$.fragment,d),l=!0)},o(d){C(a.$$.fragment,d),l=!1},d(d){d&&k(e),f.d(),d&&k(o),d&&k(i),d&&k(s),D(a,d),u=!1,p()}}}function ba(r,e,t){let{pointTool:n}=e,{editingExisting:o}=e;const i=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,o=s.editingExisting)},[n,o,i]}class Bo extends Q{constructor(e){super(),ee(this,e,ba,_a,Z,{pointTool:0,editingExisting:1})}}function ya(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function va(r){let e,t,n,o,i,s,a,l,u,p,m;return e=new kn({props:{label:"Help",$$slots:{default:[ya]},$$scope:{ctx:r}}}),l=new Sn({props:{tool:r[0]}}),{c(){B(e.$$.fragment),t=R(),n=E("div"),o=E("button"),o.textContent="Finish",i=R(),s=E("button"),s.textContent="Cancel",a=R(),B(l.$$.fragment),L(o,"type","button"),L(s,"type","button"),ce(n,"display","flex"),ce(n,"justify-content","space-between")},m(c,f){j(e,c,f),w(c,t,f),w(c,n,f),S(n,o),S(n,i),S(n,s),w(c,a,f),j(l,c,f),u=!0,p||(m=[U(o,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const d={};f&8&&(d.$$scope={dirty:f,ctx:c}),e.$set(d);const _={};f&1&&(_.tool=c[0]),l.$set(_)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){C(e.$$.fragment,c),C(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Ce(m)}}}function wa(r,e,t){let{polygonTool:n}=e;const o=()=>n.finish(),i=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,o,i]}class jo extends Q{constructor(e){super(),ee(this,e,wa,va,Z,{polygonTool:0})}}function ka(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function Sa(r){let e,t,n,o,i,s,a,l,u,p,m;return e=new kn({props:{label:"Help",$$slots:{default:[ka]},$$scope:{ctx:r}}}),l=new Sn({props:{tool:r[0]}}),{c(){B(e.$$.fragment),t=R(),n=E("div"),o=E("button"),o.textContent="Finish",i=R(),s=E("button"),s.textContent="Cancel",a=R(),B(l.$$.fragment),L(o,"type","button"),L(s,"type","button"),ce(n,"display","flex"),ce(n,"justify-content","space-between")},m(c,f){j(e,c,f),w(c,t,f),w(c,n,f),S(n,o),S(n,i),S(n,s),w(c,a,f),j(l,c,f),u=!0,p||(m=[U(o,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const d={};f&8&&(d.$$scope={dirty:f,ctx:c}),e.$set(d);const _={};f&1&&(_.tool=c[0]),l.$set(_)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){C(e.$$.fragment,c),C(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Ce(m)}}}function Ea(r,e,t){let{routeTool:n}=e;const o=()=>n.finish(),i=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,o,i]}class Do extends Q{constructor(e){super(),ee(this,e,Ea,Sa,Z,{routeTool:0})}}function Ma(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function $a(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,_;return e=new kn({props:{label:"Help",$$slots:{default:[Ma]},$$scope:{ctx:r}}}),c=new Sn({props:{tool:r[0]}}),{c(){B(e.$$.fragment),t=R(),n=E("label"),o=E("input"),i=V(`
  Avoid doubling back`),s=R(),a=E("div"),l=E("button"),l.textContent="Finish",u=R(),p=E("button"),p.textContent="Cancel",m=R(),B(c.$$.fragment),L(o,"type","checkbox"),L(l,"type","button"),L(p,"type","button"),ce(a,"display","flex"),ce(a,"justify-content","space-between")},m(g,y){j(e,g,y),w(g,t,y),w(g,n,y),S(n,o),o.checked=r[1],S(n,i),w(g,s,y),w(g,a,y),S(a,l),S(a,u),S(a,p),w(g,m,y),j(c,g,y),f=!0,d||(_=[U(o,"change",r[2]),U(l,"click",r[3]),U(p,"click",r[4])],d=!0)},p(g,[y]){const h={};y&32&&(h.$$scope={dirty:y,ctx:g}),e.$set(h),y&2&&(o.checked=g[1]);const b={};y&1&&(b.tool=g[0]),c.$set(b)},i(g){f||($(e.$$.fragment,g),$(c.$$.fragment,g),f=!0)},o(g){C(e.$$.fragment,g),C(c.$$.fragment,g),f=!1},d(g){D(e,g),g&&k(t),g&&k(n),g&&k(s),g&&k(a),g&&k(m),D(c,g),d=!1,Ce(_)}}}function Oa(r,e,t){let{routeTool:n}=e,o=!1;function i(){o=this.checked,t(1,o)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:o})},[n,o,i,s,a]}class qo extends Q{constructor(e){super(),ee(this,e,Oa,$a,Z,{routeTool:0})}}function Vr(r){let e,t,n,o;const i=[Ta,Ra,Aa,Ca,La],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=i[e](r),{c(){t.c(),n=me()},m(l,u){s[e].m(l,u),w(l,n,u),o=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(he(),C(s[p],1,1,()=>{s[p]=null}),de(),t=s[e],t?t.p(l,u):(t=s[e]=i[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){o||($(t),o=!0)},o(l){C(t),o=!1},d(l){s[e].d(l),l&&k(n)}}}function La(r){let e;return{c(){e=E("p"),e.textContent="Click an object to edit its geometry"},m(t,n){w(t,e,n)},p:H,i:H,o:H,d(t){t&&k(e)}}}function Ca(r){let e,t;return e=new qo({props:{routeTool:r[3]}}),{c(){B(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.routeTool=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Aa(r){let e,t;return e=new Do({props:{routeTool:r[3]}}),{c(){B(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.routeTool=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ra(r){let e,t;return e=new jo({props:{polygonTool:r[2]}}),{c(){B(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){const i={};o&4&&(i.polygonTool=n[2]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ta(r){let e,t;return e=new Bo({props:{pointTool:r[1],editingExisting:!0}}),{c(){B(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.pointTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ia(r){let e,t,n=r[0]==Ue&&Vr(r);return{c(){n&&n.c(),e=me()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==Ue?n?(n.p(o,i),i&1&&$(n,1)):(n=Vr(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(he(),C(n,1,1,()=>{n=null}),de())},i(o){t||($(n),t=!0)},o(o){C(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const Ue="edit-geometry";function Uo(){}function Pa(r,e,t){let n;ae(r,qe,_=>t(8,n=_));let{mode:o}=e,{pointTool:i}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(i.stop(),s.stop(),a.stop(),te.update(_=>{let g=_.features.find(y=>y.id==l);return delete g.properties.hide_while_editing,_})),l=null,t(4,u=null),Be.set(null)}n.on("mousemove",m),n.on("mouseout",c),n.on("click",f),Dt(()=>{n.off("mousemove",m),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(_=>{o==Ue&&(te.update(g=>{let y=g.features.find(h=>h.id==l);return y.properties.length_meters=_.properties.length_meters,y.properties.waypoints=_.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=_.geometry,g}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(_=>{o==Ue&&(te.update(g=>{let y=g.features.find(h=>h.id==l);return y.properties.waypoints=_.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=_.geometry,g}),l=null,t(4,u=null))});for(let _ of[i,s])_.addEventListenerSuccess(g=>{o==Ue&&(te.update(y=>{let h=y.features.find(b=>b.id==l);return h.geometry=g.geometry,delete h.properties.hide_while_editing,y}),l=null,t(4,u=null))});for(let _ of[i,s,a])_.addEventListenerFailure(()=>{o==Ue&&(te.update(g=>{let y=g.features.find(h=>h.id==l);return delete y.properties.hide_while_editing,g}),l=null,t(4,u=null))});function m(_){var g;if(o==Ue&&l==null){let y=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Be.set(((g=y[0])==null?void 0:g.id)||null)}}function c(){o==Ue&&l==null&&Be.set(null)}function f(_){if(o==Ue&&l==null){let g=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0&&d(g[0].id)}}function d(_){Be.set(null);let g=null;te.update(h=>(g=h.features.find(b=>b.id==_),g.properties.hide_while_editing=!0,h));let y=g;l=_,y.geometry.type=="LineString"?(a.editExistingRoute(y),t(4,u="route")):y.geometry.type=="Polygon"?y.properties.waypoints?(a.editExistingArea(y),t(4,u="snap-polygon")):(s.editExisting(y),t(4,u="free-polygon")):y.geometry.type=="Point"&&(i.start(),t(4,u="point"))}return r.$$set=_=>{"mode"in _&&t(0,o=_.mode),"pointTool"in _&&t(1,i=_.pointTool),"polygonTool"in _&&t(2,s=_.polygonTool),"routeTool"in _&&t(3,a=_.routeTool)},[o,i,s,a,u,Uo,p]}class xa extends Q{constructor(e){super(),ee(this,e,Pa,Ia,Z,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Uo}get stop(){return this.$$.ctx[6]}}async function Fa(r,e){const t=await fetch(r),n=t.body.getReader(),o=t.headers.get("Content-Length");let i=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),i+=p.length;const m=100*i/o;e.style=`background: linear-gradient(to right, red ${m}%, transparent 0);`}let a=new Uint8Array(i),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function Na(r){let e,t;return e=new qo({props:{routeTool:r[0]}}),{c(){B(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){const i={};o&1&&(i.routeTool=n[0]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ba(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:H,i:H,o:H,d(t){t&&k(e),r[7](null)}}}function ja(r){let e,t,n,o;const i=[Ba,Na],s=[];function a(l,u){return l[0]?l[1]==Vn?1:-1:0}return~(e=a(r))&&(t=s[e]=i[e](r)),{c(){t&&t.c(),n=me()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),o=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(he(),C(s[p],1,1,()=>{s[p]=null}),de()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=i[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){o||($(t),o=!0)},o(l){C(t),o=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const Vn="route";function Da(r,e,t){let n;ae(r,qe,c=>t(8,n=c));let{mode:o}=e,{changeMode:i}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}gn(async()=>{await Fo(),console.log(`Grabbing ${s}`);try{const c=await Fa(s,a);t(0,l=new ia(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{o==Vn&&i("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{o==Vn&&(te.update(f=>(c.id=Ut(f),c.properties.intervention_type="route",f.features.push(c),f)),i("edit-attribute"),Se.set(c.id))})});function m(c){le[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,o=c.mode),"changeMode"in c&&t(3,i=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,o,a,i,s,u,p,m]}class qa extends Q{constructor(e){super(),ee(this,e,Da,ja,Z,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Kr(r){let e,t;return e=new Bo({props:{pointTool:r[1],editingExisting:!1}}),{c(){B(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.pointTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ua(r){let e,t,n=r[0]==hn&&Kr(r);return{c(){n&&n.c(),e=me()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==hn?n?(n.p(o,i),i&1&&$(n,1)):(n=Kr(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(he(),C(n,1,1,()=>{n=null}),de())},i(o){t||($(n),t=!0)},o(o){C(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const hn="point";function Ga(r,e,t){let{mode:n}=e,{changeMode:o}=e,{pointTool:i}=e;function s(){i.start()}function a(){i.stop()}return i.addEventListenerSuccess(l=>{n==hn&&(te.update(u=>(l.id=Ut(u),l.properties.intervention_type="other",u.features.push(l),u)),o("edit-attribute"),Se.set(l.id))}),i.addEventListenerFailure(()=>{n==hn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"pointTool"in l&&t(1,i=l.pointTool)},[n,i,o,s,a]}class Ha extends Q{constructor(e){super(),ee(this,e,Ga,Ua,Z,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Zr(r){let e,t;return e=new jo({props:{polygonTool:r[1]}}),{c(){B(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.polygonTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function za(r){let e,t,n=r[0]==dn&&Zr(r);return{c(){n&&n.c(),e=me()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==dn?n?(n.p(o,i),i&1&&$(n,1)):(n=Zr(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(he(),C(n,1,1,()=>{n=null}),de())},i(o){t||($(n),t=!0)},o(o){C(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const dn="free-polygon";function Ya(r,e,t){let{mode:n}=e,{changeMode:o}=e,{polygonTool:i}=e;function s(){i.startNew()}function a(){i.stop()}return i.addEventListenerSuccess(l=>{n==dn&&(te.update(u=>(l.id=Ut(u),l.properties.intervention_type="area",u.features.push(l),u)),o("edit-attribute"),Se.set(l.id))}),i.addEventListenerFailure(()=>{n==dn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"polygonTool"in l&&t(1,i=l.polygonTool)},[n,i,o,s,a]}class Ja extends Q{constructor(e){super(),ee(this,e,Ya,za,Z,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Qr(r){let e,t;return e=new Do({props:{routeTool:r[1]}}),{c(){B(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.routeTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Xa(r){let e,t,n=r[0]==mn&&Qr(r);return{c(){n&&n.c(),e=me()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==mn?n?(n.p(o,i),i&1&&$(n,1)):(n=Qr(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(he(),C(n,1,1,()=>{n=null}),de())},i(o){t||($(n),t=!0)},o(o){C(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const mn="snap-polygon";function Wa(r,e,t){let{mode:n}=e,{changeMode:o}=e,{routeTool:i}=e;function s(){i.startArea()}function a(){i.stop()}return i.addEventListenerSuccessArea(l=>{n==mn&&(te.update(u=>(l.id=Ut(u),l.properties.intervention_type="area",u.features.push(l),u)),o("edit-attribute"),Se.set(l.id))}),i.addEventListenerFailure(()=>{n==mn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"routeTool"in l&&t(1,i=l.routeTool)},[n,i,o,s,a]}class Va extends Q{constructor(e){super(),ee(this,e,Wa,Xa,Z,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Ka(r){var e=r[0],t=r[1],n=r[2],o=r[3],i=Ye(r.slice(0,2),[n,t]),s=Ye(r.slice(0,2),[e,o]);if(i>=s){var a=(t+o)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(o-t)/2,t,l+(o-t)/2,o]}}function Za(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,o=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(o===!1||o===void 0)&&(r=JSON.parse(JSON.stringify(r)));var i=Math.pow(10,t);return ai(r,function(s){Qa(s,i,n)}),r}function Qa(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function eu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=zn(r),n=zn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var o=Za(e,{precision:7});switch(n){case"Point":return Kn(r,o);case"MultiPoint":return eo(r,o);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return eo(r,Po(r,o))}}function eo(r,e){var t=[],n=bt();return Qn(e,function(o){if(t.forEach(function(a,l){a.id=l}),!t.length)t=Kn(r,o).features,t.forEach(function(a){a.bbox||(a.bbox=Ka(ui(a)))}),n.load(We(t));else{var i=n.search(o);if(i.features.length){var s=Go(o,i);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),on(Kn(s,o),function(a){t.push(a),n.insert(a)})}}}),We(t)}function Kn(r,e){var t=[],n=je(r)[0],o=je(r)[r.geometry.coordinates.length-1];if(Rn(n,Ve(e))||Rn(o,Ve(e)))return We([r]);var i=bt(),s=Yn(r);i.load(s);var a=i.search(e);if(!a.features.length)return We([r]);var l=Go(e,a),u=[n],p=fi(s,function(m,c,f){var d=je(c)[1],_=Ve(e);return f===l.id?(m.push(_),t.push(gt(m)),Rn(_,d)?[_]:[_,d]):(m.push(d),m)},u);return p.length>1&&t.push(gt(p)),We(t)}function Go(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return on(e,function(o){var i=jt(o,r),s=i.properties.dist;s<n&&(t=o,n=s)}),t}function Rn(r,e){return r[0]===e[0]&&r[1]===e[1]}function tu(r,e,t){var n=je(t);if(zn(t)!=="LineString")throw new Error("line must be a LineString");var o=jt(t,r),i=jt(t,e),s;o.properties.index<=i.properties.index?s=[o,i]:s=[i,o];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),gt(a,t.properties)}function to(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function nu(r){let e,t,n,o=r[0]==Pt&&to();return{c(){o&&o.c(),e=me()},m(i,s){o&&o.m(i,s),w(i,e,s),t||(n=U(window,"keydown",r[1]),t=!0)},p(i,[s]){i[0]==Pt?o||(o=to(),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null)},i:H,o:H,d(i){o&&o.d(i),i&&k(e),t=!1,n()}}}const Pt="split-route",ru=10,ou=30;let Tn="split-route";function Ho(){}function no(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function iu(r,e,t){let n,o;ae(r,te,_=>t(8,n=_)),ae(r,qe,_=>t(6,o=_));let{mode:i}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;o.on("mousemove",p),o.on("click",m),Dt(()=>{o.off("mousemove",p),o.off("click",m)}),tt(o,Tn,{type:"geojson",data:De()}),ve(o,{id:"draw-split-route",source:Tn,...yt("black",ru,["case",["==",["get","snapped"],!0],1,.5])});function p(_){if(i!=Pt)return;t(5,l=no(_.lngLat.toArray(),!1)),u=null;const g=[_.point.x-ou,_.point.y],y=o.unproject(_.point).distanceTo(o.unproject(g))/1e3;let h=[];for(let[b,v]of n.features.entries())if(v.geometry.type=="LineString"){let M=jt(v.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=y&&h.push([b,M.geometry.coordinates,M.properties.dist])}h.sort((b,v)=>b[2]-v[2]),h.length>0&&(t(5,l=no(h[0][1],!0)),u=h[0][0])}function m(){if(i==Pt)if(u==null)s("edit-attribute");else{let _=eu(n.features[u],l);if(_.features.length==2){let g=_.features[0],y=_.features[1];te.update(h=>(g.id=h.features[u].id,y.id=Ut(h),g.properties=JSON.parse(JSON.stringify(h.features[u].properties)),y.properties=JSON.parse(JSON.stringify(g.properties)),c(h.features[u],g,y,l),h.features.splice(u,1,g,y),h))}a()}}function c(_,g,y,h){g.properties.length_meters=Kt(g,{units:"kilometers"})*1e3,y.properties.length_meters=Kt(y,{units:"kilometers"})*1e3,g.properties.waypoints=[],y.properties.waypoints=[];let b=f(_,h),v=!0,M=0;for(let O of _.properties.waypoints){let I=f(_,dt([O.lon,O.lat]));if(v)if(I<b)g.properties.waypoints.push(O);else{let A=O.snapped&&_.properties.waypoints[M-1].snapped;g.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:A}),v=!1,y.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:A}),y.properties.waypoints.push(O)}else y.properties.waypoints.push(O);M++}}function f(_,g){let y=_.geometry.coordinates[0],h=tu(y,g,_);return Kt(h,{units:"kilometers"})*1e3}function d(_){i==Pt&&_.key=="Escape"&&(s("edit-attribute"),_.preventDefault())}return r.$$set=_=>{"mode"in _&&t(0,i=_.mode),"changeMode"in _&&t(2,s=_.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let _=De();l&&_.features.push(l),o.getSource(Tn).setData(_)}},[i,d,s,Ho,a,l,o]}class su extends Q{constructor(e){super(),ee(this,e,iu,nu,Z,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Ho}get stop(){return this.$$.ctx[4]}}const lu="/atip/assets/edit_attributes-29b396e1.svg",au="/atip/assets/edit_geometry-02dad294.svg",uu="/atip/assets/point-276f4055.svg",fu="/atip/assets/polygon_snapped-18efbbea.svg",cu="/atip/assets/polygon_freehand-cf965967.svg",pu="/atip/assets/route-d3c0ebad.svg",hu="/atip/assets/split_route-9e0ea2da.svg";function ro(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new xa({props:n}),r[15](e),{c(){B(e.$$.fragment)},m(o,i){j(e,o,i),t=!0},p(o,i){const s={};i&8&&(s.mode=o[3]),i&4&&(s.routeTool=o[2]),e.$set(s)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){C(e.$$.fragment,o),t=!1},d(o){r[15](null),D(e,o)}}}function oo(r){let e,t;return e=new Qe({props:{mode:r[3],thisMode:"point",label:"New point",icon:uu,changeMode:r[13]}}),{c(){B(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function io(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Va({props:n}),r[18](e),{c(){B(e.$$.fragment)},m(o,i){j(e,o,i),t=!0},p(o,i){const s={};i&8&&(s.mode=o[3]),i&4&&(s.routeTool=o[2]),e.$set(s)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){C(e.$$.fragment,o),t=!1},d(o){r[18](null),D(e,o)}}}function so(r){let e,t;return e=new Qe({props:{mode:r[3],thisMode:"route",label:"New route",icon:pu,changeMode:r[13]}}),{c(){B(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function lo(r){let e,t;return e=new Qe({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:hu,changeMode:r[13]}}),{c(){B(e.$$.fragment)},m(n,o){j(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function du(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,_,g,y,h,b,v,M,O,I,A,x,T,N,W,P,z,ie,we;n=new Qe({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:lu,changeMode:r[13]}});let Re={mode:r[3],changeMode:r[13]};i=new pa({props:Re}),r[14](i),l=new Qe({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:au,changeMode:r[13]}});let re=r[2]&&ro(r),ne=r[1]!="planning"&&oo(r),xe={mode:r[3],changeMode:r[13],pointTool:r[11]};f=new Ha({props:xe}),r[16](f),g=new Qe({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:cu,changeMode:r[13]}});let Oe={mode:r[3],changeMode:r[13],polygonTool:r[12]};h=new Ja({props:Oe}),r[17](h),M=new Qe({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:fu,changeMode:r[13]}});let K=r[2]&&io(r),pe=r[1]!="planning"&&so(r);function ye(q){r[20](q)}let F={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(F.routeTool=r[2]),T=new qa({props:F}),r[19](T),le.push(()=>Ee(T,"routeTool",ye,r[2]));let G=r[1]!="planning"&&lo(r),zo={mode:r[3],changeMode:r[13]};return ie=new su({props:zo}),r[21](ie),{c(){e=E("div"),t=E("div"),B(n.$$.fragment),o=R(),B(i.$$.fragment),s=R(),a=E("div"),B(l.$$.fragment),u=R(),re&&re.c(),p=R(),m=E("div"),ne&&ne.c(),c=R(),B(f.$$.fragment),d=R(),_=E("div"),B(g.$$.fragment),y=R(),B(h.$$.fragment),b=R(),v=E("div"),B(M.$$.fragment),O=R(),K&&K.c(),I=R(),A=E("div"),pe&&pe.c(),x=R(),B(T.$$.fragment),W=R(),P=E("div"),G&&G.c(),z=R(),B(ie.$$.fragment),L(e,"class","toolbox svelte-4s4d3o")},m(q,ue){w(q,e,ue),S(e,t),j(n,t,null),S(t,o),j(i,t,null),S(e,s),S(e,a),j(l,a,null),S(a,u),re&&re.m(a,null),S(e,p),S(e,m),ne&&ne.m(m,null),S(m,c),j(f,m,null),S(e,d),S(e,_),j(g,_,null),S(_,y),j(h,_,null),S(e,b),S(e,v),j(M,v,null),S(v,O),K&&K.m(v,null),S(e,I),S(e,A),pe&&pe.m(A,null),S(A,x),j(T,A,null),S(e,W),S(e,P),G&&G.m(P,null),S(P,z),j(ie,P,null),we=!0},p(q,[ue]){const or={};ue&8&&(or.mode=q[3]),n.$set(or);const ir={};ue&8&&(ir.mode=q[3]),i.$set(ir);const sr={};ue&8&&(sr.mode=q[3]),l.$set(sr),q[2]?re?(re.p(q,ue),ue&4&&$(re,1)):(re=ro(q),re.c(),$(re,1),re.m(a,null)):re&&(he(),C(re,1,1,()=>{re=null}),de()),q[1]!="planning"?ne?(ne.p(q,ue),ue&2&&$(ne,1)):(ne=oo(q),ne.c(),$(ne,1),ne.m(m,c)):ne&&(he(),C(ne,1,1,()=>{ne=null}),de());const lr={};ue&8&&(lr.mode=q[3]),f.$set(lr);const ar={};ue&8&&(ar.mode=q[3]),g.$set(ar);const ur={};ue&8&&(ur.mode=q[3]),h.$set(ur);const fr={};ue&8&&(fr.mode=q[3]),M.$set(fr),q[2]?K?(K.p(q,ue),ue&4&&$(K,1)):(K=io(q),K.c(),$(K,1),K.m(v,null)):K&&(he(),C(K,1,1,()=>{K=null}),de()),q[1]!="planning"?pe?(pe.p(q,ue),ue&2&&$(pe,1)):(pe=so(q),pe.c(),$(pe,1),pe.m(A,x)):pe&&(he(),C(pe,1,1,()=>{pe=null}),de());const Ht={};ue&8&&(Ht.mode=q[3]),ue&1&&(Ht.url=q[0]),!N&&ue&4&&(N=!0,Ht.routeTool=q[2],Me(()=>N=!1)),T.$set(Ht),q[1]!="planning"?G?(G.p(q,ue),ue&2&&$(G,1)):(G=lo(q),G.c(),$(G,1),G.m(P,z)):G&&(he(),C(G,1,1,()=>{G=null}),de());const cr={};ue&8&&(cr.mode=q[3]),ie.$set(cr)},i(q){we||($(n.$$.fragment,q),$(i.$$.fragment,q),$(l.$$.fragment,q),$(re),$(ne),$(f.$$.fragment,q),$(g.$$.fragment,q),$(h.$$.fragment,q),$(M.$$.fragment,q),$(K),$(pe),$(T.$$.fragment,q),$(G),$(ie.$$.fragment,q),we=!0)},o(q){C(n.$$.fragment,q),C(i.$$.fragment,q),C(l.$$.fragment,q),C(re),C(ne),C(f.$$.fragment,q),C(g.$$.fragment,q),C(h.$$.fragment,q),C(M.$$.fragment,q),C(K),C(pe),C(T.$$.fragment,q),C(G),C(ie.$$.fragment,q),we=!1},d(q){q&&k(e),D(n),r[14](null),D(i),D(l),re&&re.d(),ne&&ne.d(),r[16](null),D(f),D(g),r[17](null),D(h),D(M),K&&K.d(),pe&&pe.d(),r[19](null),D(T),G&&G.d(),r[21](null),D(ie)}}}function mu(r,e,t){let n;ae(r,qe,T=>t(22,n=T));let{routeSnapperUrl:o}=e,{schema:i}=e,s,a=new Bl(n),l=new Vl(n),u="edit-attribute",p,m,c,f,d,_,g;function y(T){let N={"edit-attribute":p,"edit-geometry":m,route:c,point:f,"free-polygon":d,"snap-polygon":_,"split-route":g};if(u==T){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),N[u].stop(),t(3,u=T),console.log(`Starting new mode ${u}`),N[u].start()}Dt(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function h(T){le[T?"unshift":"push"](()=>{p=T,t(4,p)})}function b(T){le[T?"unshift":"push"](()=>{m=T,t(5,m)})}function v(T){le[T?"unshift":"push"](()=>{f=T,t(7,f)})}function M(T){le[T?"unshift":"push"](()=>{d=T,t(8,d)})}function O(T){le[T?"unshift":"push"](()=>{_=T,t(9,_)})}function I(T){le[T?"unshift":"push"](()=>{c=T,t(6,c)})}function A(T){s=T,t(2,s)}function x(T){le[T?"unshift":"push"](()=>{g=T,t(10,g)})}return r.$$set=T=>{"routeSnapperUrl"in T&&t(0,o=T.routeSnapperUrl),"schema"in T&&t(1,i=T.schema)},[o,i,s,u,p,m,c,f,d,_,g,a,l,y,h,b,v,M,O,I,A,x]}class gu extends Q{constructor(e){super(),ee(this,e,mu,du,Z,{routeSnapperUrl:0,schema:1})}}function _u(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,_,g,y,h,b;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",o=R(),i=E("button"),i.textContent="About",s=R(),a=E("button"),a.textContent="Instructions",l=R(),u=E("br"),p=R(),m=E("label"),c=V(`ATIP schema:
      `),f=E("select"),d=E("option"),d.textContent="v1",_=E("option"),_.textContent="v2",g=E("option"),g.textContent="Housing developments",y=E("option"),y.textContent="Critical issues",L(n,"type","button"),L(i,"type","button"),L(a,"type","button"),d.__value="v1",d.value=d.__value,_.__value="v2",_.value=_.__value,g.__value="planning",g.value=g.__value,y.__value="criticals",y.value=y.__value,r[2]===void 0&&qt(()=>r[12].call(f)),L(e,"slot","nav")},m(v,M){w(v,e,M),S(e,t),S(t,n),S(t,o),S(t,i),S(t,s),S(t,a),S(e,l),S(e,u),S(e,p),S(e,m),S(m,c),S(m,f),S(f,d),S(f,_),S(f,g),S(f,y),rn(f,r[2]),h||(b=[U(n,"click",r[11]),U(i,"click",r[8]),U(a,"click",r[9]),U(f,"change",r[12]),U(f,"change",r[10])],h=!0)},p(v,M){M&4&&rn(f,v[2])},d(v){v&&k(e),h=!1,Ce(b)}}}function bu(r){let e,t,n,o,i,s,a,l,u,p,m,c;return i=new kl({props:{boundaryGeojson:r[5]}}),a=new bl({props:{authorityName:r[6],schema:r[2]}}),m=new hl({props:{schema:r[2],routeInfo:r[4]}}),{c(){e=E("div"),t=E("h1"),n=V(r[6]),o=R(),B(i.$$.fragment),s=R(),B(a.$$.fragment),l=R(),u=E("br"),p=R(),B(m.$$.fragment),L(e,"slot","sidebar")},m(f,d){w(f,e,d),S(e,t),S(t,n),S(t,o),j(i,t,null),S(e,s),j(a,e,null),S(e,l),S(e,u),S(e,p),j(m,e,null),c=!0},p(f,d){const _={};d&32&&(_.boundaryGeojson=f[5]),i.$set(_);const g={};d&4&&(g.schema=f[2]),a.$set(g);const y={};d&4&&(y.schema=f[2]),d&16&&(y.routeInfo=f[4]),m.$set(y)},i(f){c||($(i.$$.fragment,f),$(a.$$.fragment,f),$(m.$$.fragment,f),c=!0)},o(f){C(i.$$.fragment,f),C(a.$$.fragment,f),C(m.$$.fragment,f),c=!1},d(f){f&&k(e),D(i),D(a),D(m)}}}function yu(r){let e,t,n,o,i,s,a,l,u,p,m,c;return e=new vs({props:{boundaryGeojson:r[5]}}),n=new xl({props:{schema:r[2]}}),i=new Nl({}),a=new gu({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new Ml({props:{style:r[7]}}),m=new Il({props:{schema:r[2]}}),{c(){B(e.$$.fragment),t=R(),B(n.$$.fragment),o=R(),B(i.$$.fragment),s=R(),B(a.$$.fragment),l=R(),B(u.$$.fragment),p=R(),B(m.$$.fragment)},m(f,d){j(e,f,d),w(f,t,d),j(n,f,d),w(f,o,d),j(i,f,d),w(f,s,d),j(a,f,d),w(f,l,d),j(u,f,d),w(f,p,d),j(m,f,d),c=!0},p(f,d){const _={};d&32&&(_.boundaryGeojson=f[5]),e.$set(_);const g={};d&4&&(g.schema=f[2]),n.$set(g);const y={};d&8&&(y.routeSnapperUrl=f[3]),d&4&&(y.schema=f[2]),a.$set(y);const h={};d&4&&(h.schema=f[2]),m.$set(h)},i(f){c||($(e.$$.fragment,f),$(n.$$.fragment,f),$(i.$$.fragment,f),$(a.$$.fragment,f),$(u.$$.fragment,f),$(m.$$.fragment,f),c=!0)},o(f){C(e.$$.fragment,f),C(n.$$.fragment,f),C(i.$$.fragment,f),C(a.$$.fragment,f),C(u.$$.fragment,f),C(m.$$.fragment,f),c=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(o),D(i,f),f&&k(s),D(a,f),f&&k(l),D(u,f),f&&k(p),D(m,f)}}}function vu(r){let e,t,n;return t=new qi({props:{style:r[7],$$slots:{default:[yu]},$$scope:{ctx:r}}}),{c(){e=E("div"),B(t.$$.fragment),L(e,"slot","main")},m(o,i){w(o,e,i),j(t,e,null),n=!0},p(o,i){const s={};i&524332&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||($(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&k(e),D(t)}}}function wu(r){let e,t,n,o,i,s,a,l;e=new Ji({props:{$$slots:{main:[vu],sidebar:[bu],nav:[_u]},$$scope:{ctx:r}}});function u(f){r[13](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new ci({props:p}),le.push(()=>Ee(n,"open",u,r[0]));function m(f){r[14](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Bi({props:c}),le.push(()=>Ee(s,"open",m,r[1])),{c(){B(e.$$.fragment),t=R(),B(n.$$.fragment),i=R(),B(s.$$.fragment)},m(f,d){j(e,f,d),w(f,t,d),j(n,f,d),w(f,i,d),j(s,f,d),l=!0},p(f,[d]){const _={};d&524348&&(_.$$scope={dirty:d,ctx:f}),e.$set(_);const g={};!o&&d&1&&(o=!0,g.open=f[0],Me(()=>o=!1)),n.$set(g);const y={};!a&&d&2&&(a=!0,y.open=f[1],Me(()=>a=!1)),s.$set(y)},i(f){l||($(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!0)},o(f){C(e.$$.fragment,f),C(n.$$.fragment,f),C(s.$$.fragment,f),l=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(i),D(s,f)}}}function ku(r,e,t){let n=!1,o=!1,i=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${a}.bin`,m=`https://atip.uk/route-info/${a}.bin`;i||(p=`https://atip.uk/route-snappers-dev/${a}.bin`,m=`https://atip.uk/route-info-dev/${a}.bin`);let c;function f(){t(0,n=!n),t(1,o=!1)}function d(){t(1,o=!o),t(0,n=!1)}let _;gn(async()=>{t(5,_=await g());const O=go(new Mi);t(4,c=await new O),await c.loadFile(m)});async function g(){const I=await(await fetch(pi)).text(),A=JSON.parse(I);return A.features=A.features.filter(x=>{var T;return((T=x.properties)==null?void 0:T.name)==a}),A}function y(){let O=new URLSearchParams(window.location.search);O.set("schema",u);let I=`${window.location.pathname}?${O.toString()}${window.location.hash}`;window.location.href=I}const h=()=>window.open("index.html");function b(){u=fo(this),t(2,u)}function v(O){n=O,t(0,n)}function M(O){o=O,t(1,o)}return[n,o,u,p,c,_,a,l,f,d,y,h,b,v,M]}class Su extends Q{constructor(e){super(),ee(this,e,ku,wu,Z,{})}}new Su({target:document.getElementById("app")});
