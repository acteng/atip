var $r=Object.defineProperty;var Br=(r,e,t)=>e in r?$r(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var W=(r,e,t)=>(Br(r,typeof e!="symbol"?e+"":e,t),t);import{S as Z,i as Q,s as V,M as Dr,b as pe,a as ze,d as X,m as U,k as We,n as T,o as $,q as J,e as w,c as F,g as S,x as z,p as E,y as Pe,f as P,z as Te,B as Ie,C as Gr,D as gn,E as zt,F as ft,G as mt,H as gt,I as vt,J as yt,K as Fn,h as b,l as G,L as jr,N as Yr,O as te,P as qr,w as vn,Q as Ke,R as me,T as yn,t as K,U as _e,j as it,r as Je,V as _n,W as Rn,X as Me,Y as An,Z as yr,_ as Tn,$ as Hr,a0 as Xr,a1 as Ee,a2 as Ur,a3 as Jr,a4 as zr,a5 as In,a6 as Wr,a7 as Ht,a8 as ct,a9 as Xt,aa as St,ab as bn,ac as en,ad as Kr,ae as lt,af as wn,ag as He,ah as ut,ai as Vr,aj as kn,ak as Zr,al as Qr,am as ei,an as Nn,ao as Nt,ap as ti,aq as ni,ar as ri,A as ii,u as oi}from"./authorities-3942dcde.js";function si(r){let e,t,n,i,o,s,u,l,a,h,m,p,f;return{c(){e=w("p"),e.textContent="For each intervention:",t=F(),n=w("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=F(),o=w("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=F(),u=w("p"),u.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=F(),a=w("p"),a.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,h=F(),m=w("p"),m.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,p=F(),f=w("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(g,v){S(g,e,v),S(g,t,v),S(g,n,v),S(g,i,v),S(g,o,v),S(g,s,v),S(g,u,v),S(g,l,v),S(g,a,v),S(g,h,v),S(g,m,v),S(g,p,v),S(g,f,v)},p:z,d(g){g&&E(e),g&&E(t),g&&E(n),g&&E(i),g&&E(o),g&&E(s),g&&E(u),g&&E(l),g&&E(a),g&&E(h),g&&E(m),g&&E(p),g&&E(f)}}}function li(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[si]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new Dr({props:o}),pe.push(()=>ze(e,"open",i,r[0])),{c(){X(e.$$.fragment)},m(s,u){U(e,s,u),n=!0},p(s,[u]){const l={};u&4&&(l.$$scope={dirty:u,ctx:s}),!t&&u&1&&(t=!0,l.open=s[0],We(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){J(e,s)}}}function ui(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class ai extends Z{constructor(e){super(),Q(this,e,ui,li,V,{open:0})}}const Qe=[];function pt(r,e=z){let t;const n=new Set;function i(u){if(V(r,u)&&(r=u,t)){const l=!Qe.length;for(const a of n)a[1](),Qe.push(a,r);if(l){for(let a=0;a<Qe.length;a+=2)Qe[a][0](Qe[a+1]);Qe.length=0}}}function o(u){i(u(r))}function s(u,l=z){const a=[u,l];return n.add(a),n.size===1&&(t=e(i)||z),u(r),()=>{n.delete(a),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Fe=pt(null),ne=pt(Pe()),be=pt(null),Ae=pt(null),$t=pt(null),tn=pt(null);function Ut(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function _r(r){ne.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),be.set(null),Ae.set(null),$t.set(null)}function $n(r){let e;const t=r[4].default,n=mt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&gt(n,t,i,i[3],e?yt(t,i[3],o,null):vt(i[3]),null)},i(i){e||(T(n,i),e=!0)},o(i){$(n,i),e=!1},d(i){n&&n.d(i)}}}function fi(r){let e,t,n=r[1]&&$n(r);return{c(){e=w("div"),n&&n.c(),P(e,"class","map svelte-12dpf1u")},m(i,o){S(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&T(n,1)):(n=$n(i),n.c(),T(n,1),n.m(e,null)):n&&(Te(),$(n,1,1,()=>{n=null}),Ie())},i(i){t||(T(n),t=!0)},o(i){$(n),t=!1},d(i){i&&E(e),n&&n.d(),r[5](null)}}}function ci(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,u,l=!1;Gr("setCamera",!window.location.hash),gn(()=>{s=new zt.Map({container:u,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new zt.ScaleControl({})),s.addControl(new zt.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Fe.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(u)}),ft(()=>{s.remove()});function a(h){pe[h?"unshift":"push"](()=>{u=h,t(0,u)})}return r.$$set=h=>{"style"in h&&t(2,o=h.style),"$$scope"in h&&t(3,i=h.$$scope)},[u,l,o,i,n,a]}class pi extends Z{constructor(e){super(),Q(this,e,ci,fi,V,{style:2})}}const hi=r=>({}),Bn=r=>({}),di=r=>({}),Dn=r=>({}),mi=r=>({}),Gn=r=>({});function gi(r){let e,t,n,i,o,s,u,l,a,h,m,p;const f=r[3].nav,g=mt(f,r,r[2],Gn),v=r[3].sidebar,y=mt(v,r,r[2],Dn),k=r[3].main,c=mt(k,r,r[2],Bn);return{c(){e=w("aside"),t=w("div"),n=w("nav"),g&&g.c(),i=F(),y&&y.c(),o=F(),s=w("button"),s.textContent="→",l=F(),a=w("main"),c&&c.c(),P(n,"class","svelte-1u7vg8a"),P(t,"class","sidebar-content content-container svelte-1u7vg8a"),P(s,"type","button"),P(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),P(e,"class",u=Fn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),P(a,"class","svelte-1u7vg8a")},m(d,_){S(d,e,_),b(e,t),b(t,n),g&&g.m(n,null),b(t,i),y&&y.m(t,null),b(e,o),b(e,s),S(d,l,_),S(d,a,_),c&&c.m(a,null),h=!0,m||(p=G(s,"click",r[1]),m=!0)},p(d,[_]){g&&g.p&&(!h||_&4)&&gt(g,f,d,d[2],h?yt(f,d[2],_,mi):vt(d[2]),Gn),y&&y.p&&(!h||_&4)&&gt(y,v,d,d[2],h?yt(v,d[2],_,di):vt(d[2]),Dn),(!h||_&1&&u!==(u=Fn(d[0]?"":"collapsed")+" svelte-1u7vg8a"))&&P(e,"class",u),c&&c.p&&(!h||_&4)&&gt(c,k,d,d[2],h?yt(k,d[2],_,hi):vt(d[2]),Bn)},i(d){h||(T(g,d),T(y,d),T(c,d),h=!0)},o(d){$(g,d),$(y,d),$(c,d),h=!1},d(d){d&&E(e),g&&g.d(d),y&&y.d(d),d&&E(l),d&&E(a),c&&c.d(d),m=!1,p()}}}function vi(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=u=>{"$$scope"in u&&t(2,i=u.$$scope)},[o,s,i,n]}class yi extends Z{constructor(e){super(),Q(this,e,vi,gi,V,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function _i(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(h){return l([a,h])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(h){a=[6,h],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var Ue=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function bi(r,e){return r>e?1:r<e?-1:0}function Ge(r,e,t){for(var n=new Ue(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Wt(r,e,t,n){var i=new Ue(r,e);if(t===null)return i.left=i.right=null,i;t=Ge(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function jn(r,e,t){var n=null,i=null;if(e){e=Ge(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function wi(r,e,t){return e===null?r:(r===null||(e=Ge(r.key,e,t),e.left=r),e)}function nn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&nn(r.left,o,!1,n,i),r.right&&nn(r.right,o,!0,n,i)}}var Sn=function(){function r(e){e===void 0&&(e=bi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Wt(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ue(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ge(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ge(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ge(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ge(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ge(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,u=this._root,l;o.length!==0||u;)if(u)o.push(u),u=u.left;else{if(u=o.pop(),l=s(u.key,t),l>0)break;if(s(u.key,e)>=0&&n.call(i,u))return this;u=u.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Si(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&sn(e,t,0,i-1,o),this._root===null)this._root=rn(e,t,0,i),this._size=i;else{var s=Ei(this.toList(),ki(e,t),o);i=this._size+i,this._root=on({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return nn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=jn(e,this._root,i),s=o.left,u=o.right;i(e,t)<0?u=Wt(t,n,u,i):s=Wt(t,n,s,i),this._root=wi(s,u,i)},r.prototype.split=function(e){return jn(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return _i(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function rn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],u=e[o],l=new Ue(s,u);return l.left=rn(r,e,t,o),l.right=rn(r,e,o+1,n),l}return null}function ki(r,e){for(var t=new Ue(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ue(r[i],e[i]);return n.next=null,t.next}function Si(r){for(var e=r,t=[],n=!1,i=new Ue(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function on(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=on(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=on(r,i+1,t),s}return null}function Ei(r,e,t){for(var n=new Ue(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function sn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,u=n+1;;){do s++;while(i(r[s],o)<0);do u--;while(i(r[u],o)>0);if(s>=u)break;var l=r[s];r[s]=r[u],r[u]=l,l=e[s],e[s]=e[u],e[u]=l}sn(r,e,t,u,i),sn(r,e,u+1,n,i)}}function ke(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Yn(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function ge(r,e,t){return e&&Yn(r.prototype,e),t&&Yn(r,t),r}var dt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},ln=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Ye=Number.EPSILON;Ye===void 0&&(Ye=Math.pow(2,-52));var xi=Ye*Ye,un=function(e,t){if(-Ye<e&&e<Ye&&-Ye<t&&t<Ye)return 0;var n=e-t;return n*n<xi*e*t?0:e<t?-1:1},Mi=function(){function r(){ke(this,r),this.reset()}return ge(r,[{key:"reset",value:function(){this.xRounder=new qn,this.yRounder=new qn}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),qn=function(){function r(){ke(this,r),this.tree=new Sn,this.round(0)}return ge(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&un(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&un(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Et=new Mi,_t=function(e,t){return e.x*t.y-e.y*t.x},br=function(e,t){return e.x*t.x+e.y*t.y},Hn=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=_t(i,o);return un(s,0)},Bt=function(e){return Math.sqrt(br(e,e))},Li=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return _t(o,i)/Bt(o)/Bt(i)},Oi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return br(o,i)/Bt(o)/Bt(i)},Xn=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Un=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},Ci=function(e,t,n,i){if(t.x===0)return Un(n,i,e.x);if(i.x===0)return Un(e,t,n.x);if(t.y===0)return Xn(n,i,e.y);if(i.y===0)return Xn(e,t,n.y);var o=_t(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},u=_t(s,t)/o,l=_t(s,i)/o,a=e.x+l*t.x,h=n.x+u*i.x,m=e.y+l*t.y,p=n.y+u*i.y,f=(a+h)/2,g=(m+p)/2;return{x:f,y:g}},Oe=function(){ge(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Dt.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){ke(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return ge(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(u){var l=u.otherSE;i.set(u,{sine:Li(n.point,t.point,l.point),cosine:Oi(n.point,t.point,l.point)})};return function(s,u){i.has(s)||o(s),i.has(u)||o(u);var l=i.get(s),a=l.sine,h=l.cosine,m=i.get(u),p=m.sine,f=m.cosine;return a>=0&&p>=0?h<f?1:h>f?-1:0:a<0&&p<0?h<f?-1:h>f?1:0:p<a?-1:p>a?1:0}}}]),r}(),Pi=0,Dt=function(){ge(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,u=n.rightSE.point.x;if(u<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,a=n.leftSE.point.y,h=t.rightSE.point.y,m=n.rightSE.point.y;if(i<o){if(a<l&&a<h)return 1;if(a>l&&a>h)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<a&&l<m)return-1;if(l>a&&l>m)return 1;var g=n.comparePoint(t.leftSE.point);if(g!==0)return g;var v=t.comparePoint(n.rightSE.point);return v<0?1:v>0?-1:1}if(l<a)return-1;if(l>a)return 1;if(s<u){var y=n.comparePoint(t.rightSE.point);if(y!==0)return y}if(s>u){var k=t.comparePoint(n.rightSE.point);if(k<0)return 1;if(k>0)return-1}if(s!==u){var c=h-l,d=s-i,_=m-a,M=u-o;if(c>d&&_<M)return 1;if(c<d&&_>M)return-1}return s>u?1:s<u||h<m?-1:h>m?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){ke(this,r),this.id=++Pi,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return ge(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,u=n.x+s*o.x;if(t.x===u)return 0;var l=(t.x-n.x)/o.x,a=n.y+l*o.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=ln(n,i);if(o===null)return null;var s=this.leftSE.point,u=this.rightSE.point,l=t.leftSE.point,a=t.rightSE.point,h=dt(n,l)&&this.comparePoint(l)===0,m=dt(i,s)&&t.comparePoint(s)===0,p=dt(n,a)&&this.comparePoint(a)===0,f=dt(i,u)&&t.comparePoint(u)===0;if(m&&h)return f&&!p?u:!f&&p?a:null;if(m)return p&&s.x===a.x&&s.y===a.y?null:s;if(h)return f&&u.x===l.x&&u.y===l.y?null:l;if(f&&p)return null;if(f)return u;if(p)return a;var g=Ci(s,this.vector(),l,t.vector());return g===null||!dt(o,g)?null:Et.round(g.x,g.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Oe(t,!0),s=new Oe(t,!1),u=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,u,this.rings.slice(),this.windings.slice());return Oe.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Oe.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var u=n;n=i,i=u}for(var l=0,a=i.rings.length;l<a;l++){var h=i.rings[l],m=i.windings[l],p=n.rings.indexOf(h);p===-1?(n.rings.push(h),n.windings.push(m)):n.windings[p]+=m}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,u=this.rings.length;s<u;s++){var l=this.rings[s],a=this.windings[s],h=n.indexOf(l);h===-1?(n.push(l),i.push(a)):i[h]+=a}for(var m=[],p=[],f=0,g=n.length;f<g;f++)if(i[f]!==0){var v=n[f],y=v.poly;if(p.indexOf(y)===-1)if(v.isExterior)m.push(y);else{p.indexOf(y)===-1&&p.push(y);var k=m.indexOf(v.poly);k!==-1&&m.splice(k,1)}}for(var c=0,d=m.length;c<d;c++){var _=m[c].multiPoly;o.indexOf(_)===-1&&o.push(_)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(xe.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,u;t.length<n.length?(s=t.length,u=n.length):(s=n.length,u=t.length),this._isInResult=u===xe.numMultiPolys&&s<u;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var a=function(m){return m.length===1&&m[0].isSubject};this._isInResult=a(t)!==a(n);break}default:throw new Error("Unrecognized operation type found ".concat(xe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,u,l=Oe.comparePoints(t,n);if(l<0)o=t,s=n,u=1;else if(l>0)o=n,s=t,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var a=new Oe(o,!0),h=new Oe(s,!1);return new r(a,h,[i],[u])}}]),r}(),Jn=function(){function r(e,t,n){if(ke(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Et.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,u=e.length;s<u;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Et.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(Dt.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Dt.fromRing(o,i,this))}return ge(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),Fi=function(){function r(e,t){if(ke(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Jn(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Jn(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return ge(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),zn=function(){function r(e,t){if(ke(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new Fi(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return ge(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),Ri=function(){ge(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var u=null,l=s.leftSE,a=s.rightSE,h=[l],m=l.point,p=[];u=l,l=a,h.push(l),l.point!==m;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var g=h[0].point,v=h[h.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(g.x,",")+" ".concat(g.y,"]. Last matching segment found ends at")+" [".concat(v.x,", ").concat(v.y,"]."))}if(f.length===1){a=f[0].otherSE;break}for(var y=null,k=0,c=p.length;k<c;k++)if(p[k].point===l.point){y=k;break}if(y!==null){var d=p.splice(y)[0],_=h.splice(d.index);_.unshift(_[0].otherSE),n.push(new r(_.reverse()));continue}p.push({index:h.length,point:l.point});var M=l.getLeftmostComparator(u);a=f.sort(M)[0].otherSE;break}n.push(new r(h))}}return n}}]);function r(e){ke(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return ge(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,u=this.events[i+1].point;Hn(s,t,u)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],a=n[1];Hn(l,t,a)===0&&n.shift(),n.push(n[0]);for(var h=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,f=[],g=m;g!=p;g+=h)f.push([n[g].x,n[g].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Oe.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),u=s?s.prevInResult():null;;){if(!s)return null;if(!u)return s.ringOut;if(u.ringOut!==s.ringOut)return u.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=u.prevInResult(),u=s?s.prevInResult():null}}}]),r}(),Wn=function(){function r(e){ke(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return ge(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),Ai=function(){function r(e){ke(this,r),this.rings=e,this.polys=this._composePolys(e)}return ge(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Wn(s));else{var u=s.enclosingRing();u.poly||n.push(new Wn(u)),u.poly.addInterior(s)}}return n}}]),r}(),Ti=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Dt.compare;ke(this,r),this.queue=e,this.tree=new Sn(t),this.segments=[]}return ge(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,u=o,l=void 0,a=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;a===void 0;)u=this.tree.next(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);if(t.isLeft){var h=null;if(l){var m=l.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(h=m),!l.isAnEndpoint(m)))for(var p=this._splitSafely(l,m),f=0,g=p.length;f<g;f++)i.push(p[f])}var v=null;if(a){var y=a.getIntersection(n);if(y!==null&&(n.isAnEndpoint(y)||(v=y),!a.isAnEndpoint(y)))for(var k=this._splitSafely(a,y),c=0,d=k.length;c<d;c++)i.push(k[c])}if(h!==null||v!==null){var _=null;if(h===null)_=v;else if(v===null)_=h;else{var M=Oe.comparePoints(h,v);_=M<=0?h:v}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var C=n.split(_),O=0,L=C.length;O<L;O++)i.push(C[O])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&a){var A=l.getIntersection(a);if(A!==null){if(!l.isAnEndpoint(A))for(var B=this._splitSafely(l,A),I=0,j=B.length;I<j;I++)i.push(B[I]);if(!a.isAnEndpoint(A))for(var x=this._splitSafely(a,A),N=0,ie=x.length;N<ie;N++)i.push(x[N])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Kn=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ii=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Ni=function(){function r(){ke(this,r)}return ge(r,[{key:"run",value:function(t,n,i){xe.type=t,Et.reset();for(var o=[new zn(n,!0)],s=0,u=i.length;s<u;s++)o.push(new zn(i[s],!1));if(xe.numMultiPolys=o.length,xe.type==="difference")for(var l=o[0],a=1;a<o.length;)ln(o[a].bbox,l.bbox)!==null?a++:o.splice(a,1);if(xe.type==="intersection"){for(var h=0,m=o.length;h<m;h++)for(var p=o[h],f=h+1,g=o.length;f<g;f++)if(ln(p.bbox,o[f].bbox)===null)return[]}for(var v=new Sn(Oe.compare),y=0,k=o.length;y<k;y++)for(var c=o[y].getSweepEvents(),d=0,_=c.length;d<_;d++)if(v.insert(c[d]),v.size>Kn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new Ti(v),C=v.size,O=v.pop();O;){var L=O.key;if(v.size===C){var A=L.segment;throw new Error("Unable to pop() ".concat(L.isLeft?"left":"right"," SweepEvent ")+"[".concat(L.point.x,", ").concat(L.point.y,"] from segment #").concat(A.id," ")+"[".concat(A.leftSE.point.x,", ").concat(A.leftSE.point.y,"] -> ")+"[".concat(A.rightSE.point.x,", ").concat(A.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(v.size>Kn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>Ii)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var B=M.process(L),I=0,j=B.length;I<j;I++){var x=B[I];x.consumedBy===void 0&&v.insert(x)}C=v.size,O=v.pop()}Et.reset();var N=Ri.factory(M.segments),ie=new Ai(N);return ie.getGeom()}}]),r}(),xe=new Ni,$i=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe.run("union",e,n)},Bi=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe.run("intersection",e,n)},Di=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe.run("xor",e,n)},Gi=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe.run("difference",e,n)},Pt={union:$i,intersection:Bi,xor:Di,difference:Gi};function ji(r,e){var t=qi(e),n=null;return r.type==="FeatureCollection"?n=Yi(r):n=wr(Pt.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function Yi(r){var e=r.features.length===2?Pt.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Pt.union.apply(Pt,r.features.map(function(t){return t.geometry.coordinates}));return wr(e)}function wr(r){return jr(r)}function qi(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return Yr(t)}function Hi(r,e,t){let n;te(r,Fe,s=>t(1,n=s));let{boundaryGeojson:i}=e;return qr("setCamera")&&n.fitBounds(vn(i),{padding:20,animate:!1}),Ke(n,"boundary",{type:"geojson",data:ji(i)}),me(n,{id:"boundary",source:"boundary",...yn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class Xi extends Z{constructor(e){super(),Q(this,e,Hi,null,V,{boundaryGeojson:0})}}function Vn(r){let e,t=Zn(r[4])+"",n,i,o,s,u;return{c(){e=K("Length: "),n=K(t),i=F(),o=w("br"),s=F(),u=w("br")},m(l,a){S(l,e,a),S(l,n,a),S(l,i,a),S(l,o,a),S(l,s,a),S(l,u,a)},p(l,a){a&16&&t!==(t=Zn(l[4])+"")&&_n(n,t)},d(l){l&&E(e),l&&E(n),l&&E(i),l&&E(o),l&&E(s),l&&E(u)}}}function Ui(r){let e,t,n,i,o,s,u,l,a,h,m,p,f,g,v,y,k,c,d,_,M,C,O,L,A,B,I,j,x,N,ie,he,we,oe,ve,Se,de,ee,Ve,Ne,$e,ue,fe,Ze,Be,ht,re,ce=r[4]&&Vn(r);return{c(){e=w("label"),t=K("Name:"),n=w("br"),i=F(),o=w("input"),s=F(),u=w("br"),l=F(),a=w("br"),h=F(),m=w("label"),p=w("input"),f=K(`
  Area`),g=F(),v=w("label"),y=w("input"),k=K(`
  Route`),c=F(),d=w("label"),_=w("input"),M=K(`
  Crossing`),C=F(),O=w("label"),L=w("input"),A=K(`
  Other`),B=F(),I=w("br"),j=F(),x=w("br"),N=F(),ie=w("label"),he=K("Description:"),we=w("br"),oe=F(),ve=w("textarea"),Se=F(),de=w("br"),ee=F(),Ve=w("br"),Ne=F(),ce&&ce.c(),$e=F(),ue=w("div"),fe=w("button"),fe.textContent="Delete",Ze=F(),Be=w("button"),Be.textContent="Save",P(o,"type","text"),_e(o,"width","100%"),P(p,"type","radio"),p.__value="area",p.value=p.__value,r[7][0].push(p),P(y,"type","radio"),y.__value="route",y.value=y.__value,r[7][0].push(y),P(_,"type","radio"),_.__value="crossing",_.value=_.__value,r[7][0].push(_),P(L,"type","radio"),L.__value="other",L.value=L.__value,r[7][0].push(L),_e(ve,"width","100%"),P(ve,"rows","5"),P(ve,"class","svelte-15lna0i"),P(fe,"type","button"),P(Be,"type","button"),_e(ue,"display","flex"),_e(ue,"justify-content","space-between")},m(R,Y){S(R,e,Y),b(e,t),b(e,n),b(e,i),b(e,o),it(o,r[0]),S(R,s,Y),S(R,u,Y),S(R,l,Y),S(R,a,Y),S(R,h,Y),S(R,m,Y),b(m,p),p.checked=p.__value===r[1],b(m,f),S(R,g,Y),S(R,v,Y),b(v,y),y.checked=y.__value===r[1],b(v,k),S(R,c,Y),S(R,d,Y),b(d,_),_.checked=_.__value===r[1],b(d,M),S(R,C,Y),S(R,O,Y),b(O,L),L.checked=L.__value===r[1],b(O,A),S(R,B,Y),S(R,I,Y),S(R,j,Y),S(R,x,Y),S(R,N,Y),S(R,ie,Y),b(ie,he),b(ie,we),b(ie,oe),b(ie,ve),it(ve,r[2]),S(R,Se,Y),S(R,de,Y),S(R,ee,Y),S(R,Ve,Y),S(R,Ne,Y),ce&&ce.m(R,Y),S(R,$e,Y),S(R,ue,Y),b(ue,fe),b(ue,Ze),b(ue,Be),ht||(re=[G(o,"input",r[5]),G(p,"change",r[6]),G(y,"change",r[8]),G(_,"change",r[9]),G(L,"change",r[10]),G(ve,"input",r[11]),G(fe,"click",r[12]),G(Be,"click",r[13])],ht=!0)},p(R,[Y]){Y&1&&o.value!==R[0]&&it(o,R[0]),Y&2&&(p.checked=p.__value===R[1]),Y&2&&(y.checked=y.__value===R[1]),Y&2&&(_.checked=_.__value===R[1]),Y&2&&(L.checked=L.__value===R[1]),Y&4&&it(ve,R[2]),R[4]?ce?ce.p(R,Y):(ce=Vn(R),ce.c(),ce.m($e.parentNode,$e)):ce&&(ce.d(1),ce=null)},i:z,o:z,d(R){R&&E(e),R&&E(s),R&&E(u),R&&E(l),R&&E(a),R&&E(h),R&&E(m),r[7][0].splice(r[7][0].indexOf(p),1),R&&E(g),R&&E(v),r[7][0].splice(r[7][0].indexOf(y),1),R&&E(c),R&&E(d),r[7][0].splice(r[7][0].indexOf(_),1),R&&E(C),R&&E(O),r[7][0].splice(r[7][0].indexOf(L),1),R&&E(B),R&&E(I),R&&E(j),R&&E(x),R&&E(N),R&&E(ie),R&&E(Se),R&&E(de),R&&E(ee),R&&E(Ve),R&&E(Ne),ce&&ce.d(R),R&&E($e),R&&E(ue),ht=!1,Je(re)}}}function Zn(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Ji(r,e,t){let{id:n}=e,{name:i}=e,{intervention_type:o}=e,{description:s}=e,{length_meters:u}=e;const l=[[]];function a(){i=this.value,t(0,i)}function h(){o=this.__value,t(1,o)}function m(){o=this.__value,t(1,o)}function p(){o=this.__value,t(1,o)}function f(){o=this.__value,t(1,o)}function g(){s=this.value,t(2,s)}const v=()=>_r(n),y=()=>be.set(null);return r.$$set=k=>{"id"in k&&t(3,n=k.id),"name"in k&&t(0,i=k.name),"intervention_type"in k&&t(1,o=k.intervention_type),"description"in k&&t(2,s=k.description),"length_meters"in k&&t(4,u=k.length_meters)},[i,o,s,n,u,a,h,l,m,p,f,g,v,y]}class zi extends Z{constructor(e){super(),Q(this,e,Ji,Ui,V,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}function Wi(r){const e=r-1;return e*e*e+1}function Qn(r,{delay:e=0,duration:t=400,easing:n=Wi}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),u=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),a=parseFloat(i.marginTop),h=parseFloat(i.marginBottom),m=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*u}px;padding-bottom: ${f*l}px;margin-top: ${f*a}px;margin-bottom: ${f*h}px;border-top-width: ${f*m}px;border-bottom-width: ${f*p}px;`}}function er(r){let e,t,n,i,o;const s=r[10].default,u=mt(s,r,r[9],null);return{c(){e=w("div"),u&&u.c(),_e(e,"border","solid 1px black"),_e(e,"padding","10px")},m(l,a){S(l,e,a),u&&u.m(e,null),r[13](e),n=!0,i||(o=G(e,"introend",r[14]),i=!0)},p(l,a){u&&u.p&&(!n||a&512)&&gt(u,s,l,l[9],n?yt(s,l[9],a,null):vt(l[9]),null)},i(l){n||(T(u,l),yr(()=>{t||(t=Tn(e,Qn,{duration:100},!0)),t.run(1)}),n=!0)},o(l){$(u,l),t||(t=Tn(e,Qn,{duration:100},!1)),t.run(0),n=!1},d(l){l&&E(e),u&&u.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Ki(r){let e,t,n,i,o,s,u,l,a,h,m=r[4]&&er(r);return{c(){e=w("button"),t=Rn("svg"),n=Rn("path"),i=F(),o=K(r[1]),s=F(),m&&m.c(),u=Me(),P(n,"d","M9 5l7 7-7 7"),P(t,"style","tran"),P(t,"width","20"),P(t,"height","20"),P(t,"fill","none"),P(t,"stroke-linecap","round"),P(t,"stroke-linejoin","round"),P(t,"stroke-width","2"),P(t,"viewBox","0 0 24 24"),P(t,"stroke","currentColor"),P(t,"class","svelte-t7fpgu"),P(e,"aria-expanded",r[4]),P(e,"class","svelte-t7fpgu"),An(e,"underlined",r[3])},m(p,f){S(p,e,f),b(e,t),b(t,n),b(e,i),b(e,o),S(p,s,f),m&&m.m(p,f),S(p,u,f),l=!0,a||(h=[G(e,"click",r[5]),G(e,"mouseenter",r[11]),G(e,"mouseleave",r[12])],a=!0)},p(p,[f]){(!l||f&2)&&_n(o,p[1]),(!l||f&16)&&P(e,"aria-expanded",p[4]),(!l||f&8)&&An(e,"underlined",p[3]),p[4]?m?(m.p(p,f),f&16&&T(m,1)):(m=er(p),m.c(),T(m,1),m.m(u.parentNode,u)):m&&(Te(),$(m,1,1,()=>{m=null}),Ie())},i(p){l||(T(m),l=!0)},o(p){$(m),l=!1},d(p){p&&E(e),p&&E(s),m&&m.d(p),p&&E(u),a=!1,Je(h)}}}function Vi(r,e,t){let n,i,o,s;te(r,Ae,c=>t(7,o=c)),te(r,be,c=>t(8,s=c));let{$$slots:u={},$$scope:l}=e,{id:a}=e,{label:h}=e;const m=()=>{be.update(c=>c==a?null:a),s==a&&(tn.set(null),tn.set(a))};let p;function f(){p==null||p.scrollIntoView({behavior:"smooth"})}const g=()=>$t.set(a),v=()=>$t.set(null);function y(c){pe[c?"unshift":"push"](()=>{p=c,t(2,p)})}const k=()=>f();return r.$$set=c=>{"id"in c&&t(0,a=c.id),"label"in c&&t(1,h=c.label),"$$scope"in c&&t(9,l=c.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==a),r.$$.dirty&129&&t(3,i=o==a)},[a,h,p,i,n,m,f,o,s,l,u,g,v,y,k]}class Zi extends Z{constructor(e){super(),Q(this,e,Vi,Ki,V,{id:0,label:1})}}function tr(r,e,t){const n=r.slice();return n[6]=e[t],n[7]=e,n[8]=t,n}function Qi(r){let e,t,n,i,o,s;function u(m){r[2](m,r[6])}function l(m){r[3](m,r[6])}function a(m){r[4](m,r[6])}let h={id:r[6].id,length_meters:r[6].properties.length_meters};return r[6].properties.name!==void 0&&(h.name=r[6].properties.name),r[6].properties.intervention_type!==void 0&&(h.intervention_type=r[6].properties.intervention_type),r[6].properties.description!==void 0&&(h.description=r[6].properties.description),e=new zi({props:h}),pe.push(()=>ze(e,"name",u,r[6].properties.name)),pe.push(()=>ze(e,"intervention_type",l,r[6].properties.intervention_type)),pe.push(()=>ze(e,"description",a,r[6].properties.description)),{c(){X(e.$$.fragment),o=F()},m(m,p){U(e,m,p),S(m,o,p),s=!0},p(m,p){r=m;const f={};p&1&&(f.id=r[6].id),p&1&&(f.length_meters=r[6].properties.length_meters),!t&&p&1&&(t=!0,f.name=r[6].properties.name,We(()=>t=!1)),!n&&p&1&&(n=!0,f.intervention_type=r[6].properties.intervention_type,We(()=>n=!1)),!i&&p&1&&(i=!0,f.description=r[6].properties.description,We(()=>i=!1)),e.$set(f)},i(m){s||(T(e.$$.fragment,m),s=!0)},o(m){$(e.$$.fragment,m),s=!1},d(m){J(e,m),m&&E(o)}}}function nr(r,e){let t,n,i;return n=new Zi({props:{id:e[6].id,label:e[8]+1+") "+rr(e[6]),$$slots:{default:[Qi]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=Me(),X(n.$$.fragment),this.first=t},m(o,s){S(o,t,s),U(n,o,s),i=!0},p(o,s){e=o;const u={};s&1&&(u.id=e[6].id),s&1&&(u.label=e[8]+1+") "+rr(e[6])),s&513&&(u.$$scope={dirty:s,ctx:e}),n.$set(u)},i(o){i||(T(n.$$.fragment,o),i=!0)},o(o){$(n.$$.fragment,o),i=!1},d(o){o&&E(t),J(n,o)}}}function eo(r){let e=[],t=new Map,n,i,o,s,u=r[0].features;const l=a=>a[6].id;for(let a=0;a<u.length;a+=1){let h=tr(r,u,a),m=l(h);t.set(m,e[a]=nr(m,h))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=Me()},m(a,h){for(let m=0;m<e.length;m+=1)e[m].m(a,h);S(a,n,h),i=!0,o||(s=G(window,"keydown",r[1]),o=!0)},p(a,[h]){h&1&&(u=a[0].features,Te(),e=Hr(e,h,l,1,a,u,t,n.parentNode,Xr,nr,n,tr),Ie())},i(a){if(!i){for(let h=0;h<u.length;h+=1)T(e[h]);i=!0}},o(a){for(let h=0;h<e.length;h+=1)$(e[h]);i=!1},d(a){for(let h=0;h<e.length;h+=1)e[h].d(a);a&&E(n),o=!1,s()}}}function rr(r){if(r.properties.name)return r.properties.name;var e=r.properties.intervention_type;return e=="other"&&(r.geometry.type=="Point"?e="point":r.geometry.type=="LineString"?e="line":e="polygon"),`Untitled ${e}`}function to(r,e,t){let n,i;te(r,be,a=>t(5,n=a)),te(r,ne,a=>t(0,i=a));function o(a){if(a.key=="Delete"){const h=a.target.tagName;if(h=="INPUT"||h=="TEXTAREA")return;a.preventDefault();const m=n;m&&_r(m)}}function s(a,h){r.$$.not_equal(h.properties.name,a)&&(h.properties.name=a,ne.set(i))}function u(a,h){r.$$.not_equal(h.properties.intervention_type,a)&&(h.properties.intervention_type=a,ne.set(i))}function l(a,h){r.$$.not_equal(h.properties.description,a)&&(h.properties.description=a,ne.set(i))}return[i,o,s,u,l]}class no extends Z{constructor(e){super(),Q(this,e,to,eo,V,{})}}function Xe(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ce(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function an(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function je(r,e,t){t===void 0&&(t={});var n=Xe(r),i=Xe(e),o=Ee(i[1]-n[1]),s=Ee(i[0]-n[0]),u=Ee(n[1]),l=Ee(i[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return Ur(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),t.units)}function Ft(r,e){return e===void 0&&(e={}),Jr(r,function(t,n){var i=n.geometry.coordinates;return t+je(i[0],i[1],e)},0)}function ro(r){let e,t,n,i,o,s,u,l,a,h,m,p,f,g,v,y,k,c,d,_=r[0].features.length+"",M,C,O,L,A,B,I,j;return{c(){e=w("div"),t=w("label"),n=K(`Scheme name:
    `),i=w("input"),o=F(),s=w("br"),u=F(),l=w("div"),a=w("label"),h=w("input"),m=F(),p=w("button"),p.textContent="Load from GeoJSON",f=F(),g=w("button"),g.textContent="Export to GeoJSON",v=F(),y=w("br"),k=F(),c=w("div"),d=w("span"),M=K(_),C=K(" interventions"),O=F(),L=w("button"),A=K("Clear all"),P(i,"type","text"),P(h,"type","file"),P(h,"id","load_geojson"),P(h,"class","svelte-lhyd1e"),P(p,"type","button"),P(g,"type","button"),P(g,"class","align-right svelte-lhyd1e"),P(L,"type","button"),P(L,"class","align-right svelte-lhyd1e"),L.disabled=B=r[0].features.length==0},m(x,N){S(x,e,N),b(e,t),b(t,n),b(t,i),it(i,r[0].scheme_name),S(x,o,N),S(x,s,N),S(x,u,N),S(x,l,N),b(l,a),b(a,h),b(a,m),b(a,p),b(l,f),b(l,g),S(x,v,N),S(x,y,N),S(x,k,N),S(x,c,N),b(c,d),b(d,M),b(d,C),b(c,O),b(c,L),b(L,A),I||(j=[G(i,"input",r[5]),G(h,"change",r[3]),G(p,"click",oo),G(g,"click",r[2]),G(L,"click",r[1])],I=!0)},p(x,[N]){N&1&&i.value!==x[0].scheme_name&&it(i,x[0].scheme_name),N&1&&_!==(_=x[0].features.length+"")&&_n(M,_),N&1&&B!==(B=x[0].features.length==0)&&(L.disabled=B)},i:z,o:z,d(x){x&&E(e),x&&E(o),x&&E(s),x&&E(u),x&&E(l),x&&E(v),x&&E(y),x&&E(k),x&&E(c),I=!1,Je(j)}}}function io(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function oo(){document.getElementById("load_geojson").click()}function so(r,e,t){let n;te(r,ne,p=>t(0,n=p));let{authorityName:i}=e,o=window.localStorage.getItem(i);if(o)try{ne.set(h(JSON.parse(o)))}catch(p){console.log(`Failed to load from local storage: ${p}`)}function s(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&ne.update(p=>(delete p.scheme_name,p.features=[],p))}function u(){const p=JSON.parse(JSON.stringify(n));for(let f of p.features)delete f.properties.hide_while_editing;return p}function l(){let p=u();var f=i;p.authority=i,p.origin="atip-v1",p.scheme_name&&(f+="_"+p.scheme_name),f+=".txt",io(f,JSON.stringify(p,null,"  "))}function a(p){const f=new FileReader;f.onload=v=>{try{ne.set(h(JSON.parse(v.target.result)))}catch(y){window.alert(`Couldn't load scheme from a file: ${y}`)}};let g=p.target.files;f.readAsText(g[0])}function h(p){let f=1;for(let g of p.features)g.properties||(g.properties={name:"",description:"",intervention_type:"other"}),g.geometry.type=="LineString"&&!g.properties.length_meters&&(g.properties.length_meters=Ft(g,{units:"kilometers"})*1e3),g.id=f++;return p}function m(){n.scheme_name=this.value,ne.set(n)}return r.$$set=p=>{"authorityName"in p&&t(4,i=p.authorityName)},r.$$.update=()=>{r.$$.dirty&17&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(i,JSON.stringify(u())))},[n,s,l,a,i,m]}class lo extends Z{constructor(e){super(),Q(this,e,so,ro,V,{authorityName:4})}}const uo="/atip/assets/zoom_out_map-b2e1091a.svg";function ao(r){let e,t,n,i,o;return{c(){e=w("button"),t=w("img"),zr(t.src,n=uo)||P(t,"src",n),P(t,"alt","Zoom to show entire boundary"),P(e,"type","button"),P(e,"title","Zoom to show entire boundary"),P(e,"class","svelte-qzjsqo")},m(s,u){S(s,e,u),b(e,t),i||(o=G(e,"click",r[0]),i=!0)},p:z,i:z,o:z,d(s){s&&E(e),i=!1,o()}}}function fo(r,e,t){let n;te(r,Fe,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(vn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class co extends Z{constructor(e){super(),Q(this,e,fo,ao,V,{boundaryGeojson:1})}}function po(r){let e,t,n,i,o,s,u;return{c(){e=w("div"),t=K(`Basemap:
  `),n=w("select"),i=w("option"),i.textContent="Streets",o=w("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&yr(()=>r[2].call(n)),P(e,"class","svelte-1tbnm6i")},m(l,a){S(l,e,a),b(e,t),b(e,n),b(n,i),b(n,o),In(n,r[0]),s||(u=[G(n,"change",r[2]),G(n,"change",r[1])],s=!0)},p(l,[a]){a&1&&In(n,l[0])},i:z,o:z,d(l){l&&E(e),s=!1,Je(u)}}}function ho(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let u=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=u}function o(){n=Wr(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class mo extends Z{constructor(e){super(),Q(this,e,ho,po,V,{style:0})}}const ye={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",hovering:"black",lineEndpointColor:"black"},Jt=10,Gt=10;function go(r){let e,t,n,i,o,s,u,l,a,h,m,p,f,g,v,y,k,c,d;return{c(){e=w("div"),t=w("h1"),t.textContent="Interventions",n=F(),i=w("ul"),o=w("li"),s=w("span"),u=K("Areas"),l=F(),a=w("li"),h=w("span"),m=K("Routes"),p=F(),f=w("li"),g=w("span"),v=K("Crossings"),y=F(),k=w("li"),c=w("span"),d=K("Other"),P(t,"class","svelte-p551i1"),P(s,"class","svelte-p551i1"),_e(s,"background",ye.area),P(h,"class","svelte-p551i1"),_e(h,"background",ye.route),P(g,"class","svelte-p551i1"),_e(g,"background",ye.crossing),P(c,"class","svelte-p551i1"),_e(c,"background",ye.other),P(e,"class","svelte-p551i1")},m(_,M){S(_,e,M),b(e,t),b(e,n),b(e,i),b(i,o),b(o,s),b(o,u),b(i,l),b(i,a),b(a,h),b(a,m),b(i,p),b(i,f),b(f,g),b(f,v),b(i,y),b(i,k),b(k,c),b(k,d)},p:z,i:z,o:z,d(_){_&&E(e)}}}class vo extends Z{constructor(e){super(),Q(this,e,null,go,V,{})}}let et="interventions";function yo(r,e,t){let n,i;te(r,Fe,l=>t(0,n=l)),te(r,ne,l=>t(1,i=l)),Ke(n,et,{type:"geojson",data:i});const o=["match",["get","intervention_type"],"area",ye.area,"route",ye.route,"crossing",ye.crossing,"other",ye.other,"white"],s=["!=","hide_while_editing",!0];return me(n,{id:"interventions-points",source:et,filter:["all",Ht,s,["!=","endpoint",!0]],...ct(o,Jt)}),me(n,{id:"interventions-lines",source:et,filter:["all",Xt,s],...St(o,Gt)},"route-lines"),me(n,{id:"interventions-lines-endpoints",source:et,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Gt,"circle-opacity":0,"circle-stroke-color":ye.lineEndpointColor,"circle-stroke-width":2}}),me(n,{id:"interventions-polygons",source:et,filter:["all",bn,s],...yn(o,.5)},"hover-polygons"),r.$$.update=()=>{if(r.$$.dirty&3){let l=JSON.parse(JSON.stringify(i)),a=[];for(let h of l.features)if(h.geometry.type=="LineString")for(let m of[h.geometry.coordinates[0],h.geometry.coordinates[h.geometry.coordinates.length-1]])a.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:m}});l.features=l.features.concat(a),n.getSource(et).setData(l)}},[n,i]}class _o extends Z{constructor(e){super(),Q(this,e,yo,null,V,{})}}let tt="hover";function bo(r,e,t){let n,i,o,s,u;return te(r,Fe,l=>t(0,n=l)),te(r,ne,l=>t(1,i=l)),te(r,$t,l=>t(2,o=l)),te(r,Ae,l=>t(3,s=l)),te(r,be,l=>t(4,u=l)),Ke(n,tt,{type:"geojson",data:Pe()}),me(n,{id:"hover-polygons",source:tt,filter:bn,...St(ye.hovering,.5*Gt,1)}),me(n,{id:"hover-lines",source:tt,filter:Xt,...St(ye.hovering,1.5*Gt,1)},"interventions-lines"),me(n,{id:"hover-points",source:tt,filter:Ht,...ct(ye.hovering,1.5*Jt,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=u||s||o;l!=null?n.getSource(tt).setData(i.features.find(a=>a.id==l)):n.getSource(tt).setData(Pe())}},[n,i,o,s,u]}class wo extends Z{constructor(e){super(),Q(this,e,bo,null,V,{})}}class En{constructor(e,t){W(this,"owner");W(this,"map");W(this,"mapHandlers",{});W(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Lt="edit-point-mode";class ko{constructor(e){W(this,"map");W(this,"active");W(this,"eventListenersSuccess");W(this,"eventListenersFailure");W(this,"cursor");W(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new En(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Ke(e,Lt,{type:"geojson",data:Pe()}),me(e,{id:"edit-point-mode",source:Lt,...ct(ye.hovering,Jt,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=So(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Lt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Pe();this.cursor&&e.features.push(this.cursor),this.map.getSource(Lt).setData(e)}}function So(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function kr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Eo(r,e);var n=Xe(r),i=Xe(e),o=Ee(n[0]),s=Ee(i[0]),u=Ee(n[1]),l=Ee(i[1]),a=Math.sin(s-o)*Math.cos(l),h=Math.cos(u)*Math.sin(l)-Math.sin(u)*Math.cos(l)*Math.cos(s-o);return en(Math.atan2(a,h))}function Eo(r,e){var t=kr(e,r);return t=(t+180)%360,t}function ir(r,e,t,n){n===void 0&&(n={});var i=Xe(r),o=Ee(i[0]),s=Ee(i[1]),u=Ee(t),l=Kr(e,n.units),a=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(u)),h=o+Math.atan2(Math.sin(u)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(a)),m=en(h),p=en(a);return lt([m,p],n.properties)}function fn(r){if(!r)throw new Error("geojson is required");var e=[];return wn(r,function(t){xo(t,e)}),He(e)}function xo(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ce(n);break;case"LineString":t=[Ce(n)]}t.forEach(function(i){var o=Mo(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Mo(r,e){var t=[];return r.reduce(function(n,i){var o=ut([n,i],e);return o.bbox=Lo(n,i),t.push(o),i}),t}function Lo(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,u=n<o?n:o,l=t>i?t:i,a=n>o?n:o;return[s,u,l,a]}var at={},Oo={get exports(){return at},set exports(r){at=r}},cn={},Co={get exports(){return cn},set exports(r){cn=r}};(function(r,e){(function(t,n){r.exports=n()})(Vr,function(){function t(c,d,_,M,C){(function O(L,A,B,I,j){for(;I>B;){if(I-B>600){var x=I-B+1,N=A-B+1,ie=Math.log(x),he=.5*Math.exp(2*ie/3),we=.5*Math.sqrt(ie*he*(x-he)/x)*(N-x/2<0?-1:1),oe=Math.max(B,Math.floor(A-N*he/x+we)),ve=Math.min(I,Math.floor(A+(x-N)*he/x+we));O(L,A,oe,ve,j)}var Se=L[A],de=B,ee=I;for(n(L,B,A),j(L[I],Se)>0&&n(L,B,I);de<ee;){for(n(L,de,ee),de++,ee--;j(L[de],Se)<0;)de++;for(;j(L[ee],Se)>0;)ee--}j(L[B],Se)===0?n(L,B,ee):n(L,++ee,I),ee<=A&&(B=ee+1),A<=ee&&(I=ee-1)}})(c,d,_||0,M||c.length-1,C||i)}function n(c,d,_){var M=c[d];c[d]=c[_],c[_]=M}function i(c,d){return c<d?-1:c>d?1:0}var o=function(c){c===void 0&&(c=9),this._maxEntries=Math.max(4,c),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(c,d,_){if(!_)return d.indexOf(c);for(var M=0;M<d.length;M++)if(_(c,d[M]))return M;return-1}function u(c,d){l(c,0,c.children.length,d,c)}function l(c,d,_,M,C){C||(C=y(null)),C.minX=1/0,C.minY=1/0,C.maxX=-1/0,C.maxY=-1/0;for(var O=d;O<_;O++){var L=c.children[O];a(C,c.leaf?M(L):L)}return C}function a(c,d){return c.minX=Math.min(c.minX,d.minX),c.minY=Math.min(c.minY,d.minY),c.maxX=Math.max(c.maxX,d.maxX),c.maxY=Math.max(c.maxY,d.maxY),c}function h(c,d){return c.minX-d.minX}function m(c,d){return c.minY-d.minY}function p(c){return(c.maxX-c.minX)*(c.maxY-c.minY)}function f(c){return c.maxX-c.minX+(c.maxY-c.minY)}function g(c,d){return c.minX<=d.minX&&c.minY<=d.minY&&d.maxX<=c.maxX&&d.maxY<=c.maxY}function v(c,d){return d.minX<=c.maxX&&d.minY<=c.maxY&&d.maxX>=c.minX&&d.maxY>=c.minY}function y(c){return{children:c,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function k(c,d,_,M,C){for(var O=[d,_];O.length;)if(!((_=O.pop())-(d=O.pop())<=M)){var L=d+Math.ceil((_-d)/M/2)*M;t(c,L,d,_,C),O.push(d,L,L,_)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(c){var d=this.data,_=[];if(!v(c,d))return _;for(var M=this.toBBox,C=[];d;){for(var O=0;O<d.children.length;O++){var L=d.children[O],A=d.leaf?M(L):L;v(c,A)&&(d.leaf?_.push(L):g(c,A)?this._all(L,_):C.push(L))}d=C.pop()}return _},o.prototype.collides=function(c){var d=this.data;if(!v(c,d))return!1;for(var _=[];d;){for(var M=0;M<d.children.length;M++){var C=d.children[M],O=d.leaf?this.toBBox(C):C;if(v(c,O)){if(d.leaf||g(c,O))return!0;_.push(C)}}d=_.pop()}return!1},o.prototype.load=function(c){if(!c||!c.length)return this;if(c.length<this._minEntries){for(var d=0;d<c.length;d++)this.insert(c[d]);return this}var _=this._build(c.slice(),0,c.length-1,0);if(this.data.children.length)if(this.data.height===_.height)this._splitRoot(this.data,_);else{if(this.data.height<_.height){var M=this.data;this.data=_,_=M}this._insert(_,this.data.height-_.height-1,!0)}else this.data=_;return this},o.prototype.insert=function(c){return c&&this._insert(c,this.data.height-1),this},o.prototype.clear=function(){return this.data=y([]),this},o.prototype.remove=function(c,d){if(!c)return this;for(var _,M,C,O=this.data,L=this.toBBox(c),A=[],B=[];O||A.length;){if(O||(O=A.pop(),M=A[A.length-1],_=B.pop(),C=!0),O.leaf){var I=s(c,O.children,d);if(I!==-1)return O.children.splice(I,1),A.push(O),this._condense(A),this}C||O.leaf||!g(O,L)?M?(_++,O=M.children[_],C=!1):O=null:(A.push(O),B.push(_),_=0,M=O,O=O.children[0])}return this},o.prototype.toBBox=function(c){return c},o.prototype.compareMinX=function(c,d){return c.minX-d.minX},o.prototype.compareMinY=function(c,d){return c.minY-d.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(c){return this.data=c,this},o.prototype._all=function(c,d){for(var _=[];c;)c.leaf?d.push.apply(d,c.children):_.push.apply(_,c.children),c=_.pop();return d},o.prototype._build=function(c,d,_,M){var C,O=_-d+1,L=this._maxEntries;if(O<=L)return u(C=y(c.slice(d,_+1)),this.toBBox),C;M||(M=Math.ceil(Math.log(O)/Math.log(L)),L=Math.ceil(O/Math.pow(L,M-1))),(C=y([])).leaf=!1,C.height=M;var A=Math.ceil(O/L),B=A*Math.ceil(Math.sqrt(L));k(c,d,_,B,this.compareMinX);for(var I=d;I<=_;I+=B){var j=Math.min(I+B-1,_);k(c,I,j,A,this.compareMinY);for(var x=I;x<=j;x+=A){var N=Math.min(x+A-1,j);C.children.push(this._build(c,x,N,M-1))}}return u(C,this.toBBox),C},o.prototype._chooseSubtree=function(c,d,_,M){for(;M.push(d),!d.leaf&&M.length-1!==_;){for(var C=1/0,O=1/0,L=void 0,A=0;A<d.children.length;A++){var B=d.children[A],I=p(B),j=(x=c,N=B,(Math.max(N.maxX,x.maxX)-Math.min(N.minX,x.minX))*(Math.max(N.maxY,x.maxY)-Math.min(N.minY,x.minY))-I);j<O?(O=j,C=I<C?I:C,L=B):j===O&&I<C&&(C=I,L=B)}d=L||d.children[0]}var x,N;return d},o.prototype._insert=function(c,d,_){var M=_?c:this.toBBox(c),C=[],O=this._chooseSubtree(M,this.data,d,C);for(O.children.push(c),a(O,M);d>=0&&C[d].children.length>this._maxEntries;)this._split(C,d),d--;this._adjustParentBBoxes(M,C,d)},o.prototype._split=function(c,d){var _=c[d],M=_.children.length,C=this._minEntries;this._chooseSplitAxis(_,C,M);var O=this._chooseSplitIndex(_,C,M),L=y(_.children.splice(O,_.children.length-O));L.height=_.height,L.leaf=_.leaf,u(_,this.toBBox),u(L,this.toBBox),d?c[d-1].children.push(L):this._splitRoot(_,L)},o.prototype._splitRoot=function(c,d){this.data=y([c,d]),this.data.height=c.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(c,d,_){for(var M,C,O,L,A,B,I,j=1/0,x=1/0,N=d;N<=_-d;N++){var ie=l(c,0,N,this.toBBox),he=l(c,N,_,this.toBBox),we=(C=ie,O=he,L=void 0,A=void 0,B=void 0,I=void 0,L=Math.max(C.minX,O.minX),A=Math.max(C.minY,O.minY),B=Math.min(C.maxX,O.maxX),I=Math.min(C.maxY,O.maxY),Math.max(0,B-L)*Math.max(0,I-A)),oe=p(ie)+p(he);we<j?(j=we,M=N,x=oe<x?oe:x):we===j&&oe<x&&(x=oe,M=N)}return M||_-d},o.prototype._chooseSplitAxis=function(c,d,_){var M=c.leaf?this.compareMinX:h,C=c.leaf?this.compareMinY:m;this._allDistMargin(c,d,_,M)<this._allDistMargin(c,d,_,C)&&c.children.sort(M)},o.prototype._allDistMargin=function(c,d,_,M){c.children.sort(M);for(var C=this.toBBox,O=l(c,0,d,C),L=l(c,_-d,_,C),A=f(O)+f(L),B=d;B<_-d;B++){var I=c.children[B];a(O,c.leaf?C(I):I),A+=f(O)}for(var j=_-d-1;j>=d;j--){var x=c.children[j];a(L,c.leaf?C(x):x),A+=f(L)}return A},o.prototype._adjustParentBBoxes=function(c,d,_){for(var M=_;M>=0;M--)a(d[M],c)},o.prototype._condense=function(c){for(var d=c.length-1,_=void 0;d>=0;d--)c[d].children.length===0?d>0?(_=c[d-1].children).splice(_.indexOf(c[d]),1):this.clear():u(c[d],this.toBBox)},o})})(Co);const Po=kn(Zr),Fo=kn(Qr),Ro=kn(ei);var Le=cn,Sr=Po,Er=Fo,nt=Ro.default,Ao=Er.featureEach;Er.coordEach;Sr.polygon;var or=Sr.featureCollection;function xr(r){var e=new Le(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:nt(t),Le.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:nt(i),n.push(i)}):Ao(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:nt(i),n.push(i)}),Le.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:nt(t),Le.prototype.remove.call(this,t,n)},e.clear=function(){return Le.prototype.clear.call(this)},e.search=function(t){var n=Le.prototype.search.call(this,this.toBBox(t));return or(n)},e.collides=function(t){return Le.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Le.prototype.all.call(this);return or(t)},e.toJSON=function(){return Le.prototype.toJSON.call(this)},e.fromJSON=function(t){return Le.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=nt(t);else if(t.type==="FeatureCollection")n=nt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Oo.exports=xr;at.default=xr;function Mr(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Nn(r)),e.type==="LineString"&&(e=Nn(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=sr(r,e);return i&&n.push(i),He(n)}var o=at();return o.load(fn(e)),Nt(fn(r),function(s){Nt(o.search(s),function(u){var l=sr(s,u);if(l){var a=Ce(l).join(",");t[a]||(t[a]=!0,n.push(l))}})}),He(n)}function sr(r,e){var t=Ce(r),n=Ce(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],u=t[1][1],l=n[0][0],a=n[0][1],h=n[1][0],m=n[1][1],p=(m-a)*(s-i)-(h-l)*(u-o),f=(h-l)*(o-a)-(m-a)*(i-l),g=(s-i)*(o-a)-(u-o)*(i-l);if(p===0)return f===0&&g===0,null;var v=f/p,y=g/p;if(v>=0&&v<=1&&y>=0&&y<=1){var k=i+v*(s-i),c=o+v*(u-o);return lt([k,c])}return null}function xt(r,e,t){t===void 0&&(t={});var n=lt([1/0,1/0],{dist:1/0}),i=0;return wn(r,function(o){for(var s=Ce(o),u=0;u<s.length-1;u++){var l=lt(s[u]);l.properties.dist=je(e,l,t);var a=lt(s[u+1]);a.properties.dist=je(e,a,t);var h=je(l,a,t),m=Math.max(l.properties.dist,a.properties.dist),p=kr(l,a),f=ir(e,m,p+90,t),g=ir(e,m,p-90,t),v=Mr(ut([f.geometry.coordinates,g.geometry.coordinates]),ut([l.geometry.coordinates,a.geometry.coordinates])),y=null;v.features.length>0&&(y=v.features[0],y.properties.dist=je(e,y,t),y.properties.location=i+je(l,y,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=u,n.properties.location=i),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=u+1,n.properties.location=i+h),y&&y.properties.dist<n.properties.dist&&(n=y,n.properties.index=u),i+=h}}),n}const rt="edit-polygon-mode";class To{constructor(e){W(this,"map");W(this,"active");W(this,"eventListenersSuccess");W(this,"eventListenersFailure");W(this,"points");W(this,"cursor");W(this,"hover");W(this,"dragFrom");W(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new En(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Ke(e,rt,{type:"geojson",data:Pe()}),me(e,{id:"edit-polygon-fill",source:rt,filter:bn,...yn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),me(e,{id:"edit-polygon-lines",source:rt,filter:Xt,...St("black",8,.5)}),me(e,{id:"edit-polygon-vertices",source:rt,filter:Ht,...ct(ye.hovering,Jt,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(ur(this.points).forEach((n,i)=>{t.push([i+1,xt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(rt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Pe();this.points.forEach((n,i)=>{let o=lr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(ur(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(rt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=lr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function lr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function ur(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let D;const Lr=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Lr.decode();let Rt=new Uint8Array;function bt(){return Rt.byteLength===0&&(Rt=new Uint8Array(D.memory.buffer)),Rt}function ot(r,e){return Lr.decode(bt().subarray(r,r+e))}const Re=new Array(32).fill(void 0);Re.push(void 0,null,!0,!1);let wt=Re.length;function se(r){wt===Re.length&&Re.push(Re.length+1);const e=wt;return wt=Re[e],Re[e]=r,e}function q(r){return Re[r]}function Io(r){r<36||(Re[r]=wt,wt=r)}function pn(r){const e=q(r);return Io(r),e}function Kt(r){return r==null}let At=new Float64Array;function No(){return At.byteLength===0&&(At=new Float64Array(D.memory.buffer)),At}let Tt=new Int32Array;function le(){return Tt.byteLength===0&&(Tt=new Int32Array(D.memory.buffer)),Tt}let qe=0;const It=new TextEncoder("utf-8"),$o=typeof It.encodeInto=="function"?function(r,e){return It.encodeInto(r,e)}:function(r,e){const t=It.encode(r);return e.set(t),{read:r.length,written:t.length}};function Ot(r,e,t){if(t===void 0){const u=It.encode(r),l=e(u.length);return bt().subarray(l,l+u.length).set(u),qe=u.length,l}let n=r.length,i=e(n);const o=bt();let s=0;for(;s<n;s++){const u=r.charCodeAt(s);if(u>127)break;o[i+s]=u}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const u=bt().subarray(i+s,i+n),l=$o(r,u);s+=l.written}return qe=s,i}function hn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=hn(r[0]));for(let s=1;s<i;s++)o+=", "+hn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Bo(r,e){const t=e(r.length*1);return bt().set(r,t/1),qe=r.length,t}function Vt(r,e){try{return r.apply(this,e)}catch(t){D.__wbindgen_exn_store(se(t))}}class jt{static __wrap(e){const t=Object.create(jt.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();D.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=D.__wbindgen_add_to_stack_pointer(-16),s=Bo(e,D.__wbindgen_malloc),u=qe;D.jsroutesnapper_new(o,s,u);var t=le()[o/4+0],n=le()[o/4+1],i=le()[o/4+2];if(i)throw pn(n);return jt.__wrap(t)}finally{D.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){D.jsroutesnapper_setConfig(this.ptr,se(e))}toFinalFeature(){try{const n=D.__wbindgen_add_to_stack_pointer(-16);D.jsroutesnapper_toFinalFeature(n,this.ptr);var e=le()[n/4+0],t=le()[n/4+1];let i;return e!==0&&(i=ot(e,t).slice(),D.__wbindgen_free(e,t*1)),i}finally{D.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=D.__wbindgen_add_to_stack_pointer(-16);D.jsroutesnapper_renderGeojson(n,this.ptr);var e=le()[n/4+0],t=le()[n/4+1];return ot(e,t)}finally{D.__wbindgen_add_to_stack_pointer(16),D.__wbindgen_free(e,t)}}setSnapMode(e){D.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return D.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){D.jsroutesnapper_onClick(this.ptr)}onDragStart(){return D.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return D.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){D.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=D.__wbindgen_add_to_stack_pointer(-16);D.jsroutesnapper_editExisting(i,this.ptr,se(e));var t=le()[i/4+0],n=le()[i/4+1];if(n)throw pn(t)}finally{D.__wbindgen_add_to_stack_pointer(16)}}}async function Do(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Go(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=ot(e,t);return se(n)},r.wbg.__wbindgen_object_drop_ref=function(e){pn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=q(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ot(e,t));return se(n)},r.wbg.__wbindgen_is_object=function(e){const t=q(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return q(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return q(e)in q(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=q(t),i=typeof n=="number"?n:void 0;No()[e/8+1]=Kt(i)?0:i,le()[e/4+0]=!Kt(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return q(e)==q(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=q(t),i=typeof n=="string"?n:void 0;var o=Kt(i)?0:Ot(i,D.__wbindgen_malloc,D.__wbindgen_realloc),s=qe;le()[e/4+1]=s,le()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(q(t)),i=Ot(n,D.__wbindgen_malloc,D.__wbindgen_realloc),o=qe;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=q(e);return se(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=q(e)[q(t)];return se(n)},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(q(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=q(e)[t>>>0];return se(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return q(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof q(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=q(e).next;return se(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Vt(function(e){const t=q(e).next();return se(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return q(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=q(e).value;return se(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return se(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Vt(function(e,t){const n=Reflect.get(q(e),q(t));return se(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Vt(function(e,t){const n=q(e).call(q(t));return se(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(q(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=q(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=q(e).buffer;return se(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(q(e));return se(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){q(e).set(q(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return q(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=q(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return se(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=q(t).stack,i=Ot(n,D.__wbindgen_malloc,D.__wbindgen_realloc),o=qe;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(ot(e,t))}finally{D.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=hn(q(t)),i=Ot(n,D.__wbindgen_malloc,D.__wbindgen_realloc),o=qe;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ot(e,t))},r.wbg.__wbindgen_memory=function(){const e=D.memory;return se(e)},r}function jo(r,e){return D=r.exports,Or.__wbindgen_wasm_module=e,At=new Float64Array,Tt=new Int32Array,Rt=new Uint8Array,D}async function Or(r){typeof r>"u"&&(r="/atip/assets/route_snapper_bg.wasm");const e=Go();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Do(await r,e);return jo(t,n)}const Ct="route-snapper",ar=10,Yo=30;class qo{constructor(e,t){W(this,"map");W(this,"inner");W(this,"active");W(this,"eventListenersSuccess");W(this,"eventListenersFailure");W(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new jt(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],Ke(e,Ct,{type:"geojson",data:Pe()}),me(e,{id:"route-points",source:Ct,filter:Ht,...ct(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",ar/2,ar])}),me(e,{id:"route-lines",source:Ct,filter:Xt,...St("black",2.5)}),this.events=new En(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Yo,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}start(){this.active||(this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExisting(e){this.active&&window.alert("Bug: editExisting called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.start(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setConfig(e){this.inner.setConfig(e),this.redraw()}redraw(){this.map.getSource(Ct).setData(JSON.parse(this.inner.renderGeojson()))}}function fr(r){let e;function t(o,s){return o[1]?Xo:Ho}let n=t(r),i=n(r);return{c(){i.c(),e=Me()},m(o,s){i.m(o,s),S(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&E(e)}}}function Ho(r){let e;return{c(){e=w("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Xo(r){let e;return{c(){e=w("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Uo(r){let e,t=r[0]==st&&fr(r);return{c(){t&&t.c(),e=Me()},m(n,i){t&&t.m(n,i),S(n,e,i)},p(n,[i]){n[0]==st?t?t.p(n,i):(t=fr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:z,o:z,d(n){t&&t.d(n),n&&E(e)}}}const st="edit-attribute";function Cr(){}function Jo(r,e,t){let n,i,o,s;te(r,Fe,f=>t(5,n=f)),te(r,ne,f=>t(6,i=f)),te(r,tn,f=>t(7,o=f)),te(r,be,f=>t(1,s=f));let{mode:u}=e,{changeMode:l}=e;function a(){be.set(null)}n.on("mousemove",h),n.on("mouseout",m),n.on("click",p),ft(()=>{n.off("mousemove",h),n.off("mouseout",m),n.off("click",p)});function h(f){var g;if(u==st){let v=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ae.set(((g=v[0])==null?void 0:g.id)||null)}}function m(){u==st&&Ae.set(null)}function p(f){if(u==st){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0?be.set(g[0].id):be.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,u=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let g=i.features.find(v=>v.id==f);g.geometry.type=="Point"?n.flyTo({center:g.geometry.coordinates,duration:500}):n.fitBounds(vn(g),{padding:200,duration:500}),l(st)}}},[u,s,l,Cr,a,n,i,o]}class zo extends Z{constructor(e){super(),Q(this,e,Jo,Uo,V,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Cr}get stop(){return this.$$.ctx[4]}}function Wo(r){let e,t;return{c:z,m(n,i){e||(t=G(window,"keydown",r[0]),e=!0)},p:z,i:z,o:z,d(n){e=!1,t()}}}function Ko(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class xn extends Z{constructor(e){super(),Q(this,e,Ko,Wo,V,{tool:1})}}function Vo(r){let e;return{c(){e=w("p"),e.textContent="Click to add a new point"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Zo(r){let e;return{c(){e=w("p"),e.textContent="Click to move the point here"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Qo(r){let e,t,n,i,o,s,u,l,a;function h(f,g){return f[1]?Zo:Vo}let m=h(r),p=m(r);return s=new xn({props:{tool:r[0]}}),{c(){p.c(),e=F(),t=w("p"),t.innerHTML="Press <b>Escape</b> to cancel",n=F(),i=w("button"),i.textContent="Cancel",o=F(),X(s.$$.fragment),P(i,"type","button")},m(f,g){p.m(f,g),S(f,e,g),S(f,t,g),S(f,n,g),S(f,i,g),S(f,o,g),U(s,f,g),u=!0,l||(a=G(i,"click",r[2]),l=!0)},p(f,[g]){m!==(m=h(f))&&(p.d(1),p=m(f),p&&(p.c(),p.m(e.parentNode,e)));const v={};g&1&&(v.tool=f[0]),s.$set(v)},i(f){u||(T(s.$$.fragment,f),u=!0)},o(f){$(s.$$.fragment,f),u=!1},d(f){p.d(f),f&&E(e),f&&E(t),f&&E(n),f&&E(i),f&&E(o),J(s,f),l=!1,a()}}}function es(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Pr extends Z{constructor(e){super(),Q(this,e,es,Qo,V,{pointTool:0,editingExisting:1})}}function ts(r){let e,t,n,i,o,s,u,l,a,h,m;return l=new xn({props:{tool:r[0]}}),{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=F(),n=w("div"),i=w("button"),i.textContent="Finish",o=F(),s=w("button"),s.textContent="Cancel",u=F(),X(l.$$.fragment),P(i,"type","button"),P(s,"type","button"),_e(n,"display","flex"),_e(n,"justify-content","space-between")},m(p,f){S(p,e,f),S(p,t,f),S(p,n,f),b(n,i),b(n,o),b(n,s),S(p,u,f),U(l,p,f),a=!0,h||(m=[G(i,"click",r[1]),G(s,"click",r[2])],h=!0)},p(p,[f]){const g={};f&1&&(g.tool=p[0]),l.$set(g)},i(p){a||(T(l.$$.fragment,p),a=!0)},o(p){$(l.$$.fragment,p),a=!1},d(p){p&&E(e),p&&E(t),p&&E(n),p&&E(u),J(l,p),h=!1,Je(m)}}}function ns(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Fr extends Z{constructor(e){super(),Q(this,e,ns,ts,V,{polygonTool:0})}}function rs(r){let e,t,n,i,o,s,u,l,a,h,m,p,f,g,v;return p=new xn({props:{tool:r[0]}}),{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=F(),n=w("label"),i=w("input"),o=K(`
  Avoid doubling back`),s=F(),u=w("div"),l=w("button"),l.textContent="Finish",a=F(),h=w("button"),h.textContent="Cancel",m=F(),X(p.$$.fragment),P(i,"type","checkbox"),P(l,"type","button"),P(h,"type","button"),_e(u,"display","flex"),_e(u,"justify-content","space-between")},m(y,k){S(y,e,k),S(y,t,k),S(y,n,k),b(n,i),i.checked=r[1],b(n,o),S(y,s,k),S(y,u,k),b(u,l),b(u,a),b(u,h),S(y,m,k),U(p,y,k),f=!0,g||(v=[G(i,"change",r[2]),G(l,"click",r[3]),G(h,"click",r[4])],g=!0)},p(y,[k]){k&2&&(i.checked=y[1]);const c={};k&1&&(c.tool=y[0]),p.$set(c)},i(y){f||(T(p.$$.fragment,y),f=!0)},o(y){$(p.$$.fragment,y),f=!1},d(y){y&&E(e),y&&E(t),y&&E(n),y&&E(s),y&&E(u),y&&E(m),J(p,y),g=!1,Je(v)}}}function is(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),u=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setConfig({avoid_doubling_back:i})},[n,i,o,s,u]}class Rr extends Z{constructor(e){super(),Q(this,e,is,rs,V,{routeTool:0})}}function cr(r){let e,t,n,i;const o=[us,ls,ss,os],s=[];function u(l,a){return l[4]=="point"?0:l[4]=="polygon"?1:l[4]=="route"?2:3}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=Me()},m(l,a){s[e].m(l,a),S(l,n,a),i=!0},p(l,a){let h=e;e=u(l),e===h?s[e].p(l,a):(Te(),$(s[h],1,1,()=>{s[h]=null}),Ie(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){i||(T(t),i=!0)},o(l){$(t),i=!1},d(l){s[e].d(l),l&&E(n)}}}function os(r){let e;return{c(){e=w("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){S(t,e,n)},p:z,i:z,o:z,d(t){t&&E(e)}}}function ss(r){let e,t;return e=new Rr({props:{routeTool:r[3]}}),{c(){X(e.$$.fragment)},m(n,i){U(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function ls(r){let e,t;return e=new Fr({props:{polygonTool:r[2]}}),{c(){X(e.$$.fragment)},m(n,i){U(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function us(r){let e,t;return e=new Pr({props:{pointTool:r[1],editingExisting:!0}}),{c(){X(e.$$.fragment)},m(n,i){U(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function as(r){let e,t,n=r[0]==De&&cr(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==De?n?(n.p(i,o),o&1&&T(n,1)):(n=cr(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Te(),$(n,1,1,()=>{n=null}),Ie())},i(i){t||(T(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const De="edit-geometry";function Ar(){}function fs(r,e,t){let n;te(r,Fe,v=>t(8,n=v));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:u}=e,l=null,a=null;function h(){l&&(o.stop(),s.stop(),u.stop(),ne.update(v=>{let y=v.features.find(k=>k.id==l);return delete y.properties.hide_while_editing,v})),l=null,t(4,a=null),Ae.set(null)}n.on("mousemove",m),n.on("mouseout",p),n.on("click",f),ft(()=>{n.off("mousemove",m),n.off("mouseout",p),n.off("click",f)}),u.addEventListenerSuccess(v=>{i==De&&(ne.update(y=>{let k=y.features.find(c=>c.id==l);return k.properties.length_meters=v.properties.length_meters,k.properties.waypoints=v.properties.waypoints,delete k.properties.hide_while_editing,k.geometry=v.geometry,y}),l=null,t(4,a=null))});for(let v of[o,s])v.addEventListenerSuccess(y=>{i==De&&(ne.update(k=>{let c=k.features.find(d=>d.id==l);return c.geometry=y.geometry,delete c.properties.hide_while_editing,k}),l=null,t(4,a=null))});for(let v of[o,s,u])v.addEventListenerFailure(()=>{i==De&&(ne.update(y=>{let k=y.features.find(c=>c.id==l);return delete k.properties.hide_while_editing,y}),l=null,t(4,a=null))});function m(v){var y;if(i==De&&l==null){let k=n.queryRenderedFeatures(v.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ae.set(((y=k[0])==null?void 0:y.id)||null)}}function p(){i==De&&l==null&&Ae.set(null)}function f(v){if(i==De&&l==null){let y=n.queryRenderedFeatures(v.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});y.length>0&&g(y[0].id)}}function g(v){Ae.set(null);let y=null;ne.update(c=>(y=c.features.find(d=>d.id==v),y.properties.hide_while_editing=!0,c));let k=y;l=v,k.geometry.type=="LineString"?(u.editExisting(k),t(4,a="route")):k.geometry.type=="Polygon"?(s.editExisting(k),t(4,a="polygon")):k.geometry.type=="Point"&&(o.start(),t(4,a="point"))}return r.$$set=v=>{"mode"in v&&t(0,i=v.mode),"pointTool"in v&&t(1,o=v.pointTool),"polygonTool"in v&&t(2,s=v.polygonTool),"routeTool"in v&&t(3,u=v.routeTool)},[i,o,s,u,a,Ar,h]}class cs extends Z{constructor(e){super(),Q(this,e,fs,as,V,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Ar}get stop(){return this.$$.ctx[6]}}async function ps(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:a,value:h}=await n.read();if(a)break;s.push(h),o+=h.length;const m=100*o/i;e.style=`background: linear-gradient(to right, red ${m}%, transparent 0);`}let u=new Uint8Array(o),l=0;for(let a of s)u.set(a,l),l+=a.length;return u}function hs(r){let e,t;return e=new Rr({props:{routeTool:r[0]}}),{c(){X(e.$$.fragment)},m(n,i){U(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function ds(r){let e;return{c(){e=w("div"),e.textContent="Route tool loading..."},m(t,n){S(t,e,n),r[7](e)},p:z,i:z,o:z,d(t){t&&E(e),r[7](null)}}}function ms(r){let e,t,n,i;const o=[ds,hs],s=[];function u(l,a){return l[0]?l[1]==dn?1:-1:0}return~(e=u(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=Me()},m(l,a){~e&&s[e].m(l,a),S(l,n,a),i=!0},p(l,[a]){let h=e;e=u(l),e===h?~e&&s[e].p(l,a):(t&&(Te(),$(s[h],1,1,()=>{s[h]=null}),Ie()),~e?(t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),T(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(T(t),i=!0)},o(l){$(t),i=!1},d(l){~e&&s[e].d(l),l&&E(n)}}}const dn="route";function gs(r,e,t){let n;te(r,Fe,p=>t(8,n=p));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,u,{routeTool:l}=e;function a(){l.isActive()||l.start()}function h(){l==null||l.stop()}gn(async()=>{await Or(),console.log(`Grabbing ${s}`);try{const p=await ps(s,u);t(0,l=new qo(n,p))}catch(p){console.log(`Route tool broke: ${p}`),t(2,u.innerHTML="Failed to load",u);return}l.addEventListenerFailure(()=>{i==dn&&o("edit-attribute")}),l.addEventListenerSuccess(p=>{i==dn&&(ne.update(f=>(p.id=Ut(f),p.properties.intervention_type="route",f.features.push(p),f)),o("edit-attribute"),be.set(p.id))})}),ft(()=>{l==null||l.tearDown()});function m(p){pe[p?"unshift":"push"](()=>{u=p,t(2,u)})}return r.$$set=p=>{"mode"in p&&t(1,i=p.mode),"changeMode"in p&&t(3,o=p.changeMode),"url"in p&&t(4,s=p.url),"routeTool"in p&&t(0,l=p.routeTool)},[l,i,u,o,s,a,h,m]}class vs extends Z{constructor(e){super(),Q(this,e,gs,ms,V,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function pr(r){let e,t;return e=new Pr({props:{pointTool:r[1],editingExisting:!1}}),{c(){X(e.$$.fragment)},m(n,i){U(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function ys(r){let e,t,n=r[0]==Yt&&pr(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Yt?n?(n.p(i,o),o&1&&T(n,1)):(n=pr(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Te(),$(n,1,1,()=>{n=null}),Ie())},i(i){t||(T(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const Yt="point";function _s(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==Yt&&(ne.update(a=>(l.id=Ut(a),l.properties.intervention_type="other",a.features.push(l),a)),i("edit-attribute"),be.set(l.id))}),o.addEventListenerFailure(()=>{n==Yt&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,u]}class bs extends Z{constructor(e){super(),Q(this,e,_s,ys,V,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function hr(r){let e,t;return e=new Fr({props:{polygonTool:r[1]}}),{c(){X(e.$$.fragment)},m(n,i){U(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function ws(r){let e,t,n=r[0]==qt&&hr(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==qt?n?(n.p(i,o),o&1&&T(n,1)):(n=hr(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Te(),$(n,1,1,()=>{n=null}),Ie())},i(i){t||(T(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const qt="polygon";function ks(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==qt&&(ne.update(a=>(l.id=Ut(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),be.set(l.id))}),o.addEventListenerFailure(()=>{n==qt&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,u]}class Ss extends Z{constructor(e){super(),Q(this,e,ks,ws,V,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Es(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=je(r.slice(0,2),[n,t]),s=je(r.slice(0,2),[e,i]);if(o>=s){var u=(t+i)/2;return[e,u-(n-e)/2,n,u+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function xs(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return ti(r,function(s){Ms(s,o,n)}),r}function Ms(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Ls(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=an(r),n=an(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=xs(e,{precision:7});switch(n){case"Point":return mn(r,i);case"MultiPoint":return dr(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return dr(r,Mr(r,i))}}function dr(r,e){var t=[],n=at();return wn(e,function(i){if(t.forEach(function(u,l){u.id=l}),!t.length)t=mn(r,i).features,t.forEach(function(u){u.bbox||(u.bbox=Es(ni(u)))}),n.load(He(t));else{var o=n.search(i);if(o.features.length){var s=Tr(i,o);t=t.filter(function(u){return u.id!==s.id}),n.remove(s),Nt(mn(s,i),function(u){t.push(u),n.insert(u)})}}}),He(t)}function mn(r,e){var t=[],n=Ce(r)[0],i=Ce(r)[r.geometry.coordinates.length-1];if(Zt(n,Xe(e))||Zt(i,Xe(e)))return He([r]);var o=at(),s=fn(r);o.load(s);var u=o.search(e);if(!u.features.length)return He([r]);var l=Tr(e,u),a=[n],h=ri(s,function(m,p,f){var g=Ce(p)[1],v=Xe(e);return f===l.id?(m.push(v),t.push(ut(m)),Zt(v,g)?[v]:[v,g]):(m.push(g),m)},a);return h.length>1&&t.push(ut(h)),He(t)}function Tr(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return Nt(e,function(i){var o=xt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function Zt(r,e){return r[0]===e[0]&&r[1]===e[1]}function Os(r,e,t){var n=Ce(t);if(an(t)!=="LineString")throw new Error("line must be a LineString");var i=xt(t,r),o=xt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var u=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)u.push(n[l]);return u.push(s[1].geometry.coordinates),ut(u,t.properties)}function mr(r){let e;return{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Cs(r){let e,t,n,i=r[0]==kt&&mr();return{c(){i&&i.c(),e=Me()},m(o,s){i&&i.m(o,s),S(o,e,s),t||(n=G(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==kt?i||(i=mr(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:z,o:z,d(o){i&&i.d(o),o&&E(e),t=!1,n()}}}const kt="split-route",Ps=10,Fs=30;let Qt="split-route";function Ir(){}function gr(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Rs(r,e,t){let n,i;te(r,ne,v=>t(8,n=v)),te(r,Fe,v=>t(6,i=v));let{mode:o}=e,{changeMode:s}=e;function u(){t(5,l=null),a=null}let l=null,a=null;i.on("mousemove",h),i.on("click",m),ft(()=>{i.off("mousemove",h),i.off("click",m)}),Ke(i,Qt,{type:"geojson",data:Pe()}),me(i,{id:"draw-split-route",source:Qt,...ct("black",Ps,["case",["==",["get","snapped"],!0],1,.5])});function h(v){if(o!=kt)return;t(5,l=gr(v.lngLat.toArray(),!1)),a=null;const y=[v.point.x-Fs,v.point.y],k=i.unproject(v.point).distanceTo(i.unproject(y))/1e3;let c=[];for(let[d,_]of n.features.entries())if(_.geometry.type=="LineString"){let M=xt(_.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=k&&c.push([d,M.geometry.coordinates,M.properties.dist])}c.sort((d,_)=>d[2]-_[2]),c.length>0&&(t(5,l=gr(c[0][1],!0)),a=c[0][0])}function m(){if(o==kt)if(a==null)s("edit-attribute");else{let v=Ls(n.features[a],l);if(v.features.length==2){let y=v.features[0],k=v.features[1];ne.update(c=>(y.id=c.features[a].id,k.id=Ut(c),y.properties=JSON.parse(JSON.stringify(c.features[a].properties)),k.properties=JSON.parse(JSON.stringify(y.properties)),p(c.features[a],y,k,l),c.features.splice(a,1,y,k),c))}u()}}function p(v,y,k,c){y.properties.length_meters=Ft(y,{units:"kilometers"})*1e3,k.properties.length_meters=Ft(k,{units:"kilometers"})*1e3,y.properties.waypoints=[],k.properties.waypoints=[];let d=f(v,c),_=!0,M=0;for(let C of v.properties.waypoints){let O=f(v,lt([C.lon,C.lat]));if(_)if(O<d)y.properties.waypoints.push(C);else{let L=C.snapped&&v.properties.waypoints[M-1].snapped;y.properties.waypoints.push({lon:c.geometry.coordinates[0],lat:c.geometry.coordinates[1],snapped:L}),_=!1,k.properties.waypoints.push({lon:c.geometry.coordinates[0],lat:c.geometry.coordinates[1],snapped:L}),k.properties.waypoints.push(C)}else k.properties.waypoints.push(C);M++}}function f(v,y){let k=v.geometry.coordinates[0],c=Os(k,y,v);return Ft(c,{units:"kilometers"})*1e3}function g(v){o==kt&&v.key=="Escape"&&(s("edit-attribute"),v.preventDefault())}return r.$$set=v=>{"mode"in v&&t(0,o=v.mode),"changeMode"in v&&t(2,s=v.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let v=Pe();l&&v.features.push(l),i.getSource(Qt).setData(v)}},[o,g,s,Ir,u,l,i]}class As extends Z{constructor(e){super(),Q(this,e,Rs,Cs,V,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Ir}get stop(){return this.$$.ctx[4]}}function vr(r){let e,t,n={mode:r[2],pointTool:r[9],polygonTool:r[10],routeTool:r[1]};return e=new cs({props:n}),r[15](e),{c(){X(e.$$.fragment)},m(i,o){U(e,i,o),t=!0},p(i,o){const s={};o&4&&(s.mode=i[2]),o&2&&(s.routeTool=i[1]),e.$set(s)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){r[15](null),J(e,i)}}}function Ts(r){let e,t,n,i,o,s,u,l,a,h,m,p,f,g,v,y,k,c,d,_,M,C,O,L,A,B,I,j,x,N,ie,he,we,oe,ve,Se,de,ee,Ve,Ne,$e,ue,fe,Ze,Be,ht={mode:r[2],changeMode:r[11]};u=new zo({props:ht}),r[13](u);let re=r[1]&&vr(r),ce={mode:r[2],changeMode:r[11],pointTool:r[9]};_=new bs({props:ce}),r[17](_);let R={mode:r[2],changeMode:r[11],polygonTool:r[10]};I=new Ss({props:R}),r[19](I);function Y(H){r[22](H)}let Mn={mode:r[2],changeMode:r[11],url:r[0]};r[1]!==void 0&&(Mn.routeTool=r[1]),oe=new vs({props:Mn}),r[21](oe),pe.push(()=>ze(oe,"routeTool",Y,r[1]));let Nr={mode:r[2],changeMode:r[11]};return ue=new As({props:Nr}),r[24](ue),{c(){e=w("div"),t=w("div"),n=w("button"),i=K("Edit attributes"),s=F(),X(u.$$.fragment),l=F(),a=w("div"),h=w("button"),m=K("Edit geometry"),f=F(),re&&re.c(),g=F(),v=w("div"),y=w("button"),k=K("New point"),d=F(),X(_.$$.fragment),M=F(),C=w("div"),O=w("button"),L=K("New polygon"),B=F(),X(I.$$.fragment),j=F(),x=w("div"),N=w("button"),ie=K("New route"),we=F(),X(oe.$$.fragment),Se=F(),de=w("div"),ee=w("button"),Ve=K("Split route"),$e=F(),X(ue.$$.fragment),P(n,"type","button"),n.disabled=o=r[2]=="edit-attribute",P(n,"class","svelte-cej5os"),P(h,"type","button"),h.disabled=p=r[2]=="edit-geometry",P(h,"class","svelte-cej5os"),P(y,"type","button"),y.disabled=c=r[2]=="point",P(y,"class","svelte-cej5os"),P(O,"type","button"),O.disabled=A=r[2]=="polygon",P(O,"class","svelte-cej5os"),P(N,"type","button"),N.disabled=he=r[2]=="route",P(N,"class","svelte-cej5os"),P(ee,"type","button"),ee.disabled=Ne=r[2]=="split-route",P(ee,"class","svelte-cej5os"),P(e,"class","toolbox svelte-cej5os")},m(H,ae){S(H,e,ae),b(e,t),b(t,n),b(n,i),b(t,s),U(u,t,null),b(e,l),b(e,a),b(a,h),b(h,m),b(a,f),re&&re.m(a,null),b(e,g),b(e,v),b(v,y),b(y,k),b(v,d),U(_,v,null),b(e,M),b(e,C),b(C,O),b(O,L),b(C,B),U(I,C,null),b(e,j),b(e,x),b(x,N),b(N,ie),b(x,we),U(oe,x,null),b(e,Se),b(e,de),b(de,ee),b(ee,Ve),b(de,$e),U(ue,de,null),fe=!0,Ze||(Be=[G(n,"click",r[12]),G(h,"click",r[14]),G(y,"click",r[16]),G(O,"click",r[18]),G(N,"click",r[20]),G(ee,"click",r[23])],Ze=!0)},p(H,[ae]){(!fe||ae&4&&o!==(o=H[2]=="edit-attribute"))&&(n.disabled=o);const Ln={};ae&4&&(Ln.mode=H[2]),u.$set(Ln),(!fe||ae&4&&p!==(p=H[2]=="edit-geometry"))&&(h.disabled=p),H[1]?re?(re.p(H,ae),ae&2&&T(re,1)):(re=vr(H),re.c(),T(re,1),re.m(a,null)):re&&(Te(),$(re,1,1,()=>{re=null}),Ie()),(!fe||ae&4&&c!==(c=H[2]=="point"))&&(y.disabled=c);const On={};ae&4&&(On.mode=H[2]),_.$set(On),(!fe||ae&4&&A!==(A=H[2]=="polygon"))&&(O.disabled=A);const Cn={};ae&4&&(Cn.mode=H[2]),I.$set(Cn),(!fe||ae&4&&he!==(he=H[2]=="route"))&&(N.disabled=he);const Mt={};ae&4&&(Mt.mode=H[2]),ae&1&&(Mt.url=H[0]),!ve&&ae&2&&(ve=!0,Mt.routeTool=H[1],We(()=>ve=!1)),oe.$set(Mt),(!fe||ae&4&&Ne!==(Ne=H[2]=="split-route"))&&(ee.disabled=Ne);const Pn={};ae&4&&(Pn.mode=H[2]),ue.$set(Pn)},i(H){fe||(T(u.$$.fragment,H),T(re),T(_.$$.fragment,H),T(I.$$.fragment,H),T(oe.$$.fragment,H),T(ue.$$.fragment,H),fe=!0)},o(H){$(u.$$.fragment,H),$(re),$(_.$$.fragment,H),$(I.$$.fragment,H),$(oe.$$.fragment,H),$(ue.$$.fragment,H),fe=!1},d(H){H&&E(e),r[13](null),J(u),re&&re.d(),r[17](null),J(_),r[19](null),J(I),r[21](null),J(oe),r[24](null),J(ue),Ze=!1,Je(Be)}}}function Is(r,e,t){let n;te(r,Fe,x=>t(25,n=x));let{routeUrl:i}=e,o,s=new ko(n),u=new To(n),l="edit-attribute",a,h,m,p,f,g;function v(x){let N={"edit-attribute":a,"edit-geometry":h,route:m,point:p,polygon:f,"split-route":g};if(l==x){console.log(`Mode is already ${l}, not changing`);return}console.log(`Stopping old mode ${l}`),N[l].stop(),t(2,l=x),console.log(`Starting new mode ${l}`),N[l].start()}ft(()=>{s==null||s.tearDown(),u==null||u.tearDown()});const y=()=>v("edit-attribute");function k(x){pe[x?"unshift":"push"](()=>{a=x,t(3,a)})}const c=()=>v("edit-geometry");function d(x){pe[x?"unshift":"push"](()=>{h=x,t(4,h)})}const _=()=>v("point");function M(x){pe[x?"unshift":"push"](()=>{p=x,t(6,p)})}const C=()=>v("polygon");function O(x){pe[x?"unshift":"push"](()=>{f=x,t(7,f)})}const L=()=>v("route");function A(x){pe[x?"unshift":"push"](()=>{m=x,t(5,m)})}function B(x){o=x,t(1,o)}const I=()=>v("split-route");function j(x){pe[x?"unshift":"push"](()=>{g=x,t(8,g)})}return r.$$set=x=>{"routeUrl"in x&&t(0,i=x.routeUrl)},[i,o,l,a,h,m,p,f,g,s,u,v,y,k,c,d,_,M,C,O,L,A,B,I,j]}class Ns extends Z{constructor(e){super(),Q(this,e,Is,Ts,V,{routeUrl:0})}}function $s(r){let e,t,n,i,o,s,u,l;return{c(){e=w("div"),t=w("button"),t.textContent="Home",n=F(),i=w("button"),i.textContent="About",o=F(),s=w("button"),s.textContent="Instructions",P(t,"type","button"),P(i,"type","button"),P(s,"type","button"),P(e,"slot","nav")},m(a,h){S(a,e,h),b(e,t),b(e,n),b(e,i),b(e,o),b(e,s),u||(l=[G(t,"click",r[8]),G(i,"click",r[6]),G(s,"click",r[7])],u=!0)},p:z,d(a){a&&E(e),u=!1,Je(l)}}}function Bs(r){let e,t,n,i,o,s,u,l,a,h,m,p;return o=new co({props:{boundaryGeojson:r[3]}}),u=new lo({props:{authorityName:r[4]}}),m=new no({}),{c(){e=w("div"),t=w("h1"),n=K(r[4]),i=F(),X(o.$$.fragment),s=F(),X(u.$$.fragment),l=F(),a=w("br"),h=F(),X(m.$$.fragment),P(e,"slot","sidebar")},m(f,g){S(f,e,g),b(e,t),b(t,n),b(t,i),U(o,t,null),b(e,s),U(u,e,null),b(e,l),b(e,a),b(e,h),U(m,e,null),p=!0},p(f,g){const v={};g&8&&(v.boundaryGeojson=f[3]),o.$set(v)},i(f){p||(T(o.$$.fragment,f),T(u.$$.fragment,f),T(m.$$.fragment,f),p=!0)},o(f){$(o.$$.fragment,f),$(u.$$.fragment,f),$(m.$$.fragment,f),p=!1},d(f){f&&E(e),J(o),J(u),J(m)}}}function Ds(r){let e,t,n,i,o,s,u,l,a,h,m,p;return e=new Xi({props:{boundaryGeojson:r[3]}}),n=new _o({}),o=new wo({}),u=new Ns({props:{routeUrl:r[2]}}),a=new mo({props:{style:r[5]}}),m=new vo({}),{c(){X(e.$$.fragment),t=F(),X(n.$$.fragment),i=F(),X(o.$$.fragment),s=F(),X(u.$$.fragment),l=F(),X(a.$$.fragment),h=F(),X(m.$$.fragment)},m(f,g){U(e,f,g),S(f,t,g),U(n,f,g),S(f,i,g),U(o,f,g),S(f,s,g),U(u,f,g),S(f,l,g),U(a,f,g),S(f,h,g),U(m,f,g),p=!0},p(f,g){const v={};g&8&&(v.boundaryGeojson=f[3]),e.$set(v);const y={};g&4&&(y.routeUrl=f[2]),u.$set(y)},i(f){p||(T(e.$$.fragment,f),T(n.$$.fragment,f),T(o.$$.fragment,f),T(u.$$.fragment,f),T(a.$$.fragment,f),T(m.$$.fragment,f),p=!0)},o(f){$(e.$$.fragment,f),$(n.$$.fragment,f),$(o.$$.fragment,f),$(u.$$.fragment,f),$(a.$$.fragment,f),$(m.$$.fragment,f),p=!1},d(f){J(e,f),f&&E(t),J(n,f),f&&E(i),J(o,f),f&&E(s),J(u,f),f&&E(l),J(a,f),f&&E(h),J(m,f)}}}function Gs(r){let e,t,n;return t=new pi({props:{style:r[5],$$slots:{default:[Ds]},$$scope:{ctx:r}}}),{c(){e=w("div"),X(t.$$.fragment),P(e,"slot","main")},m(i,o){S(i,e,o),U(t,e,null),n=!0},p(i,o){const s={};o&16396&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(T(t.$$.fragment,i),n=!0)},o(i){$(t.$$.fragment,i),n=!1},d(i){i&&E(e),J(t)}}}function js(r){let e,t,n,i,o,s,u,l;e=new yi({props:{$$slots:{main:[Gs],sidebar:[Bs],nav:[$s]},$$scope:{ctx:r}}});function a(f){r[9](f)}let h={};r[0]!==void 0&&(h.open=r[0]),n=new ii({props:h}),pe.push(()=>ze(n,"open",a,r[0]));function m(f){r[10](f)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new ai({props:p}),pe.push(()=>ze(s,"open",m,r[1])),{c(){X(e.$$.fragment),t=F(),X(n.$$.fragment),o=F(),X(s.$$.fragment)},m(f,g){U(e,f,g),S(f,t,g),U(n,f,g),S(f,o,g),U(s,f,g),l=!0},p(f,[g]){const v={};g&16396&&(v.$$scope={dirty:g,ctx:f}),e.$set(v);const y={};!i&&g&1&&(i=!0,y.open=f[0],We(()=>i=!1)),n.$set(y);const k={};!u&&g&2&&(u=!0,k.open=f[1],We(()=>u=!1)),s.$set(k)},i(f){l||(T(e.$$.fragment,f),T(n.$$.fragment,f),T(s.$$.fragment,f),l=!0)},o(f){$(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!1},d(f){J(e,f),f&&E(t),J(n,f),f&&E(o),J(s,f)}}}function Ys(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let u=s.get("authority"),l=s.get("style")||"streets";var a=`https://atip.uk/route-snappers/${u}.bin`;o||(a=`https://atip.uk/route-snappers-dev/${u}.bin`);function h(){t(0,n=!n),t(1,i=!1)}function m(){t(1,i=!i),t(0,n=!1)}let p;gn(async()=>{t(3,p=await f())});async function f(){const c=await(await fetch(oi)).text(),d=JSON.parse(c);return d.features=d.features.filter(_=>{var M;return((M=_.properties)==null?void 0:M.name)==u}),d}const g=()=>window.open("index.html");function v(k){n=k,t(0,n)}function y(k){i=k,t(1,i)}return[n,i,a,p,u,l,h,m,g,v,y]}class qs extends Z{constructor(e){super(),Q(this,e,Ys,js,V,{})}}new qs({target:document.getElementById("app")});
