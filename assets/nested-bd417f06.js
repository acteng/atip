var Xi=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var ft=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)};var de=(n,e,t)=>(Xi(n,e,"access private method"),t);import{S as oe,i as le,s as se,x as ce,y as xe,f as R,z as yt,g as M,h as S,B as at,C as re,p as P,D as ye,E as Xe,t as W,F as pe,e as L,c as z,G as T,H as He,l as X,n as I,I as Ee,o as D,J as Me,r as Je,K as on,L as Gn,M as dt,N as he,O as Re,P as Ae,Q as Oe,R as Ne,T as ne,b as fe,U as mi,V as gi,W as ln,X as rr,Y as Ji,j as wt,d as V,m as H,q as Z,Z as Ui,a as De,k as Ye,_ as Dt,$ as Wi,a0 as hn,a1 as qn,a2 as ir,w as Dn,a3 as Tt,a4 as ut,a5 as bi,a6 as or,a7 as ji,a8 as Vi,a9 as Hi,aa as lr,ab as Zi,ac as Qi,ad as Yn,A as Ki,u as $i}from"./authorities-792034fc.js";function sr(n){let e,t;return{c(){e=xe("title"),t=W(n[1])},m(r,i){M(r,e,i),S(e,t)},p(r,i){i&2&&pe(t,r[1])},d(r){r&&P(e)}}}function eo(n){let e,t,r,i=n[1]&&sr(n),o=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],l={};for(let s=0;s<o.length;s+=1)l=ce(l,o[s]);return{c(){e=xe("svg"),i&&i.c(),t=xe("path"),r=xe("path"),R(t,"d","M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14C30,8.3,23.7,2,16,2z M14.9,8h2.2v11h-2.2V8z M16,25	c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22c0.8,0,1.5,0.7,1.5,1.5S16.8,25,16,25z"),R(r,"fill","none"),R(r,"d","M17.5,23.5c0,0.8-0.7,1.5-1.5,1.5c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22	C16.8,22,17.5,22.7,17.5,23.5z M17.1,8h-2.2v11h2.2V8z"),R(r,"data-icon-path","inner-path"),R(r,"opacity","0"),yt(e,l)},m(s,u){M(s,e,u),i&&i.m(e,null),S(e,t),S(e,r)},p(s,[u]){s[1]?i?i.p(s,u):(i=sr(s),i.c(),i.m(e,t)):i&&(i.d(1),i=null),yt(e,l=at(o,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},u&1&&{width:s[0]},u&1&&{height:s[0]},u&4&&s[2],u&8&&s[3]]))},i:re,o:re,d(s){s&&P(e),i&&i.d()}}}function to(n,e,t){let r,i;const o=["size","title"];let l=ye(e,o),{size:s=16}=e,{title:u=void 0}=e;return n.$$set=a=>{t(5,e=ce(ce({},e),Xe(a))),t(3,l=ye(e,o)),"size"in a&&t(0,s=a.size),"title"in a&&t(1,u=a.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||u),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=Xe(e),[s,u,i,l,r]}class no extends oe{constructor(e){super(),le(this,e,to,eo,se,{size:0,title:1})}}const vi=no;function ar(n){let e,t;return{c(){e=xe("title"),t=W(n[1])},m(r,i){M(r,e,i),S(e,t)},p(r,i){i&2&&pe(t,r[1])},d(r){r&&P(e)}}}function ro(n){let e,t,r,i,o=n[1]&&ar(n),l=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],s={};for(let u=0;u<l.length;u+=1)s=ce(s,l[u]);return{c(){e=xe("svg"),o&&o.c(),t=xe("path"),r=xe("path"),i=xe("path"),R(t,"fill","none"),R(t,"d","M16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Zm-1.125-5h2.25V12h-2.25Z"),R(t,"data-icon-path","inner-path"),R(r,"d","M16.002,6.1714h-.004L4.6487,27.9966,4.6506,28H27.3494l.0019-.0034ZM14.875,12h2.25v9h-2.25ZM16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Z"),R(i,"d","M29,30H3a1,1,0,0,1-.8872-1.4614l13-25a1,1,0,0,1,1.7744,0l13,25A1,1,0,0,1,29,30ZM4.6507,28H27.3493l.002-.0033L16.002,6.1714h-.004L4.6487,27.9967Z"),yt(e,s)},m(u,a){M(u,e,a),o&&o.m(e,null),S(e,t),S(e,r),S(e,i)},p(u,[a]){u[1]?o?o.p(u,a):(o=ar(u),o.c(),o.m(e,t)):o&&(o.d(1),o=null),yt(e,s=at(l,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:u[0]},a&1&&{height:u[0]},a&4&&u[2],a&8&&u[3]]))},i:re,o:re,d(u){u&&P(e),o&&o.d()}}}function io(n,e,t){let r,i;const o=["size","title"];let l=ye(e,o),{size:s=16}=e,{title:u=void 0}=e;return n.$$set=a=>{t(5,e=ce(ce({},e),Xe(a))),t(3,l=ye(e,o)),"size"in a&&t(0,s=a.size),"title"in a&&t(1,u=a.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||u),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=Xe(e),[s,u,i,l,r]}class oo extends oe{constructor(e){super(),le(this,e,io,ro,se,{size:0,title:1})}}const lo=oo,so=n=>({}),ur=n=>({});function fr(n){let e,t;const r=n[16].labelText,i=Re(r,n,n[15],ur),o=i||ao(n);return{c(){e=L("span"),o&&o.c(),T(e,"bx--visually-hidden",n[7])},m(l,s){M(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s&32768)&&Ae(i,r,l,l[15],t?Ne(r,l[15],s,so):Oe(l[15]),ur):o&&o.p&&(!t||s&64)&&o.p(l,t?s:-1),(!t||s&128)&&T(e,"bx--visually-hidden",l[7])},i(l){t||(I(o,l),t=!0)},o(l){D(o,l),t=!1},d(l){l&&P(e),o&&o.d(l)}}}function ao(n){let e;return{c(){e=W(n[6])},m(t,r){M(t,e,r)},p(t,r){r&64&&pe(e,t[6])},d(t){t&&P(e)}}}function uo(n){let e,t,r,i,o,l,s,u,a,d=(n[6]||n[13].labelText)&&fr(n),g=[n[12]],c={};for(let f=0;f<g.length;f+=1)c=ce(c,g[f]);return{c(){e=L("div"),t=L("input"),r=z(),i=L("label"),o=L("span"),l=z(),d&&d.c(),R(t,"type","radio"),R(t,"id",n[8]),R(t,"name",n[9]),t.checked=n[0],t.disabled=n[3],t.required=n[4],t.value=n[2],T(t,"bx--radio-button",!0),T(o,"bx--radio-button__appearance",!0),R(i,"for",n[8]),T(i,"bx--radio-button__label",!0),He(e,c),T(e,"bx--radio-button-wrapper",!0),T(e,"bx--radio-button-wrapper--label-left",n[5]==="left")},m(f,h){M(f,e,h),S(e,t),n[18](t),S(e,r),S(e,i),S(i,o),S(i,l),d&&d.m(i,null),s=!0,u||(a=[X(t,"change",n[17]),X(t,"change",n[19])],u=!0)},p(f,[h]){(!s||h&256)&&R(t,"id",f[8]),(!s||h&512)&&R(t,"name",f[9]),(!s||h&1)&&(t.checked=f[0]),(!s||h&8)&&(t.disabled=f[3]),(!s||h&16)&&(t.required=f[4]),(!s||h&4)&&(t.value=f[2]),f[6]||f[13].labelText?d?(d.p(f,h),h&8256&&I(d,1)):(d=fr(f),d.c(),I(d,1),d.m(i,null)):d&&(Ee(),D(d,1,1,()=>{d=null}),Me()),(!s||h&256)&&R(i,"for",f[8]),He(e,c=at(g,[h&4096&&f[12]])),T(e,"bx--radio-button-wrapper",!0),T(e,"bx--radio-button-wrapper--label-left",f[5]==="left")},i(f){s||(I(d),s=!0)},o(f){D(d),s=!1},d(f){f&&P(e),n[18](null),d&&d.d(),u=!1,Je(a)}}}function fo(n,e,t){const r=["value","checked","disabled","required","labelPosition","labelText","hideLabel","id","name","ref"];let i=ye(e,r),o,{$$slots:l={},$$scope:s}=e;const u=on(l);let{value:a=""}=e,{checked:d=!1}=e,{disabled:g=!1}=e,{required:c=!1}=e,{labelPosition:f="right"}=e,{labelText:h=""}=e,{hideLabel:b=!1}=e,{id:y="ccs-"+Math.random().toString(36)}=e,{name:O=""}=e,{ref:m=null}=e;const p=Gn("RadioButtonGroup"),v=p?p.selectedValue:dt(d?a:void 0);he(n,v,x=>t(14,o=x)),p&&p.add({id:y,checked:d,disabled:g,value:a});function k(x){ne.call(this,n,x)}function _(x){fe[x?"unshift":"push"](()=>{m=x,t(1,m)})}const A=()=>{p&&p.update(a)};return n.$$set=x=>{e=ce(ce({},e),Xe(x)),t(12,i=ye(e,r)),"value"in x&&t(2,a=x.value),"checked"in x&&t(0,d=x.checked),"disabled"in x&&t(3,g=x.disabled),"required"in x&&t(4,c=x.required),"labelPosition"in x&&t(5,f=x.labelPosition),"labelText"in x&&t(6,h=x.labelText),"hideLabel"in x&&t(7,b=x.hideLabel),"id"in x&&t(8,y=x.id),"name"in x&&t(9,O=x.name),"ref"in x&&t(1,m=x.ref),"$$scope"in x&&t(15,s=x.$$scope)},n.$$.update=()=>{n.$$.dirty&16388&&t(0,d=o===a)},[d,m,a,g,c,f,h,b,y,O,p,v,i,u,o,s,l,k,_,A]}class co extends oe{constructor(e){super(),le(this,e,fo,uo,se,{value:2,checked:0,disabled:3,required:4,labelPosition:5,labelText:6,hideLabel:7,id:8,name:9,ref:1})}}const Yt=co;function ho(n){const e=n-1;return e*e*e+1}function cr(n,{delay:e=0,duration:t=400,easing:r=ho}={}){const i=getComputedStyle(n),o=+i.opacity,l=parseFloat(i.height),s=parseFloat(i.paddingTop),u=parseFloat(i.paddingBottom),a=parseFloat(i.marginTop),d=parseFloat(i.marginBottom),g=parseFloat(i.borderTopWidth),c=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:r,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*l}px;padding-top: ${f*s}px;padding-bottom: ${f*u}px;margin-top: ${f*a}px;margin-bottom: ${f*d}px;border-top-width: ${f*g}px;border-bottom-width: ${f*c}px;`}}function dr(n){let e,t;return{c(){e=xe("title"),t=W(n[1])},m(r,i){M(r,e,i),S(e,t)},p(r,i){i&2&&pe(t,r[1])},d(r){r&&P(e)}}}function po(n){let e,t,r=n[1]&&dr(n),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],o={};for(let l=0;l<i.length;l+=1)o=ce(o,i[l]);return{c(){e=xe("svg"),r&&r.c(),t=xe("path"),R(t,"d","M30 28.6L3.4 2 2 3.4l10.1 10.1L4 21.6V28h6.4l8.1-8.1L28.6 30 30 28.6zM9.6 26H6v-3.6l7.5-7.5 3.6 3.6L9.6 26zM29.4 6.2L29.4 6.2l-3.6-3.6c-.8-.8-2-.8-2.8 0l0 0 0 0-8 8 1.4 1.4L20 8.4l3.6 3.6L20 15.6l1.4 1.4 8-8C30.2 8.2 30.2 7 29.4 6.2L29.4 6.2zM25 10.6L21.4 7l3-3L28 7.6 25 10.6z"),yt(e,o)},m(l,s){M(l,e,s),r&&r.m(e,null),S(e,t)},p(l,[s]){l[1]?r?r.p(l,s):(r=dr(l),r.c(),r.m(e,t)):r&&(r.d(1),r=null),yt(e,o=at(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},s&1&&{width:l[0]},s&1&&{height:l[0]},s&4&&l[2],s&8&&l[3]]))},i:re,o:re,d(l){l&&P(e),r&&r.d()}}}function mo(n,e,t){let r,i;const o=["size","title"];let l=ye(e,o),{size:s=16}=e,{title:u=void 0}=e;return n.$$set=a=>{t(5,e=ce(ce({},e),Xe(a))),t(3,l=ye(e,o)),"size"in a&&t(0,s=a.size),"title"in a&&t(1,u=a.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||u),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=Xe(e),[s,u,i,l,r]}class go extends oe{constructor(e){super(),le(this,e,mo,po,se,{size:0,title:1})}}const bo=go;function vo(n){let e,t,r,i;const o=n[5].default,l=Re(o,n,n[4],null);let s=[n[3]],u={};for(let a=0;a<s.length;a+=1)u=ce(u,s[a]);return{c(){e=L("ol"),l&&l.c(),He(e,u),T(e,"bx--list--ordered",!n[1]),T(e,"bx--list--ordered--native",n[1]),T(e,"bx--list--nested",n[0]),T(e,"bx--list--expressive",n[2])},m(a,d){M(a,e,d),l&&l.m(e,null),t=!0,r||(i=[X(e,"click",n[6]),X(e,"mouseover",n[7]),X(e,"mouseenter",n[8]),X(e,"mouseleave",n[9])],r=!0)},p(a,[d]){l&&l.p&&(!t||d&16)&&Ae(l,o,a,a[4],t?Ne(o,a[4],d,null):Oe(a[4]),null),He(e,u=at(s,[d&8&&a[3]])),T(e,"bx--list--ordered",!a[1]),T(e,"bx--list--ordered--native",a[1]),T(e,"bx--list--nested",a[0]),T(e,"bx--list--expressive",a[2])},i(a){t||(I(l,a),t=!0)},o(a){D(l,a),t=!1},d(a){a&&P(e),l&&l.d(a),r=!1,Je(i)}}}function _o(n,e,t){const r=["nested","native","expressive"];let i=ye(e,r),{$$slots:o={},$$scope:l}=e,{nested:s=!1}=e,{native:u=!1}=e,{expressive:a=!1}=e;function d(h){ne.call(this,n,h)}function g(h){ne.call(this,n,h)}function c(h){ne.call(this,n,h)}function f(h){ne.call(this,n,h)}return n.$$set=h=>{e=ce(ce({},e),Xe(h)),t(3,i=ye(e,r)),"nested"in h&&t(0,s=h.nested),"native"in h&&t(1,u=h.native),"expressive"in h&&t(2,a=h.expressive),"$$scope"in h&&t(4,l=h.$$scope)},[s,u,a,i,l,o,d,g,c,f]}class yo extends oe{constructor(e){super(),le(this,e,_o,vo,se,{nested:0,native:1,expressive:2})}}const wo=yo,ko=n=>({}),hr=n=>({});function pr(n){let e,t;const r=n[11].legendText,i=Re(r,n,n[10],hr),o=i||So(n);return{c(){e=L("legend"),o&&o.c(),T(e,"bx--label",!0),T(e,"bx--visually-hidden",n[2])},m(l,s){M(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s&1024)&&Ae(i,r,l,l[10],t?Ne(r,l[10],s,ko):Oe(l[10]),hr):o&&o.p&&(!t||s&2)&&o.p(l,t?s:-1),(!t||s&4)&&T(e,"bx--visually-hidden",l[2])},i(l){t||(I(o,l),t=!0)},o(l){D(o,l),t=!1},d(l){l&&P(e),o&&o.d(l)}}}function So(n){let e;return{c(){e=W(n[1])},m(t,r){M(t,e,r)},p(t,r){r&2&&pe(e,t[1])},d(t){t&&P(e)}}}function Eo(n){let e,t,r,i,o,l,s=(n[1]||n[8].legendText)&&pr(n);const u=n[11].default,a=Re(u,n,n[10],null);let d=[{id:n[5]},n[7]],g={};for(let c=0;c<d.length;c+=1)g=ce(g,d[c]);return{c(){e=L("div"),t=L("fieldset"),s&&s.c(),r=z(),a&&a.c(),t.disabled=n[0],T(t,"bx--radio-button-group",!0),T(t,"bx--radio-button-group--vertical",n[4]==="vertical"),T(t,"bx--radio-button-group--label-left",n[3]==="left"),T(t,"bx--radio-button-group--label-right",n[3]==="right"),He(e,g),T(e,"bx--form-item",!0)},m(c,f){M(c,e,f),S(e,t),s&&s.m(t,null),S(t,r),a&&a.m(t,null),i=!0,o||(l=[X(e,"click",n[12]),X(e,"mouseover",n[13]),X(e,"mouseenter",n[14]),X(e,"mouseleave",n[15])],o=!0)},p(c,[f]){c[1]||c[8].legendText?s?(s.p(c,f),f&258&&I(s,1)):(s=pr(c),s.c(),I(s,1),s.m(t,r)):s&&(Ee(),D(s,1,1,()=>{s=null}),Me()),a&&a.p&&(!i||f&1024)&&Ae(a,u,c,c[10],i?Ne(u,c[10],f,null):Oe(c[10]),null),(!i||f&1)&&(t.disabled=c[0]),(!i||f&16)&&T(t,"bx--radio-button-group--vertical",c[4]==="vertical"),(!i||f&8)&&T(t,"bx--radio-button-group--label-left",c[3]==="left"),(!i||f&8)&&T(t,"bx--radio-button-group--label-right",c[3]==="right"),He(e,g=at(d,[(!i||f&32)&&{id:c[5]},f&128&&c[7]])),T(e,"bx--form-item",!0)},i(c){i||(I(s),I(a,c),i=!0)},o(c){D(s),D(a,c),i=!1},d(c){c&&P(e),s&&s.d(),a&&a.d(c),o=!1,Je(l)}}}function Mo(n,e,t){const r=["selected","disabled","legendText","hideLegend","labelPosition","orientation","id"];let i=ye(e,r),o,{$$slots:l={},$$scope:s}=e;const u=on(l);let{selected:a=void 0}=e,{disabled:d=!1}=e,{legendText:g=""}=e,{hideLegend:c=!1}=e,{labelPosition:f="right"}=e,{orientation:h="horizontal"}=e,{id:b=void 0}=e;const y=mi(),O=dt(a);he(n,O,_=>t(16,o=_)),gi("RadioButtonGroup",{selectedValue:O,add:({checked:_,value:A})=>{_&&O.set(A)},update:_=>{t(9,a=_)}}),ln(()=>{rr(O,o=a,o)}),Ji(()=>{rr(O,o=a,o)}),O.subscribe(_=>{t(9,a=_),y("change",_)});function m(_){ne.call(this,n,_)}function p(_){ne.call(this,n,_)}function v(_){ne.call(this,n,_)}function k(_){ne.call(this,n,_)}return n.$$set=_=>{e=ce(ce({},e),Xe(_)),t(7,i=ye(e,r)),"selected"in _&&t(9,a=_.selected),"disabled"in _&&t(0,d=_.disabled),"legendText"in _&&t(1,g=_.legendText),"hideLegend"in _&&t(2,c=_.hideLegend),"labelPosition"in _&&t(3,f=_.labelPosition),"orientation"in _&&t(4,h=_.orientation),"id"in _&&t(5,b=_.id),"$$scope"in _&&t(10,s=_.$$scope)},[d,g,c,f,h,b,O,i,u,a,s,l,m,p,v,k]}class Po extends oe{constructor(e){super(),le(this,e,Mo,Eo,se,{selected:9,disabled:0,legendText:1,hideLegend:2,labelPosition:3,orientation:4,id:5})}}const xo=Po,To=n=>({}),mr=n=>({});function gr(n){let e,t,r,i;const o=n[20].labelText,l=Re(o,n,n[19],mr),s=l||Lo(n);let u=n[5]&&br(n);return{c(){e=L("div"),t=L("label"),s&&s.c(),r=z(),u&&u.c(),R(t,"for",n[14]),T(t,"bx--label",!0),T(t,"bx--visually-hidden",n[11]),T(t,"bx--label--disabled",n[7]),T(e,"bx--text-area__label-wrapper",!0)},m(a,d){M(a,e,d),S(e,t),s&&s.m(t,null),S(e,r),u&&u.m(e,null),i=!0},p(a,d){l?l.p&&(!i||d[0]&524288)&&Ae(l,o,a,a[19],i?Ne(o,a[19],d,To):Oe(a[19]),mr):s&&s.p&&(!i||d[0]&1024)&&s.p(a,i?d:[-1,-1]),(!i||d[0]&16384)&&R(t,"for",a[14]),(!i||d[0]&2048)&&T(t,"bx--visually-hidden",a[11]),(!i||d[0]&128)&&T(t,"bx--label--disabled",a[7]),a[5]?u?u.p(a,d):(u=br(a),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},i(a){i||(I(s,a),i=!0)},o(a){D(s,a),i=!1},d(a){a&&P(e),s&&s.d(a),u&&u.d()}}}function Lo(n){let e;return{c(){e=W(n[10])},m(t,r){M(t,e,r)},p(t,r){r[0]&1024&&pe(e,t[10])},d(t){t&&P(e)}}}function br(n){let e,t=n[0].length+"",r,i,o;return{c(){e=L("div"),r=W(t),i=W("/"),o=W(n[5]),T(e,"bx--label",!0),T(e,"bx--label--disabled",n[7])},m(l,s){M(l,e,s),S(e,r),S(e,i),S(e,o)},p(l,s){s[0]&1&&t!==(t=l[0].length+"")&&pe(r,t),s[0]&32&&pe(o,l[5]),s[0]&128&&T(e,"bx--label--disabled",l[7])},d(l){l&&P(e)}}}function vr(n){let e,t;return e=new vi({props:{class:"bx--text-area__invalid-icon"}}),{c(){V(e.$$.fragment)},m(r,i){H(e,r,i),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){Z(e,r)}}}function _r(n){let e,t;return{c(){e=L("div"),t=W(n[9]),T(e,"bx--form__helper-text",!0),T(e,"bx--form__helper-text--disabled",n[7])},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&512&&pe(t,r[9]),i[0]&128&&T(e,"bx--form__helper-text--disabled",r[7])},d(r){r&&P(e)}}}function yr(n){let e,t;return{c(){e=L("div"),t=W(n[13]),R(e,"id",n[16]),T(e,"bx--form-requirement",!0)},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&8192&&pe(t,r[13]),i[0]&65536&&R(e,"id",r[16])},d(r){r&&P(e)}}}function Co(n){let e,t,r,i,o,l,s,u,a,d,g,c,f,h,b=(n[10]||n[17].labelText)&&!n[11]&&gr(n),y=n[12]&&vr(),O=[{"aria-invalid":l=n[12]||void 0},{"aria-describedby":s=n[12]?n[16]:void 0},{disabled:n[7]},{id:n[14]},{name:n[15]},{cols:n[3]},{rows:n[4]},{placeholder:n[2]},{readOnly:n[8]},{maxlength:u=n[5]??void 0},n[18]],m={};for(let k=0;k<O.length;k+=1)m=ce(m,O[k]);let p=!n[12]&&n[9]&&_r(n),v=n[12]&&yr(n);return{c(){e=L("div"),b&&b.c(),t=z(),r=L("div"),y&&y.c(),i=z(),o=L("textarea"),d=z(),p&&p.c(),g=z(),v&&v.c(),He(o,m),T(o,"bx--text-area",!0),T(o,"bx--text-area--light",n[6]),T(o,"bx--text-area--invalid",n[12]),R(r,"data-invalid",a=n[12]||void 0),T(r,"bx--text-area__wrapper",!0),T(e,"bx--form-item",!0)},m(k,_){M(k,e,_),b&&b.m(e,null),S(e,t),S(e,r),y&&y.m(r,null),S(r,i),S(r,o),o.autofocus&&o.focus(),n[32](o),wt(o,n[0]),S(e,d),p&&p.m(e,null),S(e,g),v&&v.m(e,null),c=!0,f||(h=[X(o,"input",n[33]),X(o,"change",n[25]),X(o,"input",n[26]),X(o,"keydown",n[27]),X(o,"keyup",n[28]),X(o,"focus",n[29]),X(o,"blur",n[30]),X(o,"paste",n[31]),X(e,"click",n[21]),X(e,"mouseover",n[22]),X(e,"mouseenter",n[23]),X(e,"mouseleave",n[24])],f=!0)},p(k,_){(k[10]||k[17].labelText)&&!k[11]?b?(b.p(k,_),_[0]&134144&&I(b,1)):(b=gr(k),b.c(),I(b,1),b.m(e,t)):b&&(Ee(),D(b,1,1,()=>{b=null}),Me()),k[12]?y?_[0]&4096&&I(y,1):(y=vr(),y.c(),I(y,1),y.m(r,i)):y&&(Ee(),D(y,1,1,()=>{y=null}),Me()),He(o,m=at(O,[(!c||_[0]&4096&&l!==(l=k[12]||void 0))&&{"aria-invalid":l},(!c||_[0]&69632&&s!==(s=k[12]?k[16]:void 0))&&{"aria-describedby":s},(!c||_[0]&128)&&{disabled:k[7]},(!c||_[0]&16384)&&{id:k[14]},(!c||_[0]&32768)&&{name:k[15]},(!c||_[0]&8)&&{cols:k[3]},(!c||_[0]&16)&&{rows:k[4]},(!c||_[0]&4)&&{placeholder:k[2]},(!c||_[0]&256)&&{readOnly:k[8]},(!c||_[0]&32&&u!==(u=k[5]??void 0))&&{maxlength:u},_[0]&262144&&k[18]])),_[0]&1&&wt(o,k[0]),T(o,"bx--text-area",!0),T(o,"bx--text-area--light",k[6]),T(o,"bx--text-area--invalid",k[12]),(!c||_[0]&4096&&a!==(a=k[12]||void 0))&&R(r,"data-invalid",a),!k[12]&&k[9]?p?p.p(k,_):(p=_r(k),p.c(),p.m(e,g)):p&&(p.d(1),p=null),k[12]?v?v.p(k,_):(v=yr(k),v.c(),v.m(e,null)):v&&(v.d(1),v=null)},i(k){c||(I(b),I(y),c=!0)},o(k){D(b),D(y),c=!1},d(k){k&&P(e),b&&b.d(),y&&y.d(),n[32](null),p&&p.d(),v&&v.d(),f=!1,Je(h)}}}function Ro(n,e,t){let r;const i=["value","placeholder","cols","rows","maxCount","light","disabled","readonly","helperText","labelText","hideLabel","invalid","invalidText","id","name","ref"];let o=ye(e,i),{$$slots:l={},$$scope:s}=e;const u=on(l);let{value:a=""}=e,{placeholder:d=""}=e,{cols:g=50}=e,{rows:c=4}=e,{maxCount:f=void 0}=e,{light:h=!1}=e,{disabled:b=!1}=e,{readonly:y=!1}=e,{helperText:O=""}=e,{labelText:m=""}=e,{hideLabel:p=!1}=e,{invalid:v=!1}=e,{invalidText:k=""}=e,{id:_="ccs-"+Math.random().toString(36)}=e,{name:A=void 0}=e,{ref:x=null}=e;function F(w){ne.call(this,n,w)}function q(w){ne.call(this,n,w)}function E(w){ne.call(this,n,w)}function B(w){ne.call(this,n,w)}function N(w){ne.call(this,n,w)}function C(w){ne.call(this,n,w)}function G(w){ne.call(this,n,w)}function J(w){ne.call(this,n,w)}function te(w){ne.call(this,n,w)}function $(w){ne.call(this,n,w)}function ee(w){ne.call(this,n,w)}function ae(w){fe[w?"unshift":"push"](()=>{x=w,t(1,x)})}function ie(){a=this.value,t(0,a)}return n.$$set=w=>{e=ce(ce({},e),Xe(w)),t(18,o=ye(e,i)),"value"in w&&t(0,a=w.value),"placeholder"in w&&t(2,d=w.placeholder),"cols"in w&&t(3,g=w.cols),"rows"in w&&t(4,c=w.rows),"maxCount"in w&&t(5,f=w.maxCount),"light"in w&&t(6,h=w.light),"disabled"in w&&t(7,b=w.disabled),"readonly"in w&&t(8,y=w.readonly),"helperText"in w&&t(9,O=w.helperText),"labelText"in w&&t(10,m=w.labelText),"hideLabel"in w&&t(11,p=w.hideLabel),"invalid"in w&&t(12,v=w.invalid),"invalidText"in w&&t(13,k=w.invalidText),"id"in w&&t(14,_=w.id),"name"in w&&t(15,A=w.name),"ref"in w&&t(1,x=w.ref),"$$scope"in w&&t(19,s=w.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&16384&&t(16,r=`error-${_}`)},[a,x,d,g,c,f,h,b,y,O,m,p,v,k,_,A,r,u,o,s,l,F,q,E,B,N,C,G,J,te,$,ee,ae,ie]}class Ao extends oe{constructor(e){super(),le(this,e,Ro,Co,se,{value:0,placeholder:2,cols:3,rows:4,maxCount:5,light:6,disabled:7,readonly:8,helperText:9,labelText:10,hideLabel:11,invalid:12,invalidText:13,id:14,name:15,ref:1},null,[-1,-1])}}const Oo=Ao,No=n=>({}),wr=n=>({}),Fo=n=>({}),kr=n=>({});function Sr(n){let e,t,r,i=n[9]&&Er(n),o=!n[20]&&n[6]&&Mr(n);return{c(){e=L("div"),i&&i.c(),t=z(),o&&o.c(),T(e,"bx--text-input__label-helper-wrapper",!0)},m(l,s){M(l,e,s),i&&i.m(e,null),S(e,t),o&&o.m(e,null),r=!0},p(l,s){l[9]?i?(i.p(l,s),s[0]&512&&I(i,1)):(i=Er(l),i.c(),I(i,1),i.m(e,t)):i&&(Ee(),D(i,1,1,()=>{i=null}),Me()),!l[20]&&l[6]?o?o.p(l,s):(o=Mr(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(l){r||(I(i),r=!0)},o(l){D(i),r=!1},d(l){l&&P(e),i&&i.d(),o&&o.d()}}}function Er(n){let e,t;const r=n[26].labelText,i=Re(r,n,n[25],kr),o=i||Io(n);return{c(){e=L("label"),o&&o.c(),R(e,"for",n[7]),T(e,"bx--label",!0),T(e,"bx--visually-hidden",n[10]),T(e,"bx--label--disabled",n[5]),T(e,"bx--label--inline",n[16]),T(e,"bx--label--inline--sm",n[2]==="sm"),T(e,"bx--label--inline--xl",n[2]==="xl")},m(l,s){M(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s[0]&33554432)&&Ae(i,r,l,l[25],t?Ne(r,l[25],s,Fo):Oe(l[25]),kr):o&&o.p&&(!t||s[0]&512)&&o.p(l,t?s:[-1,-1]),(!t||s[0]&128)&&R(e,"for",l[7]),(!t||s[0]&1024)&&T(e,"bx--visually-hidden",l[10]),(!t||s[0]&32)&&T(e,"bx--label--disabled",l[5]),(!t||s[0]&65536)&&T(e,"bx--label--inline",l[16]),(!t||s[0]&4)&&T(e,"bx--label--inline--sm",l[2]==="sm"),(!t||s[0]&4)&&T(e,"bx--label--inline--xl",l[2]==="xl")},i(l){t||(I(o,l),t=!0)},o(l){D(o,l),t=!1},d(l){l&&P(e),o&&o.d(l)}}}function Io(n){let e;return{c(){e=W(n[9])},m(t,r){M(t,e,r)},p(t,r){r[0]&512&&pe(e,t[9])},d(t){t&&P(e)}}}function Mr(n){let e,t;return{c(){e=L("div"),t=W(n[6]),T(e,"bx--form__helper-text",!0),T(e,"bx--form__helper-text--disabled",n[5]),T(e,"bx--form__helper-text--inline",n[16])},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&64&&pe(t,r[6]),i[0]&32&&T(e,"bx--form__helper-text--disabled",r[5]),i[0]&65536&&T(e,"bx--form__helper-text--inline",r[16])},d(r){r&&P(e)}}}function Pr(n){let e,t;const r=n[26].labelText,i=Re(r,n,n[25],wr),o=i||Bo(n);return{c(){e=L("label"),o&&o.c(),R(e,"for",n[7]),T(e,"bx--label",!0),T(e,"bx--visually-hidden",n[10]),T(e,"bx--label--disabled",n[5]),T(e,"bx--label--inline",n[16]),T(e,"bx--label--inline-sm",n[16]&&n[2]==="sm"),T(e,"bx--label--inline-xl",n[16]&&n[2]==="xl")},m(l,s){M(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s[0]&33554432)&&Ae(i,r,l,l[25],t?Ne(r,l[25],s,No):Oe(l[25]),wr):o&&o.p&&(!t||s[0]&512)&&o.p(l,t?s:[-1,-1]),(!t||s[0]&128)&&R(e,"for",l[7]),(!t||s[0]&1024)&&T(e,"bx--visually-hidden",l[10]),(!t||s[0]&32)&&T(e,"bx--label--disabled",l[5]),(!t||s[0]&65536)&&T(e,"bx--label--inline",l[16]),(!t||s[0]&65540)&&T(e,"bx--label--inline-sm",l[16]&&l[2]==="sm"),(!t||s[0]&65540)&&T(e,"bx--label--inline-xl",l[16]&&l[2]==="xl")},i(l){t||(I(o,l),t=!0)},o(l){D(o,l),t=!1},d(l){l&&P(e),o&&o.d(l)}}}function Bo(n){let e;return{c(){e=W(n[9])},m(t,r){M(t,e,r)},p(t,r){r[0]&512&&pe(e,t[9])},d(t){t&&P(e)}}}function xr(n){let e,t;return e=new vi({props:{class:"bx--text-input__invalid-icon"}}),{c(){V(e.$$.fragment)},m(r,i){H(e,r,i),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){Z(e,r)}}}function Tr(n){let e,t;return e=new lo({props:{class:`bx--text-input__invalid-icon
            bx--text-input__invalid-icon--warning`}}),{c(){V(e.$$.fragment)},m(r,i){H(e,r,i),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){Z(e,r)}}}function Lr(n){let e,t;return e=new bo({props:{class:"bx--text-input__readonly-icon"}}),{c(){V(e.$$.fragment)},m(r,i){H(e,r,i),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){Z(e,r)}}}function Cr(n){let e;return{c(){e=L("hr"),T(e,"bx--text-input__divider",!0)},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function Rr(n){let e,t;return{c(){e=L("div"),t=W(n[12]),R(e,"id",n[19]),T(e,"bx--form-requirement",!0)},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&4096&&pe(t,r[12]),i[0]&524288&&R(e,"id",r[19])},d(r){r&&P(e)}}}function Ar(n){let e,t;return{c(){e=L("div"),t=W(n[14]),R(e,"id",n[18]),T(e,"bx--form-requirement",!0)},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&16384&&pe(t,r[14]),i[0]&262144&&R(e,"id",r[18])},d(r){r&&P(e)}}}function Or(n){let e,t;return{c(){e=L("div"),t=W(n[6]),T(e,"bx--form__helper-text",!0),T(e,"bx--form__helper-text--disabled",n[5]),T(e,"bx--form__helper-text--inline",n[16])},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&64&&pe(t,r[6]),i[0]&32&&T(e,"bx--form__helper-text--disabled",r[5]),i[0]&65536&&T(e,"bx--form__helper-text--inline",r[16])},d(r){r&&P(e)}}}function Nr(n){let e,t;return{c(){e=L("div"),t=W(n[12]),R(e,"id",n[19]),T(e,"bx--form-requirement",!0)},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&4096&&pe(t,r[12]),i[0]&524288&&R(e,"id",r[19])},d(r){r&&P(e)}}}function Fr(n){let e,t;return{c(){e=L("div"),t=W(n[14]),R(e,"id",n[18]),T(e,"bx--form-requirement",!0)},m(r,i){M(r,e,i),S(e,t)},p(r,i){i[0]&16384&&pe(t,r[14]),i[0]&262144&&R(e,"id",r[18])},d(r){r&&P(e)}}}function zo(n){let e,t,r,i,o,l,s,u,a,d,g,c,f,h,b,y,O,m,p,v,k,_,A,x,F=n[16]&&Sr(n),q=!n[16]&&(n[9]||n[24].labelText)&&Pr(n),E=n[11]&&xr(),B=!n[11]&&n[13]&&Tr(),N=n[17]&&Lr(),C=[{"data-invalid":d=n[11]||void 0},{"aria-invalid":g=n[11]||void 0},{"data-warn":c=n[13]||void 0},{"aria-describedby":f=n[11]?n[19]:n[13]?n[18]:void 0},{disabled:n[5]},{id:n[7]},{name:n[8]},{placeholder:n[3]},{required:n[15]},{readOnly:n[17]},n[23]],G={};for(let w=0;w<C.length;w+=1)G=ce(G,C[w]);let J=n[20]&&Cr(),te=n[20]&&!n[16]&&n[11]&&Rr(n),$=n[20]&&!n[16]&&n[13]&&Ar(n),ee=!n[11]&&!n[13]&&!n[20]&&!n[16]&&n[6]&&Or(n),ae=!n[20]&&n[11]&&Nr(n),ie=!n[20]&&!n[11]&&n[13]&&Fr(n);return{c(){e=L("div"),F&&F.c(),t=z(),q&&q.c(),r=z(),i=L("div"),o=L("div"),E&&E.c(),l=z(),B&&B.c(),s=z(),N&&N.c(),u=z(),a=L("input"),h=z(),J&&J.c(),b=z(),te&&te.c(),y=z(),$&&$.c(),p=z(),ee&&ee.c(),v=z(),ae&&ae.c(),k=z(),ie&&ie.c(),He(a,G),T(a,"bx--text-input",!0),T(a,"bx--text-input--light",n[4]),T(a,"bx--text-input--invalid",n[11]),T(a,"bx--text-input--warn",n[13]),T(a,"bx--text-input--sm",n[2]==="sm"),T(a,"bx--text-input--xl",n[2]==="xl"),R(o,"data-invalid",O=n[11]||void 0),R(o,"data-warn",m=n[13]||void 0),T(o,"bx--text-input__field-wrapper",!0),T(o,"bx--text-input__field-wrapper--warning",!n[11]&&n[13]),T(i,"bx--text-input__field-outer-wrapper",!0),T(i,"bx--text-input__field-outer-wrapper--inline",n[16]),T(e,"bx--form-item",!0),T(e,"bx--text-input-wrapper",!0),T(e,"bx--text-input-wrapper--inline",n[16]),T(e,"bx--text-input-wrapper--light",n[4]),T(e,"bx--text-input-wrapper--readonly",n[17])},m(w,U){M(w,e,U),F&&F.m(e,null),S(e,t),q&&q.m(e,null),S(e,r),S(e,i),S(i,o),E&&E.m(o,null),S(o,l),B&&B.m(o,null),S(o,s),N&&N.m(o,null),S(o,u),S(o,a),a.autofocus&&a.focus(),n[36](a),wt(a,n[0]),S(o,h),J&&J.m(o,null),S(o,b),te&&te.m(o,null),S(o,y),$&&$.m(o,null),S(i,p),ee&&ee.m(i,null),S(i,v),ae&&ae.m(i,null),S(i,k),ie&&ie.m(i,null),_=!0,A||(x=[X(a,"input",n[37]),X(a,"change",n[22]),X(a,"input",n[21]),X(a,"keydown",n[31]),X(a,"keyup",n[32]),X(a,"focus",n[33]),X(a,"blur",n[34]),X(a,"paste",n[35]),X(e,"click",n[27]),X(e,"mouseover",n[28]),X(e,"mouseenter",n[29]),X(e,"mouseleave",n[30])],A=!0)},p(w,U){w[16]?F?(F.p(w,U),U[0]&65536&&I(F,1)):(F=Sr(w),F.c(),I(F,1),F.m(e,t)):F&&(Ee(),D(F,1,1,()=>{F=null}),Me()),!w[16]&&(w[9]||w[24].labelText)?q?(q.p(w,U),U[0]&16843264&&I(q,1)):(q=Pr(w),q.c(),I(q,1),q.m(e,r)):q&&(Ee(),D(q,1,1,()=>{q=null}),Me()),w[11]?E?U[0]&2048&&I(E,1):(E=xr(),E.c(),I(E,1),E.m(o,l)):E&&(Ee(),D(E,1,1,()=>{E=null}),Me()),!w[11]&&w[13]?B?U[0]&10240&&I(B,1):(B=Tr(),B.c(),I(B,1),B.m(o,s)):B&&(Ee(),D(B,1,1,()=>{B=null}),Me()),w[17]?N?U[0]&131072&&I(N,1):(N=Lr(),N.c(),I(N,1),N.m(o,u)):N&&(Ee(),D(N,1,1,()=>{N=null}),Me()),He(a,G=at(C,[(!_||U[0]&2048&&d!==(d=w[11]||void 0))&&{"data-invalid":d},(!_||U[0]&2048&&g!==(g=w[11]||void 0))&&{"aria-invalid":g},(!_||U[0]&8192&&c!==(c=w[13]||void 0))&&{"data-warn":c},(!_||U[0]&796672&&f!==(f=w[11]?w[19]:w[13]?w[18]:void 0))&&{"aria-describedby":f},(!_||U[0]&32)&&{disabled:w[5]},(!_||U[0]&128)&&{id:w[7]},(!_||U[0]&256)&&{name:w[8]},(!_||U[0]&8)&&{placeholder:w[3]},(!_||U[0]&32768)&&{required:w[15]},(!_||U[0]&131072)&&{readOnly:w[17]},U[0]&8388608&&w[23]])),U[0]&1&&a.value!==w[0]&&wt(a,w[0]),T(a,"bx--text-input",!0),T(a,"bx--text-input--light",w[4]),T(a,"bx--text-input--invalid",w[11]),T(a,"bx--text-input--warn",w[13]),T(a,"bx--text-input--sm",w[2]==="sm"),T(a,"bx--text-input--xl",w[2]==="xl"),w[20]?J||(J=Cr(),J.c(),J.m(o,b)):J&&(J.d(1),J=null),w[20]&&!w[16]&&w[11]?te?te.p(w,U):(te=Rr(w),te.c(),te.m(o,y)):te&&(te.d(1),te=null),w[20]&&!w[16]&&w[13]?$?$.p(w,U):($=Ar(w),$.c(),$.m(o,null)):$&&($.d(1),$=null),(!_||U[0]&2048&&O!==(O=w[11]||void 0))&&R(o,"data-invalid",O),(!_||U[0]&8192&&m!==(m=w[13]||void 0))&&R(o,"data-warn",m),(!_||U[0]&10240)&&T(o,"bx--text-input__field-wrapper--warning",!w[11]&&w[13]),!w[11]&&!w[13]&&!w[20]&&!w[16]&&w[6]?ee?ee.p(w,U):(ee=Or(w),ee.c(),ee.m(i,v)):ee&&(ee.d(1),ee=null),!w[20]&&w[11]?ae?ae.p(w,U):(ae=Nr(w),ae.c(),ae.m(i,k)):ae&&(ae.d(1),ae=null),!w[20]&&!w[11]&&w[13]?ie?ie.p(w,U):(ie=Fr(w),ie.c(),ie.m(i,null)):ie&&(ie.d(1),ie=null),(!_||U[0]&65536)&&T(i,"bx--text-input__field-outer-wrapper--inline",w[16]),(!_||U[0]&65536)&&T(e,"bx--text-input-wrapper--inline",w[16]),(!_||U[0]&16)&&T(e,"bx--text-input-wrapper--light",w[4]),(!_||U[0]&131072)&&T(e,"bx--text-input-wrapper--readonly",w[17])},i(w){_||(I(F),I(q),I(E),I(B),I(N),_=!0)},o(w){D(F),D(q),D(E),D(B),D(N),_=!1},d(w){w&&P(e),F&&F.d(),q&&q.d(),E&&E.d(),B&&B.d(),N&&N.d(),n[36](null),J&&J.d(),te&&te.d(),$&&$.d(),ee&&ee.d(),ae&&ae.d(),ie&&ie.d(),A=!1,Je(x)}}}function Go(n,e,t){let r,i,o;const l=["size","value","placeholder","light","disabled","helperText","id","name","labelText","hideLabel","invalid","invalidText","warn","warnText","ref","required","inline","readonly"];let s=ye(e,l),{$$slots:u={},$$scope:a}=e;const d=on(u);let{size:g=void 0}=e,{value:c=""}=e,{placeholder:f=""}=e,{light:h=!1}=e,{disabled:b=!1}=e,{helperText:y=""}=e,{id:O="ccs-"+Math.random().toString(36)}=e,{name:m=void 0}=e,{labelText:p=""}=e,{hideLabel:v=!1}=e,{invalid:k=!1}=e,{invalidText:_=""}=e,{warn:A=!1}=e,{warnText:x=""}=e,{ref:F=null}=e,{required:q=!1}=e,{inline:E=!1}=e,{readonly:B=!1}=e;const N=Gn("Form"),C=mi();function G(Y){return s.type!=="number"?Y:Y!=""?Number(Y):null}const J=Y=>{t(0,c=G(Y.target.value)),C("input",c)},te=Y=>{C("change",G(Y.target.value))};function $(Y){ne.call(this,n,Y)}function ee(Y){ne.call(this,n,Y)}function ae(Y){ne.call(this,n,Y)}function ie(Y){ne.call(this,n,Y)}function w(Y){ne.call(this,n,Y)}function U(Y){ne.call(this,n,Y)}function ze(Y){ne.call(this,n,Y)}function Mt(Y){ne.call(this,n,Y)}function qt(Y){ne.call(this,n,Y)}function cn(Y){fe[Y?"unshift":"push"](()=>{F=Y,t(1,F)})}function me(){c=this.value,t(0,c)}return n.$$set=Y=>{e=ce(ce({},e),Xe(Y)),t(23,s=ye(e,l)),"size"in Y&&t(2,g=Y.size),"value"in Y&&t(0,c=Y.value),"placeholder"in Y&&t(3,f=Y.placeholder),"light"in Y&&t(4,h=Y.light),"disabled"in Y&&t(5,b=Y.disabled),"helperText"in Y&&t(6,y=Y.helperText),"id"in Y&&t(7,O=Y.id),"name"in Y&&t(8,m=Y.name),"labelText"in Y&&t(9,p=Y.labelText),"hideLabel"in Y&&t(10,v=Y.hideLabel),"invalid"in Y&&t(11,k=Y.invalid),"invalidText"in Y&&t(12,_=Y.invalidText),"warn"in Y&&t(13,A=Y.warn),"warnText"in Y&&t(14,x=Y.warnText),"ref"in Y&&t(1,F=Y.ref),"required"in Y&&t(15,q=Y.required),"inline"in Y&&t(16,E=Y.inline),"readonly"in Y&&t(17,B=Y.readonly),"$$scope"in Y&&t(25,a=Y.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&128&&t(19,i=`error-${O}`),n.$$.dirty[0]&128&&t(18,o=`warn-${O}`)},t(20,r=!!N&&N.isFluid),[c,F,g,f,h,b,y,O,m,p,v,k,_,A,x,q,E,B,o,i,r,J,te,s,d,a,u,$,ee,ae,ie,w,U,ze,Mt,qt,cn,me]}class qo extends oe{constructor(e){super(),le(this,e,Go,zo,se,{size:2,value:0,placeholder:3,light:4,disabled:5,helperText:6,id:7,name:8,labelText:9,hideLabel:10,invalid:11,invalidText:12,warn:13,warnText:14,ref:1,required:15,inline:16,readonly:17},null,[-1,-1])}}const Do=qo;function Yo(n){let e;return{c(){e=W(`Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)`)},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function Xo(n){let e;return{c(){e=W(`Draw the intervention on the map, clicking the original point or 'Finish
      snapping' for the Polygon and Route tools respectively`)},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function Jo(n){let e;return{c(){e=W("Fill in the details that appear (Intervention type, name, description)")},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function Uo(n){let e;return{c(){e=W(`Click the "Save" button or "Delete" button to save or remove the
      intervention`)},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function Wo(n){let e,t,r,i,o,l,s,u;return e=new Dt({props:{$$slots:{default:[Yo]},$$scope:{ctx:n}}}),r=new Dt({props:{$$slots:{default:[Xo]},$$scope:{ctx:n}}}),o=new Dt({props:{$$slots:{default:[Jo]},$$scope:{ctx:n}}}),s=new Dt({props:{$$slots:{default:[Uo]},$$scope:{ctx:n}}}),{c(){V(e.$$.fragment),t=z(),V(r.$$.fragment),i=z(),V(o.$$.fragment),l=z(),V(s.$$.fragment)},m(a,d){H(e,a,d),M(a,t,d),H(r,a,d),M(a,i,d),H(o,a,d),M(a,l,d),H(s,a,d),u=!0},p(a,d){const g={};d&4&&(g.$$scope={dirty:d,ctx:a}),e.$set(g);const c={};d&4&&(c.$$scope={dirty:d,ctx:a}),r.$set(c);const f={};d&4&&(f.$$scope={dirty:d,ctx:a}),o.$set(f);const h={};d&4&&(h.$$scope={dirty:d,ctx:a}),s.$set(h)},i(a){u||(I(e.$$.fragment,a),I(r.$$.fragment,a),I(o.$$.fragment,a),I(s.$$.fragment,a),u=!0)},o(a){D(e.$$.fragment,a),D(r.$$.fragment,a),D(o.$$.fragment,a),D(s.$$.fragment,a),u=!1},d(a){Z(e,a),a&&P(t),Z(r,a),a&&P(i),Z(o,a),a&&P(l),Z(s,a)}}}function jo(n){let e,t,r,i,o,l,s,u,a,d,g,c,f,h,b,y,O,m,p,v,k,_,A,x,F,q;return o=new wo({props:{$$slots:{default:[Wo]},$$scope:{ctx:n}}}),{c(){e=L("p"),e.textContent="For each intervention:",t=z(),r=L("br"),i=z(),V(o.$$.fragment),l=z(),s=L("br"),u=z(),a=L("p"),a.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,d=z(),g=L("br"),c=z(),f=L("p"),f.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,h=z(),b=L("br"),y=z(),O=L("p"),O.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,m=z(),p=L("br"),v=z(),k=L("p"),k.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,_=z(),A=L("br"),x=z(),F=L("p"),F.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(E,B){M(E,e,B),M(E,t,B),M(E,r,B),M(E,i,B),H(o,E,B),M(E,l,B),M(E,s,B),M(E,u,B),M(E,a,B),M(E,d,B),M(E,g,B),M(E,c,B),M(E,f,B),M(E,h,B),M(E,b,B),M(E,y,B),M(E,O,B),M(E,m,B),M(E,p,B),M(E,v,B),M(E,k,B),M(E,_,B),M(E,A,B),M(E,x,B),M(E,F,B),q=!0},p(E,B){const N={};B&4&&(N.$$scope={dirty:B,ctx:E}),o.$set(N)},i(E){q||(I(o.$$.fragment,E),q=!0)},o(E){D(o.$$.fragment,E),q=!1},d(E){E&&P(e),E&&P(t),E&&P(r),E&&P(i),Z(o,E),E&&P(l),E&&P(s),E&&P(u),E&&P(a),E&&P(d),E&&P(g),E&&P(c),E&&P(f),E&&P(h),E&&P(b),E&&P(y),E&&P(O),E&&P(m),E&&P(p),E&&P(v),E&&P(k),E&&P(_),E&&P(A),E&&P(x),E&&P(F)}}}function Vo(n){let e,t,r;function i(l){n[1](l)}let o={passiveModal:!0,modalHeading:"Instructions",$$slots:{default:[jo]},$$scope:{ctx:n}};return n[0]!==void 0&&(o.open=n[0]),e=new Ui({props:o}),fe.push(()=>De(e,"open",i,n[0])),{c(){V(e.$$.fragment)},m(l,s){H(e,l,s),r=!0},p(l,[s]){const u={};s&4&&(u.$$scope={dirty:s,ctx:l}),!t&&s&1&&(t=!0,u.open=l[0],Ye(()=>t=!1)),e.$set(u)},i(l){r||(I(e.$$.fragment,l),r=!0)},o(l){D(e.$$.fragment,l),r=!1},d(l){Z(e,l)}}}function Ho(n,e,t){let{open:r}=e;function i(o){r=o,t(0,r)}return n.$$set=o=>{"open"in o&&t(0,r=o.open)},[r,i]}class Zo extends oe{constructor(e){super(),le(this,e,Ho,Vo,se,{open:0})}}const Ze=dt(null),ue=dt($e()),Te=dt(null),Ge=dt(null),Qo=dt(null);function $e(){return{type:"FeatureCollection",features:[]}}const Ko=Wi(ue,n=>{let e=n.features.find(t=>t.properties.editing);return e?e.id:null});function sn(n){let e=new Set;for(let r of n.features)e.add(r.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Ir(n){let e;const t=n[4].default,r=Re(t,n,n[3],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&8)&&Ae(r,t,i,i[3],e?Ne(t,i[3],o,null):Oe(i[3]),null)},i(i){e||(I(r,i),e=!0)},o(i){D(r,i),e=!1},d(i){r&&r.d(i)}}}function $o(n){let e,t,r=n[1]&&Ir(n);return{c(){e=L("div"),r&&r.c(),R(e,"class","map svelte-12dpf1u")},m(i,o){M(i,e,o),r&&r.m(e,null),n[5](e),t=!0},p(i,[o]){i[1]?r?(r.p(i,o),o&2&&I(r,1)):(r=Ir(i),r.c(),I(r,1),r.m(e,null)):r&&(Ee(),D(r,1,1,()=>{r=null}),Me())},i(i){t||(I(r),t=!0)},o(i){D(r),t=!1},d(i){i&&P(e),r&&r.d(),n[5](null)}}}function el(n,e,t){let{$$slots:r={},$$scope:i}=e,{style:o}=e,l,s,u=!1;gi("setCamera",!window.location.hash),ln(()=>{l=new hn.Map({container:s,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),l.addControl(new hn.ScaleControl),l.addControl(new hn.NavigationControl({visualizePitch:!0}),"bottom-right"),l.on("load",()=>{t(1,u=!0),Ze.set(l)}),new ResizeObserver(()=>{l.resize()}).observe(s)}),qn(()=>{l.remove()});function a(d){fe[d?"unshift":"push"](()=>{s=d,t(0,s)})}return n.$$set=d=>{"style"in d&&t(2,o=d.style),"$$scope"in d&&t(3,i=d.$$scope)},[s,u,o,i,r,a]}class tl extends oe{constructor(e){super(),le(this,e,el,$o,se,{style:2})}}const nl=n=>({}),Br=n=>({}),rl=n=>({}),zr=n=>({}),il=n=>({}),Gr=n=>({});function ol(n){let e,t,r,i,o,l,s,u,a,d,g,c;const f=n[3].nav,h=Re(f,n,n[2],Gr),b=n[3].sidebar,y=Re(b,n,n[2],zr),O=n[3].main,m=Re(O,n,n[2],Br);return{c(){e=L("aside"),t=L("div"),r=L("nav"),h&&h.c(),i=z(),y&&y.c(),o=z(),l=L("div"),l.textContent="→",u=z(),a=L("main"),m&&m.c(),R(r,"class","svelte-19nerxn"),R(t,"class","sidebar-content content-container svelte-19nerxn"),R(l,"class","sidebar-toggle rounded-rect svelte-19nerxn"),R(e,"class",s=ir(n[0]?"":"collapsed")+" svelte-19nerxn"),R(a,"class","svelte-19nerxn")},m(p,v){M(p,e,v),S(e,t),S(t,r),h&&h.m(r,null),S(t,i),y&&y.m(t,null),S(e,o),S(e,l),M(p,u,v),M(p,a,v),m&&m.m(a,null),d=!0,g||(c=X(l,"click",n[1]),g=!0)},p(p,[v]){h&&h.p&&(!d||v&4)&&Ae(h,f,p,p[2],d?Ne(f,p[2],v,il):Oe(p[2]),Gr),y&&y.p&&(!d||v&4)&&Ae(y,b,p,p[2],d?Ne(b,p[2],v,rl):Oe(p[2]),zr),(!d||v&1&&s!==(s=ir(p[0]?"":"collapsed")+" svelte-19nerxn"))&&R(e,"class",s),m&&m.p&&(!d||v&4)&&Ae(m,O,p,p[2],d?Ne(O,p[2],v,nl):Oe(p[2]),Br)},i(p){d||(I(h,p),I(y,p),I(m,p),d=!0)},o(p){D(h,p),D(y,p),D(m,p),d=!1},d(p){p&&P(e),h&&h.d(p),y&&y.d(p),p&&P(u),p&&P(a),m&&m.d(p),g=!1,c()}}}function ll(n,e,t){let{$$slots:r={},$$scope:i}=e,o=!0;function l(){t(0,o=!o)}return n.$$set=s=>{"$$scope"in s&&t(2,i=s.$$scope)},[o,l,i,r]}class sl extends oe{constructor(e){super(),le(this,e,ll,ol,se,{})}}var _e=63710088e-1,Xn={centimeters:_e*100,centimetres:_e*100,degrees:_e/111325,feet:_e*3.28084,inches:_e*39.37,kilometers:_e/1e3,kilometres:_e/1e3,meters:_e,metres:_e,miles:_e/1609.344,millimeters:_e*1e3,millimetres:_e*1e3,nauticalmiles:_e/1852,radians:1,yards:_e*1.0936},al={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/_e,yards:1.0936133},yn={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ie(n,e,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function ul(n,e,t){switch(n){case"Point":return we(e).geometry;case"LineString":return ke(e).geometry;case"Polygon":return an(e).geometry;case"MultiPoint":return yi(e).geometry;case"MultiLineString":return _i(e).geometry;case"MultiPolygon":return Jn(e).geometry;default:throw new Error(n+" is invalid")}}function we(n,e,t){if(t===void 0&&(t={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Zt(n[0])||!Zt(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return Ie(r,e,t)}function fl(n,e,t){return t===void 0&&(t={}),Fe(n.map(function(r){return we(r,e)}),t)}function an(n,e,t){t===void 0&&(t={});for(var r=0,i=n;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:n};return Ie(s,e,t)}function cl(n,e,t){return t===void 0&&(t={}),Fe(n.map(function(r){return an(r,e)}),t)}function ke(n,e,t){if(t===void 0&&(t={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:n};return Ie(r,e,t)}function dl(n,e,t){return t===void 0&&(t={}),Fe(n.map(function(r){return ke(r,e)}),t)}function Fe(n,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function _i(n,e,t){t===void 0&&(t={});var r={type:"MultiLineString",coordinates:n};return Ie(r,e,t)}function yi(n,e,t){t===void 0&&(t={});var r={type:"MultiPoint",coordinates:n};return Ie(r,e,t)}function Jn(n,e,t){t===void 0&&(t={});var r={type:"MultiPolygon",coordinates:n};return Ie(r,e,t)}function hl(n,e,t){t===void 0&&(t={});var r={type:"GeometryCollection",geometries:n};return Ie(r,e,t)}function pl(n,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(n*t)/t}function Un(n,e){e===void 0&&(e="kilometers");var t=Xn[e];if(!t)throw new Error(e+" units is invalid");return n*t}function un(n,e){e===void 0&&(e="kilometers");var t=Xn[e];if(!t)throw new Error(e+" units is invalid");return n/t}function ml(n,e){return At(un(n,e))}function gl(n){var e=n%360;return e<0&&(e+=360),e}function At(n){var e=n%(2*Math.PI);return e*180/Math.PI}function Ce(n){var e=n%360;return e*Math.PI/180}function bl(n,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(n>=0))throw new Error("length must be a positive number");return Un(un(n,e),t)}function vl(n,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(n>=0))throw new Error("area must be a positive number");var r=yn[e];if(!r)throw new Error("invalid original units");var i=yn[t];if(!i)throw new Error("invalid final units");return n/r*i}function Zt(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Wn(n){return!!n&&n.constructor===Object}function _l(n){if(!n)throw new Error("bbox is required");if(!Array.isArray(n))throw new Error("bbox must be an Array");if(n.length!==4&&n.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");n.forEach(function(e){if(!Zt(e))throw new Error("bbox must only contain numbers")})}function yl(n){if(!n)throw new Error("id is required");if(["string","number"].indexOf(typeof n)===-1)throw new Error("id must be a number or a string")}const wl=Object.freeze(Object.defineProperty({__proto__:null,earthRadius:_e,factors:Xn,unitsFactors:al,areaFactors:yn,feature:Ie,geometry:ul,point:we,points:fl,polygon:an,polygons:cl,lineString:ke,lineStrings:dl,featureCollection:Fe,multiLineString:_i,multiPoint:yi,multiPolygon:Jn,geometryCollection:hl,round:pl,radiansToLength:Un,lengthToRadians:un,lengthToDegrees:ml,bearingToAzimuth:gl,radiansToDegrees:At,degreesToRadians:Ce,convertLength:bl,convertArea:vl,isNumber:Zt,isObject:Wn,validateBBox:_l,validateId:yl},Symbol.toStringTag,{value:"Module"}));/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function kl(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(a){return function(d){return u([a,d])}}function u(a){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(n,t)}catch(d){a=[6,d],i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var st=function(){function n(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return n}();function Sl(n,e){return n>e?1:n<e?-1:0}function nt(n,e,t){for(var r=new st(null,null),i=r,o=r;;){var l=t(n,e.key);if(l<0){if(e.left===null)break;if(t(n,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}o.left=e,o=e,e=e.left}else if(l>0){if(e.right===null)break;if(t(n,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=r.right,e.right=r.left,e}function pn(n,e,t,r){var i=new st(n,e);if(t===null)return i.left=i.right=null,i;t=nt(n,t,r);var o=r(n,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function qr(n,e,t){var r=null,i=null;if(e){e=nt(n,e,t);var o=t(e.key,n);o===0?(r=e.left,i=e.right):o<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function El(n,e,t){return e===null?n:(n===null||(e=nt(n.key,e,t),e.left=n),e)}function wn(n,e,t,r,i){if(n){r(""+e+(t?"└── ":"├── ")+i(n)+`
`);var o=e+(t?"    ":"│   ");n.left&&wn(n.left,o,!1,r,i),n.right&&wn(n.right,o,!0,r,i)}}var jn=function(){function n(e){e===void 0&&(e=Sl),this._root=null,this._size=0,this._comparator=e}return n.prototype.insert=function(e,t){return this._size++,this._root=pn(e,t,this._root,this._comparator)},n.prototype.add=function(e,t){var r=new st(e,t);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,o=nt(e,this._root,i),l=i(e,o.key);return l===0?this._root=o:(l<0?(r.left=o.left,r.right=o,o.left=null):l>0&&(r.right=o.right,r.left=o,o.right=null),this._size++,this._root=r),this._root},n.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},n.prototype._remove=function(e,t,r){var i;if(t===null)return null;t=nt(e,t,r);var o=r(e,t.key);return o===0?(t.left===null?i=t.right:(i=nt(e,t.left,r),i.right=t.right),this._size--,i):t},n.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=nt(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},n.prototype.findStatic=function(e){for(var t=this._root,r=this._comparator;t;){var i=r(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},n.prototype.find=function(e){return this._root&&(this._root=nt(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},n.prototype.contains=function(e){for(var t=this._root,r=this._comparator;t;){var i=r(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},n.prototype.forEach=function(e,t){for(var r=this._root,i=[],o=!1;!o;)r!==null?(i.push(r),r=r.left):i.length!==0?(r=i.pop(),e.call(t,r),r=r.right):o=!0;return this},n.prototype.range=function(e,t,r,i){for(var o=[],l=this._comparator,s=this._root,u;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),u=l(s.key,t),u>0)break;if(l(s.key,e)>=0&&r.call(i,s))return this;s=s.right}return this},n.prototype.keys=function(){var e=[];return this.forEach(function(t){var r=t.key;return e.push(r)}),e},n.prototype.values=function(){var e=[];return this.forEach(function(t){var r=t.data;return e.push(r)}),e},n.prototype.min=function(){return this._root?this.minNode(this._root).key:null},n.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},n.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},n.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},n.prototype.at=function(e){for(var t=this._root,r=!1,i=0,o=[];!r;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else r=!0;return null},n.prototype.next=function(e){var t=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(r=t,t=t.left):t=t.right}return r},n.prototype.prev=function(e){var t=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(r=t,t=t.right)}return r},n.prototype.clear=function(){return this._root=null,this._size=0,this},n.prototype.toList=function(){return Pl(this._root)},n.prototype.load=function(e,t,r){t===void 0&&(t=[]),r===void 0&&(r=!1);var i=e.length,o=this._comparator;if(r&&En(e,t,0,i-1,o),this._root===null)this._root=kn(e,t,0,i),this._size=i;else{var l=xl(this.toList(),Ml(e,t),o);i=this._size+i,this._root=Sn({head:l},0,i)}return this},n.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var t=[];return wn(this._root,"",!0,function(r){return t.push(r)},e),t.join("")},n.prototype.update=function(e,t,r){var i=this._comparator,o=qr(e,this._root,i),l=o.left,s=o.right;i(e,t)<0?s=pn(t,r,s,i):l=pn(t,r,l,i),this._root=El(l,s,i)},n.prototype.split=function(e){return qr(e,this._root,this._comparator)},n.prototype[Symbol.iterator]=function(){var e;return kl(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},n}();function kn(n,e,t,r){var i=r-t;if(i>0){var o=t+Math.floor(i/2),l=n[o],s=e[o],u=new st(l,s);return u.left=kn(n,e,t,o),u.right=kn(n,e,o+1,r),u}return null}function Ml(n,e){for(var t=new st(null,null),r=t,i=0;i<n.length;i++)r=r.next=new st(n[i],e[i]);return r.next=null,t.next}function Pl(n){for(var e=n,t=[],r=!1,i=new st(null,null),o=i;!r;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):r=!0;return o.next=null,i.next}function Sn(n,e,t){var r=t-e;if(r>0){var i=e+Math.floor(r/2),o=Sn(n,e,i),l=n.head;return l.left=o,n.head=n.head.next,l.right=Sn(n,i+1,t),l}return null}function xl(n,e,t){for(var r=new st(null,null),i=r,o=n,l=e;o!==null&&l!==null;)t(o.key,l.key)<0?(i.next=o,o=o.next):(i.next=l,l=l.next),i=i.next;return o!==null?i.next=o:l!==null&&(i.next=l),r.next}function En(n,e,t,r,i){if(!(t>=r)){for(var o=n[t+r>>1],l=t-1,s=r+1;;){do l++;while(i(n[l],o)<0);do s--;while(i(n[s],o)>0);if(l>=s)break;var u=n[l];n[l]=n[s],n[s]=u,u=e[l],e[l]=e[s],e[s]=u}En(n,e,t,s,i),En(n,e,s+1,r,i)}}function Be(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Dr(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function Se(n,e,t){return e&&Dr(n.prototype,e),t&&Dr(n,t),n}var xt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Mn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var r=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,l=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:r,y:o},ur:{x:i,y:l}}},it=Number.EPSILON;it===void 0&&(it=Math.pow(2,-52));var Tl=it*it,Pn=function(e,t){if(-it<e&&e<it&&-it<t&&t<it)return 0;var r=e-t;return r*r<Tl*e*t?0:e<t?-1:1},Ll=function(){function n(){Be(this,n),this.reset()}return Se(n,[{key:"reset",value:function(){this.xRounder=new Yr,this.yRounder=new Yr}},{key:"round",value:function(t,r){return{x:this.xRounder.round(t),y:this.yRounder.round(r)}}}]),n}(),Yr=function(){function n(){Be(this,n),this.tree=new jn,this.round(0)}return Se(n,[{key:"round",value:function(t){var r=this.tree.add(t),i=this.tree.prev(r);if(i!==null&&Pn(r.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(r);return o!==null&&Pn(r.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),n}(),Ot=new Ll,Lt=function(e,t){return e.x*t.y-e.y*t.x},wi=function(e,t){return e.x*t.x+e.y*t.y},Xr=function(e,t,r){var i={x:t.x-e.x,y:t.y-e.y},o={x:r.x-e.x,y:r.y-e.y},l=Lt(i,o);return Pn(l,0)},Qt=function(e){return Math.sqrt(wi(e,e))},Cl=function(e,t,r){var i={x:t.x-e.x,y:t.y-e.y},o={x:r.x-e.x,y:r.y-e.y};return Lt(o,i)/Qt(o)/Qt(i)},Rl=function(e,t,r){var i={x:t.x-e.x,y:t.y-e.y},o={x:r.x-e.x,y:r.y-e.y};return wi(o,i)/Qt(o)/Qt(i)},Jr=function(e,t,r){return t.y===0?null:{x:e.x+t.x/t.y*(r-e.y),y:r}},Ur=function(e,t,r){return t.x===0?null:{x:r,y:e.y+t.y/t.x*(r-e.x)}},Al=function(e,t,r,i){if(t.x===0)return Ur(r,i,e.x);if(i.x===0)return Ur(e,t,r.x);if(t.y===0)return Jr(r,i,e.y);if(i.y===0)return Jr(e,t,r.y);var o=Lt(t,i);if(o==0)return null;var l={x:r.x-e.x,y:r.y-e.y},s=Lt(l,t)/o,u=Lt(l,i)/o,a=e.x+u*t.x,d=r.x+s*i.x,g=e.y+u*t.y,c=r.y+s*i.y,f=(a+d)/2,h=(g+c)/2;return{x:f,y:h}},We=function(){Se(n,null,[{key:"compare",value:function(t,r){var i=n.comparePoints(t.point,r.point);return i!==0?i:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:Kt.compare(t.segment,r.segment))}},{key:"comparePoints",value:function(t,r){return t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0}}]);function n(e,t){Be(this,n),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Se(n,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var r=t.point.events,i=0,o=r.length;i<o;i++){var l=r[i];this.point.events.push(l),l.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,r=0;r<t;r++){var i=this.point.events[r];if(i.segment.consumedBy===void 0)for(var o=r+1;o<t;o++){var l=this.point.events[o];l.consumedBy===void 0&&i.otherSE.point.events===l.otherSE.point.events&&i.segment.consume(l.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],r=0,i=this.point.events.length;r<i;r++){var o=this.point.events[r];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var r=this,i=new Map,o=function(s){var u=s.otherSE;i.set(s,{sine:Cl(r.point,t.point,u.point),cosine:Rl(r.point,t.point,u.point)})};return function(l,s){i.has(l)||o(l),i.has(s)||o(s);var u=i.get(l),a=u.sine,d=u.cosine,g=i.get(s),c=g.sine,f=g.cosine;return a>=0&&c>=0?d<f?1:d>f?-1:0:a<0&&c<0?d<f?-1:d>f?1:0:c<a?-1:c>a?1:0}}}]),n}(),Ol=0,Kt=function(){Se(n,null,[{key:"compare",value:function(t,r){var i=t.leftSE.point.x,o=r.leftSE.point.x,l=t.rightSE.point.x,s=r.rightSE.point.x;if(s<i)return 1;if(l<o)return-1;var u=t.leftSE.point.y,a=r.leftSE.point.y,d=t.rightSE.point.y,g=r.rightSE.point.y;if(i<o){if(a<u&&a<d)return 1;if(a>u&&a>d)return-1;var c=t.comparePoint(r.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=r.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(u<a&&u<g)return-1;if(u>a&&u>g)return 1;var h=r.comparePoint(t.leftSE.point);if(h!==0)return h;var b=t.comparePoint(r.rightSE.point);return b<0?1:b>0?-1:1}if(u<a)return-1;if(u>a)return 1;if(l<s){var y=r.comparePoint(t.rightSE.point);if(y!==0)return y}if(l>s){var O=t.comparePoint(r.rightSE.point);if(O<0)return 1;if(O>0)return-1}if(l!==s){var m=d-u,p=l-i,v=g-a,k=s-o;if(m>p&&v<k)return 1;if(m<p&&v>k)return-1}return l>s?1:l<s||d<g?-1:d>g?1:t.id<r.id?-1:t.id>r.id?1:0}}]);function n(e,t,r,i){Be(this,n),this.id=++Ol,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=r,this.windings=i}return Se(n,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<r?t:r},ur:{x:this.rightSE.point.x,y:t>r?t:r}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var r=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(r.x===i.x)return t.x===r.x?0:t.x<r.x?1:-1;var l=(t.y-r.y)/o.y,s=r.x+l*o.x;if(t.x===s)return 0;var u=(t.x-r.x)/o.x,a=r.y+u*o.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var r=this.bbox(),i=t.bbox(),o=Mn(r,i);if(o===null)return null;var l=this.leftSE.point,s=this.rightSE.point,u=t.leftSE.point,a=t.rightSE.point,d=xt(r,u)&&this.comparePoint(u)===0,g=xt(i,l)&&t.comparePoint(l)===0,c=xt(r,a)&&this.comparePoint(a)===0,f=xt(i,s)&&t.comparePoint(s)===0;if(g&&d)return f&&!c?s:!f&&c?a:null;if(g)return c&&l.x===a.x&&l.y===a.y?null:l;if(d)return f&&s.x===u.x&&s.y===u.y?null:u;if(f&&c)return null;if(f)return s;if(c)return a;var h=Al(l,this.vector(),u,t.vector());return h===null||!xt(o,h)?null:Ot.round(h.x,h.y)}},{key:"split",value:function(t){var r=[],i=t.events!==void 0,o=new We(t,!0),l=new We(t,!1),s=this.rightSE;this.replaceRightSE(l),r.push(l),r.push(o);var u=new n(o,s,this.rings.slice(),this.windings.slice());return We.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),We.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),l.checkForConsuming()),r}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var r=0,i=this.windings.length;r<i;r++)this.windings[r]*=-1}},{key:"consume",value:function(t){for(var r=this,i=t;r.consumedBy;)r=r.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=n.compare(r,i);if(o!==0){if(o>0){var l=r;r=i,i=l}if(r.prev===i){var s=r;r=i,i=s}for(var u=0,a=i.rings.length;u<a;u++){var d=i.rings[u],g=i.windings[u],c=r.rings.indexOf(d);c===-1?(r.rings.push(d),r.windings.push(g)):r.windings[c]+=g}i.rings=null,i.windings=null,i.consumedBy=r,i.leftSE.consumedBy=r.leftSE,i.rightSE.consumedBy=r.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var r=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,l=0,s=this.rings.length;l<s;l++){var u=this.rings[l],a=this.windings[l],d=r.indexOf(u);d===-1?(r.push(u),i.push(a)):i[d]+=a}for(var g=[],c=[],f=0,h=r.length;f<h;f++)if(i[f]!==0){var b=r[f],y=b.poly;if(c.indexOf(y)===-1)if(b.isExterior)g.push(y);else{c.indexOf(y)===-1&&c.push(y);var O=g.indexOf(b.poly);O!==-1&&g.splice(O,1)}}for(var m=0,p=g.length;m<p;m++){var v=g[m].multiPoly;o.indexOf(v)===-1&&o.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(qe.type){case"union":{var i=t.length===0,o=r.length===0;this._isInResult=i!==o;break}case"intersection":{var l,s;t.length<r.length?(l=t.length,s=r.length):(l=r.length,s=t.length),this._isInResult=s===qe.numMultiPolys&&l<s;break}case"xor":{var u=Math.abs(t.length-r.length);this._isInResult=u%2===1;break}case"difference":{var a=function(g){return g.length===1&&g[0].isSubject};this._isInResult=a(t)!==a(r);break}default:throw new Error("Unrecognized operation type found ".concat(qe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,r,i){var o,l,s,u=We.comparePoints(t,r);if(u<0)o=t,l=r,s=1;else if(u>0)o=r,l=t,s=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var a=new We(o,!0),d=new We(l,!1);return new n(a,d,[i],[s])}}]),n}(),Wr=function(){function n(e,t,r){if(Be(this,n),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Ot.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,l=1,s=e.length;l<s;l++){if(typeof e[l][0]!="number"||typeof e[l][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var u=Ot.round(e[l][0],e[l][1]);u.x===o.x&&u.y===o.y||(this.segments.push(Kt.fromRing(o,u,this)),u.x<this.bbox.ll.x&&(this.bbox.ll.x=u.x),u.y<this.bbox.ll.y&&(this.bbox.ll.y=u.y),u.x>this.bbox.ur.x&&(this.bbox.ur.x=u.x),u.y>this.bbox.ur.y&&(this.bbox.ur.y=u.y),o=u)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Kt.fromRing(o,i,this))}return Se(n,[{key:"getSweepEvents",value:function(){for(var t=[],r=0,i=this.segments.length;r<i;r++){var o=this.segments[r];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),n}(),Nl=function(){function n(e,t){if(Be(this,n),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Wr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var o=new Wr(e[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Se(n,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),r=0,i=this.interiorRings.length;r<i;r++)for(var o=this.interiorRings[r].getSweepEvents(),l=0,s=o.length;l<s;l++)t.push(o[l]);return t}}]),n}(),jr=function(){function n(e,t){if(Be(this,n),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var o=new Nl(e[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Se(n,[{key:"getSweepEvents",value:function(){for(var t=[],r=0,i=this.polys.length;r<i;r++)for(var o=this.polys[r].getSweepEvents(),l=0,s=o.length;l<s;l++)t.push(o[l]);return t}}]),n}(),Fl=function(){Se(n,null,[{key:"factory",value:function(t){for(var r=[],i=0,o=t.length;i<o;i++){var l=t[i];if(!(!l.isInResult()||l.ringOut)){for(var s=null,u=l.leftSE,a=l.rightSE,d=[u],g=u.point,c=[];s=u,u=a,d.push(u),u.point!==g;)for(;;){var f=u.getAvailableLinkedEvents();if(f.length===0){var h=d[0].point,b=d[d.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(b.x,", ").concat(b.y,"]."))}if(f.length===1){a=f[0].otherSE;break}for(var y=null,O=0,m=c.length;O<m;O++)if(c[O].point===u.point){y=O;break}if(y!==null){var p=c.splice(y)[0],v=d.splice(p.index);v.unshift(v[0].otherSE),r.push(new n(v.reverse()));continue}c.push({index:d.length,point:u.point});var k=u.getLeftmostComparator(s);a=f.sort(k)[0].otherSE;break}r.push(new n(d))}}return r}}]);function n(e){Be(this,n),this.events=e;for(var t=0,r=e.length;t<r;t++)e[t].segment.ringOut=this;this.poly=null}return Se(n,[{key:"getGeom",value:function(){for(var t=this.events[0].point,r=[t],i=1,o=this.events.length-1;i<o;i++){var l=this.events[i].point,s=this.events[i+1].point;Xr(l,t,s)!==0&&(r.push(l),t=l)}if(r.length===1)return null;var u=r[0],a=r[1];Xr(u,t,a)===0&&r.shift(),r.push(r[0]);for(var d=this.isExteriorRing()?1:-1,g=this.isExteriorRing()?0:r.length-1,c=this.isExteriorRing()?r.length:-1,f=[],h=g;h!=c;h+=d)f.push([r[h].x,r[h].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],r=1,i=this.events.length;r<i;r++){var o=this.events[r];We.compare(t,o)>0&&(t=o)}for(var l=t.segment.prevInResult(),s=l?l.prevInResult():null;;){if(!l)return null;if(!s)return l.ringOut;if(s.ringOut!==l.ringOut)return s.ringOut.enclosingRing()!==l.ringOut?l.ringOut:l.ringOut.enclosingRing();l=s.prevInResult(),s=l?l.prevInResult():null}}}]),n}(),Vr=function(){function n(e){Be(this,n),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Se(n,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var r=0,i=this.interiorRings.length;r<i;r++){var o=this.interiorRings[r].getGeom();o!==null&&t.push(o)}return t}}]),n}(),Il=function(){function n(e){Be(this,n),this.rings=e,this.polys=this._composePolys(e)}return Se(n,[{key:"getGeom",value:function(){for(var t=[],r=0,i=this.polys.length;r<i;r++){var o=this.polys[r].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var r=[],i=0,o=t.length;i<o;i++){var l=t[i];if(!l.poly)if(l.isExteriorRing())r.push(new Vr(l));else{var s=l.enclosingRing();s.poly||r.push(new Vr(s)),s.poly.addInterior(l)}}return r}}]),n}(),Bl=function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kt.compare;Be(this,n),this.queue=e,this.tree=new jn(t),this.segments=[]}return Se(n,[{key:"process",value:function(t){var r=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(r),i;var o=t.isLeft?this.tree.insert(r):this.tree.find(r);if(!o)throw new Error("Unable to find segment #".concat(r.id," ")+"[".concat(r.leftSE.point.x,", ").concat(r.leftSE.point.y,"] -> ")+"[".concat(r.rightSE.point.x,", ").concat(r.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var l=o,s=o,u=void 0,a=void 0;u===void 0;)l=this.tree.prev(l),l===null?u=null:l.key.consumedBy===void 0&&(u=l.key);for(;a===void 0;)s=this.tree.next(s),s===null?a=null:s.key.consumedBy===void 0&&(a=s.key);if(t.isLeft){var d=null;if(u){var g=u.getIntersection(r);if(g!==null&&(r.isAnEndpoint(g)||(d=g),!u.isAnEndpoint(g)))for(var c=this._splitSafely(u,g),f=0,h=c.length;f<h;f++)i.push(c[f])}var b=null;if(a){var y=a.getIntersection(r);if(y!==null&&(r.isAnEndpoint(y)||(b=y),!a.isAnEndpoint(y)))for(var O=this._splitSafely(a,y),m=0,p=O.length;m<p;m++)i.push(O[m])}if(d!==null||b!==null){var v=null;if(d===null)v=b;else if(b===null)v=d;else{var k=We.comparePoints(d,b);v=k<=0?d:b}this.queue.remove(r.rightSE),i.push(r.rightSE);for(var _=r.split(v),A=0,x=_.length;A<x;A++)i.push(_[A])}i.length>0?(this.tree.remove(r),i.push(t)):(this.segments.push(r),r.prev=u)}else{if(u&&a){var F=u.getIntersection(a);if(F!==null){if(!u.isAnEndpoint(F))for(var q=this._splitSafely(u,F),E=0,B=q.length;E<B;E++)i.push(q[E]);if(!a.isAnEndpoint(F))for(var N=this._splitSafely(a,F),C=0,G=N.length;C<G;C++)i.push(N[C])}}this.tree.remove(r)}return i}},{key:"_splitSafely",value:function(t,r){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(r);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),n}(),Hr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,zl=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Gl=function(){function n(){Be(this,n)}return Se(n,[{key:"run",value:function(t,r,i){qe.type=t,Ot.reset();for(var o=[new jr(r,!0)],l=0,s=i.length;l<s;l++)o.push(new jr(i[l],!1));if(qe.numMultiPolys=o.length,qe.type==="difference")for(var u=o[0],a=1;a<o.length;)Mn(o[a].bbox,u.bbox)!==null?a++:o.splice(a,1);if(qe.type==="intersection"){for(var d=0,g=o.length;d<g;d++)for(var c=o[d],f=d+1,h=o.length;f<h;f++)if(Mn(c.bbox,o[f].bbox)===null)return[]}for(var b=new jn(We.compare),y=0,O=o.length;y<O;y++)for(var m=o[y].getSweepEvents(),p=0,v=m.length;p<v;p++)if(b.insert(m[p]),b.size>Hr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var k=new Bl(b),_=b.size,A=b.pop();A;){var x=A.key;if(b.size===_){var F=x.segment;throw new Error("Unable to pop() ".concat(x.isLeft?"left":"right"," SweepEvent ")+"[".concat(x.point.x,", ").concat(x.point.y,"] from segment #").concat(F.id," ")+"[".concat(F.leftSE.point.x,", ").concat(F.leftSE.point.y,"] -> ")+"[".concat(F.rightSE.point.x,", ").concat(F.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(b.size>Hr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(k.segments.length>zl)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var q=k.process(x),E=0,B=q.length;E<B;E++){var N=q[E];N.consumedBy===void 0&&b.insert(N)}_=b.size,A=b.pop()}Ot.reset();var C=Fl.factory(k.segments),G=new Il(C);return G.getGeom()}}]),n}(),qe=new Gl,ql=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return qe.run("union",e,r)},Dl=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return qe.run("intersection",e,r)},Yl=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return qe.run("xor",e,r)},Xl=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return qe.run("difference",e,r)},Jt={union:ql,intersection:Dl,xor:Yl,difference:Xl};function Jl(n,e){var t=Wl(e),r=null;return n.type==="FeatureCollection"?r=Ul(n):r=ki(Jt.union(n.geometry.coordinates)),r.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function Ul(n){var e=n.features.length===2?Jt.union(n.features[0].geometry.coordinates,n.features[1].geometry.coordinates):Jt.union.apply(Jt,n.features.map(function(t){return t.geometry.coordinates}));return ki(e)}function ki(n){return Jn(n)}function Wl(n){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=n&&n.geometry.coordinates||e;return an(t)}const jl={"line-cap":"round","line-join":"round"},Vn=["==","$type","Polygon"],Hn=["==","$type","LineString"],Zn=["==","$type","Point"];function $t(n,e,t=1){return{type:"line",layout:jl,paint:{"line-color":n,"line-width":e,"line-opacity":t}}}function Qn(n,e){return{type:"fill",paint:{"fill-color":n,"fill-opacity":e}}}function Gt(n,e,t=1){return{type:"circle",paint:{"circle-radius":e,"circle-color":n,"circle-opacity":t}}}function Et(n,e,t){if(n.getSource(e)){let r=[];for(let i of n.getStyle().layers)i.source==e&&r.push(i.id);for(let i of r)n.removeLayer(i);n.removeSource(e)}n.addSource(e,t)}function Le(n,e,t=null){n.getLayer(e.id)&&n.removeLayer(e.id),t&&!n.getLayer(t)&&(t=null),n.addLayer(e,t)}function Vl(n,e,t){let r;he(n,Ze,l=>t(1,r=l));let{boundaryGeojson:i}=e;return Gn("setCamera")&&r.fitBounds(Dn(i),{padding:20,animate:!1}),Et(r,"boundary",{type:"geojson",data:Jl(i)}),Le(r,{id:"boundary",source:"boundary",...Qn("black",.5)}),n.$$set=l=>{"boundaryGeojson"in l&&t(0,i=l.boundaryGeojson)},[i]}class Hl extends oe{constructor(e){super(),le(this,e,Vl,null,se,{boundaryGeojson:0})}}function Zl(n){let e,t,r,i,o,l,s,u;return e=new Yt({props:{labelText:"Area",value:"area"}}),r=new Yt({props:{labelText:"Route",value:"route"}}),o=new Yt({props:{labelText:"Crossing",value:"crossing"}}),s=new Yt({props:{labelText:"Other",value:"other"}}),{c(){V(e.$$.fragment),t=z(),V(r.$$.fragment),i=z(),V(o.$$.fragment),l=z(),V(s.$$.fragment)},m(a,d){H(e,a,d),M(a,t,d),H(r,a,d),M(a,i,d),H(o,a,d),M(a,l,d),H(s,a,d),u=!0},p:re,i(a){u||(I(e.$$.fragment,a),I(r.$$.fragment,a),I(o.$$.fragment,a),I(s.$$.fragment,a),u=!0)},o(a){D(e.$$.fragment,a),D(r.$$.fragment,a),D(o.$$.fragment,a),D(s.$$.fragment,a),u=!1},d(a){Z(e,a),a&&P(t),Z(r,a),a&&P(i),Z(o,a),a&&P(l),Z(s,a)}}}function Zr(n){let e,t,r=Qr(n[3])+"",i,o,l;return{c(){e=L("p"),t=W("Length: "),i=W(r),o=z(),l=L("br")},m(s,u){M(s,e,u),S(e,t),S(e,i),M(s,o,u),M(s,l,u)},p(s,u){u&8&&r!==(r=Qr(s[3])+"")&&pe(i,r)},d(s){s&&P(e),s&&P(o),s&&P(l)}}}function Ql(n){let e,t,r,i,o,l,s,u,a,d,g,c,f,h,b,y,O,m,p,v,k,_,A;function x(G){n[7](G)}let F={labelText:"Name"};n[0]!==void 0&&(F.value=n[0]),e=new Do({props:F}),fe.push(()=>De(e,"value",x,n[0]));function q(G){n[8](G)}let E={$$slots:{default:[Zl]},$$scope:{ctx:n}};n[1]!==void 0&&(E.selected=n[1]),l=new xo({props:E}),fe.push(()=>De(l,"selected",q,n[1]));function B(G){n[9](G)}let N={labelText:"Description"};n[2]!==void 0&&(N.value=n[2]),g=new Oo({props:N}),fe.push(()=>De(g,"value",B,n[2]));let C=n[3]&&Zr(n);return{c(){V(e.$$.fragment),r=z(),i=L("br"),o=z(),V(l.$$.fragment),u=z(),a=L("br"),d=z(),V(g.$$.fragment),f=z(),h=L("br"),b=z(),C&&C.c(),y=z(),O=L("div"),m=L("button"),m.textContent="Delete",p=z(),v=L("button"),v.textContent="Save",R(m,"type","button"),R(v,"type","button"),Tt(v,"float","right")},m(G,J){H(e,G,J),M(G,r,J),M(G,i,J),M(G,o,J),H(l,G,J),M(G,u,J),M(G,a,J),M(G,d,J),H(g,G,J),M(G,f,J),M(G,h,J),M(G,b,J),C&&C.m(G,J),M(G,y,J),M(G,O,J),S(O,m),S(O,p),S(O,v),n[11](O),k=!0,_||(A=[X(m,"click",n[5]),X(v,"click",n[10])],_=!0)},p(G,[J]){const te={};!t&&J&1&&(t=!0,te.value=G[0],Ye(()=>t=!1)),e.$set(te);const $={};J&4096&&($.$$scope={dirty:J,ctx:G}),!s&&J&2&&(s=!0,$.selected=G[1],Ye(()=>s=!1)),l.$set($);const ee={};!c&&J&4&&(c=!0,ee.value=G[2],Ye(()=>c=!1)),g.$set(ee),G[3]?C?C.p(G,J):(C=Zr(G),C.c(),C.m(y.parentNode,y)):C&&(C.d(1),C=null)},i(G){k||(I(e.$$.fragment,G),I(l.$$.fragment,G),I(g.$$.fragment,G),k=!0)},o(G){D(e.$$.fragment,G),D(l.$$.fragment,G),D(g.$$.fragment,G),k=!1},d(G){Z(e,G),G&&P(r),G&&P(i),G&&P(o),Z(l,G),G&&P(u),G&&P(a),G&&P(d),Z(g,G),G&&P(f),G&&P(h),G&&P(b),C&&C.d(G),G&&P(y),G&&P(O),n[11](null),_=!1,Je(A)}}}function Qr(n){return n<1e3?Math.round(n)+" m":(n/1e3).toFixed(1)+"km"}function Kl(n,e,t){let{id:r}=e,{name:i}=e,{intervention_type:o}=e,{description:l}=e,{length_meters:s}=e,u;Ko.subscribe(b=>{r==b&&setTimeout(()=>u==null?void 0:u.scrollIntoView({behavior:"smooth"}),1)});function a(){ue.update(b=>(b.features=b.features.filter(y=>y.id!=r),b)),Te.set(null),Ge.set(null)}function d(b){i=b,t(0,i)}function g(b){o=b,t(1,o)}function c(b){l=b,t(2,l)}const f=()=>Te.set(null);function h(b){fe[b?"unshift":"push"](()=>{u=b,t(4,u)})}return n.$$set=b=>{"id"in b&&t(6,r=b.id),"name"in b&&t(0,i=b.name),"intervention_type"in b&&t(1,o=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(3,s=b.length_meters)},[i,o,l,s,u,a,r,d,g,c,f,h]}class $l extends oe{constructor(e){super(),le(this,e,Kl,Ql,se,{id:6,name:0,intervention_type:1,description:2,length_meters:3})}}function Kr(n){let e,t,r;const i=n[8].default,o=Re(i,n,n[7],null);return{c(){e=L("div"),o&&o.c()},m(l,s){M(l,e,s),o&&o.m(e,null),r=!0},p(l,s){o&&o.p&&(!r||s&128)&&Ae(o,i,l,l[7],r?Ne(i,l[7],s,null):Oe(l[7]),null)},i(l){r||(I(o,l),bi(()=>{t||(t=or(e,cr,{duration:300},!0)),t.run(1)}),r=!0)},o(l){D(o,l),t||(t=or(e,cr,{duration:300},!1)),t.run(0),r=!1},d(l){l&&P(e),o&&o.d(l),l&&t&&t.end()}}}function es(n){let e,t,r,i,o,l,s,u,a,d,g=n[2]&&Kr(n);return{c(){e=L("button"),t=xe("svg"),r=xe("path"),i=z(),o=W(n[0]),l=z(),g&&g.c(),s=ut(),R(r,"d","M9 5l7 7-7 7"),R(t,"style","tran"),R(t,"width","20"),R(t,"height","20"),R(t,"fill","none"),R(t,"stroke-linecap","round"),R(t,"stroke-linejoin","round"),R(t,"stroke-width","2"),R(t,"viewBox","0 0 24 24"),R(t,"stroke","currentColor"),R(t,"class","svelte-75u8ea"),R(e,"aria-expanded",n[2]),R(e,"class","svelte-75u8ea"),T(e,"underlined",n[1])},m(c,f){M(c,e,f),S(e,t),S(t,r),S(e,i),S(e,o),M(c,l,f),g&&g.m(c,f),M(c,s,f),u=!0,a||(d=[X(e,"click",n[3]),X(e,"mouseenter",n[9]),X(e,"mouseleave",n[10])],a=!0)},p(c,[f]){(!u||f&1)&&pe(o,c[0]),(!u||f&4)&&R(e,"aria-expanded",c[2]),(!u||f&2)&&T(e,"underlined",c[1]),c[2]?g?(g.p(c,f),f&4&&I(g,1)):(g=Kr(c),g.c(),I(g,1),g.m(s.parentNode,s)):g&&(Ee(),D(g,1,1,()=>{g=null}),Me())},i(c){u||(I(g),u=!0)},o(c){D(g),u=!1},d(c){c&&P(e),c&&P(l),g&&g.d(c),c&&P(s),a=!1,Je(d)}}}function ts(n,e,t){let r,i,o,l;he(n,Ge,h=>t(5,o=h)),he(n,Te,h=>t(6,l=h));let{$$slots:s={},$$scope:u}=e,{id:a}=e,{label:d}=e;const g=()=>{Te.update(h=>h==a?null:a)};function c(h){ne.call(this,n,h)}function f(h){ne.call(this,n,h)}return n.$$set=h=>{"id"in h&&t(4,a=h.id),"label"in h&&t(0,d=h.label),"$$scope"in h&&t(7,u=h.$$scope)},n.$$.update=()=>{n.$$.dirty&80&&t(2,r=l==a),n.$$.dirty&48&&t(1,i=o==a)},[d,i,r,g,a,o,l,u,s,c,f]}class ns extends oe{constructor(e){super(),le(this,e,ts,es,se,{id:4,label:0})}}function $r(n,e,t){const r=n.slice();return r[10]=e[t],r[11]=e,r[12]=t,r}function rs(n){let e,t,r,i,o,l;function s(g){n[3](g,n[10])}function u(g){n[4](g,n[10])}function a(g){n[5](g,n[10])}let d={id:n[10].id,length_meters:n[10].properties.length_meters};return n[10].properties.name!==void 0&&(d.name=n[10].properties.name),n[10].properties.intervention_type!==void 0&&(d.intervention_type=n[10].properties.intervention_type),n[10].properties.description!==void 0&&(d.description=n[10].properties.description),e=new $l({props:d}),fe.push(()=>De(e,"name",s,n[10].properties.name)),fe.push(()=>De(e,"intervention_type",u,n[10].properties.intervention_type)),fe.push(()=>De(e,"description",a,n[10].properties.description)),{c(){V(e.$$.fragment),o=z()},m(g,c){H(e,g,c),M(g,o,c),l=!0},p(g,c){n=g;const f={};c&1&&(f.id=n[10].id),c&1&&(f.length_meters=n[10].properties.length_meters),!t&&c&1&&(t=!0,f.name=n[10].properties.name,Ye(()=>t=!1)),!r&&c&1&&(r=!0,f.intervention_type=n[10].properties.intervention_type,Ye(()=>r=!1)),!i&&c&1&&(i=!0,f.description=n[10].properties.description,Ye(()=>i=!1)),e.$set(f)},i(g){l||(I(e.$$.fragment,g),l=!0)},o(g){D(e.$$.fragment,g),l=!1},d(g){Z(e,g),g&&P(o)}}}function ei(n,e){let t,r,i;function o(){return e[6](e[10])}return r=new ns({props:{id:e[10].id,label:e[12]+1+") "+ti(e[10]),$$slots:{default:[rs]},$$scope:{ctx:e}}}),r.$on("mouseenter",o),r.$on("mouseleave",e[7]),{key:n,first:null,c(){t=ut(),V(r.$$.fragment),this.first=t},m(l,s){M(l,t,s),H(r,l,s),i=!0},p(l,s){e=l;const u={};s&1&&(u.id=e[10].id),s&1&&(u.label=e[12]+1+") "+ti(e[10])),s&8193&&(u.$$scope={dirty:s,ctx:e}),r.$set(u)},i(l){i||(I(r.$$.fragment,l),i=!0)},o(l){D(r.$$.fragment,l),i=!1},d(l){l&&P(t),Z(r,l)}}}function is(n){let e=[],t=new Map,r,i,o,l,s=n[0].features;const u=a=>a[10].id;for(let a=0;a<s.length;a+=1){let d=$r(n,s,a),g=u(d);t.set(g,e[a]=ei(g,d))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=ut()},m(a,d){for(let g=0;g<e.length;g+=1)e[g].m(a,d);M(a,r,d),i=!0,o||(l=X(window,"keydown",n[2]),o=!0)},p(a,[d]){d&3&&(s=a[0].features,Ee(),e=ji(e,d,u,1,a,s,t,r.parentNode,Vi,ei,r,$r),Me())},i(a){if(!i){for(let d=0;d<s.length;d+=1)I(e[d]);i=!0}},o(a){for(let d=0;d<e.length;d+=1)D(e[d]);i=!1},d(a){for(let d=0;d<e.length;d+=1)e[d].d(a);a&&P(r),o=!1,l()}}}function ti(n){if(n.properties.name)return n.properties.name;var e=n.properties.intervention_type;return e=="other"&&(n.geometry.type=="Point"?e="point":n.geometry.type=="LineString"?e="line":e="polygon"),`Untitled ${e}`}function os(n,e,t){let r,i;he(n,Te,c=>t(8,r=c)),he(n,ue,c=>t(0,i=c));function o(c){r==null&&Ge.set(c)}function l(c){if(c.key=="Delete"){const f=c.originalTarget.tagName;if(f=="INPUT"||f=="TEXTAREA")return;c.preventDefault();const h=r;h&&(ue.update(b=>(b.features=b.features.filter(y=>y.id!=h),b)),Te.set(null))}}function s(c,f){n.$$.not_equal(f.properties.name,c)&&(f.properties.name=c,ue.set(i))}function u(c,f){n.$$.not_equal(f.properties.intervention_type,c)&&(f.properties.intervention_type=c,ue.set(i))}function a(c,f){n.$$.not_equal(f.properties.description,c)&&(f.properties.description=c,ue.set(i))}return[i,o,l,s,u,a,c=>o(c.id),()=>o(null)]}class ls extends oe{constructor(e){super(),le(this,e,os,is,se,{})}}function lt(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ve(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function xn(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function rt(n,e,t){t===void 0&&(t={});var r=lt(n),i=lt(e),o=Ce(i[1]-r[1]),l=Ce(i[0]-r[0]),s=Ce(r[1]),u=Ce(i[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(s)*Math.cos(u);return Un(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),t.units)}function ht(n,e,t){if(n!==null)for(var r,i,o,l,s,u,a,d=0,g=0,c,f=n.type,h=f==="FeatureCollection",b=f==="Feature",y=h?n.features.length:1,O=0;O<y;O++){a=h?n.features[O].geometry:b?n.geometry:n,c=a?a.type==="GeometryCollection":!1,s=c?a.geometries.length:1;for(var m=0;m<s;m++){var p=0,v=0;if(l=c?a.geometries[m]:a,l!==null){u=l.coordinates;var k=l.type;switch(d=t&&(k==="Polygon"||k==="MultiPolygon")?1:0,k){case null:break;case"Point":if(e(u,g,O,p,v)===!1)return!1;g++,p++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(e(u[r],g,O,p,v)===!1)return!1;g++,k==="MultiPoint"&&p++}k==="LineString"&&p++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-d;i++){if(e(u[r][i],g,O,p,v)===!1)return!1;g++}k==="MultiLineString"&&p++,k==="Polygon"&&v++}k==="Polygon"&&p++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(v=0,i=0;i<u[r].length;i++){for(o=0;o<u[r][i].length-d;o++){if(e(u[r][i][o],g,O,p,v)===!1)return!1;g++}v++}p++}break;case"GeometryCollection":for(r=0;r<l.geometries.length;r++)if(ht(l.geometries[r],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ss(n,e,t,r){var i=t;return ht(n,function(o,l,s,u,a){l===0&&t===void 0?i=o:i=e(i,o,l,s,u,a)},r),i}function Si(n,e){var t;switch(n.type){case"FeatureCollection":for(t=0;t<n.features.length&&e(n.features[t].properties,t)!==!1;t++);break;case"Feature":e(n.properties,0);break}}function as(n,e,t){var r=t;return Si(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}function kt(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function Ei(n,e,t){var r=t;return kt(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}function us(n){var e=[];return ht(n,function(t){e.push(t)}),e}function Kn(n,e){var t,r,i,o,l,s,u,a,d,g,c=0,f=n.type==="FeatureCollection",h=n.type==="Feature",b=f?n.features.length:1;for(t=0;t<b;t++){for(s=f?n.features[t].geometry:h?n.geometry:n,a=f?n.features[t].properties:h?n.properties:{},d=f?n.features[t].bbox:h?n.bbox:void 0,g=f?n.features[t].id:h?n.id:void 0,u=s?s.type==="GeometryCollection":!1,l=u?s.geometries.length:1,i=0;i<l;i++){if(o=u?s.geometries[i]:s,o===null){if(e(null,c,a,d,g)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,c,a,d,g)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],c,a,d,g)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}c++}}function fs(n,e,t){var r=t;return Kn(n,function(i,o,l,s,u){o===0&&t===void 0?r=i:r=e(r,i,o,l,s,u)}),r}function pt(n,e){Kn(n,function(t,r,i,o,l){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Ie(t,i,{bbox:o,id:l}),r,0)===!1?!1:void 0}var u;switch(s){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon";break}for(var a=0;a<t.coordinates.length;a++){var d=t.coordinates[a],g={type:u,coordinates:d};if(e(Ie(g,i),r,a)===!1)return!1}})}function cs(n,e,t){var r=t;return pt(n,function(i,o,l){o===0&&l===0&&t===void 0?r=i:r=e(r,i,o,l)}),r}function Mi(n,e){pt(n,function(t,r,i){var o=0;if(t.geometry){var l=t.geometry.type;if(!(l==="Point"||l==="MultiPoint")){var s,u=0,a=0,d=0;if(ht(t,function(g,c,f,h,b){if(s===void 0||r>u||h>a||b>d){s=g,u=r,a=h,d=b,o=0;return}var y=ke([s,g],t.properties);if(e(y,r,i,b,o)===!1)return!1;o++,s=g})===!1)return!1}}})}function Pi(n,e,t){var r=t,i=!1;return Mi(n,function(o,l,s,u,a){i===!1&&t===void 0?r=o:r=e(r,o,l,s,u,a),i=!0}),r}function xi(n,e){if(!n)throw new Error("geojson is required");pt(n,function(t,r,i){if(t.geometry!==null){var o=t.geometry.type,l=t.geometry.coordinates;switch(o){case"LineString":if(e(t,r,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<l.length;s++)if(e(ke(l[s],t.properties),r,i,s)===!1)return!1;break}}})}function ds(n,e,t){var r=t;return xi(n,function(i,o,l,s){o===0&&t===void 0?r=i:r=e(r,i,o,l,s)}),r}function hs(n,e){if(e=e||{},!Wn(e))throw new Error("options is invalid");var t=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,l=e.properties,s;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),l=l||n.features[t].properties,s=n.features[t].geometry;break;case"Feature":l=l||n.properties,s=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=n;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var u=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=u.length+o-1),ke([u[o],u[o+1]],l,e);case"Polygon":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o-1),ke([u[i][o],u[i][o+1]],l,e);case"MultiLineString":return r<0&&(r=u.length+r),o<0&&(o=u[r].length+o-1),ke([u[r][o],u[r][o+1]],l,e);case"MultiPolygon":return r<0&&(r=u.length+r),i<0&&(i=u[r].length+i),o<0&&(o=u[r][i].length-o-1),ke([u[r][i][o],u[r][i][o+1]],l,e)}throw new Error("geojson is invalid")}function ps(n,e){if(e=e||{},!Wn(e))throw new Error("options is invalid");var t=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,l=e.properties,s;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),l=l||n.features[t].properties,s=n.features[t].geometry;break;case"Feature":l=l||n.properties,s=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=n;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var u=s.coordinates;switch(s.type){case"Point":return we(u,l,e);case"MultiPoint":return r<0&&(r=u.length+r),we(u[r],l,e);case"LineString":return o<0&&(o=u.length+o),we(u[o],l,e);case"Polygon":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o),we(u[i][o],l,e);case"MultiLineString":return r<0&&(r=u.length+r),o<0&&(o=u[r].length+o),we(u[r][o],l,e);case"MultiPolygon":return r<0&&(r=u.length+r),i<0&&(i=u[r].length+i),o<0&&(o=u[r][i].length-o),we(u[r][i][o],l,e)}throw new Error("geojson is invalid")}const ms=Object.freeze(Object.defineProperty({__proto__:null,coordAll:us,coordEach:ht,coordReduce:ss,featureEach:kt,featureReduce:Ei,findPoint:ps,findSegment:hs,flattenEach:pt,flattenReduce:cs,geomEach:Kn,geomReduce:fs,lineEach:xi,lineReduce:ds,propEach:Si,propReduce:as,segmentEach:Mi,segmentReduce:Pi},Symbol.toStringTag,{value:"Module"}));function Ut(n,e){return e===void 0&&(e={}),Pi(n,function(t,r){var i=r.geometry.coordinates;return t+rt(i[0],i[1],e)},0)}function gs(n){let e,t,r,i,o,l,s,u,a,d,g,c,f,h,b,y,O,m,p,v=n[0].features.length+"",k,_,A,x,F,q,E,B;return{c(){e=L("div"),t=L("label"),r=W(`Scheme name:
    `),i=L("input"),o=z(),l=L("br"),s=z(),u=L("div"),a=L("label"),d=L("input"),g=z(),c=L("button"),c.textContent="Load from GeoJSON",f=z(),h=L("button"),h.textContent="Export to GeoJSON",b=z(),y=L("br"),O=z(),m=L("div"),p=L("span"),k=W(v),_=W(" interventions"),A=z(),x=L("button"),F=W("Clear all"),R(i,"type","text"),R(d,"type","file"),R(d,"id","load_geojson"),R(d,"class","svelte-lhyd1e"),R(c,"type","button"),R(c,"onclick","document.getElementById('load_geojson').click();"),R(h,"type","button"),R(h,"class","align-right svelte-lhyd1e"),R(x,"type","button"),R(x,"class","align-right svelte-lhyd1e"),x.disabled=q=n[0].features.length==0},m(N,C){M(N,e,C),S(e,t),S(t,r),S(t,i),wt(i,n[0].scheme_name),M(N,o,C),M(N,l,C),M(N,s,C),M(N,u,C),S(u,a),S(a,d),S(a,g),S(a,c),S(u,f),S(u,h),M(N,b,C),M(N,y,C),M(N,O,C),M(N,m,C),S(m,p),S(p,k),S(p,_),S(m,A),S(m,x),S(x,F),E||(B=[X(i,"input",n[5]),X(d,"change",n[3]),X(h,"click",n[2]),X(x,"click",n[1])],E=!0)},p(N,[C]){C&1&&i.value!==N[0].scheme_name&&wt(i,N[0].scheme_name),C&1&&v!==(v=N[0].features.length+"")&&pe(k,v),C&1&&q!==(q=N[0].features.length==0)&&(x.disabled=q)},i:re,o:re,d(N){N&&P(e),N&&P(o),N&&P(l),N&&P(s),N&&P(u),N&&P(b),N&&P(y),N&&P(O),N&&P(m),E=!1,Je(B)}}}function bs(n,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",n),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function vs(n,e,t){let r;he(n,ue,c=>t(0,r=c));let{authorityName:i}=e,o=window.localStorage.getItem(i);if(o)try{ue.set(d(JSON.parse(o)))}catch(c){console.log(`Failed to load from local storage: ${c}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&ue.update(c=>(delete c.scheme_name,c.features=[],c))}function s(){const c=JSON.parse(JSON.stringify(r));for(let f of c.features)delete f.properties.editing,delete f.properties.hide_while_editing;return c}function u(){let c=s();var f=i;c.authority=i,c.origin="atip-v1",c.scheme_name&&(f+="_"+c.scheme_name),f+=".txt",bs(f,JSON.stringify(c,null,"  "))}function a(c){const f=new FileReader;f.onload=h=>{try{ue.set(d(JSON.parse(h.target.result)))}catch(b){window.alert(`Couldn't load scheme from a file: ${b}`)}},f.readAsText(c.target.files[0])}function d(c){let f=1;for(let h of c.features)h.geometry.type=="LineString"&&!h.properties.length_meters&&(h.properties.length_meters=Ut(h.geometry,{units:"kilometers"})*1e3),h.id=f++;return c}function g(){r.scheme_name=this.value,ue.set(r)}return n.$$set=c=>{"authorityName"in c&&t(4,i=c.authorityName)},n.$$.update=()=>{n.$$.dirty&17&&r&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(i,JSON.stringify(s())))},[r,l,u,a,i,g]}class _s extends oe{constructor(e){super(),le(this,e,vs,gs,se,{authorityName:4})}}const ys="/atip/assets/zoom_out_map-b2e1091a.svg";function ws(n){let e,t,r,i,o;return{c(){e=L("button"),t=L("img"),Hi(t.src,r=ys)||R(t,"src",r),R(t,"alt","Zoom to show entire boundary"),R(e,"type","button"),R(e,"title","Zoom to show entire boundary"),R(e,"class","svelte-qzjsqo")},m(l,s){M(l,e,s),S(e,t),i||(o=X(e,"click",n[0]),i=!0)},p:re,i:re,o:re,d(l){l&&P(e),i=!1,o()}}}function ks(n,e,t){let r;he(n,Ze,l=>t(2,r=l));let{boundaryGeojson:i}=e;function o(){r.fitBounds(Dn(i),{padding:20,animate:!0,duration:500})}return n.$$set=l=>{"boundaryGeojson"in l&&t(1,i=l.boundaryGeojson)},[o,i]}class Ss extends oe{constructor(e){super(),le(this,e,ks,ws,se,{boundaryGeojson:1})}}function Es(n){let e,t,r,i,o,l,s;return{c(){e=L("div"),t=W(`Basemap:
  `),r=L("select"),i=L("option"),i.textContent="Streets",o=L("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,n[0]===void 0&&bi(()=>n[2].call(r)),R(e,"class","svelte-1tbnm6i")},m(u,a){M(u,e,a),S(e,t),S(e,r),S(r,i),S(r,o),lr(r,n[0]),l||(s=[X(r,"change",n[2]),X(r,"change",n[1])],l=!0)},p(u,[a]){a&1&&lr(r,u[0])},i:re,o:re,d(u){u&&P(e),l=!1,Je(s)}}}function Ms(n,e,t){let{style:r}=e;function i(){let l=new URLSearchParams(window.location.search);l.set("style",r);let s=`${window.location.pathname}?${l.toString()}${window.location.hash}`;window.location.href=s}function o(){r=Zi(this),t(0,r)}return n.$$set=l=>{"style"in l&&t(0,r=l.style)},[r,i,o]}class Ps extends oe{constructor(e){super(),le(this,e,Ms,Es,se,{style:0})}}const Pe={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",hovering:"black",lineEndpointColor:"black"},fn=10,en=10;function xs(n){let e,t,r,i,o,l,s,u,a,d,g,c,f,h,b,y,O,m,p;return{c(){e=L("div"),t=L("h1"),t.textContent="Interventions",r=z(),i=L("ul"),o=L("li"),l=L("span"),s=W("Areas"),u=z(),a=L("li"),d=L("span"),g=W("Routes"),c=z(),f=L("li"),h=L("span"),b=W("Crossings"),y=z(),O=L("li"),m=L("span"),p=W("Other"),R(t,"class","svelte-p551i1"),R(l,"class","svelte-p551i1"),Tt(l,"background",Pe.area),R(d,"class","svelte-p551i1"),Tt(d,"background",Pe.route),R(h,"class","svelte-p551i1"),Tt(h,"background",Pe.crossing),R(m,"class","svelte-p551i1"),Tt(m,"background",Pe.other),R(e,"class","svelte-p551i1")},m(v,k){M(v,e,k),S(e,t),S(e,r),S(e,i),S(i,o),S(o,l),S(o,s),S(i,u),S(i,a),S(a,d),S(a,g),S(i,c),S(i,f),S(f,h),S(f,b),S(i,y),S(i,O),S(O,m),S(O,p)},p:re,i:re,o:re,d(v){v&&P(e)}}}class Ts extends oe{constructor(e){super(),le(this,e,null,xs,se,{})}}let mt="interventions";function Ls(n,e,t){let r,i;he(n,Ze,u=>t(0,r=u)),he(n,ue,u=>t(1,i=u)),Et(r,mt,{type:"geojson",data:i});const o=["match",["get","intervention_type"],"area",Pe.area,"route",Pe.route,"crossing",Pe.crossing,"other",Pe.other,"white"],l=["!=","hide_while_editing",!0];return Le(r,{id:"interventions-points",source:mt,filter:["all",Zn,l,["!=","endpoint",!0]],...Gt(o,fn)}),Le(r,{id:"interventions-lines",source:mt,filter:["all",Hn,l],...$t(o,en)},"route-lines"),Le(r,{id:"interventions-lines-endpoints",source:mt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*en,"circle-opacity":0,"circle-stroke-color":Pe.lineEndpointColor,"circle-stroke-width":2}}),Le(r,{id:"interventions-polygons",source:mt,filter:["all",Vn,l],...Qn(o,.5)},"hover-polygons"),n.$$.update=()=>{if(n.$$.dirty&3){let u=JSON.parse(JSON.stringify(i)),a=[];for(let d of u.features)if(d.geometry.type=="LineString")for(let g of[d.geometry.coordinates[0],d.geometry.coordinates[d.geometry.coordinates.length-1]])a.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:g}});u.features=u.features.concat(a),r.getSource(mt).setData(u)}},[r,i]}class Cs extends oe{constructor(e){super(),le(this,e,Ls,null,se,{})}}let gt="hover";function Rs(n,e,t){let r,i;return he(n,Ze,o=>t(0,r=o)),he(n,ue,o=>t(1,i=o)),Et(r,gt,{type:"geojson",data:$e()}),Le(r,{id:"hover-polygons",source:gt,filter:Vn,...$t(Pe.hovering,.5*en,1)}),Le(r,{id:"hover-lines",source:gt,filter:Hn,...$t(Pe.hovering,1.5*en,1)},"interventions-lines"),Le(r,{id:"hover-points",source:gt,filter:Zn,...Gt(Pe.hovering,1.5*fn,1)},"interventions-points"),Ge.subscribe(o=>{o!=null?r.getSource(gt).setData(i.features.find(l=>l.id==o)):r.getSource(gt).setData($e())}),[]}class As extends oe{constructor(e){super(),le(this,e,Rs,null,se,{})}}var Ft,Tn;class Os{constructor(e){ft(this,Ft);this.map=e,this.active=!1,this.eventListeners=[],this.cursor=null,e.on("mousemove",t=>{this.active&&(this.cursor=Ns(t.lngLat.toArray()),de(this,Ft,Tn).call(this))}),e.on("click",t=>{if(this.active&&this.cursor){for(let r of this.eventListeners)r(this.cursor);this.stop()}}),this.source="edit-point-mode",Et(e,this.source,{type:"geojson",data:$e()}),Le(e,{id:"edit-point-mode",source:this.source,...Gt(Pe.hovering,fn,1)})}addEventListener(e){this.eventListeners.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(this.source)}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,de(this,Ft,Tn).call(this)}}Ft=new WeakSet,Tn=function(){let e=$e();this.cursor&&e.features.push(this.cursor),this.map.getSource(this.source).setData(e)};function Ns(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function Ti(n,e,t){if(t===void 0&&(t={}),t.final===!0)return Fs(n,e);var r=lt(n),i=lt(e),o=Ce(r[0]),l=Ce(i[0]),s=Ce(r[1]),u=Ce(i[1]),a=Math.sin(l-o)*Math.cos(u),d=Math.cos(s)*Math.sin(u)-Math.sin(s)*Math.cos(u)*Math.cos(l-o);return At(Math.atan2(a,d))}function Fs(n,e){var t=Ti(e,n);return t=(t+180)%360,t}function ni(n,e,t,r){r===void 0&&(r={});var i=lt(n),o=Ce(i[0]),l=Ce(i[1]),s=Ce(t),u=un(e,r.units),a=Math.asin(Math.sin(l)*Math.cos(u)+Math.cos(l)*Math.sin(u)*Math.cos(s)),d=o+Math.atan2(Math.sin(s)*Math.sin(u)*Math.cos(l),Math.cos(u)-Math.sin(l)*Math.sin(a)),g=At(d),c=At(a);return we([g,c],r.properties)}function Ln(n){if(!n)throw new Error("geojson is required");var e=[];return pt(n,function(t){Is(t,e)}),Fe(e)}function Is(n,e){var t=[],r=n.geometry;if(r!==null){switch(r.type){case"Polygon":t=Ve(r);break;case"LineString":t=[Ve(r)]}t.forEach(function(i){var o=Bs(i,n.properties);o.forEach(function(l){l.id=e.length,e.push(l)})})}}function Bs(n,e){var t=[];return n.reduce(function(r,i){var o=ke([r,i],e);return o.bbox=zs(r,i),t.push(o),i}),t}function zs(n,e){var t=n[0],r=n[1],i=e[0],o=e[1],l=t<i?t:i,s=r<o?r:o,u=t>i?t:i,a=r>o?r:o;return[l,s,u,a]}var St={},Gs={get exports(){return St},set exports(n){St=n}},Cn={},qs={get exports(){return Cn},set exports(n){Cn=n}};(function(n,e){(function(t,r){n.exports=r()})(Qi,function(){function t(m,p,v,k,_){(function A(x,F,q,E,B){for(;E>q;){if(E-q>600){var N=E-q+1,C=F-q+1,G=Math.log(N),J=.5*Math.exp(2*G/3),te=.5*Math.sqrt(G*J*(N-J)/N)*(C-N/2<0?-1:1),$=Math.max(q,Math.floor(F-C*J/N+te)),ee=Math.min(E,Math.floor(F+(N-C)*J/N+te));A(x,F,$,ee,B)}var ae=x[F],ie=q,w=E;for(r(x,q,F),B(x[E],ae)>0&&r(x,q,E);ie<w;){for(r(x,ie,w),ie++,w--;B(x[ie],ae)<0;)ie++;for(;B(x[w],ae)>0;)w--}B(x[q],ae)===0?r(x,q,w):r(x,++w,E),w<=F&&(q=w+1),F<=w&&(E=w-1)}})(m,p,v||0,k||m.length-1,_||i)}function r(m,p,v){var k=m[p];m[p]=m[v],m[v]=k}function i(m,p){return m<p?-1:m>p?1:0}var o=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function l(m,p,v){if(!v)return p.indexOf(m);for(var k=0;k<p.length;k++)if(v(m,p[k]))return k;return-1}function s(m,p){u(m,0,m.children.length,p,m)}function u(m,p,v,k,_){_||(_=y(null)),_.minX=1/0,_.minY=1/0,_.maxX=-1/0,_.maxY=-1/0;for(var A=p;A<v;A++){var x=m.children[A];a(_,m.leaf?k(x):x)}return _}function a(m,p){return m.minX=Math.min(m.minX,p.minX),m.minY=Math.min(m.minY,p.minY),m.maxX=Math.max(m.maxX,p.maxX),m.maxY=Math.max(m.maxY,p.maxY),m}function d(m,p){return m.minX-p.minX}function g(m,p){return m.minY-p.minY}function c(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function f(m){return m.maxX-m.minX+(m.maxY-m.minY)}function h(m,p){return m.minX<=p.minX&&m.minY<=p.minY&&p.maxX<=m.maxX&&p.maxY<=m.maxY}function b(m,p){return p.minX<=m.maxX&&p.minY<=m.maxY&&p.maxX>=m.minX&&p.maxY>=m.minY}function y(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function O(m,p,v,k,_){for(var A=[p,v];A.length;)if(!((v=A.pop())-(p=A.pop())<=k)){var x=p+Math.ceil((v-p)/k/2)*k;t(m,x,p,v,_),A.push(p,x,x,v)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(m){var p=this.data,v=[];if(!b(m,p))return v;for(var k=this.toBBox,_=[];p;){for(var A=0;A<p.children.length;A++){var x=p.children[A],F=p.leaf?k(x):x;b(m,F)&&(p.leaf?v.push(x):h(m,F)?this._all(x,v):_.push(x))}p=_.pop()}return v},o.prototype.collides=function(m){var p=this.data;if(!b(m,p))return!1;for(var v=[];p;){for(var k=0;k<p.children.length;k++){var _=p.children[k],A=p.leaf?this.toBBox(_):_;if(b(m,A)){if(p.leaf||h(m,A))return!0;v.push(_)}}p=v.pop()}return!1},o.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var p=0;p<m.length;p++)this.insert(m[p]);return this}var v=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var k=this.data;this.data=v,v=k}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},o.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},o.prototype.clear=function(){return this.data=y([]),this},o.prototype.remove=function(m,p){if(!m)return this;for(var v,k,_,A=this.data,x=this.toBBox(m),F=[],q=[];A||F.length;){if(A||(A=F.pop(),k=F[F.length-1],v=q.pop(),_=!0),A.leaf){var E=l(m,A.children,p);if(E!==-1)return A.children.splice(E,1),F.push(A),this._condense(F),this}_||A.leaf||!h(A,x)?k?(v++,A=k.children[v],_=!1):A=null:(F.push(A),q.push(v),v=0,k=A,A=A.children[0])}return this},o.prototype.toBBox=function(m){return m},o.prototype.compareMinX=function(m,p){return m.minX-p.minX},o.prototype.compareMinY=function(m,p){return m.minY-p.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(m){return this.data=m,this},o.prototype._all=function(m,p){for(var v=[];m;)m.leaf?p.push.apply(p,m.children):v.push.apply(v,m.children),m=v.pop();return p},o.prototype._build=function(m,p,v,k){var _,A=v-p+1,x=this._maxEntries;if(A<=x)return s(_=y(m.slice(p,v+1)),this.toBBox),_;k||(k=Math.ceil(Math.log(A)/Math.log(x)),x=Math.ceil(A/Math.pow(x,k-1))),(_=y([])).leaf=!1,_.height=k;var F=Math.ceil(A/x),q=F*Math.ceil(Math.sqrt(x));O(m,p,v,q,this.compareMinX);for(var E=p;E<=v;E+=q){var B=Math.min(E+q-1,v);O(m,E,B,F,this.compareMinY);for(var N=E;N<=B;N+=F){var C=Math.min(N+F-1,B);_.children.push(this._build(m,N,C,k-1))}}return s(_,this.toBBox),_},o.prototype._chooseSubtree=function(m,p,v,k){for(;k.push(p),!p.leaf&&k.length-1!==v;){for(var _=1/0,A=1/0,x=void 0,F=0;F<p.children.length;F++){var q=p.children[F],E=c(q),B=(N=m,C=q,(Math.max(C.maxX,N.maxX)-Math.min(C.minX,N.minX))*(Math.max(C.maxY,N.maxY)-Math.min(C.minY,N.minY))-E);B<A?(A=B,_=E<_?E:_,x=q):B===A&&E<_&&(_=E,x=q)}p=x||p.children[0]}var N,C;return p},o.prototype._insert=function(m,p,v){var k=v?m:this.toBBox(m),_=[],A=this._chooseSubtree(k,this.data,p,_);for(A.children.push(m),a(A,k);p>=0&&_[p].children.length>this._maxEntries;)this._split(_,p),p--;this._adjustParentBBoxes(k,_,p)},o.prototype._split=function(m,p){var v=m[p],k=v.children.length,_=this._minEntries;this._chooseSplitAxis(v,_,k);var A=this._chooseSplitIndex(v,_,k),x=y(v.children.splice(A,v.children.length-A));x.height=v.height,x.leaf=v.leaf,s(v,this.toBBox),s(x,this.toBBox),p?m[p-1].children.push(x):this._splitRoot(v,x)},o.prototype._splitRoot=function(m,p){this.data=y([m,p]),this.data.height=m.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(m,p,v){for(var k,_,A,x,F,q,E,B=1/0,N=1/0,C=p;C<=v-p;C++){var G=u(m,0,C,this.toBBox),J=u(m,C,v,this.toBBox),te=(_=G,A=J,x=void 0,F=void 0,q=void 0,E=void 0,x=Math.max(_.minX,A.minX),F=Math.max(_.minY,A.minY),q=Math.min(_.maxX,A.maxX),E=Math.min(_.maxY,A.maxY),Math.max(0,q-x)*Math.max(0,E-F)),$=c(G)+c(J);te<B?(B=te,k=C,N=$<N?$:N):te===B&&$<N&&(N=$,k=C)}return k||v-p},o.prototype._chooseSplitAxis=function(m,p,v){var k=m.leaf?this.compareMinX:d,_=m.leaf?this.compareMinY:g;this._allDistMargin(m,p,v,k)<this._allDistMargin(m,p,v,_)&&m.children.sort(k)},o.prototype._allDistMargin=function(m,p,v,k){m.children.sort(k);for(var _=this.toBBox,A=u(m,0,p,_),x=u(m,v-p,v,_),F=f(A)+f(x),q=p;q<v-p;q++){var E=m.children[q];a(A,m.leaf?_(E):E),F+=f(A)}for(var B=v-p-1;B>=p;B--){var N=m.children[B];a(x,m.leaf?_(N):N),F+=f(x)}return F},o.prototype._adjustParentBBoxes=function(m,p,v){for(var k=v;k>=0;k--)a(p[k],m)},o.prototype._condense=function(m){for(var p=m.length-1,v=void 0;p>=0;p--)m[p].children.length===0?p>0?(v=m[p-1].children).splice(v.indexOf(m[p]),1):this.clear():s(m[p],this.toBBox)},o})})(qs);const Ds=Yn(wl),Ys=Yn(ms);function tn(n){var e=[1/0,1/0,-1/0,-1/0];return ht(n,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}tn.default=tn;const Xs=Object.freeze(Object.defineProperty({__proto__:null,default:tn},Symbol.toStringTag,{value:"Module"})),Js=Yn(Xs);var Ue=Cn,Li=Ds,Ci=Ys,bt=Js.default,Us=Ci.featureEach;Ci.coordEach;Li.polygon;var ri=Li.featureCollection;function Ri(n){var e=new Ue(n);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:bt(t),Ue.prototype.insert.call(this,t)},e.load=function(t){var r=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:bt(i),r.push(i)}):Us(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:bt(i),r.push(i)}),Ue.prototype.load.call(this,r)},e.remove=function(t,r){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:bt(t),Ue.prototype.remove.call(this,t,r)},e.clear=function(){return Ue.prototype.clear.call(this)},e.search=function(t){var r=Ue.prototype.search.call(this,this.toBBox(t));return ri(r)},e.collides=function(t){return Ue.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ue.prototype.all.call(this);return ri(t)},e.toJSON=function(){return Ue.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ue.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var r;if(t.bbox)r=t.bbox;else if(Array.isArray(t)&&t.length===4)r=t;else if(Array.isArray(t)&&t.length===6)r=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")r=bt(t);else if(t.type==="FeatureCollection")r=bt(t);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},e}Gs.exports=Ri;St.default=Ri;function Ai(n,e){var t={},r=[];if(n.type==="LineString"&&(n=Ie(n)),e.type==="LineString"&&(e=Ie(e)),n.type==="Feature"&&e.type==="Feature"&&n.geometry!==null&&e.geometry!==null&&n.geometry.type==="LineString"&&e.geometry.type==="LineString"&&n.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=ii(n,e);return i&&r.push(i),Fe(r)}var o=St();return o.load(Ln(e)),kt(Ln(n),function(l){kt(o.search(l),function(s){var u=ii(l,s);if(u){var a=Ve(u).join(",");t[a]||(t[a]=!0,r.push(u))}})}),Fe(r)}function ii(n,e){var t=Ve(n),r=Ve(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],l=t[1][0],s=t[1][1],u=r[0][0],a=r[0][1],d=r[1][0],g=r[1][1],c=(g-a)*(l-i)-(d-u)*(s-o),f=(d-u)*(o-a)-(g-a)*(i-u),h=(l-i)*(o-a)-(s-o)*(i-u);if(c===0)return f===0&&h===0,null;var b=f/c,y=h/c;if(b>=0&&b<=1&&y>=0&&y<=1){var O=i+b*(l-i),m=o+b*(s-o);return we([O,m])}return null}function Nt(n,e,t){t===void 0&&(t={});var r=we([1/0,1/0],{dist:1/0}),i=0;return pt(n,function(o){for(var l=Ve(o),s=0;s<l.length-1;s++){var u=we(l[s]);u.properties.dist=rt(e,u,t);var a=we(l[s+1]);a.properties.dist=rt(e,a,t);var d=rt(u,a,t),g=Math.max(u.properties.dist,a.properties.dist),c=Ti(u,a),f=ni(e,g,c+90,t),h=ni(e,g,c-90,t),b=Ai(ke([f.geometry.coordinates,h.geometry.coordinates]),ke([u.geometry.coordinates,a.geometry.coordinates])),y=null;b.features.length>0&&(y=b.features[0],y.properties.dist=rt(e,y,t),y.properties.location=i+rt(u,y,t)),u.properties.dist<r.properties.dist&&(r=u,r.properties.index=s,r.properties.location=i),a.properties.dist<r.properties.dist&&(r=a,r.properties.index=s+1,r.properties.location=i+d),y&&y.properties.dist<r.properties.dist&&(r=y,r.properties.index=s),i+=d}}),r}var Qe,ct,It,Rn,Bt,An;class Ws{constructor(e){ft(this,Qe);ft(this,It);ft(this,Bt);this.map=e,this.active=!1,this.eventListeners=[],this.points=[],this.cursor=null,this.hoverPolyon=!1,this.hoverPoint=null,this.dragging=!1,this.dragFrom=null,e.on("mousemove",t=>{if(this.active&&!this.dragging)de(this,It,Rn).call(this,t);else if(this.active&&this.dragging){if(this.hoverPolyon){let r=this.dragFrom[0]-t.lngLat.lng,i=this.dragFrom[1]-t.lngLat.lat;for(let o of this.points)o[0]-=r,o[1]-=i}else this.points[this.hoverPoint]=t.lngLat.toArray();this.dragFrom=t.lngLat.toArray(),de(this,Qe,ct).call(this)}}),e.on("click",t=>{if(this.active&&this.cursor){let r=[];if(li(this.points).forEach((i,o)=>{r.push([o+1,Nt(i,this.cursor).properties.dist])}),r.sort((i,o)=>i[1]-o[1]),r.length>0){let i=r[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hoverPoint=i}else this.points.push(this.cursor.geometry.coordinates),this.hoverPoint=this.points.length-1;de(this,Qe,ct).call(this)}else this.active&&this.hoverPoint!=null&&(this.points.splice(this.hoverPoint,1),this.hoverPoint=null,de(this,Qe,ct).call(this),de(this,It,Rn).call(this,t))}),e.on("mousedown",t=>{this.active&&!this.dragging&&(this.hoverPolyon||this.hoverPoint!=null)&&(t.preventDefault(),this.cursor=null,this.dragging=!0,this.dragFrom=t.lngLat.toArray())}),e.on("mouseup",t=>{this.active&&this.dragging&&(this.dragging=!1,this.dragFrom=null)}),document.addEventListener("keypress",t=>{if(this.active&&t.key=="Enter"){t.preventDefault();let r=de(this,Bt,An).call(this);if(r)for(let i of this.eventListeners)i(r);this.stop()}}),this.source="edit-polygon-mode",Et(e,this.source,{type:"geojson",data:$e()}),Le(e,{id:"edit-polygon-fill",source:this.source,filter:Vn,...Qn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Le(e,{id:"edit-polygon-lines",source:this.source,filter:Hn,...$t("black",8,.5)}),Le(e,{id:"edit-polygon-vertices",source:this.source,filter:Zn,...Gt(Pe.hovering,fn,["case",["boolean",["get","hover"],"false"],1,.5])})}addEventListener(e){this.eventListeners.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(this.source)}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=e.geometry.coordinates[0],this.points.pop(),de(this,Qe,ct).call(this)}stop(){this.points=[],this.cursor=null,this.active=!1,this.hoverPolyon=!1,this.hoverPoint=null,this.dragging=!1,this.dragFrom=null,de(this,Qe,ct).call(this)}}Qe=new WeakSet,ct=function(){let e=$e();this.points.forEach((r,i)=>{let o=oi(r);o.properties.hover=this.hoverPoint==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(li(this.points));let t=de(this,Bt,An).call(this);t&&(t.properties.hover=this.hoverPolyon,e.features.push(t)),this.map.getSource(this.source).setData(e)},It=new WeakSet,Rn=function(e){this.cursor=null,this.hoverPolyon=!1,this.hoverPoint=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hoverPolyon=!0;break}else if(t.geometry.type=="Point"&&t.properties.hasOwnProperty("idx")){this.hoverPoint=t.properties.idx;break}!this.hoverPolyon&&this.hoverPoint==null&&(this.cursor=oi(e.lngLat.toArray())),de(this,Qe,ct).call(this)},Bt=new WeakSet,An=function(){if(this.points.length<3)return null;let e={type:"Feature",geometry:{type:"Polygon",coordinates:[JSON.parse(JSON.stringify(this.points))]},properties:{}};return e.geometry.coordinates[0].push(e.geometry.coordinates[0][0]),e};function oi(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function li(n){let e=[];for(let t=0;t<n.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[t],n[t+1]]}});return n.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[n.length-1],n[0]]}}),e}function si(n){let e;return{c(){e=L("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function js(n){let e,t=n[0]==vt&&si();return{c(){t&&t.c(),e=ut()},m(r,i){t&&t.m(r,i),M(r,e,i)},p(r,[i]){r[0]==vt?t||(t=si(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:re,o:re,d(r){t&&t.d(r),r&&P(e)}}}const vt="edit-attribute";function Oi(){}function Vs(n,e,t){let r,i,o;he(n,Ze,a=>t(4,r=a)),he(n,ue,a=>t(5,i=a)),he(n,Te,a=>t(6,o=a));let{mode:l}=e,{changeMode:s}=e;function u(){Te.set(null)}return r.on("mousemove",a=>{if(l==vt&&o==null){let g=r.queryRenderedFeatures(a.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});var d=null;g.length>0&&(d=g[0].id),Ge.set(d)}}),r.on("mouseout",()=>{l==vt&&o==null&&Ge.set(null)}),r.on("click",a=>{if(l==vt){let d=r.queryRenderedFeatures(a.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});d.length>0?Te.set(d[0].id):(Te.set(null),Ge.set(null))}}),Qo.subscribe(a=>{if(a){let d=i.features.find(g=>g.id==a);d.geometry.type=="Point"?r.flyTo({center:d.geometry.coordinates}):r.fitBounds(Dn(d),{padding:200,animate:!0,duration:500}),s(vt)}}),n.$$set=a=>{"mode"in a&&t(0,l=a.mode),"changeMode"in a&&t(1,s=a.changeMode)},[l,s,Oi,u]}class Hs extends oe{constructor(e){super(),le(this,e,Vs,js,se,{mode:0,changeMode:1,start:2,stop:3})}get start(){return Oi}get stop(){return this.$$.ctx[3]}}function ai(n){let e;return{c(){e=L("p"),e.textContent="Click an intervention to edit its geometry"},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function Zs(n){let e,t=n[0]==tt&&ai();return{c(){t&&t.c(),e=ut()},m(r,i){t&&t.m(r,i),M(r,e,i)},p(r,[i]){r[0]==tt?t||(t=ai(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:re,o:re,d(r){t&&t.d(r),r&&P(e)}}}const tt="edit-geometry";function Ni(){}function Qs(n,e,t){let r;he(n,Ze,c=>t(8,r=c));let{mode:i}=e,{routeSnapper:o}=e,{snapTool:l}=e,{pointTool:s}=e,{polygonTool:u}=e;function a(){d&&(o.stop(),s.stop(),u.stop(),ue.update(c=>{let f=c.features.find(h=>h.id==d);return delete f.properties.hide_while_editing,c})),d=null,Ge.set(null)}let d=null;r.on("mousemove",c=>{if(i==tt&&d==null){let h=r.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});var f=null;h.length>0&&(f=h[0].id),Ge.set(f)}}),r.on("mouseout",()=>{i==tt&&d==null&&Ge.set(null)}),r.on("click",c=>{if(i==tt&&d==null){let f=r.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});f.length>0&&g(f[0].id)}}),l.addEventListener("new-route",c=>{if(i==tt){const f=c.detail;ue.update(h=>{let b=h.features.find(y=>y.id==d);return b.properties.length_meters=f.properties.length_meters,b.properties.waypoints=f.properties.waypoints,delete b.properties.hide_while_editing,b.geometry=f.geometry,h}),d=null}}),l.addEventListener("no-new-route",()=>{i==tt&&(ue.update(c=>{let f=c.features.find(h=>h.id==d);return delete f.properties.hide_while_editing,c}),d=null)});for(let c of[s,u])c.addEventListener(f=>{i==tt&&(ue.update(h=>{let b=h.features.find(y=>y.id==d);return b.geometry=f.geometry,delete b.properties.hide_while_editing,h}),d=null)});function g(c){Ge.set(null);let f;ue.update(h=>(f=h.features.find(b=>b.id==c),f.properties.hide_while_editing=!0,h)),d=c,f.geometry.type=="LineString"?o.editExisting(f):f.geometry.type=="Polygon"?u.editExisting(f):f.geometry.type=="Point"&&s.start()}return n.$$set=c=>{"mode"in c&&t(0,i=c.mode),"routeSnapper"in c&&t(1,o=c.routeSnapper),"snapTool"in c&&t(2,l=c.snapTool),"pointTool"in c&&t(3,s=c.pointTool),"polygonTool"in c&&t(4,u=c.polygonTool)},[i,o,l,s,u,Ni,a]}class Ks extends oe{constructor(e){super(),le(this,e,Qs,Zs,se,{mode:0,routeSnapper:1,snapTool:2,pointTool:3,polygonTool:4,start:5,stop:6})}get start(){return Ni}get stop(){return this.$$.ctx[6]}}let j;const Fi=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Fi.decode();let Wt=new Uint8Array;function Ct(){return Wt.byteLength===0&&(Wt=new Uint8Array(j.memory.buffer)),Wt}function _t(n,e){return Fi.decode(Ct().subarray(n,n+e))}const Ke=new Array(32).fill(void 0);Ke.push(void 0,null,!0,!1);let Rt=Ke.length;function ge(n){Rt===Ke.length&&Ke.push(Ke.length+1);const e=Rt;return Rt=Ke[e],Ke[e]=n,e}function K(n){return Ke[n]}function $s(n){n<36||(Ke[n]=Rt,Rt=n)}function On(n){const e=K(n);return $s(n),e}function mn(n){return n==null}let jt=new Float64Array;function ea(){return jt.byteLength===0&&(jt=new Float64Array(j.memory.buffer)),jt}let Vt=new Int32Array;function be(){return Vt.byteLength===0&&(Vt=new Int32Array(j.memory.buffer)),Vt}let ot=0;const Ht=new TextEncoder("utf-8"),ta=typeof Ht.encodeInto=="function"?function(n,e){return Ht.encodeInto(n,e)}:function(n,e){const t=Ht.encode(n);return e.set(t),{read:n.length,written:t.length}};function Xt(n,e,t){if(t===void 0){const s=Ht.encode(n),u=e(s.length);return Ct().subarray(u,u+s.length).set(s),ot=s.length,u}let r=n.length,i=e(r);const o=Ct();let l=0;for(;l<r;l++){const s=n.charCodeAt(l);if(s>127)break;o[i+l]=s}if(l!==r){l!==0&&(n=n.slice(l)),i=t(i,r,r=l+n.length*3);const s=Ct().subarray(i+l,i+r),u=ta(n,s);l+=u.written}return ot=l,i}function Nn(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){const i=n.length;let o="[";i>0&&(o+=Nn(n[0]));for(let l=1;l<i;l++)o+=", "+Nn(n[l]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function na(n,e){const t=e(n.length*1);return Ct().set(n,t/1),ot=n.length,t}function gn(n,e){try{return n.apply(this,e)}catch(t){j.__wbindgen_exn_store(ge(t))}}class nn{static __wrap(e){const t=Object.create(nn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();j.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=j.__wbindgen_add_to_stack_pointer(-16),l=na(e,j.__wbindgen_malloc),s=ot;j.jsroutesnapper_new(o,l,s);var t=be()[o/4+0],r=be()[o/4+1],i=be()[o/4+2];if(i)throw On(r);return nn.__wrap(t)}finally{j.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){j.jsroutesnapper_setConfig(this.ptr,ge(e))}toFinalFeature(){try{const r=j.__wbindgen_add_to_stack_pointer(-16);j.jsroutesnapper_toFinalFeature(r,this.ptr);var e=be()[r/4+0],t=be()[r/4+1];let i;return e!==0&&(i=_t(e,t).slice(),j.__wbindgen_free(e,t*1)),i}finally{j.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const r=j.__wbindgen_add_to_stack_pointer(-16);j.jsroutesnapper_renderGeojson(r,this.ptr);var e=be()[r/4+0],t=be()[r/4+1];return _t(e,t)}finally{j.__wbindgen_add_to_stack_pointer(16),j.__wbindgen_free(e,t)}}setSnapMode(e){j.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,r){return j.jsroutesnapper_onMouseMove(this.ptr,e,t,r)!==0}onClick(){j.jsroutesnapper_onClick(this.ptr)}onDragStart(){return j.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return j.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){j.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=j.__wbindgen_add_to_stack_pointer(-16);j.jsroutesnapper_editExisting(i,this.ptr,ge(e));var t=be()[i/4+0],r=be()[i/4+1];if(r)throw On(t)}finally{j.__wbindgen_add_to_stack_pointer(16)}}}async function ra(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function ia(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,t){const r=_t(e,t);return ge(r)},n.wbg.__wbindgen_object_drop_ref=function(e){On(e)},n.wbg.__wbindgen_boolean_get=function(e){const t=K(e);return typeof t=="boolean"?t?1:0:2},n.wbg.__wbindgen_error_new=function(e,t){const r=new Error(_t(e,t));return ge(r)},n.wbg.__wbindgen_is_object=function(e){const t=K(e);return typeof t=="object"&&t!==null},n.wbg.__wbindgen_is_undefined=function(e){return K(e)===void 0},n.wbg.__wbindgen_in=function(e,t){return K(e)in K(t)},n.wbg.__wbindgen_number_get=function(e,t){const r=K(t),i=typeof r=="number"?r:void 0;ea()[e/8+1]=mn(i)?0:i,be()[e/4+0]=!mn(i)},n.wbg.__wbindgen_jsval_loose_eq=function(e,t){return K(e)==K(t)},n.wbg.__wbindgen_string_get=function(e,t){const r=K(t),i=typeof r=="string"?r:void 0;var o=mn(i)?0:Xt(i,j.__wbindgen_malloc,j.__wbindgen_realloc),l=ot;be()[e/4+1]=l,be()[e/4+0]=o},n.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const r=String(K(t)),i=Xt(r,j.__wbindgen_malloc,j.__wbindgen_realloc),o=ot;be()[e/4+1]=o,be()[e/4+0]=i},n.wbg.__wbindgen_object_clone_ref=function(e){const t=K(e);return ge(t)},n.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const r=K(e)[K(t)];return ge(r)},n.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(K(e))},n.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const r=K(e)[t>>>0];return ge(r)},n.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return K(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof K(e)=="function"},n.wbg.__wbg_next_579e583d33566a86=function(e){const t=K(e).next;return ge(t)},n.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return gn(function(e){const t=K(e).next();return ge(t)},arguments)},n.wbg.__wbg_done_1b73b0672e15f234=function(e){return K(e).done},n.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=K(e).value;return ge(t)},n.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ge(Symbol.iterator)},n.wbg.__wbg_get_765201544a2b6869=function(){return gn(function(e,t){const r=Reflect.get(K(e),K(t));return ge(r)},arguments)},n.wbg.__wbg_call_97ae9d8645dc388b=function(){return gn(function(e,t){const r=K(e).call(K(t));return ge(r)},arguments)},n.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(K(e))},n.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=K(e)instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=K(e).buffer;return ge(t)},n.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(K(e));return ge(t)},n.wbg.__wbg_set_83db9690f9353e79=function(e,t,r){K(e).set(K(t),r>>>0)},n.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return K(e).length},n.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=K(e)instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=K(t).stack,i=Xt(r,j.__wbindgen_malloc,j.__wbindgen_realloc),o=ot;be()[e/4+1]=o,be()[e/4+0]=i},n.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(_t(e,t))}finally{j.__wbindgen_free(e,t)}},n.wbg.__wbindgen_debug_string=function(e,t){const r=Nn(K(t)),i=Xt(r,j.__wbindgen_malloc,j.__wbindgen_realloc),o=ot;be()[e/4+1]=o,be()[e/4+0]=i},n.wbg.__wbindgen_throw=function(e,t){throw new Error(_t(e,t))},n.wbg.__wbindgen_memory=function(){const e=j.memory;return ge(e)},n}function oa(n,e){return j=n.exports,Ii.__wbindgen_wasm_module=e,jt=new Float64Array,Vt=new Int32Array,Wt=new Uint8Array,j}async function Ii(n){typeof n>"u"&&(n="/atip/assets/route_snapper_bg.wasm");const e=ia();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await ra(await n,e);return oa(t,r)}var zt,Fn,je,et;class la{constructor(e,t,r){ft(this,zt);ft(this,je);this.controlDiv=r,this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new nn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),console.log("JsRouteSnapper ready, waiting for idle event"),this.active=!1,this.loaded=!1,this.map.once("idle",()=>{console.log("JsRouteSnapper now usable"),this.map.addSource("route-snapper",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"route-points",type:"circle",source:"route-snapper",paint:{"circle-radius":["match",["get","type"],"unimportant",10/2,10],"circle-color":["match",["get","type"],"hovered","green","important","red","black"]},filter:["in","$type","Point"]}),this.map.addLayer({id:"route-lines",type:"line",source:"route-snapper",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":2.5},filter:["in","$type","LineString"]}),this.loaded=!0,this.map.on("mousemove",l=>{if(!this.active)return;const s={x:l.point.x-30,y:l.point.y},u=this.map.unproject(l.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(l.lngLat.lng,l.lngLat.lat,u)&&de(this,je,et).call(this)}),this.map.on("click",()=>{this.active&&(this.inner.onClick(),de(this,je,et).call(this))}),this.map.on("dragstart",l=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}),this.map.on("mouseup",l=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}),document.addEventListener("keypress",l=>{this.active&&l.key=="Enter"&&(l.preventDefault(),de(this,zt,Fn).call(this))}),document.addEventListener("keydown",l=>{this.active&&l.key=="Shift"&&(l.preventDefault(),this.inner.setSnapMode(!1),de(this,je,et).call(this))}),document.addEventListener("keyup",l=>{this.active&&l.key=="Shift"&&(l.preventDefault(),this.inner.setSnapMode(!0),de(this,je,et).call(this))}),this.stop()})}isActive(){return this.active}tearDown(){this.loaded&&(this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeSource("route-snapper"))}editExisting(e){if(!this.loaded){console.error("editExisting called before the map idle event received. Not starting tool.");return}e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.start(),this.inner.editExisting(e.properties.waypoints),de(this,je,et).call(this)}stop(){if(!this.loaded)return;this.active=!1,this.inner.clearState(),de(this,je,et).call(this),this.controlDiv.innerHTML="";let e=document.createElement("button");e.innerText="Route tool",e.type="button",e.onclick=()=>{this.controlDiv.dispatchEvent(new CustomEvent("activate")),this.start()},this.controlDiv.appendChild(e)}start(){if(this.active)return;this.active=!0;let e=document.createElement("button");e.type="button",e.innerText="Finish route",e.onclick=()=>{de(this,zt,Fn).call(this)};let t=document.createElement("button");t.type="button",t.innerText="Cancel",t.onclick=()=>{this.controlDiv.dispatchEvent(new CustomEvent("no-new-route")),this.stop()},this.controlDiv.innerHTML="";let r=document.createElement("div");r.style="display: flex; justify-content: space-evenly;",r.appendChild(e),r.appendChild(t),this.controlDiv.appendChild(r);let i=document.createElement("input");i.type="checkbox",i.id="avoidDoublingBack",i.onclick=()=>{this.inner.setConfig({avoid_doubling_back:i.checked}),de(this,je,et).call(this)};let o=document.createElement("label");o.innerText="Avoid doubling back",o.for=i.id;let l=document.createElement("div");l.appendChild(i),l.appendChild(o),this.controlDiv.append(l);const s=document.createElement("ul");s.innerHTML="<li><b>Click</b> green points on the transport network</br>to create snapped routes</li><li>Hold <b>Shift</b> to draw a point anywhere</li><li><b>Click and drag</b> any point to move it</li><li><b>Click</b> a red waypoint to delete it</li><li>Press <b>Enter</b> to finish route</li>",this.controlDiv.appendChild(s)}}zt=new WeakSet,Fn=function(){const e=this.inner.toFinalFeature();e?this.controlDiv.dispatchEvent(new CustomEvent("new-route",{detail:JSON.parse(e)})):this.controlDiv.dispatchEvent(new CustomEvent("no-new-route")),this.stop()},je=new WeakSet,et=function(){this.loaded&&this.map.getSource("route-snapper").setData(JSON.parse(this.inner.renderGeojson()))};async function sa(n,e){const t=await fetch(n),r=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,l=[];for(;;){const{done:a,value:d}=await r.read();if(a)break;l.push(d),o+=d.length;const g=100*o/i;e.style=`background: linear-gradient(to right, red ${g}%, transparent 0);`}let s=new Uint8Array(o),u=0;for(let a of l)s.set(a,u),u+=a.length;return s}function aa(n){let e,t;return{c(){e=L("div"),t=L("div"),t.textContent="Route tool loading..."},m(r,i){M(r,e,i),S(e,t),n[8](t),n[9](e)},p:re,i:re,o:re,d(r){r&&P(e),n[8](null),n[9](null)}}}const bn="route";function ua(n,e,t){let r;he(n,Ze,h=>t(10,r=h));let{mode:i}=e,{changeMode:o}=e,{url:l}=e,{snapTool:s}=e,u,{routeSnapper:a}=e;function d(){a.isActive()||a.start()}function g(){a==null||a.stop()}ln(async()=>{await Ii(),console.log(`Grabbing ${l}`);try{const h=await sa(l,u);t(2,a=new la(r,h,s))}catch(h){console.log(`Route tool broke: ${h}`),t(0,s.innerHTML="Failed to load",s)}s.addEventListener("activate",()=>{o(bn)}),s.addEventListener("no-new-route",()=>{i==bn&&o("edit-attribute")}),s.addEventListener("new-route",h=>{if(i==bn){const b=h.detail;ue.update(y=>(b.id=sn(y),b.properties.intervention_type="route",y.features.push(b),y)),o("edit-attribute"),Te.set(b.id)}})}),qn(()=>{a==null||a.tearDown()});function c(h){fe[h?"unshift":"push"](()=>{u=h,t(1,u)})}function f(h){fe[h?"unshift":"push"](()=>{s=h,t(0,s)})}return n.$$set=h=>{"mode"in h&&t(3,i=h.mode),"changeMode"in h&&t(4,o=h.changeMode),"url"in h&&t(5,l=h.url),"snapTool"in h&&t(0,s=h.snapTool),"routeSnapper"in h&&t(2,a=h.routeSnapper)},[s,u,a,i,o,l,d,g,c,f]}class fa extends oe{constructor(e){super(),le(this,e,ua,aa,se,{mode:3,changeMode:4,url:5,snapTool:0,routeSnapper:2,start:6,stop:7})}get start(){return this.$$.ctx[6]}get stop(){return this.$$.ctx[7]}}function ui(n){let e;return{c(){e=L("p"),e.textContent="Click to add a new point"},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function ca(n){let e,t=n[0]==In&&ui();return{c(){t&&t.c(),e=ut()},m(r,i){t&&t.m(r,i),M(r,e,i)},p(r,[i]){r[0]==In?t||(t=ui(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:re,o:re,d(r){t&&t.d(r),r&&P(e)}}}const In="point";function da(n,e,t){let{mode:r}=e,{changeMode:i}=e,{pointTool:o}=e;function l(){o.start()}function s(){o.stop()}return o.addEventListener(u=>{r==In&&(ue.update(a=>(u.id=sn(a),u.properties.intervention_type="other",a.features.push(u),a)),i("edit-attribute"),Te.set(u.id))}),n.$$set=u=>{"mode"in u&&t(0,r=u.mode),"changeMode"in u&&t(1,i=u.changeMode),"pointTool"in u&&t(2,o=u.pointTool)},[r,i,o,l,s]}class ha extends oe{constructor(e){super(),le(this,e,da,ca,se,{mode:0,changeMode:1,pointTool:2,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function fi(n){let e;return{c(){e=L("p"),e.innerHTML="Click the map to add a vertex, or click a vertex to delete it. Press <strong>Enter</strong> to finish. Drag a vertex or the polygon to move."},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function pa(n){let e,t=n[0]==Bn&&fi();return{c(){t&&t.c(),e=ut()},m(r,i){t&&t.m(r,i),M(r,e,i)},p(r,[i]){r[0]==Bn?t||(t=fi(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:re,o:re,d(r){t&&t.d(r),r&&P(e)}}}const Bn="polygon";function ma(n,e,t){let{mode:r}=e,{changeMode:i}=e,{polygonTool:o}=e;function l(){o.startNew()}function s(){o.stop()}return o.addEventListener(u=>{r==Bn&&(ue.update(a=>(u.id=sn(a),u.properties.intervention_type="area",a.features.push(u),a)),i("edit-attribute"),Te.set(u.id))}),n.$$set=u=>{"mode"in u&&t(0,r=u.mode),"changeMode"in u&&t(1,i=u.changeMode),"polygonTool"in u&&t(2,o=u.polygonTool)},[r,i,o,l,s]}class ga extends oe{constructor(e){super(),le(this,e,ma,pa,se,{mode:0,changeMode:1,polygonTool:2,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ba(n){var e=n[0],t=n[1],r=n[2],i=n[3],o=rt(n.slice(0,2),[r,t]),l=rt(n.slice(0,2),[e,i]);if(o>=l){var s=(t+i)/2;return[e,s-(r-e)/2,r,s+(r-e)/2]}else{var u=(e+r)/2;return[u-(i-t)/2,t,u+(i-t)/2,i]}}function va(n,e){e===void 0&&(e={});var t=e.precision,r=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,r=r==null||isNaN(r)?3:r,!n)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof r!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(n=JSON.parse(JSON.stringify(n)));var o=Math.pow(10,t);return ht(n,function(l){_a(l,o,r)}),n}function _a(n,e,t){n.length>t&&n.splice(t,n.length);for(var r=0;r<n.length;r++)n[r]=Math.round(n[r]*e)/e;return n}function ya(n,e){if(!n)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=xn(n),r=xn(e);if(t!=="LineString")throw new Error("line must be LineString");if(r==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(r==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=va(e,{precision:7});switch(r){case"Point":return zn(n,i);case"MultiPoint":return ci(n,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return ci(n,Ai(n,i))}}function ci(n,e){var t=[],r=St();return pt(e,function(i){if(t.forEach(function(s,u){s.id=u}),!t.length)t=zn(n,i).features,t.forEach(function(s){s.bbox||(s.bbox=ba(tn(s)))}),r.load(Fe(t));else{var o=r.search(i);if(o.features.length){var l=Bi(i,o);t=t.filter(function(s){return s.id!==l.id}),r.remove(l),kt(zn(l,i),function(s){t.push(s),r.insert(s)})}}}),Fe(t)}function zn(n,e){var t=[],r=Ve(n)[0],i=Ve(n)[n.geometry.coordinates.length-1];if(vn(r,lt(e))||vn(i,lt(e)))return Fe([n]);var o=St(),l=Ln(n);o.load(l);var s=o.search(e);if(!s.features.length)return Fe([n]);var u=Bi(e,s),a=[r],d=Ei(l,function(g,c,f){var h=Ve(c)[1],b=lt(e);return f===u.id?(g.push(b),t.push(ke(g)),vn(b,h)?[b]:[b,h]):(g.push(h),g)},a);return d.length>1&&t.push(ke(d)),Fe(t)}function Bi(n,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,r=1/0;return kt(e,function(i){var o=Nt(i,n),l=o.properties.dist;l<r&&(t=i,r=l)}),t}function vn(n,e){return n[0]===e[0]&&n[1]===e[1]}function wa(n,e,t){var r=Ve(t);if(xn(t)!=="LineString")throw new Error("line must be a LineString");var i=Nt(t,n),o=Nt(t,e),l;i.properties.index<=o.properties.index?l=[i,o]:l=[o,i];for(var s=[l[0].geometry.coordinates],u=l[0].properties.index+1;u<l[1].properties.index+1;u++)s.push(r[u]);return s.push(l[1].geometry.coordinates),ke(s,t.properties)}function di(n){let e;return{c(){e=L("p"),e.textContent="Click near a route to split it, or click on the map to cancel"},m(t,r){M(t,e,r)},d(t){t&&P(e)}}}function ka(n){let e,t=n[0]==rn&&di();return{c(){t&&t.c(),e=ut()},m(r,i){t&&t.m(r,i),M(r,e,i)},p(r,[i]){r[0]==rn?t||(t=di(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:re,o:re,d(r){t&&t.d(r),r&&P(e)}}}const rn="split-route",Sa=10,Ea=30;let _n="split-route";function zi(){}function hi(n,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:n}}}function Ma(n,e,t){let r,i;he(n,Ze,c=>t(5,r=c)),he(n,ue,c=>t(7,i=c));let{mode:o}=e,{changeMode:l}=e;function s(){t(4,u=null),a=null}let u=null,a=null;r.on("mousemove",c=>{if(o!=rn)return;t(4,u=hi(c.lngLat.toArray(),!1)),a=null;const f={x:c.point.x-Ea,y:c.point.y},h=r.unproject(c.point).distanceTo(r.unproject(f))/1e3;let b=[];for(let[y,O]of i.features.entries())if(O.geometry.type=="LineString"){let m=Nt(O.geometry,u,{units:"kilometers"});m.properties.dist<=h&&b.push([y,m.geometry.coordinates,m.properties.dist])}b.sort((y,O)=>y[2]-O[2]),b.length>0&&(t(4,u=hi(b[0][1],!0)),a=b[0][0])}),r.on("click",c=>{if(o==rn)if(a==null)l("edit-attribute");else{let f=ya(i.features[a],u);if(f.features.length==2){let h=f.features[0],b=f.features[1];ue.update(y=>(h.id=y.features[a].id,b.id=sn(y),h.properties=JSON.parse(JSON.stringify(y.features[a].properties)),b.properties=JSON.parse(JSON.stringify(h.properties)),d(y.features[a],h,b,u),y.features.splice(a,1,h,b),y))}s()}}),Et(r,_n,{type:"geojson",data:$e()}),Le(r,{id:"draw-split-route",source:_n,...Gt("black",Sa,["case",["==",["get","snapped"],!0],1,.5])});function d(c,f,h,b){f.properties.length_meters=Ut(f.geometry,{units:"kilometers"})*1e3,h.properties.length_meters=Ut(h.geometry,{units:"kilometers"})*1e3,f.properties.waypoints=[],h.properties.waypoints=[];let y=g(c,b),O=!0,m=0;for(let p of c.properties.waypoints){let v=g(c,we([p.lon,p.lat]));if(O)if(v<y)f.properties.waypoints.push(p);else{let k=p.snapped&&c.properties.waypoints[m-1].snapped;f.properties.waypoints.push({lon:b.geometry.coordinates[0],lat:b.geometry.coordinates[1],snapped:k}),O=!1,h.properties.waypoints.push({lon:b.geometry.coordinates[0],lat:b.geometry.coordinates[1],snapped:k}),h.properties.waypoints.push(p)}else h.properties.waypoints.push(p);m++}}function g(c,f){let h=c.geometry.coordinates[0],b=wa(h,f,c);return Ut(b.geometry,{units:"kilometers"})*1e3}return n.$$set=c=>{"mode"in c&&t(0,o=c.mode),"changeMode"in c&&t(1,l=c.changeMode)},n.$$.update=()=>{if(n.$$.dirty&48){let c=$e();u&&c.features.push(u),r.getSource(_n).setData(c)}},[o,l,zi,s,u,r]}class Pa extends oe{constructor(e){super(),le(this,e,Ma,ka,se,{mode:0,changeMode:1,start:2,stop:3})}get start(){return zi}get stop(){return this.$$.ctx[3]}}function pi(n){let e,t,r={mode:n[3],routeSnapper:n[1],snapTool:n[2],pointTool:n[10],polygonTool:n[11]};return e=new Ks({props:r}),n[16](e),{c(){V(e.$$.fragment)},m(i,o){H(e,i,o),t=!0},p(i,o){const l={};o&8&&(l.mode=i[3]),o&2&&(l.routeSnapper=i[1]),o&4&&(l.snapTool=i[2]),e.$set(l)},i(i){t||(I(e.$$.fragment,i),t=!0)},o(i){D(e.$$.fragment,i),t=!1},d(i){n[16](null),Z(e,i)}}}function xa(n){let e,t,r,i,o,l,s,u,a,d,g,c,f,h,b,y,O,m,p,v,k,_,A,x,F,q,E,B,N,C,G,J,te,$,ee,ae,ie,w,U,ze,Mt,qt,cn={mode:n[3],changeMode:n[12]};s=new Hs({props:cn}),n[14](s);let me=n[1]&&n[2]&&pi(n),Y={mode:n[3],changeMode:n[12],pointTool:n[10]};v=new ha({props:Y}),n[18](v);let Gi={mode:n[3],changeMode:n[12],polygonTool:n[11]};E=new ga({props:Gi}),n[20](E);function qi(Q){n[22](Q)}function Di(Q){n[23](Q)}let dn={mode:n[3],changeMode:n[12],url:n[0]};n[1]!==void 0&&(dn.routeSnapper=n[1]),n[2]!==void 0&&(dn.snapTool=n[2]),C=new fa({props:dn}),n[21](C),fe.push(()=>De(C,"routeSnapper",qi,n[1])),fe.push(()=>De(C,"snapTool",Di,n[2]));let Yi={mode:n[3],changeMode:n[12]};return U=new Pa({props:Yi}),n[25](U),{c(){e=L("div"),t=L("div"),r=L("button"),i=W("Edit attributes"),l=z(),V(s.$$.fragment),u=z(),a=L("div"),d=L("button"),g=W("Edit geometry"),f=z(),me&&me.c(),h=z(),b=L("div"),y=L("button"),O=W("New point"),p=z(),V(v.$$.fragment),k=z(),_=L("div"),A=L("button"),x=W("New polygon"),q=z(),V(E.$$.fragment),B=z(),N=L("div"),V(C.$$.fragment),te=z(),$=L("div"),ee=L("button"),ae=W("Split route"),w=z(),V(U.$$.fragment),R(r,"type","button"),r.disabled=o=n[3]=="edit-attribute",R(r,"class","svelte-cej5os"),R(d,"type","button"),d.disabled=c=n[3]=="edit-geometry",R(d,"class","svelte-cej5os"),R(y,"type","button"),y.disabled=m=n[3]=="point",R(y,"class","svelte-cej5os"),R(A,"type","button"),A.disabled=F=n[3]=="polygon",R(A,"class","svelte-cej5os"),R(ee,"type","button"),ee.disabled=ie=n[3]=="split-route",R(ee,"class","svelte-cej5os"),R(e,"class","toolbox svelte-cej5os")},m(Q,ve){M(Q,e,ve),S(e,t),S(t,r),S(r,i),S(t,l),H(s,t,null),S(e,u),S(e,a),S(a,d),S(d,g),S(a,f),me&&me.m(a,null),S(e,h),S(e,b),S(b,y),S(y,O),S(b,p),H(v,b,null),S(e,k),S(e,_),S(_,A),S(A,x),S(_,q),H(E,_,null),S(e,B),S(e,N),H(C,N,null),S(e,te),S(e,$),S($,ee),S(ee,ae),S($,w),H(U,$,null),ze=!0,Mt||(qt=[X(r,"click",n[13]),X(d,"click",n[15]),X(y,"click",n[17]),X(A,"click",n[19]),X(ee,"click",n[24])],Mt=!0)},p(Q,[ve]){(!ze||ve&8&&o!==(o=Q[3]=="edit-attribute"))&&(r.disabled=o);const $n={};ve&8&&($n.mode=Q[3]),s.$set($n),(!ze||ve&8&&c!==(c=Q[3]=="edit-geometry"))&&(d.disabled=c),Q[1]&&Q[2]?me?(me.p(Q,ve),ve&6&&I(me,1)):(me=pi(Q),me.c(),I(me,1),me.m(a,null)):me&&(Ee(),D(me,1,1,()=>{me=null}),Me()),(!ze||ve&8&&m!==(m=Q[3]=="point"))&&(y.disabled=m);const er={};ve&8&&(er.mode=Q[3]),v.$set(er),(!ze||ve&8&&F!==(F=Q[3]=="polygon"))&&(A.disabled=F);const tr={};ve&8&&(tr.mode=Q[3]),E.$set(tr);const Pt={};ve&8&&(Pt.mode=Q[3]),ve&1&&(Pt.url=Q[0]),!G&&ve&2&&(G=!0,Pt.routeSnapper=Q[1],Ye(()=>G=!1)),!J&&ve&4&&(J=!0,Pt.snapTool=Q[2],Ye(()=>J=!1)),C.$set(Pt),(!ze||ve&8&&ie!==(ie=Q[3]=="split-route"))&&(ee.disabled=ie);const nr={};ve&8&&(nr.mode=Q[3]),U.$set(nr)},i(Q){ze||(I(s.$$.fragment,Q),I(me),I(v.$$.fragment,Q),I(E.$$.fragment,Q),I(C.$$.fragment,Q),I(U.$$.fragment,Q),ze=!0)},o(Q){D(s.$$.fragment,Q),D(me),D(v.$$.fragment,Q),D(E.$$.fragment,Q),D(C.$$.fragment,Q),D(U.$$.fragment,Q),ze=!1},d(Q){Q&&P(e),n[14](null),Z(s),me&&me.d(),n[18](null),Z(v),n[20](null),Z(E),n[21](null),Z(C),n[25](null),Z(U),Mt=!1,Je(qt)}}}function Ta(n,e,t){let r;he(n,Ze,C=>t(26,r=C));let{routeUrl:i}=e,o,l,s=new Os(r),u=new Ws(r),a="edit-attribute",d,g,c,f,h,b;function y(C){let G={"edit-attribute":d,"edit-geometry":g,route:c,point:f,polygon:h,"split-route":b};if(a==C){console.log(`Mode is already ${a}, not changing`);return}console.log(`Stopping old mode ${a}`),G[a].stop(),t(3,a=C),console.log(`Starting new mode ${a}`),G[a].start()}qn(()=>{s==null||s.tearDown(),u==null||u.tearDown()});const O=()=>y("edit-attribute");function m(C){fe[C?"unshift":"push"](()=>{d=C,t(4,d)})}const p=()=>y("edit-geometry");function v(C){fe[C?"unshift":"push"](()=>{g=C,t(5,g)})}const k=()=>y("point");function _(C){fe[C?"unshift":"push"](()=>{f=C,t(7,f)})}const A=()=>y("polygon");function x(C){fe[C?"unshift":"push"](()=>{h=C,t(8,h)})}function F(C){fe[C?"unshift":"push"](()=>{c=C,t(6,c)})}function q(C){o=C,t(1,o)}function E(C){l=C,t(2,l)}const B=()=>y("split-route");function N(C){fe[C?"unshift":"push"](()=>{b=C,t(9,b)})}return n.$$set=C=>{"routeUrl"in C&&t(0,i=C.routeUrl)},[i,o,l,a,d,g,c,f,h,b,s,u,y,O,m,p,v,k,_,A,x,F,q,E,B,N]}class La extends oe{constructor(e){super(),le(this,e,Ta,xa,se,{routeUrl:0})}}function Ca(n){let e,t,r,i,o,l,s,u;return{c(){e=L("div"),t=L("button"),t.textContent="Home",r=z(),i=L("button"),i.textContent="About",o=z(),l=L("button"),l.textContent="Instructions",R(t,"type","button"),R(t,"onclick","window.open('index.html');"),R(i,"type","button"),R(l,"type","button"),R(e,"slot","nav")},m(a,d){M(a,e,d),S(e,t),S(e,r),S(e,i),S(e,o),S(e,l),s||(u=[X(i,"click",n[6]),X(l,"click",n[7])],s=!0)},p:re,d(a){a&&P(e),s=!1,Je(u)}}}function Ra(n){let e,t,r,i,o,l,s,u,a,d,g,c;return o=new Ss({props:{boundaryGeojson:n[3]}}),s=new _s({props:{authorityName:n[4]}}),g=new ls({}),{c(){e=L("div"),t=L("h1"),r=W(n[4]),i=z(),V(o.$$.fragment),l=z(),V(s.$$.fragment),u=z(),a=L("br"),d=z(),V(g.$$.fragment),R(e,"slot","sidebar")},m(f,h){M(f,e,h),S(e,t),S(t,r),S(t,i),H(o,t,null),S(e,l),H(s,e,null),S(e,u),S(e,a),S(e,d),H(g,e,null),c=!0},p(f,h){const b={};h&8&&(b.boundaryGeojson=f[3]),o.$set(b)},i(f){c||(I(o.$$.fragment,f),I(s.$$.fragment,f),I(g.$$.fragment,f),c=!0)},o(f){D(o.$$.fragment,f),D(s.$$.fragment,f),D(g.$$.fragment,f),c=!1},d(f){f&&P(e),Z(o),Z(s),Z(g)}}}function Aa(n){let e,t,r,i,o,l,s,u,a,d,g,c;return e=new Hl({props:{boundaryGeojson:n[3]}}),r=new Cs({}),o=new As({}),s=new La({props:{routeUrl:n[2]}}),a=new Ps({props:{style:n[5]}}),g=new Ts({}),{c(){V(e.$$.fragment),t=z(),V(r.$$.fragment),i=z(),V(o.$$.fragment),l=z(),V(s.$$.fragment),u=z(),V(a.$$.fragment),d=z(),V(g.$$.fragment)},m(f,h){H(e,f,h),M(f,t,h),H(r,f,h),M(f,i,h),H(o,f,h),M(f,l,h),H(s,f,h),M(f,u,h),H(a,f,h),M(f,d,h),H(g,f,h),c=!0},p(f,h){const b={};h&8&&(b.boundaryGeojson=f[3]),e.$set(b);const y={};h&4&&(y.routeUrl=f[2]),s.$set(y)},i(f){c||(I(e.$$.fragment,f),I(r.$$.fragment,f),I(o.$$.fragment,f),I(s.$$.fragment,f),I(a.$$.fragment,f),I(g.$$.fragment,f),c=!0)},o(f){D(e.$$.fragment,f),D(r.$$.fragment,f),D(o.$$.fragment,f),D(s.$$.fragment,f),D(a.$$.fragment,f),D(g.$$.fragment,f),c=!1},d(f){Z(e,f),f&&P(t),Z(r,f),f&&P(i),Z(o,f),f&&P(l),Z(s,f),f&&P(u),Z(a,f),f&&P(d),Z(g,f)}}}function Oa(n){let e,t,r;return t=new tl({props:{style:n[5],$$slots:{default:[Aa]},$$scope:{ctx:n}}}),{c(){e=L("div"),V(t.$$.fragment),R(e,"slot","main")},m(i,o){M(i,e,o),H(t,e,null),r=!0},p(i,o){const l={};o&8204&&(l.$$scope={dirty:o,ctx:i}),t.$set(l)},i(i){r||(I(t.$$.fragment,i),r=!0)},o(i){D(t.$$.fragment,i),r=!1},d(i){i&&P(e),Z(t)}}}function Na(n){let e,t,r,i,o,l,s,u;e=new sl({props:{$$slots:{main:[Oa],sidebar:[Ra],nav:[Ca]},$$scope:{ctx:n}}});function a(f){n[8](f)}let d={};n[0]!==void 0&&(d.open=n[0]),r=new Ki({props:d}),fe.push(()=>De(r,"open",a,n[0]));function g(f){n[9](f)}let c={};return n[1]!==void 0&&(c.open=n[1]),l=new Zo({props:c}),fe.push(()=>De(l,"open",g,n[1])),{c(){V(e.$$.fragment),t=z(),V(r.$$.fragment),o=z(),V(l.$$.fragment)},m(f,h){H(e,f,h),M(f,t,h),H(r,f,h),M(f,o,h),H(l,f,h),u=!0},p(f,[h]){const b={};h&8204&&(b.$$scope={dirty:h,ctx:f}),e.$set(b);const y={};!i&&h&1&&(i=!0,y.open=f[0],Ye(()=>i=!1)),r.$set(y);const O={};!s&&h&2&&(s=!0,O.open=f[1],Ye(()=>s=!1)),l.$set(O)},i(f){u||(I(e.$$.fragment,f),I(r.$$.fragment,f),I(l.$$.fragment,f),u=!0)},o(f){D(e.$$.fragment,f),D(r.$$.fragment,f),D(l.$$.fragment,f),u=!1},d(f){Z(e,f),f&&P(t),Z(r,f),f&&P(o),Z(l,f)}}}function Fa(n,e,t){let r=!1,i=!1,o=window.location.hostname.includes("atip.uk");const l=new URLSearchParams(window.location.search);let s=l.get("authority"),u=l.get("style")||"streets";var a=`https://atip.uk/route-snappers/${s}.bin`;o||(a=`https://atip.uk/route-snappers-dev/${s}.bin`);function d(){t(0,r=!r),t(1,i=!1)}function g(){t(1,i=!i),t(0,r=!1)}let c;ln(async()=>{t(3,c=await f())});async function f(){const O=await(await fetch($i)).text(),m=JSON.parse(O);return m.features=m.features.filter(p=>p.properties.name==s),m}function h(y){r=y,t(0,r)}function b(y){i=y,t(1,i)}return[r,i,a,c,s,u,d,g,h,b]}class Ia extends oe{constructor(e){super(),le(this,e,Fa,Na,se,{})}}new Ia({target:document.getElementById("app")});
