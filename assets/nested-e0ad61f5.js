var li=Object.defineProperty;var ai=(r,e,t)=>e in r?li(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ye=(r,e,t)=>(ai(r,typeof e!="symbol"?e+"":e,t),t),ui=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var nt=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)};var H=(r,e,t)=>(ui(r,e,"access private method"),t);import{S as ne,i as re,s as K,M as fi,b as ae,a as He,d as V,m as Q,k as Ve,n as Y,o as z,q as Z,e as w,c as N,g as E,x as U,p as k,f as A,y as tn,z as nn,B as ci,C as Tn,D as an,E as In,F as St,G as Et,H as kt,I as xt,J as er,h as b,l as J,K as te,L as hi,w as Bn,t as j,N as Te,j as ct,r as vt,O as Dn,P as tr,Q as Ke,R as nr,T as Gr,U as rr,V as pi,W as di,X as gi,Y as ir,Z as vi,_ as mi,$ as Gn,A as yi,u as _i}from"./authorities-9df6d6c4.js";function bi(r){let e,t,n,i,o,s,a,l,u,c,v,p,f;return{c(){e=w("p"),e.textContent="For each intervention:",t=N(),n=w("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=N(),o=w("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=N(),a=w("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=N(),u=w("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,c=N(),v=w("p"),v.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,p=N(),f=w("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(d,m){E(d,e,m),E(d,t,m),E(d,n,m),E(d,i,m),E(d,o,m),E(d,s,m),E(d,a,m),E(d,l,m),E(d,u,m),E(d,c,m),E(d,v,m),E(d,p,m),E(d,f,m)},p:U,d(d){d&&k(e),d&&k(t),d&&k(n),d&&k(i),d&&k(o),d&&k(s),d&&k(a),d&&k(l),d&&k(u),d&&k(c),d&&k(v),d&&k(p),d&&k(f)}}}function wi(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[bi]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new fi({props:o}),ae.push(()=>He(e,"open",i,r[0])),{c(){V(e.$$.fragment)},m(s,a){Q(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Ve(()=>t=!1)),e.$set(l)},i(s){n||(Y(e.$$.fragment,s),n=!0)},o(s){z(e.$$.fragment,s),n=!1},d(s){Z(e,s)}}}function Si(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Ei extends ne{constructor(e){super(),re(this,e,Si,wi,K,{open:0})}}const st=[];function mt(r,e=U){let t;const n=new Set;function i(a){if(K(r,a)&&(r=a,t)){const l=!st.length;for(const u of n)u[1](),st.push(u,r);if(l){for(let u=0;u<st.length;u+=2)st[u][0](st[u+1]);st.length=0}}}function o(a){i(a(r))}function s(a,l=U){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||U),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const ki={"line-cap":"round","line-join":"round"},qn=["==","$type","Polygon"],Yn=["==","$type","LineString"],Xn=["==","$type","Point"];function $t(r,e,t=1){return{type:"line",layout:ki,paint:{"line-color":r,"line-width":e,"line-opacity":t}}}function zn(r,e){return{type:"fill",paint:{"fill-color":r,"fill-opacity":e}}}function It(r,e,t=1){return{type:"circle",paint:{"circle-radius":e,"circle-color":r,"circle-opacity":t}}}function yt(r,e,t){if(r.getSource(e)){let n=[];for(let i of r.getStyle().layers)i.source==e&&n.push(i.id);for(let i of n)r.removeLayer(i);r.removeSource(e)}r.addSource(e,t)}function we(r,e,t=null){r.getLayer(e.id)&&r.removeLayer(e.id),t&&!r.getLayer(t)&&(t=null),r.addLayer(e,t)}function Xe(){return{type:"FeatureCollection",features:[]}}const Be=mt(null),W=mt(Xe()),xe=mt(null),Ye=mt(null),jt=mt(null),gn=mt(null);function rn(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function qr(r){W.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),xe.set(null),Ye.set(null),jt.set(null)}function or(r){let e;const t=r[4].default,n=St(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Et(n,t,i,i[3],e?xt(t,i[3],o,null):kt(i[3]),null)},i(i){e||(Y(n,i),e=!0)},o(i){z(n,i),e=!1},d(i){n&&n.d(i)}}}function xi(r){let e,t,n=r[1]&&or(r);return{c(){e=w("div"),n&&n.c(),A(e,"class","map svelte-12dpf1u")},m(i,o){E(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&Y(n,1)):(n=or(i),n.c(),Y(n,1),n.m(e,null)):n&&(tn(),z(n,1,1,()=>{n=null}),nn())},i(i){t||(Y(n),t=!0)},o(i){z(n),t=!1},d(i){i&&k(e),n&&n.d(),r[5](null)}}}function Mi(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;ci("setCamera",!window.location.hash),Tn(()=>{s=new an.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new an.ScaleControl({})),s.addControl(new an.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Be.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),In(()=>{s.remove()});function u(c){ae[c?"unshift":"push"](()=>{a=c,t(0,a)})}return r.$$set=c=>{"style"in c&&t(2,o=c.style),"$$scope"in c&&t(3,i=c.$$scope)},[a,l,o,i,n,u]}class Pi extends ne{constructor(e){super(),re(this,e,Mi,xi,K,{style:2})}}const Li=r=>({}),sr=r=>({}),Ri=r=>({}),lr=r=>({}),Oi=r=>({}),ar=r=>({});function Ai(r){let e,t,n,i,o,s,a,l,u,c,v,p;const f=r[3].nav,d=St(f,r,r[2],ar),m=r[3].sidebar,_=St(m,r,r[2],lr),R=r[3].main,h=St(R,r,r[2],sr);return{c(){e=w("aside"),t=w("div"),n=w("nav"),d&&d.c(),i=N(),_&&_.c(),o=N(),s=w("button"),s.textContent="→",l=N(),u=w("main"),h&&h.c(),A(n,"class","svelte-1u7vg8a"),A(t,"class","sidebar-content content-container svelte-1u7vg8a"),A(s,"type","button"),A(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),A(e,"class",a=er(r[0]?"":"collapsed")+" svelte-1u7vg8a"),A(u,"class","svelte-1u7vg8a")},m(g,y){E(g,e,y),b(e,t),b(t,n),d&&d.m(n,null),b(t,i),_&&_.m(t,null),b(e,o),b(e,s),E(g,l,y),E(g,u,y),h&&h.m(u,null),c=!0,v||(p=J(s,"click",r[1]),v=!0)},p(g,[y]){d&&d.p&&(!c||y&4)&&Et(d,f,g,g[2],c?xt(f,g[2],y,Oi):kt(g[2]),ar),_&&_.p&&(!c||y&4)&&Et(_,m,g,g[2],c?xt(m,g[2],y,Ri):kt(g[2]),lr),(!c||y&1&&a!==(a=er(g[0]?"":"collapsed")+" svelte-1u7vg8a"))&&A(e,"class",a),h&&h.p&&(!c||y&4)&&Et(h,R,g,g[2],c?xt(R,g[2],y,Li):kt(g[2]),sr)},i(g){c||(Y(d,g),Y(_,g),Y(h,g),c=!0)},o(g){z(d,g),z(_,g),z(h,g),c=!1},d(g){g&&k(e),d&&d.d(g),_&&_.d(g),g&&k(l),g&&k(u),h&&h.d(g),v=!1,p()}}}function Ci(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class Ni extends ne{constructor(e){super(),re(this,e,Ci,Ai,K,{})}}var ce=63710088e-1,Jn={centimeters:ce*100,centimetres:ce*100,degrees:ce/111325,feet:ce*3.28084,inches:ce*39.37,kilometers:ce/1e3,kilometres:ce/1e3,meters:ce,metres:ce,miles:ce/1609.344,millimeters:ce*1e3,millimetres:ce*1e3,nauticalmiles:ce/1852,radians:1,yards:ce*1.0936},Fi={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ce,yards:1.0936133},vn={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Pe(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Ti(r,e,t){switch(r){case"Point":return pe(e).geometry;case"LineString":return de(e).geometry;case"Polygon":return on(e).geometry;case"MultiPoint":return Xr(e).geometry;case"MultiLineString":return Yr(e).geometry;case"MultiPolygon":return Un(e).geometry;default:throw new Error(r+" is invalid")}}function pe(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Wt(r[0])||!Wt(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Pe(n,e,t)}function Ii(r,e,t){return t===void 0&&(t={}),Me(r.map(function(n){return pe(n,e)}),t)}function on(r,e,t){t===void 0&&(t={});for(var n=0,i=r;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:r};return Pe(a,e,t)}function Bi(r,e,t){return t===void 0&&(t={}),Me(r.map(function(n){return on(n,e)}),t)}function de(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Pe(n,e,t)}function Di(r,e,t){return t===void 0&&(t={}),Me(r.map(function(n){return de(n,e)}),t)}function Me(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Yr(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return Pe(n,e,t)}function Xr(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return Pe(n,e,t)}function Un(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return Pe(n,e,t)}function Gi(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return Pe(n,e,t)}function qi(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function $n(r,e){e===void 0&&(e="kilometers");var t=Jn[e];if(!t)throw new Error(e+" units is invalid");return r*t}function sn(r,e){e===void 0&&(e="kilometers");var t=Jn[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Yi(r,e){return Rt(sn(r,e))}function Xi(r){var e=r%360;return e<0&&(e+=360),e}function Rt(r){var e=r%(2*Math.PI);return e*180/Math.PI}function ke(r){var e=r%360;return e*Math.PI/180}function zi(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return $n(sn(r,e),t)}function Ji(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=vn[e];if(!n)throw new Error("invalid original units");var i=vn[t];if(!i)throw new Error("invalid final units");return r/n*i}function Wt(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function jn(r){return!!r&&r.constructor===Object}function Ui(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!Wt(e))throw new Error("bbox must only contain numbers")})}function $i(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const ji=Object.freeze(Object.defineProperty({__proto__:null,earthRadius:ce,factors:Jn,unitsFactors:Fi,areaFactors:vn,feature:Pe,geometry:Ti,point:pe,points:Ii,polygon:on,polygons:Bi,lineString:de,lineStrings:Di,featureCollection:Me,multiLineString:Yr,multiPoint:Xr,multiPolygon:Un,geometryCollection:Gi,round:qi,radiansToLength:$n,lengthToRadians:sn,lengthToDegrees:Yi,bearingToAzimuth:Xi,radiansToDegrees:Rt,degreesToRadians:ke,convertLength:zi,convertArea:Ji,isNumber:Wt,isObject:jn,validateBBox:Ui,validateId:$i},Symbol.toStringTag,{value:"Module"}));/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Wi(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(c){u=[6,c],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ze=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Hi(r,e){return r>e?1:r<e?-1:0}function Ue(r,e,t){for(var n=new Ze(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function un(r,e,t,n){var i=new Ze(r,e);if(t===null)return i.left=i.right=null,i;t=Ue(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function ur(r,e,t){var n=null,i=null;if(e){e=Ue(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Vi(r,e,t){return e===null?r:(r===null||(e=Ue(r.key,e,t),e.left=r),e)}function mn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&mn(r.left,o,!1,n,i),r.right&&mn(r.right,o,!0,n,i)}}var Wn=function(){function r(e){e===void 0&&(e=Hi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=un(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ze(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ue(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ue(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ue(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ue(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ue(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Zi(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&bn(e,t,0,i-1,o),this._root===null)this._root=yn(e,t,0,i),this._size=i;else{var s=Ki(this.toList(),Qi(e,t),o);i=this._size+i,this._root=_n({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return mn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=ur(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=un(t,n,a,i):s=un(t,n,s,i),this._root=Vi(s,a,i)},r.prototype.split=function(e){return ur(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Wi(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function yn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ze(s,a);return l.left=yn(r,e,t,o),l.right=yn(r,e,o+1,n),l}return null}function Qi(r,e){for(var t=new Ze(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ze(r[i],e[i]);return n.next=null,t.next}function Zi(r){for(var e=r,t=[],n=!1,i=new Ze(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function _n(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=_n(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=_n(r,i+1,t),s}return null}function Ki(r,e,t){for(var n=new Ze(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function bn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}bn(r,e,t,a,i),bn(r,e,a+1,n,i)}}function Le(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function fr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function ge(r,e,t){return e&&fr(r.prototype,e),t&&fr(r,t),r}var wt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},wn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},je=Number.EPSILON;je===void 0&&(je=Math.pow(2,-52));var eo=je*je,Sn=function(e,t){if(-je<e&&e<je&&-je<t&&t<je)return 0;var n=e-t;return n*n<eo*e*t?0:e<t?-1:1},to=function(){function r(){Le(this,r),this.reset()}return ge(r,[{key:"reset",value:function(){this.xRounder=new cr,this.yRounder=new cr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),cr=function(){function r(){Le(this,r),this.tree=new Wn,this.round(0)}return ge(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Sn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Sn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Ot=new to,Mt=function(e,t){return e.x*t.y-e.y*t.x},zr=function(e,t){return e.x*t.x+e.y*t.y},hr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Mt(i,o);return Sn(s,0)},Ht=function(e){return Math.sqrt(zr(e,e))},no=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Mt(o,i)/Ht(o)/Ht(i)},ro=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return zr(o,i)/Ht(o)/Ht(i)},pr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},dr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},io=function(e,t,n,i){if(t.x===0)return dr(n,i,e.x);if(i.x===0)return dr(e,t,n.x);if(t.y===0)return pr(n,i,e.y);if(i.y===0)return pr(e,t,n.y);var o=Mt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=Mt(s,t)/o,l=Mt(s,i)/o,u=e.x+l*t.x,c=n.x+a*i.x,v=e.y+l*t.y,p=n.y+a*i.y,f=(u+c)/2,d=(v+p)/2;return{x:f,y:d}},Ne=function(){ge(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Vt.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Le(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return ge(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:no(n.point,t.point,l.point),cosine:ro(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,c=l.cosine,v=i.get(a),p=v.sine,f=v.cosine;return u>=0&&p>=0?c<f?1:c>f?-1:0:u<0&&p<0?c<f?-1:c>f?1:0:p<u?-1:p>u?1:0}}}]),r}(),oo=0,Vt=function(){ge(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,c=t.rightSE.point.y,v=n.rightSE.point.y;if(i<o){if(u<l&&u<c)return 1;if(u>l&&u>c)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<v)return-1;if(l>u&&l>v)return 1;var d=n.comparePoint(t.leftSE.point);if(d!==0)return d;var m=t.comparePoint(n.rightSE.point);return m<0?1:m>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>a){var R=t.comparePoint(n.rightSE.point);if(R<0)return 1;if(R>0)return-1}if(s!==a){var h=c-l,g=s-i,y=v-u,S=a-o;if(h>g&&y<S)return 1;if(h<g&&y>S)return-1}return s>a?1:s<a||c<v?-1:c>v?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Le(this,r),this.id=++oo,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return ge(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=wn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,c=wt(n,l)&&this.comparePoint(l)===0,v=wt(i,s)&&t.comparePoint(s)===0,p=wt(n,u)&&this.comparePoint(u)===0,f=wt(i,a)&&t.comparePoint(a)===0;if(v&&c)return f&&!p?a:!f&&p?u:null;if(v)return p&&s.x===u.x&&s.y===u.y?null:s;if(c)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&p)return null;if(f)return a;if(p)return u;var d=io(s,this.vector(),l,t.vector());return d===null||!wt(o,d)?null:Ot.round(d.x,d.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Ne(t,!0),s=new Ne(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Ne.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ne.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var c=i.rings[l],v=i.windings[l],p=n.rings.indexOf(c);p===-1?(n.rings.push(c),n.windings.push(v)):n.windings[p]+=v}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],c=n.indexOf(l);c===-1?(n.push(l),i.push(u)):i[c]+=u}for(var v=[],p=[],f=0,d=n.length;f<d;f++)if(i[f]!==0){var m=n[f],_=m.poly;if(p.indexOf(_)===-1)if(m.isExterior)v.push(_);else{p.indexOf(_)===-1&&p.push(_);var R=v.indexOf(m.poly);R!==-1&&v.splice(R,1)}}for(var h=0,g=v.length;h<g;h++){var y=v[h].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ae.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Ae.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(v){return v.length===1&&v[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ae.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Ne.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Ne(o,!0),c=new Ne(s,!1);return new r(u,c,[i],[a])}}]),r}(),gr=function(){function r(e,t,n){if(Le(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Ot.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Ot.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(Vt.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Vt.fromRing(o,i,this))}return ge(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),so=function(){function r(e,t){if(Le(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new gr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new gr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return ge(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),vr=function(){function r(e,t){if(Le(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new so(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return ge(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),lo=function(){ge(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,c=[l],v=l.point,p=[];a=l,l=u,c.push(l),l.point!==v;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var d=c[0].point,m=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(m.x,", ").concat(m.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var _=null,R=0,h=p.length;R<h;R++)if(p[R].point===l.point){_=R;break}if(_!==null){var g=p.splice(_)[0],y=c.splice(g.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}p.push({index:c.length,point:l.point});var S=l.getLeftmostComparator(a);u=f.sort(S)[0].otherSE;break}n.push(new r(c))}}return n}}]);function r(e){Le(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return ge(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;hr(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];hr(l,t,u)===0&&n.shift(),n.push(n[0]);for(var c=this.isExteriorRing()?1:-1,v=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,f=[],d=v;d!=p;d+=c)f.push([n[d].x,n[d].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Ne.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),mr=function(){function r(e){Le(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return ge(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),ao=function(){function r(e){Le(this,r),this.rings=e,this.polys=this._composePolys(e)}return ge(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new mr(s));else{var a=s.enclosingRing();a.poly||n.push(new mr(a)),a.poly.addInterior(s)}}return n}}]),r}(),uo=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vt.compare;Le(this,r),this.queue=e,this.tree=new Wn(t),this.segments=[]}return ge(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var c=null;if(l){var v=l.getIntersection(n);if(v!==null&&(n.isAnEndpoint(v)||(c=v),!l.isAnEndpoint(v)))for(var p=this._splitSafely(l,v),f=0,d=p.length;f<d;f++)i.push(p[f])}var m=null;if(u){var _=u.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(m=_),!u.isAnEndpoint(_)))for(var R=this._splitSafely(u,_),h=0,g=R.length;h<g;h++)i.push(R[h])}if(c!==null||m!==null){var y=null;if(c===null)y=m;else if(m===null)y=c;else{var S=Ne.comparePoints(c,m);y=S<=0?c:m}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var L=n.split(y),M=0,x=L.length;M<x;M++)i.push(L[M])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var F=l.getIntersection(u);if(F!==null){if(!l.isAnEndpoint(F))for(var I=this._splitSafely(l,F),T=0,D=I.length;T<D;T++)i.push(I[T]);if(!u.isAnEndpoint(F))for(var C=this._splitSafely(u,F),P=0,$=C.length;P<$;P++)i.push(C[P])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),yr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,fo=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,co=function(){function r(){Le(this,r)}return ge(r,[{key:"run",value:function(t,n,i){Ae.type=t,Ot.reset();for(var o=[new vr(n,!0)],s=0,a=i.length;s<a;s++)o.push(new vr(i[s],!1));if(Ae.numMultiPolys=o.length,Ae.type==="difference")for(var l=o[0],u=1;u<o.length;)wn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Ae.type==="intersection"){for(var c=0,v=o.length;c<v;c++)for(var p=o[c],f=c+1,d=o.length;f<d;f++)if(wn(p.bbox,o[f].bbox)===null)return[]}for(var m=new Wn(Ne.compare),_=0,R=o.length;_<R;_++)for(var h=o[_].getSweepEvents(),g=0,y=h.length;g<y;g++)if(m.insert(h[g]),m.size>yr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var S=new uo(m),L=m.size,M=m.pop();M;){var x=M.key;if(m.size===L){var F=x.segment;throw new Error("Unable to pop() ".concat(x.isLeft?"left":"right"," SweepEvent ")+"[".concat(x.point.x,", ").concat(x.point.y,"] from segment #").concat(F.id," ")+"[".concat(F.leftSE.point.x,", ").concat(F.leftSE.point.y,"] -> ")+"[".concat(F.rightSE.point.x,", ").concat(F.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(m.size>yr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(S.segments.length>fo)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var I=S.process(x),T=0,D=I.length;T<D;T++){var C=I[T];C.consumedBy===void 0&&m.insert(C)}L=m.size,M=m.pop()}Ot.reset();var P=lo.factory(S.segments),$=new ao(P);return $.getGeom()}}]),r}(),Ae=new co,ho=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ae.run("union",e,n)},po=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ae.run("intersection",e,n)},go=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ae.run("xor",e,n)},vo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ae.run("difference",e,n)},qt={union:ho,intersection:po,xor:go,difference:vo};function mo(r,e){var t=_o(e),n=null;return r.type==="FeatureCollection"?n=yo(r):n=Jr(qt.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function yo(r){var e=r.features.length===2?qt.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):qt.union.apply(qt,r.features.map(function(t){return t.geometry.coordinates}));return Jr(e)}function Jr(r){return Un(r)}function _o(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return on(t)}function bo(r,e,t){let n;te(r,Be,s=>t(1,n=s));let{boundaryGeojson:i}=e;return hi("setCamera")&&n.fitBounds(Bn(i),{padding:20,animate:!1}),yt(n,"boundary",{type:"geojson",data:mo(i)}),we(n,{id:"boundary",source:"boundary",...zn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class wo extends ne{constructor(e){super(),re(this,e,bo,null,K,{boundaryGeojson:0})}}function _r(r){let e,t=br(r[4])+"",n,i,o,s,a;return{c(){e=j("Length: "),n=j(t),i=N(),o=w("br"),s=N(),a=w("br")},m(l,u){E(l,e,u),E(l,n,u),E(l,i,u),E(l,o,u),E(l,s,u),E(l,a,u)},p(l,u){u&16&&t!==(t=br(l[4])+"")&&Dn(n,t)},d(l){l&&k(e),l&&k(n),l&&k(i),l&&k(o),l&&k(s),l&&k(a)}}}function So(r){let e,t,n,i,o,s,a,l,u,c,v,p,f,d,m,_,R,h,g,y,S,L,M,x,F,I,T,D,C,P,$,ve,Se,he,ie,Re,me,oe,Ee,be,De,Oe,et,ee,tt,_t,Bt,fe=r[4]&&_r(r);return{c(){e=w("label"),t=j("Name:"),n=w("br"),i=N(),o=w("input"),s=N(),a=w("br"),l=N(),u=w("br"),c=N(),v=w("label"),p=w("input"),f=j(`
  Area`),d=N(),m=w("label"),_=w("input"),R=j(`
  Route`),h=N(),g=w("label"),y=w("input"),S=j(`
  Crossing`),L=N(),M=w("label"),x=w("input"),F=j(`
  Other`),I=N(),T=w("br"),D=N(),C=w("br"),P=N(),$=w("label"),ve=j("Description:"),Se=w("br"),he=N(),ie=w("textarea"),Re=N(),me=w("br"),oe=N(),Ee=w("br"),be=N(),fe&&fe.c(),De=N(),Oe=w("div"),et=w("button"),et.textContent="Delete",ee=N(),tt=w("button"),tt.textContent="Save",A(o,"type","text"),Te(o,"width","100%"),A(p,"type","radio"),p.__value="area",p.value=p.__value,r[7][0].push(p),A(_,"type","radio"),_.__value="route",_.value=_.__value,r[7][0].push(_),A(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[7][0].push(y),A(x,"type","radio"),x.__value="other",x.value=x.__value,r[7][0].push(x),Te(ie,"width","100%"),A(ie,"rows","5"),A(ie,"class","svelte-15lna0i"),A(et,"type","button"),A(tt,"type","button"),Te(Oe,"display","flex"),Te(Oe,"justify-content","space-between")},m(O,G){E(O,e,G),b(e,t),b(e,n),b(e,i),b(e,o),ct(o,r[0]),E(O,s,G),E(O,a,G),E(O,l,G),E(O,u,G),E(O,c,G),E(O,v,G),b(v,p),p.checked=p.__value===r[1],b(v,f),E(O,d,G),E(O,m,G),b(m,_),_.checked=_.__value===r[1],b(m,R),E(O,h,G),E(O,g,G),b(g,y),y.checked=y.__value===r[1],b(g,S),E(O,L,G),E(O,M,G),b(M,x),x.checked=x.__value===r[1],b(M,F),E(O,I,G),E(O,T,G),E(O,D,G),E(O,C,G),E(O,P,G),E(O,$,G),b($,ve),b($,Se),b($,he),b($,ie),ct(ie,r[2]),E(O,Re,G),E(O,me,G),E(O,oe,G),E(O,Ee,G),E(O,be,G),fe&&fe.m(O,G),E(O,De,G),E(O,Oe,G),b(Oe,et),b(Oe,ee),b(Oe,tt),_t||(Bt=[J(o,"input",r[5]),J(p,"change",r[6]),J(_,"change",r[8]),J(y,"change",r[9]),J(x,"change",r[10]),J(ie,"input",r[11]),J(et,"click",r[12]),J(tt,"click",r[13])],_t=!0)},p(O,[G]){G&1&&o.value!==O[0]&&ct(o,O[0]),G&2&&(p.checked=p.__value===O[1]),G&2&&(_.checked=_.__value===O[1]),G&2&&(y.checked=y.__value===O[1]),G&2&&(x.checked=x.__value===O[1]),G&4&&ct(ie,O[2]),O[4]?fe?fe.p(O,G):(fe=_r(O),fe.c(),fe.m(De.parentNode,De)):fe&&(fe.d(1),fe=null)},i:U,o:U,d(O){O&&k(e),O&&k(s),O&&k(a),O&&k(l),O&&k(u),O&&k(c),O&&k(v),r[7][0].splice(r[7][0].indexOf(p),1),O&&k(d),O&&k(m),r[7][0].splice(r[7][0].indexOf(_),1),O&&k(h),O&&k(g),r[7][0].splice(r[7][0].indexOf(y),1),O&&k(L),O&&k(M),r[7][0].splice(r[7][0].indexOf(x),1),O&&k(I),O&&k(T),O&&k(D),O&&k(C),O&&k(P),O&&k($),O&&k(Re),O&&k(me),O&&k(oe),O&&k(Ee),O&&k(be),fe&&fe.d(O),O&&k(De),O&&k(Oe),_t=!1,vt(Bt)}}}function br(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Eo(r,e,t){let{id:n}=e,{name:i}=e,{intervention_type:o}=e,{description:s}=e,{length_meters:a}=e;const l=[[]];function u(){i=this.value,t(0,i)}function c(){o=this.__value,t(1,o)}function v(){o=this.__value,t(1,o)}function p(){o=this.__value,t(1,o)}function f(){o=this.__value,t(1,o)}function d(){s=this.value,t(2,s)}const m=()=>qr(n),_=()=>xe.set(null);return r.$$set=R=>{"id"in R&&t(3,n=R.id),"name"in R&&t(0,i=R.name),"intervention_type"in R&&t(1,o=R.intervention_type),"description"in R&&t(2,s=R.description),"length_meters"in R&&t(4,a=R.length_meters)},[i,o,s,n,a,u,c,l,v,p,f,d,m,_]}class ko extends ne{constructor(e){super(),re(this,e,Eo,So,K,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}function xo(r){const e=r-1;return e*e*e+1}function wr(r,{delay:e=0,duration:t=400,easing:n=xo}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),c=parseFloat(i.marginBottom),v=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*c}px;border-top-width: ${f*v}px;border-bottom-width: ${f*p}px;`}}function Sr(r){let e,t,n,i,o;const s=r[10].default,a=St(s,r,r[9],null);return{c(){e=w("div"),a&&a.c(),Te(e,"border","solid 1px black"),Te(e,"padding","10px")},m(l,u){E(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=J(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&Et(a,s,l,l[9],n?xt(s,l[9],u,null):kt(l[9]),null)},i(l){n||(Y(a,l),Gr(()=>{t||(t=rr(e,wr,{duration:100},!0)),t.run(1)}),n=!0)},o(l){z(a,l),t||(t=rr(e,wr,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Mo(r){let e,t,n,i,o,s,a,l,u,c,v=r[4]&&Sr(r);return{c(){e=w("button"),t=tr("svg"),n=tr("path"),i=N(),o=j(r[1]),s=N(),v&&v.c(),a=Ke(),A(n,"d","M9 5l7 7-7 7"),A(t,"style","tran"),A(t,"width","20"),A(t,"height","20"),A(t,"fill","none"),A(t,"stroke-linecap","round"),A(t,"stroke-linejoin","round"),A(t,"stroke-width","2"),A(t,"viewBox","0 0 24 24"),A(t,"stroke","currentColor"),A(t,"class","svelte-t7fpgu"),A(e,"aria-expanded",r[4]),A(e,"class","svelte-t7fpgu"),nr(e,"underlined",r[3])},m(p,f){E(p,e,f),b(e,t),b(t,n),b(e,i),b(e,o),E(p,s,f),v&&v.m(p,f),E(p,a,f),l=!0,u||(c=[J(e,"click",r[5]),J(e,"mouseenter",r[11]),J(e,"mouseleave",r[12])],u=!0)},p(p,[f]){(!l||f&2)&&Dn(o,p[1]),(!l||f&16)&&A(e,"aria-expanded",p[4]),(!l||f&8)&&nr(e,"underlined",p[3]),p[4]?v?(v.p(p,f),f&16&&Y(v,1)):(v=Sr(p),v.c(),Y(v,1),v.m(a.parentNode,a)):v&&(tn(),z(v,1,1,()=>{v=null}),nn())},i(p){l||(Y(v),l=!0)},o(p){z(v),l=!1},d(p){p&&k(e),p&&k(s),v&&v.d(p),p&&k(a),u=!1,vt(c)}}}function Po(r,e,t){let n,i,o,s;te(r,Ye,h=>t(7,o=h)),te(r,xe,h=>t(8,s=h));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:c}=e;const v=()=>{xe.update(h=>h==u?null:u),s==u&&(gn.set(null),gn.set(u))};let p;function f(){p==null||p.scrollIntoView({behavior:"smooth"})}const d=()=>jt.set(u),m=()=>jt.set(null);function _(h){ae[h?"unshift":"push"](()=>{p=h,t(2,p)})}const R=()=>f();return r.$$set=h=>{"id"in h&&t(0,u=h.id),"label"in h&&t(1,c=h.label),"$$scope"in h&&t(9,l=h.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,c,p,i,n,v,f,o,s,l,a,d,m,_,R]}class Lo extends ne{constructor(e){super(),re(this,e,Po,Mo,K,{id:0,label:1})}}function Er(r,e,t){const n=r.slice();return n[6]=e[t],n[7]=e,n[8]=t,n}function Ro(r){let e,t,n,i,o,s;function a(v){r[2](v,r[6])}function l(v){r[3](v,r[6])}function u(v){r[4](v,r[6])}let c={id:r[6].id,length_meters:r[6].properties.length_meters};return r[6].properties.name!==void 0&&(c.name=r[6].properties.name),r[6].properties.intervention_type!==void 0&&(c.intervention_type=r[6].properties.intervention_type),r[6].properties.description!==void 0&&(c.description=r[6].properties.description),e=new ko({props:c}),ae.push(()=>He(e,"name",a,r[6].properties.name)),ae.push(()=>He(e,"intervention_type",l,r[6].properties.intervention_type)),ae.push(()=>He(e,"description",u,r[6].properties.description)),{c(){V(e.$$.fragment),o=N()},m(v,p){Q(e,v,p),E(v,o,p),s=!0},p(v,p){r=v;const f={};p&1&&(f.id=r[6].id),p&1&&(f.length_meters=r[6].properties.length_meters),!t&&p&1&&(t=!0,f.name=r[6].properties.name,Ve(()=>t=!1)),!n&&p&1&&(n=!0,f.intervention_type=r[6].properties.intervention_type,Ve(()=>n=!1)),!i&&p&1&&(i=!0,f.description=r[6].properties.description,Ve(()=>i=!1)),e.$set(f)},i(v){s||(Y(e.$$.fragment,v),s=!0)},o(v){z(e.$$.fragment,v),s=!1},d(v){Z(e,v),v&&k(o)}}}function kr(r,e){let t,n,i;return n=new Lo({props:{id:e[6].id,label:e[8]+1+") "+xr(e[6]),$$slots:{default:[Ro]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=Ke(),V(n.$$.fragment),this.first=t},m(o,s){E(o,t,s),Q(n,o,s),i=!0},p(o,s){e=o;const a={};s&1&&(a.id=e[6].id),s&1&&(a.label=e[8]+1+") "+xr(e[6])),s&513&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||(Y(n.$$.fragment,o),i=!0)},o(o){z(n.$$.fragment,o),i=!1},d(o){o&&k(t),Z(n,o)}}}function Oo(r){let e=[],t=new Map,n,i,o,s,a=r[0].features;const l=u=>u[6].id;for(let u=0;u<a.length;u+=1){let c=Er(r,a,u),v=l(c);t.set(v,e[u]=kr(v,c))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=Ke()},m(u,c){for(let v=0;v<e.length;v+=1)e[v].m(u,c);E(u,n,c),i=!0,o||(s=J(window,"keydown",r[1]),o=!0)},p(u,[c]){c&1&&(a=u[0].features,tn(),e=pi(e,c,l,1,u,a,t,n.parentNode,di,kr,n,Er),nn())},i(u){if(!i){for(let c=0;c<a.length;c+=1)Y(e[c]);i=!0}},o(u){for(let c=0;c<e.length;c+=1)z(e[c]);i=!1},d(u){for(let c=0;c<e.length;c+=1)e[c].d(u);u&&k(n),o=!1,s()}}}function xr(r){if(r.properties.name)return r.properties.name;var e=r.properties.intervention_type;return e=="other"&&(r.geometry.type=="Point"?e="point":r.geometry.type=="LineString"?e="line":e="polygon"),`Untitled ${e}`}function Ao(r,e,t){let n,i;te(r,xe,u=>t(5,n=u)),te(r,W,u=>t(0,i=u));function o(u){if(u.key=="Delete"){const c=u.target.tagName;if(c=="INPUT"||c=="TEXTAREA")return;u.preventDefault();const v=n;v&&qr(v)}}function s(u,c){r.$$.not_equal(c.properties.name,u)&&(c.properties.name=u,W.set(i))}function a(u,c){r.$$.not_equal(c.properties.intervention_type,u)&&(c.properties.intervention_type=u,W.set(i))}function l(u,c){r.$$.not_equal(c.properties.description,u)&&(c.properties.description=u,W.set(i))}return[i,o,s,a,l]}class Co extends ne{constructor(e){super(),re(this,e,Ao,Oo,K,{})}}function Qe(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ie(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function En(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function $e(r,e,t){t===void 0&&(t={});var n=Qe(r),i=Qe(e),o=ke(i[1]-n[1]),s=ke(i[0]-n[0]),a=ke(n[1]),l=ke(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return $n(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function it(r,e,t){if(r!==null)for(var n,i,o,s,a,l,u,c=0,v=0,p,f=r.type,d=f==="FeatureCollection",m=f==="Feature",_=d?r.features.length:1,R=0;R<_;R++){u=d?r.features[R].geometry:m?r.geometry:r,p=u?u.type==="GeometryCollection":!1,a=p?u.geometries.length:1;for(var h=0;h<a;h++){var g=0,y=0;if(s=p?u.geometries[h]:u,s!==null){l=s.coordinates;var S=s.type;switch(c=t&&(S==="Polygon"||S==="MultiPolygon")?1:0,S){case null:break;case"Point":if(e(l,v,R,g,y)===!1)return!1;v++,g++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(e(l[n],v,R,g,y)===!1)return!1;v++,S==="MultiPoint"&&g++}S==="LineString"&&g++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-c;i++){if(e(l[n][i],v,R,g,y)===!1)return!1;v++}S==="MultiLineString"&&g++,S==="Polygon"&&y++}S==="Polygon"&&g++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(y=0,i=0;i<l[n].length;i++){for(o=0;o<l[n][i].length-c;o++){if(e(l[n][i][o],v,R,g,y)===!1)return!1;v++}y++}g++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(it(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function No(r,e,t,n){var i=t;return it(r,function(o,s,a,l,u){s===0&&t===void 0?i=o:i=e(i,o,s,a,l,u)},n),i}function Ur(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function Fo(r,e,t){var n=t;return Ur(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function dt(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function $r(r,e,t){var n=t;return dt(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function To(r){var e=[];return it(r,function(t){e.push(t)}),e}function Hn(r,e){var t,n,i,o,s,a,l,u,c,v,p=0,f=r.type==="FeatureCollection",d=r.type==="Feature",m=f?r.features.length:1;for(t=0;t<m;t++){for(a=f?r.features[t].geometry:d?r.geometry:r,u=f?r.features[t].properties:d?r.properties:{},c=f?r.features[t].bbox:d?r.bbox:void 0,v=f?r.features[t].id:d?r.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,p,u,c,v)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,p,u,c,v)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],p,u,c,v)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}p++}}function Io(r,e,t){var n=t;return Hn(r,function(i,o,s,a,l){o===0&&t===void 0?n=i:n=e(n,i,o,s,a,l)}),n}function ot(r,e){Hn(r,function(t,n,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Pe(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var c=t.coordinates[u],v={type:l,coordinates:c};if(e(Pe(v,i),n,u)===!1)return!1}})}function Bo(r,e,t){var n=t;return ot(r,function(i,o,s){o===0&&s===0&&t===void 0?n=i:n=e(n,i,o,s)}),n}function jr(r,e){ot(r,function(t,n,i){var o=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var a,l=0,u=0,c=0;if(it(t,function(v,p,f,d,m){if(a===void 0||n>l||d>u||m>c){a=v,l=n,u=d,c=m,o=0;return}var _=de([a,v],t.properties);if(e(_,n,i,m,o)===!1)return!1;o++,a=v})===!1)return!1}}})}function Wr(r,e,t){var n=t,i=!1;return jr(r,function(o,s,a,l,u){i===!1&&t===void 0?n=o:n=e(n,o,s,a,l,u),i=!0}),n}function Hr(r,e){if(!r)throw new Error("geojson is required");ot(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,s=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<s.length;a++)if(e(de(s[a],t.properties),n,i,a)===!1)return!1;break}}})}function Do(r,e,t){var n=t;return Hr(r,function(i,o,s,a){o===0&&t===void 0?n=i:n=e(n,i,o,s,a)}),n}function Go(r,e){if(e=e||{},!jn(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,s=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),s=s||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":s=s||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=l.length+o-1),de([l[o],l[o+1]],s,e);case"Polygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o-1),de([l[i][o],l[i][o+1]],s,e);case"MultiLineString":return n<0&&(n=l.length+n),o<0&&(o=l[n].length+o-1),de([l[n][o],l[n][o+1]],s,e);case"MultiPolygon":return n<0&&(n=l.length+n),i<0&&(i=l[n].length+i),o<0&&(o=l[n][i].length-o-1),de([l[n][i][o],l[n][i][o+1]],s,e)}throw new Error("geojson is invalid")}function qo(r,e){if(e=e||{},!jn(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,s=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),s=s||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":s=s||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":return pe(l,s,e);case"MultiPoint":return n<0&&(n=l.length+n),pe(l[n],s,e);case"LineString":return o<0&&(o=l.length+o),pe(l[o],s,e);case"Polygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),pe(l[i][o],s,e);case"MultiLineString":return n<0&&(n=l.length+n),o<0&&(o=l[n].length+o),pe(l[n][o],s,e);case"MultiPolygon":return n<0&&(n=l.length+n),i<0&&(i=l[n].length+i),o<0&&(o=l[n][i].length-o),pe(l[n][i][o],s,e)}throw new Error("geojson is invalid")}const Yo=Object.freeze(Object.defineProperty({__proto__:null,coordAll:To,coordEach:it,coordReduce:No,featureEach:dt,featureReduce:$r,findPoint:qo,findSegment:Go,flattenEach:ot,flattenReduce:Bo,geomEach:Hn,geomReduce:Io,lineEach:Hr,lineReduce:Do,propEach:Ur,propReduce:Fo,segmentEach:jr,segmentReduce:Wr},Symbol.toStringTag,{value:"Module"}));function Yt(r,e){return e===void 0&&(e={}),Wr(r,function(t,n){var i=n.geometry.coordinates;return t+$e(i[0],i[1],e)},0)}function Xo(r){let e,t,n,i,o,s,a,l,u,c,v,p,f,d,m,_,R,h,g,y=r[0].features.length+"",S,L,M,x,F,I,T,D;return{c(){e=w("div"),t=w("label"),n=j(`Scheme name:
    `),i=w("input"),o=N(),s=w("br"),a=N(),l=w("div"),u=w("label"),c=w("input"),v=N(),p=w("button"),p.textContent="Load from GeoJSON",f=N(),d=w("button"),d.textContent="Export to GeoJSON",m=N(),_=w("br"),R=N(),h=w("div"),g=w("span"),S=j(y),L=j(" interventions"),M=N(),x=w("button"),F=j("Clear all"),A(i,"type","text"),A(c,"type","file"),A(c,"id","load_geojson"),A(c,"class","svelte-lhyd1e"),A(p,"type","button"),A(d,"type","button"),A(d,"class","align-right svelte-lhyd1e"),A(x,"type","button"),A(x,"class","align-right svelte-lhyd1e"),x.disabled=I=r[0].features.length==0},m(C,P){E(C,e,P),b(e,t),b(t,n),b(t,i),ct(i,r[0].scheme_name),E(C,o,P),E(C,s,P),E(C,a,P),E(C,l,P),b(l,u),b(u,c),b(u,v),b(u,p),b(l,f),b(l,d),E(C,m,P),E(C,_,P),E(C,R,P),E(C,h,P),b(h,g),b(g,S),b(g,L),b(h,M),b(h,x),b(x,F),T||(D=[J(i,"input",r[5]),J(c,"change",r[3]),J(p,"click",r[6]),J(d,"click",r[2]),J(x,"click",r[1])],T=!0)},p(C,[P]){P&1&&i.value!==C[0].scheme_name&&ct(i,C[0].scheme_name),P&1&&y!==(y=C[0].features.length+"")&&Dn(S,y),P&1&&I!==(I=C[0].features.length==0)&&(x.disabled=I)},i:U,o:U,d(C){C&&k(e),C&&k(o),C&&k(s),C&&k(a),C&&k(l),C&&k(m),C&&k(_),C&&k(R),C&&k(h),T=!1,vt(D)}}}function zo(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Jo(r,e,t){let n;te(r,W,f=>t(0,n=f));let{authorityName:i}=e,o=window.localStorage.getItem(i);if(o)try{W.set(c(JSON.parse(o)))}catch(f){console.log(`Failed to load from local storage: ${f}`)}function s(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&W.update(f=>(delete f.scheme_name,f.features=[],f))}function a(){const f=JSON.parse(JSON.stringify(n));for(let d of f.features)delete d.properties.hide_while_editing;return f}function l(){let f=a();var d=i;f.authority=i,f.origin="atip-v1",f.scheme_name&&(d+="_"+f.scheme_name),d+=".txt",zo(d,JSON.stringify(f,null,"  "))}function u(f){const d=new FileReader;d.onload=m=>{try{W.set(c(JSON.parse(m.target.result)))}catch(_){window.alert(`Couldn't load scheme from a file: ${_}`)}},d.readAsText(f.target.files[0])}function c(f){let d=1;for(let m of f.features)m.geometry.type=="LineString"&&!m.properties.length_meters&&(m.properties.length_meters=Yt(m,{units:"kilometers"})*1e3),m.id=d++;return f}function v(){n.scheme_name=this.value,W.set(n)}const p=()=>document.getElementById("load_geojson").click();return r.$$set=f=>{"authorityName"in f&&t(4,i=f.authorityName)},r.$$.update=()=>{r.$$.dirty&17&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(i,JSON.stringify(a())))},[n,s,l,u,i,v,p]}class Uo extends ne{constructor(e){super(),re(this,e,Jo,Xo,K,{authorityName:4})}}const $o="/atip/assets/zoom_out_map-b2e1091a.svg";function jo(r){let e,t,n,i,o;return{c(){e=w("button"),t=w("img"),gi(t.src,n=$o)||A(t,"src",n),A(t,"alt","Zoom to show entire boundary"),A(e,"type","button"),A(e,"title","Zoom to show entire boundary"),A(e,"class","svelte-qzjsqo")},m(s,a){E(s,e,a),b(e,t),i||(o=J(e,"click",r[0]),i=!0)},p:U,i:U,o:U,d(s){s&&k(e),i=!1,o()}}}function Wo(r,e,t){let n;te(r,Be,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(Bn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class Ho extends ne{constructor(e){super(),re(this,e,Wo,jo,K,{boundaryGeojson:1})}}function Vo(r){let e,t,n,i,o,s,a;return{c(){e=w("div"),t=j(`Basemap:
  `),n=w("select"),i=w("option"),i.textContent="Streets",o=w("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&Gr(()=>r[2].call(n)),A(e,"class","svelte-1tbnm6i")},m(l,u){E(l,e,u),b(e,t),b(e,n),b(n,i),b(n,o),ir(n,r[0]),s||(a=[J(n,"change",r[2]),J(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&ir(n,l[0])},i:U,o:U,d(l){l&&k(e),s=!1,vt(a)}}}function Qo(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=vi(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Zo extends ne{constructor(e){super(),re(this,e,Qo,Vo,K,{style:0})}}const _e={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",hovering:"black",lineEndpointColor:"black"},ln=10,Qt=10;function Ko(r){let e,t,n,i,o,s,a,l,u,c,v,p,f,d,m,_,R,h,g;return{c(){e=w("div"),t=w("h1"),t.textContent="Interventions",n=N(),i=w("ul"),o=w("li"),s=w("span"),a=j("Areas"),l=N(),u=w("li"),c=w("span"),v=j("Routes"),p=N(),f=w("li"),d=w("span"),m=j("Crossings"),_=N(),R=w("li"),h=w("span"),g=j("Other"),A(t,"class","svelte-p551i1"),A(s,"class","svelte-p551i1"),Te(s,"background",_e.area),A(c,"class","svelte-p551i1"),Te(c,"background",_e.route),A(d,"class","svelte-p551i1"),Te(d,"background",_e.crossing),A(h,"class","svelte-p551i1"),Te(h,"background",_e.other),A(e,"class","svelte-p551i1")},m(y,S){E(y,e,S),b(e,t),b(e,n),b(e,i),b(i,o),b(o,s),b(o,a),b(i,l),b(i,u),b(u,c),b(u,v),b(i,p),b(i,f),b(f,d),b(f,m),b(i,_),b(i,R),b(R,h),b(R,g)},p:U,i:U,o:U,d(y){y&&k(e)}}}class es extends ne{constructor(e){super(),re(this,e,null,Ko,K,{})}}let lt="interventions";function ts(r,e,t){let n,i;te(r,Be,l=>t(0,n=l)),te(r,W,l=>t(1,i=l)),yt(n,lt,{type:"geojson",data:i});const o=["match",["get","intervention_type"],"area",_e.area,"route",_e.route,"crossing",_e.crossing,"other",_e.other,"white"],s=["!=","hide_while_editing",!0];return we(n,{id:"interventions-points",source:lt,filter:["all",Xn,s,["!=","endpoint",!0]],...It(o,ln)}),we(n,{id:"interventions-lines",source:lt,filter:["all",Yn,s],...$t(o,Qt)},"route-lines"),we(n,{id:"interventions-lines-endpoints",source:lt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Qt,"circle-opacity":0,"circle-stroke-color":_e.lineEndpointColor,"circle-stroke-width":2}}),we(n,{id:"interventions-polygons",source:lt,filter:["all",qn,s],...zn(o,.5)},"hover-polygons"),r.$$.update=()=>{if(r.$$.dirty&3){let l=JSON.parse(JSON.stringify(i)),u=[];for(let c of l.features)if(c.geometry.type=="LineString")for(let v of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])u.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:v}});l.features=l.features.concat(u),n.getSource(lt).setData(l)}},[n,i]}class ns extends ne{constructor(e){super(),re(this,e,ts,null,K,{})}}let at="hover";function rs(r,e,t){let n,i,o,s,a;return te(r,Be,l=>t(0,n=l)),te(r,W,l=>t(1,i=l)),te(r,jt,l=>t(2,o=l)),te(r,Ye,l=>t(3,s=l)),te(r,xe,l=>t(4,a=l)),yt(n,at,{type:"geojson",data:Xe()}),we(n,{id:"hover-polygons",source:at,filter:qn,...$t(_e.hovering,.5*Qt,1)}),we(n,{id:"hover-lines",source:at,filter:Yn,...$t(_e.hovering,1.5*Qt,1)},"interventions-lines"),we(n,{id:"hover-points",source:at,filter:Xn,...It(_e.hovering,1.5*ln,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(at).setData(i.features.find(u=>u.id==l)):n.getSource(at).setData(Xe())}},[n,i,o,s,a]}class is extends ne{constructor(e){super(),re(this,e,rs,null,K,{})}}const Dt="edit-point-mode";var Ct,kn;class os{constructor(e){nt(this,Ct);ye(this,"map");ye(this,"active");ye(this,"eventListeners");ye(this,"cursor");this.map=e,this.active=!1,this.eventListeners=[],this.cursor=null,e.on("mousemove",t=>{this.active&&(this.cursor=ss(t.lngLat.toArray()),H(this,Ct,kn).call(this))}),e.on("click",()=>{if(this.active&&this.cursor){for(let t of this.eventListeners)t(this.cursor);this.stop()}}),yt(e,Dt,{type:"geojson",data:Xe()}),we(e,{id:"edit-point-mode",source:Dt,...It(_e.hovering,ln,1)})}addEventListener(e){this.eventListeners.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Dt)}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,H(this,Ct,kn).call(this)}}Ct=new WeakSet,kn=function(){let e=Xe();this.cursor&&e.features.push(this.cursor),this.map.getSource(Dt).setData(e)};function ss(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Vr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return ls(r,e);var n=Qe(r),i=Qe(e),o=ke(n[0]),s=ke(i[0]),a=ke(n[1]),l=ke(i[1]),u=Math.sin(s-o)*Math.cos(l),c=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return Rt(Math.atan2(u,c))}function ls(r,e){var t=Vr(e,r);return t=(t+180)%360,t}function Mr(r,e,t,n){n===void 0&&(n={});var i=Qe(r),o=ke(i[0]),s=ke(i[1]),a=ke(t),l=sn(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),v=Rt(c),p=Rt(u);return pe([v,p],n.properties)}function xn(r){if(!r)throw new Error("geojson is required");var e=[];return ot(r,function(t){as(t,e)}),Me(e)}function as(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ie(n);break;case"LineString":t=[Ie(n)]}t.forEach(function(i){var o=us(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function us(r,e){var t=[];return r.reduce(function(n,i){var o=de([n,i],e);return o.bbox=fs(n,i),t.push(o),i}),t}function fs(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var gt={},cs={get exports(){return gt},set exports(r){gt=r}},Mn={},hs={get exports(){return Mn},set exports(r){Mn=r}};(function(r,e){(function(t,n){r.exports=n()})(mi,function(){function t(h,g,y,S,L){(function M(x,F,I,T,D){for(;T>I;){if(T-I>600){var C=T-I+1,P=F-I+1,$=Math.log(C),ve=.5*Math.exp(2*$/3),Se=.5*Math.sqrt($*ve*(C-ve)/C)*(P-C/2<0?-1:1),he=Math.max(I,Math.floor(F-P*ve/C+Se)),ie=Math.min(T,Math.floor(F+(C-P)*ve/C+Se));M(x,F,he,ie,D)}var Re=x[F],me=I,oe=T;for(n(x,I,F),D(x[T],Re)>0&&n(x,I,T);me<oe;){for(n(x,me,oe),me++,oe--;D(x[me],Re)<0;)me++;for(;D(x[oe],Re)>0;)oe--}D(x[I],Re)===0?n(x,I,oe):n(x,++oe,T),oe<=F&&(I=oe+1),F<=oe&&(T=oe-1)}})(h,g,y||0,S||h.length-1,L||i)}function n(h,g,y){var S=h[g];h[g]=h[y],h[y]=S}function i(h,g){return h<g?-1:h>g?1:0}var o=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(h,g,y){if(!y)return g.indexOf(h);for(var S=0;S<g.length;S++)if(y(h,g[S]))return S;return-1}function a(h,g){l(h,0,h.children.length,g,h)}function l(h,g,y,S,L){L||(L=_(null)),L.minX=1/0,L.minY=1/0,L.maxX=-1/0,L.maxY=-1/0;for(var M=g;M<y;M++){var x=h.children[M];u(L,h.leaf?S(x):x)}return L}function u(h,g){return h.minX=Math.min(h.minX,g.minX),h.minY=Math.min(h.minY,g.minY),h.maxX=Math.max(h.maxX,g.maxX),h.maxY=Math.max(h.maxY,g.maxY),h}function c(h,g){return h.minX-g.minX}function v(h,g){return h.minY-g.minY}function p(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function f(h){return h.maxX-h.minX+(h.maxY-h.minY)}function d(h,g){return h.minX<=g.minX&&h.minY<=g.minY&&g.maxX<=h.maxX&&g.maxY<=h.maxY}function m(h,g){return g.minX<=h.maxX&&g.minY<=h.maxY&&g.maxX>=h.minX&&g.maxY>=h.minY}function _(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function R(h,g,y,S,L){for(var M=[g,y];M.length;)if(!((y=M.pop())-(g=M.pop())<=S)){var x=g+Math.ceil((y-g)/S/2)*S;t(h,x,g,y,L),M.push(g,x,x,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(h){var g=this.data,y=[];if(!m(h,g))return y;for(var S=this.toBBox,L=[];g;){for(var M=0;M<g.children.length;M++){var x=g.children[M],F=g.leaf?S(x):x;m(h,F)&&(g.leaf?y.push(x):d(h,F)?this._all(x,y):L.push(x))}g=L.pop()}return y},o.prototype.collides=function(h){var g=this.data;if(!m(h,g))return!1;for(var y=[];g;){for(var S=0;S<g.children.length;S++){var L=g.children[S],M=g.leaf?this.toBBox(L):L;if(m(h,M)){if(g.leaf||d(h,M))return!0;y.push(L)}}g=y.pop()}return!1},o.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var g=0;g<h.length;g++)this.insert(h[g]);return this}var y=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var S=this.data;this.data=y,y=S}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(h,g){if(!h)return this;for(var y,S,L,M=this.data,x=this.toBBox(h),F=[],I=[];M||F.length;){if(M||(M=F.pop(),S=F[F.length-1],y=I.pop(),L=!0),M.leaf){var T=s(h,M.children,g);if(T!==-1)return M.children.splice(T,1),F.push(M),this._condense(F),this}L||M.leaf||!d(M,x)?S?(y++,M=S.children[y],L=!1):M=null:(F.push(M),I.push(y),y=0,S=M,M=M.children[0])}return this},o.prototype.toBBox=function(h){return h},o.prototype.compareMinX=function(h,g){return h.minX-g.minX},o.prototype.compareMinY=function(h,g){return h.minY-g.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(h){return this.data=h,this},o.prototype._all=function(h,g){for(var y=[];h;)h.leaf?g.push.apply(g,h.children):y.push.apply(y,h.children),h=y.pop();return g},o.prototype._build=function(h,g,y,S){var L,M=y-g+1,x=this._maxEntries;if(M<=x)return a(L=_(h.slice(g,y+1)),this.toBBox),L;S||(S=Math.ceil(Math.log(M)/Math.log(x)),x=Math.ceil(M/Math.pow(x,S-1))),(L=_([])).leaf=!1,L.height=S;var F=Math.ceil(M/x),I=F*Math.ceil(Math.sqrt(x));R(h,g,y,I,this.compareMinX);for(var T=g;T<=y;T+=I){var D=Math.min(T+I-1,y);R(h,T,D,F,this.compareMinY);for(var C=T;C<=D;C+=F){var P=Math.min(C+F-1,D);L.children.push(this._build(h,C,P,S-1))}}return a(L,this.toBBox),L},o.prototype._chooseSubtree=function(h,g,y,S){for(;S.push(g),!g.leaf&&S.length-1!==y;){for(var L=1/0,M=1/0,x=void 0,F=0;F<g.children.length;F++){var I=g.children[F],T=p(I),D=(C=h,P=I,(Math.max(P.maxX,C.maxX)-Math.min(P.minX,C.minX))*(Math.max(P.maxY,C.maxY)-Math.min(P.minY,C.minY))-T);D<M?(M=D,L=T<L?T:L,x=I):D===M&&T<L&&(L=T,x=I)}g=x||g.children[0]}var C,P;return g},o.prototype._insert=function(h,g,y){var S=y?h:this.toBBox(h),L=[],M=this._chooseSubtree(S,this.data,g,L);for(M.children.push(h),u(M,S);g>=0&&L[g].children.length>this._maxEntries;)this._split(L,g),g--;this._adjustParentBBoxes(S,L,g)},o.prototype._split=function(h,g){var y=h[g],S=y.children.length,L=this._minEntries;this._chooseSplitAxis(y,L,S);var M=this._chooseSplitIndex(y,L,S),x=_(y.children.splice(M,y.children.length-M));x.height=y.height,x.leaf=y.leaf,a(y,this.toBBox),a(x,this.toBBox),g?h[g-1].children.push(x):this._splitRoot(y,x)},o.prototype._splitRoot=function(h,g){this.data=_([h,g]),this.data.height=h.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(h,g,y){for(var S,L,M,x,F,I,T,D=1/0,C=1/0,P=g;P<=y-g;P++){var $=l(h,0,P,this.toBBox),ve=l(h,P,y,this.toBBox),Se=(L=$,M=ve,x=void 0,F=void 0,I=void 0,T=void 0,x=Math.max(L.minX,M.minX),F=Math.max(L.minY,M.minY),I=Math.min(L.maxX,M.maxX),T=Math.min(L.maxY,M.maxY),Math.max(0,I-x)*Math.max(0,T-F)),he=p($)+p(ve);Se<D?(D=Se,S=P,C=he<C?he:C):Se===D&&he<C&&(C=he,S=P)}return S||y-g},o.prototype._chooseSplitAxis=function(h,g,y){var S=h.leaf?this.compareMinX:c,L=h.leaf?this.compareMinY:v;this._allDistMargin(h,g,y,S)<this._allDistMargin(h,g,y,L)&&h.children.sort(S)},o.prototype._allDistMargin=function(h,g,y,S){h.children.sort(S);for(var L=this.toBBox,M=l(h,0,g,L),x=l(h,y-g,y,L),F=f(M)+f(x),I=g;I<y-g;I++){var T=h.children[I];u(M,h.leaf?L(T):T),F+=f(M)}for(var D=y-g-1;D>=g;D--){var C=h.children[D];u(x,h.leaf?L(C):C),F+=f(x)}return F},o.prototype._adjustParentBBoxes=function(h,g,y){for(var S=y;S>=0;S--)u(g[S],h)},o.prototype._condense=function(h){for(var g=h.length-1,y=void 0;g>=0;g--)h[g].children.length===0?g>0?(y=h[g-1].children).splice(y.indexOf(h[g]),1):this.clear():a(h[g],this.toBBox)},o})})(hs);const ps=Gn(ji),ds=Gn(Yo);function Zt(r){var e=[1/0,1/0,-1/0,-1/0];return it(r,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}Zt.default=Zt;const gs=Object.freeze(Object.defineProperty({__proto__:null,default:Zt},Symbol.toStringTag,{value:"Module"})),vs=Gn(gs);var Ce=Mn,Qr=ps,Zr=ds,ut=vs.default,ms=Zr.featureEach;Zr.coordEach;Qr.polygon;var Pr=Qr.featureCollection;function Kr(r){var e=new Ce(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ut(t),Ce.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ut(i),n.push(i)}):ms(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ut(i),n.push(i)}),Ce.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ut(t),Ce.prototype.remove.call(this,t,n)},e.clear=function(){return Ce.prototype.clear.call(this)},e.search=function(t){var n=Ce.prototype.search.call(this,this.toBBox(t));return Pr(n)},e.collides=function(t){return Ce.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ce.prototype.all.call(this);return Pr(t)},e.toJSON=function(){return Ce.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ce.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ut(t);else if(t.type==="FeatureCollection")n=ut(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}cs.exports=Kr;gt.default=Kr;function ei(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Pe(r)),e.type==="LineString"&&(e=Pe(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Lr(r,e);return i&&n.push(i),Me(n)}var o=gt();return o.load(xn(e)),dt(xn(r),function(s){dt(o.search(s),function(a){var l=Lr(s,a);if(l){var u=Ie(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),Me(n)}function Lr(r,e){var t=Ie(r),n=Ie(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],c=n[1][0],v=n[1][1],p=(v-u)*(s-i)-(c-l)*(a-o),f=(c-l)*(o-u)-(v-u)*(i-l),d=(s-i)*(o-u)-(a-o)*(i-l);if(p===0)return f===0&&d===0,null;var m=f/p,_=d/p;if(m>=0&&m<=1&&_>=0&&_<=1){var R=i+m*(s-i),h=o+m*(a-o);return pe([R,h])}return null}function At(r,e,t){t===void 0&&(t={});var n=pe([1/0,1/0],{dist:1/0}),i=0;return ot(r,function(o){for(var s=Ie(o),a=0;a<s.length-1;a++){var l=pe(s[a]);l.properties.dist=$e(e,l,t);var u=pe(s[a+1]);u.properties.dist=$e(e,u,t);var c=$e(l,u,t),v=Math.max(l.properties.dist,u.properties.dist),p=Vr(l,u),f=Mr(e,v,p+90,t),d=Mr(e,v,p-90,t),m=ei(de([f.geometry.coordinates,d.geometry.coordinates]),de([l.geometry.coordinates,u.geometry.coordinates])),_=null;m.features.length>0&&(_=m.features[0],_.properties.dist=$e(e,_,t),_.properties.location=i+$e(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+c),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a),i+=c}}),n}const ft="edit-polygon-mode";var Ge,rt,Nt,Pn,Ft,Ln;class ys{constructor(e){nt(this,Ge);nt(this,Nt);nt(this,Ft);ye(this,"map");ye(this,"active");ye(this,"eventListeners");ye(this,"points");ye(this,"cursor");ye(this,"hoverPolyon");ye(this,"hoverPoint");ye(this,"dragging");ye(this,"dragFrom");this.map=e,this.active=!1,this.eventListeners=[],this.points=[],this.cursor=null,this.hoverPolyon=!1,this.hoverPoint=null,this.dragging=!1,this.dragFrom=null,e.on("mousemove",t=>{if(this.active&&!this.dragging)H(this,Nt,Pn).call(this,t);else if(this.active&&this.dragging){if(this.hoverPolyon){let n=this.dragFrom[0]-t.lngLat.lng,i=this.dragFrom[1]-t.lngLat.lat;for(let o of this.points)o[0]-=n,o[1]-=i}else this.points[this.hoverPoint]=t.lngLat.toArray();this.dragFrom=t.lngLat.toArray(),H(this,Ge,rt).call(this)}}),e.on("click",t=>{if(this.active&&this.cursor){let n=[];if(Or(this.points).forEach((i,o)=>{n.push([o+1,At(i,this.cursor).properties.dist])}),n.sort((i,o)=>i[1]-o[1]),n.length>0){let i=n[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hoverPoint=i}else this.points.push(this.cursor.geometry.coordinates),this.hoverPoint=this.points.length-1;H(this,Ge,rt).call(this)}else this.active&&this.hoverPoint!=null&&(this.points.splice(this.hoverPoint,1),this.hoverPoint=null,H(this,Ge,rt).call(this),H(this,Nt,Pn).call(this,t))}),e.on("mousedown",t=>{this.active&&!this.dragging&&(this.hoverPolyon||this.hoverPoint!=null)&&(t.preventDefault(),this.cursor=null,this.dragging=!0,this.dragFrom=t.lngLat.toArray())}),e.on("mouseup",()=>{this.active&&this.dragging&&(this.dragging=!1,this.dragFrom=null)}),document.addEventListener("keypress",t=>{if(this.active&&t.key=="Enter"){t.preventDefault();let n=H(this,Ft,Ln).call(this);if(n)for(let i of this.eventListeners)i(n);this.stop()}}),yt(e,ft,{type:"geojson",data:Xe()}),we(e,{id:"edit-polygon-fill",source:ft,filter:qn,...zn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),we(e,{id:"edit-polygon-lines",source:ft,filter:Yn,...$t("black",8,.5)}),we(e,{id:"edit-polygon-vertices",source:ft,filter:Xn,...It(_e.hovering,ln,["case",["boolean",["get","hover"],"false"],1,.5])})}addEventListener(e){this.eventListeners.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(ft)}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=e.geometry.coordinates[0],this.points.pop(),H(this,Ge,rt).call(this)}stop(){this.points=[],this.cursor=null,this.active=!1,this.hoverPolyon=!1,this.hoverPoint=null,this.dragging=!1,this.dragFrom=null,H(this,Ge,rt).call(this)}}Ge=new WeakSet,rt=function(){let e=Xe();this.points.forEach((n,i)=>{let o=Rr(n);o.properties.hover=this.hoverPoint==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Or(this.points));let t=H(this,Ft,Ln).call(this);t&&(t.properties.hover=this.hoverPolyon,e.features.push(t)),this.map.getSource(ft).setData(e)},Nt=new WeakSet,Pn=function(e){this.cursor=null,this.hoverPolyon=!1,this.hoverPoint=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hoverPolyon=!0;break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hoverPoint=t.properties.idx;break}!this.hoverPolyon&&this.hoverPoint==null&&(this.cursor=Rr(e.lngLat.toArray())),H(this,Ge,rt).call(this)},Ft=new WeakSet,Ln=function(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}};function Rr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Or(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]}}),e}function Ar(r){let e;return{c(){e=w("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){E(t,e,n)},d(t){t&&k(e)}}}function _s(r){let e,t=r[0]==ht&&Ar();return{c(){t&&t.c(),e=Ke()},m(n,i){t&&t.m(n,i),E(n,e,i)},p(n,[i]){n[0]==ht?t||(t=Ar(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&k(e)}}}const ht="edit-attribute";function ti(){}function bs(r,e,t){let n,i;te(r,Be,l=>t(4,n=l)),te(r,W,l=>t(5,i=l));let{mode:o}=e,{changeMode:s}=e;function a(){xe.set(null)}return n.on("mousemove",l=>{if(o==ht){let c=n.queryRenderedFeatures(l.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});var u=null;c.length>0&&(u=c[0].id),Ye.set(u)}}),n.on("mouseout",()=>{o==ht&&Ye.set(null)}),n.on("click",l=>{if(o==ht){let u=n.queryRenderedFeatures(l.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});u.length>0?xe.set(u[0].id):xe.set(null)}}),gn.subscribe(l=>{if(l){let u=i.features.find(c=>c.id==l);u.geometry.type=="Point"?n.flyTo({center:u.geometry.coordinates}):n.fitBounds(Bn(u),{padding:200,animate:!0,duration:500}),s(ht)}}),r.$$set=l=>{"mode"in l&&t(0,o=l.mode),"changeMode"in l&&t(1,s=l.changeMode)},[o,s,ti,a]}class ws extends ne{constructor(e){super(),re(this,e,bs,_s,K,{mode:0,changeMode:1,start:2,stop:3})}get start(){return ti}get stop(){return this.$$.ctx[3]}}function Cr(r){let e;return{c(){e=w("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){E(t,e,n)},d(t){t&&k(e)}}}function Ss(r){let e,t=r[0]==Je&&Cr();return{c(){t&&t.c(),e=Ke()},m(n,i){t&&t.m(n,i),E(n,e,i)},p(n,[i]){n[0]==Je?t||(t=Cr(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&k(e)}}}const Je="edit-geometry";function ni(){}function Es(r,e,t){let n;te(r,Be,p=>t(8,n=p));let{mode:i}=e,{routeSnapper:o}=e,{snapTool:s}=e,{pointTool:a}=e,{polygonTool:l}=e;function u(){c&&(o.stop(),a.stop(),l.stop(),W.update(p=>{let f=p.features.find(d=>d.id==c);return delete f.properties.hide_while_editing,p})),c=null,Ye.set(null)}let c=null;n.on("mousemove",p=>{if(i==Je&&c==null){let d=n.queryRenderedFeatures(p.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});var f=null;d.length>0&&(f=d[0].id),Ye.set(f)}}),n.on("mouseout",()=>{i==Je&&c==null&&Ye.set(null)}),n.on("click",p=>{if(i==Je&&c==null){let f=n.queryRenderedFeatures(p.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});f.length>0&&v(f[0].id)}}),s.addEventListener("new-route",p=>{if(i==Je){const f=p.detail;W.update(d=>{let m=d.features.find(_=>_.id==c);return m.properties.length_meters=f.properties.length_meters,m.properties.waypoints=f.properties.waypoints,delete m.properties.hide_while_editing,m.geometry=f.geometry,d}),c=null}}),s.addEventListener("no-new-route",()=>{i==Je&&(W.update(p=>{let f=p.features.find(d=>d.id==c);return delete f.properties.hide_while_editing,p}),c=null)});for(let p of[a,l])p.addEventListener(f=>{i==Je&&(W.update(d=>{let m=d.features.find(_=>_.id==c);return m.geometry=f.geometry,delete m.properties.hide_while_editing,d}),c=null)});function v(p){Ye.set(null);let f;W.update(d=>(f=d.features.find(m=>m.id==p),f.properties.hide_while_editing=!0,d)),c=p,f.geometry.type=="LineString"?o.editExisting(f):f.geometry.type=="Polygon"?l.editExisting(f):f.geometry.type=="Point"&&a.start()}return r.$$set=p=>{"mode"in p&&t(0,i=p.mode),"routeSnapper"in p&&t(1,o=p.routeSnapper),"snapTool"in p&&t(2,s=p.snapTool),"pointTool"in p&&t(3,a=p.pointTool),"polygonTool"in p&&t(4,l=p.polygonTool)},[i,o,s,a,l,ni,u]}class ks extends ne{constructor(e){super(),re(this,e,Es,Ss,K,{mode:0,routeSnapper:1,snapTool:2,pointTool:3,polygonTool:4,start:5,stop:6})}get start(){return ni}get stop(){return this.$$.ctx[6]}}let B;const ri=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});ri.decode();let Xt=new Uint8Array;function Pt(){return Xt.byteLength===0&&(Xt=new Uint8Array(B.memory.buffer)),Xt}function pt(r,e){return ri.decode(Pt().subarray(r,r+e))}const qe=new Array(32).fill(void 0);qe.push(void 0,null,!0,!1);let Lt=qe.length;function se(r){Lt===qe.length&&qe.push(qe.length+1);const e=Lt;return Lt=qe[e],qe[e]=r,e}function X(r){return qe[r]}function xs(r){r<36||(qe[r]=Lt,Lt=r)}function Rn(r){const e=X(r);return xs(r),e}function fn(r){return r==null}let zt=new Float64Array;function Ms(){return zt.byteLength===0&&(zt=new Float64Array(B.memory.buffer)),zt}let Jt=new Int32Array;function le(){return Jt.byteLength===0&&(Jt=new Int32Array(B.memory.buffer)),Jt}let We=0;const Ut=new TextEncoder("utf-8"),Ps=typeof Ut.encodeInto=="function"?function(r,e){return Ut.encodeInto(r,e)}:function(r,e){const t=Ut.encode(r);return e.set(t),{read:r.length,written:t.length}};function Gt(r,e,t){if(t===void 0){const a=Ut.encode(r),l=e(a.length);return Pt().subarray(l,l+a.length).set(a),We=a.length,l}let n=r.length,i=e(n);const o=Pt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=Pt().subarray(i+s,i+n),l=Ps(r,a);s+=l.written}return We=s,i}function On(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=On(r[0]));for(let s=1;s<i;s++)o+=", "+On(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ls(r,e){const t=e(r.length*1);return Pt().set(r,t/1),We=r.length,t}function cn(r,e){try{return r.apply(this,e)}catch(t){B.__wbindgen_exn_store(se(t))}}class Kt{static __wrap(e){const t=Object.create(Kt.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();B.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=B.__wbindgen_add_to_stack_pointer(-16),s=Ls(e,B.__wbindgen_malloc),a=We;B.jsroutesnapper_new(o,s,a);var t=le()[o/4+0],n=le()[o/4+1],i=le()[o/4+2];if(i)throw Rn(n);return Kt.__wrap(t)}finally{B.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){B.jsroutesnapper_setConfig(this.ptr,se(e))}toFinalFeature(){try{const n=B.__wbindgen_add_to_stack_pointer(-16);B.jsroutesnapper_toFinalFeature(n,this.ptr);var e=le()[n/4+0],t=le()[n/4+1];let i;return e!==0&&(i=pt(e,t).slice(),B.__wbindgen_free(e,t*1)),i}finally{B.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=B.__wbindgen_add_to_stack_pointer(-16);B.jsroutesnapper_renderGeojson(n,this.ptr);var e=le()[n/4+0],t=le()[n/4+1];return pt(e,t)}finally{B.__wbindgen_add_to_stack_pointer(16),B.__wbindgen_free(e,t)}}setSnapMode(e){B.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return B.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){B.jsroutesnapper_onClick(this.ptr)}onDragStart(){return B.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return B.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){B.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=B.__wbindgen_add_to_stack_pointer(-16);B.jsroutesnapper_editExisting(i,this.ptr,se(e));var t=le()[i/4+0],n=le()[i/4+1];if(n)throw Rn(t)}finally{B.__wbindgen_add_to_stack_pointer(16)}}}async function Rs(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Os(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=pt(e,t);return se(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Rn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=X(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(pt(e,t));return se(n)},r.wbg.__wbindgen_is_object=function(e){const t=X(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return X(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return X(e)in X(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=X(t),i=typeof n=="number"?n:void 0;Ms()[e/8+1]=fn(i)?0:i,le()[e/4+0]=!fn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return X(e)==X(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=X(t),i=typeof n=="string"?n:void 0;var o=fn(i)?0:Gt(i,B.__wbindgen_malloc,B.__wbindgen_realloc),s=We;le()[e/4+1]=s,le()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(X(t)),i=Gt(n,B.__wbindgen_malloc,B.__wbindgen_realloc),o=We;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=X(e);return se(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=X(e)[X(t)];return se(n)},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(X(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=X(e)[t>>>0];return se(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return X(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof X(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=X(e).next;return se(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return cn(function(e){const t=X(e).next();return se(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return X(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=X(e).value;return se(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return se(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return cn(function(e,t){const n=Reflect.get(X(e),X(t));return se(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return cn(function(e,t){const n=X(e).call(X(t));return se(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(X(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=X(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=X(e).buffer;return se(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(X(e));return se(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){X(e).set(X(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return X(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=X(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return se(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=X(t).stack,i=Gt(n,B.__wbindgen_malloc,B.__wbindgen_realloc),o=We;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(pt(e,t))}finally{B.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=On(X(t)),i=Gt(n,B.__wbindgen_malloc,B.__wbindgen_realloc),o=We;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(pt(e,t))},r.wbg.__wbindgen_memory=function(){const e=B.memory;return se(e)},r}function As(r,e){return B=r.exports,ii.__wbindgen_wasm_module=e,zt=new Float64Array,Jt=new Int32Array,Xt=new Uint8Array,B}async function ii(r){typeof r>"u"&&(r="/atip/assets/route_snapper_bg.wasm");const e=Os();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Rs(await r,e);return As(t,n)}var Tt,An,Fe,ze;class Cs{constructor(e,t,n){nt(this,Tt);nt(this,Fe);this.controlDiv=n,this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Kt(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),console.log("JsRouteSnapper ready, waiting for idle event"),this.active=!1,this.loaded=!1,this.map.once("idle",()=>{console.log("JsRouteSnapper now usable"),this.map.addSource("route-snapper",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"route-points",type:"circle",source:"route-snapper",paint:{"circle-radius":["match",["get","type"],"unimportant",10/2,10],"circle-color":["match",["get","type"],"hovered","green","important","red","black"]},filter:["in","$type","Point"]}),this.map.addLayer({id:"route-lines",type:"line",source:"route-snapper",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":2.5},filter:["in","$type","LineString"]}),this.loaded=!0,this.map.on("mousemove",s=>{if(!this.active)return;const a={x:s.point.x-30,y:s.point.y},l=this.map.unproject(s.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(s.lngLat.lng,s.lngLat.lat,l)&&H(this,Fe,ze).call(this)}),this.map.on("click",()=>{this.active&&(this.inner.onClick(),H(this,Fe,ze).call(this))}),this.map.on("dragstart",s=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}),this.map.on("mouseup",s=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}),document.addEventListener("keypress",s=>{this.active&&s.key=="Enter"&&(s.preventDefault(),H(this,Tt,An).call(this))}),document.addEventListener("keydown",s=>{this.active&&s.key=="Shift"&&(s.preventDefault(),this.inner.setSnapMode(!1),H(this,Fe,ze).call(this))}),document.addEventListener("keyup",s=>{this.active&&s.key=="Shift"&&(s.preventDefault(),this.inner.setSnapMode(!0),H(this,Fe,ze).call(this))}),this.stop()})}isActive(){return this.active}tearDown(){this.loaded&&(this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeSource("route-snapper"))}editExisting(e){if(!this.loaded){console.error("editExisting called before the map idle event received. Not starting tool.");return}e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.start(),this.inner.editExisting(e.properties.waypoints),H(this,Fe,ze).call(this)}stop(){if(!this.loaded)return;this.active=!1,this.inner.clearState(),H(this,Fe,ze).call(this),this.controlDiv.innerHTML="";let e=document.createElement("button");e.innerText="Route tool",e.type="button",e.onclick=()=>{this.controlDiv.dispatchEvent(new CustomEvent("activate")),this.start()},this.controlDiv.appendChild(e)}start(){if(this.active)return;this.active=!0;let e=document.createElement("button");e.type="button",e.innerText="Finish route",e.onclick=()=>{H(this,Tt,An).call(this)};let t=document.createElement("button");t.type="button",t.innerText="Cancel",t.onclick=()=>{this.controlDiv.dispatchEvent(new CustomEvent("no-new-route")),this.stop()},this.controlDiv.innerHTML="";let n=document.createElement("div");n.style="display: flex; justify-content: space-evenly;",n.appendChild(e),n.appendChild(t),this.controlDiv.appendChild(n);let i=document.createElement("input");i.type="checkbox",i.id="avoidDoublingBack",i.onclick=()=>{this.inner.setConfig({avoid_doubling_back:i.checked}),H(this,Fe,ze).call(this)};let o=document.createElement("label");o.innerText="Avoid doubling back",o.for=i.id;let s=document.createElement("div");s.appendChild(i),s.appendChild(o),this.controlDiv.append(s);const a=document.createElement("ul");a.innerHTML="<li><b>Click</b> green points on the transport network</br>to create snapped routes</li><li>Hold <b>Shift</b> to draw a point anywhere</li><li><b>Click and drag</b> any point to move it</li><li><b>Click</b> a red waypoint to delete it</li><li>Press <b>Enter</b> to finish route</li>",this.controlDiv.appendChild(a)}}Tt=new WeakSet,An=function(){const e=this.inner.toFinalFeature();e?this.controlDiv.dispatchEvent(new CustomEvent("new-route",{detail:JSON.parse(e)})):this.controlDiv.dispatchEvent(new CustomEvent("no-new-route")),this.stop()},Fe=new WeakSet,ze=function(){this.loaded&&this.map.getSource("route-snapper").setData(JSON.parse(this.inner.renderGeojson()))};async function Ns(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:c}=await n.read();if(u)break;s.push(c),o+=c.length;const v=100*o/i;e.style=`background: linear-gradient(to right, red ${v}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function Fs(r){let e,t;return{c(){e=w("div"),t=w("div"),t.textContent="Route tool loading..."},m(n,i){E(n,e,i),b(e,t),r[8](t),r[9](e)},p:U,i:U,o:U,d(n){n&&k(e),r[8](null),r[9](null)}}}const hn="route";function Ts(r,e,t){let n;te(r,Be,d=>t(10,n=d));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,{snapTool:a}=e,l,{routeSnapper:u}=e;function c(){u.isActive()||u.start()}function v(){u==null||u.stop()}Tn(async()=>{await ii(),console.log(`Grabbing ${s}`);try{const d=await Ns(s,l);t(2,u=new Cs(n,d,a))}catch(d){console.log(`Route tool broke: ${d}`),t(0,a.innerHTML="Failed to load",a)}a.addEventListener("activate",()=>{o(hn)}),a.addEventListener("no-new-route",()=>{i==hn&&o("edit-attribute")}),a.addEventListener("new-route",d=>{if(i==hn){const m=d.detail;W.update(_=>(m.id=rn(_),m.properties.intervention_type="route",_.features.push(m),_)),o("edit-attribute"),xe.set(m.id)}})}),In(()=>{u==null||u.tearDown()});function p(d){ae[d?"unshift":"push"](()=>{l=d,t(1,l)})}function f(d){ae[d?"unshift":"push"](()=>{a=d,t(0,a)})}return r.$$set=d=>{"mode"in d&&t(3,i=d.mode),"changeMode"in d&&t(4,o=d.changeMode),"url"in d&&t(5,s=d.url),"snapTool"in d&&t(0,a=d.snapTool),"routeSnapper"in d&&t(2,u=d.routeSnapper)},[a,l,u,i,o,s,c,v,p,f]}class Is extends ne{constructor(e){super(),re(this,e,Ts,Fs,K,{mode:3,changeMode:4,url:5,snapTool:0,routeSnapper:2,start:6,stop:7})}get start(){return this.$$.ctx[6]}get stop(){return this.$$.ctx[7]}}function Nr(r){let e;return{c(){e=w("p"),e.textContent="Click to add a new point"},m(t,n){E(t,e,n)},d(t){t&&k(e)}}}function Bs(r){let e,t=r[0]==Cn&&Nr();return{c(){t&&t.c(),e=Ke()},m(n,i){t&&t.m(n,i),E(n,e,i)},p(n,[i]){n[0]==Cn?t||(t=Nr(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&k(e)}}}const Cn="point";function Ds(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListener(l=>{n==Cn&&(W.update(u=>(l.id=rn(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),xe.set(l.id))}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(1,i=l.changeMode),"pointTool"in l&&t(2,o=l.pointTool)},[n,i,o,s,a]}class Gs extends ne{constructor(e){super(),re(this,e,Ds,Bs,K,{mode:0,changeMode:1,pointTool:2,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Fr(r){let e;return{c(){e=w("p"),e.innerHTML="Click the map to add a vertex, or click a vertex to delete it. Press <strong>Enter</strong> to finish. Drag a vertex or the polygon to move."},m(t,n){E(t,e,n)},d(t){t&&k(e)}}}function qs(r){let e,t=r[0]==Nn&&Fr();return{c(){t&&t.c(),e=Ke()},m(n,i){t&&t.m(n,i),E(n,e,i)},p(n,[i]){n[0]==Nn?t||(t=Fr(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&k(e)}}}const Nn="polygon";function Ys(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListener(l=>{n==Nn&&(W.update(u=>(l.id=rn(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),xe.set(l.id))}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(1,i=l.changeMode),"polygonTool"in l&&t(2,o=l.polygonTool)},[n,i,o,s,a]}class Xs extends ne{constructor(e){super(),re(this,e,Ys,qs,K,{mode:0,changeMode:1,polygonTool:2,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function zs(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=$e(r.slice(0,2),[n,t]),s=$e(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Js(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return it(r,function(s){Us(s,o,n)}),r}function Us(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function $s(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=En(r),n=En(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Js(e,{precision:7});switch(n){case"Point":return Fn(r,i);case"MultiPoint":return Tr(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Tr(r,ei(r,i))}}function Tr(r,e){var t=[],n=gt();return ot(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=Fn(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=zs(Zt(a)))}),n.load(Me(t));else{var o=n.search(i);if(o.features.length){var s=oi(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),dt(Fn(s,i),function(a){t.push(a),n.insert(a)})}}}),Me(t)}function Fn(r,e){var t=[],n=Ie(r)[0],i=Ie(r)[r.geometry.coordinates.length-1];if(pn(n,Qe(e))||pn(i,Qe(e)))return Me([r]);var o=gt(),s=xn(r);o.load(s);var a=o.search(e);if(!a.features.length)return Me([r]);var l=oi(e,a),u=[n],c=$r(s,function(v,p,f){var d=Ie(p)[1],m=Qe(e);return f===l.id?(v.push(m),t.push(de(v)),pn(m,d)?[m]:[m,d]):(v.push(d),v)},u);return c.length>1&&t.push(de(c)),Me(t)}function oi(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return dt(e,function(i){var o=At(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function pn(r,e){return r[0]===e[0]&&r[1]===e[1]}function js(r,e,t){var n=Ie(t);if(En(t)!=="LineString")throw new Error("line must be a LineString");var i=At(t,r),o=At(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),de(a,t.properties)}function Ir(r){let e;return{c(){e=w("p"),e.textContent="Click near a route to split it, or click on the map to cancel"},m(t,n){E(t,e,n)},d(t){t&&k(e)}}}function Ws(r){let e,t=r[0]==en&&Ir();return{c(){t&&t.c(),e=Ke()},m(n,i){t&&t.m(n,i),E(n,e,i)},p(n,[i]){n[0]==en?t||(t=Ir(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&k(e)}}}const en="split-route",Hs=10,Vs=30;let dn="split-route";function si(){}function Br(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Qs(r,e,t){let n,i;te(r,Be,p=>t(5,n=p)),te(r,W,p=>t(7,i=p));let{mode:o}=e,{changeMode:s}=e;function a(){t(4,l=null),u=null}let l=null,u=null;n.on("mousemove",p=>{if(o!=en)return;t(4,l=Br(p.lngLat.toArray(),!1)),u=null;const f=[p.point.x-Vs,p.point.y],d=n.unproject(p.point).distanceTo(n.unproject(f))/1e3;let m=[];for(let[_,R]of i.features.entries())if(R.geometry.type=="LineString"){let h=At(R.geometry,l,{units:"kilometers"});h.properties.dist<=d&&m.push([_,h.geometry.coordinates,h.properties.dist])}m.sort((_,R)=>_[2]-R[2]),m.length>0&&(t(4,l=Br(m[0][1],!0)),u=m[0][0])}),n.on("click",()=>{if(o==en)if(u==null)s("edit-attribute");else{let p=$s(i.features[u],l);if(p.features.length==2){let f=p.features[0],d=p.features[1];W.update(m=>(f.id=m.features[u].id,d.id=rn(m),f.properties=JSON.parse(JSON.stringify(m.features[u].properties)),d.properties=JSON.parse(JSON.stringify(f.properties)),c(m.features[u],f,d,l),m.features.splice(u,1,f,d),m))}a()}}),yt(n,dn,{type:"geojson",data:Xe()}),we(n,{id:"draw-split-route",source:dn,...It("black",Hs,["case",["==",["get","snapped"],!0],1,.5])});function c(p,f,d,m){f.properties.length_meters=Yt(f,{units:"kilometers"})*1e3,d.properties.length_meters=Yt(d,{units:"kilometers"})*1e3,f.properties.waypoints=[],d.properties.waypoints=[];let _=v(p,m),R=!0,h=0;for(let g of p.properties.waypoints){let y=v(p,pe([g.lon,g.lat]));if(R)if(y<_)f.properties.waypoints.push(g);else{let S=g.snapped&&p.properties.waypoints[h-1].snapped;f.properties.waypoints.push({lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1],snapped:S}),R=!1,d.properties.waypoints.push({lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1],snapped:S}),d.properties.waypoints.push(g)}else d.properties.waypoints.push(g);h++}}function v(p,f){let d=p.geometry.coordinates[0],m=js(d,f,p);return Yt(m,{units:"kilometers"})*1e3}return r.$$set=p=>{"mode"in p&&t(0,o=p.mode),"changeMode"in p&&t(1,s=p.changeMode)},r.$$.update=()=>{if(r.$$.dirty&48){let p=Xe();l&&p.features.push(l),n.getSource(dn).setData(p)}},[o,s,si,a,l,n]}class Zs extends ne{constructor(e){super(),re(this,e,Qs,Ws,K,{mode:0,changeMode:1,start:2,stop:3})}get start(){return si}get stop(){return this.$$.ctx[3]}}function Dr(r){let e,t,n={mode:r[3],routeSnapper:r[1],snapTool:r[2],pointTool:r[10],polygonTool:r[11]};return e=new ks({props:n}),r[16](e),{c(){V(e.$$.fragment)},m(i,o){Q(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&2&&(s.routeSnapper=i[1]),o&4&&(s.snapTool=i[2]),e.$set(s)},i(i){t||(Y(e.$$.fragment,i),t=!0)},o(i){z(e.$$.fragment,i),t=!1},d(i){r[16](null),Z(e,i)}}}function Ks(r){let e,t,n,i,o,s,a,l,u,c,v,p,f,d,m,_,R,h,g,y,S,L,M,x,F,I,T,D,C,P,$,ve,Se,he,ie,Re,me,oe,Ee,be,De,Oe,et={mode:r[3],changeMode:r[12]};a=new ws({props:et}),r[14](a);let ee=r[1]&&r[2]&&Dr(r),tt={mode:r[3],changeMode:r[12],pointTool:r[10]};y=new Gs({props:tt}),r[18](y);let _t={mode:r[3],changeMode:r[12],polygonTool:r[11]};T=new Xs({props:_t}),r[20](T);function Bt(q){r[22](q)}function fe(q){r[23](q)}let O={mode:r[3],changeMode:r[12],url:r[0]};r[1]!==void 0&&(O.routeSnapper=r[1]),r[2]!==void 0&&(O.snapTool=r[2]),P=new Is({props:O}),r[21](P),ae.push(()=>He(P,"routeSnapper",Bt,r[1])),ae.push(()=>He(P,"snapTool",fe,r[2]));let G={mode:r[3],changeMode:r[12]};return Ee=new Zs({props:G}),r[25](Ee),{c(){e=w("div"),t=w("div"),n=w("button"),i=j("Edit attributes"),s=N(),V(a.$$.fragment),l=N(),u=w("div"),c=w("button"),v=j("Edit geometry"),f=N(),ee&&ee.c(),d=N(),m=w("div"),_=w("button"),R=j("New point"),g=N(),V(y.$$.fragment),S=N(),L=w("div"),M=w("button"),x=j("New polygon"),I=N(),V(T.$$.fragment),D=N(),C=w("div"),V(P.$$.fragment),Se=N(),he=w("div"),ie=w("button"),Re=j("Split route"),oe=N(),V(Ee.$$.fragment),A(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",A(n,"class","svelte-cej5os"),A(c,"type","button"),c.disabled=p=r[3]=="edit-geometry",A(c,"class","svelte-cej5os"),A(_,"type","button"),_.disabled=h=r[3]=="point",A(_,"class","svelte-cej5os"),A(M,"type","button"),M.disabled=F=r[3]=="polygon",A(M,"class","svelte-cej5os"),A(ie,"type","button"),ie.disabled=me=r[3]=="split-route",A(ie,"class","svelte-cej5os"),A(e,"class","toolbox svelte-cej5os")},m(q,ue){E(q,e,ue),b(e,t),b(t,n),b(n,i),b(t,s),Q(a,t,null),b(e,l),b(e,u),b(u,c),b(c,v),b(u,f),ee&&ee.m(u,null),b(e,d),b(e,m),b(m,_),b(_,R),b(m,g),Q(y,m,null),b(e,S),b(e,L),b(L,M),b(M,x),b(L,I),Q(T,L,null),b(e,D),b(e,C),Q(P,C,null),b(e,Se),b(e,he),b(he,ie),b(ie,Re),b(he,oe),Q(Ee,he,null),be=!0,De||(Oe=[J(n,"click",r[13]),J(c,"click",r[15]),J(_,"click",r[17]),J(M,"click",r[19]),J(ie,"click",r[24])],De=!0)},p(q,[ue]){(!be||ue&8&&o!==(o=q[3]=="edit-attribute"))&&(n.disabled=o);const Vn={};ue&8&&(Vn.mode=q[3]),a.$set(Vn),(!be||ue&8&&p!==(p=q[3]=="edit-geometry"))&&(c.disabled=p),q[1]&&q[2]?ee?(ee.p(q,ue),ue&6&&Y(ee,1)):(ee=Dr(q),ee.c(),Y(ee,1),ee.m(u,null)):ee&&(tn(),z(ee,1,1,()=>{ee=null}),nn()),(!be||ue&8&&h!==(h=q[3]=="point"))&&(_.disabled=h);const Qn={};ue&8&&(Qn.mode=q[3]),y.$set(Qn),(!be||ue&8&&F!==(F=q[3]=="polygon"))&&(M.disabled=F);const Zn={};ue&8&&(Zn.mode=q[3]),T.$set(Zn);const bt={};ue&8&&(bt.mode=q[3]),ue&1&&(bt.url=q[0]),!$&&ue&2&&($=!0,bt.routeSnapper=q[1],Ve(()=>$=!1)),!ve&&ue&4&&(ve=!0,bt.snapTool=q[2],Ve(()=>ve=!1)),P.$set(bt),(!be||ue&8&&me!==(me=q[3]=="split-route"))&&(ie.disabled=me);const Kn={};ue&8&&(Kn.mode=q[3]),Ee.$set(Kn)},i(q){be||(Y(a.$$.fragment,q),Y(ee),Y(y.$$.fragment,q),Y(T.$$.fragment,q),Y(P.$$.fragment,q),Y(Ee.$$.fragment,q),be=!0)},o(q){z(a.$$.fragment,q),z(ee),z(y.$$.fragment,q),z(T.$$.fragment,q),z(P.$$.fragment,q),z(Ee.$$.fragment,q),be=!1},d(q){q&&k(e),r[14](null),Z(a),ee&&ee.d(),r[18](null),Z(y),r[20](null),Z(T),r[21](null),Z(P),r[25](null),Z(Ee),De=!1,vt(Oe)}}}function el(r,e,t){let n;te(r,Be,P=>t(26,n=P));let{routeUrl:i}=e,o,s,a=new os(n),l=new ys(n),u="edit-attribute",c,v,p,f,d,m;function _(P){let $={"edit-attribute":c,"edit-geometry":v,route:p,point:f,polygon:d,"split-route":m};if(u==P){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),$[u].stop(),t(3,u=P),console.log(`Starting new mode ${u}`),$[u].start()}In(()=>{a==null||a.tearDown(),l==null||l.tearDown()});const R=()=>_("edit-attribute");function h(P){ae[P?"unshift":"push"](()=>{c=P,t(4,c)})}const g=()=>_("edit-geometry");function y(P){ae[P?"unshift":"push"](()=>{v=P,t(5,v)})}const S=()=>_("point");function L(P){ae[P?"unshift":"push"](()=>{f=P,t(7,f)})}const M=()=>_("polygon");function x(P){ae[P?"unshift":"push"](()=>{d=P,t(8,d)})}function F(P){ae[P?"unshift":"push"](()=>{p=P,t(6,p)})}function I(P){o=P,t(1,o)}function T(P){s=P,t(2,s)}const D=()=>_("split-route");function C(P){ae[P?"unshift":"push"](()=>{m=P,t(9,m)})}return r.$$set=P=>{"routeUrl"in P&&t(0,i=P.routeUrl)},[i,o,s,u,c,v,p,f,d,m,a,l,_,R,h,g,y,S,L,M,x,F,I,T,D,C]}class tl extends ne{constructor(e){super(),re(this,e,el,Ks,K,{routeUrl:0})}}function nl(r){let e,t,n,i,o,s,a,l;return{c(){e=w("div"),t=w("button"),t.textContent="Home",n=N(),i=w("button"),i.textContent="About",o=N(),s=w("button"),s.textContent="Instructions",A(t,"type","button"),A(i,"type","button"),A(s,"type","button"),A(e,"slot","nav")},m(u,c){E(u,e,c),b(e,t),b(e,n),b(e,i),b(e,o),b(e,s),a||(l=[J(t,"click",r[8]),J(i,"click",r[6]),J(s,"click",r[7])],a=!0)},p:U,d(u){u&&k(e),a=!1,vt(l)}}}function rl(r){let e,t,n,i,o,s,a,l,u,c,v,p;return o=new Ho({props:{boundaryGeojson:r[3]}}),a=new Uo({props:{authorityName:r[4]}}),v=new Co({}),{c(){e=w("div"),t=w("h1"),n=j(r[4]),i=N(),V(o.$$.fragment),s=N(),V(a.$$.fragment),l=N(),u=w("br"),c=N(),V(v.$$.fragment),A(e,"slot","sidebar")},m(f,d){E(f,e,d),b(e,t),b(t,n),b(t,i),Q(o,t,null),b(e,s),Q(a,e,null),b(e,l),b(e,u),b(e,c),Q(v,e,null),p=!0},p(f,d){const m={};d&8&&(m.boundaryGeojson=f[3]),o.$set(m)},i(f){p||(Y(o.$$.fragment,f),Y(a.$$.fragment,f),Y(v.$$.fragment,f),p=!0)},o(f){z(o.$$.fragment,f),z(a.$$.fragment,f),z(v.$$.fragment,f),p=!1},d(f){f&&k(e),Z(o),Z(a),Z(v)}}}function il(r){let e,t,n,i,o,s,a,l,u,c,v,p;return e=new wo({props:{boundaryGeojson:r[3]}}),n=new ns({}),o=new is({}),a=new tl({props:{routeUrl:r[2]}}),u=new Zo({props:{style:r[5]}}),v=new es({}),{c(){V(e.$$.fragment),t=N(),V(n.$$.fragment),i=N(),V(o.$$.fragment),s=N(),V(a.$$.fragment),l=N(),V(u.$$.fragment),c=N(),V(v.$$.fragment)},m(f,d){Q(e,f,d),E(f,t,d),Q(n,f,d),E(f,i,d),Q(o,f,d),E(f,s,d),Q(a,f,d),E(f,l,d),Q(u,f,d),E(f,c,d),Q(v,f,d),p=!0},p(f,d){const m={};d&8&&(m.boundaryGeojson=f[3]),e.$set(m);const _={};d&4&&(_.routeUrl=f[2]),a.$set(_)},i(f){p||(Y(e.$$.fragment,f),Y(n.$$.fragment,f),Y(o.$$.fragment,f),Y(a.$$.fragment,f),Y(u.$$.fragment,f),Y(v.$$.fragment,f),p=!0)},o(f){z(e.$$.fragment,f),z(n.$$.fragment,f),z(o.$$.fragment,f),z(a.$$.fragment,f),z(u.$$.fragment,f),z(v.$$.fragment,f),p=!1},d(f){Z(e,f),f&&k(t),Z(n,f),f&&k(i),Z(o,f),f&&k(s),Z(a,f),f&&k(l),Z(u,f),f&&k(c),Z(v,f)}}}function ol(r){let e,t,n;return t=new Pi({props:{style:r[5],$$slots:{default:[il]},$$scope:{ctx:r}}}),{c(){e=w("div"),V(t.$$.fragment),A(e,"slot","main")},m(i,o){E(i,e,o),Q(t,e,null),n=!0},p(i,o){const s={};o&16396&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(Y(t.$$.fragment,i),n=!0)},o(i){z(t.$$.fragment,i),n=!1},d(i){i&&k(e),Z(t)}}}function sl(r){let e,t,n,i,o,s,a,l;e=new Ni({props:{$$slots:{main:[ol],sidebar:[rl],nav:[nl]},$$scope:{ctx:r}}});function u(f){r[9](f)}let c={};r[0]!==void 0&&(c.open=r[0]),n=new yi({props:c}),ae.push(()=>He(n,"open",u,r[0]));function v(f){r[10](f)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new Ei({props:p}),ae.push(()=>He(s,"open",v,r[1])),{c(){V(e.$$.fragment),t=N(),V(n.$$.fragment),o=N(),V(s.$$.fragment)},m(f,d){Q(e,f,d),E(f,t,d),Q(n,f,d),E(f,o,d),Q(s,f,d),l=!0},p(f,[d]){const m={};d&16396&&(m.$$scope={dirty:d,ctx:f}),e.$set(m);const _={};!i&&d&1&&(i=!0,_.open=f[0],Ve(()=>i=!1)),n.$set(_);const R={};!a&&d&2&&(a=!0,R.open=f[1],Ve(()=>a=!1)),s.$set(R)},i(f){l||(Y(e.$$.fragment,f),Y(n.$$.fragment,f),Y(s.$$.fragment,f),l=!0)},o(f){z(e.$$.fragment,f),z(n.$$.fragment,f),z(s.$$.fragment,f),l=!1},d(f){Z(e,f),f&&k(t),Z(n,f),f&&k(o),Z(s,f)}}}function ll(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets";var u=`https://atip.uk/route-snappers/${a}.bin`;o||(u=`https://atip.uk/route-snappers-dev/${a}.bin`);function c(){t(0,n=!n),t(1,i=!1)}function v(){t(1,i=!i),t(0,n=!1)}let p;Tn(async()=>{t(3,p=await f())});async function f(){const h=await(await fetch(_i)).text(),g=JSON.parse(h);return g.features=g.features.filter(y=>y.properties.name==a),g}const d=()=>window.open("index.html");function m(R){n=R,t(0,n)}function _(R){i=R,t(1,i)}return[n,i,u,p,a,l,c,v,d,m,_]}class al extends ne{constructor(e){super(),re(this,e,ll,sl,K,{})}}new al({target:document.getElementById("app")});
