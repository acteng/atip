var si=(st,pt,T)=>{if(!pt.has(st))throw TypeError("Cannot "+T)};var Et=(st,pt,T)=>{if(pt.has(st))throw TypeError("Cannot add the same private member more than once");pt instanceof WeakSet?pt.add(st):pt.set(st,T)};var W=(st,pt,T)=>(si(st,pt,"access private method"),T);import{c as Me,m as Dn,g as Oo,a as ci}from"./authorities-f5046e46.js";(async()=>{var pe,$n,$e,To,fe,Nn,Mt,ae,Ne,jo,he,Bn,Be,Ao,ge,Rn;var st={},pt={get exports(){return st},set exports(g){st=g}};(function(g,l){(function(h,b){g.exports=b()})(Me,function(){var h=function(t,e){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},o={on:function(r,a,f){if(n[r]===void 0)throw new Error("Invalid event type: "+r);n[r].push({selector:a,fn:f})},render:function(r){e.store.featureChanged(r)}},s=function(r,a){for(var f=n[r],p=f.length;p--;){var v=f[p];if(v.selector(a)){v.fn.call(o,a)||e.store.render(),e.ui.updateMapClasses();break}}};return t.start.call(o),{render:t.render,stop:function(){t.stop&&t.stop()},trash:function(){t.trash&&(t.trash(),e.store.render())},combineFeatures:function(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures:function(){t.uncombineFeatures&&t.uncombineFeatures()},drag:function(r){s("drag",r)},click:function(r){s("click",r)},mousemove:function(r){s("mousemove",r)},mousedown:function(r){s("mousedown",r)},mouseup:function(r){s("mouseup",r)},mouseout:function(r){s("mouseout",r)},keydown:function(r){s("keydown",r)},keyup:function(r){s("keyup",r)},touchstart:function(r){s("touchstart",r)},touchmove:function(r){s("touchmove",r)},touchend:function(r){s("touchend",r)},tap:function(r){s("tap",r)}}},b=6378137;function S(t){var e=0;if(t&&t.length>0){e+=Math.abs(F(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(F(t[n]))}return e}function F(t){var e,n,o,s,r,a,f=0,p=t.length;if(p>2){for(a=0;a<p;a++)a===p-2?(o=p-2,s=p-1,r=0):a===p-1?(o=p-1,s=0,r=1):(o=a,s=a+1,r=a+2),e=t[o],n=t[s],f+=(M(t[r][0])-M(e[0]))*Math.sin(M(n[1]));f=f*b*b/2}return f}function M(t){return t*Math.PI/180}var $={geometry:function t(e){var n,o=0;switch(e.type){case"Polygon":return S(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)o+=S(e.coordinates[n]);return o;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)o+=t(e.geometries[n]);return o}},ring:F},Y="mapboxgl-ctrl",rt="mapbox-gl-draw_ctrl-draw-btn",It="mapbox-gl-draw_line",ct="mapbox-gl-draw_polygon",Bt="mapbox-gl-draw_point",er="mapbox-gl-draw_trash",nr="mapbox-gl-draw_combine",or="mapbox-gl-draw_uncombine",rr="mapboxgl-ctrl-group",qn="active",ir="mapbox-gl-draw_boxselect",Kt="mapbox-gl-draw-hot",ye="mapbox-gl-draw-cold",Rt="add",Ut="move",ar="drag",Re="pointer",dn="none",nt={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Z="Feature",Lt="Polygon",Qt="LineString",ot="Point",Pt="FeatureCollection",zn="Multi",sr="MultiPoint",cr="MultiLineString",ur="MultiPolygon",k={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},pn="draw.create",lr="draw.delete",Wn="draw.update",dr="draw.selectionchange",pr="draw.modechange",fr="draw.actionable",hr="draw.render",gr="draw.combine",yr="draw.uncombine",mr="move",vr="change_coordinates",Jt="feature",fn="midpoint",me="vertex",vt="true",kt="false",br=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Yn={Point:0,LineString:1,Polygon:2};function _r(t,e){var n=Yn[t.geometry.type]-Yn[e.geometry.type];return n===0&&t.geometry.type===Lt?t.area-e.area:n}function ut(t){if(this._items={},this._nums={},this._length=t?t.length:0,t)for(var e=0,n=t.length;e<n;e++)this.add(t[e]),t[e]!==void 0&&(typeof t[e]=="string"?this._items[t[e]]=e:this._nums[t[e]]=e)}ut.prototype.add=function(t){return this.has(t)||(this._length++,typeof t=="string"?this._items[t]=this._length:this._nums[t]=this._length),this},ut.prototype.delete=function(t){return this.has(t)===!1||(this._length--,delete this._items[t],delete this._nums[t]),this},ut.prototype.has=function(t){return(typeof t=="string"||typeof t=="number")&&(this._items[t]!==void 0||this._nums[t]!==void 0)},ut.prototype.values=function(){var t=this,e=[];return Object.keys(this._items).forEach(function(n){e.push({k:n,v:t._items[n]})}),Object.keys(this._nums).forEach(function(n){e.push({k:JSON.parse(n),v:t._nums[n]})}),e.sort(function(n,o){return n.v-o.v}).map(function(n){return n.k})},ut.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var wr=[Jt,fn,me],ve={click:function(t,e,n){return Zn(t,e,n,n.options.clickBuffer)},touch:function(t,e,n){return Zn(t,e,n,n.options.touchBuffer)}};function Zn(t,e,n,o){if(n.map===null)return[];var s=t?function(v,c){return c===void 0&&(c=0),[[v.point.x-c,v.point.y-c],[v.point.x+c,v.point.y+c]]}(t,o):e,r={};n.options.styles&&(r.layers=n.options.styles.map(function(v){return v.id}));var a=n.map.queryRenderedFeatures(s,r).filter(function(v){return wr.indexOf(v.properties.meta)!==-1}),f=new ut,p=[];return a.forEach(function(v){var c=v.properties.id;f.has(c)||(f.add(c),p.push(v))}),function(v){return v.map(function(c){return c.geometry.type===Lt&&(c.area=$.geometry({type:Z,property:{},geometry:c.geometry})),c}).sort(_r).map(function(c){return delete c.area,c})}(p)}function hn(t,e){var n=ve.click(t,null,e),o={mouse:dn};return n[0]&&(o.mouse=n[0].properties.active===vt?Ut:Re,o.feature=n[0].properties.meta),e.events.currentModeName().indexOf("draw")!==-1&&(o.mouse=Rt),e.ui.queueMapClasses(o),e.ui.updateMapClasses(),n[0]}function Kn(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}function Qn(t,e,n){n===void 0&&(n={});var o=n.fineTolerance!=null?n.fineTolerance:4,s=n.grossTolerance!=null?n.grossTolerance:12,r=n.interval!=null?n.interval:500;t.point=t.point||e.point,t.time=t.time||e.time;var a=Kn(t.point,e.point);return a<o||a<s&&e.time-t.time<r}function Xn(t,e,n){n===void 0&&(n={});var o=n.tolerance!=null?n.tolerance:25,s=n.interval!=null?n.interval:250;return t.point=t.point||e.point,t.time=t.time||e.time,Kn(t.point,e.point)<o&&e.time-t.time<s}function gn(t,e){return t(e={exports:{}},e.exports),e.exports}var yn=gn(function(t){var e=t.exports=function(n,o){if(o||(o=16),n===void 0&&(n=128),n<=0)return"0";for(var s=Math.log(Math.pow(2,n))/Math.log(o),r=2;s===1/0;r*=2)s=Math.log(Math.pow(2,n/r))/Math.log(o)*r;var a=s-Math.floor(s),f="";for(r=0;r<Math.floor(s);r++)f=Math.floor(Math.random()*o).toString(o)+f;if(a){var p=Math.pow(o,a);f=Math.floor(Math.random()*p).toString(o)+f}var v=parseInt(f,o);return v!==1/0&&v>=Math.pow(2,n)?e(n,o):f};e.rack=function(n,o,s){var r=function(f){var p=0;do{if(p++>10){if(!s)throw new Error("too many ID collisions, use more bits");n+=s}var v=e(n,o)}while(Object.hasOwnProperty.call(a,v));return a[v]=f,v},a=r.hats={};return r.get=function(f){return r.hats[f]},r.set=function(f,p){return r.hats[f]=p,r},r.bits=n||128,r.base=o||16,r}}),K=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||yn(),this.type=e.geometry.type};K.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},K.prototype.incomingCoords=function(t){this.setCoordinates(t)},K.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},K.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},K.prototype.setProperty=function(t,e){this.properties[t]=e},K.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Z,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},K.prototype.internal=function(t){var e={id:this.id,meta:Jt,"meta:type":this.type,active:kt,mode:t};if(this.ctx.options.userProperties)for(var n in this.properties)e["user_"+n]=this.properties[n];return{type:Z,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Vt=function(t,e){K.call(this,t,e)};(Vt.prototype=Object.create(K.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Vt.prototype.updateCoordinate=function(t,e,n){this.coordinates=arguments.length===3?[e,n]:[t,e],this.changed()},Vt.prototype.getCoordinate=function(){return this.getCoordinates()};var bt=function(t,e){K.call(this,t,e)};(bt.prototype=Object.create(K.prototype)).isValid=function(){return this.coordinates.length>1},bt.prototype.addCoordinate=function(t,e,n){this.changed();var o=parseInt(t,10);this.coordinates.splice(o,0,[e,n])},bt.prototype.getCoordinate=function(t){var e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},bt.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)},bt.prototype.updateCoordinate=function(t,e,n){var o=parseInt(t,10);this.coordinates[o]=[e,n],this.changed()};var it=function(t,e){K.call(this,t,e),this.coordinates=this.coordinates.map(function(n){return n.slice(0,-1)})};(it.prototype=Object.create(K.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(t){return t.length>2})},it.prototype.incomingCoords=function(t){this.coordinates=t.map(function(e){return e.slice(0,-1)}),this.changed()},it.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},it.prototype.addCoordinate=function(t,e,n){this.changed();var o=t.split(".").map(function(s){return parseInt(s,10)});this.coordinates[o[0]].splice(o[1],0,[e,n])},it.prototype.removeCoordinate=function(t){this.changed();var e=t.split(".").map(function(o){return parseInt(o,10)}),n=this.coordinates[e[0]];n&&(n.splice(e[1],1),n.length<3&&this.coordinates.splice(e[0],1))},it.prototype.getCoordinate=function(t){var e=t.split(".").map(function(o){return parseInt(o,10)}),n=this.coordinates[e[0]];return JSON.parse(JSON.stringify(n[e[1]]))},it.prototype.getCoordinates=function(){return this.coordinates.map(function(t){return t.concat([t[0]])})},it.prototype.updateCoordinate=function(t,e,n){this.changed();var o=t.split("."),s=parseInt(o[0],10),r=parseInt(o[1],10);this.coordinates[s]===void 0&&(this.coordinates[s]=[]),this.coordinates[s][r]=[e,n]};var Sr={MultiPoint:Vt,MultiLineString:bt,MultiPolygon:it},Ue=function(t,e,n,o,s){var r=n.split("."),a=parseInt(r[0],10),f=r[1]?r.slice(1).join("."):null;return t[a][e](f,o,s)},tt=function(t,e){if(K.call(this,t,e),delete this.coordinates,this.model=Sr[e.geometry.type],this.model===void 0)throw new TypeError(e.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(e.geometry.coordinates)};function L(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}(tt.prototype=Object.create(K.prototype))._coordinatesToFeatures=function(t){var e=this,n=this.model.bind(this);return t.map(function(o){return new n(e.ctx,{id:yn(),type:Z,properties:{},geometry:{coordinates:o,type:e.type.replace("Multi","")}})})},tt.prototype.isValid=function(){return this.features.every(function(t){return t.isValid()})},tt.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()},tt.prototype.getCoordinate=function(t){return Ue(this.features,"getCoordinate",t)},tt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(t){return t.type===Lt?t.getCoordinates():t.coordinates})))},tt.prototype.updateCoordinate=function(t,e,n){Ue(this.features,"updateCoordinate",t,e,n),this.changed()},tt.prototype.addCoordinate=function(t,e,n){Ue(this.features,"addCoordinate",t,e,n),this.changed()},tt.prototype.removeCoordinate=function(t){Ue(this.features,"removeCoordinate",t),this.changed()},tt.prototype.getFeatures=function(){return this.features},L.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)},L.prototype.setSelectedCoordinates=function(t){var e=this;this._ctx.store.setSelectedCoordinates(t),t.reduce(function(n,o){return n[o.feature_id]===void 0&&(n[o.feature_id]=!0,e._ctx.store.get(o.feature_id).changed()),n},{})},L.prototype.getSelected=function(){return this._ctx.store.getSelected()},L.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},L.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)},L.prototype.getFeature=function(t){return this._ctx.store.get(t)},L.prototype.select=function(t){return this._ctx.store.select(t)},L.prototype.deselect=function(t){return this._ctx.store.deselect(t)},L.prototype.deleteFeature=function(t,e){return e===void 0&&(e={}),this._ctx.store.delete(t,e)},L.prototype.addFeature=function(t){return this._ctx.store.add(t)},L.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},L.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},L.prototype.setActionableState=function(t){t===void 0&&(t={});var e={trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(e)},L.prototype.changeMode=function(t,e,n){return e===void 0&&(e={}),n===void 0&&(n={}),this._ctx.events.changeMode(t,e,n)},L.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)},L.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)},L.prototype.featuresAt=function(t,e,n){if(n===void 0&&(n="click"),n!=="click"&&n!=="touch")throw new Error("invalid buffer type");return ve[n](t,e,this._ctx)},L.prototype.newFeature=function(t){var e=t.geometry.type;return e===ot?new Vt(this._ctx,t):e===Qt?new bt(this._ctx,t):e===Lt?new it(this._ctx,t):new tt(this._ctx,t)},L.prototype.isInstanceOf=function(t,e){if(t===ot)return e instanceof Vt;if(t===Qt)return e instanceof bt;if(t===Lt)return e instanceof it;if(t==="MultiFeature")return e instanceof tt;throw new Error("Unknown feature class: "+t)},L.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)},L.prototype.onSetup=function(){},L.prototype.onDrag=function(){},L.prototype.onClick=function(){},L.prototype.onMouseMove=function(){},L.prototype.onMouseDown=function(){},L.prototype.onMouseUp=function(){},L.prototype.onMouseOut=function(){},L.prototype.onKeyUp=function(){},L.prototype.onKeyDown=function(){},L.prototype.onTouchStart=function(){},L.prototype.onTouchMove=function(){},L.prototype.onTouchEnd=function(){},L.prototype.onTap=function(){},L.prototype.onStop=function(){},L.prototype.onTrash=function(){},L.prototype.onCombineFeature=function(){},L.prototype.onUncombineFeature=function(){},L.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var to={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},xr=Object.keys(to);function Er(t){var e=Object.keys(t);return function(n,o){o===void 0&&(o={});var s={},r=e.reduce(function(a,f){return a[f]=t[f],a},new L(n));return{start:function(){var a=this;s=r.onSetup(o),xr.forEach(function(f){var p,v=to[f],c=function(){return!1};t[v]&&(c=function(){return!0}),a.on(f,c,(p=v,function(y){return r[p](s,y)}))})},stop:function(){r.onStop(s)},trash:function(){r.onTrash(s)},combineFeatures:function(){r.onCombineFeatures(s)},uncombineFeatures:function(){r.onUncombineFeatures(s)},render:function(a,f){r.toDisplayFeatures(s,a,f)}}}}function Je(t){return[].concat(t).filter(function(e){return e!==void 0})}function Cr(){var t=this;if(!(t.ctx.map&&t.ctx.map.getSource(Kt)!==void 0))return p();var e=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:e});var n=[],o=[];t.isDirty?o=t.getAllIds():(n=t.getChangedIds().filter(function(v){return t.get(v)!==void 0}),o=t.sources.hot.filter(function(v){return v.properties.id&&n.indexOf(v.properties.id)===-1&&t.get(v.properties.id)!==void 0}).map(function(v){return v.properties.id})),t.sources.hot=[];var s=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter(function(v){var c=v.properties.id||v.properties.parent;return n.indexOf(c)===-1});var r=s!==t.sources.cold.length||o.length>0;function a(v,c){var y=t.get(v).internal(e);t.ctx.events.currentModeRender(y,function(_){t.sources[c].push(_)})}if(n.forEach(function(v){return a(v,"hot")}),o.forEach(function(v){return a(v,"cold")}),r&&t.ctx.map.getSource(ye).setData({type:Pt,features:t.sources.cold}),t.ctx.map.getSource(Kt).setData({type:Pt,features:t.sources.hot}),t._emitSelectionChange&&(t.ctx.map.fire(dr,{features:t.getSelected().map(function(v){return v.toGeoJSON()}),points:t.getSelectedCoordinates().map(function(v){return{type:Z,properties:{},geometry:{type:ot,coordinates:v.coordinates}}})}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){var f=t._deletedFeaturesToEmit.map(function(v){return v.toGeoJSON()});t._deletedFeaturesToEmit=[],t.ctx.map.fire(lr,{features:f})}function p(){t.isDirty=!1,t.clearChangedIds()}p(),t.ctx.map.fire(hr,{})}function B(t){var e,n=this;this._features={},this._featureIds=new ut,this._selectedFeatureIds=new ut,this._selectedCoordinates=[],this._changedFeatureIds=new ut,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]},this.render=function(){e||(e=requestAnimationFrame(function(){e=null,Cr.call(n)}))},this.isDirty=!1}function eo(t,e){var n=t._selectedCoordinates.filter(function(o){return t._selectedFeatureIds.has(o.feature_id)});t._selectedCoordinates.length===n.length||e.silent||(t._emitSelectionChange=!0),t._selectedCoordinates=n}B.prototype.createRenderBatch=function(){var t=this,e=this.render,n=0;return this.render=function(){n++},function(){t.render=e,n>0&&t.render()}},B.prototype.setDirty=function(){return this.isDirty=!0,this},B.prototype.featureChanged=function(t){return this._changedFeatureIds.add(t),this},B.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},B.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},B.prototype.getAllIds=function(){return this._featureIds.values()},B.prototype.add=function(t){return this.featureChanged(t.id),this._features[t.id]=t,this._featureIds.add(t.id),this},B.prototype.delete=function(t,e){var n=this;return e===void 0&&(e={}),Je(t).forEach(function(o){n._featureIds.has(o)&&(n._featureIds.delete(o),n._selectedFeatureIds.delete(o),e.silent||n._deletedFeaturesToEmit.indexOf(n._features[o])===-1&&n._deletedFeaturesToEmit.push(n._features[o]),delete n._features[o],n.isDirty=!0)}),eo(this,e),this},B.prototype.get=function(t){return this._features[t]},B.prototype.getAll=function(){var t=this;return Object.keys(this._features).map(function(e){return t._features[e]})},B.prototype.select=function(t,e){var n=this;return e===void 0&&(e={}),Je(t).forEach(function(o){n._selectedFeatureIds.has(o)||(n._selectedFeatureIds.add(o),n._changedFeatureIds.add(o),e.silent||(n._emitSelectionChange=!0))}),this},B.prototype.deselect=function(t,e){var n=this;return e===void 0&&(e={}),Je(t).forEach(function(o){n._selectedFeatureIds.has(o)&&(n._selectedFeatureIds.delete(o),n._changedFeatureIds.add(o),e.silent||(n._emitSelectionChange=!0))}),eo(this,e),this},B.prototype.clearSelected=function(t){return t===void 0&&(t={}),this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this},B.prototype.setSelected=function(t,e){var n=this;return e===void 0&&(e={}),t=Je(t),this.deselect(this._selectedFeatureIds.values().filter(function(o){return t.indexOf(o)===-1}),{silent:e.silent}),this.select(t.filter(function(o){return!n._selectedFeatureIds.has(o)}),{silent:e.silent}),this},B.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this},B.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},B.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},B.prototype.getSelected=function(){var t=this;return this._selectedFeatureIds.values().map(function(e){return t.get(e)})},B.prototype.getSelectedCoordinates=function(){var t=this;return this._selectedCoordinates.map(function(e){return{coordinates:t.get(e.feature_id).getCoordinate(e.coord_path)}})},B.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)},B.prototype.setFeatureProperty=function(t,e,n){this.get(t).setProperty(e,n),this.featureChanged(t)},B.prototype.storeMapConfig=function(){var t=this;br.forEach(function(e){t.ctx.map[e]&&(t._mapInitialConfig[e]=t.ctx.map[e].isEnabled())})},B.prototype.restoreMapConfig=function(){var t=this;Object.keys(this._mapInitialConfig).forEach(function(e){t._mapInitialConfig[e]?t.ctx.map[e].enable():t.ctx.map[e].disable()})},B.prototype.getInitialConfigValue=function(t){return this._mapInitialConfig[t]===void 0||this._mapInitialConfig[t]};var Ft=function(){for(var t=arguments,e={},n=0;n<arguments.length;n++){var o=t[n];for(var s in o)Mr.call(o,s)&&(e[s]=o[s])}return e},Mr=Object.prototype.hasOwnProperty,Ir=["mode","feature","mouse"];function Lr(t){var e=null,n=null,o={onRemove:function(){return t.map.off("load",o.connect),clearInterval(n),o.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.map=null,t.container=null,t.store=null,e&&e.parentNode&&e.parentNode.removeChild(e),e=null,this},connect:function(){t.map.off("load",o.connect),clearInterval(n),o.addLayers(),t.store.storeMapConfig(),t.events.addEventListeners()},onAdd:function(s){var r=s.fire;return s.fire=function(a,f){var p=arguments;return r.length===1&&arguments.length!==1&&(p=[Ft({},{type:a},f)]),r.apply(s,p)},t.map=s,t.events=function(a){var f=Object.keys(a.options.modes).reduce(function(d,w){return d[w]=Er(a.options.modes[w]),d},{}),p={},v={},c={},y=null,_=null;c.drag=function(d,w){w({point:d.point,time:new Date().getTime()})?(a.ui.queueMapClasses({mouse:ar}),_.drag(d)):d.originalEvent.stopPropagation()},c.mousedrag=function(d){c.drag(d,function(w){return!Qn(p,w)})},c.touchdrag=function(d){c.drag(d,function(w){return!Xn(v,w)})},c.mousemove=function(d){if((d.originalEvent.buttons!==void 0?d.originalEvent.buttons:d.originalEvent.which)===1)return c.mousedrag(d);var w=hn(d,a);d.featureTarget=w,_.mousemove(d)},c.mousedown=function(d){p={time:new Date().getTime(),point:d.point};var w=hn(d,a);d.featureTarget=w,_.mousedown(d)},c.mouseup=function(d){var w=hn(d,a);d.featureTarget=w,Qn(p,{point:d.point,time:new Date().getTime()})?_.click(d):_.mouseup(d)},c.mouseout=function(d){_.mouseout(d)},c.touchstart=function(d){if(d.originalEvent.preventDefault(),a.options.touchEnabled){v={time:new Date().getTime(),point:d.point};var w=ve.touch(d,null,a)[0];d.featureTarget=w,_.touchstart(d)}},c.touchmove=function(d){if(d.originalEvent.preventDefault(),a.options.touchEnabled)return _.touchmove(d),c.touchdrag(d)},c.touchend=function(d){if(d.originalEvent.preventDefault(),a.options.touchEnabled){var w=ve.touch(d,null,a)[0];d.featureTarget=w,Xn(v,{time:new Date().getTime(),point:d.point})?_.tap(d):_.touchend(d)}};var E=function(d){return!(d===8||d===46||d>=48&&d<=57)};function I(d,w,A){A===void 0&&(A={}),_.stop();var j=f[d];if(j===void 0)throw new Error(d+" is not valid");y=d;var U=j(a,w);_=h(U,a),A.silent||a.map.fire(pr,{mode:d}),a.store.setDirty(),a.store.render()}c.keydown=function(d){(d.srcElement||d.target).classList[0]==="mapboxgl-canvas"&&(d.keyCode!==8&&d.keyCode!==46||!a.options.controls.trash?E(d.keyCode)?_.keydown(d):d.keyCode===49&&a.options.controls.point?I(k.DRAW_POINT):d.keyCode===50&&a.options.controls.line_string?I(k.DRAW_LINE_STRING):d.keyCode===51&&a.options.controls.polygon&&I(k.DRAW_POLYGON):(d.preventDefault(),_.trash()))},c.keyup=function(d){E(d.keyCode)&&_.keyup(d)},c.zoomend=function(){a.store.changeZoom()},c.data=function(d){if(d.dataType==="style"){var w=a.setup,A=a.map,j=a.options,U=a.store;j.styles.some(function(C){return A.getLayer(C.id)})||(w.addLayers(),U.setDirty(),U.render())}};var J={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){y=a.options.defaultMode,_=h(f[y](a),a)},changeMode:I,actionable:function(d){var w=!1;Object.keys(d).forEach(function(A){if(J[A]===void 0)throw new Error("Invalid action type");J[A]!==d[A]&&(w=!0),J[A]=d[A]}),w&&a.map.fire(fr,{actions:J})},currentModeName:function(){return y},currentModeRender:function(d,w){return _.render(d,w)},fire:function(d,w){c[d]&&c[d](w)},addEventListeners:function(){a.map.on("mousemove",c.mousemove),a.map.on("mousedown",c.mousedown),a.map.on("mouseup",c.mouseup),a.map.on("data",c.data),a.map.on("touchmove",c.touchmove),a.map.on("touchstart",c.touchstart),a.map.on("touchend",c.touchend),a.container.addEventListener("mouseout",c.mouseout),a.options.keybindings&&(a.container.addEventListener("keydown",c.keydown),a.container.addEventListener("keyup",c.keyup))},removeEventListeners:function(){a.map.off("mousemove",c.mousemove),a.map.off("mousedown",c.mousedown),a.map.off("mouseup",c.mouseup),a.map.off("data",c.data),a.map.off("touchmove",c.touchmove),a.map.off("touchstart",c.touchstart),a.map.off("touchend",c.touchend),a.container.removeEventListener("mouseout",c.mouseout),a.options.keybindings&&(a.container.removeEventListener("keydown",c.keydown),a.container.removeEventListener("keyup",c.keyup))},trash:function(d){_.trash(d)},combineFeatures:function(){_.combineFeatures()},uncombineFeatures:function(){_.uncombineFeatures()},getMode:function(){return y}}}(t),t.ui=function(a){var f={},p=null,v={mode:null,feature:null,mouse:null},c={mode:null,feature:null,mouse:null};function y(d){c=Ft(c,d)}function _(){var d,w;if(a.container){var A=[],j=[];Ir.forEach(function(U){c[U]!==v[U]&&(A.push(U+"-"+v[U]),c[U]!==null&&j.push(U+"-"+c[U]))}),A.length>0&&(d=a.container.classList).remove.apply(d,A),j.length>0&&(w=a.container.classList).add.apply(w,j),v=Ft(v,c)}}function E(d,w){w===void 0&&(w={});var A=document.createElement("button");return A.className=rt+" "+w.className,A.setAttribute("title",w.title),w.container.appendChild(A),A.addEventListener("click",function(j){if(j.preventDefault(),j.stopPropagation(),j.target===p)return I(),void w.onDeactivate();J(d),w.onActivate()},!0),A}function I(){p&&(p.classList.remove(qn),p=null)}function J(d){I();var w=f[d];w&&w&&d!=="trash"&&(w.classList.add(qn),p=w)}return{setActiveButton:J,queueMapClasses:y,updateMapClasses:_,clearMapClasses:function(){y({mode:null,feature:null,mouse:null}),_()},addButtons:function(){var d=a.options.controls,w=document.createElement("div");return w.className=rr+" "+Y,d&&(d[nt.LINE]&&(f[nt.LINE]=E(nt.LINE,{container:w,className:It,title:"LineString tool "+(a.options.keybindings?"(l)":""),onActivate:function(){return a.events.changeMode(k.DRAW_LINE_STRING)},onDeactivate:function(){return a.events.trash()}})),d[nt.POLYGON]&&(f[nt.POLYGON]=E(nt.POLYGON,{container:w,className:ct,title:"Polygon tool "+(a.options.keybindings?"(p)":""),onActivate:function(){return a.events.changeMode(k.DRAW_POLYGON)},onDeactivate:function(){return a.events.trash()}})),d[nt.POINT]&&(f[nt.POINT]=E(nt.POINT,{container:w,className:Bt,title:"Marker tool "+(a.options.keybindings?"(m)":""),onActivate:function(){return a.events.changeMode(k.DRAW_POINT)},onDeactivate:function(){return a.events.trash()}})),d.trash&&(f.trash=E("trash",{container:w,className:er,title:"Delete",onActivate:function(){a.events.trash()}})),d.combine_features&&(f.combine_features=E("combineFeatures",{container:w,className:nr,title:"Combine",onActivate:function(){a.events.combineFeatures()}})),d.uncombine_features&&(f.uncombine_features=E("uncombineFeatures",{container:w,className:or,title:"Uncombine",onActivate:function(){a.events.uncombineFeatures()}}))),w},removeButtons:function(){Object.keys(f).forEach(function(d){var w=f[d];w.parentNode&&w.parentNode.removeChild(w),delete f[d]})}}}(t),t.container=s.getContainer(),t.store=new B(t),e=t.ui.addButtons(),t.options.boxSelect&&(s.boxZoom.disable(),s.dragPan.disable(),s.dragPan.enable()),s.loaded()?o.connect():(s.on("load",o.connect),n=setInterval(function(){s.loaded()&&o.connect()},16)),t.events.start(),e},addLayers:function(){t.map.addSource(ye,{data:{type:Pt,features:[]},type:"geojson"}),t.map.addSource(Kt,{data:{type:Pt,features:[]},type:"geojson"}),t.options.styles.forEach(function(s){t.map.addLayer(s)}),t.store.setDirty(!0),t.store.render()},removeLayers:function(){t.options.styles.forEach(function(s){t.map.getLayer(s.id)&&t.map.removeLayer(s.id)}),t.map.getSource(ye)&&t.map.removeSource(ye),t.map.getSource(Kt)&&t.map.removeSource(Kt)}};return t.setup=o,o}function mn(t){return function(e){var n=e.featureTarget;return!!n&&!!n.properties&&n.properties.meta===t}}function Xt(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===vt&&t.featureTarget.properties.meta===Jt}function no(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===kt&&t.featureTarget.properties.meta===Jt}function vn(t){return t.featureTarget===void 0}function Ve(t){var e=t.featureTarget;return!!e&&!!e.properties&&e.properties.meta===me}function bn(t){return!!t.originalEvent&&t.originalEvent.shiftKey===!0}function _n(t){return t.keyCode===27}function wn(t){return t.keyCode===13}var Pr=te;function te(t,e){this.x=t,this.y=e}function Sn(t,e){var n=e.getBoundingClientRect();return new Pr(t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0))}function be(t,e,n,o){return{type:Z,properties:{meta:me,parent:t,coord_path:n,active:o?vt:kt},geometry:{type:ot,coordinates:e}}}function xn(t,e,n){e===void 0&&(e={}),n===void 0&&(n=null);var o,s=t.geometry,r=s.type,a=s.coordinates,f=t.properties&&t.properties.id,p=[];function v(y,_){var E="",I=null;y.forEach(function(J,d){var w=_!=null?_+"."+d:String(d),A=be(f,J,w,c(w));if(e.midpoints&&I){var j=function(C,qt,Tt){var O=qt.geometry.coordinates,lt=Tt.geometry.coordinates;if(O[1]>85||O[1]<-85||lt[1]>85||lt[1]<-85)return null;var et={lng:(O[0]+lt[0])/2,lat:(O[1]+lt[1])/2};return{type:Z,properties:{meta:fn,parent:C,lng:et.lng,lat:et.lat,coord_path:Tt.properties.coord_path},geometry:{type:ot,coordinates:[et.lng,et.lat]}}}(f,I,A);j&&p.push(j)}I=A;var U=JSON.stringify(J);E!==U&&p.push(A),d===0&&(E=U)})}function c(y){return!!e.selectedPaths&&e.selectedPaths.indexOf(y)!==-1}return r===ot?p.push(be(f,a,n,c(n))):r===Lt?a.forEach(function(y,_){v(y,n!==null?n+"."+_:String(_))}):r===Qt?v(a,n):r.indexOf(zn)===0&&(o=r.replace(zn,""),a.forEach(function(y,_){var E={type:Z,properties:t.properties,geometry:{type:o,coordinates:y}};p=p.concat(xn(E,e,_))})),p}te.prototype={clone:function(){return new te(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),o=e*this.x-n*this.y,s=n*this.x+e*this.y;return this.x=o,this.y=s,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),s=e.x+n*(this.x-e.x)-o*(this.y-e.y),r=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=s,this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},te.convert=function(t){return t instanceof te?t:Array.isArray(t)?new te(t[0],t[1]):t};var ee=function(t){setTimeout(function(){t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()},0)},Ge=function(t){setTimeout(function(){t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()},0)},oo=function(t){if(!t||!t.type)return null;var e=kr[t.type];if(!e)return null;if(e==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]};if(e==="feature")return{type:"FeatureCollection",features:[t]};if(e==="featurecollection")return t},kr={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function He(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce(function(e,n){return e.concat(He(n))},[]),t;case"Feature":return t.geometry?He(t.geometry).map(function(e){var n={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:e};return t.id!==void 0&&(n.id=t.id),n}):[t];case"MultiPoint":return t.coordinates.map(function(e){return{type:"Point",coordinates:e}});case"MultiPolygon":return t.coordinates.map(function(e){return{type:"Polygon",coordinates:e}});case"MultiLineString":return t.coordinates.map(function(e){return{type:"LineString",coordinates:e}});case"GeometryCollection":return t.geometries.map(He).reduce(function(e,n){return e.concat(n)},[]);case"Point":case"Polygon":case"LineString":return[t]}}var Fr=function(t){if(!t)return[];var e=He(oo(t)),n=[];return e.features.forEach(function(o){o.geometry&&(n=n.concat(function s(r){return Array.isArray(r)&&r.length&&typeof r[0]=="number"?[r]:r.reduce(function(a,f){return Array.isArray(f)&&Array.isArray(f[0])?a.concat(s(f)):(a.push(f),a)},[])}(o.geometry.coordinates)))}),n},Or=gn(function(t){var e=t.exports=function(c){return new n(c)};function n(c){this.value=c}function o(c,y,_){var E=[],I=[],J=!0;return function d(w){var A=_?s(w):w,j={},U=!0,C={node:A,node_:w,path:[].concat(E),parent:I[I.length-1],parents:I,key:E.slice(-1)[0],isRoot:E.length===0,level:E.length,circular:null,update:function(O,lt){C.isRoot||(C.parent.node[C.key]=O),C.node=O,lt&&(U=!1)},delete:function(O){delete C.parent.node[C.key],O&&(U=!1)},remove:function(O){f(C.parent.node)?C.parent.node.splice(C.key,1):delete C.parent.node[C.key],O&&(U=!1)},keys:null,before:function(O){j.before=O},after:function(O){j.after=O},pre:function(O){j.pre=O},post:function(O){j.post=O},stop:function(){J=!1},block:function(){U=!1}};if(!J)return C;function qt(){if(typeof C.node=="object"&&C.node!==null){C.keys&&C.node_===C.node||(C.keys=r(C.node)),C.isLeaf=C.keys.length==0;for(var O=0;O<I.length;O++)if(I[O].node_===w){C.circular=I[O];break}}else C.isLeaf=!0,C.keys=null;C.notLeaf=!C.isLeaf,C.notRoot=!C.isRoot}qt();var Tt=y.call(C,C.node);return Tt!==void 0&&C.update&&C.update(Tt),j.before&&j.before.call(C,C.node),U&&(typeof C.node!="object"||C.node===null||C.circular||(I.push(C),qt(),p(C.keys,function(O,lt){E.push(O),j.pre&&j.pre.call(C,C.node[O],O);var et=d(C.node[O]);_&&v.call(C.node,O)&&(C.node[O]=et.node),et.isLast=lt==C.keys.length-1,et.isFirst=lt==0,j.post&&j.post.call(C,et),E.pop()}),I.pop()),j.after&&j.after.call(C,C.node)),C}(c).node}function s(c){if(typeof c=="object"&&c!==null){var y;if(f(c))y=[];else if(a(c)==="[object Date]")y=new Date(c.getTime?c.getTime():c);else if(function(I){return a(I)==="[object RegExp]"}(c))y=new RegExp(c);else if(function(I){return a(I)==="[object Error]"}(c))y={message:c.message};else if(function(I){return a(I)==="[object Boolean]"}(c))y=new Boolean(c);else if(function(I){return a(I)==="[object Number]"}(c))y=new Number(c);else if(function(I){return a(I)==="[object String]"}(c))y=new String(c);else if(Object.create&&Object.getPrototypeOf)y=Object.create(Object.getPrototypeOf(c));else if(c.constructor===Object)y={};else{var _=c.constructor&&c.constructor.prototype||c.__proto__||{},E=function(){};E.prototype=_,y=new E}return p(r(c),function(I){y[I]=c[I]}),y}return c}n.prototype.get=function(c){for(var y=this.value,_=0;_<c.length;_++){var E=c[_];if(!y||!v.call(y,E)){y=void 0;break}y=y[E]}return y},n.prototype.has=function(c){for(var y=this.value,_=0;_<c.length;_++){var E=c[_];if(!y||!v.call(y,E))return!1;y=y[E]}return!0},n.prototype.set=function(c,y){for(var _=this.value,E=0;E<c.length-1;E++){var I=c[E];v.call(_,I)||(_[I]={}),_=_[I]}return _[c[E]]=y,y},n.prototype.map=function(c){return o(this.value,c,!0)},n.prototype.forEach=function(c){return this.value=o(this.value,c,!1),this.value},n.prototype.reduce=function(c,y){var _=arguments.length===1,E=_?this.value:y;return this.forEach(function(I){this.isRoot&&_||(E=c.call(this,E,I))}),E},n.prototype.paths=function(){var c=[];return this.forEach(function(y){c.push(this.path)}),c},n.prototype.nodes=function(){var c=[];return this.forEach(function(y){c.push(this.node)}),c},n.prototype.clone=function(){var c=[],y=[];return function _(E){for(var I=0;I<c.length;I++)if(c[I]===E)return y[I];if(typeof E=="object"&&E!==null){var J=s(E);return c.push(E),y.push(J),p(r(E),function(d){J[d]=_(E[d])}),c.pop(),y.pop(),J}return E}(this.value)};var r=Object.keys||function(c){var y=[];for(var _ in c)y.push(_);return y};function a(c){return Object.prototype.toString.call(c)}var f=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"},p=function(c,y){if(c.forEach)return c.forEach(y);for(var _=0;_<c.length;_++)y(c[_],_,c)};p(r(n.prototype),function(c){e[c]=function(y){var _=[].slice.call(arguments,1),E=new n(y);return E[c].apply(E,_)}});var v=Object.hasOwnProperty||function(c,y){return y in c}}),Tr=Q;function Q(t){if(!(this instanceof Q))return new Q(t);this._bbox=t||[1/0,1/0,-1/0,-1/0],this._valid=!!t}Q.prototype.include=function(t){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[0]),this._bbox[3]=Math.max(this._bbox[3],t[1]),this},Q.prototype.equals=function(t){var e;return e=t instanceof Q?t.bbox():t,this._bbox[0]==e[0]&&this._bbox[1]==e[1]&&this._bbox[2]==e[2]&&this._bbox[3]==e[3]},Q.prototype.center=function(t){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Q.prototype.union=function(t){var e;return this._valid=!0,e=t instanceof Q?t.bbox():t,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[2]),this._bbox[3]=Math.max(this._bbox[3],e[3]),this},Q.prototype.bbox=function(){return this._valid?this._bbox:null},Q.prototype.contains=function(t){if(!t)return this._fastContains();if(!this._valid)return null;var e=t[0],n=t[1];return this._bbox[0]<=e&&this._bbox[1]<=n&&this._bbox[2]>=e&&this._bbox[3]>=n},Q.prototype.intersect=function(t){return this._valid?(e=t instanceof Q?t.bbox():t,!(this._bbox[0]>e[2]||this._bbox[2]<e[0]||this._bbox[3]<e[1]||this._bbox[1]>e[3])):null;var e},Q.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var t="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",t)},Q.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var ro={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},jr=Object.keys(ro),En=function(t){return Cn(t).bbox()};function Cn(t){for(var e=Tr(),n=Fr(t),o=0;o<n.length;o++)e.include(n[o]);return e}En.polygon=function(t){return Cn(t).polygon()},En.bboxify=function(t){return Or(t).map(function(e){e&&jr.some(function(n){return!!e[n]&&ro[n].indexOf(e.type)!==-1})&&(e.bbox=Cn(e).bbox(),this.update(e))})};function io(t,e){var n=-90,o=90,s=-90,r=90,a=270,f=-270;t.forEach(function(v){var c=En(v),y=c[1],_=c[3],E=c[0],I=c[2];y>n&&(n=y),_<o&&(o=_),_>s&&(s=_),y<r&&(r=y),E<a&&(a=E),I>f&&(f=I)});var p=e;return n+p.lat>85&&(p.lat=85-n),s+p.lat>90&&(p.lat=90-s),o+p.lat<-85&&(p.lat=-85-o),r+p.lat<-90&&(p.lat=-90-r),a+p.lng<=-270&&(p.lng+=360*Math.ceil(Math.abs(p.lng)/360)),f+p.lng>=270&&(p.lng-=360*Math.ceil(Math.abs(p.lng)/360)),p}function ao(t,e){var n=io(t.map(function(o){return o.toGeoJSON()}),e);t.forEach(function(o){var s,r=o.getCoordinates(),a=function(p){var v={lng:p[0]+n.lng,lat:p[1]+n.lat};return[v.lng,v.lat]},f=function(p){return p.map(function(v){return a(v)})};o.type===ot?s=a(r):o.type===Qt||o.type===sr?s=r.map(a):o.type===Lt||o.type===cr?s=r.map(f):o.type===ur&&(s=r.map(function(p){return p.map(function(v){return f(v)})})),o.incomingCoords(s)})}var z={onSetup:function(t){var e=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter(function(o){return e.getFeature(o)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),n},fireUpdate:function(){this.map.fire(Wn,{action:mr,features:this.getSelected().map(function(t){return t.toGeoJSON()})})},fireActionable:function(){var t=this,e=this.getSelected(),n=e.filter(function(f){return t.isInstanceOf("MultiFeature",f)}),o=!1;if(e.length>1){o=!0;var s=e[0].type.replace("Multi","");e.forEach(function(f){f.type.replace("Multi","")!==s&&(o=!1)})}var r=n.length>0,a=e.length>0;this.setActionableState({combineFeatures:o,uncombineFeatures:r,trash:a})},getUniqueIds:function(t){return t.length?t.map(function(e){return e.properties.id}).filter(function(e){return e!==void 0}).reduce(function(e,n){return e.add(n),e},new ut).values():[]},stopExtendedInteractions:function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1},onStop:function(){ee(this)},onMouseMove:function(t){return this.stopExtendedInteractions(t),!0},onMouseOut:function(t){return!t.dragMoving||this.fireUpdate()}};z.onTap=z.onClick=function(t,e){return vn(e)?this.clickAnywhere(t,e):mn(me)(e)?this.clickOnVertex(t,e):function(n){return!!n.featureTarget&&!!n.featureTarget.properties&&n.featureTarget.properties.meta===Jt}(e)?this.clickOnFeature(t,e):void 0},z.clickAnywhere=function(t){var e=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach(function(o){return e.doRender(o)})),ee(this),this.stopExtendedInteractions(t)},z.clickOnVertex=function(t,e){this.changeMode(k.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.updateUIClasses({mouse:Ut})},z.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},z.clickOnFeature=function(t,e){var n=this;Ge(this),this.stopExtendedInteractions(t);var o=bn(e),s=this.getSelectedIds(),r=e.featureTarget.properties.id,a=this.isSelected(r);if(!o&&a&&this.getFeature(r).type!==ot)return this.changeMode(k.DIRECT_SELECT,{featureId:r});a&&o?(this.deselect(r),this.updateUIClasses({mouse:Re}),s.length===1&&ee(this)):!a&&o?(this.select(r),this.updateUIClasses({mouse:Ut})):a||o||(s.forEach(function(f){return n.doRender(f)}),this.setSelected(r),this.updateUIClasses({mouse:Ut})),this.doRender(r)},z.onMouseDown=function(t,e){return Xt(e)?this.startOnActiveFeature(t,e):this.drawConfig.boxSelect&&function(n){return!!n.originalEvent&&!!n.originalEvent.shiftKey&&n.originalEvent.button===0}(e)?this.startBoxSelect(t,e):void 0},z.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=Sn(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0},z.onTouchStart=function(t,e){if(Xt(e))return this.startOnActiveFeature(t,e)},z.onDrag=function(t,e){return t.canDragMove?this.dragMove(t,e):this.drawConfig.boxSelect&&t.canBoxSelect?this.whileBoxSelect(t,e):void 0},z.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:Rt}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(ir),this.map.getContainer().appendChild(t.boxSelectElement));var n=Sn(e.originalEvent,this.map.getContainer()),o=Math.min(t.boxSelectStartLocation.x,n.x),s=Math.max(t.boxSelectStartLocation.x,n.x),r=Math.min(t.boxSelectStartLocation.y,n.y),a=Math.max(t.boxSelectStartLocation.y,n.y),f="translate("+o+"px, "+r+"px)";t.boxSelectElement.style.transform=f,t.boxSelectElement.style.WebkitTransform=f,t.boxSelectElement.style.width=s-o+"px",t.boxSelectElement.style.height=a-r+"px"},z.dragMove=function(t,e){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};ao(this.getSelected(),n),t.dragMoveLocation=e.lngLat},z.onMouseUp=function(t,e){var n=this;if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){var o=[t.boxSelectStartLocation,Sn(e.originalEvent,this.map.getContainer())],s=this.featuresAt(null,o,"click"),r=this.getUniqueIds(s).filter(function(a){return!n.isSelected(a)});r.length&&(this.select(r),r.forEach(function(a){return n.doRender(a)}),this.updateUIClasses({mouse:Ut}))}this.stopExtendedInteractions(t)},z.toDisplayFeatures=function(t,e,n){e.properties.active=this.isSelected(e.properties.id)?vt:kt,n(e),this.fireActionable(),e.properties.active===vt&&e.geometry.type!==ot&&xn(e).forEach(n)},z.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},z.onCombineFeatures=function(){var t=this.getSelected();if(!(t.length===0||t.length<2)){for(var e=[],n=[],o=t[0].type.replace("Multi",""),s=0;s<t.length;s++){var r=t[s];if(r.type.replace("Multi","")!==o)return;r.type.includes("Multi")?r.getCoordinates().forEach(function(f){e.push(f)}):e.push(r.getCoordinates()),n.push(r.toGeoJSON())}if(n.length>1){var a=this.newFeature({type:Z,properties:n[0].properties,geometry:{type:"Multi"+o,coordinates:e}});this.addFeature(a),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([a.id]),this.map.fire(gr,{createdFeatures:[a.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},z.onUncombineFeatures=function(){var t=this,e=this.getSelected();if(e.length!==0){for(var n=[],o=[],s=function(a){var f=e[a];t.isInstanceOf("MultiFeature",f)&&(f.getFeatures().forEach(function(p){t.addFeature(p),p.properties=f.properties,n.push(p.toGeoJSON()),t.select([p.id])}),t.deleteFeature(f.id,{silent:!0}),o.push(f.toGeoJSON()))},r=0;r<e.length;r++)s(r);n.length>1&&this.map.fire(yr,{createdFeatures:n,deletedFeatures:o}),this.fireActionable()}};var so=mn(me),Ar=mn(fn),Ot={fireUpdate:function(){this.map.fire(Wn,{action:vr,features:this.getSelected().map(function(t){return t.toGeoJSON()})})},fireActionable:function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})},startDragging:function(t,e){this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},stopDragging:function(t){this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null},onVertex:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties,o=t.selectedCoordPaths.indexOf(n.coord_path);bn(e)||o!==-1?bn(e)&&o===-1&&t.selectedCoordPaths.push(n.coord_path):t.selectedCoordPaths=[n.coord_path];var s=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(s)},onMidpoint:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties;t.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),t.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(t,e){return e.map(function(n){return{feature_id:t,coord_path:n}})},onFeature:function(t,e){t.selectedCoordPaths.length===0?this.startDragging(t,e):this.stopDragging(t)},dragFeature:function(t,e,n){ao(this.getSelected(),n),t.dragMoveLocation=e.lngLat},dragVertex:function(t,e,n){for(var o=t.selectedCoordPaths.map(function(f){return t.feature.getCoordinate(f)}),s=io(o.map(function(f){return{type:Z,properties:{},geometry:{type:ot,coordinates:f}}}),n),r=0;r<o.length;r++){var a=o[r];t.feature.updateCoordinate(t.selectedCoordPaths[r],a[0]+s.lng,a[1]+s.lat)}},clickNoTarget:function(){this.changeMode(k.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(k.SIMPLE_SELECT)},clickActiveFeature:function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()},onSetup:function(t){var e=t.featureId,n=this.getFeature(e);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===ot)throw new TypeError("direct_select mode doesn't handle point features");var o={featureId:e,feature:n,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,o.selectedCoordPaths)),this.setSelected(e),Ge(this),this.setActionableState({trash:!0}),o},onStop:function(){ee(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(t,e,n){t.featureId===e.properties.id?(e.properties.active=vt,n(e),xn(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(n)):(e.properties.active=kt,n(e)),this.fireActionable(t)},onTrash:function(t){t.selectedCoordPaths.sort(function(e,n){return n.localeCompare(e,"en",{numeric:!0})}).forEach(function(e){return t.feature.removeCoordinate(e)}),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),t.feature.isValid()===!1&&(this.deleteFeature([t.featureId]),this.changeMode(k.SIMPLE_SELECT,{}))},onMouseMove:function(t,e){var n=Xt(e),o=so(e),s=t.selectedCoordPaths.length===0;return n&&s||o&&!s?this.updateUIClasses({mouse:Ut}):this.updateUIClasses({mouse:dn}),this.stopDragging(t),!0},onMouseOut:function(t){return t.dragMoving&&this.fireUpdate(),!0}};Ot.onTouchStart=Ot.onMouseDown=function(t,e){return so(e)?this.onVertex(t,e):Xt(e)?this.onFeature(t,e):Ar(e)?this.onMidpoint(t,e):void 0},Ot.onDrag=function(t,e){if(t.canDragMove===!0){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?this.dragVertex(t,e,n):this.dragFeature(t,e,n),t.dragMoveLocation=e.lngLat}},Ot.onClick=function(t,e){return vn(e)?this.clickNoTarget(t,e):Xt(e)?this.clickActiveFeature(t,e):no(e)?this.clickInactive(t,e):void this.stopDragging(t)},Ot.onTap=function(t,e){return vn(e)?this.clickNoTarget(t,e):Xt(e)?this.clickActiveFeature(t,e):no(e)?this.clickInactive(t,e):void 0},Ot.onTouchEnd=Ot.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};var ft={};function Mn(t,e){return!!t.lngLat&&t.lngLat.lng===e[0]&&t.lngLat.lat===e[1]}ft.onSetup=function(){var t=this.newFeature({type:Z,properties:{},geometry:{type:ot,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Rt}),this.activateUIButton(nt.POINT),this.setActionableState({trash:!0}),{point:t}},ft.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)},ft.onTap=ft.onClick=function(t,e){this.updateUIClasses({mouse:Ut}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(pn,{features:[t.point.toGeoJSON()]}),this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.point.id]})},ft.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},ft.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.point.id;if(e.properties.active=o?vt:kt,!o)return n(e)},ft.onTrash=ft.stopDrawingAndRemove,ft.onKeyUp=function(t,e){if(_n(e)||wn(e))return this.stopDrawingAndRemove(t,e)};var Gt={onSetup:function(){var t=this.newFeature({type:Z,properties:{},geometry:{type:Lt,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),Ge(this),this.updateUIClasses({mouse:Rt}),this.activateUIButton(nt.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&Mn(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:Rt}),t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),Ve(e)&&this.updateUIClasses({mouse:Re})}};Gt.onTap=Gt.onClick=function(t,e){return Ve(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},Gt.onKeyUp=function(t,e){_n(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)):wn(e)&&this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},Gt.onStop=function(t){this.updateUIClasses({mouse:dn}),ee(this),this.activateUIButton(),this.getFeature(t.polygon.id)!==void 0&&(t.polygon.removeCoordinate("0."+t.currentVertexPosition),t.polygon.isValid()?this.map.fire(pn,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT,{},{silent:!0})))},Gt.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.polygon.id;if(e.properties.active=o?vt:kt,!o)return n(e);if(e.geometry.coordinates.length!==0){var s=e.geometry.coordinates[0].length;if(!(s<3)){if(e.properties.meta=Jt,n(be(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),s>3){var r=e.geometry.coordinates[0].length-3;n(be(t.polygon.id,e.geometry.coordinates[0][r],"0."+r,!1))}if(s<=4){var a=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(n({type:Z,properties:e.properties,geometry:{coordinates:a,type:Qt}}),s===3)return}return n(e)}}},Gt.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)};var Ht={onSetup:function(t){var e,n,o=(t=t||{}).featureId,s="forward";if(o){if(!(e=this.getFeature(o)))throw new Error("Could not find a feature with the provided featureId");var r=t.from;if(r&&r.type==="Feature"&&r.geometry&&r.geometry.type==="Point"&&(r=r.geometry),r&&r.type==="Point"&&r.coordinates&&r.coordinates.length===2&&(r=r.coordinates),!r||!Array.isArray(r))throw new Error("Please use the `from` property to indicate which point to continue the line from");var a=e.coordinates.length-1;if(e.coordinates[a][0]===r[0]&&e.coordinates[a][1]===r[1])n=a+1,e.addCoordinate.apply(e,[n].concat(e.coordinates[a]));else{if(e.coordinates[0][0]!==r[0]||e.coordinates[0][1]!==r[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");s="backwards",n=0,e.addCoordinate.apply(e,[n].concat(e.coordinates[0]))}}else e=this.newFeature({type:Z,properties:{},geometry:{type:Qt,coordinates:[]}}),n=0,this.addFeature(e);return this.clearSelectedFeatures(),Ge(this),this.updateUIClasses({mouse:Rt}),this.activateUIButton(nt.LINE),this.setActionableState({trash:!0}),{line:e,currentVertexPosition:n,direction:s}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&Mn(e,t.line.coordinates[t.currentVertexPosition-1])||t.direction==="backwards"&&Mn(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:Rt}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.direction==="forward"?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.line.id]})},onMouseMove:function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),Ve(e)&&this.updateUIClasses({mouse:Re})}};Ht.onTap=Ht.onClick=function(t,e){if(Ve(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)},Ht.onKeyUp=function(t,e){wn(e)?this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.line.id]}):_n(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT))},Ht.onStop=function(t){ee(this),this.activateUIButton(),this.getFeature(t.line.id)!==void 0&&(t.line.removeCoordinate(""+t.currentVertexPosition),t.line.isValid()?this.map.fire(pn,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT,{},{silent:!0})))},Ht.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)},Ht.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.line.id;if(e.properties.active=o?vt:kt,!o)return n(e);e.geometry.coordinates.length<2||(e.properties.meta=Jt,n(be(t.line.id,e.geometry.coordinates[t.direction==="forward"?e.geometry.coordinates.length-2:1],""+(t.direction==="forward"?e.geometry.coordinates.length-2:1),!1)),n(e))};var co={simple_select:z,direct_select:Ot,draw_point:ft,draw_polygon:Gt,draw_line_string:Ht},Dr={defaultMode:k.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:co,controls:{},userProperties:!1},$r={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Nr={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function uo(t,e){return t.map(function(n){return n.source?n:Ft(n,{id:n.id+"."+e,source:e==="hot"?Kt:ye})})}var Br=gn(function(t,e){var n="[object Arguments]",o="[object Map]",s="[object Object]",r="[object Set]",a=/^\[object .+?Constructor\]$/,f=/^(?:0|[1-9]\d*)$/,p={};p["[object Float32Array]"]=p["[object Float64Array]"]=p["[object Int8Array]"]=p["[object Int16Array]"]=p["[object Int32Array]"]=p["[object Uint8Array]"]=p["[object Uint8ClampedArray]"]=p["[object Uint16Array]"]=p["[object Uint32Array]"]=!0,p[n]=p["[object Array]"]=p["[object ArrayBuffer]"]=p["[object Boolean]"]=p["[object DataView]"]=p["[object Date]"]=p["[object Error]"]=p["[object Function]"]=p[o]=p["[object Number]"]=p[s]=p["[object RegExp]"]=p[r]=p["[object String]"]=p["[object WeakMap]"]=!1;var v=typeof Me=="object"&&Me&&Me.Object===Object&&Me,c=typeof self=="object"&&self&&self.Object===Object&&self,y=v||c||Function("return this")(),_=e&&!e.nodeType&&e,E=_&&t&&!t.nodeType&&t,I=E&&E.exports===_,J=I&&v.process,d=function(){try{return J&&J.binding&&J.binding("util")}catch{}}(),w=d&&d.isTypedArray;function A(i,u){for(var m=-1,x=i==null?0:i.length;++m<x;)if(u(i[m],m,i))return!0;return!1}function j(i){var u=-1,m=Array(i.size);return i.forEach(function(x,R){m[++u]=[R,x]}),m}function U(i){var u=-1,m=Array(i.size);return i.forEach(function(x){m[++u]=x}),m}var C,qt,Tt,O=Array.prototype,lt=Function.prototype,et=Object.prototype,In=y["__core-js_shared__"],po=lt.toString,ht=et.hasOwnProperty,fo=(C=/[^.]+$/.exec(In&&In.keys&&In.keys.IE_PROTO||""))?"Symbol(src)_1."+C:"",ho=et.toString,Vr=RegExp("^"+po.call(ht).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),go=I?y.Buffer:void 0,qe=y.Symbol,yo=y.Uint8Array,mo=et.propertyIsEnumerable,Gr=O.splice,zt=qe?qe.toStringTag:void 0,vo=Object.getOwnPropertySymbols,Hr=go?go.isBuffer:void 0,qr=(qt=Object.keys,Tt=Object,function(i){return qt(Tt(i))}),Ln=ne(y,"DataView"),_e=ne(y,"Map"),Pn=ne(y,"Promise"),kn=ne(y,"Set"),Fn=ne(y,"WeakMap"),we=ne(Object,"create"),zr=Zt(Ln),Wr=Zt(_e),Yr=Zt(Pn),Zr=Zt(kn),Kr=Zt(Fn),bo=qe?qe.prototype:void 0,On=bo?bo.valueOf:void 0;function Wt(i){var u=-1,m=i==null?0:i.length;for(this.clear();++u<m;){var x=i[u];this.set(x[0],x[1])}}function _t(i){var u=-1,m=i==null?0:i.length;for(this.clear();++u<m;){var x=i[u];this.set(x[0],x[1])}}function Yt(i){var u=-1,m=i==null?0:i.length;for(this.clear();++u<m;){var x=i[u];this.set(x[0],x[1])}}function ze(i){var u=-1,m=i==null?0:i.length;for(this.__data__=new Yt;++u<m;)this.add(i[u])}function jt(i){var u=this.__data__=new _t(i);this.size=u.size}function Qr(i,u){var m=Ze(i),x=!m&&oi(i),R=!m&&!x&&Tn(i),P=!m&&!x&&!R&&Lo(i),V=m||x||R||P,G=V?function(q,gt){for(var wt=-1,X=Array(q);++wt<q;)X[wt]=gt(wt);return X}(i.length,String):[],dt=G.length;for(var H in i)!u&&!ht.call(i,H)||V&&(H=="length"||R&&(H=="offset"||H=="parent")||P&&(H=="buffer"||H=="byteLength"||H=="byteOffset")||ni(H,dt))||G.push(H);return G}function We(i,u){for(var m=i.length;m--;)if(Eo(i[m][0],u))return m;return-1}function Se(i){return i==null?i===void 0?"[object Undefined]":"[object Null]":zt&&zt in Object(i)?function(u){var m=ht.call(u,zt),x=u[zt];try{u[zt]=void 0;var R=!0}catch{}var P=ho.call(u);return R&&(m?u[zt]=x:delete u[zt]),P}(i):function(u){return ho.call(u)}(i)}function _o(i){return xe(i)&&Se(i)==n}function wo(i,u,m,x,R){return i===u||(i==null||u==null||!xe(i)&&!xe(u)?i!=i&&u!=u:function(P,V,G,dt,H,q){var gt=Ze(P),wt=Ze(V),X=gt?"[object Array]":At(P),St=wt?"[object Array]":At(V),oe=(X=X==n?s:X)==s,Ke=(St=St==n?s:St)==s,re=X==St;if(re&&Tn(P)){if(!Tn(V))return!1;gt=!0,oe=!1}if(re&&!oe)return q||(q=new jt),gt||Lo(P)?So(P,V,G,dt,H,q):function(N,D,Qe,Dt,jn,at,xt){switch(Qe){case"[object DataView]":if(N.byteLength!=D.byteLength||N.byteOffset!=D.byteOffset)return!1;N=N.buffer,D=D.buffer;case"[object ArrayBuffer]":return!(N.byteLength!=D.byteLength||!at(new yo(N),new yo(D)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Eo(+N,+D);case"[object Error]":return N.name==D.name&&N.message==D.message;case"[object RegExp]":case"[object String]":return N==D+"";case o:var $t=j;case r:var Ce=1&Dt;if($t||($t=U),N.size!=D.size&&!Ce)return!1;var Xe=xt.get(N);if(Xe)return Xe==D;Dt|=2,xt.set(N,D);var ie=So($t(N),$t(D),Dt,jn,at,xt);return xt.delete(N),ie;case"[object Symbol]":if(On)return On.call(N)==On.call(D)}return!1}(P,V,X,G,dt,H,q);if(!(1&G)){var Ee=oe&&ht.call(P,"__wrapped__"),Po=Ke&&ht.call(V,"__wrapped__");if(Ee||Po){var ii=Ee?P.value():P,ai=Po?V.value():V;return q||(q=new jt),H(ii,ai,G,dt,q)}}return re?(q||(q=new jt),function(N,D,Qe,Dt,jn,at){var xt=1&Qe,$t=xo(N),Ce=$t.length,Xe=xo(D).length;if(Ce!=Xe&&!xt)return!1;for(var ie=Ce;ie--;){var Nt=$t[ie];if(!(xt?Nt in D:ht.call(D,Nt)))return!1}var ko=at.get(N);if(ko&&at.get(D))return ko==D;var tn=!0;at.set(N,D),at.set(D,N);for(var An=xt;++ie<Ce;){Nt=$t[ie];var en=N[Nt],nn=D[Nt];if(Dt)var Fo=xt?Dt(nn,en,Nt,D,N,at):Dt(en,nn,Nt,N,D,at);if(!(Fo===void 0?en===nn||jn(en,nn,Qe,Dt,at):Fo)){tn=!1;break}An||(An=Nt=="constructor")}if(tn&&!An){var on=N.constructor,rn=D.constructor;on==rn||!("constructor"in N)||!("constructor"in D)||typeof on=="function"&&on instanceof on&&typeof rn=="function"&&rn instanceof rn||(tn=!1)}return at.delete(N),at.delete(D),tn}(P,V,G,dt,H,q)):!1}(i,u,m,x,wo,R))}function Xr(i){return!(!Io(i)||function(u){return!!fo&&fo in u}(i))&&(Co(i)?Vr:a).test(Zt(i))}function ti(i){if(m=(u=i)&&u.constructor,x=typeof m=="function"&&m.prototype||et,u!==x)return qr(i);var u,m,x,R=[];for(var P in Object(i))ht.call(i,P)&&P!="constructor"&&R.push(P);return R}function So(i,u,m,x,R,P){var V=1&m,G=i.length,dt=u.length;if(G!=dt&&!(V&&dt>G))return!1;var H=P.get(i);if(H&&P.get(u))return H==u;var q=-1,gt=!0,wt=2&m?new ze:void 0;for(P.set(i,u),P.set(u,i);++q<G;){var X=i[q],St=u[q];if(x)var oe=V?x(St,X,q,u,i,P):x(X,St,q,i,u,P);if(oe!==void 0){if(oe)continue;gt=!1;break}if(wt){if(!A(u,function(Ke,re){if(Ee=re,!wt.has(Ee)&&(X===Ke||R(X,Ke,m,x,P)))return wt.push(re);var Ee})){gt=!1;break}}else if(X!==St&&!R(X,St,m,x,P)){gt=!1;break}}return P.delete(i),P.delete(u),gt}function xo(i){return function(u,m,x){var R=m(u);return Ze(u)?R:function(P,V){for(var G=-1,dt=V.length,H=P.length;++G<dt;)P[H+G]=V[G];return P}(R,x(u))}(i,ri,ei)}function Ye(i,u){var m,x,R=i.__data__;return((x=typeof(m=u))=="string"||x=="number"||x=="symbol"||x=="boolean"?m!=="__proto__":m===null)?R[typeof u=="string"?"string":"hash"]:R.map}function ne(i,u){var m=function(x,R){return x==null?void 0:x[R]}(i,u);return Xr(m)?m:void 0}Wt.prototype.clear=function(){this.__data__=we?we(null):{},this.size=0},Wt.prototype.delete=function(i){var u=this.has(i)&&delete this.__data__[i];return this.size-=u?1:0,u},Wt.prototype.get=function(i){var u=this.__data__;if(we){var m=u[i];return m==="__lodash_hash_undefined__"?void 0:m}return ht.call(u,i)?u[i]:void 0},Wt.prototype.has=function(i){var u=this.__data__;return we?u[i]!==void 0:ht.call(u,i)},Wt.prototype.set=function(i,u){var m=this.__data__;return this.size+=this.has(i)?0:1,m[i]=we&&u===void 0?"__lodash_hash_undefined__":u,this},_t.prototype.clear=function(){this.__data__=[],this.size=0},_t.prototype.delete=function(i){var u=this.__data__,m=We(u,i);return!(m<0)&&(m==u.length-1?u.pop():Gr.call(u,m,1),--this.size,!0)},_t.prototype.get=function(i){var u=this.__data__,m=We(u,i);return m<0?void 0:u[m][1]},_t.prototype.has=function(i){return We(this.__data__,i)>-1},_t.prototype.set=function(i,u){var m=this.__data__,x=We(m,i);return x<0?(++this.size,m.push([i,u])):m[x][1]=u,this},Yt.prototype.clear=function(){this.size=0,this.__data__={hash:new Wt,map:new(_e||_t),string:new Wt}},Yt.prototype.delete=function(i){var u=Ye(this,i).delete(i);return this.size-=u?1:0,u},Yt.prototype.get=function(i){return Ye(this,i).get(i)},Yt.prototype.has=function(i){return Ye(this,i).has(i)},Yt.prototype.set=function(i,u){var m=Ye(this,i),x=m.size;return m.set(i,u),this.size+=m.size==x?0:1,this},ze.prototype.add=ze.prototype.push=function(i){return this.__data__.set(i,"__lodash_hash_undefined__"),this},ze.prototype.has=function(i){return this.__data__.has(i)},jt.prototype.clear=function(){this.__data__=new _t,this.size=0},jt.prototype.delete=function(i){var u=this.__data__,m=u.delete(i);return this.size=u.size,m},jt.prototype.get=function(i){return this.__data__.get(i)},jt.prototype.has=function(i){return this.__data__.has(i)},jt.prototype.set=function(i,u){var m=this.__data__;if(m instanceof _t){var x=m.__data__;if(!_e||x.length<199)return x.push([i,u]),this.size=++m.size,this;m=this.__data__=new Yt(x)}return m.set(i,u),this.size=m.size,this};var ei=vo?function(i){return i==null?[]:(i=Object(i),function(u,m){for(var x=-1,R=u==null?0:u.length,P=0,V=[];++x<R;){var G=u[x];m(G,x,u)&&(V[P++]=G)}return V}(vo(i),function(u){return mo.call(i,u)}))}:function(){return[]},At=Se;function ni(i,u){return!!(u=u??9007199254740991)&&(typeof i=="number"||f.test(i))&&i>-1&&i%1==0&&i<u}function Zt(i){if(i!=null){try{return po.call(i)}catch{}try{return i+""}catch{}}return""}function Eo(i,u){return i===u||i!=i&&u!=u}(Ln&&At(new Ln(new ArrayBuffer(1)))!="[object DataView]"||_e&&At(new _e)!=o||Pn&&At(Pn.resolve())!="[object Promise]"||kn&&At(new kn)!=r||Fn&&At(new Fn)!="[object WeakMap]")&&(At=function(i){var u=Se(i),m=u==s?i.constructor:void 0,x=m?Zt(m):"";if(x)switch(x){case zr:return"[object DataView]";case Wr:return o;case Yr:return"[object Promise]";case Zr:return r;case Kr:return"[object WeakMap]"}return u});var oi=_o(function(){return arguments}())?_o:function(i){return xe(i)&&ht.call(i,"callee")&&!mo.call(i,"callee")},Ze=Array.isArray,Tn=Hr||function(){return!1};function Co(i){if(!Io(i))return!1;var u=Se(i);return u=="[object Function]"||u=="[object GeneratorFunction]"||u=="[object AsyncFunction]"||u=="[object Proxy]"}function Mo(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=9007199254740991}function Io(i){var u=typeof i;return i!=null&&(u=="object"||u=="function")}function xe(i){return i!=null&&typeof i=="object"}var Lo=w?function(i){return function(u){return i(u)}}(w):function(i){return xe(i)&&Mo(i.length)&&!!p[Se(i)]};function ri(i){return(u=i)!=null&&Mo(u.length)&&!Co(u)?Qr(i):ti(i);var u}t.exports=function(i,u){return wo(i,u)}}),Rr={Polygon:it,LineString:bt,Point:Vt,MultiPolygon:tt,MultiLineString:tt,MultiPoint:tt};function Ur(t,e){return e.modes=k,e.getFeatureIdsAt=function(n){return ve.click({point:n},null,t).map(function(o){return o.properties.id})},e.getSelectedIds=function(){return t.store.getSelectedIds()},e.getSelected=function(){return{type:Pt,features:t.store.getSelectedIds().map(function(n){return t.store.get(n)}).map(function(n){return n.toGeoJSON()})}},e.getSelectedPoints=function(){return{type:Pt,features:t.store.getSelectedCoordinates().map(function(n){return{type:Z,properties:{},geometry:{type:ot,coordinates:n.coordinates}}})}},e.set=function(n){if(n.type===void 0||n.type!==Pt||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");var o=t.store.createRenderBatch(),s=t.store.getAllIds().slice(),r=e.add(n),a=new ut(r);return(s=s.filter(function(f){return!a.has(f)})).length&&e.delete(s),o(),r},e.add=function(n){var o=JSON.parse(JSON.stringify(oo(n))).features.map(function(s){if(s.id=s.id||yn(),s.geometry===null)throw new Error("Invalid geometry: null");if(t.store.get(s.id)===void 0||t.store.get(s.id).type!==s.geometry.type){var r=Rr[s.geometry.type];if(r===void 0)throw new Error("Invalid geometry type: "+s.geometry.type+".");var a=new r(t,s);t.store.add(a)}else{var f=t.store.get(s.id);f.properties=s.properties,Br(f.getCoordinates(),s.geometry.coordinates)||f.incomingCoords(s.geometry.coordinates)}return s.id});return t.store.render(),o},e.get=function(n){var o=t.store.get(n);if(o)return o.toGeoJSON()},e.getAll=function(){return{type:Pt,features:t.store.getAll().map(function(n){return n.toGeoJSON()})}},e.delete=function(n){return t.store.delete(n,{silent:!0}),e.getMode()!==k.DIRECT_SELECT||t.store.getSelectedIds().length?t.store.render():t.events.changeMode(k.SIMPLE_SELECT,void 0,{silent:!0}),e},e.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:!0}),e.getMode()===k.DIRECT_SELECT?t.events.changeMode(k.SIMPLE_SELECT,void 0,{silent:!0}):t.store.render(),e},e.changeMode=function(n,o){return o===void 0&&(o={}),n===k.SIMPLE_SELECT&&e.getMode()===k.SIMPLE_SELECT?(s=o.featureIds||[],r=t.store.getSelectedIds(),s.length===r.length&&JSON.stringify(s.map(function(a){return a}).sort())===JSON.stringify(r.map(function(a){return a}).sort())||(t.store.setSelected(o.featureIds,{silent:!0}),t.store.render()),e):(n===k.DIRECT_SELECT&&e.getMode()===k.DIRECT_SELECT&&o.featureId===t.store.getSelectedIds()[0]||t.events.changeMode(n,o,{silent:!0}),e);var s,r},e.getMode=function(){return t.events.getMode()},e.trash=function(){return t.events.trash({silent:!0}),e},e.combineFeatures=function(){return t.events.combineFeatures({silent:!0}),e},e.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:!0}),e},e.setFeatureProperty=function(n,o,s){return t.store.setFeatureProperty(n,o,s),e},e}var Jr=function(t,e){var n={options:t=function(s){s===void 0&&(s={});var r=Ft(s);return s.controls||(r.controls={}),s.displayControlsDefault===!1?r.controls=Ft(Nr,s.controls):r.controls=Ft($r,s.controls),(r=Ft(Dr,r)).styles=uo(r.styles,"cold").concat(uo(r.styles,"hot")),r}(t)};e=Ur(n,e),n.api=e;var o=Lr(n);return e.onAdd=o.onAdd,e.onRemove=o.onRemove,e.types=nt,e.options=t,e};function lo(t){Jr(t,this)}return lo.modes=co,lo})})(pt);let T;const Un=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Un.decode();let Ie=new Uint8Array;function se(){return Ie.byteLength===0&&(Ie=new Uint8Array(T.memory.buffer)),Ie}function ce(g,l){return Un.decode(se().subarray(g,g+l))}const yt=new Array(32).fill(void 0);yt.push(void 0,null,!0,!1);let ue=yt.length;function Jn(g){ue===yt.length&&yt.push(yt.length+1);const l=ue;return ue=yt[l],yt[l]=g,l}function an(g){return yt[g]}function Do(g){g<36||(yt[g]=ue,ue=g)}function Vn(g){const l=an(g);return Do(g),l}let le=0;function $o(g,l){const h=l(g.length*1);return se().set(g,h/1),le=g.length,h}let Le=new Int32Array;function mt(){return Le.byteLength===0&&(Le=new Int32Array(T.memory.buffer)),Le}const Pe=new TextEncoder("utf-8"),No=typeof Pe.encodeInto=="function"?function(g,l){return Pe.encodeInto(g,l)}:function(g,l){const h=Pe.encode(g);return l.set(h),{read:g.length,written:h.length}};function Bo(g,l,h){if(h===void 0){const $=Pe.encode(g),Y=l($.length);return se().subarray(Y,Y+$.length).set($),le=$.length,Y}let b=g.length,S=l(b);const F=se();let M=0;for(;M<b;M++){const $=g.charCodeAt(M);if($>127)break;F[S+M]=$}if(M!==b){M!==0&&(g=g.slice(M)),S=h(S,b,b=M+g.length*3);const $=se().subarray(S+M,S+b),Y=No(g,$);M+=Y.written}return le=M,S}class ke{static __wrap(l){const h=Object.create(ke.prototype);return h.ptr=l,h}__destroy_into_raw(){const l=this.ptr;return this.ptr=0,l}free(){const l=this.__destroy_into_raw();T.__wbg_jsroutesnapper_free(l)}constructor(l){try{const F=T.__wbindgen_add_to_stack_pointer(-16),M=$o(l,T.__wbindgen_malloc),$=le;T.jsroutesnapper_new(F,M,$);var h=mt()[F/4+0],b=mt()[F/4+1],S=mt()[F/4+2];if(S)throw Vn(b);return ke.__wrap(h)}finally{T.__wbindgen_add_to_stack_pointer(16)}}toFinalFeature(){try{const b=T.__wbindgen_add_to_stack_pointer(-16);T.jsroutesnapper_toFinalFeature(b,this.ptr);var l=mt()[b/4+0],h=mt()[b/4+1];let S;return l!==0&&(S=ce(l,h).slice(),T.__wbindgen_free(l,h*1)),S}finally{T.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const b=T.__wbindgen_add_to_stack_pointer(-16);T.jsroutesnapper_renderGeojson(b,this.ptr);var l=mt()[b/4+0],h=mt()[b/4+1];return ce(l,h)}finally{T.__wbindgen_add_to_stack_pointer(16),T.__wbindgen_free(l,h)}}setSnapMode(l){T.jsroutesnapper_setSnapMode(this.ptr,l)}onMouseMove(l,h,b){return T.jsroutesnapper_onMouseMove(this.ptr,l,h,b)!==0}onClick(){T.jsroutesnapper_onClick(this.ptr)}onDragStart(){return T.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return T.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){T.jsroutesnapper_clearState(this.ptr)}}async function Ro(g,l){if(typeof Response=="function"&&g instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(g,l)}catch(b){if(g.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",b);else throw b}const h=await g.arrayBuffer();return await WebAssembly.instantiate(h,l)}else{const h=await WebAssembly.instantiate(g,l);return h instanceof WebAssembly.Instance?{instance:h,module:g}:h}}function Uo(){const g={};return g.wbg={},g.wbg.__wbindgen_string_new=function(l,h){const b=ce(l,h);return Jn(b)},g.wbg.__wbindgen_object_drop_ref=function(l){Vn(l)},g.wbg.__wbg_log_4b5638ad60bdc54a=function(l){console.log(an(l))},g.wbg.__wbg_new_abda76e883ba8a5f=function(){const l=new Error;return Jn(l)},g.wbg.__wbg_stack_658279fe44541cf6=function(l,h){const b=an(h).stack,S=Bo(b,T.__wbindgen_malloc,T.__wbindgen_realloc),F=le;mt()[l/4+1]=F,mt()[l/4+0]=S},g.wbg.__wbg_error_f851667af71bcfc6=function(l,h){try{console.error(ce(l,h))}finally{T.__wbindgen_free(l,h)}},g.wbg.__wbindgen_throw=function(l,h){throw new Error(ce(l,h))},g}function Jo(g,l){return T=g.exports,Gn.__wbindgen_wasm_module=l,Le=new Int32Array,Ie=new Uint8Array,T}async function Gn(g){typeof g>"u"&&(g="/atip/assets/route_snapper_bg.wasm");const l=Uo();(typeof g=="string"||typeof Request=="function"&&g instanceof Request||typeof URL=="function"&&g instanceof URL)&&(g=fetch(g));const{instance:h,module:b}=await Ro(await g,l);return Jo(h,b)}await Gn();class Vo{constructor(l,h,b){Et(this,pe);Et(this,$e);Et(this,fe);Et(this,Mt);this.controlDiv=b,this.map=l,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new ke(h),console.timeEnd("Deserialize and setup JsRouteSnapper"),console.log("JsRouteSnapper ready, waiting for idle event"),this.active=!1,this.map.once("idle",()=>{console.log("JsRouteSnapper now usable"),this.map.addSource("route-snapper",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"route-points",type:"circle",source:"route-snapper",paint:{"circle-radius":10,"circle-color":["match",["get","type"],"hovered","green","important","red","black"],"circle-opacity":["match",["get","type"],"unimportant",0,1],"circle-stroke-width":["match",["get","type"],"unimportant",2,0],"circle-stroke-color":"black"},filter:["in","$type","Point"]}),this.map.addLayer({id:"route-lines",type:"line",source:"route-snapper",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":2.5},filter:["in","$type","LineString"]}),this.map.on("mousemove",S=>{if(!this.active)return;const F={x:S.point.x-10,y:S.point.y},M=this.map.unproject(S.point).distanceTo(this.map.unproject(F));this.inner.onMouseMove(S.lngLat.lng,S.lngLat.lat,M)&&W(this,Mt,ae).call(this)}),this.map.on("click",()=>{this.active&&(this.inner.onClick(),W(this,Mt,ae).call(this))}),this.map.on("dragstart",S=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}),this.map.on("mouseup",S=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}),document.addEventListener("keypress",S=>{this.active&&S.key=="Enter"&&(S.preventDefault(),W(this,fe,Nn).call(this))}),document.addEventListener("keydown",S=>{this.active&&S.key=="Shift"&&(S.preventDefault(),this.inner.setSnapMode(!1),W(this,Mt,ae).call(this))}),document.addEventListener("keyup",S=>{this.active&&S.key=="Shift"&&(S.preventDefault(),this.inner.setSnapMode(!0),W(this,Mt,ae).call(this))}),W(this,pe,$n).call(this)})}}pe=new WeakSet,$n=function(){this.active=!1,this.inner.clearState(),W(this,Mt,ae).call(this),this.controlDiv.innerHTML="";var l=document.createElement("button");l.innerText="Route tool",l.type="button",l.onclick=()=>{W(this,$e,To).call(this)},this.controlDiv.appendChild(l)},$e=new WeakSet,To=function(){this.active=!0,this.controlDiv.innerHTML="";var l=document.createElement("button");l.type="button",l.innerText="Finish route",l.onclick=()=>{W(this,fe,Nn).call(this)},this.controlDiv.appendChild(l);const h=document.createElement("ul");h.innerHTML="<li><b>Click</b> green points on the transport network</br>to create snapped routes</li><li>Hold <b>Shift</b> to draw a point anywhere</li><li><b>Click and drag</b> any point to move it</li><li><b>Click</b> a red waypoint to delete it</li><li>Press <b>Enter</b> to finish route</li>",this.controlDiv.appendChild(h)},fe=new WeakSet,Nn=function(){const l=this.inner.toFinalFeature();l&&this.controlDiv.dispatchEvent(new CustomEvent("new-route",{detail:JSON.parse(l)})),W(this,pe,$n).call(this)},Mt=new WeakSet,ae=function(){this.map.getSource("route-snapper").setData(JSON.parse(this.inner.renderGeojson()))};async function Go(g,l){const h=await fetch(g),b=h.body.getReader(),S=h.headers.get("Content-Length"),F=document.getElementById(l);let M=0,$=[];for(;;){const{done:It,value:ct}=await b.read();if(It)break;$.push(ct),M+=ct.length;const Bt=100*M/S;F.style=`background: linear-gradient(to right, red ${Bt}%, transparent 0);`}let Y=new Uint8Array(M),rt=0;for(let It of $)Y.set(It,rt),rt+=It.length;return Y}function Ho(g,l,h,b){var S='<div style="display: flex; justify-content: space-between;">';for(const F of b){const M=g[h]==F?"checked":"";S+=`<input type="radio" id="${F}" name="${l}" ${M}>`;const $=F.charAt(0).toUpperCase()+F.slice(1);S+=`<label for="${F}">${$}</label>`}return S+="</div>",S}const qo=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],Fe="black",sn="yellow",cn="red",Oe=7,Te=10,zo={"line-cap":"round","line-join":"round"},je=["==","$type","Polygon"],un=["==","$type","LineString"],Ae=["==","$type","Point"];function de(g,l,h=1){return{type:"line",layout:zo,paint:{"line-color":g,"line-width":l,"line-opacity":h}}}function ln(g,l){return{type:"fill",paint:{"fill-color":g,"fill-opacity":l}}}function De(g,l,h=1){return{type:"circle",paint:{"circle-radius":l,"circle-color":g,"circle-opacity":h}}}const Wo=[{id:"boundary",source:"boundary",...de("black",3,.5)},{id:"hover-polygons",source:"hover",filter:je,...ln(sn,.5)},{id:"hover-lines",source:"hover",filter:un,...de(sn,1.5*Te,1)},{id:"hover-points",source:"hover",filter:Ae,...De(sn,1.5*Oe,.5)},{id:"editing-polygons",source:"editing",filter:je,...ln(cn,.5)},{id:"editing-lines",source:"editing",filter:un,...de(cn,1.5*Te)},{id:"editing-points",source:"editing",filter:Ae,...De(cn,1.5*Oe)}],Yo=qo.concat([{id:"base-points",filter:["all",Ae,["==","meta","feature"]],...De(Fe,Oe)},{id:"draggable-points",filter:["all",Ae,["!=","meta","feature"]],...De("blue",1.5*Oe)},{id:"base-line",filter:un,...de(Fe,Te)},{id:"base-polygon-fill",filter:je,...ln(Fe,.1)},{id:"base-polygon-outline",filter:je,...de(Fe,Te/2)}]);class Zo{constructor(){Et(this,Ne);Et(this,he);Et(this,Be);Et(this,ge);const l=new URLSearchParams(window.location.search);this.authority=l.get("authority"),this.currentFilename=`${this.authority}.geojson`,document.getElementById("authority").innerText=this.authority;const h=!window.location.hash;this.map=new Dn.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL",hash:!0}),this.drawControls=new st({displayControlsDefault:!1,controls:{point:!0,polygon:!0},styles:Yo}),this.currentlyEditing=null,W(this,Be,Ao).call(this,h),document.getElementById("export").onclick=()=>{const b=this.toGeojson();var S=this.authority;b.scheme_name&&(S+="_"+b.scheme_name),S+=".geojson",Ko(S,JSON.stringify(b))},document.getElementById("load_geojson").onchange=b=>{W(this,Ne,jo).call(this,b)}}toGeojson(){var l=this.drawControls.getAll();return l.scheme_name=document.getElementById("scheme_name").value||"",l.authority=this.authority,l}saveToLocalStorage(){window.localStorage.setItem(this.currentFilename,JSON.stringify(this.toGeojson()))}openForm(l){const h=l.id;this.currentlyEditing=h,document.getElementById(`accordian-btn-${h}`).classList.add("active-accordian");const b=document.getElementById(`accordian-contents-${h}`);b.style.maxHeight=b.scrollHeight+"px",this.map.getSource("editing").setData({type:"FeatureCollection",features:[l]}),this.map.getSource("hover").setData(Ct())}closeForm(){const l=this.currentlyEditing;l&&(document.getElementById(`accordian-btn-${l}`).classList.remove("active-accordian"),document.getElementById(`accordian-contents-${l}`).style.maxHeight=null),this.currentlyEditing=null,this.map.getSource("editing").setData(Ct())}updateSidebar(){const l=document.getElementById("intervention_list");l.innerHTML="";const h=document.createElement("div"),b=document.createElement("span");b.innerText=`${this.drawControls.getAll().features.length} interventions`,h.appendChild(b);const S=document.createElement("button");S.className="underlined-button",S.innerText="Clear all",S.onclick=()=>{confirm("Do you want to clear the current scheme? (You should save it first!)")&&(this.drawControls.set(Ct()),this.saveToLocalStorage(),this.updateSidebar(),document.getElementById("scheme_name").value="",this.map.getSource("hover").setData(Ct()),this.map.getSource("editing").setData(Ct()))},S.className="align-right",h.appendChild(S),l.appendChild(h),l.appendChild(document.createElement("br"));var F=1;for(const M of this.drawControls.getAll().features){M.properties;const $=document.createElement("button");$.id=`accordian-btn-${M.id}`,$.className="accordian",$.innerText=`${F}) ${Hn(M)}`,$.onmouseover=()=>{this.map.getSource("hover").setData({type:"FeatureCollection",features:[M]})},$.onmouseout=()=>{this.map.getSource("hover").setData(Ct())},$.onclick=()=>{this.currentlyEditing==M.id?this.closeForm():(this.closeForm(),this.openForm(M),M.geometry.type=="Point"?this.map.flyTo({center:M.geometry.coordinates}):this.map.fitBounds(Oo(M),{padding:200,animate:!0,duration:500}),M.geometry.type!="Point"&&this.drawControls.changeMode("direct_select",{featureId:M.id}))},l.appendChild($);const Y=document.createElement("div");Y.id=`accordian-contents-${M.id}`,Y.className="accordian-contents",l.appendChild(Y),Xo(Y,M);const rt=M.id;for(const ct of["intervention_name","intervention_description"]){const Bt=document.getElementById(`${ct}-${rt}`);Bt.oninput=()=>{this.drawControls.setFeatureProperty(rt,ct,Bt.value),this.saveToLocalStorage(),ct=="intervention_name"&&(M.properties.intervention_name=Bt.value,$.innerText=`${F}) ${Hn(M)}`)}}const It=document.querySelectorAll(`input[name="intervention_type-${rt}"]`);for(const ct of It)ct.onchange=()=>{this.drawControls.setFeatureProperty(rt,"intervention_type",ct.id),this.saveToLocalStorage()};document.getElementById(`save-${rt}`).onclick=()=>{this.closeForm(),this.drawControls.changeMode("simple_select")},document.getElementById(`delete-${rt}`).onclick=()=>{this.drawControls.delete(rt),this.closeForm(),this.updateSidebar(),this.saveToLocalStorage()},F+=1}}}Ne=new WeakSet,jo=function(l){const h=new FileReader;h.onload=b=>{try{W(this,he,Bn).call(this,b.target.result),this.saveToLocalStorage()}catch(S){console.log(`Couldn't load from a file: ${S}`),window.alert(`Couldn't load scheme from a file: ${S}`)}},h.readAsText(l.target.files[0])},he=new WeakSet,Bn=function(l){const h=JSON.parse(l);this.drawControls.set(h),this.updateSidebar();const b=document.getElementById("scheme_name");b.value=h.scheme_name||"",b.oninput=()=>{this.saveToLocalStorage()}},Be=new WeakSet,Ao=function(l){this.map.on("load",async()=>{const h=await Qo(this.authority);l&&this.map.fitBounds(Oo(h),{padding:20,animate:!1}),this.map.addSource("boundary",{type:"geojson",data:h}),this.map.addSource("hover",{type:"geojson",data:Ct()}),this.map.addSource("editing",{type:"geojson",data:Ct()});for(const S of Wo)this.map.addLayer(S);this.map.addControl(this.drawControls),this.map.addControl(new Dn.ScaleControl),this.map.addControl(new Dn.NavigationControl,"bottom-right");const b=window.localStorage.getItem(this.currentFilename);b&&W(this,he,Bn).call(this,b),this.map.on("draw.selectionchange",S=>{if(S.features.length===1){const M=S.features[0];if(M.properties.intervention_type===void 0){var F="other";M.geometry.type=="Polygon"&&(F="area"),this.drawControls.setFeatureProperty(M.id,"intervention_type",F),M.properties.intervention_type=F}this.saveToLocalStorage(),this.updateSidebar(),this.openForm(M)}else this.closeForm()}),this.map.on("draw.update",S=>{this.map.getSource("editing").setData({type:"FeatureCollection",features:[S.features[0]]})}),this.previousHoverEntry=null,this.map.on("mousemove",S=>{var F=null;if(this.currentlyEditing===null){const M=this.drawControls.getFeatureIdsAt(S.point);M.length>0&&(F=M[0])}W(this,ge,Rn).call(this,F)}),this.map.on("mouseout",()=>{W(this,ge,Rn).call(this,null)}),this.routeSnapper=await tr(this)}),document.addEventListener("keydown",h=>{h.key=="Delete"&&this.currentlyEditing!=null&&(this.drawControls.delete(this.currentlyEditing),this.closeForm(),this.updateSidebar(),this.saveToLocalStorage())})},ge=new WeakSet,Rn=function(l){l!=this.previousHoverEntry&&(this.previousHoverEntry&&this.previousHoverEntry!=this.currentlyEditing&&document.getElementById(`accordian-btn-${this.previousHoverEntry}`).classList.remove("active-accordian"),l&&document.getElementById(`accordian-btn-${l}`).classList.add("active-accordian"),this.previousHoverEntry=l)};function Ko(g,l){var h=document.createElement("a");h.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(l)),h.setAttribute("download",g),document.body.appendChild(h),h.click(),document.body.removeChild(h)}async function Qo(g){const l=await(await fetch(ci)).text(),h=JSON.parse(l);return h.features=h.features.filter(b=>b.properties.name==g),h}function Ct(){return{type:"FeatureCollection",features:[]}}function Xo(g,l){const h=l.properties,b=l.id;g.innerHTML=`
  <br/>

  <div>
    <label for="intervention_name-${b}">Name</label><br/>
    <input type="text" id="intervention_name-${b}" size="30">
  </div>

  <br/>

  ${Ho(h,"intervention_type-"+b,"intervention_type",["area","route","crossing","other"])}

  <br/>

  <div>
    <label for="intervention_description-${b}">Description</label><br/>
	  <textarea id="intervention_description-${b}" rows="3" cols="40"></textarea>
  </div>

  <br/>

  <div>
    <button type="button" id="delete-${b}">Delete</button>
    <button type="button" id="save-${b}" class="align-right">Save</button>
  </div>

  <br/>
  `,h.intervention_name&&(document.getElementById(`intervention_name-${b}`).value=h.intervention_name),h.intervention_description&&(document.getElementById(`intervention_description-${b}`).innerText=h.intervention_description)}async function tr(g){const l=`https://play.abstreet.org/route-snappers/${g.authority}.bin`;console.log(`Grabbing ${l}`);try{const h=await Go(l,"snap-progress");window.routeSnapper=new Vo(g.map,h,document.getElementById("snap-tool"))}catch(h){console.log(`Route tool broke: ${h}`),document.getElementById("snap-tool").innerHTML="Failed to load"}document.getElementById("snap-tool").addEventListener("new-route",h=>{const b=h.detail,S=g.drawControls.add(b);b.id=S[0],b.properties.intervention_type="route",g.drawControls.setFeatureProperty(b.id,"intervention_type","route"),g.updateSidebar(),g.openForm(b),g.saveToLocalStorage(),g.drawControls.changeMode("direct_select",{featureId:b.id})})}function Hn(g){if(g.properties.intervention_name)return g.properties.intervention_name;var l=g.properties.intervention_type;return l=="other"&&(g.geometry.type=="Point"?l="point":g.geometry.type=="LineString"?l="line":l="polygon"),`Untitled ${l}`}window.app=new Zo})();
