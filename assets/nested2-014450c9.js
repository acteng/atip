import{S as Ce,i as Oe,s as Be,d as N,m as J,p as v,q as C,u as M,D as me,Q as Fe,F as Le,e as h,c as w,t as b,f as Q,j as T,k as s,g as _e,n as V,x as G,a9 as ye,aa as ke,r as E,ai as je,v as ve,z as he,O as Ie,P as ze}from"./maplibre_helpers-818d46c3.js";import{L as Ne,g as ee,Z as Je,e as de,t as Me,I as qe,B as De,v as Ge,M as Te,m as Ee,C as Pe}from"./ZoomOutMap-b6350942.js";function ge(l,e,n){const r=l.slice();return r[17]=e[n],r}function $e(l){let e,n;return e=new Pe({props:{label:`${l[17].scheme_reference}: ${l[17].num_features} features`,$$slots:{default:[Ze]},$$scope:{ctx:l}}}),{c(){N(e.$$.fragment)},m(r,t){J(e,r,t),n=!0},p(r,t){const o={};t&1&&(o.label=`${r[17].scheme_reference}: ${r[17].num_features} features`),t&1048577&&(o.$$scope={dirty:t,ctx:r}),e.$set(o)},i(r){n||(v(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){M(e,r)}}}function Ze(l){let e,n,r,t=l[17].authority_or_region+"",o,c,g,p,a=l[17].capital_scheme_id+"",d,P,j,q,S=l[17].funding_programme+"",O,Z,D,L,B,i,f,y,_,U;function R(){return l[12](l[17])}function K(){return l[13](l[17])}return{c(){e=h("ul"),n=h("li"),r=b("Authority or region: "),o=b(t),c=w(),g=h("li"),p=b("Capital scheme ID: "),d=b(a),P=w(),j=h("li"),q=b("Funding programme: "),O=b(S),Z=w(),D=h("li"),L=h("button"),L.textContent="Show on map",B=w(),i=h("li"),f=h("button"),f.textContent="Edit scheme",y=w(),Q(L,"type","button"),Q(f,"type","button")},m(I,F){T(I,e,F),s(e,n),s(n,r),s(n,o),s(e,c),s(e,g),s(g,p),s(g,d),s(e,P),s(e,j),s(j,q),s(j,O),s(e,Z),s(e,D),s(D,L),s(e,B),s(e,i),s(i,f),T(I,y,F),_||(U=[V(L,"click",R),V(f,"click",K)],_=!0)},p(I,F){l=I,F&1&&t!==(t=l[17].authority_or_region+"")&&G(o,t),F&1&&a!==(a=l[17].capital_scheme_id+"")&&G(d,a),F&1&&S!==(S=l[17].funding_programme+"")&&G(O,S)},d(I){I&&(E(e),E(y)),_=!1,ve(U)}}}function be(l){let e=l[2].has(l[17].scheme_reference),n,r,t=e&&$e(l);return{c(){t&&t.c(),n=Ie()},m(o,c){t&&t.m(o,c),T(o,n,c),r=!0},p(o,c){c&5&&(e=o[2].has(o[17].scheme_reference)),e?t?(t.p(o,c),c&5&&v(t,1)):(t=$e(o),t.c(),v(t,1),t.m(n.parentNode,n)):t&&(ye(),C(t,1,1,()=>{t=null}),ke())},i(o){r||(v(t),r=!0)},o(o){C(t),r=!1},d(o){o&&E(n),t&&t.d(o)}}}function Ae(l){let e,n,r,t,o,c,g,p,a,d,P,j,q,S,O,Z,D,L,B,i,f,y,_,U,R=l[2].size+"",K,I,F=l[3].route+"",te,oe,W=l[3].area+"",re,ae,X=l[3].crossing+"",ne,ie,Y=l[3].other+"",le,ue,fe,x,z,se,ce;c=new Je({props:{boundaryGeojson:l[4]}}),p=new Le({props:{label:"Load from GeoJSON",uniqueId:"load_geojson",loadFile:l[6]}});let A=de(l[0]),m=[];for(let u=0;u<A.length;u+=1)m[u]=be(ge(l,A,u));const Se=u=>C(m[u],1,1,()=>{m[u]=null});return{c(){e=h("div"),n=h("button"),n.textContent="Home",r=w(),t=h("h1"),o=b(`Browse schemes
      `),N(c.$$.fragment),g=w(),N(p.$$.fragment),a=w(),d=h("br"),P=w(),j=h("br"),q=w(),S=h("div"),O=h("label"),Z=b("Filter by any field: "),D=h("br"),L=w(),B=h("input"),i=w(),f=h("button"),f.textContent="Clear",y=w(),_=h("p"),U=b("Showing "),K=b(R),I=b(" schemes ("),te=b(F),oe=b(" routes, "),re=b(W),ae=b(` areas,
      `),ne=b(X),ie=b(" crossings, "),le=b(Y),ue=b(" other)"),fe=w(),x=h("ul");for(let u=0;u<m.length;u+=1)m[u].c();Q(n,"type","button"),Q(B,"type","text"),Q(f,"type","button"),Q(e,"slot","sidebar")},m(u,$){T(u,e,$),s(e,n),s(e,r),s(e,t),s(t,o),J(c,t,null),s(e,g),J(p,e,null),s(e,a),s(e,d),s(e,P),s(e,j),s(e,q),s(e,S),s(S,O),s(O,Z),s(O,D),s(O,L),s(O,B),_e(B,l[1]),s(S,i),s(S,f),s(e,y),s(e,_),s(_,U),s(_,K),s(_,I),s(_,te),s(_,oe),s(_,re),s(_,ae),s(_,ne),s(_,ie),s(_,le),s(_,ue),s(e,fe),s(e,x);for(let H=0;H<m.length;H+=1)m[H]&&m[H].m(x,null);z=!0,se||(ce=[V(n,"click",l[9]),V(B,"input",l[10]),V(f,"click",l[11])],se=!0)},p(u,$){const H={};if($&16&&(H.boundaryGeojson=u[4]),c.$set(H),$&2&&B.value!==u[1]&&_e(B,u[1]),(!z||$&4)&&R!==(R=u[2].size+"")&&G(K,R),(!z||$&8)&&F!==(F=u[3].route+"")&&G(te,F),(!z||$&8)&&W!==(W=u[3].area+"")&&G(re,W),(!z||$&8)&&X!==(X=u[3].crossing+"")&&G(ne,X),(!z||$&8)&&Y!==(Y=u[3].other+"")&&G(le,Y),$&389){A=de(u[0]);let k;for(k=0;k<A.length;k+=1){const pe=ge(u,A,k);m[k]?(m[k].p(pe,$),v(m[k],1)):(m[k]=be(pe),m[k].c(),v(m[k],1),m[k].m(x,null))}for(ye(),k=A.length;k<m.length;k+=1)Se(k);ke()}},i(u){if(!z){v(c.$$.fragment,u),v(p.$$.fragment,u);for(let $=0;$<A.length;$+=1)v(m[$]);z=!0}},o(u){C(c.$$.fragment,u),C(p.$$.fragment,u),m=m.filter(Boolean);for(let $=0;$<m.length;$+=1)C(m[$]);z=!1},d(u){u&&E(e),M(c),M(p),je(m,u),se=!1,ve(ce)}}}function He(l){let e,n,r,t,o,c,g,p;return e=new qe({props:{schema:we}}),r=new De({props:{style:l[5]}}),o=new Ge({props:{schema:we}}),g=new Te({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:Ue}}),{c(){N(e.$$.fragment),n=w(),N(r.$$.fragment),t=w(),N(o.$$.fragment),c=w(),N(g.$$.fragment)},m(a,d){J(e,a,d),T(a,n,d),J(r,a,d),T(a,t,d),J(o,a,d),T(a,c,d),J(g,a,d),p=!0},p:ze,i(a){p||(v(e.$$.fragment,a),v(r.$$.fragment,a),v(o.$$.fragment,a),v(g.$$.fragment,a),p=!0)},o(a){C(e.$$.fragment,a),C(r.$$.fragment,a),C(o.$$.fragment,a),C(g.$$.fragment,a),p=!1},d(a){a&&(E(n),E(t),E(c)),M(e,a),M(r,a),M(o,a),M(g,a)}}}function Qe(l){let e,n,r;return n=new Me({props:{style:l[5],$$slots:{default:[He]},$$scope:{ctx:l}}}),{c(){e=h("div"),N(n.$$.fragment),Q(e,"slot","main")},m(t,o){T(t,e,o),J(n,e,null),r=!0},p(t,o){const c={};o&1048576&&(c.$$scope={dirty:o,ctx:t}),n.$set(c)},i(t){r||(v(n.$$.fragment,t),r=!0)},o(t){C(n.$$.fragment,t),r=!1},d(t){t&&E(e),M(n)}}}function Re(l){let e,n;return e=new Ne({props:{$$slots:{main:[Qe],sidebar:[Ae]},$$scope:{ctx:l}}}),{c(){N(e.$$.fragment)},m(r,t){J(e,r,t),n=!0},p(r,[t]){const o={};t&1048607&&(o.$$scope={dirty:t,ctx:r}),e.$set(o)},i(r){n||(v(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){M(e,r)}}}const we="v1";function Ue(l){var e="<table>";for(let[n,r]of Object.entries(l))e+=`<tr><td>${n}</td><td>${r}</td></tr>`;return e+="</table>",e}function Ke(l,e,n){let r,t;me(l,ee,i=>n(4,r=i)),me(l,Ee,i=>n(14,t=i));let c=new URLSearchParams(window.location.search).get("style")||"streets",g=[],p="",a=new Set,d={area:0,route:0,crossing:0,other:0};Fe(()=>{ee.set(null)});function P(i){try{let f=JSON.parse(i);ee.set(f),j(f),t==null||t.fitBounds(he(f),{padding:20,animate:!1})}catch(f){window.alert(`Couldn't load schemes from a file: ${f}`)}}function j(i){let f={};for(let[y,_]of Object.entries(i.schemes))f[y]={scheme_reference:y,num_features:0,..._};for(let y of i.features)f[y.properties.scheme_reference].num_features++;n(0,g=Object.values(f))}function q(i){let f={type:"FeatureCollection",features:r.features.filter(y=>y.properties.scheme_reference==i.scheme_reference)};t==null||t.fitBounds(he(f),{padding:20,animate:!1})}function S(i){let f={type:"FeatureCollection",features:r.features.filter(_=>_.properties.scheme_reference==i.scheme_reference)},y=i.authority_or_region;window.localStorage.setItem(y,JSON.stringify(f)),window.open(`scheme.html?authority=${i.authority_or_region}`,"_blank")}const O=()=>window.open("index.html");function Z(){p=this.value,n(1,p)}const D=()=>n(1,p=""),L=i=>q(i),B=i=>S(i);return l.$$.update=()=>{if(l.$$.dirty&31){if(a.clear(),p){let i=p.toLowerCase();for(let f of r.features)JSON.stringify(f.properties).toLowerCase().includes(i)&&a.add(f.properties.scheme_reference)}else for(let i of g)a.add(i.scheme_reference);ee.update(i=>{if(!i)return null;for(let f of i.features)a.has(f.properties.scheme_reference)?delete f.properties.hide_while_editing:f.properties.hide_while_editing=!0;return i}),n(3,d={area:0,route:0,crossing:0,other:0});for(let i of r==null?void 0:r.features)a.has(i.properties.scheme_reference)&&n(3,d[i.properties.intervention_type]++,d);n(2,a),n(1,p),n(4,r),n(0,g),n(3,d)}},[g,p,a,d,r,c,P,q,S,O,Z,D,L,B]}class Ve extends Ce{constructor(e){super(),Oe(this,e,Ke,Re,Be,{})}}new Ve({target:document.getElementById("app")});
