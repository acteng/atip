import{S as ve,i as Ce,s as Be,d as J,m as z,n as S,o as k,q as G,J as me,R as Le,F as Ne,e as d,c as y,t as w,f as Z,g as q,h as o,j as _e,l as P,B as H,V as we,W as ye,p as T,N as Fe,r as Se,w as he,X as Oe,G as je}from"./FileInput-ddab9480.js";import{L as Ie,g as Y,Z as Je,h as ze,I as Ge,B as Me,i as qe,M as Te,m as Ee,C as Re}from"./InterventionLayer-40577e50.js";function de(l,e,n){const r=l.slice();return r[17]=e[n],r}function ge(l){let e,n;return e=new Re({props:{label:`${l[17].scheme_reference}: ${l[17].num_features} features`,$$slots:{default:[Ze]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(r,t){z(e,r,t),n=!0},p(r,t){const s={};t&1&&(s.label=`${r[17].scheme_reference}: ${r[17].num_features} features`),t&1048577&&(s.$$scope={dirty:t,ctx:r}),e.$set(s)},i(r){n||(S(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){G(e,r)}}}function Ze(l){let e,n,r,t=l[17].authority_or_region+"",s,c,g,p,a,_,B,M,N,C;function L(){return l[12](l[17])}function A(){return l[13](l[17])}return{c(){e=d("ul"),n=d("li"),r=w("Authority or region: "),s=w(t),c=y(),g=d("li"),p=d("button"),p.textContent="Show on map",a=y(),_=d("li"),B=d("button"),B.textContent="Edit scheme",M=y(),Z(p,"type","button"),Z(B,"type","button")},m(v,F){q(v,e,F),o(e,n),o(n,r),o(n,s),o(e,c),o(e,g),o(g,p),o(e,a),o(e,_),o(_,B),q(v,M,F),N||(C=[P(p,"click",L),P(B,"click",A)],N=!0)},p(v,F){l=v,F&1&&t!==(t=l[17].authority_or_region+"")&&H(s,t)},d(v){v&&T(e),v&&T(M),N=!1,Se(C)}}}function $e(l){let e=l[2].has(l[17].scheme_reference),n,r,t=e&&ge(l);return{c(){t&&t.c(),n=Oe()},m(s,c){t&&t.m(s,c),q(s,n,c),r=!0},p(s,c){c&5&&(e=s[2].has(s[17].scheme_reference)),e?t?(t.p(s,c),c&5&&S(t,1)):(t=ge(s),t.c(),S(t,1),t.m(n.parentNode,n)):t&&(we(),k(t,1,1,()=>{t=null}),ye())},i(s){r||(S(t),r=!0)},o(s){k(t),r=!1},d(s){t&&t.d(s),s&&T(n)}}}function Ae(l){let e,n,r,t,s,c,g,p,a,_,B,M,N,C,L,A,v,F,O,f,u,j,$,E,U=l[2].size+"",x,oe,V=l[3].route+"",ee,se,W=l[3].area+"",te,ae,X=l[3].crossing+"",re,ie,K=l[3].other+"",ne,fe,ue,Q,I,le,ce;c=new Je({props:{boundaryGeojson:l[4]}}),p=new Ne({props:{label:"Load from GeoJSON",uniqueId:"load_geojson",loadFile:l[6]}});let R=l[0],m=[];for(let i=0;i<R.length;i+=1)m[i]=$e(de(l,R,i));const ke=i=>k(m[i],1,1,()=>{m[i]=null});return{c(){e=d("div"),n=d("button"),n.textContent="Home",r=y(),t=d("h1"),s=w(`Browse schemes
      `),J(c.$$.fragment),g=y(),J(p.$$.fragment),a=y(),_=d("br"),B=y(),M=d("br"),N=y(),C=d("div"),L=d("label"),A=w("Filter by any field: "),v=d("br"),F=y(),O=d("input"),f=y(),u=d("button"),u.textContent="Clear",j=y(),$=d("p"),E=w("Showing "),x=w(U),oe=w(" schemes ("),ee=w(V),se=w(" routes, "),te=w(W),ae=w(` areas,
      `),re=w(X),ie=w(" crossings, "),ne=w(K),fe=w(" other)"),ue=y(),Q=d("ul");for(let i=0;i<m.length;i+=1)m[i].c();Z(n,"type","button"),Z(O,"type","text"),Z(u,"type","button"),Z(e,"slot","sidebar")},m(i,h){q(i,e,h),o(e,n),o(e,r),o(e,t),o(t,s),z(c,t,null),o(e,g),z(p,e,null),o(e,a),o(e,_),o(e,B),o(e,M),o(e,N),o(e,C),o(C,L),o(L,A),o(L,v),o(L,F),o(L,O),_e(O,l[1]),o(C,f),o(C,u),o(e,j),o(e,$),o($,E),o($,x),o($,oe),o($,ee),o($,se),o($,te),o($,ae),o($,re),o($,ie),o($,ne),o($,fe),o(e,ue),o(e,Q);for(let D=0;D<m.length;D+=1)m[D].m(Q,null);I=!0,le||(ce=[P(n,"click",l[9]),P(O,"input",l[10]),P(u,"click",l[11])],le=!0)},p(i,h){const D={};if(h&16&&(D.boundaryGeojson=i[4]),c.$set(D),h&2&&O.value!==i[1]&&_e(O,i[1]),(!I||h&4)&&U!==(U=i[2].size+"")&&H(x,U),(!I||h&8)&&V!==(V=i[3].route+"")&&H(ee,V),(!I||h&8)&&W!==(W=i[3].area+"")&&H(te,W),(!I||h&8)&&X!==(X=i[3].crossing+"")&&H(re,X),(!I||h&8)&&K!==(K=i[3].other+"")&&H(ne,K),h&389){R=i[0];let b;for(b=0;b<R.length;b+=1){const pe=de(i,R,b);m[b]?(m[b].p(pe,h),S(m[b],1)):(m[b]=$e(pe),m[b].c(),S(m[b],1),m[b].m(Q,null))}for(we(),b=R.length;b<m.length;b+=1)ke(b);ye()}},i(i){if(!I){S(c.$$.fragment,i),S(p.$$.fragment,i);for(let h=0;h<R.length;h+=1)S(m[h]);I=!0}},o(i){k(c.$$.fragment,i),k(p.$$.fragment,i),m=m.filter(Boolean);for(let h=0;h<m.length;h+=1)k(m[h]);I=!1},d(i){i&&T(e),G(c),G(p),Fe(m,i),le=!1,Se(ce)}}}function De(l){let e,n,r,t,s,c,g,p;return e=new Ge({props:{schema:be}}),r=new Me({props:{style:l[5]}}),s=new qe({props:{schema:be}}),g=new Te({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:Ue}}),{c(){J(e.$$.fragment),n=y(),J(r.$$.fragment),t=y(),J(s.$$.fragment),c=y(),J(g.$$.fragment)},m(a,_){z(e,a,_),q(a,n,_),z(r,a,_),q(a,t,_),z(s,a,_),q(a,c,_),z(g,a,_),p=!0},p:je,i(a){p||(S(e.$$.fragment,a),S(r.$$.fragment,a),S(s.$$.fragment,a),S(g.$$.fragment,a),p=!0)},o(a){k(e.$$.fragment,a),k(r.$$.fragment,a),k(s.$$.fragment,a),k(g.$$.fragment,a),p=!1},d(a){G(e,a),a&&T(n),G(r,a),a&&T(t),G(s,a),a&&T(c),G(g,a)}}}function He(l){let e,n,r;return n=new ze({props:{style:l[5],$$slots:{default:[De]},$$scope:{ctx:l}}}),{c(){e=d("div"),J(n.$$.fragment),Z(e,"slot","main")},m(t,s){q(t,e,s),z(n,e,null),r=!0},p(t,s){const c={};s&1048576&&(c.$$scope={dirty:s,ctx:t}),n.$set(c)},i(t){r||(S(n.$$.fragment,t),r=!0)},o(t){k(n.$$.fragment,t),r=!1},d(t){t&&T(e),G(n)}}}function Pe(l){let e,n;return e=new Ie({props:{$$slots:{main:[He],sidebar:[Ae]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(r,t){z(e,r,t),n=!0},p(r,[t]){const s={};t&1048607&&(s.$$scope={dirty:t,ctx:r}),e.$set(s)},i(r){n||(S(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){G(e,r)}}}const be="v1";function Ue(l){return JSON.stringify(l,null,"  ")}function Ve(l,e,n){let r,t;me(l,Y,f=>n(4,r=f)),me(l,Ee,f=>n(14,t=f));let c=new URLSearchParams(window.location.search).get("style")||"streets",g=[],p="",a=new Set,_={area:0,route:0,crossing:0,other:0};Le(()=>{Y.set(null)});function B(f){try{let u=JSON.parse(f);Y.set(u),M(u),t==null||t.fitBounds(he(u),{padding:20,animate:!1})}catch(u){window.alert(`Couldn't load schemes from a file: ${u}`)}}function M(f){var j;let u={};for(let $ of f.features){let E=$.properties;u[j=E.scheme_reference]||(u[j]={scheme_reference:E.scheme_reference,authority_or_region:E.authority_or_region,num_features:0}),u[E.scheme_reference].num_features++}n(0,g=Object.values(u))}function N(f){let u={type:"FeatureCollection",features:r.features.filter(j=>j.properties.scheme_reference==f.scheme_reference)};t==null||t.fitBounds(he(u),{padding:20,animate:!1})}function C(f){let u={type:"FeatureCollection",features:r.features.filter($=>$.properties.scheme_reference==f.scheme_reference)},j=f.authority_or_region;window.localStorage.setItem(j,JSON.stringify(u)),window.open(`scheme.html?authority=${f.authority_or_region}`,"_blank")}const L=()=>window.open("index.html");function A(){p=this.value,n(1,p)}const v=()=>n(1,p=""),F=f=>N(f),O=f=>C(f);return l.$$.update=()=>{if(l.$$.dirty&31){if(a.clear(),p){let f=p.toLowerCase();for(let u of r.features)JSON.stringify(u.properties).toLowerCase().includes(f)&&a.add(u.properties.scheme_reference)}else for(let f of g)a.add(f.scheme_reference);Y.update(f=>{if(!f)return null;for(let u of f.features)a.has(u.properties.scheme_reference)?delete u.properties.hide_while_editing:u.properties.hide_while_editing=!0;return f}),n(3,_={area:0,route:0,crossing:0,other:0});for(let f of r==null?void 0:r.features)a.has(f.properties.scheme_reference)&&n(3,_[f.properties.intervention_type]++,_);n(2,a),n(1,p),n(4,r),n(0,g),n(3,_)}},[g,p,a,_,r,c,B,N,C,L,A,v,F,O]}class We extends ve{constructor(e){super(),Ce(this,e,Ve,Pe,Be,{})}}new We({target:document.getElementById("app")});
