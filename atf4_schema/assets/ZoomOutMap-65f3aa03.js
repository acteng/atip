import{r as pe,o as q,n as $,S as z,i as E,s as F,e as h,t as I,j as ee,af as _e,f as m,g as v,h as b,ag as te,l as R,L as O,p as w,ae as ye,G as ve,ao as J,c as B,at as se,ap as N,aq as Z,ar as V,z as A,B as we,E as ne,D as le,C as ke,J as Se,I as Ce,H as oe,am as ae,K as $e,ab as Le,a3 as me,a4 as ge,aj as ie,au as W,M as he,d as Me,m as Ie,q as Oe,a2 as j,av as Be,u as qe,b as De,aa as Fe,w as je}from"./maplibre_helpers-82249cc9.js";function dt(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function pt(s,e){q(s,1,1,()=>{e.delete(s.key)})}function _t(s,e,n,t,l,o,a,r,c,i,u,g){let d=s.length,p=o.length,y=d;const k={};for(;y--;)k[s[y].key]=y;const f=[],_=new Map,U=new Map,X=[];for(y=p;y--;){const S=g(l,o,y),L=n(S);let M=a.get(L);M?t&&X.push(()=>M.p(S,e)):(M=i(L,S),M.c()),_.set(L,f[y]=M),L in k&&U.set(L,Math.abs(y-k[L]))}const Y=new Set,x=new Set;function K(S){$(S,1),S.m(r,u),a.set(S.key,S),u=S.first,p--}for(;d&&p;){const S=f[p-1],L=s[d-1],M=S.key,G=L.key;S===L?(u=S.first,d--,p--):_.has(G)?!a.has(M)||Y.has(M)?K(S):x.has(G)?d--:U.get(M)>U.get(G)?(x.add(M),K(S)):(Y.add(G),d--):(c(L,a),d--)}for(;d--;){const S=s[d];_.has(S.key)||c(S,a)}for(;p;)K(f[p-1]);return pe(X),f}function ze(s){let e,n,t,l,o,a,r;return{c(){e=h("div"),n=I(`Basemap:
  `),t=h("select"),l=h("option"),l.textContent="Streets",o=h("option"),o.textContent="Satellite",l.__value="streets",ee(l,l.__value),o.__value="hybrid",ee(o,o.__value),s[0]===void 0&&_e(()=>s[2].call(t)),m(e,"class","svelte-1tbnm6i")},m(c,i){v(c,e,i),b(e,n),b(e,t),b(t,l),b(t,o),te(t,s[0],!0),a||(r=[R(t,"change",s[2]),R(t,"change",s[1])],a=!0)},p(c,[i]){i&1&&te(t,c[0])},i:O,o:O,d(c){c&&w(e),a=!1,pe(r)}}}function Ee(s,e,n){let{style:t}=e;function l(){let a=new URLSearchParams(window.location.search);a.set("style",t);let r=`${window.location.pathname}?${a.toString()}${window.location.hash}`;window.location.href=r}function o(){t=ye(this),n(0,t)}return s.$$set=a=>{"style"in a&&n(0,t=a.style)},[t,l,o]}class mt extends z{constructor(e){super(),E(this,e,Ee,ze,F,{style:0})}}const T=[];function D(s,e=O){let n;const t=new Set;function l(r){if(F(s,r)&&(s=r,n)){const c=!T.length;for(const i of t)i[1](),T.push(i,s);if(c){for(let i=0;i<T.length;i+=2)T[i][0](T[i+1]);T.length=0}}}function o(r){l(r(s))}function a(r,c=O){const i=[r,c];return t.add(i),t.size===1&&(n=e(l,o)||O),r(s),()=>{t.delete(i),t.size===0&&n&&(n(),n=null)}}return{set:l,update:o,subscribe:a}}function Pe(s){return s=="google"||s=="bing"}function gt(s){return{v1:"Scheme Design",v2:"Experimental Scheme Design",planning:"Development Planning",criticals:"Critical Issues",atf4:"ATF4 Scheme"}[s]}const H=D(null),ht=D(null),be=D(ve()),Te=D(null),Re=D(null),Ge=D(null),We=D(null),Je=D(Ne());Je.subscribe(s=>window.localStorage.setItem("userSettings",JSON.stringify(s)));const bt=D("edit-attribute"),yt=D(!1);function vt(s){let e=new Set;for(let t of s.features)e.add(t.id);let n=e.size+1;for(;e.has(n);)n++;return n}function wt(s){console.log(`Deleting intervention ${s}`),be.update(e=>(e.features=e.features.filter(n=>n.id!=s),e)),Te.set(null),Re.set(null),Ge.set(null),We.set(null)}function Ne(){let s={streetViewImagery:"google",avoidDoublingBack:!1};try{let e=JSON.parse(window.localStorage.getItem("userSettings")||"{}");Pe(e.streetViewImagery)&&(s.streetViewImagery=e.streetViewImagery),typeof e.avoidDoublingBack=="boolean"&&(s.avoidDoublingBack=e.avoidDoublingBack)}catch(e){console.log(`Couldn't parse userSettings from local storage: ${e}`)}return s}const Ze=s=>({}),re=s=>({}),Ve=s=>({}),ce=s=>({});function Ae(s){let e,n,t,l,o,a,r,c,i,u,g;const d=s[3].sidebar,p=J(d,s,s[2],ce),y=s[3].main,k=J(y,s,s[2],re);return{c(){e=h("div"),n=h("aside"),t=h("div"),p&&p.c(),l=B(),o=h("button"),o.textContent="â†’",r=B(),c=h("main"),k&&k.c(),m(t,"class","sidebar-content content-container svelte-ect12w"),m(o,"type","button"),m(o,"class","sidebar-toggle rounded-rect svelte-ect12w"),m(n,"class",a=se(s[0]?"":"collapsed")+" svelte-ect12w"),m(c,"class","svelte-ect12w"),m(e,"class","overall-layout svelte-ect12w")},m(f,_){v(f,e,_),b(e,n),b(n,t),p&&p.m(t,null),b(n,l),b(n,o),b(e,r),b(e,c),k&&k.m(c,null),i=!0,u||(g=R(o,"click",s[1]),u=!0)},p(f,[_]){p&&p.p&&(!i||_&4)&&N(p,d,f,f[2],i?V(d,f[2],_,Ve):Z(f[2]),ce),(!i||_&1&&a!==(a=se(f[0]?"":"collapsed")+" svelte-ect12w"))&&m(n,"class",a),k&&k.p&&(!i||_&4)&&N(k,y,f,f[2],i?V(y,f[2],_,Ze):Z(f[2]),re)},i(f){i||($(p,f),$(k,f),i=!0)},o(f){q(p,f),q(k,f),i=!1},d(f){f&&w(e),p&&p.d(f),k&&k.d(f),u=!1,g()}}}function He(s,e,n){let{$$slots:t={},$$scope:l}=e,o=!0;function a(){n(0,o=!o)}return s.$$set=r=>{"$$scope"in r&&n(2,l=r.$$scope)},[o,a,l,t]}class kt extends z{constructor(e){super(),E(this,e,He,Ae,F,{})}}const C={area:"#D94324",route:"#555F5E",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Ue=10,Q=10;let P="interventions";function Ke(s,e,n){let t,l;A(s,H,u=>n(1,t=u)),A(s,be,u=>n(2,l=u));let{schema:o}=e;we(t,P,l);const a=["match",["get","intervention_type"],"area",C.area,"route",C.route,"crossing",C.crossing,"other",C.other,"white"],r=["match",["get","reference_type",["get","planning"]],"preapp",C.preapp,"outline",C.outline,"reserved matters",C["reserved matters"],"local plan",C["local plan"],"white"],c=["!=","hide_while_editing",!0];return ne(t,{id:"interventions-points",source:P,filter:["all",Se,c,["!=","endpoint",!0]],color:a,radius:Ue}),le(t,{id:"interventions-lines",source:P,filter:["all",Ce,c],color:a,width:Q}),ne(t,{id:"interventions-lines-endpoints",source:P,filter:["==","endpoint",!0],radius:.5*Q,opacity:0,strokeColor:C.lineEndpointColor,strokeWidth:2}),ke(t,{id:"interventions-polygons",source:P,filter:["all",oe,c],color:o=="planning"?r:a,opacity:.2}),le(t,{id:"interventions-polygon-outlines",source:P,filter:["all",oe,c],color:o=="planning"?r:a,opacity:.5,width:.7*Q}),s.$$set=u=>{"schema"in u&&n(0,o=u.schema)},s.$$.update=()=>{if(s.$$.dirty&6){let u=JSON.parse(JSON.stringify(l)),g=[];for(let d of u.features)if(d.geometry.type=="LineString"&&!d.properties.hide_while_editing)for(let p of[d.geometry.coordinates[0],d.geometry.coordinates[d.geometry.coordinates.length-1]])g.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:p}});u.features=u.features.concat(g),t.getSource(P).setData(u)}},[o,t,l]}class St extends z{constructor(e){super(),E(this,e,Ke,null,F,{schema:0})}}function Qe(s){const e=s-1;return e*e*e+1}function ue(s,{delay:e=0,duration:n=400,easing:t=Qe,axis:l="y"}={}){const o=getComputedStyle(s),a=+o.opacity,r=l==="y"?"height":"width",c=parseFloat(o[r]),i=l==="y"?["top","bottom"]:["left","right"],u=i.map(_=>`${_[0].toUpperCase()}${_.slice(1)}`),g=parseFloat(o[`padding${u[0]}`]),d=parseFloat(o[`padding${u[1]}`]),p=parseFloat(o[`margin${u[0]}`]),y=parseFloat(o[`margin${u[1]}`]),k=parseFloat(o[`border${u[0]}Width`]),f=parseFloat(o[`border${u[1]}Width`]);return{delay:e,duration:n,easing:t,css:_=>`overflow: hidden;opacity: ${Math.min(_*20,1)*a};${r}: ${_*c}px;padding-${i[0]}: ${_*g}px;padding-${i[1]}: ${_*d}px;margin-${i[0]}: ${_*p}px;margin-${i[1]}: ${_*y}px;border-${i[0]}-width: ${_*k}px;border-${i[1]}-width: ${_*f}px;`}}function fe(s){let e,n,t;const l=s[3].default,o=J(l,s,s[2],null);return{c(){e=h("div"),o&&o.c()},m(a,r){v(a,e,r),o&&o.m(e,null),t=!0},p(a,r){o&&o.p&&(!t||r&4)&&N(o,l,a,a[2],t?V(l,a[2],r,null):Z(a[2]),null)},i(a){t||($(o,a),a&&_e(()=>{t&&(n||(n=ie(e,ue,{duration:100},!0)),n.run(1))}),t=!0)},o(a){q(o,a),a&&(n||(n=ie(e,ue,{duration:100},!1)),n.run(0)),t=!1},d(a){a&&w(e),o&&o.d(a),a&&n&&n.end()}}}function Xe(s){let e,n,t,l,o,a,r,c,i,u,g=s[0]&&fe(s);return{c(){e=h("button"),n=ae("svg"),t=ae("path"),l=B(),o=I(s[1]),a=B(),g&&g.c(),r=$e(),m(t,"d","M9 5l7 7-7 7"),m(n,"style","tran"),m(n,"width","20"),m(n,"height","20"),m(n,"fill","none"),m(n,"stroke-linecap","round"),m(n,"stroke-linejoin","round"),m(n,"stroke-width","2"),m(n,"viewBox","0 0 24 24"),m(n,"stroke","currentColor"),m(n,"class","svelte-una9lq"),m(e,"aria-expanded",s[0]),m(e,"class","svelte-una9lq")},m(d,p){v(d,e,p),b(e,n),b(n,t),b(e,l),b(e,o),v(d,a,p),g&&g.m(d,p),v(d,r,p),c=!0,i||(u=R(e,"click",s[4]),i=!0)},p(d,[p]){(!c||p&2)&&Le(o,d[1]),(!c||p&1)&&m(e,"aria-expanded",d[0]),d[0]?g?(g.p(d,p),p&1&&$(g,1)):(g=fe(d),g.c(),$(g,1),g.m(r.parentNode,r)):g&&(me(),q(g,1,1,()=>{g=null}),ge())},i(d){c||($(g),c=!0)},o(d){q(g),c=!1},d(d){d&&(w(e),w(a),w(r)),g&&g.d(d),i=!1,u()}}}function Ye(s,e,n){let{$$slots:t={},$$scope:l}=e,{label:o}=e,{open:a=!1}=e;const r=()=>n(0,a=!a);return s.$$set=c=>{"label"in c&&n(1,o=c.label),"open"in c&&n(0,a=c.open),"$$scope"in c&&n(2,l=c.$$scope)},[a,o,l,t,r]}class xe extends z{constructor(e){super(),E(this,e,Ye,Xe,F,{label:1,open:0})}}function et(s,e,n){let t;A(s,H,i=>n(2,t=i));let{layers:l}=e,{contents:o}=e,a=new W.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"none"});t.on("mousemove",r),t.on("mouseout",c),he(()=>{t.off("mousemove",r),t.off("mouseout",c),a.remove()});function r(i){if(!l.every(g=>t.getLayer(g))){a.remove();return}let u=t.queryRenderedFeatures(i.point,{layers:l});u.length>0?a.setLngLat(i.lngLat).setHTML(o(u[0].properties)).addTo(t):a.remove()}function c(){a.remove()}return s.$$set=i=>{"layers"in i&&n(0,l=i.layers),"contents"in i&&n(1,o=i.contents)},[l,o]}class Ct extends z{constructor(e){super(),E(this,e,et,null,F,{layers:0,contents:1})}}function tt(s){let e,n,t,l,o,a,r,c,i,u,g,d,p,y,k;return{c(){e=h("li"),n=h("span"),t=I("Areas"),l=B(),o=h("li"),a=h("span"),r=I("Routes"),c=B(),i=h("li"),u=h("span"),g=I("Crossings"),d=B(),p=h("li"),y=h("span"),k=I("Other"),m(n,"class","svelte-l42ea0"),j(n,"background",C.area),m(a,"class","svelte-l42ea0"),j(a,"background",C.route),m(u,"class","svelte-l42ea0"),j(u,"background",C.crossing),m(y,"class","svelte-l42ea0"),j(y,"background",C.other)},m(f,_){v(f,e,_),b(e,n),b(e,t),v(f,l,_),v(f,o,_),b(o,a),b(o,r),v(f,c,_),v(f,i,_),b(i,u),b(i,g),v(f,d,_),v(f,p,_),b(p,y),b(p,k)},p:O,d(f){f&&(w(e),w(l),w(o),w(c),w(i),w(d),w(p))}}}function st(s){let e,n,t,l,o,a,r,c,i,u,g,d,p,y,k;return{c(){e=h("li"),n=h("span"),t=I("Preapp"),l=B(),o=h("li"),a=h("span"),r=I("Outline"),c=B(),i=h("li"),u=h("span"),g=I("Reserved matters"),d=B(),p=h("li"),y=h("span"),k=I("Local plan"),m(n,"class","svelte-l42ea0"),j(n,"background",C.preapp),m(a,"class","svelte-l42ea0"),j(a,"background",C.outline),m(u,"class","svelte-l42ea0"),j(u,"background",C["reserved matters"]),m(y,"class","svelte-l42ea0"),j(y,"background",C["local plan"])},m(f,_){v(f,e,_),b(e,n),b(e,t),v(f,l,_),v(f,o,_),b(o,a),b(o,r),v(f,c,_),v(f,i,_),b(i,u),b(i,g),v(f,d,_),v(f,p,_),b(p,y),b(p,k)},p:O,d(f){f&&(w(e),w(l),w(o),w(c),w(i),w(d),w(p))}}}function nt(s){let e;function n(o,a){return o[0]=="planning"?st:tt}let t=n(s),l=t(s);return{c(){e=h("ul"),l.c()},m(o,a){v(o,e,a),l.m(e,null)},p(o,a){t===(t=n(o))&&l?l.p(o,a):(l.d(1),l=t(o),l&&(l.c(),l.m(e,null)))},d(o){o&&w(e),l.d()}}}function lt(s){let e,n,t;return n=new xe({props:{label:"Objects",open:!0,$$slots:{default:[nt]},$$scope:{ctx:s}}}),{c(){e=h("div"),Me(n.$$.fragment),m(e,"class","svelte-l42ea0")},m(l,o){v(l,e,o),Ie(n,e,null),t=!0},p(l,[o]){const a={};o&3&&(a.$$scope={dirty:o,ctx:l}),n.$set(a)},i(l){t||($(n.$$.fragment,l),t=!0)},o(l){q(n.$$.fragment,l),t=!1},d(l){l&&w(e),Oe(n)}}}function ot(s,e,n){let{schema:t}=e;return s.$$set=l=>{"schema"in l&&n(0,t=l.schema)},[t]}class $t extends z{constructor(e){super(),E(this,e,ot,lt,F,{schema:0})}}function de(s){let e;const n=s[4].default,t=J(n,s,s[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&N(t,n,l,l[3],e?V(n,l[3],o,null):Z(l[3]),null)},i(l){e||($(t,l),e=!0)},o(l){q(t,l),e=!1},d(l){t&&t.d(l)}}}function at(s){let e,n,t=s[1]&&de(s);return{c(){e=h("div"),t&&t.c(),m(e,"class","map svelte-12dpf1u")},m(l,o){v(l,e,o),t&&t.m(e,null),s[5](e),n=!0},p(l,[o]){l[1]?t?(t.p(l,o),o&2&&$(t,1)):(t=de(l),t.c(),$(t,1),t.m(e,null)):t&&(me(),q(t,1,1,()=>{t=null}),ge())},i(l){n||($(t),n=!0)},o(l){q(t),n=!1},d(l){l&&w(e),t&&t.d(),s[5](null)}}}function it(s,e,n){let{$$slots:t={},$$scope:l}=e,{style:o}=e,a,r,c=!1;Be("setCamera",!window.location.hash),qe(()=>{a=new W.Map({container:r,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),a.addControl(new W.ScaleControl({})),a.addControl(new W.NavigationControl({visualizePitch:!0}),"bottom-right"),a.on("load",()=>{n(1,c=!0),H.set(a)}),new ResizeObserver(()=>{a.resize()}).observe(r)}),he(()=>{a.remove()});function i(u){De[u?"unshift":"push"](()=>{r=u,n(0,r)})}return s.$$set=u=>{"style"in u&&n(2,o=u.style),"$$scope"in u&&n(3,l=u.$$scope)},[r,c,o,l,t,i]}class Lt extends z{constructor(e){super(),E(this,e,it,at,F,{style:2})}}const rt="/atip/atf4_schema/assets/zoom_out_map-b2e1091a.svg";function ct(s){let e,n,t,l,o;return{c(){e=h("button"),n=h("img"),Fe(n.src,t=rt)||m(n,"src",t),m(n,"alt","Zoom to show entire boundary"),m(e,"type","button"),m(e,"title","Zoom to show entire boundary"),m(e,"class","svelte-qzjsqo")},m(a,r){v(a,e,r),b(e,n),l||(o=R(e,"click",s[0]),l=!0)},p:O,i:O,o:O,d(a){a&&w(e),l=!1,o()}}}function ut(s,e,n){let t;A(s,H,a=>n(2,t=a));let{boundaryGeojson:l}=e;function o(){t.fitBounds(je(l),{padding:20,animate:!0,duration:500})}return s.$$set=a=>{"boundaryGeojson"in a&&n(1,l=a.boundaryGeojson)},[o,l]}class Mt extends z{constructor(e){super(),E(this,e,ut,ct,F,{boundaryGeojson:1})}}export{mt as B,xe as C,St as I,kt as L,Ct as M,Mt as Z,Re as a,Ue as b,C as c,bt as d,dt as e,Te as f,be as g,ue as h,yt as i,_t as j,pt as k,Q as l,H as m,vt as n,We as o,wt as p,gt as q,ht as r,Ge as s,Lt as t,Je as u,$t as v};
