import{S as z,i as O,s as H,b as B,c as A,g as v,m as D,l as P,t as $,n as _,q as y,Q as me,C as ge,F as ie,d as C,j as b,p as w,E as le,e as R,h as M,v as q,w as W,aD as _e,u as Y,M as be,a as we,k as L,aq as he,r as de,a8 as ke,B as ve,L as De,f as ye,y as Ce,o as Se,z as Ie,x as oe}from"./index-07b3a841.js";import{e as ae,b as Ee,d as Me,L as Re,M as Le,S as Te}from"./StreetViewController-cc2e512f.js";import{D as Be}from"./DefaultButton-97ec6ae0.js";import{T as $e,W as Ae}from"./WarningButton-d25386d9.js";function Pe(s){let e,n,t;function l(o){s[3](o)}let r={label:"Basemap",id:"basemap",choices:[["streets","Streets"],["hybrid","Satellite"],["dataviz","Dataviz"]],disabled:s[0]};return s[1]!==void 0&&(r.value=s[1]),e=new ae({props:r}),B.push(()=>A(e,"value",l)),e.$on("change",s[2]),{c(){v(e.$$.fragment)},m(o,a){D(e,o,a),t=!0},p(o,[a]){const i={};a&1&&(i.disabled=o[0]),!n&&a&2&&(n=!0,i.value=o[1],P(()=>n=!1)),e.$set(i)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){_(e.$$.fragment,o),t=!1},d(o){y(e,o)}}}function je(s,e,n){let t;me(s,ge,i=>n(4,t=i));let{disabled:l}=e,r="dataviz";function o(){t.setStyle(`https://api.maptiler.com/maps/${r}/style.json?key=MZEJTanw3WpxRvt7qDfo`)}function a(i){r=i,n(1,r)}return s.$$set=i=>{"disabled"in i&&n(0,l=i.disabled)},[l,r,o,a]}class Fe extends z{constructor(e){super(),O(this,e,je,Pe,H,{disabled:0})}}function qe(s){let e,n,t,l,r,o;return e=new le({props:{errorMessage:s[1]}}),{c(){v(e.$$.fragment),n=C(),t=R("input"),M(t,"type","text"),M(t,"class","govuk-input"),M(t,"id","locationDescription")},m(a,i){D(e,a,i),b(a,n,i),b(a,t,i),q(t,s[0]),l=!0,r||(o=[W(t,"input",s[5]),W(t,"change",s[3])],r=!0)},p(a,i){const c={};i&2&&(c.errorMessage=a[1]),e.$set(c),i&1&&t.value!==a[0]&&q(t,a[0])},i(a){l||($(e.$$.fragment,a),l=!0)},o(a){_(e.$$.fragment,a),l=!1},d(a){a&&(w(n),w(t)),y(e,a),r=!1,_e(o)}}}function Ve(s){let e;return{c(){e=Y("Lookup location description automatically")},m(n,t){b(n,e,t)},d(n){n&&w(e)}}}function We(s){let e,n,t;function l(o){s[6](o)}let r={id:"lookupLocation",$$slots:{default:[Ve]},$$scope:{ctx:s}};return s[2]!==void 0&&(r.checked=s[2]),e=new Me({props:r}),B.push(()=>A(e,"checked",l)),{c(){v(e.$$.fragment)},m(o,a){D(e,o,a),t=!0},p(o,a){const i={};a&256&&(i.$$scope={dirty:a,ctx:o}),!n&&a&4&&(n=!0,i.checked=o[2],P(()=>n=!1)),e.$set(i)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){_(e.$$.fragment,o),t=!1},d(o){y(e,o)}}}function ze(s){let e,n,t,l;return e=new ie({props:{label:"Describe this location",id:"locationDescription",$$slots:{default:[qe]},$$scope:{ctx:s}}}),t=new Ee({props:{small:!0,$$slots:{default:[We]},$$scope:{ctx:s}}}),{c(){v(e.$$.fragment),n=C(),v(t.$$.fragment)},m(r,o){D(e,r,o),b(r,n,o),D(t,r,o),l=!0},p(r,[o]){const a={};o&259&&(a.$$scope={dirty:o,ctx:r}),e.$set(a);const i={};o&260&&(i.$$scope={dirty:o,ctx:r}),t.$set(i)},i(r){l||($(e.$$.fragment,r),$(t.$$.fragment,r),l=!0)},o(r){_(e.$$.fragment,r),_(t.$$.fragment,r),l=!1},d(r){r&&w(n),y(e,r),y(t,r)}}}function Oe(s,e,n){let{locationDescription:t}=e,{locationDescriptionError:l}=e,{pt:r}=e,o=!0;async function a(p){if(!o)return;let h=`https://nominatim.openstreetmap.org/reverse?lat=${p.lat}&lon=${p.lng}&format=json`;try{n(0,t="Loading...");let f=await(await fetch(h)).json();n(0,t=f.address.road??f.display_name)}catch(d){console.log(`Location lookup failed: ${d}`)}}function i(){n(2,o=!1)}function c(){t=this.value,n(0,t)}function m(p){o=p,n(2,o)}return s.$$set=p=>{"locationDescription"in p&&n(0,t=p.locationDescription),"locationDescriptionError"in p&&n(1,l=p.locationDescriptionError),"pt"in p&&n(4,r=p.pt)},s.$$.update=()=>{s.$$.dirty&16&&a(r)},[t,l,o,i,r,c,m]}class He extends z{constructor(e){super(),O(this,e,Oe,ze,H,{locationDescription:0,locationDescriptionError:1,pt:4})}}function Ge(s){let e,n,t,l,r,o;return e=new le({props:{errorMessage:s[7]}}),{c(){v(e.$$.fragment),n=C(),t=R("input"),M(t,"type","text"),M(t,"class","govuk-input"),M(t,"id","inspector")},m(a,i){D(e,a,i),b(a,n,i),b(a,t,i),q(t,s[1]),l=!0,r||(o=W(t,"input",s[18]),r=!0)},p(a,i){const c={};i&128&&(c.errorMessage=a[7]),e.$set(c),i&2&&t.value!==a[1]&&q(t,a[1])},i(a){l||($(e.$$.fragment,a),l=!0)},o(a){_(e.$$.fragment,a),l=!1},d(a){a&&(w(n),w(t)),y(e,a),r=!1,o()}}}function Je(s){let e,n,t,l,r,o,a,i;return t=new le({props:{errorMessage:s[8]}}),{c(){e=R("div"),e.textContent="Example: ATF2_WLT_01",n=C(),v(t.$$.fragment),l=C(),r=R("input"),M(e,"class","govuk-hint"),M(r,"type","text"),M(r,"class","govuk-input"),M(r,"id","schemeReference")},m(c,m){b(c,e,m),b(c,n,m),D(t,c,m),b(c,l,m),b(c,r,m),q(r,s[2]),o=!0,a||(i=W(r,"input",s[19]),a=!0)},p(c,m){const p={};m&256&&(p.errorMessage=c[8]),t.$set(p),m&4&&r.value!==c[2]&&q(r,c[2])},i(c){o||($(t.$$.fragment,c),o=!0)},o(c){_(t.$$.fragment,c),o=!1},d(c){c&&(w(e),w(n),w(l),w(r)),y(t,c),a=!1,i()}}}function Ke(s){let e;return{c(){e=Y("Export")},m(n,t){b(n,e,t)},d(n){n&&w(e)}}}function Ne(s){let e;return{c(){e=Y("Keep editing this issue")},m(n,t){b(n,e,t)},d(n){n&&w(e)}}}function Qe(s){let e;return{c(){e=Y("Done! Enter a new critical")},m(n,t){b(n,e,t)},d(n){n&&w(e)}}}function Ue(s){let e,n,t,l,r,o,a,i,c,m,p,h;return o=new $e({props:{label:"The new row has already been copied to your clipboard. If it didn't work, copy from below",value:s[14]}}),c=new we({props:{$$slots:{default:[Ne]},$$scope:{ctx:s}}}),c.$on("click",s[24]),p=new Ae({props:{$$slots:{default:[Qe]},$$scope:{ctx:s}}}),p.$on("click",Xe),{c(){e=R("div"),n=R("p"),n.innerHTML=`Edit <i>Inspectors Log.xlsx</i>
      , add a new row at the bottom of
      <i>Form Input</i>
      , and press
      <i>Control+V</i>
      to paste.`,t=C(),l=R("p"),l.innerHTML="<b>You have to manually fill out the first ID column!</b>",r=C(),v(o.$$.fragment),a=C(),i=R("div"),v(c.$$.fragment),m=C(),v(p.$$.fragment),M(i,"class","govuk-button-group"),M(e,"class","govuk-prose")},m(d,f){b(d,e,f),L(e,n),L(e,t),L(e,l),L(e,r),D(o,e,null),L(e,a),L(e,i),D(c,i,null),L(i,m),D(p,i,null),h=!0},p(d,f){const k={};f&16384&&(k.value=d[14]),o.$set(k);const S={};f&134217728&&(S.$$scope={dirty:f,ctx:d}),c.$set(S);const I={};f&134217728&&(I.$$scope={dirty:f,ctx:d}),p.$set(I)},i(d){h||($(o.$$.fragment,d),$(c.$$.fragment,d),$(p.$$.fragment,d),h=!0)},o(d){_(o.$$.fragment,d),_(c.$$.fragment,d),_(p.$$.fragment,d),h=!1},d(d){d&&w(e),y(o),y(c),y(p)}}}function Ye(s){let e,n,t,l,r,o,a,i,c,m,p,h,d,f,k,S,I,j,T,V,F;e=new ie({props:{label:"Inspector name",id:"inspector",$$slots:{default:[Ge]},$$scope:{ctx:s}}}),t=new ie({props:{label:"Scheme reference",id:"schemeReference",$$slots:{default:[Je]},$$scope:{ctx:s}}});function Z(u){s[20](u)}let G={label:"Current design stage",id:"currentDesignStage",choices:s[15],emptyOption:!0,errorMessage:s[9]};s[3]!==void 0&&(G.value=s[3]),r=new ae({props:G}),B.push(()=>A(r,"value",Z));function X(u){s[21](u)}let J={pt:s[0],locationDescriptionError:s[11]};s[5]!==void 0&&(J.locationDescription=s[5]),i=new He({props:J}),B.push(()=>A(i,"locationDescription",X));function x(u){s[22](u)}let K={label:"Critical issue type",id:"criticalIssueType",choices:s[16],emptyOption:!0,errorMessage:s[10]};s[4]!==void 0&&(K.value=s[4]),p=new ae({props:K}),B.push(()=>A(p,"value",x));function ee(u){s[23](u)}let N={label:"Comments or notes",errorMessage:s[12]};s[6]!==void 0&&(N.value=s[6]),f=new $e({props:N}),B.push(()=>A(f,"value",ee)),I=new Be({props:{$$slots:{default:[Ke]},$$scope:{ctx:s}}}),I.$on("click",s[17]);function E(u){s[25](u)}let Q={title:"Almost done!",displayEscapeButton:!1,canCloseByClickingBackground:!1,$$slots:{default:[Ue]},$$scope:{ctx:s}};return s[13]!==void 0&&(Q.open=s[13]),T=new be({props:Q}),B.push(()=>A(T,"open",E)),{c(){v(e.$$.fragment),n=C(),v(t.$$.fragment),l=C(),v(r.$$.fragment),a=C(),v(i.$$.fragment),m=C(),v(p.$$.fragment),d=C(),v(f.$$.fragment),S=C(),v(I.$$.fragment),j=C(),v(T.$$.fragment)},m(u,g){D(e,u,g),b(u,n,g),D(t,u,g),b(u,l,g),D(r,u,g),b(u,a,g),D(i,u,g),b(u,m,g),D(p,u,g),b(u,d,g),D(f,u,g),b(u,S,g),D(I,u,g),b(u,j,g),D(T,u,g),F=!0},p(u,[g]){const ue={};g&134217858&&(ue.$$scope={dirty:g,ctx:u}),e.$set(ue);const ce={};g&134217988&&(ce.$$scope={dirty:g,ctx:u}),t.$set(ce);const te={};g&512&&(te.errorMessage=u[9]),!o&&g&8&&(o=!0,te.value=u[3],P(()=>o=!1)),r.$set(te);const U={};g&1&&(U.pt=u[0]),g&2048&&(U.locationDescriptionError=u[11]),!c&&g&32&&(c=!0,U.locationDescription=u[5],P(()=>c=!1)),i.$set(U);const ne={};g&1024&&(ne.errorMessage=u[10]),!h&&g&16&&(h=!0,ne.value=u[4],P(()=>h=!1)),p.$set(ne);const re={};g&4096&&(re.errorMessage=u[12]),!k&&g&64&&(k=!0,re.value=u[6],P(()=>k=!1)),f.$set(re);const fe={};g&134217728&&(fe.$$scope={dirty:g,ctx:u}),I.$set(fe);const se={};g&134242304&&(se.$$scope={dirty:g,ctx:u}),!V&&g&8192&&(V=!0,se.open=u[13],P(()=>V=!1)),T.$set(se)},i(u){F||($(e.$$.fragment,u),$(t.$$.fragment,u),$(r.$$.fragment,u),$(i.$$.fragment,u),$(p.$$.fragment,u),$(f.$$.fragment,u),$(I.$$.fragment,u),$(T.$$.fragment,u),F=!0)},o(u){_(e.$$.fragment,u),_(t.$$.fragment,u),_(r.$$.fragment,u),_(i.$$.fragment,u),_(p.$$.fragment,u),_(f.$$.fragment,u),_(I.$$.fragment,u),_(T.$$.fragment,u),F=!1},d(u){u&&(w(n),w(l),w(a),w(m),w(d),w(S),w(j)),y(e,u),y(t,u),y(r,u),y(i,u),y(p,u),y(f,u),y(I,u),y(T,u)}}}function pe(s){return s.map(e=>[e,e])}function Ze(s){let e=25569,t=24*(60*60*1e3);return s.getTime()/t+e}function Xe(){location.reload()}function xe(s,e,n){let{pt:t}=e,l=window.localStorage.getItem("inspector")??"",r=window.localStorage.getItem("schemeReference")??"",o=window.localStorage.getItem("currentDesignStage")??"",a="",i="",c="",m="",p="",h="",d="",f="",k="",S=!1,I="",j=pe(["Baseline","Feasibility Design","Preliminary Design","Outline Design","Detailed Design","Inspection"]),T=pe(["1 - Conflict at Side Roads","2 - Conflict at Major Junctions / Roundabouts","3 - Collision Alongside or from Behind","4 - Trip Hazard","5 - Kerbside Activity","6A - Risk of Crossing Conflict (Busy Roads)","6B - Risk of Crossing Conflict (Quieter Roads)","7A - Standard of Crossing Facility (Busy Roads)","7B - Standard of Crossing Facility (Junction)","8 - Traffic Speed (>37mph)","9A - Traffic Volume (>10,000vpd)","9B - Traffic Volume (>5% HGVs)","10 - Crossing Speed","11A - Footway Width (Absolute Minimum <1m)","11B - Footway Width (at Pinchpoints)","11C - Footway Width - Poor Pedestrian Comfort","12 - Tram - Insufficient width next to Tram Track","13 - Tram/Rail - Poor Crossing Angle","14 - Major Cycle Surface Defect","15 - Major Pedestrian Surface Defect","16 - Inappropriate Shared Use","17 - Barriers, Steps and/or Dismount signs","18 - Route isn't direct, logical or intuitive to all users","19 - Inappropriate Surface Materials","20 - Inappropriate Lighting","21 - Routes must join other facilities as a network"]);function V(){let E=0,Q=Ze(new Date);return[E,l,Q,r,o,a,he(t.toArray().reverse()).join(", "),i,c].join("	")}function F(){n(7,m=l?"":"Required"),n(8,p=r?"":"Required"),n(9,h=o?"":"Required"),n(10,d=a?"":"Required"),n(11,f=i?"":"Required"),n(12,k=c?"":"Required"),!(m||p||h||d||f||k)&&(n(14,I=V()),navigator.clipboard.writeText(I),n(13,S=!0))}function Z(){l=this.value,n(1,l)}function G(){r=this.value,n(2,r)}function X(E){o=E,n(3,o)}function J(E){i=E,n(5,i)}function x(E){a=E,n(4,a)}function K(E){c=E,n(6,c)}const ee=()=>n(13,S=!1);function N(E){S=E,n(13,S)}return s.$$set=E=>{"pt"in E&&n(0,t=E.pt)},s.$$.update=()=>{s.$$.dirty&2&&window.localStorage.setItem("inspector",l),s.$$.dirty&4&&window.localStorage.setItem("schemeReference",r),s.$$.dirty&8&&window.localStorage.setItem("currentDesignStage",o)},[t,l,r,o,a,i,c,m,p,h,d,f,k,S,I,j,T,F,Z,G,X,J,x,K,ee,N]}class et extends z{constructor(e){super(),O(this,e,xe,Ye,H,{pt:0})}}function tt(s,e,n){let t;me(s,ge,i=>n(3,t=i));let{enableAdding:l}=e,r=null,{markerPosition:o=null}=e;de(()=>{t.on("click",a),t.getCanvas().style.cursor="crosshair"}),ke(()=>{r&&r.remove(),t.off("click",a)});function a(i){r||!l||(t.getCanvas().style.cursor="inherit",r=new ve.Marker({draggable:!0}).setLngLat(i.lngLat).addTo(t),n(0,o=r.getLngLat()),r.on("dragstart",()=>{t.getCanvas().style.cursor="grabbing"}),r.on("dragend",()=>{t.getCanvas().style.cursor="inherit",n(0,o=r.getLngLat())}))}return s.$$set=i=>{"enableAdding"in i&&n(1,l=i.enableAdding),"markerPosition"in i&&n(0,o=i.markerPosition)},[o,l]}class nt extends z{constructor(e){super(),O(this,e,tt,null,H,{enableAdding:1,markerPosition:0})}}function rt(s){let e;return{c(){e=R("p"),e.textContent="Click the map to add a critical"},m(n,t){b(n,e,t)},p:oe,i:oe,o:oe,d(n){n&&w(e)}}}function st(s){let e,n;return e=new et({props:{pt:s[0]}}),{c(){v(e.$$.fragment)},m(t,l){D(e,t,l),n=!0},p(t,l){const r={};l&1&&(r.pt=t[0]),e.$set(r)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){y(e,t)}}}function ot(s){let e,n,t,l,r,o,a,i,c,m;o=new De({});const p=[st,rt],h=[];function d(f,k){return f[0]?0:1}return i=d(s),c=h[i]=p[i](s),{c(){e=R("div"),n=R("h1"),n.textContent="Critical issue entry",t=C(),l=R("p"),l.textContent=`App version: ${ye()}`,r=C(),v(o.$$.fragment),a=C(),c.c(),M(e,"slot","sidebar"),M(e,"class","govuk-prose")},m(f,k){b(f,e,k),L(e,n),L(e,t),L(e,l),L(e,r),D(o,e,null),L(e,a),h[i].m(e,null),m=!0},p(f,k){let S=i;i=d(f),i===S?h[i].p(f,k):(Ce(),_(h[S],1,1,()=>{h[S]=null}),Se(),c=h[i],c?c.p(f,k):(c=h[i]=p[i](f),c.c()),$(c,1),c.m(e,null))},i(f){m||($(o.$$.fragment,f),$(c),m=!0)},o(f){_(o.$$.fragment,f),_(c),m=!1},d(f){f&&w(e),y(o),h[i].d()}}}function it(s){let e,n,t,l,r,o,a,i,c;function m(f){s[4](f)}let p={enableAdding:s[1]};s[0]!==void 0&&(p.markerPosition=s[0]),e=new nt({props:p}),B.push(()=>A(e,"markerPosition",m)),r=new Fe({props:{disabled:!s[1]}});function h(f){s[6](f)}let d={displayEnableButton:!0};return s[1]!==void 0&&(d.isInactive=s[1]),a=new Te({props:d}),s[5](a),B.push(()=>A(a,"isInactive",h)),{c(){v(e.$$.fragment),t=C(),l=R("div"),v(r.$$.fragment),o=C(),v(a.$$.fragment),M(l,"class","top-right svelte-nlvvhu")},m(f,k){D(e,f,k),b(f,t,k),b(f,l,k),D(r,l,null),L(l,o),D(a,l,null),c=!0},p(f,k){const S={};k&2&&(S.enableAdding=f[1]),!n&&k&1&&(n=!0,S.markerPosition=f[0],P(()=>n=!1)),e.$set(S);const I={};k&2&&(I.disabled=!f[1]),r.$set(I);const j={};!i&&k&2&&(i=!0,j.isInactive=f[1],P(()=>i=!1)),a.$set(j)},i(f){c||($(e.$$.fragment,f),$(r.$$.fragment,f),$(a.$$.fragment,f),c=!0)},o(f){_(e.$$.fragment,f),_(r.$$.fragment,f),_(a.$$.fragment,f),c=!1},d(f){f&&(w(t),w(l)),y(e,f),y(r),s[5](null),y(a)}}}function at(s){let e,n,t;return n=new Le({props:{style:"dataviz",startBounds:[-5.96,49.89,2.31,55.94],$$slots:{default:[it]},$$scope:{ctx:s}}}),{c(){e=R("div"),v(n.$$.fragment),M(e,"slot","main")},m(l,r){b(l,e,r),D(n,e,null),t=!0},p(l,r){const o={};r&135&&(o.$$scope={dirty:r,ctx:l}),n.$set(o)},i(l){t||($(n.$$.fragment,l),t=!0)},o(l){_(n.$$.fragment,l),t=!1},d(l){l&&w(e),y(n)}}}function lt(s){let e,n,t,l;return e=new Re({props:{sidebarWidth:"35rem",$$slots:{main:[at],sidebar:[ot]},$$scope:{ctx:s}}}),{c(){v(e.$$.fragment)},m(r,o){D(e,r,o),n=!0,t||(l=W(window,"keydown",s[3]),t=!0)},p(r,[o]){const a={};o&135&&(a.$$scope={dirty:o,ctx:r}),e.$set(a)},i(r){n||($(e.$$.fragment,r),n=!0)},o(r){_(e.$$.fragment,r),n=!1},d(r){y(e,r),t=!1,l()}}}function ut(s,e,n){de(()=>{Ie()});let t=null,l=!0,r;function o(m){!l&&m.key=="Escape"&&(r.disableStreetView(),m.preventDefault())}function a(m){t=m,n(0,t)}function i(m){B[m?"unshift":"push"](()=>{r=m,n(2,r)})}function c(m){l=m,n(1,l)}return[t,l,r,o,a,i,c]}class ct extends z{constructor(e){super(),O(this,e,ut,lt,H,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new ct({target:document.getElementById("app")});
