var fi=Object.defineProperty;var ci=(r,e,t)=>e in r?fi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var re=(r,e,t)=>(ci(r,typeof e!="symbol"?e+"":e,t),t);import{S as ee,i as te,s as Q,M as pi,b as ie,a as ke,d as H,m as Y,k as Se,n as L,o as P,q as J,e as k,c as C,g as S,x as j,p as E,y as je,f as $,z as ve,B as be,C as hi,D as En,E as nn,F as Ot,G as st,H as lt,I as at,J as ut,K as xn,h as w,l as x,L as di,N as mi,O as se,P as _i,w as Mn,Q as Ze,R as ye,T as Vt,t as U,U as pe,V as ue,j as Te,r as Le,W as Re,X as Pr,Y as Ar,Z as Ct,_ as ct,$ as qt,a0 as In,a1 as gi,a2 as vi,a3 as Ne,a4 as bi,a5 as yi,a6 as wi,a7 as jt,a8 as Fr,a9 as Kt,aa as mt,ab as Zt,ac as St,ad as Qt,ae as un,af as ki,ag as ft,ah as $n,ai as We,aj as pt,ak as Si,al as On,am as Ei,an as Mi,ao as $i,ap as Bn,aq as Gt,ar as Oi,as as Ci,at as Li,A as Ti,u as Ri}from"./authorities-2ef082af.js";function Pi(r){let e,t,n,i,o,s,a,l,u,h,_,c,f;return{c(){e=k("p"),e.textContent="For each intervention:",t=C(),n=k("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=C(),o=k("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=C(),a=k("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=C(),u=k("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,h=C(),_=k("p"),_.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=C(),f=k("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(m,g){S(m,e,g),S(m,t,g),S(m,n,g),S(m,i,g),S(m,o,g),S(m,s,g),S(m,a,g),S(m,l,g),S(m,u,g),S(m,h,g),S(m,_,g),S(m,c,g),S(m,f,g)},p:j,d(m){m&&E(e),m&&E(t),m&&E(n),m&&E(i),m&&E(o),m&&E(s),m&&E(a),m&&E(l),m&&E(u),m&&E(h),m&&E(_),m&&E(c),m&&E(f)}}}function Ai(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Pi]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new pi({props:o}),ie.push(()=>ke(e,"open",i,r[0])),{c(){H(e.$$.fragment)},m(s,a){Y(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Se(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){J(e,s)}}}function Fi(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Ni extends ee{constructor(e){super(),te(this,e,Fi,Ai,Q,{open:0})}}const Qe=[];function _t(r,e=j){let t;const n=new Set;function i(a){if(Q(r,a)&&(r=a,t)){const l=!Qe.length;for(const u of n)u[1](),Qe.push(u,r);if(l){for(let u=0;u<Qe.length;u+=2)Qe[u][0](Qe[u+1]);Qe.length=0}}}function o(a){i(a(r))}function s(a,l=j){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||j),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ge=_t(null),ne=_t(je()),we=_t(null),De=_t(null),Et=_t(null),fn=_t(null);function Lt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Dn(r){ne.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),we.set(null),De.set(null),Et.set(null)}function qn(r){let e;const t=r[4].default,n=st(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&lt(n,t,i,i[3],e?ut(t,i[3],o,null):at(i[3]),null)},i(i){e||(L(n,i),e=!0)},o(i){P(n,i),e=!1},d(i){n&&n.d(i)}}}function xi(r){let e,t,n=r[1]&&qn(r);return{c(){e=k("div"),n&&n.c(),$(e,"class","map svelte-12dpf1u")},m(i,o){S(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&L(n,1)):(n=qn(i),n.c(),L(n,1),n.m(e,null)):n&&(ve(),P(n,1,1,()=>{n=null}),be())},i(i){t||(L(n),t=!0)},o(i){P(n),t=!1},d(i){i&&E(e),n&&n.d(),r[5](null)}}}function Ii(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;hi("setCamera",!window.location.hash),En(()=>{s=new nn.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new nn.ScaleControl({})),s.addControl(new nn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ge.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),Ot(()=>{s.remove()});function u(h){ie[h?"unshift":"push"](()=>{a=h,t(0,a)})}return r.$$set=h=>{"style"in h&&t(2,o=h.style),"$$scope"in h&&t(3,i=h.$$scope)},[a,l,o,i,n,u]}class Bi extends ee{constructor(e){super(),te(this,e,Ii,xi,Q,{style:2})}}const Di=r=>({}),jn=r=>({}),qi=r=>({}),Gn=r=>({}),ji=r=>({}),Hn=r=>({});function Gi(r){let e,t,n,i,o,s,a,l,u,h,_,c;const f=r[3].nav,m=st(f,r,r[2],Hn),g=r[3].sidebar,d=st(g,r,r[2],Gn),b=r[3].main,p=st(b,r,r[2],jn);return{c(){e=k("aside"),t=k("div"),n=k("nav"),m&&m.c(),i=C(),d&&d.c(),o=C(),s=k("button"),s.textContent="â†’",l=C(),u=k("main"),p&&p.c(),$(n,"class","svelte-1u7vg8a"),$(t,"class","sidebar-content content-container svelte-1u7vg8a"),$(s,"type","button"),$(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),$(e,"class",a=xn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),$(u,"class","svelte-1u7vg8a")},m(v,y){S(v,e,y),w(e,t),w(t,n),m&&m.m(n,null),w(t,i),d&&d.m(t,null),w(e,o),w(e,s),S(v,l,y),S(v,u,y),p&&p.m(u,null),h=!0,_||(c=x(s,"click",r[1]),_=!0)},p(v,[y]){m&&m.p&&(!h||y&4)&&lt(m,f,v,v[2],h?ut(f,v[2],y,ji):at(v[2]),Hn),d&&d.p&&(!h||y&4)&&lt(d,g,v,v[2],h?ut(g,v[2],y,qi):at(v[2]),Gn),(!h||y&1&&a!==(a=xn(v[0]?"":"collapsed")+" svelte-1u7vg8a"))&&$(e,"class",a),p&&p.p&&(!h||y&4)&&lt(p,b,v,v[2],h?ut(b,v[2],y,Di):at(v[2]),jn)},i(v){h||(L(m,v),L(d,v),L(p,v),h=!0)},o(v){P(m,v),P(d,v),P(p,v),h=!1},d(v){v&&E(e),m&&m.d(v),d&&d.d(v),v&&E(l),v&&E(u),p&&p.d(v),_=!1,c()}}}function Hi(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class Yi extends ee{constructor(e){super(),te(this,e,Hi,Gi,Q,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Ji(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(h){return l([u,h])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(h){u=[6,h],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ke=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Ui(r,e){return r>e?1:r<e?-1:0}function Je(r,e,t){for(var n=new Ke(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function rn(r,e,t,n){var i=new Ke(r,e);if(t===null)return i.left=i.right=null,i;t=Je(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Yn(r,e,t){var n=null,i=null;if(e){e=Je(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Xi(r,e,t){return e===null?r:(r===null||(e=Je(r.key,e,t),e.left=r),e)}function cn(r,e,t,n,i){if(r){n(""+e+(t?"â””â”€â”€ ":"â”œâ”€â”€ ")+i(r)+`
`);var o=e+(t?"    ":"â”‚   ");r.left&&cn(r.left,o,!1,n,i),r.right&&cn(r.right,o,!0,n,i)}}var Cn=function(){function r(e){e===void 0&&(e=Ui),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=rn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ke(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Je(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Je(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Je(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Je(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Je(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Wi(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&dn(e,t,0,i-1,o),this._root===null)this._root=pn(e,t,0,i),this._size=i;else{var s=Vi(this.toList(),zi(e,t),o);i=this._size+i,this._root=hn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return cn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Yn(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=rn(t,n,a,i):s=rn(t,n,s,i),this._root=Xi(s,a,i)},r.prototype.split=function(e){return Yn(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Ji(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function pn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ke(s,a);return l.left=pn(r,e,t,o),l.right=pn(r,e,o+1,n),l}return null}function zi(r,e){for(var t=new Ke(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ke(r[i],e[i]);return n.next=null,t.next}function Wi(r){for(var e=r,t=[],n=!1,i=new Ke(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function hn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=hn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=hn(r,i+1,t),s}return null}function Vi(r,e,t){for(var n=new Ke(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function dn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}dn(r,e,t,a,i),dn(r,e,a+1,n,i)}}function Pe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Jn(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Ee(r,e,t){return e&&Jn(r.prototype,e),t&&Jn(r,t),r}var gt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},mn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Xe=Number.EPSILON;Xe===void 0&&(Xe=Math.pow(2,-52));var Ki=Xe*Xe,_n=function(e,t){if(-Xe<e&&e<Xe&&-Xe<t&&t<Xe)return 0;var n=e-t;return n*n<Ki*e*t?0:e<t?-1:1},Zi=function(){function r(){Pe(this,r),this.reset()}return Ee(r,[{key:"reset",value:function(){this.xRounder=new Un,this.yRounder=new Un}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Un=function(){function r(){Pe(this,r),this.tree=new Cn,this.round(0)}return Ee(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&_n(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&_n(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Mt=new Zi,bt=function(e,t){return e.x*t.y-e.y*t.x},Nr=function(e,t){return e.x*t.x+e.y*t.y},Xn=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=bt(i,o);return _n(s,0)},Ht=function(e){return Math.sqrt(Nr(e,e))},Qi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return bt(o,i)/Ht(o)/Ht(i)},eo=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Nr(o,i)/Ht(o)/Ht(i)},zn=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Wn=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},to=function(e,t,n,i){if(t.x===0)return Wn(n,i,e.x);if(i.x===0)return Wn(e,t,n.x);if(t.y===0)return zn(n,i,e.y);if(i.y===0)return zn(e,t,n.y);var o=bt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=bt(s,t)/o,l=bt(s,i)/o,u=e.x+l*t.x,h=n.x+a*i.x,_=e.y+l*t.y,c=n.y+a*i.y,f=(u+h)/2,m=(_+c)/2;return{x:f,y:m}},Be=function(){Ee(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Yt.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Pe(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Ee(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:Qi(n.point,t.point,l.point),cosine:eo(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,h=l.cosine,_=i.get(a),c=_.sine,f=_.cosine;return u>=0&&c>=0?h<f?1:h>f?-1:0:u<0&&c<0?h<f?-1:h>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),no=0,Yt=function(){Ee(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,h=t.rightSE.point.y,_=n.rightSE.point.y;if(i<o){if(u<l&&u<h)return 1;if(u>l&&u>h)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<_)return-1;if(l>u&&l>_)return 1;var m=n.comparePoint(t.leftSE.point);if(m!==0)return m;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var d=n.comparePoint(t.rightSE.point);if(d!==0)return d}if(s>a){var b=t.comparePoint(n.rightSE.point);if(b<0)return 1;if(b>0)return-1}if(s!==a){var p=h-l,v=s-i,y=_-u,M=a-o;if(p>v&&y<M)return 1;if(p<v&&y>M)return-1}return s>a?1:s<a||h<_?-1:h>_?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Pe(this,r),this.id=++no,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Ee(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=mn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,h=gt(n,l)&&this.comparePoint(l)===0,_=gt(i,s)&&t.comparePoint(s)===0,c=gt(n,u)&&this.comparePoint(u)===0,f=gt(i,a)&&t.comparePoint(a)===0;if(_&&h)return f&&!c?a:!f&&c?u:null;if(_)return c&&s.x===u.x&&s.y===u.y?null:s;if(h)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var m=to(s,this.vector(),l,t.vector());return m===null||!gt(o,m)?null:Mt.round(m.x,m.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Be(t,!0),s=new Be(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Be.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Be.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var h=i.rings[l],_=i.windings[l],c=n.rings.indexOf(h);c===-1?(n.rings.push(h),n.windings.push(_)):n.windings[c]+=_}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],h=n.indexOf(l);h===-1?(n.push(l),i.push(u)):i[h]+=u}for(var _=[],c=[],f=0,m=n.length;f<m;f++)if(i[f]!==0){var g=n[f],d=g.poly;if(c.indexOf(d)===-1)if(g.isExterior)_.push(d);else{c.indexOf(d)===-1&&c.push(d);var b=_.indexOf(g.poly);b!==-1&&_.splice(b,1)}}for(var p=0,v=_.length;p<v;p++){var y=_[p].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(xe.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===xe.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(_){return _.length===1&&_[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(xe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Be.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Be(o,!0),h=new Be(s,!1);return new r(u,h,[i],[a])}}]),r}(),Vn=function(){function r(e,t,n){if(Pe(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Mt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Mt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(Yt.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Yt.fromRing(o,i,this))}return Ee(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),ro=function(){function r(e,t){if(Pe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Vn(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Vn(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Ee(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Kn=function(){function r(e,t){if(Pe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new ro(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Ee(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),io=function(){Ee(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,h=[l],_=l.point,c=[];a=l,l=u,h.push(l),l.point!==_;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var m=h[0].point,g=h[h.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(m.x,",")+" ".concat(m.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var d=null,b=0,p=c.length;b<p;b++)if(c[b].point===l.point){d=b;break}if(d!==null){var v=c.splice(d)[0],y=h.splice(v.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}c.push({index:h.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(h))}}return n}}]);function r(e){Pe(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Ee(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Xn(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Xn(l,t,u)===0&&n.shift(),n.push(n[0]);for(var h=this.isExteriorRing()?1:-1,_=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],m=_;m!=c;m+=h)f.push([n[m].x,n[m].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Be.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Zn=function(){function r(e){Pe(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Ee(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),oo=function(){function r(e){Pe(this,r),this.rings=e,this.polys=this._composePolys(e)}return Ee(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Zn(s));else{var a=s.enclosingRing();a.poly||n.push(new Zn(a)),a.poly.addInterior(s)}}return n}}]),r}(),so=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Yt.compare;Pe(this,r),this.queue=e,this.tree=new Cn(t),this.segments=[]}return Ee(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var h=null;if(l){var _=l.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(h=_),!l.isAnEndpoint(_)))for(var c=this._splitSafely(l,_),f=0,m=c.length;f<m;f++)i.push(c[f])}var g=null;if(u){var d=u.getIntersection(n);if(d!==null&&(n.isAnEndpoint(d)||(g=d),!u.isAnEndpoint(d)))for(var b=this._splitSafely(u,d),p=0,v=b.length;p<v;p++)i.push(b[p])}if(h!==null||g!==null){var y=null;if(h===null)y=g;else if(g===null)y=h;else{var M=Be.comparePoints(h,g);y=M<=0?h:g}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var O=n.split(y),R=0,T=O.length;R<T;R++)i.push(O[R])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var A=l.getIntersection(u);if(A!==null){if(!l.isAnEndpoint(A))for(var B=this._splitSafely(l,A),N=0,V=B.length;N<V;N++)i.push(B[N]);if(!u.isAnEndpoint(A))for(var q=this._splitSafely(u,A),D=0,I=q.length;D<I;D++)i.push(q[D])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Qn=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,lo=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ao=function(){function r(){Pe(this,r)}return Ee(r,[{key:"run",value:function(t,n,i){xe.type=t,Mt.reset();for(var o=[new Kn(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Kn(i[s],!1));if(xe.numMultiPolys=o.length,xe.type==="difference")for(var l=o[0],u=1;u<o.length;)mn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(xe.type==="intersection"){for(var h=0,_=o.length;h<_;h++)for(var c=o[h],f=h+1,m=o.length;f<m;f++)if(mn(c.bbox,o[f].bbox)===null)return[]}for(var g=new Cn(Be.compare),d=0,b=o.length;d<b;d++)for(var p=o[d].getSweepEvents(),v=0,y=p.length;v<y;v++)if(g.insert(p[v]),g.size>Qn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new so(g),O=g.size,R=g.pop();R;){var T=R.key;if(g.size===O){var A=T.segment;throw new Error("Unable to pop() ".concat(T.isLeft?"left":"right"," SweepEvent ")+"[".concat(T.point.x,", ").concat(T.point.y,"] from segment #").concat(A.id," ")+"[".concat(A.leftSE.point.x,", ").concat(A.leftSE.point.y,"] -> ")+"[".concat(A.rightSE.point.x,", ").concat(A.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Qn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>lo)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var B=M.process(T),N=0,V=B.length;N<V;N++){var q=B[N];q.consumedBy===void 0&&g.insert(q)}O=g.size,R=g.pop()}Mt.reset();var D=io.factory(M.segments),I=new oo(D);return I.getGeom()}}]),r}(),xe=new ao,uo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe.run("union",e,n)},fo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe.run("intersection",e,n)},co=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe.run("xor",e,n)},po=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe.run("difference",e,n)},Ft={union:uo,intersection:fo,xor:co,difference:po};function ho(r,e){var t=_o(e),n=null;return r.type==="FeatureCollection"?n=mo(r):n=xr(Ft.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function mo(r){var e=r.features.length===2?Ft.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Ft.union.apply(Ft,r.features.map(function(t){return t.geometry.coordinates}));return xr(e)}function xr(r){return di(r)}function _o(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return mi(t)}function go(r,e,t){let n;se(r,Ge,s=>t(1,n=s));let{boundaryGeojson:i}=e;return _i("setCamera")&&n.fitBounds(Mn(i),{padding:20,animate:!1}),Ze(n,"boundary",{type:"geojson",data:ho(i)}),ye(n,{id:"boundary",source:"boundary",...Vt("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class vo extends ee{constructor(e){super(),te(this,e,go,null,Q,{boundaryGeojson:0})}}function er(r){let e,t=tr(r[3])+"",n;return{c(){e=U("Length: "),n=U(t)},m(i,o){S(i,e,o),S(i,n,o)},p(i,o){o&8&&t!==(t=tr(i[3])+"")&&Re(n,t)},d(i){i&&E(e),i&&E(n)}}}function bo(r){let e,t,n,i,o,s,a,l,u,h,_,c,f,m,g,d,b,p,v,y,M,O,R,T,A,B,N,V,q,D,I,K,G,le,Me,Ae,he,ce,Fe,oe=r[3]&&er(r);return{c(){e=k("label"),t=U("Name:"),n=k("br"),i=C(),o=k("input"),s=C(),a=k("br"),l=C(),u=k("br"),h=C(),_=k("label"),c=k("input"),f=U(`
  Area`),m=C(),g=k("label"),d=k("input"),b=U(`
  Route`),p=C(),v=k("label"),y=k("input"),M=U(`
  Crossing`),O=C(),R=k("label"),T=k("input"),A=U(`
  Other`),B=C(),N=k("br"),V=C(),q=k("br"),D=C(),I=k("label"),K=U("Description:"),G=k("br"),le=C(),Me=k("textarea"),Ae=C(),oe&&oe.c(),he=pe(),$(o,"type","text"),ue(o,"width","100%"),$(c,"type","radio"),c.__value="area",c.value=c.__value,r[6][0].push(c),$(d,"type","radio"),d.__value="route",d.value=d.__value,r[6][0].push(d),$(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[6][0].push(y),$(T,"type","radio"),T.__value="other",T.value=T.__value,r[6][0].push(T),ue(Me,"width","100%"),$(Me,"rows","5"),$(Me,"class","svelte-15lna0i")},m(F,Z){S(F,e,Z),w(e,t),w(e,n),w(e,i),w(e,o),Te(o,r[0]),S(F,s,Z),S(F,a,Z),S(F,l,Z),S(F,u,Z),S(F,h,Z),S(F,_,Z),w(_,c),c.checked=c.__value===r[1],w(_,f),S(F,m,Z),S(F,g,Z),w(g,d),d.checked=d.__value===r[1],w(g,b),S(F,p,Z),S(F,v,Z),w(v,y),y.checked=y.__value===r[1],w(v,M),S(F,O,Z),S(F,R,Z),w(R,T),T.checked=T.__value===r[1],w(R,A),S(F,B,Z),S(F,N,Z),S(F,V,Z),S(F,q,Z),S(F,D,Z),S(F,I,Z),w(I,K),w(I,G),w(I,le),w(I,Me),Te(Me,r[2]),S(F,Ae,Z),oe&&oe.m(F,Z),S(F,he,Z),ce||(Fe=[x(o,"input",r[4]),x(c,"change",r[5]),x(d,"change",r[7]),x(y,"change",r[8]),x(T,"change",r[9]),x(Me,"input",r[10])],ce=!0)},p(F,[Z]){Z&1&&o.value!==F[0]&&Te(o,F[0]),Z&2&&(c.checked=c.__value===F[1]),Z&2&&(d.checked=d.__value===F[1]),Z&2&&(y.checked=y.__value===F[1]),Z&2&&(T.checked=T.__value===F[1]),Z&4&&Te(Me,F[2]),F[3]?oe?oe.p(F,Z):(oe=er(F),oe.c(),oe.m(he.parentNode,he)):oe&&(oe.d(1),oe=null)},i:j,o:j,d(F){F&&E(e),F&&E(s),F&&E(a),F&&E(l),F&&E(u),F&&E(h),F&&E(_),r[6][0].splice(r[6][0].indexOf(c),1),F&&E(m),F&&E(g),r[6][0].splice(r[6][0].indexOf(d),1),F&&E(p),F&&E(v),r[6][0].splice(r[6][0].indexOf(y),1),F&&E(O),F&&E(R),r[6][0].splice(r[6][0].indexOf(T),1),F&&E(B),F&&E(N),F&&E(V),F&&E(q),F&&E(D),F&&E(I),F&&E(Ae),oe&&oe.d(F),F&&E(he),ce=!1,Le(Fe)}}}function tr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function yo(r,e,t){let{name:n}=e,{intervention_type:i}=e,{description:o}=e,{length_meters:s}=e;const a=[[]];function l(){n=this.value,t(0,n)}function u(){i=this.__value,t(1,i)}function h(){i=this.__value,t(1,i)}function _(){i=this.__value,t(1,i)}function c(){i=this.__value,t(1,i)}function f(){o=this.value,t(2,o)}return r.$$set=m=>{"name"in m&&t(0,n=m.name),"intervention_type"in m&&t(1,i=m.intervention_type),"description"in m&&t(2,o=m.description),"length_meters"in m&&t(3,s=m.length_meters)},[n,i,o,s,l,u,a,h,_,c,f]}class wo extends ee{constructor(e){super(),te(this,e,yo,bo,Q,{name:0,intervention_type:1,description:2,length_meters:3})}}const ko="Intervention",So=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],Eo={name:ko,oneOf:So};function Mo(r){const e=r-1;return e*e*e+1}function ht(r,{delay:e=0,duration:t=400,easing:n=Mo}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),h=parseFloat(i.marginBottom),_=parseFloat(i.borderTopWidth),c=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*h}px;border-top-width: ${f*_}px;border-bottom-width: ${f*c}px;`}}function Ir(r){return"members"in r}function Br(r){return"oneOf"in r}function Dr(r){return typeof r=="string"}function qr(r){return typeof r=="object"&&"value"in r}function $o(r){return"type"in r&&r.type=="number"}function jr(r){return"type"in r&&r.type=="one-liner"}function Gr(r){return"type"in r&&r.type=="textbox"}function Hr(r){return"type"in r&&r.type=="checkbox"}function nr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function rr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function ir(r){let e,t=r[1].description+"",n;return{c(){e=k("p"),n=U(t),$(e,"class","svelte-1b72l00")},m(i,o){S(i,e,o),w(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&Re(n,t)},d(i){i&&E(e)}}}function Oo(r){let e,t,n;return{c(){e=k("input"),$(e,"type","checkbox")},m(i,o){S(i,e,o),e.checked=r[0],t||(n=x(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:j,o:j,d(i){i&&E(e),t=!1,n()}}}function Co(r){let e,t,n;return{c(){e=k("textarea"),ue(e,"width","100%"),$(e,"rows","5"),$(e,"class","svelte-1b72l00")},m(i,o){S(i,e,o),Te(e,r[0]),t||(n=x(e,"input",r[13]),t=!0)},p(i,o){o&1&&Te(e,i[0])},i:j,o:j,d(i){i&&E(e),t=!1,n()}}}function Lo(r){let e,t,n;return{c(){e=k("input"),$(e,"type","text"),ue(e,"width","100%")},m(i,o){S(i,e,o),Te(e,r[0]),t||(n=x(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Te(e,i[0])},i:j,o:j,d(i){i&&E(e),t=!1,n()}}}function To(r){let e,t,n;return{c(){e=k("input"),$(e,"type","number")},m(i,o){S(i,e,o),Te(e,r[0]),t||(n=x(e,"input",r[11]),t=!0)},p(i,o){o&1&&Pr(e.value)!==i[0]&&Te(e,i[0])},i:j,o:j,d(i){i&&E(e),t=!1,n()}}}function Ro(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=sr(nr(r,n,s));const o=s=>P(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=pe()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);S(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=nr(s,n,l);i[l]?(i[l].p(u,a),L(i[l],1)):(i[l]=sr(u),i[l].c(),L(i[l],1),i[l].m(e.parentNode,e))}for(ve(),l=n.length;l<i.length;l+=1)o(l);be()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)L(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)P(i[a]);t=!1},d(s){Ar(i,s),s&&E(e)}}}function Po(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=lr(rr(r,n,s));const o=s=>P(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=pe()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);S(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=rr(s,n,l);i[l]?(i[l].p(u,a),L(i[l],1)):(i[l]=lr(u),i[l].c(),L(i[l],1),i[l].m(e.parentNode,e))}for(ve(),l=n.length;l<i.length;l+=1)o(l);be()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)L(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)P(i[a]);t=!1},d(s){Ar(i,s),s&&E(e)}}}function Ao(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,h,_,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&or(r);return{c(){e=k("label"),t=k("input"),i=C(),s=U(o),a=k("br"),l=C(),f&&f.c(),u=pe(),$(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(m,g){S(m,e,g),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),S(m,l,g),f&&f.m(m,g),S(m,u,g),h=!0,_||(c=[x(t,"change",r[9]),x(t,"change",r[4])],_=!0)},p(m,g){(!h||g&2&&n!==(n=m[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===m[2]),(!h||g&2)&&o!==(o=m[15].name+"")&&Re(s,o),m[2]==m[15].name&&typeof m[0]=="object"?f?(f.p(m,g),g&7&&L(f,1)):(f=or(m),f.c(),L(f,1),f.m(u.parentNode,u)):f&&(ve(),P(f,1,1,()=>{f=null}),be())},i(m){h||(L(f),h=!0)},o(m){P(f),h=!1},d(m){m&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),m&&E(l),f&&f.d(m),m&&E(u),_=!1,Le(c)}}}function Fo(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,h;function _(m,g){return m[15].description?Io:xo}let c=_(r),f=c(r);return{c(){e=k("label"),t=k("input"),i=C(),s=U(o),a=C(),f.c(),l=C(),$(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(m,g){S(m,e,g),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),f.m(e,null),w(e,l),u||(h=[x(t,"change",r[8]),x(t,"change",r[3])],u=!0)},p(m,g){g&2&&n!==(n=m[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===m[2]),g&2&&o!==(o=m[15].value+"")&&Re(s,o),c===(c=_(m))&&f?f.p(m,g):(f.d(1),f=c(m),f&&(f.c(),f.m(e,l)))},i:j,o:j,d(m){m&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Le(h)}}}function No(r){let e,t,n,i,o=r[15]+"",s,a,l,u,h,_;return{c(){e=k("label"),t=k("input"),i=C(),s=U(o),a=C(),l=k("br"),u=C(),$(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){S(c,e,f),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),w(e,l),w(e,u),h||(_=[x(t,"change",r[6]),x(t,"change",r[3])],h=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&o!==(o=c[15]+"")&&Re(s,o)},i:j,o:j,d(c){c&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),h=!1,Le(_)}}}function or(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Tt({props:l}),ie.push(()=>ke(t,"value",a,r[0][r[15].name])),{c(){e=k("div"),H(t.$$.fragment),i=C(),$(e,"class","svelte-1b72l00")},m(u,h){S(u,e,h),Y(t,e,null),w(e,i),s=!0},p(u,h){r=u;const _={};h&2&&(_.spec=r[15]),!n&&h&3&&(n=!0,_.value=r[0][r[15].name],Se(()=>n=!1)),t.$set(_)},i(u){s||(L(t.$$.fragment,u),Ct(()=>{o||(o=ct(e,ht,{duration:500},!0)),o.run(1)}),s=!0)},o(u){P(t.$$.fragment,u),o||(o=ct(e,ht,{duration:500},!1)),o.run(0),s=!1},d(u){u&&E(e),J(t),u&&o&&o.end()}}}function xo(r){let e;return{c(){e=k("br")},m(t,n){S(t,e,n)},p:j,d(t){t&&E(e)}}}function Io(r){let e,t,n=r[15].description+"",i,o;return{c(){e=k("p"),t=U("("),i=U(n),o=U(")"),$(e,"class","svelte-1b72l00")},m(s,a){S(s,e,a),w(e,t),w(e,i),w(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&Re(i,n)},d(s){s&&E(e)}}}function sr(r){let e,t,n,i,o,s;const a=[No,Fo,Ao],l=[];function u(h,_){return _&2&&(e=null),_&2&&(t=null),e==null&&(e=!!Dr(h[15])),e?0:(t==null&&(t=!!qr(h[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=pe()},m(h,_){l[n].m(h,_),S(h,o,_),s=!0},p(h,_){let c=n;n=u(h,_),n===c?l[n].p(h,_):(ve(),P(l[c],1,1,()=>{l[c]=null}),be(),i=l[n],i?i.p(h,_):(i=l[n]=a[n](h),i.c()),L(i,1),i.m(o.parentNode,o))},i(h){s||(L(i),s=!0)},o(h){P(i),s=!1},d(h){l[n].d(h),h&&E(o)}}}function lr(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function h(c){r[5](c,r[15])}let _={spec:r[15]};return r[0][r[15].name]!==void 0&&(_.value=r[0][r[15].name]),s=new Tt({props:_}),ie.push(()=>ke(s,"value",h,r[0][r[15].name])),{c(){e=k("div"),t=k("h3"),i=U(n),o=C(),H(s.$$.fragment),l=C(),$(e,"class","svelte-1b72l00")},m(c,f){S(c,e,f),w(e,t),w(t,i),w(e,o),Y(s,e,null),w(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&Re(i,n);const m={};f&2&&(m.spec=r[15]),!a&&f&3&&(a=!0,m.value=r[0][r[15].name],Se(()=>a=!1)),s.$set(m)},i(c){u||(L(s.$$.fragment,c),u=!0)},o(c){P(s.$$.fragment,c),u=!1},d(c){c&&E(e),J(s)}}}function Bo(r){let e,t,n,i,o,s,a,l,u,h,_,c=r[1].description&&ir(r);const f=[Po,Ro,To,Lo,Co,Oo],m=[];function g(d,b){return b&2&&(t=null),b&2&&(n=null),b&2&&(i=null),b&2&&(o=null),b&2&&(s=null),b&2&&(a=null),t==null&&(t=!!Ir(d[1])),t?0:(n==null&&(n=!!Br(d[1])),n?1:(i==null&&(i=!!$o(d[1])),i?2:(o==null&&(o=!!jr(d[1])),o?3:(s==null&&(s=!!Gr(d[1])),s?4:(a==null&&(a=!!Hr(d[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=m[l]=f[l](r)),{c(){c&&c.c(),e=C(),u&&u.c(),h=pe()},m(d,b){c&&c.m(d,b),S(d,e,b),~l&&m[l].m(d,b),S(d,h,b),_=!0},p(d,[b]){d[1].description?c?c.p(d,b):(c=ir(d),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let p=l;l=g(d,b),l===p?~l&&m[l].p(d,b):(u&&(ve(),P(m[p],1,1,()=>{m[p]=null}),be()),~l?(u=m[l],u?u.p(d,b):(u=m[l]=f[l](d),u.c()),L(u,1),u.m(h.parentNode,h)):u=null)},i(d){_||(L(u),_=!0)},o(d){P(u),_=!1},d(d){c&&c.d(d),d&&E(e),~l&&m[l].d(d),d&&E(h)}}}function Do(r,e,t){var p,v,y;let{spec:n}=e,{value:i}=e,o="";if(Ir(n)){i||(i={});for(let M of n.members)jr(M)||Gr(M)?i[p=M.name]||(i[p]=""):Hr(M)?i[v=M.name]||(i[v]=!1):i[y=M.name]||(i[y]={})}else Br(n)&&(i||(i={}),Dr(i)?o=i:qr(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,O){r.$$.not_equal(i[O.name],M)&&(i[O.name]=M,t(0,i))}function h(){o=this.__value,t(2,o)}function _(){o=this.__value,t(2,o)}function c(){o=this.__value,t(2,o)}function f(M,O){r.$$.not_equal(i[O.name],M)&&(i[O.name]=M,t(0,i))}function m(){i=Pr(this.value),t(0,i)}function g(){i=this.value,t(0,i)}function d(){i=this.value,t(0,i)}function b(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,h,l,_,c,f,m,g,d,b]}class Tt extends ee{constructor(e){super(),te(this,e,Do,Bo,Q,{spec:1,value:0})}}function qo(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Tt({props:o}),ie.push(()=>ke(e,"value",i,r[0].v2)),{c(){H(e.$$.fragment)},m(s,a){Y(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Se(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){J(e,s)}}}function jo(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=Eo;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Go extends ee{constructor(e){super(),te(this,e,jo,qo,Q,{props:0})}}const Ho="Planning",Yo=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],Jo={name:Ho,members:Yo};function Uo(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Tt({props:o}),ie.push(()=>ke(e,"value",i,r[0].planning)),{c(){H(e.$$.fragment)},m(s,a){Y(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Se(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){J(e,s)}}}function Xo(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=Jo;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class zo extends ee{constructor(e){super(),te(this,e,Xo,Uo,Q,{props:0})}}const Wo="CriticalIssue",Vo=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],Ko={name:Wo,members:Vo};function Zo(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Tt({props:o}),ie.push(()=>ke(e,"value",i,r[0].criticals)),{c(){H(e.$$.fragment)},m(s,a){Y(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Se(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){J(e,s)}}}function Qo(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=Ko;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class es extends ee{constructor(e){super(),te(this,e,Qo,Zo,Q,{props:0})}}function ar(r){let e,t,n,i,o;const s=r[10].default,a=st(s,r,r[9],null);return{c(){e=k("div"),a&&a.c(),ue(e,"border","solid 1px black"),ue(e,"padding","10px")},m(l,u){S(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=x(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&lt(a,s,l,l[9],n?ut(s,l[9],u,null):at(l[9]),null)},i(l){n||(L(a,l),Ct(()=>{t||(t=ct(e,ht,{duration:100},!0)),t.run(1)}),n=!0)},o(l){P(a,l),t||(t=ct(e,ht,{duration:100},!1)),t.run(0),n=!1},d(l){l&&E(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function ts(r){let e,t,n,i,o,s,a,l,u,h,_=r[4]&&ar(r);return{c(){e=k("button"),t=qt("svg"),n=qt("path"),i=C(),o=U(r[1]),s=C(),_&&_.c(),a=pe(),$(n,"d","M9 5l7 7-7 7"),$(t,"style","tran"),$(t,"width","20"),$(t,"height","20"),$(t,"fill","none"),$(t,"stroke-linecap","round"),$(t,"stroke-linejoin","round"),$(t,"stroke-width","2"),$(t,"viewBox","0 0 24 24"),$(t,"stroke","currentColor"),$(t,"class","svelte-t7fpgu"),$(e,"aria-expanded",r[4]),$(e,"class","svelte-t7fpgu"),In(e,"underlined",r[3])},m(c,f){S(c,e,f),w(e,t),w(t,n),w(e,i),w(e,o),S(c,s,f),_&&_.m(c,f),S(c,a,f),l=!0,u||(h=[x(e,"click",r[5]),x(e,"mouseenter",r[11]),x(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&Re(o,c[1]),(!l||f&16)&&$(e,"aria-expanded",c[4]),(!l||f&8)&&In(e,"underlined",c[3]),c[4]?_?(_.p(c,f),f&16&&L(_,1)):(_=ar(c),_.c(),L(_,1),_.m(a.parentNode,a)):_&&(ve(),P(_,1,1,()=>{_=null}),be())},i(c){l||(L(_),l=!0)},o(c){P(_),l=!1},d(c){c&&E(e),c&&E(s),_&&_.d(c),c&&E(a),u=!1,Le(h)}}}function ns(r,e,t){let n,i,o,s;se(r,De,p=>t(7,o=p)),se(r,we,p=>t(8,s=p));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:h}=e;const _=()=>{we.update(p=>p==u?null:u),s==u&&(fn.set(null),fn.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const m=()=>Et.set(u),g=()=>Et.set(null);function d(p){ie[p?"unshift":"push"](()=>{c=p,t(2,c)})}const b=()=>f();return r.$$set=p=>{"id"in p&&t(0,u=p.id),"label"in p&&t(1,h=p.label),"$$scope"in p&&t(9,l=p.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,h,c,i,n,_,f,o,s,l,a,m,g,d,b]}class rs extends ee{constructor(e){super(),te(this,e,ns,ts,Q,{id:0,label:1})}}function ur(r,e,t){const n=r.slice();return n[13]=e[t],n[14]=e,n[15]=t,n}function is(r){let e,t,n;function i(s){r[9](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new es({props:o}),ie.push(()=>ke(e,"props",i,r[13].properties)),{c(){H(e.$$.fragment)},m(s,a){Y(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,Se(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){J(e,s)}}}function os(r){let e,t,n;function i(s){r[8](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new zo({props:o}),ie.push(()=>ke(e,"props",i,r[13].properties)),{c(){H(e.$$.fragment)},m(s,a){Y(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,Se(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){J(e,s)}}}function ss(r){let e,t,n;function i(s){r[7](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Go({props:o}),ie.push(()=>ke(e,"props",i,r[13].properties)),{c(){H(e.$$.fragment)},m(s,a){Y(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,Se(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){J(e,s)}}}function ls(r){let e,t,n,i,o;function s(h){r[4](h,r[13])}function a(h){r[5](h,r[13])}function l(h){r[6](h,r[13])}let u={length_meters:r[13].properties.length_meters};return r[13].properties.name!==void 0&&(u.name=r[13].properties.name),r[13].properties.intervention_type!==void 0&&(u.intervention_type=r[13].properties.intervention_type),r[13].properties.description!==void 0&&(u.description=r[13].properties.description),e=new wo({props:u}),ie.push(()=>ke(e,"name",s,r[13].properties.name)),ie.push(()=>ke(e,"intervention_type",a,r[13].properties.intervention_type)),ie.push(()=>ke(e,"description",l,r[13].properties.description)),{c(){H(e.$$.fragment)},m(h,_){Y(e,h,_),o=!0},p(h,_){r=h;const c={};_&2&&(c.length_meters=r[13].properties.length_meters),!t&&_&2&&(t=!0,c.name=r[13].properties.name,Se(()=>t=!1)),!n&&_&2&&(n=!0,c.intervention_type=r[13].properties.intervention_type,Se(()=>n=!1)),!i&&_&2&&(i=!0,c.description=r[13].properties.description,Se(()=>i=!1)),e.$set(c)},i(h){o||(L(e.$$.fragment,h),o=!0)},o(h){P(e.$$.fragment,h),o=!1},d(h){J(e,h)}}}function as(r){let e,t,n,i,o,s,a,l,u,h,_,c,f,m,g;const d=[ls,ss,os,is],b=[];function p(y,M){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:y[0]=="criticals"?3:-1}~(e=p(r))&&(t=b[e]=d[e](r));function v(){return r[10](r[13])}return{c(){t&&t.c(),n=C(),i=k("br"),o=C(),s=k("br"),a=C(),l=k("div"),u=k("button"),u.textContent="Delete",h=C(),_=k("button"),_.textContent="Save",c=C(),$(u,"type","button"),$(_,"type","button"),ue(l,"display","flex"),ue(l,"justify-content","space-between")},m(y,M){~e&&b[e].m(y,M),S(y,n,M),S(y,i,M),S(y,o,M),S(y,s,M),S(y,a,M),S(y,l,M),w(l,u),w(l,h),w(l,_),S(y,c,M),f=!0,m||(g=[x(u,"click",v),x(_,"click",r[11])],m=!0)},p(y,M){r=y;let O=e;e=p(r),e===O?~e&&b[e].p(r,M):(t&&(ve(),P(b[O],1,1,()=>{b[O]=null}),be()),~e?(t=b[e],t?t.p(r,M):(t=b[e]=d[e](r),t.c()),L(t,1),t.m(n.parentNode,n)):t=null)},i(y){f||(L(t),f=!0)},o(y){P(t),f=!1},d(y){~e&&b[e].d(y),y&&E(n),y&&E(i),y&&E(o),y&&E(s),y&&E(a),y&&E(l),y&&E(c),m=!1,Le(g)}}}function fr(r,e){let t,n,i;return n=new rs({props:{id:e[13].id,label:e[15]+1+") "+e[2](e[13]),$$slots:{default:[as]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=pe(),H(n.$$.fragment),this.first=t},m(o,s){S(o,t,s),Y(n,o,s),i=!0},p(o,s){e=o;const a={};s&2&&(a.id=e[13].id),s&2&&(a.label=e[15]+1+") "+e[2](e[13])),s&65539&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||(L(n.$$.fragment,o),i=!0)},o(o){P(n.$$.fragment,o),i=!1},d(o){o&&E(t),J(n,o)}}}function us(r){let e=[],t=new Map,n,i,o,s,a=r[1].features;const l=u=>u[13].id;for(let u=0;u<a.length;u+=1){let h=ur(r,a,u),_=l(h);t.set(_,e[u]=fr(_,h))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=pe()},m(u,h){for(let _=0;_<e.length;_+=1)e[_].m(u,h);S(u,n,h),i=!0,o||(s=x(window,"keydown",r[3]),o=!0)},p(u,[h]){h&7&&(a=u[1].features,ve(),e=gi(e,h,l,1,u,a,t,n.parentNode,vi,fr,n,ur),be())},i(u){if(!i){for(let h=0;h<a.length;h+=1)L(e[h]);i=!0}},o(u){for(let h=0;h<e.length;h+=1)P(e[h]);i=!1},d(u){for(let h=0;h<e.length;h+=1)e[h].d(u);u&&E(n),o=!1,s()}}}function fs(r,e,t){let n,i;se(r,we,d=>t(12,n=d)),se(r,ne,d=>t(1,i=d));let{schema:o}=e;function s(d){var p,v,y,M,O;if(o=="planning")return((p=d.properties.planning)==null?void 0:p.name)||"Untitled polygon";if(o=="v2")return((y=(v=d.properties.v2)==null?void 0:v.Route)==null?void 0:y.name)||((O=(M=d.properties.v2)==null?void 0:M.Crossing)==null?void 0:O.name)||"Untitled intervention";if(d.properties.name)return d.properties.name;var b=d.properties.intervention_type;return b=="other"&&(d.geometry.type=="Point"?b="point":d.geometry.type=="LineString"?b="line":b="polygon"),`Untitled ${b}`}function a(d){if(d.key=="Delete"){const b=d.target.tagName;if(b=="INPUT"||b=="TEXTAREA")return;d.preventDefault();const p=n;p&&Dn(p)}}function l(d,b){r.$$.not_equal(b.properties.name,d)&&(b.properties.name=d,ne.set(i))}function u(d,b){r.$$.not_equal(b.properties.intervention_type,d)&&(b.properties.intervention_type=d,ne.set(i))}function h(d,b){r.$$.not_equal(b.properties.description,d)&&(b.properties.description=d,ne.set(i))}function _(d,b){r.$$.not_equal(b.properties,d)&&(b.properties=d,ne.set(i))}function c(d,b){r.$$.not_equal(b.properties,d)&&(b.properties=d,ne.set(i))}function f(d,b){r.$$.not_equal(b.properties,d)&&(b.properties=d,ne.set(i))}const m=d=>Dn(d.id),g=()=>we.set(null);return r.$$set=d=>{"schema"in d&&t(0,o=d.schema)},[o,i,s,a,l,u,h,_,c,f,m,g]}class cs extends ee{constructor(e){super(),te(this,e,fs,us,Q,{schema:0})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function qe(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function gn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ue(r,e,t){t===void 0&&(t={});var n=Ve(r),i=Ve(e),o=Ne(i[1]-n[1]),s=Ne(i[0]-n[0]),a=Ne(n[1]),l=Ne(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return bi(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Nt(r,e){return e===void 0&&(e={}),yi(r,function(t,n){var i=n.geometry.coordinates;return t+Ue(i[0],i[1],e)},0)}function cr(r){let e,t,n,i,o,s=r[1]+1+"",a,l,u=r[0].length+"",h,_,c,f,m,g,d;return{c(){e=k("div"),t=k("button"),n=U("Previous"),o=C(),a=U(s),l=U(" / "),h=U(u),_=C(),c=k("button"),f=U("Next"),$(t,"type","button"),t.disabled=i=r[1]==0,$(c,"type","button"),c.disabled=m=r[1]==r[0].length-1},m(b,p){S(b,e,p),w(e,t),w(t,n),w(e,o),w(e,a),w(e,l),w(e,h),w(e,_),w(e,c),w(c,f),g||(d=[x(t,"click",r[10]),x(c,"click",r[11])],g=!0)},p(b,p){p&2&&i!==(i=b[1]==0)&&(t.disabled=i),p&2&&s!==(s=b[1]+1+"")&&Re(a,s),p&1&&u!==(u=b[0].length+"")&&Re(h,u),p&3&&m!==(m=b[1]==b[0].length-1)&&(c.disabled=m)},d(b){b&&E(e),g=!1,Le(d)}}}function ps(r){let e,t,n,i,o,s,a,l,u,h,_,c,f,m,g,d,b,p,v,y,M=r[2].features.length+"",O,R,T,A,B,N,V,q,D=r[0].length>1&&cr(r);return{c(){e=k("div"),t=k("label"),n=U(`Scheme name:
    `),i=k("input"),o=C(),s=k("br"),a=C(),l=k("div"),u=k("label"),h=k("input"),_=C(),c=k("button"),c.textContent="Load from GeoJSON",f=C(),m=k("button"),m.textContent="Export to GeoJSON",g=C(),D&&D.c(),d=C(),b=k("br"),p=C(),v=k("div"),y=k("span"),O=U(M),R=U(" interventions"),T=C(),A=k("button"),B=U("Clear all"),$(i,"type","text"),$(h,"type","file"),$(h,"id","load_geojson"),h.multiple=!0,$(h,"class","svelte-lhyd1e"),$(c,"type","button"),$(m,"type","button"),$(m,"class","align-right svelte-lhyd1e"),$(A,"type","button"),$(A,"class","align-right svelte-lhyd1e"),A.disabled=N=r[2].features.length==0},m(I,K){S(I,e,K),w(e,t),w(t,n),w(t,i),Te(i,r[2].scheme_name),S(I,o,K),S(I,s,K),S(I,a,K),S(I,l,K),w(l,u),w(u,h),w(u,_),w(u,c),w(l,f),w(l,m),S(I,g,K),D&&D.m(I,K),S(I,d,K),S(I,b,K),S(I,p,K),S(I,v,K),w(v,y),w(y,O),w(y,R),w(v,T),w(v,A),w(A,B),V||(q=[x(i,"input",r[9]),x(h,"change",r[5]),x(c,"click",ds),x(m,"click",r[4]),x(A,"click",r[3])],V=!0)},p(I,[K]){K&4&&i.value!==I[2].scheme_name&&Te(i,I[2].scheme_name),I[0].length>1?D?D.p(I,K):(D=cr(I),D.c(),D.m(d.parentNode,d)):D&&(D.d(1),D=null),K&4&&M!==(M=I[2].features.length+"")&&Re(O,M),K&4&&N!==(N=I[2].features.length==0)&&(A.disabled=N)},i:j,o:j,d(I){I&&E(e),I&&E(o),I&&E(s),I&&E(a),I&&E(l),I&&E(g),D&&D.d(I),I&&E(d),I&&E(b),I&&E(p),I&&E(v),V=!1,Le(q)}}}function hs(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function ds(){document.getElementById("load_geojson").click()}function ms(r,e,t){let n;se(r,ne,p=>t(2,n=p));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=[],l=0,u=window.localStorage.getItem(s);if(u)try{ne.set(m(JSON.parse(u)))}catch(p){console.log(`Failed to load from local storage: ${p}`)}function h(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(ne.update(p=>(delete p.scheme_name,p.features=[],p)),we.set(null),De.set(null),Et.set(null))}function _(){const p=JSON.parse(JSON.stringify(n));for(let v of p.features)delete v.properties.hide_while_editing;return p}function c(){let p=_();var v=s;p.authority=i,p.origin="atip-v1",p.scheme_name&&(v+="_"+p.scheme_name),v+=".txt",hs(v,JSON.stringify(p,null,"  "))}function f(p){t(0,a=[]),t(1,l=0);let v=!0;for(let y of p.target.files){let M=v;const O=new FileReader;O.onload=R=>{if(t(0,a=[...a,R.target.result]),M)try{ne.set(m(JSON.parse(R.target.result)))}catch(T){window.alert(`Couldn't load scheme from a file: ${T}`)}},O.readAsText(y),v=!1}}function m(p){let v=1;for(let y of p.features)y.properties||(y.properties={name:"",description:"",intervention_type:"other"}),y.geometry.type=="LineString"&&!y.properties.length_meters&&(y.properties.length_meters=Nt(y,{units:"kilometers"})*1e3),y.id=v++;return p}function g(){n.scheme_name=this.value,ne.set(n)}const d=p=>t(1,l--,l),b=p=>t(1,l++,l);return r.$$set=p=>{"authorityName"in p&&t(6,i=p.authorityName),"schema"in p&&t(7,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&260&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(_()))),r.$$.dirty&3&&a.length>1)try{ne.set(m(JSON.parse(a[l])))}catch(p){console.log(`Failed to load from local storage: ${p}`)}},[a,l,n,h,c,f,i,o,s,g,d,b]}class _s extends ee{constructor(e){super(),te(this,e,ms,ps,Q,{authorityName:6,schema:7})}}const gs="/atip/browse_files/assets/zoom_out_map-b2e1091a.svg";function vs(r){let e,t,n,i,o;return{c(){e=k("button"),t=k("img"),wi(t.src,n=gs)||$(t,"src",n),$(t,"alt","Zoom to show entire boundary"),$(e,"type","button"),$(e,"title","Zoom to show entire boundary"),$(e,"class","svelte-qzjsqo")},m(s,a){S(s,e,a),w(e,t),i||(o=x(e,"click",r[0]),i=!0)},p:j,i:j,o:j,d(s){s&&E(e),i=!1,o()}}}function bs(r,e,t){let n;se(r,Ge,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(Mn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class ys extends ee{constructor(e){super(),te(this,e,bs,vs,Q,{boundaryGeojson:1})}}function ws(r){let e,t,n,i,o,s,a;return{c(){e=k("div"),t=U(`Basemap:
  `),n=k("select"),i=k("option"),i.textContent="Streets",o=k("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&Ct(()=>r[2].call(n)),$(e,"class","svelte-1tbnm6i")},m(l,u){S(l,e,u),w(e,t),w(e,n),w(n,i),w(n,o),jt(n,r[0]),s||(a=[x(n,"change",r[2]),x(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&jt(n,l[0])},i:j,o:j,d(l){l&&E(e),s=!1,Le(a)}}}function ks(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=Fr(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Ss extends ee{constructor(e){super(),te(this,e,ks,ws,Q,{style:0})}}const ae={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},en=10,Jt=10;function Es(r){let e,t,n,i,o,s,a,l,u,h,_,c,f,m,g;return{c(){e=k("li"),t=k("span"),n=U("Areas"),i=C(),o=k("li"),s=k("span"),a=U("Routes"),l=C(),u=k("li"),h=k("span"),_=U("Crossings"),c=C(),f=k("li"),m=k("span"),g=U("Other"),$(t,"class","svelte-p551i1"),ue(t,"background",ae.area),$(s,"class","svelte-p551i1"),ue(s,"background",ae.route),$(h,"class","svelte-p551i1"),ue(h,"background",ae.crossing),$(m,"class","svelte-p551i1"),ue(m,"background",ae.other)},m(d,b){S(d,e,b),w(e,t),w(e,n),S(d,i,b),S(d,o,b),w(o,s),w(o,a),S(d,l,b),S(d,u,b),w(u,h),w(u,_),S(d,c,b),S(d,f,b),w(f,m),w(f,g)},p:j,d(d){d&&E(e),d&&E(i),d&&E(o),d&&E(l),d&&E(u),d&&E(c),d&&E(f)}}}function Ms(r){let e,t,n,i,o,s,a,l,u,h,_,c,f,m,g;return{c(){e=k("li"),t=k("span"),n=U("Preapp"),i=C(),o=k("li"),s=k("span"),a=U("Outline"),l=C(),u=k("li"),h=k("span"),_=U("Reserved matters"),c=C(),f=k("li"),m=k("span"),g=U("Local plan"),$(t,"class","svelte-p551i1"),ue(t,"background",ae.preapp),$(s,"class","svelte-p551i1"),ue(s,"background",ae.outline),$(h,"class","svelte-p551i1"),ue(h,"background",ae["reserved matters"]),$(m,"class","svelte-p551i1"),ue(m,"background",ae["local plan"])},m(d,b){S(d,e,b),w(e,t),w(e,n),S(d,i,b),S(d,o,b),w(o,s),w(o,a),S(d,l,b),S(d,u,b),w(u,h),w(u,_),S(d,c,b),S(d,f,b),w(f,m),w(f,g)},p:j,d(d){d&&E(e),d&&E(i),d&&E(o),d&&E(l),d&&E(u),d&&E(c),d&&E(f)}}}function $s(r){let e,t,n,i;function o(l,u){return l[0]=="planning"?Ms:Es}let s=o(r),a=s(r);return{c(){e=k("div"),t=k("h1"),t.textContent="Interventions",n=C(),i=k("ul"),a.c(),$(t,"class","svelte-p551i1"),$(e,"class","svelte-p551i1")},m(l,u){S(l,e,u),w(e,t),w(e,n),w(e,i),a.m(i,null)},p(l,[u]){s===(s=o(l))&&a?a.p(l,u):(a.d(1),a=s(l),a&&(a.c(),a.m(i,null)))},i:j,o:j,d(l){l&&E(e),a.d()}}}function Os(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class Cs extends ee{constructor(e){super(),te(this,e,Os,$s,Q,{schema:0})}}let et="interventions";function Ls(r,e,t){let n,i;se(r,Ge,h=>t(1,n=h)),se(r,ne,h=>t(2,i=h));let{schema:o}=e;Ze(n,et,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",ae.area,"route",ae.route,"crossing",ae.crossing,"other",ae.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",ae.preapp,"outline",ae.outline,"reserved matters",ae["reserved matters"],"local plan",ae["local plan"],"white"],l=["!=","hide_while_editing",!0];return ye(n,{id:"interventions-points",source:et,filter:["all",Kt,l,["!=","endpoint",!0]],...mt(s,en)}),ye(n,{id:"interventions-lines",source:et,filter:["all",Zt,l],...St(s,Jt)},"route-lines"),ye(n,{id:"interventions-lines-endpoints",source:et,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Jt,"circle-opacity":0,"circle-stroke-color":ae.lineEndpointColor,"circle-stroke-width":2}}),ye(n,{id:"interventions-polygons",source:et,filter:["all",Qt,l],...Vt(o=="planning"?a:s,.5)},"hover-polygons"),r.$$set=h=>{"schema"in h&&t(0,o=h.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let h=JSON.parse(JSON.stringify(i)),_=[];for(let c of h.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])_.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});h.features=h.features.concat(_),n.getSource(et).setData(h)}},[o,n,i]}class Ts extends ee{constructor(e){super(),te(this,e,Ls,null,Q,{schema:0})}}let tt="hover";function Rs(r,e,t){let n,i,o,s,a;return se(r,Ge,l=>t(0,n=l)),se(r,ne,l=>t(1,i=l)),se(r,Et,l=>t(2,o=l)),se(r,De,l=>t(3,s=l)),se(r,we,l=>t(4,a=l)),Ze(n,tt,{type:"geojson",data:je()}),ye(n,{id:"hover-polygons",source:tt,filter:Qt,...St(ae.hovering,.5*Jt,1)}),ye(n,{id:"hover-lines",source:tt,filter:Zt,...St(ae.hovering,1.5*Jt,1)},"interventions-lines"),ye(n,{id:"hover-points",source:tt,filter:Kt,...mt(ae.hovering,1.5*en,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(tt).setData(i.features.find(u=>u.id==l)):n.getSource(tt).setData(je())}},[n,i,o,s,a]}class Ps extends ee{constructor(e){super(),te(this,e,Rs,null,Q,{})}}class Ln{constructor(e,t){re(this,"owner");re(this,"map");re(this,"mapHandlers",{});re(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Pt="edit-point-mode";class As{constructor(e){re(this,"map");re(this,"active");re(this,"eventListenersSuccess");re(this,"eventListenersFailure");re(this,"cursor");re(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new Ln(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Ze(e,Pt,{type:"geojson",data:je()}),ye(e,{id:"edit-point-mode",source:Pt,...mt(ae.hovering,en,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=Fs(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Pt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=je();this.cursor&&e.features.push(this.cursor),this.map.getSource(Pt).setData(e)}}function Fs(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Yr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Ns(r,e);var n=Ve(r),i=Ve(e),o=Ne(n[0]),s=Ne(i[0]),a=Ne(n[1]),l=Ne(i[1]),u=Math.sin(s-o)*Math.cos(l),h=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return un(Math.atan2(u,h))}function Ns(r,e){var t=Yr(e,r);return t=(t+180)%360,t}function pr(r,e,t,n){n===void 0&&(n={});var i=Ve(r),o=Ne(i[0]),s=Ne(i[1]),a=Ne(t),l=ki(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),h=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),_=un(h),c=un(u);return ft([_,c],n.properties)}function vn(r){if(!r)throw new Error("geojson is required");var e=[];return $n(r,function(t){xs(t,e)}),We(e)}function xs(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=qe(n);break;case"LineString":t=[qe(n)]}t.forEach(function(i){var o=Is(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Is(r,e){var t=[];return r.reduce(function(n,i){var o=pt([n,i],e);return o.bbox=Bs(n,i),t.push(o),i}),t}function Bs(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var dt={},Ds={get exports(){return dt},set exports(r){dt=r}},bn={},qs={get exports(){return bn},set exports(r){bn=r}};(function(r,e){(function(t,n){r.exports=n()})(Si,function(){function t(p,v,y,M,O){(function R(T,A,B,N,V){for(;N>B;){if(N-B>600){var q=N-B+1,D=A-B+1,I=Math.log(q),K=.5*Math.exp(2*I/3),G=.5*Math.sqrt(I*K*(q-K)/q)*(D-q/2<0?-1:1),le=Math.max(B,Math.floor(A-D*K/q+G)),Me=Math.min(N,Math.floor(A+(q-D)*K/q+G));R(T,A,le,Me,V)}var Ae=T[A],he=B,ce=N;for(n(T,B,A),V(T[N],Ae)>0&&n(T,B,N);he<ce;){for(n(T,he,ce),he++,ce--;V(T[he],Ae)<0;)he++;for(;V(T[ce],Ae)>0;)ce--}V(T[B],Ae)===0?n(T,B,ce):n(T,++ce,N),ce<=A&&(B=ce+1),A<=ce&&(N=ce-1)}})(p,v,y||0,M||p.length-1,O||i)}function n(p,v,y){var M=p[v];p[v]=p[y],p[y]=M}function i(p,v){return p<v?-1:p>v?1:0}var o=function(p){p===void 0&&(p=9),this._maxEntries=Math.max(4,p),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(p,v,y){if(!y)return v.indexOf(p);for(var M=0;M<v.length;M++)if(y(p,v[M]))return M;return-1}function a(p,v){l(p,0,p.children.length,v,p)}function l(p,v,y,M,O){O||(O=d(null)),O.minX=1/0,O.minY=1/0,O.maxX=-1/0,O.maxY=-1/0;for(var R=v;R<y;R++){var T=p.children[R];u(O,p.leaf?M(T):T)}return O}function u(p,v){return p.minX=Math.min(p.minX,v.minX),p.minY=Math.min(p.minY,v.minY),p.maxX=Math.max(p.maxX,v.maxX),p.maxY=Math.max(p.maxY,v.maxY),p}function h(p,v){return p.minX-v.minX}function _(p,v){return p.minY-v.minY}function c(p){return(p.maxX-p.minX)*(p.maxY-p.minY)}function f(p){return p.maxX-p.minX+(p.maxY-p.minY)}function m(p,v){return p.minX<=v.minX&&p.minY<=v.minY&&v.maxX<=p.maxX&&v.maxY<=p.maxY}function g(p,v){return v.minX<=p.maxX&&v.minY<=p.maxY&&v.maxX>=p.minX&&v.maxY>=p.minY}function d(p){return{children:p,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function b(p,v,y,M,O){for(var R=[v,y];R.length;)if(!((y=R.pop())-(v=R.pop())<=M)){var T=v+Math.ceil((y-v)/M/2)*M;t(p,T,v,y,O),R.push(v,T,T,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(p){var v=this.data,y=[];if(!g(p,v))return y;for(var M=this.toBBox,O=[];v;){for(var R=0;R<v.children.length;R++){var T=v.children[R],A=v.leaf?M(T):T;g(p,A)&&(v.leaf?y.push(T):m(p,A)?this._all(T,y):O.push(T))}v=O.pop()}return y},o.prototype.collides=function(p){var v=this.data;if(!g(p,v))return!1;for(var y=[];v;){for(var M=0;M<v.children.length;M++){var O=v.children[M],R=v.leaf?this.toBBox(O):O;if(g(p,R)){if(v.leaf||m(p,R))return!0;y.push(O)}}v=y.pop()}return!1},o.prototype.load=function(p){if(!p||!p.length)return this;if(p.length<this._minEntries){for(var v=0;v<p.length;v++)this.insert(p[v]);return this}var y=this._build(p.slice(),0,p.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(p){return p&&this._insert(p,this.data.height-1),this},o.prototype.clear=function(){return this.data=d([]),this},o.prototype.remove=function(p,v){if(!p)return this;for(var y,M,O,R=this.data,T=this.toBBox(p),A=[],B=[];R||A.length;){if(R||(R=A.pop(),M=A[A.length-1],y=B.pop(),O=!0),R.leaf){var N=s(p,R.children,v);if(N!==-1)return R.children.splice(N,1),A.push(R),this._condense(A),this}O||R.leaf||!m(R,T)?M?(y++,R=M.children[y],O=!1):R=null:(A.push(R),B.push(y),y=0,M=R,R=R.children[0])}return this},o.prototype.toBBox=function(p){return p},o.prototype.compareMinX=function(p,v){return p.minX-v.minX},o.prototype.compareMinY=function(p,v){return p.minY-v.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(p){return this.data=p,this},o.prototype._all=function(p,v){for(var y=[];p;)p.leaf?v.push.apply(v,p.children):y.push.apply(y,p.children),p=y.pop();return v},o.prototype._build=function(p,v,y,M){var O,R=y-v+1,T=this._maxEntries;if(R<=T)return a(O=d(p.slice(v,y+1)),this.toBBox),O;M||(M=Math.ceil(Math.log(R)/Math.log(T)),T=Math.ceil(R/Math.pow(T,M-1))),(O=d([])).leaf=!1,O.height=M;var A=Math.ceil(R/T),B=A*Math.ceil(Math.sqrt(T));b(p,v,y,B,this.compareMinX);for(var N=v;N<=y;N+=B){var V=Math.min(N+B-1,y);b(p,N,V,A,this.compareMinY);for(var q=N;q<=V;q+=A){var D=Math.min(q+A-1,V);O.children.push(this._build(p,q,D,M-1))}}return a(O,this.toBBox),O},o.prototype._chooseSubtree=function(p,v,y,M){for(;M.push(v),!v.leaf&&M.length-1!==y;){for(var O=1/0,R=1/0,T=void 0,A=0;A<v.children.length;A++){var B=v.children[A],N=c(B),V=(q=p,D=B,(Math.max(D.maxX,q.maxX)-Math.min(D.minX,q.minX))*(Math.max(D.maxY,q.maxY)-Math.min(D.minY,q.minY))-N);V<R?(R=V,O=N<O?N:O,T=B):V===R&&N<O&&(O=N,T=B)}v=T||v.children[0]}var q,D;return v},o.prototype._insert=function(p,v,y){var M=y?p:this.toBBox(p),O=[],R=this._chooseSubtree(M,this.data,v,O);for(R.children.push(p),u(R,M);v>=0&&O[v].children.length>this._maxEntries;)this._split(O,v),v--;this._adjustParentBBoxes(M,O,v)},o.prototype._split=function(p,v){var y=p[v],M=y.children.length,O=this._minEntries;this._chooseSplitAxis(y,O,M);var R=this._chooseSplitIndex(y,O,M),T=d(y.children.splice(R,y.children.length-R));T.height=y.height,T.leaf=y.leaf,a(y,this.toBBox),a(T,this.toBBox),v?p[v-1].children.push(T):this._splitRoot(y,T)},o.prototype._splitRoot=function(p,v){this.data=d([p,v]),this.data.height=p.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(p,v,y){for(var M,O,R,T,A,B,N,V=1/0,q=1/0,D=v;D<=y-v;D++){var I=l(p,0,D,this.toBBox),K=l(p,D,y,this.toBBox),G=(O=I,R=K,T=void 0,A=void 0,B=void 0,N=void 0,T=Math.max(O.minX,R.minX),A=Math.max(O.minY,R.minY),B=Math.min(O.maxX,R.maxX),N=Math.min(O.maxY,R.maxY),Math.max(0,B-T)*Math.max(0,N-A)),le=c(I)+c(K);G<V?(V=G,M=D,q=le<q?le:q):G===V&&le<q&&(q=le,M=D)}return M||y-v},o.prototype._chooseSplitAxis=function(p,v,y){var M=p.leaf?this.compareMinX:h,O=p.leaf?this.compareMinY:_;this._allDistMargin(p,v,y,M)<this._allDistMargin(p,v,y,O)&&p.children.sort(M)},o.prototype._allDistMargin=function(p,v,y,M){p.children.sort(M);for(var O=this.toBBox,R=l(p,0,v,O),T=l(p,y-v,y,O),A=f(R)+f(T),B=v;B<y-v;B++){var N=p.children[B];u(R,p.leaf?O(N):N),A+=f(R)}for(var V=y-v-1;V>=v;V--){var q=p.children[V];u(T,p.leaf?O(q):q),A+=f(T)}return A},o.prototype._adjustParentBBoxes=function(p,v,y){for(var M=y;M>=0;M--)u(v[M],p)},o.prototype._condense=function(p){for(var v=p.length-1,y=void 0;v>=0;v--)p[v].children.length===0?v>0?(y=p[v-1].children).splice(y.indexOf(p[v]),1):this.clear():a(p[v],this.toBBox)},o})})(qs);const js=On(Ei),Gs=On(Mi),Hs=On($i);var Ie=bn,Jr=js,Ur=Gs,nt=Hs.default,Ys=Ur.featureEach;Ur.coordEach;Jr.polygon;var hr=Jr.featureCollection;function Xr(r){var e=new Ie(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:nt(t),Ie.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:nt(i),n.push(i)}):Ys(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:nt(i),n.push(i)}),Ie.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:nt(t),Ie.prototype.remove.call(this,t,n)},e.clear=function(){return Ie.prototype.clear.call(this)},e.search=function(t){var n=Ie.prototype.search.call(this,this.toBBox(t));return hr(n)},e.collides=function(t){return Ie.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ie.prototype.all.call(this);return hr(t)},e.toJSON=function(){return Ie.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ie.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=nt(t);else if(t.type==="FeatureCollection")n=nt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ds.exports=Xr;dt.default=Xr;function zr(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Bn(r)),e.type==="LineString"&&(e=Bn(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=dr(r,e);return i&&n.push(i),We(n)}var o=dt();return o.load(vn(e)),Gt(vn(r),function(s){Gt(o.search(s),function(a){var l=dr(s,a);if(l){var u=qe(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function dr(r,e){var t=qe(r),n=qe(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],h=n[1][0],_=n[1][1],c=(_-u)*(s-i)-(h-l)*(a-o),f=(h-l)*(o-u)-(_-u)*(i-l),m=(s-i)*(o-u)-(a-o)*(i-l);if(c===0)return f===0&&m===0,null;var g=f/c,d=m/c;if(g>=0&&g<=1&&d>=0&&d<=1){var b=i+g*(s-i),p=o+g*(a-o);return ft([b,p])}return null}function $t(r,e,t){t===void 0&&(t={});var n=ft([1/0,1/0],{dist:1/0}),i=0;return $n(r,function(o){for(var s=qe(o),a=0;a<s.length-1;a++){var l=ft(s[a]);l.properties.dist=Ue(e,l,t);var u=ft(s[a+1]);u.properties.dist=Ue(e,u,t);var h=Ue(l,u,t),_=Math.max(l.properties.dist,u.properties.dist),c=Yr(l,u),f=pr(e,_,c+90,t),m=pr(e,_,c-90,t),g=zr(pt([f.geometry.coordinates,m.geometry.coordinates]),pt([l.geometry.coordinates,u.geometry.coordinates])),d=null;g.features.length>0&&(d=g.features[0],d.properties.dist=Ue(e,d,t),d.properties.location=i+Ue(l,d,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+h),d&&d.properties.dist<n.properties.dist&&(n=d,n.properties.index=a),i+=h}}),n}const rt="edit-polygon-mode";class Js{constructor(e){re(this,"map");re(this,"active");re(this,"eventListenersSuccess");re(this,"eventListenersFailure");re(this,"points");re(this,"cursor");re(this,"hover");re(this,"dragFrom");re(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new Ln(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Ze(e,rt,{type:"geojson",data:je()}),ye(e,{id:"edit-polygon-fill",source:rt,filter:Qt,...Vt("red",["case",["boolean",["get","hover"],"false"],1,.5])}),ye(e,{id:"edit-polygon-lines",source:rt,filter:Zt,...St("black",8,.5)}),ye(e,{id:"edit-polygon-vertices",source:rt,filter:Kt,...mt(ae.hovering,en,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(_r(this.points).forEach((n,i)=>{t.push([i+1,$t(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(rt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=je();this.points.forEach((n,i)=>{let o=mr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(_r(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(rt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=mr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function mr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function _r(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let W;const Ye=new Array(32).fill(void 0);Ye.push(void 0,null,!0,!1);function z(r){return Ye[r]}let yt=Ye.length;function Us(r){r<36||(Ye[r]=yt,yt=r)}function yn(r){const e=z(r);return Us(r),e}const Wr=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Wr.decode();let xt=new Uint8Array;function wt(){return xt.byteLength===0&&(xt=new Uint8Array(W.memory.buffer)),xt}function it(r,e){return Wr.decode(wt().subarray(r,r+e))}function _e(r){yt===Ye.length&&Ye.push(Ye.length+1);const e=yt;return yt=Ye[e],Ye[e]=r,e}function on(r){return r==null}let It=new Float64Array;function Xs(){return It.byteLength===0&&(It=new Float64Array(W.memory.buffer)),It}let Bt=new Int32Array;function ge(){return Bt.byteLength===0&&(Bt=new Int32Array(W.memory.buffer)),Bt}let ze=0;const Dt=new TextEncoder("utf-8"),zs=typeof Dt.encodeInto=="function"?function(r,e){return Dt.encodeInto(r,e)}:function(r,e){const t=Dt.encode(r);return e.set(t),{read:r.length,written:t.length}};function At(r,e,t){if(t===void 0){const a=Dt.encode(r),l=e(a.length);return wt().subarray(l,l+a.length).set(a),ze=a.length,l}let n=r.length,i=e(n);const o=wt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=wt().subarray(i+s,i+n),l=zs(r,a);s+=l.written}return ze=s,i}function wn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=wn(r[0]));for(let s=1;s<i;s++)o+=", "+wn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ws(r,e){const t=e(r.length*1);return wt().set(r,t/1),ze=r.length,t}function sn(r,e){try{return r.apply(this,e)}catch(t){W.__wbindgen_exn_store(_e(t))}}class Ut{static __wrap(e){const t=Object.create(Ut.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();W.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=W.__wbindgen_add_to_stack_pointer(-16),s=Ws(e,W.__wbindgen_malloc),a=ze;W.jsroutesnapper_new(o,s,a);var t=ge()[o/4+0],n=ge()[o/4+1],i=ge()[o/4+2];if(i)throw yn(n);return Ut.__wrap(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){W.jsroutesnapper_setConfig(this.ptr,_e(e))}toFinalFeature(){try{const n=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ge()[n/4+0],t=ge()[n/4+1];let i;return e!==0&&(i=it(e,t).slice(),W.__wbindgen_free(e,t*1)),i}finally{W.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_renderGeojson(n,this.ptr);var e=ge()[n/4+0],t=ge()[n/4+1];return it(e,t)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,t)}}setSnapMode(e){W.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return W.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){W.jsroutesnapper_onClick(this.ptr)}onDragStart(){return W.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return W.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){W.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_editExisting(i,this.ptr,_e(e));var t=ge()[i/4+0],n=ge()[i/4+1];if(n)throw yn(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}}async function Vs(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ks(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){yn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=z(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(it(e,t));return _e(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=it(e,t);return _e(n)},r.wbg.__wbindgen_is_object=function(e){const t=z(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return z(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return z(e)in z(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=z(t),i=typeof n=="number"?n:void 0;Xs()[e/8+1]=on(i)?0:i,ge()[e/4+0]=!on(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return z(e)==z(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=z(t),i=typeof n=="string"?n:void 0;var o=on(i)?0:At(i,W.__wbindgen_malloc,W.__wbindgen_realloc),s=ze;ge()[e/4+1]=s,ge()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(z(t)),i=At(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=ze;ge()[e/4+1]=o,ge()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=z(e);return _e(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=z(e)[z(t)];return _e(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(z(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(z(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(z(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(z(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(z(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=z(e)[t>>>0];return _e(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return z(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof z(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=z(e).next;return _e(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return sn(function(e){const t=z(e).next();return _e(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return z(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=z(e).value;return _e(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return _e(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return sn(function(e,t){const n=Reflect.get(z(e),z(t));return _e(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return sn(function(e,t){const n=z(e).call(z(t));return _e(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(z(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=z(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=z(e).buffer;return _e(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(z(e));return _e(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){z(e).set(z(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return z(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=z(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return _e(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=z(t).stack,i=At(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=ze;ge()[e/4+1]=o,ge()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(it(e,t))}finally{W.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=wn(z(t)),i=At(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=ze;ge()[e/4+1]=o,ge()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(it(e,t))},r.wbg.__wbindgen_memory=function(){const e=W.memory;return _e(e)},r}function Zs(r,e){return W=r.exports,Vr.__wbindgen_wasm_module=e,It=new Float64Array,Bt=new Int32Array,xt=new Uint8Array,W}async function Vr(r){typeof r>"u"&&(r="/atip/browse_files/assets/route_snapper_bg.wasm");const e=Ks();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Vs(await r,e);return Zs(t,n)}const vt="route-snapper",gr=10,Qs=30;class el{constructor(e,t){re(this,"map");re(this,"inner");re(this,"active");re(this,"eventListenersSuccessRoute");re(this,"eventListenersSuccessArea");re(this,"eventListenersFailure");re(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Ut(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Ze(e,vt,{type:"geojson",data:je()}),ye(e,{id:"route-points",source:vt,filter:Kt,...mt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",gr/2,gr])}),ye(e,{id:"route-lines",source:vt,filter:Zt,...St("black",2.5)}),ye(e,{id:"route-polygons",source:vt,filter:Qt,...Vt("black",.5)}),this.events=new Ln(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Qs,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(vt).setData(JSON.parse(this.inner.renderGeojson()))}}function vr(r){let e;function t(o,s){return o[1]?nl:tl}let n=t(r),i=n(r);return{c(){i.c(),e=pe()},m(o,s){i.m(o,s),S(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&E(e)}}}function tl(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function nl(r){let e;return{c(){e=k("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function rl(r){let e,t=r[0]==ot&&vr(r);return{c(){t&&t.c(),e=pe()},m(n,i){t&&t.m(n,i),S(n,e,i)},p(n,[i]){n[0]==ot?t?t.p(n,i):(t=vr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:j,o:j,d(n){t&&t.d(n),n&&E(e)}}}const ot="edit-attribute";function Kr(){}function il(r,e,t){let n,i,o,s;se(r,Ge,f=>t(5,n=f)),se(r,ne,f=>t(6,i=f)),se(r,fn,f=>t(7,o=f)),se(r,we,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){we.set(null)}n.on("mousemove",h),n.on("mouseout",_),n.on("click",c),Ot(()=>{n.off("mousemove",h),n.off("mouseout",_),n.off("click",c)});function h(f){var m;if(a==ot){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});De.set(((m=g[0])==null?void 0:m.id)||null)}}function _(){a==ot&&De.set(null)}function c(f){if(a==ot){let m=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0?we.set(m[0].id):we.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let m=i.features.find(g=>g.id==f);m.geometry.type=="Point"?n.flyTo({center:m.geometry.coordinates,duration:500}):n.fitBounds(Mn(m),{padding:200,duration:500}),l(ot)}}},[a,s,l,Kr,u,n,i,o]}class ol extends ee{constructor(e){super(),te(this,e,il,rl,Q,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Kr}get stop(){return this.$$.ctx[4]}}function sl(r){let e,t;return{c:j,m(n,i){e||(t=x(window,"keydown",r[0]),e=!0)},p:j,i:j,o:j,d(n){e=!1,t()}}}function ll(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class tn extends ee{constructor(e){super(),te(this,e,ll,sl,Q,{tool:1})}}function al(r){let e;return{c(){e=k("li"),e.textContent="Click to add a new point"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function ul(r){let e;return{c(){e=k("li"),e.textContent="Click to move the point here"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function fl(r){let e,t,n,i,o,s,a,l,u,h;function _(m,g){return m[1]?ul:al}let c=_(r),f=c(r);return a=new tn({props:{tool:r[0]}}),{c(){e=k("ul"),f.c(),t=C(),n=k("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=C(),o=k("button"),o.textContent="Cancel",s=C(),H(a.$$.fragment),$(o,"type","button")},m(m,g){S(m,e,g),f.m(e,null),w(e,t),w(e,n),S(m,i,g),S(m,o,g),S(m,s,g),Y(a,m,g),l=!0,u||(h=x(o,"click",r[2]),u=!0)},p(m,[g]){c!==(c=_(m))&&(f.d(1),f=c(m),f&&(f.c(),f.m(e,t)));const d={};g&1&&(d.tool=m[0]),a.$set(d)},i(m){l||(L(a.$$.fragment,m),l=!0)},o(m){P(a.$$.fragment,m),l=!1},d(m){m&&E(e),f.d(),m&&E(i),m&&E(o),m&&E(s),J(a,m),u=!1,h()}}}function cl(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Zr extends ee{constructor(e){super(),te(this,e,cl,fl,Q,{pointTool:0,editingExisting:1})}}function br(r){let e,t,n;const i=r[3].default,o=st(i,r,r[2],null);return{c(){e=k("div"),o&&o.c()},m(s,a){S(s,e,a),o&&o.m(e,null),n=!0},p(s,a){o&&o.p&&(!n||a&4)&&lt(o,i,s,s[2],n?ut(i,s[2],a,null):at(s[2]),null)},i(s){n||(L(o,s),Ct(()=>{t||(t=ct(e,ht,{duration:100},!0)),t.run(1)}),n=!0)},o(s){P(o,s),t||(t=ct(e,ht,{duration:100},!1)),t.run(0),n=!1},d(s){s&&E(e),o&&o.d(s),s&&t&&t.end()}}}function pl(r){let e,t,n,i,o,s,a,l,u,h,_=r[1]&&br(r);return{c(){e=k("button"),t=qt("svg"),n=qt("path"),i=C(),o=U(r[0]),s=C(),_&&_.c(),a=pe(),$(n,"d","M9 5l7 7-7 7"),$(t,"style","tran"),$(t,"width","20"),$(t,"height","20"),$(t,"fill","none"),$(t,"stroke-linecap","round"),$(t,"stroke-linejoin","round"),$(t,"stroke-width","2"),$(t,"viewBox","0 0 24 24"),$(t,"stroke","currentColor"),$(t,"class","svelte-una9lq"),$(e,"aria-expanded",r[1]),$(e,"class","svelte-una9lq")},m(c,f){S(c,e,f),w(e,t),w(t,n),w(e,i),w(e,o),S(c,s,f),_&&_.m(c,f),S(c,a,f),l=!0,u||(h=x(e,"click",r[4]),u=!0)},p(c,[f]){(!l||f&1)&&Re(o,c[0]),(!l||f&2)&&$(e,"aria-expanded",c[1]),c[1]?_?(_.p(c,f),f&2&&L(_,1)):(_=br(c),_.c(),L(_,1),_.m(a.parentNode,a)):_&&(ve(),P(_,1,1,()=>{_=null}),be())},i(c){l||(L(_),l=!0)},o(c){P(_),l=!1},d(c){c&&E(e),c&&E(s),_&&_.d(c),c&&E(a),u=!1,h()}}}function hl(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,s=!1;const a=()=>t(1,s=!s);return r.$$set=l=>{"label"in l&&t(0,o=l.label),"$$scope"in l&&t(2,i=l.$$scope)},[o,s,i,n,a]}class Tn extends ee{constructor(e){super(),te(this,e,hl,pl,Q,{label:0})}}function dl(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},p:j,d(t){t&&E(e)}}}function ml(r){let e,t,n,i,o,s,a,l,u,h,_;return e=new Tn({props:{label:"Help",$$slots:{default:[dl]},$$scope:{ctx:r}}}),l=new tn({props:{tool:r[0]}}),{c(){H(e.$$.fragment),t=C(),n=k("div"),i=k("button"),i.textContent="Finish",o=C(),s=k("button"),s.textContent="Cancel",a=C(),H(l.$$.fragment),$(i,"type","button"),$(s,"type","button"),ue(n,"display","flex"),ue(n,"justify-content","space-between")},m(c,f){Y(e,c,f),S(c,t,f),S(c,n,f),w(n,i),w(n,o),w(n,s),S(c,a,f),Y(l,c,f),u=!0,h||(_=[x(i,"click",r[1]),x(s,"click",r[2])],h=!0)},p(c,[f]){const m={};f&8&&(m.$$scope={dirty:f,ctx:c}),e.$set(m);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||(L(e.$$.fragment,c),L(l.$$.fragment,c),u=!0)},o(c){P(e.$$.fragment,c),P(l.$$.fragment,c),u=!1},d(c){J(e,c),c&&E(t),c&&E(n),c&&E(a),J(l,c),h=!1,Le(_)}}}function _l(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Qr extends ee{constructor(e){super(),te(this,e,_l,ml,Q,{polygonTool:0})}}function gl(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},p:j,d(t){t&&E(e)}}}function vl(r){let e,t,n,i,o,s,a,l,u,h,_;return e=new Tn({props:{label:"Help",$$slots:{default:[gl]},$$scope:{ctx:r}}}),l=new tn({props:{tool:r[0]}}),{c(){H(e.$$.fragment),t=C(),n=k("div"),i=k("button"),i.textContent="Finish",o=C(),s=k("button"),s.textContent="Cancel",a=C(),H(l.$$.fragment),$(i,"type","button"),$(s,"type","button"),ue(n,"display","flex"),ue(n,"justify-content","space-between")},m(c,f){Y(e,c,f),S(c,t,f),S(c,n,f),w(n,i),w(n,o),w(n,s),S(c,a,f),Y(l,c,f),u=!0,h||(_=[x(i,"click",r[1]),x(s,"click",r[2])],h=!0)},p(c,[f]){const m={};f&8&&(m.$$scope={dirty:f,ctx:c}),e.$set(m);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||(L(e.$$.fragment,c),L(l.$$.fragment,c),u=!0)},o(c){P(e.$$.fragment,c),P(l.$$.fragment,c),u=!1},d(c){J(e,c),c&&E(t),c&&E(n),c&&E(a),J(l,c),h=!1,Le(_)}}}function bl(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class ei extends ee{constructor(e){super(),te(this,e,bl,vl,Q,{routeTool:0})}}function yl(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},p:j,d(t){t&&E(e)}}}function wl(r){let e,t,n,i,o,s,a,l,u,h,_,c,f,m,g;return e=new Tn({props:{label:"Help",$$slots:{default:[yl]},$$scope:{ctx:r}}}),c=new tn({props:{tool:r[0]}}),{c(){H(e.$$.fragment),t=C(),n=k("label"),i=k("input"),o=U(`
  Avoid doubling back`),s=C(),a=k("div"),l=k("button"),l.textContent="Finish",u=C(),h=k("button"),h.textContent="Cancel",_=C(),H(c.$$.fragment),$(i,"type","checkbox"),$(l,"type","button"),$(h,"type","button"),ue(a,"display","flex"),ue(a,"justify-content","space-between")},m(d,b){Y(e,d,b),S(d,t,b),S(d,n,b),w(n,i),i.checked=r[1],w(n,o),S(d,s,b),S(d,a,b),w(a,l),w(a,u),w(a,h),S(d,_,b),Y(c,d,b),f=!0,m||(g=[x(i,"change",r[2]),x(l,"click",r[3]),x(h,"click",r[4])],m=!0)},p(d,[b]){const p={};b&32&&(p.$$scope={dirty:b,ctx:d}),e.$set(p),b&2&&(i.checked=d[1]);const v={};b&1&&(v.tool=d[0]),c.$set(v)},i(d){f||(L(e.$$.fragment,d),L(c.$$.fragment,d),f=!0)},o(d){P(e.$$.fragment,d),P(c.$$.fragment,d),f=!1},d(d){J(e,d),d&&E(t),d&&E(n),d&&E(s),d&&E(a),d&&E(_),J(c,d),m=!1,Le(g)}}}function kl(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class ti extends ee{constructor(e){super(),te(this,e,kl,wl,Q,{routeTool:0})}}function yr(r){let e,t,n,i;const o=[Ol,$l,Ml,El,Sl],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=pe()},m(l,u){s[e].m(l,u),S(l,n,u),i=!0},p(l,u){let h=e;e=a(l),e===h?s[e].p(l,u):(ve(),P(s[h],1,1,()=>{s[h]=null}),be(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),L(t,1),t.m(n.parentNode,n))},i(l){i||(L(t),i=!0)},o(l){P(t),i=!1},d(l){s[e].d(l),l&&E(n)}}}function Sl(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){S(t,e,n)},p:j,i:j,o:j,d(t){t&&E(e)}}}function El(r){let e,t;return e=new ti({props:{routeTool:r[3]}}),{c(){H(e.$$.fragment)},m(n,i){Y(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function Ml(r){let e,t;return e=new ei({props:{routeTool:r[3]}}),{c(){H(e.$$.fragment)},m(n,i){Y(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function $l(r){let e,t;return e=new Qr({props:{polygonTool:r[2]}}),{c(){H(e.$$.fragment)},m(n,i){Y(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function Ol(r){let e,t;return e=new Zr({props:{pointTool:r[1],editingExisting:!0}}),{c(){H(e.$$.fragment)},m(n,i){Y(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function Cl(r){let e,t,n=r[0]==He&&yr(r);return{c(){n&&n.c(),e=pe()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==He?n?(n.p(i,o),o&1&&L(n,1)):(n=yr(i),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(ve(),P(n,1,1,()=>{n=null}),be())},i(i){t||(L(n),t=!0)},o(i){P(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const He="edit-geometry";function ni(){}function Ll(r,e,t){let n;se(r,Ge,g=>t(8,n=g));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function h(){l&&(o.stop(),s.stop(),a.stop(),ne.update(g=>{let d=g.features.find(b=>b.id==l);return delete d.properties.hide_while_editing,g})),l=null,t(4,u=null),De.set(null)}n.on("mousemove",_),n.on("mouseout",c),n.on("click",f),Ot(()=>{n.off("mousemove",_),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(g=>{i==He&&(ne.update(d=>{let b=d.features.find(p=>p.id==l);return b.properties.length_meters=g.properties.length_meters,b.properties.waypoints=g.properties.waypoints,delete b.properties.hide_while_editing,b.geometry=g.geometry,d}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{i==He&&(ne.update(d=>{let b=d.features.find(p=>p.id==l);return b.properties.waypoints=g.properties.waypoints,delete b.properties.hide_while_editing,b.geometry=g.geometry,d}),l=null,t(4,u=null))});for(let g of[o,s])g.addEventListenerSuccess(d=>{i==He&&(ne.update(b=>{let p=b.features.find(v=>v.id==l);return p.geometry=d.geometry,delete p.properties.hide_while_editing,b}),l=null,t(4,u=null))});for(let g of[o,s,a])g.addEventListenerFailure(()=>{i==He&&(ne.update(d=>{let b=d.features.find(p=>p.id==l);return delete b.properties.hide_while_editing,d}),l=null,t(4,u=null))});function _(g){var d;if(i==He&&l==null){let b=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});De.set(((d=b[0])==null?void 0:d.id)||null)}}function c(){i==He&&l==null&&De.set(null)}function f(g){if(i==He&&l==null){let d=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});d.length>0&&m(d[0].id)}}function m(g){De.set(null);let d=null;ne.update(p=>(d=p.features.find(v=>v.id==g),d.properties.hide_while_editing=!0,p));let b=d;l=g,b.geometry.type=="LineString"?(a.editExistingRoute(b),t(4,u="route")):b.geometry.type=="Polygon"?b.properties.waypoints?(a.editExistingArea(b),t(4,u="snap-polygon")):(s.editExisting(b),t(4,u="free-polygon")):b.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"pointTool"in g&&t(1,o=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[i,o,s,a,u,ni,h]}class Tl extends ee{constructor(e){super(),te(this,e,Ll,Cl,Q,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return ni}get stop(){return this.$$.ctx[6]}}async function Rl(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:h}=await n.read();if(u)break;s.push(h),o+=h.length;const _=100*o/i;e.style=`background: linear-gradient(to right, red ${_}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function Pl(r){let e,t;return e=new ti({props:{routeTool:r[0]}}),{c(){H(e.$$.fragment)},m(n,i){Y(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function Al(r){let e;return{c(){e=k("div"),e.textContent="Route tool loading..."},m(t,n){S(t,e,n),r[7](e)},p:j,i:j,o:j,d(t){t&&E(e),r[7](null)}}}function Fl(r){let e,t,n,i;const o=[Al,Pl],s=[];function a(l,u){return l[0]?l[1]==kn?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=pe()},m(l,u){~e&&s[e].m(l,u),S(l,n,u),i=!0},p(l,[u]){let h=e;e=a(l),e===h?~e&&s[e].p(l,u):(t&&(ve(),P(s[h],1,1,()=>{s[h]=null}),be()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),L(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(L(t),i=!0)},o(l){P(t),i=!1},d(l){~e&&s[e].d(l),l&&E(n)}}}const kn="route";function Nl(r,e,t){let n;se(r,Ge,c=>t(8,n=c));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function h(){l==null||l.stop()}En(async()=>{await Vr(),console.log(`Grabbing ${s}`);try{const c=await Rl(s,a);t(0,l=new el(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==kn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{i==kn&&(ne.update(f=>(c.id=Lt(f),c.properties.intervention_type="route",f.features.push(c),f)),o("edit-attribute"),we.set(c.id))})});function _(c){ie[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,i=c.mode),"changeMode"in c&&t(3,o=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,i,a,o,s,u,h,_]}class xl extends ee{constructor(e){super(),te(this,e,Nl,Fl,Q,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function wr(r){let e,t;return e=new Zr({props:{pointTool:r[1],editingExisting:!1}}),{c(){H(e.$$.fragment)},m(n,i){Y(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function Il(r){let e,t,n=r[0]==Xt&&wr(r);return{c(){n&&n.c(),e=pe()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Xt?n?(n.p(i,o),o&1&&L(n,1)):(n=wr(i),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(ve(),P(n,1,1,()=>{n=null}),be())},i(i){t||(L(n),t=!0)},o(i){P(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const Xt="point";function Bl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Xt&&(ne.update(u=>(l.id=Lt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),we.set(l.id))}),o.addEventListenerFailure(()=>{n==Xt&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class Dl extends ee{constructor(e){super(),te(this,e,Bl,Il,Q,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function kr(r){let e,t;return e=new Qr({props:{polygonTool:r[1]}}),{c(){H(e.$$.fragment)},m(n,i){Y(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function ql(r){let e,t,n=r[0]==zt&&kr(r);return{c(){n&&n.c(),e=pe()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==zt?n?(n.p(i,o),o&1&&L(n,1)):(n=kr(i),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(ve(),P(n,1,1,()=>{n=null}),be())},i(i){t||(L(n),t=!0)},o(i){P(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const zt="free-polygon";function jl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==zt&&(ne.update(u=>(l.id=Lt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),we.set(l.id))}),o.addEventListenerFailure(()=>{n==zt&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Gl extends ee{constructor(e){super(),te(this,e,jl,ql,Q,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Sr(r){let e,t;return e=new ei({props:{routeTool:r[1]}}),{c(){H(e.$$.fragment)},m(n,i){Y(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){J(e,n)}}}function Hl(r){let e,t,n=r[0]==Wt&&Sr(r);return{c(){n&&n.c(),e=pe()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Wt?n?(n.p(i,o),o&1&&L(n,1)):(n=Sr(i),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(ve(),P(n,1,1,()=>{n=null}),be())},i(i){t||(L(n),t=!0)},o(i){P(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const Wt="snap-polygon";function Yl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==Wt&&(ne.update(u=>(l.id=Lt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),we.set(l.id))}),o.addEventListenerFailure(()=>{n==Wt&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class Jl extends ee{constructor(e){super(),te(this,e,Yl,Hl,Q,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Ul(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Ue(r.slice(0,2),[n,t]),s=Ue(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Xl(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return Oi(r,function(s){zl(s,o,n)}),r}function zl(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Wl(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=gn(r),n=gn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Xl(e,{precision:7});switch(n){case"Point":return Sn(r,i);case"MultiPoint":return Er(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Er(r,zr(r,i))}}function Er(r,e){var t=[],n=dt();return $n(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=Sn(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=Ul(Ci(a)))}),n.load(We(t));else{var o=n.search(i);if(o.features.length){var s=ri(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),Gt(Sn(s,i),function(a){t.push(a),n.insert(a)})}}}),We(t)}function Sn(r,e){var t=[],n=qe(r)[0],i=qe(r)[r.geometry.coordinates.length-1];if(ln(n,Ve(e))||ln(i,Ve(e)))return We([r]);var o=dt(),s=vn(r);o.load(s);var a=o.search(e);if(!a.features.length)return We([r]);var l=ri(e,a),u=[n],h=Li(s,function(_,c,f){var m=qe(c)[1],g=Ve(e);return f===l.id?(_.push(g),t.push(pt(_)),ln(g,m)?[g]:[g,m]):(_.push(m),_)},u);return h.length>1&&t.push(pt(h)),We(t)}function ri(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return Gt(e,function(i){var o=$t(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function ln(r,e){return r[0]===e[0]&&r[1]===e[1]}function Vl(r,e,t){var n=qe(t);if(gn(t)!=="LineString")throw new Error("line must be a LineString");var i=$t(t,r),o=$t(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),pt(a,t.properties)}function Mr(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Kl(r){let e,t,n,i=r[0]==kt&&Mr();return{c(){i&&i.c(),e=pe()},m(o,s){i&&i.m(o,s),S(o,e,s),t||(n=x(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==kt?i||(i=Mr(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:j,o:j,d(o){i&&i.d(o),o&&E(e),t=!1,n()}}}const kt="split-route",Zl=10,Ql=30;let an="split-route";function ii(){}function $r(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function ea(r,e,t){let n,i;se(r,ne,g=>t(8,n=g)),se(r,Ge,g=>t(6,i=g));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",h),i.on("click",_),Ot(()=>{i.off("mousemove",h),i.off("click",_)}),Ze(i,an,{type:"geojson",data:je()}),ye(i,{id:"draw-split-route",source:an,...mt("black",Zl,["case",["==",["get","snapped"],!0],1,.5])});function h(g){if(o!=kt)return;t(5,l=$r(g.lngLat.toArray(),!1)),u=null;const d=[g.point.x-Ql,g.point.y],b=i.unproject(g.point).distanceTo(i.unproject(d))/1e3;let p=[];for(let[v,y]of n.features.entries())if(y.geometry.type=="LineString"){let M=$t(y.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=b&&p.push([v,M.geometry.coordinates,M.properties.dist])}p.sort((v,y)=>v[2]-y[2]),p.length>0&&(t(5,l=$r(p[0][1],!0)),u=p[0][0])}function _(){if(o==kt)if(u==null)s("edit-attribute");else{let g=Wl(n.features[u],l);if(g.features.length==2){let d=g.features[0],b=g.features[1];ne.update(p=>(d.id=p.features[u].id,b.id=Lt(p),d.properties=JSON.parse(JSON.stringify(p.features[u].properties)),b.properties=JSON.parse(JSON.stringify(d.properties)),c(p.features[u],d,b,l),p.features.splice(u,1,d,b),p))}a()}}function c(g,d,b,p){d.properties.length_meters=Nt(d,{units:"kilometers"})*1e3,b.properties.length_meters=Nt(b,{units:"kilometers"})*1e3,d.properties.waypoints=[],b.properties.waypoints=[];let v=f(g,p),y=!0,M=0;for(let O of g.properties.waypoints){let R=f(g,ft([O.lon,O.lat]));if(y)if(R<v)d.properties.waypoints.push(O);else{let T=O.snapped&&g.properties.waypoints[M-1].snapped;d.properties.waypoints.push({lon:p.geometry.coordinates[0],lat:p.geometry.coordinates[1],snapped:T}),y=!1,b.properties.waypoints.push({lon:p.geometry.coordinates[0],lat:p.geometry.coordinates[1],snapped:T}),b.properties.waypoints.push(O)}else b.properties.waypoints.push(O);M++}}function f(g,d){let b=g.geometry.coordinates[0],p=Vl(b,d,g);return Nt(p,{units:"kilometers"})*1e3}function m(g){o==kt&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=je();l&&g.features.push(l),i.getSource(an).setData(g)}},[o,m,s,ii,a,l,i]}class ta extends ee{constructor(e){super(),te(this,e,ea,Kl,Q,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ii}get stop(){return this.$$.ctx[4]}}function Or(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new Tl({props:n}),r[17](e),{c(){H(e.$$.fragment)},m(i,o){Y(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){P(e.$$.fragment,i),t=!1},d(i){r[17](null),J(e,i)}}}function Cr(r){let e,t,n,i,o;return{c(){e=k("button"),t=U("New point"),$(e,"type","button"),e.disabled=n=r[3]=="point",$(e,"class","svelte-cej5os")},m(s,a){S(s,e,a),w(e,t),i||(o=x(e,"click",r[18]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function Lr(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Jl({props:n}),r[23](e),{c(){H(e.$$.fragment)},m(i,o){Y(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){P(e.$$.fragment,i),t=!1},d(i){r[23](null),J(e,i)}}}function Tr(r){let e,t,n,i,o;return{c(){e=k("button"),t=U("New route"),$(e,"type","button"),e.disabled=n=r[3]=="route",$(e,"class","svelte-cej5os")},m(s,a){S(s,e,a),w(e,t),i||(o=x(e,"click",r[24]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function Rr(r){let e,t,n,i,o;return{c(){e=k("button"),t=U("Split route"),$(e,"type","button"),e.disabled=n=r[3]=="split-route",$(e,"class","svelte-cej5os")},m(s,a){S(s,e,a),w(e,t),i||(o=x(e,"click",r[27]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function na(r){let e,t,n,i,o,s,a,l,u,h,_,c,f,m,g,d,b,p,v,y,M,O,R,T,A,B,N,V,q,D,I,K,G,le,Me,Ae,he,ce,Fe,oe,F,Z,oi={mode:r[3],changeMode:r[13]};a=new ol({props:oi}),r[15](a);let de=r[2]&&Or(r),$e=r[1]!="planning"&&Cr(r),si={mode:r[3],changeMode:r[13],pointTool:r[11]};b=new Dl({props:si}),r[19](b);let li={mode:r[3],changeMode:r[13],polygonTool:r[12]};T=new Gl({props:li}),r[21](T);let me=r[2]&&Lr(r),Oe=r[1]!="planning"&&Tr(r);function ai(X){r[26](X)}let Rn={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(Rn.routeTool=r[2]),le=new xl({props:Rn}),r[25](le),ie.push(()=>ke(le,"routeTool",ai,r[2]));let Ce=r[1]!="planning"&&Rr(r),ui={mode:r[3],changeMode:r[13]};return Fe=new ta({props:ui}),r[28](Fe),{c(){e=k("div"),t=k("div"),n=k("button"),i=U("Edit attributes"),s=C(),H(a.$$.fragment),l=C(),u=k("div"),h=k("button"),_=U("Edit geometry"),f=C(),de&&de.c(),m=C(),g=k("div"),$e&&$e.c(),d=C(),H(b.$$.fragment),p=C(),v=k("div"),y=k("button"),M=U("New polygon (freehand)"),R=C(),H(T.$$.fragment),A=C(),B=k("div"),N=k("button"),V=U("New polygon (snapped)"),D=C(),me&&me.c(),I=C(),K=k("div"),Oe&&Oe.c(),G=C(),H(le.$$.fragment),Ae=C(),he=k("div"),Ce&&Ce.c(),ce=C(),H(Fe.$$.fragment),$(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",$(n,"class","svelte-cej5os"),$(h,"type","button"),h.disabled=c=r[3]=="edit-geometry",$(h,"class","svelte-cej5os"),$(y,"type","button"),y.disabled=O=r[3]=="free-polygon",$(y,"class","svelte-cej5os"),$(N,"type","button"),N.disabled=q=r[3]=="snap-polygon",$(N,"class","svelte-cej5os"),$(e,"class","toolbox svelte-cej5os")},m(X,fe){S(X,e,fe),w(e,t),w(t,n),w(n,i),w(t,s),Y(a,t,null),w(e,l),w(e,u),w(u,h),w(h,_),w(u,f),de&&de.m(u,null),w(e,m),w(e,g),$e&&$e.m(g,null),w(g,d),Y(b,g,null),w(e,p),w(e,v),w(v,y),w(y,M),w(v,R),Y(T,v,null),w(e,A),w(e,B),w(B,N),w(N,V),w(B,D),me&&me.m(B,null),w(e,I),w(e,K),Oe&&Oe.m(K,null),w(K,G),Y(le,K,null),w(e,Ae),w(e,he),Ce&&Ce.m(he,null),w(he,ce),Y(Fe,he,null),oe=!0,F||(Z=[x(n,"click",r[14]),x(h,"click",r[16]),x(y,"click",r[20]),x(N,"click",r[22])],F=!0)},p(X,[fe]){(!oe||fe&8&&o!==(o=X[3]=="edit-attribute"))&&(n.disabled=o);const Pn={};fe&8&&(Pn.mode=X[3]),a.$set(Pn),(!oe||fe&8&&c!==(c=X[3]=="edit-geometry"))&&(h.disabled=c),X[2]?de?(de.p(X,fe),fe&4&&L(de,1)):(de=Or(X),de.c(),L(de,1),de.m(u,null)):de&&(ve(),P(de,1,1,()=>{de=null}),be()),X[1]!="planning"?$e?$e.p(X,fe):($e=Cr(X),$e.c(),$e.m(g,d)):$e&&($e.d(1),$e=null);const An={};fe&8&&(An.mode=X[3]),b.$set(An),(!oe||fe&8&&O!==(O=X[3]=="free-polygon"))&&(y.disabled=O);const Fn={};fe&8&&(Fn.mode=X[3]),T.$set(Fn),(!oe||fe&8&&q!==(q=X[3]=="snap-polygon"))&&(N.disabled=q),X[2]?me?(me.p(X,fe),fe&4&&L(me,1)):(me=Lr(X),me.c(),L(me,1),me.m(B,null)):me&&(ve(),P(me,1,1,()=>{me=null}),be()),X[1]!="planning"?Oe?Oe.p(X,fe):(Oe=Tr(X),Oe.c(),Oe.m(K,G)):Oe&&(Oe.d(1),Oe=null);const Rt={};fe&8&&(Rt.mode=X[3]),fe&1&&(Rt.url=X[0]),!Me&&fe&4&&(Me=!0,Rt.routeTool=X[2],Se(()=>Me=!1)),le.$set(Rt),X[1]!="planning"?Ce?Ce.p(X,fe):(Ce=Rr(X),Ce.c(),Ce.m(he,ce)):Ce&&(Ce.d(1),Ce=null);const Nn={};fe&8&&(Nn.mode=X[3]),Fe.$set(Nn)},i(X){oe||(L(a.$$.fragment,X),L(de),L(b.$$.fragment,X),L(T.$$.fragment,X),L(me),L(le.$$.fragment,X),L(Fe.$$.fragment,X),oe=!0)},o(X){P(a.$$.fragment,X),P(de),P(b.$$.fragment,X),P(T.$$.fragment,X),P(me),P(le.$$.fragment,X),P(Fe.$$.fragment,X),oe=!1},d(X){X&&E(e),r[15](null),J(a),de&&de.d(),$e&&$e.d(),r[19](null),J(b),r[21](null),J(T),me&&me.d(),Oe&&Oe.d(),r[25](null),J(le),Ce&&Ce.d(),r[28](null),J(Fe),F=!1,Le(Z)}}}function ra(r,e,t){let n;se(r,Ge,G=>t(29,n=G));let{routeUrl:i}=e,{schema:o}=e,s,a=new As(n),l=new Js(n),u="edit-attribute",h,_,c,f,m,g,d;function b(G){let le={"edit-attribute":h,"edit-geometry":_,route:c,point:f,"free-polygon":m,"snap-polygon":g,"split-route":d};if(u==G){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),le[u].stop(),t(3,u=G),console.log(`Starting new mode ${u}`),le[u].start()}Ot(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const p=()=>b("edit-attribute");function v(G){ie[G?"unshift":"push"](()=>{h=G,t(4,h)})}const y=()=>b("edit-geometry");function M(G){ie[G?"unshift":"push"](()=>{_=G,t(5,_)})}const O=()=>b("point");function R(G){ie[G?"unshift":"push"](()=>{f=G,t(7,f)})}const T=()=>b("free-polygon");function A(G){ie[G?"unshift":"push"](()=>{m=G,t(8,m)})}const B=()=>b("snap-polygon");function N(G){ie[G?"unshift":"push"](()=>{g=G,t(9,g)})}const V=()=>b("route");function q(G){ie[G?"unshift":"push"](()=>{c=G,t(6,c)})}function D(G){s=G,t(2,s)}const I=()=>b("split-route");function K(G){ie[G?"unshift":"push"](()=>{d=G,t(10,d)})}return r.$$set=G=>{"routeUrl"in G&&t(0,i=G.routeUrl),"schema"in G&&t(1,o=G.schema)},[i,o,s,u,h,_,c,f,m,g,d,a,l,b,p,v,y,M,O,R,T,A,B,N,V,q,D,I,K]}class ia extends ee{constructor(e){super(),te(this,e,ra,na,Q,{routeUrl:0,schema:1})}}function oa(r){let e,t,n,i,o,s,a,l,u,h,_,c,f,m,g,d,b,p,v;return{c(){e=k("div"),t=k("div"),n=k("button"),n.textContent="Home",i=C(),o=k("button"),o.textContent="About",s=C(),a=k("button"),a.textContent="Instructions",l=C(),u=k("br"),h=C(),_=k("label"),c=U(`ATIP schema:
      `),f=k("select"),m=k("option"),m.textContent="v1",g=k("option"),g.textContent="v2",d=k("option"),d.textContent="Housing developments",b=k("option"),b.textContent="Critical issues",$(n,"type","button"),$(o,"type","button"),$(a,"type","button"),m.__value="v1",m.value=m.__value,g.__value="v2",g.value=g.__value,d.__value="planning",d.value=d.__value,b.__value="criticals",b.value=b.__value,r[2]===void 0&&Ct(()=>r[11].call(f)),$(e,"slot","nav")},m(y,M){S(y,e,M),w(e,t),w(t,n),w(t,i),w(t,o),w(t,s),w(t,a),w(e,l),w(e,u),w(e,h),w(e,_),w(_,c),w(_,f),w(f,m),w(f,g),w(f,d),w(f,b),jt(f,r[2]),p||(v=[x(n,"click",r[10]),x(o,"click",r[7]),x(a,"click",r[8]),x(f,"change",r[11]),x(f,"change",r[9])],p=!0)},p(y,M){M&4&&jt(f,y[2])},d(y){y&&E(e),p=!1,Le(v)}}}function sa(r){let e,t,n,i,o,s,a,l,u,h,_,c;return o=new ys({props:{boundaryGeojson:r[4]}}),a=new _s({props:{authorityName:r[5],schema:r[2]}}),_=new cs({props:{schema:r[2]}}),{c(){e=k("div"),t=k("h1"),n=U(r[5]),i=C(),H(o.$$.fragment),s=C(),H(a.$$.fragment),l=C(),u=k("br"),h=C(),H(_.$$.fragment),$(e,"slot","sidebar")},m(f,m){S(f,e,m),w(e,t),w(t,n),w(t,i),Y(o,t,null),w(e,s),Y(a,e,null),w(e,l),w(e,u),w(e,h),Y(_,e,null),c=!0},p(f,m){const g={};m&16&&(g.boundaryGeojson=f[4]),o.$set(g);const d={};m&4&&(d.schema=f[2]),a.$set(d);const b={};m&4&&(b.schema=f[2]),_.$set(b)},i(f){c||(L(o.$$.fragment,f),L(a.$$.fragment,f),L(_.$$.fragment,f),c=!0)},o(f){P(o.$$.fragment,f),P(a.$$.fragment,f),P(_.$$.fragment,f),c=!1},d(f){f&&E(e),J(o),J(a),J(_)}}}function la(r){let e,t,n,i,o,s,a,l,u,h,_,c;return e=new vo({props:{boundaryGeojson:r[4]}}),n=new Ts({props:{schema:r[2]}}),o=new Ps({}),a=new ia({props:{routeUrl:r[3],schema:r[2]}}),u=new Ss({props:{style:r[6]}}),_=new Cs({props:{schema:r[2]}}),{c(){H(e.$$.fragment),t=C(),H(n.$$.fragment),i=C(),H(o.$$.fragment),s=C(),H(a.$$.fragment),l=C(),H(u.$$.fragment),h=C(),H(_.$$.fragment)},m(f,m){Y(e,f,m),S(f,t,m),Y(n,f,m),S(f,i,m),Y(o,f,m),S(f,s,m),Y(a,f,m),S(f,l,m),Y(u,f,m),S(f,h,m),Y(_,f,m),c=!0},p(f,m){const g={};m&16&&(g.boundaryGeojson=f[4]),e.$set(g);const d={};m&4&&(d.schema=f[2]),n.$set(d);const b={};m&8&&(b.routeUrl=f[3]),m&4&&(b.schema=f[2]),a.$set(b);const p={};m&4&&(p.schema=f[2]),_.$set(p)},i(f){c||(L(e.$$.fragment,f),L(n.$$.fragment,f),L(o.$$.fragment,f),L(a.$$.fragment,f),L(u.$$.fragment,f),L(_.$$.fragment,f),c=!0)},o(f){P(e.$$.fragment,f),P(n.$$.fragment,f),P(o.$$.fragment,f),P(a.$$.fragment,f),P(u.$$.fragment,f),P(_.$$.fragment,f),c=!1},d(f){J(e,f),f&&E(t),J(n,f),f&&E(i),J(o,f),f&&E(s),J(a,f),f&&E(l),J(u,f),f&&E(h),J(_,f)}}}function aa(r){let e,t,n;return t=new Bi({props:{style:r[6],$$slots:{default:[la]},$$scope:{ctx:r}}}),{c(){e=k("div"),H(t.$$.fragment),$(e,"slot","main")},m(i,o){S(i,e,o),Y(t,e,null),n=!0},p(i,o){const s={};o&131100&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(L(t.$$.fragment,i),n=!0)},o(i){P(t.$$.fragment,i),n=!1},d(i){i&&E(e),J(t)}}}function ua(r){let e,t,n,i,o,s,a,l;e=new Yi({props:{$$slots:{main:[aa],sidebar:[sa],nav:[oa]},$$scope:{ctx:r}}});function u(f){r[12](f)}let h={};r[0]!==void 0&&(h.open=r[0]),n=new Ti({props:h}),ie.push(()=>ke(n,"open",u,r[0]));function _(f){r[13](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Ni({props:c}),ie.push(()=>ke(s,"open",_,r[1])),{c(){H(e.$$.fragment),t=C(),H(n.$$.fragment),o=C(),H(s.$$.fragment)},m(f,m){Y(e,f,m),S(f,t,m),Y(n,f,m),S(f,o,m),Y(s,f,m),l=!0},p(f,[m]){const g={};m&131100&&(g.$$scope={dirty:m,ctx:f}),e.$set(g);const d={};!i&&m&1&&(i=!0,d.open=f[0],Se(()=>i=!1)),n.$set(d);const b={};!a&&m&2&&(a=!0,b.open=f[1],Se(()=>a=!1)),s.$set(b)},i(f){l||(L(e.$$.fragment,f),L(n.$$.fragment,f),L(s.$$.fragment,f),l=!0)},o(f){P(e.$$.fragment,f),P(n.$$.fragment,f),P(s.$$.fragment,f),l=!1},d(f){J(e,f),f&&E(t),J(n,f),f&&E(o),J(s,f)}}}function fa(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var h=`https://atip.uk/route-snappers/${a}.bin`;o||(h=`https://atip.uk/route-snappers-dev/${a}.bin`);function _(){t(0,n=!n),t(1,i=!1)}function c(){t(1,i=!i),t(0,n=!1)}let f;En(async()=>{t(4,f=await m())});async function m(){const M=await(await fetch(Ri)).text(),O=JSON.parse(M);return O.features=O.features.filter(R=>{var T;return((T=R.properties)==null?void 0:T.name)==a}),O}function g(){let y=new URLSearchParams(window.location.search);y.set("schema",u);let M=`${window.location.pathname}?${y.toString()}${window.location.hash}`;window.location.href=M}const d=()=>window.open("index.html");function b(){u=Fr(this),t(2,u)}function p(y){n=y,t(0,n)}function v(y){i=y,t(1,i)}return[n,i,u,h,f,a,l,_,c,g,d,b,p,v]}class ca extends ee{constructor(e){super(),te(this,e,fa,ua,Q,{})}}new ca({target:document.getElementById("app")});
