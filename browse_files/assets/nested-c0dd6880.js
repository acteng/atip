var Vi=Object.defineProperty;var Ki=(r,e,t)=>e in r?Vi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ie=(r,e,t)=>(Ki(r,typeof e!="symbol"?e+"":e,t),t);import{S as te,i as ne,s as ee,M as Zi,b as oe,a as Oe,d as G,m as z,k as Le,n as A,o as T,q as H,e as k,c as C,g as S,x as q,p as E,y as He,f as O,z as we,B as ke,C as Qi,D as Qn,E as Mn,F as Gt,G as dt,H as mt,I as _t,J as gt,K as pr,h as w,l as F,L as eo,N as to,O as le,P as no,w as er,Q as ot,R as Se,T as yn,t as Y,U as de,V as ce,j as Pe,r as Ie,W as xe,X as ui,Y as fi,Z as zt,_ as yt,$ as sn,a0 as hr,a1 as ro,a2 as io,a3 as De,a4 as oo,a5 as so,a6 as lo,a7 as ln,a8 as ci,a9 as vn,aa as St,ab as wn,ac as Dt,ad as kn,ae as Pn,af as ao,ag as bt,ah as tr,ai as et,aj as vt,ak as uo,al as nr,am as fo,an as co,ao as po,ap as dr,aq as an,ar as ho,as as mo,at as _o,A as go,u as bo}from"./authorities-2ef082af.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pi=Symbol("Comlink.proxy"),yo=Symbol("Comlink.endpoint"),vo=Symbol("Comlink.releaseProxy"),On=Symbol("Comlink.finalizer"),Kt=Symbol("Comlink.thrown"),hi=r=>typeof r=="object"&&r!==null||typeof r=="function",wo={canHandle:r=>hi(r)&&r[pi],serialize(r){const{port1:e,port2:t}=new MessageChannel;return rr(r,e),[t,[t]]},deserialize(r){return r.start(),_i(r)}},ko={canHandle:r=>hi(r)&&Kt in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},di=new Map([["proxy",wo],["throw",ko]]);function So(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function rr(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!So(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(rt);let u;try{const h=a.slice(0,-1).reduce((c,f)=>c[f],r),m=a.reduce((c,f)=>c[f],r);switch(s){case"GET":u=m;break;case"SET":h[a.slice(-1)[0]]=rt(i.data.value),u=!0;break;case"APPLY":u=m.apply(h,l);break;case"CONSTRUCT":{const c=new m(...l);u=Ao(c)}break;case"ENDPOINT":{const{port1:c,port2:f}=new MessageChannel;rr(r,f),u=Co(c,[c])}break;case"RELEASE":u=void 0;break;default:return}}catch(h){u={value:h,[Kt]:0}}Promise.resolve(u).catch(h=>({value:h,[Kt]:0})).then(h=>{const[m,c]=cn(h);e.postMessage(Object.assign(Object.assign({},m),{id:o}),c),s==="RELEASE"&&(e.removeEventListener("message",n),mi(e),On in r&&typeof r[On]=="function"&&r[On]())}).catch(h=>{const[m,c]=cn({value:new TypeError("Unserializable return value"),[Kt]:0});e.postMessage(Object.assign(Object.assign({},m),{id:o}),c)})}),e.start&&e.start()}function Eo(r){return r.constructor.name==="MessagePort"}function mi(r){Eo(r)&&r.close()}function _i(r,e){return xn(r,[],e)}function Xt(r){if(r)throw new Error("Proxy has been released and is not useable")}function gi(r){return ct(r,{type:"RELEASE"}).then(()=>{mi(r)})}const un=new WeakMap,fn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(un.get(r)||0)-1;un.set(r,e),e===0&&gi(r)});function Mo(r,e){const t=(un.get(e)||0)+1;un.set(e,t),fn&&fn.register(r,e,r)}function Oo(r){fn&&fn.unregister(r)}function xn(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(Xt(n),s===vo)return()=>{Oo(i),gi(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=ct(r,{type:"GET",path:e.map(l=>l.toString())}).then(rt);return a.then.bind(a)}return xn(r,[...e,s])},set(o,s,a){Xt(n);const[l,u]=cn(a);return ct(r,{type:"SET",path:[...e,s].map(h=>h.toString()),value:l},u).then(rt)},apply(o,s,a){Xt(n);const l=e[e.length-1];if(l===yo)return ct(r,{type:"ENDPOINT"}).then(rt);if(l==="bind")return xn(r,e.slice(0,-1));const[u,h]=mr(a);return ct(r,{type:"APPLY",path:e.map(m=>m.toString()),argumentList:u},h).then(rt)},construct(o,s){Xt(n);const[a,l]=mr(s);return ct(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(rt)}});return Mo(i,r),i}function Lo(r){return Array.prototype.concat.apply([],r)}function mr(r){const e=r.map(cn);return[e.map(t=>t[0]),Lo(e.map(t=>t[1]))]}const bi=new WeakMap;function Co(r,e){return bi.set(r,e),r}function Ao(r){return Object.assign(r,{[pi]:!0})}function cn(r){for(const[e,t]of di)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},bi.get(r)||[]]}function rt(r){switch(r.type){case"HANDLER":return di.get(r.name).deserialize(r.value);case"RAW":return r.value}}function ct(r,e,t){return new Promise(n=>{const i=$o();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function $o(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Ro(){return new Worker("/atip/browse_files/assets/worker-87bfd23e.js")}let se;const Xe=new Array(128).fill(void 0);Xe.push(void 0,null,!0,!1);function K(r){return Xe[r]}let It=Xe.length;function To(r){r<132||(Xe[r]=It,It=r)}function Fn(r){const e=K(r);return To(r),e}let it=0,Ct=null;function Pt(){return(Ct===null||Ct.byteLength===0)&&(Ct=new Uint8Array(se.memory.buffer)),Ct}const Zt=new TextEncoder("utf-8"),Io=typeof Zt.encodeInto=="function"?function(r,e){return Zt.encodeInto(r,e)}:function(r,e){const t=Zt.encode(r);return e.set(t),{read:r.length,written:t.length}};function Ln(r,e,t){if(t===void 0){const a=Zt.encode(r),l=e(a.length);return Pt().subarray(l,l+a.length).set(a),it=a.length,l}let n=r.length,i=e(n);const o=Pt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=Pt().subarray(i+s,i+n),l=Io(r,a);s+=l.written}return it=s,i}function Mt(r){return r==null}let At=null;function Ee(){return(At===null||At.byteLength===0)&&(At=new Int32Array(se.memory.buffer)),At}const yi=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});yi.decode();function $t(r,e){return yi.decode(Pt().subarray(r,r+e))}function be(r){It===Xe.length&&Xe.push(Xe.length+1);const e=It;return It=Xe[e],Xe[e]=r,e}let Rt=null;function Po(){return(Rt===null||Rt.byteLength===0)&&(Rt=new Float64Array(se.memory.buffer)),Rt}let Tt=null;function xo(){return(Tt===null||Tt.byteLength===0)&&(Tt=new BigInt64Array(se.memory.buffer)),Tt}function Nn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Nn(r[0]));for(let s=1;s<i;s++)o+=", "+Nn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Fo(r,e){const t=e(r.length*1);return Pt().set(r,t/1),it=r.length,t}function Cn(r,e){try{return r.apply(this,e)}catch(t){se.__wbindgen_exn_store(be(t))}}let Bn=class{static __wrap(e){const t=Object.create(Bn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();se.__wbg_routeinfo_free(e)}constructor(e){try{const o=se.__wbindgen_add_to_stack_pointer(-16),s=Fo(e,se.__wbindgen_malloc),a=it;se.routeinfo_new(o,s,a);var t=Ee()[o/4+0],n=Ee()[o/4+1],i=Ee()[o/4+2];if(i)throw Fn(n);return Bn.__wrap(t)}finally{se.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){try{const l=se.__wbindgen_add_to_stack_pointer(-16);se.routeinfo_nameForRoute(l,this.ptr,be(e));var t=Ee()[l/4+0],n=Ee()[l/4+1],i=Ee()[l/4+2],o=Ee()[l/4+3],s=t,a=n;if(o)throw s=0,a=0,Fn(i);return $t(s,a)}finally{se.__wbindgen_add_to_stack_pointer(16),se.__wbindgen_free(s,a)}}};async function No(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Bo(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Fn(e)},r.wbg.__wbindgen_string_get=function(e,t){const n=K(t),i=typeof n=="string"?n:void 0;var o=Mt(i)?0:Ln(i,se.__wbindgen_malloc,se.__wbindgen_realloc),s=it;Ee()[e/4+1]=s,Ee()[e/4+0]=o},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error($t(e,t));return be(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=$t(e,t);return be(n)},r.wbg.__wbindgen_boolean_get=function(e){const t=K(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof K(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return be(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return K(e)===K(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=K(t),i=typeof n=="number"?n:void 0;Po()[e/8+1]=Mt(i)?0:i,Ee()[e/4+0]=!Mt(i)},r.wbg.__wbindgen_is_object=function(e){const t=K(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return K(e)in K(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return be(t)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return K(e)==K(t)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return be(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=K(t).stack,i=Ln(n,se.__wbindgen_malloc,se.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error($t(e,t))}finally{se.__wbindgen_free(e,t)}},r.wbg.__wbg_log_7bb108d119bafbc1=function(e){console.log(K(e))},r.wbg.__wbg_get_27fe3dac1c4d0224=function(e,t){const n=K(e)[t>>>0];return be(n)},r.wbg.__wbg_length_e498fbc24f9c1d4f=function(e){return K(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof K(e)=="function"},r.wbg.__wbg_next_b7d530c04fd8b217=function(e){const t=K(e).next;return be(t)},r.wbg.__wbg_next_88560ec06a094dea=function(){return Cn(function(e){const t=K(e).next();return be(t)},arguments)},r.wbg.__wbg_done_1ebec03bbd919843=function(e){return K(e).done},r.wbg.__wbg_value_6ac8da5cc5b3efda=function(e){const t=K(e).value;return be(t)},r.wbg.__wbg_iterator_55f114446221aa5a=function(){return be(Symbol.iterator)},r.wbg.__wbg_get_baf4855f9a986186=function(){return Cn(function(e,t){const n=Reflect.get(K(e),K(t));return be(n)},arguments)},r.wbg.__wbg_call_95d1ea488d03e4e8=function(){return Cn(function(e,t){const n=K(e).call(K(t));return be(n)},arguments)},r.wbg.__wbg_isArray_39d28997bf6b96b4=function(e){return Array.isArray(K(e))},r.wbg.__wbg_instanceof_ArrayBuffer_a69f02ee4c4f5065=function(e){let t;try{t=K(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_8c4789029e885159=function(e){return Number.isSafeInteger(K(e))},r.wbg.__wbg_entries_4e1315b774245952=function(e){const t=Object.entries(K(e));return be(t)},r.wbg.__wbg_buffer_cf65c07de34b9a08=function(e){const t=K(e).buffer;return be(t)},r.wbg.__wbg_new_537b7341ce90bb31=function(e){const t=new Uint8Array(K(e));return be(t)},r.wbg.__wbg_set_17499e8aa4003ebd=function(e,t,n){K(e).set(K(t),n>>>0)},r.wbg.__wbg_length_27a2afe8ab42b09f=function(e){return K(e).length},r.wbg.__wbg_instanceof_Uint8Array_01cebe79ca606cca=function(e){let t;try{t=K(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=K(t),i=typeof n=="bigint"?n:void 0;xo()[e/8+1]=Mt(i)?BigInt(0):i,Ee()[e/4+0]=!Mt(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Nn(K(t)),i=Ln(n,se.__wbindgen_malloc,se.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error($t(e,t))},r.wbg.__wbindgen_memory=function(){const e=se.memory;return be(e)},r}function Do(r,e){return se=r.exports,vi.__wbindgen_wasm_module=e,Tt=null,Rt=null,At=null,Ct=null,se}async function vi(r){typeof r>"u"&&(r="/atip/browse_files/assets/route_info_bg.wasm");const e=Bo();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await No(await r,e);return Do(t,n)}class jo{constructor(){ie(this,"inner");this.inner=null}async loadFile(e){await vi(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new Bn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.nameForRoute(e)}}rr(jo);function qo(r){let e,t,n,i,o,s,a,l,u,h,m,c,f;return{c(){e=k("p"),e.textContent="For each intervention:",t=C(),n=k("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=C(),o=k("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=C(),a=k("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=C(),u=k("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,h=C(),m=k("p"),m.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=C(),f=k("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(d,b){S(d,e,b),S(d,t,b),S(d,n,b),S(d,i,b),S(d,o,b),S(d,s,b),S(d,a,b),S(d,l,b),S(d,u,b),S(d,h,b),S(d,m,b),S(d,c,b),S(d,f,b)},p:q,d(d){d&&E(e),d&&E(t),d&&E(n),d&&E(i),d&&E(o),d&&E(s),d&&E(a),d&&E(l),d&&E(u),d&&E(h),d&&E(m),d&&E(c),d&&E(f)}}}function Uo(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[qo]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new Zi({props:o}),oe.push(()=>Oe(e,"open",i,r[0])),{c(){G(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Le(()=>t=!1)),e.$set(l)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){H(e,s)}}}function Go(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class zo extends te{constructor(e){super(),ne(this,e,Go,Uo,ee,{open:0})}}const st=[];function Et(r,e=q){let t;const n=new Set;function i(a){if(ee(r,a)&&(r=a,t)){const l=!st.length;for(const u of n)u[1](),st.push(u,r);if(l){for(let u=0;u<st.length;u+=2)st[u][0](st[u+1]);st.length=0}}}function o(a){i(a(r))}function s(a,l=q){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||q),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ye=Et(null),re=Et(He()),Me=Et(null),Ge=Et(null),jt=Et(null),Dn=Et(null);function Ht(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function _r(r){re.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Me.set(null),Ge.set(null),jt.set(null)}function gr(r){let e;const t=r[4].default,n=dt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&mt(n,t,i,i[3],e?gt(t,i[3],o,null):_t(i[3]),null)},i(i){e||(A(n,i),e=!0)},o(i){T(n,i),e=!1},d(i){n&&n.d(i)}}}function Ho(r){let e,t,n=r[1]&&gr(r);return{c(){e=k("div"),n&&n.c(),O(e,"class","map svelte-12dpf1u")},m(i,o){S(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&A(n,1)):(n=gr(i),n.c(),A(n,1),n.m(e,null)):n&&(we(),T(n,1,1,()=>{n=null}),ke())},i(i){t||(A(n),t=!0)},o(i){T(n),t=!1},d(i){i&&E(e),n&&n.d(),r[5](null)}}}function Yo(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;Qi("setCamera",!window.location.hash),Qn(()=>{s=new Mn.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new Mn.ScaleControl({})),s.addControl(new Mn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ye.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),Gt(()=>{s.remove()});function u(h){oe[h?"unshift":"push"](()=>{a=h,t(0,a)})}return r.$$set=h=>{"style"in h&&t(2,o=h.style),"$$scope"in h&&t(3,i=h.$$scope)},[a,l,o,i,n,u]}class Jo extends te{constructor(e){super(),ne(this,e,Yo,Ho,ee,{style:2})}}const Xo=r=>({}),br=r=>({}),Wo=r=>({}),yr=r=>({}),Vo=r=>({}),vr=r=>({});function Ko(r){let e,t,n,i,o,s,a,l,u,h,m,c;const f=r[3].nav,d=dt(f,r,r[2],vr),b=r[3].sidebar,g=dt(b,r,r[2],yr),y=r[3].main,p=dt(y,r,r[2],br);return{c(){e=k("aside"),t=k("div"),n=k("nav"),d&&d.c(),i=C(),g&&g.c(),o=C(),s=k("button"),s.textContent="→",l=C(),u=k("main"),p&&p.c(),O(n,"class","svelte-1u7vg8a"),O(t,"class","sidebar-content content-container svelte-1u7vg8a"),O(s,"type","button"),O(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),O(e,"class",a=pr(r[0]?"":"collapsed")+" svelte-1u7vg8a"),O(u,"class","svelte-1u7vg8a")},m(_,v){S(_,e,v),w(e,t),w(t,n),d&&d.m(n,null),w(t,i),g&&g.m(t,null),w(e,o),w(e,s),S(_,l,v),S(_,u,v),p&&p.m(u,null),h=!0,m||(c=F(s,"click",r[1]),m=!0)},p(_,[v]){d&&d.p&&(!h||v&4)&&mt(d,f,_,_[2],h?gt(f,_[2],v,Vo):_t(_[2]),vr),g&&g.p&&(!h||v&4)&&mt(g,b,_,_[2],h?gt(b,_[2],v,Wo):_t(_[2]),yr),(!h||v&1&&a!==(a=pr(_[0]?"":"collapsed")+" svelte-1u7vg8a"))&&O(e,"class",a),p&&p.p&&(!h||v&4)&&mt(p,y,_,_[2],h?gt(y,_[2],v,Xo):_t(_[2]),br)},i(_){h||(A(d,_),A(g,_),A(p,_),h=!0)},o(_){T(d,_),T(g,_),T(p,_),h=!1},d(_){_&&E(e),d&&d.d(_),g&&g.d(_),_&&E(l),_&&E(u),p&&p.d(_),m=!1,c()}}}function Zo(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class Qo extends te{constructor(e){super(),ne(this,e,Zo,Ko,ee,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function es(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(h){return l([u,h])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(h){u=[6,h],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var nt=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function ts(r,e){return r>e?1:r<e?-1:0}function Ve(r,e,t){for(var n=new nt(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function An(r,e,t,n){var i=new nt(r,e);if(t===null)return i.left=i.right=null,i;t=Ve(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function wr(r,e,t){var n=null,i=null;if(e){e=Ve(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function ns(r,e,t){return e===null?r:(r===null||(e=Ve(r.key,e,t),e.left=r),e)}function jn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&jn(r.left,o,!1,n,i),r.right&&jn(r.right,o,!0,n,i)}}var ir=function(){function r(e){e===void 0&&(e=ts),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=An(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new nt(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ve(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ve(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ve(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ve(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ve(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return is(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Gn(e,t,0,i-1,o),this._root===null)this._root=qn(e,t,0,i),this._size=i;else{var s=os(this.toList(),rs(e,t),o);i=this._size+i,this._root=Un({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return jn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=wr(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=An(t,n,a,i):s=An(t,n,s,i),this._root=ns(s,a,i)},r.prototype.split=function(e){return wr(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return es(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function qn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new nt(s,a);return l.left=qn(r,e,t,o),l.right=qn(r,e,o+1,n),l}return null}function rs(r,e){for(var t=new nt(null,null),n=t,i=0;i<r.length;i++)n=n.next=new nt(r[i],e[i]);return n.next=null,t.next}function is(r){for(var e=r,t=[],n=!1,i=new nt(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Un(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Un(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Un(r,i+1,t),s}return null}function os(r,e,t){for(var n=new nt(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Gn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Gn(r,e,t,a,i),Gn(r,e,a+1,n,i)}}function Fe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function kr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Ce(r,e,t){return e&&kr(r.prototype,e),t&&kr(r,t),r}var Ot=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},zn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Ze=Number.EPSILON;Ze===void 0&&(Ze=Math.pow(2,-52));var ss=Ze*Ze,Hn=function(e,t){if(-Ze<e&&e<Ze&&-Ze<t&&t<Ze)return 0;var n=e-t;return n*n<ss*e*t?0:e<t?-1:1},ls=function(){function r(){Fe(this,r),this.reset()}return Ce(r,[{key:"reset",value:function(){this.xRounder=new Sr,this.yRounder=new Sr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Sr=function(){function r(){Fe(this,r),this.tree=new ir,this.round(0)}return Ce(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Hn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Hn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),qt=new ls,xt=function(e,t){return e.x*t.y-e.y*t.x},wi=function(e,t){return e.x*t.x+e.y*t.y},Er=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=xt(i,o);return Hn(s,0)},pn=function(e){return Math.sqrt(wi(e,e))},as=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return xt(o,i)/pn(o)/pn(i)},us=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return wi(o,i)/pn(o)/pn(i)},Mr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Or=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},fs=function(e,t,n,i){if(t.x===0)return Or(n,i,e.x);if(i.x===0)return Or(e,t,n.x);if(t.y===0)return Mr(n,i,e.y);if(i.y===0)return Mr(e,t,n.y);var o=xt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=xt(s,t)/o,l=xt(s,i)/o,u=e.x+l*t.x,h=n.x+a*i.x,m=e.y+l*t.y,c=n.y+a*i.y,f=(u+h)/2,d=(m+c)/2;return{x:f,y:d}},Ue=function(){Ce(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:hn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Fe(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Ce(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:as(n.point,t.point,l.point),cosine:us(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,h=l.cosine,m=i.get(a),c=m.sine,f=m.cosine;return u>=0&&c>=0?h<f?1:h>f?-1:0:u<0&&c<0?h<f?-1:h>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),cs=0,hn=function(){Ce(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,h=t.rightSE.point.y,m=n.rightSE.point.y;if(i<o){if(u<l&&u<h)return 1;if(u>l&&u>h)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<m)return-1;if(l>u&&l>m)return 1;var d=n.comparePoint(t.leftSE.point);if(d!==0)return d;var b=t.comparePoint(n.rightSE.point);return b<0?1:b>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var g=n.comparePoint(t.rightSE.point);if(g!==0)return g}if(s>a){var y=t.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(s!==a){var p=h-l,_=s-i,v=m-u,M=a-o;if(p>_&&v<M)return 1;if(p<_&&v>M)return-1}return s>a?1:s<a||h<m?-1:h>m?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Fe(this,r),this.id=++cs,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Ce(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=zn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,h=Ot(n,l)&&this.comparePoint(l)===0,m=Ot(i,s)&&t.comparePoint(s)===0,c=Ot(n,u)&&this.comparePoint(u)===0,f=Ot(i,a)&&t.comparePoint(a)===0;if(m&&h)return f&&!c?a:!f&&c?u:null;if(m)return c&&s.x===u.x&&s.y===u.y?null:s;if(h)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var d=fs(s,this.vector(),l,t.vector());return d===null||!Ot(o,d)?null:qt.round(d.x,d.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Ue(t,!0),s=new Ue(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Ue.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ue.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var h=i.rings[l],m=i.windings[l],c=n.rings.indexOf(h);c===-1?(n.rings.push(h),n.windings.push(m)):n.windings[c]+=m}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],h=n.indexOf(l);h===-1?(n.push(l),i.push(u)):i[h]+=u}for(var m=[],c=[],f=0,d=n.length;f<d;f++)if(i[f]!==0){var b=n[f],g=b.poly;if(c.indexOf(g)===-1)if(b.isExterior)m.push(g);else{c.indexOf(g)===-1&&c.push(g);var y=m.indexOf(b.poly);y!==-1&&m.splice(y,1)}}for(var p=0,_=m.length;p<_;p++){var v=m[p].multiPoly;o.indexOf(v)===-1&&o.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(je.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===je.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(m){return m.length===1&&m[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(je.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Ue.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Ue(o,!0),h=new Ue(s,!1);return new r(u,h,[i],[a])}}]),r}(),Lr=function(){function r(e,t,n){if(Fe(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=qt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=qt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(hn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(hn.fromRing(o,i,this))}return Ce(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),ps=function(){function r(e,t){if(Fe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Lr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Lr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Ce(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Cr=function(){function r(e,t){if(Fe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new ps(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Ce(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),hs=function(){Ce(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,h=[l],m=l.point,c=[];a=l,l=u,h.push(l),l.point!==m;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var d=h[0].point,b=h[h.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(b.x,", ").concat(b.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var g=null,y=0,p=c.length;y<p;y++)if(c[y].point===l.point){g=y;break}if(g!==null){var _=c.splice(g)[0],v=h.splice(_.index);v.unshift(v[0].otherSE),n.push(new r(v.reverse()));continue}c.push({index:h.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(h))}}return n}}]);function r(e){Fe(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Ce(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Er(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Er(l,t,u)===0&&n.shift(),n.push(n[0]);for(var h=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],d=m;d!=c;d+=h)f.push([n[d].x,n[d].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Ue.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Ar=function(){function r(e){Fe(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Ce(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),ds=function(){function r(e){Fe(this,r),this.rings=e,this.polys=this._composePolys(e)}return Ce(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Ar(s));else{var a=s.enclosingRing();a.poly||n.push(new Ar(a)),a.poly.addInterior(s)}}return n}}]),r}(),ms=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hn.compare;Fe(this,r),this.queue=e,this.tree=new ir(t),this.segments=[]}return Ce(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var h=null;if(l){var m=l.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(h=m),!l.isAnEndpoint(m)))for(var c=this._splitSafely(l,m),f=0,d=c.length;f<d;f++)i.push(c[f])}var b=null;if(u){var g=u.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(b=g),!u.isAnEndpoint(g)))for(var y=this._splitSafely(u,g),p=0,_=y.length;p<_;p++)i.push(y[p])}if(h!==null||b!==null){var v=null;if(h===null)v=b;else if(b===null)v=h;else{var M=Ue.comparePoints(h,b);v=M<=0?h:b}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var L=n.split(v),R=0,$=L.length;R<$;R++)i.push(L[R])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var I=l.getIntersection(u);if(I!==null){if(!l.isAnEndpoint(I))for(var N=this._splitSafely(l,I),x=0,V=N.length;x<V;x++)i.push(N[x]);if(!u.isAnEndpoint(I))for(var j=this._splitSafely(u,I),D=0,B=j.length;D<B;D++)i.push(j[D])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),$r=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,_s=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,gs=function(){function r(){Fe(this,r)}return Ce(r,[{key:"run",value:function(t,n,i){je.type=t,qt.reset();for(var o=[new Cr(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Cr(i[s],!1));if(je.numMultiPolys=o.length,je.type==="difference")for(var l=o[0],u=1;u<o.length;)zn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(je.type==="intersection"){for(var h=0,m=o.length;h<m;h++)for(var c=o[h],f=h+1,d=o.length;f<d;f++)if(zn(c.bbox,o[f].bbox)===null)return[]}for(var b=new ir(Ue.compare),g=0,y=o.length;g<y;g++)for(var p=o[g].getSweepEvents(),_=0,v=p.length;_<v;_++)if(b.insert(p[_]),b.size>$r)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new ms(b),L=b.size,R=b.pop();R;){var $=R.key;if(b.size===L){var I=$.segment;throw new Error("Unable to pop() ".concat($.isLeft?"left":"right"," SweepEvent ")+"[".concat($.point.x,", ").concat($.point.y,"] from segment #").concat(I.id," ")+"[".concat(I.leftSE.point.x,", ").concat(I.leftSE.point.y,"] -> ")+"[".concat(I.rightSE.point.x,", ").concat(I.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(b.size>$r)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>_s)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var N=M.process($),x=0,V=N.length;x<V;x++){var j=N[x];j.consumedBy===void 0&&b.insert(j)}L=b.size,R=b.pop()}qt.reset();var D=hs.factory(M.segments),B=new ds(D);return B.getGeom()}}]),r}(),je=new gs,bs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return je.run("union",e,n)},ys=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return je.run("intersection",e,n)},vs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return je.run("xor",e,n)},ws=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return je.run("difference",e,n)},Qt={union:bs,intersection:ys,xor:vs,difference:ws};function ks(r,e){var t=Es(e),n=null;return r.type==="FeatureCollection"?n=Ss(r):n=ki(Qt.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function Ss(r){var e=r.features.length===2?Qt.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Qt.union.apply(Qt,r.features.map(function(t){return t.geometry.coordinates}));return ki(e)}function ki(r){return eo(r)}function Es(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return to(t)}function Ms(r,e,t){let n;le(r,Ye,s=>t(1,n=s));let{boundaryGeojson:i}=e;return no("setCamera")&&n.fitBounds(er(i),{padding:20,animate:!1}),ot(n,"boundary",{type:"geojson",data:ks(i)}),Se(n,{id:"boundary",source:"boundary",...yn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class Os extends te{constructor(e){super(),ne(this,e,Ms,null,ee,{boundaryGeojson:0})}}function Rr(r){let e,t=Tr(r[3])+"",n,i,o,s,a,l;return{c(){e=Y("Length: "),n=Y(t),i=C(),o=k("br"),s=k("button"),s.textContent="Auto-fill details",O(s,"type","button")},m(u,h){S(u,e,h),S(u,n,h),S(u,i,h),S(u,o,h),S(u,s,h),a||(l=F(s,"click",r[14]),a=!0)},p(u,h){h&8&&t!==(t=Tr(u[3])+"")&&xe(n,t)},d(u){u&&E(e),u&&E(n),u&&E(i),u&&E(o),u&&E(s),a=!1,l()}}}function Ls(r){let e,t,n,i,o,s,a,l,u,h,m,c,f,d,b,g,y,p,_,v,M,L,R,$,I,N,x,V,j,D,B,Z,U,ue,Ae,Ne,me,he,Be,ae=r[3]&&Rr(r);return{c(){e=k("label"),t=Y("Name:"),n=k("br"),i=C(),o=k("input"),s=C(),a=k("br"),l=C(),u=k("br"),h=C(),m=k("label"),c=k("input"),f=Y(`
  Area`),d=C(),b=k("label"),g=k("input"),y=Y(`
  Route`),p=C(),_=k("label"),v=k("input"),M=Y(`
  Crossing`),L=C(),R=k("label"),$=k("input"),I=Y(`
  Other`),N=C(),x=k("br"),V=C(),j=k("br"),D=C(),B=k("label"),Z=Y("Description:"),U=k("br"),ue=C(),Ae=k("textarea"),Ne=C(),ae&&ae.c(),me=de(),O(o,"type","text"),ce(o,"width","100%"),O(c,"type","radio"),c.__value="area",c.value=c.__value,r[9][0].push(c),O(g,"type","radio"),g.__value="route",g.value=g.__value,r[9][0].push(g),O(v,"type","radio"),v.__value="crossing",v.value=v.__value,r[9][0].push(v),O($,"type","radio"),$.__value="other",$.value=$.__value,r[9][0].push($),ce(Ae,"width","100%"),O(Ae,"rows","5"),O(Ae,"class","svelte-15lna0i")},m(P,Q){S(P,e,Q),w(e,t),w(e,n),w(e,i),w(e,o),Pe(o,r[0]),S(P,s,Q),S(P,a,Q),S(P,l,Q),S(P,u,Q),S(P,h,Q),S(P,m,Q),w(m,c),c.checked=c.__value===r[1],w(m,f),S(P,d,Q),S(P,b,Q),w(b,g),g.checked=g.__value===r[1],w(b,y),S(P,p,Q),S(P,_,Q),w(_,v),v.checked=v.__value===r[1],w(_,M),S(P,L,Q),S(P,R,Q),w(R,$),$.checked=$.__value===r[1],w(R,I),S(P,N,Q),S(P,x,Q),S(P,V,Q),S(P,j,Q),S(P,D,Q),S(P,B,Q),w(B,Z),w(B,U),w(B,ue),w(B,Ae),Pe(Ae,r[2]),S(P,Ne,Q),ae&&ae.m(P,Q),S(P,me,Q),he||(Be=[F(o,"input",r[7]),F(c,"change",r[8]),F(g,"change",r[10]),F(v,"change",r[11]),F($,"change",r[12]),F(Ae,"input",r[13])],he=!0)},p(P,[Q]){Q&1&&o.value!==P[0]&&Pe(o,P[0]),Q&2&&(c.checked=c.__value===P[1]),Q&2&&(g.checked=g.__value===P[1]),Q&2&&(v.checked=v.__value===P[1]),Q&2&&($.checked=$.__value===P[1]),Q&4&&Pe(Ae,P[2]),P[3]?ae?ae.p(P,Q):(ae=Rr(P),ae.c(),ae.m(me.parentNode,me)):ae&&(ae.d(1),ae=null)},i:q,o:q,d(P){P&&E(e),P&&E(s),P&&E(a),P&&E(l),P&&E(u),P&&E(h),P&&E(m),r[9][0].splice(r[9][0].indexOf(c),1),P&&E(d),P&&E(b),r[9][0].splice(r[9][0].indexOf(g),1),P&&E(p),P&&E(_),r[9][0].splice(r[9][0].indexOf(v),1),P&&E(L),P&&E(R),r[9][0].splice(r[9][0].indexOf($),1),P&&E(N),P&&E(x),P&&E(V),P&&E(j),P&&E(D),P&&E(B),P&&E(Ne),ae&&ae.d(P),P&&E(me),he=!1,Ie(Be)}}}function Tr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Cs(r,e,t){let n;le(r,re,_=>t(15,n=_));let{routeInfo:i}=e,{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function h(){let _=n.features.find(v=>v.id==o);try{t(0,s=await i.nameForRoute(_))}catch(v){window.alert(`Couldn't auto-name route: ${v}`)}}const m=[[]];function c(){s=this.value,t(0,s)}function f(){a=this.__value,t(1,a)}function d(){a=this.__value,t(1,a)}function b(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function y(){l=this.value,t(2,l)}const p=()=>h();return r.$$set=_=>{"routeInfo"in _&&t(5,i=_.routeInfo),"id"in _&&t(6,o=_.id),"name"in _&&t(0,s=_.name),"intervention_type"in _&&t(1,a=_.intervention_type),"description"in _&&t(2,l=_.description),"length_meters"in _&&t(3,u=_.length_meters)},[s,a,l,u,h,i,o,c,f,m,d,b,g,y,p]}class As extends te{constructor(e){super(),ne(this,e,Cs,Ls,ee,{routeInfo:5,id:6,name:0,intervention_type:1,description:2,length_meters:3})}}const $s="Intervention",Rs=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],Ts={name:$s,oneOf:Rs};function Is(r){const e=r-1;return e*e*e+1}function wt(r,{delay:e=0,duration:t=400,easing:n=Is}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),h=parseFloat(i.marginBottom),m=parseFloat(i.borderTopWidth),c=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*h}px;border-top-width: ${f*m}px;border-bottom-width: ${f*c}px;`}}function Si(r){return"members"in r}function Ei(r){return"oneOf"in r}function Mi(r){return typeof r=="string"}function Oi(r){return typeof r=="object"&&"value"in r}function Ps(r){return"type"in r&&r.type=="number"}function Li(r){return"type"in r&&r.type=="one-liner"}function Ci(r){return"type"in r&&r.type=="textbox"}function Ai(r){return"type"in r&&r.type=="checkbox"}function Ir(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Pr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function xr(r){let e,t=r[1].description+"",n;return{c(){e=k("p"),n=Y(t),O(e,"class","svelte-1b72l00")},m(i,o){S(i,e,o),w(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&xe(n,t)},d(i){i&&E(e)}}}function xs(r){let e,t,n;return{c(){e=k("input"),O(e,"type","checkbox")},m(i,o){S(i,e,o),e.checked=r[0],t||(n=F(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:q,o:q,d(i){i&&E(e),t=!1,n()}}}function Fs(r){let e,t,n;return{c(){e=k("textarea"),ce(e,"width","100%"),O(e,"rows","5"),O(e,"class","svelte-1b72l00")},m(i,o){S(i,e,o),Pe(e,r[0]),t||(n=F(e,"input",r[13]),t=!0)},p(i,o){o&1&&Pe(e,i[0])},i:q,o:q,d(i){i&&E(e),t=!1,n()}}}function Ns(r){let e,t,n;return{c(){e=k("input"),O(e,"type","text"),ce(e,"width","100%")},m(i,o){S(i,e,o),Pe(e,r[0]),t||(n=F(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Pe(e,i[0])},i:q,o:q,d(i){i&&E(e),t=!1,n()}}}function Bs(r){let e,t,n;return{c(){e=k("input"),O(e,"type","number")},m(i,o){S(i,e,o),Pe(e,r[0]),t||(n=F(e,"input",r[11]),t=!0)},p(i,o){o&1&&ui(e.value)!==i[0]&&Pe(e,i[0])},i:q,o:q,d(i){i&&E(e),t=!1,n()}}}function Ds(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=Nr(Ir(r,n,s));const o=s=>T(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=de()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);S(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Ir(s,n,l);i[l]?(i[l].p(u,a),A(i[l],1)):(i[l]=Nr(u),i[l].c(),A(i[l],1),i[l].m(e.parentNode,e))}for(we(),l=n.length;l<i.length;l+=1)o(l);ke()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)A(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)T(i[a]);t=!1},d(s){fi(i,s),s&&E(e)}}}function js(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=Br(Pr(r,n,s));const o=s=>T(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=de()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);S(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Pr(s,n,l);i[l]?(i[l].p(u,a),A(i[l],1)):(i[l]=Br(u),i[l].c(),A(i[l],1),i[l].m(e.parentNode,e))}for(we(),l=n.length;l<i.length;l+=1)o(l);ke()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)A(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)T(i[a]);t=!1},d(s){fi(i,s),s&&E(e)}}}function qs(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,h,m,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&Fr(r);return{c(){e=k("label"),t=k("input"),i=C(),s=Y(o),a=k("br"),l=C(),f&&f.c(),u=de(),O(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(d,b){S(d,e,b),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),S(d,l,b),f&&f.m(d,b),S(d,u,b),h=!0,m||(c=[F(t,"change",r[9]),F(t,"change",r[4])],m=!0)},p(d,b){(!h||b&2&&n!==(n=d[15].name))&&(t.__value=n,t.value=t.__value),b&4&&(t.checked=t.__value===d[2]),(!h||b&2)&&o!==(o=d[15].name+"")&&xe(s,o),d[2]==d[15].name&&typeof d[0]=="object"?f?(f.p(d,b),b&7&&A(f,1)):(f=Fr(d),f.c(),A(f,1),f.m(u.parentNode,u)):f&&(we(),T(f,1,1,()=>{f=null}),ke())},i(d){h||(A(f),h=!0)},o(d){T(f),h=!1},d(d){d&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),d&&E(l),f&&f.d(d),d&&E(u),m=!1,Ie(c)}}}function Us(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,h;function m(d,b){return d[15].description?Hs:zs}let c=m(r),f=c(r);return{c(){e=k("label"),t=k("input"),i=C(),s=Y(o),a=C(),f.c(),l=C(),O(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(d,b){S(d,e,b),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),f.m(e,null),w(e,l),u||(h=[F(t,"change",r[8]),F(t,"change",r[3])],u=!0)},p(d,b){b&2&&n!==(n=d[15].value)&&(t.__value=n,t.value=t.__value),b&4&&(t.checked=t.__value===d[2]),b&2&&o!==(o=d[15].value+"")&&xe(s,o),c===(c=m(d))&&f?f.p(d,b):(f.d(1),f=c(d),f&&(f.c(),f.m(e,l)))},i:q,o:q,d(d){d&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Ie(h)}}}function Gs(r){let e,t,n,i,o=r[15]+"",s,a,l,u,h,m;return{c(){e=k("label"),t=k("input"),i=C(),s=Y(o),a=C(),l=k("br"),u=C(),O(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){S(c,e,f),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),w(e,l),w(e,u),h||(m=[F(t,"change",r[6]),F(t,"change",r[3])],h=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&o!==(o=c[15]+"")&&xe(s,o)},i:q,o:q,d(c){c&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),h=!1,Ie(m)}}}function Fr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Yt({props:l}),oe.push(()=>Oe(t,"value",a,r[0][r[15].name])),{c(){e=k("div"),G(t.$$.fragment),i=C(),O(e,"class","svelte-1b72l00")},m(u,h){S(u,e,h),z(t,e,null),w(e,i),s=!0},p(u,h){r=u;const m={};h&2&&(m.spec=r[15]),!n&&h&3&&(n=!0,m.value=r[0][r[15].name],Le(()=>n=!1)),t.$set(m)},i(u){s||(A(t.$$.fragment,u),zt(()=>{o||(o=yt(e,wt,{duration:500},!0)),o.run(1)}),s=!0)},o(u){T(t.$$.fragment,u),o||(o=yt(e,wt,{duration:500},!1)),o.run(0),s=!1},d(u){u&&E(e),H(t),u&&o&&o.end()}}}function zs(r){let e;return{c(){e=k("br")},m(t,n){S(t,e,n)},p:q,d(t){t&&E(e)}}}function Hs(r){let e,t,n=r[15].description+"",i,o;return{c(){e=k("p"),t=Y("("),i=Y(n),o=Y(")"),O(e,"class","svelte-1b72l00")},m(s,a){S(s,e,a),w(e,t),w(e,i),w(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&xe(i,n)},d(s){s&&E(e)}}}function Nr(r){let e,t,n,i,o,s;const a=[Gs,Us,qs],l=[];function u(h,m){return m&2&&(e=null),m&2&&(t=null),e==null&&(e=!!Mi(h[15])),e?0:(t==null&&(t=!!Oi(h[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=de()},m(h,m){l[n].m(h,m),S(h,o,m),s=!0},p(h,m){let c=n;n=u(h,m),n===c?l[n].p(h,m):(we(),T(l[c],1,1,()=>{l[c]=null}),ke(),i=l[n],i?i.p(h,m):(i=l[n]=a[n](h),i.c()),A(i,1),i.m(o.parentNode,o))},i(h){s||(A(i),s=!0)},o(h){T(i),s=!1},d(h){l[n].d(h),h&&E(o)}}}function Br(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function h(c){r[5](c,r[15])}let m={spec:r[15]};return r[0][r[15].name]!==void 0&&(m.value=r[0][r[15].name]),s=new Yt({props:m}),oe.push(()=>Oe(s,"value",h,r[0][r[15].name])),{c(){e=k("div"),t=k("h3"),i=Y(n),o=C(),G(s.$$.fragment),l=C(),O(e,"class","svelte-1b72l00")},m(c,f){S(c,e,f),w(e,t),w(t,i),w(e,o),z(s,e,null),w(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&xe(i,n);const d={};f&2&&(d.spec=r[15]),!a&&f&3&&(a=!0,d.value=r[0][r[15].name],Le(()=>a=!1)),s.$set(d)},i(c){u||(A(s.$$.fragment,c),u=!0)},o(c){T(s.$$.fragment,c),u=!1},d(c){c&&E(e),H(s)}}}function Ys(r){let e,t,n,i,o,s,a,l,u,h,m,c=r[1].description&&xr(r);const f=[js,Ds,Bs,Ns,Fs,xs],d=[];function b(g,y){return y&2&&(t=null),y&2&&(n=null),y&2&&(i=null),y&2&&(o=null),y&2&&(s=null),y&2&&(a=null),t==null&&(t=!!Si(g[1])),t?0:(n==null&&(n=!!Ei(g[1])),n?1:(i==null&&(i=!!Ps(g[1])),i?2:(o==null&&(o=!!Li(g[1])),o?3:(s==null&&(s=!!Ci(g[1])),s?4:(a==null&&(a=!!Ai(g[1])),a?5:-1)))))}return~(l=b(r,-1))&&(u=d[l]=f[l](r)),{c(){c&&c.c(),e=C(),u&&u.c(),h=de()},m(g,y){c&&c.m(g,y),S(g,e,y),~l&&d[l].m(g,y),S(g,h,y),m=!0},p(g,[y]){g[1].description?c?c.p(g,y):(c=xr(g),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let p=l;l=b(g,y),l===p?~l&&d[l].p(g,y):(u&&(we(),T(d[p],1,1,()=>{d[p]=null}),ke()),~l?(u=d[l],u?u.p(g,y):(u=d[l]=f[l](g),u.c()),A(u,1),u.m(h.parentNode,h)):u=null)},i(g){m||(A(u),m=!0)},o(g){T(u),m=!1},d(g){c&&c.d(g),g&&E(e),~l&&d[l].d(g),g&&E(h)}}}function Js(r,e,t){var p,_,v;let{spec:n}=e,{value:i}=e,o="";if(Si(n)){i||(i={});for(let M of n.members)Li(M)||Ci(M)?i[p=M.name]||(i[p]=""):Ai(M)?i[_=M.name]||(i[_]=!1):i[v=M.name]||(i[v]={})}else Ei(n)&&(i||(i={}),Mi(i)?o=i:Oi(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,L){r.$$.not_equal(i[L.name],M)&&(i[L.name]=M,t(0,i))}function h(){o=this.__value,t(2,o)}function m(){o=this.__value,t(2,o)}function c(){o=this.__value,t(2,o)}function f(M,L){r.$$.not_equal(i[L.name],M)&&(i[L.name]=M,t(0,i))}function d(){i=ui(this.value),t(0,i)}function b(){i=this.value,t(0,i)}function g(){i=this.value,t(0,i)}function y(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,h,l,m,c,f,d,b,g,y]}class Yt extends te{constructor(e){super(),ne(this,e,Js,Ys,ee,{spec:1,value:0})}}function Xs(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Yt({props:o}),oe.push(()=>Oe(e,"value",i,r[0].v2)),{c(){G(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Le(()=>t=!1)),e.$set(l)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){H(e,s)}}}function Ws(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=Ts;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Vs extends te{constructor(e){super(),ne(this,e,Ws,Xs,ee,{props:0})}}const Ks="Planning",Zs=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],Qs={name:Ks,members:Zs};function el(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Yt({props:o}),oe.push(()=>Oe(e,"value",i,r[0].planning)),{c(){G(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Le(()=>t=!1)),e.$set(l)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){H(e,s)}}}function tl(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=Qs;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class nl extends te{constructor(e){super(),ne(this,e,tl,el,ee,{props:0})}}const rl="CriticalIssue",il=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],ol={name:rl,members:il};function sl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Yt({props:o}),oe.push(()=>Oe(e,"value",i,r[0].criticals)),{c(){G(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Le(()=>t=!1)),e.$set(l)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){H(e,s)}}}function ll(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=ol;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class al extends te{constructor(e){super(),ne(this,e,ll,sl,ee,{props:0})}}function Dr(r){let e,t,n,i,o;const s=r[10].default,a=dt(s,r,r[9],null);return{c(){e=k("div"),a&&a.c(),ce(e,"border","solid 1px black"),ce(e,"padding","10px")},m(l,u){S(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=F(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&mt(a,s,l,l[9],n?gt(s,l[9],u,null):_t(l[9]),null)},i(l){n||(A(a,l),zt(()=>{t||(t=yt(e,wt,{duration:100},!0)),t.run(1)}),n=!0)},o(l){T(a,l),t||(t=yt(e,wt,{duration:100},!1)),t.run(0),n=!1},d(l){l&&E(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function ul(r){let e,t,n,i,o,s,a,l,u,h,m=r[4]&&Dr(r);return{c(){e=k("button"),t=sn("svg"),n=sn("path"),i=C(),o=Y(r[1]),s=C(),m&&m.c(),a=de(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-t7fpgu"),O(e,"aria-expanded",r[4]),O(e,"class","svelte-t7fpgu"),hr(e,"underlined",r[3])},m(c,f){S(c,e,f),w(e,t),w(t,n),w(e,i),w(e,o),S(c,s,f),m&&m.m(c,f),S(c,a,f),l=!0,u||(h=[F(e,"click",r[5]),F(e,"mouseenter",r[11]),F(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&xe(o,c[1]),(!l||f&16)&&O(e,"aria-expanded",c[4]),(!l||f&8)&&hr(e,"underlined",c[3]),c[4]?m?(m.p(c,f),f&16&&A(m,1)):(m=Dr(c),m.c(),A(m,1),m.m(a.parentNode,a)):m&&(we(),T(m,1,1,()=>{m=null}),ke())},i(c){l||(A(m),l=!0)},o(c){T(m),l=!1},d(c){c&&E(e),c&&E(s),m&&m.d(c),c&&E(a),u=!1,Ie(h)}}}function fl(r,e,t){let n,i,o,s;le(r,Ge,p=>t(7,o=p)),le(r,Me,p=>t(8,s=p));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:h}=e;const m=()=>{Me.update(p=>p==u?null:u),s==u&&(Dn.set(null),Dn.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const d=()=>jt.set(u),b=()=>jt.set(null);function g(p){oe[p?"unshift":"push"](()=>{c=p,t(2,c)})}const y=()=>f();return r.$$set=p=>{"id"in p&&t(0,u=p.id),"label"in p&&t(1,h=p.label),"$$scope"in p&&t(9,l=p.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,h,c,i,n,m,f,o,s,l,a,d,b,g,y]}class cl extends te{constructor(e){super(),ne(this,e,fl,ul,ee,{id:0,label:1})}}function jr(r,e,t){const n=r.slice();return n[14]=e[t],n[15]=e,n[16]=t,n}function pl(r){let e,t,n;function i(s){r[10](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new al({props:o}),oe.push(()=>Oe(e,"props",i,r[14].properties)),{c(){G(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Le(()=>t=!1)),e.$set(l)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){H(e,s)}}}function hl(r){let e,t,n;function i(s){r[9](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new nl({props:o}),oe.push(()=>Oe(e,"props",i,r[14].properties)),{c(){G(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Le(()=>t=!1)),e.$set(l)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){H(e,s)}}}function dl(r){let e,t,n;function i(s){r[8](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new Vs({props:o}),oe.push(()=>Oe(e,"props",i,r[14].properties)),{c(){G(e.$$.fragment)},m(s,a){z(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Le(()=>t=!1)),e.$set(l)},i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){H(e,s)}}}function ml(r){let e,t,n,i,o;function s(h){r[5](h,r[14])}function a(h){r[6](h,r[14])}function l(h){r[7](h,r[14])}let u={routeInfo:r[1],id:r[14].id,length_meters:r[14].properties.length_meters};return r[14].properties.name!==void 0&&(u.name=r[14].properties.name),r[14].properties.intervention_type!==void 0&&(u.intervention_type=r[14].properties.intervention_type),r[14].properties.description!==void 0&&(u.description=r[14].properties.description),e=new As({props:u}),oe.push(()=>Oe(e,"name",s,r[14].properties.name)),oe.push(()=>Oe(e,"intervention_type",a,r[14].properties.intervention_type)),oe.push(()=>Oe(e,"description",l,r[14].properties.description)),{c(){G(e.$$.fragment)},m(h,m){z(e,h,m),o=!0},p(h,m){r=h;const c={};m&2&&(c.routeInfo=r[1]),m&4&&(c.id=r[14].id),m&4&&(c.length_meters=r[14].properties.length_meters),!t&&m&4&&(t=!0,c.name=r[14].properties.name,Le(()=>t=!1)),!n&&m&4&&(n=!0,c.intervention_type=r[14].properties.intervention_type,Le(()=>n=!1)),!i&&m&4&&(i=!0,c.description=r[14].properties.description,Le(()=>i=!1)),e.$set(c)},i(h){o||(A(e.$$.fragment,h),o=!0)},o(h){T(e.$$.fragment,h),o=!1},d(h){H(e,h)}}}function _l(r){let e,t,n,i,o,s,a,l,u,h,m,c,f,d,b;const g=[ml,dl,hl,pl],y=[];function p(v,M){return v[0]=="v1"?0:v[0]=="v2"?1:v[0]=="planning"?2:v[0]=="criticals"?3:-1}~(e=p(r))&&(t=y[e]=g[e](r));function _(){return r[11](r[14])}return{c(){t&&t.c(),n=C(),i=k("br"),o=C(),s=k("br"),a=C(),l=k("div"),u=k("button"),u.textContent="Delete",h=C(),m=k("button"),m.textContent="Save",c=C(),O(u,"type","button"),O(m,"type","button"),ce(l,"display","flex"),ce(l,"justify-content","space-between")},m(v,M){~e&&y[e].m(v,M),S(v,n,M),S(v,i,M),S(v,o,M),S(v,s,M),S(v,a,M),S(v,l,M),w(l,u),w(l,h),w(l,m),S(v,c,M),f=!0,d||(b=[F(u,"click",_),F(m,"click",r[12])],d=!0)},p(v,M){r=v;let L=e;e=p(r),e===L?~e&&y[e].p(r,M):(t&&(we(),T(y[L],1,1,()=>{y[L]=null}),ke()),~e?(t=y[e],t?t.p(r,M):(t=y[e]=g[e](r),t.c()),A(t,1),t.m(n.parentNode,n)):t=null)},i(v){f||(A(t),f=!0)},o(v){T(t),f=!1},d(v){~e&&y[e].d(v),v&&E(n),v&&E(i),v&&E(o),v&&E(s),v&&E(a),v&&E(l),v&&E(c),d=!1,Ie(b)}}}function qr(r,e){let t,n,i;return n=new cl({props:{id:e[14].id,label:e[16]+1+") "+e[3](e[14]),$$slots:{default:[_l]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=de(),G(n.$$.fragment),this.first=t},m(o,s){S(o,t,s),z(n,o,s),i=!0},p(o,s){e=o;const a={};s&4&&(a.id=e[14].id),s&4&&(a.label=e[16]+1+") "+e[3](e[14])),s&131079&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||(A(n.$$.fragment,o),i=!0)},o(o){T(n.$$.fragment,o),i=!1},d(o){o&&E(t),H(n,o)}}}function gl(r){let e=[],t=new Map,n,i,o,s,a=r[2].features;const l=u=>u[14].id;for(let u=0;u<a.length;u+=1){let h=jr(r,a,u),m=l(h);t.set(m,e[u]=qr(m,h))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=de()},m(u,h){for(let m=0;m<e.length;m+=1)e[m].m(u,h);S(u,n,h),i=!0,o||(s=F(window,"keydown",r[4]),o=!0)},p(u,[h]){h&15&&(a=u[2].features,we(),e=ro(e,h,l,1,u,a,t,n.parentNode,io,qr,n,jr),ke())},i(u){if(!i){for(let h=0;h<a.length;h+=1)A(e[h]);i=!0}},o(u){for(let h=0;h<e.length;h+=1)T(e[h]);i=!1},d(u){for(let h=0;h<e.length;h+=1)e[h].d(u);u&&E(n),o=!1,s()}}}function bl(r,e,t){let n,i;le(r,Me,y=>t(13,n=y)),le(r,re,y=>t(2,i=y));let{schema:o}=e,{routeInfo:s}=e;function a(y){var _,v,M,L,R;if(o=="planning")return((_=y.properties.planning)==null?void 0:_.name)||"Untitled polygon";if(o=="v2")return((M=(v=y.properties.v2)==null?void 0:v.Route)==null?void 0:M.name)||((R=(L=y.properties.v2)==null?void 0:L.Crossing)==null?void 0:R.name)||"Untitled intervention";if(y.properties.name)return y.properties.name;var p=y.properties.intervention_type;return p=="other"&&(y.geometry.type=="Point"?p="point":y.geometry.type=="LineString"?p="line":p="polygon"),`Untitled ${p}`}function l(y){if(y.key=="Delete"){const p=y.target.tagName;if(p=="INPUT"||p=="TEXTAREA")return;y.preventDefault();const _=n;_&&_r(_)}}function u(y,p){r.$$.not_equal(p.properties.name,y)&&(p.properties.name=y,re.set(i))}function h(y,p){r.$$.not_equal(p.properties.intervention_type,y)&&(p.properties.intervention_type=y,re.set(i))}function m(y,p){r.$$.not_equal(p.properties.description,y)&&(p.properties.description=y,re.set(i))}function c(y,p){r.$$.not_equal(p.properties,y)&&(p.properties=y,re.set(i))}function f(y,p){r.$$.not_equal(p.properties,y)&&(p.properties=y,re.set(i))}function d(y,p){r.$$.not_equal(p.properties,y)&&(p.properties=y,re.set(i))}const b=y=>_r(y.id),g=()=>Me.set(null);return r.$$set=y=>{"schema"in y&&t(0,o=y.schema),"routeInfo"in y&&t(1,s=y.routeInfo)},[o,s,i,a,l,u,h,m,c,f,d,b,g]}class yl extends te{constructor(e){super(),ne(this,e,bl,gl,ee,{schema:0,routeInfo:1})}}function tt(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ze(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Yn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ke(r,e,t){t===void 0&&(t={});var n=tt(r),i=tt(e),o=De(i[1]-n[1]),s=De(i[0]-n[0]),a=De(n[1]),l=De(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return oo(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function en(r,e){return e===void 0&&(e={}),so(r,function(t,n){var i=n.geometry.coordinates;return t+Ke(i[0],i[1],e)},0)}function Ur(r){let e,t,n,i,o,s=r[1]+1+"",a,l,u=r[0].length+"",h,m,c,f,d,b,g;return{c(){e=k("div"),t=k("button"),n=Y("Previous"),o=C(),a=Y(s),l=Y(" / "),h=Y(u),m=C(),c=k("button"),f=Y("Next"),O(t,"type","button"),t.disabled=i=r[1]==0,O(c,"type","button"),c.disabled=d=r[1]==r[0].length-1},m(y,p){S(y,e,p),w(e,t),w(t,n),w(e,o),w(e,a),w(e,l),w(e,h),w(e,m),w(e,c),w(c,f),b||(g=[F(t,"click",r[10]),F(c,"click",r[11])],b=!0)},p(y,p){p&2&&i!==(i=y[1]==0)&&(t.disabled=i),p&2&&s!==(s=y[1]+1+"")&&xe(a,s),p&1&&u!==(u=y[0].length+"")&&xe(h,u),p&3&&d!==(d=y[1]==y[0].length-1)&&(c.disabled=d)},d(y){y&&E(e),b=!1,Ie(g)}}}function vl(r){let e,t,n,i,o,s,a,l,u,h,m,c,f,d,b,g,y,p,_,v,M=r[2].features.length+"",L,R,$,I,N,x,V,j,D=r[0].length>1&&Ur(r);return{c(){e=k("div"),t=k("label"),n=Y(`Scheme name:
    `),i=k("input"),o=C(),s=k("br"),a=C(),l=k("div"),u=k("label"),h=k("input"),m=C(),c=k("button"),c.textContent="Load from GeoJSON",f=C(),d=k("button"),d.textContent="Export to GeoJSON",b=C(),D&&D.c(),g=C(),y=k("br"),p=C(),_=k("div"),v=k("span"),L=Y(M),R=Y(" interventions"),$=C(),I=k("button"),N=Y("Clear all"),O(i,"type","text"),O(h,"type","file"),O(h,"id","load_geojson"),h.multiple=!0,O(h,"class","svelte-lhyd1e"),O(c,"type","button"),O(d,"type","button"),O(d,"class","align-right svelte-lhyd1e"),O(I,"type","button"),O(I,"class","align-right svelte-lhyd1e"),I.disabled=x=r[2].features.length==0},m(B,Z){S(B,e,Z),w(e,t),w(t,n),w(t,i),Pe(i,r[2].scheme_name),S(B,o,Z),S(B,s,Z),S(B,a,Z),S(B,l,Z),w(l,u),w(u,h),w(u,m),w(u,c),w(l,f),w(l,d),S(B,b,Z),D&&D.m(B,Z),S(B,g,Z),S(B,y,Z),S(B,p,Z),S(B,_,Z),w(_,v),w(v,L),w(v,R),w(_,$),w(_,I),w(I,N),V||(j=[F(i,"input",r[9]),F(h,"change",r[5]),F(c,"click",kl),F(d,"click",r[4]),F(I,"click",r[3])],V=!0)},p(B,[Z]){Z&4&&i.value!==B[2].scheme_name&&Pe(i,B[2].scheme_name),B[0].length>1?D?D.p(B,Z):(D=Ur(B),D.c(),D.m(g.parentNode,g)):D&&(D.d(1),D=null),Z&4&&M!==(M=B[2].features.length+"")&&xe(L,M),Z&4&&x!==(x=B[2].features.length==0)&&(I.disabled=x)},i:q,o:q,d(B){B&&E(e),B&&E(o),B&&E(s),B&&E(a),B&&E(l),B&&E(b),D&&D.d(B),B&&E(g),B&&E(y),B&&E(p),B&&E(_),V=!1,Ie(j)}}}function wl(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function kl(){document.getElementById("load_geojson").click()}function Sl(r,e,t){let n;le(r,re,p=>t(2,n=p));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=[],l=0,u=window.localStorage.getItem(s);if(u)try{re.set(d(JSON.parse(u)))}catch(p){console.log(`Failed to load from local storage: ${p}`)}function h(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(re.update(p=>(delete p.scheme_name,p.features=[],p)),Me.set(null),Ge.set(null),jt.set(null))}function m(){const p=JSON.parse(JSON.stringify(n));for(let _ of p.features)delete _.properties.hide_while_editing;return p}function c(){let p=m();var _=s;p.authority=i,p.origin="atip-v1",p.scheme_name&&(_+="_"+p.scheme_name),_+=".txt",wl(_,JSON.stringify(p,null,"  "))}function f(p){t(0,a=[]),t(1,l=0);let _=!0;for(let v of p.target.files){let M=_;const L=new FileReader;L.onload=R=>{if(t(0,a=[...a,R.target.result]),M)try{re.set(d(JSON.parse(R.target.result)))}catch($){window.alert(`Couldn't load scheme from a file: ${$}`)}},L.readAsText(v),_=!1}}function d(p){let _=1;for(let v of p.features)v.properties||(v.properties={name:"",description:"",intervention_type:"other"}),v.geometry.type=="LineString"&&!v.properties.length_meters&&(v.properties.length_meters=en(v,{units:"kilometers"})*1e3),v.id=_++;return p}function b(){n.scheme_name=this.value,re.set(n)}const g=p=>t(1,l--,l),y=p=>t(1,l++,l);return r.$$set=p=>{"authorityName"in p&&t(6,i=p.authorityName),"schema"in p&&t(7,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&260&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(m()))),r.$$.dirty&3&&a.length>1)try{re.set(d(JSON.parse(a[l])))}catch(p){console.log(`Failed to load from local storage: ${p}`)}},[a,l,n,h,c,f,i,o,s,b,g,y]}class El extends te{constructor(e){super(),ne(this,e,Sl,vl,ee,{authorityName:6,schema:7})}}const Ml="/atip/browse_files/assets/zoom_out_map-b2e1091a.svg";function Ol(r){let e,t,n,i,o;return{c(){e=k("button"),t=k("img"),lo(t.src,n=Ml)||O(t,"src",n),O(t,"alt","Zoom to show entire boundary"),O(e,"type","button"),O(e,"title","Zoom to show entire boundary"),O(e,"class","svelte-qzjsqo")},m(s,a){S(s,e,a),w(e,t),i||(o=F(e,"click",r[0]),i=!0)},p:q,i:q,o:q,d(s){s&&E(e),i=!1,o()}}}function Ll(r,e,t){let n;le(r,Ye,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(er(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class Cl extends te{constructor(e){super(),ne(this,e,Ll,Ol,ee,{boundaryGeojson:1})}}function Al(r){let e,t,n,i,o,s,a;return{c(){e=k("div"),t=Y(`Basemap:
  `),n=k("select"),i=k("option"),i.textContent="Streets",o=k("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&zt(()=>r[2].call(n)),O(e,"class","svelte-1tbnm6i")},m(l,u){S(l,e,u),w(e,t),w(e,n),w(n,i),w(n,o),ln(n,r[0]),s||(a=[F(n,"change",r[2]),F(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&ln(n,l[0])},i:q,o:q,d(l){l&&E(e),s=!1,Ie(a)}}}function $l(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=ci(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Rl extends te{constructor(e){super(),ne(this,e,$l,Al,ee,{style:0})}}const fe={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Sn=10,dn=10;function Tl(r){let e,t,n,i,o,s,a,l,u,h,m,c,f,d,b;return{c(){e=k("li"),t=k("span"),n=Y("Areas"),i=C(),o=k("li"),s=k("span"),a=Y("Routes"),l=C(),u=k("li"),h=k("span"),m=Y("Crossings"),c=C(),f=k("li"),d=k("span"),b=Y("Other"),O(t,"class","svelte-p551i1"),ce(t,"background",fe.area),O(s,"class","svelte-p551i1"),ce(s,"background",fe.route),O(h,"class","svelte-p551i1"),ce(h,"background",fe.crossing),O(d,"class","svelte-p551i1"),ce(d,"background",fe.other)},m(g,y){S(g,e,y),w(e,t),w(e,n),S(g,i,y),S(g,o,y),w(o,s),w(o,a),S(g,l,y),S(g,u,y),w(u,h),w(u,m),S(g,c,y),S(g,f,y),w(f,d),w(f,b)},p:q,d(g){g&&E(e),g&&E(i),g&&E(o),g&&E(l),g&&E(u),g&&E(c),g&&E(f)}}}function Il(r){let e,t,n,i,o,s,a,l,u,h,m,c,f,d,b;return{c(){e=k("li"),t=k("span"),n=Y("Preapp"),i=C(),o=k("li"),s=k("span"),a=Y("Outline"),l=C(),u=k("li"),h=k("span"),m=Y("Reserved matters"),c=C(),f=k("li"),d=k("span"),b=Y("Local plan"),O(t,"class","svelte-p551i1"),ce(t,"background",fe.preapp),O(s,"class","svelte-p551i1"),ce(s,"background",fe.outline),O(h,"class","svelte-p551i1"),ce(h,"background",fe["reserved matters"]),O(d,"class","svelte-p551i1"),ce(d,"background",fe["local plan"])},m(g,y){S(g,e,y),w(e,t),w(e,n),S(g,i,y),S(g,o,y),w(o,s),w(o,a),S(g,l,y),S(g,u,y),w(u,h),w(u,m),S(g,c,y),S(g,f,y),w(f,d),w(f,b)},p:q,d(g){g&&E(e),g&&E(i),g&&E(o),g&&E(l),g&&E(u),g&&E(c),g&&E(f)}}}function Pl(r){let e,t,n,i;function o(l,u){return l[0]=="planning"?Il:Tl}let s=o(r),a=s(r);return{c(){e=k("div"),t=k("h1"),t.textContent="Interventions",n=C(),i=k("ul"),a.c(),O(t,"class","svelte-p551i1"),O(e,"class","svelte-p551i1")},m(l,u){S(l,e,u),w(e,t),w(e,n),w(e,i),a.m(i,null)},p(l,[u]){s===(s=o(l))&&a?a.p(l,u):(a.d(1),a=s(l),a&&(a.c(),a.m(i,null)))},i:q,o:q,d(l){l&&E(e),a.d()}}}function xl(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class Fl extends te{constructor(e){super(),ne(this,e,xl,Pl,ee,{schema:0})}}let lt="interventions";function Nl(r,e,t){let n,i;le(r,Ye,h=>t(1,n=h)),le(r,re,h=>t(2,i=h));let{schema:o}=e;ot(n,lt,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",fe.area,"route",fe.route,"crossing",fe.crossing,"other",fe.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",fe.preapp,"outline",fe.outline,"reserved matters",fe["reserved matters"],"local plan",fe["local plan"],"white"],l=["!=","hide_while_editing",!0];return Se(n,{id:"interventions-points",source:lt,filter:["all",vn,l,["!=","endpoint",!0]],...St(s,Sn)}),Se(n,{id:"interventions-lines",source:lt,filter:["all",wn,l],...Dt(s,dn)},"route-lines"),Se(n,{id:"interventions-lines-endpoints",source:lt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*dn,"circle-opacity":0,"circle-stroke-color":fe.lineEndpointColor,"circle-stroke-width":2}}),Se(n,{id:"interventions-polygons",source:lt,filter:["all",kn,l],...yn(o=="planning"?a:s,.5)},"hover-polygons"),r.$$set=h=>{"schema"in h&&t(0,o=h.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let h=JSON.parse(JSON.stringify(i)),m=[];for(let c of h.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])m.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});h.features=h.features.concat(m),n.getSource(lt).setData(h)}},[o,n,i]}class Bl extends te{constructor(e){super(),ne(this,e,Nl,null,ee,{schema:0})}}let at="hover";function Dl(r,e,t){let n,i,o,s,a;return le(r,Ye,l=>t(0,n=l)),le(r,re,l=>t(1,i=l)),le(r,jt,l=>t(2,o=l)),le(r,Ge,l=>t(3,s=l)),le(r,Me,l=>t(4,a=l)),ot(n,at,{type:"geojson",data:He()}),Se(n,{id:"hover-polygons",source:at,filter:kn,...Dt(fe.hovering,.5*dn,1)}),Se(n,{id:"hover-lines",source:at,filter:wn,...Dt(fe.hovering,1.5*dn,1)},"interventions-lines"),Se(n,{id:"hover-points",source:at,filter:vn,...St(fe.hovering,1.5*Sn,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(at).setData(i.features.find(u=>u.id==l)):n.getSource(at).setData(He())}},[n,i,o,s,a]}class jl extends te{constructor(e){super(),ne(this,e,Dl,null,ee,{})}}class or{constructor(e,t){ie(this,"owner");ie(this,"map");ie(this,"mapHandlers",{});ie(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Wt="edit-point-mode";class ql{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"cursor");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new or(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),ot(e,Wt,{type:"geojson",data:He()}),Se(e,{id:"edit-point-mode",source:Wt,...St(fe.hovering,Sn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=Ul(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Wt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=He();this.cursor&&e.features.push(this.cursor),this.map.getSource(Wt).setData(e)}}function Ul(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function $i(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Gl(r,e);var n=tt(r),i=tt(e),o=De(n[0]),s=De(i[0]),a=De(n[1]),l=De(i[1]),u=Math.sin(s-o)*Math.cos(l),h=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return Pn(Math.atan2(u,h))}function Gl(r,e){var t=$i(e,r);return t=(t+180)%360,t}function Gr(r,e,t,n){n===void 0&&(n={});var i=tt(r),o=De(i[0]),s=De(i[1]),a=De(t),l=ao(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),h=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),m=Pn(h),c=Pn(u);return bt([m,c],n.properties)}function Jn(r){if(!r)throw new Error("geojson is required");var e=[];return tr(r,function(t){zl(t,e)}),et(e)}function zl(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=ze(n);break;case"LineString":t=[ze(n)]}t.forEach(function(i){var o=Hl(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Hl(r,e){var t=[];return r.reduce(function(n,i){var o=vt([n,i],e);return o.bbox=Yl(n,i),t.push(o),i}),t}function Yl(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var kt={},Jl={get exports(){return kt},set exports(r){kt=r}},Xn={},Xl={get exports(){return Xn},set exports(r){Xn=r}};(function(r,e){(function(t,n){r.exports=n()})(uo,function(){function t(p,_,v,M,L){(function R($,I,N,x,V){for(;x>N;){if(x-N>600){var j=x-N+1,D=I-N+1,B=Math.log(j),Z=.5*Math.exp(2*B/3),U=.5*Math.sqrt(B*Z*(j-Z)/j)*(D-j/2<0?-1:1),ue=Math.max(N,Math.floor(I-D*Z/j+U)),Ae=Math.min(x,Math.floor(I+(j-D)*Z/j+U));R($,I,ue,Ae,V)}var Ne=$[I],me=N,he=x;for(n($,N,I),V($[x],Ne)>0&&n($,N,x);me<he;){for(n($,me,he),me++,he--;V($[me],Ne)<0;)me++;for(;V($[he],Ne)>0;)he--}V($[N],Ne)===0?n($,N,he):n($,++he,x),he<=I&&(N=he+1),I<=he&&(x=he-1)}})(p,_,v||0,M||p.length-1,L||i)}function n(p,_,v){var M=p[_];p[_]=p[v],p[v]=M}function i(p,_){return p<_?-1:p>_?1:0}var o=function(p){p===void 0&&(p=9),this._maxEntries=Math.max(4,p),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(p,_,v){if(!v)return _.indexOf(p);for(var M=0;M<_.length;M++)if(v(p,_[M]))return M;return-1}function a(p,_){l(p,0,p.children.length,_,p)}function l(p,_,v,M,L){L||(L=g(null)),L.minX=1/0,L.minY=1/0,L.maxX=-1/0,L.maxY=-1/0;for(var R=_;R<v;R++){var $=p.children[R];u(L,p.leaf?M($):$)}return L}function u(p,_){return p.minX=Math.min(p.minX,_.minX),p.minY=Math.min(p.minY,_.minY),p.maxX=Math.max(p.maxX,_.maxX),p.maxY=Math.max(p.maxY,_.maxY),p}function h(p,_){return p.minX-_.minX}function m(p,_){return p.minY-_.minY}function c(p){return(p.maxX-p.minX)*(p.maxY-p.minY)}function f(p){return p.maxX-p.minX+(p.maxY-p.minY)}function d(p,_){return p.minX<=_.minX&&p.minY<=_.minY&&_.maxX<=p.maxX&&_.maxY<=p.maxY}function b(p,_){return _.minX<=p.maxX&&_.minY<=p.maxY&&_.maxX>=p.minX&&_.maxY>=p.minY}function g(p){return{children:p,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(p,_,v,M,L){for(var R=[_,v];R.length;)if(!((v=R.pop())-(_=R.pop())<=M)){var $=_+Math.ceil((v-_)/M/2)*M;t(p,$,_,v,L),R.push(_,$,$,v)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(p){var _=this.data,v=[];if(!b(p,_))return v;for(var M=this.toBBox,L=[];_;){for(var R=0;R<_.children.length;R++){var $=_.children[R],I=_.leaf?M($):$;b(p,I)&&(_.leaf?v.push($):d(p,I)?this._all($,v):L.push($))}_=L.pop()}return v},o.prototype.collides=function(p){var _=this.data;if(!b(p,_))return!1;for(var v=[];_;){for(var M=0;M<_.children.length;M++){var L=_.children[M],R=_.leaf?this.toBBox(L):L;if(b(p,R)){if(_.leaf||d(p,R))return!0;v.push(L)}}_=v.pop()}return!1},o.prototype.load=function(p){if(!p||!p.length)return this;if(p.length<this._minEntries){for(var _=0;_<p.length;_++)this.insert(p[_]);return this}var v=this._build(p.slice(),0,p.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var M=this.data;this.data=v,v=M}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},o.prototype.insert=function(p){return p&&this._insert(p,this.data.height-1),this},o.prototype.clear=function(){return this.data=g([]),this},o.prototype.remove=function(p,_){if(!p)return this;for(var v,M,L,R=this.data,$=this.toBBox(p),I=[],N=[];R||I.length;){if(R||(R=I.pop(),M=I[I.length-1],v=N.pop(),L=!0),R.leaf){var x=s(p,R.children,_);if(x!==-1)return R.children.splice(x,1),I.push(R),this._condense(I),this}L||R.leaf||!d(R,$)?M?(v++,R=M.children[v],L=!1):R=null:(I.push(R),N.push(v),v=0,M=R,R=R.children[0])}return this},o.prototype.toBBox=function(p){return p},o.prototype.compareMinX=function(p,_){return p.minX-_.minX},o.prototype.compareMinY=function(p,_){return p.minY-_.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(p){return this.data=p,this},o.prototype._all=function(p,_){for(var v=[];p;)p.leaf?_.push.apply(_,p.children):v.push.apply(v,p.children),p=v.pop();return _},o.prototype._build=function(p,_,v,M){var L,R=v-_+1,$=this._maxEntries;if(R<=$)return a(L=g(p.slice(_,v+1)),this.toBBox),L;M||(M=Math.ceil(Math.log(R)/Math.log($)),$=Math.ceil(R/Math.pow($,M-1))),(L=g([])).leaf=!1,L.height=M;var I=Math.ceil(R/$),N=I*Math.ceil(Math.sqrt($));y(p,_,v,N,this.compareMinX);for(var x=_;x<=v;x+=N){var V=Math.min(x+N-1,v);y(p,x,V,I,this.compareMinY);for(var j=x;j<=V;j+=I){var D=Math.min(j+I-1,V);L.children.push(this._build(p,j,D,M-1))}}return a(L,this.toBBox),L},o.prototype._chooseSubtree=function(p,_,v,M){for(;M.push(_),!_.leaf&&M.length-1!==v;){for(var L=1/0,R=1/0,$=void 0,I=0;I<_.children.length;I++){var N=_.children[I],x=c(N),V=(j=p,D=N,(Math.max(D.maxX,j.maxX)-Math.min(D.minX,j.minX))*(Math.max(D.maxY,j.maxY)-Math.min(D.minY,j.minY))-x);V<R?(R=V,L=x<L?x:L,$=N):V===R&&x<L&&(L=x,$=N)}_=$||_.children[0]}var j,D;return _},o.prototype._insert=function(p,_,v){var M=v?p:this.toBBox(p),L=[],R=this._chooseSubtree(M,this.data,_,L);for(R.children.push(p),u(R,M);_>=0&&L[_].children.length>this._maxEntries;)this._split(L,_),_--;this._adjustParentBBoxes(M,L,_)},o.prototype._split=function(p,_){var v=p[_],M=v.children.length,L=this._minEntries;this._chooseSplitAxis(v,L,M);var R=this._chooseSplitIndex(v,L,M),$=g(v.children.splice(R,v.children.length-R));$.height=v.height,$.leaf=v.leaf,a(v,this.toBBox),a($,this.toBBox),_?p[_-1].children.push($):this._splitRoot(v,$)},o.prototype._splitRoot=function(p,_){this.data=g([p,_]),this.data.height=p.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(p,_,v){for(var M,L,R,$,I,N,x,V=1/0,j=1/0,D=_;D<=v-_;D++){var B=l(p,0,D,this.toBBox),Z=l(p,D,v,this.toBBox),U=(L=B,R=Z,$=void 0,I=void 0,N=void 0,x=void 0,$=Math.max(L.minX,R.minX),I=Math.max(L.minY,R.minY),N=Math.min(L.maxX,R.maxX),x=Math.min(L.maxY,R.maxY),Math.max(0,N-$)*Math.max(0,x-I)),ue=c(B)+c(Z);U<V?(V=U,M=D,j=ue<j?ue:j):U===V&&ue<j&&(j=ue,M=D)}return M||v-_},o.prototype._chooseSplitAxis=function(p,_,v){var M=p.leaf?this.compareMinX:h,L=p.leaf?this.compareMinY:m;this._allDistMargin(p,_,v,M)<this._allDistMargin(p,_,v,L)&&p.children.sort(M)},o.prototype._allDistMargin=function(p,_,v,M){p.children.sort(M);for(var L=this.toBBox,R=l(p,0,_,L),$=l(p,v-_,v,L),I=f(R)+f($),N=_;N<v-_;N++){var x=p.children[N];u(R,p.leaf?L(x):x),I+=f(R)}for(var V=v-_-1;V>=_;V--){var j=p.children[V];u($,p.leaf?L(j):j),I+=f($)}return I},o.prototype._adjustParentBBoxes=function(p,_,v){for(var M=v;M>=0;M--)u(_[M],p)},o.prototype._condense=function(p){for(var _=p.length-1,v=void 0;_>=0;_--)p[_].children.length===0?_>0?(v=p[_-1].children).splice(v.indexOf(p[_]),1):this.clear():a(p[_],this.toBBox)},o})})(Xl);const Wl=nr(fo),Vl=nr(co),Kl=nr(po);var qe=Xn,Ri=Wl,Ti=Vl,ut=Kl.default,Zl=Ti.featureEach;Ti.coordEach;Ri.polygon;var zr=Ri.featureCollection;function Ii(r){var e=new qe(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ut(t),qe.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ut(i),n.push(i)}):Zl(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ut(i),n.push(i)}),qe.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ut(t),qe.prototype.remove.call(this,t,n)},e.clear=function(){return qe.prototype.clear.call(this)},e.search=function(t){var n=qe.prototype.search.call(this,this.toBBox(t));return zr(n)},e.collides=function(t){return qe.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=qe.prototype.all.call(this);return zr(t)},e.toJSON=function(){return qe.prototype.toJSON.call(this)},e.fromJSON=function(t){return qe.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ut(t);else if(t.type==="FeatureCollection")n=ut(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Jl.exports=Ii;kt.default=Ii;function Pi(r,e){var t={},n=[];if(r.type==="LineString"&&(r=dr(r)),e.type==="LineString"&&(e=dr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Hr(r,e);return i&&n.push(i),et(n)}var o=kt();return o.load(Jn(e)),an(Jn(r),function(s){an(o.search(s),function(a){var l=Hr(s,a);if(l){var u=ze(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),et(n)}function Hr(r,e){var t=ze(r),n=ze(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],h=n[1][0],m=n[1][1],c=(m-u)*(s-i)-(h-l)*(a-o),f=(h-l)*(o-u)-(m-u)*(i-l),d=(s-i)*(o-u)-(a-o)*(i-l);if(c===0)return f===0&&d===0,null;var b=f/c,g=d/c;if(b>=0&&b<=1&&g>=0&&g<=1){var y=i+b*(s-i),p=o+b*(a-o);return bt([y,p])}return null}function Ut(r,e,t){t===void 0&&(t={});var n=bt([1/0,1/0],{dist:1/0}),i=0;return tr(r,function(o){for(var s=ze(o),a=0;a<s.length-1;a++){var l=bt(s[a]);l.properties.dist=Ke(e,l,t);var u=bt(s[a+1]);u.properties.dist=Ke(e,u,t);var h=Ke(l,u,t),m=Math.max(l.properties.dist,u.properties.dist),c=$i(l,u),f=Gr(e,m,c+90,t),d=Gr(e,m,c-90,t),b=Pi(vt([f.geometry.coordinates,d.geometry.coordinates]),vt([l.geometry.coordinates,u.geometry.coordinates])),g=null;b.features.length>0&&(g=b.features[0],g.properties.dist=Ke(e,g,t),g.properties.location=i+Ke(l,g,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+h),g&&g.properties.dist<n.properties.dist&&(n=g,n.properties.index=a),i+=h}}),n}const ft="edit-polygon-mode";class Ql{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"points");ie(this,"cursor");ie(this,"hover");ie(this,"dragFrom");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new or(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),ot(e,ft,{type:"geojson",data:He()}),Se(e,{id:"edit-polygon-fill",source:ft,filter:kn,...yn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Se(e,{id:"edit-polygon-lines",source:ft,filter:wn,...Dt("black",8,.5)}),Se(e,{id:"edit-polygon-vertices",source:ft,filter:vn,...St(fe.hovering,Sn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Jr(this.points).forEach((n,i)=>{t.push([i+1,Ut(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(ft),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=He();this.points.forEach((n,i)=>{let o=Yr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Jr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(ft).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Yr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Yr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Jr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let W;const We=new Array(32).fill(void 0);We.push(void 0,null,!0,!1);function X(r){return We[r]}let Ft=We.length;function ea(r){r<36||(We[r]=Ft,Ft=r)}function Wn(r){const e=X(r);return ea(r),e}const xi=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});xi.decode();let tn=new Uint8Array;function Nt(){return tn.byteLength===0&&(tn=new Uint8Array(W.memory.buffer)),tn}function pt(r,e){return xi.decode(Nt().subarray(r,r+e))}function ye(r){Ft===We.length&&We.push(We.length+1);const e=Ft;return Ft=We[e],We[e]=r,e}function $n(r){return r==null}let nn=new Float64Array;function ta(){return nn.byteLength===0&&(nn=new Float64Array(W.memory.buffer)),nn}let rn=new Int32Array;function ve(){return rn.byteLength===0&&(rn=new Int32Array(W.memory.buffer)),rn}let Qe=0;const on=new TextEncoder("utf-8"),na=typeof on.encodeInto=="function"?function(r,e){return on.encodeInto(r,e)}:function(r,e){const t=on.encode(r);return e.set(t),{read:r.length,written:t.length}};function Vt(r,e,t){if(t===void 0){const a=on.encode(r),l=e(a.length);return Nt().subarray(l,l+a.length).set(a),Qe=a.length,l}let n=r.length,i=e(n);const o=Nt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=Nt().subarray(i+s,i+n),l=na(r,a);s+=l.written}return Qe=s,i}function Vn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Vn(r[0]));for(let s=1;s<i;s++)o+=", "+Vn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function ra(r,e){const t=e(r.length*1);return Nt().set(r,t/1),Qe=r.length,t}function Rn(r,e){try{return r.apply(this,e)}catch(t){W.__wbindgen_exn_store(ye(t))}}class mn{static __wrap(e){const t=Object.create(mn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();W.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=W.__wbindgen_add_to_stack_pointer(-16),s=ra(e,W.__wbindgen_malloc),a=Qe;W.jsroutesnapper_new(o,s,a);var t=ve()[o/4+0],n=ve()[o/4+1],i=ve()[o/4+2];if(i)throw Wn(n);return mn.__wrap(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){W.jsroutesnapper_setConfig(this.ptr,ye(e))}toFinalFeature(){try{const n=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ve()[n/4+0],t=ve()[n/4+1];let i;return e!==0&&(i=pt(e,t).slice(),W.__wbindgen_free(e,t*1)),i}finally{W.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_renderGeojson(n,this.ptr);var e=ve()[n/4+0],t=ve()[n/4+1];return pt(e,t)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,t)}}setSnapMode(e){W.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return W.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){W.jsroutesnapper_onClick(this.ptr)}onDragStart(){return W.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return W.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){W.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_editExisting(i,this.ptr,ye(e));var t=ve()[i/4+0],n=ve()[i/4+1];if(n)throw Wn(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}}async function ia(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function oa(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Wn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=X(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(pt(e,t));return ye(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=pt(e,t);return ye(n)},r.wbg.__wbindgen_is_object=function(e){const t=X(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return X(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return X(e)in X(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=X(t),i=typeof n=="number"?n:void 0;ta()[e/8+1]=$n(i)?0:i,ve()[e/4+0]=!$n(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return X(e)==X(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=X(t),i=typeof n=="string"?n:void 0;var o=$n(i)?0:Vt(i,W.__wbindgen_malloc,W.__wbindgen_realloc),s=Qe;ve()[e/4+1]=s,ve()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(X(t)),i=Vt(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=Qe;ve()[e/4+1]=o,ve()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=X(e);return ye(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=X(e)[X(t)];return ye(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(X(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(X(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(X(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(X(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(X(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=X(e)[t>>>0];return ye(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return X(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof X(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=X(e).next;return ye(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Rn(function(e){const t=X(e).next();return ye(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return X(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=X(e).value;return ye(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ye(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Rn(function(e,t){const n=Reflect.get(X(e),X(t));return ye(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Rn(function(e,t){const n=X(e).call(X(t));return ye(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(X(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=X(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=X(e).buffer;return ye(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(X(e));return ye(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){X(e).set(X(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return X(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=X(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ye(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=X(t).stack,i=Vt(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=Qe;ve()[e/4+1]=o,ve()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(pt(e,t))}finally{W.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=Vn(X(t)),i=Vt(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=Qe;ve()[e/4+1]=o,ve()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(pt(e,t))},r.wbg.__wbindgen_memory=function(){const e=W.memory;return ye(e)},r}function sa(r,e){return W=r.exports,Fi.__wbindgen_wasm_module=e,nn=new Float64Array,rn=new Int32Array,tn=new Uint8Array,W}async function Fi(r){typeof r>"u"&&(r="/atip/browse_files/assets/route_snapper_bg.wasm");const e=oa();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await ia(await r,e);return sa(t,n)}const Lt="route-snapper",Xr=10,la=30;class aa{constructor(e,t){ie(this,"map");ie(this,"inner");ie(this,"active");ie(this,"eventListenersSuccessRoute");ie(this,"eventListenersSuccessArea");ie(this,"eventListenersFailure");ie(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new mn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],ot(e,Lt,{type:"geojson",data:He()}),Se(e,{id:"route-points",source:Lt,filter:vn,...St(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Xr/2,Xr])}),Se(e,{id:"route-lines",source:Lt,filter:wn,...Dt("black",2.5)}),Se(e,{id:"route-polygons",source:Lt,filter:kn,...yn("black",.5)}),this.events=new or(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-la,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Lt).setData(JSON.parse(this.inner.renderGeojson()))}}function Wr(r){let e;function t(o,s){return o[1]?fa:ua}let n=t(r),i=n(r);return{c(){i.c(),e=de()},m(o,s){i.m(o,s),S(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&E(e)}}}function ua(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function fa(r){let e;return{c(){e=k("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function ca(r){let e,t=r[0]==ht&&Wr(r);return{c(){t&&t.c(),e=de()},m(n,i){t&&t.m(n,i),S(n,e,i)},p(n,[i]){n[0]==ht?t?t.p(n,i):(t=Wr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:q,o:q,d(n){t&&t.d(n),n&&E(e)}}}const ht="edit-attribute";function Ni(){}function pa(r,e,t){let n,i,o,s;le(r,Ye,f=>t(5,n=f)),le(r,re,f=>t(6,i=f)),le(r,Dn,f=>t(7,o=f)),le(r,Me,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){Me.set(null)}n.on("mousemove",h),n.on("mouseout",m),n.on("click",c),Gt(()=>{n.off("mousemove",h),n.off("mouseout",m),n.off("click",c)});function h(f){var d;if(a==ht){let b=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ge.set(((d=b[0])==null?void 0:d.id)||null)}}function m(){a==ht&&Ge.set(null)}function c(f){if(a==ht){let d=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});d.length>0?Me.set(d[0].id):Me.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let d=i.features.find(b=>b.id==f);d.geometry.type=="Point"?n.flyTo({center:d.geometry.coordinates,duration:500}):n.fitBounds(er(d),{padding:200,duration:500}),l(ht)}}},[a,s,l,Ni,u,n,i,o]}class ha extends te{constructor(e){super(),ne(this,e,pa,ca,ee,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Ni}get stop(){return this.$$.ctx[4]}}function da(r){let e,t;return{c:q,m(n,i){e||(t=F(window,"keydown",r[0]),e=!0)},p:q,i:q,o:q,d(n){e=!1,t()}}}function ma(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class En extends te{constructor(e){super(),ne(this,e,ma,da,ee,{tool:1})}}function _a(r){let e;return{c(){e=k("li"),e.textContent="Click to add a new point"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function ga(r){let e;return{c(){e=k("li"),e.textContent="Click to move the point here"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function ba(r){let e,t,n,i,o,s,a,l,u,h;function m(d,b){return d[1]?ga:_a}let c=m(r),f=c(r);return a=new En({props:{tool:r[0]}}),{c(){e=k("ul"),f.c(),t=C(),n=k("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=C(),o=k("button"),o.textContent="Cancel",s=C(),G(a.$$.fragment),O(o,"type","button")},m(d,b){S(d,e,b),f.m(e,null),w(e,t),w(e,n),S(d,i,b),S(d,o,b),S(d,s,b),z(a,d,b),l=!0,u||(h=F(o,"click",r[2]),u=!0)},p(d,[b]){c!==(c=m(d))&&(f.d(1),f=c(d),f&&(f.c(),f.m(e,t)));const g={};b&1&&(g.tool=d[0]),a.$set(g)},i(d){l||(A(a.$$.fragment,d),l=!0)},o(d){T(a.$$.fragment,d),l=!1},d(d){d&&E(e),f.d(),d&&E(i),d&&E(o),d&&E(s),H(a,d),u=!1,h()}}}function ya(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Bi extends te{constructor(e){super(),ne(this,e,ya,ba,ee,{pointTool:0,editingExisting:1})}}function Vr(r){let e,t,n;const i=r[3].default,o=dt(i,r,r[2],null);return{c(){e=k("div"),o&&o.c()},m(s,a){S(s,e,a),o&&o.m(e,null),n=!0},p(s,a){o&&o.p&&(!n||a&4)&&mt(o,i,s,s[2],n?gt(i,s[2],a,null):_t(s[2]),null)},i(s){n||(A(o,s),zt(()=>{t||(t=yt(e,wt,{duration:100},!0)),t.run(1)}),n=!0)},o(s){T(o,s),t||(t=yt(e,wt,{duration:100},!1)),t.run(0),n=!1},d(s){s&&E(e),o&&o.d(s),s&&t&&t.end()}}}function va(r){let e,t,n,i,o,s,a,l,u,h,m=r[1]&&Vr(r);return{c(){e=k("button"),t=sn("svg"),n=sn("path"),i=C(),o=Y(r[0]),s=C(),m&&m.c(),a=de(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-una9lq"),O(e,"aria-expanded",r[1]),O(e,"class","svelte-una9lq")},m(c,f){S(c,e,f),w(e,t),w(t,n),w(e,i),w(e,o),S(c,s,f),m&&m.m(c,f),S(c,a,f),l=!0,u||(h=F(e,"click",r[4]),u=!0)},p(c,[f]){(!l||f&1)&&xe(o,c[0]),(!l||f&2)&&O(e,"aria-expanded",c[1]),c[1]?m?(m.p(c,f),f&2&&A(m,1)):(m=Vr(c),m.c(),A(m,1),m.m(a.parentNode,a)):m&&(we(),T(m,1,1,()=>{m=null}),ke())},i(c){l||(A(m),l=!0)},o(c){T(m),l=!1},d(c){c&&E(e),c&&E(s),m&&m.d(c),c&&E(a),u=!1,h()}}}function wa(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,s=!1;const a=()=>t(1,s=!s);return r.$$set=l=>{"label"in l&&t(0,o=l.label),"$$scope"in l&&t(2,i=l.$$scope)},[o,s,i,n,a]}class sr extends te{constructor(e){super(),ne(this,e,wa,va,ee,{label:0})}}function ka(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},p:q,d(t){t&&E(e)}}}function Sa(r){let e,t,n,i,o,s,a,l,u,h,m;return e=new sr({props:{label:"Help",$$slots:{default:[ka]},$$scope:{ctx:r}}}),l=new En({props:{tool:r[0]}}),{c(){G(e.$$.fragment),t=C(),n=k("div"),i=k("button"),i.textContent="Finish",o=C(),s=k("button"),s.textContent="Cancel",a=C(),G(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),ce(n,"display","flex"),ce(n,"justify-content","space-between")},m(c,f){z(e,c,f),S(c,t,f),S(c,n,f),w(n,i),w(n,o),w(n,s),S(c,a,f),z(l,c,f),u=!0,h||(m=[F(i,"click",r[1]),F(s,"click",r[2])],h=!0)},p(c,[f]){const d={};f&8&&(d.$$scope={dirty:f,ctx:c}),e.$set(d);const b={};f&1&&(b.tool=c[0]),l.$set(b)},i(c){u||(A(e.$$.fragment,c),A(l.$$.fragment,c),u=!0)},o(c){T(e.$$.fragment,c),T(l.$$.fragment,c),u=!1},d(c){H(e,c),c&&E(t),c&&E(n),c&&E(a),H(l,c),h=!1,Ie(m)}}}function Ea(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Di extends te{constructor(e){super(),ne(this,e,Ea,Sa,ee,{polygonTool:0})}}function Ma(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},p:q,d(t){t&&E(e)}}}function Oa(r){let e,t,n,i,o,s,a,l,u,h,m;return e=new sr({props:{label:"Help",$$slots:{default:[Ma]},$$scope:{ctx:r}}}),l=new En({props:{tool:r[0]}}),{c(){G(e.$$.fragment),t=C(),n=k("div"),i=k("button"),i.textContent="Finish",o=C(),s=k("button"),s.textContent="Cancel",a=C(),G(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),ce(n,"display","flex"),ce(n,"justify-content","space-between")},m(c,f){z(e,c,f),S(c,t,f),S(c,n,f),w(n,i),w(n,o),w(n,s),S(c,a,f),z(l,c,f),u=!0,h||(m=[F(i,"click",r[1]),F(s,"click",r[2])],h=!0)},p(c,[f]){const d={};f&8&&(d.$$scope={dirty:f,ctx:c}),e.$set(d);const b={};f&1&&(b.tool=c[0]),l.$set(b)},i(c){u||(A(e.$$.fragment,c),A(l.$$.fragment,c),u=!0)},o(c){T(e.$$.fragment,c),T(l.$$.fragment,c),u=!1},d(c){H(e,c),c&&E(t),c&&E(n),c&&E(a),H(l,c),h=!1,Ie(m)}}}function La(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class ji extends te{constructor(e){super(),ne(this,e,La,Oa,ee,{routeTool:0})}}function Ca(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},p:q,d(t){t&&E(e)}}}function Aa(r){let e,t,n,i,o,s,a,l,u,h,m,c,f,d,b;return e=new sr({props:{label:"Help",$$slots:{default:[Ca]},$$scope:{ctx:r}}}),c=new En({props:{tool:r[0]}}),{c(){G(e.$$.fragment),t=C(),n=k("label"),i=k("input"),o=Y(`
  Avoid doubling back`),s=C(),a=k("div"),l=k("button"),l.textContent="Finish",u=C(),h=k("button"),h.textContent="Cancel",m=C(),G(c.$$.fragment),O(i,"type","checkbox"),O(l,"type","button"),O(h,"type","button"),ce(a,"display","flex"),ce(a,"justify-content","space-between")},m(g,y){z(e,g,y),S(g,t,y),S(g,n,y),w(n,i),i.checked=r[1],w(n,o),S(g,s,y),S(g,a,y),w(a,l),w(a,u),w(a,h),S(g,m,y),z(c,g,y),f=!0,d||(b=[F(i,"change",r[2]),F(l,"click",r[3]),F(h,"click",r[4])],d=!0)},p(g,[y]){const p={};y&32&&(p.$$scope={dirty:y,ctx:g}),e.$set(p),y&2&&(i.checked=g[1]);const _={};y&1&&(_.tool=g[0]),c.$set(_)},i(g){f||(A(e.$$.fragment,g),A(c.$$.fragment,g),f=!0)},o(g){T(e.$$.fragment,g),T(c.$$.fragment,g),f=!1},d(g){H(e,g),g&&E(t),g&&E(n),g&&E(s),g&&E(a),g&&E(m),H(c,g),d=!1,Ie(b)}}}function $a(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class qi extends te{constructor(e){super(),ne(this,e,$a,Aa,ee,{routeTool:0})}}function Kr(r){let e,t,n,i;const o=[xa,Pa,Ia,Ta,Ra],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=de()},m(l,u){s[e].m(l,u),S(l,n,u),i=!0},p(l,u){let h=e;e=a(l),e===h?s[e].p(l,u):(we(),T(s[h],1,1,()=>{s[h]=null}),ke(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),A(t,1),t.m(n.parentNode,n))},i(l){i||(A(t),i=!0)},o(l){T(t),i=!1},d(l){s[e].d(l),l&&E(n)}}}function Ra(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){S(t,e,n)},p:q,i:q,o:q,d(t){t&&E(e)}}}function Ta(r){let e,t;return e=new qi({props:{routeTool:r[3]}}),{c(){G(e.$$.fragment)},m(n,i){z(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Ia(r){let e,t;return e=new ji({props:{routeTool:r[3]}}),{c(){G(e.$$.fragment)},m(n,i){z(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Pa(r){let e,t;return e=new Di({props:{polygonTool:r[2]}}),{c(){G(e.$$.fragment)},m(n,i){z(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function xa(r){let e,t;return e=new Bi({props:{pointTool:r[1],editingExisting:!0}}),{c(){G(e.$$.fragment)},m(n,i){z(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Fa(r){let e,t,n=r[0]==Je&&Kr(r);return{c(){n&&n.c(),e=de()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Je?n?(n.p(i,o),o&1&&A(n,1)):(n=Kr(i),n.c(),A(n,1),n.m(e.parentNode,e)):n&&(we(),T(n,1,1,()=>{n=null}),ke())},i(i){t||(A(n),t=!0)},o(i){T(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const Je="edit-geometry";function Ui(){}function Na(r,e,t){let n;le(r,Ye,b=>t(8,n=b));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function h(){l&&(o.stop(),s.stop(),a.stop(),re.update(b=>{let g=b.features.find(y=>y.id==l);return delete g.properties.hide_while_editing,b})),l=null,t(4,u=null),Ge.set(null)}n.on("mousemove",m),n.on("mouseout",c),n.on("click",f),Gt(()=>{n.off("mousemove",m),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(b=>{i==Je&&(re.update(g=>{let y=g.features.find(p=>p.id==l);return y.properties.length_meters=b.properties.length_meters,y.properties.waypoints=b.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=b.geometry,g}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(b=>{i==Je&&(re.update(g=>{let y=g.features.find(p=>p.id==l);return y.properties.waypoints=b.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=b.geometry,g}),l=null,t(4,u=null))});for(let b of[o,s])b.addEventListenerSuccess(g=>{i==Je&&(re.update(y=>{let p=y.features.find(_=>_.id==l);return p.geometry=g.geometry,delete p.properties.hide_while_editing,y}),l=null,t(4,u=null))});for(let b of[o,s,a])b.addEventListenerFailure(()=>{i==Je&&(re.update(g=>{let y=g.features.find(p=>p.id==l);return delete y.properties.hide_while_editing,g}),l=null,t(4,u=null))});function m(b){var g;if(i==Je&&l==null){let y=n.queryRenderedFeatures(b.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ge.set(((g=y[0])==null?void 0:g.id)||null)}}function c(){i==Je&&l==null&&Ge.set(null)}function f(b){if(i==Je&&l==null){let g=n.queryRenderedFeatures(b.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0&&d(g[0].id)}}function d(b){Ge.set(null);let g=null;re.update(p=>(g=p.features.find(_=>_.id==b),g.properties.hide_while_editing=!0,p));let y=g;l=b,y.geometry.type=="LineString"?(a.editExistingRoute(y),t(4,u="route")):y.geometry.type=="Polygon"?y.properties.waypoints?(a.editExistingArea(y),t(4,u="snap-polygon")):(s.editExisting(y),t(4,u="free-polygon")):y.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=b=>{"mode"in b&&t(0,i=b.mode),"pointTool"in b&&t(1,o=b.pointTool),"polygonTool"in b&&t(2,s=b.polygonTool),"routeTool"in b&&t(3,a=b.routeTool)},[i,o,s,a,u,Ui,h]}class Ba extends te{constructor(e){super(),ne(this,e,Na,Fa,ee,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Ui}get stop(){return this.$$.ctx[6]}}async function Da(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:h}=await n.read();if(u)break;s.push(h),o+=h.length;const m=100*o/i;e.style=`background: linear-gradient(to right, red ${m}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function ja(r){let e,t;return e=new qi({props:{routeTool:r[0]}}),{c(){G(e.$$.fragment)},m(n,i){z(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function qa(r){let e;return{c(){e=k("div"),e.textContent="Route tool loading..."},m(t,n){S(t,e,n),r[7](e)},p:q,i:q,o:q,d(t){t&&E(e),r[7](null)}}}function Ua(r){let e,t,n,i;const o=[qa,ja],s=[];function a(l,u){return l[0]?l[1]==Kn?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=de()},m(l,u){~e&&s[e].m(l,u),S(l,n,u),i=!0},p(l,[u]){let h=e;e=a(l),e===h?~e&&s[e].p(l,u):(t&&(we(),T(s[h],1,1,()=>{s[h]=null}),ke()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),A(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(A(t),i=!0)},o(l){T(t),i=!1},d(l){~e&&s[e].d(l),l&&E(n)}}}const Kn="route";function Ga(r,e,t){let n;le(r,Ye,c=>t(8,n=c));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function h(){l==null||l.stop()}Qn(async()=>{await Fi(),console.log(`Grabbing ${s}`);try{const c=await Da(s,a);t(0,l=new aa(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==Kn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{i==Kn&&(re.update(f=>(c.id=Ht(f),c.properties.intervention_type="route",f.features.push(c),f)),o("edit-attribute"),Me.set(c.id))})});function m(c){oe[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,i=c.mode),"changeMode"in c&&t(3,o=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,i,a,o,s,u,h,m]}class za extends te{constructor(e){super(),ne(this,e,Ga,Ua,ee,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Zr(r){let e,t;return e=new Bi({props:{pointTool:r[1],editingExisting:!1}}),{c(){G(e.$$.fragment)},m(n,i){z(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Ha(r){let e,t,n=r[0]==_n&&Zr(r);return{c(){n&&n.c(),e=de()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==_n?n?(n.p(i,o),o&1&&A(n,1)):(n=Zr(i),n.c(),A(n,1),n.m(e.parentNode,e)):n&&(we(),T(n,1,1,()=>{n=null}),ke())},i(i){t||(A(n),t=!0)},o(i){T(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const _n="point";function Ya(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==_n&&(re.update(u=>(l.id=Ht(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),Me.set(l.id))}),o.addEventListenerFailure(()=>{n==_n&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class Ja extends te{constructor(e){super(),ne(this,e,Ya,Ha,ee,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Qr(r){let e,t;return e=new Di({props:{polygonTool:r[1]}}),{c(){G(e.$$.fragment)},m(n,i){z(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Xa(r){let e,t,n=r[0]==gn&&Qr(r);return{c(){n&&n.c(),e=de()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==gn?n?(n.p(i,o),o&1&&A(n,1)):(n=Qr(i),n.c(),A(n,1),n.m(e.parentNode,e)):n&&(we(),T(n,1,1,()=>{n=null}),ke())},i(i){t||(A(n),t=!0)},o(i){T(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const gn="free-polygon";function Wa(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==gn&&(re.update(u=>(l.id=Ht(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Me.set(l.id))}),o.addEventListenerFailure(()=>{n==gn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Va extends te{constructor(e){super(),ne(this,e,Wa,Xa,ee,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ei(r){let e,t;return e=new ji({props:{routeTool:r[1]}}),{c(){G(e.$$.fragment)},m(n,i){z(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(A(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function Ka(r){let e,t,n=r[0]==bn&&ei(r);return{c(){n&&n.c(),e=de()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==bn?n?(n.p(i,o),o&1&&A(n,1)):(n=ei(i),n.c(),A(n,1),n.m(e.parentNode,e)):n&&(we(),T(n,1,1,()=>{n=null}),ke())},i(i){t||(A(n),t=!0)},o(i){T(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const bn="snap-polygon";function Za(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==bn&&(re.update(u=>(l.id=Ht(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Me.set(l.id))}),o.addEventListenerFailure(()=>{n==bn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class Qa extends te{constructor(e){super(),ne(this,e,Za,Ka,ee,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function eu(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Ke(r.slice(0,2),[n,t]),s=Ke(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function tu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return ho(r,function(s){nu(s,o,n)}),r}function nu(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function ru(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Yn(r),n=Yn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=tu(e,{precision:7});switch(n){case"Point":return Zn(r,i);case"MultiPoint":return ti(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return ti(r,Pi(r,i))}}function ti(r,e){var t=[],n=kt();return tr(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=Zn(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=eu(mo(a)))}),n.load(et(t));else{var o=n.search(i);if(o.features.length){var s=Gi(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),an(Zn(s,i),function(a){t.push(a),n.insert(a)})}}}),et(t)}function Zn(r,e){var t=[],n=ze(r)[0],i=ze(r)[r.geometry.coordinates.length-1];if(Tn(n,tt(e))||Tn(i,tt(e)))return et([r]);var o=kt(),s=Jn(r);o.load(s);var a=o.search(e);if(!a.features.length)return et([r]);var l=Gi(e,a),u=[n],h=_o(s,function(m,c,f){var d=ze(c)[1],b=tt(e);return f===l.id?(m.push(b),t.push(vt(m)),Tn(b,d)?[b]:[b,d]):(m.push(d),m)},u);return h.length>1&&t.push(vt(h)),et(t)}function Gi(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return an(e,function(i){var o=Ut(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function Tn(r,e){return r[0]===e[0]&&r[1]===e[1]}function iu(r,e,t){var n=ze(t);if(Yn(t)!=="LineString")throw new Error("line must be a LineString");var i=Ut(t,r),o=Ut(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),vt(a,t.properties)}function ni(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function ou(r){let e,t,n,i=r[0]==Bt&&ni();return{c(){i&&i.c(),e=de()},m(o,s){i&&i.m(o,s),S(o,e,s),t||(n=F(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Bt?i||(i=ni(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:q,o:q,d(o){i&&i.d(o),o&&E(e),t=!1,n()}}}const Bt="split-route",su=10,lu=30;let In="split-route";function zi(){}function ri(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function au(r,e,t){let n,i;le(r,re,b=>t(8,n=b)),le(r,Ye,b=>t(6,i=b));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",h),i.on("click",m),Gt(()=>{i.off("mousemove",h),i.off("click",m)}),ot(i,In,{type:"geojson",data:He()}),Se(i,{id:"draw-split-route",source:In,...St("black",su,["case",["==",["get","snapped"],!0],1,.5])});function h(b){if(o!=Bt)return;t(5,l=ri(b.lngLat.toArray(),!1)),u=null;const g=[b.point.x-lu,b.point.y],y=i.unproject(b.point).distanceTo(i.unproject(g))/1e3;let p=[];for(let[_,v]of n.features.entries())if(v.geometry.type=="LineString"){let M=Ut(v.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=y&&p.push([_,M.geometry.coordinates,M.properties.dist])}p.sort((_,v)=>_[2]-v[2]),p.length>0&&(t(5,l=ri(p[0][1],!0)),u=p[0][0])}function m(){if(o==Bt)if(u==null)s("edit-attribute");else{let b=ru(n.features[u],l);if(b.features.length==2){let g=b.features[0],y=b.features[1];re.update(p=>(g.id=p.features[u].id,y.id=Ht(p),g.properties=JSON.parse(JSON.stringify(p.features[u].properties)),y.properties=JSON.parse(JSON.stringify(g.properties)),c(p.features[u],g,y,l),p.features.splice(u,1,g,y),p))}a()}}function c(b,g,y,p){g.properties.length_meters=en(g,{units:"kilometers"})*1e3,y.properties.length_meters=en(y,{units:"kilometers"})*1e3,g.properties.waypoints=[],y.properties.waypoints=[];let _=f(b,p),v=!0,M=0;for(let L of b.properties.waypoints){let R=f(b,bt([L.lon,L.lat]));if(v)if(R<_)g.properties.waypoints.push(L);else{let $=L.snapped&&b.properties.waypoints[M-1].snapped;g.properties.waypoints.push({lon:p.geometry.coordinates[0],lat:p.geometry.coordinates[1],snapped:$}),v=!1,y.properties.waypoints.push({lon:p.geometry.coordinates[0],lat:p.geometry.coordinates[1],snapped:$}),y.properties.waypoints.push(L)}else y.properties.waypoints.push(L);M++}}function f(b,g){let y=b.geometry.coordinates[0],p=iu(y,g,b);return en(p,{units:"kilometers"})*1e3}function d(b){o==Bt&&b.key=="Escape"&&(s("edit-attribute"),b.preventDefault())}return r.$$set=b=>{"mode"in b&&t(0,o=b.mode),"changeMode"in b&&t(2,s=b.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let b=He();l&&b.features.push(l),i.getSource(In).setData(b)}},[o,d,s,zi,a,l,i]}class uu extends te{constructor(e){super(),ne(this,e,au,ou,ee,{mode:0,changeMode:2,start:3,stop:4})}get start(){return zi}get stop(){return this.$$.ctx[4]}}function ii(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new Ba({props:n}),r[17](e),{c(){G(e.$$.fragment)},m(i,o){z(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){T(e.$$.fragment,i),t=!1},d(i){r[17](null),H(e,i)}}}function oi(r){let e,t,n,i,o;return{c(){e=k("button"),t=Y("New point"),O(e,"type","button"),e.disabled=n=r[3]=="point",O(e,"class","svelte-1yde1zx")},m(s,a){S(s,e,a),w(e,t),i||(o=F(e,"click",r[18]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function si(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Qa({props:n}),r[23](e),{c(){G(e.$$.fragment)},m(i,o){z(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){T(e.$$.fragment,i),t=!1},d(i){r[23](null),H(e,i)}}}function li(r){let e,t,n,i,o;return{c(){e=k("button"),t=Y("New route"),O(e,"type","button"),e.disabled=n=r[3]=="route",O(e,"class","svelte-1yde1zx")},m(s,a){S(s,e,a),w(e,t),i||(o=F(e,"click",r[24]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function ai(r){let e,t,n,i,o;return{c(){e=k("button"),t=Y("Split route"),O(e,"type","button"),e.disabled=n=r[3]=="split-route",O(e,"class","svelte-1yde1zx")},m(s,a){S(s,e,a),w(e,t),i||(o=F(e,"click",r[27]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function fu(r){let e,t,n,i,o,s,a,l,u,h,m,c,f,d,b,g,y,p,_,v,M,L,R,$,I,N,x,V,j,D,B,Z,U,ue,Ae,Ne,me,he,Be,ae,P,Q,Hi={mode:r[3],changeMode:r[13]};a=new ha({props:Hi}),r[15](a);let _e=r[2]&&ii(r),$e=r[1]!="planning"&&oi(r),Yi={mode:r[3],changeMode:r[13],pointTool:r[11]};y=new Ja({props:Yi}),r[19](y);let Ji={mode:r[3],changeMode:r[13],polygonTool:r[12]};$=new Va({props:Ji}),r[21]($);let ge=r[2]&&si(r),Re=r[1]!="planning"&&li(r);function Xi(J){r[26](J)}let lr={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(lr.routeTool=r[2]),ue=new za({props:lr}),r[25](ue),oe.push(()=>Oe(ue,"routeTool",Xi,r[2]));let Te=r[1]!="planning"&&ai(r),Wi={mode:r[3],changeMode:r[13]};return Be=new uu({props:Wi}),r[28](Be),{c(){e=k("div"),t=k("div"),n=k("button"),i=Y("Edit attributes"),s=C(),G(a.$$.fragment),l=C(),u=k("div"),h=k("button"),m=Y("Edit geometry"),f=C(),_e&&_e.c(),d=C(),b=k("div"),$e&&$e.c(),g=C(),G(y.$$.fragment),p=C(),_=k("div"),v=k("button"),M=Y("New polygon (freehand)"),R=C(),G($.$$.fragment),I=C(),N=k("div"),x=k("button"),V=Y("New polygon (snapped)"),D=C(),ge&&ge.c(),B=C(),Z=k("div"),Re&&Re.c(),U=C(),G(ue.$$.fragment),Ne=C(),me=k("div"),Te&&Te.c(),he=C(),G(Be.$$.fragment),O(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",O(n,"class","svelte-1yde1zx"),O(h,"type","button"),h.disabled=c=r[3]=="edit-geometry",O(h,"class","svelte-1yde1zx"),O(v,"type","button"),v.disabled=L=r[3]=="free-polygon",O(v,"class","svelte-1yde1zx"),O(x,"type","button"),x.disabled=j=r[3]=="snap-polygon",O(x,"class","svelte-1yde1zx"),O(e,"class","toolbox svelte-1yde1zx")},m(J,pe){S(J,e,pe),w(e,t),w(t,n),w(n,i),w(t,s),z(a,t,null),w(e,l),w(e,u),w(u,h),w(h,m),w(u,f),_e&&_e.m(u,null),w(e,d),w(e,b),$e&&$e.m(b,null),w(b,g),z(y,b,null),w(e,p),w(e,_),w(_,v),w(v,M),w(_,R),z($,_,null),w(e,I),w(e,N),w(N,x),w(x,V),w(N,D),ge&&ge.m(N,null),w(e,B),w(e,Z),Re&&Re.m(Z,null),w(Z,U),z(ue,Z,null),w(e,Ne),w(e,me),Te&&Te.m(me,null),w(me,he),z(Be,me,null),ae=!0,P||(Q=[F(n,"click",r[14]),F(h,"click",r[16]),F(v,"click",r[20]),F(x,"click",r[22])],P=!0)},p(J,[pe]){(!ae||pe&8&&o!==(o=J[3]=="edit-attribute"))&&(n.disabled=o);const ar={};pe&8&&(ar.mode=J[3]),a.$set(ar),(!ae||pe&8&&c!==(c=J[3]=="edit-geometry"))&&(h.disabled=c),J[2]?_e?(_e.p(J,pe),pe&4&&A(_e,1)):(_e=ii(J),_e.c(),A(_e,1),_e.m(u,null)):_e&&(we(),T(_e,1,1,()=>{_e=null}),ke()),J[1]!="planning"?$e?$e.p(J,pe):($e=oi(J),$e.c(),$e.m(b,g)):$e&&($e.d(1),$e=null);const ur={};pe&8&&(ur.mode=J[3]),y.$set(ur),(!ae||pe&8&&L!==(L=J[3]=="free-polygon"))&&(v.disabled=L);const fr={};pe&8&&(fr.mode=J[3]),$.$set(fr),(!ae||pe&8&&j!==(j=J[3]=="snap-polygon"))&&(x.disabled=j),J[2]?ge?(ge.p(J,pe),pe&4&&A(ge,1)):(ge=si(J),ge.c(),A(ge,1),ge.m(N,null)):ge&&(we(),T(ge,1,1,()=>{ge=null}),ke()),J[1]!="planning"?Re?Re.p(J,pe):(Re=li(J),Re.c(),Re.m(Z,U)):Re&&(Re.d(1),Re=null);const Jt={};pe&8&&(Jt.mode=J[3]),pe&1&&(Jt.url=J[0]),!Ae&&pe&4&&(Ae=!0,Jt.routeTool=J[2],Le(()=>Ae=!1)),ue.$set(Jt),J[1]!="planning"?Te?Te.p(J,pe):(Te=ai(J),Te.c(),Te.m(me,he)):Te&&(Te.d(1),Te=null);const cr={};pe&8&&(cr.mode=J[3]),Be.$set(cr)},i(J){ae||(A(a.$$.fragment,J),A(_e),A(y.$$.fragment,J),A($.$$.fragment,J),A(ge),A(ue.$$.fragment,J),A(Be.$$.fragment,J),ae=!0)},o(J){T(a.$$.fragment,J),T(_e),T(y.$$.fragment,J),T($.$$.fragment,J),T(ge),T(ue.$$.fragment,J),T(Be.$$.fragment,J),ae=!1},d(J){J&&E(e),r[15](null),H(a),_e&&_e.d(),$e&&$e.d(),r[19](null),H(y),r[21](null),H($),ge&&ge.d(),Re&&Re.d(),r[25](null),H(ue),Te&&Te.d(),r[28](null),H(Be),P=!1,Ie(Q)}}}function cu(r,e,t){let n;le(r,Ye,U=>t(29,n=U));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new ql(n),l=new Ql(n),u="edit-attribute",h,m,c,f,d,b,g;function y(U){let ue={"edit-attribute":h,"edit-geometry":m,route:c,point:f,"free-polygon":d,"snap-polygon":b,"split-route":g};if(u==U){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),ue[u].stop(),t(3,u=U),console.log(`Starting new mode ${u}`),ue[u].start()}Gt(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const p=()=>y("edit-attribute");function _(U){oe[U?"unshift":"push"](()=>{h=U,t(4,h)})}const v=()=>y("edit-geometry");function M(U){oe[U?"unshift":"push"](()=>{m=U,t(5,m)})}const L=()=>y("point");function R(U){oe[U?"unshift":"push"](()=>{f=U,t(7,f)})}const $=()=>y("free-polygon");function I(U){oe[U?"unshift":"push"](()=>{d=U,t(8,d)})}const N=()=>y("snap-polygon");function x(U){oe[U?"unshift":"push"](()=>{b=U,t(9,b)})}const V=()=>y("route");function j(U){oe[U?"unshift":"push"](()=>{c=U,t(6,c)})}function D(U){s=U,t(2,s)}const B=()=>y("split-route");function Z(U){oe[U?"unshift":"push"](()=>{g=U,t(10,g)})}return r.$$set=U=>{"routeSnapperUrl"in U&&t(0,i=U.routeSnapperUrl),"schema"in U&&t(1,o=U.schema)},[i,o,s,u,h,m,c,f,d,b,g,a,l,y,p,_,v,M,L,R,$,I,N,x,V,j,D,B,Z]}class pu extends te{constructor(e){super(),ne(this,e,cu,fu,ee,{routeSnapperUrl:0,schema:1})}}function hu(r){let e,t,n,i,o,s,a,l,u,h,m,c,f,d,b,g,y,p,_;return{c(){e=k("div"),t=k("div"),n=k("button"),n.textContent="Home",i=C(),o=k("button"),o.textContent="About",s=C(),a=k("button"),a.textContent="Instructions",l=C(),u=k("br"),h=C(),m=k("label"),c=Y(`ATIP schema:
      `),f=k("select"),d=k("option"),d.textContent="v1",b=k("option"),b.textContent="v2",g=k("option"),g.textContent="Housing developments",y=k("option"),y.textContent="Critical issues",O(n,"type","button"),O(o,"type","button"),O(a,"type","button"),d.__value="v1",d.value=d.__value,b.__value="v2",b.value=b.__value,g.__value="planning",g.value=g.__value,y.__value="criticals",y.value=y.__value,r[2]===void 0&&zt(()=>r[12].call(f)),O(e,"slot","nav")},m(v,M){S(v,e,M),w(e,t),w(t,n),w(t,i),w(t,o),w(t,s),w(t,a),w(e,l),w(e,u),w(e,h),w(e,m),w(m,c),w(m,f),w(f,d),w(f,b),w(f,g),w(f,y),ln(f,r[2]),p||(_=[F(n,"click",r[11]),F(o,"click",r[8]),F(a,"click",r[9]),F(f,"change",r[12]),F(f,"change",r[10])],p=!0)},p(v,M){M&4&&ln(f,v[2])},d(v){v&&E(e),p=!1,Ie(_)}}}function du(r){let e,t,n,i,o,s,a,l,u,h,m,c;return o=new Cl({props:{boundaryGeojson:r[5]}}),a=new El({props:{authorityName:r[6],schema:r[2]}}),m=new yl({props:{schema:r[2],routeInfo:r[4]}}),{c(){e=k("div"),t=k("h1"),n=Y(r[6]),i=C(),G(o.$$.fragment),s=C(),G(a.$$.fragment),l=C(),u=k("br"),h=C(),G(m.$$.fragment),O(e,"slot","sidebar")},m(f,d){S(f,e,d),w(e,t),w(t,n),w(t,i),z(o,t,null),w(e,s),z(a,e,null),w(e,l),w(e,u),w(e,h),z(m,e,null),c=!0},p(f,d){const b={};d&32&&(b.boundaryGeojson=f[5]),o.$set(b);const g={};d&4&&(g.schema=f[2]),a.$set(g);const y={};d&4&&(y.schema=f[2]),d&16&&(y.routeInfo=f[4]),m.$set(y)},i(f){c||(A(o.$$.fragment,f),A(a.$$.fragment,f),A(m.$$.fragment,f),c=!0)},o(f){T(o.$$.fragment,f),T(a.$$.fragment,f),T(m.$$.fragment,f),c=!1},d(f){f&&E(e),H(o),H(a),H(m)}}}function mu(r){let e,t,n,i,o,s,a,l,u,h,m,c;return e=new Os({props:{boundaryGeojson:r[5]}}),n=new Bl({props:{schema:r[2]}}),o=new jl({}),a=new pu({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new Rl({props:{style:r[7]}}),m=new Fl({props:{schema:r[2]}}),{c(){G(e.$$.fragment),t=C(),G(n.$$.fragment),i=C(),G(o.$$.fragment),s=C(),G(a.$$.fragment),l=C(),G(u.$$.fragment),h=C(),G(m.$$.fragment)},m(f,d){z(e,f,d),S(f,t,d),z(n,f,d),S(f,i,d),z(o,f,d),S(f,s,d),z(a,f,d),S(f,l,d),z(u,f,d),S(f,h,d),z(m,f,d),c=!0},p(f,d){const b={};d&32&&(b.boundaryGeojson=f[5]),e.$set(b);const g={};d&4&&(g.schema=f[2]),n.$set(g);const y={};d&8&&(y.routeSnapperUrl=f[3]),d&4&&(y.schema=f[2]),a.$set(y);const p={};d&4&&(p.schema=f[2]),m.$set(p)},i(f){c||(A(e.$$.fragment,f),A(n.$$.fragment,f),A(o.$$.fragment,f),A(a.$$.fragment,f),A(u.$$.fragment,f),A(m.$$.fragment,f),c=!0)},o(f){T(e.$$.fragment,f),T(n.$$.fragment,f),T(o.$$.fragment,f),T(a.$$.fragment,f),T(u.$$.fragment,f),T(m.$$.fragment,f),c=!1},d(f){H(e,f),f&&E(t),H(n,f),f&&E(i),H(o,f),f&&E(s),H(a,f),f&&E(l),H(u,f),f&&E(h),H(m,f)}}}function _u(r){let e,t,n;return t=new Jo({props:{style:r[7],$$slots:{default:[mu]},$$scope:{ctx:r}}}),{c(){e=k("div"),G(t.$$.fragment),O(e,"slot","main")},m(i,o){S(i,e,o),z(t,e,null),n=!0},p(i,o){const s={};o&524332&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(A(t.$$.fragment,i),n=!0)},o(i){T(t.$$.fragment,i),n=!1},d(i){i&&E(e),H(t)}}}function gu(r){let e,t,n,i,o,s,a,l;e=new Qo({props:{$$slots:{main:[_u],sidebar:[du],nav:[hu]},$$scope:{ctx:r}}});function u(f){r[13](f)}let h={};r[0]!==void 0&&(h.open=r[0]),n=new go({props:h}),oe.push(()=>Oe(n,"open",u,r[0]));function m(f){r[14](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new zo({props:c}),oe.push(()=>Oe(s,"open",m,r[1])),{c(){G(e.$$.fragment),t=C(),G(n.$$.fragment),o=C(),G(s.$$.fragment)},m(f,d){z(e,f,d),S(f,t,d),z(n,f,d),S(f,o,d),z(s,f,d),l=!0},p(f,[d]){const b={};d&524348&&(b.$$scope={dirty:d,ctx:f}),e.$set(b);const g={};!i&&d&1&&(i=!0,g.open=f[0],Le(()=>i=!1)),n.$set(g);const y={};!a&&d&2&&(a=!0,y.open=f[1],Le(()=>a=!1)),s.$set(y)},i(f){l||(A(e.$$.fragment,f),A(n.$$.fragment,f),A(s.$$.fragment,f),l=!0)},o(f){T(e.$$.fragment,f),T(n.$$.fragment,f),T(s.$$.fragment,f),l=!1},d(f){H(e,f),f&&E(t),H(n,f),f&&E(o),H(s,f)}}}function bu(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var h=`https://atip.uk/route-snappers/${a}.bin`,m=`https://atip.uk/route-info/${a}.bin`;o||(h=`https://atip.uk/route-snappers-dev/${a}.bin`,m=`https://atip.uk/route-info-dev/${a}.bin`);let c;function f(){t(0,n=!n),t(1,i=!1)}function d(){t(1,i=!i),t(0,n=!1)}let b;Qn(async()=>{t(5,b=await g());const L=_i(new Ro);t(4,c=await new L),await c.loadFile(m)});async function g(){const R=await(await fetch(bo)).text(),$=JSON.parse(R);return $.features=$.features.filter(I=>{var N;return((N=I.properties)==null?void 0:N.name)==a}),$}function y(){let L=new URLSearchParams(window.location.search);L.set("schema",u);let R=`${window.location.pathname}?${L.toString()}${window.location.hash}`;window.location.href=R}const p=()=>window.open("index.html");function _(){u=ci(this),t(2,u)}function v(L){n=L,t(0,n)}function M(L){i=L,t(1,i)}return[n,i,u,h,c,b,a,l,f,d,y,p,_,v,M]}class yu extends te{constructor(e){super(),ne(this,e,bu,gu,ee,{})}}new yu({target:document.getElementById("app")});
