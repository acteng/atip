import{S as we,i as ye,s as ve,g as F,m as j,t as g,l as b,q as B,G as Y,a as x,e as G,u as S,f as O,h as U,j as k,k as $,x as q,p as C,B as Se,r as je,T as Be,d as Me,al as ie,aa as fe,y as te,n as re,am as Ae,z as Le,aA as Ne,E as Ie,b as ue,c as ce,F as Oe,o as me,Q as ze,R as Ee,v as pe,w as Pe}from"./maplibre_helpers-047865b5.js";import{C as ke,g as V,m as Ce,L as Te,Z as Ge,p as Je,S as _e,I as qe,B as De,q as Re,M as Ze}from"./ZoomOutMap-04d71e13.js";function He(s){let e={};for(let[t,r]of Object.entries(s.schemes))e[t]={scheme_reference:t,num_features:0,authority_or_region:r.authority_or_region,capital_scheme_id:r.capital_scheme_id,funding_programme:r.funding_programme};for(let t of s.features)e[t.properties.scheme_reference].num_features++,delete t.properties.id,delete t.properties.authority_or_region,delete t.properties.capital_scheme_id,delete t.properties.funding_programme,delete t.properties.valid,delete t.properties.centroid_lon,delete t.properties.centroid_lat;return Object.values(e)}function Qe(s){let e;return{c(){e=S("Show on map")},m(t,r){k(t,e,r)},d(t){t&&C(e)}}}function Ue(s){let e;return{c(){e=S("Edit scheme")},m(t,r){k(t,e,r)},d(t){t&&C(e)}}}function Ke(s){let e,t,r=s[0].authority_or_region+"",n,o,p,a,f=s[0].capital_scheme_id+"",l,_,z,N,i=s[0].funding_programme+"",m,M,A,I,D,E,T;return I=new x({props:{$$slots:{default:[Qe]},$$scope:{ctx:s}}}),I.$on("click",s[1]),E=new x({props:{$$slots:{default:[Ue]},$$scope:{ctx:s}}}),E.$on("click",s[2]),{c(){e=G("p"),t=S("Authority or region: "),n=S(r),o=O(),p=G("p"),a=S("Capital scheme ID: "),l=S(f),_=O(),z=G("p"),N=S("Funding programme: "),m=S(i),M=O(),A=G("div"),F(I.$$.fragment),D=O(),F(E.$$.fragment),U(A,"class","govuk-button-group")},m(d,y){k(d,e,y),$(e,t),$(e,n),k(d,o,y),k(d,p,y),$(p,a),$(p,l),k(d,_,y),k(d,z,y),$(z,N),$(z,m),k(d,M,y),k(d,A,y),j(I,A,null),$(A,D),j(E,A,null),T=!0},p(d,y){(!T||y&1)&&r!==(r=d[0].authority_or_region+"")&&q(n,r),(!T||y&1)&&f!==(f=d[0].capital_scheme_id+"")&&q(l,f),(!T||y&1)&&i!==(i=d[0].funding_programme+"")&&q(m,i);const c={};y&32&&(c.$$scope={dirty:y,ctx:d}),I.$set(c);const h={};y&32&&(h.$$scope={dirty:y,ctx:d}),E.$set(h)},i(d){T||(g(I.$$.fragment,d),g(E.$$.fragment,d),T=!0)},o(d){b(I.$$.fragment,d),b(E.$$.fragment,d),T=!1},d(d){d&&(C(e),C(o),C(p),C(_),C(z),C(M),C(A)),B(I),B(E)}}}function Ve(s){let e,t;return e=new ke({props:{label:`${s[0].scheme_reference}: ${s[0].num_features} features`,$$slots:{default:[Ke]},$$scope:{ctx:s}}}),{c(){F(e.$$.fragment)},m(r,n){j(e,r,n),t=!0},p(r,[n]){const o={};n&1&&(o.label=`${r[0].scheme_reference}: ${r[0].num_features} features`),n&33&&(o.$$scope={dirty:n,ctx:r}),e.$set(o)},i(r){t||(g(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function We(s,e,t){let r,n;Y(s,V,f=>t(3,r=f)),Y(s,Ce,f=>t(4,n=f));let{scheme:o}=e;function p(){let f={type:"FeatureCollection",features:r.features.filter(l=>l.properties.scheme_reference==o.scheme_reference)};n==null||n.fitBounds(Se(f),{padding:20,animate:!1})}function a(){let f={type:"FeatureCollection",features:r.features.filter(_=>_.properties.scheme_reference==o.scheme_reference)},l=o.authority_or_region;window.localStorage.setItem(l,JSON.stringify(f)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return s.$$set=f=>{"scheme"in f&&t(0,o=f.scheme)},[o,p,a]}class Xe extends we{constructor(e){super(),ye(this,e,We,Ve,ve,{scheme:0})}}function $e(s,e,t){const r=s.slice();return r[20]=e[t],r}function Ye(s){let e;return{c(){e=S("Home")},m(t,r){k(t,e,r)},d(t){t&&C(e)}}}function ge(s){let e,t;return e=new Ie({props:{errorMessage:s[7]}}),{c(){F(e.$$.fragment)},m(r,n){j(e,r,n),t=!0},p(r,n){const o={};n&128&&(o.errorMessage=r[7]),e.$set(o)},i(r){t||(g(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function xe(s){let e;return{c(){e=S("Clear")},m(t,r){k(t,e,r)},d(t){t&&C(e)}}}function et(s){let e,t,r,n,o,p;return r=new x({props:{$$slots:{default:[xe]},$$scope:{ctx:s}}}),r.$on("click",s[17]),{c(){e=G("input"),t=O(),F(r.$$.fragment),U(e,"type","text"),U(e,"class","govuk-input govuk-input--width-10"),U(e,"id","filterText")},m(a,f){k(a,e,f),pe(e,s[1]),k(a,t,f),j(r,a,f),n=!0,o||(p=Pe(e,"input",s[16]),o=!0)},p(a,f){f&2&&e.value!==a[1]&&pe(e,a[1]);const l={};f&8388608&&(l.$$scope={dirty:f,ctx:a}),r.$set(l)},i(a){n||(g(r.$$.fragment,a),n=!0)},o(a){b(r.$$.fragment,a),n=!1},d(a){a&&(C(e),C(t)),B(r,a),o=!1,p()}}}function tt(s){let e,t,r,n,o,p,a,f;function l(i){s[14](i)}let _={label:"Authority or region",id:"filterAuthority",choices:s[8]};s[4]!==void 0&&(_.value=s[4]),e=new _e({props:_}),ue.push(()=>ce(e,"value",l));function z(i){s[15](i)}let N={label:"Funding programme",id:"filterFundingProgramme",choices:s[9]};return s[5]!==void 0&&(N.value=s[5]),n=new _e({props:N}),ue.push(()=>ce(n,"value",z)),a=new Oe({props:{label:"Any field",id:"filterText",$$slots:{default:[et]},$$scope:{ctx:s}}}),{c(){F(e.$$.fragment),r=O(),F(n.$$.fragment),p=O(),F(a.$$.fragment)},m(i,m){j(e,i,m),k(i,r,m),j(n,i,m),k(i,p,m),j(a,i,m),f=!0},p(i,m){const M={};m&256&&(M.choices=i[8]),!t&&m&16&&(t=!0,M.value=i[4],me(()=>t=!1)),e.$set(M);const A={};m&512&&(A.choices=i[9]),!o&&m&32&&(o=!0,A.value=i[5],me(()=>o=!1)),n.$set(A);const I={};m&8388610&&(I.$$scope={dirty:m,ctx:i}),a.$set(I)},i(i){f||(g(e.$$.fragment,i),g(n.$$.fragment,i),g(a.$$.fragment,i),f=!0)},o(i){b(e.$$.fragment,i),b(n.$$.fragment,i),b(a.$$.fragment,i),f=!1},d(i){i&&(C(r),C(p)),B(e,i),B(n,i),B(a,i)}}}function de(s){let e,t;return e=new Xe({props:{scheme:s[20]}}),{c(){F(e.$$.fragment)},m(r,n){j(e,r,n),t=!0},p(r,n){const o={};n&1&&(o.scheme=r[20]),e.$set(o)},i(r){t||(g(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}function he(s){let e=s[2].has(s[20].scheme_reference),t,r,n=e&&de(s);return{c(){n&&n.c(),t=ze()},m(o,p){n&&n.m(o,p),k(o,t,p),r=!0},p(o,p){p&5&&(e=o[2].has(o[20].scheme_reference)),e?n?(n.p(o,p),p&5&&g(n,1)):(n=de(o),n.c(),g(n,1),n.m(t.parentNode,t)):n&&(te(),b(n,1,1,()=>{n=null}),re())},i(o){r||(g(n),r=!0)},o(o){b(n),r=!1},d(o){o&&C(t),n&&n.d(o)}}}function rt(s){let e,t,r,n,o,p,a,f,l,_,z,N,i,m,M,A=s[2].size+"",I,D,E=s[3].route+"",T,d,y=s[3].area+"",c,h,R=s[3].crossing+"",K,Z,W=s[3].other+"",ee,ne,se,X,J;t=new x({props:{$$slots:{default:[Ye]},$$scope:{ctx:s}}}),t.$on("click",s[13]),a=new Ge({props:{boundaryGeojson:s[6]}});let L=s[7]&&ge(s);_=new Me({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:s[11]}}),N=new ke({props:{label:"Filters",$$slots:{default:[tt]},$$scope:{ctx:s}}});let H=ie(s[0]),v=[];for(let u=0;u<H.length;u+=1)v[u]=he($e(s,H,u));const Fe=u=>b(v[u],1,1,()=>{v[u]=null});return{c(){e=G("div"),F(t.$$.fragment),r=O(),n=G("div"),o=G("h1"),o.textContent="Browse schemes",p=O(),F(a.$$.fragment),f=O(),L&&L.c(),l=O(),F(_.$$.fragment),z=O(),F(N.$$.fragment),i=O(),m=G("p"),M=S("Showing "),I=S(A),D=S(" schemes ("),T=S(E),d=S(" routes, "),c=S(y),h=S(` areas,
      `),K=S(R),Z=S(" crossings, "),ee=S(W),ne=S(" other)"),se=O(),X=G("ul");for(let u=0;u<v.length;u+=1)v[u].c();fe(n,"display","flex"),fe(n,"justify-content","space-between"),U(e,"slot","sidebar"),U(e,"class","govuk-prose")},m(u,w){k(u,e,w),j(t,e,null),$(e,r),$(e,n),$(n,o),$(n,p),j(a,n,null),$(e,f),L&&L.m(e,null),$(e,l),j(_,e,null),$(e,z),j(N,e,null),$(e,i),$(e,m),$(m,M),$(m,I),$(m,D),$(m,T),$(m,d),$(m,c),$(m,h),$(m,K),$(m,Z),$(m,ee),$(m,ne),$(e,se),$(e,X);for(let Q=0;Q<v.length;Q+=1)v[Q]&&v[Q].m(X,null);J=!0},p(u,w){const Q={};w&8388608&&(Q.$$scope={dirty:w,ctx:u}),t.$set(Q);const oe={};w&64&&(oe.boundaryGeojson=u[6]),a.$set(oe),u[7]?L?(L.p(u,w),w&128&&g(L,1)):(L=ge(u),L.c(),g(L,1),L.m(e,l)):L&&(te(),b(L,1,1,()=>{L=null}),re());const le={};if(w&8389426&&(le.$$scope={dirty:w,ctx:u}),N.$set(le),(!J||w&4)&&A!==(A=u[2].size+"")&&q(I,A),(!J||w&8)&&E!==(E=u[3].route+"")&&q(T,E),(!J||w&8)&&y!==(y=u[3].area+"")&&q(c,y),(!J||w&8)&&R!==(R=u[3].crossing+"")&&q(K,R),(!J||w&8)&&W!==(W=u[3].other+"")&&q(ee,W),w&5){H=ie(u[0]);let P;for(P=0;P<H.length;P+=1){const ae=$e(u,H,P);v[P]?(v[P].p(ae,w),g(v[P],1)):(v[P]=he(ae),v[P].c(),g(v[P],1),v[P].m(X,null))}for(te(),P=H.length;P<v.length;P+=1)Fe(P);re()}},i(u){if(!J){g(t.$$.fragment,u),g(a.$$.fragment,u),g(L),g(_.$$.fragment,u),g(N.$$.fragment,u);for(let w=0;w<H.length;w+=1)g(v[w]);J=!0}},o(u){b(t.$$.fragment,u),b(a.$$.fragment,u),b(L),b(_.$$.fragment,u),b(N.$$.fragment,u),v=v.filter(Boolean);for(let w=0;w<v.length;w+=1)b(v[w]);J=!1},d(u){u&&C(e),B(t),B(a),L&&L.d(),B(_),B(N),Ae(v,u)}}}function nt(s){let e,t,r,n,o,p,a,f;return e=new qe({props:{schema:be}}),r=new De({props:{style:s[10]}}),o=new Re({props:{schema:be}}),a=new Ze({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:s[12]}}),{c(){F(e.$$.fragment),t=O(),F(r.$$.fragment),n=O(),F(o.$$.fragment),p=O(),F(a.$$.fragment)},m(l,_){j(e,l,_),k(l,t,_),j(r,l,_),k(l,n,_),j(o,l,_),k(l,p,_),j(a,l,_),f=!0},p:Ee,i(l){f||(g(e.$$.fragment,l),g(r.$$.fragment,l),g(o.$$.fragment,l),g(a.$$.fragment,l),f=!0)},o(l){b(e.$$.fragment,l),b(r.$$.fragment,l),b(o.$$.fragment,l),b(a.$$.fragment,l),f=!1},d(l){l&&(C(t),C(n),C(p)),B(e,l),B(r,l),B(o,l),B(a,l)}}}function st(s){let e,t,r;return t=new Je({props:{style:s[10],$$slots:{default:[nt]},$$scope:{ctx:s}}}),{c(){e=G("div"),F(t.$$.fragment),U(e,"slot","main")},m(n,o){k(n,e,o),j(t,e,null),r=!0},p(n,o){const p={};o&8388608&&(p.$$scope={dirty:o,ctx:n}),t.$set(p)},i(n){r||(g(t.$$.fragment,n),r=!0)},o(n){b(t.$$.fragment,n),r=!1},d(n){n&&C(e),B(t)}}}function ot(s){let e,t;return e=new Te({props:{$$slots:{main:[st],sidebar:[rt]},$$scope:{ctx:s}}}),{c(){F(e.$$.fragment)},m(r,n){j(e,r,n),t=!0},p(r,[n]){const o={};n&8389631&&(o.$$scope={dirty:n,ctx:r}),e.$set(o)},i(r){t||(g(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){B(e,r)}}}const be="v1";function lt(s,e,t){let r,n;Y(s,Ce,c=>t(18,r=c)),Y(s,V,c=>t(6,n=c)),je(()=>{Le()});let p=new URLSearchParams(window.location.search).get("style")||"streets",a="",f=[],l="",_=new Set,z={area:0,route:0,crossing:0,other:0},N=[],i="",m=[],M="";Be(()=>{V.set(null)});function A(c){try{let h=JSON.parse(c);t(0,f=He(h)),V.set(h),t(7,a="");let R=new Set,K=new Set;for(let Z of f)Z.authority_or_region&&R.add(Z.authority_or_region),Z.funding_programme&&K.add(Z.funding_programme);t(8,N=Array.from(R.entries())),N.sort(),t(9,m=Array.from(K.entries())),m.sort(),r==null||r.fitBounds(Se(h),{padding:20,animate:!1})}catch(h){t(7,a=`Couldn't load schemes from a file: ${h}`)}}function I(c){var h='<div class="govuk-prose" style="max-width: 30vw;">';return h+=`<h2>${c.name} (${c.intervention_type})</h2>`,h+=`<p>Scheme reference: ${c.scheme_reference}</p>`,c.length_meters&&(h+=`<p>Length: ${Ne(c.length_meters)}</p>`),c.description&&(h+=`<p>${c.description}</p>`),h}const D=()=>window.open("index.html");function E(c){i=c,t(4,i)}function T(c){M=c,t(5,M)}function d(){l=this.value,t(1,l)}const y=()=>t(1,l="");return s.$$.update=()=>{if(s.$$.dirty&127&&n){if(_.clear(),l||i||M){let c=l.toLowerCase();for(let h of n.features)JSON.stringify(h.properties).toLowerCase().includes(c)&&(i&&h.properties.authority_or_region!=i||M&&h.properties.funding_programme!=M||_.add(h.properties.scheme_reference))}else for(let c of f)_.add(c.scheme_reference);V.update(c=>{if(!c)return null;for(let h of c.features)_.has(h.properties.scheme_reference)?delete h.properties.hide_while_editing:h.properties.hide_while_editing=!0;return c}),t(3,z={area:0,route:0,crossing:0,other:0});for(let c of n==null?void 0:n.features)_.has(c.properties.scheme_reference)&&t(3,z[c.properties.intervention_type]++,z);t(2,_),t(6,n),t(1,l),t(4,i),t(5,M),t(0,f),t(3,z)}},[f,l,_,z,i,M,n,a,N,m,p,A,I,D,E,T,d,y]}class at extends we{constructor(e){super(),ye(this,e,lt,ot,ve,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new at({target:document.getElementById("app")});
