import{S as H,i as Q,s as K,g as F,f as O,e as A,u as M,m as B,j as k,k as S,x as E,t as b,l as v,p as j,q as L,G as J,r as le,b as R,c as U,F as ue,o as Z,a as D,h as T,v as W,w as ce,B as ie,T as me,d as pe,al as X,aa as Y,y as q,n as P,am as _e,z as $e,aA as ge,E as he,Q as de,R as we}from"./maplibre_helpers-047865b5.js";import{C as ae,g as G,S as x,m as fe,L as be,Z as ve,p as Se,I as ye,B as ke,q as je,M as Ce}from"./ZoomOutMap-04d71e13.js";function Me(r){let e=new Map;for(let[s,t]of Object.entries(r.schemes))e.set(s,{scheme_reference:s,num_features:0,authority_or_region:t.authority_or_region,capital_scheme_id:t.capital_scheme_id,funding_programme:t.funding_programme});for(let s of r.features)e.get(s.properties.scheme_reference).num_features++,delete s.properties.id,delete s.properties.authority_or_region,delete s.properties.capital_scheme_id,delete s.properties.funding_programme,delete s.properties.valid,delete s.properties.centroid_lon,delete s.properties.centroid_lat;return e}function Fe(r){let e;return{c(){e=M("Clear")},m(s,t){k(s,e,t)},d(s){s&&j(e)}}}function Be(r){let e,s,t,n,o,a;return t=new D({props:{$$slots:{default:[Fe]},$$scope:{ctx:r}}}),t.$on("click",r[11]),{c(){e=A("input"),s=O(),F(t.$$.fragment),T(e,"type","text"),T(e,"class","govuk-input govuk-input--width-10"),T(e,"id","filterText")},m(i,u){k(i,e,u),W(e,r[1]),k(i,s,u),B(t,i,u),n=!0,o||(a=ce(e,"input",r[10]),o=!0)},p(i,u){u&2&&e.value!==i[1]&&W(e,i[1]);const c={};u&16384&&(c.$$scope={dirty:u,ctx:i}),t.$set(c)},i(i){n||(b(t.$$.fragment,i),n=!0)},o(i){v(t.$$.fragment,i),n=!1},d(i){i&&(j(e),j(s)),L(t,i),o=!1,a()}}}function Le(r){let e,s,t,n,o,a,i,u;function c(m){r[8](m)}let w={label:"Authority or region",id:"filterAuthority",choices:r[4],emptyOption:!0};r[2]!==void 0&&(w.value=r[2]),e=new x({props:w}),R.push(()=>U(e,"value",c));function y(m){r[9](m)}let z={label:"Funding programme",id:"filterFundingProgramme",choices:r[5],emptyOption:!0};return r[3]!==void 0&&(z.value=r[3]),n=new x({props:z}),R.push(()=>U(n,"value",y)),i=new ue({props:{label:"Any field",id:"filterText",$$slots:{default:[Be]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),t=O(),F(n.$$.fragment),a=O(),F(i.$$.fragment)},m(m,p){B(e,m,p),k(m,t,p),B(n,m,p),k(m,a,p),B(i,m,p),u=!0},p(m,p){const _={};p&16&&(_.choices=m[4]),!s&&p&4&&(s=!0,_.value=m[2],Z(()=>s=!1)),e.$set(_);const d={};p&32&&(d.choices=m[5]),!o&&p&8&&(o=!0,d.value=m[3],Z(()=>o=!1)),n.$set(d);const g={};p&16386&&(g.$$scope={dirty:p,ctx:m}),i.$set(g)},i(m){u||(b(e.$$.fragment,m),b(n.$$.fragment,m),b(i.$$.fragment,m),u=!0)},o(m){v(e.$$.fragment,m),v(n.$$.fragment,m),v(i.$$.fragment,m),u=!1},d(m){m&&(j(t),j(a)),L(e,m),L(n,m),L(i,m)}}}function Ne(r){let e,s,t,n,o=r[0].size+"",a,i,u=r[6].route+"",c,w,y=r[6].area+"",z,m,p=r[6].crossing+"",_,d,g=r[6].other+"",h,C,f;return e=new ae({props:{label:"Filters",$$slots:{default:[Le]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment),s=O(),t=A("p"),n=M("Showing "),a=M(o),i=M(" schemes ("),c=M(u),w=M(" routes, "),z=M(y),m=M(` areas,
  `),_=M(p),d=M(" crossings, "),h=M(g),C=M(" other)")},m(l,$){B(e,l,$),k(l,s,$),k(l,t,$),S(t,n),S(t,a),S(t,i),S(t,c),S(t,w),S(t,z),S(t,m),S(t,_),S(t,d),S(t,h),S(t,C),f=!0},p(l,[$]){const I={};$&16446&&(I.$$scope={dirty:$,ctx:l}),e.$set(I),(!f||$&1)&&o!==(o=l[0].size+"")&&E(a,o),(!f||$&64)&&u!==(u=l[6].route+"")&&E(c,u),(!f||$&64)&&y!==(y=l[6].area+"")&&E(z,y),(!f||$&64)&&p!==(p=l[6].crossing+"")&&E(_,p),(!f||$&64)&&g!==(g=l[6].other+"")&&E(h,g)},i(l){f||(b(e.$$.fragment,l),f=!0)},o(l){v(e.$$.fragment,l),f=!1},d(l){l&&(j(s),j(t)),L(e,l)}}}function ze(r,e,s){let t;J(r,G,g=>s(12,t=g));let{schemes:n}=e,{showSchemes:o=new Set}=e,a="",i=[],u="",c=[],w="",y={area:0,route:0,crossing:0,other:0};le(()=>{let g=new Set,h=new Set;for(let C of n.values())C.authority_or_region&&g.add(C.authority_or_region),C.funding_programme&&h.add(C.funding_programme);s(4,i=Array.from(g.entries())),i.sort(),s(5,c=Array.from(h.entries())),c.sort()});function z(g,h,C){o.clear();let f=g.toLowerCase();for(let l of t.features)if(!(f&&!JSON.stringify(l.properties).toLowerCase().includes(f))){if(h||C){let $=n.get(l.properties.scheme_reference);if(h&&$.authority_or_region!=h||C&&$.funding_programme!=C)continue}o.add(l.properties.scheme_reference)}s(0,o),s(6,y={area:0,route:0,crossing:0,other:0}),G.update(l=>{for(let $ of l.features)o.has($.properties.scheme_reference)?(delete $.properties.hide_while_editing,s(6,y[$.properties.intervention_type]++,y)):$.properties.hide_while_editing=!0;return l}),s(6,y)}function m(g){u=g,s(2,u)}function p(g){w=g,s(3,w)}function _(){a=this.value,s(1,a)}const d=()=>s(1,a="");return r.$$set=g=>{"schemes"in g&&s(7,n=g.schemes),"showSchemes"in g&&s(0,o=g.showSchemes)},r.$$.update=()=>{r.$$.dirty&14&&z(a,u,w)},[o,a,u,w,i,c,y,n,m,p,_,d]}class Oe extends H{constructor(e){super(),Q(this,e,ze,Ne,K,{schemes:7,showSchemes:0})}}function Ae(r){let e;return{c(){e=M("Show on map")},m(s,t){k(s,e,t)},d(s){s&&j(e)}}}function Ie(r){let e;return{c(){e=M("Edit scheme")},m(s,t){k(s,e,t)},d(s){s&&j(e)}}}function Ee(r){let e,s,t=r[0].authority_or_region+"",n,o,a,i,u=r[0].capital_scheme_id+"",c,w,y,z,m=r[0].funding_programme+"",p,_,d,g,h,C,f;return g=new D({props:{$$slots:{default:[Ae]},$$scope:{ctx:r}}}),g.$on("click",r[1]),C=new D({props:{$$slots:{default:[Ie]},$$scope:{ctx:r}}}),C.$on("click",r[2]),{c(){e=A("p"),s=M("Authority or region: "),n=M(t),o=O(),a=A("p"),i=M("Capital scheme ID: "),c=M(u),w=O(),y=A("p"),z=M("Funding programme: "),p=M(m),_=O(),d=A("div"),F(g.$$.fragment),h=O(),F(C.$$.fragment),T(d,"class","govuk-button-group")},m(l,$){k(l,e,$),S(e,s),S(e,n),k(l,o,$),k(l,a,$),S(a,i),S(a,c),k(l,w,$),k(l,y,$),S(y,z),S(y,p),k(l,_,$),k(l,d,$),B(g,d,null),S(d,h),B(C,d,null),f=!0},p(l,$){(!f||$&1)&&t!==(t=l[0].authority_or_region+"")&&E(n,t),(!f||$&1)&&u!==(u=l[0].capital_scheme_id+"")&&E(c,u),(!f||$&1)&&m!==(m=l[0].funding_programme+"")&&E(p,m);const I={};$&32&&(I.$$scope={dirty:$,ctx:l}),g.$set(I);const N={};$&32&&(N.$$scope={dirty:$,ctx:l}),C.$set(N)},i(l){f||(b(g.$$.fragment,l),b(C.$$.fragment,l),f=!0)},o(l){v(g.$$.fragment,l),v(C.$$.fragment,l),f=!1},d(l){l&&(j(e),j(o),j(a),j(w),j(y),j(_),j(d)),L(g),L(C)}}}function Te(r){let e,s;return e=new ae({props:{label:`${r[0].scheme_reference}: ${r[0].num_features} features`,$$slots:{default:[Ee]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,n){B(e,t,n),s=!0},p(t,[n]){const o={};n&1&&(o.label=`${t[0].scheme_reference}: ${t[0].num_features} features`),n&33&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){v(e.$$.fragment,t),s=!1},d(t){L(e,t)}}}function Ge(r,e,s){let t,n;J(r,G,u=>s(3,t=u)),J(r,fe,u=>s(4,n=u));let{scheme:o}=e;function a(){let u={type:"FeatureCollection",features:t.features.filter(c=>c.properties.scheme_reference==o.scheme_reference)};n==null||n.fitBounds(ie(u),{padding:20,animate:!1})}function i(){let u={type:"FeatureCollection",features:t.features.filter(w=>w.properties.scheme_reference==o.scheme_reference)},c=o.authority_or_region;window.localStorage.setItem(c,JSON.stringify(u)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return r.$$set=u=>{"scheme"in u&&s(0,o=u.scheme)},[o,a,i]}class Je extends H{constructor(e){super(),Q(this,e,Ge,Te,K,{scheme:0})}}function ee(r,e,s){const t=r.slice();return t[11]=e[s],t}function qe(r){let e;return{c(){e=M("Home")},m(s,t){k(s,e,t)},d(s){s&&j(e)}}}function te(r){let e,s;return e=new he({props:{errorMessage:r[0]}}),{c(){F(e.$$.fragment)},m(t,n){B(e,t,n),s=!0},p(t,n){const o={};n&1&&(o.errorMessage=t[0]),e.$set(o)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){v(e.$$.fragment,t),s=!1},d(t){L(e,t)}}}function se(r){let e,s,t;function n(a){r[8](a)}let o={schemes:r[1]};return r[2]!==void 0&&(o.showSchemes=r[2]),e=new Oe({props:o}),R.push(()=>U(e,"showSchemes",n)),{c(){F(e.$$.fragment)},m(a,i){B(e,a,i),t=!0},p(a,i){const u={};i&2&&(u.schemes=a[1]),!s&&i&4&&(s=!0,u.showSchemes=a[2],Z(()=>s=!1)),e.$set(u)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){v(e.$$.fragment,a),t=!1},d(a){L(e,a)}}}function ne(r){let e,s;return e=new Je({props:{scheme:r[11]}}),{c(){F(e.$$.fragment)},m(t,n){B(e,t,n),s=!0},p(t,n){const o={};n&2&&(o.scheme=t[11]),e.$set(o)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){v(e.$$.fragment,t),s=!1},d(t){L(e,t)}}}function re(r){let e=r[2].has(r[11].scheme_reference),s,t,n=e&&ne(r);return{c(){n&&n.c(),s=de()},m(o,a){n&&n.m(o,a),k(o,s,a),t=!0},p(o,a){a&6&&(e=o[2].has(o[11].scheme_reference)),e?n?(n.p(o,a),a&6&&b(n,1)):(n=ne(o),n.c(),b(n,1),n.m(s.parentNode,s)):n&&(q(),v(n,1,1,()=>{n=null}),P())},i(o){t||(b(n),t=!0)},o(o){v(n),t=!1},d(o){o&&j(s),n&&n.d(o)}}}function Pe(r){let e,s,t,n,o,a,i,u,c,w,y,z,m,p;s=new D({props:{$$slots:{default:[qe]},$$scope:{ctx:r}}}),s.$on("click",r[7]),i=new ve({props:{boundaryGeojson:r[3]}});let _=r[0]&&te(r);w=new pe({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:r[5]}});let d=r[1].size>0&&se(r),g=X(r[1].values()),h=[];for(let f=0;f<g.length;f+=1)h[f]=re(ee(r,g,f));const C=f=>v(h[f],1,1,()=>{h[f]=null});return{c(){e=A("div"),F(s.$$.fragment),t=O(),n=A("div"),o=A("h1"),o.textContent="Browse schemes",a=O(),F(i.$$.fragment),u=O(),_&&_.c(),c=O(),F(w.$$.fragment),y=O(),d&&d.c(),z=O(),m=A("ul");for(let f=0;f<h.length;f+=1)h[f].c();Y(n,"display","flex"),Y(n,"justify-content","space-between"),T(e,"slot","sidebar"),T(e,"class","govuk-prose")},m(f,l){k(f,e,l),B(s,e,null),S(e,t),S(e,n),S(n,o),S(n,a),B(i,n,null),S(e,u),_&&_.m(e,null),S(e,c),B(w,e,null),S(e,y),d&&d.m(e,null),S(e,z),S(e,m);for(let $=0;$<h.length;$+=1)h[$]&&h[$].m(m,null);p=!0},p(f,l){const $={};l&16384&&($.$$scope={dirty:l,ctx:f}),s.$set($);const I={};if(l&8&&(I.boundaryGeojson=f[3]),i.$set(I),f[0]?_?(_.p(f,l),l&1&&b(_,1)):(_=te(f),_.c(),b(_,1),_.m(e,c)):_&&(q(),v(_,1,1,()=>{_=null}),P()),f[1].size>0?d?(d.p(f,l),l&2&&b(d,1)):(d=se(f),d.c(),b(d,1),d.m(e,z)):d&&(q(),v(d,1,1,()=>{d=null}),P()),l&6){g=X(f[1].values());let N;for(N=0;N<g.length;N+=1){const V=ee(f,g,N);h[N]?(h[N].p(V,l),b(h[N],1)):(h[N]=re(V),h[N].c(),b(h[N],1),h[N].m(m,null))}for(q(),N=g.length;N<h.length;N+=1)C(N);P()}},i(f){if(!p){b(s.$$.fragment,f),b(i.$$.fragment,f),b(_),b(w.$$.fragment,f),b(d);for(let l=0;l<g.length;l+=1)b(h[l]);p=!0}},o(f){v(s.$$.fragment,f),v(i.$$.fragment,f),v(_),v(w.$$.fragment,f),v(d),h=h.filter(Boolean);for(let l=0;l<h.length;l+=1)v(h[l]);p=!1},d(f){f&&j(e),L(s),L(i),_&&_.d(),L(w),d&&d.d(),_e(h,f)}}}function De(r){let e,s,t,n,o,a,i,u;return e=new ye({props:{schema:oe}}),t=new ke({props:{style:r[4]}}),o=new je({props:{schema:oe}}),i=new Ce({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:r[6]}}),{c(){F(e.$$.fragment),s=O(),F(t.$$.fragment),n=O(),F(o.$$.fragment),a=O(),F(i.$$.fragment)},m(c,w){B(e,c,w),k(c,s,w),B(t,c,w),k(c,n,w),B(o,c,w),k(c,a,w),B(i,c,w),u=!0},p:we,i(c){u||(b(e.$$.fragment,c),b(t.$$.fragment,c),b(o.$$.fragment,c),b(i.$$.fragment,c),u=!0)},o(c){v(e.$$.fragment,c),v(t.$$.fragment,c),v(o.$$.fragment,c),v(i.$$.fragment,c),u=!1},d(c){c&&(j(s),j(n),j(a)),L(e,c),L(t,c),L(o,c),L(i,c)}}}function Re(r){let e,s,t;return s=new Se({props:{style:r[4],$$slots:{default:[De]},$$scope:{ctx:r}}}),{c(){e=A("div"),F(s.$$.fragment),T(e,"slot","main")},m(n,o){k(n,e,o),B(s,e,null),t=!0},p(n,o){const a={};o&16384&&(a.$$scope={dirty:o,ctx:n}),s.$set(a)},i(n){t||(b(s.$$.fragment,n),t=!0)},o(n){v(s.$$.fragment,n),t=!1},d(n){n&&j(e),L(s)}}}function Ue(r){let e,s;return e=new be({props:{$$slots:{main:[Re],sidebar:[Pe]},$$scope:{ctx:r}}}),{c(){F(e.$$.fragment)},m(t,n){B(e,t,n),s=!0},p(t,[n]){const o={};n&16399&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){v(e.$$.fragment,t),s=!1},d(t){L(e,t)}}}const oe="v1";function Ze(r,e,s){let t,n;J(r,fe,p=>s(9,t=p)),J(r,G,p=>s(3,n=p)),le(()=>{$e()});let a=new URLSearchParams(window.location.search).get("style")||"streets",i="",u=new Map,c=new Set;me(()=>{G.set(null)});function w(p){try{let _=JSON.parse(p);s(1,u=Me(_)),G.set(_),s(0,i=""),t==null||t.fitBounds(ie(_),{padding:20,animate:!1})}catch(_){s(0,i=`Couldn't load schemes from a file: ${_}`)}}function y(p){var _='<div class="govuk-prose" style="max-width: 30vw;">';return _+=`<h2>${p.name} (${p.intervention_type})</h2>`,_+=`<p>Scheme reference: ${p.scheme_reference}</p>`,p.length_meters&&(_+=`<p>Length: ${ge(p.length_meters)}</p>`),p.description&&(_+=`<p>${p.description}</p>`),_}const z=()=>window.open("index.html");function m(p){c=p,s(2,c)}return[i,u,c,n,a,w,y,z,m]}class He extends H{constructor(e){super(),Q(this,e,Ze,Ue,K,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new He({target:document.getElementById("app")});
