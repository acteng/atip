import{S as G,i as J,s as W,g as D,f as z,e as V,u as B,m as M,j as k,k as C,x,t as y,l as b,p as U,q as E,X as ne,a0 as re,r as Le,b as ue,c as ce,F as wt,o as he,a as pe,h as q,v as Pe,w as bt,Y as ke,aW as Tt,$ as St,Q as Ye,C as Qe,aX as Ie,ae as et,d as Lt,T as je,y as ae,n as le,z as kt,A as Ut,a7 as Dt,aO as Mt,E as Et,P as Ve,R as Ct,ab as Bt}from"./data_getter-312a85bb.js";import{C as Ue,S as Ze,d as zt,M as tt,g as At,L as Nt,Z as Ot,e as Pt,I as It,f as jt,B as Vt,b as Zt}from"./Map-0538b554.js";function Ht(t){let e=new Map;for(let[r,n]of Object.entries(t.schemes))e.set(r,{scheme_reference:r,num_features:0,authority_or_region:n.authority_or_region,capital_scheme_id:n.capital_scheme_id,funding_programme:n.funding_programme});for(let r of t.features)e.get(r.properties.scheme_reference).num_features++,delete r.properties.id,delete r.properties.authority_or_region,delete r.properties.capital_scheme_id,delete r.properties.funding_programme,delete r.properties.valid,delete r.properties.centroid_lon,delete r.properties.centroid_lat;return e}function Ft(t){let e;return{c(){e=B("Clear")},m(r,n){k(r,e,n)},d(r){r&&U(e)}}}function Kt(t){let e,r,n,s,o,i;return n=new pe({props:{$$slots:{default:[Ft]},$$scope:{ctx:t}}}),n.$on("click",t[11]),{c(){e=V("input"),r=z(),D(n.$$.fragment),q(e,"type","text"),q(e,"class","govuk-input govuk-input--width-10"),q(e,"id","filterText")},m(l,a){k(l,e,a),Pe(e,t[0]),k(l,r,a),M(n,l,a),s=!0,o||(i=bt(e,"input",t[10]),o=!0)},p(l,a){a&1&&e.value!==l[0]&&Pe(e,l[0]);const c={};a&16384&&(c.$$scope={dirty:a,ctx:l}),n.$set(c)},i(l){s||(y(n.$$.fragment,l),s=!0)},o(l){b(n.$$.fragment,l),s=!1},d(l){l&&(U(e),U(r)),E(n,l),o=!1,i()}}}function Rt(t){let e,r,n,s,o,i,l,a;function c(m){t[8](m)}let f={label:"Authority or region",id:"filterAuthority",choices:t[4],emptyOption:!0};t[2]!==void 0&&(f.value=t[2]),e=new Ze({props:f}),ue.push(()=>ce(e,"value",c));function u(m){t[9](m)}let p={label:"Funding programme",id:"filterFundingProgramme",choices:t[5],emptyOption:!0};return t[3]!==void 0&&(p.value=t[3]),s=new Ze({props:p}),ue.push(()=>ce(s,"value",u)),l=new wt({props:{label:"Intervention name or description",id:"filterText",$$slots:{default:[Kt]},$$scope:{ctx:t}}}),{c(){D(e.$$.fragment),n=z(),D(s.$$.fragment),i=z(),D(l.$$.fragment)},m(m,d){M(e,m,d),k(m,n,d),M(s,m,d),k(m,i,d),M(l,m,d),a=!0},p(m,d){const _={};d&16&&(_.choices=m[4]),!r&&d&4&&(r=!0,_.value=m[2],he(()=>r=!1)),e.$set(_);const $={};d&32&&($.choices=m[5]),!o&&d&8&&(o=!0,$.value=m[3],he(()=>o=!1)),s.$set($);const g={};d&16385&&(g.$$scope={dirty:d,ctx:m}),l.$set(g)},i(m){a||(y(e.$$.fragment,m),y(s.$$.fragment,m),y(l.$$.fragment,m),a=!0)},o(m){b(e.$$.fragment,m),b(s.$$.fragment,m),b(l.$$.fragment,m),a=!1},d(m){m&&(U(n),U(i)),E(e,m),E(s,m),E(l,m)}}}function xt(t){let e,r,n,s,o=t[1].size+"",i,l,a=t[6].route+"",c,f,u=t[6].area+"",p,m,d=t[6].crossing+"",_,$,g=t[6].other+"",h,w,S;return e=new Ue({props:{label:"Filters",$$slots:{default:[Rt]},$$scope:{ctx:t}}}),{c(){D(e.$$.fragment),r=z(),n=V("p"),s=B("Showing "),i=B(o),l=B(" schemes ("),c=B(a),f=B(" routes, "),p=B(u),m=B(` areas,
  `),_=B(d),$=B(" crossings, "),h=B(g),w=B(" other)")},m(v,T){M(e,v,T),k(v,r,T),k(v,n,T),C(n,s),C(n,i),C(n,l),C(n,c),C(n,f),C(n,p),C(n,m),C(n,_),C(n,$),C(n,h),C(n,w),S=!0},p(v,[T]){const A={};T&16445&&(A.$$scope={dirty:T,ctx:v}),e.$set(A),(!S||T&2)&&o!==(o=v[1].size+"")&&x(i,o),(!S||T&64)&&a!==(a=v[6].route+"")&&x(c,a),(!S||T&64)&&u!==(u=v[6].area+"")&&x(p,u),(!S||T&64)&&d!==(d=v[6].crossing+"")&&x(_,d),(!S||T&64)&&g!==(g=v[6].other+"")&&x(h,g)},i(v){S||(y(e.$$.fragment,v),S=!0)},o(v){b(e.$$.fragment,v),S=!1},d(v){v&&(U(r),U(n)),E(e,v)}}}function qt(t,e,r){let n;ne(t,re,g=>r(12,n=g));let{schemes:s}=e,{schemesToBeShown:o=new Set}=e,{filterText:i=""}=e,l=[],a="",c=[],f="",u={area:0,route:0,crossing:0,other:0};Le(()=>{let g=new Set,h=new Set;for(let w of s.values())w.authority_or_region&&g.add(w.authority_or_region),w.funding_programme&&h.add(w.funding_programme);r(4,l=Array.from(g.entries())),l.sort(),r(5,c=Array.from(h.entries())),c.sort()});function p(g,h,w){let S=g.toLowerCase(),v=A=>{var N,K;if(S&&!((N=A.properties.name)!=null&&N.toLowerCase().includes(S))&&!((K=A.properties.description)!=null&&K.toLowerCase().includes(S)))return!1;if(h||w){let O=s.get(A.properties.scheme_reference);if(h&&O.authority_or_region!=h||w&&O.funding_programme!=w)return!1}return!0};r(1,o=new Set(n.features.filter(v).map(A=>A.properties.scheme_reference))),r(6,u={area:0,route:0,crossing:0,other:0});let T=A=>{var N,K;return!(!o.has(A.properties.scheme_reference)||S&&!((N=A.properties.name)!=null&&N.toLowerCase().includes(S))&&!((K=A.properties.description)!=null&&K.toLowerCase().includes(S)))};re.update(A=>{for(let N of A.features)T(N)?(delete N.properties.hide_while_editing,r(6,u[N.properties.intervention_type]++,u)):N.properties.hide_while_editing=!0;return A}),r(6,u)}function m(g){a=g,r(2,a)}function d(g){f=g,r(3,f)}function _(){i=this.value,r(0,i)}const $=()=>r(0,i="");return t.$$set=g=>{"schemes"in g&&r(7,s=g.schemes),"schemesToBeShown"in g&&r(1,o=g.schemesToBeShown),"filterText"in g&&r(0,i=g.filterText)},t.$$.update=()=>{t.$$.dirty&13&&p(i,a,f)},[i,o,a,f,l,c,u,s,m,d,_,$]}class Gt extends G{constructor(e){super(),J(this,e,qt,xt,W,{schemes:7,schemesToBeShown:1,filterText:0})}}function Jt(t){let e,r,n,s;return e=new At({props:{color:t[2]}}),{c(){D(e.$$.fragment),r=z(),n=B(t[1])},m(o,i){M(e,o,i),k(o,r,i),k(o,n,i),s=!0},p(o,i){const l={};i&4&&(l.color=o[2]),e.$set(l),(!s||i&2)&&x(n,o[1])},i(o){s||(y(e.$$.fragment,o),s=!0)},o(o){b(e.$$.fragment,o),s=!1},d(o){o&&(U(r),U(n)),E(e,o)}}}function Wt(t){let e,r,n,s,o;function i(a){t[8](a)}let l={id:t[0],hint:t[3],$$slots:{default:[Jt]},$$scope:{ctx:t}};return t[4]!==void 0&&(l.checked=t[4]),e=new zt({props:l}),ue.push(()=>ce(e,"checked",i)),s=new tt({props:{layers:[t[0]],contents:t[5]}}),{c(){D(e.$$.fragment),n=z(),D(s.$$.fragment)},m(a,c){M(e,a,c),k(a,n,c),M(s,a,c),o=!0},p(a,[c]){const f={};c&1&&(f.id=a[0]),c&8&&(f.hint=a[3]),c&518&&(f.$$scope={dirty:c,ctx:a}),!r&&c&16&&(r=!0,f.checked=a[4],he(()=>r=!1)),e.$set(f);const u={};c&1&&(u.layers=[a[0]]),s.$set(u)},i(a){o||(y(e.$$.fragment,a),y(s.$$.fragment,a),o=!0)},o(a){b(e.$$.fragment,a),b(s.$$.fragment,a),o=!1},d(a){a&&U(n),E(e,a),E(s,a)}}}function Xt(t,e,r){let n;ne(t,ke,p=>r(7,n=p));let{name:s}=e,{singularNoun:o}=e,{pluralNoun:i}=e,{color:l}=e,{hint:a}=e;Tt(n,s,`https://atip.uk/layers/v1/${s}.pmtiles`),St(n,{id:s,source:s,sourceLayer:s,color:l,opacity:.8});let c=!1;function f(p){return`<div class="govuk-prose"><p>${p.name??`Unnamed ${o}`}</p></div>`}function u(p){c=p,r(4,c)}return t.$$set=p=>{"name"in p&&r(0,s=p.name),"singularNoun"in p&&r(6,o=p.singularNoun),"pluralNoun"in p&&r(1,i=p.pluralNoun),"color"in p&&r(2,l=p.color),"hint"in p&&r(3,a=p.hint)},t.$$.update=()=>{t.$$.dirty&145&&n.getLayer(s)&&n.setLayoutProperty(s,"visibility",c?"visible":"none")},[s,i,l,a,c,f,o,n,u]}class rt extends G{constructor(e){super(),J(this,e,Xt,Wt,W,{name:0,singularNoun:6,pluralNoun:1,color:2,hint:3})}}function Yt(t){let e,r;return e=new rt({props:{name:"hospitals",singularNoun:"hospital",pluralNoun:"Hospitals",color:"blue",hint:"Hospital data from OpenStreetMap. Doesn't include outpatient clinics or individual doctor's offices."}}),{c(){D(e.$$.fragment)},m(n,s){M(e,n,s),r=!0},p:Ye,i(n){r||(y(e.$$.fragment,n),r=!0)},o(n){b(e.$$.fragment,n),r=!1},d(n){E(e,n)}}}class Qt extends G{constructor(e){super(),J(this,e,null,Yt,W,{})}}function er(t){let e;return{c(){e=B("Show on map")},m(r,n){k(r,e,n)},d(r){r&&U(e)}}}function tr(t){let e;return{c(){e=B("Edit scheme locally")},m(r,n){k(r,e,n)},d(r){r&&U(e)}}}function rr(t){let e,r,n=t[0].authority_or_region+"",s,o,i,l,a=t[0].capital_scheme_id+"",c,f,u,p,m=t[0].funding_programme+"",d,_,$,g,h,w,S;return g=new pe({props:{$$slots:{default:[er]},$$scope:{ctx:t}}}),g.$on("click",t[3]),w=new pe({props:{disabled:t[1],title:t[2],$$slots:{default:[tr]},$$scope:{ctx:t}}}),w.$on("click",t[4]),{c(){e=V("p"),r=B("Authority or region: "),s=B(n),o=z(),i=V("p"),l=B("Capital scheme ID: "),c=B(a),f=z(),u=V("p"),p=B("Funding programme: "),d=B(m),_=z(),$=V("div"),D(g.$$.fragment),h=z(),D(w.$$.fragment),q($,"class","govuk-button-group")},m(v,T){k(v,e,T),C(e,r),C(e,s),k(v,o,T),k(v,i,T),C(i,l),C(i,c),k(v,f,T),k(v,u,T),C(u,p),C(u,d),k(v,_,T),k(v,$,T),M(g,$,null),C($,h),M(w,$,null),S=!0},p(v,T){(!S||T&1)&&n!==(n=v[0].authority_or_region+"")&&x(s,n),(!S||T&1)&&a!==(a=v[0].capital_scheme_id+"")&&x(c,a),(!S||T&1)&&m!==(m=v[0].funding_programme+"")&&x(d,m);const A={};T&256&&(A.$$scope={dirty:T,ctx:v}),g.$set(A);const N={};T&256&&(N.$$scope={dirty:T,ctx:v}),w.$set(N)},i(v){S||(y(g.$$.fragment,v),y(w.$$.fragment,v),S=!0)},o(v){b(g.$$.fragment,v),b(w.$$.fragment,v),S=!1},d(v){v&&(U(e),U(o),U(i),U(f),U(u),U(_),U($)),E(g),E(w)}}}function nr(t){let e,r;return e=new Ue({props:{label:`${t[0].scheme_reference}: ${t[0].num_features} features`,$$slots:{default:[rr]},$$scope:{ctx:t}}}),{c(){D(e.$$.fragment)},m(n,s){M(e,n,s),r=!0},p(n,[s]){const o={};s&1&&(o.label=`${n[0].scheme_reference}: ${n[0].num_features} features`),s&257&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){r||(y(e.$$.fragment,n),r=!0)},o(n){b(e.$$.fragment,n),r=!1},d(n){E(e,n)}}}function sr(t,e,r){let n,s;ne(t,re,u=>r(6,n=u)),ne(t,ke,u=>r(7,s=u));let{scheme:o}=e,{authorityNames:i}=e,l=!i.has(o.authority_or_region),a=l?"This scheme doesn't have an authority specified correctly, so you can't edit this scheme. We're working to fix this problem.":void 0;function c(){let u={type:"FeatureCollection",features:n.features.filter(p=>p.properties.scheme_reference==o.scheme_reference)};s==null||s.fitBounds(Qe(u),{padding:20,animate:!1})}function f(){let u={type:"FeatureCollection",features:n.features.filter(m=>m.properties.scheme_reference==o.scheme_reference)},p=o.authority_or_region;window.localStorage.setItem(p,JSON.stringify(u)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return t.$$set=u=>{"scheme"in u&&r(0,o=u.scheme),"authorityNames"in u&&r(5,i=u.authorityNames)},[o,l,a,c,f,i]}class or extends G{constructor(e){super(),J(this,e,sr,nr,W,{scheme:0,authorityNames:5})}}function ir(t){let e,r;return e=new rt({props:{name:"schools",singularNoun:"school",pluralNoun:"Schools",color:"red",hint:"Primary and secondary schools, from OpenStreetMap."}}),{c(){D(e.$$.fragment)},m(n,s){M(e,n,s),r=!0},p:Ye,i(n){r||(y(e.$$.fragment,n),r=!0)},o(n){b(e.$$.fragment,n),r=!1},d(n){E(e,n)}}}class ar extends G{constructor(e){super(),J(this,e,null,ir,W,{})}}var P=(t,e,r)=>new Promise((n,s)=>{var o=a=>{try{l(r.next(a))}catch(c){s(c)}},i=a=>{try{l(r.throw(a))}catch(c){s(c)}},l=a=>a.done?n(a.value):Promise.resolve(a.value).then(o,i);l((r=r.apply(t,e)).next())}),j=Uint8Array,ee=Uint16Array,lr=Int32Array,nt=new j([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),st=new j([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fr=new j([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ot=function(t,e){for(var r=new ee(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new lr(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)s[o]=o-r[n]<<5|n;return{b:r,r:s}},it=ot(nt,2),at=it.b,ur=it.r;at[28]=258,ur[258]=28;var cr=ot(st,0),hr=cr.b,Te=new ee(32768);for(L=0;L<32768;++L)R=(L&43690)>>1|(L&21845)<<1,R=(R&52428)>>2|(R&13107)<<2,R=(R&61680)>>4|(R&3855)<<4,Te[L]=((R&65280)>>8|(R&255)<<8)>>1;var R,L,fe=function(t,e,r){for(var n=t.length,s=0,o=new ee(e);s<n;++s)t[s]&&++o[t[s]-1];var i=new ee(e);for(s=1;s<e;++s)i[s]=i[s-1]+o[s-1]<<1;var l;if(r){l=new ee(1<<e);var a=15-e;for(s=0;s<n;++s)if(t[s])for(var c=s<<4|t[s],f=e-t[s],u=i[t[s]-1]++<<f,p=u|(1<<f)-1;u<=p;++u)l[Te[u]>>a]=c}else for(l=new ee(n),s=0;s<n;++s)t[s]&&(l[s]=Te[i[t[s]-1]++]>>15-t[s]);return l},me=new j(288);for(L=0;L<144;++L)me[L]=8;var L;for(L=144;L<256;++L)me[L]=9;var L;for(L=256;L<280;++L)me[L]=7;var L;for(L=280;L<288;++L)me[L]=8;var L,lt=new j(32);for(L=0;L<32;++L)lt[L]=5;var L,mr=fe(me,9,1),gr=fe(lt,5,1),we=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},H=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},be=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},pr=function(t){return(t+7)/8|0},dr=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var n=new j(r-e);return n.set(t.subarray(e,r)),n},_r=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],I=function(t,e,r){var n=new Error(e||_r[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,I),!r)throw n;return n},De=function(t,e,r,n){var s=t.length,o=n?n.length:0;if(!s||e.f&&!e.l)return r||new j(0);var i=!r||e.i!=2,l=e.i;r||(r=new j(s*3));var a=function(Ae){var Ne=r.length;if(Ae>Ne){var Oe=new j(Math.max(Ne*2,Ae));Oe.set(r),r=Oe}},c=e.f||0,f=e.p||0,u=e.b||0,p=e.l,m=e.d,d=e.m,_=e.n,$=s*8;do{if(!p){c=H(t,f,1);var g=H(t,f+1,3);if(f+=3,g)if(g==1)p=mr,m=gr,d=9,_=5;else if(g==2){var v=H(t,f,31)+257,T=H(t,f+10,15)+4,A=v+H(t,f+5,31)+1;f+=14;for(var N=new j(A),K=new j(19),O=0;O<T;++O)K[fr[O]]=H(t,f+O*3,7);f+=T*3;for(var Me=we(K),dt=(1<<Me)-1,_t=fe(K,Me,1),O=0;O<A;){var Ee=_t[H(t,f,dt)];f+=Ee&15;var h=Ee>>4;if(h<16)N[O++]=h;else{var X=0,ge=0;for(h==16?(ge=3+H(t,f,3),f+=2,X=N[O-1]):h==17?(ge=3+H(t,f,7),f+=3):h==18&&(ge=11+H(t,f,127),f+=7);ge--;)N[O++]=X}}var Ce=N.subarray(0,v),Z=N.subarray(v);d=we(Ce),_=we(Z),p=fe(Ce,d,1),m=fe(Z,_,1)}else I(1);else{var h=pr(f)+4,w=t[h-4]|t[h-3]<<8,S=h+w;if(S>s){l&&I(0);break}i&&a(u+w),r.set(t.subarray(h,S),u),e.b=u+=w,e.p=f=S*8,e.f=c;continue}if(f>$){l&&I(0);break}}i&&a(u+131072);for(var vt=(1<<d)-1,yt=(1<<_)-1,_e=f;;_e=f){var X=p[be(t,f)&vt],Y=X>>4;if(f+=X&15,f>$){l&&I(0);break}if(X||I(2),Y<256)r[u++]=Y;else if(Y==256){_e=f,p=null;break}else{var Be=Y-254;if(Y>264){var O=Y-257,se=nt[O];Be=H(t,f,(1<<se)-1)+at[O],f+=se}var ve=m[be(t,f)&yt],ye=ve>>4;ve||I(3),f+=ve&15;var Z=hr[ye];if(ye>3){var se=st[ye];Z+=be(t,f)&(1<<se)-1,f+=se}if(f>$){l&&I(0);break}i&&a(u+131072);var $e=u+Be;if(u<Z){var ze=o-Z,$t=Math.min(Z,$e);for(ze+u<0&&I(3);u<$t;++u)r[u]=n[ze+u]}for(;u<$e;u+=4)r[u]=r[u-Z],r[u+1]=r[u+1-Z],r[u+2]=r[u+2-Z],r[u+3]=r[u+3-Z];u=$e}}e.l=p,e.p=_e,e.b=u,e.f=c,p&&(c=1,e.m=d,e.d=m,e.n=_)}while(!c);return u==r.length?r:dr(r,0,u)},vr=new j(0),yr=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&I(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=(t[10]|t[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[r++]);return r+(e&2)},$r=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},wr=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&I(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&I(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function br(t,e){return De(t,{i:2},e&&e.out,e&&e.dictionary)}function Tr(t,e){var r=yr(t);return r+8>t.length&&I(6,"invalid gzip data"),De(t.subarray(r,-8),{i:2},e&&e.out||new j($r(t)),e&&e.dictionary)}function Sr(t,e){return De(t.subarray(wr(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Se(t,e){return t[0]==31&&t[1]==139&&t[2]==8?Tr(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?br(t,e):Sr(t,e)}var Lr=typeof TextDecoder<"u"&&new TextDecoder,kr=0;try{Lr.decode(vr,{stream:!0}),kr=1}catch{}var ft=(t,e)=>t*Math.pow(2,e),oe=(t,e)=>Math.floor(t/Math.pow(2,e)),de=(t,e)=>ft(t.getUint16(e+1,!0),8)+t.getUint8(e),ut=(t,e)=>ft(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),Ur=(t,e,r,n,s)=>{if(t!=n.getUint8(s))return t-n.getUint8(s);const o=de(n,s+1);if(e!=o)return e-o;const i=de(n,s+4);return r!=i?r-i:0},Dr=(t,e,r,n)=>{const s=ct(t,e|128,r,n);return s?{z:e,x:r,y:n,offset:s[0],length:s[1],is_dir:!0}:null},He=(t,e,r,n)=>{const s=ct(t,e,r,n);return s?{z:e,x:r,y:n,offset:s[0],length:s[1],is_dir:!1}:null},ct=(t,e,r,n)=>{let s=0,o=t.byteLength/17-1;for(;s<=o;){const i=o+s>>1,l=Ur(e,r,n,t,i*17);if(l>0)s=i+1;else if(l<0)o=i-1;else return[ut(t,i*17+7),t.getUint32(i*17+13,!0)]}return null},Mr=(t,e)=>t.is_dir&&!e.is_dir?1:!t.is_dir&&e.is_dir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,ht=(t,e)=>{const r=t.getUint8(e*17);return{z:r&127,x:de(t,e*17+1),y:de(t,e*17+4),offset:ut(t,e*17+7),length:t.getUint32(e*17+13,!0),is_dir:r>>7===1}},Fe=t=>{const e=[],r=new DataView(t);for(let n=0;n<r.byteLength/17;n++)e.push(ht(r,n));return Er(e)},Er=t=>{t.sort(Mr);const e=new ArrayBuffer(17*t.length),r=new Uint8Array(e);for(let n=0;n<t.length;n++){const s=t[n];let o=s.z;s.is_dir&&(o=o|128),r[n*17]=o,r[n*17+1]=s.x&255,r[n*17+2]=s.x>>8&255,r[n*17+3]=s.x>>16&255,r[n*17+4]=s.y&255,r[n*17+5]=s.y>>8&255,r[n*17+6]=s.y>>16&255,r[n*17+7]=s.offset&255,r[n*17+8]=oe(s.offset,8)&255,r[n*17+9]=oe(s.offset,16)&255,r[n*17+10]=oe(s.offset,24)&255,r[n*17+11]=oe(s.offset,32)&255,r[n*17+12]=oe(s.offset,48)&255,r[n*17+13]=s.length&255,r[n*17+14]=s.length>>8&255,r[n*17+15]=s.length>>16&255,r[n*17+16]=s.length>>24&255}return e},Cr=(t,e)=>{if(t.byteLength<17)return null;const r=t.byteLength/17,n=ht(t,r-1);if(n.is_dir){const s=n.z,o=e.z-s,i=Math.trunc(e.x/(1<<o)),l=Math.trunc(e.y/(1<<o));return{z:s,x:i,y:l}}return null};function Br(t){return P(this,null,function*(){const e=yield t.getBytes(0,512e3),r=new DataView(e.data),n=r.getUint32(4,!0),s=r.getUint16(8,!0),o=new TextDecoder("utf-8"),i=JSON.parse(o.decode(new DataView(e.data,10,n)));let l=0;i.compression==="gzip"&&(l=2);let a=0;"minzoom"in i&&(a=+i.minzoom);let c=0;"maxzoom"in i&&(c=+i.maxzoom);let f=0,u=0,p=0,m=-180,d=-85,_=180,$=85;if(i.bounds){const h=i.bounds.split(",");m=+h[0],d=+h[1],_=+h[2],$=+h[3]}if(i.center){const h=i.center.split(",");f=+h[0],u=+h[1],p=+h[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:l,tileType:1,minZoom:a,maxZoom:c,minLon:m,minLat:d,maxLon:_,maxLat:$,centerZoom:p,centerLon:f,centerLat:u,etag:e.etag}})}function zr(t,e,r,n,s,o,i){return P(this,null,function*(){let l=yield r.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(l=Fe(l));const a=He(new DataView(l),n,s,o);if(a){let u=(yield e.getBytes(a.offset,a.length,i)).data;const p=new DataView(u);return p.getUint8(0)==31&&p.getUint8(1)==139&&(u=Se(new Uint8Array(u))),{data:u}}const c=Cr(new DataView(l),{z:n,x:s,y:o});if(c){const f=Dr(new DataView(l),c.z,c.x,c.y);if(f){let u=yield r.getArrayBuffer(e,f.offset,f.length,t);t.specVersion===1&&(u=Fe(u));const p=He(new DataView(u),n,s,o);if(p){let d=(yield e.getBytes(p.offset,p.length,i)).data;const _=new DataView(d);return _.getUint8(0)==31&&_.getUint8(1)==139&&(d=Se(new Uint8Array(d))),{data:d}}}}})}var mt={getHeader:Br,getZxy:zr},Ar=class{constructor(){this.tile=(t,e)=>{if(t.type=="json"){const r=t.url.substr(10);let n=this.tiles.get(r);return n||(n=new Ke(r),this.tiles.set(r,n)),n.getHeader().then(s=>{const o={tiles:[t.url+"/{z}/{x}/{y}"],minzoom:s.minZoom,maxzoom:s.maxZoom,bounds:[s.minLon,s.minLat,s.maxLon,s.maxLat]};e(null,o,null,null)}).catch(s=>{e(s,null,null,null)}),{cancel:()=>{}}}else{const r=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=t.url.match(r);if(!n)throw new Error("Invalid PMTiles protocol URL");const s=n[1];let o=this.tiles.get(s);o||(o=new Ke(s),this.tiles.set(s,o));const i=n[2],l=n[3],a=n[4],c=new AbortController,f=c.signal;let u=()=>{c.abort()};return o.getHeader().then(p=>{o.getZxy(+i,+l,+a,f).then(m=>{m?e(null,new Uint8Array(m.data),m.cacheControl,m.expires):p.tileType==1?e(null,new Uint8Array,null,null):e(null,null,null,null)}).catch(m=>{m.name!=="AbortError"&&e(m,null,null,null)})}),{cancel:u}}},this.tiles=new Map}add(t){this.tiles.set(t.source.getKey(),t)}get(t){return this.tiles.get(t)}};function Q(t,e){return(e>>>0)*4294967296+(t>>>0)}function Nr(t,e){const r=e.buf;let n,s;if(s=r[e.pos++],n=(s&112)>>4,s<128||(s=r[e.pos++],n|=(s&127)<<3,s<128)||(s=r[e.pos++],n|=(s&127)<<10,s<128)||(s=r[e.pos++],n|=(s&127)<<17,s<128)||(s=r[e.pos++],n|=(s&127)<<24,s<128)||(s=r[e.pos++],n|=(s&1)<<31,s<128))return Q(t,n);throw new Error("Expected varint not more than 10 bytes")}function ie(t){const e=t.buf;let r,n;return n=e[t.pos++],r=n&127,n<128||(n=e[t.pos++],r|=(n&127)<<7,n<128)||(n=e[t.pos++],r|=(n&127)<<14,n<128)||(n=e[t.pos++],r|=(n&127)<<21,n<128)?r:(n=e[t.pos],r|=(n&15)<<28,Nr(r,t))}function Or(t,e,r,n){if(n==0){r==1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}var Pr=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Ir(t,e,r){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,t)-1||r>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");const n=Pr[t],s=Math.pow(2,t);let o=0,i=0,l=0;const a=[e,r];let c=s/2;for(;c>0;)o=(a[0]&c)>0?1:0,i=(a[1]&c)>0?1:0,l+=c*c*(3*o^i),Or(c,a,o,i),c=c/2;return n+l}function gt(t,e){return P(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Se(new Uint8Array(t));{let n=new Response(t).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}}else throw Error("Compression method not supported")})}var jr=127;function Vr(t,e){let r=0,n=t.length-1;for(;r<=n;){const s=n+r>>1,o=e-t[s].tileId;if(o>0)r=s+1;else if(o<0)n=s-1;else return t[s]}return n>=0&&(t[n].runLength===0||e-t[n].tileId<t[n].runLength)?t[n]:null}var Zr=class{constructor(t){this.url=t}getKey(){return this.url}getBytes(t,e,r){return P(this,null,function*(){let n;r||(n=new AbortController,r=n.signal);let s=yield fetch(this.url,{signal:r,headers:{Range:"bytes="+t+"-"+(t+e-1)}});if(s.status===416&&t===0){const l=s.headers.get("Content-Range");if(!l||!l.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const a=+l.substr(8);s=yield fetch(this.url,{signal:r,headers:{Range:"bytes=0-"+(a-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function F(t,e){const r=t.getUint32(e+4,!0),n=t.getUint32(e+0,!0);return r*Math.pow(2,32)+n}function Hr(t,e){const r=new DataView(t),n=r.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:F(r,8),rootDirectoryLength:F(r,16),jsonMetadataOffset:F(r,24),jsonMetadataLength:F(r,32),leafDirectoryOffset:F(r,40),leafDirectoryLength:F(r,48),tileDataOffset:F(r,56),tileDataLength:F(r,64),numAddressedTiles:F(r,72),numTileEntries:F(r,80),numTileContents:F(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:e}}function pt(t){const e={buf:new Uint8Array(t),pos:0},r=ie(e),n=[];let s=0;for(let o=0;o<r;o++){const i=ie(e);n.push({tileId:s+i,offset:0,length:0,runLength:1}),s+=i}for(let o=0;o<r;o++)n[o].runLength=ie(e);for(let o=0;o<r;o++)n[o].length=ie(e);for(let o=0;o<r;o++){const i=ie(e);i===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=i-1}return n}function Fr(t){const e=new DataView(t);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var te=class extends Error{};function Kr(t,e,r,n){return P(this,null,function*(){const s=yield t.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Fr(s.data)<3)return[yield mt.getHeader(t)];const i=s.data.slice(0,jr);let l=s.etag;n&&s.etag!=n&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),l=void 0);const a=Hr(i,l);if(r){const c=s.data.slice(a.rootDirectoryOffset,a.rootDirectoryOffset+a.rootDirectoryLength),f=t.getKey()+"|"+(a.etag||"")+"|"+a.rootDirectoryOffset+"|"+a.rootDirectoryLength,u=pt(yield e(c,a.internalCompression));return[a,[f,u.length,u]]}return[a,void 0]})}function Rr(t,e,r,n,s){return P(this,null,function*(){const o=yield t.getBytes(r,n);if(s.etag&&s.etag!==o.etag)throw new te(o.etag);const i=yield e(o.data,s.internalCompression),l=pt(i);if(l.length===0)throw new Error("Empty directory is invalid");return l})}var xr=class{constructor(t=100,e=!0,r=gt){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.prefetch=e,this.decompress=r}getHeader(t,e){return P(this,null,function*(){const r=t.getKey();if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const n=new Promise((s,o)=>{Kr(t,this.decompress,this.prefetch,e).then(i=>{i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:Promise.resolve(i[1][2])}),s(i[0]),this.prune()}).catch(i=>{o(i)})});return this.cache.set(r,{lastUsed:this.counter++,data:n}),n})}getDirectory(t,e,r,n){return P(this,null,function*(){const s=t.getKey()+"|"+(n.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((i,l)=>{Rr(t,this.decompress,e,r,n).then(a=>{i(a),this.prune()}).catch(a=>{l(a)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}getArrayBuffer(t,e,r,n){return P(this,null,function*(){const s=t.getKey()+"|"+(n.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((i,l)=>{t.getBytes(e,r).then(a=>{if(n.etag&&n.etag!==a.etag)throw new te(a.etag);i(a.data),this.cache.has(s),this.prune()}).catch(a=>{l(a)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((r,n)=>{r.lastUsed<t&&(t=r.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(t,e){return P(this,null,function*(){this.cache.delete(t.getKey()),yield this.getHeader(t,e)})}},Ke=class{constructor(t,e,r){typeof t=="string"?this.source=new Zr(t):this.source=t,r?this.decompress=r:this.decompress=gt,e?this.cache=e:this.cache=new xr}getHeader(){return P(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,r,n){return P(this,null,function*(){const s=Ir(t,e,r),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return mt.getZxy(o,this.source,this.cache,t,e,r,n);if(t<o.minZoom||t>o.maxZoom)return;let i=o.rootDirectoryOffset,l=o.rootDirectoryLength;for(let a=0;a<=3;a++){const c=yield this.cache.getDirectory(this.source,i,l,o),f=Vr(c,s);if(f)if(f.runLength>0){const u=yield this.source.getBytes(o.tileDataOffset+f.offset,f.length,n);if(o.etag&&o.etag!==u.etag)throw new te(u.etag);return{data:yield this.decompress(u.data,o.tileCompression),cacheControl:u.cacheControl,expires:u.expires}}else i=o.leafDirectoryOffset+f.offset,l=f.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,r,n){return P(this,null,function*(){try{return yield this.getZxyAttempt(t,e,r,n)}catch(s){if(s instanceof te)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(t,e,r,n);throw s}})}getMetadataAttempt(){return P(this,null,function*(){const t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength);if(t.etag&&t.etag!==e.etag)throw new te(e.etag);const r=yield this.decompress(e.data,t.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(r))})}getMetadata(){return P(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof te)return this.cache.invalidate(this.source,t.message),yield this.getMetadataAttempt();throw t}})}};function qr(t){return Le(()=>{let e=new Ar;Ie.addProtocol("pmtiles",e.tile)}),et(()=>{Ie.removeProtocol("pmtiles")}),[]}class Gr extends G{constructor(e){super(),J(this,e,qr,null,W,{})}}function Re(t,e,r){const n=t.slice();return n[15]=e[r],n}function Jr(t){let e;return{c(){e=B("Home")},m(r,n){k(r,e,n)},d(r){r&&U(e)}}}function xe(t){let e,r;return e=new Et({props:{errorMessage:t[1]}}),{c(){D(e.$$.fragment)},m(n,s){M(e,n,s),r=!0},p(n,s){const o={};s&2&&(o.errorMessage=n[1]),e.$set(o)},i(n){r||(y(e.$$.fragment,n),r=!0)},o(n){b(e.$$.fragment,n),r=!1},d(n){E(e,n)}}}function qe(t){let e,r,n,s;function o(a){t[10](a)}function i(a){t[11](a)}let l={schemes:t[2]};return t[3]!==void 0&&(l.schemesToBeShown=t[3]),t[4]!==void 0&&(l.filterText=t[4]),e=new Gt({props:l}),ue.push(()=>ce(e,"schemesToBeShown",o)),ue.push(()=>ce(e,"filterText",i)),{c(){D(e.$$.fragment)},m(a,c){M(e,a,c),s=!0},p(a,c){const f={};c&4&&(f.schemes=a[2]),!r&&c&8&&(r=!0,f.schemesToBeShown=a[3],he(()=>r=!1)),!n&&c&16&&(n=!0,f.filterText=a[4],he(()=>n=!1)),e.$set(f)},i(a){s||(y(e.$$.fragment,a),s=!0)},o(a){b(e.$$.fragment,a),s=!1},d(a){E(e,a)}}}function Ge(t){let e,r,n=Ve(t[2].values()),s=[];for(let i=0;i<n.length;i+=1)s[i]=We(Re(t,n,i));const o=i=>b(s[i],1,1,()=>{s[i]=null});return{c(){e=V("ul");for(let i=0;i<s.length;i+=1)s[i].c()},m(i,l){k(i,e,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);r=!0},p(i,l){if(l&13){n=Ve(i[2].values());let a;for(a=0;a<n.length;a+=1){const c=Re(i,n,a);s[a]?(s[a].p(c,l),y(s[a],1)):(s[a]=We(c),s[a].c(),y(s[a],1),s[a].m(e,null))}for(ae(),a=n.length;a<s.length;a+=1)o(a);le()}},i(i){if(!r){for(let l=0;l<n.length;l+=1)y(s[l]);r=!0}},o(i){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)b(s[l]);r=!1},d(i){i&&U(e),Ct(s,i)}}}function Je(t){let e,r;return e=new or({props:{scheme:t[15],authorityNames:t[0]}}),{c(){D(e.$$.fragment)},m(n,s){M(e,n,s),r=!0},p(n,s){const o={};s&4&&(o.scheme=n[15]),s&1&&(o.authorityNames=n[0]),e.$set(o)},i(n){r||(y(e.$$.fragment,n),r=!0)},o(n){b(e.$$.fragment,n),r=!1},d(n){E(e,n)}}}function We(t){let e=t[3].has(t[15].scheme_reference),r,n,s=e&&Je(t);return{c(){s&&s.c(),r=Bt()},m(o,i){s&&s.m(o,i),k(o,r,i),n=!0},p(o,i){i&12&&(e=o[3].has(o[15].scheme_reference)),e?s?(s.p(o,i),i&12&&y(s,1)):(s=Je(o),s.c(),y(s,1),s.m(r.parentNode,r)):s&&(ae(),b(s,1,1,()=>{s=null}),le())},i(o){n||(y(s),n=!0)},o(o){b(s),n=!1},d(o){o&&U(r),s&&s.d(o)}}}function Wr(t){let e,r,n,s,o,i,l,a,c,f,u,p,m;r=new pe({props:{$$slots:{default:[Jr]},$$scope:{ctx:t}}}),r.$on("click",t[9]),l=new Ot({props:{boundaryGeojson:t[5]}});let d=t[1]&&xe(t);f=new Lt({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:t[7]}});let _=t[2].size>0&&qe(t),$=t[0]&&Ge(t);return{c(){e=V("div"),D(r.$$.fragment),n=z(),s=V("div"),o=V("h1"),o.textContent="Browse schemes",i=z(),D(l.$$.fragment),a=z(),d&&d.c(),c=z(),D(f.$$.fragment),u=z(),_&&_.c(),p=z(),$&&$.c(),je(s,"display","flex"),je(s,"justify-content","space-between"),q(e,"slot","sidebar"),q(e,"class","govuk-prose")},m(g,h){k(g,e,h),M(r,e,null),C(e,n),C(e,s),C(s,o),C(s,i),M(l,s,null),C(e,a),d&&d.m(e,null),C(e,c),M(f,e,null),C(e,u),_&&_.m(e,null),C(e,p),$&&$.m(e,null),m=!0},p(g,h){const w={};h&262144&&(w.$$scope={dirty:h,ctx:g}),r.$set(w);const S={};h&32&&(S.boundaryGeojson=g[5]),l.$set(S),g[1]?d?(d.p(g,h),h&2&&y(d,1)):(d=xe(g),d.c(),y(d,1),d.m(e,c)):d&&(ae(),b(d,1,1,()=>{d=null}),le()),g[2].size>0?_?(_.p(g,h),h&4&&y(_,1)):(_=qe(g),_.c(),y(_,1),_.m(e,p)):_&&(ae(),b(_,1,1,()=>{_=null}),le()),g[0]?$?($.p(g,h),h&1&&y($,1)):($=Ge(g),$.c(),y($,1),$.m(e,null)):$&&(ae(),b($,1,1,()=>{$=null}),le())},i(g){m||(y(r.$$.fragment,g),y(l.$$.fragment,g),y(d),y(f.$$.fragment,g),y(_),y($),m=!0)},o(g){b(r.$$.fragment,g),b(l.$$.fragment,g),b(d),b(f.$$.fragment,g),b(_),b($),m=!1},d(g){g&&U(e),E(r),E(l),d&&d.d(),E(f),_&&_.d(),$&&$.d()}}}function Xr(t){let e,r,n,s;return e=new ar({}),n=new Qt({}),{c(){D(e.$$.fragment),r=z(),D(n.$$.fragment)},m(o,i){M(e,o,i),k(o,r,i),M(n,o,i),s=!0},i(o){s||(y(e.$$.fragment,o),y(n.$$.fragment,o),s=!0)},o(o){b(e.$$.fragment,o),b(n.$$.fragment,o),s=!1},d(o){o&&U(r),E(e,o),E(n,o)}}}function Yr(t){let e,r,n,s;return e=new Vt({props:{style:t[6]}}),n=new Zt({props:{small:!0,$$slots:{default:[Xr]},$$scope:{ctx:t}}}),{c(){D(e.$$.fragment),r=z(),D(n.$$.fragment)},m(o,i){M(e,o,i),k(o,r,i),M(n,o,i),s=!0},p(o,i){const l={};i&262144&&(l.$$scope={dirty:i,ctx:o}),n.$set(l)},i(o){s||(y(e.$$.fragment,o),y(n.$$.fragment,o),s=!0)},o(o){b(e.$$.fragment,o),b(n.$$.fragment,o),s=!1},d(o){o&&U(r),E(e,o),E(n,o)}}}function Qr(t){let e,r,n,s,o,i,l,a,c;return e=new It({props:{schema:Xe}}),n=new jt({props:{schema:Xe}}),o=new tt({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:t[8]}}),a=new Ue({props:{label:"Layers",open:!0,$$slots:{default:[Yr]},$$scope:{ctx:t}}}),{c(){D(e.$$.fragment),r=z(),D(n.$$.fragment),s=z(),D(o.$$.fragment),i=z(),l=V("div"),D(a.$$.fragment),q(l,"class","top-right svelte-nlvvhu")},m(f,u){M(e,f,u),k(f,r,u),M(n,f,u),k(f,s,u),M(o,f,u),k(f,i,u),k(f,l,u),M(a,l,null),c=!0},p(f,u){const p={};u&262144&&(p.$$scope={dirty:u,ctx:f}),a.$set(p)},i(f){c||(y(e.$$.fragment,f),y(n.$$.fragment,f),y(o.$$.fragment,f),y(a.$$.fragment,f),c=!0)},o(f){b(e.$$.fragment,f),b(n.$$.fragment,f),b(o.$$.fragment,f),b(a.$$.fragment,f),c=!1},d(f){f&&(U(r),U(s),U(i),U(l)),E(e,f),E(n,f),E(o,f),E(a)}}}function en(t){let e,r,n,s,o;return r=new Gr({}),s=new Pt({props:{style:t[6],$$slots:{default:[Qr]},$$scope:{ctx:t}}}),{c(){e=V("div"),D(r.$$.fragment),n=z(),D(s.$$.fragment),q(e,"slot","main")},m(i,l){k(i,e,l),M(r,e,null),C(e,n),M(s,e,null),o=!0},p(i,l){const a={};l&262144&&(a.$$scope={dirty:l,ctx:i}),s.$set(a)},i(i){o||(y(r.$$.fragment,i),y(s.$$.fragment,i),o=!0)},o(i){b(r.$$.fragment,i),b(s.$$.fragment,i),o=!1},d(i){i&&U(e),E(r),E(s)}}}function tn(t){let e,r;return e=new Nt({props:{$$slots:{main:[en],sidebar:[Wr]},$$scope:{ctx:t}}}),{c(){D(e.$$.fragment)},m(n,s){M(e,n,s),r=!0},p(n,[s]){const o={};s&262207&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){r||(y(e.$$.fragment,n),r=!0)},o(n){b(e.$$.fragment,n),r=!1},d(n){E(e,n)}}}const Xe="v1";function rn(t,e,r){let n,s;ne(t,ke,h=>r(12,n=h)),ne(t,re,h=>r(5,s=h));let o=null;Le(async()=>{kt();let h=await Ut();r(0,o=new Set(h.features.map(w=>w.properties.name)))});let l=new URLSearchParams(window.location.search).get("style")||"streets",a="",c=new Map,f=new Set,u="";et(()=>{re.set(Dt())});function p(h){try{let w=JSON.parse(h);r(2,c=Ht(w)),re.set(w),r(1,a=""),n==null||n.fitBounds(Qe(w),{padding:20,animate:!1})}catch(w){r(1,a=`Couldn't load schemes from a file: ${w}`)}}function m(h){var w='<div class="govuk-prose" style="max-width: 30vw;">';return w+=`<h2>${d(h.name)} (${h.intervention_type})</h2>`,w+=`<p>Scheme reference: ${h.scheme_reference}</p>`,h.length_meters&&(w+=`<p>Length: ${Mt(h.length_meters)}</p>`),h.description&&(w+=`<p>${d(h.description)}</p>`),w}function d(h){return u?h.replace(new RegExp(u,"gi"),w=>`<mark>${w}</mark>`):h}const _=()=>window.open("index.html");function $(h){f=h,r(3,f)}function g(h){u=h,r(4,u)}return[o,a,c,f,u,s,l,p,m,_,$,g]}class nn extends G{constructor(e){super(),J(this,e,rn,tn,W,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new nn({target:document.getElementById("app")});
