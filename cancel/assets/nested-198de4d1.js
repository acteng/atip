var Nr=Object.defineProperty;var Br=(r,e,t)=>e in r?Nr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var W=(r,e,t)=>(Br(r,typeof e!="symbol"?e+"":e,t),t);import{S as Q,i as ee,s as Z,M as $r,b as he,a as ze,d as U,m as J,k as We,n as T,o as $,q as z,e as w,c as F,g as k,x as H,p as S,y as Pe,f as P,z as Ie,B as Te,C as Dr,D as mn,E as zt,F as ft,G as gt,H as mt,I as vt,J as yt,K as Pn,h as b,l as Y,L as Gr,N as jr,O as te,P as Yr,w as vn,Q as Ve,R as ge,T as yn,t as V,U as _e,j as it,r as Je,V as _n,W as Fn,X as Me,Y as Rn,Z as vr,_ as An,$ as qr,a0 as Xr,a1 as xe,a2 as Hr,a3 as Ur,a4 as Jr,a5 as In,a6 as zr,a7 as Xt,a8 as ct,a9 as Ht,aa as kt,ab as bn,ac as en,ad as Wr,ae as lt,af as wn,ag as Xe,ah as ut,ai as Vr,aj as kn,ak as Zr,al as Kr,am as Qr,an as Tn,ao as Tt,ap as ei,aq as ti,ar as ni,A as ri,u as ii}from"./authorities-a207e9a8.js";function oi(r){let e,t,n,i,o,s,u,l,a,h,m,p,f;return{c(){e=w("p"),e.textContent="For each intervention:",t=F(),n=w("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=F(),o=w("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=F(),u=w("p"),u.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=F(),a=w("p"),a.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,h=F(),m=w("p"),m.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,p=F(),f=w("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(g,v){k(g,e,v),k(g,t,v),k(g,n,v),k(g,i,v),k(g,o,v),k(g,s,v),k(g,u,v),k(g,l,v),k(g,a,v),k(g,h,v),k(g,m,v),k(g,p,v),k(g,f,v)},p:H,d(g){g&&S(e),g&&S(t),g&&S(n),g&&S(i),g&&S(o),g&&S(s),g&&S(u),g&&S(l),g&&S(a),g&&S(h),g&&S(m),g&&S(p),g&&S(f)}}}function si(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[oi]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new $r({props:o}),he.push(()=>ze(e,"open",i,r[0])),{c(){U(e.$$.fragment)},m(s,u){J(e,s,u),n=!0},p(s,[u]){const l={};u&4&&(l.$$scope={dirty:u,ctx:s}),!t&&u&1&&(t=!0,l.open=s[0],We(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){z(e,s)}}}function li(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class ui extends Q{constructor(e){super(),ee(this,e,li,si,Z,{open:0})}}const Qe=[];function ht(r,e=H){let t;const n=new Set;function i(u){if(Z(r,u)&&(r=u,t)){const l=!Qe.length;for(const a of n)a[1](),Qe.push(a,r);if(l){for(let a=0;a<Qe.length;a+=2)Qe[a][0](Qe[a+1]);Qe.length=0}}}function o(u){i(u(r))}function s(u,l=H){const a=[u,l];return n.add(a),n.size===1&&(t=e(i)||H),u(r),()=>{n.delete(a),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Fe=ht(null),ne=ht(Pe()),be=ht(null),Ae=ht(null),Nt=ht(null),tn=ht(null);function Ut(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function yr(r){ne.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),be.set(null),Ae.set(null),Nt.set(null)}function Nn(r){let e;const t=r[4].default,n=gt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&mt(n,t,i,i[3],e?yt(t,i[3],o,null):vt(i[3]),null)},i(i){e||(T(n,i),e=!0)},o(i){$(n,i),e=!1},d(i){n&&n.d(i)}}}function ai(r){let e,t,n=r[1]&&Nn(r);return{c(){e=w("div"),n&&n.c(),P(e,"class","map svelte-12dpf1u")},m(i,o){k(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&T(n,1)):(n=Nn(i),n.c(),T(n,1),n.m(e,null)):n&&(Ie(),$(n,1,1,()=>{n=null}),Te())},i(i){t||(T(n),t=!0)},o(i){$(n),t=!1},d(i){i&&S(e),n&&n.d(),r[5](null)}}}function fi(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,u,l=!1;Dr("setCamera",!window.location.hash),mn(()=>{s=new zt.Map({container:u,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new zt.ScaleControl({})),s.addControl(new zt.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Fe.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(u)}),ft(()=>{s.remove()});function a(h){he[h?"unshift":"push"](()=>{u=h,t(0,u)})}return r.$$set=h=>{"style"in h&&t(2,o=h.style),"$$scope"in h&&t(3,i=h.$$scope)},[u,l,o,i,n,a]}class ci extends Q{constructor(e){super(),ee(this,e,fi,ai,Z,{style:2})}}const hi=r=>({}),Bn=r=>({}),pi=r=>({}),$n=r=>({}),di=r=>({}),Dn=r=>({});function gi(r){let e,t,n,i,o,s,u,l,a,h,m,p;const f=r[3].nav,g=gt(f,r,r[2],Dn),v=r[3].sidebar,_=gt(v,r,r[2],$n),x=r[3].main,c=gt(x,r,r[2],Bn);return{c(){e=w("aside"),t=w("div"),n=w("nav"),g&&g.c(),i=F(),_&&_.c(),o=F(),s=w("button"),s.textContent="→",l=F(),a=w("main"),c&&c.c(),P(n,"class","svelte-1u7vg8a"),P(t,"class","sidebar-content content-container svelte-1u7vg8a"),P(s,"type","button"),P(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),P(e,"class",u=Pn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),P(a,"class","svelte-1u7vg8a")},m(d,y){k(d,e,y),b(e,t),b(t,n),g&&g.m(n,null),b(t,i),_&&_.m(t,null),b(e,o),b(e,s),k(d,l,y),k(d,a,y),c&&c.m(a,null),h=!0,m||(p=Y(s,"click",r[1]),m=!0)},p(d,[y]){g&&g.p&&(!h||y&4)&&mt(g,f,d,d[2],h?yt(f,d[2],y,di):vt(d[2]),Dn),_&&_.p&&(!h||y&4)&&mt(_,v,d,d[2],h?yt(v,d[2],y,pi):vt(d[2]),$n),(!h||y&1&&u!==(u=Pn(d[0]?"":"collapsed")+" svelte-1u7vg8a"))&&P(e,"class",u),c&&c.p&&(!h||y&4)&&mt(c,x,d,d[2],h?yt(x,d[2],y,hi):vt(d[2]),Bn)},i(d){h||(T(g,d),T(_,d),T(c,d),h=!0)},o(d){$(g,d),$(_,d),$(c,d),h=!1},d(d){d&&S(e),g&&g.d(d),_&&_.d(d),d&&S(l),d&&S(a),c&&c.d(d),m=!1,p()}}}function mi(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=u=>{"$$scope"in u&&t(2,i=u.$$scope)},[o,s,i,n]}class vi extends Q{constructor(e){super(),ee(this,e,mi,gi,Z,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function yi(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(h){return l([a,h])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(h){a=[6,h],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var Ue=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function _i(r,e){return r>e?1:r<e?-1:0}function Ge(r,e,t){for(var n=new Ue(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Wt(r,e,t,n){var i=new Ue(r,e);if(t===null)return i.left=i.right=null,i;t=Ge(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Gn(r,e,t){var n=null,i=null;if(e){e=Ge(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function bi(r,e,t){return e===null?r:(r===null||(e=Ge(r.key,e,t),e.left=r),e)}function nn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&nn(r.left,o,!1,n,i),r.right&&nn(r.right,o,!0,n,i)}}var Sn=function(){function r(e){e===void 0&&(e=_i),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Wt(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ue(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ge(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ge(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ge(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ge(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ge(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,u=this._root,l;o.length!==0||u;)if(u)o.push(u),u=u.left;else{if(u=o.pop(),l=s(u.key,t),l>0)break;if(s(u.key,e)>=0&&n.call(i,u))return this;u=u.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return ki(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&sn(e,t,0,i-1,o),this._root===null)this._root=rn(e,t,0,i),this._size=i;else{var s=Si(this.toList(),wi(e,t),o);i=this._size+i,this._root=on({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return nn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Gn(e,this._root,i),s=o.left,u=o.right;i(e,t)<0?u=Wt(t,n,u,i):s=Wt(t,n,s,i),this._root=bi(s,u,i)},r.prototype.split=function(e){return Gn(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return yi(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function rn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],u=e[o],l=new Ue(s,u);return l.left=rn(r,e,t,o),l.right=rn(r,e,o+1,n),l}return null}function wi(r,e){for(var t=new Ue(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ue(r[i],e[i]);return n.next=null,t.next}function ki(r){for(var e=r,t=[],n=!1,i=new Ue(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function on(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=on(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=on(r,i+1,t),s}return null}function Si(r,e,t){for(var n=new Ue(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function sn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,u=n+1;;){do s++;while(i(r[s],o)<0);do u--;while(i(r[u],o)>0);if(s>=u)break;var l=r[s];r[s]=r[u],r[u]=l,l=e[s],e[s]=e[u],e[u]=l}sn(r,e,t,u,i),sn(r,e,u+1,n,i)}}function ke(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function jn(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function me(r,e,t){return e&&jn(r.prototype,e),t&&jn(r,t),r}var dt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},ln=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Ye=Number.EPSILON;Ye===void 0&&(Ye=Math.pow(2,-52));var xi=Ye*Ye,un=function(e,t){if(-Ye<e&&e<Ye&&-Ye<t&&t<Ye)return 0;var n=e-t;return n*n<xi*e*t?0:e<t?-1:1},Ei=function(){function r(){ke(this,r),this.reset()}return me(r,[{key:"reset",value:function(){this.xRounder=new Yn,this.yRounder=new Yn}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Yn=function(){function r(){ke(this,r),this.tree=new Sn,this.round(0)}return me(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&un(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&un(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),St=new Ei,_t=function(e,t){return e.x*t.y-e.y*t.x},_r=function(e,t){return e.x*t.x+e.y*t.y},qn=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=_t(i,o);return un(s,0)},Bt=function(e){return Math.sqrt(_r(e,e))},Mi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return _t(o,i)/Bt(o)/Bt(i)},Li=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return _r(o,i)/Bt(o)/Bt(i)},Xn=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Hn=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},Oi=function(e,t,n,i){if(t.x===0)return Hn(n,i,e.x);if(i.x===0)return Hn(e,t,n.x);if(t.y===0)return Xn(n,i,e.y);if(i.y===0)return Xn(e,t,n.y);var o=_t(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},u=_t(s,t)/o,l=_t(s,i)/o,a=e.x+l*t.x,h=n.x+u*i.x,m=e.y+l*t.y,p=n.y+u*i.y,f=(a+h)/2,g=(m+p)/2;return{x:f,y:g}},Oe=function(){me(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:$t.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){ke(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return me(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(u){var l=u.otherSE;i.set(u,{sine:Mi(n.point,t.point,l.point),cosine:Li(n.point,t.point,l.point)})};return function(s,u){i.has(s)||o(s),i.has(u)||o(u);var l=i.get(s),a=l.sine,h=l.cosine,m=i.get(u),p=m.sine,f=m.cosine;return a>=0&&p>=0?h<f?1:h>f?-1:0:a<0&&p<0?h<f?-1:h>f?1:0:p<a?-1:p>a?1:0}}}]),r}(),Ci=0,$t=function(){me(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,u=n.rightSE.point.x;if(u<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,a=n.leftSE.point.y,h=t.rightSE.point.y,m=n.rightSE.point.y;if(i<o){if(a<l&&a<h)return 1;if(a>l&&a>h)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<a&&l<m)return-1;if(l>a&&l>m)return 1;var g=n.comparePoint(t.leftSE.point);if(g!==0)return g;var v=t.comparePoint(n.rightSE.point);return v<0?1:v>0?-1:1}if(l<a)return-1;if(l>a)return 1;if(s<u){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>u){var x=t.comparePoint(n.rightSE.point);if(x<0)return 1;if(x>0)return-1}if(s!==u){var c=h-l,d=s-i,y=m-a,M=u-o;if(c>d&&y<M)return 1;if(c<d&&y>M)return-1}return s>u?1:s<u||h<m?-1:h>m?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){ke(this,r),this.id=++Ci,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return me(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,u=n.x+s*o.x;if(t.x===u)return 0;var l=(t.x-n.x)/o.x,a=n.y+l*o.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=ln(n,i);if(o===null)return null;var s=this.leftSE.point,u=this.rightSE.point,l=t.leftSE.point,a=t.rightSE.point,h=dt(n,l)&&this.comparePoint(l)===0,m=dt(i,s)&&t.comparePoint(s)===0,p=dt(n,a)&&this.comparePoint(a)===0,f=dt(i,u)&&t.comparePoint(u)===0;if(m&&h)return f&&!p?u:!f&&p?a:null;if(m)return p&&s.x===a.x&&s.y===a.y?null:s;if(h)return f&&u.x===l.x&&u.y===l.y?null:l;if(f&&p)return null;if(f)return u;if(p)return a;var g=Oi(s,this.vector(),l,t.vector());return g===null||!dt(o,g)?null:St.round(g.x,g.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Oe(t,!0),s=new Oe(t,!1),u=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,u,this.rings.slice(),this.windings.slice());return Oe.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Oe.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var u=n;n=i,i=u}for(var l=0,a=i.rings.length;l<a;l++){var h=i.rings[l],m=i.windings[l],p=n.rings.indexOf(h);p===-1?(n.rings.push(h),n.windings.push(m)):n.windings[p]+=m}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,u=this.rings.length;s<u;s++){var l=this.rings[s],a=this.windings[s],h=n.indexOf(l);h===-1?(n.push(l),i.push(a)):i[h]+=a}for(var m=[],p=[],f=0,g=n.length;f<g;f++)if(i[f]!==0){var v=n[f],_=v.poly;if(p.indexOf(_)===-1)if(v.isExterior)m.push(_);else{p.indexOf(_)===-1&&p.push(_);var x=m.indexOf(v.poly);x!==-1&&m.splice(x,1)}}for(var c=0,d=m.length;c<d;c++){var y=m[c].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ee.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,u;t.length<n.length?(s=t.length,u=n.length):(s=n.length,u=t.length),this._isInResult=u===Ee.numMultiPolys&&s<u;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var a=function(m){return m.length===1&&m[0].isSubject};this._isInResult=a(t)!==a(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ee.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,u,l=Oe.comparePoints(t,n);if(l<0)o=t,s=n,u=1;else if(l>0)o=n,s=t,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var a=new Oe(o,!0),h=new Oe(s,!1);return new r(a,h,[i],[u])}}]),r}(),Un=function(){function r(e,t,n){if(ke(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=St.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,u=e.length;s<u;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=St.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push($t.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push($t.fromRing(o,i,this))}return me(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),Pi=function(){function r(e,t){if(ke(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Un(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Un(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return me(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),Jn=function(){function r(e,t){if(ke(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new Pi(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return me(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),Fi=function(){me(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var u=null,l=s.leftSE,a=s.rightSE,h=[l],m=l.point,p=[];u=l,l=a,h.push(l),l.point!==m;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var g=h[0].point,v=h[h.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(g.x,",")+" ".concat(g.y,"]. Last matching segment found ends at")+" [".concat(v.x,", ").concat(v.y,"]."))}if(f.length===1){a=f[0].otherSE;break}for(var _=null,x=0,c=p.length;x<c;x++)if(p[x].point===l.point){_=x;break}if(_!==null){var d=p.splice(_)[0],y=h.splice(d.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}p.push({index:h.length,point:l.point});var M=l.getLeftmostComparator(u);a=f.sort(M)[0].otherSE;break}n.push(new r(h))}}return n}}]);function r(e){ke(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return me(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,u=this.events[i+1].point;qn(s,t,u)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],a=n[1];qn(l,t,a)===0&&n.shift(),n.push(n[0]);for(var h=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,f=[],g=m;g!=p;g+=h)f.push([n[g].x,n[g].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Oe.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),u=s?s.prevInResult():null;;){if(!s)return null;if(!u)return s.ringOut;if(u.ringOut!==s.ringOut)return u.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=u.prevInResult(),u=s?s.prevInResult():null}}}]),r}(),zn=function(){function r(e){ke(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return me(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),Ri=function(){function r(e){ke(this,r),this.rings=e,this.polys=this._composePolys(e)}return me(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new zn(s));else{var u=s.enclosingRing();u.poly||n.push(new zn(u)),u.poly.addInterior(s)}}return n}}]),r}(),Ai=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$t.compare;ke(this,r),this.queue=e,this.tree=new Sn(t),this.segments=[]}return me(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,u=o,l=void 0,a=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;a===void 0;)u=this.tree.next(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);if(t.isLeft){var h=null;if(l){var m=l.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(h=m),!l.isAnEndpoint(m)))for(var p=this._splitSafely(l,m),f=0,g=p.length;f<g;f++)i.push(p[f])}var v=null;if(a){var _=a.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(v=_),!a.isAnEndpoint(_)))for(var x=this._splitSafely(a,_),c=0,d=x.length;c<d;c++)i.push(x[c])}if(h!==null||v!==null){var y=null;if(h===null)y=v;else if(v===null)y=h;else{var M=Oe.comparePoints(h,v);y=M<=0?h:v}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var C=n.split(y),L=0,O=C.length;L<O;L++)i.push(C[L])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&a){var A=l.getIntersection(a);if(A!==null){if(!l.isAnEndpoint(A))for(var B=this._splitSafely(l,A),I=0,G=B.length;I<G;I++)i.push(B[I]);if(!a.isAnEndpoint(A))for(var E=this._splitSafely(a,A),N=0,ie=E.length;N<ie;N++)i.push(E[N])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Wn=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ii=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Ti=function(){function r(){ke(this,r)}return me(r,[{key:"run",value:function(t,n,i){Ee.type=t,St.reset();for(var o=[new Jn(n,!0)],s=0,u=i.length;s<u;s++)o.push(new Jn(i[s],!1));if(Ee.numMultiPolys=o.length,Ee.type==="difference")for(var l=o[0],a=1;a<o.length;)ln(o[a].bbox,l.bbox)!==null?a++:o.splice(a,1);if(Ee.type==="intersection"){for(var h=0,m=o.length;h<m;h++)for(var p=o[h],f=h+1,g=o.length;f<g;f++)if(ln(p.bbox,o[f].bbox)===null)return[]}for(var v=new Sn(Oe.compare),_=0,x=o.length;_<x;_++)for(var c=o[_].getSweepEvents(),d=0,y=c.length;d<y;d++)if(v.insert(c[d]),v.size>Wn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new Ai(v),C=v.size,L=v.pop();L;){var O=L.key;if(v.size===C){var A=O.segment;throw new Error("Unable to pop() ".concat(O.isLeft?"left":"right"," SweepEvent ")+"[".concat(O.point.x,", ").concat(O.point.y,"] from segment #").concat(A.id," ")+"[".concat(A.leftSE.point.x,", ").concat(A.leftSE.point.y,"] -> ")+"[".concat(A.rightSE.point.x,", ").concat(A.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(v.size>Wn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>Ii)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var B=M.process(O),I=0,G=B.length;I<G;I++){var E=B[I];E.consumedBy===void 0&&v.insert(E)}C=v.size,L=v.pop()}St.reset();var N=Fi.factory(M.segments),ie=new Ri(N);return ie.getGeom()}}]),r}(),Ee=new Ti,Ni=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ee.run("union",e,n)},Bi=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ee.run("intersection",e,n)},$i=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ee.run("xor",e,n)},Di=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ee.run("difference",e,n)},Ct={union:Ni,intersection:Bi,xor:$i,difference:Di};function Gi(r,e){var t=Yi(e),n=null;return r.type==="FeatureCollection"?n=ji(r):n=br(Ct.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function ji(r){var e=r.features.length===2?Ct.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Ct.union.apply(Ct,r.features.map(function(t){return t.geometry.coordinates}));return br(e)}function br(r){return Gr(r)}function Yi(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return jr(t)}function qi(r,e,t){let n;te(r,Fe,s=>t(1,n=s));let{boundaryGeojson:i}=e;return Yr("setCamera")&&n.fitBounds(vn(i),{padding:20,animate:!1}),Ve(n,"boundary",{type:"geojson",data:Gi(i)}),ge(n,{id:"boundary",source:"boundary",...yn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class Xi extends Q{constructor(e){super(),ee(this,e,qi,null,Z,{boundaryGeojson:0})}}function Vn(r){let e,t=Zn(r[4])+"",n,i,o,s,u;return{c(){e=V("Length: "),n=V(t),i=F(),o=w("br"),s=F(),u=w("br")},m(l,a){k(l,e,a),k(l,n,a),k(l,i,a),k(l,o,a),k(l,s,a),k(l,u,a)},p(l,a){a&16&&t!==(t=Zn(l[4])+"")&&_n(n,t)},d(l){l&&S(e),l&&S(n),l&&S(i),l&&S(o),l&&S(s),l&&S(u)}}}function Hi(r){let e,t,n,i,o,s,u,l,a,h,m,p,f,g,v,_,x,c,d,y,M,C,L,O,A,B,I,G,E,N,ie,pe,we,oe,ve,Se,de,K,Ze,Ne,Be,ue,fe,Ke,$e,pt,re,ce=r[4]&&Vn(r);return{c(){e=w("label"),t=V("Name:"),n=w("br"),i=F(),o=w("input"),s=F(),u=w("br"),l=F(),a=w("br"),h=F(),m=w("label"),p=w("input"),f=V(`
  Area`),g=F(),v=w("label"),_=w("input"),x=V(`
  Route`),c=F(),d=w("label"),y=w("input"),M=V(`
  Crossing`),C=F(),L=w("label"),O=w("input"),A=V(`
  Other`),B=F(),I=w("br"),G=F(),E=w("br"),N=F(),ie=w("label"),pe=V("Description:"),we=w("br"),oe=F(),ve=w("textarea"),Se=F(),de=w("br"),K=F(),Ze=w("br"),Ne=F(),ce&&ce.c(),Be=F(),ue=w("div"),fe=w("button"),fe.textContent="Delete",Ke=F(),$e=w("button"),$e.textContent="Save",P(o,"type","text"),_e(o,"width","100%"),P(p,"type","radio"),p.__value="area",p.value=p.__value,r[7][0].push(p),P(_,"type","radio"),_.__value="route",_.value=_.__value,r[7][0].push(_),P(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[7][0].push(y),P(O,"type","radio"),O.__value="other",O.value=O.__value,r[7][0].push(O),_e(ve,"width","100%"),P(ve,"rows","5"),P(ve,"class","svelte-15lna0i"),P(fe,"type","button"),P($e,"type","button"),_e(ue,"display","flex"),_e(ue,"justify-content","space-between")},m(R,j){k(R,e,j),b(e,t),b(e,n),b(e,i),b(e,o),it(o,r[0]),k(R,s,j),k(R,u,j),k(R,l,j),k(R,a,j),k(R,h,j),k(R,m,j),b(m,p),p.checked=p.__value===r[1],b(m,f),k(R,g,j),k(R,v,j),b(v,_),_.checked=_.__value===r[1],b(v,x),k(R,c,j),k(R,d,j),b(d,y),y.checked=y.__value===r[1],b(d,M),k(R,C,j),k(R,L,j),b(L,O),O.checked=O.__value===r[1],b(L,A),k(R,B,j),k(R,I,j),k(R,G,j),k(R,E,j),k(R,N,j),k(R,ie,j),b(ie,pe),b(ie,we),b(ie,oe),b(ie,ve),it(ve,r[2]),k(R,Se,j),k(R,de,j),k(R,K,j),k(R,Ze,j),k(R,Ne,j),ce&&ce.m(R,j),k(R,Be,j),k(R,ue,j),b(ue,fe),b(ue,Ke),b(ue,$e),pt||(re=[Y(o,"input",r[5]),Y(p,"change",r[6]),Y(_,"change",r[8]),Y(y,"change",r[9]),Y(O,"change",r[10]),Y(ve,"input",r[11]),Y(fe,"click",r[12]),Y($e,"click",r[13])],pt=!0)},p(R,[j]){j&1&&o.value!==R[0]&&it(o,R[0]),j&2&&(p.checked=p.__value===R[1]),j&2&&(_.checked=_.__value===R[1]),j&2&&(y.checked=y.__value===R[1]),j&2&&(O.checked=O.__value===R[1]),j&4&&it(ve,R[2]),R[4]?ce?ce.p(R,j):(ce=Vn(R),ce.c(),ce.m(Be.parentNode,Be)):ce&&(ce.d(1),ce=null)},i:H,o:H,d(R){R&&S(e),R&&S(s),R&&S(u),R&&S(l),R&&S(a),R&&S(h),R&&S(m),r[7][0].splice(r[7][0].indexOf(p),1),R&&S(g),R&&S(v),r[7][0].splice(r[7][0].indexOf(_),1),R&&S(c),R&&S(d),r[7][0].splice(r[7][0].indexOf(y),1),R&&S(C),R&&S(L),r[7][0].splice(r[7][0].indexOf(O),1),R&&S(B),R&&S(I),R&&S(G),R&&S(E),R&&S(N),R&&S(ie),R&&S(Se),R&&S(de),R&&S(K),R&&S(Ze),R&&S(Ne),ce&&ce.d(R),R&&S(Be),R&&S(ue),pt=!1,Je(re)}}}function Zn(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Ui(r,e,t){let{id:n}=e,{name:i}=e,{intervention_type:o}=e,{description:s}=e,{length_meters:u}=e;const l=[[]];function a(){i=this.value,t(0,i)}function h(){o=this.__value,t(1,o)}function m(){o=this.__value,t(1,o)}function p(){o=this.__value,t(1,o)}function f(){o=this.__value,t(1,o)}function g(){s=this.value,t(2,s)}const v=()=>yr(n),_=()=>be.set(null);return r.$$set=x=>{"id"in x&&t(3,n=x.id),"name"in x&&t(0,i=x.name),"intervention_type"in x&&t(1,o=x.intervention_type),"description"in x&&t(2,s=x.description),"length_meters"in x&&t(4,u=x.length_meters)},[i,o,s,n,u,a,h,l,m,p,f,g,v,_]}class Ji extends Q{constructor(e){super(),ee(this,e,Ui,Hi,Z,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}function zi(r){const e=r-1;return e*e*e+1}function Kn(r,{delay:e=0,duration:t=400,easing:n=zi}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),u=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),a=parseFloat(i.marginTop),h=parseFloat(i.marginBottom),m=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*u}px;padding-bottom: ${f*l}px;margin-top: ${f*a}px;margin-bottom: ${f*h}px;border-top-width: ${f*m}px;border-bottom-width: ${f*p}px;`}}function Qn(r){let e,t,n,i,o;const s=r[10].default,u=gt(s,r,r[9],null);return{c(){e=w("div"),u&&u.c(),_e(e,"border","solid 1px black"),_e(e,"padding","10px")},m(l,a){k(l,e,a),u&&u.m(e,null),r[13](e),n=!0,i||(o=Y(e,"introend",r[14]),i=!0)},p(l,a){u&&u.p&&(!n||a&512)&&mt(u,s,l,l[9],n?yt(s,l[9],a,null):vt(l[9]),null)},i(l){n||(T(u,l),vr(()=>{t||(t=An(e,Kn,{duration:100},!0)),t.run(1)}),n=!0)},o(l){$(u,l),t||(t=An(e,Kn,{duration:100},!1)),t.run(0),n=!1},d(l){l&&S(e),u&&u.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Wi(r){let e,t,n,i,o,s,u,l,a,h,m=r[4]&&Qn(r);return{c(){e=w("button"),t=Fn("svg"),n=Fn("path"),i=F(),o=V(r[1]),s=F(),m&&m.c(),u=Me(),P(n,"d","M9 5l7 7-7 7"),P(t,"style","tran"),P(t,"width","20"),P(t,"height","20"),P(t,"fill","none"),P(t,"stroke-linecap","round"),P(t,"stroke-linejoin","round"),P(t,"stroke-width","2"),P(t,"viewBox","0 0 24 24"),P(t,"stroke","currentColor"),P(t,"class","svelte-t7fpgu"),P(e,"aria-expanded",r[4]),P(e,"class","svelte-t7fpgu"),Rn(e,"underlined",r[3])},m(p,f){k(p,e,f),b(e,t),b(t,n),b(e,i),b(e,o),k(p,s,f),m&&m.m(p,f),k(p,u,f),l=!0,a||(h=[Y(e,"click",r[5]),Y(e,"mouseenter",r[11]),Y(e,"mouseleave",r[12])],a=!0)},p(p,[f]){(!l||f&2)&&_n(o,p[1]),(!l||f&16)&&P(e,"aria-expanded",p[4]),(!l||f&8)&&Rn(e,"underlined",p[3]),p[4]?m?(m.p(p,f),f&16&&T(m,1)):(m=Qn(p),m.c(),T(m,1),m.m(u.parentNode,u)):m&&(Ie(),$(m,1,1,()=>{m=null}),Te())},i(p){l||(T(m),l=!0)},o(p){$(m),l=!1},d(p){p&&S(e),p&&S(s),m&&m.d(p),p&&S(u),a=!1,Je(h)}}}function Vi(r,e,t){let n,i,o,s;te(r,Ae,c=>t(7,o=c)),te(r,be,c=>t(8,s=c));let{$$slots:u={},$$scope:l}=e,{id:a}=e,{label:h}=e;const m=()=>{be.update(c=>c==a?null:a),s==a&&(tn.set(null),tn.set(a))};let p;function f(){p==null||p.scrollIntoView({behavior:"smooth"})}const g=()=>Nt.set(a),v=()=>Nt.set(null);function _(c){he[c?"unshift":"push"](()=>{p=c,t(2,p)})}const x=()=>f();return r.$$set=c=>{"id"in c&&t(0,a=c.id),"label"in c&&t(1,h=c.label),"$$scope"in c&&t(9,l=c.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==a),r.$$.dirty&129&&t(3,i=o==a)},[a,h,p,i,n,m,f,o,s,l,u,g,v,_,x]}class Zi extends Q{constructor(e){super(),ee(this,e,Vi,Wi,Z,{id:0,label:1})}}function er(r,e,t){const n=r.slice();return n[6]=e[t],n[7]=e,n[8]=t,n}function Ki(r){let e,t,n,i,o,s;function u(m){r[2](m,r[6])}function l(m){r[3](m,r[6])}function a(m){r[4](m,r[6])}let h={id:r[6].id,length_meters:r[6].properties.length_meters};return r[6].properties.name!==void 0&&(h.name=r[6].properties.name),r[6].properties.intervention_type!==void 0&&(h.intervention_type=r[6].properties.intervention_type),r[6].properties.description!==void 0&&(h.description=r[6].properties.description),e=new Ji({props:h}),he.push(()=>ze(e,"name",u,r[6].properties.name)),he.push(()=>ze(e,"intervention_type",l,r[6].properties.intervention_type)),he.push(()=>ze(e,"description",a,r[6].properties.description)),{c(){U(e.$$.fragment),o=F()},m(m,p){J(e,m,p),k(m,o,p),s=!0},p(m,p){r=m;const f={};p&1&&(f.id=r[6].id),p&1&&(f.length_meters=r[6].properties.length_meters),!t&&p&1&&(t=!0,f.name=r[6].properties.name,We(()=>t=!1)),!n&&p&1&&(n=!0,f.intervention_type=r[6].properties.intervention_type,We(()=>n=!1)),!i&&p&1&&(i=!0,f.description=r[6].properties.description,We(()=>i=!1)),e.$set(f)},i(m){s||(T(e.$$.fragment,m),s=!0)},o(m){$(e.$$.fragment,m),s=!1},d(m){z(e,m),m&&S(o)}}}function tr(r,e){let t,n,i;return n=new Zi({props:{id:e[6].id,label:e[8]+1+") "+nr(e[6]),$$slots:{default:[Ki]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=Me(),U(n.$$.fragment),this.first=t},m(o,s){k(o,t,s),J(n,o,s),i=!0},p(o,s){e=o;const u={};s&1&&(u.id=e[6].id),s&1&&(u.label=e[8]+1+") "+nr(e[6])),s&513&&(u.$$scope={dirty:s,ctx:e}),n.$set(u)},i(o){i||(T(n.$$.fragment,o),i=!0)},o(o){$(n.$$.fragment,o),i=!1},d(o){o&&S(t),z(n,o)}}}function Qi(r){let e=[],t=new Map,n,i,o,s,u=r[0].features;const l=a=>a[6].id;for(let a=0;a<u.length;a+=1){let h=er(r,u,a),m=l(h);t.set(m,e[a]=tr(m,h))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=Me()},m(a,h){for(let m=0;m<e.length;m+=1)e[m].m(a,h);k(a,n,h),i=!0,o||(s=Y(window,"keydown",r[1]),o=!0)},p(a,[h]){h&1&&(u=a[0].features,Ie(),e=qr(e,h,l,1,a,u,t,n.parentNode,Xr,tr,n,er),Te())},i(a){if(!i){for(let h=0;h<u.length;h+=1)T(e[h]);i=!0}},o(a){for(let h=0;h<e.length;h+=1)$(e[h]);i=!1},d(a){for(let h=0;h<e.length;h+=1)e[h].d(a);a&&S(n),o=!1,s()}}}function nr(r){if(r.properties.name)return r.properties.name;var e=r.properties.intervention_type;return e=="other"&&(r.geometry.type=="Point"?e="point":r.geometry.type=="LineString"?e="line":e="polygon"),`Untitled ${e}`}function eo(r,e,t){let n,i;te(r,be,a=>t(5,n=a)),te(r,ne,a=>t(0,i=a));function o(a){if(a.key=="Delete"){const h=a.target.tagName;if(h=="INPUT"||h=="TEXTAREA")return;a.preventDefault();const m=n;m&&yr(m)}}function s(a,h){r.$$.not_equal(h.properties.name,a)&&(h.properties.name=a,ne.set(i))}function u(a,h){r.$$.not_equal(h.properties.intervention_type,a)&&(h.properties.intervention_type=a,ne.set(i))}function l(a,h){r.$$.not_equal(h.properties.description,a)&&(h.properties.description=a,ne.set(i))}return[i,o,s,u,l]}class to extends Q{constructor(e){super(),ee(this,e,eo,Qi,Z,{})}}function He(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ce(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function an(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function je(r,e,t){t===void 0&&(t={});var n=He(r),i=He(e),o=xe(i[1]-n[1]),s=xe(i[0]-n[0]),u=xe(n[1]),l=xe(i[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return Hr(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),t.units)}function Pt(r,e){return e===void 0&&(e={}),Ur(r,function(t,n){var i=n.geometry.coordinates;return t+je(i[0],i[1],e)},0)}function no(r){let e,t,n,i,o,s,u,l,a,h,m,p,f,g,v,_,x,c,d,y=r[0].features.length+"",M,C,L,O,A,B,I,G;return{c(){e=w("div"),t=w("label"),n=V(`Scheme name:
    `),i=w("input"),o=F(),s=w("br"),u=F(),l=w("div"),a=w("label"),h=w("input"),m=F(),p=w("button"),p.textContent="Load from GeoJSON",f=F(),g=w("button"),g.textContent="Export to GeoJSON",v=F(),_=w("br"),x=F(),c=w("div"),d=w("span"),M=V(y),C=V(" interventions"),L=F(),O=w("button"),A=V("Clear all"),P(i,"type","text"),P(h,"type","file"),P(h,"id","load_geojson"),P(h,"class","svelte-lhyd1e"),P(p,"type","button"),P(g,"type","button"),P(g,"class","align-right svelte-lhyd1e"),P(O,"type","button"),P(O,"class","align-right svelte-lhyd1e"),O.disabled=B=r[0].features.length==0},m(E,N){k(E,e,N),b(e,t),b(t,n),b(t,i),it(i,r[0].scheme_name),k(E,o,N),k(E,s,N),k(E,u,N),k(E,l,N),b(l,a),b(a,h),b(a,m),b(a,p),b(l,f),b(l,g),k(E,v,N),k(E,_,N),k(E,x,N),k(E,c,N),b(c,d),b(d,M),b(d,C),b(c,L),b(c,O),b(O,A),I||(G=[Y(i,"input",r[5]),Y(h,"change",r[3]),Y(p,"click",io),Y(g,"click",r[2]),Y(O,"click",r[1])],I=!0)},p(E,[N]){N&1&&i.value!==E[0].scheme_name&&it(i,E[0].scheme_name),N&1&&y!==(y=E[0].features.length+"")&&_n(M,y),N&1&&B!==(B=E[0].features.length==0)&&(O.disabled=B)},i:H,o:H,d(E){E&&S(e),E&&S(o),E&&S(s),E&&S(u),E&&S(l),E&&S(v),E&&S(_),E&&S(x),E&&S(c),I=!1,Je(G)}}}function ro(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function io(){document.getElementById("load_geojson").click()}function oo(r,e,t){let n;te(r,ne,p=>t(0,n=p));let{authorityName:i}=e,o=window.localStorage.getItem(i);if(o)try{ne.set(h(JSON.parse(o)))}catch(p){console.log(`Failed to load from local storage: ${p}`)}function s(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&ne.update(p=>(delete p.scheme_name,p.features=[],p))}function u(){const p=JSON.parse(JSON.stringify(n));for(let f of p.features)delete f.properties.hide_while_editing;return p}function l(){let p=u();var f=i;p.authority=i,p.origin="atip-v1",p.scheme_name&&(f+="_"+p.scheme_name),f+=".txt",ro(f,JSON.stringify(p,null,"  "))}function a(p){const f=new FileReader;f.onload=v=>{try{ne.set(h(JSON.parse(v.target.result)))}catch(_){window.alert(`Couldn't load scheme from a file: ${_}`)}};let g=p.target.files;f.readAsText(g[0])}function h(p){let f=1;for(let g of p.features)g.properties||(g.properties={name:"",description:"",intervention_type:"other"}),g.geometry.type=="LineString"&&!g.properties.length_meters&&(g.properties.length_meters=Pt(g,{units:"kilometers"})*1e3),g.id=f++;return p}function m(){n.scheme_name=this.value,ne.set(n)}return r.$$set=p=>{"authorityName"in p&&t(4,i=p.authorityName)},r.$$.update=()=>{r.$$.dirty&17&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(i,JSON.stringify(u())))},[n,s,l,a,i,m]}class so extends Q{constructor(e){super(),ee(this,e,oo,no,Z,{authorityName:4})}}const lo="/atip/cancel/assets/zoom_out_map-b2e1091a.svg";function uo(r){let e,t,n,i,o;return{c(){e=w("button"),t=w("img"),Jr(t.src,n=lo)||P(t,"src",n),P(t,"alt","Zoom to show entire boundary"),P(e,"type","button"),P(e,"title","Zoom to show entire boundary"),P(e,"class","svelte-qzjsqo")},m(s,u){k(s,e,u),b(e,t),i||(o=Y(e,"click",r[0]),i=!0)},p:H,i:H,o:H,d(s){s&&S(e),i=!1,o()}}}function ao(r,e,t){let n;te(r,Fe,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(vn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class fo extends Q{constructor(e){super(),ee(this,e,ao,uo,Z,{boundaryGeojson:1})}}function co(r){let e,t,n,i,o,s,u;return{c(){e=w("div"),t=V(`Basemap:
  `),n=w("select"),i=w("option"),i.textContent="Streets",o=w("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&vr(()=>r[2].call(n)),P(e,"class","svelte-1tbnm6i")},m(l,a){k(l,e,a),b(e,t),b(e,n),b(n,i),b(n,o),In(n,r[0]),s||(u=[Y(n,"change",r[2]),Y(n,"change",r[1])],s=!0)},p(l,[a]){a&1&&In(n,l[0])},i:H,o:H,d(l){l&&S(e),s=!1,Je(u)}}}function ho(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let u=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=u}function o(){n=zr(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class po extends Q{constructor(e){super(),ee(this,e,ho,co,Z,{style:0})}}const ye={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",hovering:"black",lineEndpointColor:"black"},Jt=10,Dt=10;function go(r){let e,t,n,i,o,s,u,l,a,h,m,p,f,g,v,_,x,c,d;return{c(){e=w("div"),t=w("h1"),t.textContent="Interventions",n=F(),i=w("ul"),o=w("li"),s=w("span"),u=V("Areas"),l=F(),a=w("li"),h=w("span"),m=V("Routes"),p=F(),f=w("li"),g=w("span"),v=V("Crossings"),_=F(),x=w("li"),c=w("span"),d=V("Other"),P(t,"class","svelte-p551i1"),P(s,"class","svelte-p551i1"),_e(s,"background",ye.area),P(h,"class","svelte-p551i1"),_e(h,"background",ye.route),P(g,"class","svelte-p551i1"),_e(g,"background",ye.crossing),P(c,"class","svelte-p551i1"),_e(c,"background",ye.other),P(e,"class","svelte-p551i1")},m(y,M){k(y,e,M),b(e,t),b(e,n),b(e,i),b(i,o),b(o,s),b(o,u),b(i,l),b(i,a),b(a,h),b(a,m),b(i,p),b(i,f),b(f,g),b(f,v),b(i,_),b(i,x),b(x,c),b(x,d)},p:H,i:H,o:H,d(y){y&&S(e)}}}class mo extends Q{constructor(e){super(),ee(this,e,null,go,Z,{})}}let et="interventions";function vo(r,e,t){let n,i;te(r,Fe,l=>t(0,n=l)),te(r,ne,l=>t(1,i=l)),Ve(n,et,{type:"geojson",data:i});const o=["match",["get","intervention_type"],"area",ye.area,"route",ye.route,"crossing",ye.crossing,"other",ye.other,"white"],s=["!=","hide_while_editing",!0];return ge(n,{id:"interventions-points",source:et,filter:["all",Xt,s,["!=","endpoint",!0]],...ct(o,Jt)}),ge(n,{id:"interventions-lines",source:et,filter:["all",Ht,s],...kt(o,Dt)},"route-lines"),ge(n,{id:"interventions-lines-endpoints",source:et,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Dt,"circle-opacity":0,"circle-stroke-color":ye.lineEndpointColor,"circle-stroke-width":2}}),ge(n,{id:"interventions-polygons",source:et,filter:["all",bn,s],...yn(o,.5)},"hover-polygons"),r.$$.update=()=>{if(r.$$.dirty&3){let l=JSON.parse(JSON.stringify(i)),a=[];for(let h of l.features)if(h.geometry.type=="LineString")for(let m of[h.geometry.coordinates[0],h.geometry.coordinates[h.geometry.coordinates.length-1]])a.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:m}});l.features=l.features.concat(a),n.getSource(et).setData(l)}},[n,i]}class yo extends Q{constructor(e){super(),ee(this,e,vo,null,Z,{})}}let tt="hover";function _o(r,e,t){let n,i,o,s,u;return te(r,Fe,l=>t(0,n=l)),te(r,ne,l=>t(1,i=l)),te(r,Nt,l=>t(2,o=l)),te(r,Ae,l=>t(3,s=l)),te(r,be,l=>t(4,u=l)),Ve(n,tt,{type:"geojson",data:Pe()}),ge(n,{id:"hover-polygons",source:tt,filter:bn,...kt(ye.hovering,.5*Dt,1)}),ge(n,{id:"hover-lines",source:tt,filter:Ht,...kt(ye.hovering,1.5*Dt,1)},"interventions-lines"),ge(n,{id:"hover-points",source:tt,filter:Xt,...ct(ye.hovering,1.5*Jt,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=u||s||o;l!=null?n.getSource(tt).setData(i.features.find(a=>a.id==l)):n.getSource(tt).setData(Pe())}},[n,i,o,s,u]}class bo extends Q{constructor(e){super(),ee(this,e,_o,null,Z,{})}}class xn{constructor(e,t){W(this,"owner");W(this,"map");W(this,"mapHandlers",{});W(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Mt="edit-point-mode";class wo{constructor(e){W(this,"map");W(this,"active");W(this,"eventListenersSuccess");W(this,"eventListenersFailure");W(this,"cursor");W(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new xn(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Ve(e,Mt,{type:"geojson",data:Pe()}),ge(e,{id:"edit-point-mode",source:Mt,...ct(ye.hovering,Jt,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=ko(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Mt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Pe();this.cursor&&e.features.push(this.cursor),this.map.getSource(Mt).setData(e)}}function ko(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function wr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return So(r,e);var n=He(r),i=He(e),o=xe(n[0]),s=xe(i[0]),u=xe(n[1]),l=xe(i[1]),a=Math.sin(s-o)*Math.cos(l),h=Math.cos(u)*Math.sin(l)-Math.sin(u)*Math.cos(l)*Math.cos(s-o);return en(Math.atan2(a,h))}function So(r,e){var t=wr(e,r);return t=(t+180)%360,t}function rr(r,e,t,n){n===void 0&&(n={});var i=He(r),o=xe(i[0]),s=xe(i[1]),u=xe(t),l=Wr(e,n.units),a=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(u)),h=o+Math.atan2(Math.sin(u)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(a)),m=en(h),p=en(a);return lt([m,p],n.properties)}function fn(r){if(!r)throw new Error("geojson is required");var e=[];return wn(r,function(t){xo(t,e)}),Xe(e)}function xo(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ce(n);break;case"LineString":t=[Ce(n)]}t.forEach(function(i){var o=Eo(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Eo(r,e){var t=[];return r.reduce(function(n,i){var o=ut([n,i],e);return o.bbox=Mo(n,i),t.push(o),i}),t}function Mo(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,u=n<o?n:o,l=t>i?t:i,a=n>o?n:o;return[s,u,l,a]}var at={},Lo={get exports(){return at},set exports(r){at=r}},cn={},Oo={get exports(){return cn},set exports(r){cn=r}};(function(r,e){(function(t,n){r.exports=n()})(Vr,function(){function t(c,d,y,M,C){(function L(O,A,B,I,G){for(;I>B;){if(I-B>600){var E=I-B+1,N=A-B+1,ie=Math.log(E),pe=.5*Math.exp(2*ie/3),we=.5*Math.sqrt(ie*pe*(E-pe)/E)*(N-E/2<0?-1:1),oe=Math.max(B,Math.floor(A-N*pe/E+we)),ve=Math.min(I,Math.floor(A+(E-N)*pe/E+we));L(O,A,oe,ve,G)}var Se=O[A],de=B,K=I;for(n(O,B,A),G(O[I],Se)>0&&n(O,B,I);de<K;){for(n(O,de,K),de++,K--;G(O[de],Se)<0;)de++;for(;G(O[K],Se)>0;)K--}G(O[B],Se)===0?n(O,B,K):n(O,++K,I),K<=A&&(B=K+1),A<=K&&(I=K-1)}})(c,d,y||0,M||c.length-1,C||i)}function n(c,d,y){var M=c[d];c[d]=c[y],c[y]=M}function i(c,d){return c<d?-1:c>d?1:0}var o=function(c){c===void 0&&(c=9),this._maxEntries=Math.max(4,c),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(c,d,y){if(!y)return d.indexOf(c);for(var M=0;M<d.length;M++)if(y(c,d[M]))return M;return-1}function u(c,d){l(c,0,c.children.length,d,c)}function l(c,d,y,M,C){C||(C=_(null)),C.minX=1/0,C.minY=1/0,C.maxX=-1/0,C.maxY=-1/0;for(var L=d;L<y;L++){var O=c.children[L];a(C,c.leaf?M(O):O)}return C}function a(c,d){return c.minX=Math.min(c.minX,d.minX),c.minY=Math.min(c.minY,d.minY),c.maxX=Math.max(c.maxX,d.maxX),c.maxY=Math.max(c.maxY,d.maxY),c}function h(c,d){return c.minX-d.minX}function m(c,d){return c.minY-d.minY}function p(c){return(c.maxX-c.minX)*(c.maxY-c.minY)}function f(c){return c.maxX-c.minX+(c.maxY-c.minY)}function g(c,d){return c.minX<=d.minX&&c.minY<=d.minY&&d.maxX<=c.maxX&&d.maxY<=c.maxY}function v(c,d){return d.minX<=c.maxX&&d.minY<=c.maxY&&d.maxX>=c.minX&&d.maxY>=c.minY}function _(c){return{children:c,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function x(c,d,y,M,C){for(var L=[d,y];L.length;)if(!((y=L.pop())-(d=L.pop())<=M)){var O=d+Math.ceil((y-d)/M/2)*M;t(c,O,d,y,C),L.push(d,O,O,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(c){var d=this.data,y=[];if(!v(c,d))return y;for(var M=this.toBBox,C=[];d;){for(var L=0;L<d.children.length;L++){var O=d.children[L],A=d.leaf?M(O):O;v(c,A)&&(d.leaf?y.push(O):g(c,A)?this._all(O,y):C.push(O))}d=C.pop()}return y},o.prototype.collides=function(c){var d=this.data;if(!v(c,d))return!1;for(var y=[];d;){for(var M=0;M<d.children.length;M++){var C=d.children[M],L=d.leaf?this.toBBox(C):C;if(v(c,L)){if(d.leaf||g(c,L))return!0;y.push(C)}}d=y.pop()}return!1},o.prototype.load=function(c){if(!c||!c.length)return this;if(c.length<this._minEntries){for(var d=0;d<c.length;d++)this.insert(c[d]);return this}var y=this._build(c.slice(),0,c.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(c){return c&&this._insert(c,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(c,d){if(!c)return this;for(var y,M,C,L=this.data,O=this.toBBox(c),A=[],B=[];L||A.length;){if(L||(L=A.pop(),M=A[A.length-1],y=B.pop(),C=!0),L.leaf){var I=s(c,L.children,d);if(I!==-1)return L.children.splice(I,1),A.push(L),this._condense(A),this}C||L.leaf||!g(L,O)?M?(y++,L=M.children[y],C=!1):L=null:(A.push(L),B.push(y),y=0,M=L,L=L.children[0])}return this},o.prototype.toBBox=function(c){return c},o.prototype.compareMinX=function(c,d){return c.minX-d.minX},o.prototype.compareMinY=function(c,d){return c.minY-d.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(c){return this.data=c,this},o.prototype._all=function(c,d){for(var y=[];c;)c.leaf?d.push.apply(d,c.children):y.push.apply(y,c.children),c=y.pop();return d},o.prototype._build=function(c,d,y,M){var C,L=y-d+1,O=this._maxEntries;if(L<=O)return u(C=_(c.slice(d,y+1)),this.toBBox),C;M||(M=Math.ceil(Math.log(L)/Math.log(O)),O=Math.ceil(L/Math.pow(O,M-1))),(C=_([])).leaf=!1,C.height=M;var A=Math.ceil(L/O),B=A*Math.ceil(Math.sqrt(O));x(c,d,y,B,this.compareMinX);for(var I=d;I<=y;I+=B){var G=Math.min(I+B-1,y);x(c,I,G,A,this.compareMinY);for(var E=I;E<=G;E+=A){var N=Math.min(E+A-1,G);C.children.push(this._build(c,E,N,M-1))}}return u(C,this.toBBox),C},o.prototype._chooseSubtree=function(c,d,y,M){for(;M.push(d),!d.leaf&&M.length-1!==y;){for(var C=1/0,L=1/0,O=void 0,A=0;A<d.children.length;A++){var B=d.children[A],I=p(B),G=(E=c,N=B,(Math.max(N.maxX,E.maxX)-Math.min(N.minX,E.minX))*(Math.max(N.maxY,E.maxY)-Math.min(N.minY,E.minY))-I);G<L?(L=G,C=I<C?I:C,O=B):G===L&&I<C&&(C=I,O=B)}d=O||d.children[0]}var E,N;return d},o.prototype._insert=function(c,d,y){var M=y?c:this.toBBox(c),C=[],L=this._chooseSubtree(M,this.data,d,C);for(L.children.push(c),a(L,M);d>=0&&C[d].children.length>this._maxEntries;)this._split(C,d),d--;this._adjustParentBBoxes(M,C,d)},o.prototype._split=function(c,d){var y=c[d],M=y.children.length,C=this._minEntries;this._chooseSplitAxis(y,C,M);var L=this._chooseSplitIndex(y,C,M),O=_(y.children.splice(L,y.children.length-L));O.height=y.height,O.leaf=y.leaf,u(y,this.toBBox),u(O,this.toBBox),d?c[d-1].children.push(O):this._splitRoot(y,O)},o.prototype._splitRoot=function(c,d){this.data=_([c,d]),this.data.height=c.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(c,d,y){for(var M,C,L,O,A,B,I,G=1/0,E=1/0,N=d;N<=y-d;N++){var ie=l(c,0,N,this.toBBox),pe=l(c,N,y,this.toBBox),we=(C=ie,L=pe,O=void 0,A=void 0,B=void 0,I=void 0,O=Math.max(C.minX,L.minX),A=Math.max(C.minY,L.minY),B=Math.min(C.maxX,L.maxX),I=Math.min(C.maxY,L.maxY),Math.max(0,B-O)*Math.max(0,I-A)),oe=p(ie)+p(pe);we<G?(G=we,M=N,E=oe<E?oe:E):we===G&&oe<E&&(E=oe,M=N)}return M||y-d},o.prototype._chooseSplitAxis=function(c,d,y){var M=c.leaf?this.compareMinX:h,C=c.leaf?this.compareMinY:m;this._allDistMargin(c,d,y,M)<this._allDistMargin(c,d,y,C)&&c.children.sort(M)},o.prototype._allDistMargin=function(c,d,y,M){c.children.sort(M);for(var C=this.toBBox,L=l(c,0,d,C),O=l(c,y-d,y,C),A=f(L)+f(O),B=d;B<y-d;B++){var I=c.children[B];a(L,c.leaf?C(I):I),A+=f(L)}for(var G=y-d-1;G>=d;G--){var E=c.children[G];a(O,c.leaf?C(E):E),A+=f(O)}return A},o.prototype._adjustParentBBoxes=function(c,d,y){for(var M=y;M>=0;M--)a(d[M],c)},o.prototype._condense=function(c){for(var d=c.length-1,y=void 0;d>=0;d--)c[d].children.length===0?d>0?(y=c[d-1].children).splice(y.indexOf(c[d]),1):this.clear():u(c[d],this.toBBox)},o})})(Oo);const Co=kn(Zr),Po=kn(Kr),Fo=kn(Qr);var Le=cn,kr=Co,Sr=Po,nt=Fo.default,Ro=Sr.featureEach;Sr.coordEach;kr.polygon;var ir=kr.featureCollection;function xr(r){var e=new Le(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:nt(t),Le.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:nt(i),n.push(i)}):Ro(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:nt(i),n.push(i)}),Le.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:nt(t),Le.prototype.remove.call(this,t,n)},e.clear=function(){return Le.prototype.clear.call(this)},e.search=function(t){var n=Le.prototype.search.call(this,this.toBBox(t));return ir(n)},e.collides=function(t){return Le.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Le.prototype.all.call(this);return ir(t)},e.toJSON=function(){return Le.prototype.toJSON.call(this)},e.fromJSON=function(t){return Le.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=nt(t);else if(t.type==="FeatureCollection")n=nt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Lo.exports=xr;at.default=xr;function Er(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Tn(r)),e.type==="LineString"&&(e=Tn(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=or(r,e);return i&&n.push(i),Xe(n)}var o=at();return o.load(fn(e)),Tt(fn(r),function(s){Tt(o.search(s),function(u){var l=or(s,u);if(l){var a=Ce(l).join(",");t[a]||(t[a]=!0,n.push(l))}})}),Xe(n)}function or(r,e){var t=Ce(r),n=Ce(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],u=t[1][1],l=n[0][0],a=n[0][1],h=n[1][0],m=n[1][1],p=(m-a)*(s-i)-(h-l)*(u-o),f=(h-l)*(o-a)-(m-a)*(i-l),g=(s-i)*(o-a)-(u-o)*(i-l);if(p===0)return f===0&&g===0,null;var v=f/p,_=g/p;if(v>=0&&v<=1&&_>=0&&_<=1){var x=i+v*(s-i),c=o+v*(u-o);return lt([x,c])}return null}function xt(r,e,t){t===void 0&&(t={});var n=lt([1/0,1/0],{dist:1/0}),i=0;return wn(r,function(o){for(var s=Ce(o),u=0;u<s.length-1;u++){var l=lt(s[u]);l.properties.dist=je(e,l,t);var a=lt(s[u+1]);a.properties.dist=je(e,a,t);var h=je(l,a,t),m=Math.max(l.properties.dist,a.properties.dist),p=wr(l,a),f=rr(e,m,p+90,t),g=rr(e,m,p-90,t),v=Er(ut([f.geometry.coordinates,g.geometry.coordinates]),ut([l.geometry.coordinates,a.geometry.coordinates])),_=null;v.features.length>0&&(_=v.features[0],_.properties.dist=je(e,_,t),_.properties.location=i+je(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=u,n.properties.location=i),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=u+1,n.properties.location=i+h),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=u),i+=h}}),n}const rt="edit-polygon-mode";class Ao{constructor(e){W(this,"map");W(this,"active");W(this,"eventListenersSuccess");W(this,"eventListenersFailure");W(this,"points");W(this,"cursor");W(this,"hover");W(this,"dragFrom");W(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new xn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Ve(e,rt,{type:"geojson",data:Pe()}),ge(e,{id:"edit-polygon-fill",source:rt,filter:bn,...yn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),ge(e,{id:"edit-polygon-lines",source:rt,filter:Ht,...kt("black",8,.5)}),ge(e,{id:"edit-polygon-vertices",source:rt,filter:Xt,...ct(ye.hovering,Jt,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(lr(this.points).forEach((n,i)=>{t.push([i+1,xt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(rt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Pe();this.points.forEach((n,i)=>{let o=sr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(lr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(rt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=sr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function sr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function lr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let D;const Mr=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Mr.decode();let Ft=new Uint8Array;function bt(){return Ft.byteLength===0&&(Ft=new Uint8Array(D.memory.buffer)),Ft}function ot(r,e){return Mr.decode(bt().subarray(r,r+e))}const Re=new Array(32).fill(void 0);Re.push(void 0,null,!0,!1);let wt=Re.length;function se(r){wt===Re.length&&Re.push(Re.length+1);const e=wt;return wt=Re[e],Re[e]=r,e}function q(r){return Re[r]}function Io(r){r<36||(Re[r]=wt,wt=r)}function hn(r){const e=q(r);return Io(r),e}function Vt(r){return r==null}let Rt=new Float64Array;function To(){return Rt.byteLength===0&&(Rt=new Float64Array(D.memory.buffer)),Rt}let At=new Int32Array;function le(){return At.byteLength===0&&(At=new Int32Array(D.memory.buffer)),At}let qe=0;const It=new TextEncoder("utf-8"),No=typeof It.encodeInto=="function"?function(r,e){return It.encodeInto(r,e)}:function(r,e){const t=It.encode(r);return e.set(t),{read:r.length,written:t.length}};function Lt(r,e,t){if(t===void 0){const u=It.encode(r),l=e(u.length);return bt().subarray(l,l+u.length).set(u),qe=u.length,l}let n=r.length,i=e(n);const o=bt();let s=0;for(;s<n;s++){const u=r.charCodeAt(s);if(u>127)break;o[i+s]=u}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const u=bt().subarray(i+s,i+n),l=No(r,u);s+=l.written}return qe=s,i}function pn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=pn(r[0]));for(let s=1;s<i;s++)o+=", "+pn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Bo(r,e){const t=e(r.length*1);return bt().set(r,t/1),qe=r.length,t}function Zt(r,e){try{return r.apply(this,e)}catch(t){D.__wbindgen_exn_store(se(t))}}class Gt{static __wrap(e){const t=Object.create(Gt.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();D.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=D.__wbindgen_add_to_stack_pointer(-16),s=Bo(e,D.__wbindgen_malloc),u=qe;D.jsroutesnapper_new(o,s,u);var t=le()[o/4+0],n=le()[o/4+1],i=le()[o/4+2];if(i)throw hn(n);return Gt.__wrap(t)}finally{D.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){D.jsroutesnapper_setConfig(this.ptr,se(e))}toFinalFeature(){try{const n=D.__wbindgen_add_to_stack_pointer(-16);D.jsroutesnapper_toFinalFeature(n,this.ptr);var e=le()[n/4+0],t=le()[n/4+1];let i;return e!==0&&(i=ot(e,t).slice(),D.__wbindgen_free(e,t*1)),i}finally{D.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=D.__wbindgen_add_to_stack_pointer(-16);D.jsroutesnapper_renderGeojson(n,this.ptr);var e=le()[n/4+0],t=le()[n/4+1];return ot(e,t)}finally{D.__wbindgen_add_to_stack_pointer(16),D.__wbindgen_free(e,t)}}setSnapMode(e){D.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return D.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){D.jsroutesnapper_onClick(this.ptr)}onDragStart(){return D.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return D.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){D.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=D.__wbindgen_add_to_stack_pointer(-16);D.jsroutesnapper_editExisting(i,this.ptr,se(e));var t=le()[i/4+0],n=le()[i/4+1];if(n)throw hn(t)}finally{D.__wbindgen_add_to_stack_pointer(16)}}}async function $o(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Do(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=ot(e,t);return se(n)},r.wbg.__wbindgen_object_drop_ref=function(e){hn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=q(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ot(e,t));return se(n)},r.wbg.__wbindgen_is_object=function(e){const t=q(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return q(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return q(e)in q(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=q(t),i=typeof n=="number"?n:void 0;To()[e/8+1]=Vt(i)?0:i,le()[e/4+0]=!Vt(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return q(e)==q(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=q(t),i=typeof n=="string"?n:void 0;var o=Vt(i)?0:Lt(i,D.__wbindgen_malloc,D.__wbindgen_realloc),s=qe;le()[e/4+1]=s,le()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(q(t)),i=Lt(n,D.__wbindgen_malloc,D.__wbindgen_realloc),o=qe;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=q(e);return se(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=q(e)[q(t)];return se(n)},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(q(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=q(e)[t>>>0];return se(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return q(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof q(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=q(e).next;return se(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Zt(function(e){const t=q(e).next();return se(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return q(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=q(e).value;return se(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return se(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Zt(function(e,t){const n=Reflect.get(q(e),q(t));return se(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Zt(function(e,t){const n=q(e).call(q(t));return se(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(q(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=q(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=q(e).buffer;return se(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(q(e));return se(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){q(e).set(q(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return q(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=q(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return se(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=q(t).stack,i=Lt(n,D.__wbindgen_malloc,D.__wbindgen_realloc),o=qe;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(ot(e,t))}finally{D.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=pn(q(t)),i=Lt(n,D.__wbindgen_malloc,D.__wbindgen_realloc),o=qe;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ot(e,t))},r.wbg.__wbindgen_memory=function(){const e=D.memory;return se(e)},r}function Go(r,e){return D=r.exports,Lr.__wbindgen_wasm_module=e,Rt=new Float64Array,At=new Int32Array,Ft=new Uint8Array,D}async function Lr(r){typeof r>"u"&&(r="/atip/cancel/assets/route_snapper_bg.wasm");const e=Do();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await $o(await r,e);return Go(t,n)}const Ot="route-snapper",ur=10,jo=30;class Yo{constructor(e,t){W(this,"map");W(this,"inner");W(this,"active");W(this,"eventListenersSuccess");W(this,"eventListenersFailure");W(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Gt(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],Ve(e,Ot,{type:"geojson",data:Pe()}),ge(e,{id:"route-points",source:Ot,filter:Xt,...ct(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",ur/2,ur])}),ge(e,{id:"route-lines",source:Ot,filter:Ht,...kt("black",2.5)}),this.events=new xn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-jo,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}start(){this.active||(this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExisting(e){this.active&&window.alert("Bug: editExisting called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.start(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setConfig(e){this.inner.setConfig(e),this.redraw()}redraw(){this.map.getSource(Ot).setData(JSON.parse(this.inner.renderGeojson()))}}function ar(r){let e;function t(o,s){return o[1]?Xo:qo}let n=t(r),i=n(r);return{c(){i.c(),e=Me()},m(o,s){i.m(o,s),k(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&S(e)}}}function qo(r){let e;return{c(){e=w("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function Xo(r){let e;return{c(){e=w("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function Ho(r){let e,t=r[0]==st&&ar(r);return{c(){t&&t.c(),e=Me()},m(n,i){t&&t.m(n,i),k(n,e,i)},p(n,[i]){n[0]==st?t?t.p(n,i):(t=ar(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:H,o:H,d(n){t&&t.d(n),n&&S(e)}}}const st="edit-attribute";function Or(){}function Uo(r,e,t){let n,i,o,s;te(r,Fe,f=>t(5,n=f)),te(r,ne,f=>t(6,i=f)),te(r,tn,f=>t(7,o=f)),te(r,be,f=>t(1,s=f));let{mode:u}=e,{changeMode:l}=e;function a(){be.set(null)}n.on("mousemove",h),n.on("mouseout",m),n.on("click",p),ft(()=>{n.off("mousemove",h),n.off("mouseout",m),n.off("click",p)});function h(f){var g;if(u==st){let v=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ae.set(((g=v[0])==null?void 0:g.id)||null)}}function m(){u==st&&Ae.set(null)}function p(f){if(u==st){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0?be.set(g[0].id):be.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,u=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let g=i.features.find(v=>v.id==f);g.geometry.type=="Point"?n.flyTo({center:g.geometry.coordinates,duration:500}):n.fitBounds(vn(g),{padding:200,duration:500}),l(st)}}},[u,s,l,Or,a,n,i,o]}class Jo extends Q{constructor(e){super(),ee(this,e,Uo,Ho,Z,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Or}get stop(){return this.$$.ctx[4]}}function zo(r){let e;return{c(){e=w("p"),e.textContent="Click to add a new point"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function Wo(r){let e;return{c(){e=w("p"),e.textContent="Click to move the point here"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function Vo(r){let e,t,n,i;function o(l,a){return l[1]?Wo:zo}let s=o(r),u=s(r);return{c(){u.c(),e=F(),t=w("button"),t.textContent="Cancel",P(t,"type","button")},m(l,a){u.m(l,a),k(l,e,a),k(l,t,a),n||(i=Y(t,"click",r[2]),n=!0)},p(l,[a]){s!==(s=o(l))&&(u.d(1),u=s(l),u&&(u.c(),u.m(e.parentNode,e)))},i:H,o:H,d(l){u.d(l),l&&S(e),l&&S(t),n=!1,i()}}}function Zo(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Cr extends Q{constructor(e){super(),ee(this,e,Zo,Vo,Z,{pointTool:0,editingExisting:1})}}function Ko(r){let e,t,n,i,o,s,u,l;return{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li>`,t=F(),n=w("div"),i=w("button"),i.textContent="Finish",o=F(),s=w("button"),s.textContent="Cancel",P(i,"type","button"),P(s,"type","button"),_e(n,"display","flex"),_e(n,"justify-content","space-between")},m(a,h){k(a,e,h),k(a,t,h),k(a,n,h),b(n,i),b(n,o),b(n,s),u||(l=[Y(i,"click",r[1]),Y(s,"click",r[2])],u=!0)},p:H,i:H,o:H,d(a){a&&S(e),a&&S(t),a&&S(n),u=!1,Je(l)}}}function Qo(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Pr extends Q{constructor(e){super(),ee(this,e,Qo,Ko,Z,{polygonTool:0})}}function es(r){let e,t,n,i,o,s,u,l,a,h,m,p;return{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li>`,t=F(),n=w("label"),i=w("input"),o=V(`
  Avoid doubling back`),s=F(),u=w("div"),l=w("button"),l.textContent="Finish",a=F(),h=w("button"),h.textContent="Cancel",P(i,"type","checkbox"),P(l,"type","button"),P(h,"type","button"),_e(u,"display","flex"),_e(u,"justify-content","space-between")},m(f,g){k(f,e,g),k(f,t,g),k(f,n,g),b(n,i),i.checked=r[1],b(n,o),k(f,s,g),k(f,u,g),b(u,l),b(u,a),b(u,h),m||(p=[Y(i,"change",r[2]),Y(l,"click",r[3]),Y(h,"click",r[4])],m=!0)},p(f,[g]){g&2&&(i.checked=f[1])},i:H,o:H,d(f){f&&S(e),f&&S(t),f&&S(n),f&&S(s),f&&S(u),m=!1,Je(p)}}}function ts(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),u=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setConfig({avoid_doubling_back:i})},[n,i,o,s,u]}class Fr extends Q{constructor(e){super(),ee(this,e,ts,es,Z,{routeTool:0})}}function fr(r){let e,t,n,i;const o=[os,is,rs,ns],s=[];function u(l,a){return l[4]=="point"?0:l[4]=="polygon"?1:l[4]=="route"?2:3}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=Me()},m(l,a){s[e].m(l,a),k(l,n,a),i=!0},p(l,a){let h=e;e=u(l),e===h?s[e].p(l,a):(Ie(),$(s[h],1,1,()=>{s[h]=null}),Te(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){i||(T(t),i=!0)},o(l){$(t),i=!1},d(l){s[e].d(l),l&&S(n)}}}function ns(r){let e;return{c(){e=w("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){k(t,e,n)},p:H,i:H,o:H,d(t){t&&S(e)}}}function rs(r){let e,t;return e=new Fr({props:{routeTool:r[3]}}),{c(){U(e.$$.fragment)},m(n,i){J(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function is(r){let e,t;return e=new Pr({props:{polygonTool:r[2]}}),{c(){U(e.$$.fragment)},m(n,i){J(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function os(r){let e,t;return e=new Cr({props:{pointTool:r[1],editingExisting:!0}}),{c(){U(e.$$.fragment)},m(n,i){J(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function ss(r){let e,t,n=r[0]==De&&fr(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==De?n?(n.p(i,o),o&1&&T(n,1)):(n=fr(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Ie(),$(n,1,1,()=>{n=null}),Te())},i(i){t||(T(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const De="edit-geometry";function Rr(){}function ls(r,e,t){let n;te(r,Fe,v=>t(8,n=v));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:u}=e,l=null,a=null;function h(){l&&(o.stop(),s.stop(),u.stop(),ne.update(v=>{let _=v.features.find(x=>x.id==l);return delete _.properties.hide_while_editing,v})),l=null,t(4,a=null),Ae.set(null)}n.on("mousemove",m),n.on("mouseout",p),n.on("click",f),ft(()=>{n.off("mousemove",m),n.off("mouseout",p),n.off("click",f)}),u.addEventListenerSuccess(v=>{i==De&&(ne.update(_=>{let x=_.features.find(c=>c.id==l);return x.properties.length_meters=v.properties.length_meters,x.properties.waypoints=v.properties.waypoints,delete x.properties.hide_while_editing,x.geometry=v.geometry,_}),l=null,t(4,a=null))});for(let v of[o,s])v.addEventListenerSuccess(_=>{i==De&&(ne.update(x=>{let c=x.features.find(d=>d.id==l);return c.geometry=_.geometry,delete c.properties.hide_while_editing,x}),l=null,t(4,a=null))});for(let v of[o,s,u])v.addEventListenerFailure(()=>{i==De&&(ne.update(_=>{let x=_.features.find(c=>c.id==l);return delete x.properties.hide_while_editing,_}),l=null,t(4,a=null))});function m(v){var _;if(i==De&&l==null){let x=n.queryRenderedFeatures(v.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ae.set(((_=x[0])==null?void 0:_.id)||null)}}function p(){i==De&&l==null&&Ae.set(null)}function f(v){if(i==De&&l==null){let _=n.queryRenderedFeatures(v.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&g(_[0].id)}}function g(v){Ae.set(null);let _=null;ne.update(c=>(_=c.features.find(d=>d.id==v),_.properties.hide_while_editing=!0,c));let x=_;l=v,x.geometry.type=="LineString"?(u.editExisting(x),t(4,a="route")):x.geometry.type=="Polygon"?(s.editExisting(x),t(4,a="polygon")):x.geometry.type=="Point"&&(o.start(),t(4,a="point"))}return r.$$set=v=>{"mode"in v&&t(0,i=v.mode),"pointTool"in v&&t(1,o=v.pointTool),"polygonTool"in v&&t(2,s=v.polygonTool),"routeTool"in v&&t(3,u=v.routeTool)},[i,o,s,u,a,Rr,h]}class us extends Q{constructor(e){super(),ee(this,e,ls,ss,Z,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Rr}get stop(){return this.$$.ctx[6]}}async function as(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:a,value:h}=await n.read();if(a)break;s.push(h),o+=h.length;const m=100*o/i;e.style=`background: linear-gradient(to right, red ${m}%, transparent 0);`}let u=new Uint8Array(o),l=0;for(let a of s)u.set(a,l),l+=a.length;return u}function fs(r){let e,t;return e=new Fr({props:{routeTool:r[0]}}),{c(){U(e.$$.fragment)},m(n,i){J(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function cs(r){let e;return{c(){e=w("div"),e.textContent="Route tool loading..."},m(t,n){k(t,e,n),r[7](e)},p:H,i:H,o:H,d(t){t&&S(e),r[7](null)}}}function hs(r){let e,t,n,i;const o=[cs,fs],s=[];function u(l,a){return l[0]?l[1]==dn?1:-1:0}return~(e=u(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=Me()},m(l,a){~e&&s[e].m(l,a),k(l,n,a),i=!0},p(l,[a]){let h=e;e=u(l),e===h?~e&&s[e].p(l,a):(t&&(Ie(),$(s[h],1,1,()=>{s[h]=null}),Te()),~e?(t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),T(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(T(t),i=!0)},o(l){$(t),i=!1},d(l){~e&&s[e].d(l),l&&S(n)}}}const dn="route";function ps(r,e,t){let n;te(r,Fe,p=>t(8,n=p));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,u,{routeTool:l}=e;function a(){l.isActive()||l.start()}function h(){l==null||l.stop()}mn(async()=>{await Lr(),console.log(`Grabbing ${s}`);try{const p=await as(s,u);t(0,l=new Yo(n,p))}catch(p){console.log(`Route tool broke: ${p}`),t(2,u.innerHTML="Failed to load",u);return}l.addEventListenerFailure(()=>{i==dn&&o("edit-attribute")}),l.addEventListenerSuccess(p=>{i==dn&&(ne.update(f=>(p.id=Ut(f),p.properties.intervention_type="route",f.features.push(p),f)),o("edit-attribute"),be.set(p.id))})}),ft(()=>{l==null||l.tearDown()});function m(p){he[p?"unshift":"push"](()=>{u=p,t(2,u)})}return r.$$set=p=>{"mode"in p&&t(1,i=p.mode),"changeMode"in p&&t(3,o=p.changeMode),"url"in p&&t(4,s=p.url),"routeTool"in p&&t(0,l=p.routeTool)},[l,i,u,o,s,a,h,m]}class ds extends Q{constructor(e){super(),ee(this,e,ps,hs,Z,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function cr(r){let e,t;return e=new Cr({props:{pointTool:r[1],editingExisting:!1}}),{c(){U(e.$$.fragment)},m(n,i){J(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function gs(r){let e,t,n=r[0]==jt&&cr(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==jt?n?(n.p(i,o),o&1&&T(n,1)):(n=cr(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Ie(),$(n,1,1,()=>{n=null}),Te())},i(i){t||(T(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const jt="point";function ms(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==jt&&(ne.update(a=>(l.id=Ut(a),l.properties.intervention_type="other",a.features.push(l),a)),i("edit-attribute"),be.set(l.id))}),o.addEventListenerFailure(()=>{n==jt&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,u]}class vs extends Q{constructor(e){super(),ee(this,e,ms,gs,Z,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function hr(r){let e,t;return e=new Pr({props:{polygonTool:r[1]}}),{c(){U(e.$$.fragment)},m(n,i){J(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function ys(r){let e,t,n=r[0]==Yt&&hr(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==Yt?n?(n.p(i,o),o&1&&T(n,1)):(n=hr(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Ie(),$(n,1,1,()=>{n=null}),Te())},i(i){t||(T(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const Yt="polygon";function _s(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==Yt&&(ne.update(a=>(l.id=Ut(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),be.set(l.id))}),o.addEventListenerFailure(()=>{n==Yt&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,u]}class bs extends Q{constructor(e){super(),ee(this,e,_s,ys,Z,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ws(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=je(r.slice(0,2),[n,t]),s=je(r.slice(0,2),[e,i]);if(o>=s){var u=(t+i)/2;return[e,u-(n-e)/2,n,u+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function ks(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return ei(r,function(s){Ss(s,o,n)}),r}function Ss(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function xs(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=an(r),n=an(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=ks(e,{precision:7});switch(n){case"Point":return gn(r,i);case"MultiPoint":return pr(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return pr(r,Er(r,i))}}function pr(r,e){var t=[],n=at();return wn(e,function(i){if(t.forEach(function(u,l){u.id=l}),!t.length)t=gn(r,i).features,t.forEach(function(u){u.bbox||(u.bbox=ws(ti(u)))}),n.load(Xe(t));else{var o=n.search(i);if(o.features.length){var s=Ar(i,o);t=t.filter(function(u){return u.id!==s.id}),n.remove(s),Tt(gn(s,i),function(u){t.push(u),n.insert(u)})}}}),Xe(t)}function gn(r,e){var t=[],n=Ce(r)[0],i=Ce(r)[r.geometry.coordinates.length-1];if(Kt(n,He(e))||Kt(i,He(e)))return Xe([r]);var o=at(),s=fn(r);o.load(s);var u=o.search(e);if(!u.features.length)return Xe([r]);var l=Ar(e,u),a=[n],h=ni(s,function(m,p,f){var g=Ce(p)[1],v=He(e);return f===l.id?(m.push(v),t.push(ut(m)),Kt(v,g)?[v]:[v,g]):(m.push(g),m)},a);return h.length>1&&t.push(ut(h)),Xe(t)}function Ar(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return Tt(e,function(i){var o=xt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function Kt(r,e){return r[0]===e[0]&&r[1]===e[1]}function Es(r,e,t){var n=Ce(t);if(an(t)!=="LineString")throw new Error("line must be a LineString");var i=xt(t,r),o=xt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var u=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)u.push(n[l]);return u.push(s[1].geometry.coordinates),ut(u,t.properties)}function dr(r){let e;return{c(){e=w("p"),e.textContent="Click near a route to split it, or click on the map to cancel"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function Ms(r){let e,t=r[0]==qt&&dr();return{c(){t&&t.c(),e=Me()},m(n,i){t&&t.m(n,i),k(n,e,i)},p(n,[i]){n[0]==qt?t||(t=dr(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:H,o:H,d(n){t&&t.d(n),n&&S(e)}}}const qt="split-route",Ls=10,Os=30;let Qt="split-route";function Ir(){}function gr(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Cs(r,e,t){let n,i;te(r,ne,g=>t(7,n=g)),te(r,Fe,g=>t(5,i=g));let{mode:o}=e,{changeMode:s}=e;function u(){t(4,l=null),a=null}let l=null,a=null;i.on("mousemove",h),i.on("click",m),ft(()=>{i.off("mousemove",h),i.off("click",m)}),Ve(i,Qt,{type:"geojson",data:Pe()}),ge(i,{id:"draw-split-route",source:Qt,...ct("black",Ls,["case",["==",["get","snapped"],!0],1,.5])});function h(g){if(o!=qt)return;t(4,l=gr(g.lngLat.toArray(),!1)),a=null;const v=[g.point.x-Os,g.point.y],_=i.unproject(g.point).distanceTo(i.unproject(v))/1e3;let x=[];for(let[c,d]of n.features.entries())if(d.geometry.type=="LineString"){let y=xt(d.geometry,l,{units:"kilometers"});y.properties.dist!=null&&y.properties.dist<=_&&x.push([c,y.geometry.coordinates,y.properties.dist])}x.sort((c,d)=>c[2]-d[2]),x.length>0&&(t(4,l=gr(x[0][1],!0)),a=x[0][0])}function m(){if(o==qt)if(a==null)s("edit-attribute");else{let g=xs(n.features[a],l);if(g.features.length==2){let v=g.features[0],_=g.features[1];ne.update(x=>(v.id=x.features[a].id,_.id=Ut(x),v.properties=JSON.parse(JSON.stringify(x.features[a].properties)),_.properties=JSON.parse(JSON.stringify(v.properties)),p(x.features[a],v,_,l),x.features.splice(a,1,v,_),x))}u()}}function p(g,v,_,x){v.properties.length_meters=Pt(v,{units:"kilometers"})*1e3,_.properties.length_meters=Pt(_,{units:"kilometers"})*1e3,v.properties.waypoints=[],_.properties.waypoints=[];let c=f(g,x),d=!0,y=0;for(let M of g.properties.waypoints){let C=f(g,lt([M.lon,M.lat]));if(d)if(C<c)v.properties.waypoints.push(M);else{let L=M.snapped&&g.properties.waypoints[y-1].snapped;v.properties.waypoints.push({lon:x.geometry.coordinates[0],lat:x.geometry.coordinates[1],snapped:L}),d=!1,_.properties.waypoints.push({lon:x.geometry.coordinates[0],lat:x.geometry.coordinates[1],snapped:L}),_.properties.waypoints.push(M)}else _.properties.waypoints.push(M);y++}}function f(g,v){let _=g.geometry.coordinates[0],x=Es(_,v,g);return Pt(x,{units:"kilometers"})*1e3}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(1,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&48){let g=Pe();l&&g.features.push(l),i.getSource(Qt).setData(g)}},[o,s,Ir,u,l,i]}class Ps extends Q{constructor(e){super(),ee(this,e,Cs,Ms,Z,{mode:0,changeMode:1,start:2,stop:3})}get start(){return Ir}get stop(){return this.$$.ctx[3]}}function mr(r){let e,t,n={mode:r[2],pointTool:r[9],polygonTool:r[10],routeTool:r[1]};return e=new us({props:n}),r[15](e),{c(){U(e.$$.fragment)},m(i,o){J(e,i,o),t=!0},p(i,o){const s={};o&4&&(s.mode=i[2]),o&2&&(s.routeTool=i[1]),e.$set(s)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){r[15](null),z(e,i)}}}function Fs(r){let e,t,n,i,o,s,u,l,a,h,m,p,f,g,v,_,x,c,d,y,M,C,L,O,A,B,I,G,E,N,ie,pe,we,oe,ve,Se,de,K,Ze,Ne,Be,ue,fe,Ke,$e,pt={mode:r[2],changeMode:r[11]};u=new Jo({props:pt}),r[13](u);let re=r[1]&&mr(r),ce={mode:r[2],changeMode:r[11],pointTool:r[9]};y=new vs({props:ce}),r[17](y);let R={mode:r[2],changeMode:r[11],polygonTool:r[10]};I=new bs({props:R}),r[19](I);function j(X){r[22](X)}let En={mode:r[2],changeMode:r[11],url:r[0]};r[1]!==void 0&&(En.routeTool=r[1]),oe=new ds({props:En}),r[21](oe),he.push(()=>ze(oe,"routeTool",j,r[1]));let Tr={mode:r[2],changeMode:r[11]};return ue=new Ps({props:Tr}),r[24](ue),{c(){e=w("div"),t=w("div"),n=w("button"),i=V("Edit attributes"),s=F(),U(u.$$.fragment),l=F(),a=w("div"),h=w("button"),m=V("Edit geometry"),f=F(),re&&re.c(),g=F(),v=w("div"),_=w("button"),x=V("New point"),d=F(),U(y.$$.fragment),M=F(),C=w("div"),L=w("button"),O=V("New polygon"),B=F(),U(I.$$.fragment),G=F(),E=w("div"),N=w("button"),ie=V("New route"),we=F(),U(oe.$$.fragment),Se=F(),de=w("div"),K=w("button"),Ze=V("Split route"),Be=F(),U(ue.$$.fragment),P(n,"type","button"),n.disabled=o=r[2]=="edit-attribute",P(n,"class","svelte-cej5os"),P(h,"type","button"),h.disabled=p=r[2]=="edit-geometry",P(h,"class","svelte-cej5os"),P(_,"type","button"),_.disabled=c=r[2]=="point",P(_,"class","svelte-cej5os"),P(L,"type","button"),L.disabled=A=r[2]=="polygon",P(L,"class","svelte-cej5os"),P(N,"type","button"),N.disabled=pe=r[2]=="route",P(N,"class","svelte-cej5os"),P(K,"type","button"),K.disabled=Ne=r[2]=="split-route",P(K,"class","svelte-cej5os"),P(e,"class","toolbox svelte-cej5os")},m(X,ae){k(X,e,ae),b(e,t),b(t,n),b(n,i),b(t,s),J(u,t,null),b(e,l),b(e,a),b(a,h),b(h,m),b(a,f),re&&re.m(a,null),b(e,g),b(e,v),b(v,_),b(_,x),b(v,d),J(y,v,null),b(e,M),b(e,C),b(C,L),b(L,O),b(C,B),J(I,C,null),b(e,G),b(e,E),b(E,N),b(N,ie),b(E,we),J(oe,E,null),b(e,Se),b(e,de),b(de,K),b(K,Ze),b(de,Be),J(ue,de,null),fe=!0,Ke||($e=[Y(n,"click",r[12]),Y(h,"click",r[14]),Y(_,"click",r[16]),Y(L,"click",r[18]),Y(N,"click",r[20]),Y(K,"click",r[23])],Ke=!0)},p(X,[ae]){(!fe||ae&4&&o!==(o=X[2]=="edit-attribute"))&&(n.disabled=o);const Mn={};ae&4&&(Mn.mode=X[2]),u.$set(Mn),(!fe||ae&4&&p!==(p=X[2]=="edit-geometry"))&&(h.disabled=p),X[1]?re?(re.p(X,ae),ae&2&&T(re,1)):(re=mr(X),re.c(),T(re,1),re.m(a,null)):re&&(Ie(),$(re,1,1,()=>{re=null}),Te()),(!fe||ae&4&&c!==(c=X[2]=="point"))&&(_.disabled=c);const Ln={};ae&4&&(Ln.mode=X[2]),y.$set(Ln),(!fe||ae&4&&A!==(A=X[2]=="polygon"))&&(L.disabled=A);const On={};ae&4&&(On.mode=X[2]),I.$set(On),(!fe||ae&4&&pe!==(pe=X[2]=="route"))&&(N.disabled=pe);const Et={};ae&4&&(Et.mode=X[2]),ae&1&&(Et.url=X[0]),!ve&&ae&2&&(ve=!0,Et.routeTool=X[1],We(()=>ve=!1)),oe.$set(Et),(!fe||ae&4&&Ne!==(Ne=X[2]=="split-route"))&&(K.disabled=Ne);const Cn={};ae&4&&(Cn.mode=X[2]),ue.$set(Cn)},i(X){fe||(T(u.$$.fragment,X),T(re),T(y.$$.fragment,X),T(I.$$.fragment,X),T(oe.$$.fragment,X),T(ue.$$.fragment,X),fe=!0)},o(X){$(u.$$.fragment,X),$(re),$(y.$$.fragment,X),$(I.$$.fragment,X),$(oe.$$.fragment,X),$(ue.$$.fragment,X),fe=!1},d(X){X&&S(e),r[13](null),z(u),re&&re.d(),r[17](null),z(y),r[19](null),z(I),r[21](null),z(oe),r[24](null),z(ue),Ke=!1,Je($e)}}}function Rs(r,e,t){let n;te(r,Fe,E=>t(25,n=E));let{routeUrl:i}=e,o,s=new wo(n),u=new Ao(n),l="edit-attribute",a,h,m,p,f,g;function v(E){let N={"edit-attribute":a,"edit-geometry":h,route:m,point:p,polygon:f,"split-route":g};if(l==E){console.log(`Mode is already ${l}, not changing`);return}console.log(`Stopping old mode ${l}`),N[l].stop(),t(2,l=E),console.log(`Starting new mode ${l}`),N[l].start()}ft(()=>{s==null||s.tearDown(),u==null||u.tearDown()});const _=()=>v("edit-attribute");function x(E){he[E?"unshift":"push"](()=>{a=E,t(3,a)})}const c=()=>v("edit-geometry");function d(E){he[E?"unshift":"push"](()=>{h=E,t(4,h)})}const y=()=>v("point");function M(E){he[E?"unshift":"push"](()=>{p=E,t(6,p)})}const C=()=>v("polygon");function L(E){he[E?"unshift":"push"](()=>{f=E,t(7,f)})}const O=()=>v("route");function A(E){he[E?"unshift":"push"](()=>{m=E,t(5,m)})}function B(E){o=E,t(1,o)}const I=()=>v("split-route");function G(E){he[E?"unshift":"push"](()=>{g=E,t(8,g)})}return r.$$set=E=>{"routeUrl"in E&&t(0,i=E.routeUrl)},[i,o,l,a,h,m,p,f,g,s,u,v,_,x,c,d,y,M,C,L,O,A,B,I,G]}class As extends Q{constructor(e){super(),ee(this,e,Rs,Fs,Z,{routeUrl:0})}}function Is(r){let e,t,n,i,o,s,u,l;return{c(){e=w("div"),t=w("button"),t.textContent="Home",n=F(),i=w("button"),i.textContent="About",o=F(),s=w("button"),s.textContent="Instructions",P(t,"type","button"),P(i,"type","button"),P(s,"type","button"),P(e,"slot","nav")},m(a,h){k(a,e,h),b(e,t),b(e,n),b(e,i),b(e,o),b(e,s),u||(l=[Y(t,"click",r[8]),Y(i,"click",r[6]),Y(s,"click",r[7])],u=!0)},p:H,d(a){a&&S(e),u=!1,Je(l)}}}function Ts(r){let e,t,n,i,o,s,u,l,a,h,m,p;return o=new fo({props:{boundaryGeojson:r[3]}}),u=new so({props:{authorityName:r[4]}}),m=new to({}),{c(){e=w("div"),t=w("h1"),n=V(r[4]),i=F(),U(o.$$.fragment),s=F(),U(u.$$.fragment),l=F(),a=w("br"),h=F(),U(m.$$.fragment),P(e,"slot","sidebar")},m(f,g){k(f,e,g),b(e,t),b(t,n),b(t,i),J(o,t,null),b(e,s),J(u,e,null),b(e,l),b(e,a),b(e,h),J(m,e,null),p=!0},p(f,g){const v={};g&8&&(v.boundaryGeojson=f[3]),o.$set(v)},i(f){p||(T(o.$$.fragment,f),T(u.$$.fragment,f),T(m.$$.fragment,f),p=!0)},o(f){$(o.$$.fragment,f),$(u.$$.fragment,f),$(m.$$.fragment,f),p=!1},d(f){f&&S(e),z(o),z(u),z(m)}}}function Ns(r){let e,t,n,i,o,s,u,l,a,h,m,p;return e=new Xi({props:{boundaryGeojson:r[3]}}),n=new yo({}),o=new bo({}),u=new As({props:{routeUrl:r[2]}}),a=new po({props:{style:r[5]}}),m=new mo({}),{c(){U(e.$$.fragment),t=F(),U(n.$$.fragment),i=F(),U(o.$$.fragment),s=F(),U(u.$$.fragment),l=F(),U(a.$$.fragment),h=F(),U(m.$$.fragment)},m(f,g){J(e,f,g),k(f,t,g),J(n,f,g),k(f,i,g),J(o,f,g),k(f,s,g),J(u,f,g),k(f,l,g),J(a,f,g),k(f,h,g),J(m,f,g),p=!0},p(f,g){const v={};g&8&&(v.boundaryGeojson=f[3]),e.$set(v);const _={};g&4&&(_.routeUrl=f[2]),u.$set(_)},i(f){p||(T(e.$$.fragment,f),T(n.$$.fragment,f),T(o.$$.fragment,f),T(u.$$.fragment,f),T(a.$$.fragment,f),T(m.$$.fragment,f),p=!0)},o(f){$(e.$$.fragment,f),$(n.$$.fragment,f),$(o.$$.fragment,f),$(u.$$.fragment,f),$(a.$$.fragment,f),$(m.$$.fragment,f),p=!1},d(f){z(e,f),f&&S(t),z(n,f),f&&S(i),z(o,f),f&&S(s),z(u,f),f&&S(l),z(a,f),f&&S(h),z(m,f)}}}function Bs(r){let e,t,n;return t=new ci({props:{style:r[5],$$slots:{default:[Ns]},$$scope:{ctx:r}}}),{c(){e=w("div"),U(t.$$.fragment),P(e,"slot","main")},m(i,o){k(i,e,o),J(t,e,null),n=!0},p(i,o){const s={};o&16396&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(T(t.$$.fragment,i),n=!0)},o(i){$(t.$$.fragment,i),n=!1},d(i){i&&S(e),z(t)}}}function $s(r){let e,t,n,i,o,s,u,l;e=new vi({props:{$$slots:{main:[Bs],sidebar:[Ts],nav:[Is]},$$scope:{ctx:r}}});function a(f){r[9](f)}let h={};r[0]!==void 0&&(h.open=r[0]),n=new ri({props:h}),he.push(()=>ze(n,"open",a,r[0]));function m(f){r[10](f)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new ui({props:p}),he.push(()=>ze(s,"open",m,r[1])),{c(){U(e.$$.fragment),t=F(),U(n.$$.fragment),o=F(),U(s.$$.fragment)},m(f,g){J(e,f,g),k(f,t,g),J(n,f,g),k(f,o,g),J(s,f,g),l=!0},p(f,[g]){const v={};g&16396&&(v.$$scope={dirty:g,ctx:f}),e.$set(v);const _={};!i&&g&1&&(i=!0,_.open=f[0],We(()=>i=!1)),n.$set(_);const x={};!u&&g&2&&(u=!0,x.open=f[1],We(()=>u=!1)),s.$set(x)},i(f){l||(T(e.$$.fragment,f),T(n.$$.fragment,f),T(s.$$.fragment,f),l=!0)},o(f){$(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!1},d(f){z(e,f),f&&S(t),z(n,f),f&&S(o),z(s,f)}}}function Ds(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let u=s.get("authority"),l=s.get("style")||"streets";var a=`https://atip.uk/route-snappers/${u}.bin`;o||(a=`https://atip.uk/route-snappers-dev/${u}.bin`);function h(){t(0,n=!n),t(1,i=!1)}function m(){t(1,i=!i),t(0,n=!1)}let p;mn(async()=>{t(3,p=await f())});async function f(){const c=await(await fetch(ii)).text(),d=JSON.parse(c);return d.features=d.features.filter(y=>{var M;return((M=y.properties)==null?void 0:M.name)==u}),d}const g=()=>window.open("index.html");function v(x){n=x,t(0,n)}function _(x){i=x,t(1,i)}return[n,i,a,p,u,l,h,m,g,v,_]}class Gs extends Q{constructor(e){super(),ee(this,e,Ds,$s,Z,{})}}new Gs({target:document.getElementById("app")});
