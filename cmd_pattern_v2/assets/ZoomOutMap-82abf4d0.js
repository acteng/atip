import{S as q,i as z,s as F,e as b,t as O,aj as ne,f as m,g as y,h as g,ak as H,l as $,U as L,p as v,r as ae,ai as re,O as ue,x as R,c as B,as as U,y as D,z as E,A as W,n as C,o as M,I as G,K as ce,N as A,M as fe,L as pe,R as de,Q as me,P as _e,ap as K,T as be,E as ge,a8 as le,a9 as oe,am as Q,at as P,ag as ie,d as ye,m as ve,q as he,B as N,au as we,u as ke,b as Se,ae as Ce,w as Oe}from"./maplibre_helpers-22323140.js";function Le(l){let e,s,t,n,o,i,r;return{c(){e=b("div"),s=O(`Basemap:
  `),t=b("select"),n=b("option"),n.textContent="Streets",o=b("option"),o.textContent="Satellite",n.__value="streets",n.value=n.__value,o.__value="hybrid",o.value=o.__value,l[0]===void 0&&ne(()=>l[2].call(t)),m(e,"class","svelte-1tbnm6i")},m(c,a){y(c,e,a),g(e,s),g(e,t),g(t,n),g(t,o),H(t,l[0]),i||(r=[$(t,"change",l[2]),$(t,"change",l[1])],i=!0)},p(c,[a]){a&1&&H(t,c[0])},i:L,o:L,d(c){c&&v(e),i=!1,ae(r)}}}function Be(l,e,s){let{style:t}=e;function n(){let i=new URLSearchParams(window.location.search);i.set("style",t);let r=`${window.location.pathname}?${i.toString()}${window.location.hash}`;window.location.href=r}function o(){t=re(this),s(0,t)}return l.$$set=i=>{"style"in i&&s(0,t=i.style)},[t,n,o]}class ot extends q{constructor(e){super(),z(this,e,Be,Le,F,{style:0})}}const J=[];function I(l,e=L){let s;const t=new Set;function n(r){if(F(l,r)&&(l=r,s)){const c=!J.length;for(const a of t)a[1](),J.push(a,l);if(c){for(let a=0;a<J.length;a+=2)J[a][0](J[a+1]);J.length=0}}}function o(r){n(r(l))}function i(r,c=L){const a=[r,c];return t.add(a),t.size===1&&(s=e(n)||L),r(l),()=>{t.delete(a),t.size===0&&(s(),s=null)}}return{set:n,update:o,subscribe:i}}let V=[];function it(l){let e;return j.update(s=>(e=Te(s),l.id=e,s.features.push(l),s)),V.push({kind:"new",feature:JSON.parse(JSON.stringify(l))}),e}function at(l,e){let s,t,n;return j.update(o=>{let i=o.features.find(r=>r.id==l);return i?(t=JSON.parse(JSON.stringify(i)),e(i),n=JSON.parse(JSON.stringify(i)),s=!0):s=!1,o}),s&&V.push({kind:"edit",fOld:t,fNew:n}),s}function Me(l){let e,s;return j.update(t=>{let n=t.features.length;return s=t.features.find(o=>o.id==l),t.features=t.features.filter(o=>o.id!=l),e=n-1==t.features.length,t}),e&&V.push({kind:"delete",feature:s}),e}function Fe(l){return l=="google"||l=="bing"}const Z=I(null),rt=I(null),j=I(ue()),Ie=I(null),Ne=I(null),qe=I(null),ze=I(null),Je=I($e());Je.subscribe(l=>window.localStorage.setItem("userSettings",JSON.stringify(l)));const ut=I("edit-attribute");function Te(l){let e=new Set;for(let t of l.features)e.add(t.id);let s=e.size+1;for(;e.has(s);)s++;return s}function ct(l){console.log(`Deleting intervention ${l}`),Me(l),Ie.set(null),Ne.set(null),qe.set(null),ze.set(null)}function $e(){let l={streetViewImagery:"google",avoidDoublingBack:!1};try{let e=JSON.parse(window.localStorage.getItem("userSettings")||"{}");Fe(e.streetViewImagery)&&(l.streetViewImagery=e.streetViewImagery),typeof e.avoidDoublingBack=="boolean"&&(l.avoidDoublingBack=e.avoidDoublingBack)}catch(e){console.log(`Couldn't parse userSettings from local storage: ${e}`)}return l}const Pe=l=>({}),X=l=>({}),Re=l=>({}),Y=l=>({});function De(l){let e,s,t,n,o,i,r,c,a,p,_;const d=l[3].sidebar,f=R(d,l,l[2],Y),S=l[3].main,w=R(S,l,l[2],X);return{c(){e=b("div"),s=b("aside"),t=b("div"),f&&f.c(),n=B(),o=b("button"),o.textContent="â†’",r=B(),c=b("main"),w&&w.c(),m(t,"class","sidebar-content content-container svelte-ect12w"),m(o,"type","button"),m(o,"class","sidebar-toggle rounded-rect svelte-ect12w"),m(s,"class",i=U(l[0]?"":"collapsed")+" svelte-ect12w"),m(c,"class","svelte-ect12w"),m(e,"class","overall-layout svelte-ect12w")},m(u,h){y(u,e,h),g(e,s),g(s,t),f&&f.m(t,null),g(s,n),g(s,o),g(e,r),g(e,c),w&&w.m(c,null),a=!0,p||(_=$(o,"click",l[1]),p=!0)},p(u,[h]){f&&f.p&&(!a||h&4)&&D(f,d,u,u[2],a?W(d,u[2],h,Re):E(u[2]),Y),(!a||h&1&&i!==(i=U(u[0]?"":"collapsed")+" svelte-ect12w"))&&m(s,"class",i),w&&w.p&&(!a||h&4)&&D(w,S,u,u[2],a?W(S,u[2],h,Pe):E(u[2]),X)},i(u){a||(C(f,u),C(w,u),a=!0)},o(u){M(f,u),M(w,u),a=!1},d(u){u&&v(e),f&&f.d(u),w&&w.d(u),p=!1,_()}}}function Ee(l,e,s){let{$$slots:t={},$$scope:n}=e,o=!0;function i(){s(0,o=!o)}return l.$$set=r=>{"$$scope"in r&&s(2,n=r.$$scope)},[o,i,n,t]}class ft extends q{constructor(e){super(),z(this,e,Ee,De,F,{})}}const k={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},We=10,x=10;let T="interventions";function Ge(l,e,s){let t,n;G(l,Z,p=>s(1,t=p)),G(l,j,p=>s(2,n=p));let{schema:o}=e;ce(t,T,n);const i=["match",["get","intervention_type"],"area",k.area,"route",k.route,"crossing",k.crossing,"other",k.other,"white"],r=["match",["get","reference_type",["get","planning"]],"preapp",k.preapp,"outline",k.outline,"reserved matters",k["reserved matters"],"local plan",k["local plan"],"white"],c=["!=","hide_while_editing",!0];return A(t,{id:"interventions-points",source:T,filter:["all",de,c,["!=","endpoint",!0]],color:i,radius:We}),fe(t,{id:"interventions-lines",source:T,filter:["all",me,c],color:i,width:x}),A(t,{id:"interventions-lines-endpoints",source:T,filter:["==","endpoint",!0],radius:.5*x,opacity:0,strokeColor:k.lineEndpointColor,strokeWidth:2}),pe(t,{id:"interventions-polygons",source:T,filter:["all",_e,c],color:o=="planning"?r:i,opacity:.5}),l.$$set=p=>{"schema"in p&&s(0,o=p.schema)},l.$$.update=()=>{if(l.$$.dirty&6){let p=JSON.parse(JSON.stringify(n)),_=[];for(let d of p.features)if(d.geometry.type=="LineString"&&!d.properties.hide_while_editing)for(let f of[d.geometry.coordinates[0],d.geometry.coordinates[d.geometry.coordinates.length-1]])_.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(_),t.getSource(T).setData(p)}},[o,t,n]}class pt extends q{constructor(e){super(),z(this,e,Ge,null,F,{schema:0})}}function Ze(l){const e=l-1;return e*e*e+1}function ee(l,{delay:e=0,duration:s=400,easing:t=Ze}={}){const n=getComputedStyle(l),o=+n.opacity,i=parseFloat(n.height),r=parseFloat(n.paddingTop),c=parseFloat(n.paddingBottom),a=parseFloat(n.marginTop),p=parseFloat(n.marginBottom),_=parseFloat(n.borderTopWidth),d=parseFloat(n.borderBottomWidth);return{delay:e,duration:s,easing:t,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*i}px;padding-top: ${f*r}px;padding-bottom: ${f*c}px;margin-top: ${f*a}px;margin-bottom: ${f*p}px;border-top-width: ${f*_}px;border-bottom-width: ${f*d}px;`}}function te(l){let e,s,t;const n=l[3].default,o=R(n,l,l[2],null);return{c(){e=b("div"),o&&o.c()},m(i,r){y(i,e,r),o&&o.m(e,null),t=!0},p(i,r){o&&o.p&&(!t||r&4)&&D(o,n,i,i[2],t?W(n,i[2],r,null):E(i[2]),null)},i(i){t||(C(o,i),ne(()=>{s||(s=Q(e,ee,{duration:100},!0)),s.run(1)}),t=!0)},o(i){M(o,i),s||(s=Q(e,ee,{duration:100},!1)),s.run(0),t=!1},d(i){i&&v(e),o&&o.d(i),i&&s&&s.end()}}}function je(l){let e,s,t,n,o,i,r,c,a,p,_=l[0]&&te(l);return{c(){e=b("button"),s=K("svg"),t=K("path"),n=B(),o=O(l[1]),i=B(),_&&_.c(),r=be(),m(t,"d","M9 5l7 7-7 7"),m(s,"style","tran"),m(s,"width","20"),m(s,"height","20"),m(s,"fill","none"),m(s,"stroke-linecap","round"),m(s,"stroke-linejoin","round"),m(s,"stroke-width","2"),m(s,"viewBox","0 0 24 24"),m(s,"stroke","currentColor"),m(s,"class","svelte-una9lq"),m(e,"aria-expanded",l[0]),m(e,"class","svelte-una9lq")},m(d,f){y(d,e,f),g(e,s),g(s,t),g(e,n),g(e,o),y(d,i,f),_&&_.m(d,f),y(d,r,f),c=!0,a||(p=$(e,"click",l[4]),a=!0)},p(d,[f]){(!c||f&2)&&ge(o,d[1]),(!c||f&1)&&m(e,"aria-expanded",d[0]),d[0]?_?(_.p(d,f),f&1&&C(_,1)):(_=te(d),_.c(),C(_,1),_.m(r.parentNode,r)):_&&(le(),M(_,1,1,()=>{_=null}),oe())},i(d){c||(C(_),c=!0)},o(d){M(_),c=!1},d(d){d&&v(e),d&&v(i),_&&_.d(d),d&&v(r),a=!1,p()}}}function Ve(l,e,s){let{$$slots:t={},$$scope:n}=e,{label:o}=e,{open:i=!1}=e;const r=()=>s(0,i=!i);return l.$$set=c=>{"label"in c&&s(1,o=c.label),"open"in c&&s(0,i=c.open),"$$scope"in c&&s(2,n=c.$$scope)},[i,o,n,t,r]}class He extends q{constructor(e){super(),z(this,e,Ve,je,F,{label:1,open:0})}}function Ue(l,e,s){let t;G(l,Z,a=>s(2,t=a));let{layers:n}=e,{contents:o}=e,i=new P.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"none"});t.on("mousemove",r),t.on("mouseout",c),ie(()=>{t.off("mousemove",r),t.off("mouseout",c),i.remove()});function r(a){if(!n.every(_=>t.getLayer(_))){i.remove();return}let p=t.queryRenderedFeatures(a.point,{layers:n});p.length>0?i.setLngLat(a.lngLat).setHTML(o(p[0].properties)).addTo(t):i.remove()}function c(){i.remove()}return l.$$set=a=>{"layers"in a&&s(0,n=a.layers),"contents"in a&&s(1,o=a.contents)},[n,o]}class dt extends q{constructor(e){super(),z(this,e,Ue,null,F,{layers:0,contents:1})}}function Ae(l){let e,s,t,n,o,i,r,c,a,p,_,d,f,S,w;return{c(){e=b("li"),s=b("span"),t=O("Areas"),n=B(),o=b("li"),i=b("span"),r=O("Routes"),c=B(),a=b("li"),p=b("span"),_=O("Crossings"),d=B(),f=b("li"),S=b("span"),w=O("Other"),m(s,"class","svelte-l42ea0"),N(s,"background",k.area),m(i,"class","svelte-l42ea0"),N(i,"background",k.route),m(p,"class","svelte-l42ea0"),N(p,"background",k.crossing),m(S,"class","svelte-l42ea0"),N(S,"background",k.other)},m(u,h){y(u,e,h),g(e,s),g(e,t),y(u,n,h),y(u,o,h),g(o,i),g(o,r),y(u,c,h),y(u,a,h),g(a,p),g(a,_),y(u,d,h),y(u,f,h),g(f,S),g(f,w)},p:L,d(u){u&&v(e),u&&v(n),u&&v(o),u&&v(c),u&&v(a),u&&v(d),u&&v(f)}}}function Ke(l){let e,s,t,n,o,i,r,c,a,p,_,d,f,S,w;return{c(){e=b("li"),s=b("span"),t=O("Preapp"),n=B(),o=b("li"),i=b("span"),r=O("Outline"),c=B(),a=b("li"),p=b("span"),_=O("Reserved matters"),d=B(),f=b("li"),S=b("span"),w=O("Local plan"),m(s,"class","svelte-l42ea0"),N(s,"background",k.preapp),m(i,"class","svelte-l42ea0"),N(i,"background",k.outline),m(p,"class","svelte-l42ea0"),N(p,"background",k["reserved matters"]),m(S,"class","svelte-l42ea0"),N(S,"background",k["local plan"])},m(u,h){y(u,e,h),g(e,s),g(e,t),y(u,n,h),y(u,o,h),g(o,i),g(o,r),y(u,c,h),y(u,a,h),g(a,p),g(a,_),y(u,d,h),y(u,f,h),g(f,S),g(f,w)},p:L,d(u){u&&v(e),u&&v(n),u&&v(o),u&&v(c),u&&v(a),u&&v(d),u&&v(f)}}}function Qe(l){let e;function s(o,i){return o[0]=="planning"?Ke:Ae}let t=s(l),n=t(l);return{c(){e=b("ul"),n.c()},m(o,i){y(o,e,i),n.m(e,null)},p(o,i){t===(t=s(o))&&n?n.p(o,i):(n.d(1),n=t(o),n&&(n.c(),n.m(e,null)))},d(o){o&&v(e),n.d()}}}function Xe(l){let e,s,t;return s=new He({props:{label:"Objects",open:!0,$$slots:{default:[Qe]},$$scope:{ctx:l}}}),{c(){e=b("div"),ye(s.$$.fragment),m(e,"class","svelte-l42ea0")},m(n,o){y(n,e,o),ve(s,e,null),t=!0},p(n,[o]){const i={};o&3&&(i.$$scope={dirty:o,ctx:n}),s.$set(i)},i(n){t||(C(s.$$.fragment,n),t=!0)},o(n){M(s.$$.fragment,n),t=!1},d(n){n&&v(e),he(s)}}}function Ye(l,e,s){let{schema:t}=e;return l.$$set=n=>{"schema"in n&&s(0,t=n.schema)},[t]}class mt extends q{constructor(e){super(),z(this,e,Ye,Xe,F,{schema:0})}}function se(l){let e;const s=l[4].default,t=R(s,l,l[3],null);return{c(){t&&t.c()},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&8)&&D(t,s,n,n[3],e?W(s,n[3],o,null):E(n[3]),null)},i(n){e||(C(t,n),e=!0)},o(n){M(t,n),e=!1},d(n){t&&t.d(n)}}}function xe(l){let e,s,t=l[1]&&se(l);return{c(){e=b("div"),t&&t.c(),m(e,"class","map svelte-12dpf1u")},m(n,o){y(n,e,o),t&&t.m(e,null),l[5](e),s=!0},p(n,[o]){n[1]?t?(t.p(n,o),o&2&&C(t,1)):(t=se(n),t.c(),C(t,1),t.m(e,null)):t&&(le(),M(t,1,1,()=>{t=null}),oe())},i(n){s||(C(t),s=!0)},o(n){M(t),s=!1},d(n){n&&v(e),t&&t.d(),l[5](null)}}}function et(l,e,s){let{$$slots:t={},$$scope:n}=e,{style:o}=e,i,r,c=!1;we("setCamera",!window.location.hash),ke(()=>{i=new P.Map({container:r,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),i.addControl(new P.ScaleControl({})),i.addControl(new P.NavigationControl({visualizePitch:!0}),"bottom-right"),i.on("load",()=>{s(1,c=!0),Z.set(i)}),new ResizeObserver(()=>{i.resize()}).observe(r)}),ie(()=>{i.remove()});function a(p){Se[p?"unshift":"push"](()=>{r=p,s(0,r)})}return l.$$set=p=>{"style"in p&&s(2,o=p.style),"$$scope"in p&&s(3,n=p.$$scope)},[r,c,o,n,t,a]}class _t extends q{constructor(e){super(),z(this,e,et,xe,F,{style:2})}}const tt="/atip/cmd_pattern_v2/assets/zoom_out_map-b2e1091a.svg";function st(l){let e,s,t,n,o;return{c(){e=b("button"),s=b("img"),Ce(s.src,t=tt)||m(s,"src",t),m(s,"alt","Zoom to show entire boundary"),m(e,"type","button"),m(e,"title","Zoom to show entire boundary"),m(e,"class","svelte-qzjsqo")},m(i,r){y(i,e,r),g(e,s),n||(o=$(e,"click",l[0]),n=!0)},p:L,i:L,o:L,d(i){i&&v(e),n=!1,o()}}}function nt(l,e,s){let t;G(l,Z,i=>s(2,t=i));let{boundaryGeojson:n}=e;function o(){t.fitBounds(Oe(n),{padding:20,animate:!0,duration:500})}return l.$$set=i=>{"boundaryGeojson"in i&&s(1,n=i.boundaryGeojson)},[o,n]}class bt extends q{constructor(e){super(),z(this,e,nt,st,F,{boundaryGeojson:1})}}export{ot as B,He as C,pt as I,ft as L,dt as M,bt as Z,Ne as a,We as b,k as c,ut as d,at as e,Ie as f,j as g,Te as h,ee as i,ct as j,_t as k,x as l,Z as m,it as n,ze as o,mt as p,rt as r,qe as s,Je as u};
