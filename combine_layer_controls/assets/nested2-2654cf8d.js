import{S as ye,i as Se,s as Ce,g as L,m as O,t as $,l as b,q as z,G as ae,r as Fe,T as je,a as te,d as Me,al as fe,e as P,f as B,u as k,aa as ue,h as Y,j as y,k as p,y as re,n as ne,x as U,p as S,am as Ne,z as Ae,B as ie,E as Be,b as ce,c as me,F as Le,o as pe,Q as Oe,R as ze,v as _e,w as Ie}from"./maplibre_helpers-ef1a5107.js";import{L as Te,Z as Ee,C as ve,p as Ge,g as ee,S as $e,I as Je,q as Pe,M as qe,m as De}from"./ZoomOutMap-897f89c5.js";function ge(s,e,t){const r=s.slice();return r[24]=e[t],r}function Re(s){let e;return{c(){e=k("Home")},m(t,r){y(t,e,r)},d(t){t&&S(e)}}}function de(s){let e,t;return e=new Be({props:{errorMessage:s[7]}}),{c(){L(e.$$.fragment)},m(r,n){O(e,r,n),t=!0},p(r,n){const l={};n&128&&(l.errorMessage=r[7]),e.$set(l)},i(r){t||($(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){z(e,r)}}}function Ze(s){let e;return{c(){e=k("Clear")},m(t,r){y(t,e,r)},d(t){t&&S(e)}}}function He(s){let e,t,r,n,l,c;return r=new te({props:{$$slots:{default:[Ze]},$$scope:{ctx:s}}}),r.$on("click",s[18]),{c(){e=P("input"),t=B(),L(r.$$.fragment),Y(e,"type","text"),Y(e,"class","govuk-input govuk-input--width-10"),Y(e,"id","filterText")},m(o,m){y(o,e,m),_e(e,s[1]),y(o,t,m),O(r,o,m),n=!0,l||(c=Ie(e,"input",s[17]),l=!0)},p(o,m){m&2&&e.value!==o[1]&&_e(e,o[1]);const C={};m&134217728&&(C.$$scope={dirty:m,ctx:o}),r.$set(C)},i(o){n||($(r.$$.fragment,o),n=!0)},o(o){b(r.$$.fragment,o),n=!1},d(o){o&&(S(e),S(t)),z(r,o),l=!1,c()}}}function Qe(s){let e,t,r,n,l,c,o,m;function C(a){s[15](a)}let v={label:"Authority or region",id:"filterAuthority",choices:s[8]};s[4]!==void 0&&(v.value=s[4]),e=new $e({props:v}),ce.push(()=>me(e,"value",C));function I(a){s[16](a)}let N={label:"Funding programme",id:"filterFundingProgramme",choices:s[9]};return s[5]!==void 0&&(N.value=s[5]),n=new $e({props:N}),ce.push(()=>me(n,"value",I)),o=new Le({props:{label:"Any field",id:"filterText",$$slots:{default:[He]},$$scope:{ctx:s}}}),{c(){L(e.$$.fragment),r=B(),L(n.$$.fragment),c=B(),L(o.$$.fragment)},m(a,i){O(e,a,i),y(a,r,i),O(n,a,i),y(a,c,i),O(o,a,i),m=!0},p(a,i){const F={};i&256&&(F.choices=a[8]),!t&&i&16&&(t=!0,F.value=a[4],pe(()=>t=!1)),e.$set(F);const j={};i&512&&(j.choices=a[9]),!l&&i&32&&(l=!0,j.value=a[5],pe(()=>l=!1)),n.$set(j);const A={};i&134217730&&(A.$$scope={dirty:i,ctx:a}),o.$set(A)},i(a){m||($(e.$$.fragment,a),$(n.$$.fragment,a),$(o.$$.fragment,a),m=!0)},o(a){b(e.$$.fragment,a),b(n.$$.fragment,a),b(o.$$.fragment,a),m=!1},d(a){a&&(S(r),S(c)),z(e,a),z(n,a),z(o,a)}}}function he(s){let e,t;return e=new ve({props:{label:`${s[24].scheme_reference}: ${s[24].num_features} features`,$$slots:{default:[Ve]},$$scope:{ctx:s}}}),{c(){L(e.$$.fragment)},m(r,n){O(e,r,n),t=!0},p(r,n){const l={};n&1&&(l.label=`${r[24].scheme_reference}: ${r[24].num_features} features`),n&134217729&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(r){t||($(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){z(e,r)}}}function Ue(s){let e;return{c(){e=k("Show on map")},m(t,r){y(t,e,r)},d(t){t&&S(e)}}}function Ke(s){let e;return{c(){e=k("Edit scheme")},m(t,r){y(t,e,r)},d(t){t&&S(e)}}}function Ve(s){let e,t,r=s[24].authority_or_region+"",n,l,c,o,m=s[24].capital_scheme_id+"",C,v,I,N,a=s[24].funding_programme+"",i,F,j,A,Z,T,D,G;function H(){return s[19](s[24])}A=new te({props:{$$slots:{default:[Ue]},$$scope:{ctx:s}}}),A.$on("click",H);function K(){return s[20](s[24])}return T=new te({props:{$$slots:{default:[Ke]},$$scope:{ctx:s}}}),T.$on("click",K),{c(){e=P("p"),t=k("Authority or region: "),n=k(r),l=B(),c=P("p"),o=k("Capital scheme ID: "),C=k(m),v=B(),I=P("p"),N=k("Funding programme: "),i=k(a),F=B(),j=P("div"),L(A.$$.fragment),Z=B(),L(T.$$.fragment),D=B(),Y(j,"class","govuk-button-group")},m(d,h){y(d,e,h),p(e,t),p(e,n),y(d,l,h),y(d,c,h),p(c,o),p(c,C),y(d,v,h),y(d,I,h),p(I,N),p(I,i),y(d,F,h),y(d,j,h),O(A,j,null),p(j,Z),O(T,j,null),y(d,D,h),G=!0},p(d,h){s=d,(!G||h&1)&&r!==(r=s[24].authority_or_region+"")&&U(n,r),(!G||h&1)&&m!==(m=s[24].capital_scheme_id+"")&&U(C,m),(!G||h&1)&&a!==(a=s[24].funding_programme+"")&&U(i,a);const Q={};h&134217728&&(Q.$$scope={dirty:h,ctx:s}),A.$set(Q);const u={};h&134217728&&(u.$$scope={dirty:h,ctx:s}),T.$set(u)},i(d){G||($(A.$$.fragment,d),$(T.$$.fragment,d),G=!0)},o(d){b(A.$$.fragment,d),b(T.$$.fragment,d),G=!1},d(d){d&&(S(e),S(l),S(c),S(v),S(I),S(F),S(j),S(D)),z(A),z(T)}}}function be(s){let e=s[2].has(s[24].scheme_reference),t,r,n=e&&he(s);return{c(){n&&n.c(),t=Oe()},m(l,c){n&&n.m(l,c),y(l,t,c),r=!0},p(l,c){c&5&&(e=l[2].has(l[24].scheme_reference)),e?n?(n.p(l,c),c&5&&$(n,1)):(n=he(l),n.c(),$(n,1),n.m(t.parentNode,t)):n&&(re(),b(n,1,1,()=>{n=null}),ne())},i(l){r||($(n),r=!0)},o(l){b(n),r=!1},d(l){l&&S(t),n&&n.d(l)}}}function We(s){let e,t,r,n,l,c,o,m,C,v,I,N,a,i,F,j=s[2].size+"",A,Z,T=s[3].route+"",D,G,H=s[3].area+"",K,d,h=s[3].crossing+"",Q,u,_=s[3].other+"",q,V,J,x,R;t=new te({props:{$$slots:{default:[Re]},$$scope:{ctx:s}}}),t.$on("click",s[14]),o=new Ee({props:{boundaryGeojson:s[6]}});let M=s[7]&&de(s);v=new Me({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:s[11]}}),N=new ve({props:{label:"Filters",$$slots:{default:[Qe]},$$scope:{ctx:s}}});let W=fe(s[0]),w=[];for(let f=0;f<W.length;f+=1)w[f]=be(ge(s,W,f));const ke=f=>b(w[f],1,1,()=>{w[f]=null});return{c(){e=P("div"),L(t.$$.fragment),r=B(),n=P("div"),l=P("h1"),l.textContent="Browse schemes",c=B(),L(o.$$.fragment),m=B(),M&&M.c(),C=B(),L(v.$$.fragment),I=B(),L(N.$$.fragment),a=B(),i=P("p"),F=k("Showing "),A=k(j),Z=k(" schemes ("),D=k(T),G=k(" routes, "),K=k(H),d=k(` areas,
      `),Q=k(h),u=k(" crossings, "),q=k(_),V=k(" other)"),J=B(),x=P("ul");for(let f=0;f<w.length;f+=1)w[f].c();ue(n,"display","flex"),ue(n,"justify-content","space-between"),Y(e,"slot","sidebar"),Y(e,"class","govuk-prose")},m(f,g){y(f,e,g),O(t,e,null),p(e,r),p(e,n),p(n,l),p(n,c),O(o,n,null),p(e,m),M&&M.m(e,null),p(e,C),O(v,e,null),p(e,I),O(N,e,null),p(e,a),p(e,i),p(i,F),p(i,A),p(i,Z),p(i,D),p(i,G),p(i,K),p(i,d),p(i,Q),p(i,u),p(i,q),p(i,V),p(e,J),p(e,x);for(let X=0;X<w.length;X+=1)w[X]&&w[X].m(x,null);R=!0},p(f,g){const X={};g&134217728&&(X.$$scope={dirty:g,ctx:f}),t.$set(X);const se={};g&64&&(se.boundaryGeojson=f[6]),o.$set(se),f[7]?M?(M.p(f,g),g&128&&$(M,1)):(M=de(f),M.c(),$(M,1),M.m(e,C)):M&&(re(),b(M,1,1,()=>{M=null}),ne());const oe={};if(g&134218546&&(oe.$$scope={dirty:g,ctx:f}),N.$set(oe),(!R||g&4)&&j!==(j=f[2].size+"")&&U(A,j),(!R||g&8)&&T!==(T=f[3].route+"")&&U(D,T),(!R||g&8)&&H!==(H=f[3].area+"")&&U(K,H),(!R||g&8)&&h!==(h=f[3].crossing+"")&&U(Q,h),(!R||g&8)&&_!==(_=f[3].other+"")&&U(q,_),g&12293){W=fe(f[0]);let E;for(E=0;E<W.length;E+=1){const le=ge(f,W,E);w[E]?(w[E].p(le,g),$(w[E],1)):(w[E]=be(le),w[E].c(),$(w[E],1),w[E].m(x,null))}for(re(),E=W.length;E<w.length;E+=1)ke(E);ne()}},i(f){if(!R){$(t.$$.fragment,f),$(o.$$.fragment,f),$(M),$(v.$$.fragment,f),$(N.$$.fragment,f);for(let g=0;g<W.length;g+=1)$(w[g]);R=!0}},o(f){b(t.$$.fragment,f),b(o.$$.fragment,f),b(M),b(v.$$.fragment,f),b(N.$$.fragment,f),w=w.filter(Boolean);for(let g=0;g<w.length;g+=1)b(w[g]);R=!1},d(f){f&&S(e),z(t),z(o),M&&M.d(),z(v),z(N),Ne(w,f)}}}function Xe(s){let e,t,r,n,l,c;return e=new Je({props:{schema:we}}),r=new Pe({props:{schema:we,style:s[10]}}),l=new qe({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:et}}),{c(){L(e.$$.fragment),t=B(),L(r.$$.fragment),n=B(),L(l.$$.fragment)},m(o,m){O(e,o,m),y(o,t,m),O(r,o,m),y(o,n,m),O(l,o,m),c=!0},p:ze,i(o){c||($(e.$$.fragment,o),$(r.$$.fragment,o),$(l.$$.fragment,o),c=!0)},o(o){b(e.$$.fragment,o),b(r.$$.fragment,o),b(l.$$.fragment,o),c=!1},d(o){o&&(S(t),S(n)),z(e,o),z(r,o),z(l,o)}}}function Ye(s){let e,t,r;return t=new Ge({props:{style:s[10],$$slots:{default:[Xe]},$$scope:{ctx:s}}}),{c(){e=P("div"),L(t.$$.fragment),Y(e,"slot","main")},m(n,l){y(n,e,l),O(t,e,null),r=!0},p(n,l){const c={};l&134217728&&(c.$$scope={dirty:l,ctx:n}),t.$set(c)},i(n){r||($(t.$$.fragment,n),r=!0)},o(n){b(t.$$.fragment,n),r=!1},d(n){n&&S(e),z(t)}}}function xe(s){let e,t;return e=new Te({props:{$$slots:{main:[Ye],sidebar:[We]},$$scope:{ctx:s}}}),{c(){L(e.$$.fragment)},m(r,n){O(e,r,n),t=!0},p(r,[n]){const l={};n&134218751&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(r){t||($(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){z(e,r)}}}const we="v1";function et(s){var e="<table>";for(let[t,r]of Object.entries(s))e+=`<tr><td>${t}</td><td>${r}</td></tr>`;return e+="</table>",e}function tt(s,e,t){let r,n;ae(s,ee,u=>t(6,r=u)),ae(s,De,u=>t(21,n=u)),Fe(()=>{Ae()});let c=new URLSearchParams(window.location.search).get("style")||"streets",o="",m=[],C="",v=new Set,I={area:0,route:0,crossing:0,other:0},N=[],a="",i=[],F="";je(()=>{ee.set(null)});function j(u){try{let _=JSON.parse(u);ee.set(_),A(_),t(7,o=""),n==null||n.fitBounds(ie(_),{padding:20,animate:!1})}catch(_){t(7,o=`Couldn't load schemes from a file: ${_}`)}}function A(u){let _={};for(let[J,x]of Object.entries(u.schemes))_[J]={scheme_reference:J,num_features:0,...x};for(let J of u.features)_[J.properties.scheme_reference].num_features++;t(0,m=Object.values(_));let q=new Set,V=new Set;for(let J of m)J.authority_or_region&&q.add(J.authority_or_region),J.funding_programme&&V.add(J.funding_programme);t(8,N=Array.from(q.entries())),N.sort(),t(9,i=Array.from(V.entries())),i.sort()}function Z(u){let _={type:"FeatureCollection",features:r.features.filter(q=>q.properties.scheme_reference==u.scheme_reference)};n==null||n.fitBounds(ie(_),{padding:20,animate:!1})}function T(u){let _={type:"FeatureCollection",features:r.features.filter(V=>V.properties.scheme_reference==u.scheme_reference)},q=u.authority_or_region;window.localStorage.setItem(q,JSON.stringify(_)),window.open(`scheme.html?authority=${u.authority_or_region}`,"_blank")}const D=()=>window.open("index.html");function G(u){a=u,t(4,a)}function H(u){F=u,t(5,F)}function K(){C=this.value,t(1,C)}const d=()=>t(1,C=""),h=u=>Z(u),Q=u=>T(u);return s.$$.update=()=>{if(s.$$.dirty&127&&r){if(v.clear(),C||a||F){let u=C.toLowerCase();for(let _ of r.features)JSON.stringify(_.properties).toLowerCase().includes(u)&&(a&&_.properties.authority_or_region!=a||F&&_.properties.funding_programme!=F||v.add(_.properties.scheme_reference))}else for(let u of m)v.add(u.scheme_reference);ee.update(u=>{if(!u)return null;for(let _ of u.features)v.has(_.properties.scheme_reference)?delete _.properties.hide_while_editing:_.properties.hide_while_editing=!0;return u}),t(3,I={area:0,route:0,crossing:0,other:0});for(let u of r==null?void 0:r.features)v.has(u.properties.scheme_reference)&&t(3,I[u.properties.intervention_type]++,I);t(2,v),t(6,r),t(1,C),t(4,a),t(5,F),t(0,m),t(3,I)}},[m,C,v,I,a,F,r,o,N,i,c,j,Z,T,D,G,H,K,d,h,Q]}class rt extends ye{constructor(e){super(),Se(this,e,tt,xe,Ce,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new rt({target:document.getElementById("app")});
