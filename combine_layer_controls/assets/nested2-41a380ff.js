import{S as H,i as Q,s as K,g as C,f as O,e as A,u as j,m as M,j as B,k as b,x as I,t as d,l as v,p as T,q as F,G as J,r as le,b as R,c as U,F as ue,o as Z,a as D,h as E,v as W,w as ce,B as ae,T as me,d as pe,al as X,aa as Y,y as q,n as P,am as _e,z as $e,M as ge,aA as he,E as de,Q as we,R as be}from"./maplibre_helpers-f351ca71.js";import{C as ie,g as G,S as x,m as fe,L as ve,Z as Se,p as ye,I as ke,q as Be,M as Te}from"./ZoomOutMap-83d349b4.js";function je(r){let e=new Map;for(let[s,t]of Object.entries(r.schemes))e.set(s,{scheme_reference:s,num_features:0,authority_or_region:t.authority_or_region,capital_scheme_id:t.capital_scheme_id,funding_programme:t.funding_programme});for(let s of r.features)e.get(s.properties.scheme_reference).num_features++,delete s.properties.id,delete s.properties.authority_or_region,delete s.properties.capital_scheme_id,delete s.properties.funding_programme,delete s.properties.valid,delete s.properties.centroid_lon,delete s.properties.centroid_lat;return e}function Ce(r){let e;return{c(){e=j("Clear")},m(s,t){B(s,e,t)},d(s){s&&T(e)}}}function Me(r){let e,s,t,n,o,i;return t=new D({props:{$$slots:{default:[Ce]},$$scope:{ctx:r}}}),t.$on("click",r[11]),{c(){e=A("input"),s=O(),C(t.$$.fragment),E(e,"type","text"),E(e,"class","govuk-input govuk-input--width-10"),E(e,"id","filterText")},m(l,u){B(l,e,u),W(e,r[1]),B(l,s,u),M(t,l,u),n=!0,o||(i=ce(e,"input",r[10]),o=!0)},p(l,u){u&2&&e.value!==l[1]&&W(e,l[1]);const w={};u&16384&&(w.$$scope={dirty:u,ctx:l}),t.$set(w)},i(l){n||(d(t.$$.fragment,l),n=!0)},o(l){v(t.$$.fragment,l),n=!1},d(l){l&&(T(e),T(s)),F(t,l),o=!1,i()}}}function Fe(r){let e,s,t,n,o,i,l,u;function w(c){r[8](c)}let S={label:"Authority or region",id:"filterAuthority",choices:r[4],emptyOption:!0};r[2]!==void 0&&(S.value=r[2]),e=new x({props:S}),R.push(()=>U(e,"value",w));function y(c){r[9](c)}let N={label:"Funding programme",id:"filterFundingProgramme",choices:r[5],emptyOption:!0};return r[3]!==void 0&&(N.value=r[3]),n=new x({props:N}),R.push(()=>U(n,"value",y)),l=new ue({props:{label:"Any field",id:"filterText",$$slots:{default:[Me]},$$scope:{ctx:r}}}),{c(){C(e.$$.fragment),t=O(),C(n.$$.fragment),i=O(),C(l.$$.fragment)},m(c,m){M(e,c,m),B(c,t,m),M(n,c,m),B(c,i,m),M(l,c,m),u=!0},p(c,m){const p={};m&16&&(p.choices=c[4]),!s&&m&4&&(s=!0,p.value=c[2],Z(()=>s=!1)),e.$set(p);const h={};m&32&&(h.choices=c[5]),!o&&m&8&&(o=!0,h.value=c[3],Z(()=>o=!1)),n.$set(h);const $={};m&16386&&($.$$scope={dirty:m,ctx:c}),l.$set($)},i(c){u||(d(e.$$.fragment,c),d(n.$$.fragment,c),d(l.$$.fragment,c),u=!0)},o(c){v(e.$$.fragment,c),v(n.$$.fragment,c),v(l.$$.fragment,c),u=!1},d(c){c&&(T(t),T(i)),F(e,c),F(n,c),F(l,c)}}}function Le(r){let e,s,t,n,o=r[0].size+"",i,l,u=r[6].route+"",w,S,y=r[6].area+"",N,c,m=r[6].crossing+"",p,h,$=r[6].other+"",g,k,f;return e=new ie({props:{label:"Filters",$$slots:{default:[Fe]},$$scope:{ctx:r}}}),{c(){C(e.$$.fragment),s=O(),t=A("p"),n=j("Showing "),i=j(o),l=j(" schemes ("),w=j(u),S=j(" routes, "),N=j(y),c=j(` areas,
  `),p=j(m),h=j(" crossings, "),g=j($),k=j(" other)")},m(a,_){M(e,a,_),B(a,s,_),B(a,t,_),b(t,n),b(t,i),b(t,l),b(t,w),b(t,S),b(t,N),b(t,c),b(t,p),b(t,h),b(t,g),b(t,k),f=!0},p(a,[_]){const z={};_&16446&&(z.$$scope={dirty:_,ctx:a}),e.$set(z),(!f||_&1)&&o!==(o=a[0].size+"")&&I(i,o),(!f||_&64)&&u!==(u=a[6].route+"")&&I(w,u),(!f||_&64)&&y!==(y=a[6].area+"")&&I(N,y),(!f||_&64)&&m!==(m=a[6].crossing+"")&&I(p,m),(!f||_&64)&&$!==($=a[6].other+"")&&I(g,$)},i(a){f||(d(e.$$.fragment,a),f=!0)},o(a){v(e.$$.fragment,a),f=!1},d(a){a&&(T(s),T(t)),F(e,a)}}}function Ne(r,e,s){let t;J(r,G,$=>s(12,t=$));let{schemes:n}=e,{schemesToBeShown:o=new Set}=e,i="",l=[],u="",w=[],S="",y={area:0,route:0,crossing:0,other:0};le(()=>{let $=new Set,g=new Set;for(let k of n.values())k.authority_or_region&&$.add(k.authority_or_region),k.funding_programme&&g.add(k.funding_programme);s(4,l=Array.from($.entries())),l.sort(),s(5,w=Array.from(g.entries())),w.sort()});function N($,g,k){let f=$.toLowerCase(),a=_=>{if(f&&!JSON.stringify(_.properties).toLowerCase().includes(f))return!1;if(g||k){let z=n.get(_.properties.scheme_reference);if(g&&z.authority_or_region!=g||k&&z.funding_programme!=k)return!1}return!0};s(0,o=new Set(t.features.filter(a).map(_=>_.properties.scheme_reference))),s(6,y={area:0,route:0,crossing:0,other:0}),G.update(_=>{for(let z of _.features)o.has(z.properties.scheme_reference)?(delete z.properties.hide_while_editing,s(6,y[z.properties.intervention_type]++,y)):z.properties.hide_while_editing=!0;return _}),s(6,y)}function c($){u=$,s(2,u)}function m($){S=$,s(3,S)}function p(){i=this.value,s(1,i)}const h=()=>s(1,i="");return r.$$set=$=>{"schemes"in $&&s(7,n=$.schemes),"schemesToBeShown"in $&&s(0,o=$.schemesToBeShown)},r.$$.update=()=>{r.$$.dirty&14&&N(i,u,S)},[o,i,u,S,l,w,y,n,c,m,p,h]}class ze extends H{constructor(e){super(),Q(this,e,Ne,Le,K,{schemes:7,schemesToBeShown:0})}}function Oe(r){let e;return{c(){e=j("Show on map")},m(s,t){B(s,e,t)},d(s){s&&T(e)}}}function Ae(r){let e;return{c(){e=j("Edit scheme")},m(s,t){B(s,e,t)},d(s){s&&T(e)}}}function Ie(r){let e,s,t=r[0].authority_or_region+"",n,o,i,l,u=r[0].capital_scheme_id+"",w,S,y,N,c=r[0].funding_programme+"",m,p,h,$,g,k,f;return $=new D({props:{$$slots:{default:[Oe]},$$scope:{ctx:r}}}),$.$on("click",r[1]),k=new D({props:{$$slots:{default:[Ae]},$$scope:{ctx:r}}}),k.$on("click",r[2]),{c(){e=A("p"),s=j("Authority or region: "),n=j(t),o=O(),i=A("p"),l=j("Capital scheme ID: "),w=j(u),S=O(),y=A("p"),N=j("Funding programme: "),m=j(c),p=O(),h=A("div"),C($.$$.fragment),g=O(),C(k.$$.fragment),E(h,"class","govuk-button-group")},m(a,_){B(a,e,_),b(e,s),b(e,n),B(a,o,_),B(a,i,_),b(i,l),b(i,w),B(a,S,_),B(a,y,_),b(y,N),b(y,m),B(a,p,_),B(a,h,_),M($,h,null),b(h,g),M(k,h,null),f=!0},p(a,_){(!f||_&1)&&t!==(t=a[0].authority_or_region+"")&&I(n,t),(!f||_&1)&&u!==(u=a[0].capital_scheme_id+"")&&I(w,u),(!f||_&1)&&c!==(c=a[0].funding_programme+"")&&I(m,c);const z={};_&32&&(z.$$scope={dirty:_,ctx:a}),$.$set(z);const L={};_&32&&(L.$$scope={dirty:_,ctx:a}),k.$set(L)},i(a){f||(d($.$$.fragment,a),d(k.$$.fragment,a),f=!0)},o(a){v($.$$.fragment,a),v(k.$$.fragment,a),f=!1},d(a){a&&(T(e),T(o),T(i),T(S),T(y),T(p),T(h)),F($),F(k)}}}function Ee(r){let e,s;return e=new ie({props:{label:`${r[0].scheme_reference}: ${r[0].num_features} features`,$$slots:{default:[Ie]},$$scope:{ctx:r}}}),{c(){C(e.$$.fragment)},m(t,n){M(e,t,n),s=!0},p(t,[n]){const o={};n&1&&(o.label=`${t[0].scheme_reference}: ${t[0].num_features} features`),n&33&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){s||(d(e.$$.fragment,t),s=!0)},o(t){v(e.$$.fragment,t),s=!1},d(t){F(e,t)}}}function Ge(r,e,s){let t,n;J(r,G,u=>s(3,t=u)),J(r,fe,u=>s(4,n=u));let{scheme:o}=e;function i(){let u={type:"FeatureCollection",features:t.features.filter(w=>w.properties.scheme_reference==o.scheme_reference)};n==null||n.fitBounds(ae(u),{padding:20,animate:!1})}function l(){let u={type:"FeatureCollection",features:t.features.filter(S=>S.properties.scheme_reference==o.scheme_reference)},w=o.authority_or_region;window.localStorage.setItem(w,JSON.stringify(u)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return r.$$set=u=>{"scheme"in u&&s(0,o=u.scheme)},[o,i,l]}class Je extends H{constructor(e){super(),Q(this,e,Ge,Ee,K,{scheme:0})}}function ee(r,e,s){const t=r.slice();return t[11]=e[s],t}function qe(r){let e;return{c(){e=j("Home")},m(s,t){B(s,e,t)},d(s){s&&T(e)}}}function te(r){let e,s;return e=new de({props:{errorMessage:r[0]}}),{c(){C(e.$$.fragment)},m(t,n){M(e,t,n),s=!0},p(t,n){const o={};n&1&&(o.errorMessage=t[0]),e.$set(o)},i(t){s||(d(e.$$.fragment,t),s=!0)},o(t){v(e.$$.fragment,t),s=!1},d(t){F(e,t)}}}function se(r){let e,s,t;function n(i){r[8](i)}let o={schemes:r[1]};return r[2]!==void 0&&(o.schemesToBeShown=r[2]),e=new ze({props:o}),R.push(()=>U(e,"schemesToBeShown",n)),{c(){C(e.$$.fragment)},m(i,l){M(e,i,l),t=!0},p(i,l){const u={};l&2&&(u.schemes=i[1]),!s&&l&4&&(s=!0,u.schemesToBeShown=i[2],Z(()=>s=!1)),e.$set(u)},i(i){t||(d(e.$$.fragment,i),t=!0)},o(i){v(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function ne(r){let e,s;return e=new Je({props:{scheme:r[11]}}),{c(){C(e.$$.fragment)},m(t,n){M(e,t,n),s=!0},p(t,n){const o={};n&2&&(o.scheme=t[11]),e.$set(o)},i(t){s||(d(e.$$.fragment,t),s=!0)},o(t){v(e.$$.fragment,t),s=!1},d(t){F(e,t)}}}function re(r){let e=r[2].has(r[11].scheme_reference),s,t,n=e&&ne(r);return{c(){n&&n.c(),s=we()},m(o,i){n&&n.m(o,i),B(o,s,i),t=!0},p(o,i){i&6&&(e=o[2].has(o[11].scheme_reference)),e?n?(n.p(o,i),i&6&&d(n,1)):(n=ne(o),n.c(),d(n,1),n.m(s.parentNode,s)):n&&(q(),v(n,1,1,()=>{n=null}),P())},i(o){t||(d(n),t=!0)},o(o){v(n),t=!1},d(o){o&&T(s),n&&n.d(o)}}}function Pe(r){let e,s,t,n,o,i,l,u,w,S,y,N,c,m;s=new D({props:{$$slots:{default:[qe]},$$scope:{ctx:r}}}),s.$on("click",r[7]),l=new Se({props:{boundaryGeojson:r[3]}});let p=r[0]&&te(r);S=new pe({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:r[5]}});let h=r[1].size>0&&se(r),$=X(r[1].values()),g=[];for(let f=0;f<$.length;f+=1)g[f]=re(ee(r,$,f));const k=f=>v(g[f],1,1,()=>{g[f]=null});return{c(){e=A("div"),C(s.$$.fragment),t=O(),n=A("div"),o=A("h1"),o.textContent="Browse schemes",i=O(),C(l.$$.fragment),u=O(),p&&p.c(),w=O(),C(S.$$.fragment),y=O(),h&&h.c(),N=O(),c=A("ul");for(let f=0;f<g.length;f+=1)g[f].c();Y(n,"display","flex"),Y(n,"justify-content","space-between"),E(e,"slot","sidebar"),E(e,"class","govuk-prose")},m(f,a){B(f,e,a),M(s,e,null),b(e,t),b(e,n),b(n,o),b(n,i),M(l,n,null),b(e,u),p&&p.m(e,null),b(e,w),M(S,e,null),b(e,y),h&&h.m(e,null),b(e,N),b(e,c);for(let _=0;_<g.length;_+=1)g[_]&&g[_].m(c,null);m=!0},p(f,a){const _={};a&16384&&(_.$$scope={dirty:a,ctx:f}),s.$set(_);const z={};if(a&8&&(z.boundaryGeojson=f[3]),l.$set(z),f[0]?p?(p.p(f,a),a&1&&d(p,1)):(p=te(f),p.c(),d(p,1),p.m(e,w)):p&&(q(),v(p,1,1,()=>{p=null}),P()),f[1].size>0?h?(h.p(f,a),a&2&&d(h,1)):(h=se(f),h.c(),d(h,1),h.m(e,N)):h&&(q(),v(h,1,1,()=>{h=null}),P()),a&6){$=X(f[1].values());let L;for(L=0;L<$.length;L+=1){const V=ee(f,$,L);g[L]?(g[L].p(V,a),d(g[L],1)):(g[L]=re(V),g[L].c(),d(g[L],1),g[L].m(c,null))}for(q(),L=$.length;L<g.length;L+=1)k(L);P()}},i(f){if(!m){d(s.$$.fragment,f),d(l.$$.fragment,f),d(p),d(S.$$.fragment,f),d(h);for(let a=0;a<$.length;a+=1)d(g[a]);m=!0}},o(f){v(s.$$.fragment,f),v(l.$$.fragment,f),v(p),v(S.$$.fragment,f),v(h),g=g.filter(Boolean);for(let a=0;a<g.length;a+=1)v(g[a]);m=!1},d(f){f&&T(e),F(s),F(l),p&&p.d(),F(S),h&&h.d(),_e(g,f)}}}function De(r){let e,s,t,n,o,i;return e=new ke({props:{schema:oe}}),t=new Be({props:{schema:oe,style:r[4]}}),o=new Te({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:r[6]}}),{c(){C(e.$$.fragment),s=O(),C(t.$$.fragment),n=O(),C(o.$$.fragment)},m(l,u){M(e,l,u),B(l,s,u),M(t,l,u),B(l,n,u),M(o,l,u),i=!0},p:be,i(l){i||(d(e.$$.fragment,l),d(t.$$.fragment,l),d(o.$$.fragment,l),i=!0)},o(l){v(e.$$.fragment,l),v(t.$$.fragment,l),v(o.$$.fragment,l),i=!1},d(l){l&&(T(s),T(n)),F(e,l),F(t,l),F(o,l)}}}function Re(r){let e,s,t;return s=new ye({props:{style:r[4],$$slots:{default:[De]},$$scope:{ctx:r}}}),{c(){e=A("div"),C(s.$$.fragment),E(e,"slot","main")},m(n,o){B(n,e,o),M(s,e,null),t=!0},p(n,o){const i={};o&16384&&(i.$$scope={dirty:o,ctx:n}),s.$set(i)},i(n){t||(d(s.$$.fragment,n),t=!0)},o(n){v(s.$$.fragment,n),t=!1},d(n){n&&T(e),F(s)}}}function Ue(r){let e,s;return e=new ve({props:{$$slots:{main:[Re],sidebar:[Pe]},$$scope:{ctx:r}}}),{c(){C(e.$$.fragment)},m(t,n){M(e,t,n),s=!0},p(t,[n]){const o={};n&16399&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){s||(d(e.$$.fragment,t),s=!0)},o(t){v(e.$$.fragment,t),s=!1},d(t){F(e,t)}}}const oe="v1";function Ze(r,e,s){let t,n;J(r,fe,m=>s(9,t=m)),J(r,G,m=>s(3,n=m)),le(()=>{$e()});let i=new URLSearchParams(window.location.search).get("style")||"streets",l="",u=new Map,w=new Set;me(()=>{G.set(ge())});function S(m){try{let p=JSON.parse(m);s(1,u=je(p)),G.set(p),s(0,l=""),t==null||t.fitBounds(ae(p),{padding:20,animate:!1})}catch(p){s(0,l=`Couldn't load schemes from a file: ${p}`)}}function y(m){var p='<div class="govuk-prose" style="max-width: 30vw;">';return p+=`<h2>${m.name} (${m.intervention_type})</h2>`,p+=`<p>Scheme reference: ${m.scheme_reference}</p>`,m.length_meters&&(p+=`<p>Length: ${he(m.length_meters)}</p>`),m.description&&(p+=`<p>${m.description}</p>`),p}const N=()=>window.open("index.html");function c(m){w=m,s(2,w)}return[l,u,w,n,i,S,y,N,c]}class He extends H{constructor(e){super(),Q(this,e,Ze,Ue,K,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new He({target:document.getElementById("app")});
