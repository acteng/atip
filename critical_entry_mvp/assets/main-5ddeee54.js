import{S as ue,i as fe,s as pe,F as de,b as U,a as ee,e as I,c,d as k,f as E,g as B,h as f,m as A,j as te,t as $,k as v,l as me,n as F,o as S,p as ce,q as re,r as ne,u as ge,v as he,w as $e,x as _e,y as be,z as ve,A as we,B as ye}from"./layer_helper_utils-391e6b00.js";import{D as ke,A as Ae,g as Se}from"./About-0c0051ea.js";import{S as Ee,E as ae,R as Te,F as Ie,I as Me}from"./InteractiveLayer-f2507dad.js";function Be(a){let t;return{c(){t=re("About")},m(e,o){B(e,t,o)},d(e){e&&F(t)}}}function Fe(a){let t,e,o,p,g;return{c(){t=I("input"),e=c(),o=I("datalist"),E(t,"class","govuk-input govuk-input--width-20"),E(t,"id","inputValue"),E(t,"data-testid","transport-authority"),E(t,"list","authorities-list"),E(o,"id","authorities-list")},m(d,s){B(d,t,s),ne(t,a[0]),B(d,e,s),B(d,o,s),a[12](o),p||(g=ge(t,"input",a[11]),p=!0)},p(d,s){s&1&&t.value!==d[0]&&ne(t,d[0])},d(d){d&&(F(t),F(e),F(o)),a[12](null),p=!1,g()}}}function Le(a){let t;return{c(){t=re("Start")},m(e,o){B(e,t,o)},d(e){e&&F(t)}}}function oe(a){let t,e;return t=new Me({props:{layer:W,clickable:!0,tooltip:Je}}),t.$on("click",Ne),{c(){k(t.$$.fragment)},m(o,p){A(t,o,p),e=!0},p:he,i(o){e||($(t.$$.fragment,o),e=!0)},o(o){v(t.$$.fragment,o),e=!1},d(o){S(t,o)}}}function je(a){let t,e,o,p,g,d,s,M,_,w,m,j,C,D,b,L,N,J,O,r,l,h,y,P,z,q,T,G,R;g=new Ee({props:{$$slots:{default:[Be]},$$scope:{ctx:a}}}),g.$on("click",a[10]),s=new ae({props:{errorMessage:a[2]}}),_=new de({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[Fe]},$$scope:{ctx:a}}}),m=new ke({props:{disabled:!a[6],$$slots:{default:[Le]},$$scope:{ctx:a}}}),m.$on("click",a[9]);function le(n){a[13](n)}let H={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]],inlineSmall:!0};a[5]!==void 0&&(H.value=a[5]),b=new Te({props:H}),U.push(()=>ee(b,"value",le)),b.$on("change",a[7]),r=new ae({props:{errorMessage:Ce}}),h=new Ie({props:{label:"Or upload an ATIP GeoJSON file",loadFile:a[8],id:"load-geojson"}});let i=a[4]&&oe();function ie(n){a[14](n)}let Z={};return a[1]!==void 0&&(Z.open=a[1]),T=new Ae({props:Z}),U.push(()=>ee(T,"open",ie)),{c(){t=I("div"),e=I("div"),o=I("h1"),o.textContent="Welcome to ATIP v2",p=c(),k(g.$$.fragment),d=c(),k(s.$$.fragment),M=c(),k(_.$$.fragment),w=c(),k(m.$$.fragment),j=c(),C=I("hr"),D=c(),k(b.$$.fragment),N=c(),J=I("hr"),O=c(),k(r.$$.fragment),l=c(),k(h.$$.fragment),y=c(),P=I("div"),P.innerHTML='<div id="map" class="svelte-lyn11h"></div>',z=c(),i&&i.c(),q=c(),k(T.$$.fragment),E(o,"class","govuk-heading-l"),E(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),E(P,"class","govuk-grid-column-one-half"),E(t,"class","govuk-grid-row")},m(n,u){B(n,t,u),f(t,e),f(e,o),f(e,p),A(g,e,null),f(e,d),A(s,e,null),f(e,M),A(_,e,null),f(e,w),A(m,e,null),f(e,j),f(e,C),f(e,D),A(b,e,null),f(e,N),f(e,J),f(e,O),A(r,e,null),f(e,l),A(h,e,null),f(t,y),f(t,P),f(t,z),i&&i.m(t,null),B(n,q,u),A(T,n,u),R=!0},p(n,[u]){const K={};u&131072&&(K.$$scope={dirty:u,ctx:n}),g.$set(K);const Q={};u&4&&(Q.errorMessage=n[2]),s.$set(Q);const X={};u&131081&&(X.$$scope={dirty:u,ctx:n}),_.$set(X);const V={};u&64&&(V.disabled=!n[6]),u&131072&&(V.$$scope={dirty:u,ctx:n}),m.$set(V);const Y={};!L&&u&32&&(L=!0,Y.value=n[5],te(()=>L=!1)),b.$set(Y),n[4]?i?(i.p(n,u),u&16&&$(i,1)):(i=oe(),i.c(),$(i,1),i.m(t,null)):i&&($e(),v(i,1,1,()=>{i=null}),me());const x={};!G&&u&2&&(G=!0,x.open=n[1],te(()=>G=!1)),T.$set(x)},i(n){R||($(g.$$.fragment,n),$(s.$$.fragment,n),$(_.$$.fragment,n),$(m.$$.fragment,n),$(b.$$.fragment,n),$(r.$$.fragment,n),$(h.$$.fragment,n),$(i),$(T.$$.fragment,n),R=!0)},o(n){v(g.$$.fragment,n),v(s.$$.fragment,n),v(_.$$.fragment,n),v(m.$$.fragment,n),v(b.$$.fragment,n),v(r.$$.fragment,n),v(h.$$.fragment,n),v(i),v(T.$$.fragment,n),R=!1},d(n){n&&(F(t),F(q)),S(g),S(s),S(_),S(m),S(b),S(r),S(h),i&&i.d(),S(T,n)}}}let Ce="",se="boundary",W="boundary-layer";function De(a){if(a.features.length>0){let t=a.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function Ne(a){window.location.href=`scheme.html?authority=${a.detail.properties.name}`}function Je(a){return`<p>${a.properties.name}</p>`}function Oe(a,t,e){let o,p=!1,d=new URLSearchParams(window.location.search).get("error")||"",s,M,_=new Set,w=null,m="TA";function j(){w==null||w.setFilter(W,["==",["get","level"],m])}ce(async()=>{_e();const r=await Se();for(let h of r.features){let y=document.createElement("option");y.value=h.properties.name,M.appendChild(y),_.add(h.properties.name)}let l=new be.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});e(4,w=l),ve.set(w),l.on("load",function(){l.fitBounds(we(r),{padding:20,animate:!1}),l.addSource(se,{type:"geojson",data:r,generateId:!0}),l.addLayer({id:W,source:se,filter:["==",["get","level"],m],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":ye(.8,.4)}})})});function C(r){try{let l=JSON.parse(r);if(!l.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!_.has(l.authority))throw new Error(`Unknown authority ${l.authority}`);let h=l.authority,y=De(l);y!="v1"&&(h+=`_${y}`),window.localStorage.setItem(h,JSON.stringify(l)),window.location.href=`scheme.html?authority=${l.authority}&schema=${y}`}catch(l){e(2,d=`Couldn't load scheme from a file: ${l}`)}}function D(){window.location.href=`scheme.html?authority=${s}`}const b=()=>e(1,p=!p);function L(){s=this.value,e(0,s)}function N(r){U[r?"unshift":"push"](()=>{M=r,e(3,M)})}function J(r){m=r,e(5,m)}function O(r){p=r,e(1,p)}return a.$$.update=()=>{a.$$.dirty&1&&e(6,o=_.has(s))},[s,p,d,M,w,m,o,j,C,D,b,L,N,J,O]}class Pe extends ue{constructor(t){super(),fe(this,t,Oe,je,pe,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Pe({target:document.getElementById("app")});
