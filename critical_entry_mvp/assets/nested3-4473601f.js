import{S as O,i as H,s as q,b as M,c as E,f as b,m as h,k as j,t as g,l as $,p as w,L as ue,A as ce,F as Z,d as I,h as v,o as k,e as A,g as D,u as z,v as W,az as ge,r as G,M as $e,am as be,a as he,j as T,q as fe,a4 as we,z as ve,x as ke,n as ye,y as Ce,w as Y}from"./layer_helper_utils-ac09d4f6.js";import{e as X,b as Se,d as Ie,L as De,M as Le,S as Be}from"./StreetViewController-3b59a493.js";import{D as Ae}from"./DefaultButton-4a4146ca.js";import{T as pe,W as Pe}from"./WarningButton-2354a940.js";function Te(s){let e,n,o;function i(r){s[3](r)}let t={label:"Basemap",id:"basemap",choices:[["streets","Streets"],["hybrid","Satellite"],["dataviz","Dataviz"]],disabled:s[0]};return s[1]!==void 0&&(t.value=s[1]),e=new X({props:t}),M.push(()=>E(e,"value",i)),e.$on("change",s[2]),{c(){b(e.$$.fragment)},m(r,u){h(e,r,u),o=!0},p(r,[u]){const a={};u&1&&(a.disabled=r[0]),!n&&u&2&&(n=!0,a.value=r[1],j(()=>n=!1)),e.$set(a)},i(r){o||(g(e.$$.fragment,r),o=!0)},o(r){$(e.$$.fragment,r),o=!1},d(r){w(e,r)}}}function Me(s,e,n){let o;ue(s,ce,a=>n(4,o=a));let{disabled:i}=e,t="dataviz";function r(){o.setStyle(`https://api.maptiler.com/maps/${t}/style.json?key=MZEJTanw3WpxRvt7qDfo`)}function u(a){t=a,n(1,t)}return s.$$set=a=>{"disabled"in a&&n(0,i=a.disabled)},[i,t,r,u]}class Ee extends O{constructor(e){super(),H(this,e,Me,Te,q,{disabled:0})}}function je(s){let e,n,o;return{c(){e=A("input"),D(e,"type","text"),D(e,"class","govuk-input govuk-input--width-20"),D(e,"id","location_description")},m(i,t){v(i,e,t),z(e,s[0]),n||(o=[W(e,"input",s[4]),W(e,"change",s[2])],n=!0)},p(i,t){t&1&&e.value!==i[0]&&z(e,i[0])},d(i){i&&k(e),n=!1,ge(o)}}}function Re(s){let e;return{c(){e=G("Lookup location description automatically")},m(n,o){v(n,e,o)},d(n){n&&k(e)}}}function Fe(s){let e,n,o;function i(r){s[5](r)}let t={id:"lookupLocation",$$slots:{default:[Re]},$$scope:{ctx:s}};return s[1]!==void 0&&(t.checked=s[1]),e=new Ie({props:t}),M.push(()=>E(e,"checked",i)),{c(){b(e.$$.fragment)},m(r,u){h(e,r,u),o=!0},p(r,u){const a={};u&128&&(a.$$scope={dirty:u,ctx:r}),!n&&u&2&&(n=!0,a.checked=r[1],j(()=>n=!1)),e.$set(a)},i(r){o||(g(e.$$.fragment,r),o=!0)},o(r){$(e.$$.fragment,r),o=!1},d(r){w(e,r)}}}function ze(s){let e,n,o,i;return e=new Z({props:{label:"Describe this location",id:"location_description",$$slots:{default:[je]},$$scope:{ctx:s}}}),o=new Se({props:{small:!0,$$slots:{default:[Fe]},$$scope:{ctx:s}}}),{c(){b(e.$$.fragment),n=I(),b(o.$$.fragment)},m(t,r){h(e,t,r),v(t,n,r),h(o,t,r),i=!0},p(t,[r]){const u={};r&129&&(u.$$scope={dirty:r,ctx:t}),e.$set(u);const a={};r&130&&(a.$$scope={dirty:r,ctx:t}),o.$set(a)},i(t){i||(g(e.$$.fragment,t),g(o.$$.fragment,t),i=!0)},o(t){$(e.$$.fragment,t),$(o.$$.fragment,t),i=!1},d(t){t&&k(n),w(e,t),w(o,t)}}}function Ve(s,e,n){let{location_description:o}=e,{pt:i}=e,t=!0;async function r(c){if(!t)return;let p=`https://nominatim.openstreetmap.org/reverse?lat=${c.lat}&lon=${c.lng}&format=json`;try{n(0,o="Loading...");let _=await(await fetch(p)).json();n(0,o=_.address.road??_.display_name)}catch(y){console.log(`Location lookup failed: ${y}`)}}function u(){n(1,t=!1)}function a(){o=this.value,n(0,o)}function m(c){t=c,n(1,t)}return s.$$set=c=>{"location_description"in c&&n(0,o=c.location_description),"pt"in c&&n(3,i=c.pt)},s.$$.update=()=>{s.$$.dirty&8&&r(i)},[o,t,u,i,a,m]}class We extends O{constructor(e){super(),H(this,e,Ve,ze,q,{location_description:0,pt:3})}}function Oe(s){let e,n,o;return{c(){e=A("input"),D(e,"type","text"),D(e,"class","govuk-input govuk-input--width-10"),D(e,"id","inspector")},m(i,t){v(i,e,t),z(e,s[1]),n||(o=W(e,"input",s[12]),n=!0)},p(i,t){t&2&&e.value!==i[1]&&z(e,i[1])},d(i){i&&k(e),n=!1,o()}}}function He(s){let e,n,o;return{c(){e=A("input"),D(e,"type","text"),D(e,"class","govuk-input govuk-input--width-10"),D(e,"id","scheme_reference")},m(i,t){v(i,e,t),z(e,s[2]),n||(o=W(e,"input",s[13]),n=!0)},p(i,t){t&4&&e.value!==i[2]&&z(e,i[2])},d(i){i&&k(e),n=!1,o()}}}function qe(s){let e;return{c(){e=G("Export")},m(n,o){v(n,e,o)},d(n){n&&k(e)}}}function Ge(s){let e;return{c(){e=G("Keep editing this issue")},m(n,o){v(n,e,o)},d(n){n&&k(e)}}}function Je(s){let e;return{c(){e=G("Done! Enter a new critical")},m(n,o){v(n,e,o)},d(n){n&&k(e)}}}function Ke(s){let e,n,o,i,t,r,u,a,m,c,p,y;return r=new pe({props:{label:"The new row has already been copied to your clipboard. If it didn't work, copy from below",value:s[10]()}}),m=new he({props:{$$slots:{default:[Ge]},$$scope:{ctx:s}}}),m.$on("click",s[18]),p=new Pe({props:{$$slots:{default:[Je]},$$scope:{ctx:s}}}),p.$on("click",Qe),{c(){e=A("div"),n=A("p"),n.innerHTML=`Edit <i>Inspectors Log.xlsx</i>
      , add a new row at the bottom of
      <i>Form Input</i>
      , and press
      <i>Control+V</i>
      to paste.`,o=I(),i=A("p"),i.innerHTML="<b>You have to manually fill out the first ID column!</b>",t=I(),b(r.$$.fragment),u=I(),a=A("div"),b(m.$$.fragment),c=I(),b(p.$$.fragment),D(a,"class","govuk-button-group"),D(e,"class","govuk-prose")},m(_,f){v(_,e,f),T(e,n),T(e,o),T(e,i),T(e,t),h(r,e,null),T(e,u),T(e,a),h(m,a,null),T(a,c),h(p,a,null),y=!0},p(_,f){const C={};f&1048576&&(C.$$scope={dirty:f,ctx:_}),m.$set(C);const B={};f&1048576&&(B.$$scope={dirty:f,ctx:_}),p.$set(B)},i(_){y||(g(r.$$.fragment,_),g(m.$$.fragment,_),g(p.$$.fragment,_),y=!0)},o(_){$(r.$$.fragment,_),$(m.$$.fragment,_),$(p.$$.fragment,_),y=!1},d(_){_&&k(e),w(r),w(m),w(p)}}}function Ne(s){let e,n,o,i,t,r,u,a,m,c,p,y,_,f,C,B,L,R,P,V,F;e=new Z({props:{label:"Inspector name",id:"inspector",$$slots:{default:[Oe]},$$scope:{ctx:s}}}),o=new Z({props:{label:"Scheme reference",id:"scheme_reference",$$slots:{default:[He]},$$scope:{ctx:s}}});function J(l){s[14](l)}let S={label:"Current design stage",id:"current_design_stage",choices:s[8],emptyOption:!0};s[3]!==void 0&&(S.value=s[3]),t=new X({props:S}),M.push(()=>E(t,"value",J));function K(l){s[15](l)}let N={pt:s[0]};s[5]!==void 0&&(N.location_description=s[5]),a=new We({props:N}),M.push(()=>E(a,"location_description",K));function de(l){s[16](l)}let x={label:"Critical issue type",id:"critical_issue_type",choices:s[9],emptyOption:!0};s[4]!==void 0&&(x.value=s[4]),p=new X({props:x}),M.push(()=>E(p,"value",de));function me(l){s[17](l)}let ee={label:"Comments or notes"};s[6]!==void 0&&(ee.value=s[6]),f=new pe({props:ee}),M.push(()=>E(f,"value",me)),L=new Ae({props:{$$slots:{default:[qe]},$$scope:{ctx:s}}}),L.$on("click",s[11]);function _e(l){s[19](l)}let te={title:"Almost done!",displayEscapeButton:!1,canCloseByClickingBackground:!1,$$slots:{default:[Ke]},$$scope:{ctx:s}};return s[7]!==void 0&&(te.open=s[7]),P=new $e({props:te}),M.push(()=>E(P,"open",_e)),{c(){b(e.$$.fragment),n=I(),b(o.$$.fragment),i=I(),b(t.$$.fragment),u=I(),b(a.$$.fragment),c=I(),b(p.$$.fragment),_=I(),b(f.$$.fragment),B=I(),b(L.$$.fragment),R=I(),b(P.$$.fragment)},m(l,d){h(e,l,d),v(l,n,d),h(o,l,d),v(l,i,d),h(t,l,d),v(l,u,d),h(a,l,d),v(l,c,d),h(p,l,d),v(l,_,d),h(f,l,d),v(l,B,d),h(L,l,d),v(l,R,d),h(P,l,d),F=!0},p(l,[d]){const ne={};d&1048578&&(ne.$$scope={dirty:d,ctx:l}),e.$set(ne);const se={};d&1048580&&(se.$$scope={dirty:d,ctx:l}),o.$set(se);const oe={};!r&&d&8&&(r=!0,oe.value=l[3],j(()=>r=!1)),t.$set(oe);const U={};d&1&&(U.pt=l[0]),!m&&d&32&&(m=!0,U.location_description=l[5],j(()=>m=!1)),a.$set(U);const ie={};!y&&d&16&&(y=!0,ie.value=l[4],j(()=>y=!1)),p.$set(ie);const re={};!C&&d&64&&(C=!0,re.value=l[6],j(()=>C=!1)),f.$set(re);const ae={};d&1048576&&(ae.$$scope={dirty:d,ctx:l}),L.$set(ae);const Q={};d&1048704&&(Q.$$scope={dirty:d,ctx:l}),!V&&d&128&&(V=!0,Q.open=l[7],j(()=>V=!1)),P.$set(Q)},i(l){F||(g(e.$$.fragment,l),g(o.$$.fragment,l),g(t.$$.fragment,l),g(a.$$.fragment,l),g(p.$$.fragment,l),g(f.$$.fragment,l),g(L.$$.fragment,l),g(P.$$.fragment,l),F=!0)},o(l){$(e.$$.fragment,l),$(o.$$.fragment,l),$(t.$$.fragment,l),$(a.$$.fragment,l),$(p.$$.fragment,l),$(f.$$.fragment,l),$(L.$$.fragment,l),$(P.$$.fragment,l),F=!1},d(l){l&&(k(n),k(i),k(u),k(c),k(_),k(B),k(R)),w(e,l),w(o,l),w(t,l),w(a,l),w(p,l),w(f,l),w(L,l),w(P,l)}}}function le(s){return s.map(e=>[e,e])}function Ue(s){let e=25569,o=24*(60*60*1e3);return s.getTime()/o+e}function Qe(){location.reload()}function Ye(s,e,n){let{pt:o}=e,i=window.localStorage.getItem("inspector")??"",t=window.localStorage.getItem("scheme_reference")??"",r=window.localStorage.getItem("current_design_stage")??"",u="",a="",m="",c=!1,p=le(["Baseline","Feasibility Design","Preliminary Design","Outline Design","Detailed Design","Inspection"]),y=le(["1 - Conflict at Side Roads","2 - Conflict at Major Junctions / Roundabouts","3 - Collision Alongside or from Behind","4 - Trip Hazard","5 - Kerbside Activity","6A - Risk of Crossing Conflict (Busy Roads)","6B - Risk of Crossing Conflict (Quieter Roads)","7A - Standard of Crossing Facility (Busy Roads)","7B - Standard of Crossing Facility (Junction)","8 - Traffic Speed (>37mph)","9A - Traffic Volume (>10,000vpd)","9B - Traffic Volume (>5% HGVs)","10 - Crossing Speed","11A - Footway Width (Absolute Minimum <1m)","11B - Footway Width (at Pinchpoints)","11C - Footway Width - Poor Pedestrian Comfort","12 - Tram - Insufficient width next to Tram Track","13 - Tram/Rail - Poor Crossing Angle","14 - Major Cycle Surface Defect","15 - Major Pedestrian Surface Defect","16 - Inappropriate Shared Use","17 - Barriers, Steps and/or Dismount signs","18 - Route isn't direct, logical or intuitive to all users","19 - Inappropriate Surface Materials","20 - Inappropriate Lighting","21 - Routes must join other facilities as a network"]);function _(){let S=0,K=Ue(new Date);return[S,i,K,t,r,u,be(o.toArray().reverse()).join(","),a,m].join("	")}function f(){navigator.clipboard.writeText(_()),n(7,c=!0)}function C(){i=this.value,n(1,i)}function B(){t=this.value,n(2,t)}function L(S){r=S,n(3,r)}function R(S){a=S,n(5,a)}function P(S){u=S,n(4,u)}function V(S){m=S,n(6,m)}const F=()=>n(7,c=!1);function J(S){c=S,n(7,c)}return s.$$set=S=>{"pt"in S&&n(0,o=S.pt)},s.$$.update=()=>{s.$$.dirty&2&&window.localStorage.setItem("inspector",i),s.$$.dirty&4&&window.localStorage.setItem("scheme_reference",t),s.$$.dirty&8&&window.localStorage.setItem("current_design_stage",r)},[o,i,t,r,u,a,m,c,p,y,_,f,C,B,L,R,P,V,F,J]}class Ze extends O{constructor(e){super(),H(this,e,Ye,Ne,q,{pt:0})}}function Xe(s,e,n){let o;ue(s,ce,a=>n(3,o=a));let{enableAdding:i}=e,t=null,{markerPosition:r=null}=e;fe(()=>{o.on("click",u),o.getCanvas().style.cursor="crosshair"}),we(()=>{t&&t.remove(),o.off("click",u)});function u(a){t||!i||(o.getCanvas().style.cursor="inherit",t=new ve.Marker({draggable:!0}).setLngLat(a.lngLat).addTo(o),n(0,r=t.getLngLat()),t.on("dragstart",()=>{o.getCanvas().style.cursor="grabbing"}),t.on("dragend",()=>{o.getCanvas().style.cursor="inherit",n(0,r=t.getLngLat())}))}return s.$$set=a=>{"enableAdding"in a&&n(1,i=a.enableAdding),"markerPosition"in a&&n(0,r=a.markerPosition)},[r,i]}class xe extends O{constructor(e){super(),H(this,e,Xe,null,q,{enableAdding:1,markerPosition:0})}}function et(s){let e;return{c(){e=A("p"),e.textContent="Click the map to add a critical"},m(n,o){v(n,e,o)},p:Y,i:Y,o:Y,d(n){n&&k(e)}}}function tt(s){let e,n;return e=new Ze({props:{pt:s[0]}}),{c(){b(e.$$.fragment)},m(o,i){h(e,o,i),n=!0},p(o,i){const t={};i&1&&(t.pt=o[0]),e.$set(t)},i(o){n||(g(e.$$.fragment,o),n=!0)},o(o){$(e.$$.fragment,o),n=!1},d(o){w(e,o)}}}function nt(s){let e,n,o,i,t,r;const u=[tt,et],a=[];function m(c,p){return c[0]?0:1}return i=m(s),t=a[i]=u[i](s),{c(){e=A("div"),n=A("h1"),n.textContent="Critical issue entry",o=I(),t.c(),D(e,"slot","sidebar"),D(e,"class","govuk-prose")},m(c,p){v(c,e,p),T(e,n),T(e,o),a[i].m(e,null),r=!0},p(c,p){let y=i;i=m(c),i===y?a[i].p(c,p):(ke(),$(a[y],1,1,()=>{a[y]=null}),ye(),t=a[i],t?t.p(c,p):(t=a[i]=u[i](c),t.c()),g(t,1),t.m(e,null))},i(c){r||(g(t),r=!0)},o(c){$(t),r=!1},d(c){c&&k(e),a[i].d()}}}function st(s){let e,n,o,i,t,r,u,a,m;function c(f){s[4](f)}let p={enableAdding:s[1]};s[0]!==void 0&&(p.markerPosition=s[0]),e=new xe({props:p}),M.push(()=>E(e,"markerPosition",c)),t=new Ee({props:{disabled:!s[1]}});function y(f){s[6](f)}let _={displayEnableButton:!0};return s[1]!==void 0&&(_.isInactive=s[1]),u=new Be({props:_}),s[5](u),M.push(()=>E(u,"isInactive",y)),{c(){b(e.$$.fragment),o=I(),i=A("div"),b(t.$$.fragment),r=I(),b(u.$$.fragment),D(i,"class","top-right svelte-nlvvhu")},m(f,C){h(e,f,C),v(f,o,C),v(f,i,C),h(t,i,null),T(i,r),h(u,i,null),m=!0},p(f,C){const B={};C&2&&(B.enableAdding=f[1]),!n&&C&1&&(n=!0,B.markerPosition=f[0],j(()=>n=!1)),e.$set(B);const L={};C&2&&(L.disabled=!f[1]),t.$set(L);const R={};!a&&C&2&&(a=!0,R.isInactive=f[1],j(()=>a=!1)),u.$set(R)},i(f){m||(g(e.$$.fragment,f),g(t.$$.fragment,f),g(u.$$.fragment,f),m=!0)},o(f){$(e.$$.fragment,f),$(t.$$.fragment,f),$(u.$$.fragment,f),m=!1},d(f){f&&(k(o),k(i)),w(e,f),w(t),s[5](null),w(u)}}}function ot(s){let e,n,o;return n=new Le({props:{style:"dataviz",startBounds:[-5.96,49.89,2.31,55.94],$$slots:{default:[st]},$$scope:{ctx:s}}}),{c(){e=A("div"),b(n.$$.fragment),D(e,"slot","main")},m(i,t){v(i,e,t),h(n,e,null),o=!0},p(i,t){const r={};t&135&&(r.$$scope={dirty:t,ctx:i}),n.$set(r)},i(i){o||(g(n.$$.fragment,i),o=!0)},o(i){$(n.$$.fragment,i),o=!1},d(i){i&&k(e),w(n)}}}function it(s){let e,n,o,i;return e=new De({props:{$$slots:{main:[ot],sidebar:[nt]},$$scope:{ctx:s}}}),{c(){b(e.$$.fragment)},m(t,r){h(e,t,r),n=!0,o||(i=W(window,"keydown",s[3]),o=!0)},p(t,[r]){const u={};r&135&&(u.$$scope={dirty:r,ctx:t}),e.$set(u)},i(t){n||(g(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){w(e,t),o=!1,i()}}}function rt(s,e,n){fe(()=>{Ce()});let o=null,i=!0,t;function r(c){!i&&c.key=="Escape"&&(t.disableStreetView(),c.preventDefault())}function u(c){o=c,n(0,o)}function a(c){M[c?"unshift":"push"](()=>{t=c,n(2,t)})}function m(c){i=c,n(1,i)}return[o,i,t,r,u,a,m]}class at extends O{constructor(e){super(),H(this,e,rt,it,q,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new at({target:document.getElementById("app")});
