import{S as z,i as O,s as H,b as A,c as B,f as w,m as k,k as P,t as $,l as _,p as v,N as me,A as de,F as ie,d as C,h as b,o as h,E as le,e as R,g as I,u as q,v as V,aA as _e,r as U,M as be,an as he,a as we,j as L,q as ge,a5 as ke,z as ve,x as De,n as ye,y as Ce,w as oe}from"./layer_helper_utils-82107f2d.js";import{e as ae,b as Se,d as Ee,L as Ie,M as Me,S as Re}from"./StreetViewController-2396d6ed.js";import{D as Te}from"./DefaultButton-092ed778.js";import{T as $e,W as Le}from"./WarningButton-bcff6923.js";function Ae(s){let e,r,t;function i(o){s[3](o)}let n={label:"Basemap",id:"basemap",choices:[["streets","Streets"],["hybrid","Satellite"],["dataviz","Dataviz"]],disabled:s[0]};return s[1]!==void 0&&(n.value=s[1]),e=new ae({props:n}),A.push(()=>B(e,"value",i)),e.$on("change",s[2]),{c(){w(e.$$.fragment)},m(o,a){k(e,o,a),t=!0},p(o,[a]){const l={};a&1&&(l.disabled=o[0]),!r&&a&2&&(r=!0,l.value=o[1],P(()=>r=!1)),e.$set(l)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){_(e.$$.fragment,o),t=!1},d(o){v(e,o)}}}function Be(s,e,r){let t;me(s,de,l=>r(4,t=l));let{disabled:i}=e,n="dataviz";function o(){t.setStyle(`https://api.maptiler.com/maps/${n}/style.json?key=MZEJTanw3WpxRvt7qDfo`)}function a(l){n=l,r(1,n)}return s.$$set=l=>{"disabled"in l&&r(0,i=l.disabled)},[i,n,o,a]}class Pe extends z{constructor(e){super(),O(this,e,Be,Ae,H,{disabled:0})}}function je(s){let e,r,t,i,n,o;return e=new le({props:{errorMessage:s[1]}}),{c(){w(e.$$.fragment),r=C(),t=R("input"),I(t,"type","text"),I(t,"class","govuk-input"),I(t,"id","locationDescription")},m(a,l){k(e,a,l),b(a,r,l),b(a,t,l),q(t,s[0]),i=!0,n||(o=[V(t,"input",s[5]),V(t,"change",s[3])],n=!0)},p(a,l){const c={};l&2&&(c.errorMessage=a[1]),e.$set(c),l&1&&t.value!==a[0]&&q(t,a[0])},i(a){i||($(e.$$.fragment,a),i=!0)},o(a){_(e.$$.fragment,a),i=!1},d(a){a&&(h(r),h(t)),v(e,a),n=!1,_e(o)}}}function Fe(s){let e;return{c(){e=U("Lookup location description automatically")},m(r,t){b(r,e,t)},d(r){r&&h(e)}}}function qe(s){let e,r,t;function i(o){s[6](o)}let n={id:"lookupLocation",$$slots:{default:[Fe]},$$scope:{ctx:s}};return s[2]!==void 0&&(n.checked=s[2]),e=new Ee({props:n}),A.push(()=>B(e,"checked",i)),{c(){w(e.$$.fragment)},m(o,a){k(e,o,a),t=!0},p(o,a){const l={};a&256&&(l.$$scope={dirty:a,ctx:o}),!r&&a&4&&(r=!0,l.checked=o[2],P(()=>r=!1)),e.$set(l)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){_(e.$$.fragment,o),t=!1},d(o){v(e,o)}}}function We(s){let e,r,t,i;return e=new ie({props:{label:"Describe this location",id:"locationDescription",$$slots:{default:[je]},$$scope:{ctx:s}}}),t=new Se({props:{small:!0,$$slots:{default:[qe]},$$scope:{ctx:s}}}),{c(){w(e.$$.fragment),r=C(),w(t.$$.fragment)},m(n,o){k(e,n,o),b(n,r,o),k(t,n,o),i=!0},p(n,[o]){const a={};o&259&&(a.$$scope={dirty:o,ctx:n}),e.$set(a);const l={};o&260&&(l.$$scope={dirty:o,ctx:n}),t.$set(l)},i(n){i||($(e.$$.fragment,n),$(t.$$.fragment,n),i=!0)},o(n){_(e.$$.fragment,n),_(t.$$.fragment,n),i=!1},d(n){n&&h(r),v(e,n),v(t,n)}}}function Ve(s,e,r){let{locationDescription:t}=e,{locationDescriptionError:i}=e,{pt:n}=e,o=!0;async function a(m){if(!o)return;let D=`https://nominatim.openstreetmap.org/reverse?lat=${m.lat}&lon=${m.lng}&format=json`;try{r(0,t="Loading...");let p=await(await fetch(D)).json();r(0,t=p.address.road??p.display_name)}catch(g){console.log(`Location lookup failed: ${g}`)}}function l(){r(2,o=!1)}function c(){t=this.value,r(0,t)}function f(m){o=m,r(2,o)}return s.$$set=m=>{"locationDescription"in m&&r(0,t=m.locationDescription),"locationDescriptionError"in m&&r(1,i=m.locationDescriptionError),"pt"in m&&r(4,n=m.pt)},s.$$.update=()=>{s.$$.dirty&16&&a(n)},[t,i,o,l,n,c,f]}class ze extends z{constructor(e){super(),O(this,e,Ve,We,H,{locationDescription:0,locationDescriptionError:1,pt:4})}}function Oe(s){let e,r,t,i,n,o;return e=new le({props:{errorMessage:s[7]}}),{c(){w(e.$$.fragment),r=C(),t=R("input"),I(t,"type","text"),I(t,"class","govuk-input"),I(t,"id","inspector")},m(a,l){k(e,a,l),b(a,r,l),b(a,t,l),q(t,s[1]),i=!0,n||(o=V(t,"input",s[18]),n=!0)},p(a,l){const c={};l&128&&(c.errorMessage=a[7]),e.$set(c),l&2&&t.value!==a[1]&&q(t,a[1])},i(a){i||($(e.$$.fragment,a),i=!0)},o(a){_(e.$$.fragment,a),i=!1},d(a){a&&(h(r),h(t)),v(e,a),n=!1,o()}}}function He(s){let e,r,t,i,n,o,a,l;return t=new le({props:{errorMessage:s[8]}}),{c(){e=R("div"),e.textContent="Example: ATF2_WLT_01",r=C(),w(t.$$.fragment),i=C(),n=R("input"),I(e,"class","govuk-hint"),I(n,"type","text"),I(n,"class","govuk-input"),I(n,"id","schemeReference")},m(c,f){b(c,e,f),b(c,r,f),k(t,c,f),b(c,i,f),b(c,n,f),q(n,s[2]),o=!0,a||(l=V(n,"input",s[19]),a=!0)},p(c,f){const m={};f&256&&(m.errorMessage=c[8]),t.$set(m),f&4&&n.value!==c[2]&&q(n,c[2])},i(c){o||($(t.$$.fragment,c),o=!0)},o(c){_(t.$$.fragment,c),o=!1},d(c){c&&(h(e),h(r),h(i),h(n)),v(t,c),a=!1,l()}}}function Ne(s){let e;return{c(){e=U("Export")},m(r,t){b(r,e,t)},d(r){r&&h(e)}}}function Ge(s){let e;return{c(){e=U("Keep editing this issue")},m(r,t){b(r,e,t)},d(r){r&&h(e)}}}function Je(s){let e;return{c(){e=U("Done! Enter a new critical")},m(r,t){b(r,e,t)},d(r){r&&h(e)}}}function Ke(s){let e,r,t,i,n,o,a,l,c,f,m,D;return o=new $e({props:{label:"The new row has already been copied to your clipboard. If it didn't work, copy from below",value:s[16]()}}),c=new we({props:{$$slots:{default:[Ge]},$$scope:{ctx:s}}}),c.$on("click",s[24]),m=new Le({props:{$$slots:{default:[Je]},$$scope:{ctx:s}}}),m.$on("click",Ye),{c(){e=R("div"),r=R("p"),r.innerHTML=`Edit <i>Inspectors Log.xlsx</i>
      , add a new row at the bottom of
      <i>Form Input</i>
      , and press
      <i>Control+V</i>
      to paste.`,t=C(),i=R("p"),i.innerHTML="<b>You have to manually fill out the first ID column!</b>",n=C(),w(o.$$.fragment),a=C(),l=R("div"),w(c.$$.fragment),f=C(),w(m.$$.fragment),I(l,"class","govuk-button-group"),I(e,"class","govuk-prose")},m(g,p){b(g,e,p),L(e,r),L(e,t),L(e,i),L(e,n),k(o,e,null),L(e,a),L(e,l),k(c,l,null),L(l,f),k(m,l,null),D=!0},p(g,p){const y={};p&67108864&&(y.$$scope={dirty:p,ctx:g}),c.$set(y);const E={};p&67108864&&(E.$$scope={dirty:p,ctx:g}),m.$set(E)},i(g){D||($(o.$$.fragment,g),$(c.$$.fragment,g),$(m.$$.fragment,g),D=!0)},o(g){_(o.$$.fragment,g),_(c.$$.fragment,g),_(m.$$.fragment,g),D=!1},d(g){g&&h(e),v(o),v(c),v(m)}}}function Ue(s){let e,r,t,i,n,o,a,l,c,f,m,D,g,p,y,E,M,j,T,W,F;e=new ie({props:{label:"Inspector name",id:"inspector",$$slots:{default:[Oe]},$$scope:{ctx:s}}}),t=new ie({props:{label:"Scheme reference",id:"schemeReference",$$slots:{default:[He]},$$scope:{ctx:s}}});function Q(u){s[20](u)}let N={label:"Current design stage",id:"currentDesignStage",choices:s[14],emptyOption:!0,errorMessage:s[9]};s[3]!==void 0&&(N.value=s[3]),n=new ae({props:N}),A.push(()=>B(n,"value",Q));function Y(u){s[21](u)}let G={pt:s[0],locationDescriptionError:s[11]};s[5]!==void 0&&(G.locationDescription=s[5]),l=new ze({props:G}),A.push(()=>B(l,"locationDescription",Y));function Z(u){s[22](u)}let J={label:"Critical issue type",id:"criticalIssueType",choices:s[15],emptyOption:!0,errorMessage:s[10]};s[4]!==void 0&&(J.value=s[4]),m=new ae({props:J}),A.push(()=>B(m,"value",Z));function X(u){s[23](u)}let S={label:"Comments or notes",errorMessage:s[12]};s[6]!==void 0&&(S.value=s[6]),p=new $e({props:S}),A.push(()=>B(p,"value",X)),M=new Te({props:{$$slots:{default:[Ne]},$$scope:{ctx:s}}}),M.$on("click",s[17]);function x(u){s[25](u)}let ee={title:"Almost done!",displayEscapeButton:!1,canCloseByClickingBackground:!1,$$slots:{default:[Ke]},$$scope:{ctx:s}};return s[13]!==void 0&&(ee.open=s[13]),T=new be({props:ee}),A.push(()=>B(T,"open",x)),{c(){w(e.$$.fragment),r=C(),w(t.$$.fragment),i=C(),w(n.$$.fragment),a=C(),w(l.$$.fragment),f=C(),w(m.$$.fragment),g=C(),w(p.$$.fragment),E=C(),w(M.$$.fragment),j=C(),w(T.$$.fragment)},m(u,d){k(e,u,d),b(u,r,d),k(t,u,d),b(u,i,d),k(n,u,d),b(u,a,d),k(l,u,d),b(u,f,d),k(m,u,d),b(u,g,d),k(p,u,d),b(u,E,d),k(M,u,d),b(u,j,d),k(T,u,d),F=!0},p(u,[d]){const ue={};d&67108994&&(ue.$$scope={dirty:d,ctx:u}),e.$set(ue);const ce={};d&67109124&&(ce.$$scope={dirty:d,ctx:u}),t.$set(ce);const te={};d&512&&(te.errorMessage=u[9]),!o&&d&8&&(o=!0,te.value=u[3],P(()=>o=!1)),n.$set(te);const K={};d&1&&(K.pt=u[0]),d&2048&&(K.locationDescriptionError=u[11]),!c&&d&32&&(c=!0,K.locationDescription=u[5],P(()=>c=!1)),l.$set(K);const ne={};d&1024&&(ne.errorMessage=u[10]),!D&&d&16&&(D=!0,ne.value=u[4],P(()=>D=!1)),m.$set(ne);const re={};d&4096&&(re.errorMessage=u[12]),!y&&d&64&&(y=!0,re.value=u[6],P(()=>y=!1)),p.$set(re);const fe={};d&67108864&&(fe.$$scope={dirty:d,ctx:u}),M.$set(fe);const se={};d&67117056&&(se.$$scope={dirty:d,ctx:u}),!W&&d&8192&&(W=!0,se.open=u[13],P(()=>W=!1)),T.$set(se)},i(u){F||($(e.$$.fragment,u),$(t.$$.fragment,u),$(n.$$.fragment,u),$(l.$$.fragment,u),$(m.$$.fragment,u),$(p.$$.fragment,u),$(M.$$.fragment,u),$(T.$$.fragment,u),F=!0)},o(u){_(e.$$.fragment,u),_(t.$$.fragment,u),_(n.$$.fragment,u),_(l.$$.fragment,u),_(m.$$.fragment,u),_(p.$$.fragment,u),_(M.$$.fragment,u),_(T.$$.fragment,u),F=!1},d(u){u&&(h(r),h(i),h(a),h(f),h(g),h(E),h(j)),v(e,u),v(t,u),v(n,u),v(l,u),v(m,u),v(p,u),v(M,u),v(T,u)}}}function pe(s){return s.map(e=>[e,e])}function Qe(s){let e=25569,t=24*(60*60*1e3);return s.getTime()/t+e}function Ye(){location.reload()}function Ze(s,e,r){let{pt:t}=e,i=window.localStorage.getItem("inspector")??"",n=window.localStorage.getItem("schemeReference")??"",o=window.localStorage.getItem("currentDesignStage")??"",a="",l="",c="",f="",m="",D="",g="",p="",y="",E=!1,M=pe(["Baseline","Feasibility Design","Preliminary Design","Outline Design","Detailed Design","Inspection"]),j=pe(["1 - Conflict at Side Roads","2 - Conflict at Major Junctions / Roundabouts","3 - Collision Alongside or from Behind","4 - Trip Hazard","5 - Kerbside Activity","6A - Risk of Crossing Conflict (Busy Roads)","6B - Risk of Crossing Conflict (Quieter Roads)","7A - Standard of Crossing Facility (Busy Roads)","7B - Standard of Crossing Facility (Junction)","8 - Traffic Speed (>37mph)","9A - Traffic Volume (>10,000vpd)","9B - Traffic Volume (>5% HGVs)","10 - Crossing Speed","11A - Footway Width (Absolute Minimum <1m)","11B - Footway Width (at Pinchpoints)","11C - Footway Width - Poor Pedestrian Comfort","12 - Tram - Insufficient width next to Tram Track","13 - Tram/Rail - Poor Crossing Angle","14 - Major Cycle Surface Defect","15 - Major Pedestrian Surface Defect","16 - Inappropriate Shared Use","17 - Barriers, Steps and/or Dismount signs","18 - Route isn't direct, logical or intuitive to all users","19 - Inappropriate Surface Materials","20 - Inappropriate Lighting","21 - Routes must join other facilities as a network"]);function T(){let S=0,x=Qe(new Date);return[S,i,x,n,o,a,he(t.toArray().reverse()).join(", "),l,c].join("	")}function W(){r(7,f=i?"":"Required"),r(8,m=n?"":"Required"),r(9,D=o?"":"Required"),r(10,g=a?"":"Required"),r(11,p=l?"":"Required"),r(12,y=c?"":"Required"),!(f||m||D||g||p||y)&&(navigator.clipboard.writeText(T()),r(13,E=!0))}function F(){i=this.value,r(1,i)}function Q(){n=this.value,r(2,n)}function N(S){o=S,r(3,o)}function Y(S){l=S,r(5,l)}function G(S){a=S,r(4,a)}function Z(S){c=S,r(6,c)}const J=()=>r(13,E=!1);function X(S){E=S,r(13,E)}return s.$$set=S=>{"pt"in S&&r(0,t=S.pt)},s.$$.update=()=>{s.$$.dirty&2&&window.localStorage.setItem("inspector",i),s.$$.dirty&4&&window.localStorage.setItem("schemeReference",n),s.$$.dirty&8&&window.localStorage.setItem("currentDesignStage",o)},[t,i,n,o,a,l,c,f,m,D,g,p,y,E,M,j,T,W,F,Q,N,Y,G,Z,J,X]}class Xe extends z{constructor(e){super(),O(this,e,Ze,Ue,H,{pt:0})}}function xe(s,e,r){let t;me(s,de,l=>r(3,t=l));let{enableAdding:i}=e,n=null,{markerPosition:o=null}=e;ge(()=>{t.on("click",a),t.getCanvas().style.cursor="crosshair"}),ke(()=>{n&&n.remove(),t.off("click",a)});function a(l){n||!i||(t.getCanvas().style.cursor="inherit",n=new ve.Marker({draggable:!0}).setLngLat(l.lngLat).addTo(t),r(0,o=n.getLngLat()),n.on("dragstart",()=>{t.getCanvas().style.cursor="grabbing"}),n.on("dragend",()=>{t.getCanvas().style.cursor="inherit",r(0,o=n.getLngLat())}))}return s.$$set=l=>{"enableAdding"in l&&r(1,i=l.enableAdding),"markerPosition"in l&&r(0,o=l.markerPosition)},[o,i]}class et extends z{constructor(e){super(),O(this,e,xe,null,H,{enableAdding:1,markerPosition:0})}}function tt(s){let e;return{c(){e=R("p"),e.textContent="Click the map to add a critical"},m(r,t){b(r,e,t)},p:oe,i:oe,o:oe,d(r){r&&h(e)}}}function nt(s){let e,r;return e=new Xe({props:{pt:s[0]}}),{c(){w(e.$$.fragment)},m(t,i){k(e,t,i),r=!0},p(t,i){const n={};i&1&&(n.pt=t[0]),e.$set(n)},i(t){r||($(e.$$.fragment,t),r=!0)},o(t){_(e.$$.fragment,t),r=!1},d(t){v(e,t)}}}function rt(s){let e,r,t,i,n,o;const a=[nt,tt],l=[];function c(f,m){return f[0]?0:1}return i=c(s),n=l[i]=a[i](s),{c(){e=R("div"),r=R("h1"),r.textContent="Critical issue entry",t=C(),n.c(),I(e,"slot","sidebar"),I(e,"class","govuk-prose")},m(f,m){b(f,e,m),L(e,r),L(e,t),l[i].m(e,null),o=!0},p(f,m){let D=i;i=c(f),i===D?l[i].p(f,m):(De(),_(l[D],1,1,()=>{l[D]=null}),ye(),n=l[i],n?n.p(f,m):(n=l[i]=a[i](f),n.c()),$(n,1),n.m(e,null))},i(f){o||($(n),o=!0)},o(f){_(n),o=!1},d(f){f&&h(e),l[i].d()}}}function st(s){let e,r,t,i,n,o,a,l,c;function f(p){s[4](p)}let m={enableAdding:s[1]};s[0]!==void 0&&(m.markerPosition=s[0]),e=new et({props:m}),A.push(()=>B(e,"markerPosition",f)),n=new Pe({props:{disabled:!s[1]}});function D(p){s[6](p)}let g={displayEnableButton:!0};return s[1]!==void 0&&(g.isInactive=s[1]),a=new Re({props:g}),s[5](a),A.push(()=>B(a,"isInactive",D)),{c(){w(e.$$.fragment),t=C(),i=R("div"),w(n.$$.fragment),o=C(),w(a.$$.fragment),I(i,"class","top-right svelte-nlvvhu")},m(p,y){k(e,p,y),b(p,t,y),b(p,i,y),k(n,i,null),L(i,o),k(a,i,null),c=!0},p(p,y){const E={};y&2&&(E.enableAdding=p[1]),!r&&y&1&&(r=!0,E.markerPosition=p[0],P(()=>r=!1)),e.$set(E);const M={};y&2&&(M.disabled=!p[1]),n.$set(M);const j={};!l&&y&2&&(l=!0,j.isInactive=p[1],P(()=>l=!1)),a.$set(j)},i(p){c||($(e.$$.fragment,p),$(n.$$.fragment,p),$(a.$$.fragment,p),c=!0)},o(p){_(e.$$.fragment,p),_(n.$$.fragment,p),_(a.$$.fragment,p),c=!1},d(p){p&&(h(t),h(i)),v(e,p),v(n),s[5](null),v(a)}}}function ot(s){let e,r,t;return r=new Me({props:{style:"dataviz",startBounds:[-5.96,49.89,2.31,55.94],$$slots:{default:[st]},$$scope:{ctx:s}}}),{c(){e=R("div"),w(r.$$.fragment),I(e,"slot","main")},m(i,n){b(i,e,n),k(r,e,null),t=!0},p(i,n){const o={};n&135&&(o.$$scope={dirty:n,ctx:i}),r.$set(o)},i(i){t||($(r.$$.fragment,i),t=!0)},o(i){_(r.$$.fragment,i),t=!1},d(i){i&&h(e),v(r)}}}function it(s){let e,r,t,i;return e=new Ie({props:{sidebarWidth:"35rem",$$slots:{main:[ot],sidebar:[rt]},$$scope:{ctx:s}}}),{c(){w(e.$$.fragment)},m(n,o){k(e,n,o),r=!0,t||(i=V(window,"keydown",s[3]),t=!0)},p(n,[o]){const a={};o&135&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){r||($(e.$$.fragment,n),r=!0)},o(n){_(e.$$.fragment,n),r=!1},d(n){v(e,n),t=!1,i()}}}function at(s,e,r){ge(()=>{Ce()});let t=null,i=!0,n;function o(f){!i&&f.key=="Escape"&&(n.disableStreetView(),f.preventDefault())}function a(f){t=f,r(0,t)}function l(f){A[f?"unshift":"push"](()=>{n=f,r(2,n)})}function c(f){i=f,r(1,i)}return[t,i,n,o,a,l,c]}class lt extends z{constructor(e){super(),O(this,e,at,it,H,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new lt({target:document.getElementById("app")});
