import{S as G,i as O,s as q,b as B,c as M,f as w,m as y,k as F,t as $,l as b,p as C,W as oe,A as re,F as N,d as P,h,o as v,e as T,g as I,u as E,v as z,aH as ue,r as ae,au as ce,q as le,ac as fe,z as pe,j as U,x as me,n as de,y as _e,w as K}from"./layer_helper_utils-01d185c0.js";import{e as Q,b as ge,d as $e,L as be,M as he,S as ve}from"./StreetViewController-de46511c.js";import{D as ke}from"./DefaultButton-7b002e7b.js";import{T as we}from"./TextArea-4fa02107.js";function ye(i){let e,n,o;function s(a){i[3](a)}let t={label:"Basemap",id:"basemap",choices:[["streets","Streets"],["hybrid","Satellite"],["dataviz","Dataviz"]],disabled:i[0]};return i[1]!==void 0&&(t.value=i[1]),e=new Q({props:t}),B.push(()=>M(e,"value",s)),e.$on("change",i[2]),{c(){w(e.$$.fragment)},m(a,u){y(e,a,u),o=!0},p(a,[u]){const l={};u&1&&(l.disabled=a[0]),!n&&u&2&&(n=!0,l.value=a[1],F(()=>n=!1)),e.$set(l)},i(a){o||($(e.$$.fragment,a),o=!0)},o(a){b(e.$$.fragment,a),o=!1},d(a){C(e,a)}}}function Ce(i,e,n){let o;oe(i,re,l=>n(4,o=l));let{disabled:s}=e,t="dataviz";function a(){o.setStyle(`https://api.maptiler.com/maps/${t}/style.json?key=MZEJTanw3WpxRvt7qDfo`)}function u(l){t=l,n(1,t)}return i.$$set=l=>{"disabled"in l&&n(0,s=l.disabled)},[s,t,a,u]}class Se extends G{constructor(e){super(),O(this,e,Ce,ye,q,{disabled:0})}}function Ie(i){let e,n,o;return{c(){e=T("input"),I(e,"type","text"),I(e,"class","govuk-input govuk-input--width-10"),I(e,"id","inspector")},m(s,t){h(s,e,t),E(e,i[0]),n||(o=z(e,"input",i[12]),n=!0)},p(s,t){t&1&&e.value!==s[0]&&E(e,s[0])},d(s){s&&v(e),n=!1,o()}}}function De(i){let e,n,o;return{c(){e=T("input"),I(e,"type","text"),I(e,"class","govuk-input govuk-input--width-10"),I(e,"id","scheme_reference")},m(s,t){h(s,e,t),E(e,i[1]),n||(o=z(e,"input",i[13]),n=!0)},p(s,t){t&2&&e.value!==s[1]&&E(e,s[1])},d(s){s&&v(e),n=!1,o()}}}function Pe(i){let e,n,o;return{c(){e=T("input"),I(e,"type","text"),I(e,"class","govuk-input govuk-input--width-20"),I(e,"id","location_description")},m(s,t){h(s,e,t),E(e,i[4]),n||(o=[z(e,"input",i[16]),z(e,"change",i[10])],n=!0)},p(s,t){t&16&&e.value!==s[4]&&E(e,s[4])},d(s){s&&v(e),n=!1,ue(o)}}}function Ae(i){let e;return{c(){e=ae("Lookup location description automatically")},m(n,o){h(n,e,o)},d(n){n&&v(e)}}}function Le(i){let e,n,o;function s(a){i[17](a)}let t={id:"lookupLocation",$$slots:{default:[Ae]},$$scope:{ctx:i}};return i[6]!==void 0&&(t.checked=i[6]),e=new $e({props:t}),B.push(()=>M(e,"checked",s)),{c(){w(e.$$.fragment)},m(a,u){y(e,a,u),o=!0},p(a,u){const l={};u&1048576&&(l.$$scope={dirty:u,ctx:a}),!n&&u&64&&(n=!0,l.checked=a[6],F(()=>n=!1)),e.$set(l)},i(a){o||($(e.$$.fragment,a),o=!0)},o(a){b(e.$$.fragment,a),o=!1},d(a){C(e,a)}}}function Be(i){let e;return{c(){e=ae("Export")},m(n,o){h(n,e,o)},d(n){n&&v(e)}}}function Te(i){let e,n,o,s,t,a,u,l,d,c,_,D,k,f,m,A,L,S,R;e=new N({props:{label:"Inspector name",id:"inspector",$$slots:{default:[Ie]},$$scope:{ctx:i}}}),o=new N({props:{label:"Scheme reference",id:"scheme_reference",$$slots:{default:[De]},$$scope:{ctx:i}}});function H(r){i[14](r)}let W={label:"Current design stage",id:"current_design_stage",choices:i[7],emptyOption:!0};i[2]!==void 0&&(W.value=i[2]),t=new Q({props:W}),B.push(()=>M(t,"value",H));function J(r){i[15](r)}let g={label:"Critical issue type",id:"critical_issue_type",choices:i[8],emptyOption:!0};i[3]!==void 0&&(g.value=i[3]),l=new Q({props:g}),B.push(()=>M(l,"value",J)),_=new N({props:{label:"Describe this location",id:"location_description",$$slots:{default:[Pe]},$$scope:{ctx:i}}}),k=new ge({props:{small:!0,$$slots:{default:[Le]},$$scope:{ctx:i}}});function V(r){i[18](r)}let j={label:"Comments or notes"};return i[5]!==void 0&&(j.value=i[5]),m=new we({props:j}),B.push(()=>M(m,"value",V)),S=new ke({props:{$$slots:{default:[Be]},$$scope:{ctx:i}}}),S.$on("click",i[9]),{c(){w(e.$$.fragment),n=P(),w(o.$$.fragment),s=P(),w(t.$$.fragment),u=P(),w(l.$$.fragment),c=P(),w(_.$$.fragment),D=P(),w(k.$$.fragment),f=P(),w(m.$$.fragment),L=P(),w(S.$$.fragment)},m(r,p){y(e,r,p),h(r,n,p),y(o,r,p),h(r,s,p),y(t,r,p),h(r,u,p),y(l,r,p),h(r,c,p),y(_,r,p),h(r,D,p),y(k,r,p),h(r,f,p),y(m,r,p),h(r,L,p),y(S,r,p),R=!0},p(r,[p]){const Z={};p&1048577&&(Z.$$scope={dirty:p,ctx:r}),e.$set(Z);const X={};p&1048578&&(X.$$scope={dirty:p,ctx:r}),o.$set(X);const Y={};!a&&p&4&&(a=!0,Y.value=r[2],F(()=>a=!1)),t.$set(Y);const x={};!d&&p&8&&(d=!0,x.value=r[3],F(()=>d=!1)),l.$set(x);const ee={};p&1048592&&(ee.$$scope={dirty:p,ctx:r}),_.$set(ee);const te={};p&1048640&&(te.$$scope={dirty:p,ctx:r}),k.$set(te);const ne={};!A&&p&32&&(A=!0,ne.value=r[5],F(()=>A=!1)),m.$set(ne);const se={};p&1048576&&(se.$$scope={dirty:p,ctx:r}),S.$set(se)},i(r){R||($(e.$$.fragment,r),$(o.$$.fragment,r),$(t.$$.fragment,r),$(l.$$.fragment,r),$(_.$$.fragment,r),$(k.$$.fragment,r),$(m.$$.fragment,r),$(S.$$.fragment,r),R=!0)},o(r){b(e.$$.fragment,r),b(o.$$.fragment,r),b(t.$$.fragment,r),b(l.$$.fragment,r),b(_.$$.fragment,r),b(k.$$.fragment,r),b(m.$$.fragment,r),b(S.$$.fragment,r),R=!1},d(r){r&&(v(n),v(s),v(u),v(c),v(D),v(f),v(L)),C(e,r),C(o,r),C(t,r),C(l,r),C(_,r),C(k,r),C(m,r),C(S,r)}}}function ie(i){return i.map(e=>[e,e])}function je(i){let e=25569,o=24*(60*60*1e3);return i.getTime()/o+e}function Me(i,e,n){let{pt:o}=e,s=window.localStorage.getItem("inspector")??"",t=window.localStorage.getItem("scheme_reference")??"",a="",u="",l="",d="",c=ie(["Baseline","Feasibility Design","Preliminary Design","Outline Design","Detailed Design","Inspection"]),_=ie(["1 - Conflict at Side Roads","2 - Conflict at Major Junctions / Roundabouts","3 - Collision Alongside or from Behind","4 - Trip Hazard","5 - Kerbside Activity","6A - Risk of Crossing Conflict (Busy Roads)","6B - Risk of Crossing Conflict (Quieter Roads)","7A - Standard of Crossing Facility (Busy Roads)","7B - Standard of Crossing Facility (Junction)","8 - Traffic Speed (>37mph)","9A - Traffic Volume (>10,000vpd)","9B - Traffic Volume (>5% HGVs)","10 - Crossing Speed","11A - Footway Width (Absolute Minimum <1m)","11B - Footway Width (at Pinchpoints)","11C - Footway Width - Poor Pedestrian Comfort","12 - Tram - Insufficient width next to Tram Track","13 - Tram/Rail - Poor Crossing Angle","14 - Major Cycle Surface Defect","15 - Major Pedestrian Surface Defect","16 - Inappropriate Shared Use","17 - Barriers, Steps and/or Dismount signs","18 - Route isn't direct, logical or intuitive to all users","19 - Inappropriate Surface Materials","20 - Inappropriate Lighting","21 - Routes must join other facilities as a network"]);function D(){let g=0,V=je(new Date),j=[g,s,V,t,a,u,ce(o.toArray().reverse()).join(","),l,d];navigator.clipboard.writeText(j.join("	")),window.alert("Go to a new row at the bottom of Form Input, and press Control+V to paste")}let k=!0;async function f(g){if(!k)return;let V=`https://nominatim.openstreetmap.org/reverse?lat=${g.lat}&lon=${g.lng}&format=json`;try{n(4,l="Loading...");let r=await(await fetch(V)).json();n(4,l=r.address.road??r.display_name)}catch(j){console.log(`Location lookup failed: ${j}`)}}function m(){n(6,k=!1)}function A(){s=this.value,n(0,s)}function L(){t=this.value,n(1,t)}function S(g){a=g,n(2,a)}function R(g){u=g,n(3,u)}function H(){l=this.value,n(4,l)}function W(g){k=g,n(6,k)}function J(g){d=g,n(5,d)}return i.$$set=g=>{"pt"in g&&n(11,o=g.pt)},i.$$.update=()=>{i.$$.dirty&1&&window.localStorage.setItem("inspector",s),i.$$.dirty&2&&window.localStorage.setItem("scheme_reference",t),i.$$.dirty&2048&&f(o)},[s,t,a,u,l,d,k,c,_,D,m,o,A,L,S,R,H,W,J]}class Fe extends G{constructor(e){super(),O(this,e,Me,Te,q,{pt:11})}}function Re(i,e,n){let o;oe(i,re,l=>n(3,o=l));let{enableAdding:s}=e,t=null,{markerPosition:a=null}=e;le(()=>{o.on("click",u),o.getCanvas().style.cursor="crosshair"}),fe(()=>{t&&t.remove(),o.off("click",u)});function u(l){t||!s||(o.getCanvas().style.cursor="inherit",t=new pe.Marker({draggable:!0}).setLngLat(l.lngLat).addTo(o),n(0,a=t.getLngLat()),t.on("dragstart",()=>{o.getCanvas().style.cursor="grabbing"}),t.on("dragend",()=>{o.getCanvas().style.cursor="inherit",n(0,a=t.getLngLat())}))}return i.$$set=l=>{"enableAdding"in l&&n(1,s=l.enableAdding),"markerPosition"in l&&n(0,a=l.markerPosition)},[a,s]}class Ee extends G{constructor(e){super(),O(this,e,Re,null,q,{enableAdding:1,markerPosition:0})}}function Ve(i){let e;return{c(){e=T("p"),e.textContent="Click the map to add a critical"},m(n,o){h(n,e,o)},p:K,i:K,o:K,d(n){n&&v(e)}}}function ze(i){let e,n;return e=new Fe({props:{pt:i[0]}}),{c(){w(e.$$.fragment)},m(o,s){y(e,o,s),n=!0},p(o,s){const t={};s&1&&(t.pt=o[0]),e.$set(t)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){b(e.$$.fragment,o),n=!1},d(o){C(e,o)}}}function We(i){let e,n,o,s,t,a;const u=[ze,Ve],l=[];function d(c,_){return c[0]?0:1}return s=d(i),t=l[s]=u[s](i),{c(){e=T("div"),n=T("h1"),n.textContent="Critical issue entry",o=P(),t.c(),I(e,"slot","sidebar"),I(e,"class","govuk-prose")},m(c,_){h(c,e,_),U(e,n),U(e,o),l[s].m(e,null),a=!0},p(c,_){let D=s;s=d(c),s===D?l[s].p(c,_):(me(),b(l[D],1,1,()=>{l[D]=null}),de(),t=l[s],t?t.p(c,_):(t=l[s]=u[s](c),t.c()),$(t,1),t.m(e,null))},i(c){a||($(t),a=!0)},o(c){b(t),a=!1},d(c){c&&v(e),l[s].d()}}}function Ge(i){let e,n,o,s,t,a,u,l,d;function c(f){i[4](f)}let _={enableAdding:i[1]};i[0]!==void 0&&(_.markerPosition=i[0]),e=new Ee({props:_}),B.push(()=>M(e,"markerPosition",c)),t=new Se({props:{disabled:!i[1]}});function D(f){i[6](f)}let k={displayEnableButton:!0};return i[1]!==void 0&&(k.isInactive=i[1]),u=new ve({props:k}),i[5](u),B.push(()=>M(u,"isInactive",D)),{c(){w(e.$$.fragment),o=P(),s=T("div"),w(t.$$.fragment),a=P(),w(u.$$.fragment),I(s,"class","top-right svelte-nlvvhu")},m(f,m){y(e,f,m),h(f,o,m),h(f,s,m),y(t,s,null),U(s,a),y(u,s,null),d=!0},p(f,m){const A={};m&2&&(A.enableAdding=f[1]),!n&&m&1&&(n=!0,A.markerPosition=f[0],F(()=>n=!1)),e.$set(A);const L={};m&2&&(L.disabled=!f[1]),t.$set(L);const S={};!l&&m&2&&(l=!0,S.isInactive=f[1],F(()=>l=!1)),u.$set(S)},i(f){d||($(e.$$.fragment,f),$(t.$$.fragment,f),$(u.$$.fragment,f),d=!0)},o(f){b(e.$$.fragment,f),b(t.$$.fragment,f),b(u.$$.fragment,f),d=!1},d(f){f&&(v(o),v(s)),C(e,f),C(t),i[5](null),C(u)}}}function Oe(i){let e,n,o;return n=new he({props:{style:"dataviz",startBounds:[-5.96,49.89,2.31,55.94],$$slots:{default:[Ge]},$$scope:{ctx:i}}}),{c(){e=T("div"),w(n.$$.fragment),I(e,"slot","main")},m(s,t){h(s,e,t),y(n,e,null),o=!0},p(s,t){const a={};t&135&&(a.$$scope={dirty:t,ctx:s}),n.$set(a)},i(s){o||($(n.$$.fragment,s),o=!0)},o(s){b(n.$$.fragment,s),o=!1},d(s){s&&v(e),C(n)}}}function qe(i){let e,n,o,s;return e=new be({props:{$$slots:{main:[Oe],sidebar:[We]},$$scope:{ctx:i}}}),{c(){w(e.$$.fragment)},m(t,a){y(e,t,a),n=!0,o||(s=z(window,"keydown",i[3]),o=!0)},p(t,[a]){const u={};a&135&&(u.$$scope={dirty:a,ctx:t}),e.$set(u)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){C(e,t),o=!1,s()}}}function He(i,e,n){le(()=>{_e()});let o=null,s=!0,t;function a(c){!s&&c.key=="Escape"&&(t.disableStreetView(),c.preventDefault())}function u(c){o=c,n(0,o)}function l(c){B[c?"unshift":"push"](()=>{t=c,n(2,t)})}function d(c){s=c,n(1,s)}return[o,s,t,a,u,l,d]}class Je extends G{constructor(e){super(),O(this,e,He,qe,q,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Je({target:document.getElementById("app")});
