import{S as W,i as O,s as H,b as L,c as A,f as b,m as h,k as P,t as $,l as _,p as w,N as me,A as ge,F as ie,d as C,h as k,o as v,E as le,e as R,g as M,u as q,v as z,aA as _e,r as U,M as be,an as he,a as we,j as B,q as de,a5 as ke,z as ve,x as De,n as ye,y as Ce,w as oe}from"./layer_helper_utils-add7f0af.js";import{e as ae,b as Se,d as Ie,L as Me,M as Ee,S as Re}from"./StreetViewController-72772fe4.js";import{D as Te}from"./DefaultButton-958b3452.js";import{T as $e,W as Be}from"./WarningButton-cec559fa.js";function Le(s){let e,n,t;function a(i){s[3](i)}let r={label:"Basemap",id:"basemap",choices:[["streets","Streets"],["hybrid","Satellite"],["dataviz","Dataviz"]],disabled:s[0]};return s[1]!==void 0&&(r.value=s[1]),e=new ae({props:r}),L.push(()=>A(e,"value",a)),e.$on("change",s[2]),{c(){b(e.$$.fragment)},m(i,o){h(e,i,o),t=!0},p(i,[o]){const l={};o&1&&(l.disabled=i[0]),!n&&o&2&&(n=!0,l.value=i[1],P(()=>n=!1)),e.$set(l)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){_(e.$$.fragment,i),t=!1},d(i){w(e,i)}}}function Ae(s,e,n){let t;me(s,ge,l=>n(4,t=l));let{disabled:a}=e,r="dataviz";function i(){t.setStyle(`https://api.maptiler.com/maps/${r}/style.json?key=MZEJTanw3WpxRvt7qDfo`)}function o(l){r=l,n(1,r)}return s.$$set=l=>{"disabled"in l&&n(0,a=l.disabled)},[a,r,i,o]}class Pe extends W{constructor(e){super(),O(this,e,Ae,Le,H,{disabled:0})}}function je(s){let e,n,t,a,r,i;return e=new le({props:{errorMessage:s[1]}}),{c(){b(e.$$.fragment),n=C(),t=R("input"),M(t,"type","text"),M(t,"class","govuk-input govuk-input--width-20"),M(t,"id","locationDescription")},m(o,l){h(e,o,l),k(o,n,l),k(o,t,l),q(t,s[0]),a=!0,r||(i=[z(t,"input",s[5]),z(t,"change",s[3])],r=!0)},p(o,l){const p={};l&2&&(p.errorMessage=o[1]),e.$set(p),l&1&&t.value!==o[0]&&q(t,o[0])},i(o){a||($(e.$$.fragment,o),a=!0)},o(o){_(e.$$.fragment,o),a=!1},d(o){o&&(v(n),v(t)),w(e,o),r=!1,_e(i)}}}function Fe(s){let e;return{c(){e=U("Lookup location description automatically")},m(n,t){k(n,e,t)},d(n){n&&v(e)}}}function qe(s){let e,n,t;function a(i){s[6](i)}let r={id:"lookupLocation",$$slots:{default:[Fe]},$$scope:{ctx:s}};return s[2]!==void 0&&(r.checked=s[2]),e=new Ie({props:r}),L.push(()=>A(e,"checked",a)),{c(){b(e.$$.fragment)},m(i,o){h(e,i,o),t=!0},p(i,o){const l={};o&256&&(l.$$scope={dirty:o,ctx:i}),!n&&o&4&&(n=!0,l.checked=i[2],P(()=>n=!1)),e.$set(l)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){_(e.$$.fragment,i),t=!1},d(i){w(e,i)}}}function Ve(s){let e,n,t,a;return e=new ie({props:{label:"Describe this location",id:"locationDescription",$$slots:{default:[je]},$$scope:{ctx:s}}}),t=new Se({props:{small:!0,$$slots:{default:[qe]},$$scope:{ctx:s}}}),{c(){b(e.$$.fragment),n=C(),b(t.$$.fragment)},m(r,i){h(e,r,i),k(r,n,i),h(t,r,i),a=!0},p(r,[i]){const o={};i&259&&(o.$$scope={dirty:i,ctx:r}),e.$set(o);const l={};i&260&&(l.$$scope={dirty:i,ctx:r}),t.$set(l)},i(r){a||($(e.$$.fragment,r),$(t.$$.fragment,r),a=!0)},o(r){_(e.$$.fragment,r),_(t.$$.fragment,r),a=!1},d(r){r&&v(n),w(e,r),w(t,r)}}}function ze(s,e,n){let{locationDescription:t}=e,{locationDescriptionError:a}=e,{pt:r}=e,i=!0;async function o(f){if(!i)return;let D=`https://nominatim.openstreetmap.org/reverse?lat=${f.lat}&lon=${f.lng}&format=json`;try{n(0,t="Loading...");let c=await(await fetch(D)).json();n(0,t=c.address.road??c.display_name)}catch(d){console.log(`Location lookup failed: ${d}`)}}function l(){n(2,i=!1)}function p(){t=this.value,n(0,t)}function m(f){i=f,n(2,i)}return s.$$set=f=>{"locationDescription"in f&&n(0,t=f.locationDescription),"locationDescriptionError"in f&&n(1,a=f.locationDescriptionError),"pt"in f&&n(4,r=f.pt)},s.$$.update=()=>{s.$$.dirty&16&&o(r)},[t,a,i,l,r,p,m]}class We extends W{constructor(e){super(),O(this,e,ze,Ve,H,{locationDescription:0,locationDescriptionError:1,pt:4})}}function Oe(s){let e,n,t,a,r,i;return e=new le({props:{errorMessage:s[7]}}),{c(){b(e.$$.fragment),n=C(),t=R("input"),M(t,"type","text"),M(t,"class","govuk-input govuk-input--width-10"),M(t,"id","inspector")},m(o,l){h(e,o,l),k(o,n,l),k(o,t,l),q(t,s[1]),a=!0,r||(i=z(t,"input",s[18]),r=!0)},p(o,l){const p={};l&128&&(p.errorMessage=o[7]),e.$set(p),l&2&&t.value!==o[1]&&q(t,o[1])},i(o){a||($(e.$$.fragment,o),a=!0)},o(o){_(e.$$.fragment,o),a=!1},d(o){o&&(v(n),v(t)),w(e,o),r=!1,i()}}}function He(s){let e,n,t,a,r,i;return e=new le({props:{errorMessage:s[8]}}),{c(){b(e.$$.fragment),n=C(),t=R("input"),M(t,"type","text"),M(t,"class","govuk-input govuk-input--width-10"),M(t,"id","schemeReference")},m(o,l){h(e,o,l),k(o,n,l),k(o,t,l),q(t,s[2]),a=!0,r||(i=z(t,"input",s[19]),r=!0)},p(o,l){const p={};l&256&&(p.errorMessage=o[8]),e.$set(p),l&4&&t.value!==o[2]&&q(t,o[2])},i(o){a||($(e.$$.fragment,o),a=!0)},o(o){_(e.$$.fragment,o),a=!1},d(o){o&&(v(n),v(t)),w(e,o),r=!1,i()}}}function Ne(s){let e;return{c(){e=U("Export")},m(n,t){k(n,e,t)},d(n){n&&v(e)}}}function Ge(s){let e;return{c(){e=U("Keep editing this issue")},m(n,t){k(n,e,t)},d(n){n&&v(e)}}}function Je(s){let e;return{c(){e=U("Done! Enter a new critical")},m(n,t){k(n,e,t)},d(n){n&&v(e)}}}function Ke(s){let e,n,t,a,r,i,o,l,p,m,f,D;return i=new $e({props:{label:"The new row has already been copied to your clipboard. If it didn't work, copy from below",value:s[16]()}}),p=new we({props:{$$slots:{default:[Ge]},$$scope:{ctx:s}}}),p.$on("click",s[24]),f=new Be({props:{$$slots:{default:[Je]},$$scope:{ctx:s}}}),f.$on("click",Ye),{c(){e=R("div"),n=R("p"),n.innerHTML=`Edit <i>Inspectors Log.xlsx</i>
      , add a new row at the bottom of
      <i>Form Input</i>
      , and press
      <i>Control+V</i>
      to paste.`,t=C(),a=R("p"),a.innerHTML="<b>You have to manually fill out the first ID column!</b>",r=C(),b(i.$$.fragment),o=C(),l=R("div"),b(p.$$.fragment),m=C(),b(f.$$.fragment),M(l,"class","govuk-button-group"),M(e,"class","govuk-prose")},m(d,c){k(d,e,c),B(e,n),B(e,t),B(e,a),B(e,r),h(i,e,null),B(e,o),B(e,l),h(p,l,null),B(l,m),h(f,l,null),D=!0},p(d,c){const y={};c&67108864&&(y.$$scope={dirty:c,ctx:d}),p.$set(y);const I={};c&67108864&&(I.$$scope={dirty:c,ctx:d}),f.$set(I)},i(d){D||($(i.$$.fragment,d),$(p.$$.fragment,d),$(f.$$.fragment,d),D=!0)},o(d){_(i.$$.fragment,d),_(p.$$.fragment,d),_(f.$$.fragment,d),D=!1},d(d){d&&v(e),w(i),w(p),w(f)}}}function Ue(s){let e,n,t,a,r,i,o,l,p,m,f,D,d,c,y,I,E,j,T,V,F;e=new ie({props:{label:"Inspector name",id:"inspector",$$slots:{default:[Oe]},$$scope:{ctx:s}}}),t=new ie({props:{label:"Scheme reference",id:"schemeReference",$$slots:{default:[He]},$$scope:{ctx:s}}});function Q(u){s[20](u)}let N={label:"Current design stage",id:"currentDesignStage",choices:s[14],emptyOption:!0,errorMessage:s[9]};s[3]!==void 0&&(N.value=s[3]),r=new ae({props:N}),L.push(()=>A(r,"value",Q));function Y(u){s[21](u)}let G={pt:s[0],locationDescriptionError:s[11]};s[5]!==void 0&&(G.locationDescription=s[5]),l=new We({props:G}),L.push(()=>A(l,"locationDescription",Y));function Z(u){s[22](u)}let J={label:"Critical issue type",id:"criticalIssueType",choices:s[15],emptyOption:!0,errorMessage:s[10]};s[4]!==void 0&&(J.value=s[4]),f=new ae({props:J}),L.push(()=>A(f,"value",Z));function X(u){s[23](u)}let S={label:"Comments or notes",errorMessage:s[12]};s[6]!==void 0&&(S.value=s[6]),c=new $e({props:S}),L.push(()=>A(c,"value",X)),E=new Te({props:{$$slots:{default:[Ne]},$$scope:{ctx:s}}}),E.$on("click",s[17]);function x(u){s[25](u)}let ee={title:"Almost done!",displayEscapeButton:!1,canCloseByClickingBackground:!1,$$slots:{default:[Ke]},$$scope:{ctx:s}};return s[13]!==void 0&&(ee.open=s[13]),T=new be({props:ee}),L.push(()=>A(T,"open",x)),{c(){b(e.$$.fragment),n=C(),b(t.$$.fragment),a=C(),b(r.$$.fragment),o=C(),b(l.$$.fragment),m=C(),b(f.$$.fragment),d=C(),b(c.$$.fragment),I=C(),b(E.$$.fragment),j=C(),b(T.$$.fragment)},m(u,g){h(e,u,g),k(u,n,g),h(t,u,g),k(u,a,g),h(r,u,g),k(u,o,g),h(l,u,g),k(u,m,g),h(f,u,g),k(u,d,g),h(c,u,g),k(u,I,g),h(E,u,g),k(u,j,g),h(T,u,g),F=!0},p(u,[g]){const ue={};g&67108994&&(ue.$$scope={dirty:g,ctx:u}),e.$set(ue);const ce={};g&67109124&&(ce.$$scope={dirty:g,ctx:u}),t.$set(ce);const te={};g&512&&(te.errorMessage=u[9]),!i&&g&8&&(i=!0,te.value=u[3],P(()=>i=!1)),r.$set(te);const K={};g&1&&(K.pt=u[0]),g&2048&&(K.locationDescriptionError=u[11]),!p&&g&32&&(p=!0,K.locationDescription=u[5],P(()=>p=!1)),l.$set(K);const ne={};g&1024&&(ne.errorMessage=u[10]),!D&&g&16&&(D=!0,ne.value=u[4],P(()=>D=!1)),f.$set(ne);const re={};g&4096&&(re.errorMessage=u[12]),!y&&g&64&&(y=!0,re.value=u[6],P(()=>y=!1)),c.$set(re);const fe={};g&67108864&&(fe.$$scope={dirty:g,ctx:u}),E.$set(fe);const se={};g&67117056&&(se.$$scope={dirty:g,ctx:u}),!V&&g&8192&&(V=!0,se.open=u[13],P(()=>V=!1)),T.$set(se)},i(u){F||($(e.$$.fragment,u),$(t.$$.fragment,u),$(r.$$.fragment,u),$(l.$$.fragment,u),$(f.$$.fragment,u),$(c.$$.fragment,u),$(E.$$.fragment,u),$(T.$$.fragment,u),F=!0)},o(u){_(e.$$.fragment,u),_(t.$$.fragment,u),_(r.$$.fragment,u),_(l.$$.fragment,u),_(f.$$.fragment,u),_(c.$$.fragment,u),_(E.$$.fragment,u),_(T.$$.fragment,u),F=!1},d(u){u&&(v(n),v(a),v(o),v(m),v(d),v(I),v(j)),w(e,u),w(t,u),w(r,u),w(l,u),w(f,u),w(c,u),w(E,u),w(T,u)}}}function pe(s){return s.map(e=>[e,e])}function Qe(s){let e=25569,t=24*(60*60*1e3);return s.getTime()/t+e}function Ye(){location.reload()}function Ze(s,e,n){let{pt:t}=e,a=window.localStorage.getItem("inspector")??"",r=window.localStorage.getItem("schemeReference")??"",i=window.localStorage.getItem("currentDesignStage")??"",o="",l="",p="",m="",f="",D="",d="",c="",y="",I=!1,E=pe(["Baseline","Feasibility Design","Preliminary Design","Outline Design","Detailed Design","Inspection"]),j=pe(["1 - Conflict at Side Roads","2 - Conflict at Major Junctions / Roundabouts","3 - Collision Alongside or from Behind","4 - Trip Hazard","5 - Kerbside Activity","6A - Risk of Crossing Conflict (Busy Roads)","6B - Risk of Crossing Conflict (Quieter Roads)","7A - Standard of Crossing Facility (Busy Roads)","7B - Standard of Crossing Facility (Junction)","8 - Traffic Speed (>37mph)","9A - Traffic Volume (>10,000vpd)","9B - Traffic Volume (>5% HGVs)","10 - Crossing Speed","11A - Footway Width (Absolute Minimum <1m)","11B - Footway Width (at Pinchpoints)","11C - Footway Width - Poor Pedestrian Comfort","12 - Tram - Insufficient width next to Tram Track","13 - Tram/Rail - Poor Crossing Angle","14 - Major Cycle Surface Defect","15 - Major Pedestrian Surface Defect","16 - Inappropriate Shared Use","17 - Barriers, Steps and/or Dismount signs","18 - Route isn't direct, logical or intuitive to all users","19 - Inappropriate Surface Materials","20 - Inappropriate Lighting","21 - Routes must join other facilities as a network"]);function T(){let S=0,x=Qe(new Date);return[S,a,x,r,i,o,he(t.toArray().reverse()).join(", "),l,p].join("	")}function V(){n(7,m=a?"":"Required"),n(8,f=r?"":"Required"),n(9,D=i?"":"Required"),n(10,d=o?"":"Required"),n(11,c=l?"":"Required"),n(12,y=p?"":"Required"),!(m||f||D||d||c||y)&&(navigator.clipboard.writeText(T()),n(13,I=!0))}function F(){a=this.value,n(1,a)}function Q(){r=this.value,n(2,r)}function N(S){i=S,n(3,i)}function Y(S){l=S,n(5,l)}function G(S){o=S,n(4,o)}function Z(S){p=S,n(6,p)}const J=()=>n(13,I=!1);function X(S){I=S,n(13,I)}return s.$$set=S=>{"pt"in S&&n(0,t=S.pt)},s.$$.update=()=>{s.$$.dirty&2&&window.localStorage.setItem("inspector",a),s.$$.dirty&4&&window.localStorage.setItem("schemeReference",r),s.$$.dirty&8&&window.localStorage.setItem("currentDesignStage",i)},[t,a,r,i,o,l,p,m,f,D,d,c,y,I,E,j,T,V,F,Q,N,Y,G,Z,J,X]}class Xe extends W{constructor(e){super(),O(this,e,Ze,Ue,H,{pt:0})}}function xe(s,e,n){let t;me(s,ge,l=>n(3,t=l));let{enableAdding:a}=e,r=null,{markerPosition:i=null}=e;de(()=>{t.on("click",o),t.getCanvas().style.cursor="crosshair"}),ke(()=>{r&&r.remove(),t.off("click",o)});function o(l){r||!a||(t.getCanvas().style.cursor="inherit",r=new ve.Marker({draggable:!0}).setLngLat(l.lngLat).addTo(t),n(0,i=r.getLngLat()),r.on("dragstart",()=>{t.getCanvas().style.cursor="grabbing"}),r.on("dragend",()=>{t.getCanvas().style.cursor="inherit",n(0,i=r.getLngLat())}))}return s.$$set=l=>{"enableAdding"in l&&n(1,a=l.enableAdding),"markerPosition"in l&&n(0,i=l.markerPosition)},[i,a]}class et extends W{constructor(e){super(),O(this,e,xe,null,H,{enableAdding:1,markerPosition:0})}}function tt(s){let e;return{c(){e=R("p"),e.textContent="Click the map to add a critical"},m(n,t){k(n,e,t)},p:oe,i:oe,o:oe,d(n){n&&v(e)}}}function nt(s){let e,n;return e=new Xe({props:{pt:s[0]}}),{c(){b(e.$$.fragment)},m(t,a){h(e,t,a),n=!0},p(t,a){const r={};a&1&&(r.pt=t[0]),e.$set(r)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){w(e,t)}}}function rt(s){let e,n,t,a,r,i;const o=[nt,tt],l=[];function p(m,f){return m[0]?0:1}return a=p(s),r=l[a]=o[a](s),{c(){e=R("div"),n=R("h1"),n.textContent="Critical issue entry",t=C(),r.c(),M(e,"slot","sidebar"),M(e,"class","govuk-prose")},m(m,f){k(m,e,f),B(e,n),B(e,t),l[a].m(e,null),i=!0},p(m,f){let D=a;a=p(m),a===D?l[a].p(m,f):(De(),_(l[D],1,1,()=>{l[D]=null}),ye(),r=l[a],r?r.p(m,f):(r=l[a]=o[a](m),r.c()),$(r,1),r.m(e,null))},i(m){i||($(r),i=!0)},o(m){_(r),i=!1},d(m){m&&v(e),l[a].d()}}}function st(s){let e,n,t,a,r,i,o,l,p;function m(c){s[4](c)}let f={enableAdding:s[1]};s[0]!==void 0&&(f.markerPosition=s[0]),e=new et({props:f}),L.push(()=>A(e,"markerPosition",m)),r=new Pe({props:{disabled:!s[1]}});function D(c){s[6](c)}let d={displayEnableButton:!0};return s[1]!==void 0&&(d.isInactive=s[1]),o=new Re({props:d}),s[5](o),L.push(()=>A(o,"isInactive",D)),{c(){b(e.$$.fragment),t=C(),a=R("div"),b(r.$$.fragment),i=C(),b(o.$$.fragment),M(a,"class","top-right svelte-nlvvhu")},m(c,y){h(e,c,y),k(c,t,y),k(c,a,y),h(r,a,null),B(a,i),h(o,a,null),p=!0},p(c,y){const I={};y&2&&(I.enableAdding=c[1]),!n&&y&1&&(n=!0,I.markerPosition=c[0],P(()=>n=!1)),e.$set(I);const E={};y&2&&(E.disabled=!c[1]),r.$set(E);const j={};!l&&y&2&&(l=!0,j.isInactive=c[1],P(()=>l=!1)),o.$set(j)},i(c){p||($(e.$$.fragment,c),$(r.$$.fragment,c),$(o.$$.fragment,c),p=!0)},o(c){_(e.$$.fragment,c),_(r.$$.fragment,c),_(o.$$.fragment,c),p=!1},d(c){c&&(v(t),v(a)),w(e,c),w(r),s[5](null),w(o)}}}function ot(s){let e,n,t;return n=new Ee({props:{style:"dataviz",startBounds:[-5.96,49.89,2.31,55.94],$$slots:{default:[st]},$$scope:{ctx:s}}}),{c(){e=R("div"),b(n.$$.fragment),M(e,"slot","main")},m(a,r){k(a,e,r),h(n,e,null),t=!0},p(a,r){const i={};r&135&&(i.$$scope={dirty:r,ctx:a}),n.$set(i)},i(a){t||($(n.$$.fragment,a),t=!0)},o(a){_(n.$$.fragment,a),t=!1},d(a){a&&v(e),w(n)}}}function it(s){let e,n,t,a;return e=new Me({props:{$$slots:{main:[ot],sidebar:[rt]},$$scope:{ctx:s}}}),{c(){b(e.$$.fragment)},m(r,i){h(e,r,i),n=!0,t||(a=z(window,"keydown",s[3]),t=!0)},p(r,[i]){const o={};i&135&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||($(e.$$.fragment,r),n=!0)},o(r){_(e.$$.fragment,r),n=!1},d(r){w(e,r),t=!1,a()}}}function at(s,e,n){de(()=>{Ce()});let t=null,a=!0,r;function i(m){!a&&m.key=="Escape"&&(r.disableStreetView(),m.preventDefault())}function o(m){t=m,n(0,t)}function l(m){L[m?"unshift":"push"](()=>{r=m,n(2,r)})}function p(m){a=m,n(1,a)}return[t,a,r,i,o,l,p]}class lt extends W{constructor(e){super(),O(this,e,at,it,H,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new lt({target:document.getElementById("app")});
