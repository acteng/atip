# ATIP GeoJSON specification

NOTE: This document is out-of-date as of November 2024. If you're relying on this file format, please file a Github issue.

This document describes the file format that ATIP creates and exports. It's helpful if you're writing software that consumes these files, or if you're trying to create one using other GIS software. Files produced by ATIP can be used with any GIS software handling GeoJSON files. If you're trying to load a GeoJSON file in ATIP, it won't work unless it fits the format described here.

## Specification

ATIP produces a [GeoJSON file](https://datatracker.ietf.org/doc/html/rfc7946). This section is specific about the contents of it.

### Top-level properties

- The file must be a `FeatureCollection` with one or more features
- The [coordinate reference system](https://datatracker.ietf.org/doc/html/rfc7946#section-4) must be WGS 84, and there should be no top-level `crs` property
- There may be three [foreign members](https://datatracker.ietf.org/doc/html/rfc7946#section-6.1) defined at the top-level:
  - An optional string `origin`, set to `atip-v1` or `atip-v2` when generated by ATIP. If you use another tool, you can omit `origin` or set it to `QGIS`, `Felt`, etc to describe the tool you used.
  - An optional string `authority`, belonging to [this set](https://github.com/acteng/atip/blob/main/assets/authority_names.json)
  - An optional free-form string `scheme_name`

An example of the overall structure:

```
{
  "type": "FeatureCollection",
  "features": [ ... ],
  "authority": "Adur",
  "origin": "atip-v2",
  "scheme_name": "Proposal 123"
}
```

## Features

Each GeoJSON feature represents one geospatial object, or "intervention."

- `id` may be set. ATIP generates opaque numeric IDs -- don't assume they are sequential. These IDs are not guaranteed to be stable across saving and loading the file in ATIP.
- The `geometry` type may be a `Point`, `LineString`, or `Polygon`.
  - Other types like `MultiLineString` and `MultiPolygon` are not supported. Please split individual `LineStrings` or `Polygons` and copy any properties as appropriate.
- Please limit [coordinate precision](https://datatracker.ietf.org/doc/html/rfc7946#section-11.2) to 6 decimal places, representing about 10cm. When loading a file, ATIP may round to this precision.

### Properties

Each feature has several properties:

- `intervention_type`, which should be one of the following: `area`, `route`, `crossing`, or `other`
- An optional string `name`
- An optional string `description`
- For LineStrings, ATIP will populate a numeric `length_meters` property
  - If this is missing in a loaded file, it'll be backfilled automatically

Some `LineString` and `Polygon` features have an optional array as a `waypoints` property. ATIP generates this for all routes drawn and for polygons using the "snapped" tool. It allows these features to later be edited using the same drawing tools, which snap to the existing road network for more convenient drawing. Each entry in the array is a JSON object of the form:

- A numeric `lon` for longitude
- A numeric `lat` for latitude
- A boolean `snapped`, indicating if that waypoint is snapped to the road network or not

If you are generating a file from another tool, omit `waypoints` and don't expect editing the geometry in ATIP to completely work.

## Versioning

This format was defined as of 23 March, 2023. It has not changed since then. If you used an earlier prototype of ATIP, the output file may not match this specification.

## Example

A full example can be found [here](https://raw.githubusercontent.com/acteng/atip/main/tests/data/Adur.json).
