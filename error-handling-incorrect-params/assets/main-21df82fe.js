import{S as K,i as Z,s as Q,e as m,a as b,t as O,b as h,c as S,d as _,f as X,n as G,g as M,h as ve,j as x,k as ie,l as W,u as be,m as ke,o as we,p as ye,q as T,r as C,v as re,w as ge,x as ue,y as $e,z as Ae,A as z,B as Se,C as Me,F as Ee,D as ee,E as fe,G as Be,H as j,I as D,J as de,K as J,L as Fe,M as Ie,N as Te}from"./maplibre_helpers-c61c3e88.js";import{i as Ce}from"./all-3f19c173.js";import{a as Le,A as Ne}from"./About-1dbd0a47.js";function je(n){let t,e,l,i;return{c(){t=m("p"),e=m("span"),e.textContent="Error:",l=b(),i=O(n[0]),h(e,"class","govuk-visually-hidden"),h(t,"class","govuk-error-message")},m(d,a){S(d,t,a),_(t,e),_(t,l),_(t,i)},p(d,[a]){a&1&&X(i,d[0])},i:G,o:G,d(d){d&&M(t)}}}function De(n,t,e){let{errorMessage:l}=t;return n.$$set=i=>{"errorMessage"in i&&e(0,l=i.errorMessage)},[l]}class Je extends K{constructor(t){super(),Z(this,t,De,je,Q,{errorMessage:0})}}function Oe(n){let t,e,l,i;const d=n[2].default,a=ve(d,n,n[1],null);let f=[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},n[0]],r={};for(let s=0;s<f.length;s+=1)r=x(r,f[s]);return{c(){t=m("button"),a&&a.c(),ie(t,r)},m(s,o){S(s,t,o),a&&a.m(t,null),t.autofocus&&t.focus(),e=!0,l||(i=W(t,"click",n[3]),l=!0)},p(s,[o]){a&&a.p&&(!e||o&2)&&be(a,d,s,s[1],e?we(d,s[1],o,null):ke(s[1]),null),ie(t,r=ye(f,[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},o&1&&s[0]]))},i(s){e||(T(a,s),e=!0)},o(s){C(a,s),e=!1},d(s){s&&M(t),a&&a.d(s),l=!1,i()}}}function Pe(n,t,e){let{$$slots:l={},$$scope:i}=t;function d(a){ge.call(this,n,a)}return n.$$set=a=>{e(0,t=x(x({},t),re(a))),"$$scope"in a&&e(1,i=a.$$scope)},t=re(t),[t,i,l,d]}class qe extends K{constructor(t){super(),Z(this,t,Pe,Oe,Q,{})}}function ce(n,t,e){const l=n.slice();return l[7]=t[e][0],l[8]=t[e][1],l}function _e(n){let t,e,l,i,d=!1,a,f,r=n[8]+"",s,o,c,E,B,y;return E=Ae(n[6][0]),{c(){t=m("div"),e=m("input"),a=b(),f=m("label"),s=O(r),c=b(),h(e,"class","govuk-radios__input"),h(e,"id",l=n[2]+n[7]),h(e,"type","radio"),e.__value=i=n[7],z(e,e.__value),h(f,"class","govuk-label govuk-radios__label"),h(f,"for",o=n[2]+n[7]),h(t,"class","govuk-radios__item"),E.p(e)},m(v,A){S(v,t,A),_(t,e),e.checked=e.__value===n[0],_(t,a),_(t,f),_(f,s),_(t,c),B||(y=[W(e,"change",n[5]),W(e,"change",n[4])],B=!0)},p(v,A){A&12&&l!==(l=v[2]+v[7])&&h(e,"id",l),A&8&&i!==(i=v[7])&&(e.__value=i,z(e,e.__value),d=!0),(d||A&9)&&(e.checked=e.__value===v[0]),A&8&&r!==(r=v[8]+"")&&X(s,r),A&12&&o!==(o=v[2]+v[7])&&h(f,"for",o)},d(v){v&&M(t),E.r(),B=!1,Se(y)}}}function Ge(n){let t,e,l,i,d,a,f=ue(n[3]),r=[];for(let s=0;s<f.length;s+=1)r[s]=_e(ce(n,f,s));return{c(){t=m("div"),e=m("fieldset"),l=m("legend"),i=O(n[1]),d=b(),a=m("div");for(let s=0;s<r.length;s+=1)r[s].c();h(l,"class","govuk-fieldset__legend"),h(a,"class","govuk-radios"),h(a,"data-module","govuk-radios"),h(e,"class","govuk-fieldset"),h(t,"class","govuk-form-group")},m(s,o){S(s,t,o),_(t,e),_(e,l),_(l,i),_(e,d),_(e,a);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(a,null)},p(s,[o]){if(o&2&&X(i,s[1]),o&13){f=ue(s[3]);let c;for(c=0;c<f.length;c+=1){const E=ce(s,f,c);r[c]?r[c].p(E,o):(r[c]=_e(E),r[c].c(),r[c].m(a,null))}for(;c<r.length;c+=1)r[c].d(1);r.length=f.length}},i:G,o:G,d(s){s&&M(t),$e(r,s)}}}function Re(n,t,e){let{legend:l}=t,{id:i}=t,{choices:d}=t,{value:a}=t;const f=[[]];function r(o){ge.call(this,n,o)}function s(){a=this.__value,e(0,a)}return n.$$set=o=>{"legend"in o&&e(1,l=o.legend),"id"in o&&e(2,i=o.id),"choices"in o&&e(3,d=o.choices),"value"in o&&e(0,a=o.value)},[a,l,i,d,r,s,f]}class Ue extends K{constructor(t){super(),Z(this,t,Re,Ge,Q,{legend:1,id:2,choices:3,value:0})}}async function Ve(){const t=await(await fetch(Le)).text();return JSON.parse(t)}function He(n){let t;return{c(){t=O("About")},m(e,l){S(e,t,l)},d(e){e&&M(t)}}}function We(n){let t,e;return t=new Je({props:{errorMessage:n[6]}}),{c(){j(t.$$.fragment)},m(l,i){D(t,l,i),e=!0},p:G,i(l){e||(T(t.$$.fragment,l),e=!0)},o(l){C(t.$$.fragment,l),e=!1},d(l){J(t,l)}}}function ze(n){let t,e,l,i,d;return{c(){t=m("input"),e=b(),l=m("datalist"),h(t,"class","govuk-input govuk-input--width-20"),h(t,"id","inputValue"),h(t,"data-testid","transport-authority"),h(t,"list","authorities-list"),h(l,"id","authorities-list")},m(a,f){S(a,t,f),z(t,n[0]),S(a,e,f),S(a,l,f),n[12](l),i||(d=W(t,"input",n[11]),i=!0)},p(a,f){f&1&&t.value!==a[0]&&z(t,a[0])},d(a){a&&(M(t),M(e),M(l)),n[12](null),i=!1,d()}}}function Ke(n){let t;return{c(){t=O("Start")},m(e,l){S(e,t,l)},d(e){e&&M(t)}}}function he(n){let t,e;return{c(){t=m("i"),e=O(n[4])},m(l,i){S(l,t,i),_(t,e)},p(l,i){i&16&&X(e,l[4])},d(l){l&&M(t)}}}function Ze(n){let t,e,l,i,d,a,f,r,s,o,c,E,B,y,v,A,P,R,U,L,k,p,F,g,N,V;d=new Me({props:{$$slots:{default:[He]},$$scope:{ctx:n}}}),d.$on("click",n[10]);let I=n[6]&&We(n);r=new Ee({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[ze]},$$scope:{ctx:n}}}),o=new qe({props:{disabled:!n[5],$$slots:{default:[Ke]},$$scope:{ctx:n}}}),o.$on("click",n[9]);function pe(u){n[13](u)}let te={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]]};n[3]!==void 0&&(te.value=n[3]),y=new Ue({props:te}),ee.push(()=>fe(y,"value",pe)),y.$on("change",n[7]);let $=n[4]&&he(n);L=new Be({props:{label:"Or upload an ATIP GeoJSON file",loadFile:n[8],id:"load-geojson"}});function me(u){n[14](u)}let ne={};return n[1]!==void 0&&(ne.open=n[1]),g=new Ne({props:ne}),ee.push(()=>fe(g,"open",me)),{c(){t=m("div"),e=m("div"),l=m("h1"),l.textContent="Welcome to ATIP v2",i=b(),j(d.$$.fragment),a=b(),I&&I.c(),f=b(),j(r.$$.fragment),s=b(),j(o.$$.fragment),c=b(),E=m("hr"),B=b(),j(y.$$.fragment),A=b(),$&&$.c(),P=b(),R=m("hr"),U=b(),j(L.$$.fragment),k=b(),p=m("div"),p.innerHTML='<div id="map" class="svelte-lyn11h"></div>',F=b(),j(g.$$.fragment),h(l,"class","govuk-heading-l"),h(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),h(p,"class","govuk-grid-column-one-half"),h(t,"class","govuk-grid-row")},m(u,w){S(u,t,w),_(t,e),_(e,l),_(e,i),D(d,e,null),_(e,a),I&&I.m(e,null),_(e,f),D(r,e,null),_(e,s),D(o,e,null),_(e,c),_(e,E),_(e,B),D(y,e,null),_(e,A),$&&$.m(e,null),_(e,P),_(e,R),_(e,U),D(L,e,null),_(t,k),_(t,p),S(u,F,w),D(g,u,w),V=!0},p(u,[w]){const le={};w&262144&&(le.$$scope={dirty:w,ctx:u}),d.$set(le),u[6]&&I.p(u,w);const ae={};w&262149&&(ae.$$scope={dirty:w,ctx:u}),r.$set(ae);const Y={};w&32&&(Y.disabled=!u[5]),w&262144&&(Y.$$scope={dirty:w,ctx:u}),o.$set(Y);const oe={};!v&&w&8&&(v=!0,oe.value=u[3],de(()=>v=!1)),y.$set(oe),u[4]?$?$.p(u,w):($=he(u),$.c(),$.m(e,P)):$&&($.d(1),$=null);const se={};!N&&w&2&&(N=!0,se.open=u[1],de(()=>N=!1)),g.$set(se)},i(u){V||(T(d.$$.fragment,u),T(I),T(r.$$.fragment,u),T(o.$$.fragment,u),T(y.$$.fragment,u),T(L.$$.fragment,u),T(g.$$.fragment,u),V=!0)},o(u){C(d.$$.fragment,u),C(I),C(r.$$.fragment,u),C(o.$$.fragment,u),C(y.$$.fragment,u),C(L.$$.fragment,u),C(g.$$.fragment,u),V=!1},d(u){u&&(M(t),M(F)),J(d),I&&I.d(),J(r),J(o),J(y),$&&$.d(),J(L),J(g,u)}}}let H="boundary",q="boundary-layer";function Qe(n){if(n.features.length>0){let t=n.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function Xe(n,t,e){let l,i=!1,a=new URLSearchParams(window.location.search).get("error"),f,r,s=new Set,o=null,c="TA";function E(){o==null||o.setFilter(q,["==",["get","level"],c])}let B=null;Fe(async()=>{Ce();const k=await Ve();for(let g of k.features){let N=document.createElement("option");N.value=g.properties.name,r.appendChild(N),s.add(g.properties.name)}o=new Ie.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let p=null;function F(){p!==null&&o.setFeatureState({source:H,id:p},{hover:!1})}o.on("load",function(){o.fitBounds(Te(k),{padding:20,animate:!1}),o.addSource(H,{type:"geojson",data:k,generateId:!0}),o.addLayer({id:q,source:H,filter:["==",["get","level"],c],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),o.on("mousemove",q,g=>{g.features.length>0&&(F(),p=g.features[0].id,e(4,B=g.features[0].properties.name),o.setFeatureState({source:H,id:p},{hover:!0}))}),o.on("mouseleave",q,()=>{F(),p=null,e(4,B=null)}),o.on("click",q,function(g){let N=g.features[0].properties.name;window.location.href=`scheme.html?authority=${N}`})})});function y(k){try{let p=JSON.parse(k);if(!p.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!s.has(p.authority))throw new Error(`Unknown authority ${p.authority}`);let F=p.authority,g=Qe(p);g!="v1"&&(F+=`_${g}`),window.localStorage.setItem(F,JSON.stringify(p)),window.location.href=`scheme.html?authority=${p.authority}&schema=${g}`}catch(p){window.alert(`Couldn't load scheme from a file: ${p}`)}}function v(){window.location.href=`scheme.html?authority=${f}`}const A=()=>e(1,i=!i);function P(){f=this.value,e(0,f)}function R(k){ee[k?"unshift":"push"](()=>{r=k,e(2,r)})}function U(k){c=k,e(3,c)}function L(k){i=k,e(1,i)}return n.$$.update=()=>{n.$$.dirty&1&&e(5,l=s.has(f))},[f,i,r,c,B,l,a,E,y,v,A,P,R,U,L]}class Ye extends K{constructor(t){super(),Z(this,t,Xe,Ze,Q,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Ye({target:document.getElementById("app")});
