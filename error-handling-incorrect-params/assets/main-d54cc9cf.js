import{S as Z,i as Q,s as X,e as p,a as $,t as J,b as g,c as E,d as _,f as Y,n as U,g as B,h as be,j as ee,k as ue,l as W,u as ke,m as we,o as $e,p as ye,q as I,r as C,v as fe,w as he,x as de,y as Ae,z as Me,A as z,B as Se,C as Ee,F as Be,D as K,E as te,G as Fe,H as D,I as N,J as Ie,K as ne,L as O,M as Te,N as Ce,O as Le,P as je}from"./maplibre_helpers-350d1756.js";import{i as De}from"./all-3f19c173.js";import{A as Ne,g as Oe}from"./About-2e09b8a3.js";function Je(n){let t,e,a,i;return{c(){t=p("p"),e=p("span"),e.textContent="Error:",a=$(),i=J(n[0]),g(e,"class","govuk-visually-hidden"),g(t,"class","govuk-error-message")},m(d,l){E(d,t,l),_(t,e),_(t,a),_(t,i)},p(d,[l]){l&1&&Y(i,d[0])},i:U,o:U,d(d){d&&B(t)}}}function Pe(n,t,e){let{errorMessage:a}=t;return n.$$set=i=>{"errorMessage"in i&&e(0,a=i.errorMessage)},[a]}class qe extends Z{constructor(t){super(),Q(this,t,Pe,Je,X,{errorMessage:0})}}function Ge(n){let t,e,a,i;const d=n[2].default,l=be(d,n,n[1],null);let u=[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},n[0]],r={};for(let o=0;o<u.length;o+=1)r=ee(r,u[o]);return{c(){t=p("button"),l&&l.c(),ue(t,r)},m(o,s){E(o,t,s),l&&l.m(t,null),t.autofocus&&t.focus(),e=!0,a||(i=W(t,"click",n[3]),a=!0)},p(o,[s]){l&&l.p&&(!e||s&2)&&ke(l,d,o,o[1],e?$e(d,o[1],s,null):we(o[1]),null),ue(t,r=ye(u,[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},s&1&&o[0]]))},i(o){e||(I(l,o),e=!0)},o(o){C(l,o),e=!1},d(o){o&&B(t),l&&l.d(o),a=!1,i()}}}function Re(n,t,e){let{$$slots:a={},$$scope:i}=t;function d(l){he.call(this,n,l)}return n.$$set=l=>{e(0,t=ee(ee({},t),fe(l))),"$$scope"in l&&e(1,i=l.$$scope)},t=fe(t),[t,i,a,d]}class Ve extends Z{constructor(t){super(),Q(this,t,Re,Ge,X,{})}}function ce(n,t,e){const a=n.slice();return a[7]=t[e][0],a[8]=t[e][1],a}function _e(n){let t,e,a,i,d=!1,l,u,r=n[8]+"",o,s,c,F,T,y;return F=Me(n[6][0]),{c(){t=p("div"),e=p("input"),l=$(),u=p("label"),o=J(r),c=$(),g(e,"class","govuk-radios__input"),g(e,"id",a=n[2]+n[7]),g(e,"type","radio"),e.__value=i=n[7],z(e,e.__value),g(u,"class","govuk-label govuk-radios__label"),g(u,"for",s=n[2]+n[7]),g(t,"class","govuk-radios__item"),F.p(e)},m(b,S){E(b,t,S),_(t,e),e.checked=e.__value===n[0],_(t,l),_(t,u),_(u,o),_(t,c),T||(y=[W(e,"change",n[5]),W(e,"change",n[4])],T=!0)},p(b,S){S&12&&a!==(a=b[2]+b[7])&&g(e,"id",a),S&8&&i!==(i=b[7])&&(e.__value=i,z(e,e.__value),d=!0),(d||S&9)&&(e.checked=e.__value===b[0]),S&8&&r!==(r=b[8]+"")&&Y(o,r),S&12&&s!==(s=b[2]+b[7])&&g(u,"for",s)},d(b){b&&B(t),F.r(),T=!1,Se(y)}}}function He(n){let t,e,a,i,d,l,u=de(n[3]),r=[];for(let o=0;o<u.length;o+=1)r[o]=_e(ce(n,u,o));return{c(){t=p("div"),e=p("fieldset"),a=p("legend"),i=J(n[1]),d=$(),l=p("div");for(let o=0;o<r.length;o+=1)r[o].c();g(a,"class","govuk-fieldset__legend"),g(l,"class","govuk-radios"),g(l,"data-module","govuk-radios"),g(e,"class","govuk-fieldset"),g(t,"class","govuk-form-group")},m(o,s){E(o,t,s),_(t,e),_(e,a),_(a,i),_(e,d),_(e,l);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(l,null)},p(o,[s]){if(s&2&&Y(i,o[1]),s&13){u=de(o[3]);let c;for(c=0;c<u.length;c+=1){const F=ce(o,u,c);r[c]?r[c].p(F,s):(r[c]=_e(F),r[c].c(),r[c].m(l,null))}for(;c<r.length;c+=1)r[c].d(1);r.length=u.length}},i:U,o:U,d(o){o&&B(t),Ae(r,o)}}}function Ue(n,t,e){let{legend:a}=t,{id:i}=t,{choices:d}=t,{value:l}=t;const u=[[]];function r(s){he.call(this,n,s)}function o(){l=this.__value,e(0,l)}return n.$$set=s=>{"legend"in s&&e(1,a=s.legend),"id"in s&&e(2,i=s.id),"choices"in s&&e(3,d=s.choices),"value"in s&&e(0,l=s.value)},[l,a,i,d,r,o,u]}class We extends Z{constructor(t){super(),Q(this,t,Ue,He,X,{legend:1,id:2,choices:3,value:0})}}function ze(n){let t;return{c(){t=J("About")},m(e,a){E(e,t,a)},d(e){e&&B(t)}}}function ge(n){let t,e,a;function i(l){n[11](l)}let d={};return n[2]!==void 0&&(d.errorMessage=n[2]),t=new qe({props:d}),K.push(()=>te(t,"errorMessage",i)),{c(){D(t.$$.fragment)},m(l,u){N(t,l,u),a=!0},p(l,u){const r={};!e&&u&4&&(e=!0,r.errorMessage=l[2],ne(()=>e=!1)),t.$set(r)},i(l){a||(I(t.$$.fragment,l),a=!0)},o(l){C(t.$$.fragment,l),a=!1},d(l){O(t,l)}}}function Ke(n){let t,e,a,i,d;return{c(){t=p("input"),e=$(),a=p("datalist"),g(t,"class","govuk-input govuk-input--width-20"),g(t,"id","inputValue"),g(t,"data-testid","transport-authority"),g(t,"list","authorities-list"),g(a,"id","authorities-list")},m(l,u){E(l,t,u),z(t,n[0]),E(l,e,u),E(l,a,u),n[13](a),i||(d=W(t,"input",n[12]),i=!0)},p(l,u){u&1&&t.value!==l[0]&&z(t,l[0])},d(l){l&&(B(t),B(e),B(a)),n[13](null),i=!1,d()}}}function Ze(n){let t;return{c(){t=J("Start")},m(e,a){E(e,t,a)},d(e){e&&B(t)}}}function me(n){let t,e;return{c(){t=p("i"),e=J(n[5])},m(a,i){E(a,t,i),_(t,e)},p(a,i){i&32&&Y(e,a[5])},d(a){a&&B(t)}}}function Qe(n){let t,e,a,i,d,l,u,r,o,s,c,F,T,y,b,S,P,G,R,j,V,m,h,A,k,L;d=new Ee({props:{$$slots:{default:[ze]},$$scope:{ctx:n}}}),d.$on("click",n[10]);let v=n[2]&&ge(n);r=new Be({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[Ke]},$$scope:{ctx:n}}}),s=new Ve({props:{disabled:!n[6],$$slots:{default:[Ze]},$$scope:{ctx:n}}}),s.$on("click",n[9]);function pe(f){n[14](f)}let le={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]]};n[4]!==void 0&&(le.value=n[4]),y=new We({props:le}),K.push(()=>te(y,"value",pe)),y.$on("change",n[7]);let M=n[5]&&me(n);j=new Fe({props:{label:"Or upload an ATIP GeoJSON file",loadFile:n[8],id:"load-geojson"}});function ve(f){n[15](f)}let ae={};return n[1]!==void 0&&(ae.open=n[1]),A=new Ne({props:ae}),K.push(()=>te(A,"open",ve)),{c(){t=p("div"),e=p("div"),a=p("h1"),a.textContent="Welcome to ATIP v2",i=$(),D(d.$$.fragment),l=$(),v&&v.c(),u=$(),D(r.$$.fragment),o=$(),D(s.$$.fragment),c=$(),F=p("hr"),T=$(),D(y.$$.fragment),S=$(),M&&M.c(),P=$(),G=p("hr"),R=$(),D(j.$$.fragment),V=$(),m=p("div"),m.innerHTML='<div id="map" class="svelte-lyn11h"></div>',h=$(),D(A.$$.fragment),g(a,"class","govuk-heading-l"),g(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),g(m,"class","govuk-grid-column-one-half"),g(t,"class","govuk-grid-row")},m(f,w){E(f,t,w),_(t,e),_(e,a),_(e,i),N(d,e,null),_(e,l),v&&v.m(e,null),_(e,u),N(r,e,null),_(e,o),N(s,e,null),_(e,c),_(e,F),_(e,T),N(y,e,null),_(e,S),M&&M.m(e,null),_(e,P),_(e,G),_(e,R),N(j,e,null),_(t,V),_(t,m),E(f,h,w),N(A,f,w),L=!0},p(f,[w]){const se={};w&524288&&(se.$$scope={dirty:w,ctx:f}),d.$set(se),f[2]?v?(v.p(f,w),w&4&&I(v,1)):(v=ge(f),v.c(),I(v,1),v.m(e,u)):v&&(Ce(),C(v,1,1,()=>{v=null}),Ie());const oe={};w&524297&&(oe.$$scope={dirty:w,ctx:f}),r.$set(oe);const x={};w&64&&(x.disabled=!f[6]),w&524288&&(x.$$scope={dirty:w,ctx:f}),s.$set(x);const ie={};!b&&w&16&&(b=!0,ie.value=f[4],ne(()=>b=!1)),y.$set(ie),f[5]?M?M.p(f,w):(M=me(f),M.c(),M.m(e,P)):M&&(M.d(1),M=null);const re={};!k&&w&2&&(k=!0,re.open=f[1],ne(()=>k=!1)),A.$set(re)},i(f){L||(I(d.$$.fragment,f),I(v),I(r.$$.fragment,f),I(s.$$.fragment,f),I(y.$$.fragment,f),I(j.$$.fragment,f),I(A.$$.fragment,f),L=!0)},o(f){C(d.$$.fragment,f),C(v),C(r.$$.fragment,f),C(s.$$.fragment,f),C(y.$$.fragment,f),C(j.$$.fragment,f),C(A.$$.fragment,f),L=!1},d(f){f&&(B(t),B(h)),O(d),v&&v.d(),O(r),O(s),O(y),M&&M.d(),O(j),O(A,f)}}}let H="boundary",q="boundary-layer";function Xe(n){if(n.features.length>0){let t=n.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function Ye(n,t,e){let a,i=!1,l=new URLSearchParams(window.location.search).get("error"),u,r,o=new Set,s=null,c="TA";function F(){s==null||s.setFilter(q,["==",["get","level"],c])}let T=null;Te(async()=>{De();const m=await Oe();for(let k of m.features){let L=document.createElement("option");L.value=k.properties.name,r.appendChild(L),o.add(k.properties.name)}s=new Le.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let h=null;function A(){h!==null&&s.setFeatureState({source:H,id:h},{hover:!1})}s.on("load",function(){s.fitBounds(je(m),{padding:20,animate:!1}),s.addSource(H,{type:"geojson",data:m,generateId:!0}),s.addLayer({id:q,source:H,filter:["==",["get","level"],c],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),s.on("mousemove",q,k=>{k.features.length>0&&(A(),h=k.features[0].id,e(5,T=k.features[0].properties.name),s.setFeatureState({source:H,id:h},{hover:!0}))}),s.on("mouseleave",q,()=>{A(),h=null,e(5,T=null)}),s.on("click",q,function(k){let L=k.features[0].properties.name;window.location.href=`scheme.html?authority=${L}`})})});function y(m){try{let h=JSON.parse(m);if(!h.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!o.has(h.authority))throw new Error(`Unknown authority ${h.authority}`);let A=h.authority,k=Xe(h);k!="v1"&&(A+=`_${k}`),window.localStorage.setItem(A,JSON.stringify(h)),window.location.href=`scheme.html?authority=${h.authority}&schema=${k}`}catch(h){window.alert(`Couldn't load scheme from a file: ${h}`)}}function b(){window.location.href=`scheme.html?authority=${u}`}const S=()=>e(1,i=!i);function P(m){l=m,e(2,l)}function G(){u=this.value,e(0,u)}function R(m){K[m?"unshift":"push"](()=>{r=m,e(3,r)})}function j(m){c=m,e(4,c)}function V(m){i=m,e(1,i)}return n.$$.update=()=>{n.$$.dirty&1&&e(6,a=o.has(u))},[u,i,l,r,c,T,a,F,y,b,S,P,G,R,j,V]}class xe extends Z{constructor(t){super(),Q(this,t,Ye,Qe,X,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new xe({target:document.getElementById("app")});
