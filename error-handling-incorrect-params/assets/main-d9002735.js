import{S as Z,i as X,s as Y,c as be,a as K,e as b,b as se,d as F,l as H,u as ke,g as we,f as ye,h as $e,t as B,j as T,k as I,m as ie,n as pe,o as ue,p as q,q as y,r as h,v as _,w as x,x as re,y as Ae,z as Se,A as W,B as Ee,C as Be,F as Fe,D as Q,E as fe,G as Ie,H as C,I as D,J as Me,K as ce,L as O,M as Te,N as Le,O as Ne,P as je,Q as Ce}from"./maplibre_helpers-09c65b90.js";import{i as De}from"./all-3f19c173.js";import{a as Oe,A as Je}from"./About-37568bde.js";function Pe(n){let t,e,l,u;const c=n[2].default,s=be(c,n,n[1],null);let f=[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},n[0]],i={};for(let o=0;o<f.length;o+=1)i=K(i,f[o]);return{c(){t=b("button"),s&&s.c(),se(t,i)},m(o,a){F(o,t,a),s&&s.m(t,null),t.autofocus&&t.focus(),e=!0,l||(u=H(t,"click",n[3]),l=!0)},p(o,[a]){s&&s.p&&(!e||a&2)&&ke(s,c,o,o[1],e?ye(c,o[1],a,null):we(o[1]),null),se(t,i=$e(f,[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},a&1&&o[0]]))},i(o){e||(B(s,o),e=!0)},o(o){T(s,o),e=!1},d(o){o&&I(t),s&&s.d(o),l=!1,u()}}}function qe(n,t,e){let{$$slots:l={},$$scope:u}=t;function c(s){pe.call(this,n,s)}return n.$$set=s=>{e(0,t=K(K({},t),ie(s))),"$$scope"in s&&e(1,u=s.$$scope)},t=ie(t),[t,u,l,c]}class Ge extends Z{constructor(t){super(),X(this,t,qe,Pe,Y,{})}}function de(n,t,e){const l=n.slice();return l[7]=t[e][0],l[8]=t[e][1],l}function _e(n){let t,e,l,u,c=!1,s,f,i=n[8]+"",o,a,d,E,M,$;return E=Se(n[6][0]),{c(){t=b("div"),e=b("input"),s=y(),f=b("label"),o=q(i),d=y(),h(e,"class","govuk-radios__input"),h(e,"id",l=n[2]+n[7]),h(e,"type","radio"),e.__value=u=n[7],W(e,e.__value),h(f,"class","govuk-label govuk-radios__label"),h(f,"for",a=n[2]+n[7]),h(t,"class","govuk-radios__item"),E.p(e)},m(v,S){F(v,t,S),_(t,e),e.checked=e.__value===n[0],_(t,s),_(t,f),_(f,o),_(t,d),M||($=[H(e,"change",n[5]),H(e,"change",n[4])],M=!0)},p(v,S){S&12&&l!==(l=v[2]+v[7])&&h(e,"id",l),S&8&&u!==(u=v[7])&&(e.__value=u,W(e,e.__value),c=!0),(c||S&9)&&(e.checked=e.__value===v[0]),S&8&&i!==(i=v[8]+"")&&x(o,i),S&12&&a!==(a=v[2]+v[7])&&h(f,"for",a)},d(v){v&&I(t),E.r(),M=!1,Ee($)}}}function Re(n){let t,e,l,u,c,s,f=ue(n[3]),i=[];for(let o=0;o<f.length;o+=1)i[o]=_e(de(n,f,o));return{c(){t=b("div"),e=b("fieldset"),l=b("legend"),u=q(n[1]),c=y(),s=b("div");for(let o=0;o<i.length;o+=1)i[o].c();h(l,"class","govuk-fieldset__legend"),h(s,"class","govuk-radios"),h(s,"data-module","govuk-radios"),h(e,"class","govuk-fieldset"),h(t,"class","govuk-form-group")},m(o,a){F(o,t,a),_(t,e),_(e,l),_(l,u),_(e,c),_(e,s);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(s,null)},p(o,[a]){if(a&2&&x(u,o[1]),a&13){f=ue(o[3]);let d;for(d=0;d<f.length;d+=1){const E=de(o,f,d);i[d]?i[d].p(E,a):(i[d]=_e(E),i[d].c(),i[d].m(s,null))}for(;d<i.length;d+=1)i[d].d(1);i.length=f.length}},i:re,o:re,d(o){o&&I(t),Ae(i,o)}}}function Ue(n,t,e){let{legend:l}=t,{id:u}=t,{choices:c}=t,{value:s}=t;const f=[[]];function i(a){pe.call(this,n,a)}function o(){s=this.__value,e(0,s)}return n.$$set=a=>{"legend"in a&&e(1,l=a.legend),"id"in a&&e(2,u=a.id),"choices"in a&&e(3,c=a.choices),"value"in a&&e(0,s=a.value)},[s,l,u,c,i,o,f]}class Ve extends Z{constructor(t){super(),X(this,t,Ue,Re,Y,{legend:1,id:2,choices:3,value:0})}}async function He(){const t=await(await fetch(Oe)).text();return JSON.parse(t)}function We(n){let t;return{c(){t=q("About")},m(e,l){F(e,t,l)},d(e){e&&I(t)}}}function he(n){let t,e;return t=new Le({props:{errorMessage:n[2]}}),{c(){C(t.$$.fragment)},m(l,u){D(t,l,u),e=!0},p(l,u){const c={};u&4&&(c.errorMessage=l[2]),t.$set(c)},i(l){e||(B(t.$$.fragment,l),e=!0)},o(l){T(t.$$.fragment,l),e=!1},d(l){O(t,l)}}}function ze(n){let t,e,l,u,c;return{c(){t=b("input"),e=y(),l=b("datalist"),h(t,"class","govuk-input govuk-input--width-20"),h(t,"id","inputValue"),h(t,"data-testid","transport-authority"),h(t,"list","authorities-list"),h(l,"id","authorities-list")},m(s,f){F(s,t,f),W(t,n[0]),F(s,e,f),F(s,l,f),n[12](l),u||(c=H(t,"input",n[11]),u=!0)},p(s,f){f&1&&t.value!==s[0]&&W(t,s[0])},d(s){s&&(I(t),I(e),I(l)),n[12](null),u=!1,c()}}}function Ke(n){let t;return{c(){t=q("Start")},m(e,l){F(e,t,l)},d(e){e&&I(t)}}}function me(n){let t,e;return{c(){t=b("i"),e=q(n[5])},m(l,u){F(l,t,u),_(t,e)},p(l,u){u&32&&x(e,l[5])},d(l){l&&I(t)}}}function Qe(n){let t,e,l,u,c,s,f,i,o,a,d,E,M,$,v,S,J,G,R,N,w,p,L,m,j,U;c=new Be({props:{$$slots:{default:[We]},$$scope:{ctx:n}}}),c.$on("click",n[10]);let g=n[2]&&he(n);i=new Fe({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[ze]},$$scope:{ctx:n}}}),a=new Ge({props:{disabled:!n[6],$$slots:{default:[Ke]},$$scope:{ctx:n}}}),a.$on("click",n[9]);function ge(r){n[13](r)}let ee={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]]};n[4]!==void 0&&(ee.value=n[4]),$=new Ve({props:ee}),Q.push(()=>fe($,"value",ge)),$.$on("change",n[7]);let A=n[5]&&me(n);N=new Ie({props:{label:"Or upload an ATIP GeoJSON file",loadFile:n[8],id:"load-geojson"}});function ve(r){n[14](r)}let te={};return n[1]!==void 0&&(te.open=n[1]),m=new Je({props:te}),Q.push(()=>fe(m,"open",ve)),{c(){t=b("div"),e=b("div"),l=b("h1"),l.textContent="Welcome to ATIP v2",u=y(),C(c.$$.fragment),s=y(),g&&g.c(),f=y(),C(i.$$.fragment),o=y(),C(a.$$.fragment),d=y(),E=b("hr"),M=y(),C($.$$.fragment),S=y(),A&&A.c(),J=y(),G=b("hr"),R=y(),C(N.$$.fragment),w=y(),p=b("div"),p.innerHTML='<div id="map" class="svelte-lyn11h"></div>',L=y(),C(m.$$.fragment),h(l,"class","govuk-heading-l"),h(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),h(p,"class","govuk-grid-column-one-half"),h(t,"class","govuk-grid-row")},m(r,k){F(r,t,k),_(t,e),_(e,l),_(e,u),D(c,e,null),_(e,s),g&&g.m(e,null),_(e,f),D(i,e,null),_(e,o),D(a,e,null),_(e,d),_(e,E),_(e,M),D($,e,null),_(e,S),A&&A.m(e,null),_(e,J),_(e,G),_(e,R),D(N,e,null),_(t,w),_(t,p),F(r,L,k),D(m,r,k),U=!0},p(r,[k]){const ne={};k&262144&&(ne.$$scope={dirty:k,ctx:r}),c.$set(ne),r[2]?g?(g.p(r,k),k&4&&B(g,1)):(g=he(r),g.c(),B(g,1),g.m(e,f)):g&&(Ne(),T(g,1,1,()=>{g=null}),Me());const le={};k&262153&&(le.$$scope={dirty:k,ctx:r}),i.$set(le);const z={};k&64&&(z.disabled=!r[6]),k&262144&&(z.$$scope={dirty:k,ctx:r}),a.$set(z);const ae={};!v&&k&16&&(v=!0,ae.value=r[4],ce(()=>v=!1)),$.$set(ae),r[5]?A?A.p(r,k):(A=me(r),A.c(),A.m(e,J)):A&&(A.d(1),A=null);const oe={};!j&&k&2&&(j=!0,oe.open=r[1],ce(()=>j=!1)),m.$set(oe)},i(r){U||(B(c.$$.fragment,r),B(g),B(i.$$.fragment,r),B(a.$$.fragment,r),B($.$$.fragment,r),B(N.$$.fragment,r),B(m.$$.fragment,r),U=!0)},o(r){T(c.$$.fragment,r),T(g),T(i.$$.fragment,r),T(a.$$.fragment,r),T($.$$.fragment,r),T(N.$$.fragment,r),T(m.$$.fragment,r),U=!1},d(r){r&&(I(t),I(L)),O(c),g&&g.d(),O(i),O(a),O($),A&&A.d(),O(N),O(m,r)}}}let V="boundary",P="boundary-layer";function Ze(n){if(n.features.length>0){let t=n.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function Xe(n,t,e){let l,u=!1,s=new URLSearchParams(window.location.search).get("error"),f,i,o=new Set,a=null,d="TA";function E(){a==null||a.setFilter(P,["==",["get","level"],d])}let M=null;Te(async()=>{De();const w=await He();for(let m of w.features){let j=document.createElement("option");j.value=m.properties.name,i.appendChild(j),o.add(m.properties.name)}a=new je.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let p=null;function L(){p!==null&&a.setFeatureState({source:V,id:p},{hover:!1})}a.on("load",function(){a.fitBounds(Ce(w),{padding:20,animate:!1}),a.addSource(V,{type:"geojson",data:w,generateId:!0}),a.addLayer({id:P,source:V,filter:["==",["get","level"],d],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),a.on("mousemove",P,m=>{m.features.length>0&&(L(),p=m.features[0].id,e(5,M=m.features[0].properties.name),a.setFeatureState({source:V,id:p},{hover:!0}))}),a.on("mouseleave",P,()=>{L(),p=null,e(5,M=null)}),a.on("click",P,function(m){let j=m.features[0].properties.name;window.location.href=`scheme.html?authority=${j}`})})});function $(w){try{let p=JSON.parse(w);if(!p.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!o.has(p.authority))throw new Error(`Unknown authority ${p.authority}`);let L=p.authority,m=Ze(p);m!="v1"&&(L+=`_${m}`),window.localStorage.setItem(L,JSON.stringify(p)),window.location.href=`scheme.html?authority=${p.authority}&schema=${m}`}catch(p){e(2,s=`Couldn't load scheme from a file: ${p}`)}}function v(){window.location.href=`scheme.html?authority=${f}`}const S=()=>e(1,u=!u);function J(){f=this.value,e(0,f)}function G(w){Q[w?"unshift":"push"](()=>{i=w,e(3,i)})}function R(w){d=w,e(4,d)}function N(w){u=w,e(1,u)}return n.$$.update=()=>{n.$$.dirty&1&&e(6,l=o.has(f))},[f,u,s,i,d,M,l,E,$,v,S,J,G,R,N]}class Ye extends Z{constructor(t){super(),X(this,t,Xe,Qe,Y,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Ye({target:document.getElementById("app")});
