import{S as K,i as Q,s as X,F as Y,A as x,b as z,a as tt,e as d,c as y,t as et,d as D,f as b,g as O,h as o,j as R,m as W,l as L,k as at,n as G,o as V,p as J,q as Z,r as nt,u as ot,v as lt,w as st,x as it}from"./authorities-5ed30848.js";function rt(a){let e,r,I,u,w,A,C,_,c,F,k,E,h,s,p,T,$,n,l,f,v,i,m,j,S,N,q,P,M;v=new Y({props:{label:"Upload ATIP GeoJSON file",onChange:a[4]}});function H(t){a[9](t)}let U={};return a[1]!==void 0&&(U.open=a[1]),S=new x({props:U}),z.push(()=>tt(S,"open",H,a[1])),{c(){e=d("div"),r=d("h1"),r.textContent="Welcome to ATIP v2",I=y(),u=d("button"),u.textContent="About",w=y(),A=d("p"),A.textContent="Select Transport Authority or Local Authority District:",C=y(),_=d("div"),c=d("input"),F=y(),k=d("datalist"),E=y(),h=d("button"),s=et("Start"),T=y(),$=d("p"),$.textContent="Or pick a Transport Authority on the map",n=y(),l=d("p"),l.textContent="Or upload an ATIP file:",f=y(),D(v.$$.fragment),i=y(),m=d("div"),j=y(),D(S.$$.fragment),b(u,"type","button"),b(u,"class","svelte-ynp6gq"),b(c,"data-testid","transport-authority"),b(c,"list","authorities-list"),b(k,"id","authorities-list"),b(h,"type","button"),h.disabled=p=!a[3],b(h,"class","svelte-ynp6gq"),b(e,"class","left svelte-ynp6gq"),b(m,"id","map"),b(m,"class","svelte-ynp6gq")},m(t,g){O(t,e,g),o(e,r),o(e,I),o(e,u),o(e,w),o(e,A),o(e,C),o(e,_),o(_,c),R(c,a[0]),o(_,F),o(_,k),a[8](k),o(_,E),o(_,h),o(h,s),o(e,T),o(e,$),o(e,n),o(e,l),o(e,f),W(v,e,null),O(t,i,g),O(t,m,g),O(t,j,g),W(S,t,g),q=!0,P||(M=[L(u,"click",a[6]),L(c,"input",a[7]),L(h,"click",a[5])],P=!0)},p(t,[g]){g&1&&c.value!==t[0]&&R(c,t[0]),(!q||g&8&&p!==(p=!t[3]))&&(h.disabled=p);const B={};!N&&g&2&&(N=!0,B.open=t[1],at(()=>N=!1)),S.$set(B)},i(t){q||(G(v.$$.fragment,t),G(S.$$.fragment,t),q=!0)},o(t){V(v.$$.fragment,t),V(S.$$.fragment,t),q=!1},d(t){t&&J(e),a[8](null),Z(v),t&&J(i),t&&J(m),t&&J(j),Z(S,t),P=!1,nt(M)}}}function ut(a){if(a.features.length>0){let e=a.features[0].properties;for(let r of["planning","v2","criticals"])if(e&&r in e)return r}return"v1"}function pt(a,e,r){let I,u=!1,w,A,C=new Set;ot(async()=>{let s="boundary",p="boundary-layer";const $=await(await fetch(lt)).text(),n=JSON.parse($);for(let i of n.features){let m=document.createElement("option");m.value=i.properties.name,A.appendChild(m),C.add(i.properties.name)}n.features=n.features.filter(i=>i.properties.level=="TA");let l=new st.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"}),f=null;function v(){f!==null&&l.setFeatureState({source:s,id:f},{hover:!1})}l.on("load",function(){l.fitBounds(it(n),{padding:20,animate:!1}),l.addSource(s,{type:"geojson",data:n,generateId:!0}),l.addLayer({id:p,source:s,type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),l.on("mousemove",p,i=>{i.features.length>0&&(v(),f=i.features[0].id,l.setFeatureState({source:s,id:f},{hover:!0}))}),l.on("mouseleave",p,()=>{v(),f=null}),l.on("click",p,function(i){let m=i.features[0].properties.name;window.location.href=`scheme.html?authority=${m}`})})});function _(s){const p=new FileReader;p.onload=$=>{try{let n=JSON.parse($.target.result);if(!n.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!C.has(n.authority))throw new Error(`Unknown authority ${n.authority}`);let l=n.authority,f=ut(n);f!="v1"&&(l+=`_${f}`),window.localStorage.setItem(l,JSON.stringify(n)),window.location.href=`scheme.html?authority=${n.authority}&schema=${f}`}catch(n){window.alert(`Couldn't load scheme from a file: ${n}`)}};let T=s.target.files;p.readAsText(T[0])}function c(){window.location.href=`scheme.html?authority=${w}`}const F=()=>r(1,u=!u);function k(){w=this.value,r(0,w)}function E(s){z[s?"unshift":"push"](()=>{A=s,r(2,A)})}function h(s){u=s,r(1,u)}return a.$$.update=()=>{a.$$.dirty&1&&r(3,I=C.has(w))},[w,u,A,I,_,c,F,k,E,h]}class ft extends K{constructor(e){super(),Q(this,e,pt,rt,X,{})}}new ft({target:document.getElementById("app")});
