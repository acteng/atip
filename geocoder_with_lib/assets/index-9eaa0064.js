var Qg=Object.defineProperty;var e_=(a,u,p)=>u in a?Qg(a,u,{enumerable:!0,configurable:!0,writable:!0,value:p}):a[u]=p;var Sn=(a,u,p)=>(e_(a,typeof u!="symbol"?u+"":u,p),p);(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))_(w);new MutationObserver(w=>{for(const T of w)if(T.type==="childList")for(const M of T.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&_(M)}).observe(document,{childList:!0,subtree:!0});function p(w){const T={};return w.integrity&&(T.integrity=w.integrity),w.referrerPolicy&&(T.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?T.credentials="include":w.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function _(w){if(w.ep)return;w.ep=!0;const T=p(w);fetch(w.href,T)}})();function Wi(){}const t_=a=>a;function qc(a,u){for(const p in u)a[p]=u[p];return a}function nf(a){return a()}function Ep(){return Object.create(null)}function fs(a){a.forEach(nf)}function Yc(a){return typeof a=="function"}function Rr(a,u){return a!=a?u==u:a!==u||a&&typeof a=="object"||typeof a=="function"}let Oc;function Hx(a,u){return Oc||(Oc=document.createElement("a")),Oc.href=u,a===Oc.href}function i_(a){return Object.keys(a).length===0}function sf(a,...u){if(a==null){for(const _ of u)_(void 0);return Wi}const p=a.subscribe(...u);return p.unsubscribe?()=>p.unsubscribe():p}function of(a){let u;return sf(a,p=>u=p)(),u}function Ea(a,u,p){a.$$.on_destroy.push(sf(u,p))}function Ta(a,u,p,_){if(a){const w=af(a,u,p,_);return a[0](w)}}function af(a,u,p,_){return a[1]&&_?qc(p.ctx.slice(),a[1](_(u))):p.ctx}function Sa(a,u,p,_){if(a[2]&&_){const w=a[2](_(p));if(u.dirty===void 0)return w;if(typeof w=="object"){const T=[],M=Math.max(u.dirty.length,w.length);for(let o=0;o<M;o+=1)T[o]=u.dirty[o]|w[o];return T}return u.dirty|w}return u.dirty}function Ca(a,u,p,_,w,T){if(w){const M=af(u,p,_,T);a.p(M,w)}}function Ia(a){if(a.ctx.length>32){const u=[],p=a.ctx.length/32;for(let _=0;_<p;_++)u[_]=-1;return u}return-1}function Tp(a){const u={};for(const p in a)p[0]!=="$"&&(u[p]=a[p]);return u}function Wx(a){const u={};for(const p in a)u[p]=!0;return u}function Sp(a){return a??""}function Cp(a,u,p){return a.set(p),u}function r_(a){return a&&Yc(a.destroy)?a.destroy:Wi}const lf=typeof window<"u";let n_=lf?()=>window.performance.now():()=>Date.now(),Mh=lf?a=>requestAnimationFrame(a):Wi;const xa=new Set;function cf(a){xa.forEach(u=>{u.c(a)||(xa.delete(u),u.f())}),xa.size!==0&&Mh(cf)}function s_(a){let u;return xa.size===0&&Mh(cf),{promise:new Promise(p=>{xa.add(u={c:a,f:p})}),abort(){xa.delete(u)}}}function mi(a,u){a.appendChild(u)}function uf(a){if(!a)return document;const u=a.getRootNode?a.getRootNode():a.ownerDocument;return u&&u.host?u:a.ownerDocument}function o_(a){const u=Ci("style");return u.textContent="/* empty */",a_(uf(a),u),u.sheet}function a_(a,u){return mi(a.head||a,u),u.sheet}function Ii(a,u,p){a.insertBefore(u,p||null)}function ni(a){a.parentNode&&a.parentNode.removeChild(a)}function l_(a,u){for(let p=0;p<a.length;p+=1)a[p]&&a[p].d(u)}function Ci(a){return document.createElement(a)}function c_(a){return document.createElementNS("http://www.w3.org/2000/svg",a)}function Rs(a){return document.createTextNode(a)}function Yr(){return Rs(" ")}function Jc(){return Rs("")}function Pl(a,u,p,_){return a.addEventListener(u,p,_),()=>a.removeEventListener(u,p,_)}function u_(a){return function(u){return u.stopPropagation(),a.call(this,u)}}function Ft(a,u,p){p==null?a.removeAttribute(u):a.getAttribute(u)!==p&&a.setAttribute(u,p)}const h_=["width","height"];function Ip(a,u){const p=Object.getOwnPropertyDescriptors(a.__proto__);for(const _ in u)u[_]==null?a.removeAttribute(_):_==="style"?a.style.cssText=u[_]:_==="__value"?a.value=a[_]=u[_]:p[_]&&p[_].set&&h_.indexOf(_)===-1?a[_]=u[_]:Ft(a,_,u[_])}function d_(a){let u;return{p(...p){u=p,u.forEach(_=>a.push(_))},r(){u.forEach(p=>a.splice(a.indexOf(p),1))}}}function Xx(a){return a===""?null:+a}function p_(a){return Array.from(a.childNodes)}function zl(a,u){u=""+u,a.data!==u&&(a.data=u)}function Ap(a,u){a.value=u??""}function kp(a,u,p,_){p==null?a.style.removeProperty(u):a.style.setProperty(u,p,_?"important":"")}function Kx(a,u,p){for(let _=0;_<a.options.length;_+=1){const w=a.options[_];if(w.__value===u){w.selected=!0;return}}(!p||u!==void 0)&&(a.selectedIndex=-1)}function Yx(a){const u=a.querySelector(":checked");return u&&u.__value}function Vn(a,u,p){a.classList.toggle(u,!!p)}function hf(a,u,{bubbles:p=!1,cancelable:_=!1}={}){return new CustomEvent(a,{detail:u,bubbles:p,cancelable:_})}class Jx{constructor(u=!1){Sn(this,"is_svg",!1);Sn(this,"e");Sn(this,"n");Sn(this,"t");Sn(this,"a");this.is_svg=u,this.e=this.n=null}c(u){this.h(u)}m(u,p,_=null){this.e||(this.is_svg?this.e=c_(p.nodeName):this.e=Ci(p.nodeType===11?"TEMPLATE":p.nodeName),this.t=p.tagName!=="TEMPLATE"?p:p.content,this.c(u)),this.i(_)}h(u){this.e.innerHTML=u,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(u){for(let p=0;p<this.n.length;p+=1)Ii(this.t,this.n[p],u)}p(u){this.d(),this.h(u),this.i(this.a)}d(){this.n.forEach(ni)}}const Zc=new Map;let $c=0;function f_(a){let u=5381,p=a.length;for(;p--;)u=(u<<5)-u^a.charCodeAt(p);return u>>>0}function m_(a,u){const p={stylesheet:o_(u),rules:{}};return Zc.set(a,p),p}function Mp(a,u,p,_,w,T,M,o=0){const z=16.666/_;let A=`{
`;for(let De=0;De<=1;De+=z){const Se=u+(p-u)*T(De);A+=De*100+`%{${M(Se,1-Se)}}
`}const G=A+`100% {${M(p,1-p)}}
}`,j=`__svelte_${f_(G)}_${o}`,fe=uf(a),{stylesheet:ge,rules:he}=Zc.get(fe)||m_(fe,a);he[j]||(he[j]=!0,ge.insertRule(`@keyframes ${j} ${G}`,ge.cssRules.length));const Ce=a.style.animation||"";return a.style.animation=`${Ce?`${Ce}, `:""}${j} ${_}ms linear ${w}ms 1 both`,$c+=1,j}function g_(a,u){const p=(a.style.animation||"").split(", "),_=p.filter(u?T=>T.indexOf(u)<0:T=>T.indexOf("__svelte")===-1),w=p.length-_.length;w&&(a.style.animation=_.join(", "),$c-=w,$c||__())}function __(){Mh(()=>{$c||(Zc.forEach(a=>{const{ownerNode:u}=a.stylesheet;u&&ni(u)}),Zc.clear())})}let Ll;function kl(a){Ll=a}function Dl(){if(!Ll)throw new Error("Function called outside component initialization");return Ll}function y_(a){Dl().$$.on_mount.push(a)}function Qc(a){Dl().$$.on_destroy.push(a)}function v_(){const a=Dl();return(u,p,{cancelable:_=!1}={})=>{const w=a.$$.callbacks[u];if(w){const T=hf(u,p,{cancelable:_});return w.slice().forEach(M=>{M.call(a,T)}),!T.defaultPrevented}return!0}}function Ph(a,u){return Dl().$$.context.set(a,u),u}function x_(a){return Dl().$$.context.get(a)}function df(a,u){const p=a.$$.callbacks[u.type];p&&p.slice().forEach(_=>_.call(this,u))}const ga=[],Gc=[];let ba=[];const Eh=[],pf=Promise.resolve();let Th=!1;function ff(){Th||(Th=!0,pf.then(mf))}function Qx(){return ff(),pf}function Hc(a){ba.push(a)}function Pp(a){Eh.push(a)}const _h=new Set;let pa=0;function mf(){if(pa!==0)return;const a=Ll;do{try{for(;pa<ga.length;){const u=ga[pa];pa++,kl(u),b_(u.$$)}}catch(u){throw ga.length=0,pa=0,u}for(kl(null),ga.length=0,pa=0;Gc.length;)Gc.pop()();for(let u=0;u<ba.length;u+=1){const p=ba[u];_h.has(p)||(_h.add(p),p())}ba.length=0}while(ga.length);for(;Eh.length;)Eh.pop()();Th=!1,_h.clear(),kl(a)}function b_(a){if(a.fragment!==null){a.update(),fs(a.before_update);const u=a.dirty;a.dirty=[-1],a.fragment&&a.fragment.p(a.ctx,u),a.after_update.forEach(Hc)}}function w_(a){const u=[],p=[];ba.forEach(_=>a.indexOf(_)===-1?u.push(_):p.push(_)),p.forEach(_=>_()),ba=u}let Cl;function E_(){return Cl||(Cl=Promise.resolve(),Cl.then(()=>{Cl=null})),Cl}function yh(a,u,p){a.dispatchEvent(hf(`${u?"intro":"outro"}${p}`))}const Nc=new Set;let hs;function Bl(){hs={r:0,c:[],p:hs}}function Rl(){hs.r||fs(hs.c),hs=hs.p}function At(a,u){a&&a.i&&(Nc.delete(a),a.i(u))}function jt(a,u,p,_){if(a&&a.o){if(Nc.has(a))return;Nc.add(a),hs.c.push(()=>{Nc.delete(a),_&&(p&&a.d(1),_())}),a.o(u)}else _&&_()}const T_={duration:0};function e0(a,u,p,_){let T=u(a,p,{direction:"both"}),M=_?0:1,o=null,z=null,A=null,G;function j(){A&&g_(a,A)}function fe(he,Ce){const De=he.b-M;return Ce*=Math.abs(De),{a:M,b:he.b,d:De,duration:Ce,start:he.start,end:he.start+Ce,group:he.group}}function ge(he){const{delay:Ce=0,duration:De=300,easing:Se=t_,tick:Ne=Wi,css:Ue}=T||T_,lt={start:n_()+Ce,b:he};he||(lt.group=hs,hs.r+=1),"inert"in a&&(he?G!==void 0&&(a.inert=G):(G=a.inert,a.inert=!0)),o||z?z=lt:(Ue&&(j(),A=Mp(a,M,he,De,Ce,Se,Ue)),he&&Ne(0,1),o=fe(lt,De),Hc(()=>yh(a,he,"start")),s_(pt=>{if(z&&pt>z.start&&(o=fe(z,De),z=null,yh(a,o.b,"start"),Ue&&(j(),A=Mp(a,M,o.b,o.duration,0,Se,T.css))),o){if(pt>=o.end)Ne(M=o.b,1-M),yh(a,o.b,"end"),z||(o.b?j():--o.group.r||fs(o.group.c)),o=null;else if(pt>=o.start){const ht=pt-o.start;M=o.a+o.d*Se(ht/o.duration),Ne(M,1-M)}}return!!(o||z)}))}return{run(he){Yc(T)?E_().then(()=>{T=T({direction:he?"in":"out"}),ge(he)}):ge(he)},end(){j(),o=z=null}}}function Lp(a){return(a==null?void 0:a.length)!==void 0?a:Array.from(a)}function t0(a,u){jt(a,1,1,()=>{u.delete(a.key)})}function i0(a,u,p,_,w,T,M,o,z,A,G,j){let fe=a.length,ge=T.length,he=fe;const Ce={};for(;he--;)Ce[a[he].key]=he;const De=[],Se=new Map,Ne=new Map,Ue=[];for(he=ge;he--;){const st=j(w,T,he),xt=p(st);let _t=M.get(xt);_t?_&&Ue.push(()=>_t.p(st,u)):(_t=A(xt,st),_t.c()),Se.set(xt,De[he]=_t),xt in Ce&&Ne.set(xt,Math.abs(he-Ce[xt]))}const lt=new Set,pt=new Set;function ht(st){At(st,1),st.m(o,G),M.set(st.key,st),G=st.first,ge--}for(;fe&&ge;){const st=De[ge-1],xt=a[fe-1],_t=st.key,tt=xt.key;st===xt?(G=st.first,fe--,ge--):Se.has(tt)?!M.has(_t)||lt.has(_t)?ht(st):pt.has(tt)?fe--:Ne.get(_t)>Ne.get(tt)?(pt.add(_t),ht(st)):(lt.add(tt),fe--):(z(xt,M),fe--)}for(;fe--;){const st=a[fe];Se.has(st.key)||z(st,M)}for(;ge;)ht(De[ge-1]);return fs(Ue),De}function S_(a,u){const p={},_={},w={$$scope:1};let T=a.length;for(;T--;){const M=a[T],o=u[T];if(o){for(const z in M)z in o||(_[z]=1);for(const z in o)w[z]||(p[z]=o[z],w[z]=1);a[T]=o}else for(const z in M)w[z]=1}for(const M in _)M in p||(p[M]=void 0);return p}function r0(a){return typeof a=="object"&&a!==null?a:{}}function zp(a,u,p){const _=a.$$.props[u];_!==void 0&&(a.$$.bound[_]=p,p(a.$$.ctx[_]))}function ds(a){a&&a.c()}function Nn(a,u,p){const{fragment:_,after_update:w}=a.$$;_&&_.m(u,p),Hc(()=>{const T=a.$$.on_mount.map(nf).filter(Yc);a.$$.on_destroy?a.$$.on_destroy.push(...T):fs(T),a.$$.on_mount=[]}),w.forEach(Hc)}function jn(a,u){const p=a.$$;p.fragment!==null&&(w_(p.after_update),fs(p.on_destroy),p.fragment&&p.fragment.d(u),p.on_destroy=p.fragment=null,p.ctx=[])}function C_(a,u){a.$$.dirty[0]===-1&&(ga.push(a),ff(),a.$$.dirty.fill(0)),a.$$.dirty[u/31|0]|=1<<u%31}function Jr(a,u,p,_,w,T,M,o=[-1]){const z=Ll;kl(a);const A=a.$$={fragment:null,ctx:[],props:T,update:Wi,not_equal:w,bound:Ep(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u.context||(z?z.$$.context:[])),callbacks:Ep(),dirty:o,skip_bound:!1,root:u.target||z.$$.root};M&&M(A.root);let G=!1;if(A.ctx=p?p(a,u.props||{},(j,fe,...ge)=>{const he=ge.length?ge[0]:fe;return A.ctx&&w(A.ctx[j],A.ctx[j]=he)&&(!A.skip_bound&&A.bound[j]&&A.bound[j](he),G&&C_(a,j)),fe}):[],A.update(),G=!0,fs(A.before_update),A.fragment=_?_(A.ctx):!1,u.target){if(u.hydrate){const j=p_(u.target);A.fragment&&A.fragment.l(j),j.forEach(ni)}else A.fragment&&A.fragment.c();u.intro&&At(a.$$.fragment),Nn(a,u.target,u.anchor),mf()}kl(z)}class Qr{constructor(){Sn(this,"$$");Sn(this,"$$set")}$destroy(){jn(this,1),this.$destroy=Wi}$on(u,p){if(!Yc(p))return Wi;const _=this.$$.callbacks[u]||(this.$$.callbacks[u]=[]);return _.push(p),()=>{const w=_.indexOf(p);w!==-1&&_.splice(w,1)}}$set(u){this.$$set&&!i_(u)&&(this.$$.skip_bound=!0,this.$$set(u),this.$$.skip_bound=!1)}}const I_="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(I_);function fi(a,u){if(window.NodeList.prototype.forEach)return a.forEach(u);for(var p=0;p<a.length;p++)u.call(window,a[p],p,a)}function A_(){var a=new Date().getTime();return typeof window.performance<"u"&&typeof window.performance.now=="function"&&(a+=window.performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(u){var p=(a+Math.random()*16)%16|0;return a=Math.floor(a/16),(u==="x"?p:p&3|8).toString(16)})}function Aa(){for(var a=function(T){var M={},o=function(z,A){for(var G in z)if(Object.prototype.hasOwnProperty.call(z,G)){var j=z[G],fe=A?A+"."+G:G;typeof j=="object"?o(j,fe):M[fe]=j}};return o(T),M},u={},p=0;p<arguments.length;p++){var _=a(arguments[p]);for(var w in _)Object.prototype.hasOwnProperty.call(_,w)&&(u[w]=_[w])}return u}function Lh(a,u){if(!a||typeof a!="object")throw new Error('Provide a `configObject` of type "object".');if(!u||typeof u!="string")throw new Error('Provide a `namespace` of type "string" to filter the `configObject` by.');var p={};for(var _ in a){var w=_.split(".");if(Object.prototype.hasOwnProperty.call(a,_)&&w[0]===u){w.length>1&&w.shift();var T=w.join(".");p[T]=a[_]}}return p}(function(a){var u="defineProperty"in Object&&function(){try{var p={};return Object.defineProperty(p,"test",{value:42}),!0}catch{return!1}}();u||function(p){var _=Object.prototype.hasOwnProperty("__defineGetter__"),w="Getters & setters cannot be defined on this javascript engine",T="A property cannot both have accessors and be writable or have a value";Object.defineProperty=function(o,z,A){if(p&&(o===window||o===document||o===Element.prototype||o instanceof Element))return p(o,z,A);if(o===null||!(o instanceof Object||typeof o=="object"))throw new TypeError("Object.defineProperty called on non-object");if(!(A instanceof Object))throw new TypeError("Property description must be an object");var G=String(z),j="value"in A||"writable"in A,fe="get"in A&&typeof A.get,ge="set"in A&&typeof A.set;if(fe){if(fe!=="function")throw new TypeError("Getter must be a function");if(!_)throw new TypeError(w);if(j)throw new TypeError(T);Object.__defineGetter__.call(o,G,A.get)}else o[G]=A.value;if(ge){if(ge!=="function")throw new TypeError("Setter must be a function");if(!_)throw new TypeError(w);if(j)throw new TypeError(T);Object.__defineSetter__.call(o,G,A.set)}return"value"in A&&(o[G]=A.value),o}}(Object.defineProperty)}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});(function(a){var u="Document"in this;u||typeof WorkerGlobalScope>"u"&&typeof importScripts!="function"&&(this.HTMLDocument?this.Document=this.HTMLDocument:(this.Document=this.HTMLDocument=document.constructor=new Function("return function Document() {}")(),this.Document.prototype=document))}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});(function(a){var u="Element"in this&&"HTMLElement"in this;u||function(){if(window.Element&&!window.HTMLElement){window.HTMLElement=window.Element;return}window.Element=window.HTMLElement=new Function("return function Element() {}")();var p=document.appendChild(document.createElement("body")),_=p.appendChild(document.createElement("iframe")),w=_.contentWindow.document,T=Element.prototype=w.appendChild(w.createElement("*")),M={},o=function(ge,he){var Ce=ge.childNodes||[],De=-1,Se,Ne,Ue;if(ge.nodeType===1&&ge.constructor!==Element){ge.constructor=Element;for(Se in M)Ne=M[Se],ge[Se]=Ne}for(;Ue=he&&Ce[++De];)o(Ue,he);return ge},z=document.getElementsByTagName("*"),A=document.createElement,G,j=100;T.attachEvent("onpropertychange",function(ge){for(var he=ge.propertyName,Ce=!M.hasOwnProperty(he),De=T[he],Se=M[he],Ne=-1,Ue;Ue=z[++Ne];)Ue.nodeType===1&&(Ce||Ue[he]===Se)&&(Ue[he]=De);M[he]=De}),T.constructor=Element,T.hasAttribute||(T.hasAttribute=function(he){return this.getAttribute(he)!==null});function fe(){return j--||clearTimeout(G),document.body&&!document.body.prototype&&/(complete|interactive)/.test(document.readyState)?(o(document,!0),G&&document.body.prototype&&clearTimeout(G),!!document.body.prototype):!1}fe()||(document.onreadystatechange=fe,G=setInterval(fe,25)),document.createElement=function(he){var Ce=A(String(he).toLowerCase());return o(Ce)},document.removeChild(p)}()}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});(function(a){var u=function(){if(!document.documentElement.dataset)return!1;var p=document.createElement("div");return p.setAttribute("data-a-b","c"),p.dataset&&p.dataset.aB=="c"}();u||Object.defineProperty(Element.prototype,"dataset",{get:function(){for(var p=this,_=this.attributes,w={},T=0;T<_.length;T++){var M=_[T];if(M&&M.name&&/^data-\w[.\w-]*$/.test(M.name)){var o=M.name,z=M.value,A=o.substr(5).replace(/-./g,function(G){return G.charAt(1).toUpperCase()});"__defineGetter__"in Object.prototype&&"__defineSetter__"in Object.prototype?Object.defineProperty(w,A,{enumerable:!0,get:function(){return this.value}.bind({value:z||""}),set:function(j,fe){typeof fe<"u"?this.setAttribute(j,fe):this.removeAttribute(j)}.bind(p,o)}):w[A]=z}}return w}})}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});(function(a){var u="trim"in String.prototype;u||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")})}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});function k_(a){if(typeof a!="string")return a;var u=a.trim();return u==="true"?!0:u==="false"?!1:u.length>0&&isFinite(Number(u))?Number(u):a}function ka(a){var u={};for(var p in a)u[p]=k_(a[p]);return u}function dr(a,u){this.translations=a||{},this.locale=u&&u.locale||document.documentElement.lang||"en"}dr.prototype.t=function(a,u){if(!a)throw new Error("i18n: lookup key missing");u&&typeof u.count=="number"&&(a=a+"."+this.getPluralSuffix(a,u.count));var p=this.translations[a];if(typeof p=="string")if(p.match(/%{(.\S+)}/)){if(!u)throw new Error("i18n: cannot replace placeholders in string if no option data provided");return this.replacePlaceholders(p,u)}else return p;else return a};dr.prototype.replacePlaceholders=function(a,u){var p;return this.hasIntlNumberFormatSupport()&&(p=new Intl.NumberFormat(this.locale)),a.replace(/%{(.\S+)}/g,function(_,w){if(Object.prototype.hasOwnProperty.call(u,w)){var T=u[w];return T===!1||typeof T!="number"&&typeof T!="string"?"":typeof T=="number"?p?p.format(T):T.toString():T}else throw new Error("i18n: no data found to replace "+_+" placeholder in string")})};dr.prototype.hasIntlPluralRulesSupport=function(){return!!(window.Intl&&"PluralRules"in window.Intl&&Intl.PluralRules.supportedLocalesOf(this.locale).length)};dr.prototype.hasIntlNumberFormatSupport=function(){return!!(window.Intl&&"NumberFormat"in window.Intl&&Intl.NumberFormat.supportedLocalesOf(this.locale).length)};dr.prototype.getPluralSuffix=function(a,u){if(u=Number(u),!isFinite(u))return"other";var p;if(this.hasIntlPluralRulesSupport()?p=new Intl.PluralRules(this.locale).select(u):p=this.selectPluralFormUsingFallbackRules(u),a+"."+p in this.translations)return p;if(a+".other"in this.translations)return console&&"warn"in console&&console.warn('i18n: Missing plural form ".'+p+'" for "'+this.locale+'" locale. Falling back to ".other".'),"other";throw new Error('i18n: Plural form ".other" is required for "'+this.locale+'" locale')};dr.prototype.selectPluralFormUsingFallbackRules=function(a){a=Math.abs(Math.floor(a));var u=this.getPluralRulesForLocale();return u?dr.pluralRules[u](a):"other"};dr.prototype.getPluralRulesForLocale=function(){var a=this.locale,u=a.split("-")[0];for(var p in dr.pluralRulesMap)if(Object.prototype.hasOwnProperty.call(dr.pluralRulesMap,p)){for(var _=dr.pluralRulesMap[p],w=0;w<_.length;w++)if(_[w]===a||_[w]===u)return p}};dr.pluralRulesMap={arabic:["ar"],chinese:["my","zh","id","ja","jv","ko","ms","th","vi"],french:["hy","bn","fr","gu","hi","fa","pa","zu"],german:["af","sq","az","eu","bg","ca","da","nl","en","et","fi","ka","de","el","hu","lb","no","so","sw","sv","ta","te","tr","ur"],irish:["ga"],russian:["ru","uk"],scottish:["gd"],spanish:["pt-PT","it","es"],welsh:["cy"]};dr.pluralRules={arabic:function(a){return a===0?"zero":a===1?"one":a===2?"two":a%100>=3&&a%100<=10?"few":a%100>=11&&a%100<=99?"many":"other"},chinese:function(){return"other"},french:function(a){return a===0||a===1?"one":"other"},german:function(a){return a===1?"one":"other"},irish:function(a){return a===1?"one":a===2?"two":a>=3&&a<=6?"few":a>=7&&a<=10?"many":"other"},russian:function(a){var u=a%100,p=u%10;return p===1&&u!==11?"one":p>=2&&p<=4&&!(u>=12&&u<=14)?"few":p===0||p>=5&&p<=9||u>=11&&u<=14?"many":"other"},scottish:function(a){return a===1||a===11?"one":a===2||a===12?"two":a>=3&&a<=10||a>=13&&a<=19?"few":"other"},spanish:function(a){return a===1?"one":a%1e6===0&&a!==0?"many":"other"},welsh:function(a){return a===0?"zero":a===1?"one":a===2?"two":a===3?"few":a===6?"many":"other"}};(function(a){var u="DOMTokenList"in this&&function(p){return"classList"in p?!p.classList.toggle("x",!1)&&!p.className:!0}(document.createElement("x"));u||function(p){var _="DOMTokenList"in p&&p.DOMTokenList;(!_||document.createElementNS&&document.createElementNS("http://www.w3.org/2000/svg","svg")&&!(document.createElementNS("http://www.w3.org/2000/svg","svg").classList instanceof DOMTokenList))&&(p.DOMTokenList=function(){var w=!0,T=function(o,z,A,G){Object.defineProperty?Object.defineProperty(o,z,{configurable:w===!1?!0:!!G,get:A}):o.__defineGetter__(z,A)};try{T({},"support")}catch{w=!1}var M=function(o,z){var A=this,G=[],j={},fe=0,ge=0,he=function(Se){T(A,Se,function(){return De(),G[Se]},!1)},Ce=function(){if(fe>=ge)for(;ge<fe;++ge)he(ge)},De=function(){var Se,Ne,Ue=arguments,lt=/\s+/;if(Ue.length){for(Ne=0;Ne<Ue.length;++Ne)if(lt.test(Ue[Ne]))throw Se=new SyntaxError('String "'+Ue[Ne]+'" contains an invalid character'),Se.code=5,Se.name="InvalidCharacterError",Se}for(typeof o[z]=="object"?G=(""+o[z].baseVal).replace(/^\s+|\s+$/g,"").split(lt):G=(""+o[z]).replace(/^\s+|\s+$/g,"").split(lt),G[0]===""&&(G=[]),j={},Ne=0;Ne<G.length;++Ne)j[G[Ne]]=!0;fe=G.length,Ce()};return De(),T(A,"length",function(){return De(),fe}),A.toLocaleString=A.toString=function(){return De(),G.join(" ")},A.item=function(Se){return De(),G[Se]},A.contains=function(Se){return De(),!!j[Se]},A.add=function(){De.apply(A,Se=arguments);for(var Se,Ne,Ue=0,lt=Se.length;Ue<lt;++Ue)Ne=Se[Ue],j[Ne]||(G.push(Ne),j[Ne]=!0);fe!==G.length&&(fe=G.length>>>0,typeof o[z]=="object"?o[z].baseVal=G.join(" "):o[z]=G.join(" "),Ce())},A.remove=function(){De.apply(A,Se=arguments);for(var Se,Ne={},Ue=0,lt=[];Ue<Se.length;++Ue)Ne[Se[Ue]]=!0,delete j[Se[Ue]];for(Ue=0;Ue<G.length;++Ue)Ne[G[Ue]]||lt.push(G[Ue]);G=lt,fe=lt.length>>>0,typeof o[z]=="object"?o[z].baseVal=G.join(" "):o[z]=G.join(" "),Ce()},A.toggle=function(Se,Ne){return De.apply(A,[Se]),a!==Ne?Ne?(A.add(Se),!0):(A.remove(Se),!1):j[Se]?(A.remove(Se),!1):(A.add(Se),!0)},A};return M}()),function(){var w=document.createElement("span");"classList"in w&&(w.classList.toggle("x",!1),w.classList.contains("x")&&(w.classList.constructor.prototype.toggle=function(M){var o=arguments[1];if(o===a){var z=!this.contains(M);return this[z?"add":"remove"](M),z}return o=!!o,this[o?"add":"remove"](M),o}))}(),function(){var w=document.createElement("span");if("classList"in w&&(w.classList.add("a","b"),!w.classList.contains("b"))){var T=w.classList.constructor.prototype.add;w.classList.constructor.prototype.add=function(){for(var M=arguments,o=arguments.length,z=0;z<o;z++)T.call(this,M[z])}}}(),function(){var w=document.createElement("span");if("classList"in w&&(w.classList.add("a"),w.classList.add("b"),w.classList.remove("a","b"),!!w.classList.contains("b"))){var T=w.classList.constructor.prototype.remove;w.classList.constructor.prototype.remove=function(){for(var M=arguments,o=arguments.length,z=0;z<o;z++)T.call(this,M[z])}}}()}(this)}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});(function(a){var u="document"in this&&"classList"in document.documentElement&&"Element"in this&&"classList"in Element.prototype&&function(){var p=document.createElement("span");return p.classList.add("a","b"),p.classList.contains("b")}();u||function(p){var _=!0,w=function(M,o,z,A){Object.defineProperty?Object.defineProperty(M,o,{configurable:_===!1?!0:!!A,get:z}):M.__defineGetter__(o,z)};try{w({},"support")}catch{_=!1}var T=function(M,o,z){w(M.prototype,o,function(){var A,G=this,j="__defineGetter__DEFINE_PROPERTY"+o;if(G[j])return A;if(G[j]=!0,_===!1){for(var fe,ge=T.mirror||document.createElement("div"),he=ge.childNodes,Ce=he.length,De=0;De<Ce;++De)if(he[De]._R===G){fe=he[De];break}fe||(fe=ge.appendChild(document.createElement("div"))),A=DOMTokenList.call(fe,G,z)}else A=new DOMTokenList(G,z);return w(G,o,function(){return A}),delete G[j],A},!0)};T(p.Element,"classList","className"),T(p.HTMLElement,"classList","className"),T(p.HTMLLinkElement,"relList","rel"),T(p.HTMLAnchorElement,"relList","rel"),T(p.HTMLAreaElement,"relList","rel")}(this)}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});(function(a){var u="document"in this&&"matches"in document.documentElement;u||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.mozMatchesSelector||function(_){for(var w=this,T=(w.document||w.ownerDocument).querySelectorAll(_),M=0;T[M]&&T[M]!==w;)++M;return!!T[M]})}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});(function(a){var u="document"in this&&"closest"in document.documentElement;u||(Element.prototype.closest=function(_){for(var w=this;w;){if(w.matches(_))return w;w="SVGElement"in window&&w instanceof SVGElement?w.parentNode:w.parentElement}return null})}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});(function(a){var u="Window"in this;u||typeof WorkerGlobalScope>"u"&&typeof importScripts!="function"&&function(p){p.constructor?p.Window=p.constructor:(p.Window=p.constructor=new Function("return function Window() {}")()).prototype=this}(this)}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});(function(a){var u=function(p){if(!("Event"in p))return!1;if(typeof p.Event=="function")return!0;try{return new Event("click"),!0}catch{return!1}}(this);u||function(){var p={click:1,dblclick:1,keyup:1,keypress:1,keydown:1,mousedown:1,mouseup:1,mousemove:1,mouseover:1,mouseenter:1,mouseleave:1,mouseout:1,storage:1,storagecommit:1,textinput:1};if(typeof document>"u"||typeof window>"u")return;function _(T,M){for(var o=-1,z=T.length;++o<z;)if(o in T&&T[o]===M)return o;return-1}var w=window.Event&&window.Event.prototype||null;window.Event=Window.prototype.Event=function(M,o){if(!M)throw new Error("Not enough arguments");var z;if("createEvent"in document){z=document.createEvent("Event");var A=o&&o.bubbles!==a?o.bubbles:!1,G=o&&o.cancelable!==a?o.cancelable:!1;return z.initEvent(M,A,G),z}return z=document.createEventObject(),z.type=M,z.bubbles=o&&o.bubbles!==a?o.bubbles:!1,z.cancelable=o&&o.cancelable!==a?o.cancelable:!1,z},w&&Object.defineProperty(window.Event,"prototype",{configurable:!1,enumerable:!1,writable:!0,value:w}),"createEvent"in document||(window.addEventListener=Window.prototype.addEventListener=Document.prototype.addEventListener=Element.prototype.addEventListener=function(){var M=this,o=arguments[0],z=arguments[1];if(M===window&&o in p)throw new Error("In IE8 the event: "+o+" is not available on the window object. Please see https://github.com/Financial-Times/polyfill-service/issues/317 for more information.");M._events||(M._events={}),M._events[o]||(M._events[o]=function(A){var G=M._events[A.type].list,j=G.slice(),fe=-1,ge=j.length,he;for(A.preventDefault=function(){A.cancelable!==!1&&(A.returnValue=!1)},A.stopPropagation=function(){A.cancelBubble=!0},A.stopImmediatePropagation=function(){A.cancelBubble=!0,A.cancelImmediate=!0},A.currentTarget=M,A.relatedTarget=A.fromElement||null,A.target=A.target||A.srcElement||M,A.timeStamp=new Date().getTime(),A.clientX&&(A.pageX=A.clientX+document.documentElement.scrollLeft,A.pageY=A.clientY+document.documentElement.scrollTop);++fe<ge&&!A.cancelImmediate;)fe in j&&(he=j[fe],_(G,he)!==-1&&typeof he=="function"&&he.call(M,A))},M._events[o].list=[],M.attachEvent&&M.attachEvent("on"+o,M._events[o])),M._events[o].list.push(z)},window.removeEventListener=Window.prototype.removeEventListener=Document.prototype.removeEventListener=Element.prototype.removeEventListener=function(){var M=this,o=arguments[0],z=arguments[1],A;M._events&&M._events[o]&&M._events[o].list&&(A=_(M._events[o].list,z),A!==-1&&(M._events[o].list.splice(A,1),M._events[o].list.length||(M.detachEvent&&M.detachEvent("on"+o,M._events[o]),delete M._events[o])))},window.dispatchEvent=Window.prototype.dispatchEvent=Document.prototype.dispatchEvent=Element.prototype.dispatchEvent=function(M){if(!arguments.length)throw new Error("Not enough arguments");if(!M||typeof M.type!="string")throw new Error("DOM Events Exception 0");var o=this,z=M.type;try{if(!M.bubbles){M.cancelBubble=!0;var A=function(G){G.cancelBubble=!0,(o||window).detachEvent("on"+z,A)};this.attachEvent("on"+z,A)}this.fireEvent("on"+z,M)}catch{M.target=o;do M.currentTarget=o,"_events"in o&&typeof o._events[z]=="function"&&o._events[z].call(o,M),typeof o["on"+z]=="function"&&o["on"+z].call(o,M),o=o.nodeType===9?o.parentWindow:o.parentNode;while(o&&!M.cancelBubble)}return!0},document.attachEvent("onreadystatechange",function(){document.readyState==="complete"&&document.dispatchEvent(new Event("DOMContentLoaded",{bubbles:!0}))}))}()}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});(function(a){var u="bind"in Function.prototype;u||Object.defineProperty(Function.prototype,"bind",{value:function(_){var w=Array,T=Object,M=T.prototype,o=w.prototype,z=function(){},A=M.toString,G=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",j,fe=Function.prototype.toString,ge=function(Zt){try{return fe.call(Zt),!0}catch{return!1}},he="[object Function]",Ce="[object GeneratorFunction]";j=function(Zt){if(typeof Zt!="function")return!1;if(G)return ge(Zt);var _i=A.call(Zt);return _i===he||_i===Ce};var De=o.slice,Se=o.concat,Ne=o.push,Ue=Math.max,lt=this;if(!j(lt))throw new TypeError("Function.prototype.bind called on incompatible "+lt);for(var pt=De.call(arguments,1),ht,st=function(){if(this instanceof ht){var gi=lt.apply(this,Se.call(pt,De.call(arguments)));return T(gi)===gi?gi:this}else return lt.apply(_,Se.call(pt,De.call(arguments)))},xt=Ue(0,lt.length-pt.length),_t=[],tt=0;tt<xt;tt++)Ne.call(_t,"$"+tt);return ht=Function("binder","return function ("+_t.join(",")+"){ return binder.apply(this, arguments); }")(st),lt.prototype&&(z.prototype=lt.prototype,ht.prototype=new z,z.prototype=null),ht}})}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});var M_={hideAllSections:"Hide all sections",hideSection:"Hide",hideSectionAriaLabel:"Hide this section",showAllSections:"Show all sections",showSection:"Show",showSectionAriaLabel:"Show this section"};function Ar(a,u){if(!(a instanceof HTMLElement))return this;this.$module=a;var p={i18n:M_,rememberExpanded:!0};this.config=Aa(p,u||{},ka(a.dataset)),this.i18n=new dr(Lh(this.config,"i18n")),this.controlsClass="govuk-accordion__controls",this.showAllClass="govuk-accordion__show-all",this.showAllTextClass="govuk-accordion__show-all-text",this.sectionClass="govuk-accordion__section",this.sectionExpandedClass="govuk-accordion__section--expanded",this.sectionButtonClass="govuk-accordion__section-button",this.sectionHeaderClass="govuk-accordion__section-header",this.sectionHeadingClass="govuk-accordion__section-heading",this.sectionHeadingDividerClass="govuk-accordion__section-heading-divider",this.sectionHeadingTextClass="govuk-accordion__section-heading-text",this.sectionHeadingTextFocusClass="govuk-accordion__section-heading-text-focus",this.sectionShowHideToggleClass="govuk-accordion__section-toggle",this.sectionShowHideToggleFocusClass="govuk-accordion__section-toggle-focus",this.sectionShowHideTextClass="govuk-accordion__section-toggle-text",this.upChevronIconClass="govuk-accordion-nav__chevron",this.downChevronIconClass="govuk-accordion-nav__chevron--down",this.sectionSummaryClass="govuk-accordion__section-summary",this.sectionSummaryFocusClass="govuk-accordion__section-summary-focus",this.sectionContentClass="govuk-accordion__section-content";var _=this.$module.querySelectorAll("."+this.sectionClass);if(!_.length)return this;this.$sections=_,this.browserSupportsSessionStorage=P_.checkForSessionStorage(),this.$showAllButton=null,this.$showAllIcon=null,this.$showAllText=null}Ar.prototype.init=function(){if(!(!this.$module||!this.$sections)){this.initControls(),this.initSectionHeaders();var a=this.checkIfAllSectionsOpen();this.updateShowAllButton(a)}};Ar.prototype.initControls=function(){this.$showAllButton=document.createElement("button"),this.$showAllButton.setAttribute("type","button"),this.$showAllButton.setAttribute("class",this.showAllClass),this.$showAllButton.setAttribute("aria-expanded","false"),this.$showAllIcon=document.createElement("span"),this.$showAllIcon.classList.add(this.upChevronIconClass),this.$showAllButton.appendChild(this.$showAllIcon);var a=document.createElement("div");a.setAttribute("class",this.controlsClass),a.appendChild(this.$showAllButton),this.$module.insertBefore(a,this.$module.firstChild),this.$showAllText=document.createElement("span"),this.$showAllText.classList.add(this.showAllTextClass),this.$showAllButton.appendChild(this.$showAllText),this.$showAllButton.addEventListener("click",this.onShowOrHideAllToggle.bind(this)),"onbeforematch"in document&&document.addEventListener("beforematch",this.onBeforeMatch.bind(this))};Ar.prototype.initSectionHeaders=function(){var a=this,u=this.$sections;fi(u,function(p,_){var w=p.querySelector("."+a.sectionHeaderClass);w&&(a.constructHeaderMarkup(w,_),a.setExpanded(a.isExpanded(p),p),w.addEventListener("click",a.onSectionToggle.bind(a,p)),a.setInitialState(p))})};Ar.prototype.constructHeaderMarkup=function(a,u){var p=a.querySelector("."+this.sectionButtonClass),_=a.querySelector("."+this.sectionHeadingClass),w=a.querySelector("."+this.sectionSummaryClass);if(!(!p||!_)){var T=document.createElement("button");T.setAttribute("type","button"),T.setAttribute("aria-controls",this.$module.id+"-content-"+(u+1).toString());for(var M=0;M<p.attributes.length;M++){var o=p.attributes.item(M);o.nodeName!=="id"&&T.setAttribute(o.nodeName,o.nodeValue)}var z=document.createElement("span");z.classList.add(this.sectionHeadingTextClass),z.id=p.id;var A=document.createElement("span");A.classList.add(this.sectionHeadingTextFocusClass),z.appendChild(A),A.innerHTML=p.innerHTML;var G=document.createElement("span");G.classList.add(this.sectionShowHideToggleClass),G.setAttribute("data-nosnippet","");var j=document.createElement("span");j.classList.add(this.sectionShowHideToggleFocusClass),G.appendChild(j);var fe=document.createElement("span"),ge=document.createElement("span");if(ge.classList.add(this.upChevronIconClass),j.appendChild(ge),fe.classList.add(this.sectionShowHideTextClass),j.appendChild(fe),T.appendChild(z),T.appendChild(this.getButtonPunctuationEl()),w){var he=document.createElement("span"),Ce=document.createElement("span");Ce.classList.add(this.sectionSummaryFocusClass),he.appendChild(Ce);for(var De=0,Se=w.attributes.length;De<Se;++De){var Ne=w.attributes.item(De).nodeName,Ue=w.attributes.item(De).nodeValue;he.setAttribute(Ne,Ue)}Ce.innerHTML=w.innerHTML,w.parentNode.replaceChild(he,w),T.appendChild(he),T.appendChild(this.getButtonPunctuationEl())}T.appendChild(G),_.removeChild(p),_.appendChild(T)}};Ar.prototype.onBeforeMatch=function(a){var u=a.target;if(u instanceof Element){var p=u.closest("."+this.sectionClass);p&&this.setExpanded(!0,p)}};Ar.prototype.onSectionToggle=function(a){var u=this.isExpanded(a);this.setExpanded(!u,a),this.storeState(a)};Ar.prototype.onShowOrHideAllToggle=function(){var a=this,u=this.$sections,p=!this.checkIfAllSectionsOpen();fi(u,function(_){a.setExpanded(p,_),a.storeState(_)}),a.updateShowAllButton(p)};Ar.prototype.setExpanded=function(a,u){var p=u.querySelector("."+this.upChevronIconClass),_=u.querySelector("."+this.sectionShowHideTextClass),w=u.querySelector("."+this.sectionButtonClass),T=u.querySelector("."+this.sectionContentClass);if(!(!p||!(_ instanceof HTMLElement)||!w||!T)){var M=a?this.i18n.t("hideSection"):this.i18n.t("showSection");_.innerText=M,w.setAttribute("aria-expanded",a.toString());var o=[],z=u.querySelector("."+this.sectionHeadingTextClass);z instanceof HTMLElement&&o.push(z.innerText.trim());var A=u.querySelector("."+this.sectionSummaryClass);A instanceof HTMLElement&&o.push(A.innerText.trim());var G=a?this.i18n.t("hideSectionAriaLabel"):this.i18n.t("showSectionAriaLabel");o.push(G),w.setAttribute("aria-label",o.join(" , ")),a?(T.removeAttribute("hidden"),u.classList.add(this.sectionExpandedClass),p.classList.remove(this.downChevronIconClass)):(T.setAttribute("hidden","until-found"),u.classList.remove(this.sectionExpandedClass),p.classList.add(this.downChevronIconClass));var j=this.checkIfAllSectionsOpen();this.updateShowAllButton(j)}};Ar.prototype.isExpanded=function(a){return a.classList.contains(this.sectionExpandedClass)};Ar.prototype.checkIfAllSectionsOpen=function(){var a=this.$sections.length,u=this.$module.querySelectorAll("."+this.sectionExpandedClass).length,p=a===u;return p};Ar.prototype.updateShowAllButton=function(a){var u=a?this.i18n.t("hideAllSections"):this.i18n.t("showAllSections");this.$showAllButton.setAttribute("aria-expanded",a.toString()),this.$showAllText.innerText=u,a?this.$showAllIcon.classList.remove(this.downChevronIconClass):this.$showAllIcon.classList.add(this.downChevronIconClass)};var P_={checkForSessionStorage:function(){var a="this is the test string",u;try{return window.sessionStorage.setItem(a,a),u=window.sessionStorage.getItem(a)===a.toString(),window.sessionStorage.removeItem(a),u}catch{return!1}}};Ar.prototype.storeState=function(a){if(this.browserSupportsSessionStorage&&this.config.rememberExpanded){var u=a.querySelector("."+this.sectionButtonClass);if(u){var p=u.getAttribute("aria-controls"),_=u.getAttribute("aria-expanded");p&&_&&window.sessionStorage.setItem(p,_)}}};Ar.prototype.setInitialState=function(a){if(this.browserSupportsSessionStorage&&this.config.rememberExpanded){var u=a.querySelector("."+this.sectionButtonClass);if(u){var p=u.getAttribute("aria-controls"),_=p?window.sessionStorage.getItem(p):null;_!==null&&this.setExpanded(_==="true",a)}}};Ar.prototype.getButtonPunctuationEl=function(){var a=document.createElement("span");return a.classList.add("govuk-visually-hidden",this.sectionHeadingDividerClass),a.innerHTML=", ",a};var L_=32,z_=1;function eu(a,u){if(!(a instanceof HTMLElement))return this;this.$module=a,this.debounceFormSubmitTimer=null;var p={preventDoubleClick:!1};this.config=Aa(p,u||{},ka(a.dataset))}eu.prototype.init=function(){this.$module&&(this.$module.addEventListener("keydown",this.handleKeyDown),this.$module.addEventListener("click",this.debounce.bind(this)))};eu.prototype.handleKeyDown=function(a){var u=a.target;a.keyCode===L_&&u instanceof HTMLElement&&u.getAttribute("role")==="button"&&(a.preventDefault(),u.click())};eu.prototype.debounce=function(a){if(this.config.preventDoubleClick){if(this.debounceFormSubmitTimer)return a.preventDefault(),!1;this.debounceFormSubmitTimer=setTimeout(function(){this.debounceFormSubmitTimer=null}.bind(this),z_*1e3)}};function D_(a,u){var p=a.closest("["+u+"]");return p?p.getAttribute(u):null}(function(a){var u="Date"in self&&"now"in self.Date&&"getTime"in self.Date.prototype;u||(Date.now=function(){return new Date().getTime()})}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});var B_={charactersUnderLimit:{one:"You have %{count} character remaining",other:"You have %{count} characters remaining"},charactersAtLimit:"You have 0 characters remaining",charactersOverLimit:{one:"You have %{count} character too many",other:"You have %{count} characters too many"},wordsUnderLimit:{one:"You have %{count} word remaining",other:"You have %{count} words remaining"},wordsAtLimit:"You have 0 words remaining",wordsOverLimit:{one:"You have %{count} word too many",other:"You have %{count} words too many"},textareaDescription:{other:""}};function Fr(a,u){if(!(a instanceof HTMLElement))return this;var p=a.querySelector(".govuk-js-character-count");if(!(p instanceof HTMLTextAreaElement||p instanceof HTMLInputElement))return this;var _={threshold:0,i18n:B_},w=ka(a.dataset),T={};if(("maxwords"in w||"maxlength"in w)&&(T={maxlength:!1,maxwords:!1}),this.config=Aa(_,u||{},T,w),this.i18n=new dr(Lh(this.config,"i18n"),{locale:D_(a,"lang")}),this.maxLength=1/0,"maxwords"in this.config&&this.config.maxwords)this.maxLength=this.config.maxwords;else if("maxlength"in this.config&&this.config.maxlength)this.maxLength=this.config.maxlength;else return;this.$module=a,this.$textarea=p,this.$visibleCountMessage=null,this.$screenReaderCountMessage=null,this.lastInputTimestamp=null,this.lastInputValue="",this.valueChecker=null}Fr.prototype.init=function(){if(!(!this.$module||!this.$textarea)){var a=this.$textarea,u=document.getElementById(a.id+"-info");if(u){u.innerText.match(/^\s*$/)&&(u.innerText=this.i18n.t("textareaDescription",{count:this.maxLength})),a.insertAdjacentElement("afterend",u);var p=document.createElement("div");p.className="govuk-character-count__sr-status govuk-visually-hidden",p.setAttribute("aria-live","polite"),this.$screenReaderCountMessage=p,u.insertAdjacentElement("afterend",p);var _=document.createElement("div");_.className=u.className,_.classList.add("govuk-character-count__status"),_.setAttribute("aria-hidden","true"),this.$visibleCountMessage=_,u.insertAdjacentElement("afterend",_),u.classList.add("govuk-visually-hidden"),a.removeAttribute("maxlength"),this.bindChangeEvents(),window.addEventListener("onpageshow"in window?"pageshow":"DOMContentLoaded",this.updateCountMessage.bind(this)),this.updateCountMessage()}}};Fr.prototype.bindChangeEvents=function(){var a=this.$textarea;a.addEventListener("keyup",this.handleKeyUp.bind(this)),a.addEventListener("focus",this.handleFocus.bind(this)),a.addEventListener("blur",this.handleBlur.bind(this))};Fr.prototype.handleKeyUp=function(){this.updateVisibleCountMessage(),this.lastInputTimestamp=Date.now()};Fr.prototype.handleFocus=function(){this.valueChecker=setInterval(function(){(!this.lastInputTimestamp||Date.now()-500>=this.lastInputTimestamp)&&this.updateIfValueChanged()}.bind(this),1e3)};Fr.prototype.handleBlur=function(){clearInterval(this.valueChecker)};Fr.prototype.updateIfValueChanged=function(){this.$textarea.value!==this.lastInputValue&&(this.lastInputValue=this.$textarea.value,this.updateCountMessage())};Fr.prototype.updateCountMessage=function(){this.updateVisibleCountMessage(),this.updateScreenReaderCountMessage()};Fr.prototype.updateVisibleCountMessage=function(){var a=this.$textarea,u=this.$visibleCountMessage,p=this.maxLength-this.count(a.value);this.isOverThreshold()?u.classList.remove("govuk-character-count__message--disabled"):u.classList.add("govuk-character-count__message--disabled"),p<0?(a.classList.add("govuk-textarea--error"),u.classList.remove("govuk-hint"),u.classList.add("govuk-error-message")):(a.classList.remove("govuk-textarea--error"),u.classList.remove("govuk-error-message"),u.classList.add("govuk-hint")),u.innerText=this.getCountMessage()};Fr.prototype.updateScreenReaderCountMessage=function(){var a=this.$screenReaderCountMessage;this.isOverThreshold()?a.removeAttribute("aria-hidden"):a.setAttribute("aria-hidden","true"),a.innerText=this.getCountMessage()};Fr.prototype.count=function(a){if("maxwords"in this.config&&this.config.maxwords){var u=a.match(/\S+/g)||[];return u.length}else return a.length};Fr.prototype.getCountMessage=function(){var a=this.maxLength-this.count(this.$textarea.value),u="maxwords"in this.config&&this.config.maxwords?"words":"characters";return this.formatCountMessage(a,u)};Fr.prototype.formatCountMessage=function(a,u){if(a===0)return this.i18n.t(u+"AtLimit");var p=a<0?"OverLimit":"UnderLimit";return this.i18n.t(u+p,{count:Math.abs(a)})};Fr.prototype.isOverThreshold=function(){if(!this.config.threshold)return!0;var a=this.$textarea,u=this.count(a.value),p=this.maxLength,_=p*this.config.threshold/100;return _<=u};function yo(a){if(!(a instanceof HTMLElement))return this;var u=a.querySelectorAll('input[type="checkbox"]');if(!u.length)return this;this.$module=a,this.$inputs=u}yo.prototype.init=function(){if(!(!this.$module||!this.$inputs)){var a=this.$module,u=this.$inputs;fi(u,function(p){var _=p.getAttribute("data-aria-controls");!_||!document.getElementById(_)||(p.setAttribute("aria-controls",_),p.removeAttribute("data-aria-controls"))}),window.addEventListener("onpageshow"in window?"pageshow":"DOMContentLoaded",this.syncAllConditionalReveals.bind(this)),this.syncAllConditionalReveals(),a.addEventListener("click",this.handleClick.bind(this))}};yo.prototype.syncAllConditionalReveals=function(){fi(this.$inputs,this.syncConditionalRevealWithInputState.bind(this))};yo.prototype.syncConditionalRevealWithInputState=function(a){var u=a.getAttribute("aria-controls");if(u){var p=document.getElementById(u);if(p&&p.classList.contains("govuk-checkboxes__conditional")){var _=a.checked;a.setAttribute("aria-expanded",_.toString()),p.classList.toggle("govuk-checkboxes__conditional--hidden",!_)}}};yo.prototype.unCheckAllInputsExcept=function(a){var u=this,p=document.querySelectorAll('input[type="checkbox"][name="'+a.name+'"]');fi(p,function(_){var w=a.form===_.form;w&&_!==a&&(_.checked=!1,u.syncConditionalRevealWithInputState(_))})};yo.prototype.unCheckExclusiveInputs=function(a){var u=this,p=document.querySelectorAll('input[data-behaviour="exclusive"][type="checkbox"][name="'+a.name+'"]');fi(p,function(_){var w=a.form===_.form;w&&(_.checked=!1,u.syncConditionalRevealWithInputState(_))})};yo.prototype.handleClick=function(a){var u=a.target;if(!(!(u instanceof HTMLInputElement)||u.type!=="checkbox")){var p=u.getAttribute("aria-controls");if(p&&this.syncConditionalRevealWithInputState(u),!!u.checked){var _=u.getAttribute("data-behaviour")==="exclusive";_?this.unCheckAllInputsExcept(u):this.unCheckExclusiveInputs(u)}}};var R_=13,Dp=32;function Fl(a){if(!(a instanceof HTMLElement))return this;this.$module=a,this.$summary=null,this.$content=null}Fl.prototype.init=function(){if(this.$module){var a="HTMLDetailsElement"in window&&this.$module instanceof HTMLDetailsElement;a||this.polyfillDetails()}};Fl.prototype.polyfillDetails=function(){var a=this.$module,u=this.$summary=a.getElementsByTagName("summary").item(0),p=this.$content=a.getElementsByTagName("div").item(0);!u||!p||(p.id||(p.id="details-content-"+A_()),a.setAttribute("role","group"),u.setAttribute("role","button"),u.setAttribute("aria-controls",p.id),u.tabIndex=0,this.$module.hasAttribute("open")?u.setAttribute("aria-expanded","true"):(u.setAttribute("aria-expanded","false"),p.style.display="none"),this.polyfillHandleInputs(this.polyfillSetAttributes.bind(this)))};Fl.prototype.polyfillSetAttributes=function(){return this.$module.hasAttribute("open")?(this.$module.removeAttribute("open"),this.$summary.setAttribute("aria-expanded","false"),this.$content.style.display="none"):(this.$module.setAttribute("open","open"),this.$summary.setAttribute("aria-expanded","true"),this.$content.style.display=""),!0};Fl.prototype.polyfillHandleInputs=function(a){this.$summary.addEventListener("keypress",function(u){var p=u.target;(u.keyCode===R_||u.keyCode===Dp)&&p instanceof HTMLElement&&p.nodeName.toLowerCase()==="summary"&&(u.preventDefault(),p.click?p.click():a(u))}),this.$summary.addEventListener("keyup",function(u){var p=u.target;u.keyCode===Dp&&p instanceof HTMLElement&&p.nodeName.toLowerCase()==="summary"&&u.preventDefault()}),this.$summary.addEventListener("click",a)};function vo(a,u){if(!(a instanceof HTMLElement))return this;this.$module=a;var p={disableAutoFocus:!1};this.config=Aa(p,u||{},ka(a.dataset))}vo.prototype.init=function(){if(this.$module){var a=this.$module;this.setFocus(),a.addEventListener("click",this.handleClick.bind(this))}};vo.prototype.setFocus=function(){var a=this.$module;this.config.disableAutoFocus||(a.setAttribute("tabindex","-1"),a.addEventListener("blur",function(){a.removeAttribute("tabindex")}),a.focus())};vo.prototype.handleClick=function(a){var u=a.target;this.focusTarget(u)&&a.preventDefault()};vo.prototype.focusTarget=function(a){if(!(a instanceof HTMLAnchorElement))return!1;var u=this.getFragmentFromUrl(a.href);if(!u)return!1;var p=document.getElementById(u);if(!p)return!1;var _=this.getAssociatedLegendOrLabel(p);return _?(_.scrollIntoView(),p.focus({preventScroll:!0}),!0):!1};vo.prototype.getFragmentFromUrl=function(a){if(a.indexOf("#")!==-1)return a.split("#").pop()};vo.prototype.getAssociatedLegendOrLabel=function(a){var u=a.closest("fieldset");if(u){var p=u.getElementsByTagName("legend");if(p.length){var _=p[0];if(a instanceof HTMLInputElement&&(a.type==="checkbox"||a.type==="radio"))return _;var w=_.getBoundingClientRect().top,T=a.getBoundingClientRect();if(T.height&&window.innerHeight){var M=T.top+T.height;if(M-w<window.innerHeight/2)return _}}}return document.querySelector("label[for='"+a.getAttribute("id")+"']")||a.closest("label")};var F_={activated:"Loading.",timedOut:"Exit this page expired.",pressTwoMoreTimes:"Shift, press 2 more times to exit.",pressOneMoreTime:"Shift, press 1 more time to exit."};function dn(a,u){var p={i18n:F_};if(!(a instanceof HTMLElement))return this;var _=a.querySelector(".govuk-exit-this-page__button");if(!(_ instanceof HTMLElement))return this;this.config=Aa(p,u||{},ka(a.dataset)),this.i18n=new dr(Lh(this.config,"i18n")),this.$module=a,this.$button=_,this.$skiplinkButton=document.querySelector(".govuk-js-exit-this-page-skiplink"),this.$updateSpan=null,this.$indicatorContainer=null,this.$overlay=null,this.keypressCounter=0,this.lastKeyWasModified=!1,this.timeoutTime=5e3,this.keypressTimeoutId=null,this.timeoutMessageId=null}dn.prototype.initUpdateSpan=function(){this.$updateSpan=document.createElement("span"),this.$updateSpan.setAttribute("role","status"),this.$updateSpan.className="govuk-visually-hidden",this.$module.appendChild(this.$updateSpan)};dn.prototype.initButtonClickHandler=function(){this.$button.addEventListener("click",this.handleClick.bind(this)),this.$skiplinkButton&&this.$skiplinkButton.addEventListener("click",this.handleClick.bind(this))};dn.prototype.buildIndicator=function(){this.$indicatorContainer=document.createElement("div"),this.$indicatorContainer.className="govuk-exit-this-page__indicator",this.$indicatorContainer.setAttribute("aria-hidden","true");for(var a=0;a<3;a++){var u=document.createElement("div");u.className="govuk-exit-this-page__indicator-light",this.$indicatorContainer.appendChild(u)}this.$button.appendChild(this.$indicatorContainer)};dn.prototype.updateIndicator=function(){this.keypressCounter>0?this.$indicatorContainer.classList.add("govuk-exit-this-page__indicator--visible"):this.$indicatorContainer.classList.remove("govuk-exit-this-page__indicator--visible");var a=this.$indicatorContainer.querySelectorAll(".govuk-exit-this-page__indicator-light");fi(a,function(u,p){u.classList.toggle("govuk-exit-this-page__indicator-light--on",p<this.keypressCounter)}.bind(this))};dn.prototype.exitPage=function(){this.$updateSpan.innerText="",document.body.classList.add("govuk-exit-this-page-hide-content"),this.$overlay=document.createElement("div"),this.$overlay.className="govuk-exit-this-page-overlay",this.$overlay.setAttribute("role","alert"),document.body.appendChild(this.$overlay),this.$overlay.innerText=this.i18n.t("activated"),window.location.href=this.$button.getAttribute("href")};dn.prototype.handleClick=function(a){a.preventDefault(),this.exitPage()};dn.prototype.handleKeypress=function(a){(a.key==="Shift"||a.keyCode===16||a.which===16)&&!this.lastKeyWasModified?(this.keypressCounter+=1,this.updateIndicator(),this.timeoutMessageId!==null&&(clearTimeout(this.timeoutMessageId),this.timeoutMessageId=null),this.keypressCounter>=3?(this.keypressCounter=0,this.keypressTimeoutId!==null&&(clearTimeout(this.keypressTimeoutId),this.keypressTimeoutId=null),this.exitPage()):this.keypressCounter===1?this.$updateSpan.innerText=this.i18n.t("pressTwoMoreTimes"):this.$updateSpan.innerText=this.i18n.t("pressOneMoreTime"),this.setKeypressTimer()):this.keypressTimeoutId!==null&&this.resetKeypressTimer(),this.lastKeyWasModified=a.shiftKey};dn.prototype.setKeypressTimer=function(){clearTimeout(this.keypressTimeoutId),this.keypressTimeoutId=setTimeout(this.resetKeypressTimer.bind(this),this.timeoutTime)};dn.prototype.resetKeypressTimer=function(){clearTimeout(this.keypressTimeoutId),this.keypressTimeoutId=null,this.keypressCounter=0,this.$updateSpan.innerText=this.i18n.t("timedOut"),this.timeoutMessageId=setTimeout(function(){this.$updateSpan.innerText=""}.bind(this),this.timeoutTime),this.updateIndicator()};dn.prototype.resetPage=function(){document.body.classList.remove("govuk-exit-this-page-hide-content"),this.$overlay&&(this.$overlay.remove(),this.$overlay=null),this.$updateSpan.setAttribute("role","status"),this.$updateSpan.innerText="",this.updateIndicator(),this.keypressTimeoutId&&clearTimeout(this.keypressTimeoutId),this.timeoutMessageId&&clearTimeout(this.timeoutMessageId)};dn.prototype.init=function(){this.buildIndicator(),this.initUpdateSpan(),this.initButtonClickHandler(),"govukFrontendExitThisPageKeypress"in document.body.dataset||(document.addEventListener("keyup",this.handleKeypress.bind(this),!0),document.body.dataset.govukFrontendExitThisPageKeypress="true"),window.addEventListener("onpageshow"in window?"pageshow":"DOMContentLoaded",this.resetPage.bind(this))};function tu(a){if(!(a instanceof HTMLElement))return this;this.$module=a,this.$menuButton=a.querySelector(".govuk-js-header-toggle"),this.$menu=this.$menuButton&&a.querySelector("#"+this.$menuButton.getAttribute("aria-controls")),this.menuIsOpen=!1,this.mql=null}tu.prototype.init=function(){!this.$module||!this.$menuButton||!this.$menu||("matchMedia"in window?(this.mql=window.matchMedia("(min-width: 48.0625em)"),"addEventListener"in this.mql?this.mql.addEventListener("change",this.syncState.bind(this)):this.mql.addListener(this.syncState.bind(this)),this.syncState(),this.$menuButton.addEventListener("click",this.handleMenuButtonClick.bind(this))):this.$menuButton.setAttribute("hidden",""))};tu.prototype.syncState=function(){this.mql.matches?(this.$menu.removeAttribute("hidden"),this.$menuButton.setAttribute("hidden","")):(this.$menuButton.removeAttribute("hidden"),this.$menuButton.setAttribute("aria-expanded",this.menuIsOpen.toString()),this.menuIsOpen?this.$menu.removeAttribute("hidden"):this.$menu.setAttribute("hidden",""))};tu.prototype.handleMenuButtonClick=function(){this.menuIsOpen=!this.menuIsOpen,this.syncState()};function zh(a,u){if(!(a instanceof HTMLElement))return this;this.$module=a;var p={disableAutoFocus:!1};this.config=Aa(p,u||{},ka(a.dataset))}zh.prototype.init=function(){this.$module&&this.setFocus()};zh.prototype.setFocus=function(){var a=this.$module;this.config.disableAutoFocus||a.getAttribute("role")==="alert"&&(a.getAttribute("tabindex")||(a.setAttribute("tabindex","-1"),a.addEventListener("blur",function(){a.removeAttribute("tabindex")})),a.focus())};function Ol(a){if(!(a instanceof HTMLElement))return this;var u=a.querySelectorAll('input[type="radio"]');if(!u.length)return this;this.$module=a,this.$inputs=u}Ol.prototype.init=function(){if(!(!this.$module||!this.$inputs)){var a=this.$module,u=this.$inputs;fi(u,function(p){var _=p.getAttribute("data-aria-controls");!_||!document.getElementById(_)||(p.setAttribute("aria-controls",_),p.removeAttribute("data-aria-controls"))}),window.addEventListener("onpageshow"in window?"pageshow":"DOMContentLoaded",this.syncAllConditionalReveals.bind(this)),this.syncAllConditionalReveals(),a.addEventListener("click",this.handleClick.bind(this))}};Ol.prototype.syncAllConditionalReveals=function(){fi(this.$inputs,this.syncConditionalRevealWithInputState.bind(this))};Ol.prototype.syncConditionalRevealWithInputState=function(a){var u=a.getAttribute("aria-controls");if(u){var p=document.getElementById(u);if(p&&p.classList.contains("govuk-radios__conditional")){var _=a.checked;a.setAttribute("aria-expanded",_.toString()),p.classList.toggle("govuk-radios__conditional--hidden",!_)}}};Ol.prototype.handleClick=function(a){var u=this,p=a.target;if(!(!(p instanceof HTMLInputElement)||p.type!=="radio")){var _=document.querySelectorAll('input[type="radio"][aria-controls]'),w=p.form,T=p.name;fi(_,function(M){var o=M.form===w,z=M.name===T;z&&o&&u.syncConditionalRevealWithInputState(M)})}};function Ma(a){if(!(a instanceof HTMLAnchorElement))return this;this.$module=a,this.$linkedElement=null,this.linkedElementListener=!1}Ma.prototype.init=function(){if(this.$module){var a=this.getLinkedElement();a&&(this.$linkedElement=a,this.$module.addEventListener("click",this.focusLinkedElement.bind(this)))}};Ma.prototype.getLinkedElement=function(){var a=this.getFragmentFromUrl();return a?document.getElementById(a):null};Ma.prototype.focusLinkedElement=function(){var a=this.$linkedElement;a.getAttribute("tabindex")||(a.setAttribute("tabindex","-1"),a.classList.add("govuk-skip-link-focused-element"),this.linkedElementListener||(this.$linkedElement.addEventListener("blur",this.removeFocusProperties.bind(this)),this.linkedElementListener=!0)),a.focus()};Ma.prototype.removeFocusProperties=function(){this.$linkedElement.removeAttribute("tabindex"),this.$linkedElement.classList.remove("govuk-skip-link-focused-element")};Ma.prototype.getFragmentFromUrl=function(){if(this.$module.hash)return this.$module.hash.split("#").pop()};(function(a){var u="document"in this&&"nextElementSibling"in document.documentElement;u||Object.defineProperty(Element.prototype,"nextElementSibling",{get:function(){for(var p=this.nextSibling;p&&p.nodeType!==1;)p=p.nextSibling;return p}})}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});(function(a){var u="document"in this&&"previousElementSibling"in document.documentElement;u||Object.defineProperty(Element.prototype,"previousElementSibling",{get:function(){for(var p=this.previousSibling;p&&p.nodeType!==1;)p=p.previousSibling;return p}})}).call(typeof window=="object"&&window||typeof self=="object"&&self||typeof global=="object"&&global||{});function si(a){if(!(a instanceof HTMLElement))return this;var u=a.querySelectorAll("a.govuk-tabs__tab");if(!u.length)return this;this.$module=a,this.$tabs=u,this.keys={left:37,right:39,up:38,down:40},this.jsHiddenClass="govuk-tabs__panel--hidden",this.boundTabClick=this.onTabClick.bind(this),this.boundTabKeydown=this.onTabKeydown.bind(this),this.boundOnHashChange=this.onHashChange.bind(this),this.changingHash=!1}si.prototype.init=function(){!this.$module||!this.$tabs||(typeof window.matchMedia=="function"?this.setupResponsiveChecks():this.setup())};si.prototype.setupResponsiveChecks=function(){this.mql=window.matchMedia("(min-width: 40.0625em)"),this.mql.addListener(this.checkMode.bind(this)),this.checkMode()};si.prototype.checkMode=function(){this.mql.matches?this.setup():this.teardown()};si.prototype.setup=function(){var a=this,u=this.$module,p=this.$tabs,_=u.querySelector(".govuk-tabs__list"),w=u.querySelectorAll(".govuk-tabs__list-item");if(!(!p||!_||!w)){_.setAttribute("role","tablist"),fi(w,function(M){M.setAttribute("role","presentation")}),fi(p,function(M){a.setAttributes(M),M.addEventListener("click",a.boundTabClick,!0),M.addEventListener("keydown",a.boundTabKeydown,!0),a.hideTab(M)});var T=this.getTab(window.location.hash)||this.$tabs[0];T&&(this.showTab(T),window.addEventListener("hashchange",this.boundOnHashChange,!0))}};si.prototype.teardown=function(){var a=this,u=this.$module,p=this.$tabs,_=u.querySelector(".govuk-tabs__list"),w=u.querySelectorAll("a.govuk-tabs__list-item");!p||!_||!w||(_.removeAttribute("role"),fi(w,function(T){T.removeAttribute("role")}),fi(p,function(T){T.removeEventListener("click",a.boundTabClick,!0),T.removeEventListener("keydown",a.boundTabKeydown,!0),a.unsetAttributes(T)}),window.removeEventListener("hashchange",this.boundOnHashChange,!0))};si.prototype.onHashChange=function(){var a=window.location.hash,u=this.getTab(a);if(u){if(this.changingHash){this.changingHash=!1;return}var p=this.getCurrentTab();p&&(this.hideTab(p),this.showTab(u),u.focus())}};si.prototype.hideTab=function(a){this.unhighlightTab(a),this.hidePanel(a)};si.prototype.showTab=function(a){this.highlightTab(a),this.showPanel(a)};si.prototype.getTab=function(a){return this.$module.querySelector('a.govuk-tabs__tab[href="'+a+'"]')};si.prototype.setAttributes=function(a){var u=this.getHref(a).slice(1);a.setAttribute("id","tab_"+u),a.setAttribute("role","tab"),a.setAttribute("aria-controls",u),a.setAttribute("aria-selected","false"),a.setAttribute("tabindex","-1");var p=this.getPanel(a);p&&(p.setAttribute("role","tabpanel"),p.setAttribute("aria-labelledby",a.id),p.classList.add(this.jsHiddenClass))};si.prototype.unsetAttributes=function(a){a.removeAttribute("id"),a.removeAttribute("role"),a.removeAttribute("aria-controls"),a.removeAttribute("aria-selected"),a.removeAttribute("tabindex");var u=this.getPanel(a);u&&(u.removeAttribute("role"),u.removeAttribute("aria-labelledby"),u.classList.remove(this.jsHiddenClass))};si.prototype.onTabClick=function(a){var u=this.getCurrentTab(),p=a.currentTarget;!u||!(p instanceof HTMLAnchorElement)||(a.preventDefault(),this.hideTab(u),this.showTab(p),this.createHistoryEntry(p))};si.prototype.createHistoryEntry=function(a){var u=this.getPanel(a);if(u){var p=u.id;u.id="",this.changingHash=!0,window.location.hash=this.getHref(a).slice(1),u.id=p}};si.prototype.onTabKeydown=function(a){switch(a.keyCode){case this.keys.left:case this.keys.up:this.activatePreviousTab(),a.preventDefault();break;case this.keys.right:case this.keys.down:this.activateNextTab(),a.preventDefault();break}};si.prototype.activateNextTab=function(){var a=this.getCurrentTab();if(!(!a||!a.parentElement)){var u=a.parentElement.nextElementSibling;if(u){var p=u.querySelector("a.govuk-tabs__tab");p&&(this.hideTab(a),this.showTab(p),p.focus(),this.createHistoryEntry(p))}}};si.prototype.activatePreviousTab=function(){var a=this.getCurrentTab();if(!(!a||!a.parentElement)){var u=a.parentElement.previousElementSibling;if(u){var p=u.querySelector("a.govuk-tabs__tab");p&&(this.hideTab(a),this.showTab(p),p.focus(),this.createHistoryEntry(p))}}};si.prototype.getPanel=function(a){return this.$module.querySelector(this.getHref(a))};si.prototype.showPanel=function(a){var u=this.getPanel(a);u&&u.classList.remove(this.jsHiddenClass)};si.prototype.hidePanel=function(a){var u=this.getPanel(a);u&&u.classList.add(this.jsHiddenClass)};si.prototype.unhighlightTab=function(a){a.parentElement&&(a.setAttribute("aria-selected","false"),a.parentElement.classList.remove("govuk-tabs__list-item--selected"),a.setAttribute("tabindex","-1"))};si.prototype.highlightTab=function(a){a.parentElement&&(a.setAttribute("aria-selected","true"),a.parentElement.classList.add("govuk-tabs__list-item--selected"),a.setAttribute("tabindex","0"))};si.prototype.getCurrentTab=function(){return this.$module.querySelector(".govuk-tabs__list-item--selected a.govuk-tabs__tab")};si.prototype.getHref=function(a){var u=a.getAttribute("href"),p=u.slice(u.indexOf("#"),u.length);return p};function n0(a){a=typeof a<"u"?a:{};var u=a.scope instanceof HTMLElement?a.scope:document,p=u.querySelectorAll('[data-module="govuk-accordion"]');fi(p,function(he){new Ar(he,a.accordion).init()});var _=u.querySelectorAll('[data-module="govuk-button"]');fi(_,function(he){new eu(he,a.button).init()});var w=u.querySelectorAll('[data-module="govuk-character-count"]');fi(w,function(he){new Fr(he,a.characterCount).init()});var T=u.querySelectorAll('[data-module="govuk-checkboxes"]');fi(T,function(he){new yo(he).init()});var M=u.querySelectorAll('[data-module="govuk-details"]');fi(M,function(he){new Fl(he).init()});var o=u.querySelector('[data-module="govuk-error-summary"]');o&&new vo(o,a.errorSummary).init();var z=u.querySelectorAll('[data-module="govuk-exit-this-page"]');fi(z,function(he){new dn(he,a.exitThisPage).init()});var A=u.querySelector('[data-module="govuk-header"]');A&&new tu(A).init();var G=u.querySelectorAll('[data-module="govuk-notification-banner"]');fi(G,function(he){new zh(he,a.notificationBanner).init()});var j=u.querySelectorAll('[data-module="govuk-radios"]');fi(j,function(he){new Ol(he).init()});var fe=u.querySelector('[data-module="govuk-skip-link"]');fe&&new Ma(fe).init();var ge=u.querySelectorAll('[data-module="govuk-tabs"]');fi(ge,function(he){new si(he).init()})}function Bp(a){let u,p,_,w;return{c(){u=Ci("div"),p=Ci("span"),p.textContent="Error:",_=Yr(),w=Rs(a[0]),Ft(p,"class","govuk-visually-hidden"),Ft(u,"class","govuk-error-message")},m(T,M){Ii(T,u,M),mi(u,p),mi(u,_),mi(u,w)},p(T,M){M&1&&zl(w,T[0])},d(T){T&&ni(u)}}}function O_(a){let u,p=a[0]&&Bp(a);return{c(){p&&p.c(),u=Jc()},m(_,w){p&&p.m(_,w),Ii(_,u,w)},p(_,[w]){_[0]?p?p.p(_,w):(p=Bp(_),p.c(),p.m(u.parentNode,u)):p&&(p.d(1),p=null)},i:Wi,o:Wi,d(_){_&&ni(u),p&&p.d(_)}}}function U_(a,u,p){let{errorMessage:_}=u;return a.$$set=w=>{"errorMessage"in w&&p(0,_=w.errorMessage)},[_]}class V_ extends Qr{constructor(u){super(),Jr(this,u,U_,O_,Rr,{errorMessage:0})}}function N_(a){let u,p,_,w,T;const M=a[3].default,o=Ta(M,a,a[2],null);return{c(){u=Ci("div"),p=Ci("label"),_=Rs(a[0]),w=Yr(),o&&o.c(),Ft(p,"class","govuk-label"),Ft(p,"for",a[1]),Ft(u,"class","govuk-form-group")},m(z,A){Ii(z,u,A),mi(u,p),mi(p,_),mi(u,w),o&&o.m(u,null),T=!0},p(z,[A]){(!T||A&1)&&zl(_,z[0]),(!T||A&2)&&Ft(p,"for",z[1]),o&&o.p&&(!T||A&4)&&Ca(o,M,z,z[2],T?Sa(M,z[2],A,null):Ia(z[2]),null)},i(z){T||(At(o,z),T=!0)},o(z){jt(o,z),T=!1},d(z){z&&ni(u),o&&o.d(z)}}}function j_(a,u,p){let{$$slots:_={},$$scope:w}=u,{label:T}=u,{id:M}=u;return a.$$set=o=>{"label"in o&&p(0,T=o.label),"id"in o&&p(1,M=o.id),"$$scope"in o&&p(2,w=o.$$scope)},[T,M,w,_]}class s0 extends Qr{constructor(u){super(),Jr(this,u,j_,N_,Rr,{label:0,id:1})}}function Rp(a,u,p){const _=a.slice();return _[8]=u[p][0],_[9]=u[p][1],_}function Fp(a){let u,p,_,w,T=!1,M,o,z=a[9]+"",A,G,j,fe,ge,he;return fe=d_(a[7][0]),{c(){u=Ci("div"),p=Ci("input"),M=Yr(),o=Ci("label"),A=Rs(z),j=Yr(),Ft(p,"class","govuk-radios__input"),Ft(p,"id",_=a[2]+a[8]),Ft(p,"type","radio"),p.__value=w=a[8],Ap(p,p.__value),Ft(o,"class","govuk-label govuk-radios__label"),Ft(o,"for",G=a[2]+a[8]),Ft(u,"class","govuk-radios__item"),fe.p(p)},m(Ce,De){Ii(Ce,u,De),mi(u,p),p.checked=p.__value===a[0],mi(u,M),mi(u,o),mi(o,A),mi(u,j),ge||(he=[Pl(p,"change",a[6]),Pl(p,"change",a[5])],ge=!0)},p(Ce,De){De&12&&_!==(_=Ce[2]+Ce[8])&&Ft(p,"id",_),De&8&&w!==(w=Ce[8])&&(p.__value=w,Ap(p,p.__value),T=!0),(T||De&9)&&(p.checked=p.__value===Ce[0]),De&8&&z!==(z=Ce[9]+"")&&zl(A,z),De&12&&G!==(G=Ce[2]+Ce[8])&&Ft(o,"for",G)},d(Ce){Ce&&ni(u),fe.r(),ge=!1,fs(he)}}}function q_(a){let u,p,_,w,T,M,o=Lp(a[3]),z=[];for(let A=0;A<o.length;A+=1)z[A]=Fp(Rp(a,o,A));return{c(){u=Ci("div"),p=Ci("fieldset"),_=Ci("legend"),w=Rs(a[1]),T=Yr(),M=Ci("div");for(let A=0;A<z.length;A+=1)z[A].c();Ft(_,"class","govuk-fieldset__legend"),Ft(M,"class","govuk-radios"),Ft(M,"data-module","govuk-radios"),Vn(M,"govuk-radios--inline",a[4]),Vn(M,"govuk-radios--small",a[4]),Ft(p,"class","govuk-fieldset"),Ft(u,"class","govuk-form-group")},m(A,G){Ii(A,u,G),mi(u,p),mi(p,_),mi(_,w),mi(p,T),mi(p,M);for(let j=0;j<z.length;j+=1)z[j]&&z[j].m(M,null)},p(A,[G]){if(G&2&&zl(w,A[1]),G&13){o=Lp(A[3]);let j;for(j=0;j<o.length;j+=1){const fe=Rp(A,o,j);z[j]?z[j].p(fe,G):(z[j]=Fp(fe),z[j].c(),z[j].m(M,null))}for(;j<z.length;j+=1)z[j].d(1);z.length=o.length}G&16&&Vn(M,"govuk-radios--inline",A[4]),G&16&&Vn(M,"govuk-radios--small",A[4])},i:Wi,o:Wi,d(A){A&&ni(u),l_(z,A)}}}function Z_(a,u,p){let{legend:_}=u,{id:w}=u,{choices:T}=u,{inlineSmall:M=!1}=u,{value:o}=u;const z=[[]];function A(j){df.call(this,a,j)}function G(){o=this.__value,p(0,o)}return a.$$set=j=>{"legend"in j&&p(1,_=j.legend),"id"in j&&p(2,w=j.id),"choices"in j&&p(3,T=j.choices),"inlineSmall"in j&&p(4,M=j.inlineSmall),"value"in j&&p(0,o=j.value)},[o,_,w,T,M,A,G,z]}class o0 extends Qr{constructor(u){super(),Jr(this,u,Z_,q_,Rr,{legend:1,id:2,choices:3,inlineSmall:4,value:0})}}function $_(a){let u,p,_,w;const T=a[2].default,M=Ta(T,a,a[1],null);let o=[{type:"button"},{class:"govuk-button govuk-button--secondary"},{"data-module":"govuk-button"},a[0]],z={};for(let A=0;A<o.length;A+=1)z=qc(z,o[A]);return{c(){u=Ci("button"),M&&M.c(),Ip(u,z)},m(A,G){Ii(A,u,G),M&&M.m(u,null),u.autofocus&&u.focus(),p=!0,_||(w=Pl(u,"click",a[3]),_=!0)},p(A,[G]){M&&M.p&&(!p||G&2)&&Ca(M,T,A,A[1],p?Sa(T,A[1],G,null):Ia(A[1]),null),Ip(u,z=S_(o,[{type:"button"},{class:"govuk-button govuk-button--secondary"},{"data-module":"govuk-button"},G&1&&A[0]]))},i(A){p||(At(M,A),p=!0)},o(A){jt(M,A),p=!1},d(A){A&&ni(u),M&&M.d(A),_=!1,w()}}}function G_(a,u,p){let{$$slots:_={},$$scope:w}=u;function T(M){df.call(this,a,M)}return a.$$set=M=>{p(0,u=qc(qc({},u),Tp(M))),"$$scope"in M&&p(1,w=M.$$scope)},u=Tp(u),[u,w,_,T]}class H_ extends Qr{constructor(u){super(),Jr(this,u,G_,$_,Rr,{})}}const W_="/atip/geocoder_with_lib/assets/authorities-80e824dc.geojson";var hr=63710088e-1,Dh={centimeters:hr*100,centimetres:hr*100,degrees:hr/111325,feet:hr*3.28084,inches:hr*39.37,kilometers:hr/1e3,kilometres:hr/1e3,meters:hr,metres:hr,miles:hr/1609.344,millimeters:hr*1e3,millimetres:hr*1e3,nauticalmiles:hr/1852,radians:1,yards:hr*1.0936},X_={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/hr,yards:1.0936133},Sh={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function qn(a,u,p){p===void 0&&(p={});var _={type:"Feature"};return(p.id===0||p.id)&&(_.id=p.id),p.bbox&&(_.bbox=p.bbox),_.properties=u||{},_.geometry=a,_}function K_(a,u,p){switch(a){case"Point":return us(u).geometry;case"LineString":return ps(u).geometry;case"Polygon":return Bh(u).geometry;case"MultiPoint":return _f(u).geometry;case"MultiLineString":return gf(u).geometry;case"MultiPolygon":return yf(u).geometry;default:throw new Error(a+" is invalid")}}function us(a,u,p){if(p===void 0&&(p={}),!a)throw new Error("coordinates is required");if(!Array.isArray(a))throw new Error("coordinates must be an Array");if(a.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Wc(a[0])||!Wc(a[1]))throw new Error("coordinates must contain numbers");var _={type:"Point",coordinates:a};return qn(_,u,p)}function Y_(a,u,p){return p===void 0&&(p={}),iu(a.map(function(_){return us(_,u)}),p)}function Bh(a,u,p){p===void 0&&(p={});for(var _=0,w=a;_<w.length;_++){var T=w[_];if(T.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var M=0;M<T[T.length-1].length;M++)if(T[T.length-1][M]!==T[0][M])throw new Error("First and last Position are not equivalent.")}var o={type:"Polygon",coordinates:a};return qn(o,u,p)}function J_(a,u,p){return p===void 0&&(p={}),iu(a.map(function(_){return Bh(_,u)}),p)}function ps(a,u,p){if(p===void 0&&(p={}),a.length<2)throw new Error("coordinates must be an array of two or more positions");var _={type:"LineString",coordinates:a};return qn(_,u,p)}function Q_(a,u,p){return p===void 0&&(p={}),iu(a.map(function(_){return ps(_,u)}),p)}function iu(a,u){u===void 0&&(u={});var p={type:"FeatureCollection"};return u.id&&(p.id=u.id),u.bbox&&(p.bbox=u.bbox),p.features=a,p}function gf(a,u,p){p===void 0&&(p={});var _={type:"MultiLineString",coordinates:a};return qn(_,u,p)}function _f(a,u,p){p===void 0&&(p={});var _={type:"MultiPoint",coordinates:a};return qn(_,u,p)}function yf(a,u,p){p===void 0&&(p={});var _={type:"MultiPolygon",coordinates:a};return qn(_,u,p)}function ey(a,u,p){p===void 0&&(p={});var _={type:"GeometryCollection",geometries:a};return qn(_,u,p)}function ty(a,u){if(u===void 0&&(u=0),u&&!(u>=0))throw new Error("precision must be a positive number");var p=Math.pow(10,u||0);return Math.round(a*p)/p}function vf(a,u){u===void 0&&(u="kilometers");var p=Dh[u];if(!p)throw new Error(u+" units is invalid");return a*p}function Rh(a,u){u===void 0&&(u="kilometers");var p=Dh[u];if(!p)throw new Error(u+" units is invalid");return a/p}function iy(a,u){return xf(Rh(a,u))}function ry(a){var u=a%360;return u<0&&(u+=360),u}function xf(a){var u=a%(2*Math.PI);return u*180/Math.PI}function ny(a){var u=a%360;return u*Math.PI/180}function sy(a,u,p){if(u===void 0&&(u="kilometers"),p===void 0&&(p="kilometers"),!(a>=0))throw new Error("length must be a positive number");return vf(Rh(a,u),p)}function oy(a,u,p){if(u===void 0&&(u="meters"),p===void 0&&(p="kilometers"),!(a>=0))throw new Error("area must be a positive number");var _=Sh[u];if(!_)throw new Error("invalid original units");var w=Sh[p];if(!w)throw new Error("invalid final units");return a/_*w}function Wc(a){return!isNaN(a)&&a!==null&&!Array.isArray(a)}function Fh(a){return!!a&&a.constructor===Object}function ay(a){if(!a)throw new Error("bbox is required");if(!Array.isArray(a))throw new Error("bbox must be an Array");if(a.length!==4&&a.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");a.forEach(function(u){if(!Wc(u))throw new Error("bbox must only contain numbers")})}function ly(a){if(!a)throw new Error("id is required");if(["string","number"].indexOf(typeof a)===-1)throw new Error("id must be a number or a string")}const a0=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Sh,bearingToAzimuth:ry,convertArea:oy,convertLength:sy,degreesToRadians:ny,earthRadius:hr,factors:Dh,feature:qn,featureCollection:iu,geometry:K_,geometryCollection:ey,isNumber:Wc,isObject:Fh,lengthToDegrees:iy,lengthToRadians:Rh,lineString:ps,lineStrings:Q_,multiLineString:gf,multiPoint:_f,multiPolygon:yf,point:us,points:Y_,polygon:Bh,polygons:J_,radiansToDegrees:xf,radiansToLength:vf,round:ty,unitsFactors:X_,validateBBox:ay,validateId:ly},Symbol.toStringTag,{value:"Module"}));function Pa(a,u,p){if(a!==null)for(var _,w,T,M,o,z,A,G=0,j=0,fe,ge=a.type,he=ge==="FeatureCollection",Ce=ge==="Feature",De=he?a.features.length:1,Se=0;Se<De;Se++){A=he?a.features[Se].geometry:Ce?a.geometry:a,fe=A?A.type==="GeometryCollection":!1,o=fe?A.geometries.length:1;for(var Ne=0;Ne<o;Ne++){var Ue=0,lt=0;if(M=fe?A.geometries[Ne]:A,M!==null){z=M.coordinates;var pt=M.type;switch(G=p&&(pt==="Polygon"||pt==="MultiPolygon")?1:0,pt){case null:break;case"Point":if(u(z,j,Se,Ue,lt)===!1)return!1;j++,Ue++;break;case"LineString":case"MultiPoint":for(_=0;_<z.length;_++){if(u(z[_],j,Se,Ue,lt)===!1)return!1;j++,pt==="MultiPoint"&&Ue++}pt==="LineString"&&Ue++;break;case"Polygon":case"MultiLineString":for(_=0;_<z.length;_++){for(w=0;w<z[_].length-G;w++){if(u(z[_][w],j,Se,Ue,lt)===!1)return!1;j++}pt==="MultiLineString"&&Ue++,pt==="Polygon"&&lt++}pt==="Polygon"&&Ue++;break;case"MultiPolygon":for(_=0;_<z.length;_++){for(lt=0,w=0;w<z[_].length;w++){for(T=0;T<z[_][w].length-G;T++){if(u(z[_][w][T],j,Se,Ue,lt)===!1)return!1;j++}lt++}Ue++}break;case"GeometryCollection":for(_=0;_<M.geometries.length;_++)if(Pa(M.geometries[_],u,p)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function cy(a,u,p,_){var w=p;return Pa(a,function(T,M,o,z,A){M===0&&p===void 0?w=T:w=u(w,T,M,o,z,A)},_),w}function bf(a,u){var p;switch(a.type){case"FeatureCollection":for(p=0;p<a.features.length&&u(a.features[p].properties,p)!==!1;p++);break;case"Feature":u(a.properties,0);break}}function uy(a,u,p){var _=p;return bf(a,function(w,T){T===0&&p===void 0?_=w:_=u(_,w,T)}),_}function wf(a,u){if(a.type==="Feature")u(a,0);else if(a.type==="FeatureCollection")for(var p=0;p<a.features.length&&u(a.features[p],p)!==!1;p++);}function hy(a,u,p){var _=p;return wf(a,function(w,T){T===0&&p===void 0?_=w:_=u(_,w,T)}),_}function dy(a){var u=[];return Pa(a,function(p){u.push(p)}),u}function Oh(a,u){var p,_,w,T,M,o,z,A,G,j,fe=0,ge=a.type==="FeatureCollection",he=a.type==="Feature",Ce=ge?a.features.length:1;for(p=0;p<Ce;p++){for(o=ge?a.features[p].geometry:he?a.geometry:a,A=ge?a.features[p].properties:he?a.properties:{},G=ge?a.features[p].bbox:he?a.bbox:void 0,j=ge?a.features[p].id:he?a.id:void 0,z=o?o.type==="GeometryCollection":!1,M=z?o.geometries.length:1,w=0;w<M;w++){if(T=z?o.geometries[w]:o,T===null){if(u(null,fe,A,G,j)===!1)return!1;continue}switch(T.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(u(T,fe,A,G,j)===!1)return!1;break}case"GeometryCollection":{for(_=0;_<T.geometries.length;_++)if(u(T.geometries[_],fe,A,G,j)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}fe++}}function py(a,u,p){var _=p;return Oh(a,function(w,T,M,o,z){T===0&&p===void 0?_=w:_=u(_,w,T,M,o,z)}),_}function ru(a,u){Oh(a,function(p,_,w,T,M){var o=p===null?null:p.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return u(qn(p,w,{bbox:T,id:M}),_,0)===!1?!1:void 0}var z;switch(o){case"MultiPoint":z="Point";break;case"MultiLineString":z="LineString";break;case"MultiPolygon":z="Polygon";break}for(var A=0;A<p.coordinates.length;A++){var G=p.coordinates[A],j={type:z,coordinates:G};if(u(qn(j,w),_,A)===!1)return!1}})}function fy(a,u,p){var _=p;return ru(a,function(w,T,M){T===0&&M===0&&p===void 0?_=w:_=u(_,w,T,M)}),_}function Ef(a,u){ru(a,function(p,_,w){var T=0;if(p.geometry){var M=p.geometry.type;if(!(M==="Point"||M==="MultiPoint")){var o,z=0,A=0,G=0;if(Pa(p,function(j,fe,ge,he,Ce){if(o===void 0||_>z||he>A||Ce>G){o=j,z=_,A=he,G=Ce,T=0;return}var De=ps([o,j],p.properties);if(u(De,_,w,Ce,T)===!1)return!1;T++,o=j})===!1)return!1}}})}function my(a,u,p){var _=p,w=!1;return Ef(a,function(T,M,o,z,A){w===!1&&p===void 0?_=T:_=u(_,T,M,o,z,A),w=!0}),_}function Tf(a,u){if(!a)throw new Error("geojson is required");ru(a,function(p,_,w){if(p.geometry!==null){var T=p.geometry.type,M=p.geometry.coordinates;switch(T){case"LineString":if(u(p,_,w,0,0)===!1)return!1;break;case"Polygon":for(var o=0;o<M.length;o++)if(u(ps(M[o],p.properties),_,w,o)===!1)return!1;break}}})}function gy(a,u,p){var _=p;return Tf(a,function(w,T,M,o){T===0&&p===void 0?_=w:_=u(_,w,T,M,o)}),_}function _y(a,u){if(u=u||{},!Fh(u))throw new Error("options is invalid");var p=u.featureIndex||0,_=u.multiFeatureIndex||0,w=u.geometryIndex||0,T=u.segmentIndex||0,M=u.properties,o;switch(a.type){case"FeatureCollection":p<0&&(p=a.features.length+p),M=M||a.features[p].properties,o=a.features[p].geometry;break;case"Feature":M=M||a.properties,o=a.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":o=a;break;default:throw new Error("geojson is invalid")}if(o===null)return null;var z=o.coordinates;switch(o.type){case"Point":case"MultiPoint":return null;case"LineString":return T<0&&(T=z.length+T-1),ps([z[T],z[T+1]],M,u);case"Polygon":return w<0&&(w=z.length+w),T<0&&(T=z[w].length+T-1),ps([z[w][T],z[w][T+1]],M,u);case"MultiLineString":return _<0&&(_=z.length+_),T<0&&(T=z[_].length+T-1),ps([z[_][T],z[_][T+1]],M,u);case"MultiPolygon":return _<0&&(_=z.length+_),w<0&&(w=z[_].length+w),T<0&&(T=z[_][w].length-T-1),ps([z[_][w][T],z[_][w][T+1]],M,u)}throw new Error("geojson is invalid")}function yy(a,u){if(u=u||{},!Fh(u))throw new Error("options is invalid");var p=u.featureIndex||0,_=u.multiFeatureIndex||0,w=u.geometryIndex||0,T=u.coordIndex||0,M=u.properties,o;switch(a.type){case"FeatureCollection":p<0&&(p=a.features.length+p),M=M||a.features[p].properties,o=a.features[p].geometry;break;case"Feature":M=M||a.properties,o=a.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":o=a;break;default:throw new Error("geojson is invalid")}if(o===null)return null;var z=o.coordinates;switch(o.type){case"Point":return us(z,M,u);case"MultiPoint":return _<0&&(_=z.length+_),us(z[_],M,u);case"LineString":return T<0&&(T=z.length+T),us(z[T],M,u);case"Polygon":return w<0&&(w=z.length+w),T<0&&(T=z[w].length+T),us(z[w][T],M,u);case"MultiLineString":return _<0&&(_=z.length+_),T<0&&(T=z[_].length+T),us(z[_][T],M,u);case"MultiPolygon":return _<0&&(_=z.length+_),w<0&&(w=z[_].length+w),T<0&&(T=z[_][w].length-T),us(z[_][w][T],M,u)}throw new Error("geojson is invalid")}const l0=Object.freeze(Object.defineProperty({__proto__:null,coordAll:dy,coordEach:Pa,coordReduce:cy,featureEach:wf,featureReduce:hy,findPoint:yy,findSegment:_y,flattenEach:ru,flattenReduce:fy,geomEach:Oh,geomReduce:py,lineEach:Tf,lineReduce:gy,propEach:bf,propReduce:uy,segmentEach:Ef,segmentReduce:my},Symbol.toStringTag,{value:"Module"}));function Xc(a){var u=[1/0,1/0,-1/0,-1/0];return Pa(a,function(p){u[0]>p[0]&&(u[0]=p[0]),u[1]>p[1]&&(u[1]=p[1]),u[2]<p[0]&&(u[2]=p[0]),u[3]<p[1]&&(u[3]=p[1])}),u}Xc.default=Xc;const c0=Object.freeze(Object.defineProperty({__proto__:null,default:Xc},Symbol.toStringTag,{value:"Module"})),fa=[];function vh(a,u){return{subscribe:Si(a,u).subscribe}}function Si(a,u=Wi){let p;const _=new Set;function w(o){if(Rr(a,o)&&(a=o,p)){const z=!fa.length;for(const A of _)A[1](),fa.push(A,a);if(z){for(let A=0;A<fa.length;A+=2)fa[A][0](fa[A+1]);fa.length=0}}}function T(o){w(o(a))}function M(o,z=Wi){const A=[o,z];return _.add(A),_.size===1&&(p=u(w,T)||Wi),o(a),()=>{_.delete(A),_.size===0&&p&&(p(),p=null)}}return{set:w,update:T,subscribe:M}}function vy(a){return a=="google"||a=="bing"}const Uh=Si(null),u0=Si("dataviz"),h0=Si(null),xy=Si(Ay()),by=Si(null),wy=Si(null),Ey=Si(null),Ty=Si(null),Sy=Si(Cy());Sy.subscribe(a=>window.localStorage.setItem("userSettings",JSON.stringify(a)));const d0=Si("edit-attribute"),p0=Si(!1),f0=Si(!0);function m0(a){let u=new Set;for(let _ of a.features)u.add(_.id);let p=u.size+1;for(;u.has(p);)p++;return p}function g0(a){console.log(`Deleting intervention ${a}`),xy.update(u=>(u.features=u.features.filter(p=>p.id!=a),u)),by.set(null),wy.set(null),Ey.set(null),Ty.set(null)}function Cy(){let a={streetViewImagery:"google",avoidDoublingBack:!1};try{let u=JSON.parse(window.localStorage.getItem("userSettings")||"{}");vy(u.streetViewImagery)&&(a.streetViewImagery=u.streetViewImagery),typeof u.avoidDoublingBack=="boolean"&&(a.avoidDoublingBack=u.avoidDoublingBack)}catch(u){console.log(`Couldn't parse userSettings from local storage: ${u}`)}return a}function _0(a){return{id:a,beforeId:Sf(a)}}function Sf(a){let u=of(Uh);if(!u){console.warn(`getBeforeId(${a}) called before map is ready. Z-ordering may be incorrect.`);return}let p,_=!1;for(let w=Op.length-1;w>=0;w--){let T=Op[w];if(T==a){_=!0;break}u.getLayer(T)&&(p=T)}if(!_)throw new Error(`Layer ID ${a} not defined in layerZorder`);return p}const Op=["parliamentary_constituencies","parliamentary_constituencies-outline","wards","wards-outline","combined_authorities","combined_authorities-outline","local_authority_districts","local_authority_districts-outline","local_planning_authorities","local_planning_authorities-outline","census_output_areas","census_output_areas-outline","imd","imd-outline","mrn","bus_routes","cycle_paths","pct_commute","pct_school","road_widths","road_speeds","schools","hospitals","sports_spaces","railway_stations","cycle_parking","crossings","vehicle_counts","interventions-polygons","interventions-polygons-outlines","hover-polygons","hover-lines","interventions-lines","interventions-lines-endpoints","hover-points","interventions-points","criticals-clusters","criticals-counts","criticals-points","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices","draw-split-route","draw-street-view","route-points","route-lines","route-polygons","road_label","Road labels","boundary","measurement-line"],Up="#000000",Vh=!0,Cf=1,y0=["==","$type","Polygon"],v0=["==","$type","LineString"],x0=["==","$type","Point"];function b0(a,u,p){Iy(a,u),a.addSource(u,{type:"geojson",data:p})}function Iy(a,u){if(a.getSource(u)){let p=[];for(let _ of a.getStyle().layers)"source"in _&&_.source==u&&p.push(_.id);for(let _ of p)a.removeLayer(_);a.removeSource(u)}}function Nh(a,u){a.getLayer(u.id)&&a.removeLayer(u.id);let p=Sf(u.id);a.addLayer(u,p)}function w0(a,u){let p={id:u.id,source:u.source,filter:u.filter??Vh,type:"fill",paint:{"fill-color":u.color,"fill-opacity":u.opacity}};u.sourceLayer&&(p["source-layer"]=u.sourceLayer),Nh(a,p)}function E0(a,u){let p={id:u.id,source:u.source,filter:u.filter??Vh,type:"circle",paint:{"circle-radius":u.radius,"circle-color":u.color??Up,"circle-opacity":u.opacity??Cf,"circle-stroke-color":u.strokeColor??Up,"circle-stroke-width":u.strokeWidth??0}};u.sourceLayer&&(p["source-layer"]=u.sourceLayer),Nh(a,p)}function T0(a,u){let p={id:u.id,source:u.source,filter:u.filter??Vh,type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":u.color,"line-width":u.width,"line-opacity":u.opacity??Cf}};u.sourceLayer&&(p["source-layer"]=u.sourceLayer),Nh(a,p)}function Ay(){return{type:"FeatureCollection",features:[]}}function S0(a){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:ky(a)}}}function ky(a){return[Math.round(a[0]*1e7)/1e7,Math.round(a[1]*1e7)/1e7]}function C0(a,u,p){let _=["match",a];for(let[w,T]of Object.entries(u))_.push(w),_.push(T);return _.push(p),_}function I0(a,u,p){let _=["step",a];for(let w=1;w<u.length;w++)_.push(p[w-1]),_.push(u[w]);return _.push(p[p.length-1]),_}function A0(a){return Xc(a)}function k0(a){return a<1e3?Math.round(a)+" m":(a/1e3).toFixed(1)+"km"}function M0(){let a=[];return sm()=="Private (development)"&&(a=a.concat([["Road","OS Road"],["Light","OS Light"],["Outdoor","OS Outdoor"],["bluesky","Bluesky Satellite (12.5cm)"]])),a.concat([["streets","MapTiler Streets"],["hybrid","MapTiler Satellite"],["dataviz","MapTiler Dataviz"]])}async function Vp(a){if(a=="streets"||a=="hybrid"||a=="dataviz")return`https://api.maptiler.com/maps/${a}/style.json?key=MZEJTanw3WpxRvt7qDfo`;let p=await(await fetch(`${$x()}/api_keys.json`)).json(),_,w;return a=="bluesky"?(_=`https://ogc.apps.midgard.airbusds-cint.com/apgb/wmts/rest/apgb:AP-12CM5-GB-LATEST/default/EPSG-3857/EPSG:3857:{z}/{y}/{x}?GUID=${p.bluesky}&format=image/png&TRANSPARENT=FALSE,`,w="Bluesky"):(_=`https://api.os.uk/maps/raster/v1/zxy/${a}_3857/{z}/{x}/{y}.png?key=${p.ordnance_survey}`,w="Contains OS data &copy; Crown copyright and database rights 2023"),{version:8,sources:{"raster-tiles":{type:"raster",tiles:[_],tileSize:256,attribution:w}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:"https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=MZEJTanw3WpxRvt7qDfo"}}function P0(a){let u=JSON.parse(JSON.stringify(a)),p=[];for(let _ of u.features)if(_.geometry.type=="LineString"&&!_.properties.hide_while_editing)for(let w of[_.geometry.coordinates[0],_.geometry.coordinates[_.geometry.coordinates.length-1]])p.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:w}});return u.features=u.features.concat(p),u}class My{constructor(u){Sn(this,"id");Sn(this,"defaultLayer");Sn(this,"changedProperties",[]);this.id=u.id,this.defaultLayer=JSON.parse(JSON.stringify(u))}setProperty(u,p,_){u.setPaintProperty(this.id,p,_),this.changedProperties.push(p)}returnToDefaultPaintValues(u){this.changedProperties.forEach(p=>{u.setPaintProperty(this.id,p,this.defaultLayer.paint[p])}),this.changedProperties=[]}}const Py=["Road network","Path"];function Ly(){let a=[];for(let u of["road","bridge","tunnel"])for(let p of["link","minor","minor_construction","motorway","motorway_construction","motorway_link","path_pedestrian","secondary_tertiary","secondary_tertiary_construction","service_track","service_track_construction","street","trunk_primary","trunk_primary_construction","trunk_primary_link"])a.push(`${u}_${p}`);return a}const zy=["Path","Road","Tunnel"],Dy=Py.concat(Ly(),zy);function L0(){return of(Uh).getStyle().layers.filter(a=>Dy.includes(a.id)).map(a=>new My(a))}function By(a){let u,p;const _=a[2].default,w=Ta(_,a,a[1],null);return{c(){u=Ci("a"),w&&w.c(),Ft(u,"href",a[0]),Ft(u,"target","_blank"),Ft(u,"rel","noreferrer")},m(T,M){Ii(T,u,M),w&&w.m(u,null),p=!0},p(T,[M]){w&&w.p&&(!p||M&2)&&Ca(w,_,T,T[1],p?Sa(_,T[1],M,null):Ia(T[1]),null),(!p||M&1)&&Ft(u,"href",T[0])},i(T){p||(At(w,T),p=!0)},o(T){jt(w,T),p=!1},d(T){T&&ni(u),w&&w.d(T)}}}function Ry(a,u,p){let{$$slots:_={},$$scope:w}=u,{href:T}=u;return a.$$set=M=>{"href"in M&&p(0,T=M.href),"$$scope"in M&&p(1,w=M.$$scope)},[T,w,_]}class z0 extends Qr{constructor(u){super(),Jr(this,u,Ry,By,Rr,{href:0})}}var _a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function If(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function D0(a){if(a.__esModule)return a;var u=a.default;if(typeof u=="function"){var p=function _(){if(this instanceof _){var w=[null];w.push.apply(w,arguments);var T=Function.bind.apply(u,w);return new T}return u.apply(this,arguments)};p.prototype=u.prototype}else p={};return Object.defineProperty(p,"__esModule",{value:!0}),Object.keys(a).forEach(function(_){var w=Object.getOwnPropertyDescriptor(a,_);Object.defineProperty(p,_,w.get?w:{enumerable:!0,get:function(){return a[_]}})}),p}var Af=Oy,Fy=Object.prototype.hasOwnProperty;function Oy(){for(var a={},u=0;u<arguments.length;u++){var p=arguments[u];for(var _ in p)Fy.call(p,_)&&(a[_]=p[_])}return a}var kf={exports:{}};(function(a,u){(function(){var p={};a.exports=p,p.simpleFilter=function(_,w){return w.filter(function(T){return p.test(_,T)})},p.test=function(_,w){return p.match(_,w)!==null},p.match=function(_,w,T){T=T||{};var M=0,o=[],z=w.length,A=0,G=0,j=T.pre||"",fe=T.post||"",ge=T.caseSensitive&&w||w.toLowerCase(),he;_=T.caseSensitive&&_||_.toLowerCase();for(var Ce=0;Ce<z;Ce++)he=w[Ce],ge[Ce]===_[M]?(he=j+he+fe,M+=1,G+=1+G):G=0,A+=G,o[o.length]=he;return M===_.length?(A=ge===_?1/0:A,{rendered:o.join(""),score:A}):null},p.filter=function(_,w,T){return!w||w.length===0?[]:typeof _!="string"?w:(T=T||{},w.reduce(function(M,o,z,A){var G=o;T.extract&&(G=T.extract(o));var j=p.match(_,G,T);return j!=null&&(M[M.length]={string:j.rendered,score:j.score,index:z,original:o}),M},[]).sort(function(M,o){var z=o.score-M.score;return z||M.index-o.index}))}})()})(kf);var Uy=kf.exports,Or=function(a){return this.component=a,this.items=[],this.active=a.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,a.el.parentNode.insertBefore(this.wrapper,a.el.nextSibling),this};Or.prototype.show=function(){this.element.style.display="block"};Or.prototype.hide=function(){this.element.style.display="none"};Or.prototype.add=function(a){this.items.push(a)};Or.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0};Or.prototype.isEmpty=function(){return!this.items.length};Or.prototype.isVisible=function(){return this.element.style.display==="block"};Or.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var a=0;a<this.items.length;a++)this.drawItem(this.items[a],this.active===a);this.show()};Or.prototype.drawItem=function(a,u){var p=document.createElement("li"),_=document.createElement("a");u&&(p.className+=" active"),_.innerHTML=a.string,p.appendChild(_),this.element.appendChild(p),p.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),p.addEventListener("mouseup",function(){this.handleMouseUp.call(this,a)}.bind(this))};Or.prototype.handleMouseUp=function(a){this.selectingListItem=!1,this.component.value(a.original),this.clear(),this.draw()};Or.prototype.move=function(a){this.active=a,this.draw()};Or.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)};Or.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)};Or.prototype.drawError=function(a){var u=document.createElement("li");u.innerHTML=a,this.element.appendChild(u),this.show()};var Vy=Or,Ny=Af,jy=Uy,qy=Vy,pr=function(a,u,p){return p=p||{},this.options=Ny({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},p),this.el=a,this.data=u||[],this.list=new qy(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(_){this.handleKeyUp(_.keyCode,_)}.bind(this),!1),this.el.addEventListener("keydown",function(_){this.handleKeyDown(_)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(_){this.handlePaste(_)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};pr.prototype.handleKeyUp=function(a,u){if(!(a===40||a===38||a===27||a===9)){if(a===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),u.stopPropagation());return}this.handleInputChange(this.el.value)}};pr.prototype.handleKeyDown=function(a){switch(a.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&a.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};pr.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};pr.prototype.handlePaste=function(a){if(a.clipboardData)this.handleInputChange(a.clipboardData.getData("Text"));else{var u=this;setTimeout(function(){u.handleInputChange(a.target.value)},100)}};pr.prototype.handleInputChange=function(a){if(this.query=this.normalize(a),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(u){for(var p=0;p<u.length&&(this.list.add(u[p]),p!==this.options.limit-1);p++);this.list.draw()}.bind(this))};pr.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};pr.prototype.update=function(a){this.data=a,this.handleKeyUp()};pr.prototype.clear=function(){this.data=[],this.list.clear()};pr.prototype.normalize=function(a){return a=a.toLowerCase(),a};pr.prototype.match=function(a,u){return a.indexOf(u)>-1};pr.prototype.value=function(a){if(this.selected=a,this.el.value=this.getItemValue(a||{place_name:this.query}),document.createEvent){var u=document.createEvent("HTMLEvents");u.initEvent("change",!0,!1),this.el.dispatchEvent(u)}else this.el.fireEvent("onchange")};pr.prototype.getCandidates=function(a){var u={pre:"<strong>",post:"</strong>",extract:function(_){return this.getItemValue(_)}.bind(this)},p;this.options.filter?(p=jy.filter(this.query,this.data,u),p=p.map(function(_){return{original:_.original,string:this.render(_.original,_.string)}}.bind(this))):p=this.data.map(function(_){var w=this.render(_);return{original:_,string:w}}.bind(this)),a(p)};pr.prototype.getItemValue=function(a){return a};pr.prototype.render=function(a,u){if(u)return u;for(var p=a.original?this.getItemValue(a.original):this.getItemValue(a),_=this.normalize(p),w=_.lastIndexOf(this.query);w>-1;){var T=w+this.query.length;p=p.slice(0,w)+"<strong>"+p.slice(w,T)+"</strong>"+p.slice(T),w=_.slice(0,w).lastIndexOf(this.query)}return p};pr.prototype.renderError=function(a){this.list.drawError(a)};var Zy=pr,Mf=Zy,$y=Mf;typeof window<"u"&&(window.Suggestions=Mf);var Gy="Expected a function",Np=0/0,Hy="[object Symbol]",Wy=/^\s+|\s+$/g,Xy=/^[-+]0x[0-9a-f]+$/i,Ky=/^0b[01]+$/i,Yy=/^0o[0-7]+$/i,Jy=parseInt,Qy=typeof _a=="object"&&_a&&_a.Object===Object&&_a,ev=typeof self=="object"&&self&&self.Object===Object&&self,tv=Qy||ev||Function("return this")(),iv=Object.prototype,rv=iv.toString,nv=Math.max,sv=Math.min,xh=function(){return tv.Date.now()};function ov(a,u,p){var _,w,T,M,o,z,A=0,G=!1,j=!1,fe=!0;if(typeof a!="function")throw new TypeError(Gy);u=jp(u)||0,Ch(p)&&(G=!!p.leading,j="maxWait"in p,T=j?nv(jp(p.maxWait)||0,u):T,fe="trailing"in p?!!p.trailing:fe);function ge(ht){var st=_,xt=w;return _=w=void 0,A=ht,M=a.apply(xt,st),M}function he(ht){return A=ht,o=setTimeout(Se,u),G?ge(ht):M}function Ce(ht){var st=ht-z,xt=ht-A,_t=u-st;return j?sv(_t,T-xt):_t}function De(ht){var st=ht-z,xt=ht-A;return z===void 0||st>=u||st<0||j&&xt>=T}function Se(){var ht=xh();if(De(ht))return Ne(ht);o=setTimeout(Se,Ce(ht))}function Ne(ht){return o=void 0,fe&&_?ge(ht):(_=w=void 0,M)}function Ue(){o!==void 0&&clearTimeout(o),A=0,_=z=w=o=void 0}function lt(){return o===void 0?M:Ne(xh())}function pt(){var ht=xh(),st=De(ht);if(_=arguments,w=this,z=ht,st){if(o===void 0)return he(z);if(j)return o=setTimeout(Se,u),ge(z)}return o===void 0&&(o=setTimeout(Se,u)),M}return pt.cancel=Ue,pt.flush=lt,pt}function Ch(a){var u=typeof a;return!!a&&(u=="object"||u=="function")}function av(a){return!!a&&typeof a=="object"}function lv(a){return typeof a=="symbol"||av(a)&&rv.call(a)==Hy}function jp(a){if(typeof a=="number")return a;if(lv(a))return Np;if(Ch(a)){var u=typeof a.valueOf=="function"?a.valueOf():a;a=Ch(u)?u+"":u}if(typeof a!="string")return a===0?a:+a;a=a.replace(Wy,"");var p=Ky.test(a);return p||Yy.test(a)?Jy(a.slice(2),p?2:8):Xy.test(a)?Np:+a}var cv=ov,jh={exports:{}},wa=typeof Reflect=="object"?Reflect:null,qp=wa&&typeof wa.apply=="function"?wa.apply:function(u,p,_){return Function.prototype.apply.call(u,p,_)},jc;wa&&typeof wa.ownKeys=="function"?jc=wa.ownKeys:Object.getOwnPropertySymbols?jc=function(u){return Object.getOwnPropertyNames(u).concat(Object.getOwnPropertySymbols(u))}:jc=function(u){return Object.getOwnPropertyNames(u)};function uv(a){console&&console.warn&&console.warn(a)}var Pf=Number.isNaN||function(u){return u!==u};function qt(){qt.init.call(this)}jh.exports=qt;jh.exports.once=fv;qt.EventEmitter=qt;qt.prototype._events=void 0;qt.prototype._eventsCount=0;qt.prototype._maxListeners=void 0;var Zp=10;function nu(a){if(typeof a!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}Object.defineProperty(qt,"defaultMaxListeners",{enumerable:!0,get:function(){return Zp},set:function(a){if(typeof a!="number"||a<0||Pf(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");Zp=a}});qt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};qt.prototype.setMaxListeners=function(u){if(typeof u!="number"||u<0||Pf(u))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+u+".");return this._maxListeners=u,this};function Lf(a){return a._maxListeners===void 0?qt.defaultMaxListeners:a._maxListeners}qt.prototype.getMaxListeners=function(){return Lf(this)};qt.prototype.emit=function(u){for(var p=[],_=1;_<arguments.length;_++)p.push(arguments[_]);var w=u==="error",T=this._events;if(T!==void 0)w=w&&T.error===void 0;else if(!w)return!1;if(w){var M;if(p.length>0&&(M=p[0]),M instanceof Error)throw M;var o=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw o.context=M,o}var z=T[u];if(z===void 0)return!1;if(typeof z=="function")qp(z,this,p);else for(var A=z.length,G=Ff(z,A),_=0;_<A;++_)qp(G[_],this,p);return!0};function zf(a,u,p,_){var w,T,M;if(nu(p),T=a._events,T===void 0?(T=a._events=Object.create(null),a._eventsCount=0):(T.newListener!==void 0&&(a.emit("newListener",u,p.listener?p.listener:p),T=a._events),M=T[u]),M===void 0)M=T[u]=p,++a._eventsCount;else if(typeof M=="function"?M=T[u]=_?[p,M]:[M,p]:_?M.unshift(p):M.push(p),w=Lf(a),w>0&&M.length>w&&!M.warned){M.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(u)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=a,o.type=u,o.count=M.length,uv(o)}return a}qt.prototype.addListener=function(u,p){return zf(this,u,p,!1)};qt.prototype.on=qt.prototype.addListener;qt.prototype.prependListener=function(u,p){return zf(this,u,p,!0)};function hv(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Df(a,u,p){var _={fired:!1,wrapFn:void 0,target:a,type:u,listener:p},w=hv.bind(_);return w.listener=p,_.wrapFn=w,w}qt.prototype.once=function(u,p){return nu(p),this.on(u,Df(this,u,p)),this};qt.prototype.prependOnceListener=function(u,p){return nu(p),this.prependListener(u,Df(this,u,p)),this};qt.prototype.removeListener=function(u,p){var _,w,T,M,o;if(nu(p),w=this._events,w===void 0)return this;if(_=w[u],_===void 0)return this;if(_===p||_.listener===p)--this._eventsCount===0?this._events=Object.create(null):(delete w[u],w.removeListener&&this.emit("removeListener",u,_.listener||p));else if(typeof _!="function"){for(T=-1,M=_.length-1;M>=0;M--)if(_[M]===p||_[M].listener===p){o=_[M].listener,T=M;break}if(T<0)return this;T===0?_.shift():dv(_,T),_.length===1&&(w[u]=_[0]),w.removeListener!==void 0&&this.emit("removeListener",u,o||p)}return this};qt.prototype.off=qt.prototype.removeListener;qt.prototype.removeAllListeners=function(u){var p,_,w;if(_=this._events,_===void 0)return this;if(_.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):_[u]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete _[u]),this;if(arguments.length===0){var T=Object.keys(_),M;for(w=0;w<T.length;++w)M=T[w],M!=="removeListener"&&this.removeAllListeners(M);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(p=_[u],typeof p=="function")this.removeListener(u,p);else if(p!==void 0)for(w=p.length-1;w>=0;w--)this.removeListener(u,p[w]);return this};function Bf(a,u,p){var _=a._events;if(_===void 0)return[];var w=_[u];return w===void 0?[]:typeof w=="function"?p?[w.listener||w]:[w]:p?pv(w):Ff(w,w.length)}qt.prototype.listeners=function(u){return Bf(this,u,!0)};qt.prototype.rawListeners=function(u){return Bf(this,u,!1)};qt.listenerCount=function(a,u){return typeof a.listenerCount=="function"?a.listenerCount(u):Rf.call(a,u)};qt.prototype.listenerCount=Rf;function Rf(a){var u=this._events;if(u!==void 0){var p=u[a];if(typeof p=="function")return 1;if(p!==void 0)return p.length}return 0}qt.prototype.eventNames=function(){return this._eventsCount>0?jc(this._events):[]};function Ff(a,u){for(var p=new Array(u),_=0;_<u;++_)p[_]=a[_];return p}function dv(a,u){for(;u+1<a.length;u++)a[u]=a[u+1];a.pop()}function pv(a){for(var u=new Array(a.length),p=0;p<u.length;++p)u[p]=a[p].listener||a[p];return u}function fv(a,u){return new Promise(function(p,_){function w(M){a.removeListener(u,T),_(M)}function T(){typeof a.removeListener=="function"&&a.removeListener("error",w),p([].slice.call(arguments))}Of(a,u,T,{once:!0}),u!=="error"&&mv(a,w,{once:!0})})}function mv(a,u,p){typeof a.on=="function"&&Of(a,"error",u,p)}function Of(a,u,p,_){if(typeof a.on=="function")_.once?a.once(u,p):a.on(u,p);else if(typeof a.addEventListener=="function")a.addEventListener(u,function w(T){_.once&&a.removeEventListener(u,w),p(T)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a)}var gv=jh.exports,_v={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},yv={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},vv={placeholder:yv},Uf={exports:{}};(function(a){(function(u,p,_){a.exports?a.exports=_():u[p]=_()})(_a,"subtag",function(){var u="",p=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function _(z){return z.match(p)||[]}function w(z){return _(z).filter(function(A,G){return A&&G})}function T(z){return z=_(z),{language:z[1]||u,extlang:z[2]||u,script:z[3]||u,region:z[4]||u}}function M(z,A,G){Object.defineProperty(z,A,{value:G,enumerable:!0})}function o(z,A,G){function j(fe){return _(fe)[z]||u}M(j,"pattern",A),M(T,G,j)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),M(T,"split",w),T})})(Uf);var xv=Uf.exports,bv=$y,wv=cv,Wr=Af,Ev=gv.EventEmitter,$p=_v,Tv=vv,Sv=xv;function Vf(a,u){this._eventEmitter=new Ev,this.options=Wr({},this.options,u),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=a}Vf.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(a){return a.text!==void 0?a.text:a.place_name},render:function(a){if(a.geometry){var o=a.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+o[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+o.splice(1,o.length).join(",")+"</div></div></div>"}else{var u=a.text,p=u.toLowerCase().indexOf(this.query.toLowerCase()),_=this.query.length,w=u.substring(0,p),T=u.substring(p,p+_),M=u.substring(p+_);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+w+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+T+"</span>"+M+"</div></div></div>"}},popupRender:function(a){var u=a.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+u[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+u.splice(1,u.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(a){function u(_,w){if(!document.body.contains(w))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var T=_.onAdd();w.appendChild(T)}if(a._controlContainer)a.addControl(this);else if(a instanceof HTMLElement)u(this,a);else if(typeof a=="string"){var p=document.querySelectorAll(a);if(p.length===0)throw new Error("Element ",a,"not found.");if(p.length>1)throw new Error("Geocoder can only be added to a single html element");u(this,p[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(a){if(a&&typeof a!="string"&&(this._map=a),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var u=this.container=document.createElement("div");u.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var p=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",wv(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var _=document.createElement("div");_.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var w=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(w),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),_.appendChild(this._clearEl),_.appendChild(this._loadingEl),u.appendChild(p),u.appendChild(this._inputEl),u.appendChild(_),this._typeahead=new bv(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),u},createIcon:function(a,u){var p=document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+a+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+a),p.setAttribute("viewBox","0 0 18 18"),p.setAttribute("xml:space","preserve"),p.setAttribute("width",18),p.setAttribute("height",18),"innerHTML"in p)p.innerHTML=u;else{var _=document.createElement("div");_.innerHTML="<svg>"+u.valueOf().toString()+"</svg>";var w=_.firstChild,T=w.firstChild;p.appendChild(T)}return p},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(a){var u=(a.clipboardData||window.clipboardData).getData("text");u.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(u)},_onKeyDown:function(a){var u=27,p=9;if(a.keyCode===u&&this.options.clearAndBlurOnEsc)return this._clear(a),this._inputEl.blur();var _=a.target&&a.target.shadowRoot?a.target.shadowRoot.activeElement:a.target,w=_?_.value:"";if(!w)return this.fresh=!0,a.keyCode!==p&&this.clear(a),this._clearEl.style.display="none";if(!(a.metaKey||[p,u,37,39,38,40].indexOf(a.keyCode)!==-1)){if(a.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(_.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(_.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}_.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(_.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(a){this.options.clearOnBlur&&this._clearOnBlur(a),this.options.collapsed&&this._collapse()},_onChange:function(){var a=this._typeahead.selected;if(a&&!a.geometry)a.placeId?this._geocode(a.placeId,!0,!0):this._geocode(a.text,!0);else if(a&&JSON.stringify(a)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var u;if(this._removeResultMarkers(),a.properties&&$p[a.properties.short_code])u=Wr({},this.options.flyTo),this._map&&this._map.fitBounds($p[a.properties.short_code].bbox,u);else if(a.bbox){var p=a.bbox;u=Wr({},this.options.flyTo),this._map&&this._map.fitBounds([[p[0],p[1]],[p[2],p[3]]],u)}else{var _={zoom:this.options.zoom};u=Wr({},_,this.options.flyTo),a.center?u.center=a.center:a.geometry&&a.geometry.type&&a.geometry.type==="Point"&&a.geometry.coordinates&&(u.center=a.geometry.coordinates),this._map&&this._map.flyTo(u)}}this.options.marker&&this._maplibregl&&this._handleMarker(a),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(a),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:a})}},_getConfigForRequest:function(){var a=["bbox","limit","proximity","countries","types","language","reverseMode"],u=this,p=a.reduce(function(_,w){return u.options[w]&&(["countries","types","language"].indexOf(w)>-1?_[w]=u.options[w].split(/[\s,]+/):_[w]=u.options[w],w==="proximity"&&u.options[w]&&typeof u.options[w].longitude=="number"&&typeof u.options[w].latitude=="number"&&(_[w]=[u.options[w].longitude,u.options[w].latitude])),_},{});return p},_geocode:function(a,u,p){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:a}),this.inputString=a;var _=null,w=this._getConfigForRequest(),T;if(this.options.localGeocoderOnly)T=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(a)){var M=a.split(/[\s(,)?]+/).map(function(A){return parseFloat(A,10)}).reverse();w.types&&w.types[0],w=Wr(w,{query:M,limit:1}),"proximity"in w&&delete w.proximity,T=this.geocoderApi.reverseGeocode(w)}else w=Wr(w,{query:a}),this.geocoderApi.getSuggestions?u?this.geocoderApi.searchByPlaceId&&p?T=this.geocoderApi.searchByPlaceId(w):T=this.geocoderApi.forwardGeocode(w):T=this.geocoderApi.getSuggestions(w):T=this.geocoderApi.forwardGeocode(w);var o=[];this.options.localGeocoder&&(o=this.options.localGeocoder(a),o||(o=[]));var z=[];return T.catch(function(A){_=A}.bind(this)).then(function(A){this._loadingEl.style.display="none";var G={};return A?G=A:G={type:"FeatureCollection",features:[]},G.config=w,this.fresh&&(this.fresh=!1),G.features=G.features?o.concat(G.features):o,this.options.externalGeocoder?(z=this.options.externalGeocoder(a,G.features,w)||[],z.then(function(j){return G.features=G.features?j.concat(G.features):j,G},function(){return G})):G}.bind(this)).then(function(A){if(_)throw _;this.options.filter&&A.features.length&&(A.features=A.features.filter(this.options.filter));var G=[];A.suggestions?G=A.suggestions:A.place?G=[A.place]:G=A.features,G.length?(this._clearEl.style.display="block",this._typeahead.update(G),(!this.options.showResultsWhileTyping||u)&&this.options.showResultMarkers&&(A.features.length>0||A.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",A)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",A))}.bind(this)).catch(function(A){this._loadingEl.style.display="none",o.length&&this.options.localGeocoder||z.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(o)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:o}),this._eventEmitter.emit("error",{error:A})}.bind(this)),T},_clear:function(a){a&&a.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(a){this._clear(a),this._inputEl.focus()},_clearOnBlur:function(a){var u=this;a.relatedTarget&&u._clear(a)},_onQueryResult:function(a){var u=a;if(u.features.length){var p=u.features[0];this._typeahead.selected=p,this._inputEl.value=p.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var a=this._map.getCenter().wrap();this.setProximity({longitude:a.lng,latitude:a.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(a){return this._geocode(a).then(this._onQueryResult),this},_renderError:function(){var a="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(a)},_renderNoResults:function(){var a="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(a)},_renderMessage:function(a){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(a)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var a=this.options.language.split(",")[0],u=Sv.language(a),p=Tv.placeholder[u];if(p)return p}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var a=this._typeahead.data.filter(function(w){return typeof w!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var u={padding:100},p=Wr({},u,this.options.flyTo),_=new this._maplibregl.LngLatBounds;a.forEach(function(w){_.extend(w.geometry.coordinates)}),this._map.fitBounds(_.toArray(),p)}return a.length>0&&this._maplibregl&&this._handleResultMarkers(a),this}},setInput:function(a){return this._inputEl.value=a,this._typeahead.selected=null,this._typeahead.clear(),a.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(a),this},setProximity:function(a){return this.options.proximity=a,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(a){return a&&typeof a=="function"&&(this._typeahead.render=a),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(a){var u=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=a||this.options.language||u,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(a){return this.options.zoom=a,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(a){return this.options.flyTo=a,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(a){return this.placeholder=a||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(a){return this.options.bbox=a,this},getCountries:function(){return this.options.countries},setCountries:function(a){return this.options.countries=a,this},getTypes:function(){return this.options.types},setTypes:function(a){return this.options.types=a,this},getMinLength:function(){return this.options.minLength},setMinLength:function(a){return this.options.minLength=a,this._typeahead&&(this._typeahead.options.minLength=a),this},getLimit:function(){return this.options.limit},setLimit:function(a){return this.options.limit=a,this._typeahead&&(this._typeahead.options.limit=a),this},getFilter:function(){return this.options.filter},setFilter:function(a){return this.options.filter=a,this},setGeocoderApi:function(a){return this.geocoderApi=a,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(a){if(this._map){this._removeMarker();var u={color:"#4668F2"},p=Wr({},u,this.options.marker);this.mapMarker=new this._maplibregl.Marker(p);var _;if(this.options.popup){var w={},T=Wr({},w,this.options.popup);_=new this._maplibregl.Popup(T).setHTML(this.options.popupRender(a))}return a.center?(this.mapMarker.setLngLat(a.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(_)):a.geometry&&a.geometry.type&&a.geometry.type==="Point"&&a.geometry.coordinates&&(this.mapMarker.setLngLat(a.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(_)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(a){if(this._map){this._removeResultMarkers();var u={color:"#4668F2"},p=Wr({},u,this.options.showResultMarkers);return a.forEach(function(_){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var w=this.options.showResultMarkers.element.cloneNode(!0);p=Wr(p,{element:w})}var T=new this._maplibregl.Marker(Wr({},p,{element:w})),M;if(this.options.popup){var o={},z=Wr({},o,this.options.popup);M=new this._maplibregl.Popup(z).setHTML(this.options.popupRender(_))}_.center?(T.setLngLat(_.center).addTo(this._map),this.options.popup&&T.setPopup(M)):_.geometry&&_.geometry.type&&_.geometry.type==="Point"&&_.geometry.coordinates&&(T.setLngLat(_.geometry.coordinates).addTo(this._map),this.options.popup&&T.setPopup(M)),this.resultMarkers.push(T)}.bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(a){a.remove()}),this.resultMarkers=[])},on:function(a,u){return this._eventEmitter.on(a,u),this},off:function(a,u){return this._eventEmitter.removeListener(a,u),this}};var Cv=Vf;const B0=If(Cv);var Nf={exports:{}};(function(a,u){(function(p,_){a.exports=_()})(_a,function(){var p,_,w;function T(o,z){if(!p)p=z;else if(!_)_=z;else{var A="var sharedChunk = {}; ("+p+")(sharedChunk); ("+_+")(sharedChunk);",G={};p(G),w=z(G),typeof window<"u"&&(w.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}T(["exports"],function(o){function z(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var A=G;function G(i,e){this.x=i,this.y=e}G.prototype={clone:function(){return new G(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),c=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},G.convert=function(i){return i instanceof G?i:Array.isArray(i)?new G(i[0],i[1]):i};var j=z(A),fe=ge;function ge(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}ge.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var c=this.sampleCurveX(r)-i;if(Math.abs(c)<e)return r;var f=this.sampleCurveDerivativeX(r);if(Math.abs(f)<1e-6)break;r-=c/f}var g=0,y=1;for(r=i,s=0;s<20&&(c=this.sampleCurveX(r),!(Math.abs(c-i)<e));s++)i>c?g=r:y=r,r=.5*(y-g)+g;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var he=z(fe);function Ce(i,e,r,s){const c=new he(i,e,r,s);return function(f){return c.solve(f)}}const De=Ce(.25,.1,.25,1);function Se(i,e,r){return Math.min(r,Math.max(e,i))}function Ne(i,e,r){const s=r-e,c=((i-e)%s+s)%s+e;return c===e?r:c}function Ue(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let lt=1;function pt(i,e,r){const s={};for(const c in i)s[c]=e.call(r||this,i[c],c,i);return s}function ht(i,e,r){const s={};for(const c in i)e.call(r||this,i[c],c,i)&&(s[c]=i[c]);return s}function st(i){return Array.isArray(i)?i.map(st):typeof i=="object"&&i?pt(i,st):i}const xt={};function _t(i){xt[i]||(typeof console<"u"&&console.warn(i),xt[i]=!0)}function tt(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function gi(i){let e=0;for(let r,s,c=0,f=i.length,g=f-1;c<f;g=c++)r=i[c],s=i[g],e+=(s.x-r.x)*(r.y+s.y);return e}function Zt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let _i=null;function fr(i){if(_i==null){const e=i.navigator?i.navigator.userAgent:null;_i=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return _i}function $t(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const yi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let er,Jt;const en={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,r.drawImage(i,0,0,i.width,i.height),r},resolveURL:i=>(er||(er=document.createElement("a")),er.href=i,er.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Jt==null&&(Jt=matchMedia("(prefers-reduced-motion: reduce)")),Jt.matches)}},Ur={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Fi extends Error{constructor(e,r,s,c){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=c}}const oi=Zt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,vi=i=>Ur.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function kt(i,e){const r=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:oi(),signal:r.signal});let c=!1,f=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),f||fetch(s).then(g=>g.ok?(y=>{(i.type==="arrayBuffer"||i.type==="image"?y.arrayBuffer():i.type==="json"?y.json():y.text()).then(b=>{f||(c=!0,e(null,b,y.headers.get("Cache-Control"),y.headers.get("Expires")))}).catch(b=>{f||e(new Error(b.message))})})(g):g.blob().then(y=>e(new Fi(g.status,g.statusText,i.url,y)))).catch(g=>{g.code!==20&&e(new Error(g.message))}),{cancel:()=>{f=!0,c||r.abort()}}}const Xi=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Zt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Zt())return(vi(i.url)||kt)(i,e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(oi())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return kt(i,e);if(Zt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(s,c){const f=new XMLHttpRequest;f.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(f.responseType="arraybuffer");for(const g in s.headers)f.setRequestHeader(g,s.headers[g]);return s.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=s.credentials==="include",f.onerror=()=>{c(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let g=f.response;if(s.type==="json")try{g=JSON.parse(f.response)}catch(y){return c(y)}c(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else{const g=new Blob([f.response],{type:f.getResponseHeader("Content-Type")});c(new Fi(f.status,f.statusText,s.url,g))}},f.send(s.body),{cancel:()=>f.abort()}}(i,e)},Be=function(i,e){return Xi(Ue(i,{type:"arrayBuffer"}),e)};function ot(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Rt(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Oi(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class Ki{constructor(e,r={}){Ue(this,r),this.type=e}}class mr extends Ki{constructor(e,r={}){super("error",Ue({error:e},r))}}class Vr{on(e,r){return this._listeners=this._listeners||{},Rt(e,r,this._listeners),this}off(e,r){return Oi(e,r,this._listeners),Oi(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Rt(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){typeof e=="string"&&(e=new Ki(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of c)y.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of f)Oi(s,y,this._oneTimeListeners),y.call(this,e);const g=this._eventedParent;g&&(Ue(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof mr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const pn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ms(i,e){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return pn.forEach(s=>{s in e&&(r[s]=e[s])}),r}function Lt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Lt(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!Lt(i[r],e[r]))return!1;return!0}return i===e}const Ct={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Zn(i,e,r){r.push({command:Ct.addSource,args:[i,e[i]]})}function $n(i,e,r){e.push({command:Ct.removeSource,args:[i]}),r[i]=!0}function xo(i,e,r,s){$n(i,r,s),Zn(i,e,r)}function bo(i,e,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!Lt(i[r][s],e[r][s]))return!1;for(s in e[r])if(Object.prototype.hasOwnProperty.call(e[r],s)&&s!=="data"&&!Lt(i[r][s],e[r][s]))return!1;return!0}function Qt(i,e,r,s,c,f){let g;for(g in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,g)&&(Lt(i[g],e[g])||r.push({command:f,args:[s,g,e[g],c]}));for(g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(i,g)&&(Lt(i[g],e[g])||r.push({command:f,args:[s,g,e[g],c]}))}function Fs(i){return i.id}function gs(i,e){return i[e.id]=e,i}class Me{constructor(e,r,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function Yi(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}class tr extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class fn{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,c]of r)this.bindings[s]=c}concat(e){return new fn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const An={kind:"null"},Pe={kind:"number"},ct={kind:"string"},ut={kind:"boolean"},Ui={kind:"color"},mn={kind:"object"},it={kind:"value"},tn={kind:"collator"},rn={kind:"formatted"},kn={kind:"padding"},kr={kind:"resolvedImage"},Mn={kind:"variableAnchorOffsetCollection"};function Di(i,e){return{kind:"array",itemType:i,N:e}}function Ot(i){if(i.kind==="array"){const e=Ot(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Os=[An,Pe,ct,ut,Ui,rn,mn,Di(it),kn,kr,Mn];function nn(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!nn(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of Os)if(!nn(r,e))return null}}return`Expected ${Ot(i)} but found ${Ot(e)} instead.`}function W(i,e){return e.some(r=>r.kind===i.kind)}function D(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function R(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const V=.96422,K=.82521,Q=4/29,se=6/29,te=3*se*se,ee=se*se*se,ae=Math.PI/180,ve=180/Math.PI;function xe(i){return(i%=360)<0&&(i+=360),i}function be([i,e,r,s]){let c,f;const g=at((.2225045*(i=Qe(i))+.7168786*(e=Qe(e))+.0606169*(r=Qe(r)))/1);i===e&&e===r?c=f=g:(c=at((.4360747*i+.3850649*e+.1430804*r)/V),f=at((.0139322*i+.0971045*e+.7141733*r)/K));const y=116*g-16;return[y<0?0:y,500*(c-g),200*(g-f),s]}function Qe(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function at(i){return i>ee?Math.pow(i,1/3):i/te+Q}function Ze([i,e,r,s]){let c=(i+16)/116,f=isNaN(e)?c:c+e/500,g=isNaN(r)?c:c-r/200;return c=1*nt(c),f=V*nt(f),g=K*nt(g),[Xe(3.1338561*f-1.6168667*c-.4906146*g),Xe(-.9787684*f+1.9161415*c+.033454*g),Xe(.0719453*f-.2289914*c+1.4052427*g),s]}function Xe(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function nt(i){return i>se?i*i*i:te*(i-Q)}function Et(i){return parseInt(i.padEnd(2,i),16)/255}function zt(i,e){return yt(e?i/100:i,0,1)}function yt(i,e,r){return Math.min(Math.max(e,i),r)}function wt(i){return!i.some(Number.isNaN)}const ir={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class rt{constructor(e,r,s,c=1,f=!0){this.r=e,this.g=r,this.b=s,this.a=c,f||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,r,s,c]))}static parse(e){if(e instanceof rt)return e;if(typeof e!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=ir[s];if(c){const[g,y,b]=c;return[g/255,y/255,b/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const g=s.length<6?1:2;let y=1;return[Et(s.slice(y,y+=g)),Et(s.slice(y,y+=g)),Et(s.slice(y,y+=g)),Et(s.slice(y,y+g)||"ff")]}if(s.startsWith("rgb")){const g=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,b,S,k,L,B,O,U,$,X,J,oe]=g,ie=[k||" ",O||" ",X].join("");if(ie==="  "||ie==="  /"||ie===",,"||ie===",,,"){const le=[S,B,$].join(""),ue=le==="%%%"?100:le===""?255:0;if(ue){const ye=[yt(+b/ue,0,1),yt(+L/ue,0,1),yt(+U/ue,0,1),J?zt(+J,oe):1];if(wt(ye))return ye}}return}}const f=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[g,y,b,S,k,L,B,O,U]=f,$=[b||" ",k||" ",B].join("");if($==="  "||$==="  /"||$===",,"||$===",,,"){const X=[+y,yt(+S,0,100),yt(+L,0,100),O?zt(+O,U):1];if(wt(X))return function([J,oe,ie,le]){function ue(ye){const Oe=(ye+J/30)%12,Ge=oe*Math.min(ie,1-ie);return ie-Ge*Math.max(-1,Math.min(Oe-3,9-Oe,1))}return J=xe(J),oe/=100,ie/=100,[ue(0),ue(8),ue(4),le]}(X)}}}(e);return r?new rt(...r,!1):void 0}get rgb(){const{r:e,g:r,b:s,a:c}=this,f=c||1/0;return this.overwriteGetter("rgb",[e/f,r/f,s/f,c])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,s,c,f]=be(e),g=Math.sqrt(s*s+c*c);return[Math.round(1e4*g)?xe(Math.atan2(c,s)*ve):NaN,g,r,f]}(this.rgb))}get lab(){return this.overwriteGetter("lab",be(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,s,c]=this.rgb;return`rgba(${[e,r,s].map(f=>Math.round(255*f)).join(",")},${c})`}}rt.black=new rt(0,0,0,1),rt.white=new rt(1,1,1,1),rt.transparent=new rt(0,0,0,0),rt.red=new rt(1,0,0,1);class xi{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Bi{constructor(e,r,s,c,f){this.text=e,this.image=r,this.scale=s,this.fontStack=c,this.textColor=f}}class ai{constructor(e){this.sections=e}static fromString(e){return new ai([new Bi(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ai?e:ai.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class gr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof gr)return e;if(typeof e=="number")return new gr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new gr(e)}}toString(){return JSON.stringify(this.values)}}const su=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Vi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Vi)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const s=e[r],c=e[r+1];if(typeof s!="string"||!su.has(s)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Vi(e)}}toString(){return JSON.stringify(this.values)}}class Mr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Mr({name:e,available:!1}):null}}function jl(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wo(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof rt||i instanceof xi||i instanceof ai||i instanceof gr||i instanceof Vi||i instanceof Mr)return!0;if(Array.isArray(i)){for(const e of i)if(!wo(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!wo(i[e]))return!1;return!0}return!1}function li(i){if(i===null)return An;if(typeof i=="string")return ct;if(typeof i=="boolean")return ut;if(typeof i=="number")return Pe;if(i instanceof rt)return Ui;if(i instanceof xi)return tn;if(i instanceof ai)return rn;if(i instanceof gr)return kn;if(i instanceof Vi)return Mn;if(i instanceof Mr)return kr;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const c=li(s);if(r){if(r===c)continue;r=it;break}r=c}return Di(r||it,e)}return mn}function Pn(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof rt||i instanceof ai||i instanceof gr||i instanceof Vi||i instanceof Mr?i.toString():JSON.stringify(i)}class Gn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!wo(e[1]))return r.error("invalid value");const s=e[1];let c=li(s);const f=r.expectedType;return c.kind!=="array"||c.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(c=f),new Gn(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ci{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Eo={string:ct,number:Pe,boolean:ut,object:mn};class Ni{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,c=1;const f=e[0];if(f==="array"){let y,b;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in Eo)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=Eo[S],c++}else y=it;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],c++}s=Di(y,b)}else{if(!Eo[f])throw new Error(`Types doesn't contain name = ${f}`);s=Eo[f]}const g=[];for(;c<e.length;c++){const y=r.parse(e[c],c,it);if(!y)return null;g.push(y)}return new Ni(s,g)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!nn(this.type,li(s)))return s;if(r===this.args.length-1)throw new ci(`Expected value to be of type ${Ot(this.type)}, but found ${Ot(li(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const To={"to-boolean":ut,"to-color":Ui,"to-number":Pe,"to-string":ct};class sn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!To[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const c=To[s],f=[];for(let g=1;g<e.length;g++){const y=r.parse(e[g],g,it);if(!y)return null;f.push(y)}return new sn(c,f)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,s;for(const c of this.args){if(r=c.evaluate(e),s=null,r instanceof rt)return r;if(typeof r=="string"){const f=e.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:jl(r[0],r[1],r[2],r[3]),!s))return new rt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ci(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(e);const c=gr.parse(r);if(c)return c}throw new ci(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(e);const c=Vi.parse(r);if(c)return c}throw new ci(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new ci(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return ai.fromString(Pn(this.args[0].evaluate(e)));case"resolvedImage":return Mr.fromString(Pn(this.args[0].evaluate(e)));default:return Pn(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Us=["Unknown","Point","LineString","Polygon"];class Mt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Us[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=rt.parse(e)),r}}class So{constructor(e,r,s=[],c,f=new fn,g=[]){this.registry=e,this.path=s,this.key=s.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=g,this.expectedType=c,this._isConstant=r}parse(e,r,s,c,f={}){return r?this.concat(r,s,c)._parse(e,f):this._parse(e,f)}_parse(e,r){function s(c,f,g){return g==="assert"?new Ni(f,[c]):g==="coerce"?new sn(f,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[c];if(f){let g=f.parse(e,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,b=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||b.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(y.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(y.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(y,b))return null}else g=s(g,y,r.typeAnnotation||"coerce");else g=s(g,y,r.typeAnnotation||"coerce");else g=s(g,y,r.typeAnnotation||"coerce");else g=s(g,y,r.typeAnnotation||"assert")}if(!(g instanceof Gn)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const y=new Mt;try{g=new Gn(g.type,g.evaluate(y))}catch(b){return this.error(b.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const c=typeof e=="number"?this.path.concat(e):this.path,f=s?this.scope.concat(s):this.scope;return new So(this.registry,this._isConstant,c,r||null,f,this.errors)}error(e,...r){const s=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new tr(s,e))}checkSubtype(e,r){const s=nn(e,r);return s&&this.error(s),s}}class _s{constructor(e,r,s){this.type=tn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const c=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,ut);if(!c)return null;const f=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,ut);if(!f)return null;let g=null;return s.locale&&(g=r.parse(s.locale,1,ct),!g)?null:new _s(c,f,g)}evaluate(e){return new xi(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Ln=8192;function Co(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Vs(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function ou(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*Ln),Math.round(s*c*Ln)]}function ql(i,e,r){const s=i[0]-e[0],c=i[1]-e[1],f=i[0]-r[0],g=i[1]-r[1];return s*g-f*c==0&&s*f<=0&&c*g<=0}function Io(i,e){let r=!1;for(let g=0,y=e.length;g<y;g++){const b=e[g];for(let S=0,k=b.length;S<k-1;S++){if(ql(i,b[S],b[S+1]))return!1;(c=b[S])[1]>(s=i)[1]!=(f=b[S+1])[1]>s[1]&&s[0]<(f[0]-c[0])*(s[1]-c[1])/(f[1]-c[1])+c[0]&&(r=!r)}}var s,c,f;return r}function au(i,e){for(let r=0;r<e.length;r++)if(Io(i,e[r]))return!0;return!1}function Zl(i,e,r,s){const c=s[0]-r[0],f=s[1]-r[1],g=(i[0]-r[0])*f-c*(i[1]-r[1]),y=(e[0]-r[0])*f-c*(e[1]-r[1]);return g>0&&y<0||g<0&&y>0}function lu(i,e,r){for(const S of r)for(let k=0;k<S.length-1;++k)if((y=[(g=S[k+1])[0]-(f=S[k])[0],g[1]-f[1]])[0]*(b=[(c=e)[0]-(s=i)[0],c[1]-s[1]])[1]-y[1]*b[0]!=0&&Zl(s,c,f,g)&&Zl(f,g,s,c))return!0;var s,c,f,g,y,b;return!1}function $l(i,e){for(let r=0;r<i.length;++r)if(!Io(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(lu(i[r],i[r+1],e))return!1;return!0}function Gl(i,e){for(let r=0;r<e.length;r++)if($l(i,e[r]))return!0;return!1}function Ao(i,e,r){const s=[];for(let c=0;c<i.length;c++){const f=[];for(let g=0;g<i[c].length;g++){const y=ou(i[c][g],r);Co(e,y),f.push(y)}s.push(f)}return s}function Hl(i,e,r){const s=[];for(let c=0;c<i.length;c++){const f=Ao(i[c],e,r);s.push(f)}return s}function Wl(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const c=.5*s;let f=i[0]-r[0]>c?-s:r[0]-i[0]>c?s:0;f===0&&(f=i[0]-r[2]>c?-s:r[2]-i[0]>c?s:0),i[0]+=f}Co(e,i)}function ko(i,e,r,s){const c=Math.pow(2,s.z)*Ln,f=[s.x*Ln,s.y*Ln],g=[];for(const y of i)for(const b of y){const S=[b.x+f[0],b.y+f[1]];Wl(S,e,r,c),g.push(S)}return g}function Xl(i,e,r,s){const c=Math.pow(2,s.z)*Ln,f=[s.x*Ln,s.y*Ln],g=[];for(const b of i){const S=[];for(const k of b){const L=[k.x+f[0],k.y+f[1]];Co(e,L),S.push(L)}g.push(S)}if(e[2]-e[0]<=c/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of g)for(const S of b)Wl(S,e,r,c)}var y;return g}class Hn{constructor(e,r){this.type=ut,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(wo(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let c=0;c<s.features.length;++c){const f=s.features[c].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Hn(s,s.features[c].geometry)}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Hn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Hn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(s.type==="Polygon"){const y=Ao(s.coordinates,f,g),b=ko(r.geometry(),c,f,g);if(!Vs(c,f))return!1;for(const S of b)if(!Io(S,y))return!1}if(s.type==="MultiPolygon"){const y=Hl(s.coordinates,f,g),b=ko(r.geometry(),c,f,g);if(!Vs(c,f))return!1;for(const S of b)if(!au(S,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(s.type==="Polygon"){const y=Ao(s.coordinates,f,g),b=Xl(r.geometry(),c,f,g);if(!Vs(c,f))return!1;for(const S of b)if(!$l(S,y))return!1}if(s.type==="MultiPolygon"){const y=Hl(s.coordinates,f,g),b=Xl(r.geometry(),c,f,g);if(!Vs(c,f))return!1;for(const S of b)if(!Gl(S,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Mo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new Mo(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class _r{constructor(e,r,s,c){this.name=e,this.type=r,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],c=_r.definitions[s];if(!c)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=g.filter(([S])=>!Array.isArray(S)||S.length===e.length-1);let b=null;for(const[S,k]of y){b=new So(r.registry,Ns,r.path,null,r.scope);const L=[];let B=!1;for(let O=1;O<e.length;O++){const U=e[O],$=Array.isArray(S)?S[O-1]:S.type,X=b.parse(U,1+L.length,$);if(!X){B=!0;break}L.push(X)}if(!B)if(Array.isArray(S)&&S.length!==L.length)b.error(`Expected ${S.length} arguments, but found ${L.length} instead.`);else{for(let O=0;O<L.length;O++){const U=Array.isArray(S)?S[O]:S.type,$=L[O];b.concat(O+1).checkSubtype(U,$.type)}if(b.errors.length===0)return new _r(s,f,k,L)}}if(y.length===1)r.errors.push(...b.errors);else{const S=(y.length?y:g).map(([L])=>{return B=L,Array.isArray(B)?`(${B.map(Ot).join(", ")})`:`(${Ot(B.type)}...)`;var B}).join(" | "),k=[];for(let L=1;L<e.length;L++){const B=r.parse(e[L],1+k.length);if(!B)return null;k.push(Ot(B.type))}r.error(`Expected arguments of type ${S}, but found (${k.join(", ")}) instead.`)}return null}static register(e,r){_r.definitions=r;for(const s in r)e[s]=_r}}function Ns(i){if(i instanceof Mo)return Ns(i.boundExpression);if(i instanceof _r&&i.name==="error"||i instanceof _s||i instanceof Hn)return!1;const e=i instanceof sn||i instanceof Ni;let r=!0;return i.eachChild(s=>{r=e?r&&Ns(s):r&&s instanceof Gn}),!!r&&Po(i)&&qs(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Po(i){if(i instanceof _r&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Hn)return!1;let e=!0;return i.eachChild(r=>{e&&!Po(r)&&(e=!1)}),e}function js(i){if(i instanceof _r&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!js(r)&&(e=!1)}),e}function qs(i,e){if(i instanceof _r&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!qs(s,e)&&(r=!1)}),r}function Zs(i,e){const r=i.length-1;let s,c,f=0,g=r,y=0;for(;f<=g;)if(y=Math.floor((f+g)/2),s=i[y],c=i[y+1],s<=e){if(y===r||e<c)return y;f=y+1}else{if(!(s>e))throw new ci("Input is not a number.");g=y-1}return 0}class $s{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,f]of s)this.labels.push(c),this.outputs.push(f)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Pe);if(!s)return null;const c=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let g=1;g<e.length;g+=2){const y=g===1?-1/0:e[g],b=e[g+1],S=g,k=g+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(c.length&&c[c.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const L=r.parse(b,k,f);if(!L)return null;f=f||L.type,c.push([y,L])}return new $s(f,s,c)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const f=r.length;return c>=r[f-1]?s[f-1].evaluate(e):s[Zs(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Wn(i,e,r){return i+r*(e-i)}function Lo(i,e,r){return i.map((s,c)=>Wn(s,e[c],r))}const yr={number:Wn,color:function(i,e,r,s="rgb"){switch(s){case"rgb":{const[c,f,g,y]=Lo(i.rgb,e.rgb,r);return new rt(c,f,g,y,!1)}case"hcl":{const[c,f,g,y]=i.hcl,[b,S,k,L]=e.hcl;let B,O;if(isNaN(c)||isNaN(b))isNaN(c)?isNaN(b)?B=NaN:(B=b,g!==1&&g!==0||(O=S)):(B=c,k!==1&&k!==0||(O=f));else{let oe=b-c;b>c&&oe>180?oe-=360:b<c&&c-b>180&&(oe+=360),B=c+r*oe}const[U,$,X,J]=function([oe,ie,le,ue]){return oe=isNaN(oe)?0:oe*ae,Ze([le,Math.cos(oe)*ie,Math.sin(oe)*ie,ue])}([B,O??Wn(f,S,r),Wn(g,k,r),Wn(y,L,r)]);return new rt(U,$,X,J,!1)}case"lab":{const[c,f,g,y]=Ze(Lo(i.lab,e.lab,r));return new rt(c,f,g,y,!1)}}},array:Lo,padding:function(i,e,r){return new gr(Lo(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const s=i.values,c=e.values;if(s.length!==c.length)throw new ci(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const f=[];for(let g=0;g<s.length;g+=2){if(s[g]!==c[g])throw new ci(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${s[g]}, to[${g}]: ${c[g]}`);f.push(s[g]);const[y,b]=s[g+1],[S,k]=c[g+1];f.push([Wn(y,S,r),Wn(b,k,r)])}return new Vi(f)}};class vr{constructor(e,r,s,c,f){this.type=e,this.operator=r,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[g,y]of f)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(e,r,s,c){let f=0;if(e.name==="exponential")f=La(r,e.base,s,c);else if(e.name==="linear")f=La(r,1,s,c);else if(e.name==="cubic-bezier"){const g=e.controlPoints;f=new he(g[0],g[1],g[2],g[3]).solve(La(r,1,s,c))}return f}static parse(e,r){let[s,c,f,...g]=e;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const S=c[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:S}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const S=c.slice(1);if(S.length!==4||S.some(k=>typeof k!="number"||k<0||k>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,Pe),!f)return null;const y=[];let b=null;s==="interpolate-hcl"||s==="interpolate-lab"?b=Ui:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let S=0;S<g.length;S+=2){const k=g[S],L=g[S+1],B=S+3,O=S+4;if(typeof k!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(y.length&&y[y.length-1][0]>=k)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const U=r.parse(L,O,b);if(!U)return null;b=b||U.type,y.push([k,U])}return R(b,Pe)||R(b,Ui)||R(b,kn)||R(b,Mn)||R(b,Di(Pe))?new vr(b,s,c,f,y):r.error(`Type ${Ot(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const f=r.length;if(c>=r[f-1])return s[f-1].evaluate(e);const g=Zs(r,c),y=vr.interpolationFactor(this.interpolation,c,r[g],r[g+1]),b=s[g].evaluate(e),S=s[g+1].evaluate(e);switch(this.operator){case"interpolate":return yr[this.type.kind](b,S,y);case"interpolate-hcl":return yr.color(b,S,y,"hcl");case"interpolate-lab":return yr.color(b,S,y,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function La(i,e,r,s){const c=s-r,f=i-r;return c===0?0:e===1?f/c:(Math.pow(e,f)-1)/(Math.pow(e,c)-1)}class zo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const c=r.expectedType;c&&c.kind!=="value"&&(s=c);const f=[];for(const y of e.slice(1)){const b=r.parse(y,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,f.push(b)}if(!s)throw new Error("No output type");const g=c&&f.some(y=>nn(c,y.type));return new zo(g?it:s,f)}evaluate(e){let r,s=null,c=0;for(const f of this.args)if(c++,s=f.evaluate(e),s&&s instanceof Mr&&!s.available&&(r||(r=s.name),s=null,c===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class ys{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const g=e[f];if(typeof g!="string")return r.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=r.parse(e[f+1],f+1);if(!y)return null;s.push([g,y])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return c?new ys(s,c):null}outputDefined(){return this.result.outputDefined()}}class vs{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Pe),c=r.parse(e[2],2,Di(r.expectedType||it));return s&&c?new vs(c.type.itemType,s,c):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new ci(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new ci(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new ci(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Tt{constructor(e,r){this.type=ut,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,it),c=r.parse(e[2],2,it);return s&&c?W(s.type,[ut,ct,Pe,An,it])?new Tt(s,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ot(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!D(r,["boolean","string","number","null"]))throw new ci(`Expected first argument to be of type boolean, string, number or null, but found ${Ot(li(r))} instead.`);if(!D(s,["string","array"]))throw new ci(`Expected second argument to be of type array or string, but found ${Ot(li(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Do{constructor(e,r,s){this.type=Pe,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,it),c=r.parse(e[2],2,it);if(!s||!c)return null;if(!W(s.type,[ut,ct,Pe,An,it]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ot(s.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,Pe);return f?new Do(s,c,f):null}return new Do(s,c)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!D(r,["boolean","string","number","null"]))throw new ci(`Expected first argument to be of type boolean, string, number or null, but found ${Ot(li(r))} instead.`);if(!D(s,["string","array"]))throw new ci(`Expected second argument to be of type array or string, but found ${Ot(li(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(r,c)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class za{constructor(e,r,s,c,f,g){this.inputType=e,this.type=r,this.input=s,this.cases=c,this.outputs=f,this.otherwise=g}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const f={},g=[];for(let S=2;S<e.length-1;S+=2){let k=e[S];const L=e[S+1];Array.isArray(k)||(k=[k]);const B=r.concat(S);if(k.length===0)return B.error("Expected at least one branch label.");for(const U of k){if(typeof U!="number"&&typeof U!="string")return B.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return B.error("Numeric branch labels must be integer values.");if(s){if(B.checkSubtype(s,li(U)))return null}else s=li(U);if(f[String(U)]!==void 0)return B.error("Branch labels must be unique.");f[String(U)]=g.length}const O=r.parse(L,S,c);if(!O)return null;c=c||O.type,g.push(O)}const y=r.parse(e[1],1,it);if(!y)return null;const b=r.parse(e[e.length-1],e.length-1,c);return b?y.type.kind!=="value"&&r.concat(1).checkSubtype(s,y.type)?null:new za(s,c,y,f,g,b):null}evaluate(e){const r=this.input.evaluate(e);return(li(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Da{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const c=[];for(let g=1;g<e.length-1;g+=2){const y=r.parse(e[g],g,ut);if(!y)return null;const b=r.parse(e[g+1],g+1,s);if(!b)return null;c.push([y,b]),s=s||b.type}const f=r.parse(e[e.length-1],e.length-1,s);if(!f)return null;if(!s)throw new Error("Can't infer output type");return new Da(s,c,f)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Bo{constructor(e,r,s,c){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,it),c=r.parse(e[2],2,Pe);if(!s||!c)return null;if(!W(s.type,[Di(it),ct,it]))return r.error(`Expected first argument to be of type array or string, but found ${Ot(s.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,Pe);return f?new Bo(s.type,s,c,f):null}return new Bo(s.type,s,c)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!D(r,["string","array"]))throw new ci(`Expected first argument to be of type array or string, but found ${Ot(li(r))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return r.slice(s,c)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Kl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Yl(i,e,r,s){return s.compare(e,r)===0}function xs(i,e,r){const s=i!=="=="&&i!=="!=";return class jf{constructor(f,g,y){this.type=ut,this.lhs=f,this.rhs=g,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||g.type.kind==="value"}static parse(f,g){if(f.length!==3&&f.length!==4)return g.error("Expected two or three arguments.");const y=f[0];let b=g.parse(f[1],1,it);if(!b)return null;if(!Kl(y,b.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${Ot(b.type)}'.`);let S=g.parse(f[2],2,it);if(!S)return null;if(!Kl(y,S.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${Ot(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return g.error(`Cannot compare types '${Ot(b.type)}' and '${Ot(S.type)}'.`);s&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new Ni(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new Ni(b.type,[S])));let k=null;if(f.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(k=g.parse(f[3],3,tn),!k)return null}return new jf(b,S,k)}evaluate(f){const g=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const b=li(g),S=li(y);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new ci(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const b=li(g),S=li(y);if(b.kind!=="string"||S.kind!=="string")return e(f,g,y)}return this.collator?r(f,g,y,this.collator.evaluate(f)):e(f,g,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const cu=xs("==",function(i,e,r){return e===r},Yl),uu=xs("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!Yl(0,e,r,s)}),hu=xs("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),du=xs(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),pu=xs("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),fu=xs(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class Ba{constructor(e,r,s,c,f){this.type=ct,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=f}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Pe);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let f=null;if(c.locale&&(f=r.parse(c.locale,1,ct),!f))return null;let g=null;if(c.currency&&(g=r.parse(c.currency,1,ct),!g))return null;let y=null;if(c["min-fraction-digits"]&&(y=r.parse(c["min-fraction-digits"],1,Pe),!y))return null;let b=null;return c["max-fraction-digits"]&&(b=r.parse(c["max-fraction-digits"],1,Pe),!b)?null:new Ba(s,f,g,y,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ro{constructor(e){this.type=rn,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const c=[];let f=!1;for(let g=1;g<=e.length-1;++g){const y=e[g];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let b=null;if(y["font-scale"]&&(b=r.parse(y["font-scale"],1,Pe),!b))return null;let S=null;if(y["text-font"]&&(S=r.parse(y["text-font"],1,Di(ct)),!S))return null;let k=null;if(y["text-color"]&&(k=r.parse(y["text-color"],1,Ui),!k))return null;const L=c[c.length-1];L.scale=b,L.font=S,L.textColor=k}else{const b=r.parse(e[g],1,it);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,c.push({content:b,scale:null,font:null,textColor:null})}}return new Ro(c)}evaluate(e){return new ai(this.sections.map(r=>{const s=r.content.evaluate(e);return li(s)===kr?new Bi("",s,null,null,null):new Bi(Pn(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class Ra{constructor(e){this.type=kr,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,ct);return s?new Ra(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=Mr.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class Fa{constructor(e){this.type=Pe,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ot(s.type)} instead.`):new Fa(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new ci(`Expected value to be of type string or array, but found ${Ot(li(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const bs={"==":cu,"!=":uu,">":du,"<":hu,">=":fu,"<=":pu,array:Ni,at:vs,boolean:Ni,case:Da,coalesce:zo,collator:_s,format:Ro,image:Ra,in:Tt,"index-of":Do,interpolate:vr,"interpolate-hcl":vr,"interpolate-lab":vr,length:Fa,let:ys,literal:Gn,match:za,number:Ni,"number-format":Ba,object:Ni,slice:Bo,step:$s,string:Ni,"to-boolean":sn,"to-color":sn,"to-number":sn,"to-string":sn,var:Mo,within:Hn};function Jl(i,[e,r,s,c]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const f=c?c.evaluate(i):1,g=jl(e,r,s,f);if(g)throw new ci(g);return new rt(e/255,r/255,s/255,f,!1)}function Ql(i,e){return i in e}function Oa(i,e){const r=e[i];return r===void 0?null:r}function Xn(i){return{type:i}}function ec(i){return{result:"success",value:i}}function ws(i){return{result:"error",value:i}}function Es(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function tc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Ua(i){return!!i.expression&&i.expression.interpolated}function It(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Fo(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function mu(i){return i}function ic(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",c=s||!(s||i.property!==void 0),f=i.type||(Ua(e)?"exponential":"interval");if(r||e.type==="padding"){const k=r?rt.parse:gr.parse;(i=Yi({},i)).stops&&(i.stops=i.stops.map(L=>[L[0],k(L[1])])),i.default=k(i.default?i.default:e.default)}if(i.colorSpace&&(g=i.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var g;let y,b,S;if(f==="exponential")y=rc;else if(f==="interval")y=_u;else if(f==="categorical"){y=gu,b=Object.create(null);for(const k of i.stops)b[k[0]]=k[1];S=typeof i.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);y=yu}if(s){const k={},L=[];for(let U=0;U<i.stops.length;U++){const $=i.stops[U],X=$[0].zoom;k[X]===void 0&&(k[X]={zoom:X,type:i.type,property:i.property,default:i.default,stops:[]},L.push(X)),k[X].stops.push([$[0].value,$[1]])}const B=[];for(const U of L)B.push([k[U].zoom,ic(k[U],e)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:vr.interpolationFactor.bind(void 0,O),zoomStops:B.map(U=>U[0]),evaluate:({zoom:U},$)=>rc({stops:B,base:i.base},e,U).evaluate(U,$)}}if(c){const k=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:vr.interpolationFactor.bind(void 0,k),zoomStops:i.stops.map(L=>L[0]),evaluate:({zoom:L})=>y(i,e,L,b,S)}}return{kind:"source",evaluate(k,L){const B=L&&L.properties?L.properties[i.property]:void 0;return B===void 0?Kn(i.default,e.default):y(i,e,B,b,S)}}}function Kn(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function gu(i,e,r,s,c){return Kn(typeof r===c?s[r]:void 0,i.default,e.default)}function _u(i,e,r){if(It(r)!=="number")return Kn(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const c=Zs(i.stops.map(f=>f[0]),r);return i.stops[c][1]}function rc(i,e,r){const s=i.base!==void 0?i.base:1;if(It(r)!=="number")return Kn(i.default,e.default);const c=i.stops.length;if(c===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[c-1][0])return i.stops[c-1][1];const f=Zs(i.stops.map(k=>k[0]),r),g=function(k,L,B,O){const U=O-B,$=k-B;return U===0?0:L===1?$/U:(Math.pow(L,$)-1)/(Math.pow(L,U)-1)}(r,s,i.stops[f][0],i.stops[f+1][0]),y=i.stops[f][1],b=i.stops[f+1][1],S=yr[e.type]||mu;return typeof y.evaluate=="function"?{evaluate(...k){const L=y.evaluate.apply(void 0,k),B=b.evaluate.apply(void 0,k);if(L!==void 0&&B!==void 0)return S(L,B,g,i.colorSpace)}}:S(y,b,g,i.colorSpace)}function yu(i,e,r){switch(e.type){case"color":r=rt.parse(r);break;case"formatted":r=ai.fromString(r.toString());break;case"resolvedImage":r=Mr.fromString(r.toString());break;case"padding":r=gr.parse(r);break;default:It(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Kn(r,i.default,e.default)}_r.register(bs,{error:[{kind:"error"},[ct],(i,[e])=>{throw new ci(e.evaluate(i))}],typeof:[ct,[it],(i,[e])=>Ot(li(e.evaluate(i)))],"to-rgba":[Di(Pe,4),[Ui],(i,[e])=>{const[r,s,c,f]=e.evaluate(i).rgb;return[255*r,255*s,255*c,f]}],rgb:[Ui,[Pe,Pe,Pe],Jl],rgba:[Ui,[Pe,Pe,Pe,Pe],Jl],has:{type:ut,overloads:[[[ct],(i,[e])=>Ql(e.evaluate(i),i.properties())],[[ct,mn],(i,[e,r])=>Ql(e.evaluate(i),r.evaluate(i))]]},get:{type:it,overloads:[[[ct],(i,[e])=>Oa(e.evaluate(i),i.properties())],[[ct,mn],(i,[e,r])=>Oa(e.evaluate(i),r.evaluate(i))]]},"feature-state":[it,[ct],(i,[e])=>Oa(e.evaluate(i),i.featureState||{})],properties:[mn,[],i=>i.properties()],"geometry-type":[ct,[],i=>i.geometryType()],id:[it,[],i=>i.id()],zoom:[Pe,[],i=>i.globals.zoom],"heatmap-density":[Pe,[],i=>i.globals.heatmapDensity||0],"line-progress":[Pe,[],i=>i.globals.lineProgress||0],accumulated:[it,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Pe,Xn(Pe),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[Pe,Xn(Pe),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:Pe,overloads:[[[Pe,Pe],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Pe],(i,[e])=>-e.evaluate(i)]]},"/":[Pe,[Pe,Pe],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Pe,[Pe,Pe],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Pe,[],()=>Math.LN2],pi:[Pe,[],()=>Math.PI],e:[Pe,[],()=>Math.E],"^":[Pe,[Pe,Pe],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Pe,[Pe],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Pe,[Pe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Pe,[Pe],(i,[e])=>Math.log(e.evaluate(i))],log2:[Pe,[Pe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Pe,[Pe],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Pe,[Pe],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Pe,[Pe],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Pe,[Pe],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Pe,[Pe],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Pe,[Pe],(i,[e])=>Math.atan(e.evaluate(i))],min:[Pe,Xn(Pe),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Pe,Xn(Pe),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Pe,[Pe],(i,[e])=>Math.abs(e.evaluate(i))],round:[Pe,[Pe],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Pe,[Pe],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Pe,[Pe],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ut,[ct,it],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[ut,[it],(i,[e])=>i.id()===e.value],"filter-type-==":[ut,[ct],(i,[e])=>i.geometryType()===e.value],"filter-<":[ut,[ct,it],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s<c}],"filter-id-<":[ut,[it],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[ut,[ct,it],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s>c}],"filter-id->":[ut,[it],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[ut,[ct,it],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[ut,[it],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[ut,[ct,it],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[ut,[it],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[ut,[it],(i,[e])=>e.value in i.properties()],"filter-has-id":[ut,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ut,[Di(ct)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ut,[Di(it)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ut,[ct,Di(it)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ut,[ct,Di(it)],(i,[e,r])=>function(s,c,f,g){for(;f<=g;){const y=f+g>>1;if(c[y]===s)return!0;c[y]>s?g=y-1:f=y+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ut,overloads:[[[ut,ut],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Xn(ut),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:ut,overloads:[[[ut,ut],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Xn(ut),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[ut,[ut],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ut,[ct],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[ct,[ct],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ct,[ct],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ct,Xn(it),(i,e)=>e.map(r=>Pn(r.evaluate(i))).join("")],"resolved-locale":[ct,[tn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ei{constructor(e,r){var s;this.expression=e,this._warningHistory={},this._evaluator=new Mt,this._defaultValue=r?(s=r).type==="color"&&Fo(s.default)?new rt(0,0,0,0):s.type==="color"?rt.parse(s.default)||null:s.type==="padding"?gr.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?Vi.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,c,f,g){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=c,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,c,f,g){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new ci(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Oo(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in bs}function vt(i,e){const r=new So(bs,Ns,[],e?function(c){const f={color:Ui,string:ct,number:Pe,enum:ct,boolean:ut,formatted:rn,padding:kn,resolvedImage:kr,variableAnchorOffsetCollection:Mn};return c.type==="array"?Di(f[c.value]||it,c.length):f[c.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?ec(new ei(s,e)):ws(r.errors)}class Gs{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!js(r.expression)}evaluateWithoutErrorHandling(e,r,s,c,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,f,g)}evaluate(e,r,s,c,f,g){return this._styleExpression.evaluate(e,r,s,c,f,g)}}class Ut{constructor(e,r,s,c){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!js(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,r,s,c,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,f,g)}evaluate(e,r,s,c,f,g){return this._styleExpression.evaluate(e,r,s,c,f,g)}interpolationFactor(e,r,s){return this.interpolationType?vr.interpolationFactor(this.interpolationType,e,r,s):0}}function Vt(i,e){const r=vt(i,e);if(r.result==="error")return r;const s=r.value.expression,c=Po(s);if(!c&&!Es(e))return ws([new tr("","data expressions not supported")]);const f=qs(s,["zoom"]);if(!f&&!tc(e))return ws([new tr("","zoom expressions not supported")]);const g=Hs(s);return g||f?g instanceof tr?ws([g]):g instanceof vr&&!Ua(e)?ws([new tr("",'"interpolate" expressions cannot be used with this property')]):ec(g?new Ut(c?"camera":"composite",r.value,g.labels,g instanceof vr?g.interpolation:void 0):new Gs(c?"constant":"source",r.value)):ws([new tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Yn{constructor(e,r){this._parameters=e,this._specification=r,Yi(this,ic(this._parameters,this._specification))}static deserialize(e){return new Yn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Hs(i){let e=null;if(i instanceof ys)e=Hs(i.result);else if(i instanceof zo){for(const r of i.args)if(e=Hs(r),e)break}else(i instanceof $s||i instanceof vr)&&i.input instanceof _r&&i.input.name==="zoom"&&(e=i);return e instanceof tr||i.eachChild(r=>{const s=Hs(r);s instanceof tr?e=s:!e&&s?e=new tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new tr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Va(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Va(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const vu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Na(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Va(i)||(i=Ws(i));const e=vt(i,vu);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,c)=>e.value.evaluate(r,s,{},c),needGeometry:ja(i)}}function xu(i,e){return i<e?-1:i>e?1:0}function ja(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(ja(i[e]))return!0;return!1}function Ws(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Uo(i[1],i[2],"=="):e==="!="?No(Uo(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Uo(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Ws))):e==="all"?["all"].concat(i.slice(1).map(Ws)):e==="none"?["all"].concat(i.slice(1).map(Ws).map(No)):e==="in"?qa(i[1],i.slice(2)):e==="!in"?No(qa(i[1],i.slice(2))):e==="has"?Vo(i[1]):e==="!has"?No(Vo(i[1])):e!=="within"||i;var r}function Uo(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function qa(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(xu)]]:["filter-in-small",i,["literal",e]]}}function Vo(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function No(i){return["!",i]}function Za(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let c="[";for(const f of i)c+=`${Za(f)},`;return`${c}]`}const r=Object.keys(i).sort();let s="{";for(let c=0;c<r.length;c++)s+=`${JSON.stringify(r[c])}:${Za(i[r[c]])},`;return`${s}}`}function bu(i){let e="";for(const r of pn)e+=`/${Za(i[r])}`;return e}function nc(i){const e=i.value;return e?[new Me(i.key,e,"constants have been deprecated as of v8")]:[]}function ui(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Jn(i){if(Array.isArray(i))return i.map(Jn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Jn(i[r]);return e}return ui(i)}function Pr(i){const e=i.key,r=i.value,s=i.valueSpec||{},c=i.objectElementValidators||{},f=i.style,g=i.styleSpec,y=i.validateSpec;let b=[];const S=It(r);if(S!=="object")return[new Me(e,r,`object expected, ${S} found`)];for(const k in r){const L=k.split(".")[0],B=s[L]||s["*"];let O;if(c[L])O=c[L];else if(s[L])O=y;else if(c["*"])O=c["*"];else{if(!s["*"]){b.push(new Me(e,r[k],`unknown property "${k}"`));continue}O=y}b=b.concat(O({key:(e&&`${e}.`)+k,value:r[k],valueSpec:B,style:f,styleSpec:g,object:r,objectKey:k,validateSpec:y},r))}for(const k in s)c[k]||s[k].required&&s[k].default===void 0&&r[k]===void 0&&b.push(new Me(e,r,`missing required property "${k}"`));return b}function $a(i){const e=i.value,r=i.valueSpec,s=i.style,c=i.styleSpec,f=i.key,g=i.arrayElementValidator||i.validateSpec;if(It(e)!=="array")return[new Me(f,e,`array expected, ${It(e)} found`)];if(r.length&&e.length!==r.length)return[new Me(f,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Me(f,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values};c.$version<7&&(y.function=r.function),It(r.value)==="object"&&(y=r.value);let b=[];for(let S=0;S<e.length;S++)b=b.concat(g({array:e,arrayIndex:S,value:e[S],valueSpec:y,validateSpec:i.validateSpec,style:s,styleSpec:c,key:`${f}[${S}]`}));return b}function jo(i){const e=i.key,r=i.value,s=i.valueSpec;let c=It(r);return c==="number"&&r!=r&&(c="NaN"),c!=="number"?[new Me(e,r,`number expected, ${c} found`)]:"minimum"in s&&r<s.minimum?[new Me(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new Me(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function Ga(i){const e=i.valueSpec,r=ui(i.value.type);let s,c,f,g={};const y=r!=="categorical"&&i.value.property===void 0,b=!y,S=It(i.value.stops)==="array"&&It(i.value.stops[0])==="array"&&It(i.value.stops[0][0])==="object",k=Pr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(O){if(r==="identity")return[new Me(O.key,O.value,'identity function may not have a "stops" property')];let U=[];const $=O.value;return U=U.concat($a({key:O.key,value:$,valueSpec:O.valueSpec,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:L})),It($)==="array"&&$.length===0&&U.push(new Me(O.key,$,"array must have at least one stop")),U},default:function(O){return O.validateSpec({key:O.key,value:O.value,valueSpec:e,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec})}}});return r==="identity"&&y&&k.push(new Me(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||k.push(new Me(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Ua(i.valueSpec)&&k.push(new Me(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(b&&!Es(i.valueSpec)?k.push(new Me(i.key,i.value,"property functions not supported")):y&&!tc(i.valueSpec)&&k.push(new Me(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!S||i.value.property!==void 0||k.push(new Me(i.key,i.value,'"property" property is required')),k;function L(O){let U=[];const $=O.value,X=O.key;if(It($)!=="array")return[new Me(X,$,`array expected, ${It($)} found`)];if($.length!==2)return[new Me(X,$,`array length 2 expected, length ${$.length} found`)];if(S){if(It($[0])!=="object")return[new Me(X,$,`object expected, ${It($[0])} found`)];if($[0].zoom===void 0)return[new Me(X,$,"object stop key must have zoom")];if($[0].value===void 0)return[new Me(X,$,"object stop key must have value")];if(f&&f>ui($[0].zoom))return[new Me(X,$[0].zoom,"stop zoom values must appear in ascending order")];ui($[0].zoom)!==f&&(f=ui($[0].zoom),c=void 0,g={}),U=U.concat(Pr({key:`${X}[0]`,value:$[0],valueSpec:{zoom:{}},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:jo,value:B}}))}else U=U.concat(B({key:`${X}[0]`,value:$[0],valueSpec:{},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec},$));return Oo(Jn($[1]))?U.concat([new Me(`${X}[1]`,$[1],"expressions are not allowed in function stops.")]):U.concat(O.validateSpec({key:`${X}[1]`,value:$[1],valueSpec:e,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec}))}function B(O,U){const $=It(O.value),X=ui(O.value),J=O.value!==null?O.value:U;if(s){if($!==s)return[new Me(O.key,J,`${$} stop domain type must match previous stop domain type ${s}`)]}else s=$;if($!=="number"&&$!=="string"&&$!=="boolean")return[new Me(O.key,J,"stop domain value must be a number, string, or boolean")];if($!=="number"&&r!=="categorical"){let oe=`number expected, ${$} found`;return Es(e)&&r===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Me(O.key,J,oe)]}return r!=="categorical"||$!=="number"||isFinite(X)&&Math.floor(X)===X?r!=="categorical"&&$==="number"&&c!==void 0&&X<c?[new Me(O.key,J,"stop domain values must appear in ascending order")]:(c=X,r==="categorical"&&X in g?[new Me(O.key,J,"stop domain values must be unique")]:(g[X]=!0,[])):[new Me(O.key,J,`integer expected, found ${X}`)]}}function gn(i){const e=(i.expressionContext==="property"?Vt:vt)(Jn(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new Me(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Me(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!js(r))return[new Me(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!js(r))return[new Me(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!qs(r,["zoom","feature-state"]))return[new Me(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Po(r))return[new Me(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Xs(i){const e=i.key,r=i.value,s=i.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(ui(r))===-1&&c.push(new Me(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(ui(r))===-1&&c.push(new Me(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function qo(i){return Va(Jn(i.value))?gn(Yi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):sc(i)}function sc(i){const e=i.value,r=i.key;if(It(e)!=="array")return[new Me(r,e,`array expected, ${It(e)} found`)];const s=i.styleSpec;let c,f=[];if(e.length<1)return[new Me(r,e,"filter array must have at least 1 element")];switch(f=f.concat(Xs({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),ui(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ui(e[1])==="$type"&&f.push(new Me(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new Me(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=It(e[1]),c!=="string"&&f.push(new Me(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let g=2;g<e.length;g++)c=It(e[g]),ui(e[1])==="$type"?f=f.concat(Xs({key:`${r}[${g}]`,value:e[g],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&f.push(new Me(`${r}[${g}]`,e[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)f=f.concat(sc({key:`${r}[${g}]`,value:e[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=It(e[1]),e.length!==2?f.push(new Me(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&f.push(new Me(`${r}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=It(e[1]),e.length!==2?f.push(new Me(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&f.push(new Me(`${r}[1]`,e[1],`object expected, ${c} found`))}return f}function Zo(i,e){const r=i.key,s=i.validateSpec,c=i.style,f=i.styleSpec,g=i.value,y=i.objectKey,b=f[`${e}_${i.layerType}`];if(!b)return[];const S=y.match(/^(.*)-transition$/);if(e==="paint"&&S&&b[S[1]]&&b[S[1]].transition)return s({key:r,value:g,valueSpec:f.transition,style:c,styleSpec:f});const k=i.valueSpec||b[y];if(!k)return[new Me(r,g,`unknown property "${y}"`)];let L;if(It(g)==="string"&&Es(k)&&!k.tokens&&(L=/^{([^}]+)}$/.exec(g)))return[new Me(r,g,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const B=[];return i.layerType==="symbol"&&(y==="text-field"&&c&&!c.glyphs&&B.push(new Me(r,g,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Fo(Jn(g))&&ui(g.type)==="identity"&&B.push(new Me(r,g,'"text-font" does not support identity functions'))),B.concat(s({key:i.key,value:g,valueSpec:k,style:c,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:y}))}function Ks(i){return Zo(i,"paint")}function $o(i){return Zo(i,"layout")}function Go(i){let e=[];const r=i.value,s=i.key,c=i.style,f=i.styleSpec;r.type||r.ref||e.push(new Me(s,r,'either "type" or "ref" is required'));let g=ui(r.type);const y=ui(r.ref);if(r.id){const b=ui(r.id);for(let S=0;S<i.arrayIndex;S++){const k=c.layers[S];ui(k.id)===b&&e.push(new Me(s,r.id,`duplicate layer id "${r.id}", previously used at line ${k.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(S=>{S in r&&e.push(new Me(s,r[S],`"${S}" is prohibited for ref layers`))}),c.layers.forEach(S=>{ui(S.id)===y&&(b=S)}),b?b.ref?e.push(new Me(s,r.ref,"ref cannot reference another ref layer")):g=ui(b.type):e.push(new Me(s,r.ref,`ref layer "${y}" not found`))}else if(g!=="background")if(r.source){const b=c.sources&&c.sources[r.source],S=b&&ui(b.type);b?S==="vector"&&g==="raster"?e.push(new Me(s,r.source,`layer "${r.id}" requires a raster source`)):S==="raster"&&g!=="raster"?e.push(new Me(s,r.source,`layer "${r.id}" requires a vector source`)):S!=="vector"||r["source-layer"]?S==="raster-dem"&&g!=="hillshade"?e.push(new Me(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!r.paint||!r.paint["line-gradient"]||S==="geojson"&&b.lineMetrics||e.push(new Me(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Me(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Me(s,r.source,`source "${r.source}" not found`))}else e.push(new Me(s,r,'missing required property "source"'));return e=e.concat(Pr({key:s,value:r,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:qo,layout:b=>Pr({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":S=>$o(Yi({layerType:g},S))}}),paint:b=>Pr({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":S=>Ks(Yi({layerType:g},S))}})}})),e}function zn(i){const e=i.value,r=i.key,s=It(e);return s!=="string"?[new Me(r,e,`string expected, ${s} found`)]:[]}const oc={promoteId:function({key:i,value:e}){if(It(e)==="string")return zn({key:i,value:e});{const r=[];for(const s in e)r.push(...zn({key:`${i}.${s}`,value:e[s]}));return r}}};function Ys(i){const e=i.value,r=i.key,s=i.styleSpec,c=i.style,f=i.validateSpec;if(!e.type)return[new Me(r,e,'"type" is required')];const g=ui(e.type);let y;switch(g){case"vector":case"raster":case"raster-dem":return y=Pr({key:r,value:e,valueSpec:s[`source_${g.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:oc,validateSpec:f}),y;case"geojson":if(y=Pr({key:r,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,validateSpec:f,objectElementValidators:oc}),e.cluster)for(const b in e.clusterProperties){const[S,k]=e.clusterProperties[b],L=typeof S=="string"?[S,["accumulated"],["get",b]]:S;y.push(...gn({key:`${r}.${b}.map`,value:k,validateSpec:f,expressionContext:"cluster-map"})),y.push(...gn({key:`${r}.${b}.reduce`,value:L,validateSpec:f,expressionContext:"cluster-reduce"}))}return y;case"video":return Pr({key:r,value:e,valueSpec:s.source_video,style:c,validateSpec:f,styleSpec:s});case"image":return Pr({key:r,value:e,valueSpec:s.source_image,style:c,validateSpec:f,styleSpec:s});case"canvas":return[new Me(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xs({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,validateSpec:f,styleSpec:s})}}function ac(i){const e=i.value,r=i.styleSpec,s=r.light,c=i.style;let f=[];const g=It(e);if(e===void 0)return f;if(g!=="object")return f=f.concat([new Me("light",e,`object expected, ${g} found`)]),f;for(const y in e){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&s[b[1]]&&s[b[1]].transition?i.validateSpec({key:y,value:e[y],valueSpec:r.transition,validateSpec:i.validateSpec,style:c,styleSpec:r}):s[y]?i.validateSpec({key:y,value:e[y],valueSpec:s[y],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new Me(y,e[y],`unknown property "${y}"`)])}return f}function lc(i){const e=i.value,r=i.styleSpec,s=r.terrain,c=i.style;let f=[];const g=It(e);if(e===void 0)return f;if(g!=="object")return f=f.concat([new Me("terrain",e,`object expected, ${g} found`)]),f;for(const y in e)f=f.concat(s[y]?i.validateSpec({key:y,value:e[y],valueSpec:s[y],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new Me(y,e[y],`unknown property "${y}"`)]);return f}function cc(i){let e=[];const r=i.value,s=i.key;if(Array.isArray(r)){const c=[],f=[];for(const g in r)r[g].id&&c.includes(r[g].id)&&e.push(new Me(s,r,`all the sprites' ids must be unique, but ${r[g].id} is duplicated`)),c.push(r[g].id),r[g].url&&f.includes(r[g].url)&&e.push(new Me(s,r,`all the sprites' URLs must be unique, but ${r[g].url} is duplicated`)),f.push(r[g].url),e=e.concat(Pr({key:`${s}[${g}]`,value:r[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return zn({key:s,value:r})}const uc={"*":()=>[],array:$a,boolean:function(i){const e=i.value,r=i.key,s=It(e);return s!=="boolean"?[new Me(r,e,`boolean expected, ${s} found`)]:[]},number:jo,color:function(i){const e=i.key,r=i.value,s=It(r);return s!=="string"?[new Me(e,r,`color expected, ${s} found`)]:rt.parse(String(r))?[]:[new Me(e,r,`color expected, "${r}" found`)]},constants:nc,enum:Xs,filter:qo,function:Ga,layer:Go,object:Pr,source:Ys,light:ac,terrain:lc,string:zn,formatted:function(i){return zn(i).length===0?[]:gn(i)},resolvedImage:function(i){return zn(i).length===0?[]:gn(i)},padding:function(i){const e=i.key,r=i.value;if(It(r)==="array"){if(r.length<1||r.length>4)return[new Me(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let c=[];for(let f=0;f<r.length;f++)c=c.concat(i.validateSpec({key:`${e}[${f}]`,value:r[f],validateSpec:i.validateSpec,valueSpec:s}));return c}return jo({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,s=It(r),c=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new Me(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let g=0;g<r.length;g+=2)f=f.concat(Xs({key:`${e}[${g}]`,value:r[g],valueSpec:c.layout_symbol["text-anchor"]})),f=f.concat($a({key:`${e}[${g+1}]`,value:r[g+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:c}));return f},sprite:cc};function Js(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=Js,r.expression&&Fo(ui(e))?Ga(i):r.expression&&Oo(Jn(e))?gn(i):r.type&&uc[r.type]?uc[r.type](i):Pr(Yi({},i,{valueSpec:r.type?s[r.type]:r}))}function Qs(i){const e=i.value,r=i.key,s=zn(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Me(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Me(r,e,'"glyphs" url must include a "{range}" token'))),s}function xr(i,e=me){let r=[];return r=r.concat(Js({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Js,objectElementValidators:{glyphs:Qs,"*":()=>[]}})),i.constants&&(r=r.concat(nc({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:Js}))),eo(r)}function bi(i){return function(e){return i({...e,validateSpec:Js})}}function eo(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function _n(i){return function(...e){return eo(i.apply(this,e))}}xr.source=_n(bi(Ys)),xr.sprite=_n(bi(cc)),xr.glyphs=_n(bi(Qs)),xr.light=_n(bi(ac)),xr.terrain=_n(bi(lc)),xr.layer=_n(bi(Go)),xr.filter=_n(bi(qo)),xr.paintProperty=_n(bi(Ks)),xr.layoutProperty=_n(bi($o));const to=xr,wu=to.light,io=to.paintProperty,Eu=to.layoutProperty;function Ho(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new mr(new Error(s.message))),r=!0;return r}class ro{constructor(e,r,s){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(r=g[1])+2*(s=g[2]);for(let b=0;b<this.d*this.d;b++){const S=g[3+b],k=g[3+b+1];c.push(S===k?null:g.subarray(S,k))}const y=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],y),this.bboxes=g.subarray(y),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const f=s/r*e;this.min=-f,this.max=e+f}insert(e,r,s,c,f){this._forEachCell(r,s,c,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,c,f,g){this.cells[f].push(g)}query(e,r,s,c,f){const g=this.min,y=this.max;if(e<=g&&r<=g&&y<=s&&y<=c&&!f)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(e,r,s,c,this._queryCell,b,{},f),b}}_queryCell(e,r,s,c,f,g,y,b){const S=this.cells[f];if(S!==null){const k=this.keys,L=this.bboxes;for(let B=0;B<S.length;B++){const O=S[B];if(y[O]===void 0){const U=4*O;(b?b(L[U+0],L[U+1],L[U+2],L[U+3]):e<=L[U+2]&&r<=L[U+3]&&s>=L[U+0]&&c>=L[U+1])?(y[O]=!0,g.push(k[O])):y[O]=!1}}}}_forEachCell(e,r,s,c,f,g,y,b){const S=this._convertToCellCoord(e),k=this._convertToCellCoord(r),L=this._convertToCellCoord(s),B=this._convertToCellCoord(c);for(let O=S;O<=L;O++)for(let U=k;U<=B;U++){const $=this.d*U+O;if((!b||b(this._convertFromCellCoord(O),this._convertFromCellCoord(U),this._convertFromCellCoord(O+1),this._convertFromCellCoord(U+1)))&&f.call(this,e,r,s,c,$,g,y,b))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let g=0;g<this.cells.length;g++)s+=this.cells[g].length;const c=new Int32Array(r+s+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let f=r;for(let g=0;g<e.length;g++){const y=e[g];c[3+g]=f,c.set(y,f),f+=y.length}return c[3+e.length]=f,c.set(this.keys,f),f+=this.keys.length,c[3+e.length+1]=f,c.set(this.bboxes,f),f+=this.bboxes.length,c.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new ro(e.buffer)}}const on={};function Ve(i,e,r={}){if(on[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),on[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Ve("Object",Object),Ve("TransferableGridIndex",ro),Ve("Color",rt),Ve("Error",Error),Ve("AJAXError",Fi),Ve("ResolvedImage",Mr),Ve("StylePropertyFunction",Yn),Ve("StyleExpression",ei,{omit:["_evaluator"]}),Ve("ZoomDependentExpression",Ut),Ve("ZoomConstantExpression",Gs),Ve("CompoundExpression",_r,{omit:["_evaluate"]});for(const i in bs)bs[i]._classRegistryKey||Ve(`Expression_${i}`,bs[i]);function Ts(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function no(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Ts(i)||$t(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(no(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");if(!on[s])throw new Error(`${s} is not registered.`);const c=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in i){if(!i.hasOwnProperty(f)||on[s].omit.indexOf(f)>=0)continue;const g=i[f];c[f]=on[s].shallow.indexOf(f)>=0?g:no(g,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof i)}function Qn(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Ts(i)||$t(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Qn);if(typeof i=="object"){const e=i.$name||"Object";if(!on[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=on[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const f=i[c];s[c]=on[e].shallow.indexOf(c)>=0?f:Qn(f)}return s}throw new Error("can't deserialize object of type "+typeof i)}class Ha{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Re={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Wo(i){for(const e of i)if(so(e.charCodeAt(0)))return!0;return!1}function hc(i){for(const e of i)if(!Tu(e.charCodeAt(0)))return!1;return!0}function Tu(i){return!(Re.Arabic(i)||Re["Arabic Supplement"](i)||Re["Arabic Extended-A"](i)||Re["Arabic Presentation Forms-A"](i)||Re["Arabic Presentation Forms-B"](i))}function so(i){return!(i!==746&&i!==747&&(i<4352||!(Re["Bopomofo Extended"](i)||Re.Bopomofo(i)||Re["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Re["CJK Compatibility Ideographs"](i)||Re["CJK Compatibility"](i)||Re["CJK Radicals Supplement"](i)||Re["CJK Strokes"](i)||!(!Re["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Re["CJK Unified Ideographs Extension A"](i)||Re["CJK Unified Ideographs"](i)||Re["Enclosed CJK Letters and Months"](i)||Re["Hangul Compatibility Jamo"](i)||Re["Hangul Jamo Extended-A"](i)||Re["Hangul Jamo Extended-B"](i)||Re["Hangul Jamo"](i)||Re["Hangul Syllables"](i)||Re.Hiragana(i)||Re["Ideographic Description Characters"](i)||Re.Kanbun(i)||Re["Kangxi Radicals"](i)||Re["Katakana Phonetic Extensions"](i)||Re.Katakana(i)&&i!==12540||!(!Re["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Re["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Re["Unified Canadian Aboriginal Syllabics"](i)||Re["Unified Canadian Aboriginal Syllabics Extended"](i)||Re["Vertical Forms"](i)||Re["Yijing Hexagram Symbols"](i)||Re["Yi Syllables"](i)||Re["Yi Radicals"](i))))}function oo(i){return!(so(i)||function(e){return!!(Re["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Re["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Re["Letterlike Symbols"](e)||Re["Number Forms"](e)||Re["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Re["Control Pictures"](e)&&e!==9251||Re["Optical Character Recognition"](e)||Re["Enclosed Alphanumerics"](e)||Re["Geometric Shapes"](e)||Re["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Re["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Re["CJK Symbols and Punctuation"](e)||Re.Katakana(e)||Re["Private Use Area"](e)||Re["CJK Compatibility Forms"](e)||Re["Small Form Variants"](e)||Re["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Wa(i){return i>=1424&&i<=2303||Re["Arabic Presentation Forms-A"](i)||Re["Arabic Presentation Forms-B"](i)}function Su(i,e){return!(!e&&Wa(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Re.Khmer(i))}function dc(i){for(const e of i)if(Wa(e.charCodeAt(0)))return!0;return!1}const Xa="deferred",ao="loading",Ka="loaded";let Ya=null,rr="unavailable",Dn=null;const Ja=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(rr="error"),Ya&&Ya(i)};function Qa(){el.fire(new Ki("pluginStateChange",{pluginStatus:rr,pluginURL:Dn}))}const el=new Vr,tl=function(){return rr},pc=function(){if(rr!==Xa||!Dn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");rr=ao,Qa(),Dn&&Be({url:Dn},i=>{i?Ja(i):(rr=Ka,Qa())})},Lr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>rr===Ka||Lr.applyArabicShaping!=null,isLoading:()=>rr===ao,setState(i){if(!Zt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");rr=i.pluginStatus,Dn=i.pluginURL},isParsed(){if(!Zt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Lr.applyArabicShaping!=null&&Lr.processBidirectionalText!=null&&Lr.processStyledBidirectionalText!=null},getPluginURL(){if(!Zt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Dn}};class Gt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ha,this.transition={})}isSupportedScript(e){return function(r,s){for(const c of r)if(!Su(c.charCodeAt(0),s))return!1;return!0}(e,Lr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class Xo{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,c){if(Fo(s))return new Yn(s,c);if(Oo(s)){const f=Vt(s,c);if(f.result==="error")throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=s;return c.type==="color"&&typeof s=="string"?f=rt.parse(s):c.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(f=Vi.parse(s)):f=gr.parse(s),{kind:"constant",evaluate:()=>f}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class Ss{constructor(e){this.property=e,this.value=new Xo(e,void 0)}transitioned(e,r){return new Ko(this.property,this.value,r,Ue({},e.transition,this.transition),e.now)}untransitioned(){return new Ko(this.property,this.value,null,{},0)}}class fc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return st(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ss(this._values[e].property)),this._values[e].value=new Xo(this._values[e].property,r===null?void 0:st(r))}getTransition(e){return st(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ss(this._values[e].property)),this._values[e].transition=st(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const c=this.getTransition(r);c!==void 0&&(e[`${r}-transition`]=c)}return e}transitioned(e,r){const s=new mc(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,r._values[c]);return s}untransitioned(){const e=new mc(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Ko{constructor(e,r,s,c,f){this.property=e,this.value=r,this.begin=f+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const c=e.now||0,f=this.value.possiblyEvaluate(e,r,s),g=this.prior;if(g){if(c>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(c<this.begin)return g.possiblyEvaluate(e,r,s);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,r,s),f,function(b){if(b<=0)return 0;if(b>=1)return 1;const S=b*b,k=S*b;return 4*(b<.5?k:3*(b-S)+k-.75)}(y))}}return f}}class mc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const c=new lo(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,r,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Cu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return st(this._values[e].value)}setValue(e,r){this._values[e]=new Xo(this._values[e].property,r===null?void 0:st(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const c=new lo(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,r,s);return c}}class Nr{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,c){return this.property.evaluate(this.value,this.parameters,e,r,s,c)}}class lo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class We{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const c=yr[this.specification.type];return c?c(e,r,s):e}}class et{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,c){return new Nr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,c)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Nr(this,{kind:"constant",value:void 0},e.parameters);const c=yr[this.specification.type];if(c){const f=c(e.value.value,r.value.value,s);return new Nr(this,{kind:"constant",value:f},e.parameters)}return e}evaluate(e,r,s,c,f,g){return e.kind==="constant"?e.value:e.evaluate(r,s,c,f,g)}}class Yo extends et{possiblyEvaluate(e,r,s,c){if(e.value===void 0)return new Nr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},s,c),g=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,y=this._calculate(g,g,g,r);return new Nr(this,{kind:"constant",value:y},r)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Nr(this,{kind:"constant",value:f},r)}return new Nr(this,e.expression,r)}evaluate(e,r,s,c,f,g){if(e.kind==="source"){const y=e.evaluate(r,s,c,f,g);return this._calculate(y,y,y,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,c),e.evaluate({zoom:Math.floor(r.zoom)},s,c),e.evaluate({zoom:Math.floor(r.zoom)+1},s,c),r):e.value}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class il{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},s,c);return this._calculate(f,f,f,r)}return this._calculate(e.expression.evaluate(new Gt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Gt(Math.floor(r.zoom),r)),e.expression.evaluate(new Gt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class rl{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){return!!e.expression.evaluate(r,null,{},s,c)}interpolate(){return!1}}class nr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new Xo(s,void 0),f=this.defaultTransitionablePropertyValues[r]=new Ss(s);this.defaultTransitioningPropertyValues[r]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}Ve("DataDrivenProperty",et),Ve("DataConstantProperty",We),Ve("CrossFadedDataDrivenProperty",Yo),Ve("CrossFadedProperty",il),Ve("ColorRampProperty",rl);const es="-transition";class an extends Vr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Cu(r.layout)),r.paint)){this._transitionablePaint=new fc(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new lo(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(Eu,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(es)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(io,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(es))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const c=this._transitionablePaint._values[e],f=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),y=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||g||f||this._handleOverridablePaintPropertyUpdate(e,y,b)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ht(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,c,f={}){return(!f||f.validate!==!1)&&Ho(this,e.call(to,{key:r,layerType:this.type,objectKey:s,value:c,styleSpec:me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Nr&&Es(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Iu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class co{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function hi(i,e=1){let r=0,s=0;return{members:i.map(c=>{const f=Iu[c.type].BYTES_PER_ELEMENT,g=r=gc(r,Math.max(e,f)),y=c.components||1;return s=Math.max(s,f),r+=f*y,{name:c.name,type:c.type,components:y,offset:g}}),size:gc(r,Math.max(s,e)),alignment:e}}function gc(i,e){return Math.ceil(i/e)*e}class zr extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=s,e}}zr.prototype.bytesPerElement=4,Ve("StructArrayLayout2i4",zr);class uo extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const f=3*e;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=c,e}}uo.prototype.bytesPerElement=6,Ve("StructArrayLayout3i6",uo);class ho extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,c)}emplace(e,r,s,c,f){const g=4*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=c,this.int16[g+3]=f,e}}ho.prototype.bytesPerElement=8,Ve("StructArrayLayout4i8",ho);class Jo extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,c,f,g)}emplace(e,r,s,c,f,g,y){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=c,this.int16[b+3]=f,this.int16[b+4]=g,this.int16[b+5]=y,e}}Jo.prototype.bytesPerElement=12,Ve("StructArrayLayout2i4i12",Jo);class po extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,c,f,g)}emplace(e,r,s,c,f,g,y){const b=4*e,S=8*e;return this.int16[b+0]=r,this.int16[b+1]=s,this.uint8[S+4]=c,this.uint8[S+5]=f,this.uint8[S+6]=g,this.uint8[S+7]=y,e}}po.prototype.bytesPerElement=8,Ve("StructArrayLayout2i4ub8",po);class fo extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=s,e}}fo.prototype.bytesPerElement=8,Ve("StructArrayLayout2f8",fo);class Cs extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,g,y,b,S,k){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,s,c,f,g,y,b,S,k)}emplace(e,r,s,c,f,g,y,b,S,k,L){const B=10*e;return this.uint16[B+0]=r,this.uint16[B+1]=s,this.uint16[B+2]=c,this.uint16[B+3]=f,this.uint16[B+4]=g,this.uint16[B+5]=y,this.uint16[B+6]=b,this.uint16[B+7]=S,this.uint16[B+8]=k,this.uint16[B+9]=L,e}}Cs.prototype.bytesPerElement=20,Ve("StructArrayLayout10ui20",Cs);class ts extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,g,y,b,S,k,L,B){const O=this.length;return this.resize(O+1),this.emplace(O,e,r,s,c,f,g,y,b,S,k,L,B)}emplace(e,r,s,c,f,g,y,b,S,k,L,B,O){const U=12*e;return this.int16[U+0]=r,this.int16[U+1]=s,this.int16[U+2]=c,this.int16[U+3]=f,this.uint16[U+4]=g,this.uint16[U+5]=y,this.uint16[U+6]=b,this.uint16[U+7]=S,this.int16[U+8]=k,this.int16[U+9]=L,this.int16[U+10]=B,this.int16[U+11]=O,e}}ts.prototype.bytesPerElement=24,Ve("StructArrayLayout4i4ui4i24",ts);class nl extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const f=3*e;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=c,e}}nl.prototype.bytesPerElement=12,Ve("StructArrayLayout3f12",nl);class Qo extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Qo.prototype.bytesPerElement=4,Ve("StructArrayLayout1ul4",Qo);class is extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,g,y,b,S){const k=this.length;return this.resize(k+1),this.emplace(k,e,r,s,c,f,g,y,b,S)}emplace(e,r,s,c,f,g,y,b,S,k){const L=10*e,B=5*e;return this.int16[L+0]=r,this.int16[L+1]=s,this.int16[L+2]=c,this.int16[L+3]=f,this.int16[L+4]=g,this.int16[L+5]=y,this.uint32[B+3]=b,this.uint16[L+8]=S,this.uint16[L+9]=k,e}}is.prototype.bytesPerElement=20,Ve("StructArrayLayout6i1ul2ui20",is);class sl extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,c,f,g)}emplace(e,r,s,c,f,g,y){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=c,this.int16[b+3]=f,this.int16[b+4]=g,this.int16[b+5]=y,e}}sl.prototype.bytesPerElement=12,Ve("StructArrayLayout2i2i2i12",sl);class ol extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,s,c,f)}emplace(e,r,s,c,f,g){const y=4*e,b=8*e;return this.float32[y+0]=r,this.float32[y+1]=s,this.float32[y+2]=c,this.int16[b+6]=f,this.int16[b+7]=g,e}}ol.prototype.bytesPerElement=16,Ve("StructArrayLayout2f1f2i16",ol);class ea extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,c)}emplace(e,r,s,c,f){const g=12*e,y=3*e;return this.uint8[g+0]=r,this.uint8[g+1]=s,this.float32[y+1]=c,this.float32[y+2]=f,e}}ea.prototype.bytesPerElement=12,Ve("StructArrayLayout2ub2f12",ea);class ta extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const f=3*e;return this.uint16[f+0]=r,this.uint16[f+1]=s,this.uint16[f+2]=c,e}}ta.prototype.bytesPerElement=6,Ve("StructArrayLayout3ui6",ta);class al extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,g,y,b,S,k,L,B,O,U,$,X,J){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,r,s,c,f,g,y,b,S,k,L,B,O,U,$,X,J)}emplace(e,r,s,c,f,g,y,b,S,k,L,B,O,U,$,X,J,oe){const ie=24*e,le=12*e,ue=48*e;return this.int16[ie+0]=r,this.int16[ie+1]=s,this.uint16[ie+2]=c,this.uint16[ie+3]=f,this.uint32[le+2]=g,this.uint32[le+3]=y,this.uint32[le+4]=b,this.uint16[ie+10]=S,this.uint16[ie+11]=k,this.uint16[ie+12]=L,this.float32[le+7]=B,this.float32[le+8]=O,this.uint8[ue+36]=U,this.uint8[ue+37]=$,this.uint8[ue+38]=X,this.uint32[le+10]=J,this.int16[ie+22]=oe,e}}al.prototype.bytesPerElement=48,Ve("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",al);class St extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,f,g,y,b,S,k,L,B,O,U,$,X,J,oe,ie,le,ue,ye,Oe,Ge,Fe,ze,Ae,je){const ke=this.length;return this.resize(ke+1),this.emplace(ke,e,r,s,c,f,g,y,b,S,k,L,B,O,U,$,X,J,oe,ie,le,ue,ye,Oe,Ge,Fe,ze,Ae,je)}emplace(e,r,s,c,f,g,y,b,S,k,L,B,O,U,$,X,J,oe,ie,le,ue,ye,Oe,Ge,Fe,ze,Ae,je,ke){const Te=32*e,Je=16*e;return this.int16[Te+0]=r,this.int16[Te+1]=s,this.int16[Te+2]=c,this.int16[Te+3]=f,this.int16[Te+4]=g,this.int16[Te+5]=y,this.int16[Te+6]=b,this.int16[Te+7]=S,this.uint16[Te+8]=k,this.uint16[Te+9]=L,this.uint16[Te+10]=B,this.uint16[Te+11]=O,this.uint16[Te+12]=U,this.uint16[Te+13]=$,this.uint16[Te+14]=X,this.uint16[Te+15]=J,this.uint16[Te+16]=oe,this.uint16[Te+17]=ie,this.uint16[Te+18]=le,this.uint16[Te+19]=ue,this.uint16[Te+20]=ye,this.uint16[Te+21]=Oe,this.uint16[Te+22]=Ge,this.uint32[Je+12]=Fe,this.float32[Je+13]=ze,this.float32[Je+14]=Ae,this.uint16[Te+30]=je,this.uint16[Te+31]=ke,e}}St.prototype.bytesPerElement=64,Ve("StructArrayLayout8i15ui1ul2f2ui64",St);class d extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}d.prototype.bytesPerElement=4,Ve("StructArrayLayout1f4",d);class t extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const f=3*e;return this.uint16[6*e+0]=r,this.float32[f+1]=s,this.float32[f+2]=c,e}}t.prototype.bytesPerElement=12,Ve("StructArrayLayout1ui2f12",t);class n extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const f=4*e;return this.uint32[2*e+0]=r,this.uint16[f+2]=s,this.uint16[f+3]=c,e}}n.prototype.bytesPerElement=8,Ve("StructArrayLayout1ul2ui8",n);class l extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=s,e}}l.prototype.bytesPerElement=4,Ve("StructArrayLayout2ui4",l);class h extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}h.prototype.bytesPerElement=2,Ve("StructArrayLayout1ui2",h);class m extends Xt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,c)}emplace(e,r,s,c,f){const g=4*e;return this.float32[g+0]=r,this.float32[g+1]=s,this.float32[g+2]=c,this.float32[g+3]=f,e}}m.prototype.bytesPerElement=16,Ve("StructArrayLayout4f16",m);class v extends co{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new j(this.anchorPointX,this.anchorPointY)}}v.prototype.size=20;class x extends is{get(e){return new v(this,e)}}Ve("CollisionBoxArray",x);class E extends co{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}E.prototype.size=48;class C extends al{get(e){return new E(this,e)}}Ve("PlacedSymbolArray",C);class I extends co{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}I.prototype.size=64;class P extends St{get(e){return new I(this,e)}}Ve("SymbolInstanceArray",P);class F extends d{getoffsetX(e){return this.float32[1*e+0]}}Ve("GlyphOffsetArray",F);class Z extends uo{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ve("SymbolLineVertexArray",Z);class q extends co{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}q.prototype.size=12;class H extends t{get(e){return new q(this,e)}}Ve("TextAnchorOffsetArray",H);class N extends co{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}N.prototype.size=8;class re extends n{get(e){return new N(this,e)}}Ve("FeatureIndexArray",re);class ce extends zr{}class Y extends zr{}class ne extends zr{}class de extends Jo{}class pe extends po{}class _e extends fo{}class Ee extends Cs{}class we extends ts{}class Ie extends nl{}class $e extends Qo{}class ft extends sl{}class Le extends ea{}class Ke extends ta{}class qe extends l{}const Ht=hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:mt}=Ht;class Ye{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,c){let f=this.segments[this.segments.length-1];return e>Ye.MAX_VERTEX_ARRAY_LENGTH&&_t(`Max vertices per segment is ${Ye.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Ye.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==c)&&(f={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},c!==void 0&&(f.sortKey=c),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,c){return new Ye([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}function gt(i,e){return 256*(i=Se(Math.floor(i),0,255))+Se(Math.floor(e),0,255)}Ye.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ve("SegmentVector",Ye);const Kt=hi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Pt={exports:{}},br={exports:{}};br.exports=function(i,e){var r,s,c,f,g,y,b,S;for(s=i.length-(r=3&i.length),c=e,g=3432918353,y=461845907,S=0;S<s;)b=255&i.charCodeAt(S)|(255&i.charCodeAt(++S))<<8|(255&i.charCodeAt(++S))<<16|(255&i.charCodeAt(++S))<<24,++S,c=27492+(65535&(f=5*(65535&(c=(c^=b=(65535&(b=(b=(65535&b)*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&i.charCodeAt(S+2))<<16;case 2:b^=(255&i.charCodeAt(S+1))<<8;case 1:c^=b=(65535&(b=(b=(65535&(b^=255&i.charCodeAt(S)))*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295}return c^=i.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Ri=br.exports,ii={exports:{}};ii.exports=function(i,e){for(var r,s=i.length,c=e^s,f=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(f)|(255&i.charCodeAt(++f))<<8|(255&i.charCodeAt(++f))<<16|(255&i.charCodeAt(++f))<<24))+((1540483477*(r>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++f;switch(s){case 3:c^=(255&i.charCodeAt(f+2))<<16;case 2:c^=(255&i.charCodeAt(f+1))<<8;case 1:c=1540483477*(65535&(c^=255&i.charCodeAt(f)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var sr=Ri,ln=ii.exports;Pt.exports=sr,Pt.exports.murmur3=sr,Pt.exports.murmur2=ln;var jr=z(Pt.exports);class cn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,c){this.ids.push(Is(e)),this.positions.push(r,s,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Is(e);let s=0,c=this.ids.length-1;for(;s<c;){const g=s+c>>1;this.ids[g]>=r?c=g:s=g+1}const f=[];for(;this.ids[s]===r;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(e,r){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Bn(s,c,0,s.length-1),r&&r.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const r=new cn;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Is(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:jr(String(i))}function Bn(i,e,r,s){for(;r<s;){const c=i[r+s>>1];let f=r-1,g=s+1;for(;;){do f++;while(i[f]<c);do g--;while(i[g]>c);if(f>=g)break;yn(i,f,g),yn(e,3*f,3*g),yn(e,3*f+1,3*g+1),yn(e,3*f+2,3*g+2)}g-r<s-g?(Bn(i,e,r,g),r=g+1):(Bn(i,e,g+1,s),s=g)}}function yn(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}Ve("FeaturePositionMap",cn);class di{constructor(e,r){this.gl=e.gl,this.location=r}}class Ai extends di{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ji extends di{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class As extends di{constructor(e,r){super(e,r),this.current=rt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ki=new Float32Array(16);function wi(i){return[gt(255*i.r,255*i.g),gt(255*i.b,255*i.a)]}class qi{constructor(e,r,s){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new As(e,r):new Ai(e,r)}}class Yt{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,s,c){const f=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"?new ji(e,r):new Ai(e,r)}}class vn{constructor(e,r,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,s,c,f){const g=this.paintVertexArray.length,y=this.expression.evaluate(new Gt(0),r,{},c,[],f);this.paintVertexArray.resize(e),this._setPaintValue(g,e,y)}updatePaintArray(e,r,s,c){const f=this.expression.evaluate({zoom:0},s,c);this._setPaintValue(e,r,f)}_setPaintValue(e,r,s){if(this.type==="color"){const c=wi(s);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qr{constructor(e,r,s,c,f,g){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,r,s,c,f){const g=this.expression.evaluate(new Gt(this.zoom),r,{},c,[],f),y=this.expression.evaluate(new Gt(this.zoom+1),r,{},c,[],f),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,g,y)}updatePaintArray(e,r,s,c){const f=this.expression.evaluate({zoom:this.zoom},s,c),g=this.expression.evaluate({zoom:this.zoom+1},s,c);this._setPaintValue(e,r,f,g)}_setPaintValue(e,r,s,c){if(this.type==="color"){const f=wi(s),g=wi(c);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,f[0],f[1],g[0],g[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=Se(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,r,s){return new Ai(e,r)}}class Rn{constructor(e,r,s,c,f,g){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,r,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,c,f){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],f)}_setPaintValues(e,r,s,c){if(!c||!s)return;const{min:f,mid:g,max:y}=s,b=c[f],S=c[g],k=c[y];if(b&&S&&k)for(let L=e;L<r;L++)this.zoomInPaintVertexArray.emplace(L,S.tl[0],S.tl[1],S.br[0],S.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],S.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,S.tl[0],S.tl[1],S.br[0],S.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],S.pixelRatio,k.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Kt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Kt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class _c{constructor(e,r,s){this.binders={},this._buffers=[];const c=[];for(const f in e.paint._values){if(!s(f))continue;const g=e.paint.get(f);if(!(g instanceof Nr&&Es(g.property.specification)))continue;const y=Au(f,e.type),b=g.value,S=g.property.specification.type,k=g.property.useIntegerZoom,L=g.property.specification["property-type"],B=L==="cross-faded"||L==="cross-faded-data-driven";if(b.kind==="constant")this.binders[f]=B?new Yt(b.value,y):new qi(b.value,y,S),c.push(`/u_${f}`);else if(b.kind==="source"||B){const O=ns(f,S,"source");this.binders[f]=B?new Rn(b,S,k,r,O,e.id):new vn(b,y,S,O),c.push(`/a_${f}`)}else{const O=ns(f,S,"composite");this.binders[f]=new qr(b,y,S,k,r,O),c.push(`/z_${f}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof vn||r instanceof qr?r.maxValue:0}populatePaintArrays(e,r,s,c,f){for(const g in this.binders){const y=this.binders[g];(y instanceof vn||y instanceof qr||y instanceof Rn)&&y.populatePaintArray(e,r,s,c,f)}}setConstantPatternPositions(e,r){for(const s in this.binders){const c=this.binders[s];c instanceof Yt&&c.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,c,f){let g=!1;for(const y in e){const b=r.getPositions(y);for(const S of b){const k=s.feature(S.index);for(const L in this.binders){const B=this.binders[L];if((B instanceof vn||B instanceof qr||B instanceof Rn)&&B.expression.isStateDependent===!0){const O=c.paint.get(L);B.expression=O.value,B.updatePaintArray(S.start,S.end,k,e[y],f),g=!0}}}}return g}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof qi||s instanceof Yt)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof vn||s instanceof qr)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name);else if(s instanceof Rn)for(let c=0;c<Kt.members.length;c++)e.push(Kt.members[c].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof qi||s instanceof Yt||s instanceof qr)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof qi||f instanceof Yt||f instanceof qr){for(const g of f.uniformNames)if(r[g]){const y=f.getBinding(e,r[g],g);s.push({name:g,property:c,binding:y})}}}return s}setUniforms(e,r,s,c){for(const{name:f,property:g,binding:y}of r)this.binders[g].setUniform(y,c,s.get(g),f)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof Rn){const c=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof vn||s instanceof qr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof vn||s instanceof qr||s instanceof Rn)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof vn||r instanceof qr||r instanceof Rn)&&r.destroy()}}}class rs{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new _c(c,r,s);this.needsUpload=!1,this._featureMap=new cn,this._bufferOffset=0}populatePaintArrays(e,r,s,c,f,g){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(e,r,c,f,g);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,c){for(const f of s)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,r,f,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Au(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function ns(i,e,r){const s={color:{source:fo,composite:m},number:{source:d,composite:fo}},c=function(f){return{"line-pattern":{source:Ee,composite:Ee},"fill-pattern":{source:Ee,composite:Ee},"fill-extrusion-pattern":{source:Ee,composite:Ee}}[f]}(i);return c&&c[r]||s[e][r]}Ve("ConstantBinder",qi),Ve("CrossFadedConstantBinder",Yt),Ve("SourceExpressionBinder",vn),Ve("CrossFadedCompositeBinder",Rn),Ve("CompositeExpressionBinder",qr),Ve("ProgramConfiguration",_c,{omit:["_buffers"]}),Ve("ProgramConfigurationSet",rs);const ti=8192,ia=Math.pow(2,14)-1,ll=-ia-1;function xn(i){const e=ti/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const c=r[s];for(let f=0;f<c.length;f++){const g=c[f],y=Math.round(g.x*e),b=Math.round(g.y*e);g.x=Se(y,ll,ia),g.y=Se(b,ll,ia),(y<g.x||y>g.x+1||b<g.y||b>g.y+1)&&_t("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Fn(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?xn(i):[]}}function ks(i,e,r,s,c){i.emplaceBack(2*e+(s+1)/2,2*r+(c+1)/2)}class ku{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Y,this.indexArray=new Ke,this.segments=new Ye,this.programConfigurations=new rs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const c=this.layers[0],f=[];let g=null,y=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),y=!g.isConstant());for(const{feature:b,id:S,index:k,sourceLayerIndex:L}of e){const B=this.layers[0]._featureFilter.needGeometry,O=Fn(b,B);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),O,s))continue;const U=y?g.evaluate(O,{},s):void 0,$={id:S,properties:b.properties,type:b.type,sourceLayerIndex:L,index:k,geometry:B?O.geometry:xn(b),patterns:{},sortKey:U};f.push($)}y&&f.sort((b,S)=>b.sortKey-S.sortKey);for(const b of f){const{geometry:S,index:k,sourceLayerIndex:L}=b,B=e[k].feature;this.addFeature(b,S,k,s),r.featureIndex.insert(B,S,k,L,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,c){for(const f of r)for(const g of f){const y=g.x,b=g.y;if(y<0||y>=ti||b<0||b>=ti)continue;const S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),k=S.vertexLength;ks(this.layoutVertexArray,y,b,-1,-1),ks(this.layoutVertexArray,y,b,1,-1),ks(this.layoutVertexArray,y,b,1,1),ks(this.layoutVertexArray,y,b,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+3,k+2),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c)}}function Gh(i,e){for(let r=0;r<i.length;r++)if(ra(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(ra(i,e[r]))return!0;return!!Mu(i,e)}function om(i,e,r){return!!ra(i,e)||!!Pu(e,i,r)}function Hh(i,e){if(i.length===1)return Xh(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let c=0;c<s.length;c++)if(ra(i,s[c]))return!0}for(let r=0;r<i.length;r++)if(Xh(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Mu(i,e[r]))return!0;return!1}function am(i,e,r){if(i.length>1){if(Mu(i,e))return!0;for(let s=0;s<e.length;s++)if(Pu(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Pu(i[s],e,r))return!0;return!1}function Mu(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],c=i[r+1];for(let f=0;f<e.length-1;f++)if(lm(s,c,e[f],e[f+1]))return!0}return!1}function lm(i,e,r,s){return tt(i,r,s)!==tt(e,r,s)&&tt(i,e,r)!==tt(i,e,s)}function Pu(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(Wh(i,e[c-1],e[c])<s)return!0;return!1}function Wh(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const c=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function Xh(i,e){let r,s,c,f=!1;for(let g=0;g<i.length;g++){r=i[g];for(let y=0,b=r.length-1;y<r.length;b=y++)s=r[y],c=r[b],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(f=!f)}return f}function ra(i,e){let r=!1;for(let s=0,c=i.length-1;s<i.length;c=s++){const f=i[s],g=i[c];f.y>e.y!=g.y>e.y&&e.x<(g.x-f.x)*(e.y-f.y)/(g.y-f.y)+f.x&&(r=!r)}return r}function cm(i,e,r){const s=r[0],c=r[2];if(i.x<s.x&&e.x<s.x||i.x>c.x&&e.x>c.x||i.y<s.y&&e.y<s.y||i.y>c.y&&e.y>c.y)return!1;const f=tt(i,e,r[0]);return f!==tt(i,e,r[1])||f!==tt(i,e,r[2])||f!==tt(i,e,r[3])}function cl(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function yc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function vc(i,e,r,s,c){if(!e[0]&&!e[1])return i;const f=j.convert(e)._mult(c);r==="viewport"&&f._rotate(-s);const g=[];for(let y=0;y<i.length;y++)g.push(i[y].sub(f));return g}let Kh,Yh;Ve("CircleBucket",ku,{omit:["layers"]});var um={get paint(){return Yh=Yh||new nr({"circle-radius":new et(me.paint_circle["circle-radius"]),"circle-color":new et(me.paint_circle["circle-color"]),"circle-blur":new et(me.paint_circle["circle-blur"]),"circle-opacity":new et(me.paint_circle["circle-opacity"]),"circle-translate":new We(me.paint_circle["circle-translate"]),"circle-translate-anchor":new We(me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new We(me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new We(me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new et(me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new et(me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new et(me.paint_circle["circle-stroke-opacity"])})},get layout(){return Kh=Kh||new nr({"circle-sort-key":new et(me.layout_circle["circle-sort-key"])})}},or=1e-6,na=typeof Float32Array<"u"?Float32Array:Array;function Lu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Jh(i,e,r){var s=e[0],c=e[1],f=e[2],g=e[3],y=e[4],b=e[5],S=e[6],k=e[7],L=e[8],B=e[9],O=e[10],U=e[11],$=e[12],X=e[13],J=e[14],oe=e[15],ie=r[0],le=r[1],ue=r[2],ye=r[3];return i[0]=ie*s+le*y+ue*L+ye*$,i[1]=ie*c+le*b+ue*B+ye*X,i[2]=ie*f+le*S+ue*O+ye*J,i[3]=ie*g+le*k+ue*U+ye*oe,i[4]=(ie=r[4])*s+(le=r[5])*y+(ue=r[6])*L+(ye=r[7])*$,i[5]=ie*c+le*b+ue*B+ye*X,i[6]=ie*f+le*S+ue*O+ye*J,i[7]=ie*g+le*k+ue*U+ye*oe,i[8]=(ie=r[8])*s+(le=r[9])*y+(ue=r[10])*L+(ye=r[11])*$,i[9]=ie*c+le*b+ue*B+ye*X,i[10]=ie*f+le*S+ue*O+ye*J,i[11]=ie*g+le*k+ue*U+ye*oe,i[12]=(ie=r[12])*s+(le=r[13])*y+(ue=r[14])*L+(ye=r[15])*$,i[13]=ie*c+le*b+ue*B+ye*X,i[14]=ie*f+le*S+ue*O+ye*J,i[15]=ie*g+le*k+ue*U+ye*oe,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var ul,hm=Jh;function xc(i,e,r){var s=e[0],c=e[1],f=e[2],g=e[3];return i[0]=r[0]*s+r[4]*c+r[8]*f+r[12]*g,i[1]=r[1]*s+r[5]*c+r[9]*f+r[13]*g,i[2]=r[2]*s+r[6]*c+r[10]*f+r[14]*g,i[3]=r[3]*s+r[7]*c+r[11]*f+r[15]*g,i}ul=new na(4),na!=Float32Array&&(ul[0]=0,ul[1]=0,ul[2]=0,ul[3]=0);class dm extends an{constructor(e){super(e,um)}createBucket(e){return new ku(e)}queryRadius(e){const r=e;return cl("circle-radius",this,r)+cl("circle-stroke-width",this,r)+yc(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,s,c,f,g,y,b){const S=vc(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,y),k=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),L=this.paint.get("circle-pitch-alignment")==="map",B=L?S:function(U,$){return U.map(X=>Qh(X,$))}(S,b),O=L?k*y:k;for(const U of c)for(const $ of U){const X=L?$:Qh($,b);let J=O;const oe=xc([],[$.x,$.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?J*=oe[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(J*=g.cameraToCenterDistance/oe[3]),om(B,X,J))return!0}return!1}}function Qh(i,e){const r=xc([],[i.x,i.y,0,1],e);return new j(r[0]/r[3],r[1]/r[3])}class ed extends ku{}let td;Ve("HeatmapBucket",ed,{omit:["layers"]});var pm={get paint(){return td=td||new nr({"heatmap-radius":new et(me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new et(me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new We(me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rl(me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new We(me.paint_heatmap["heatmap-opacity"])})}};function zu(i,{width:e,height:r},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*r*s}`)}else c=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=c,i}function id(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const c=zu({},{width:e,height:r},s);Du(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=c.data}function Du(i,e,r,s,c,f){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||r.x>i.width-c.width||r.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=i.data,y=e.data;if(g===y)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<c.height;b++){const S=((r.y+b)*i.width+r.x)*f,k=((s.y+b)*e.width+s.x)*f;for(let L=0;L<c.width*f;L++)y[k+L]=g[S+L]}return e}class hl{constructor(e,r){zu(this,e,1,r)}resize(e){id(this,e,1)}clone(){return new hl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,f){Du(e,r,s,c,f,1)}}class Zr{constructor(e,r){zu(this,e,4,r)}resize(e){id(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Zr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,f){Du(e,r,s,c,f,4)}}function rd(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,c=i.image||new Zr({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const f=(g,y,b)=>{e[i.evaluationKey]=b;const S=i.expression.evaluate(e);c.data[g+y+0]=Math.floor(255*S.r/S.a),c.data[g+y+1]=Math.floor(255*S.g/S.a),c.data[g+y+2]=Math.floor(255*S.b/S.a),c.data[g+y+3]=Math.floor(255*S.a)};if(i.clips)for(let g=0,y=0;g<s;++g,y+=4*r)for(let b=0,S=0;b<r;b++,S+=4){const k=b/(r-1),{start:L,end:B}=i.clips[g];f(y,S,L*(1-k)+B*k)}else for(let g=0,y=0;g<r;g++,y+=4)f(0,y,g/(r-1));return c}Ve("AlphaImage",hl),Ve("RGBAImage",Zr);class fm extends an{createBucket(e){return new ed(e)}constructor(e){super(e,pm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let nd;var mm={get paint(){return nd=nd||new nr({"hillshade-illumination-direction":new We(me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new We(me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new We(me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new We(me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new We(me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new We(me.paint_hillshade["hillshade-accent-color"])})}};class gm extends an{constructor(e){super(e,mm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const _m=hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:ym}=_m;var Bu={exports:{}};function bc(i,e,r){r=r||2;var s,c,f,g,y,b,S,k=e&&e.length,L=k?e[0]*r:i.length,B=sd(i,0,L,r,!0),O=[];if(!B||B.next===B.prev)return O;if(k&&(B=function($,X,J,oe){var ie,le,ue,ye=[];for(ie=0,le=X.length;ie<le;ie++)(ue=sd($,X[ie]*oe,ie<le-1?X[ie+1]*oe:$.length,oe,!1))===ue.next&&(ue.steiner=!0),ye.push(Cm(ue));for(ye.sort(Em),ie=0;ie<ye.length;ie++)J=Tm(ye[ie],J);return J}(i,e,B,r)),i.length>80*r){s=f=i[0],c=g=i[1];for(var U=r;U<L;U+=r)(y=i[U])<s&&(s=y),(b=i[U+1])<c&&(c=b),y>f&&(f=y),b>g&&(g=b);S=(S=Math.max(f-s,g-c))!==0?32767/S:0}return dl(B,O,r,s,c,S,0),O}function sd(i,e,r,s,c){var f,g;if(c===Ou(i,e,r,s)>0)for(f=e;f<r;f+=s)g=ld(f,i[f],i[f+1],g);else for(f=r-s;f>=e;f-=s)g=ld(f,i[f],i[f+1],g);return g&&wc(g,g.next)&&(fl(g),g=g.next),g}function mo(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!wc(s,s.next)&&pi(s.prev,s,s.next)!==0)s=s.next;else{if(fl(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function dl(i,e,r,s,c,f,g){if(i){!g&&f&&function(k,L,B,O){var U=k;do U.z===0&&(U.z=Ru(U.x,U.y,L,B,O)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==k);U.prevZ.nextZ=null,U.prevZ=null,function($){var X,J,oe,ie,le,ue,ye,Oe,Ge=1;do{for(J=$,$=null,le=null,ue=0;J;){for(ue++,oe=J,ye=0,X=0;X<Ge&&(ye++,oe=oe.nextZ);X++);for(Oe=Ge;ye>0||Oe>0&&oe;)ye!==0&&(Oe===0||!oe||J.z<=oe.z)?(ie=J,J=J.nextZ,ye--):(ie=oe,oe=oe.nextZ,Oe--),le?le.nextZ=ie:$=ie,ie.prevZ=le,le=ie;J=oe}le.nextZ=null,Ge*=2}while(ue>1)}(U)}(i,s,c,f);for(var y,b,S=i;i.prev!==i.next;)if(y=i.prev,b=i.next,f?xm(i,s,c,f):vm(i))e.push(y.i/r|0),e.push(i.i/r|0),e.push(b.i/r|0),fl(i),i=b.next,S=b.next;else if((i=b)===S){g?g===1?dl(i=bm(mo(i),e,r),e,r,s,c,f,2):g===2&&wm(i,e,r,s,c,f):dl(mo(i),e,r,s,c,f,1);break}}}function vm(i){var e=i.prev,r=i,s=i.next;if(pi(e,r,s)>=0)return!1;for(var c=e.x,f=r.x,g=s.x,y=e.y,b=r.y,S=s.y,k=c<f?c<g?c:g:f<g?f:g,L=y<b?y<S?y:S:b<S?b:S,B=c>f?c>g?c:g:f>g?f:g,O=y>b?y>S?y:S:b>S?b:S,U=s.next;U!==e;){if(U.x>=k&&U.x<=B&&U.y>=L&&U.y<=O&&sa(c,y,f,b,g,S,U.x,U.y)&&pi(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function xm(i,e,r,s){var c=i.prev,f=i,g=i.next;if(pi(c,f,g)>=0)return!1;for(var y=c.x,b=f.x,S=g.x,k=c.y,L=f.y,B=g.y,O=y<b?y<S?y:S:b<S?b:S,U=k<L?k<B?k:B:L<B?L:B,$=y>b?y>S?y:S:b>S?b:S,X=k>L?k>B?k:B:L>B?L:B,J=Ru(O,U,e,r,s),oe=Ru($,X,e,r,s),ie=i.prevZ,le=i.nextZ;ie&&ie.z>=J&&le&&le.z<=oe;){if(ie.x>=O&&ie.x<=$&&ie.y>=U&&ie.y<=X&&ie!==c&&ie!==g&&sa(y,k,b,L,S,B,ie.x,ie.y)&&pi(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,le.x>=O&&le.x<=$&&le.y>=U&&le.y<=X&&le!==c&&le!==g&&sa(y,k,b,L,S,B,le.x,le.y)&&pi(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;ie&&ie.z>=J;){if(ie.x>=O&&ie.x<=$&&ie.y>=U&&ie.y<=X&&ie!==c&&ie!==g&&sa(y,k,b,L,S,B,ie.x,ie.y)&&pi(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;le&&le.z<=oe;){if(le.x>=O&&le.x<=$&&le.y>=U&&le.y<=X&&le!==c&&le!==g&&sa(y,k,b,L,S,B,le.x,le.y)&&pi(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function bm(i,e,r){var s=i;do{var c=s.prev,f=s.next.next;!wc(c,f)&&od(c,s,s.next,f)&&pl(c,f)&&pl(f,c)&&(e.push(c.i/r|0),e.push(s.i/r|0),e.push(f.i/r|0),fl(s),fl(s.next),s=i=f),s=s.next}while(s!==i);return mo(s)}function wm(i,e,r,s,c,f){var g=i;do{for(var y=g.next.next;y!==g.prev;){if(g.i!==y.i&&Im(g,y)){var b=ad(g,y);return g=mo(g,g.next),b=mo(b,b.next),dl(g,e,r,s,c,f,0),void dl(b,e,r,s,c,f,0)}y=y.next}g=g.next}while(g!==i)}function Em(i,e){return i.x-e.x}function Tm(i,e){var r=function(c,f){var g,y=f,b=c.x,S=c.y,k=-1/0;do{if(S<=y.y&&S>=y.next.y&&y.next.y!==y.y){var L=y.x+(S-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(L<=b&&L>k&&(k=L,g=y.x<y.next.x?y:y.next,L===b))return g}y=y.next}while(y!==f);if(!g)return null;var B,O=g,U=g.x,$=g.y,X=1/0;y=g;do b>=y.x&&y.x>=U&&b!==y.x&&sa(S<$?b:k,S,U,$,S<$?k:b,S,y.x,y.y)&&(B=Math.abs(S-y.y)/(b-y.x),pl(y,c)&&(B<X||B===X&&(y.x>g.x||y.x===g.x&&Sm(g,y)))&&(g=y,X=B)),y=y.next;while(y!==O);return g}(i,e);if(!r)return e;var s=ad(r,i);return mo(s,s.next),mo(r,r.next)}function Sm(i,e){return pi(i.prev,i,e.prev)<0&&pi(e.next,i,i.next)<0}function Ru(i,e,r,s,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Cm(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function sa(i,e,r,s,c,f,g,y){return(c-g)*(e-y)>=(i-g)*(f-y)&&(i-g)*(s-y)>=(r-g)*(e-y)&&(r-g)*(f-y)>=(c-g)*(s-y)}function Im(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==s.i&&c.next.i!==s.i&&od(c,c.next,r,s))return!0;c=c.next}while(c!==r);return!1}(i,e)&&(pl(i,e)&&pl(e,i)&&function(r,s){var c=r,f=!1,g=(r.x+s.x)/2,y=(r.y+s.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&g<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next;while(c!==r);return f}(i,e)&&(pi(i.prev,i,e.prev)||pi(i,e.prev,e))||wc(i,e)&&pi(i.prev,i,i.next)>0&&pi(e.prev,e,e.next)>0)}function pi(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function wc(i,e){return i.x===e.x&&i.y===e.y}function od(i,e,r,s){var c=Tc(pi(i,e,r)),f=Tc(pi(i,e,s)),g=Tc(pi(r,s,i)),y=Tc(pi(r,s,e));return c!==f&&g!==y||!(c!==0||!Ec(i,r,e))||!(f!==0||!Ec(i,s,e))||!(g!==0||!Ec(r,i,s))||!(y!==0||!Ec(r,e,s))}function Ec(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Tc(i){return i>0?1:i<0?-1:0}function pl(i,e){return pi(i.prev,i,i.next)<0?pi(i,e,i.next)>=0&&pi(i,i.prev,e)>=0:pi(i,e,i.prev)<0||pi(i,i.next,e)<0}function ad(i,e){var r=new Fu(i.i,i.x,i.y),s=new Fu(e.i,e.x,e.y),c=i.next,f=e.prev;return i.next=e,e.prev=i,r.next=c,c.prev=r,s.next=r,r.prev=s,f.next=s,s.prev=f,s}function ld(i,e,r,s){var c=new Fu(i,e,r);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function fl(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Fu(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ou(i,e,r,s){for(var c=0,f=e,g=r-s;f<r;f+=s)c+=(i[g]-i[f])*(i[f+1]+i[g+1]),g=f;return c}Bu.exports=bc,Bu.exports.default=bc,bc.deviation=function(i,e,r,s){var c=e&&e.length,f=Math.abs(Ou(i,0,c?e[0]*r:i.length,r));if(c)for(var g=0,y=e.length;g<y;g++)f-=Math.abs(Ou(i,e[g]*r,g<y-1?e[g+1]*r:i.length,r));var b=0;for(g=0;g<s.length;g+=3){var S=s[g]*r,k=s[g+1]*r,L=s[g+2]*r;b+=Math.abs((i[S]-i[L])*(i[k+1]-i[S+1])-(i[S]-i[k])*(i[L+1]-i[S+1]))}return f===0&&b===0?0:Math.abs((b-f)/f)},bc.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,c=0;c<i.length;c++){for(var f=0;f<i[c].length;f++)for(var g=0;g<e;g++)r.vertices.push(i[c][f][g]);c>0&&r.holes.push(s+=i[c-1].length)}return r};var cd=z(Bu.exports);function Am(i,e,r,s,c){ud(i,e,r||0,s||i.length-1,c||km)}function ud(i,e,r,s,c){for(;s>r;){if(s-r>600){var f=s-r+1,g=e-r+1,y=Math.log(f),b=.5*Math.exp(2*y/3),S=.5*Math.sqrt(y*b*(f-b)/f)*(g-f/2<0?-1:1);ud(i,e,Math.max(r,Math.floor(e-g*b/f+S)),Math.min(s,Math.floor(e+(f-g)*b/f+S)),c)}var k=i[e],L=r,B=s;for(ml(i,r,e),c(i[s],k)>0&&ml(i,r,s);L<B;){for(ml(i,L,B),L++,B--;c(i[L],k)<0;)L++;for(;c(i[B],k)>0;)B--}c(i[r],k)===0?ml(i,r,B):ml(i,++B,s),B<=e&&(r=B+1),e<=B&&(s=B-1)}}function ml(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function km(i,e){return i<e?-1:i>e?1:0}function Uu(i,e){const r=i.length;if(r<=1)return[i];const s=[];let c,f;for(let g=0;g<r;g++){const y=gi(i[g]);y!==0&&(i[g].area=Math.abs(y),f===void 0&&(f=y<0),f===y<0?(c&&s.push(c),c=[i[g]]):c.push(i[g]))}if(c&&s.push(c),e>1)for(let g=0;g<s.length;g++)s[g].length<=e||(Am(s[g],e,1,s[g].length-1,Mm),s[g]=s[g].slice(0,e));return s}function Mm(i,e){return e.area-i.area}function Vu(i,e,r){const s=r.patternDependencies;let c=!1;for(const f of e){const g=f.paint.get(`${i}-pattern`);g.isConstant()||(c=!0);const y=g.constantOr(null);y&&(c=!0,s[y.to]=!0,s[y.from]=!0)}return c}function Nu(i,e,r,s,c){const f=c.patternDependencies;for(const g of e){const y=g.paint.get(`${i}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:s-1},r,{},c.availableImages),S=y.evaluate({zoom:s},r,{},c.availableImages),k=y.evaluate({zoom:s+1},r,{},c.availableImages);b=b&&b.name?b.name:b,S=S&&S.name?S.name:S,k=k&&k.name?k.name:k,f[b]=!0,f[S]=!0,f[k]=!0,r.patterns[g.id]={min:b,mid:S,max:k}}}return r}class ju{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ne,this.indexArray=new Ke,this.indexArray2=new qe,this.programConfigurations=new rs(e.layers,e.zoom),this.segments=new Ye,this.segments2=new Ye,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Vu("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),f=!c.isConstant(),g=[];for(const{feature:y,id:b,index:S,sourceLayerIndex:k}of e){const L=this.layers[0]._featureFilter.needGeometry,B=Fn(y,L);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),B,s))continue;const O=f?c.evaluate(B,{},s,r.availableImages):void 0,U={id:b,properties:y.properties,type:y.type,sourceLayerIndex:k,index:S,geometry:L?B.geometry:xn(y),patterns:{},sortKey:O};g.push(U)}f&&g.sort((y,b)=>y.sortKey-b.sortKey);for(const y of g){const{geometry:b,index:S,sourceLayerIndex:k}=y;if(this.hasPattern){const L=Nu("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(y,b,S,s,{});r.featureIndex.insert(e[S].feature,b,S,k,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ym),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,c,f){for(const g of Uu(r,500)){let y=0;for(const O of g)y+=O.length;const b=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),S=b.vertexLength,k=[],L=[];for(const O of g){if(O.length===0)continue;O!==g[0]&&L.push(k.length/2);const U=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),$=U.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack($+O.length-1,$),k.push(O[0].x),k.push(O[0].y);for(let X=1;X<O.length;X++)this.layoutVertexArray.emplaceBack(O[X].x,O[X].y),this.indexArray2.emplaceBack($+X-1,$+X),k.push(O[X].x),k.push(O[X].y);U.vertexLength+=O.length,U.primitiveLength+=O.length}const B=cd(k,L);for(let O=0;O<B.length;O+=3)this.indexArray.emplaceBack(S+B[O],S+B[O+1],S+B[O+2]);b.vertexLength+=y,b.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,c)}}let hd,dd;Ve("FillBucket",ju,{omit:["layers","patternFeatures"]});var Pm={get paint(){return dd=dd||new nr({"fill-antialias":new We(me.paint_fill["fill-antialias"]),"fill-opacity":new et(me.paint_fill["fill-opacity"]),"fill-color":new et(me.paint_fill["fill-color"]),"fill-outline-color":new et(me.paint_fill["fill-outline-color"]),"fill-translate":new We(me.paint_fill["fill-translate"]),"fill-translate-anchor":new We(me.paint_fill["fill-translate-anchor"]),"fill-pattern":new Yo(me.paint_fill["fill-pattern"])})},get layout(){return hd=hd||new nr({"fill-sort-key":new et(me.layout_fill["fill-sort-key"])})}};class Lm extends an{constructor(e){super(e,Pm)}recalculate(e,r){super.recalculate(e,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new ju(e)}queryRadius(){return yc(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,s,c,f,g,y){return Hh(vc(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,y),c)}isTileClipped(){return!0}}const zm=hi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Dm=hi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Bm}=zm;var Ms={},Rm=A,pd=oa;function oa(i,e,r,s,c){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=c,i.readFields(Fm,this,e)}function Fm(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,c){for(var f=s.readVarint()+s.pos;s.pos<f;){var g=c._keys[s.readVarint()],y=c._values[s.readVarint()];c.properties[g]=y}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function Om(i){for(var e,r,s=0,c=0,f=i.length,g=f-1;c<f;g=c++)s+=((r=i[g]).x-(e=i[c]).x)*(e.y+r.y);return s}oa.types=["Unknown","Point","LineString","Polygon"],oa.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,c=0,f=0,g=0,y=[];i.pos<r;){if(c<=0){var b=i.readVarint();s=7&b,c=b>>3}if(c--,s===1||s===2)f+=i.readSVarint(),g+=i.readSVarint(),s===1&&(e&&y.push(e),e=[]),e.push(new Rm(f,g));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&y.push(e),y},oa.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,c=0,f=0,g=1/0,y=-1/0,b=1/0,S=-1/0;i.pos<e;){if(s<=0){var k=i.readVarint();r=7&k,s=k>>3}if(s--,r===1||r===2)(c+=i.readSVarint())<g&&(g=c),c>y&&(y=c),(f+=i.readSVarint())<b&&(b=f),f>S&&(S=f);else if(r!==7)throw new Error("unknown command "+r)}return[g,b,y,S]},oa.prototype.toGeoJSON=function(i,e,r){var s,c,f=this.extent*Math.pow(2,r),g=this.extent*i,y=this.extent*e,b=this.loadGeometry(),S=oa.types[this.type];function k(O){for(var U=0;U<O.length;U++){var $=O[U];O[U]=[360*($.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(s=0;s<b.length;s++)L[s]=b[s][0];k(b=L);break;case 2:for(s=0;s<b.length;s++)k(b[s]);break;case 3:for(b=function(O){var U=O.length;if(U<=1)return[O];for(var $,X,J=[],oe=0;oe<U;oe++){var ie=Om(O[oe]);ie!==0&&(X===void 0&&(X=ie<0),X===ie<0?($&&J.push($),$=[O[oe]]):$.push(O[oe]))}return $&&J.push($),J}(b),s=0;s<b.length;s++)for(c=0;c<b[s].length;c++)k(b[s][c])}b.length===1?b=b[0]:S="Multi"+S;var B={type:"Feature",geometry:{type:S,coordinates:b},properties:this.properties};return"id"in this&&(B.id=this.id),B};var Um=pd,fd=md;function md(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Vm,this,e),this.length=this._features.length}function Vm(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var c=null,f=s.readVarint()+s.pos;s.pos<f;){var g=s.readVarint()>>3;c=g===1?s.readString():g===2?s.readFloat():g===3?s.readDouble():g===4?s.readVarint64():g===5?s.readVarint():g===6?s.readSVarint():g===7?s.readBoolean():null}return c}(r))}md.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Um(this._pbf,e,this.extent,this._keys,this._values)};var Nm=fd;function jm(i,e,r){if(i===3){var s=new Nm(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}Ms.VectorTile=function(i,e){this.layers=i.readFields(jm,{},e)},Ms.VectorTileFeature=pd,Ms.VectorTileLayer=fd;const qm=Ms.VectorTileFeature.types,qu=Math.pow(2,13);function gl(i,e,r,s,c,f,g,y){i.emplaceBack(e,r,2*Math.floor(s*qu)+g,c*qu*2,f*qu*2,Math.round(y))}class Zu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new de,this.centroidVertexArray=new ce,this.indexArray=new Ke,this.programConfigurations=new rs(e.layers,e.zoom),this.segments=new Ye,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasPattern=Vu("fill-extrusion",this.layers,r);for(const{feature:c,id:f,index:g,sourceLayerIndex:y}of e){const b=this.layers[0]._featureFilter.needGeometry,S=Fn(c,b);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),S,s))continue;const k={id:f,sourceLayerIndex:y,index:g,geometry:b?S.geometry:xn(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Nu("fill-extrusion",this.layers,k,this.zoom,r)):this.addFeature(k,k.geometry,g,s,{}),r.featureIndex.insert(c,k.geometry,g,y,this.index,!0)}}addFeatures(e,r,s){for(const c of this.features){const{geometry:f}=c;this.addFeature(c,f,c.index,r,s)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bm),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Dm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,c,f){const g={x:0,y:0,vertexCount:0};for(const y of Uu(r,500)){let b=0;for(const U of y)b+=U.length;let S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const U of y){if(U.length===0||$m(U))continue;let $=0;for(let X=0;X<U.length;X++){const J=U[X];if(X>=1){const oe=U[X-1];if(!Zm(J,oe)){S.vertexLength+4>Ye.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ie=J.sub(oe)._perp()._unit(),le=oe.dist(J);$+le>32768&&($=0),gl(this.layoutVertexArray,J.x,J.y,ie.x,ie.y,0,0,$),gl(this.layoutVertexArray,J.x,J.y,ie.x,ie.y,0,1,$),g.x+=2*J.x,g.y+=2*J.y,g.vertexCount+=2,$+=le,gl(this.layoutVertexArray,oe.x,oe.y,ie.x,ie.y,0,0,$),gl(this.layoutVertexArray,oe.x,oe.y,ie.x,ie.y,0,1,$),g.x+=2*oe.x,g.y+=2*oe.y,g.vertexCount+=2;const ue=S.vertexLength;this.indexArray.emplaceBack(ue,ue+2,ue+1),this.indexArray.emplaceBack(ue+1,ue+2,ue+3),S.vertexLength+=4,S.primitiveLength+=2}}}}if(S.vertexLength+b>Ye.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),qm[e.type]!=="Polygon")continue;const k=[],L=[],B=S.vertexLength;for(const U of y)if(U.length!==0){U!==y[0]&&L.push(k.length/2);for(let $=0;$<U.length;$++){const X=U[$];gl(this.layoutVertexArray,X.x,X.y,0,0,1,1,0),g.x+=X.x,g.y+=X.y,g.vertexCount+=1,k.push(X.x),k.push(X.y)}}const O=cd(k,L);for(let U=0;U<O.length;U+=3)this.indexArray.emplaceBack(B+O[U],B+O[U+2],B+O[U+1]);S.primitiveLength+=O.length/3,S.vertexLength+=b}for(let y=0;y<g.vertexCount;y++)this.centroidVertexArray.emplaceBack(Math.floor(g.x/g.vertexCount),Math.floor(g.y/g.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,c)}}function Zm(i,e){return i.x===e.x&&(i.x<0||i.x>ti)||i.y===e.y&&(i.y<0||i.y>ti)}function $m(i){return i.every(e=>e.x<0)||i.every(e=>e.x>ti)||i.every(e=>e.y<0)||i.every(e=>e.y>ti)}let gd;Ve("FillExtrusionBucket",Zu,{omit:["layers","features"]});var Gm={get paint(){return gd=gd||new nr({"fill-extrusion-opacity":new We(me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new et(me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new We(me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new We(me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Yo(me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new et(me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new et(me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new We(me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Hm extends an{constructor(e){super(e,Gm)}createBucket(e){return new Zu(e)}queryRadius(){return yc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,s,c,f,g,y,b){const S=vc(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,y),k=this.paint.get("fill-extrusion-height").evaluate(r,s),L=this.paint.get("fill-extrusion-base").evaluate(r,s),B=function(U,$,X,J){const oe=[];for(const ie of U){const le=[ie.x,ie.y,0,1];xc(le,le,$),oe.push(new j(le[0]/le[3],le[1]/le[3]))}return oe}(S,b),O=function(U,$,X,J){const oe=[],ie=[],le=J[8]*$,ue=J[9]*$,ye=J[10]*$,Oe=J[11]*$,Ge=J[8]*X,Fe=J[9]*X,ze=J[10]*X,Ae=J[11]*X;for(const je of U){const ke=[],Te=[];for(const Je of je){const He=Je.x,dt=Je.y,Nt=J[0]*He+J[4]*dt+J[12],Wt=J[1]*He+J[5]*dt+J[13],Pi=J[2]*He+J[6]*dt+J[14],Dr=J[3]*He+J[7]*dt+J[15],ar=Pi+ye,Ei=Dr+Oe,zi=Nt+Ge,$i=Wt+Fe,Er=Pi+ze,lr=Dr+Ae,Ti=new j((Nt+le)/Ei,(Wt+ue)/Ei);Ti.z=ar/Ei,ke.push(Ti);const Li=new j(zi/lr,$i/lr);Li.z=Er/lr,Te.push(Li)}oe.push(ke),ie.push(Te)}return[oe,ie]}(c,L,k,b);return function(U,$,X){let J=1/0;Hh(X,$)&&(J=_d(X,$[0]));for(let oe=0;oe<$.length;oe++){const ie=$[oe],le=U[oe];for(let ue=0;ue<ie.length-1;ue++){const ye=ie[ue],Oe=[ye,ie[ue+1],le[ue+1],le[ue],ye];Gh(X,Oe)&&(J=Math.min(J,_d(X,Oe)))}}return J!==1/0&&J}(O[0],O[1],B)}}function _l(i,e){return i.x*e.x+i.y*e.y}function _d(i,e){if(i.length===1){let r=0;const s=e[r++];let c;for(;!c||s.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const f=e[r],g=i[0],y=c.sub(s),b=f.sub(s),S=g.sub(s),k=_l(y,y),L=_l(y,b),B=_l(b,b),O=_l(S,y),U=_l(S,b),$=k*B-L*L,X=(B*O-L*U)/$,J=(k*U-L*O)/$,oe=s.z*(1-X-J)+c.z*X+f.z*J;if(isFinite(oe))return oe}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const Wm=hi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Xm}=Wm,Km=hi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ym}=Km,Jm=Ms.VectorTileFeature.types,Qm=Math.cos(Math.PI/180*37.5),yd=Math.pow(2,14)/.5;class $u{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new pe,this.layoutVertexArray2=new _e,this.indexArray=new Ke,this.programConfigurations=new rs(e.layers,e.zoom),this.segments=new Ye,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Vu("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),f=!c.isConstant(),g=[];for(const{feature:y,id:b,index:S,sourceLayerIndex:k}of e){const L=this.layers[0]._featureFilter.needGeometry,B=Fn(y,L);if(!this.layers[0]._featureFilter.filter(new Gt(this.zoom),B,s))continue;const O=f?c.evaluate(B,{},s):void 0,U={id:b,properties:y.properties,type:y.type,sourceLayerIndex:k,index:S,geometry:L?B.geometry:xn(y),patterns:{},sortKey:O};g.push(U)}f&&g.sort((y,b)=>y.sortKey-b.sortKey);for(const y of g){const{geometry:b,index:S,sourceLayerIndex:k}=y;if(this.hasPattern){const L=Nu("line",this.layers,y,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(y,b,S,s,{});r.featureIndex.insert(e[S].feature,b,S,k,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Ym)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,c,f){const g=this.layers[0].layout,y=g.get("line-join").evaluate(e,{}),b=g.get("line-cap"),S=g.get("line-miter-limit"),k=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of r)this.addLine(L,e,y,b,S,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,c)}addLine(e,r,s,c,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<e.length-1;J++)this.totalDistance+=e[J].dist(e[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=Jm[r.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let S=0;for(;S<b-1&&e[S].equals(e[S+1]);)S++;if(b<(y?3:2))return;s==="bevel"&&(f=1.05);const k=this.overscaling<=16?15*ti/(512*this.overscaling):0,L=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let B,O,U,$,X;this.e1=this.e2=-1,y&&(B=e[b-2],X=e[S].sub(B)._unit()._perp());for(let J=S;J<b;J++){if(U=J===b-1?y?e[S+1]:void 0:e[J+1],U&&e[J].equals(U))continue;X&&($=X),B&&(O=B),B=e[J],X=U?U.sub(B)._unit()._perp():$,$=$||X;let oe=$.add(X);oe.x===0&&oe.y===0||oe._unit();const ie=$.x*X.x+$.y*X.y,le=oe.x*X.x+oe.y*X.y,ue=le!==0?1/le:1/0,ye=2*Math.sqrt(2-2*le),Oe=le<Qm&&O&&U,Ge=$.x*X.y-$.y*X.x>0;if(Oe&&J>S){const Ae=B.dist(O);if(Ae>2*k){const je=B.sub(B.sub(O)._mult(k/Ae)._round());this.updateDistance(O,je),this.addCurrentVertex(je,$,0,0,L),O=je}}const Fe=O&&U;let ze=Fe?s:y?"butt":c;if(Fe&&ze==="round"&&(ue<g?ze="miter":ue<=2&&(ze="fakeround")),ze==="miter"&&ue>f&&(ze="bevel"),ze==="bevel"&&(ue>2&&(ze="flipbevel"),ue<f&&(ze="miter")),O&&this.updateDistance(O,B),ze==="miter")oe._mult(ue),this.addCurrentVertex(B,oe,0,0,L);else if(ze==="flipbevel"){if(ue>100)oe=X.mult(-1);else{const Ae=ue*$.add(X).mag()/$.sub(X).mag();oe._perp()._mult(Ae*(Ge?-1:1))}this.addCurrentVertex(B,oe,0,0,L),this.addCurrentVertex(B,oe.mult(-1),0,0,L)}else if(ze==="bevel"||ze==="fakeround"){const Ae=-Math.sqrt(ue*ue-1),je=Ge?Ae:0,ke=Ge?0:Ae;if(O&&this.addCurrentVertex(B,$,je,ke,L),ze==="fakeround"){const Te=Math.round(180*ye/Math.PI/20);for(let Je=1;Je<Te;Je++){let He=Je/Te;if(He!==.5){const Nt=He-.5;He+=He*Nt*(He-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*Nt*Nt+(.848013+ie*(.215638*ie-1.06021)))}const dt=X.sub($)._mult(He)._add($)._unit()._mult(Ge?-1:1);this.addHalfVertex(B,dt.x,dt.y,!1,Ge,0,L)}}U&&this.addCurrentVertex(B,X,-je,-ke,L)}else if(ze==="butt")this.addCurrentVertex(B,oe,0,0,L);else if(ze==="square"){const Ae=O?1:-1;this.addCurrentVertex(B,oe,Ae,Ae,L)}else ze==="round"&&(O&&(this.addCurrentVertex(B,$,0,0,L),this.addCurrentVertex(B,$,1,1,L,!0)),U&&(this.addCurrentVertex(B,X,-1,-1,L,!0),this.addCurrentVertex(B,X,0,0,L)));if(Oe&&J<b-1){const Ae=B.dist(U);if(Ae>2*k){const je=B.add(U.sub(B)._mult(k/Ae)._round());this.updateDistance(B,je),this.addCurrentVertex(je,X,0,0,L),B=je}}}}addCurrentVertex(e,r,s,c,f,g=!1){const y=r.y*c-r.x,b=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,g,!1,s,f),this.addHalfVertex(e,y,b,g,!0,-c,f),this.distance>yd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,s,c,f,g))}addHalfVertex({x:e,y:r},s,c,f,g,y,b){const S=.5*(this.lineClips?this.scaledDistance*(yd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(r<<1)+(g?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1)|(63&S)<<2,S>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const k=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),b.primitiveLength++),g?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let vd,xd;Ve("LineBucket",$u,{omit:["layers","patternFeatures"]});var bd={get paint(){return xd=xd||new nr({"line-opacity":new et(me.paint_line["line-opacity"]),"line-color":new et(me.paint_line["line-color"]),"line-translate":new We(me.paint_line["line-translate"]),"line-translate-anchor":new We(me.paint_line["line-translate-anchor"]),"line-width":new et(me.paint_line["line-width"]),"line-gap-width":new et(me.paint_line["line-gap-width"]),"line-offset":new et(me.paint_line["line-offset"]),"line-blur":new et(me.paint_line["line-blur"]),"line-dasharray":new il(me.paint_line["line-dasharray"]),"line-pattern":new Yo(me.paint_line["line-pattern"]),"line-gradient":new rl(me.paint_line["line-gradient"])})},get layout(){return vd=vd||new nr({"line-cap":new We(me.layout_line["line-cap"]),"line-join":new et(me.layout_line["line-join"]),"line-miter-limit":new We(me.layout_line["line-miter-limit"]),"line-round-limit":new We(me.layout_line["line-round-limit"]),"line-sort-key":new et(me.layout_line["line-sort-key"])})}};class eg extends et{possiblyEvaluate(e,r){return r=new Gt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,s,c){return r=Ue({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,s,c)}}let Sc;class tg extends an{constructor(e){super(e,bd),this.gradientVersion=0,Sc||(Sc=new eg(bd.paint.properties["line-width"].specification),Sc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){e==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof $s,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Sc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new $u(e)}queryRadius(e){const r=e,s=wd(cl("line-width",this,r),cl("line-gap-width",this,r)),c=cl("line-offset",this,r);return s/2+Math.abs(c)+yc(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,s,c,f,g,y){const b=vc(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,y),S=y/2*wd(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),k=this.paint.get("line-offset").evaluate(r,s);return k&&(c=function(L,B){const O=[];for(let U=0;U<L.length;U++){const $=L[U],X=[];for(let J=0;J<$.length;J++){const oe=$[J-1],ie=$[J],le=$[J+1],ue=J===0?new j(0,0):ie.sub(oe)._unit()._perp(),ye=J===$.length-1?new j(0,0):le.sub(ie)._unit()._perp(),Oe=ue._add(ye)._unit(),Ge=Oe.x*ye.x+Oe.y*ye.y;Ge!==0&&Oe._mult(1/Ge),X.push(Oe._mult(B)._add(ie))}O.push(X)}return O}(c,k*y)),function(L,B,O){for(let U=0;U<B.length;U++){const $=B[U];if(L.length>=3){for(let X=0;X<$.length;X++)if(ra(L,$[X]))return!0}if(am(L,$,O))return!0}return!1}(b,c,S)}isTileClipped(){return!0}}function wd(i,e){return e>0?e+2*i:i}const ig=hi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rg=hi([{name:"a_projected_pos",components:3,type:"Float32"}],4);hi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ng=hi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);hi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ed=hi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sg=hi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function og(i,e,r){return i.sections.forEach(s=>{s.text=function(c,f,g){const y=f.layout.get("text-transform").evaluate(g,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),Lr.applyArabicShaping&&(c=Lr.applyArabicShaping(c)),c}(s.text,e,r)}),i}hi([{name:"triangle",components:3,type:"Uint16"}]),hi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),hi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),hi([{type:"Float32",name:"offsetX"}]),hi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),hi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const yl={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Mi=24,Td=Dt,Sd=function(i,e,r,s,c){var f,g,y=8*c-s-1,b=(1<<y)-1,S=b>>1,k=-7,L=r?c-1:0,B=r?-1:1,O=i[e+L];for(L+=B,f=O&(1<<-k)-1,O>>=-k,k+=y;k>0;f=256*f+i[e+L],L+=B,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=s;k>0;g=256*g+i[e+L],L+=B,k-=8);if(f===0)f=1-S;else{if(f===b)return g?NaN:1/0*(O?-1:1);g+=Math.pow(2,s),f-=S}return(O?-1:1)*g*Math.pow(2,f-s)},Cd=function(i,e,r,s,c,f){var g,y,b,S=8*f-c-1,k=(1<<S)-1,L=k>>1,B=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=s?0:f-1,U=s?1:-1,$=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,g=k):(g=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-g))<1&&(g--,b*=2),(e+=g+L>=1?B/b:B*Math.pow(2,1-L))*b>=2&&(g++,b/=2),g+L>=k?(y=0,g=k):g+L>=1?(y=(e*b-1)*Math.pow(2,c),g+=L):(y=e*Math.pow(2,L-1)*Math.pow(2,c),g=0));c>=8;i[r+O]=255&y,O+=U,y/=256,c-=8);for(g=g<<c|y,S+=c;S>0;i[r+O]=255&g,O+=U,g/=256,S-=8);i[r+O-U]|=128*$};function Dt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Dt.Varint=0,Dt.Fixed64=1,Dt.Bytes=2,Dt.Fixed32=5;var Gu=4294967296,Id=1/Gu,Ad=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ss(i){return i.type===Dt.Bytes?i.readVarint()+i.pos:i.pos+1}function aa(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function kd(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var c=r.pos-1;c>=i;c--)r.buf[c+s]=r.buf[c]}function ag(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function lg(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function cg(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function ug(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function hg(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function dg(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function pg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function fg(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function mg(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Cc(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function la(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Md(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Dt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),c=s>>3,f=this.pos;this.type=7&s,i(c,e,this),this.pos===f&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Cc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Md(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Cc(this.buf,this.pos)+Cc(this.buf,this.pos+4)*Gu;return this.pos+=8,i},readSFixed64:function(){var i=Cc(this.buf,this.pos)+Md(this.buf,this.pos+4)*Gu;return this.pos+=8,i},readFloat:function(){var i=Sd(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Sd(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(c,f,g){var y,b,S=g.buf;if(y=(112&(b=S[g.pos++]))>>4,b<128||(y|=(127&(b=S[g.pos++]))<<3,b<128)||(y|=(127&(b=S[g.pos++]))<<10,b<128)||(y|=(127&(b=S[g.pos++]))<<17,b<128)||(y|=(127&(b=S[g.pos++]))<<24,b<128)||(y|=(1&(b=S[g.pos++]))<<31,b<128))return aa(c,y,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Ad?function(r,s,c){return Ad.decode(r.subarray(s,c))}(this.buf,e,i):function(r,s,c){for(var f="",g=s;g<c;){var y,b,S,k=r[g],L=null,B=k>239?4:k>223?3:k>191?2:1;if(g+B>c)break;B===1?k<128&&(L=k):B===2?(192&(y=r[g+1]))==128&&(L=(31&k)<<6|63&y)<=127&&(L=null):B===3?(b=r[g+2],(192&(y=r[g+1]))==128&&(192&b)==128&&((L=(15&k)<<12|(63&y)<<6|63&b)<=2047||L>=55296&&L<=57343)&&(L=null)):B===4&&(b=r[g+2],S=r[g+3],(192&(y=r[g+1]))==128&&(192&b)==128&&(192&S)==128&&((L=(15&k)<<18|(63&y)<<12|(63&b)<<6|63&S)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,B=1):L>65535&&(L-=65536,f+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),f+=String.fromCharCode(L),g+=B}return f}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Dt.Bytes)return i.push(this.readVarint(e));var r=ss(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Dt.Bytes)return i.push(this.readSVarint());var e=ss(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Dt.Bytes)return i.push(this.readBoolean());var e=ss(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Dt.Bytes)return i.push(this.readFloat());var e=ss(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Dt.Bytes)return i.push(this.readDouble());var e=ss(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Dt.Bytes)return i.push(this.readFixed32());var e=ss(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Dt.Bytes)return i.push(this.readSFixed32());var e=ss(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Dt.Bytes)return i.push(this.readFixed64());var e=ss(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Dt.Bytes)return i.push(this.readSFixed64());var e=ss(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Dt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Dt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Dt.Fixed32)this.pos+=4;else{if(e!==Dt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),la(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),la(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),la(this.buf,-1&i,this.pos),la(this.buf,Math.floor(i*Id),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),la(this.buf,-1&i,this.pos),la(this.buf,Math.floor(i*Id),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,c;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(f,g,y){y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7)}(s,0,r),function(f,g){var y=(7&f)<<4;g.buf[g.pos++]|=y|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(c,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,c,f){for(var g,y,b=0;b<c.length;b++){if((g=c.charCodeAt(b))>55295&&g<57344){if(!y){g>56319||b+1===c.length?(s[f++]=239,s[f++]=191,s[f++]=189):y=g;continue}if(g<56320){s[f++]=239,s[f++]=191,s[f++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(s[f++]=239,s[f++]=191,s[f++]=189,y=null);g<128?s[f++]=g:(g<2048?s[f++]=g>>6|192:(g<65536?s[f++]=g>>12|224:(s[f++]=g>>18|240,s[f++]=g>>12&63|128),s[f++]=g>>6&63|128),s[f++]=63&g|128)}return f}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&kd(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Cd(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Cd(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&kd(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Dt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,ag,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,lg,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,hg,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,cg,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,ug,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,dg,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,pg,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,fg,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,mg,e)},writeBytesField:function(i,e){this.writeTag(i,Dt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Dt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Dt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Dt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Dt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Dt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Dt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Dt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Dt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Dt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Hu=z(Td);const Wu=3;function gg(i,e,r){i===1&&r.readMessage(_g,e)}function _g(i,e,r){if(i===3){const{id:s,bitmap:c,width:f,height:g,left:y,top:b,advance:S}=r.readMessage(yg,{});e.push({id:s,bitmap:new hl({width:f+2*Wu,height:g+2*Wu},c),metrics:{width:f,height:g,left:y,top:b,advance:S}})}}function yg(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const Pd=Wu;function Ld(i){let e=0,r=0;for(const g of i)e+=g.w*g.h,r=Math.max(r,g.w);i.sort((g,y)=>y.h-g.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,f=0;for(const g of i)for(let y=s.length-1;y>=0;y--){const b=s[y];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,f=Math.max(f,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===b.w&&g.h===b.h){const S=s.pop();y<s.length&&(s[y]=S)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(s.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:c,h:f,fill:e/(c*f)||0}}const wr=1;class Xu{constructor(e,{pixelRatio:r,version:s,stretchX:c,stretchY:f,content:g}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=f,this.content=g,this.version=s}get tl(){return[this.paddedRect.x+wr,this.paddedRect.y+wr]}get br(){return[this.paddedRect.x+this.paddedRect.w-wr,this.paddedRect.y+this.paddedRect.h-wr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*wr)/this.pixelRatio,(this.paddedRect.h-2*wr)/this.pixelRatio]}}class zd{constructor(e,r){const s={},c={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,s,f),this.addImages(r,c,f);const{w:g,h:y}=Ld(f),b=new Zr({width:g||1,height:y||1});for(const S in e){const k=e[S],L=s[S].paddedRect;Zr.copy(k.data,b,{x:0,y:0},{x:L.x+wr,y:L.y+wr},k.data)}for(const S in r){const k=r[S],L=c[S].paddedRect,B=L.x+wr,O=L.y+wr,U=k.data.width,$=k.data.height;Zr.copy(k.data,b,{x:0,y:0},{x:B,y:O},k.data),Zr.copy(k.data,b,{x:0,y:$-1},{x:B,y:O-1},{width:U,height:1}),Zr.copy(k.data,b,{x:0,y:0},{x:B,y:O+$},{width:U,height:1}),Zr.copy(k.data,b,{x:U-1,y:0},{x:B-1,y:O},{width:1,height:$}),Zr.copy(k.data,b,{x:0,y:0},{x:B+U,y:O},{width:1,height:$})}this.image=b,this.iconPositions=s,this.patternPositions=c}addImages(e,r,s){for(const c in e){const f=e[c],g={x:0,y:0,w:f.data.width+2*wr,h:f.data.height+2*wr};s.push(g),r[c]=new Xu(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,f]=e.tl;s.update(r.data,void 0,{x:c,y:f})}}var Ps;Ve("ImagePosition",Xu),Ve("ImageAtlas",zd),o.WritingMode=void 0,(Ps=o.WritingMode||(o.WritingMode={}))[Ps.none=0]="none",Ps[Ps.horizontal=1]="horizontal",Ps[Ps.vertical=2]="vertical",Ps[Ps.horizontalOnly=3]="horizontalOnly";const vl=-17;class xl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new xl;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new xl;return r.imageName=e,r}}class ca{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new ca;for(let c=0;c<e.sections.length;c++){const f=e.sections[c];f.image?s.addImageSection(f):s.addTextSection(f,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let s=0;s<e.length;s++){const c=e.charCodeAt(s+1)||null,f=e.charCodeAt(s-1)||null;r+=c&&oo(c)&&!yl[e[s+1]]||f&&oo(f)&&!yl[e[s-1]]||!yl[e[s]]?e[s]:yl[e[s]]}return r}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&Ac[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Ac[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new ca;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(xl.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void _t("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(xl.forImage(r)),this.sectionIndex.push(this.sections.length-1)):_t("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ic(i,e,r,s,c,f,g,y,b,S,k,L,B,O,U,$){const X=ca.fromFeature(i,c);let J;L===o.WritingMode.vertical&&X.verticalizePunctuation();const{processBidirectionalText:oe,processStyledBidirectionalText:ie}=Lr;if(oe&&X.sections.length===1){J=[];const ye=oe(X.toString(),Ku(X,S,f,e,s,O,U));for(const Oe of ye){const Ge=new ca;Ge.text=Oe,Ge.sections=X.sections;for(let Fe=0;Fe<Oe.length;Fe++)Ge.sectionIndex.push(0);J.push(Ge)}}else if(ie){J=[];const ye=ie(X.text,X.sectionIndex,Ku(X,S,f,e,s,O,U));for(const Oe of ye){const Ge=new ca;Ge.text=Oe[0],Ge.sectionIndex=Oe[1],Ge.sections=X.sections,J.push(Ge)}}else J=function(ye,Oe){const Ge=[],Fe=ye.text;let ze=0;for(const Ae of Oe)Ge.push(ye.substring(ze,Ae)),ze=Ae;return ze<Fe.length&&Ge.push(ye.substring(ze,Fe.length)),Ge}(X,Ku(X,S,f,e,s,O,U));const le=[],ue={positionedLines:le,text:X.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(ye,Oe,Ge,Fe,ze,Ae,je,ke,Te,Je,He,dt){let Nt=0,Wt=vl,Pi=0,Dr=0;const ar=ke==="right"?1:ke==="left"?0:.5;let Ei=0;for(const Ti of ze){Ti.trim();const Li=Ti.getMaxScale(),Ji=(Li-1)*Mi,cr={positionedGlyphs:[],lineOffset:0};ye.positionedLines[Ei]=cr;const Tr=cr.positionedGlyphs;let Sr=0;if(!Ti.length()){Wt+=Ae,++Ei;continue}for(let Gi=0;Gi<Ti.length();Gi++){const bt=Ti.getSection(Gi),Br=Ti.getSectionIndex(Gi),Hi=Ti.getCharCode(Gi);let ur=0,un=null,bn=null,wn=null,os=Mi;const hn=!(Te===o.WritingMode.horizontal||!He&&!so(Hi)||He&&(Ac[Hi]||(zi=Hi,Re.Arabic(zi)||Re["Arabic Supplement"](zi)||Re["Arabic Extended-A"](zi)||Re["Arabic Presentation Forms-A"](zi)||Re["Arabic Presentation Forms-B"](zi))));if(bt.imageName){const Gr=Fe[bt.imageName];if(!Gr)continue;wn=bt.imageName,ye.iconsInText=ye.iconsInText||!0,bn=Gr.paddedRect;const Cr=Gr.displaySize;bt.scale=bt.scale*Mi/dt,un={width:Cr[0],height:Cr[1],left:wr,top:-Pd,advance:hn?Cr[1]:Cr[0]},ur=Ji+(Mi-Cr[1]*bt.scale),os=un.advance;const as=hn?Cr[0]*bt.scale-Mi*Li:Cr[1]*bt.scale-Mi*Li;as>0&&as>Sr&&(Sr=as)}else{const Gr=Ge[bt.fontStack],Cr=Gr&&Gr[Hi];if(Cr&&Cr.rect)bn=Cr.rect,un=Cr.metrics;else{const as=Oe[bt.fontStack],Sl=as&&as[Hi];if(!Sl)continue;un=Sl.metrics}ur=(Li-bt.scale)*Mi}hn?(ye.verticalizable=!0,Tr.push({glyph:Hi,imageName:wn,x:Nt,y:Wt+ur,vertical:hn,scale:bt.scale,fontStack:bt.fontStack,sectionIndex:Br,metrics:un,rect:bn}),Nt+=os*bt.scale+Je):(Tr.push({glyph:Hi,imageName:wn,x:Nt,y:Wt+ur,vertical:hn,scale:bt.scale,fontStack:bt.fontStack,sectionIndex:Br,metrics:un,rect:bn}),Nt+=un.advance*bt.scale+Je)}Tr.length!==0&&(Pi=Math.max(Nt-Je,Pi),bg(Tr,0,Tr.length-1,ar,Sr)),Nt=0;const ri=Ae*Li+Sr;cr.lineOffset=Math.max(Sr,Ji),Wt+=ri,Dr=Math.max(ri,Dr),++Ei}var zi;const $i=Wt-vl,{horizontalAlign:Er,verticalAlign:lr}=Yu(je);(function(Ti,Li,Ji,cr,Tr,Sr,ri,Gi,bt){const Br=(Li-Ji)*Tr;let Hi=0;Hi=Sr!==ri?-Gi*cr-vl:(-cr*bt+.5)*ri;for(const ur of Ti)for(const un of ur.positionedGlyphs)un.x+=Br,un.y+=Hi})(ye.positionedLines,ar,Er,lr,Pi,Dr,Ae,$i,ze.length),ye.top+=-lr*$i,ye.bottom=ye.top+$i,ye.left+=-Er*Pi,ye.right=ye.left+Pi}(ue,e,r,s,J,g,y,b,L,S,B,$),!function(ye){for(const Oe of ye)if(Oe.positionedGlyphs.length!==0)return!1;return!0}(le)&&ue}const Ac={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Dd(i,e,r,s,c,f){if(e.imageName){const g=s[e.imageName];return g?g.displaySize[0]*e.scale*Mi/f+c:0}{const g=r[e.fontStack],y=g&&g[i];return y?y.metrics.advance*e.scale+c:0}}function Bd(i,e,r,s){const c=Math.pow(i-e,2);return s?i<e?c/2:2*c:c+Math.abs(r)*r}function xg(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Rd(i,e,r,s,c,f){let g=null,y=Bd(e,r,c,f);for(const b of s){const S=Bd(e-b.x,r,c,f)+b.badness;S<=y&&(g=b,y=S)}return{index:i,x:e,priorBreak:g,badness:y}}function Fd(i){return i?Fd(i.priorBreak).concat(i.index):[]}function Ku(i,e,r,s,c,f,g){if(f!=="point")return[];if(!i)return[];const y=[],b=function(B,O,U,$,X,J){let oe=0;for(let ie=0;ie<B.length();ie++){const le=B.getSection(ie);oe+=Dd(B.getCharCode(ie),le,$,X,O,J)}return oe/Math.max(1,Math.ceil(oe/U))}(i,e,r,s,c,g),S=i.text.indexOf("")>=0;let k=0;for(let B=0;B<i.length();B++){const O=i.getSection(B),U=i.getCharCode(B);if(Ac[U]||(k+=Dd(U,O,s,c,e,g)),B<i.length()-1){const $=!((L=U)<11904||!(Re["Bopomofo Extended"](L)||Re.Bopomofo(L)||Re["CJK Compatibility Forms"](L)||Re["CJK Compatibility Ideographs"](L)||Re["CJK Compatibility"](L)||Re["CJK Radicals Supplement"](L)||Re["CJK Strokes"](L)||Re["CJK Symbols and Punctuation"](L)||Re["CJK Unified Ideographs Extension A"](L)||Re["CJK Unified Ideographs"](L)||Re["Enclosed CJK Letters and Months"](L)||Re["Halfwidth and Fullwidth Forms"](L)||Re.Hiragana(L)||Re["Ideographic Description Characters"](L)||Re["Kangxi Radicals"](L)||Re["Katakana Phonetic Extensions"](L)||Re.Katakana(L)||Re["Vertical Forms"](L)||Re["Yi Radicals"](L)||Re["Yi Syllables"](L)));(vg[U]||$||O.imageName)&&y.push(Rd(B+1,k,b,y,xg(U,i.getCharCode(B+1),$&&S),!1))}}var L;return Fd(Rd(i.length(),k,b,y,0,!0))}function Yu(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function bg(i,e,r,s,c){if(!s&&!c)return;const f=i[r],g=(i[r].x+f.metrics.advance*f.scale)*s;for(let y=e;y<=r;y++)i[y].x-=g,i[y].y+=c}function wg(i,e,r){const{horizontalAlign:s,verticalAlign:c}=Yu(r),f=e[0]-i.displaySize[0]*s,g=e[1]-i.displaySize[1]*c;return{image:i,top:g,bottom:g+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function Od(i,e,r,s,c,f){const g=i.image;let y;if(g.content){const X=g.content,J=g.pixelRatio||1;y=[X[0]/J,X[1]/J,g.displaySize[0]-X[2]/J,g.displaySize[1]-X[3]/J]}const b=e.left*f,S=e.right*f;let k,L,B,O;r==="width"||r==="both"?(O=c[0]+b-s[3],L=c[0]+S+s[1]):(O=c[0]+(b+S-g.displaySize[0])/2,L=O+g.displaySize[0]);const U=e.top*f,$=e.bottom*f;return r==="height"||r==="both"?(k=c[1]+U-s[0],B=c[1]+$+s[2]):(k=c[1]+(U+$-g.displaySize[1])/2,B=k+g.displaySize[1]),{image:g,top:k,right:L,bottom:B,left:O,collisionPadding:y}}const bl=255,On=128,Ls=bl*On;function Ud(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Gt(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=r;let f=0;for(;f<s.length&&s[f]<=i;)f++;f=Math.max(0,f-1);let g=f;for(;g<s.length&&s[g]<i+1;)g++;g=Math.min(s.length-1,g);const y=s[f],b=s[g];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:b,minSize:r.evaluate(new Gt(y)),maxSize:r.evaluate(new Gt(b)),interpolationType:c}}}function Ju(i,e,r){let s="never";const c=i.get(e);return c?s=c:i.get(r)&&(s="always"),s}const Eg=Ms.VectorTileFeature.types,Tg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function kc(i,e,r,s,c,f,g,y,b,S,k,L,B){const O=y?Math.min(Ls,Math.round(y[0])):0,U=y?Math.min(Ls,Math.round(y[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*c),f,g,(O<<1)+(b?1:0),U,16*S,16*k,256*L,256*B)}function Qu(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Sg(i){for(const e of i.sections)if(dc(e.text))return!0;return!1}class eh{constructor(e){this.layoutVertexArray=new we,this.indexArray=new Ke,this.programConfigurations=e,this.segments=new Ye,this.dynamicLayoutVertexArray=new Ie,this.opacityVertexArray=new $e,this.hasVisibleVertices=!1,this.placedSymbolArray=new C}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ig.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,rg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Tg,!0),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ve("SymbolBuffers",eh);class th{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Ye,this.collisionVertexArray=new Le}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ng.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ve("CollisionBuffers",th);class ua{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Lu([]),this.placementViewportMatrix=Lu([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ud(this.zoom,r["text-size"]),this.iconSizeData=Ud(this.zoom,r["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=Ju(s,"text-overlap","text-allow-overlap")!=="never"||Ju(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(g=>o.WritingMode[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new eh(new rs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new eh(new rs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new F,this.lineVertexArray=new Z,this.symbolInstances=new P,this.textAnchorOffsets=new H}calculateGlyphDependencies(e,r,s,c,f){for(let g=0;g<e.length;g++)if(r[e.charCodeAt(g)]=!0,(s||c)&&f){const y=yl[e.charAt(g)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,s){const c=this.layers[0],f=c.layout,g=f.get("text-font"),y=f.get("text-field"),b=f.get("icon-image"),S=(y.value.kind!=="constant"||y.value.value instanceof ai&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),k=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,L=f.get("symbol-sort-key");if(this.features=[],!S&&!k)return;const B=r.iconDependencies,O=r.glyphDependencies,U=r.availableImages,$=new Gt(this.zoom);for(const{feature:X,id:J,index:oe,sourceLayerIndex:ie}of e){const le=c._featureFilter.needGeometry,ue=Fn(X,le);if(!c._featureFilter.filter($,ue,s))continue;let ye,Oe;if(le||(ue.geometry=xn(X)),S){const Fe=c.getValueAndResolveTokens("text-field",ue,s,U),ze=ai.factory(Fe);Sg(ze)&&(this.hasRTLText=!0),(!this.hasRTLText||tl()==="unavailable"||this.hasRTLText&&Lr.isParsed())&&(ye=og(ze,c,ue))}if(k){const Fe=c.getValueAndResolveTokens("icon-image",ue,s,U);Oe=Fe instanceof Mr?Fe:Mr.fromString(Fe)}if(!ye&&!Oe)continue;const Ge=this.sortFeaturesByKey?L.evaluate(ue,{},s):void 0;if(this.features.push({id:J,text:ye,icon:Oe,index:oe,sourceLayerIndex:ie,geometry:ue.geometry,properties:X.properties,type:Eg[X.type],sortKey:Ge}),Oe&&(B[Oe.name]=!0),ye){const Fe=g.evaluate(ue,{},s).join(","),ze=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.WritingMode.vertical)>=0;for(const Ae of ye.sections)if(Ae.image)B[Ae.image.name]=!0;else{const je=Wo(ye.toString()),ke=Ae.fontStack||Fe,Te=O[ke]=O[ke]||{};this.calculateGlyphDependencies(Ae.text,Te,ze,this.allowVerticalPlacement,je)}}}f.get("symbol-placement")==="line"&&(this.features=function(X){const J={},oe={},ie=[];let le=0;function ue(Fe){ie.push(X[Fe]),le++}function ye(Fe,ze,Ae){const je=oe[Fe];return delete oe[Fe],oe[ze]=je,ie[je].geometry[0].pop(),ie[je].geometry[0]=ie[je].geometry[0].concat(Ae[0]),je}function Oe(Fe,ze,Ae){const je=J[ze];return delete J[ze],J[Fe]=je,ie[je].geometry[0].shift(),ie[je].geometry[0]=Ae[0].concat(ie[je].geometry[0]),je}function Ge(Fe,ze,Ae){const je=Ae?ze[0][ze[0].length-1]:ze[0][0];return`${Fe}:${je.x}:${je.y}`}for(let Fe=0;Fe<X.length;Fe++){const ze=X[Fe],Ae=ze.geometry,je=ze.text?ze.text.toString():null;if(!je){ue(Fe);continue}const ke=Ge(je,Ae),Te=Ge(je,Ae,!0);if(ke in oe&&Te in J&&oe[ke]!==J[Te]){const Je=Oe(ke,Te,Ae),He=ye(ke,Te,ie[Je].geometry);delete J[ke],delete oe[Te],oe[Ge(je,ie[He].geometry,!0)]=He,ie[Je].geometry=null}else ke in oe?ye(ke,Te,Ae):Te in J?Oe(ke,Te,Ae):(ue(Fe),J[ke]=le-1,oe[Te]=le-1)}return ie.filter(Fe=>Fe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,J)=>X.sortKey-J.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(r[e.segment+1]),f=e.dist(r[e.segment]);const g={};for(let y=e.segment+1;y<r.length;y++)g[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:c},y<r.length-1&&(c+=r[y+1].dist(r[y]));for(let y=e.segment||0;y>=0;y--)g[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:f},y>0&&(f+=r[y-1].dist(r[y]));for(let y=0;y<r.length;y++){const b=g[y];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,c,f,g,y,b,S,k,L,B){const O=e.indexArray,U=e.layoutVertexArray,$=e.segments.prepareSegment(4*r.length,U,O,this.canOverlap?g.sortKey:void 0),X=this.glyphOffsetArray.length,J=$.vertexLength,oe=this.allowVerticalPlacement&&y===o.WritingMode.vertical?Math.PI/2:0,ie=g.text&&g.text.sections;for(let le=0;le<r.length;le++){const{tl:ue,tr:ye,bl:Oe,br:Ge,tex:Fe,pixelOffsetTL:ze,pixelOffsetBR:Ae,minFontScaleX:je,minFontScaleY:ke,glyphOffset:Te,isSDF:Je,sectionIndex:He}=r[le],dt=$.vertexLength,Nt=Te[1];kc(U,b.x,b.y,ue.x,Nt+ue.y,Fe.x,Fe.y,s,Je,ze.x,ze.y,je,ke),kc(U,b.x,b.y,ye.x,Nt+ye.y,Fe.x+Fe.w,Fe.y,s,Je,Ae.x,ze.y,je,ke),kc(U,b.x,b.y,Oe.x,Nt+Oe.y,Fe.x,Fe.y+Fe.h,s,Je,ze.x,Ae.y,je,ke),kc(U,b.x,b.y,Ge.x,Nt+Ge.y,Fe.x+Fe.w,Fe.y+Fe.h,s,Je,Ae.x,Ae.y,je,ke),Qu(e.dynamicLayoutVertexArray,b,oe),O.emplaceBack(dt,dt+1,dt+2),O.emplaceBack(dt+1,dt+2,dt+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Te[0]),le!==r.length-1&&He===r[le+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,g,g.index,{},B,ie&&ie[He])}e.placedSymbolArray.emplaceBack(b.x,b.y,X,this.glyphOffsetArray.length-X,J,S,k,b.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],y,0,!1,0,L)}_addCollisionDebugVertex(e,r,s,c,f,g){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,c,f,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,r,s,c,f,g,y){const b=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),S=b.vertexLength,k=f.layoutVertexArray,L=f.collisionVertexArray,B=y.anchorX,O=y.anchorY;this._addCollisionDebugVertex(k,L,g,B,O,new j(e,r)),this._addCollisionDebugVertex(k,L,g,B,O,new j(s,r)),this._addCollisionDebugVertex(k,L,g,B,O,new j(s,c)),this._addCollisionDebugVertex(k,L,g,B,O,new j(e,c)),b.vertexLength+=4;const U=f.indexArray;U.emplaceBack(S,S+1),U.emplaceBack(S+1,S+2),U.emplaceBack(S+2,S+3),U.emplaceBack(S+3,S),b.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,c){for(let f=e;f<r;f++){const g=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new th(ft,Ed.members,qe),this.iconCollisionBox=new th(ft,Ed.members,qe);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,c,f,g,y,b,S){const k={};for(let L=r;L<s;L++){const B=e.get(L);k.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},k.textFeatureIndex=B.featureIndex;break}for(let L=c;L<f;L++){const B=e.get(L);k.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},k.verticalTextFeatureIndex=B.featureIndex;break}for(let L=g;L<y;L++){const B=e.get(L);k.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},k.iconFeatureIndex=B.featureIndex;break}for(let L=b;L<S;L++){const B=e.get(L);k.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},k.verticalIconFeatureIndex=B.featureIndex;break}return k}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),c=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<c;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),c=[],f=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const b=this.symbolInstances.get(y);c.push(0|Math.round(r*b.anchorX+s*b.anchorY)),f.push(b.featureIndex)}return g.sort((y,b)=>c[y]-c[b]||f[b]-f[y]),g}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,f,g)=>{c>=0&&g.indexOf(c)===f&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Vd,Nd;Ve("SymbolBucket",ua,{omit:["layers","collisionBoxArray","features","compareText"]}),ua.MAX_GLYPHS=65535,ua.addDynamicAttributes=Qu;var ih={get paint(){return Nd=Nd||new nr({"icon-opacity":new et(me.paint_symbol["icon-opacity"]),"icon-color":new et(me.paint_symbol["icon-color"]),"icon-halo-color":new et(me.paint_symbol["icon-halo-color"]),"icon-halo-width":new et(me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new et(me.paint_symbol["icon-halo-blur"]),"icon-translate":new We(me.paint_symbol["icon-translate"]),"icon-translate-anchor":new We(me.paint_symbol["icon-translate-anchor"]),"text-opacity":new et(me.paint_symbol["text-opacity"]),"text-color":new et(me.paint_symbol["text-color"],{runtimeType:Ui,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new et(me.paint_symbol["text-halo-color"]),"text-halo-width":new et(me.paint_symbol["text-halo-width"]),"text-halo-blur":new et(me.paint_symbol["text-halo-blur"]),"text-translate":new We(me.paint_symbol["text-translate"]),"text-translate-anchor":new We(me.paint_symbol["text-translate-anchor"])})},get layout(){return Vd=Vd||new nr({"symbol-placement":new We(me.layout_symbol["symbol-placement"]),"symbol-spacing":new We(me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new We(me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new et(me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new We(me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new We(me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new We(me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new We(me.layout_symbol["icon-ignore-placement"]),"icon-optional":new We(me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new We(me.layout_symbol["icon-rotation-alignment"]),"icon-size":new et(me.layout_symbol["icon-size"]),"icon-text-fit":new We(me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new We(me.layout_symbol["icon-text-fit-padding"]),"icon-image":new et(me.layout_symbol["icon-image"]),"icon-rotate":new et(me.layout_symbol["icon-rotate"]),"icon-padding":new et(me.layout_symbol["icon-padding"]),"icon-keep-upright":new We(me.layout_symbol["icon-keep-upright"]),"icon-offset":new et(me.layout_symbol["icon-offset"]),"icon-anchor":new et(me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new We(me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new We(me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new We(me.layout_symbol["text-rotation-alignment"]),"text-field":new et(me.layout_symbol["text-field"]),"text-font":new et(me.layout_symbol["text-font"]),"text-size":new et(me.layout_symbol["text-size"]),"text-max-width":new et(me.layout_symbol["text-max-width"]),"text-line-height":new We(me.layout_symbol["text-line-height"]),"text-letter-spacing":new et(me.layout_symbol["text-letter-spacing"]),"text-justify":new et(me.layout_symbol["text-justify"]),"text-radial-offset":new et(me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new We(me.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new et(me.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new et(me.layout_symbol["text-anchor"]),"text-max-angle":new We(me.layout_symbol["text-max-angle"]),"text-writing-mode":new We(me.layout_symbol["text-writing-mode"]),"text-rotate":new et(me.layout_symbol["text-rotate"]),"text-padding":new We(me.layout_symbol["text-padding"]),"text-keep-upright":new We(me.layout_symbol["text-keep-upright"]),"text-transform":new et(me.layout_symbol["text-transform"]),"text-offset":new et(me.layout_symbol["text-offset"]),"text-allow-overlap":new We(me.layout_symbol["text-allow-overlap"]),"text-overlap":new We(me.layout_symbol["text-overlap"]),"text-ignore-placement":new We(me.layout_symbol["text-ignore-placement"]),"text-optional":new We(me.layout_symbol["text-optional"])})}};class jd{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:An,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ve("FormatSectionOverride",jd,{omit:["defaultValue"]});class Mc extends an{constructor(e){super(e,ih)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const f of s)c.indexOf(f)<0&&c.push(f);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,c){const f=this.layout.get(e).evaluate(r,{},s,c),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Oo(g.value)||!f?f:function(y,b){return b.replace(/{([^{}]+)}/g,(S,k)=>k in y?String(y[k]):"")}(r.properties,f)}createBucket(e){return new ua(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of ih.paint.overridableProperties){if(!Mc.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new jd(r),c=new ei(s,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new Gs("source",c):new Ut("composite",c,r.value.zoomStops),this.paint._values[e]=new Nr(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Mc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),c=ih.paint.properties[r];let f=!1;const g=y=>{for(const b of y)if(c.overrides&&c.overrides.hasOverride(b))return void(f=!0)};if(s.value.kind==="constant"&&s.value.value instanceof ai)g(s.value.value.sections);else if(s.value.kind==="source"){const y=S=>{f||(S instanceof Gn&&li(S.value)===rn?g(S.value.sections):S instanceof Ro?g(S.sections):S.eachChild(y))},b=s.value;b._styleExpression&&y(b._styleExpression.expression)}return f}}let qd;var Cg={get paint(){return qd=qd||new nr({"background-color":new We(me.paint_background["background-color"]),"background-pattern":new il(me.paint_background["background-pattern"]),"background-opacity":new We(me.paint_background["background-opacity"])})}};class Ig extends an{constructor(e){super(e,Cg)}}let Zd;var Ag={get paint(){return Zd=Zd||new nr({"raster-opacity":new We(me.paint_raster["raster-opacity"]),"raster-hue-rotate":new We(me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new We(me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new We(me.paint_raster["raster-brightness-max"]),"raster-saturation":new We(me.paint_raster["raster-saturation"]),"raster-contrast":new We(me.paint_raster["raster-contrast"]),"raster-resampling":new We(me.paint_raster["raster-resampling"]),"raster-fade-duration":new We(me.paint_raster["raster-fade-duration"])})}};class kg extends an{constructor(e){super(e,Ag)}}class Mg extends an{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Pg{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const rh=63710088e-1;class zs{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new zs(Ne(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,c=e.lat*r,f=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return rh*Math.acos(Math.min(f,1))}static convert(e){if(e instanceof zs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new zs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new zs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const $d=2*Math.PI*rh;function Gd(i){return $d*Math.cos(i*Math.PI/180)}function Hd(i){return(180+i)/360}function Wd(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Xd(i,e){return i/Gd(e)}function nh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Pc{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=zs.convert(e);return new Pc(Hd(s.lng),Wd(s.lat),Xd(r,s.lat))}toLngLat(){return new zs(360*this.x-180,nh(this.y))}toAltitude(){return this.z*Gd(nh(this.y))}meterInMercatorCoordinateUnits(){return 1/$d*(e=nh(this.y),1/Math.cos(e*Math.PI/180));var e}}function Kd(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class sh{constructor(e,r,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=wl(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const c=(g=this.y,y=this.z,b=Kd(256*(f=this.x),256*(g=Math.pow(2,y)-g-1),y),S=Kd(256*(f+1),256*(g+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]);var f,g,y,b,S;const k=function(L,B,O){let U,$="";for(let X=L;X>0;X--)U=1<<X-1,$+=(B&U?1:0)+(O&U?2:0);return $}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,k).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new j((e.x*r-this.x)*ti,(e.y*r-this.y)*ti)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Yd{constructor(e,r){this.wrap=e,this.canonical=r,this.key=wl(e,r.z,r.z,r.x,r.y)}}class $r{constructor(e,r,s,c,f){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new sh(s,+c,+f),this.key=wl(r,e,s,c,f)}clone(){return new $r(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new $r(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $r(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?wl(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):wl(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new $r(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new $r(r,this.wrap,r,s,c),new $r(r,this.wrap,r,s+1,c),new $r(r,this.wrap,r,s,c+1),new $r(r,this.wrap,r,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new $r(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new $r(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Yd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Pc(e.x-this.wrap,e.y))}}function wl(i,e,r,s,c){(i*=2)<0&&(i=-1*i-1);const f=1<<r;return(f*f*i+f*c+s).toString(36)+r.toString(36)+e.toString(36)}Ve("CanonicalTileID",sh),Ve("OverscaledTileID",$r,{omit:["posMatrix"]});class Jd{constructor(e,r,s){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void _t(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const c=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=s||"mapbox";for(let f=0;f<c;f++)this.data[this._idx(-1,f)]=this.data[this._idx(0,f)],this.data[this._idx(c,f)]=this.data[this._idx(c-1,f)],this.data[this._idx(f,-1)]=this.data[this._idx(f,0)],this.data[this._idx(f,c)]=this.data[this._idx(f,c-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(c,-1)]=this.data[this._idx(c-1,0)],this.data[this._idx(-1,c)]=this.data[this._idx(0,c-1)],this.data[this._idx(c,c)]=this.data[this._idx(c-1,c-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let f=0;f<c;f++)for(let g=0;g<c;g++){const y=this.get(f,g);y>this.max&&(this.max=y),y<this.min&&(this.min=y)}}get(e,r){const s=new Uint8Array(this.data.buffer),c=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[c],s[c+1],s[c+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,s){return(256*e*256+256*r+s)/10-1e4}_unpackTerrarium(e,r,s){return 256*e+r+s/256-32768}getPixels(){return new Zr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,f=r*this.dim+this.dim,g=s*this.dim,y=s*this.dim+this.dim;switch(r){case-1:c=f-1;break;case 1:f=c+1}switch(s){case-1:g=y-1;break;case 1:y=g+1}const b=-r*this.dim,S=-s*this.dim;for(let k=g;k<y;k++)for(let L=c;L<f;L++)this.data[this._idx(L,k)]=e.data[this._idx(L+b,k+S)]}}Ve("DEMData",Jd);class Qd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class ep{constructor(e,r,s,c,f){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=c,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class tp{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ro(ti,16,0),this.grid3D=new ro(ti,16,0),this.featureIndexArray=new re,this.promoteId=r}insert(e,r,s,c,f,g){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,f);const b=g?this.grid3D:this.grid;for(let S=0;S<r.length;S++){const k=r[S],L=[1/0,1/0,-1/0,-1/0];for(let B=0;B<k.length;B++){const O=k[B];L[0]=Math.min(L[0],O.x),L[1]=Math.min(L[1],O.y),L[2]=Math.max(L[2],O.x),L[3]=Math.max(L[3],O.y)}L[0]<ti&&L[1]<ti&&L[2]>=0&&L[3]>=0&&b.insert(y,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ms.VectorTile(new Hu(this.rawTileData)).layers,this.sourceLayerCoder=new Qd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,s,c){this.loadVTLayers();const f=e.params||{},g=ti/e.tileSize/e.scale,y=Na(f.filter),b=e.queryGeometry,S=e.queryPadding*g,k=rp(b),L=this.grid.query(k.minX-S,k.minY-S,k.maxX+S,k.maxY+S),B=rp(e.cameraQueryGeometry),O=this.grid3D.query(B.minX-S,B.minY-S,B.maxX+S,B.maxY+S,(X,J,oe,ie)=>function(le,ue,ye,Oe,Ge){for(const ze of le)if(ue<=ze.x&&ye<=ze.y&&Oe>=ze.x&&Ge>=ze.y)return!0;const Fe=[new j(ue,ye),new j(ue,Ge),new j(Oe,Ge),new j(Oe,ye)];if(le.length>2){for(const ze of Fe)if(ra(le,ze))return!0}for(let ze=0;ze<le.length-1;ze++)if(cm(le[ze],le[ze+1],Fe))return!0;return!1}(e.cameraQueryGeometry,X-S,J-S,oe+S,ie+S));for(const X of O)L.push(X);L.sort(Lg);const U={};let $;for(let X=0;X<L.length;X++){const J=L[X];if(J===$)continue;$=J;const oe=this.featureIndexArray.get(J);let ie=null;this.loadMatchingFeature(U,oe.bucketIndex,oe.sourceLayerIndex,oe.featureIndex,y,f.layers,f.availableImages,r,s,c,(le,ue,ye)=>(ie||(ie=xn(le)),ue.queryIntersectsFeature(b,le,ye,ie,this.z,e.transform,g,e.pixelPosMatrix)))}return U}loadMatchingFeature(e,r,s,c,f,g,y,b,S,k,L){const B=this.bucketLayerIDs[r];if(g&&!function(X,J){for(let oe=0;oe<X.length;oe++)if(J.indexOf(X[oe])>=0)return!0;return!1}(g,B))return;const O=this.sourceLayerCoder.decode(s),U=this.vtLayers[O].feature(c);if(f.needGeometry){const X=Fn(U,!0);if(!f.filter(new Gt(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!f.filter(new Gt(this.tileID.overscaledZ),U))return;const $=this.getId(U,O);for(let X=0;X<B.length;X++){const J=B[X];if(g&&g.indexOf(J)<0)continue;const oe=b[J];if(!oe)continue;let ie={};$&&k&&(ie=k.getState(oe.sourceLayer||"_geojsonTileLayer",$));const le=Ue({},S[J]);le.paint=ip(le.paint,oe.paint,U,ie,y),le.layout=ip(le.layout,oe.layout,U,ie,y);const ue=!L||L(U,oe,ie);if(!ue)continue;const ye=new ep(U,this.z,this.x,this.y,$);ye.layer=le;let Oe=e[J];Oe===void 0&&(Oe=e[J]=[]),Oe.push({featureIndex:c,feature:ye,intersectionZ:ue})}}lookupSymbolFeatures(e,r,s,c,f,g,y,b){const S={};this.loadVTLayers();const k=Na(f);for(const L of e)this.loadMatchingFeature(S,s,c,L,k,g,y,b,r);return S}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function ip(i,e,r,s,c){return pt(i,(f,g)=>{const y=e instanceof lo?e.get(g):null;return y&&y.evaluate?y.evaluate(r,s,c):y})}function rp(i){let e=1/0,r=1/0,s=-1/0,c=-1/0;for(const f of i)e=Math.min(e,f.x),r=Math.min(r,f.y),s=Math.max(s,f.x),c=Math.max(c,f.y);return{minX:e,minY:r,maxX:s,maxY:c}}function Lg(i,e){return e-i}function np(i,e,r,s,c){const f=[];for(let g=0;g<i.length;g++){const y=i[g];let b;for(let S=0;S<y.length-1;S++){let k=y[S],L=y[S+1];k.x<e&&L.x<e||(k.x<e?k=new j(e,k.y+(e-k.x)/(L.x-k.x)*(L.y-k.y))._round():L.x<e&&(L=new j(e,k.y+(e-k.x)/(L.x-k.x)*(L.y-k.y))._round()),k.y<r&&L.y<r||(k.y<r?k=new j(k.x+(r-k.y)/(L.y-k.y)*(L.x-k.x),r)._round():L.y<r&&(L=new j(k.x+(r-k.y)/(L.y-k.y)*(L.x-k.x),r)._round()),k.x>=s&&L.x>=s||(k.x>=s?k=new j(s,k.y+(s-k.x)/(L.x-k.x)*(L.y-k.y))._round():L.x>=s&&(L=new j(s,k.y+(s-k.x)/(L.x-k.x)*(L.y-k.y))._round()),k.y>=c&&L.y>=c||(k.y>=c?k=new j(k.x+(c-k.y)/(L.y-k.y)*(L.x-k.x),c)._round():L.y>=c&&(L=new j(k.x+(c-k.y)/(L.y-k.y)*(L.x-k.x),c)._round()),b&&k.equals(b[b.length-1])||(b=[k],f.push(b)),b.push(L)))))}}return f}Ve("FeatureIndex",tp,{omit:["rawTileData","sourceLayerCoder"]});class Ds extends j{constructor(e,r,s,c){super(e,r),this.angle=s,c!==void 0&&(this.segment=c)}clone(){return new Ds(this.x,this.y,this.angle,this.segment)}}function sp(i,e,r,s,c){if(e.segment===void 0||r===0)return!0;let f=e,g=e.segment+1,y=0;for(;y>-r/2;){if(g--,g<0)return!1;y-=i[g].dist(f),f=i[g]}y+=i[g].dist(i[g+1]),g++;const b=[];let S=0;for(;y<r/2;){const k=i[g],L=i[g+1];if(!L)return!1;let B=i[g-1].angleTo(k)-k.angleTo(L);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:B}),S+=B;y-b[0].distance>s;)S-=b.shift().angleDelta;if(S>c)return!1;g++,y+=k.dist(L)}return!0}function op(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function ap(i,e,r){return i?.6*e*r:0}function lp(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function zg(i,e,r,s,c,f){const g=ap(r,c,f),y=lp(r,s)*f;let b=0;const S=op(i)/2;for(let k=0;k<i.length-1;k++){const L=i[k],B=i[k+1],O=L.dist(B);if(b+O>S){const U=(S-b)/O,$=yr.number(L.x,B.x,U),X=yr.number(L.y,B.y,U),J=new Ds($,X,B.angleTo(L),k);return J._round(),!g||sp(i,J,y,g,e)?J:void 0}b+=O}}function Dg(i,e,r,s,c,f,g,y,b){const S=ap(s,f,g),k=lp(s,c),L=k*g,B=i[0].x===0||i[0].x===b||i[0].y===0||i[0].y===b;return e-L<e/4&&(e=L+e/4),cp(i,B?e/2*y%e:(k/2+2*f)*g*y%e,e,S,r,L,B,!1,b)}function cp(i,e,r,s,c,f,g,y,b){const S=f/2,k=op(i);let L=0,B=e-r,O=[];for(let U=0;U<i.length-1;U++){const $=i[U],X=i[U+1],J=$.dist(X),oe=X.angleTo($);for(;B+r<L+J;){B+=r;const ie=(B-L)/J,le=yr.number($.x,X.x,ie),ue=yr.number($.y,X.y,ie);if(le>=0&&le<b&&ue>=0&&ue<b&&B-S>=0&&B+S<=k){const ye=new Ds(le,ue,oe,U);ye._round(),s&&!sp(i,ye,f,s,c)||O.push(ye)}}L+=J}return y||O.length||g||(O=cp(i,L/2,r,s,c,f,g,!0,b)),O}Ve("Anchor",Ds);const ha=wr;function up(i,e,r,s){const c=[],f=i.image,g=f.pixelRatio,y=f.paddedRect.w-2*ha,b=f.paddedRect.h-2*ha,S=i.right-i.left,k=i.bottom-i.top,L=f.stretchX||[[0,y]],B=f.stretchY||[[0,b]],O=(Ae,je)=>Ae+je[1]-je[0],U=L.reduce(O,0),$=B.reduce(O,0),X=y-U,J=b-$;let oe=0,ie=U,le=0,ue=$,ye=0,Oe=X,Ge=0,Fe=J;if(f.content&&s){const Ae=f.content;oe=Lc(L,0,Ae[0]),le=Lc(B,0,Ae[1]),ie=Lc(L,Ae[0],Ae[2]),ue=Lc(B,Ae[1],Ae[3]),ye=Ae[0]-oe,Ge=Ae[1]-le,Oe=Ae[2]-Ae[0]-ie,Fe=Ae[3]-Ae[1]-ue}const ze=(Ae,je,ke,Te)=>{const Je=zc(Ae.stretch-oe,ie,S,i.left),He=Dc(Ae.fixed-ye,Oe,Ae.stretch,U),dt=zc(je.stretch-le,ue,k,i.top),Nt=Dc(je.fixed-Ge,Fe,je.stretch,$),Wt=zc(ke.stretch-oe,ie,S,i.left),Pi=Dc(ke.fixed-ye,Oe,ke.stretch,U),Dr=zc(Te.stretch-le,ue,k,i.top),ar=Dc(Te.fixed-Ge,Fe,Te.stretch,$),Ei=new j(Je,dt),zi=new j(Wt,dt),$i=new j(Wt,Dr),Er=new j(Je,Dr),lr=new j(He/g,Nt/g),Ti=new j(Pi/g,ar/g),Li=e*Math.PI/180;if(Li){const Tr=Math.sin(Li),Sr=Math.cos(Li),ri=[Sr,-Tr,Tr,Sr];Ei._matMult(ri),zi._matMult(ri),Er._matMult(ri),$i._matMult(ri)}const Ji=Ae.stretch+Ae.fixed,cr=je.stretch+je.fixed;return{tl:Ei,tr:zi,bl:Er,br:$i,tex:{x:f.paddedRect.x+ha+Ji,y:f.paddedRect.y+ha+cr,w:ke.stretch+ke.fixed-Ji,h:Te.stretch+Te.fixed-cr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:lr,pixelOffsetBR:Ti,minFontScaleX:Oe/g/S,minFontScaleY:Fe/g/k,isSDF:r}};if(s&&(f.stretchX||f.stretchY)){const Ae=hp(L,X,U),je=hp(B,J,$);for(let ke=0;ke<Ae.length-1;ke++){const Te=Ae[ke],Je=Ae[ke+1];for(let He=0;He<je.length-1;He++)c.push(ze(Te,je[He],Je,je[He+1]))}}else c.push(ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return c}function Lc(i,e,r){let s=0;for(const c of i)s+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return s}function hp(i,e,r){const s=[{fixed:-ha,stretch:0}];for(const[c,f]of i){const g=s[s.length-1];s.push({fixed:c-g.stretch,stretch:g.stretch}),s.push({fixed:c-g.stretch,stretch:g.stretch+(f-c)})}return s.push({fixed:e+ha,stretch:r}),s}function zc(i,e,r,s){return i/e*r+s}function Dc(i,e,r,s){return i-e*r/s}class Bc{constructor(e,r,s,c,f,g,y,b,S,k){if(this.boxStartIndex=e.length,S){let L=g.top,B=g.bottom;const O=g.collisionPadding;O&&(L-=O[1],B+=O[3]);let U=B-L;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{let L=g.top*y-b[0],B=g.bottom*y+b[2],O=g.left*y-b[3],U=g.right*y+b[1];const $=g.collisionPadding;if($&&(O-=$[0]*y,L-=$[1]*y,U+=$[2]*y,B+=$[3]*y),k){const X=new j(O,L),J=new j(U,L),oe=new j(O,B),ie=new j(U,B),le=k*Math.PI/180;X._rotate(le),J._rotate(le),oe._rotate(le),ie._rotate(le),O=Math.min(X.x,J.x,oe.x,ie.x),U=Math.max(X.x,J.x,oe.x,ie.x),L=Math.min(X.y,J.y,oe.y,ie.y),B=Math.max(X.y,J.y,oe.y,ie.y)}e.emplaceBack(r.x,r.y,O,L,U,B,s,c,f)}this.boxEndIndex=e.length}}class Bg{constructor(e=[],r=Rg){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,c=r[e];for(;e>0;){const f=e-1>>1,g=r[f];if(s(c,g)>=0)break;r[e]=g,e=f}r[e]=c}_down(e){const{data:r,compare:s}=this,c=this.length>>1,f=r[e];for(;e<c;){let g=1+(e<<1),y=r[g];const b=g+1;if(b<this.length&&s(r[b],y)<0&&(g=b,y=r[b]),s(y,f)>=0)break;r[e]=y,e=g}r[e]=f}}function Rg(i,e){return i<e?-1:i>e?1:0}function Fg(i,e=1,r=!1){let s=1/0,c=1/0,f=-1/0,g=-1/0;const y=i[0];for(let O=0;O<y.length;O++){const U=y[O];(!O||U.x<s)&&(s=U.x),(!O||U.y<c)&&(c=U.y),(!O||U.x>f)&&(f=U.x),(!O||U.y>g)&&(g=U.y)}const b=Math.min(f-s,g-c);let S=b/2;const k=new Bg([],Og);if(b===0)return new j(s,c);for(let O=s;O<f;O+=b)for(let U=c;U<g;U+=b)k.push(new da(O+S,U+S,S,i));let L=function(O){let U=0,$=0,X=0;const J=O[0];for(let oe=0,ie=J.length,le=ie-1;oe<ie;le=oe++){const ue=J[oe],ye=J[le],Oe=ue.x*ye.y-ye.x*ue.y;$+=(ue.x+ye.x)*Oe,X+=(ue.y+ye.y)*Oe,U+=3*Oe}return new da($/U,X/U,0,O)}(i),B=k.length;for(;k.length;){const O=k.pop();(O.d>L.d||!L.d)&&(L=O,r&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,B)),O.max-L.d<=e||(S=O.h/2,k.push(new da(O.p.x-S,O.p.y-S,S,i)),k.push(new da(O.p.x+S,O.p.y-S,S,i)),k.push(new da(O.p.x-S,O.p.y+S,S,i)),k.push(new da(O.p.x+S,O.p.y+S,S,i)),B+=4)}return r&&(console.log(`num probes: ${B}`),console.log(`best distance: ${L.d}`)),L.p}function Og(i,e){return e.max-i.max}function da(i,e,r,s){this.p=new j(i,e),this.h=r,this.d=function(c,f){let g=!1,y=1/0;for(let b=0;b<f.length;b++){const S=f[b];for(let k=0,L=S.length,B=L-1;k<L;B=k++){const O=S[k],U=S[B];O.y>c.y!=U.y>c.y&&c.x<(U.x-O.x)*(c.y-O.y)/(U.y-O.y)+O.x&&(g=!g),y=Math.min(y,Wh(c,O,U))}}return(g?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var Zi;o.TextAnchorEnum=void 0,(Zi=o.TextAnchorEnum||(o.TextAnchorEnum={}))[Zi.center=1]="center",Zi[Zi.left=2]="left",Zi[Zi.right=3]="right",Zi[Zi.top=4]="top",Zi[Zi.bottom=5]="bottom",Zi[Zi["top-left"]=6]="top-left",Zi[Zi["top-right"]=7]="top-right",Zi[Zi["bottom-left"]=8]="bottom-left",Zi[Zi["bottom-right"]=9]="bottom-right";const Bs=7,oh=Number.POSITIVE_INFINITY;function dp(i,e){return e[1]!==oh?function(r,s,c){let f=0,g=0;switch(s=Math.abs(s),c=Math.abs(c),r){case"top-right":case"top-left":case"top":g=c-Bs;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+Bs}switch(r){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}return[f,g]}(i,e[0],e[1]):function(r,s){let c=0,f=0;s<0&&(s=0);const g=s/Math.SQRT2;switch(r){case"top-right":case"top-left":f=g-Bs;break;case"bottom-right":case"bottom-left":f=-g+Bs;break;case"bottom":f=-s+Bs;break;case"top":f=s-Bs}switch(r){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=s;break;case"right":c=-s}return[c,f]}(i,e[0])}function pp(i,e,r){var s;const c=i.layout,f=(s=c.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(e,{},r);if(f){const y=f.values,b=[];for(let S=0;S<y.length;S+=2){const k=b[S]=y[S],L=y[S+1].map(B=>B*Mi);k.startsWith("top")?L[1]-=Bs:k.startsWith("bottom")&&(L[1]+=Bs),b[S+1]=L}return new Vi(b)}const g=c.get("text-variable-anchor");if(g){let y;y=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},r)*Mi,oh]:c.get("text-offset").evaluate(e,{},r).map(S=>S*Mi);const b=[];for(const S of g)b.push(S,dp(S,y));return new Vi(b)}return null}function ah(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ug(i,e,r,s,c,f,g,y,b,S,k){let L=f.textMaxSize.evaluate(e,{});L===void 0&&(L=g);const B=i.layers[0].layout,O=B.get("icon-offset").evaluate(e,{},k),U=mp(r.horizontal),$=g/24,X=i.tilePixelRatio*$,J=i.tilePixelRatio*L/24,oe=i.tilePixelRatio*y,ie=i.tilePixelRatio*B.get("symbol-spacing"),le=B.get("text-padding")*i.tilePixelRatio,ue=function(Te,Je,He,dt=1){const Nt=Te.get("icon-padding").evaluate(Je,{},He),Wt=Nt&&Nt.values;return[Wt[0]*dt,Wt[1]*dt,Wt[2]*dt,Wt[3]*dt]}(B,e,k,i.tilePixelRatio),ye=B.get("text-max-angle")/180*Math.PI,Oe=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",Ge=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Fe=B.get("symbol-placement"),ze=ie/2,Ae=B.get("icon-text-fit");let je;s&&Ae!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(je=Od(s,r.vertical,Ae,B.get("icon-text-fit-padding"),O,$)),U&&(s=Od(s,U,Ae,B.get("icon-text-fit-padding"),O,$)));const ke=(Te,Je)=>{Je.x<0||Je.x>=ti||Je.y<0||Je.y>=ti||function(He,dt,Nt,Wt,Pi,Dr,ar,Ei,zi,$i,Er,lr,Ti,Li,Ji,cr,Tr,Sr,ri,Gi,bt,Br,Hi,ur,un){const bn=He.addToLineVertexArray(dt,Nt);let wn,os,hn,Gr,Cr=0,as=0,Sl=0,vp=0,mh=-1,gh=-1;const ls={};let xp=jr("");if(He.allowVerticalPlacement&&Wt.vertical){const Qi=Ei.layout.get("text-rotate").evaluate(bt,{},ur)+90;hn=new Bc(zi,dt,$i,Er,lr,Wt.vertical,Ti,Li,Ji,Qi),ar&&(Gr=new Bc(zi,dt,$i,Er,lr,ar,Tr,Sr,Ji,Qi))}if(Pi){const Qi=Ei.layout.get("icon-rotate").evaluate(bt,{}),Hr=Ei.layout.get("icon-text-fit")!=="none",go=up(Pi,Qi,Hi,Hr),Tn=ar?up(ar,Qi,Hi,Hr):void 0;os=new Bc(zi,dt,$i,Er,lr,Pi,Tr,Sr,!1,Qi),Cr=4*go.length;const _o=He.iconSizeData;let Un=null;_o.kind==="source"?(Un=[On*Ei.layout.get("icon-size").evaluate(bt,{})],Un[0]>Ls&&_t(`${He.layerIds[0]}: Value for "icon-size" is >= ${bl}. Reduce your "icon-size".`)):_o.kind==="composite"&&(Un=[On*Br.compositeIconSizes[0].evaluate(bt,{},ur),On*Br.compositeIconSizes[1].evaluate(bt,{},ur)],(Un[0]>Ls||Un[1]>Ls)&&_t(`${He.layerIds[0]}: Value for "icon-size" is >= ${bl}. Reduce your "icon-size".`)),He.addSymbols(He.icon,go,Un,Gi,ri,bt,o.WritingMode.none,dt,bn.lineStartIndex,bn.lineLength,-1,ur),mh=He.icon.placedSymbolArray.length-1,Tn&&(as=4*Tn.length,He.addSymbols(He.icon,Tn,Un,Gi,ri,bt,o.WritingMode.vertical,dt,bn.lineStartIndex,bn.lineLength,-1,ur),gh=He.icon.placedSymbolArray.length-1)}const bp=Object.keys(Wt.horizontal);for(const Qi of bp){const Hr=Wt.horizontal[Qi];if(!wn){xp=jr(Hr.text);const Tn=Ei.layout.get("text-rotate").evaluate(bt,{},ur);wn=new Bc(zi,dt,$i,Er,lr,Hr,Ti,Li,Ji,Tn)}const go=Hr.positionedLines.length===1;if(Sl+=fp(He,dt,Hr,Dr,Ei,Ji,bt,cr,bn,Wt.vertical?o.WritingMode.horizontal:o.WritingMode.horizontalOnly,go?bp:[Qi],ls,mh,Br,ur),go)break}Wt.vertical&&(vp+=fp(He,dt,Wt.vertical,Dr,Ei,Ji,bt,cr,bn,o.WritingMode.vertical,["vertical"],ls,gh,Br,ur));const jg=wn?wn.boxStartIndex:He.collisionBoxArray.length,qg=wn?wn.boxEndIndex:He.collisionBoxArray.length,Zg=hn?hn.boxStartIndex:He.collisionBoxArray.length,$g=hn?hn.boxEndIndex:He.collisionBoxArray.length,Gg=os?os.boxStartIndex:He.collisionBoxArray.length,Hg=os?os.boxEndIndex:He.collisionBoxArray.length,Wg=Gr?Gr.boxStartIndex:He.collisionBoxArray.length,Xg=Gr?Gr.boxEndIndex:He.collisionBoxArray.length;let En=-1;const Fc=(Qi,Hr)=>Qi&&Qi.circleDiameter?Math.max(Qi.circleDiameter,Hr):Hr;En=Fc(wn,En),En=Fc(hn,En),En=Fc(os,En),En=Fc(Gr,En);const wp=En>-1?1:0;wp&&(En*=un/Mi),He.glyphOffsetArray.length>=ua.MAX_GLYPHS&&_t("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bt.sortKey!==void 0&&He.addToSortKeyRanges(He.symbolInstances.length,bt.sortKey);const Kg=pp(Ei,bt,ur),[Yg,Jg]=function(Qi,Hr){const go=Qi.length,Tn=Hr==null?void 0:Hr.values;if((Tn==null?void 0:Tn.length)>0)for(let _o=0;_o<Tn.length;_o+=2){const Un=Tn[_o+1];Qi.emplaceBack(o.TextAnchorEnum[Tn[_o]],Un[0],Un[1])}return[go,Qi.length]}(He.textAnchorOffsets,Kg);He.symbolInstances.emplaceBack(dt.x,dt.y,ls.right>=0?ls.right:-1,ls.center>=0?ls.center:-1,ls.left>=0?ls.left:-1,ls.vertical||-1,mh,gh,xp,jg,qg,Zg,$g,Gg,Hg,Wg,Xg,$i,Sl,vp,Cr,as,wp,0,Ti,En,Yg,Jg)}(i,Je,Te,r,s,c,je,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,X,[le,le,le,le],Oe,b,oe,ue,Ge,O,e,f,S,k,g)};if(Fe==="line")for(const Te of np(e.geometry,0,0,ti,ti)){const Je=Dg(Te,ie,ye,r.vertical||U,s,24,J,i.overscaling,ti);for(const He of Je)U&&Vg(i,U.text,ze,He)||ke(Te,He)}else if(Fe==="line-center"){for(const Te of e.geometry)if(Te.length>1){const Je=zg(Te,ye,r.vertical||U,s,24,J);Je&&ke(Te,Je)}}else if(e.type==="Polygon")for(const Te of Uu(e.geometry,0)){const Je=Fg(Te,16);ke(Te[0],new Ds(Je.x,Je.y,0))}else if(e.type==="LineString")for(const Te of e.geometry)ke(Te,new Ds(Te[0].x,Te[0].y,0));else if(e.type==="Point")for(const Te of e.geometry)for(const Je of Te)ke([Je],new Ds(Je.x,Je.y,0))}function fp(i,e,r,s,c,f,g,y,b,S,k,L,B,O,U){const $=function(oe,ie,le,ue,ye,Oe,Ge,Fe){const ze=ue.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,Ae=[];for(const je of ie.positionedLines)for(const ke of je.positionedGlyphs){if(!ke.rect)continue;const Te=ke.rect||{};let Je=Pd+1,He=!0,dt=1,Nt=0;const Wt=(ye||Fe)&&ke.vertical,Pi=ke.metrics.advance*ke.scale/2;if(Fe&&ie.verticalizable&&(Nt=je.lineOffset/2-(ke.imageName?-(Mi-ke.metrics.width*ke.scale)/2:(ke.scale-1)*Mi)),ke.imageName){const ri=Ge[ke.imageName];He=ri.sdf,dt=ri.pixelRatio,Je=wr/dt}const Dr=ye?[ke.x+Pi,ke.y]:[0,0];let ar=ye?[0,0]:[ke.x+Pi+le[0],ke.y+le[1]-Nt],Ei=[0,0];Wt&&(Ei=ar,ar=[0,0]);const zi=(ke.metrics.left-Je)*ke.scale-Pi+ar[0],$i=(-ke.metrics.top-Je)*ke.scale+ar[1],Er=zi+Te.w*ke.scale/dt,lr=$i+Te.h*ke.scale/dt,Ti=new j(zi,$i),Li=new j(Er,$i),Ji=new j(zi,lr),cr=new j(Er,lr);if(Wt){const ri=new j(-Pi,Pi-vl),Gi=-Math.PI/2,bt=Mi/2-Pi,Br=new j(5-vl-bt,-(ke.imageName?bt:0)),Hi=new j(...Ei);Ti._rotateAround(Gi,ri)._add(Br)._add(Hi),Li._rotateAround(Gi,ri)._add(Br)._add(Hi),Ji._rotateAround(Gi,ri)._add(Br)._add(Hi),cr._rotateAround(Gi,ri)._add(Br)._add(Hi)}if(ze){const ri=Math.sin(ze),Gi=Math.cos(ze),bt=[Gi,-ri,ri,Gi];Ti._matMult(bt),Li._matMult(bt),Ji._matMult(bt),cr._matMult(bt)}const Tr=new j(0,0),Sr=new j(0,0);Ae.push({tl:Ti,tr:Li,bl:Ji,br:cr,tex:Te,writingMode:ie.writingMode,glyphOffset:Dr,sectionIndex:ke.sectionIndex,isSDF:He,pixelOffsetTL:Tr,pixelOffsetBR:Sr,minFontScaleX:0,minFontScaleY:0})}return Ae}(0,r,y,c,f,g,s,i.allowVerticalPlacement),X=i.textSizeData;let J=null;X.kind==="source"?(J=[On*c.layout.get("text-size").evaluate(g,{})],J[0]>Ls&&_t(`${i.layerIds[0]}: Value for "text-size" is >= ${bl}. Reduce your "text-size".`)):X.kind==="composite"&&(J=[On*O.compositeTextSizes[0].evaluate(g,{},U),On*O.compositeTextSizes[1].evaluate(g,{},U)],(J[0]>Ls||J[1]>Ls)&&_t(`${i.layerIds[0]}: Value for "text-size" is >= ${bl}. Reduce your "text-size".`)),i.addSymbols(i.text,$,J,y,f,g,S,e,b.lineStartIndex,b.lineLength,B,U);for(const oe of k)L[oe]=i.text.placedSymbolArray.length-1;return 4*$.length}function mp(i){for(const e in i)return i[e];return null}function Vg(i,e,r,s){const c=i.compareText;if(e in c){const f=c[e];for(let g=f.length-1;g>=0;g--)if(s.dist(f[g])<r)return!0}else c[e]=[];return c[e].push(s),!1}const gp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class lh{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=s>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const f=gp[15&s];if(!f)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new lh(y,g,f,e)}constructor(e,r=64,s=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=gp.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${s}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return ch(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:y}=this,b=[0,f.length-1,0],S=[];for(;b.length;){const k=b.pop()||0,L=b.pop()||0,B=b.pop()||0;if(L-B<=y){for(let X=B;X<=L;X++){const J=g[2*X],oe=g[2*X+1];J>=e&&J<=s&&oe>=r&&oe<=c&&S.push(f[X])}continue}const O=B+L>>1,U=g[2*O],$=g[2*O+1];U>=e&&U<=s&&$>=r&&$<=c&&S.push(f[O]),(k===0?e<=U:r<=$)&&(b.push(B),b.push(O-1),b.push(1-k)),(k===0?s>=U:c>=$)&&(b.push(O+1),b.push(L),b.push(1-k))}return S}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:g}=this,y=[0,c.length-1,0],b=[],S=s*s;for(;y.length;){const k=y.pop()||0,L=y.pop()||0,B=y.pop()||0;if(L-B<=g){for(let X=B;X<=L;X++)yp(f[2*X],f[2*X+1],e,r)<=S&&b.push(c[X]);continue}const O=B+L>>1,U=f[2*O],$=f[2*O+1];yp(U,$,e,r)<=S&&b.push(c[O]),(k===0?e-s<=U:r-s<=$)&&(y.push(B),y.push(O-1),y.push(1-k)),(k===0?e+s>=U:r+s>=$)&&(y.push(O+1),y.push(L),y.push(1-k))}return b}}function ch(i,e,r,s,c,f){if(c-s<=r)return;const g=s+c>>1;_p(i,e,g,s,c,f),ch(i,e,r,s,g-1,1-f),ch(i,e,r,g+1,c,1-f)}function _p(i,e,r,s,c,f){for(;c>s;){if(c-s>600){const S=c-s+1,k=r-s+1,L=Math.log(S),B=.5*Math.exp(2*L/3),O=.5*Math.sqrt(L*B*(S-B)/S)*(k-S/2<0?-1:1);_p(i,e,r,Math.max(s,Math.floor(r-k*B/S+O)),Math.min(c,Math.floor(r+(S-k)*B/S+O)),f)}const g=e[2*r+f];let y=s,b=c;for(El(i,e,s,r),e[2*c+f]>g&&El(i,e,s,c);y<b;){for(El(i,e,y,b),y++,b--;e[2*y+f]<g;)y++;for(;e[2*b+f]>g;)b--}e[2*s+f]===g?El(i,e,s,b):(b++,El(i,e,b,c)),b<=r&&(s=b+1),r<=b&&(c=b-1)}}function El(i,e,r,s){uh(i,r,s),uh(e,2*r,2*s),uh(e,2*r+1,2*s+1)}function uh(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}function yp(i,e,r,s){const c=i-r,f=e-s;return c*c+f*f}var hh;o.PerformanceMarkers=void 0,(hh=o.PerformanceMarkers||(o.PerformanceMarkers={})).create="create",hh.load="load",hh.fullLoad="fullLoad";let Rc=null,Tl=[];const dh=1e3/60,ph="loadTime",fh="fullLoadTime",Ng={mark(i){performance.mark(i)},frame(i){const e=i;Rc!=null&&Tl.push(e-Rc),Rc=e},clearMetrics(){Rc=null,Tl=[],performance.clearMeasures(ph),performance.clearMeasures(fh);for(const i in o.PerformanceMarkers)performance.clearMarks(o.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure(ph,o.PerformanceMarkers.create,o.PerformanceMarkers.load),performance.measure(fh,o.PerformanceMarkers.create,o.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName(ph)[0].duration,e=performance.getEntriesByName(fh)[0].duration,r=Tl.length,s=1/(Tl.reduce((f,g)=>f+g,0)/r/1e3),c=Tl.filter(f=>f>dh).reduce((f,g)=>f+(g-dh)/dh,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:c/(r+c)*100,totalFrames:r}}};o.AJAXError=Fi,o.ARRAY_TYPE=na,o.Actor=class{constructor(i,e,r){this.receive=s=>{const c=s.data,f=c.id;if(f&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){delete this.tasks[f];const g=this.cancelCallbacks[f];delete this.cancelCallbacks[f],g&&g()}else Zt()||c.mustQueue?(this.tasks[f]=c,this.taskQueue.push(f),this.invoker.trigger()):this.processTask(f,c)},this.process=()=>{if(!this.taskQueue.length)return;const s=this.taskQueue.shift(),c=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),c&&this.processTask(s,c)},this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Pg(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Zt()?i:window}send(i,e,r,s,c=!1){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[f]=r);const g=fr(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:i,hasCallback:!!r,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:no(e,g)},g),{cancel:()=>{r&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Qn(e.error)):r(null,Qn(e.data)))}else{let r=!1;const s=fr(this.globalScope)?void 0:[],c=e.hasCallback?(y,b)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:y?no(y):null,data:no(b,s)},s)}:y=>{r=!0};let f=null;const g=Qn(e.data);if(this.parent[e.type])f=this.parent[e.type](e.sourceMapId,g,c);else if(this.parent.getWorkerSource){const y=e.type.split(".");f=this.parent.getWorkerSource(e.sourceMapId,y[0],g.source)[y[1]](g,c)}else c(new Error(`Could not find function ${e.type}`));!r&&f&&f.cancel&&(this.cancelCallbacks[i]=f.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.AlphaImage=hl,o.CanonicalTileID=sh,o.CollisionBoxArray=x,o.CollisionCircleLayoutArray=class extends ol{},o.Color=rt,o.DEMData=Jd,o.DataConstantProperty=We,o.DictionaryCoder=Qd,o.EXTENT=ti,o.ErrorEvent=mr,o.EvaluationParameters=Gt,o.Event=Ki,o.Evented=Vr,o.FeatureIndex=tp,o.FillBucket=ju,o.FillExtrusionBucket=Zu,o.GeoJSONFeature=ep,o.ImageAtlas=zd,o.ImagePosition=Xu,o.KDBush=lh,o.LineBucket=$u,o.LineStripIndexArray=class extends h{},o.LngLat=zs,o.MercatorCoordinate=Pc,o.ONE_EM=Mi,o.OverscaledTileID=$r,o.PerformanceUtils=Ng,o.Point=j,o.Pos3dArray=class extends uo{},o.PosArray=ce,o.Properties=nr,o.Protobuf=Hu,o.QuadTriangleArray=class extends ta{},o.RGBAImage=Zr,o.RasterBoundsArray=class extends ho{},o.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},o.SegmentVector=Ye,o.SymbolBucket=ua,o.Transitionable=fc,o.TriangleIndexArray=Ke,o.Uniform1f=Ai,o.Uniform1i=class extends di{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends di{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.Uniform3f=class extends di{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.Uniform4f=ji,o.UniformColor=As,o.UniformMatrix4f=class extends di{constructor(i,e){super(i,e),this.current=ki}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.UnwrappedTileID=Yd,o.ValidationError=Me,o.ZoomHistory=Ha,o.addDynamicAttributes=Qu,o.arrayBufferToImage=function(i,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=yi})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const s=new Blob([new Uint8Array(i)],{type:"image/png"});r.src=i.byteLength?URL.createObjectURL(s):yi},o.arrayBufferToImageBitmap=function(i,e){const r=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(r).then(s=>{e(null,s)}).catch(s=>{e(new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},o.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let s=i.length;const c=new Array(i.length);let f=null;i.forEach((g,y)=>{e(g,(b,S)=>{b&&(f=b),c[y]=S,--s==0&&r(f,c)})})},o.bezier=Ce,o.browser=en,o.clamp=Se,o.clipLine=np,o.clone=function(i){var e=new na(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.clone$1=st,o.collisionCircleLayout=sg,o.config=Ur,o.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.create=function(){var i=new na(16);return na!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.createExpression=vt,o.createFilter=Na,o.createLayout=hi,o.createStyleLayer=function(i){if(i.type==="custom")return new Mg(i);switch(i.type){case"background":return new Ig(i);case"circle":return new dm(i);case"fill":return new Lm(i);case"fill-extrusion":return new Hm(i);case"heatmap":return new fm(i);case"hillshade":return new gm(i);case"line":return new tg(i);case"raster":return new kg(i);case"symbol":return new Mc(i)}},o.deepEqual=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],r[s]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(!i(e[s],r[s]))return!1;return!0}return e===r},o.defaultEasing=De,o.derefLayers=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=ms(i[r],e[i[r].ref]));return i},o.diffStyles=function(i,e){if(!i)return[{command:Ct.setStyle,args:[e]}];let r=[];try{if(!Lt(i.version,e.version))return[{command:Ct.setStyle,args:[e]}];Lt(i.center,e.center)||r.push({command:Ct.setCenter,args:[e.center]}),Lt(i.zoom,e.zoom)||r.push({command:Ct.setZoom,args:[e.zoom]}),Lt(i.bearing,e.bearing)||r.push({command:Ct.setBearing,args:[e.bearing]}),Lt(i.pitch,e.pitch)||r.push({command:Ct.setPitch,args:[e.pitch]}),Lt(i.sprite,e.sprite)||r.push({command:Ct.setSprite,args:[e.sprite]}),Lt(i.glyphs,e.glyphs)||r.push({command:Ct.setGlyphs,args:[e.glyphs]}),Lt(i.transition,e.transition)||r.push({command:Ct.setTransition,args:[e.transition]}),Lt(i.light,e.light)||r.push({command:Ct.setLight,args:[e.light]});const s={},c=[];(function(g,y,b,S){let k;for(k in y=y||{},g=g||{})Object.prototype.hasOwnProperty.call(g,k)&&(Object.prototype.hasOwnProperty.call(y,k)||$n(k,b,S));for(k in y)Object.prototype.hasOwnProperty.call(y,k)&&(Object.prototype.hasOwnProperty.call(g,k)?Lt(g[k],y[k])||(g[k].type==="geojson"&&y[k].type==="geojson"&&bo(g,y,k)?b.push({command:Ct.setGeoJSONSourceData,args:[k,y[k].data]}):xo(k,y,b,S)):Zn(k,y,b))})(i.sources,e.sources,c,s);const f=[];i.layers&&i.layers.forEach(g=>{s[g.source]?r.push({command:Ct.removeLayer,args:[g.id]}):f.push(g)}),r=r.concat(c),function(g,y,b){y=y||[];const S=(g=g||[]).map(Fs),k=y.map(Fs),L=g.reduce(gs,{}),B=y.reduce(gs,{}),O=S.slice(),U=Object.create(null);let $,X,J,oe,ie,le,ue;for($=0,X=0;$<S.length;$++)J=S[$],Object.prototype.hasOwnProperty.call(B,J)?X++:(b.push({command:Ct.removeLayer,args:[J]}),O.splice(O.indexOf(J,X),1));for($=0,X=0;$<k.length;$++)J=k[k.length-1-$],O[O.length-1-$]!==J&&(Object.prototype.hasOwnProperty.call(L,J)?(b.push({command:Ct.removeLayer,args:[J]}),O.splice(O.lastIndexOf(J,O.length-X),1)):X++,le=O[O.length-$],b.push({command:Ct.addLayer,args:[B[J],le]}),O.splice(O.length-$,0,J),U[J]=!0);for($=0;$<k.length;$++)if(J=k[$],oe=L[J],ie=B[J],!U[J]&&!Lt(oe,ie))if(Lt(oe.source,ie.source)&&Lt(oe["source-layer"],ie["source-layer"])&&Lt(oe.type,ie.type)){for(ue in Qt(oe.layout,ie.layout,b,J,null,Ct.setLayoutProperty),Qt(oe.paint,ie.paint,b,J,null,Ct.setPaintProperty),Lt(oe.filter,ie.filter)||b.push({command:Ct.setFilter,args:[J,ie.filter]}),Lt(oe.minzoom,ie.minzoom)&&Lt(oe.maxzoom,ie.maxzoom)||b.push({command:Ct.setLayerZoomRange,args:[J,ie.minzoom,ie.maxzoom]}),oe)Object.prototype.hasOwnProperty.call(oe,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?Qt(oe[ue],ie[ue],b,J,ue.slice(6),Ct.setPaintProperty):Lt(oe[ue],ie[ue])||b.push({command:Ct.setLayerProperty,args:[J,ue,ie[ue]]}));for(ue in ie)Object.prototype.hasOwnProperty.call(ie,ue)&&!Object.prototype.hasOwnProperty.call(oe,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?Qt(oe[ue],ie[ue],b,J,ue.slice(6),Ct.setPaintProperty):Lt(oe[ue],ie[ue])||b.push({command:Ct.setLayerProperty,args:[J,ue,ie[ue]]}))}else b.push({command:Ct.removeLayer,args:[J]}),le=O[O.lastIndexOf(J)+1],b.push({command:Ct.addLayer,args:[ie,le]})}(f,e.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:Ct.setStyle,args:[e]}]}return r},o.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},o.earthRadius=rh,o.emitValidationErrors=Ho,o.emptyStyle=function(){const i={},e=me.$version;for(const r in me.$root){const s=me.$root[r];if(s.required){let c=null;c=r==="version"?e:s.type==="array"?[]:{},c!=null&&(i[r]=c)}}return i},o.equals=function(i,e){var r=i[0],s=i[1],c=i[2],f=i[3],g=i[4],y=i[5],b=i[6],S=i[7],k=i[8],L=i[9],B=i[10],O=i[11],U=i[12],$=i[13],X=i[14],J=i[15],oe=e[0],ie=e[1],le=e[2],ue=e[3],ye=e[4],Oe=e[5],Ge=e[6],Fe=e[7],ze=e[8],Ae=e[9],je=e[10],ke=e[11],Te=e[12],Je=e[13],He=e[14],dt=e[15];return Math.abs(r-oe)<=or*Math.max(1,Math.abs(r),Math.abs(oe))&&Math.abs(s-ie)<=or*Math.max(1,Math.abs(s),Math.abs(ie))&&Math.abs(c-le)<=or*Math.max(1,Math.abs(c),Math.abs(le))&&Math.abs(f-ue)<=or*Math.max(1,Math.abs(f),Math.abs(ue))&&Math.abs(g-ye)<=or*Math.max(1,Math.abs(g),Math.abs(ye))&&Math.abs(y-Oe)<=or*Math.max(1,Math.abs(y),Math.abs(Oe))&&Math.abs(b-Ge)<=or*Math.max(1,Math.abs(b),Math.abs(Ge))&&Math.abs(S-Fe)<=or*Math.max(1,Math.abs(S),Math.abs(Fe))&&Math.abs(k-ze)<=or*Math.max(1,Math.abs(k),Math.abs(ze))&&Math.abs(L-Ae)<=or*Math.max(1,Math.abs(L),Math.abs(Ae))&&Math.abs(B-je)<=or*Math.max(1,Math.abs(B),Math.abs(je))&&Math.abs(O-ke)<=or*Math.max(1,Math.abs(O),Math.abs(ke))&&Math.abs(U-Te)<=or*Math.max(1,Math.abs(U),Math.abs(Te))&&Math.abs($-Je)<=or*Math.max(1,Math.abs($),Math.abs(Je))&&Math.abs(X-He)<=or*Math.max(1,Math.abs(X),Math.abs(He))&&Math.abs(J-dt)<=or*Math.max(1,Math.abs(J),Math.abs(dt))},o.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:c}){return i.kind==="source"?s/On:i.kind==="composite"?yr.number(s/On,c/On,r):e},o.evaluateSizeForZoom=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:f,maxZoom:g}=i,y=c?Se(vr.interpolationFactor(c,e,f,g),0,1):0;i.kind==="camera"?s=yr.number(i.minSize,i.maxSize,y):r=y}return{uSizeT:r,uSize:s}},o.evented=el,o.extend=Ue,o.filterObject=ht,o.findLineIntersection=function(i,e,r,s){const c=e.y-i.y,f=e.x-i.x,g=s.y-r.y,y=s.x-r.x,b=g*f-y*c;if(b===0)return null;const S=(y*(i.y-r.y)-g*(i.x-r.x))/b;return new j(i.x+S*f,i.y+S*c)},o.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.getAnchorAlignment=Yu,o.getAnchorJustification=ah,o.getArrayBuffer=Be,o.getDefaultExportFromCjs=z,o.getJSON=function(i,e){return Xi(Ue(i,{type:"json"}),e)},o.getOverlapMode=Ju,o.getProtocolAction=vi,o.getRTLTextPluginStatus=tl,o.getReferrer=oi,o.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<i.length;s++){const c=window.document.createElement("source");ot(i[s])||(r.crossOrigin="Anonymous"),c.src=i[s],r.appendChild(c)}return{cancel:()=>{}}},o.groupByLayout=function(i,e){const r={};for(let c=0;c<i.length;c++){const f=e&&e[i[c].id]||bu(i[c]);e&&(e[i[c].id]=f);let g=r[f];g||(g=r[f]=[]),g.push(i[c])}const s=[];for(const c in r)s.push(r[c]);return s},o.identity=Lu,o.interpolate=yr,o.invert=function(i,e){var r=e[0],s=e[1],c=e[2],f=e[3],g=e[4],y=e[5],b=e[6],S=e[7],k=e[8],L=e[9],B=e[10],O=e[11],U=e[12],$=e[13],X=e[14],J=e[15],oe=r*y-s*g,ie=r*b-c*g,le=r*S-f*g,ue=s*b-c*y,ye=s*S-f*y,Oe=c*S-f*b,Ge=k*$-L*U,Fe=k*X-B*U,ze=k*J-O*U,Ae=L*X-B*$,je=L*J-O*$,ke=B*J-O*X,Te=oe*ke-ie*je+le*Ae+ue*ze-ye*Fe+Oe*Ge;return Te?(i[0]=(y*ke-b*je+S*Ae)*(Te=1/Te),i[1]=(c*je-s*ke-f*Ae)*Te,i[2]=($*Oe-X*ye+J*ue)*Te,i[3]=(B*ye-L*Oe-O*ue)*Te,i[4]=(b*ze-g*ke-S*Fe)*Te,i[5]=(r*ke-c*ze+f*Fe)*Te,i[6]=(X*le-U*Oe-J*ie)*Te,i[7]=(k*Oe-B*le+O*ie)*Te,i[8]=(g*je-y*ze+S*Ge)*Te,i[9]=(s*ze-r*je-f*Ge)*Te,i[10]=(U*ye-$*le+J*oe)*Te,i[11]=(L*le-k*ye-O*oe)*Te,i[12]=(y*Fe-g*Ae-b*Ge)*Te,i[13]=(r*Ae-s*Fe+c*Ge)*Te,i[14]=($*ie-U*ue-X*oe)*Te,i[15]=(k*ue-L*ie+B*oe)*Te,i):null},o.isImageBitmap=$t,o.isSafari=fr,o.isWorker=Zt,o.keysDifference=function(i,e){const r=[];for(const s in i)s in e||r.push(s);return r},o.lazyLoadRTLTextPlugin=function(){Lr.isLoading()||Lr.isLoaded()||tl()!=="deferred"||pc()},o.makeRequest=Xi,o.mapObject=pt,o.mercatorXfromLng=Hd,o.mercatorYfromLat=Wd,o.mercatorZfromAltitude=Xd,o.mul=hm,o.mul$1=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},o.multiply=Jh,o.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},o.operations=Ct,o.ortho=function(i,e,r,s,c,f,g){var y=1/(e-r),b=1/(s-c),S=1/(f-g);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*S,i[11]=0,i[12]=(e+r)*y,i[13]=(c+s)*b,i[14]=(g+f)*S,i[15]=1,i},o.parseCacheControl=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,c,f)=>{const g=c||f;return e[s]=!g||g.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},o.parseGlyphPbf=function(i){return new Hu(i).readFields(gg,[])},o.pbf=Td,o.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=ti/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,s=e._unevaluatedLayout._values,c={layoutIconSize:s["icon-size"].possiblyEvaluate(new Gt(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Gt(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Gt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:k}=i.bucket.textSizeData;c.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Gt(S),i.canonical),s["text-size"].possiblyEvaluate(new Gt(k),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:k}=i.bucket.iconSizeData;c.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Gt(S),i.canonical),s["icon-size"].possiblyEvaluate(new Gt(k),i.canonical)]}const f=r.get("text-line-height")*Mi,g=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",y=r.get("text-keep-upright"),b=r.get("text-size");for(const S of i.bucket.features){const k=r.get("text-font").evaluate(S,{},i.canonical).join(","),L=b.evaluate(S,{},i.canonical),B=c.layoutTextSize.evaluate(S,{},i.canonical),O=c.layoutIconSize.evaluate(S,{},i.canonical),U={horizontal:{},vertical:void 0},$=S.text;let X,J=[0,0];if($){const le=$.toString(),ue=r.get("text-letter-spacing").evaluate(S,{},i.canonical)*Mi,ye=hc(le)?ue:0,Oe=r.get("text-anchor").evaluate(S,{},i.canonical),Ge=pp(e,S,i.canonical);if(!Ge){const ke=r.get("text-radial-offset").evaluate(S,{},i.canonical);J=ke?dp(Oe,[ke*Mi,oh]):r.get("text-offset").evaluate(S,{},i.canonical).map(Te=>Te*Mi)}let Fe=g?"center":r.get("text-justify").evaluate(S,{},i.canonical);const ze=r.get("symbol-placement"),Ae=ze==="point"?r.get("text-max-width").evaluate(S,{},i.canonical)*Mi:0,je=()=>{i.bucket.allowVerticalPlacement&&Wo(le)&&(U.vertical=Ic($,i.glyphMap,i.glyphPositions,i.imagePositions,k,Ae,f,Oe,"left",ye,J,o.WritingMode.vertical,!0,ze,B,L))};if(!g&&Ge){const ke=new Set;if(Fe==="auto")for(let Je=0;Je<Ge.values.length;Je+=2)ke.add(ah(Ge.values[Je]));else ke.add(Fe);let Te=!1;for(const Je of ke)if(!U.horizontal[Je])if(Te)U.horizontal[Je]=U.horizontal[0];else{const He=Ic($,i.glyphMap,i.glyphPositions,i.imagePositions,k,Ae,f,"center",Je,ye,J,o.WritingMode.horizontal,!1,ze,B,L);He&&(U.horizontal[Je]=He,Te=He.positionedLines.length===1)}je()}else{Fe==="auto"&&(Fe=ah(Oe));const ke=Ic($,i.glyphMap,i.glyphPositions,i.imagePositions,k,Ae,f,Oe,Fe,ye,J,o.WritingMode.horizontal,!1,ze,B,L);ke&&(U.horizontal[Fe]=ke),je(),Wo(le)&&g&&y&&(U.vertical=Ic($,i.glyphMap,i.glyphPositions,i.imagePositions,k,Ae,f,Oe,Fe,ye,J,o.WritingMode.vertical,!1,ze,B,L))}}let oe=!1;if(S.icon&&S.icon.name){const le=i.imageMap[S.icon.name];le&&(X=wg(i.imagePositions[S.icon.name],r.get("icon-offset").evaluate(S,{},i.canonical),r.get("icon-anchor").evaluate(S,{},i.canonical)),oe=!!le.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=oe:i.bucket.sdfIcons!==oe&&_t("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(le.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ie=mp(U.horizontal)||U.vertical;i.bucket.iconsInText=!!ie&&ie.iconsInText,(ie||X)&&Ug(i.bucket,S,U,X,i.imageMap,c,B,O,J,oe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},o.perspective=function(i,e,r,s,c){var f,g=1/Math.tan(e/2);return i[0]=g/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+s)*(f=1/(s-c)),i[14]=2*c*s*f):(i[10]=-1,i[14]=-2*s),i},o.pick=function(i,e){const r={};for(let s=0;s<e.length;s++){const c=e[s];c in i&&(r[c]=i[c])}return r},o.plugin=Lr,o.pointGeometry=A,o.polygonIntersectsPolygon=Gh,o.potpack=Ld,o.register=Ve,o.registerForPluginStateChange=function(i){return i({pluginStatus:rr,pluginURL:Dn}),el.on("pluginStateChange",i),i},o.renderColorRamp=rd,o.rotateX=function(i,e,r){var s=Math.sin(r),c=Math.cos(r),f=e[4],g=e[5],y=e[6],b=e[7],S=e[8],k=e[9],L=e[10],B=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=f*c+S*s,i[5]=g*c+k*s,i[6]=y*c+L*s,i[7]=b*c+B*s,i[8]=S*c-f*s,i[9]=k*c-g*s,i[10]=L*c-y*s,i[11]=B*c-b*s,i},o.rotateZ=function(i,e,r){var s=Math.sin(r),c=Math.cos(r),f=e[0],g=e[1],y=e[2],b=e[3],S=e[4],k=e[5],L=e[6],B=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=f*c+S*s,i[1]=g*c+k*s,i[2]=y*c+L*s,i[3]=b*c+B*s,i[4]=S*c-f*s,i[5]=k*c-g*s,i[6]=L*c-y*s,i[7]=B*c-b*s,i},o.sameOrigin=ot,o.scale=function(i,e,r){var s=r[0],c=r[1],f=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*f,i[9]=e[9]*f,i[10]=e[10]*f,i[11]=e[11]*f,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},o.setRTLTextPlugin=function(i,e,r=!1){if(rr===Xa||rr===ao||rr===Ka)throw new Error("setRTLTextPlugin cannot be called multiple times.");Dn=en.resolveURL(i),rr=Xa,Ya=e,Qa(),r||pc()},o.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},o.toEvaluationFeature=Fn,o.transformMat4=xc,o.translate=function(i,e,r){var s,c,f,g,y,b,S,k,L,B,O,U,$=r[0],X=r[1],J=r[2];return e===i?(i[12]=e[0]*$+e[4]*X+e[8]*J+e[12],i[13]=e[1]*$+e[5]*X+e[9]*J+e[13],i[14]=e[2]*$+e[6]*X+e[10]*J+e[14],i[15]=e[3]*$+e[7]*X+e[11]*J+e[15]):(c=e[1],f=e[2],g=e[3],y=e[4],b=e[5],S=e[6],k=e[7],L=e[8],B=e[9],O=e[10],U=e[11],i[0]=s=e[0],i[1]=c,i[2]=f,i[3]=g,i[4]=y,i[5]=b,i[6]=S,i[7]=k,i[8]=L,i[9]=B,i[10]=O,i[11]=U,i[12]=s*$+y*X+L*J+e[12],i[13]=c*$+b*X+B*J+e[13],i[14]=f*$+S*X+O*J+e[14],i[15]=g*$+k*X+U*J+e[15]),i},o.triggerPluginCompletionEvent=Ja,o.unicodeBlockLookup=Re,o.uniqueId=function(){return lt++},o.v8Spec=me,o.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateLight=wu,o.validateStyle=to,o.vectorTile=Ms,o.warnOnce=_t,o.wrap=Ne}),T(["./shared"],function(o){class z{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,R){for(const K of D){this._layerConfigs[K.id]=K;const Q=this._layers[K.id]=o.createStyleLayer(K);Q._featureFilter=o.createFilter(Q.filter),this.keyCache[K.id]&&delete this.keyCache[K.id]}for(const K of R)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const V=o.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const K of V){const Q=K.map(xe=>this._layers[xe.id]),se=Q[0];if(se.visibility==="none")continue;const te=se.source||"";let ee=this.familiesBySource[te];ee||(ee=this.familiesBySource[te]={});const ae=se.sourceLayer||"_geojsonTileLayer";let ve=ee[ae];ve||(ve=ee[ae]=[]),ve.push(Q)}}}class A{constructor(D){const R={},V=[];for(const te in D){const ee=D[te],ae=R[te]={};for(const ve in ee){const xe=ee[+ve];if(!xe||xe.bitmap.width===0||xe.bitmap.height===0)continue;const be={x:0,y:0,w:xe.bitmap.width+2,h:xe.bitmap.height+2};V.push(be),ae[ve]={rect:be,metrics:xe.metrics}}}const{w:K,h:Q}=o.potpack(V),se=new o.AlphaImage({width:K||1,height:Q||1});for(const te in D){const ee=D[te];for(const ae in ee){const ve=ee[+ae];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const xe=R[te][ae].rect;o.AlphaImage.copy(ve.bitmap,se,{x:0,y:0},{x:xe.x+1,y:xe.y+1},ve.bitmap)}}this.image=se,this.positions=R}}o.register("GlyphAtlas",A);class G{constructor(D){this.tileID=new o.OverscaledTileID(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(D,R,V,K,Q){this.status="parsing",this.data=D,this.collisionBoxArray=new o.CollisionBoxArray;const se=new o.DictionaryCoder(Object.keys(D.layers).sort()),te=new o.FeatureIndex(this.tileID,this.promoteId);te.bucketLayerIDs=[];const ee={},ae={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:V},ve=R.familiesBySource[this.source];for(const yt in ve){const wt=D.layers[yt];if(!wt)continue;wt.version===1&&o.warnOnce(`Vector tile source "${this.source}" layer "${yt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ir=se.encode(yt),rt=[];for(let xi=0;xi<wt.length;xi++){const Bi=wt.feature(xi),ai=te.getId(Bi,yt);rt.push({feature:Bi,id:ai,index:xi,sourceLayerIndex:ir})}for(const xi of ve[yt]){const Bi=xi[0];Bi.source!==this.source&&o.warnOnce(`layer.source = ${Bi.source} does not equal this.source = ${this.source}`),Bi.minzoom&&this.zoom<Math.floor(Bi.minzoom)||Bi.maxzoom&&this.zoom>=Bi.maxzoom||Bi.visibility!=="none"&&(j(xi,this.zoom,V),(ee[Bi.id]=Bi.createBucket({index:te.bucketLayerIDs.length,layers:xi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ir,sourceID:this.source})).populate(rt,ae,this.tileID.canonical),te.bucketLayerIDs.push(xi.map(ai=>ai.id)))}}let xe,be,Qe,at;const Ze=o.mapObject(ae.glyphDependencies,yt=>Object.keys(yt).map(Number));this.inFlightDependencies.forEach(yt=>yt==null?void 0:yt.cancel()),this.inFlightDependencies=[];const Xe=++this.dependencySentinel;Object.keys(Ze).length?this.inFlightDependencies.push(K.send("getGlyphs",{uid:this.uid,stacks:Ze,source:this.source,tileID:this.tileID,type:"glyphs"},(yt,wt)=>{Xe===this.dependencySentinel&&(xe||(xe=yt,be=wt,zt.call(this)))})):be={};const nt=Object.keys(ae.iconDependencies);nt.length?this.inFlightDependencies.push(K.send("getImages",{icons:nt,source:this.source,tileID:this.tileID,type:"icons"},(yt,wt)=>{Xe===this.dependencySentinel&&(xe||(xe=yt,Qe=wt,zt.call(this)))})):Qe={};const Et=Object.keys(ae.patternDependencies);function zt(){if(xe)return Q(xe);if(be&&Qe&&at){const yt=new A(be),wt=new o.ImageAtlas(Qe,at);for(const ir in ee){const rt=ee[ir];rt instanceof o.SymbolBucket?(j(rt.layers,this.zoom,V),o.performSymbolLayout({bucket:rt,glyphMap:be,glyphPositions:yt.positions,imageMap:Qe,imagePositions:wt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):rt.hasPattern&&(rt instanceof o.LineBucket||rt instanceof o.FillBucket||rt instanceof o.FillExtrusionBucket)&&(j(rt.layers,this.zoom,V),rt.addFeatures(ae,this.tileID.canonical,wt.patternPositions))}this.status="done",Q(null,{buckets:Object.values(ee).filter(ir=>!ir.isEmpty()),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yt.image,imageAtlas:wt,glyphMap:this.returnDependencies?be:null,iconMap:this.returnDependencies?Qe:null,glyphPositions:this.returnDependencies?yt.positions:null})}}Et.length?this.inFlightDependencies.push(K.send("getImages",{icons:Et,source:this.source,tileID:this.tileID,type:"patterns"},(yt,wt)=>{Xe===this.dependencySentinel&&(xe||(xe=yt,at=wt,zt.call(this)))})):at={},zt.call(this)}}function j(W,D,R){const V=new o.EvaluationParameters(D);for(const K of W)K.recalculate(V,R)}function fe(W,D){const R=o.getArrayBuffer(W.request,(V,K,Q,se)=>{V?D(V):K&&D(null,{vectorTile:new o.vectorTile.VectorTile(new o.Protobuf(K)),rawData:K,cacheControl:Q,expires:se})});return()=>{R.cancel(),D()}}class ge{constructor(D,R,V,K){this.actor=D,this.layerIndex=R,this.availableImages=V,this.loadVectorData=K||fe,this.fetching={},this.loading={},this.loaded={}}loadTile(D,R){const V=D.uid;this.loading||(this.loading={});const K=!!(D&&D.request&&D.request.collectResourceTiming)&&new o.RequestPerformance(D.request),Q=this.loading[V]=new G(D);Q.abort=this.loadVectorData(D,(se,te)=>{if(delete this.loading[V],se||!te)return Q.status="done",this.loaded[V]=Q,R(se);const ee=te.rawData,ae={};te.expires&&(ae.expires=te.expires),te.cacheControl&&(ae.cacheControl=te.cacheControl);const ve={};if(K){const xe=K.finish();xe&&(ve.resourceTiming=JSON.parse(JSON.stringify(xe)))}Q.vectorTile=te.vectorTile,Q.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,(xe,be)=>{if(delete this.fetching[V],xe||!be)return R(xe);R(null,o.extend({rawTileData:ee.slice(0)},be,ae,ve))}),this.loaded=this.loaded||{},this.loaded[V]=Q,this.fetching[V]={rawTileData:ee,cacheControl:ae,resourceTiming:ve}})}reloadTile(D,R){const V=this.loaded,K=D.uid;if(V&&V[K]){const Q=V[K];Q.showCollisionBoxes=D.showCollisionBoxes,Q.status==="parsing"?Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,(se,te)=>{if(se||!te)return R(se,te);let ee;if(this.fetching[K]){const{rawTileData:ae,cacheControl:ve,resourceTiming:xe}=this.fetching[K];delete this.fetching[K],ee=o.extend({rawTileData:ae.slice(0)},te,ve,xe)}else ee=te;R(null,ee)}):Q.status==="done"&&(Q.vectorTile?Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,R):R())}}abortTile(D,R){const V=this.loading,K=D.uid;V&&V[K]&&V[K].abort&&(V[K].abort(),delete V[K]),R()}removeTile(D,R){const V=this.loaded,K=D.uid;V&&V[K]&&delete V[K],R()}}class he{constructor(){this.loaded={}}loadTile(D,R){const{uid:V,encoding:K,rawImageData:Q}=D,se=o.isImageBitmap(Q)?this.getImageData(Q):Q,te=new o.DEMData(V,se,K);this.loaded=this.loaded||{},this.loaded[V]=te,R(null,te)}getImageData(D){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);const R=this.offscreenCanvasContext.getImageData(-1,-1,D.width+2,D.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:R.width,height:R.height},R.data)}removeTile(D){const R=this.loaded,V=D.uid;R&&R[V]&&delete R[V]}}function Ce(W,D){if(W.length!==0){De(W[0],D);for(var R=1;R<W.length;R++)De(W[R],!D)}}function De(W,D){for(var R=0,V=0,K=0,Q=W.length,se=Q-1;K<Q;se=K++){var te=(W[K][0]-W[se][0])*(W[se][1]+W[K][1]),ee=R+te;V+=Math.abs(R)>=Math.abs(te)?R-ee+te:te-ee+R,R=ee}R+V>=0!=!!D&&W.reverse()}var Se=o.getDefaultExportFromCjs(function W(D,R){var V,K=D&&D.type;if(K==="FeatureCollection")for(V=0;V<D.features.length;V++)W(D.features[V],R);else if(K==="GeometryCollection")for(V=0;V<D.geometries.length;V++)W(D.geometries[V],R);else if(K==="Feature")W(D.geometry,R);else if(K==="Polygon")Ce(D.coordinates,R);else if(K==="MultiPolygon")for(V=0;V<D.coordinates.length;V++)Ce(D.coordinates[V],R);return D});const Ne=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;var Ue={exports:{}},lt=o.pointGeometry,pt=o.vectorTile.VectorTileFeature,ht=st;function st(W,D){this.options=D||{},this.features=W,this.length=W.length}function xt(W,D){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=D||4096}st.prototype.feature=function(W){return new xt(this.features[W],this.options.extent)},xt.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var D=0;D<W.length;D++){for(var R=W[D],V=[],K=0;K<R.length;K++)V.push(new lt(R[K][0],R[K][1]));this.geometry.push(V)}return this.geometry},xt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,D=1/0,R=-1/0,V=1/0,K=-1/0,Q=0;Q<W.length;Q++)for(var se=W[Q],te=0;te<se.length;te++){var ee=se[te];D=Math.min(D,ee.x),R=Math.max(R,ee.x),V=Math.min(V,ee.y),K=Math.max(K,ee.y)}return[D,V,R,K]},xt.prototype.toGeoJSON=pt.prototype.toGeoJSON;var _t=o.pbf,tt=ht;function gi(W){var D=new _t;return function(R,V){for(var K in R.layers)V.writeMessage(3,Zt,R.layers[K])}(W,D),D.finish()}function Zt(W,D){var R;D.writeVarintField(15,W.version||1),D.writeStringField(1,W.name||""),D.writeVarintField(5,W.extent||4096);var V={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<W.length;R++)V.feature=W.feature(R),D.writeMessage(2,_i,V);var K=V.keys;for(R=0;R<K.length;R++)D.writeStringField(3,K[R]);var Q=V.values;for(R=0;R<Q.length;R++)D.writeMessage(4,Jt,Q[R])}function _i(W,D){var R=W.feature;R.id!==void 0&&D.writeVarintField(1,R.id),D.writeMessage(2,fr,W),D.writeVarintField(3,R.type),D.writeMessage(4,er,R)}function fr(W,D){var R=W.feature,V=W.keys,K=W.values,Q=W.keycache,se=W.valuecache;for(var te in R.properties){var ee=R.properties[te],ae=Q[te];if(ee!==null){ae===void 0&&(V.push(te),Q[te]=ae=V.length-1),D.writeVarint(ae);var ve=typeof ee;ve!=="string"&&ve!=="boolean"&&ve!=="number"&&(ee=JSON.stringify(ee));var xe=ve+":"+ee,be=se[xe];be===void 0&&(K.push(ee),se[xe]=be=K.length-1),D.writeVarint(be)}}}function $t(W,D){return(D<<3)+(7&W)}function yi(W){return W<<1^W>>31}function er(W,D){for(var R=W.loadGeometry(),V=W.type,K=0,Q=0,se=R.length,te=0;te<se;te++){var ee=R[te],ae=1;V===1&&(ae=ee.length),D.writeVarint($t(1,ae));for(var ve=V===3?ee.length-1:ee.length,xe=0;xe<ve;xe++){xe===1&&V!==1&&D.writeVarint($t(2,ve-1));var be=ee[xe].x-K,Qe=ee[xe].y-Q;D.writeVarint(yi(be)),D.writeVarint(yi(Qe)),K+=be,Q+=Qe}V===3&&D.writeVarint($t(7,1))}}function Jt(W,D){var R=typeof W;R==="string"?D.writeStringField(1,W):R==="boolean"?D.writeBooleanField(7,W):R==="number"&&(W%1!=0?D.writeDoubleField(3,W):W<0?D.writeSVarintField(6,W):D.writeVarintField(5,W))}Ue.exports=gi,Ue.exports.fromVectorTileJs=gi,Ue.exports.fromGeojsonVt=function(W,D){D=D||{};var R={};for(var V in W)R[V]=new tt(W[V].features,D),R[V].name=V,R[V].version=D.version,R[V].extent=D.extent;return gi({layers:R})},Ue.exports.GeoJSONWrapper=tt;var en=o.getDefaultExportFromCjs(Ue.exports);const Ur={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},Fi=Math.fround||(oi=new Float32Array(1),W=>(oi[0]=+W,oi[0]));var oi;const vi=3,kt=5,Xi=6;class Be{constructor(D){this.options=Object.assign(Object.create(Ur),D),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(D){const{log:R,minZoom:V,maxZoom:K}=this.options;R&&console.time("total time");const Q=`prepare ${D.length} points`;R&&console.time(Q),this.points=D;const se=[];for(let ee=0;ee<D.length;ee++){const ae=D[ee];if(!ae.geometry)continue;const[ve,xe]=ae.geometry.coordinates,be=Fi(Oi(ve)),Qe=Fi(Ki(xe));se.push(be,Qe,1/0,ee,-1,1),this.options.reduce&&se.push(0)}let te=this.trees[K+1]=this._createTree(se);R&&console.timeEnd(Q);for(let ee=K;ee>=V;ee--){const ae=+Date.now();te=this.trees[ee]=this._createTree(this._cluster(te,ee)),R&&console.log("z%d: %d clusters in %dms",ee,te.numItems,+Date.now()-ae)}return R&&console.timeEnd("total time"),this}getClusters(D,R){let V=((D[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,D[1]));let Q=D[2]===180?180:((D[2]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)V=-180,Q=180;else if(V>Q){const xe=this.getClusters([V,K,180,se],R),be=this.getClusters([-180,K,Q,se],R);return xe.concat(be)}const te=this.trees[this._limitZoom(R)],ee=te.range(Oi(V),Ki(se),Oi(Q),Ki(K)),ae=te.data,ve=[];for(const xe of ee){const be=this.stride*xe;ve.push(ae[be+kt]>1?ot(ae,be,this.clusterProps):this.points[ae[be+vi]])}return ve}getChildren(D){const R=this._getOriginId(D),V=this._getOriginZoom(D),K="No cluster with the specified id.",Q=this.trees[V];if(!Q)throw new Error(K);const se=Q.data;if(R*this.stride>=se.length)throw new Error(K);const te=this.options.radius/(this.options.extent*Math.pow(2,V-1)),ee=Q.within(se[R*this.stride],se[R*this.stride+1],te),ae=[];for(const ve of ee){const xe=ve*this.stride;se[xe+4]===D&&ae.push(se[xe+kt]>1?ot(se,xe,this.clusterProps):this.points[se[xe+vi]])}if(ae.length===0)throw new Error(K);return ae}getLeaves(D,R,V){const K=[];return this._appendLeaves(K,D,R=R||10,V=V||0,0),K}getTile(D,R,V){const K=this.trees[this._limitZoom(D)],Q=Math.pow(2,D),{extent:se,radius:te}=this.options,ee=te/se,ae=(V-ee)/Q,ve=(V+1+ee)/Q,xe={features:[]};return this._addTileFeatures(K.range((R-ee)/Q,ae,(R+1+ee)/Q,ve),K.data,R,V,Q,xe),R===0&&this._addTileFeatures(K.range(1-ee/Q,ae,1,ve),K.data,Q,V,Q,xe),R===Q-1&&this._addTileFeatures(K.range(0,ae,ee/Q,ve),K.data,-1,V,Q,xe),xe.features.length?xe:null}getClusterExpansionZoom(D){let R=this._getOriginZoom(D)-1;for(;R<=this.options.maxZoom;){const V=this.getChildren(D);if(R++,V.length!==1)break;D=V[0].properties.cluster_id}return R}_appendLeaves(D,R,V,K,Q){const se=this.getChildren(R);for(const te of se){const ee=te.properties;if(ee&&ee.cluster?Q+ee.point_count<=K?Q+=ee.point_count:Q=this._appendLeaves(D,ee.cluster_id,V,K,Q):Q<K?Q++:D.push(te),D.length===V)break}return Q}_createTree(D){const R=new o.KDBush(D.length/this.stride|0,this.options.nodeSize,Float32Array);for(let V=0;V<D.length;V+=this.stride)R.add(D[V],D[V+1]);return R.finish(),R.data=D,R}_addTileFeatures(D,R,V,K,Q,se){for(const te of D){const ee=te*this.stride,ae=R[ee+kt]>1;let ve,xe,be;if(ae)ve=Rt(R,ee,this.clusterProps),xe=R[ee],be=R[ee+1];else{const Ze=this.points[R[ee+vi]];ve=Ze.properties;const[Xe,nt]=Ze.geometry.coordinates;xe=Oi(Xe),be=Ki(nt)}const Qe={type:1,geometry:[[Math.round(this.options.extent*(xe*Q-V)),Math.round(this.options.extent*(be*Q-K))]],tags:ve};let at;at=ae||this.options.generateId?R[ee+vi]:this.points[R[ee+vi]].id,at!==void 0&&(Qe.id=at),se.features.push(Qe)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,R){const{radius:V,extent:K,reduce:Q,minPoints:se}=this.options,te=V/(K*Math.pow(2,R)),ee=D.data,ae=[],ve=this.stride;for(let xe=0;xe<ee.length;xe+=ve){if(ee[xe+2]<=R)continue;ee[xe+2]=R;const be=ee[xe],Qe=ee[xe+1],at=D.within(ee[xe],ee[xe+1],te),Ze=ee[xe+kt];let Xe=Ze;for(const nt of at){const Et=nt*ve;ee[Et+2]>R&&(Xe+=ee[Et+kt])}if(Xe>Ze&&Xe>=se){let nt,Et=be*Ze,zt=Qe*Ze,yt=-1;const wt=((xe/ve|0)<<5)+(R+1)+this.points.length;for(const ir of at){const rt=ir*ve;if(ee[rt+2]<=R)continue;ee[rt+2]=R;const xi=ee[rt+kt];Et+=ee[rt]*xi,zt+=ee[rt+1]*xi,ee[rt+4]=wt,Q&&(nt||(nt=this._map(ee,xe,!0),yt=this.clusterProps.length,this.clusterProps.push(nt)),Q(nt,this._map(ee,rt)))}ee[xe+4]=wt,ae.push(Et/Xe,zt/Xe,1/0,wt,-1,Xe),Q&&ae.push(yt)}else{for(let nt=0;nt<ve;nt++)ae.push(ee[xe+nt]);if(Xe>1)for(const nt of at){const Et=nt*ve;if(!(ee[Et+2]<=R)){ee[Et+2]=R;for(let zt=0;zt<ve;zt++)ae.push(ee[Et+zt])}}}}return ae}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,R,V){if(D[R+kt]>1){const se=this.clusterProps[D[R+Xi]];return V?Object.assign({},se):se}const K=this.points[D[R+vi]].properties,Q=this.options.map(K);return V&&Q===K?Object.assign({},Q):Q}}function ot(W,D,R){return{type:"Feature",id:W[D+vi],properties:Rt(W,D,R),geometry:{type:"Point",coordinates:[(V=W[D],360*(V-.5)),mr(W[D+1])]}};var V}function Rt(W,D,R){const V=W[D+kt],K=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V,Q=W[D+Xi],se=Q===-1?{}:Object.assign({},R[Q]);return Object.assign(se,{cluster:!0,cluster_id:W[D+vi],point_count:V,point_count_abbreviated:K})}function Oi(W){return W/360+.5}function Ki(W){const D=Math.sin(W*Math.PI/180),R=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return R<0?0:R>1?1:R}function mr(W){const D=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function Vr(W,D,R,V){for(var K,Q=V,se=R-D>>1,te=R-D,ee=W[D],ae=W[D+1],ve=W[R],xe=W[R+1],be=D+3;be<R;be+=3){var Qe=me(W[be],W[be+1],ee,ae,ve,xe);if(Qe>Q)K=be,Q=Qe;else if(Qe===Q){var at=Math.abs(be-se);at<te&&(K=be,te=at)}}Q>V&&(K-D>3&&Vr(W,D,K,V),W[K+2]=Q,R-K>3&&Vr(W,K,R,V))}function me(W,D,R,V,K,Q){var se=K-R,te=Q-V;if(se!==0||te!==0){var ee=((W-R)*se+(D-V)*te)/(se*se+te*te);ee>1?(R=K,V=Q):ee>0&&(R+=se*ee,V+=te*ee)}return(se=W-R)*se+(te=D-V)*te}function pn(W,D,R,V){var K={id:W===void 0?null:W,type:D,geometry:R,tags:V,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Q){var se=Q.geometry,te=Q.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")ms(Q,se);else if(te==="Polygon"||te==="MultiLineString")for(var ee=0;ee<se.length;ee++)ms(Q,se[ee]);else if(te==="MultiPolygon")for(ee=0;ee<se.length;ee++)for(var ae=0;ae<se[ee].length;ae++)ms(Q,se[ee][ae])}(K),K}function ms(W,D){for(var R=0;R<D.length;R+=3)W.minX=Math.min(W.minX,D[R]),W.minY=Math.min(W.minY,D[R+1]),W.maxX=Math.max(W.maxX,D[R]),W.maxY=Math.max(W.maxY,D[R+1])}function Lt(W,D,R,V){if(D.geometry){var K=D.geometry.coordinates,Q=D.geometry.type,se=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),te=[],ee=D.id;if(R.promoteId?ee=D.properties[R.promoteId]:R.generateId&&(ee=V||0),Q==="Point")Ct(K,te);else if(Q==="MultiPoint")for(var ae=0;ae<K.length;ae++)Ct(K[ae],te);else if(Q==="LineString")Zn(K,te,se,!1);else if(Q==="MultiLineString"){if(R.lineMetrics){for(ae=0;ae<K.length;ae++)Zn(K[ae],te=[],se,!1),W.push(pn(ee,"LineString",te,D.properties));return}$n(K,te,se,!1)}else if(Q==="Polygon")$n(K,te,se,!0);else{if(Q!=="MultiPolygon"){if(Q==="GeometryCollection"){for(ae=0;ae<D.geometry.geometries.length;ae++)Lt(W,{id:ee,geometry:D.geometry.geometries[ae],properties:D.properties},R,V);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ae=0;ae<K.length;ae++){var ve=[];$n(K[ae],ve,se,!0),te.push(ve)}}W.push(pn(ee,Q,te,D.properties))}}function Ct(W,D){D.push(xo(W[0])),D.push(bo(W[1])),D.push(0)}function Zn(W,D,R,V){for(var K,Q,se=0,te=0;te<W.length;te++){var ee=xo(W[te][0]),ae=bo(W[te][1]);D.push(ee),D.push(ae),D.push(0),te>0&&(se+=V?(K*ae-ee*Q)/2:Math.sqrt(Math.pow(ee-K,2)+Math.pow(ae-Q,2))),K=ee,Q=ae}var ve=D.length-3;D[2]=1,Vr(D,0,ve,R),D[ve+2]=1,D.size=Math.abs(se),D.start=0,D.end=D.size}function $n(W,D,R,V){for(var K=0;K<W.length;K++){var Q=[];Zn(W[K],Q,R,V),D.push(Q)}}function xo(W){return W/360+.5}function bo(W){var D=Math.sin(W*Math.PI/180),R=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return R<0?0:R>1?1:R}function Qt(W,D,R,V,K,Q,se,te){if(V/=D,Q>=(R/=D)&&se<V)return W;if(se<R||Q>=V)return null;for(var ee=[],ae=0;ae<W.length;ae++){var ve=W[ae],xe=ve.geometry,be=ve.type,Qe=K===0?ve.minX:ve.minY,at=K===0?ve.maxX:ve.maxY;if(Qe>=R&&at<V)ee.push(ve);else if(!(at<R||Qe>=V)){var Ze=[];if(be==="Point"||be==="MultiPoint")Fs(xe,Ze,R,V,K);else if(be==="LineString")gs(xe,Ze,R,V,K,!1,te.lineMetrics);else if(be==="MultiLineString")Yi(xe,Ze,R,V,K,!1);else if(be==="Polygon")Yi(xe,Ze,R,V,K,!0);else if(be==="MultiPolygon")for(var Xe=0;Xe<xe.length;Xe++){var nt=[];Yi(xe[Xe],nt,R,V,K,!0),nt.length&&Ze.push(nt)}if(Ze.length){if(te.lineMetrics&&be==="LineString"){for(Xe=0;Xe<Ze.length;Xe++)ee.push(pn(ve.id,be,Ze[Xe],ve.tags));continue}be!=="LineString"&&be!=="MultiLineString"||(Ze.length===1?(be="LineString",Ze=Ze[0]):be="MultiLineString"),be!=="Point"&&be!=="MultiPoint"||(be=Ze.length===3?"Point":"MultiPoint"),ee.push(pn(ve.id,be,Ze,ve.tags))}}}return ee.length?ee:null}function Fs(W,D,R,V,K){for(var Q=0;Q<W.length;Q+=3){var se=W[Q+K];se>=R&&se<=V&&(D.push(W[Q]),D.push(W[Q+1]),D.push(W[Q+2]))}}function gs(W,D,R,V,K,Q,se){for(var te,ee,ae=Me(W),ve=K===0?fn:An,xe=W.start,be=0;be<W.length-3;be+=3){var Qe=W[be],at=W[be+1],Ze=W[be+2],Xe=W[be+3],nt=W[be+4],Et=K===0?Qe:at,zt=K===0?Xe:nt,yt=!1;se&&(te=Math.sqrt(Math.pow(Qe-Xe,2)+Math.pow(at-nt,2))),Et<R?zt>R&&(ee=ve(ae,Qe,at,Xe,nt,R),se&&(ae.start=xe+te*ee)):Et>V?zt<V&&(ee=ve(ae,Qe,at,Xe,nt,V),se&&(ae.start=xe+te*ee)):tr(ae,Qe,at,Ze),zt<R&&Et>=R&&(ee=ve(ae,Qe,at,Xe,nt,R),yt=!0),zt>V&&Et<=V&&(ee=ve(ae,Qe,at,Xe,nt,V),yt=!0),!Q&&yt&&(se&&(ae.end=xe+te*ee),D.push(ae),ae=Me(W)),se&&(xe+=te)}var wt=W.length-3;Qe=W[wt],at=W[wt+1],Ze=W[wt+2],(Et=K===0?Qe:at)>=R&&Et<=V&&tr(ae,Qe,at,Ze),wt=ae.length-3,Q&&wt>=3&&(ae[wt]!==ae[0]||ae[wt+1]!==ae[1])&&tr(ae,ae[0],ae[1],ae[2]),ae.length&&D.push(ae)}function Me(W){var D=[];return D.size=W.size,D.start=W.start,D.end=W.end,D}function Yi(W,D,R,V,K,Q){for(var se=0;se<W.length;se++)gs(W[se],D,R,V,K,Q,!1)}function tr(W,D,R,V){W.push(D),W.push(R),W.push(V)}function fn(W,D,R,V,K,Q){var se=(Q-D)/(V-D);return W.push(Q),W.push(R+(K-R)*se),W.push(1),se}function An(W,D,R,V,K,Q){var se=(Q-R)/(K-R);return W.push(D+(V-D)*se),W.push(Q),W.push(1),se}function Pe(W,D){for(var R=[],V=0;V<W.length;V++){var K,Q=W[V],se=Q.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")K=ct(Q.geometry,D);else if(se==="MultiLineString"||se==="Polygon"){K=[];for(var te=0;te<Q.geometry.length;te++)K.push(ct(Q.geometry[te],D))}else if(se==="MultiPolygon")for(K=[],te=0;te<Q.geometry.length;te++){for(var ee=[],ae=0;ae<Q.geometry[te].length;ae++)ee.push(ct(Q.geometry[te][ae],D));K.push(ee)}R.push(pn(Q.id,se,K,Q.tags))}return R}function ct(W,D){var R=[];R.size=W.size,W.start!==void 0&&(R.start=W.start,R.end=W.end);for(var V=0;V<W.length;V+=3)R.push(W[V]+D,W[V+1],W[V+2]);return R}function ut(W,D){if(W.transformed)return W;var R,V,K,Q=1<<W.z,se=W.x,te=W.y;for(R=0;R<W.features.length;R++){var ee=W.features[R],ae=ee.geometry,ve=ee.type;if(ee.geometry=[],ve===1)for(V=0;V<ae.length;V+=2)ee.geometry.push(Ui(ae[V],ae[V+1],D,Q,se,te));else for(V=0;V<ae.length;V++){var xe=[];for(K=0;K<ae[V].length;K+=2)xe.push(Ui(ae[V][K],ae[V][K+1],D,Q,se,te));ee.geometry.push(xe)}}return W.transformed=!0,W}function Ui(W,D,R,V,K,Q){return[Math.round(R*(W*V-K)),Math.round(R*(D*V-Q))]}function mn(W,D,R,V,K){for(var Q=D===K.maxZoom?0:K.tolerance/((1<<D)*K.extent),se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:V,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<W.length;te++){se.numFeatures++,it(se,W[te],Q,K);var ee=W[te].minX,ae=W[te].minY,ve=W[te].maxX,xe=W[te].maxY;ee<se.minX&&(se.minX=ee),ae<se.minY&&(se.minY=ae),ve>se.maxX&&(se.maxX=ve),xe>se.maxY&&(se.maxY=xe)}return se}function it(W,D,R,V){var K=D.geometry,Q=D.type,se=[];if(Q==="Point"||Q==="MultiPoint")for(var te=0;te<K.length;te+=3)se.push(K[te]),se.push(K[te+1]),W.numPoints++,W.numSimplified++;else if(Q==="LineString")tn(se,K,W,R,!1,!1);else if(Q==="MultiLineString"||Q==="Polygon")for(te=0;te<K.length;te++)tn(se,K[te],W,R,Q==="Polygon",te===0);else if(Q==="MultiPolygon")for(var ee=0;ee<K.length;ee++){var ae=K[ee];for(te=0;te<ae.length;te++)tn(se,ae[te],W,R,!0,te===0)}if(se.length){var ve=D.tags||null;if(Q==="LineString"&&V.lineMetrics){for(var xe in ve={},D.tags)ve[xe]=D.tags[xe];ve.mapbox_clip_start=K.start/K.size,ve.mapbox_clip_end=K.end/K.size}var be={geometry:se,type:Q==="Polygon"||Q==="MultiPolygon"?3:Q==="LineString"||Q==="MultiLineString"?2:1,tags:ve};D.id!==null&&(be.id=D.id),W.features.push(be)}}function tn(W,D,R,V,K,Q){var se=V*V;if(V>0&&D.size<(K?se:V))R.numPoints+=D.length/3;else{for(var te=[],ee=0;ee<D.length;ee+=3)(V===0||D[ee+2]>se)&&(R.numSimplified++,te.push(D[ee]),te.push(D[ee+1])),R.numPoints++;K&&function(ae,ve){for(var xe=0,be=0,Qe=ae.length,at=Qe-2;be<Qe;at=be,be+=2)xe+=(ae[be]-ae[at])*(ae[be+1]+ae[at+1]);if(xe>0===ve)for(be=0,Qe=ae.length;be<Qe/2;be+=2){var Ze=ae[be],Xe=ae[be+1];ae[be]=ae[Qe-2-be],ae[be+1]=ae[Qe-1-be],ae[Qe-2-be]=Ze,ae[Qe-1-be]=Xe}}(te,Q),W.push(te)}}function rn(W,D){var R=(D=this.options=function(K,Q){for(var se in Q)K[se]=Q[se];return K}(Object.create(this.options),D)).debug;if(R&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var V=function(K,Q){var se=[];if(K.type==="FeatureCollection")for(var te=0;te<K.features.length;te++)Lt(se,K.features[te],Q,te);else Lt(se,K.type==="Feature"?K:{geometry:K},Q);return se}(W,D);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),V=function(K,Q){var se=Q.buffer/Q.extent,te=K,ee=Qt(K,1,-1-se,se,0,-1,2,Q),ae=Qt(K,1,1-se,2+se,0,-1,2,Q);return(ee||ae)&&(te=Qt(K,1,-se,1+se,0,-1,2,Q)||[],ee&&(te=Pe(ee,1).concat(te)),ae&&(te=te.concat(Pe(ae,-1)))),te}(V,D),V.length&&this.splitTile(V,0,0,0),R&&(V.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function kn(W,D,R){return 32*((1<<W)*R+D)+W}function kr(W,D){return D?W.properties[D]:W.id}function Mn(W,D){if(W==null)return!0;if(W.type==="Feature")return kr(W,D)!=null;if(W.type==="FeatureCollection"){const R=new Set;for(const V of W.features){const K=kr(V,D);if(K==null||R.has(K))return!1;R.add(K)}return!0}return!1}function Di(W,D){const R=new Map;if(W!=null)if(W.type==="Feature")R.set(kr(W,D),W);else for(const V of W.features)R.set(kr(V,D),V);return R}function Ot(W,D){const R=W.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const V=this._geoJSONIndex.getTile(R.z,R.x,R.y);if(!V)return D(null,null);const K=new class{constructor(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=se.length,this._features=se}feature(se){return new class{constructor(te){this._feature=te,this.extent=o.EXTENT,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const ee of this._feature.geometry)te.push([new o.Point(ee[0],ee[1])]);return te}{const te=[];for(const ee of this._feature.geometry){const ae=[];for(const ve of ee)ae.push(new o.Point(ve[0],ve[1]));te.push(ae)}return te}}toGeoJSON(te,ee,ae){return Ne.call(this,te,ee,ae)}}(this._features[se])}}(V.features);let Q=en(K);Q.byteOffset===0&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),D(null,{vectorTile:K,rawData:Q.buffer})}rn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},rn.prototype.splitTile=function(W,D,R,V,K,Q,se){for(var te=[W,D,R,V],ee=this.options,ae=ee.debug;te.length;){V=te.pop(),R=te.pop(),D=te.pop(),W=te.pop();var ve=1<<D,xe=kn(D,R,V),be=this.tiles[xe];if(!be&&(ae>1&&console.time("creation"),be=this.tiles[xe]=mn(W,D,R,V,ee),this.tileCoords.push({z:D,x:R,y:V}),ae)){ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,R,V,be.numFeatures,be.numPoints,be.numSimplified),console.timeEnd("creation"));var Qe="z"+D;this.stats[Qe]=(this.stats[Qe]||0)+1,this.total++}if(be.source=W,K){if(D===ee.maxZoom||D===K)continue;var at=1<<K-D;if(R!==Math.floor(Q/at)||V!==Math.floor(se/at))continue}else if(D===ee.indexMaxZoom||be.numPoints<=ee.indexMaxPoints)continue;if(be.source=null,W.length!==0){ae>1&&console.time("clipping");var Ze,Xe,nt,Et,zt,yt,wt=.5*ee.buffer/ee.extent,ir=.5-wt,rt=.5+wt,xi=1+wt;Ze=Xe=nt=Et=null,zt=Qt(W,ve,R-wt,R+rt,0,be.minX,be.maxX,ee),yt=Qt(W,ve,R+ir,R+xi,0,be.minX,be.maxX,ee),W=null,zt&&(Ze=Qt(zt,ve,V-wt,V+rt,1,be.minY,be.maxY,ee),Xe=Qt(zt,ve,V+ir,V+xi,1,be.minY,be.maxY,ee),zt=null),yt&&(nt=Qt(yt,ve,V-wt,V+rt,1,be.minY,be.maxY,ee),Et=Qt(yt,ve,V+ir,V+xi,1,be.minY,be.maxY,ee),yt=null),ae>1&&console.timeEnd("clipping"),te.push(Ze||[],D+1,2*R,2*V),te.push(Xe||[],D+1,2*R,2*V+1),te.push(nt||[],D+1,2*R+1,2*V),te.push(Et||[],D+1,2*R+1,2*V+1)}}},rn.prototype.getTile=function(W,D,R){var V=this.options,K=V.extent,Q=V.debug;if(W<0||W>24)return null;var se=1<<W,te=kn(W,D=(D%se+se)%se,R);if(this.tiles[te])return ut(this.tiles[te],K);Q>1&&console.log("drilling down to z%d-%d-%d",W,D,R);for(var ee,ae=W,ve=D,xe=R;!ee&&ae>0;)ae--,ve=Math.floor(ve/2),xe=Math.floor(xe/2),ee=this.tiles[kn(ae,ve,xe)];return ee&&ee.source?(Q>1&&console.log("found parent tile z%d-%d-%d",ae,ve,xe),Q>1&&console.time("drilling down"),this.splitTile(ee.source,ae,ve,xe,W,D,R),Q>1&&console.timeEnd("drilling down"),this.tiles[te]?ut(this.tiles[te],K):null):null};class Os extends ge{constructor(D,R,V,K){super(D,R,V,Ot),this._dataUpdateable=new Map,this.loadGeoJSON=(Q,se)=>{const{promoteId:te}=Q;if(Q.request)return o.getJSON(Q.request,(ee,ae,ve,xe)=>{this._dataUpdateable=Mn(ae,te)?Di(ae,te):void 0,se(ee,ae,ve,xe)});if(typeof Q.data=="string")try{const ee=JSON.parse(Q.data);this._dataUpdateable=Mn(ee,te)?Di(ee,te):void 0,se(null,ee)}catch{se(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`))}else Q.dataDiff?this._dataUpdateable?(function(ee,ae,ve){var xe,be,Qe,at;if(ae.removeAll&&ee.clear(),ae.remove)for(const Ze of ae.remove)ee.delete(Ze);if(ae.add)for(const Ze of ae.add){const Xe=kr(Ze,ve);Xe!=null&&ee.set(Xe,Ze)}if(ae.update)for(const Ze of ae.update){let Xe=ee.get(Ze.id);if(Xe==null)continue;const nt=!Ze.removeAllProperties&&(((xe=Ze.removeProperties)===null||xe===void 0?void 0:xe.length)>0||((be=Ze.addOrUpdateProperties)===null||be===void 0?void 0:be.length)>0);if((Ze.newGeometry||Ze.removeAllProperties||nt)&&(Xe={...Xe},ee.set(Ze.id,Xe),nt&&(Xe.properties={...Xe.properties})),Ze.newGeometry&&(Xe.geometry=Ze.newGeometry),Ze.removeAllProperties)Xe.properties={};else if(((Qe=Ze.removeProperties)===null||Qe===void 0?void 0:Qe.length)>0)for(const Et of Ze.removeProperties)Object.prototype.hasOwnProperty.call(Xe.properties,Et)&&delete Xe.properties[Et];if(((at=Ze.addOrUpdateProperties)===null||at===void 0?void 0:at.length)>0)for(const{key:Et,value:zt}of Ze.addOrUpdateProperties)Xe.properties[Et]=zt}}(this._dataUpdateable,Q.dataDiff,te),se(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):se(new Error(`Cannot update existing geojson data in ${Q.source}`)):se(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},K&&(this.loadGeoJSON=K)}loadData(D,R){var V;(V=this._pendingRequest)===null||V===void 0||V.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const K=!!(D&&D.request&&D.request.collectResourceTiming)&&new o.RequestPerformance(D.request);this._pendingCallback=R,this._pendingRequest=this.loadGeoJSON(D,(Q,se)=>{if(delete this._pendingCallback,delete this._pendingRequest,Q||!se)return R(Q);if(typeof se!="object")return R(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{Se(se,!0);try{if(D.filter){const ee=o.createExpression(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ee.result==="error")throw new Error(ee.value.map(ve=>`${ve.key}: ${ve.message}`).join(", "));se={type:"FeatureCollection",features:se.features.filter(ve=>ee.value.evaluate({zoom:0},ve))}}this._geoJSONIndex=D.cluster?new Be(function({superclusterOptions:ee,clusterProperties:ae}){if(!ae||!ee)return ee;const ve={},xe={},be={accumulated:null,zoom:0},Qe={properties:null},at=Object.keys(ae);for(const Ze of at){const[Xe,nt]=ae[Ze],Et=o.createExpression(nt),zt=o.createExpression(typeof Xe=="string"?[Xe,["accumulated"],["get",Ze]]:Xe);ve[Ze]=Et.value,xe[Ze]=zt.value}return ee.map=Ze=>{Qe.properties=Ze;const Xe={};for(const nt of at)Xe[nt]=ve[nt].evaluate(be,Qe);return Xe},ee.reduce=(Ze,Xe)=>{Qe.properties=Xe;for(const nt of at)be.accumulated=Ze[nt],Ze[nt]=xe[nt].evaluate(be,Qe)},ee}(D)).load(se.features):function(ee,ae){return new rn(ee,ae)}(se,D.geojsonVtOptions)}catch(ee){return R(ee)}this.loaded={};const te={};if(K){const ee=K.finish();ee&&(te.resourceTiming={},te.resourceTiming[D.source]=JSON.parse(JSON.stringify(ee)))}R(null,te)}})}reloadTile(D,R){const V=this.loaded;return V&&V[D.uid]?super.reloadTile(D,R):this.loadTile(D,R)}removeSource(D,R){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),R()}getClusterExpansionZoom(D,R){try{R(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(V){R(V)}}getClusterChildren(D,R){try{R(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(V){R(V)}}getClusterLeaves(D,R){try{R(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(V){R(V)}}}class nn{constructor(D){this.self=D,this.actor=new o.Actor(D,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ge,geojson:Os},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(R,V)=>{if(this.workerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.workerSourceTypes[R]=V},this.self.registerRTLTextPlugin=R=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=R.applyArabicShaping,o.plugin.processBidirectionalText=R.processBidirectionalText,o.plugin.processStyledBidirectionalText=R.processStyledBidirectionalText}}setReferrer(D,R){this.referrer=R}setImages(D,R,V){this.availableImages[D]=R;for(const K in this.workerSources[D]){const Q=this.workerSources[D][K];for(const se in Q)Q[se].availableImages=R}V()}setLayers(D,R,V){this.getLayerIndex(D).replace(R),V()}updateLayers(D,R,V){this.getLayerIndex(D).update(R.layers,R.removedIds),V()}loadTile(D,R,V){this.getWorkerSource(D,R.type,R.source).loadTile(R,V)}loadDEMTile(D,R,V){this.getDEMWorkerSource(D,R.source).loadTile(R,V)}reloadTile(D,R,V){this.getWorkerSource(D,R.type,R.source).reloadTile(R,V)}abortTile(D,R,V){this.getWorkerSource(D,R.type,R.source).abortTile(R,V)}removeTile(D,R,V){this.getWorkerSource(D,R.type,R.source).removeTile(R,V)}removeDEMTile(D,R){this.getDEMWorkerSource(D,R.source).removeTile(R)}removeSource(D,R,V){if(!this.workerSources[D]||!this.workerSources[D][R.type]||!this.workerSources[D][R.type][R.source])return;const K=this.workerSources[D][R.type][R.source];delete this.workerSources[D][R.type][R.source],K.removeSource!==void 0?K.removeSource(R,V):V()}loadWorkerSource(D,R,V){try{this.self.importScripts(R.url),V()}catch(K){V(K.toString())}}syncRTLPluginState(D,R,V){try{o.plugin.setState(R);const K=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&K!=null){this.self.importScripts(K);const Q=o.plugin.isParsed();V(Q?void 0:new Error(`RTL Text Plugin failed to import scripts from ${K}`),Q)}}catch(K){V(K.toString())}}getAvailableImages(D){let R=this.availableImages[D];return R||(R=[]),R}getLayerIndex(D){let R=this.layerIndexes[D];return R||(R=this.layerIndexes[D]=new z),R}getWorkerSource(D,R,V){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][R]||(this.workerSources[D][R]={}),!this.workerSources[D][R][V]){const K={send:(Q,se,te)=>{this.actor.send(Q,se,te,D)}};this.workerSources[D][R][V]=new this.workerSourceTypes[R](K,this.getLayerIndex(D),this.getAvailableImages(D))}return this.workerSources[D][R][V]}getDEMWorkerSource(D,R){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][R]||(this.demWorkerSources[D][R]=new he),this.demWorkerSources[D][R]}}return o.isWorker()&&(self.worker=new nn(self)),nn}),T(["./shared"],function(o){var z="3.3.1";class A{static testProp(t){if(!A.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in A.docStyle)return t[n];return t[0]}static create(t,n,l){const h=window.document.createElement(t);return n!==void 0&&(h.className=n),l&&l.appendChild(h),h}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){A.docStyle&&A.selectProp&&(A.userSelect=A.docStyle[A.selectProp],A.docStyle[A.selectProp]="none")}static enableDrag(){A.docStyle&&A.selectProp&&(A.docStyle[A.selectProp]=A.userSelect)}static setTransform(t,n){t.style[A.transformProp]=n}static addEventListener(t,n,l,h={}){t.addEventListener(n,l,"passive"in h?h:h.capture)}static removeEventListener(t,n,l,h={}){t.removeEventListener(n,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",A.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",A.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",A.suppressClickInternal,!0)},0)}static mousePos(t,n){const l=t.getBoundingClientRect();return new o.Point(n.clientX-l.left-t.clientLeft,n.clientY-l.top-t.clientTop)}static touchPos(t,n){const l=t.getBoundingClientRect(),h=[];for(let m=0;m<n.length;m++)h.push(new o.Point(n[m].clientX-l.left-t.clientLeft,n[m].clientY-l.top-t.clientTop));return h}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}A.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,A.selectProp=A.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),A.transformProp=A.testProp(["transform","WebkitTransform"]);const G={supported:!1,testSupport:function(d){!ge&&fe&&(he?Ce(d):j=d)}};let j,fe,ge=!1,he=!1;function Ce(d){const t=d.createTexture();d.bindTexture(d.TEXTURE_2D,t);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,fe),d.isContextLost())return;G.supported=!0}catch{}d.deleteTexture(t),ge=!0}var De,Se;typeof document<"u"&&(fe=document.createElement("img"),fe.onload=function(){j&&Ce(j),j=null,he=!0},fe.onerror=function(){ge=!0,j=null},fe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let t,n,l,h;d.resetRequestQueue=()=>{t=[],n=0,l=0,h={}},d.addThrottleControl=C=>{const I=l++;return h[I]=C,I},d.removeThrottleControl=C=>{delete h[C],x()},d.getImage=(C,I,P=!0)=>{G.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*");const F={requestParameters:C,supportImageRefresh:P,callback:I,cancelled:!1,completed:!1,cancel:()=>{F.completed||F.cancelled||(F.cancelled=!0,F.innerRequest&&(F.innerRequest.cancel(),n--),x())}};return t.push(F),x(),F};const m=C=>{const{requestParameters:I,supportImageRefresh:P,callback:F}=C;return o.extend(I,{type:"image"}),(P!==!1||o.isWorker()||o.getProtocolAction(I.url)||I.headers&&!Object.keys(I.headers).reduce((Z,q)=>Z&&q==="accept",!0)?o.makeRequest:E)(I,(Z,q,H,N)=>{v(C,F,Z,q,H,N)})},v=(C,I,P,F,Z,q)=>{P?I(P):F instanceof HTMLImageElement||o.isImageBitmap(F)?I(null,F):F&&((H,N)=>{typeof createImageBitmap=="function"?o.arrayBufferToImageBitmap(H,N):o.arrayBufferToImage(H,N)})(F,(H,N)=>{H!=null?I(H):N!=null&&I(null,N,{cacheControl:Z,expires:q})}),C.cancelled||(C.completed=!0,n--,x())},x=()=>{const C=(()=>{const I=Object.keys(h);let P=!1;if(I.length>0){for(const F of I)if(P=h[F](),P)break}return P})()?o.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=n;I<C&&t.length>0;I++){const P=t.shift();if(P.cancelled){I--;continue}const F=m(P);n++,P.innerRequest=F}},E=(C,I)=>{const P=new Image,F=C.url;let Z=!1;const q=C.credentials;return q&&q==="include"?P.crossOrigin="use-credentials":(q&&q==="same-origin"||!o.sameOrigin(F))&&(P.crossOrigin="anonymous"),P.fetchPriority="high",P.onload=()=>{I(null,P),P.onerror=P.onload=null},P.onerror=()=>{Z||I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),P.onerror=P.onload=null},P.src=F,{cancel:()=>{Z=!0,P.src=""}}}}(De||(De={})),De.resetRequestQueue(),function(d){d.Glyphs="Glyphs",d.Image="Image",d.Source="Source",d.SpriteImage="SpriteImage",d.SpriteJSON="SpriteJSON",d.Style="Style",d.Tile="Tile",d.Unknown="Unknown"}(Se||(Se={}));class Ne{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,l){const h=function(m){const v=m.match(Ue);if(!v)throw new Error(`Unable to parse URL "${m}"`);return{protocol:v[1],authority:v[2],path:v[3]||"/",params:v[4]?v[4].split("&"):[]}}(t);return h.path+=`${n}${l}`,function(m){const v=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${v}`}(h)}setTransformRequest(t){this._transformRequestFn=t}}const Ue=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function lt(d){var t=new o.ARRAY_TYPE(3);return t[0]=d[0],t[1]=d[1],t[2]=d[2],t}var pt,ht=function(d,t,n){return d[0]=t[0]-n[0],d[1]=t[1]-n[1],d[2]=t[2]-n[2],d};pt=new o.ARRAY_TYPE(3),o.ARRAY_TYPE!=Float32Array&&(pt[0]=0,pt[1]=0,pt[2]=0);var st=function(d){var t=d[0],n=d[1];return t*t+n*n};function xt(d){const t=[];if(typeof d=="string")t.push({id:"default",url:d});else if(d&&d.length>0){const n=[];for(const{id:l,url:h}of d){const m=`${l}${h}`;n.indexOf(m)===-1&&(n.push(m),t.push({id:l,url:h}))}}return t}function _t(d,t,n,l,h){if(l)return void d(l);if(h!==Object.values(t).length||h!==Object.values(n).length)return;const m={};for(const v in t){m[v]={};const x=o.browser.getImageCanvasContext(n[v]),E=t[v];for(const C in E){const{width:I,height:P,x:F,y:Z,sdf:q,pixelRatio:H,stretchX:N,stretchY:re,content:ce}=E[C];m[v][C]={data:null,pixelRatio:H,sdf:q,stretchX:N,stretchY:re,content:ce,spriteData:{width:I,height:P,x:F,y:Z,context:x}}}}d(null,m)}(function(){var d=new o.ARRAY_TYPE(2);o.ARRAY_TYPE!=Float32Array&&(d[0]=0,d[1]=0)})();class tt{constructor(t,n,l,h){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(n,h)}update(t,n,l){const{width:h,height:m}=t,v=!(this.size&&this.size[0]===h&&this.size[1]===m||l),{context:x}=this,{gl:E}=x;if(this.useMipmap=!!(n&&n.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!n||n.premultiply!==!1)),v)this.size=[h,m],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.isImageBitmap(t)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,t):E.texImage2D(E.TEXTURE_2D,0,this.format,h,m,0,this.format,E.UNSIGNED_BYTE,t.data);else{const{x:C,y:I}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.isImageBitmap(t)?E.texSubImage2D(E.TEXTURE_2D,0,C,I,E.RGBA,E.UNSIGNED_BYTE,t):E.texSubImage2D(E.TEXTURE_2D,0,C,I,h,m,E.RGBA,E.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(t,n,l){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),l!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=m.LINEAR),t!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l||t),this.filter=t),n!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,n),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function gi(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class Zt extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:l}of this.requestors)this._notify(n,l);this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const l=n.spriteData;n.data=new o.RGBAImage({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let l=!0;const h=n.data||n.spriteData;return this._validateStretch(n.stretchX,h&&h.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(n.stretchY,h&&h.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(n.content,n)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,n){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||n<h[1])return!1;l=h[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const l=n.spriteData,h=l&&l.width||n.data.width,m=l&&l.height||n.data.height;return!(t[0]<0||h<t[0]||t[1]<0||m<t[1]||t[2]<0||h<t[2]||t[3]<0||m<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==n.data.width||h.data.height!==n.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=h.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let l=!0;if(!this.isLoaded())for(const h of t)this.images[h]||(l=!1);this.isLoaded()||l?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const l={};for(const h of t){let m=this.getImage(h);m||(this.fire(new o.Event("styleimagemissing",{id:h})),m=this.getImage(h)),m?l[h]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:o.warnOnce(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,l)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],l=this.getImage(t);if(!l)return null;if(n&&n.position.version===l.version)return n.position;if(n)n.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},m=new o.ImagePosition(h,l);this.patterns[t]={bin:h,position:m}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new tt(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const m in this.patterns)t.push(this.patterns[m].bin);const{w:n,h:l}=o.potpack(t),h=this.atlasImage;h.resize({width:n||1,height:l||1});for(const m in this.patterns){const{bin:v}=this.patterns[m],x=v.x+1,E=v.y+1,C=this.getImage(m).data,I=C.width,P=C.height;o.RGBAImage.copy(C,h,{x:0,y:0},{x,y:E},{width:I,height:P}),o.RGBAImage.copy(C,h,{x:0,y:P-1},{x,y:E-1},{width:I,height:1}),o.RGBAImage.copy(C,h,{x:0,y:0},{x,y:E+P},{width:I,height:1}),o.RGBAImage.copy(C,h,{x:I-1,y:0},{x:x-1,y:E},{width:1,height:P}),o.RGBAImage.copy(C,h,{x:0,y:0},{x:x+I,y:E},{width:1,height:P})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const l=this.getImage(n);l||o.warnOnce(`Image with ID: "${n}" was not found`),gi(l)&&this.updateImage(n,l)}}}const _i=1e20;function fr(d,t,n,l,h,m,v,x,E){for(let C=t;C<t+l;C++)$t(d,n*m+C,m,h,v,x,E);for(let C=n;C<n+h;C++)$t(d,C*m+t,1,l,v,x,E)}function $t(d,t,n,l,h,m,v){m[0]=0,v[0]=-_i,v[1]=_i,h[0]=d[t];for(let x=1,E=0,C=0;x<l;x++){h[x]=d[t+x*n];const I=x*x;do{const P=m[E];C=(h[x]-h[P]+I-P*P)/(x-P)/2}while(C<=v[E]&&--E>-1);E++,m[E]=x,v[E]=C,v[E+1]=_i}for(let x=0,E=0;x<l;x++){for(;v[E+1]<x;)E++;const C=m[E],I=x-C;d[t+x*n]=h[C]+I*I}}class yi{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const l=[];for(const h in t)for(const m of t[h])l.push({stack:h,id:m});o.asyncAll(l,({stack:h,id:m},v)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{}});let E=x.glyphs[m];if(E!==void 0)return void v(null,{stack:h,id:m,glyph:E});if(E=this._tinySDF(x,h,m),E)return x.glyphs[m]=E,void v(null,{stack:h,id:m,glyph:E});const C=Math.floor(m/256);if(256*C>65535)return void v(new Error("glyphs > 65535 not supported"));if(x.ranges[C])return void v(null,{stack:h,id:m,glyph:E});if(!this.url)return void v(new Error("glyphsUrl is not set"));let I=x.requests[C];I||(I=x.requests[C]=[],yi.loadGlyphRange(h,C,this.url,this.requestManager,(P,F)=>{if(F){for(const Z in F)this._doesCharSupportLocalGlyph(+Z)||(x.glyphs[+Z]=F[+Z]);x.ranges[C]=!0}for(const Z of I)Z(P,F);delete x.requests[C]})),I.push((P,F)=>{P?v(P):F&&v(null,{stack:h,id:m,glyph:F[m]||null})})},(h,m)=>{if(h)n(h);else if(m){const v={};for(const{stack:x,id:E,glyph:C}of m)(v[x]||(v[x]={}))[E]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};n(null,v)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](t)||o.unicodeBlockLookup["Hangul Syllables"](t)||o.unicodeBlockLookup.Hiragana(t)||o.unicodeBlockLookup.Katakana(t))}_tinySDF(t,n,l){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let m=t.tinySDF;if(!m){let x="400";/bold/i.test(n)?x="900":/medium/i.test(n)?x="500":/light/i.test(n)&&(x="200"),m=t.tinySDF=new yi.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:h,fontWeight:x})}const v=m.draw(String.fromCharCode(l));return{id:l,bitmap:new o.AlphaImage({width:v.width||30,height:v.height||30},v.data),metrics:{width:v.glyphWidth||24,height:v.glyphHeight||24,left:v.glyphLeft||0,top:v.glyphTop-27||-8,advance:v.glyphAdvance||24}}}}yi.loadGlyphRange=function(d,t,n,l,h){const m=256*t,v=m+255,x=l.transformRequest(n.replace("{fontstack}",d).replace("{range}",`${m}-${v}`),Se.Glyphs);o.getArrayBuffer(x,(E,C)=>{if(E)h(E);else if(C){const I={};for(const P of o.parseGlyphPbf(C))I[P.id]=P;h(null,I)}})},yi.TinySDF=class{constructor({fontSize:d=24,buffer:t=3,radius:n=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:v="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=n;const x=this.size=d+4*t,E=this._createCanvas(x),C=this.ctx=E.getContext("2d",{willReadFrequently:!0});C.font=`${v} ${m} ${d}px ${h}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(d){const t=document.createElement("canvas");return t.width=t.height=d,t}draw(d){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(d),v=Math.ceil(n),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),E=Math.min(this.size-this.buffer,v+Math.ceil(l)),C=x+2*this.buffer,I=E+2*this.buffer,P=Math.max(C*I,0),F=new Uint8ClampedArray(P),Z={data:F,width:C,height:I,glyphWidth:x,glyphHeight:E,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(x===0||E===0)return Z;const{ctx:q,buffer:H,gridInner:N,gridOuter:re}=this;q.clearRect(H,H,x,E),q.fillText(d,H,H+v);const ce=q.getImageData(H,H,x,E);re.fill(_i,0,P),N.fill(0,0,P);for(let Y=0;Y<E;Y++)for(let ne=0;ne<x;ne++){const de=ce.data[4*(Y*x+ne)+3]/255;if(de===0)continue;const pe=(Y+H)*C+ne+H;if(de===1)re[pe]=0,N[pe]=_i;else{const _e=.5-de;re[pe]=_e>0?_e*_e:0,N[pe]=_e<0?_e*_e:0}}fr(re,0,0,C,I,C,this.f,this.v,this.z),fr(N,H,H,x,E,C,this.f,this.v,this.z);for(let Y=0;Y<P;Y++){const ne=Math.sqrt(re[Y])-Math.sqrt(N[Y]);F[Y]=Math.round(255-255*(ne/this.radius+this.cutoff))}return Z}};class er{constructor(){this.specification=o.v8Spec.light.position}possiblyEvaluate(t,n){return o.sphericalToCartesian(t.expression.evaluate(n))}interpolate(t,n,l){return{x:o.interpolate.number(t.x,n.x,l),y:o.interpolate.number(t.y,n.y,l),z:o.interpolate.number(t.z,n.z,l)}}}let Jt,en;class Ur extends o.Evented{constructor(t){super(),Jt=Jt||new o.Properties({anchor:new o.DataConstantProperty(o.v8Spec.light.anchor),position:new er,color:new o.DataConstantProperty(o.v8Spec.light.color),intensity:new o.DataConstantProperty(o.v8Spec.light.intensity)}),this._transitionable=new o.Transitionable(Jt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(o.validateLight,t,n))for(const l in t){const h=t[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,l){return(!l||l.validate!==!1)&&o.emitValidationErrors(this,t.call(o.validateStyle,o.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.v8Spec})))}}class Fi{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const l=t.join(",")+String(n);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,n)),this.dashEntry[l]}getDashRanges(t,n,l){const h=[];let m=t.length%2==1?-t[t.length-1]*l:0,v=t[0]*l,x=!0;h.push({left:m,right:v,isDash:x,zeroLength:t[0]===0});let E=t[0];for(let C=1;C<t.length;C++){x=!x;const I=t[C];m=E*l,E+=I,v=E*l,h.push({left:m,right:v,isDash:x,zeroLength:I===0})}return h}addRoundDash(t,n,l){const h=n/2;for(let m=-l;m<=l;m++){const v=this.width*(this.nextRow+l+m);let x=0,E=t[x];for(let C=0;C<this.width;C++){C/E.right>1&&(E=t[++x]);const I=Math.abs(C-E.left),P=Math.abs(C-E.right),F=Math.min(I,P);let Z;const q=m/l*(h+1);if(E.isDash){const H=h-Math.abs(q);Z=Math.sqrt(F*F+H*H)}else Z=h-Math.sqrt(F*F+q*q);this.data[v+C]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(t){for(let x=t.length-1;x>=0;--x){const E=t[x],C=t[x+1];E.zeroLength?t.splice(x,1):C&&C.isDash===E.isDash&&(C.left=E.left,t.splice(x,1))}const n=t[0],l=t[t.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const h=this.width*this.nextRow;let m=0,v=t[m];for(let x=0;x<this.width;x++){x/v.right>1&&(v=t[++m]);const E=Math.abs(x-v.left),C=Math.abs(x-v.right),I=Math.min(E,C);this.data[h+x]=Math.max(0,Math.min(255,(v.isDash?I:-I)+128))}}addDash(t,n){const l=n?7:0,h=2*l+1;if(this.nextRow+h>this.height)return o.warnOnce("LineAtlas out of space"),null;let m=0;for(let x=0;x<t.length;x++)m+=t[x];if(m!==0){const x=this.width/m,E=this.getDashRanges(t,this.width,x);n?this.addRoundDash(E,x,l):this.addRegularDash(E)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:m};return this.nextRow+=h,this.dirty=!0,v}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class oi{constructor(t,n,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=l;const h=this.workerPool.acquire(l);for(let m=0;m<h.length;m++){const v=new oi.Actor(h[m],n,l);v.name=`Worker ${m}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n,l){o.asyncAll(this.actors,(h,m)=>{h.send(t,n,m)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function vi(d,t,n){const l=function(h,m){if(h)return n(h);if(m){const v=o.pick(o.extend(m,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);m.vector_layers&&(v.vectorLayers=m.vector_layers,v.vectorLayerIds=v.vectorLayers.map(x=>x.id)),n(null,v)}};return d.url?o.getJSON(t.transformRequest(d.url,Se.Source),l):o.browser.frame(()=>l(null,d))}oi.Actor=o.Actor;class kt{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof o.LngLat?new o.LngLat(t.lng,t.lat):o.LngLat.convert(t),this}setSouthWest(t){return this._sw=t instanceof o.LngLat?new o.LngLat(t.lng,t.lat):o.LngLat.convert(t),this}extend(t){const n=this._sw,l=this._ne;let h,m;if(t instanceof o.LngLat)h=t,m=t;else{if(!(t instanceof kt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(kt.convert(t)):this.extend(o.LngLat.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(o.LngLat.convert(t)):this;if(h=t._sw,m=t._ne,!h||!m)return this}return n||l?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new o.LngLat(h.lng,h.lat),this._ne=new o.LngLat(m.lng,m.lat)),this}getCenter(){return new o.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new o.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:l}=o.LngLat.convert(t);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(t){return t instanceof kt?t:t&&new kt(t)}static fromLngLat(t,n=0){const l=360*n/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new kt(new o.LngLat(t.lng-h,t.lat-l),new o.LngLat(t.lng+h,t.lat+l))}}class Xi{constructor(t,n,l){this.bounds=kt.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),l=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*n),h=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*n),m=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*n),v=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*n);return t.x>=l&&t.x<m&&t.y>=h&&t.y<v}}class Be extends o.Evented{constructor(t,n,l,h){if(super(),this.load=()=>{this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vi(this._options,this.map._requestManager,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),m?this.fire(new o.ErrorEvent(m)):v&&(o.extend(this,v),v.bounds&&(this.tileBounds=new Xi(v.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>o.extend({},this._options),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(n,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,n){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(l,Se.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function m(v,x){return delete t.request,t.aborted?n(null):v&&v.status!==404?n(v):(x&&x.resourceTiming&&(t.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&x&&t.setExpiryData(x),t.loadVectorData(x,this.map.painter),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}h.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",h,m.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",h,m.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class ot extends o.Evented{constructor(t,n,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},n),o.extend(this,o.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vi(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new o.ErrorEvent(t)):n&&(o.extend(this,n),n.bounds&&(this.tileBounds=new Xi(n.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=De.getImage(this.map._requestManager.transformRequest(l,Se.Tile),(h,m,v)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(h)t.state="errored",n(h);else if(m){this.map._refreshExpiredTiles&&v&&t.setExpiryData(v);const x=this.map.painter.context,E=x.gl;t.texture=this.map.painter.getTileTexture(m.width),t.texture?t.texture.update(m,{useMipmap:!0}):(t.texture=new tt(x,m,E.RGBA,{useMipmap:!0}),t.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),x.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,x.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,x.extTextureFilterAnisotropicMax)),t.state="loaded",n(null)}},this.map._refreshExpiredTiles)}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}class Rt extends ot{constructor(t,n,l,h){super(t,n,l,h),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(t,n){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function h(m,v){m&&(t.state="errored",n(m)),v&&(t.dem=v,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",n(null))}t.request=De.getImage(this.map._requestManager.transformRequest(l,Se.Tile),function(m,v){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(m)t.state="errored",n(m);else if(v){this.map._refreshExpiredTiles&&t.setExpiryData(v),delete v.cacheControl,delete v.expires;const x=o.isImageBitmap(v)&&(en==null&&(en=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),en)?v:o.browser.getImageData(v,1),E={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:x,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",E,h.bind(this)))}}.bind(this),this.map._refreshExpiredTiles),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const n=t.canonical,l=Math.pow(2,n.z),h=(n.x-1+l)%l,m=n.x===0?t.wrap-1:t.wrap,v=(n.x+1+l)%l,x=n.x+1===l?t.wrap+1:t.wrap,E={};return E[new o.OverscaledTileID(t.overscaledZ,m,n.z,h,n.y).key]={backfilled:!1},E[new o.OverscaledTileID(t.overscaledZ,x,n.z,v,n.y).key]={backfilled:!1},n.y>0&&(E[new o.OverscaledTileID(t.overscaledZ,m,n.z,h,n.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(t.overscaledZ,x,n.z,v,n.y-1).key]={backfilled:!1}),n.y+1<l&&(E[new o.OverscaledTileID(t.overscaledZ,m,n.z,h,n.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(t.overscaledZ,x,n.z,v,n.y+1).key]={backfilled:!1}),E}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Oi extends o.Evented{constructor(t,n,l,h){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>o.extend({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(h),this._data=n.data,this._options=o.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const m=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*m,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*m,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.EXTENT,radius:(n.clusterRadius||50)*m,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,l,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:l},h),this}_updateWorkerData(t){const n=o.extend({},this.workerOptions);t?n.dataDiff=t:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(o.browser.resolveURL(this._data),Se.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(l,h)=>{if(this._pendingLoads--,this._removed||h&&h.abandoned)return void this.fire(new o.Event("dataabort",{dataType:"source"}));let m=null;if(h&&h.resourceTiming&&h.resourceTiming[this.id]&&(m=h.resourceTiming[this.id].slice(0)),l)return void this.fire(new o.ErrorEvent(l));const v={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&o.extend(v,{resourceTiming:m}),this.fire(new o.Event("data",{...v,sourceDataType:"metadata"})),this.fire(new o.Event("data",{...v,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const l=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const h={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(l,h,(m,v)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):m?n(m):(t.loadVectorData(v,this.map.painter,l==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Ki=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class mr extends o.Evented{constructor(t,n,l,h){super(),this.load=(m,v)=>{this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=De.getImage(this.map._requestManager.transformRequest(this.url,Se.Image),(x,E)=>{this._request=null,this._loaded=!0,x?this.fire(new o.ErrorEvent(x)):E&&(this.image=E,m&&(this.coordinates=m),v&&v(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const m=this.map.painter.context,v=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,Ki.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new tt(m,this.image,v.RGBA),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE));let x=!1;for(const E in this.tiles){const C=this.tiles[E];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,x=!0)}x&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=n}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(h){let m=1/0,v=1/0,x=-1/0,E=-1/0;for(const F of h)m=Math.min(m,F.x),v=Math.min(v,F.y),x=Math.max(x,F.x),E=Math.max(E,F.y);const C=Math.max(x-m,E-v),I=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),P=Math.pow(2,I);return new o.CanonicalTileID(I,Math.floor((m+x)/2*P),Math.floor((v+E)/2*P))}(n),this.minzoom=this.maxzoom=this.tileID.z;const l=n.map(h=>this.tileID.getTilePoint(h)._round());return this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(l[2].x,l[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}hasTransition(){return!1}}class Vr extends mr{constructor(t,n,l,h){super(t,n,l,h),this.load=()=>{this._loaded=!1;const m=this.options;this.urls=[];for(const v of m.urls)this.urls.push(this.map._requestManager.transformRequest(v,Se.Source).url);o.getVideo(this.urls,(v,x)=>{this._loaded=!0,v?this.fire(new o.ErrorEvent(v)):x&&(this.video=x,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,v=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,Ki.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.texSubImage2D(v.TEXTURE_2D,0,0,0,v.RGBA,v.UNSIGNED_BYTE,this.video)):(this.texture=new tt(m,this.video,v.RGBA),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE));let x=!1;for(const E in this.tiles){const C=this.tiles[E];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,x=!0)}x&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=n}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class me extends mr{constructor(t,n,l,h){super(t,n,l,h),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const v=this.map.painter.context,x=v.gl;this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,Ki.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new tt(v,this.canvas,x.RGBA,{premultiply:!0});let E=!1;for(const C in this.tiles){const I=this.tiles[C];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,E=!0)}E&&this.fire(new o.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(v=>typeof v!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const pn={},ms=d=>{switch(d){case"geojson":return Oi;case"image":return mr;case"raster":return ot;case"raster-dem":return Rt;case"vector":return Be;case"video":return Vr;case"canvas":return me}return pn[d]};function Lt(d,t){const n=o.create();return o.translate(n,n,[1,1,0]),o.scale(n,n,[.5*d.width,.5*d.height,1]),o.multiply(n,n,d.calculatePosMatrix(t.toUnwrapped()))}function Ct(d,t,n,l,h,m){const v=function(P,F,Z){if(P)for(const q of P){const H=F[q];if(H&&H.source===Z&&H.type==="fill-extrusion")return!0}else for(const q in F){const H=F[q];if(H.source===Z&&H.type==="fill-extrusion")return!0}return!1}(h&&h.layers,t,d.id),x=m.maxPitchScaleFactor(),E=d.tilesIn(l,x,v);E.sort(Zn);const C=[];for(const P of E)C.push({wrappedTileID:P.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(t,n,d._state,P.queryGeometry,P.cameraQueryGeometry,P.scale,h,m,x,Lt(d.transform,P.tileID))});const I=function(P){const F={},Z={};for(const q of P){const H=q.queryResults,N=q.wrappedTileID,re=Z[N]=Z[N]||{};for(const ce in H){const Y=H[ce],ne=re[ce]=re[ce]||{},de=F[ce]=F[ce]||[];for(const pe of Y)ne[pe.featureIndex]||(ne[pe.featureIndex]=!0,de.push(pe))}}return F}(C);for(const P in I)I[P].forEach(F=>{const Z=F.feature,q=d.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=q});return I}function Zn(d,t){const n=d.tileID,l=t.tileID;return n.overscaledZ-l.overscaledZ||n.canonical.y-l.canonical.y||n.wrap-l.wrap||n.canonical.x-l.canonical.x}class $n{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=o.uniqueId(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,m){const v={};if(!m)return v;for(const x of h){const E=x.layerIds.map(C=>m.getLayer(C)).filter(Boolean);if(E.length!==0){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(C=>E.filter(I=>I.id===C)[0]));for(const C of E)v[C.id]=x}}return v}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof o.SymbolBucket&&m.hasRTLText){this.hasRTLText=!0,o.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(m))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new tt(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new tt(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,l,h,m,v,x,E,C,I){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:m,scale:v,tileSize:this.tileSize,pixelPosMatrix:I,transform:E,params:x,queryPadding:this.queryPadding*C},t,n,l):{}}querySourceFeatures(t,n){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),m=n&&n.sourceLayer?n.sourceLayer:"",v=h._geojsonTileLayer||h[m];if(!v)return;const x=o.createFilter(n&&n.filter),{z:E,x:C,y:I}=this.tileID.canonical,P={z:E,x:C,y:I};for(let F=0;F<v.length;F++){const Z=v.feature(F);if(x.needGeometry){const N=o.toEvaluationFeature(Z,!0);if(!x.filter(new o.EvaluationParameters(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!x.filter(new o.EvaluationParameters(this.tileID.overscaledZ),Z))continue;const q=l.getId(Z,m),H=new o.GeoJSONFeature(Z,E,C,I,q);H.tile=P,t.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const l=o.parseCacheControl(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const m=this.expirationTime-n;m?this.expirationTime=l+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!n.style.hasLayer(h))continue;const m=this.buckets[h],v=m.layers[0].sourceLayer||"_geojsonTileLayer",x=l[v],E=t[v];if(!x||!E||Object.keys(E).length===0)continue;m.update(E,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=n&&n.style&&n.style.getLayer(h);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.browser.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.browser.now()+t}setDependencies(t,n){const l={};for(const h of n)l[h]=!0;this.dependencies[t]=l}hasDependency(t,n){for(const l of t){const h=this.dependencies[l];if(h){for(const m of n)if(h[m])return!0}}return!1}}class xo{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,l){const h=t.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const m={value:n,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(t,m)},l)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const l=t.wrapped().key,h=n===void 0?0:this.data[l].indexOf(n),m=this.data[l][h];return this.data[l].splice(h,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const l in this.data)for(const h of this.data[l])t(h.value)||n.push(h);for(const l of n)this.remove(l.value.tileID,l)}}class bo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,l){const h=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},o.extend(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const m in this.state[t])m!==h&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const m in this.state[t][h])l[m]||(this.deletedStates[t][h][m]=null)}else for(const m in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][m]===null&&delete this.deletedStates[t][h][m]}removeFeatureState(t,n,l){if(this.deletedStates[t]===null)return;const h=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&n!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,n){const l=String(n),h=o.extend({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const m=this.deletedStates[t][n];if(m===null)return{};for(const v in m)delete h[v]}return h}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const v in this.stateChanges[h])this.state[h][v]||(this.state[h][v]={}),o.extend(this.state[h][v],this.stateChanges[h][v]),m[v]=this.state[h][v];l[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(this.deletedStates[h]===null)for(const v in this.state[h])m[v]={},this.state[h][v]={};else for(const v in this.deletedStates[h]){if(this.deletedStates[h][v]===null)this.state[h][v]={};else for(const x of Object.keys(this.deletedStates[h][v]))delete this.state[h][v][x];m[v]=this.state[h][v]}l[h]=l[h]||{},o.extend(l[h],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in t)t[h].setFeatureState(l,n)}}class Qt extends o.Evented{constructor(t,n,l){super(),this.id=t,this.dispatcher=l,this.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,m,v,x)=>{const E=new(ms(m.type))(h,m,v,x);if(E.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${E.id}`);return E})(t,n,l,this),this._tiles={},this._cache=new xo(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new bo,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new o.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const l=this._tiles[n];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Fs).map(t=>t.key)}getRenderableIds(t){const n=[];for(const l in this._tiles)this._isIdRenderable(l,t)&&n.push(this._tiles[l]);return t?n.sort((l,h)=>{const m=l.tileID,v=h.tileID,x=new o.Point(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new o.Point(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-v.overscaledZ||E.y-x.y||E.x-x.x}).map(l=>l.tileID.key):n.map(l=>l.tileID).sort(Fs).map(l=>l.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=n),this._loadTile(l,this._tileLoaded.bind(this,l,t,n)))}_tileLoaded(t,n,l,h){if(h)return t.state="errored",void(h.status!==404?this._source.fire(new o.ErrorEvent(h,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=o.browser.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let h=0;h<n.length;h++){const m=n[h];if(t.neighboringTiles&&t.neighboringTiles[m]){const v=this.getTileByID(m);l(t,v),l(v,t)}}function l(h,m){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let v=m.tileID.canonical.x-h.tileID.canonical.x;const x=m.tileID.canonical.y-h.tileID.canonical.y,E=Math.pow(2,h.tileID.canonical.z),C=m.tileID.key;v===0&&x===0||Math.abs(x)>1||(Math.abs(v)>1&&(Math.abs(v+E)===1?v+=E:Math.abs(v-E)===1&&(v-=E)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,v,x),h.neighboringTiles&&h.neighboringTiles[C]&&(h.neighboringTiles[C].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,l,h){for(const m in this._tiles){let v=this._tiles[m];if(h[m]||!v.hasData()||v.tileID.overscaledZ<=n||v.tileID.overscaledZ>l)continue;let x=v.tileID;for(;v&&v.tileID.overscaledZ>n+1;){const C=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[C.key],v&&v.hasData()&&(x=C)}let E=x;for(;E.overscaledZ>n;)if(E=E.scaledTo(E.overscaledZ-1),t[E.key]){h[x.key]=x;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=n?l:null}for(let l=t.overscaledZ-1;l>=n;l--){const h=t.scaledTo(l),m=this._getLoadedTile(h);if(m)return m}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(n*l*(this._maxTileCacheZoomLevels===null?o.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(m)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const l={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),l[m.tileID.key]=m}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let l;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new o.OverscaledTileID(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y)):(l=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(l=l.filter(I=>this._source.hasTile(I)))):l=[];const h=t.coveringZoomLevel(this._source),m=Math.max(h-Qt.maxOverzooming,this._source.minzoom),v=Math.max(h+Qt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const I={};for(const P of l)if(P.canonical.z>this._source.minzoom){const F=P.scaledTo(P.canonical.z-1);I[F.key]=F;const Z=P.scaledTo(Math.max(this._source.minzoom,Math.min(P.canonical.z,5)));I[Z.key]=Z}l=l.concat(Object.values(I))}const x=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,x&&this.fire(new o.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(l,h);if(gs(this._source.type)){const I={},P={},F=Object.keys(E),Z=o.browser.now();for(const q of F){const H=E[q],N=this._tiles[q];if(!N||N.fadeEndTime!==0&&N.fadeEndTime<=Z)continue;const re=this.findLoadedParent(H,m);re&&(this._addTile(re.tileID),I[re.tileID.key]=re.tileID),P[q]=H}this._retainLoadedChildren(P,h,v,E);for(const q in I)E[q]||(this._coveredTiles[q]=!0,E[q]=I[q]);if(n){const q={},H={};for(const N of l)this._tiles[N.key].hasData()?q[N.key]=N:H[N.key]=N;for(const N in H){const re=H[N].children(this._source.maxzoom);this._tiles[re[0].key]&&this._tiles[re[1].key]&&this._tiles[re[2].key]&&this._tiles[re[3].key]&&(q[re[0].key]=E[re[0].key]=re[0],q[re[1].key]=E[re[1].key]=re[1],q[re[2].key]=E[re[2].key]=re[2],q[re[3].key]=E[re[3].key]=re[3],delete H[N])}for(const N in H){const re=this.findLoadedParent(H[N],this._source.minzoom);if(re){q[re.tileID.key]=E[re.tileID.key]=re.tileID;for(const ce in q)q[ce].isChildOf(re.tileID)&&delete q[ce]}}for(const N in this._tiles)q[N]||(this._coveredTiles[N]=!0)}}for(const I in E)this._tiles[I].clearFadeHold();const C=o.keysDifference(this._tiles,E);for(const I of C){const P=this._tiles[I];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(I)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const l={},h={},m=Math.max(n-Qt.maxOverzooming,this._source.minzoom),v=Math.max(n+Qt.maxUnderzooming,this._source.minzoom),x={};for(const E of t){const C=this._addTile(E);l[E.key]=E,C.hasData()||n<this._source.maxzoom&&(x[E.key]=E)}this._retainLoadedChildren(x,n,v,l);for(const E of t){let C=this._tiles[E.key];if(C.hasData())continue;if(n+1>this._source.maxzoom){const P=E.children(this._source.maxzoom)[0],F=this.getTile(P);if(F&&F.hasData()){l[P.key]=P;continue}}else{const P=E.children(this._source.maxzoom);if(l[P[0].key]&&l[P[1].key]&&l[P[2].key]&&l[P[3].key])continue}let I=C.wasRequested();for(let P=E.overscaledZ-1;P>=m;--P){const F=E.scaledTo(P);if(h[F.key])break;if(h[F.key]=!0,C=this.getTile(F),!C&&I&&(C=this._addTile(F)),C){const Z=C.hasData();if((I||Z)&&(l[F.key]=F),I=C.wasRequested(),Z)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let l,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}n.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;h=m}for(const m of n)this._loadedParentTiles[m]=l}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const l=n;return n||(n=new $n(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,l||this._source.fire(new o.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=n.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,l){const h=[],m=this.transform;if(!m)return h;const v=l?m.getCameraQueryGeometry(t):t,x=t.map(q=>m.pointCoordinate(q,this.terrain)),E=v.map(q=>m.pointCoordinate(q,this.terrain)),C=this.getIds();let I=1/0,P=1/0,F=-1/0,Z=-1/0;for(const q of E)I=Math.min(I,q.x),P=Math.min(P,q.y),F=Math.max(F,q.x),Z=Math.max(Z,q.y);for(let q=0;q<C.length;q++){const H=this._tiles[C[q]];if(H.holdingForFade())continue;const N=H.tileID,re=Math.pow(2,m.zoom-H.tileID.overscaledZ),ce=n*H.queryPadding*o.EXTENT/H.tileSize/re,Y=[N.getTilePoint(new o.MercatorCoordinate(I,P)),N.getTilePoint(new o.MercatorCoordinate(F,Z))];if(Y[0].x-ce<o.EXTENT&&Y[0].y-ce<o.EXTENT&&Y[1].x+ce>=0&&Y[1].y+ce>=0){const ne=x.map(pe=>N.getTilePoint(pe)),de=E.map(pe=>N.getTilePoint(pe));h.push({tile:H,tileID:N,queryGeometry:ne,cameraQueryGeometry:de,scale:re})}}return h}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of n)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(gs(this._source.type)){const t=o.browser.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=t)return!0}return!1}setFeatureState(t,n,l){this._state.updateState(t=t||"_geojsonTileLayer",n,l)}removeFeatureState(t,n,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,l)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,l){const h=this._tiles[t];h&&h.setDependencies(n,l)}reloadTilesForDependencies(t,n){for(const l in this._tiles)this._tiles[l].hasDependency(t,n)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(t,n))}}function Fs(d,t){const n=Math.abs(2*d.wrap)-+(d.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||l-n||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function gs(d){return d==="raster"||d==="image"||d==="video"}Qt.maxOverzooming=10,Qt.maxUnderzooming=3;const Me="mapboxgl_preloaded_worker_pool";class Yi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Yi.workerCount;)this.workers.push(new Worker(o.config.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Me]}numActive(){return Object.keys(this.active).length}}const tr=Math.floor(o.browser.hardwareConcurrency/2);let fn;function An(){return fn||(fn=new Yi),fn}Yi.workerCount=o.isSafari(globalThis)?Math.max(Math.min(tr,3),1):1;class Pe{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.clamp(t,0,1);let n=1,l=this._distances[n];const h=t*this.paddedLength+this.padding;for(;l<h&&n<this._distances.length;)l=this._distances[++n];const m=n-1,v=this._distances[m],x=l-v,E=x>0?(h-v)/x:0;return this.points[m].mult(1-E).add(this.points[n].mult(E))}}function ct(d,t){let n=!0;return d==="always"||d!=="never"&&t!=="never"||(n=!1),n}class ut{constructor(t,n,l){const h=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(n/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)h.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,l,h,m){this._forEachCell(n,l,h,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m)}insertCircle(t,n,l,h){this._forEachCell(n-h,l-h,n+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,n,l,h,m,v){this.boxCells[m].push(v)}_insertCircleCell(t,n,l,h,m,v){this.circleCells[m].push(v)}_query(t,n,l,h,m,v,x){if(l<0||t>this.width||h<0||n>this.height)return[];const E=[];if(t<=0&&n<=0&&this.width<=l&&this.height<=h){if(m)return[{key:null,x1:t,y1:n,x2:l,y2:h}];for(let C=0;C<this.boxKeys.length;C++)E.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const I=this.circles[3*C],P=this.circles[3*C+1],F=this.circles[3*C+2];E.push({key:this.circleKeys[C],x1:I-F,y1:P-F,x2:I+F,y2:P+F})}}else this._forEachCell(t,n,l,h,this._queryCell,E,{hitTest:m,overlapMode:v,seenUids:{box:{},circle:{}}},x);return E}query(t,n,l,h){return this._query(t,n,l,h,!1,null)}hitTest(t,n,l,h,m,v){return this._query(t,n,l,h,!0,m,v).length>0}hitTestCircle(t,n,l,h,m){const v=t-l,x=t+l,E=n-l,C=n+l;if(x<0||v>this.width||C<0||E>this.height)return!1;const I=[];return this._forEachCell(v,E,x,C,this._queryCellCircle,I,{hitTest:!0,overlapMode:h,circle:{x:t,y:n,radius:l},seenUids:{box:{},circle:{}}},m),I.length>0}_queryCell(t,n,l,h,m,v,x,E){const{seenUids:C,hitTest:I,overlapMode:P}=x,F=this.boxCells[m];if(F!==null){const q=this.bboxes;for(const H of F)if(!C.box[H]){C.box[H]=!0;const N=4*H,re=this.boxKeys[H];if(t<=q[N+2]&&n<=q[N+3]&&l>=q[N+0]&&h>=q[N+1]&&(!E||E(re))&&(!I||!ct(P,re.overlapMode))&&(v.push({key:re,x1:q[N],y1:q[N+1],x2:q[N+2],y2:q[N+3]}),I))return!0}}const Z=this.circleCells[m];if(Z!==null){const q=this.circles;for(const H of Z)if(!C.circle[H]){C.circle[H]=!0;const N=3*H,re=this.circleKeys[H];if(this._circleAndRectCollide(q[N],q[N+1],q[N+2],t,n,l,h)&&(!E||E(re))&&(!I||!ct(P,re.overlapMode))){const ce=q[N],Y=q[N+1],ne=q[N+2];if(v.push({key:re,x1:ce-ne,y1:Y-ne,x2:ce+ne,y2:Y+ne}),I)return!0}}}return!1}_queryCellCircle(t,n,l,h,m,v,x,E){const{circle:C,seenUids:I,overlapMode:P}=x,F=this.boxCells[m];if(F!==null){const q=this.bboxes;for(const H of F)if(!I.box[H]){I.box[H]=!0;const N=4*H,re=this.boxKeys[H];if(this._circleAndRectCollide(C.x,C.y,C.radius,q[N+0],q[N+1],q[N+2],q[N+3])&&(!E||E(re))&&!ct(P,re.overlapMode))return v.push(!0),!0}}const Z=this.circleCells[m];if(Z!==null){const q=this.circles;for(const H of Z)if(!I.circle[H]){I.circle[H]=!0;const N=3*H,re=this.circleKeys[H];if(this._circlesCollide(q[N],q[N+1],q[N+2],C.x,C.y,C.radius)&&(!E||E(re))&&!ct(P,re.overlapMode))return v.push(!0),!0}}}_forEachCell(t,n,l,h,m,v,x,E){const C=this._convertToXCellCoord(t),I=this._convertToYCellCoord(n),P=this._convertToXCellCoord(l),F=this._convertToYCellCoord(h);for(let Z=C;Z<=P;Z++)for(let q=I;q<=F;q++)if(m.call(this,t,n,l,h,this.xCellCount*q+Z,v,x,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,l,h,m,v){const x=h-t,E=m-n,C=l+v;return C*C>x*x+E*E}_circleAndRectCollide(t,n,l,h,m,v,x){const E=(v-h)/2,C=Math.abs(t-(h+E));if(C>E+l)return!1;const I=(x-m)/2,P=Math.abs(n-(m+I));if(P>I+l)return!1;if(C<=E||P<=I)return!0;const F=C-E,Z=P-I;return F*F+Z*Z<=l*l}}function Ui(d,t,n,l,h){const m=o.create();return t?(o.scale(m,m,[1/h,1/h,1]),n||o.rotateZ(m,m,l.angle)):o.multiply(m,l.labelPlaneMatrix,d),m}function mn(d,t,n,l,h){if(t){const m=o.clone(d);return o.scale(m,m,[h,h,1]),n||o.rotateZ(m,m,-l.angle),m}return l.glCoordMatrix}function it(d,t,n){let l;n?(l=[d.x,d.y,n(d.x,d.y),1],o.transformMat4(l,l,t)):(l=[d.x,d.y,0,1],K(l,l,t));const h=l[3];return{point:new o.Point(l[0]/h,l[1]/h),signedDistanceFromCamera:h}}function tn(d,t){return .5+d/t*.5}function rn(d,t){const n=d[0]/d[3],l=d[1]/d[3];return n>=-t[0]&&n<=t[0]&&l>=-t[1]&&l<=t[1]}function kn(d,t,n,l,h,m,v,x,E,C){const I=l?d.textSizeData:d.iconSizeData,P=o.evaluateSizeForZoom(I,n.transform.zoom),F=[256/n.width*2+1,256/n.height*2+1],Z=l?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Z.clear();const q=d.lineVertexArray,H=l?d.text.placedSymbolArray:d.icon.placedSymbolArray,N=n.transform.width/n.transform.height;let re=!1;for(let ce=0;ce<H.length;ce++){const Y=H.get(ce);if(Y.hidden||Y.writingMode===o.WritingMode.vertical&&!re){V(Y.numGlyphs,Z);continue}let ne;if(re=!1,C?(ne=[Y.anchorX,Y.anchorY,C(Y.anchorX,Y.anchorY),1],o.transformMat4(ne,ne,t)):(ne=[Y.anchorX,Y.anchorY,0,1],K(ne,ne,t)),!rn(ne,F)){V(Y.numGlyphs,Z);continue}const de=tn(n.transform.cameraToCenterDistance,ne[3]),pe=o.evaluateSizeForFeature(I,P,Y),_e=v?pe/de:pe*de,Ee=new o.Point(Y.anchorX,Y.anchorY),we=it(Ee,h,C).point,Ie={projections:{},offsets:{}},$e=Di(Y,_e,!1,x,t,h,m,d.glyphOffsetArray,q,Z,we,Ee,Ie,N,E,C);re=$e.useVertical,($e.notEnoughRoom||re||$e.needsFlipping&&Di(Y,_e,!0,x,t,h,m,d.glyphOffsetArray,q,Z,we,Ee,Ie,N,E,C).notEnoughRoom)&&V(Y.numGlyphs,Z)}l?d.text.dynamicLayoutVertexBuffer.updateData(Z):d.icon.dynamicLayoutVertexBuffer.updateData(Z)}function kr(d,t,n,l,h,m,v,x,E,C,I,P,F){const Z=x.glyphStartIndex+x.numGlyphs,q=x.lineStartIndex,H=x.lineStartIndex+x.lineLength,N=t.getoffsetX(x.glyphStartIndex),re=t.getoffsetX(Z-1),ce=D(d*N,n,l,h,m,v,x.segment,q,H,E,C,I,P,F);if(!ce)return null;const Y=D(d*re,n,l,h,m,v,x.segment,q,H,E,C,I,P,F);return Y?{first:ce,last:Y}:null}function Mn(d,t,n,l){return d===o.WritingMode.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*l?{useVertical:!0}:(d===o.WritingMode.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function Di(d,t,n,l,h,m,v,x,E,C,I,P,F,Z,q,H){const N=t/24,re=d.lineOffsetX*N,ce=d.lineOffsetY*N;let Y;if(d.numGlyphs>1){const ne=d.glyphStartIndex+d.numGlyphs,de=d.lineStartIndex,pe=d.lineStartIndex+d.lineLength,_e=kr(N,x,re,ce,n,I,P,d,E,m,F,q,H);if(!_e)return{notEnoughRoom:!0};const Ee=it(_e.first.point,v,H).point,we=it(_e.last.point,v,H).point;if(l&&!n){const Ie=Mn(d.writingMode,Ee,we,Z);if(Ie)return Ie}Y=[_e.first];for(let Ie=d.glyphStartIndex+1;Ie<ne-1;Ie++)Y.push(D(N*x.getoffsetX(Ie),re,ce,n,I,P,d.segment,de,pe,E,m,F,q,H));Y.push(_e.last)}else{if(l&&!n){const de=it(P,h,H).point,pe=d.lineStartIndex+d.segment+1,_e=new o.Point(E.getx(pe),E.gety(pe)),Ee=it(_e,h,H),we=Ee.signedDistanceFromCamera>0?Ee.point:Ot(P,_e,de,1,h,H),Ie=Mn(d.writingMode,de,we,Z);if(Ie)return Ie}const ne=D(N*x.getoffsetX(d.glyphStartIndex),re,ce,n,I,P,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,E,m,F,q,H);if(!ne)return{notEnoughRoom:!0};Y=[ne]}for(const ne of Y)o.addDynamicAttributes(C,ne.point,ne.angle);return{}}function Ot(d,t,n,l,h,m){const v=it(d.add(d.sub(t)._unit()),h,m).point,x=n.sub(v);return n.add(x._mult(l/x.mag()))}function Os(d,t){const{projectionCache:n,lineVertexArray:l,labelPlaneMatrix:h,tileAnchorPoint:m,distanceFromAnchor:v,getElevation:x,previousVertex:E,direction:C,absOffsetX:I}=t;if(n.projections[d])return n.projections[d];const P=new o.Point(l.getx(d),l.gety(d)),F=it(P,h,x);if(F.signedDistanceFromCamera>0)return n.projections[d]=F.point,F.point;const Z=d-C;return Ot(v===0?m:new o.Point(l.getx(Z),l.gety(Z)),P,E,I-v+1,h,x)}function nn(d,t,n){return d._unit()._perp()._mult(t*n)}function W(d,t,n,l,h,m,v,x){const{projectionCache:E,direction:C}=x;if(E.offsets[d])return E.offsets[d];const I=n.add(t);if(d+C<l||d+C>=h)return E.offsets[d]=I,I;const P=Os(d+C,x),F=nn(P.sub(n),v,C),Z=n.add(F),q=P.add(F);return E.offsets[d]=o.findLineIntersection(m,I,Z,q)||I,E.offsets[d]}function D(d,t,n,l,h,m,v,x,E,C,I,P,F,Z){const q=l?d-t:d+t;let H=q>0?1:-1,N=0;l&&(H*=-1,N=Math.PI),H<0&&(N+=Math.PI);let re,ce,Y=H>0?x+v:x+v+1,ne=h,de=h,pe=0,_e=0;const Ee=Math.abs(q),we=[];let Ie;for(;pe+_e<=Ee;){if(Y+=H,Y<x||Y>=E)return null;pe+=_e,de=ne,ce=re;const Le={projectionCache:P,lineVertexArray:C,labelPlaneMatrix:I,tileAnchorPoint:m,distanceFromAnchor:pe,getElevation:Z,previousVertex:de,direction:H,absOffsetX:Ee};if(ne=Os(Y,Le),n===0)we.push(de),Ie=ne.sub(de);else{let Ke;const qe=ne.sub(de);Ke=qe.mag()===0?nn(Os(Y+H,Le).sub(ne),n,H):nn(qe,n,H),ce||(ce=de.add(Ke)),re=W(Y,Ke,ne,x,E,ce,n,Le),we.push(ce),Ie=re.sub(ce)}_e=Ie.mag()}const $e=Ie._mult((Ee-pe)/_e)._add(ce||de),ft=N+Math.atan2(ne.y-de.y,ne.x-de.x);return we.push($e),{point:$e,angle:F?ft:0,path:we}}const R=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function V(d,t){for(let n=0;n<d;n++){const l=t.length;t.resize(l+4),t.float32.set(R,3*l)}}function K(d,t,n){const l=t[0],h=t[1];return d[0]=n[0]*l+n[4]*h+n[12],d[1]=n[1]*l+n[5]*h+n[13],d[3]=n[3]*l+n[7]*h+n[15],d}const Q=100;class se{constructor(t,n=new ut(t.width+200,t.height+200,25),l=new ut(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=l,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Q,this.screenBottomBoundary=t.height+Q,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,l,h,m,v){const x=this.projectAndGetPerspectiveRatio(h,t.anchorPointX,t.anchorPointY,v),E=l*x.perspectiveRatio,C=t.x1*E+x.point.x,I=t.y1*E+x.point.y,P=t.x2*E+x.point.x,F=t.y2*E+x.point.y;return!this.isInsideGrid(C,I,P,F)||n!=="always"&&this.grid.hitTest(C,I,P,F,n,m)||x.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[C,I,P,F],offscreen:this.isOffscreen(C,I,P,F)}}placeCollisionCircles(t,n,l,h,m,v,x,E,C,I,P,F,Z,q){const H=[],N=new o.Point(n.anchorX,n.anchorY),re=it(N,v,q),ce=tn(this.transform.cameraToCenterDistance,re.signedDistanceFromCamera),Y=(I?m/ce:m*ce)/o.ONE_EM,ne=it(N,x,q).point,de=kr(Y,h,n.lineOffsetX*Y,n.lineOffsetY*Y,!1,ne,N,n,l,x,{projections:{},offsets:{}},!1,q);let pe=!1,_e=!1,Ee=!0;if(de){const we=.5*F*ce+Z,Ie=new o.Point(-100,-100),$e=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),ft=new Pe,Le=de.first,Ke=de.last;let qe=[];for(let Ye=Le.path.length-1;Ye>=1;Ye--)qe.push(Le.path[Ye]);for(let Ye=1;Ye<Ke.path.length;Ye++)qe.push(Ke.path[Ye]);const Ht=2.5*we;if(E){const Ye=qe.map(gt=>it(gt,E,q));qe=Ye.some(gt=>gt.signedDistanceFromCamera<=0)?[]:Ye.map(gt=>gt.point)}let mt=[];if(qe.length>0){const Ye=qe[0].clone(),gt=qe[0].clone();for(let Kt=1;Kt<qe.length;Kt++)Ye.x=Math.min(Ye.x,qe[Kt].x),Ye.y=Math.min(Ye.y,qe[Kt].y),gt.x=Math.max(gt.x,qe[Kt].x),gt.y=Math.max(gt.y,qe[Kt].y);mt=Ye.x>=Ie.x&&gt.x<=$e.x&&Ye.y>=Ie.y&&gt.y<=$e.y?[qe]:gt.x<Ie.x||Ye.x>$e.x||gt.y<Ie.y||Ye.y>$e.y?[]:o.clipLine([qe],Ie.x,Ie.y,$e.x,$e.y)}for(const Ye of mt){ft.reset(Ye,.25*we);let gt=0;gt=ft.length<=.5*we?1:Math.ceil(ft.paddedLength/Ht)+1;for(let Kt=0;Kt<gt;Kt++){const Pt=Kt/Math.max(gt-1,1),br=ft.lerp(Pt),Ri=br.x+Q,ii=br.y+Q;H.push(Ri,ii,we,0);const sr=Ri-we,ln=ii-we,jr=Ri+we,cn=ii+we;if(Ee=Ee&&this.isOffscreen(sr,ln,jr,cn),_e=_e||this.isInsideGrid(sr,ln,jr,cn),t!=="always"&&this.grid.hitTestCircle(Ri,ii,we,t,P)&&(pe=!0,!C))return{circles:[],offscreen:!1,collisionDetected:pe}}}}return{circles:!C&&pe||!_e||ce<this.perspectiveRatioCutoff?[]:H,offscreen:Ee,collisionDetected:pe}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let l=1/0,h=1/0,m=-1/0,v=-1/0;for(const I of t){const P=new o.Point(I.x+Q,I.y+Q);l=Math.min(l,P.x),h=Math.min(h,P.y),m=Math.max(m,P.x),v=Math.max(v,P.y),n.push(P)}const x=this.grid.query(l,h,m,v).concat(this.ignoredGrid.query(l,h,m,v)),E={},C={};for(const I of x){const P=I.key;if(E[P.bucketInstanceId]===void 0&&(E[P.bucketInstanceId]={}),E[P.bucketInstanceId][P.featureIndex])continue;const F=[new o.Point(I.x1,I.y1),new o.Point(I.x2,I.y1),new o.Point(I.x2,I.y2),new o.Point(I.x1,I.y2)];o.polygonIntersectsPolygon(n,F)&&(E[P.bucketInstanceId][P.featureIndex]=!0,C[P.bucketInstanceId]===void 0&&(C[P.bucketInstanceId]=[]),C[P.bucketInstanceId].push(P.featureIndex))}return C}insertCollisionBox(t,n,l,h,m,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:v,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,l,h,m,v){const x=l?this.ignoredGrid:this.grid,E={bucketInstanceId:h,featureIndex:m,collisionGroupID:v,overlapMode:n};for(let C=0;C<t.length;C+=4)x.insertCircle(E,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,n,l,h){let m;return h?(m=[n,l,h(n,l),1],o.transformMat4(m,m,t)):(m=[n,l,0,1],K(m,m,t)),{point:new o.Point((m[0]/m[3]+1)/2*this.transform.width+Q,(-m[1]/m[3]+1)/2*this.transform.height+Q),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}}isOffscreen(t,n,l,h){return l<Q||t>=this.screenRightBoundary||h<Q||n>this.screenBottomBoundary}isInsideGrid(t,n,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=o.identity([]);return o.translate(t,t,[-100,-100,0]),t}}function te(d,t,n){return t*(o.EXTENT/(d.tileSize*Math.pow(2,n-d.tileID.overscaledZ)))}class ee{constructor(t,n,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class ae{constructor(t,n,l,h,m){this.text=new ee(t?t.text:null,n,l,m),this.icon=new ee(t?t.icon:null,n,h,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ve{constructor(t,n,l){this.text=t,this.icon=n,this.skipFade=l}}class xe{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class be{constructor(t,n,l,h,m){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=m}}class Qe{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:l=>l.collisionGroupID===n}}return this.collisionGroups[t]}}function at(d,t,n,l,h){const{horizontalAlign:m,verticalAlign:v}=o.getAnchorAlignment(d);return new o.Point(-(m-.5)*t+l[0]*h,-(v-.5)*n+l[1]*h)}function Ze(d,t,n,l,h,m){const{x1:v,x2:x,y1:E,y2:C,anchorPointX:I,anchorPointY:P}=d,F=new o.Point(t,n);return l&&F._rotate(h?m:-m),{x1:v+F.x,y1:E+F.y,x2:x+F.x,y2:C+F.y,anchorPointX:I,anchorPointY:P}}class Xe{constructor(t,n,l,h,m){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new se(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Qe(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,l,h){const m=l.getBucket(n),v=l.latestFeatureIndex;if(!m||!v||n.id!==m.layerIds[0])return;const x=l.collisionBoxArray,E=m.layers[0].layout,C=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),I=l.tileSize/o.EXTENT,P=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),F=E.get("text-pitch-alignment")==="map",Z=E.get("text-rotation-alignment")==="map",q=te(l,1,this.transform.zoom),H=Ui(P,F,Z,this.transform,q);let N=null;if(F){const ce=mn(P,F,Z,this.transform,q);N=o.multiply([],this.transform.labelPlaneMatrix,ce)}this.retainedQueryData[m.bucketInstanceId]=new be(m.bucketInstanceId,v,m.sourceLayerIndex,m.index,l.tileID);const re={bucket:m,layout:E,posMatrix:P,textLabelPlaneMatrix:H,labelToScreenMatrix:N,scale:C,textPixelRatio:I,holdingForFade:l.holdingForFade(),collisionBoxArray:x,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(h)for(const ce of m.sortKeyRanges){const{sortKey:Y,symbolInstanceStart:ne,symbolInstanceEnd:de}=ce;t.push({sortKey:Y,symbolInstanceStart:ne,symbolInstanceEnd:de,parameters:re})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:re})}attemptAnchorPlacement(t,n,l,h,m,v,x,E,C,I,P,F,Z,q,H,N){const re=o.TextAnchorEnum[t.textAnchor],ce=[t.textOffset0,t.textOffset1],Y=at(re,l,h,ce,m),ne=this.collisionIndex.placeCollisionBox(Ze(n,Y.x,Y.y,v,x,this.transform.angle),P,E,C,I.predicate,N);if((!H||this.collisionIndex.placeCollisionBox(Ze(H,Y.x,Y.y,v,x,this.transform.angle),P,E,C,I.predicate,N).box.length!==0)&&ne.box.length>0){let de;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(de=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:ce,width:l,height:h,anchor:re,textBoxScale:m,prevAnchor:de},this.markUsedJustification(Z,re,F,q),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,q,F),this.placedOrientations[F.crossTileID]=q),{shift:Y,placedGlyphBoxes:ne}}}placeLayerBucketPart(t,n,l){const{bucket:h,layout:m,posMatrix:v,textLabelPlaneMatrix:x,labelToScreenMatrix:E,textPixelRatio:C,holdingForFade:I,collisionBoxArray:P,partiallyEvaluatedTextSize:F,collisionGroup:Z}=t.parameters,q=m.get("text-optional"),H=m.get("icon-optional"),N=o.getOverlapMode(m,"text-overlap","text-allow-overlap"),re=N==="always",ce=o.getOverlapMode(m,"icon-overlap","icon-allow-overlap"),Y=ce==="always",ne=m.get("text-rotation-alignment")==="map",de=m.get("text-pitch-alignment")==="map",pe=m.get("icon-text-fit")!=="none",_e=m.get("symbol-z-order")==="viewport-y",Ee=re&&(Y||!h.hasIconData()||H),we=Y&&(re||!h.hasTextData()||q);!h.collisionArrays&&P&&h.deserializeCollisionBoxes(P);const Ie=this.retainedQueryData[h.bucketInstanceId].tileID,$e=this.terrain?(Le,Ke)=>this.terrain.getElevation(Ie,Le,Ke):null,ft=(Le,Ke)=>{var qe,Ht;if(n[Le.crossTileID])return;if(I)return void(this.placements[Le.crossTileID]=new ve(!1,!1,!1));let mt=!1,Ye=!1,gt=!0,Kt=null,Pt={box:null,offscreen:null},br={box:null,offscreen:null},Ri=null,ii=null,sr=null,ln=0,jr=0,cn=0;Ke.textFeatureIndex?ln=Ke.textFeatureIndex:Le.useRuntimeCollisionCircles&&(ln=Le.featureIndex),Ke.verticalTextFeatureIndex&&(jr=Ke.verticalTextFeatureIndex);const Is=Ke.textBox;if(Is){const di=ki=>{let wi=o.WritingMode.horizontal;if(h.allowVerticalPlacement&&!ki&&this.prevPlacement){const qi=this.prevPlacement.placedOrientations[Le.crossTileID];qi&&(this.placedOrientations[Le.crossTileID]=qi,wi=qi,this.markUsedOrientation(h,wi,Le))}return wi},Ai=(ki,wi)=>{if(h.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&Ke.verticalTextBox){for(const qi of h.writingModes)if(qi===o.WritingMode.vertical?(Pt=wi(),br=Pt):Pt=ki(),Pt&&Pt.box&&Pt.box.length)break}else Pt=ki()},ji=Le.textAnchorOffsetStartIndex,As=Le.textAnchorOffsetEndIndex;if(As===ji){const ki=(wi,qi)=>{const Yt=this.collisionIndex.placeCollisionBox(wi,N,C,v,Z.predicate,$e);return Yt&&Yt.box&&Yt.box.length&&(this.markUsedOrientation(h,qi,Le),this.placedOrientations[Le.crossTileID]=qi),Yt};Ai(()=>ki(Is,o.WritingMode.horizontal),()=>{const wi=Ke.verticalTextBox;return h.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&wi?ki(wi,o.WritingMode.vertical):{box:null,offscreen:null}}),di(Pt&&Pt.box&&Pt.box.length)}else{let ki=o.TextAnchorEnum[(Ht=(qe=this.prevPlacement)===null||qe===void 0?void 0:qe.variableOffsets[Le.crossTileID])===null||Ht===void 0?void 0:Ht.anchor];const wi=(Yt,vn,qr)=>{const Rn=Yt.x2-Yt.x1,_c=Yt.y2-Yt.y1,rs=Le.textBoxScale,Au=pe&&ce==="never"?vn:null;let ns={box:[],offscreen:!1},ti=N==="never"?1:2,ia="never";ki&&ti++;for(let ll=0;ll<ti;ll++){for(let xn=ji;xn<As;xn++){const Fn=h.textAnchorOffsets.get(xn);if(ki&&Fn.textAnchor!==ki)continue;const ks=this.attemptAnchorPlacement(Fn,Yt,Rn,_c,rs,ne,de,C,v,Z,ia,Le,h,qr,Au,$e);if(ks&&(ns=ks.placedGlyphBoxes,ns&&ns.box&&ns.box.length))return mt=!0,Kt=ks.shift,ns}ki?ki=null:ia=N}return ns};Ai(()=>wi(Is,Ke.iconBox,o.WritingMode.horizontal),()=>{const Yt=Ke.verticalTextBox;return h.allowVerticalPlacement&&!(Pt&&Pt.box&&Pt.box.length)&&Le.numVerticalGlyphVertices>0&&Yt?wi(Yt,Ke.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Pt&&(mt=Pt.box,gt=Pt.offscreen);const qi=di(Pt&&Pt.box);if(!mt&&this.prevPlacement){const Yt=this.prevPlacement.variableOffsets[Le.crossTileID];Yt&&(this.variableOffsets[Le.crossTileID]=Yt,this.markUsedJustification(h,Yt.anchor,Le,qi))}}}if(Ri=Pt,mt=Ri&&Ri.box&&Ri.box.length>0,gt=Ri&&Ri.offscreen,Le.useRuntimeCollisionCircles){const di=h.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex),Ai=o.evaluateSizeForFeature(h.textSizeData,F,di),ji=m.get("text-padding");ii=this.collisionIndex.placeCollisionCircles(N,di,h.lineVertexArray,h.glyphOffsetArray,Ai,v,x,E,l,de,Z.predicate,Le.collisionCircleDiameter,ji,$e),ii.circles.length&&ii.collisionDetected&&!l&&o.warnOnce("Collisions detected, but collision boxes are not shown"),mt=re||ii.circles.length>0&&!ii.collisionDetected,gt=gt&&ii.offscreen}if(Ke.iconFeatureIndex&&(cn=Ke.iconFeatureIndex),Ke.iconBox){const di=Ai=>{const ji=pe&&Kt?Ze(Ai,Kt.x,Kt.y,ne,de,this.transform.angle):Ai;return this.collisionIndex.placeCollisionBox(ji,ce,C,v,Z.predicate,$e)};br&&br.box&&br.box.length&&Ke.verticalIconBox?(sr=di(Ke.verticalIconBox),Ye=sr.box.length>0):(sr=di(Ke.iconBox),Ye=sr.box.length>0),gt=gt&&sr.offscreen}const Bn=q||Le.numHorizontalGlyphVertices===0&&Le.numVerticalGlyphVertices===0,yn=H||Le.numIconVertices===0;if(Bn||yn?yn?Bn||(Ye=Ye&&mt):mt=Ye&&mt:Ye=mt=Ye&&mt,mt&&Ri&&Ri.box&&this.collisionIndex.insertCollisionBox(Ri.box,N,m.get("text-ignore-placement"),h.bucketInstanceId,br&&br.box&&jr?jr:ln,Z.ID),Ye&&sr&&this.collisionIndex.insertCollisionBox(sr.box,ce,m.get("icon-ignore-placement"),h.bucketInstanceId,cn,Z.ID),ii&&(mt&&this.collisionIndex.insertCollisionCircles(ii.circles,N,m.get("text-ignore-placement"),h.bucketInstanceId,ln,Z.ID),l)){const di=h.bucketInstanceId;let Ai=this.collisionCircleArrays[di];Ai===void 0&&(Ai=this.collisionCircleArrays[di]=new xe);for(let ji=0;ji<ii.circles.length;ji+=4)Ai.circles.push(ii.circles[ji+0]),Ai.circles.push(ii.circles[ji+1]),Ai.circles.push(ii.circles[ji+2]),Ai.circles.push(ii.collisionDetected?1:0)}if(Le.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Le.crossTileID]=new ve(mt||Ee,Ye||we,gt||h.justReloaded),n[Le.crossTileID]=!0};if(_e){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Le=h.getSortedSymbolIndexes(this.transform.angle);for(let Ke=Le.length-1;Ke>=0;--Ke){const qe=Le[Ke];ft(h.symbolInstances.get(qe),h.collisionArrays[qe])}}else for(let Le=t.symbolInstanceStart;Le<t.symbolInstanceEnd;Le++)ft(h.symbolInstances.get(Le),h.collisionArrays[Le]);if(l&&h.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[h.bucketInstanceId];o.invert(Le.invProjMatrix,v),Le.viewportMatrix=this.collisionIndex.getViewportMatrix()}h.justReloaded=!1}markUsedJustification(t,n,l,h){let m;m=h===o.WritingMode.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(n)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const x of v)x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=m>=0&&x!==m?0:l.crossTileID)}markUsedOrientation(t,n,l){const h=n===o.WritingMode.horizontal||n===o.WritingMode.horizontalOnly?n:0,m=n===o.WritingMode.vertical?n:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const x of v)t.text.placedSymbolArray.get(x).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let l=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const h=n?n.symbolFadeChange(t):1,m=n?n.opacities:{},v=n?n.variableOffsets:{},x=n?n.placedOrientations:{};for(const E in this.placements){const C=this.placements[E],I=m[E];I?(this.opacities[E]=new ae(I,h,C.text,C.icon),l=l||C.text!==I.text.placed||C.icon!==I.icon.placed):(this.opacities[E]=new ae(null,h,C.text,C.icon,C.skipFade),l=l||C.text||C.icon)}for(const E in m){const C=m[E];if(!this.opacities[E]){const I=new ae(C,h,!1,!1);I.isHidden()||(this.opacities[E]=I,l=l||C.text.placed||C.icon.placed)}}for(const E in v)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=v[E]);for(const E in x)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=x[E]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const l={};for(const h of n){const m=h.getBucket(t);m&&h.latestFeatureIndex&&t.id===m.layerIds[0]&&this.updateBucketOpacities(m,l,h.collisionBoxArray)}}updateBucketOpacities(t,n,l){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const h=t.layers[0],m=h.layout,v=new ae(null,0,!1,!1,!0),x=m.get("text-allow-overlap"),E=m.get("icon-allow-overlap"),C=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),I=m.get("text-rotation-alignment")==="map",P=m.get("text-pitch-alignment")==="map",F=m.get("icon-text-fit")!=="none",Z=new ae(null,0,x&&(E||!t.hasIconData()||m.get("icon-optional")),E&&(x||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&l&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(l);const q=(H,N,re)=>{for(let ce=0;ce<N/4;ce++)H.opacityVertexArray.emplaceBack(re);H.hasVisibleVertices=H.hasVisibleVertices||re!==ai};for(let H=0;H<t.symbolInstances.length;H++){const N=t.symbolInstances.get(H),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:ce,crossTileID:Y}=N;let ne=this.opacities[Y];n[Y]?ne=v:ne||(ne=Z,this.opacities[Y]=ne),n[Y]=!0;const de=N.numIconVertices>0,pe=this.placedOrientations[N.crossTileID],_e=pe===o.WritingMode.vertical,Ee=pe===o.WritingMode.horizontal||pe===o.WritingMode.horizontalOnly;if(re>0||ce>0){const we=Bi(ne.text);q(t.text,re,_e?ai:we),q(t.text,ce,Ee?ai:we);const Ie=ne.text.isHidden();[N.rightJustifiedTextSymbolIndex,N.centerJustifiedTextSymbolIndex,N.leftJustifiedTextSymbolIndex].forEach(Le=>{Le>=0&&(t.text.placedSymbolArray.get(Le).hidden=Ie||_e?1:0)}),N.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(N.verticalPlacedTextSymbolIndex).hidden=Ie||Ee?1:0);const $e=this.variableOffsets[N.crossTileID];$e&&this.markUsedJustification(t,$e.anchor,N,pe);const ft=this.placedOrientations[N.crossTileID];ft&&(this.markUsedJustification(t,"left",N,ft),this.markUsedOrientation(t,ft,N))}if(de){const we=Bi(ne.icon),Ie=!(F&&N.verticalPlacedIconSymbolIndex&&_e);N.placedIconSymbolIndex>=0&&(q(t.icon,N.numIconVertices,Ie?we:ai),t.icon.placedSymbolArray.get(N.placedIconSymbolIndex).hidden=ne.icon.isHidden()),N.verticalPlacedIconSymbolIndex>=0&&(q(t.icon,N.numVerticalIconVertices,Ie?ai:we),t.icon.placedSymbolArray.get(N.verticalPlacedIconSymbolIndex).hidden=ne.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const we=t.collisionArrays[H];if(we){let Ie=new o.Point(0,0);if(we.textBox||we.verticalTextBox){let ft=!0;if(C){const Le=this.variableOffsets[Y];Le?(Ie=at(Le.anchor,Le.width,Le.height,Le.textOffset,Le.textBoxScale),I&&Ie._rotate(P?this.transform.angle:-this.transform.angle)):ft=!1}we.textBox&&nt(t.textCollisionBox.collisionVertexArray,ne.text.placed,!ft||_e,Ie.x,Ie.y),we.verticalTextBox&&nt(t.textCollisionBox.collisionVertexArray,ne.text.placed,!ft||Ee,Ie.x,Ie.y)}const $e=!!(!Ee&&we.verticalIconBox);we.iconBox&&nt(t.iconCollisionBox.collisionVertexArray,ne.icon.placed,$e,F?Ie.x:0,F?Ie.y:0),we.verticalIconBox&&nt(t.iconCollisionBox.collisionVertexArray,ne.icon.placed,!$e,F?Ie.x:0,F?Ie.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=H.invProjMatrix,t.placementViewportMatrix=H.viewportMatrix,t.collisionCircleArray=H.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const l=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function nt(d,t,n,l,h){d.emplaceBack(t?1:0,n?1:0,l||0,h||0),d.emplaceBack(t?1:0,n?1:0,l||0,h||0),d.emplaceBack(t?1:0,n?1:0,l||0,h||0),d.emplaceBack(t?1:0,n?1:0,l||0,h||0)}const Et=Math.pow(2,25),zt=Math.pow(2,24),yt=Math.pow(2,17),wt=Math.pow(2,16),ir=Math.pow(2,9),rt=Math.pow(2,8),xi=Math.pow(2,1);function Bi(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,n=Math.floor(127*d.opacity);return n*Et+t*zt+n*yt+t*wt+n*ir+t*rt+n*xi+t}const ai=0;class gr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,l,h,m){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(v,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((x,E)=>x.sortKey-E.sortKey));this._currentPartIndex<v.length;)if(n.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,m())return!0;return!1}}class su{constructor(t,n,l,h,m,v,x,E){this.placement=new Xe(t,n,v,x,E),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,n,l){const h=o.browser.now(),m=()=>!this._forceFullPlacement&&o.browser.now()-h>2;for(;this._currentPlacementIndex>=0;){const v=n[t[this._currentPlacementIndex]],x=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=x)&&(!v.maxzoom||v.maxzoom>x)){if(this._inProgressLayer||(this._inProgressLayer=new gr(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Vi=512/o.EXTENT/2;class Mr{constructor(t,n,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let m=0;m<n.length;m++){const v=n.get(m),x=v.key,E=h.get(x);E?E.push(v):h.set(x,[v])}for(const[m,v]of h){const x={positions:v.map(E=>({x:Math.floor(E.anchorX*Vi),y:Math.floor(E.anchorY*Vi)})),crossTileIDs:v.map(E=>E.crossTileID)};if(x.positions.length>128){const E=new o.KDBush(x.positions.length,16,Uint16Array);for(const{x:C,y:I}of x.positions)E.add(C,I);E.finish(),delete x.positions,x.index=E}this._symbolsByKey[m]=x}}getScaledCoordinates(t,n){const{x:l,y:h,z:m}=this.tileID.canonical,{x:v,y:x,z:E}=n.canonical,C=Vi/Math.pow(2,E-m),I=(x*o.EXTENT+t.anchorY)*C,P=h*o.EXTENT*Vi;return{x:Math.floor((v*o.EXTENT+t.anchorX)*C-l*o.EXTENT*Vi),y:Math.floor(I-P)}}findMatches(t,n,l){const h=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let m=0;m<t.length;m++){const v=t.get(m);if(v.crossTileID)continue;const x=this._symbolsByKey[v.key];if(!x)continue;const E=this.getScaledCoordinates(v,n);if(x.index){const C=x.index.range(E.x-h,E.y-h,E.x+h,E.y+h).sort();for(const I of C){const P=x.crossTileIDs[I];if(!l[P]){l[P]=!0,v.crossTileID=P;break}}}else if(x.positions)for(let C=0;C<x.positions.length;C++){const I=x.positions[C],P=x.crossTileIDs[C];if(Math.abs(I.x-E.x)<=h&&Math.abs(I.y-E.y)<=h&&!l[P]){l[P]=!0,v.crossTileID=P;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class jl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const l in this.indexes){const h=this.indexes[l],m={};for(const v in h){const x=h[v];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+n),m[x.tileID.key]=x}this.indexes[l]=m}this.lng=t}addBucket(t,n,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let m=0;m<n.symbolInstances.length;m++)n.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const m in this.indexes){const v=this.indexes[m];if(Number(m)>t.overscaledZ)for(const x in v){const E=v[x];E.tileID.isChildOf(t)&&E.findMatches(n.symbolInstances,t,h)}else{const x=v[t.scaledTo(Number(m)).key];x&&x.findMatches(n.symbolInstances,t,h)}}for(let m=0;m<n.symbolInstances.length;m++){const v=n.symbolInstances.get(m);v.crossTileID||(v.crossTileID=l.generate(),h[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Mr(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const l of n.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let n=!1;for(const l in this.indexes){const h=this.indexes[l];for(const m in h)t[h[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[m]),delete h[m],n=!0)}return n}}class li{constructor(){this.layerIndexes={},this.crossTileIDs=new jl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new wo);let m=!1;const v={};h.handleWrapJump(l);for(const x of n){const E=x.getBucket(t);E&&t.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(x.tileID,E,this.crossTileIDs)&&(m=!0),v[E.bucketInstanceId]=!0)}return h.removeStaleBuckets(v)&&(m=!0),m}pruneUnusedLayers(t){const n={};t.forEach(l=>{n[l]=!0});for(const l in this.layerIndexes)n[l]||delete this.layerIndexes[l]}}const Pn=(d,t)=>o.emitValidationErrors(d,t&&t.filter(n=>n.identifier!=="source.canvas")),Gn=o.pick(o.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),ci=o.pick(o.operations,["setCenter","setZoom","setBearing","setPitch"]),Eo=o.emptyStyle();class Ni extends o.Evented{constructor(t,n={}){super(),this.map=t,this.dispatcher=new oi(An(),this,t._getMapId()),this.imageManager=new Zt,this.imageManager.setEventedParent(this),this.glyphManager=new yi(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Fi(256,512),this.crossTileSymbolIndex=new li,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const l=this;this._rtlTextPluginCallback=Ni.registerForPluginStateChange(h=>{l.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:h.pluginStatus,pluginURL:h.pluginURL},(m,v)=>{if(o.triggerPluginCompletionEvent(m),v&&v.every(x=>x))for(const x in l.sourceCaches){const E=l.sourceCaches[x].getSource().type;E!=="vector"&&E!=="geojson"||l.sourceCaches[x].reload()}})}),this.on("data",h=>{if(h.dataType!=="source"||h.sourceDataType!=="metadata")return;const m=this.sourceCaches[h.sourceId];if(!m)return;const v=m.getSource();if(v&&v.vectorLayerIds)for(const x in this._layers){const E=this._layers[x];E.source===v.id&&this._validateLayer(E)}})}loadURL(t,n={},l){this.fire(new o.Event("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const h=this.map._requestManager.transformRequest(t,Se.Style);this._request=o.getJSON(h,(m,v)=>{this._request=null,m?this.fire(new o.ErrorEvent(m)):v&&this._load(v,n,l)})}loadJSON(t,n={},l){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.browser.frame(()=>{this._request=null,n.validate=n.validate!==!1,this._load(t,n,l)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Eo,{validate:!1})}_load(t,n,l){var h;const m=n.transformStyle?n.transformStyle(l,t):t;if(!n.validate||!Pn(this,o.validateStyle(m))){this._loaded=!0,this.stylesheet=m;for(const v in m.sources)this.addSource(v,m.sources[v],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new Ur(this.stylesheet.light),this.map.setTerrain((h=this.stylesheet.terrain)!==null&&h!==void 0?h:null),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}}_createLayers(){const t=o.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of t){const l=o.createStyleLayer(n);l.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=l}}_loadSprite(t,n=!1,l=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(h,m,v,x){const E=xt(h),C=E.length,I=v>1?"@2x":"",P={},F={},Z={};for(const{id:q,url:H}of E){const N=m.transformRequest(m.normalizeSpriteURL(H,I,".json"),Se.SpriteJSON),re=`${q}_${N.url}`;P[re]=o.getJSON(N,(ne,de)=>{delete P[re],F[q]=de,_t(x,F,Z,ne,C)});const ce=m.transformRequest(m.normalizeSpriteURL(H,I,".png"),Se.SpriteImage),Y=`${q}_${ce.url}`;P[Y]=De.getImage(ce,(ne,de)=>{delete P[Y],Z[q]=de,_t(x,F,Z,ne,C)})}return{cancel(){for(const q of Object.values(P))q.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(h,m)=>{if(this._spriteRequest=null,h)this.fire(new o.ErrorEvent(h));else if(m)for(const v in m){this._spritesImagesIds[v]=[];const x=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(E=>!(E in m)):[];for(const E of x)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in m[v]){const C=v==="default"?E:`${v}:${E}`;this._spritesImagesIds[v].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,m[v][E],!1):this.imageManager.addImage(C,m[v][E]),n&&(this._changedImages[C]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"})),l&&l(h)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const l=t.sourceLayer;if(!l)return;const h=n.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const n=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n);const l=[];for(const h of t)n[h]&&l.push(n[h]);return l}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const l of n){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const h=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(h.length||m.length)&&this._updateWorkerLayers(h,m);for(const v in this._updatedSources){const x=this._updatedSources[v];if(x==="reload")this._reloadSource(v);else{if(x!=="clear")throw new Error(`Invalid action ${x}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.sourceCaches){const m=this.sourceCaches[h];l[h]=m.used,m.used=!1}for(const h of this._order){const m=this._layers[h];m.recalculate(t,this._availableImages),!m.isHidden(t.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const h in l){const m=this.sourceCaches[h];l[h]!==m.used&&m.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){this._checkLoaded();const l=this.serialize();if(t=n.transformStyle?n.transformStyle(l,t):t,Pn(this,o.validateStyle(t)))return!1;(t=o.clone$1(t)).layers=o.derefLayers(t.layers);const h=o.diffStyles(l,t).filter(v=>!(v.command in ci));if(h.length===0)return!1;const m=h.filter(v=>!(v.command in Gn));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);for(const v of h)v.command!=="setTransition"&&this[v.command].apply(this,v.args);return this.stylesheet=t,!0}addImage(t,n){if(this.getImage(t))return this.fire(new o.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,l={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(o.validateStyle.source,`sources.${t}`,n,null,l))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const h=this.sourceCaches[t]=new Qt(t,n,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t})),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new o.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.sourceCaches[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new o.ErrorEvent(new Error(`Layer "${h}" already exists on this map.`)));let m;if(t.type==="custom"){if(Pn(this,o.validateCustomStyleLayer(t)))return;m=o.createStyleLayer(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=o.clone$1(t),t=o.extend(t,{source:h})),this._validate(o.validateStyle.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;m=o.createStyleLayer(t),this._validateLayer(m),m.setEventedParent(this,{layer:{id:h}})}const v=n?this._order.indexOf(n):this._order.length;if(n&&v===-1)this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${h}" before non-existing layer "${n}".`)));else{if(this._order.splice(v,0,h),this._layerOrderChanged=!0,this._layers[h]=m,this._removedLayers[h]&&m.source&&m.type!=="custom"){const x=this._removedLayers[h];delete this._removedLayers[h],x.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=n?this._order.indexOf(n):this._order.length;n&&h===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===n&&h.maxzoom===l||(n!=null&&(h.minzoom=n),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!o.deepEqual(h.filter,n))return n==null?(h.filter=void 0,void this._updateLayer(h)):void(this._validate(o.validateStyle.filter,`layers.${h.id}.filter`,n,null,l)||(h.filter=o.clone$1(n),this._updateLayer(h)))}else this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,n,l,h={}){this._checkLoaded();const m=this.getLayer(t);m?o.deepEqual(m.getLayoutProperty(n),l)||(m.setLayoutProperty(n,l,h),this._updateLayer(m)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const l=this.getLayer(t);if(l)return l.getLayoutProperty(n);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,l,h={}){this._checkLoaded();const m=this.getLayer(t);m?o.deepEqual(m.getPaintProperty(n),l)||(m.setPaintProperty(n,l,h)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const l=t.source,h=t.sourceLayer,m=this.sourceCaches[l];if(m===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)));const v=m.getSource().type;v==="geojson"&&h?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||h?(t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),m.setFeatureState(h,t.id,n)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const l=t.source,h=this.sourceCaches[l];if(h===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)));const m=h.getSource().type,v=m==="vector"?t.sourceLayer:void 0;m!=="vector"||v?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(v,t.id,n):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,l=t.sourceLayer,h=this.sourceCaches[n];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=o.mapObject(this.sourceCaches,h=>h.serialize()),n=this._serializeByIds(this._order),l=this.stylesheet;return o.filterObject({version:l.version,name:l.name,metadata:l.metadata,light:l.light,center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,sprite:l.sprite,glyphs:l.glyphs,transition:l.transition,sources:t,layers:n},h=>h!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=v=>this._layers[v].type==="fill-extrusion",l={},h=[];for(let v=this._order.length-1;v>=0;v--){const x=this._order[v];if(n(x)){l[x]=v;for(const E of t){const C=E[x];if(C)for(const I of C)h.push(I)}}}h.sort((v,x)=>x.intersectionZ-v.intersectionZ);const m=[];for(let v=this._order.length-1;v>=0;v--){const x=this._order[v];if(n(x))for(let E=h.length-1;E>=0;E--){const C=h[E].feature;if(l[C.layer.id]<v)break;m.push(C),h.pop()}else for(const E of t){const C=E[x];if(C)for(const I of C)m.push(I.feature)}}return m}queryRenderedFeatures(t,n,l){n&&n.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);const h={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const x of n.layers){const E=this._layers[x];if(!E)return this.fire(new o.ErrorEvent(new Error(`The layer '${x}' does not exist in the map's style and cannot be queried for features.`))),[];h[E.source]=!0}}const m=[];n.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const x in this.sourceCaches)n.layers&&!h[x]||m.push(Ct(this.sourceCaches[x],this._layers,v,t,n,l));return this.placement&&m.push(function(x,E,C,I,P,F,Z){const q={},H=F.queryRenderedSymbols(I),N=[];for(const re of Object.keys(H).map(Number))N.push(Z[re]);N.sort(Zn);for(const re of N){const ce=re.featureIndex.lookupSymbolFeatures(H[re.bucketInstanceId],E,re.bucketIndex,re.sourceLayerIndex,P.filter,P.layers,P.availableImages,x);for(const Y in ce){const ne=q[Y]=q[Y]||[],de=ce[Y];de.sort((pe,_e)=>{const Ee=re.featureSortOrder;if(Ee){const we=Ee.indexOf(pe.featureIndex);return Ee.indexOf(_e.featureIndex)-we}return _e.featureIndex-pe.featureIndex});for(const pe of de)ne.push(pe)}}for(const re in q)q[re].forEach(ce=>{const Y=ce.feature,ne=C[x[re].source].getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=ne});return q}(this._layers,v,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(t,n){n&&n.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);const l=this.sourceCaches[t];return l?function(h,m){const v=h.getRenderableIds().map(C=>h.getTileByID(C)),x=[],E={};for(let C=0;C<v.length;C++){const I=v[C],P=I.tileID.canonical.key;E[P]||(E[P]=!0,I.querySourceFeatures(x,m))}return x}(l,n):[]}addSourceType(t,n,l){return ms(t)?l(new Error(`A source type called "${t}" already exists.`)):(((h,m)=>{pn[h]=m})(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},l):l(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const v in t)if(!o.deepEqual(t[v],l[v])){h=!0;break}if(!h)return;const m={now:o.browser.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(m)}_validate(t,n,l,h,m={}){return(!m||m.validate!==!1)&&Pn(this,t.call(o.validateStyle,o.extend({key:n,style:this.serialize(),value:l,styleSpec:o.v8Spec},h)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const l=this.sourceCaches[n];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,l,h,m=!1){let v=!1,x=!1;const E={};for(const C of this._order){const I=this._layers[C];if(I.type!=="symbol")continue;if(!E[I.source]){const F=this.sourceCaches[I.source];E[I.source]=F.getRenderableIds(!0).map(Z=>F.getTileByID(Z)).sort((Z,q)=>q.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(q.tileID)?-1:1))}const P=this.crossTileSymbolIndex.addLayer(I,E[I.source],t.center.lng);v=v||P}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.browser.now(),t.zoom))&&(this.pauseablePlacement=new su(t,this.map.terrain,this._order,m,n,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.browser.now()),x=!0),v&&this.pauseablePlacement.placement.setStale()),x||v)for(const C of this._order){const I=this._layers[C];I.type==="symbol"&&this.placement.updateLayerOpacities(I,E[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.browser.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,l){this.imageManager.getImages(n.icons,l),this._updateTilesForChangedImages();const h=this.sourceCaches[n.source];h&&h.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,l){this.glyphManager.getGlyphs(n.stacks,l);const h=this.sourceCaches[n.source];h&&h.setDependencies(n.tileID.key,n.type,[""])}getResource(t,n,l){return o.makeRequest(n,l)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(o.validateStyle.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,l={},h){this._checkLoaded();const m=[{id:t,url:n}],v=[...xt(this.stylesheet.sprite),...m];this._validate(o.validateStyle.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(m,!0,h))}removeSprite(t){this._checkLoaded();const n=xt(this.stylesheet.sprite);if(n.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;n.splice(n.findIndex(l=>l.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}else this.fire(new o.ErrorEvent(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return xt(this.stylesheet.sprite)}setSprite(t,n={},l){this._checkLoaded(),t&&this._validate(o.validateStyle.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}}Ni.registerForPluginStateChange=o.registerForPluginStateChange;var To=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),sn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Us={prelude:Mt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Mt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Mt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Mt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Mt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Mt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Mt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Mt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Mt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Mt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Mt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Mt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Mt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Mt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Mt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Mt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Mt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Mt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Mt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Mt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Mt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",sn),terrainDepth:Mt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",sn),terrainCoords:Mt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",sn)};function Mt(d,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute ([\w]+) ([\w]+)/g),h=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=m?m.concat(h):h,x={};return{fragmentSource:d=d.replace(n,(E,C,I,P,F)=>(x[F]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${I} ${P} ${F};
#else
uniform ${I} ${P} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${I} ${P} ${F} = u_${F};
#endif
`)),vertexSource:t=t.replace(n,(E,C,I,P,F)=>{const Z=P==="float"?"vec2":"vec4",q=F.match(/color/)?"color":Z;return x[F]?C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${I} ${Z} a_${F};
varying ${I} ${P} ${F};
#else
uniform ${I} ${P} u_${F};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${I} ${P} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${q}(a_${F}, u_${F}_t);
#else
    ${I} ${P} ${F} = u_${F};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${I} ${Z} a_${F};
#else
uniform ${I} ${P} u_${F};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${I} ${P} ${F} = a_${F};
#else
    ${I} ${P} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${I} ${P} ${F} = unpack_mix_${q}(a_${F}, u_${F}_t);
#else
    ${I} ${P} ${F} = u_${F};
#endif
`}),staticAttributes:l,staticUniforms:v}}class So{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,l,h,m,v,x,E,C){this.context=t;let I=this.boundPaintVertexBuffers.length!==h.length;for(let P=0;!I&&P<h.length;P++)this.boundPaintVertexBuffers[P]!==h[P]&&(I=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==l||I||this.boundIndexBuffer!==m||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==x||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==C?this.freshBind(n,l,h,m,v,x,E,C):(t.bindVertexArray.set(this.vao),x&&x.bind(),m&&m.dynamicDraw&&m.bind(),E&&E.bind(),C&&C.bind())}freshBind(t,n,l,h,m,v,x,E){const C=t.numAttributes,I=this.context,P=I.gl;this.vao&&this.destroy(),this.vao=I.createVertexArray(),I.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=x,this.boundDynamicVertexBuffer3=E,n.enableAttributes(P,t);for(const F of l)F.enableAttributes(P,t);v&&v.enableAttributes(P,t),x&&x.enableAttributes(P,t),E&&E.enableAttributes(P,t),n.bind(),n.setVertexAttribPointers(P,t,m);for(const F of l)F.bind(),F.setVertexAttribPointers(P,t,m);v&&(v.bind(),v.setVertexAttribPointers(P,t,m)),h&&h.bind(),x&&(x.bind(),x.setVertexAttribPointers(P,t,m)),E&&(E.bind(),E.setVertexAttribPointers(P,t,m)),I.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function _s(d){const t=[];for(let n=0;n<d.length;n++){if(d[n]===null)continue;const l=d[n].split(" ");t.push(l.pop())}return t}class Ln{constructor(t,n,l,h,m,v){const x=t.gl;this.program=x.createProgram();const E=_s(n.staticAttributes),C=l?l.getBinderAttributes():[],I=E.concat(C),P=Us.prelude.staticUniforms?_s(Us.prelude.staticUniforms):[],F=n.staticUniforms?_s(n.staticUniforms):[],Z=l?l.getBinderUniforms():[],q=P.concat(F).concat(Z),H=[];for(const pe of q)H.indexOf(pe)<0&&H.push(pe);const N=l?l.defines():[];m&&N.push("#define OVERDRAW_INSPECTOR;"),v&&N.push("#define TERRAIN3D;");const re=N.concat(Us.prelude.fragmentSource,n.fragmentSource).join(`
`),ce=N.concat(Us.prelude.vertexSource,n.vertexSource).join(`
`),Y=x.createShader(x.FRAGMENT_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);if(x.shaderSource(Y,re),x.compileShader(Y),!x.getShaderParameter(Y,x.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${x.getShaderInfoLog(Y)}`);x.attachShader(this.program,Y);const ne=x.createShader(x.VERTEX_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);if(x.shaderSource(ne,ce),x.compileShader(ne),!x.getShaderParameter(ne,x.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${x.getShaderInfoLog(ne)}`);x.attachShader(this.program,ne),this.attributes={};const de={};this.numAttributes=I.length;for(let pe=0;pe<this.numAttributes;pe++)I[pe]&&(x.bindAttribLocation(this.program,pe,I[pe]),this.attributes[I[pe]]=pe);if(x.linkProgram(this.program),!x.getProgramParameter(this.program,x.LINK_STATUS))throw new Error(`Program failed to link: ${x.getProgramInfoLog(this.program)}`);x.deleteShader(ne),x.deleteShader(Y);for(let pe=0;pe<H.length;pe++){const _e=H[pe];if(_e&&!de[_e]){const Ee=x.getUniformLocation(this.program,_e);Ee&&(de[_e]=Ee)}}this.fixedUniforms=h(t,de),this.terrainUniforms=((pe,_e)=>({u_depth:new o.Uniform1i(pe,_e.u_depth),u_terrain:new o.Uniform1i(pe,_e.u_terrain),u_terrain_dim:new o.Uniform1f(pe,_e.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f(pe,_e.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f(pe,_e.u_terrain_unpack),u_terrain_exaggeration:new o.Uniform1f(pe,_e.u_terrain_exaggeration)}))(t,de),this.binderUniforms=l?l.getUniforms(t,de):[]}draw(t,n,l,h,m,v,x,E,C,I,P,F,Z,q,H,N,re,ce){const Y=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(m),t.setCullFace(v),E){t.activeTexture.set(Y.TEXTURE2),Y.bindTexture(Y.TEXTURE_2D,E.depthTexture),t.activeTexture.set(Y.TEXTURE3),Y.bindTexture(Y.TEXTURE_2D,E.texture);for(const de in this.terrainUniforms)this.terrainUniforms[de].set(E[de])}for(const de in this.fixedUniforms)this.fixedUniforms[de].set(x[de]);H&&H.setUniforms(t,this.binderUniforms,Z,{zoom:q});let ne=0;switch(n){case Y.LINES:ne=2;break;case Y.TRIANGLES:ne=3;break;case Y.LINE_STRIP:ne=1}for(const de of F.get()){const pe=de.vaos||(de.vaos={});(pe[C]||(pe[C]=new So)).bind(t,this,I,H?H.getPaintVertexBuffers():[],P,de.vertexOffset,N,re,ce),Y.drawElements(n,de.primitiveLength*ne,Y.UNSIGNED_SHORT,de.primitiveOffset*ne*2)}}}function Co(d,t,n){const l=1/te(n,1,t.transform.tileZoom),h=Math.pow(2,n.tileID.overscaledZ),m=n.tileSize*Math.pow(2,t.transform.tileZoom)/h,v=m*(n.tileID.canonical.x+n.tileID.wrap*h),x=m*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[l,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}const Vs=(d,t,n,l)=>{const h=t.style.light,m=h.properties.get("position"),v=[m.x,m.y,m.z],x=function(){var C=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();h.properties.get("anchor")==="viewport"&&function(C,I){var P=Math.sin(I),F=Math.cos(I);C[0]=F,C[1]=P,C[2]=0,C[3]=-P,C[4]=F,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(x,-t.transform.angle),function(C,I,P){var F=I[0],Z=I[1],q=I[2];C[0]=F*P[0]+Z*P[3]+q*P[6],C[1]=F*P[1]+Z*P[4]+q*P[7],C[2]=F*P[2]+Z*P[5]+q*P[8]}(v,v,x);const E=h.properties.get("color");return{u_matrix:d,u_lightpos:v,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+n,u_opacity:l}},ou=(d,t,n,l,h,m,v)=>o.extend(Vs(d,t,n,l),Co(m,t,v),{u_height_factor:-Math.pow(2,h.overscaledZ)/v.tileSize/8}),ql=d=>({u_matrix:d}),Io=(d,t,n,l)=>o.extend(ql(d),Co(n,t,l)),au=(d,t)=>({u_matrix:d,u_world:t}),Zl=(d,t,n,l,h)=>o.extend(Io(d,t,n,l),{u_world:h}),lu=(d,t,n,l)=>{const h=d.transform;let m,v;if(l.paint.get("circle-pitch-alignment")==="map"){const x=te(n,1,h.zoom);m=!0,v=[x,x]}else m=!1,v=h.pixelsToGLUnits;return{u_camera_to_center_distance:h.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(t.posMatrix,n,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+m,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:v}},$l=(d,t,n)=>{const l=te(n,1,t.zoom),h=Math.pow(2,t.zoom-n.tileID.overscaledZ),m=n.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:l,u_extrude_scale:[t.pixelsToGLUnits[0]/(l*h),t.pixelsToGLUnits[1]/(l*h)],u_overscale_factor:m}},Gl=(d,t,n=1)=>({u_matrix:d,u_color:t,u_overlay:0,u_overlay_scale:n}),Ao=d=>({u_matrix:d}),Hl=(d,t,n,l)=>({u_matrix:d,u_extrude_scale:te(t,1,n),u_intensity:l});function Wl(d,t){const n=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new o.MercatorCoordinate(0,l/n).toLngLat().lat,new o.MercatorCoordinate(0,(l+1)/n).toLngLat().lat]}const ko=(d,t,n,l)=>{const h=d.transform;return{u_matrix:Ns(d,t,n,l),u_ratio:1/te(t,1,h.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Xl=(d,t,n,l,h)=>o.extend(ko(d,t,n,h),{u_image:0,u_image_height:l}),Hn=(d,t,n,l,h)=>{const m=d.transform,v=_r(t,m);return{u_matrix:Ns(d,t,n,h),u_texsize:t.imageAtlasTexture.size,u_ratio:1/te(t,1,m.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Mo=(d,t,n,l,h,m)=>{const v=d.lineAtlas,x=_r(t,d.transform),E=n.layout.get("line-cap")==="round",C=v.getDash(l.from,E),I=v.getDash(l.to,E),P=C.width*h.fromScale,F=I.width*h.toScale;return o.extend(ko(d,t,n,m),{u_patternscale_a:[x/P,-C.height/2],u_patternscale_b:[x/F,-I.height/2],u_sdfgamma:v.width/(256*Math.min(P,F)*d.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:I.y,u_mix:h.t})};function _r(d,t){return 1/te(d,1,t.tileZoom)}function Ns(d,t,n,l){return d.translatePosMatrix(l?l.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Po=(d,t,n,l,h)=>{return{u_matrix:d,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(v=h.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(m=h.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:js(h.paint.get("raster-hue-rotate"))};var m,v};function js(d){d*=Math.PI/180;const t=Math.sin(d),n=Math.cos(d);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const qs=(d,t,n,l,h,m,v,x,E,C)=>{const I=h.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:I.cameraToCenterDistance,u_pitch:I.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:I.width/I.height,u_fade_change:h.options.fadeDuration?h.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:v,u_coord_matrix:x,u_is_text:+E,u_pitch_with_map:+l,u_texsize:C,u_texture:0}},Zs=(d,t,n,l,h,m,v,x,E,C,I)=>{const P=h.transform;return o.extend(qs(d,t,n,l,h,m,v,x,E,C),{u_gamma_scale:l?Math.cos(P._pitch)*P.cameraToCenterDistance:1,u_device_pixel_ratio:h.pixelRatio,u_is_halo:+I})},$s=(d,t,n,l,h,m,v,x,E,C)=>o.extend(Zs(d,t,n,l,h,m,v,x,!0,E,!0),{u_texsize_icon:C,u_texture_icon:1}),Wn=(d,t,n)=>({u_matrix:d,u_opacity:t,u_color:n}),Lo=(d,t,n,l,h,m)=>o.extend(function(v,x,E,C){const I=E.imageManager.getPattern(v.from.toString()),P=E.imageManager.getPattern(v.to.toString()),{width:F,height:Z}=E.imageManager.getPixelSize(),q=Math.pow(2,C.tileID.overscaledZ),H=C.tileSize*Math.pow(2,E.transform.tileZoom)/q,N=H*(C.tileID.canonical.x+C.tileID.wrap*q),re=H*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:P.tl,u_pattern_br_b:P.br,u_texsize:[F,Z],u_mix:x.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:P.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/te(C,1,E.transform.tileZoom),u_pixel_coord_upper:[N>>16,re>>16],u_pixel_coord_lower:[65535&N,65535&re]}}(l,m,n,h),{u_matrix:d,u_opacity:t}),yr={fillExtrusion:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_lightpos:new o.Uniform3f(d,t.u_lightpos),u_lightintensity:new o.Uniform1f(d,t.u_lightintensity),u_lightcolor:new o.Uniform3f(d,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(d,t.u_vertical_gradient),u_opacity:new o.Uniform1f(d,t.u_opacity)}),fillExtrusionPattern:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_lightpos:new o.Uniform3f(d,t.u_lightpos),u_lightintensity:new o.Uniform1f(d,t.u_lightintensity),u_lightcolor:new o.Uniform3f(d,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(d,t.u_vertical_gradient),u_height_factor:new o.Uniform1f(d,t.u_height_factor),u_image:new o.Uniform1i(d,t.u_image),u_texsize:new o.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,t.u_scale),u_fade:new o.Uniform1f(d,t.u_fade),u_opacity:new o.Uniform1f(d,t.u_opacity)}),fill:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix)}),fillPattern:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_image:new o.Uniform1i(d,t.u_image),u_texsize:new o.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,t.u_scale),u_fade:new o.Uniform1f(d,t.u_fade)}),fillOutline:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_world:new o.Uniform2f(d,t.u_world)}),fillOutlinePattern:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_world:new o.Uniform2f(d,t.u_world),u_image:new o.Uniform1i(d,t.u_image),u_texsize:new o.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,t.u_scale),u_fade:new o.Uniform1f(d,t.u_fade)}),circle:(d,t)=>({u_camera_to_center_distance:new o.Uniform1f(d,t.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(d,t.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(d,t.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(d,t.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(d,t.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(d,t.u_matrix)}),collisionBox:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_camera_to_center_distance:new o.Uniform1f(d,t.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(d,t.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(d,t.u_extrude_scale),u_overscale_factor:new o.Uniform1f(d,t.u_overscale_factor)}),collisionCircle:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_inv_matrix:new o.UniformMatrix4f(d,t.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(d,t.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(d,t.u_viewport_size)}),debug:(d,t)=>({u_color:new o.UniformColor(d,t.u_color),u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_overlay:new o.Uniform1i(d,t.u_overlay),u_overlay_scale:new o.Uniform1f(d,t.u_overlay_scale)}),clippingMask:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix)}),heatmap:(d,t)=>({u_extrude_scale:new o.Uniform1f(d,t.u_extrude_scale),u_intensity:new o.Uniform1f(d,t.u_intensity),u_matrix:new o.UniformMatrix4f(d,t.u_matrix)}),heatmapTexture:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_world:new o.Uniform2f(d,t.u_world),u_image:new o.Uniform1i(d,t.u_image),u_color_ramp:new o.Uniform1i(d,t.u_color_ramp),u_opacity:new o.Uniform1f(d,t.u_opacity)}),hillshade:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_image:new o.Uniform1i(d,t.u_image),u_latrange:new o.Uniform2f(d,t.u_latrange),u_light:new o.Uniform2f(d,t.u_light),u_shadow:new o.UniformColor(d,t.u_shadow),u_highlight:new o.UniformColor(d,t.u_highlight),u_accent:new o.UniformColor(d,t.u_accent)}),hillshadePrepare:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_image:new o.Uniform1i(d,t.u_image),u_dimension:new o.Uniform2f(d,t.u_dimension),u_zoom:new o.Uniform1f(d,t.u_zoom),u_unpack:new o.Uniform4f(d,t.u_unpack)}),line:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_ratio:new o.Uniform1f(d,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,t.u_units_to_pixels)}),lineGradient:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_ratio:new o.Uniform1f(d,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,t.u_units_to_pixels),u_image:new o.Uniform1i(d,t.u_image),u_image_height:new o.Uniform1f(d,t.u_image_height)}),linePattern:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_texsize:new o.Uniform2f(d,t.u_texsize),u_ratio:new o.Uniform1f(d,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,t.u_device_pixel_ratio),u_image:new o.Uniform1i(d,t.u_image),u_units_to_pixels:new o.Uniform2f(d,t.u_units_to_pixels),u_scale:new o.Uniform3f(d,t.u_scale),u_fade:new o.Uniform1f(d,t.u_fade)}),lineSDF:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_ratio:new o.Uniform1f(d,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,t.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(d,t.u_patternscale_a),u_patternscale_b:new o.Uniform2f(d,t.u_patternscale_b),u_sdfgamma:new o.Uniform1f(d,t.u_sdfgamma),u_image:new o.Uniform1i(d,t.u_image),u_tex_y_a:new o.Uniform1f(d,t.u_tex_y_a),u_tex_y_b:new o.Uniform1f(d,t.u_tex_y_b),u_mix:new o.Uniform1f(d,t.u_mix)}),raster:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_tl_parent:new o.Uniform2f(d,t.u_tl_parent),u_scale_parent:new o.Uniform1f(d,t.u_scale_parent),u_buffer_scale:new o.Uniform1f(d,t.u_buffer_scale),u_fade_t:new o.Uniform1f(d,t.u_fade_t),u_opacity:new o.Uniform1f(d,t.u_opacity),u_image0:new o.Uniform1i(d,t.u_image0),u_image1:new o.Uniform1i(d,t.u_image1),u_brightness_low:new o.Uniform1f(d,t.u_brightness_low),u_brightness_high:new o.Uniform1f(d,t.u_brightness_high),u_saturation_factor:new o.Uniform1f(d,t.u_saturation_factor),u_contrast_factor:new o.Uniform1f(d,t.u_contrast_factor),u_spin_weights:new o.Uniform3f(d,t.u_spin_weights)}),symbolIcon:(d,t)=>({u_is_size_zoom_constant:new o.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,t.u_size_t),u_size:new o.Uniform1f(d,t.u_size),u_camera_to_center_distance:new o.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,t.u_pitch),u_rotate_symbol:new o.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,t.u_fade_change),u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new o.Uniform1i(d,t.u_is_text),u_pitch_with_map:new o.Uniform1i(d,t.u_pitch_with_map),u_texsize:new o.Uniform2f(d,t.u_texsize),u_texture:new o.Uniform1i(d,t.u_texture)}),symbolSDF:(d,t)=>({u_is_size_zoom_constant:new o.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,t.u_size_t),u_size:new o.Uniform1f(d,t.u_size),u_camera_to_center_distance:new o.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,t.u_pitch),u_rotate_symbol:new o.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,t.u_fade_change),u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new o.Uniform1i(d,t.u_is_text),u_pitch_with_map:new o.Uniform1i(d,t.u_pitch_with_map),u_texsize:new o.Uniform2f(d,t.u_texsize),u_texture:new o.Uniform1i(d,t.u_texture),u_gamma_scale:new o.Uniform1f(d,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(d,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(d,t.u_is_halo)}),symbolTextAndIcon:(d,t)=>({u_is_size_zoom_constant:new o.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,t.u_size_t),u_size:new o.Uniform1f(d,t.u_size),u_camera_to_center_distance:new o.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,t.u_pitch),u_rotate_symbol:new o.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,t.u_fade_change),u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new o.Uniform1i(d,t.u_is_text),u_pitch_with_map:new o.Uniform1i(d,t.u_pitch_with_map),u_texsize:new o.Uniform2f(d,t.u_texsize),u_texsize_icon:new o.Uniform2f(d,t.u_texsize_icon),u_texture:new o.Uniform1i(d,t.u_texture),u_texture_icon:new o.Uniform1i(d,t.u_texture_icon),u_gamma_scale:new o.Uniform1f(d,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(d,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(d,t.u_is_halo)}),background:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_opacity:new o.Uniform1f(d,t.u_opacity),u_color:new o.UniformColor(d,t.u_color)}),backgroundPattern:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_opacity:new o.Uniform1f(d,t.u_opacity),u_image:new o.Uniform1i(d,t.u_image),u_pattern_tl_a:new o.Uniform2f(d,t.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(d,t.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(d,t.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(d,t.u_pattern_br_b),u_texsize:new o.Uniform2f(d,t.u_texsize),u_mix:new o.Uniform1f(d,t.u_mix),u_pattern_size_a:new o.Uniform2f(d,t.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(d,t.u_pattern_size_b),u_scale_a:new o.Uniform1f(d,t.u_scale_a),u_scale_b:new o.Uniform1f(d,t.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(d,t.u_tile_units_to_pixels)}),terrain:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_texture:new o.Uniform1i(d,t.u_texture),u_ele_delta:new o.Uniform1f(d,t.u_ele_delta)}),terrainDepth:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_ele_delta:new o.Uniform1f(d,t.u_ele_delta)}),terrainCoords:(d,t)=>({u_matrix:new o.UniformMatrix4f(d,t.u_matrix),u_texture:new o.Uniform1i(d,t.u_texture),u_terrain_coords_id:new o.Uniform1f(d,t.u_terrain_coords_id),u_ele_delta:new o.Uniform1f(d,t.u_ele_delta)})};class vr{constructor(t,n,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const La={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zo{constructor(t,n,l,h){this.length=n.length,this.attributes=l,this.itemSize=n.bytesPerElement,this.dynamicDraw=h,this.context=t;const m=t.gl;this.buffer=m.createBuffer(),t.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let l=0;l<this.attributes.length;l++){const h=n.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,n,l){for(let h=0;h<this.attributes.length;h++){const m=this.attributes[h],v=n.attributes[m.name];v!==void 0&&t.vertexAttribPointer(v,m.components,t[La[m.type]],!1,this.itemSize,m.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ys=new WeakMap;function vs(d){if(ys.has(d))return ys.get(d);{const t=d.getParameter(d.VERSION).startsWith("WebGL 2.0");return ys.set(d,t),t}}class Tt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Do extends Tt{getDefault(){return o.Color.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class za extends Tt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Da extends Tt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Bo extends Tt{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Kl extends Tt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Yl extends Tt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class xs extends Tt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class cu extends Tt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class uu extends Tt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class hu extends Tt{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class du extends Tt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class pu extends Tt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class fu extends Tt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Ba extends Tt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ro extends Tt{getDefault(){return o.Color.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ra extends Tt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Fa extends Tt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class bs extends Tt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Jl extends Tt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ql extends Tt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Oa extends Tt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Xn extends Tt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ec extends Tt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ws extends Tt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Es extends Tt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class tc extends Tt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ua extends Tt{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class It extends Tt{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const l=this.gl;vs(l)?l.bindVertexArray(t):(n=l.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Fo extends Tt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class mu extends Tt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ic extends Tt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Kn extends Tt{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class gu extends Kn{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _u extends Kn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class rc extends Kn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class yu{constructor(t,n,l,h,m){this.context=t,this.width=n,this.height=l;const v=t.gl,x=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new gu(t,x),h)this.depthAttachment=m?new rc(t,x):new _u(t,x);else if(m)throw new Error("Stencil cannot be setted without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class ei{constructor(t,n,l){this.blendFunction=t,this.blendColor=n,this.mask=l}}ei.Replace=[1,0],ei.disabled=new ei(ei.Replace,o.Color.transparent,[!1,!1,!1,!1]),ei.unblended=new ei(ei.Replace,o.Color.transparent,[!0,!0,!0,!0]),ei.alphaBlended=new ei([1,771],o.Color.transparent,[!0,!0,!0,!0]);class Oo{constructor(t){var n,l;if(this.gl=t,this.clearColor=new Do(this),this.clearDepth=new za(this),this.clearStencil=new Da(this),this.colorMask=new Bo(this),this.depthMask=new Kl(this),this.stencilMask=new Yl(this),this.stencilFunc=new xs(this),this.stencilOp=new cu(this),this.stencilTest=new uu(this),this.depthRange=new hu(this),this.depthTest=new du(this),this.depthFunc=new pu(this),this.blend=new fu(this),this.blendFunc=new Ba(this),this.blendColor=new Ro(this),this.blendEquation=new Ra(this),this.cullFace=new Fa(this),this.cullFaceSide=new bs(this),this.frontFace=new Jl(this),this.program=new Ql(this),this.activeTexture=new Oa(this),this.viewport=new Xn(this),this.bindFramebuffer=new ec(this),this.bindRenderbuffer=new ws(this),this.bindTexture=new Es(this),this.bindVertexBuffer=new tc(this),this.bindElementBuffer=new Ua(this),this.bindVertexArray=new It(this),this.pixelStoreUnpack=new Fo(this),this.pixelStoreUnpackPremultiplyAlpha=new mu(this),this.pixelStoreUnpackFlipY=new ic(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),vs(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:h==null?void 0:h.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h==null?void 0:h.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h==null?void 0:h.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new vr(this,t,n)}createVertexBuffer(t,n,l){return new zo(this,t,n,l)}createRenderbuffer(t,n,l){const h=this.gl,m=h.createRenderbuffer();return this.bindRenderbuffer.set(m),h.renderbufferStorage(h.RENDERBUFFER,t,n,l),this.bindRenderbuffer.set(null),m}createFramebuffer(t,n,l,h){return new yu(this,t,n,l,h)}clear({color:t,depth:n,stencil:l}){const h=this.gl;let m=0;t&&(m|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(m|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),l!==void 0&&(m|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(m)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.deepEqual(t.blendFunction,ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return vs(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return vs(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class vt{constructor(t,n,l){this.func=t,this.mask=n,this.range=l}}vt.ReadOnly=!1,vt.ReadWrite=!0,vt.disabled=new vt(519,vt.ReadOnly,[0,1]);const Gs=7680;class Ut{constructor(t,n,l,h,m,v){this.test=t,this.ref=n,this.mask=l,this.fail=h,this.depthFail=m,this.pass=v}}Ut.disabled=new Ut({func:519,mask:0},0,0,Gs,Gs,Gs);class Vt{constructor(t,n,l){this.enable=t,this.mode=n,this.frontFace=l}}let Yn;function Hs(d,t,n,l,h,m,v){const x=d.context,E=x.gl,C=d.useProgram("collisionBox"),I=[];let P=0,F=0;for(let Y=0;Y<l.length;Y++){const ne=l[Y],de=t.getTile(ne),pe=de.getBucket(n);if(!pe)continue;let _e=ne.posMatrix;h[0]===0&&h[1]===0||(_e=d.translatePosMatrix(ne.posMatrix,de,h,m));const Ee=v?pe.textCollisionBox:pe.iconCollisionBox,we=pe.collisionCircleArray;if(we.length>0){const Ie=o.create(),$e=_e;o.mul(Ie,pe.placementInvProjMatrix,d.transform.glCoordMatrix),o.mul(Ie,Ie,pe.placementViewportMatrix),I.push({circleArray:we,circleOffset:F,transform:$e,invTransform:Ie,coord:ne}),P+=we.length/4,F=P}Ee&&C.draw(x,E.LINES,vt.disabled,Ut.disabled,d.colorModeForRenderPass(),Vt.disabled,$l(_e,d.transform,de),d.style.map.terrain&&d.style.map.terrain.getTerrainData(ne),n.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,d.transform.zoom,null,null,Ee.collisionVertexBuffer)}if(!v||!I.length)return;const Z=d.useProgram("collisionCircle"),q=new o.CollisionCircleLayoutArray;q.resize(4*P),q._trim();let H=0;for(const Y of I)for(let ne=0;ne<Y.circleArray.length/4;ne++){const de=4*ne,pe=Y.circleArray[de+0],_e=Y.circleArray[de+1],Ee=Y.circleArray[de+2],we=Y.circleArray[de+3];q.emplace(H++,pe,_e,Ee,we,0),q.emplace(H++,pe,_e,Ee,we,1),q.emplace(H++,pe,_e,Ee,we,2),q.emplace(H++,pe,_e,Ee,we,3)}(!Yn||Yn.length<2*P)&&(Yn=function(Y){const ne=2*Y,de=new o.QuadTriangleArray;de.resize(ne),de._trim();for(let pe=0;pe<ne;pe++){const _e=6*pe;de.uint16[_e+0]=4*pe+0,de.uint16[_e+1]=4*pe+1,de.uint16[_e+2]=4*pe+2,de.uint16[_e+3]=4*pe+2,de.uint16[_e+4]=4*pe+3,de.uint16[_e+5]=4*pe+0}return de}(P));const N=x.createIndexBuffer(Yn,!0),re=x.createVertexBuffer(q,o.collisionCircleLayout.members,!0);for(const Y of I){const ne={u_matrix:Y.transform,u_inv_matrix:Y.invTransform,u_camera_to_center_distance:(ce=d.transform).cameraToCenterDistance,u_viewport_size:[ce.width,ce.height]};Z.draw(x,E.TRIANGLES,vt.disabled,Ut.disabled,d.colorModeForRenderPass(),Vt.disabled,ne,d.style.map.terrain&&d.style.map.terrain.getTerrainData(Y.coord),n.id,re,N,o.SegmentVector.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,d.transform.zoom,null,null,null)}var ce;re.destroy(),N.destroy()}Vt.disabled=new Vt(!1,1029,2305),Vt.backCCW=new Vt(!0,1029,2305);const Va=o.identity(new Float32Array(16));function vu(d,t,n,l,h,m){const{horizontalAlign:v,verticalAlign:x}=o.getAnchorAlignment(d);return new o.Point((-(v-.5)*t/h+l[0])*m,(-(x-.5)*n/h+l[1])*m)}function Na(d,t,n,l,h,m,v,x,E,C,I){const P=d.text.placedSymbolArray,F=d.text.dynamicLayoutVertexArray,Z=d.icon.dynamicLayoutVertexArray,q={};F.clear();for(let H=0;H<P.length;H++){const N=P.get(H),re=N.hidden||!N.crossTileID||d.allowVerticalPlacement&&!N.placedOrientation?null:l[N.crossTileID];if(re){const ce=new o.Point(N.anchorX,N.anchorY),Y=it(ce,n?v:m,I),ne=tn(h.cameraToCenterDistance,Y.signedDistanceFromCamera);let de=o.evaluateSizeForFeature(d.textSizeData,E,N)*ne/o.ONE_EM;n&&(de*=d.tilePixelRatio/x);const{width:pe,height:_e,anchor:Ee,textOffset:we,textBoxScale:Ie}=re,$e=vu(Ee,pe,_e,we,Ie,de),ft=n?it(ce.add($e),m,I).point:Y.point.add(t?$e.rotate(-h.angle):$e),Le=d.allowVerticalPlacement&&N.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Ke=0;Ke<N.numGlyphs;Ke++)o.addDynamicAttributes(F,ft,Le);C&&N.associatedIconIndex>=0&&(q[N.associatedIconIndex]={shiftedAnchor:ft,angle:Le})}else V(N.numGlyphs,F)}if(C){Z.clear();const H=d.icon.placedSymbolArray;for(let N=0;N<H.length;N++){const re=H.get(N);if(re.hidden)V(re.numGlyphs,Z);else{const ce=q[N];if(ce)for(let Y=0;Y<re.numGlyphs;Y++)o.addDynamicAttributes(Z,ce.shiftedAnchor,ce.angle);else V(re.numGlyphs,Z)}}d.icon.dynamicLayoutVertexBuffer.updateData(Z)}d.text.dynamicLayoutVertexBuffer.updateData(F)}function xu(d,t,n){return n.iconsInText&&t?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function ja(d,t,n,l,h,m,v,x,E,C,I,P){const F=d.context,Z=F.gl,q=d.transform,H=x==="map",N=E==="map",re=x!=="viewport"&&n.layout.get("symbol-placement")!=="point",ce=H&&!N&&!re,Y=!n.layout.get("symbol-sort-key").isConstant();let ne=!1;const de=d.depthModeForSublayer(0,vt.ReadOnly),pe=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),_e=[];for(const Ee of l){const we=t.getTile(Ee),Ie=we.getBucket(n);if(!Ie)continue;const $e=h?Ie.text:Ie.icon;if(!$e||!$e.segments.get().length||!$e.hasVisibleVertices)continue;const ft=$e.programConfigurations.get(n.id),Le=h||Ie.sdfIcons,Ke=h?Ie.textSizeData:Ie.iconSizeData,qe=N||q.pitch!==0,Ht=d.useProgram(xu(Le,h,Ie),ft),mt=o.evaluateSizeForZoom(Ke,q.zoom),Ye=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Ee);let gt,Kt,Pt,br,Ri=[0,0],ii=null;if(h)Kt=we.glyphAtlasTexture,Pt=Z.LINEAR,gt=we.glyphAtlasTexture.size,Ie.iconsInText&&(Ri=we.imageAtlasTexture.size,ii=we.imageAtlasTexture,br=qe||d.options.rotating||d.options.zooming||Ke.kind==="composite"||Ke.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const ki=n.layout.get("icon-size").constantOr(0)!==1||Ie.iconsNeedLinear;Kt=we.imageAtlasTexture,Pt=Le||d.options.rotating||d.options.zooming||ki||qe?Z.LINEAR:Z.NEAREST,gt=we.imageAtlasTexture.size}const sr=te(we,1,d.transform.zoom),ln=Ui(Ee.posMatrix,N,H,d.transform,sr),jr=mn(Ee.posMatrix,N,H,d.transform,sr),cn=pe&&Ie.hasTextData(),Is=n.layout.get("icon-text-fit")!=="none"&&cn&&Ie.hasIconData();if(re){const ki=d.style.map.terrain?(qi,Yt)=>d.style.map.terrain.getElevation(Ee,qi,Yt):null,wi=n.layout.get("text-rotation-alignment")==="map";kn(Ie,Ee.posMatrix,d,h,ln,jr,N,C,wi,ki)}const Bn=d.translatePosMatrix(Ee.posMatrix,we,m,v),yn=re||h&&pe||Is?Va:ln,di=d.translatePosMatrix(jr,we,m,v,!0),Ai=Le&&n.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ji;ji=Le?Ie.iconsInText?$s(Ke.kind,mt,ce,N,d,Bn,yn,di,gt,Ri):Zs(Ke.kind,mt,ce,N,d,Bn,yn,di,h,gt,!0):qs(Ke.kind,mt,ce,N,d,Bn,yn,di,h,gt);const As={program:Ht,buffers:$e,uniformValues:ji,atlasTexture:Kt,atlasTextureIcon:ii,atlasInterpolation:Pt,atlasInterpolationIcon:br,isSDF:Le,hasHalo:Ai};if(Y&&Ie.canOverlap){ne=!0;const ki=$e.segments.get();for(const wi of ki)_e.push({segments:new o.SegmentVector([wi]),sortKey:wi.sortKey,state:As,terrainData:Ye})}else _e.push({segments:$e.segments,sortKey:0,state:As,terrainData:Ye})}ne&&_e.sort((Ee,we)=>Ee.sortKey-we.sortKey);for(const Ee of _e){const we=Ee.state;if(F.activeTexture.set(Z.TEXTURE0),we.atlasTexture.bind(we.atlasInterpolation,Z.CLAMP_TO_EDGE),we.atlasTextureIcon&&(F.activeTexture.set(Z.TEXTURE1),we.atlasTextureIcon&&we.atlasTextureIcon.bind(we.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),we.isSDF){const Ie=we.uniformValues;we.hasHalo&&(Ie.u_is_halo=1,Ws(we.buffers,Ee.segments,n,d,we.program,de,I,P,Ie,Ee.terrainData)),Ie.u_is_halo=0}Ws(we.buffers,Ee.segments,n,d,we.program,de,I,P,we.uniformValues,Ee.terrainData)}}function Ws(d,t,n,l,h,m,v,x,E,C){const I=l.context;h.draw(I,I.gl.TRIANGLES,m,v,x,Vt.disabled,E,C,n.id,d.layoutVertexBuffer,d.indexBuffer,t,n.paint,l.transform.zoom,d.programConfigurations.get(n.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Uo(d,t,n,l,h){if(!n||!l||!l.imageAtlas)return;const m=l.imageAtlas.patternPositions;let v=m[n.to.toString()],x=m[n.from.toString()];if(!v||!x){const E=h.getPaintProperty(t);v=m[E],x=m[E]}v&&x&&d.setConstantPatternPositions(v,x)}function qa(d,t,n,l,h,m,v){const x=d.context.gl,E="fill-pattern",C=n.paint.get(E),I=C&&C.constantOr(1),P=n.getCrossfadeParameters();let F,Z,q,H,N;v?(Z=I&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=x.LINES):(Z=I?"fillPattern":"fill",F=x.TRIANGLES);const re=C.constantOr(null);for(const ce of l){const Y=t.getTile(ce);if(I&&!Y.patternsLoaded())continue;const ne=Y.getBucket(n);if(!ne)continue;const de=ne.programConfigurations.get(n.id),pe=d.useProgram(Z,de),_e=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ce);I&&(d.context.activeTexture.set(x.TEXTURE0),Y.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),de.updatePaintBuffers(P)),Uo(de,E,re,Y,n);const Ee=_e?ce:null,we=d.translatePosMatrix(Ee?Ee.posMatrix:ce.posMatrix,Y,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(v){H=ne.indexBuffer2,N=ne.segments2;const Ie=[x.drawingBufferWidth,x.drawingBufferHeight];q=Z==="fillOutlinePattern"&&I?Zl(we,d,P,Y,Ie):au(we,Ie)}else H=ne.indexBuffer,N=ne.segments,q=I?Io(we,d,P,Y):ql(we);pe.draw(d.context,F,h,d.stencilModeForClipping(ce),m,Vt.disabled,q,_e,n.id,ne.layoutVertexBuffer,H,N,n.paint,d.transform.zoom,de)}}function Vo(d,t,n,l,h,m,v){const x=d.context,E=x.gl,C="fill-extrusion-pattern",I=n.paint.get(C),P=I.constantOr(1),F=n.getCrossfadeParameters(),Z=n.paint.get("fill-extrusion-opacity"),q=I.constantOr(null);for(const H of l){const N=t.getTile(H),re=N.getBucket(n);if(!re)continue;const ce=d.style.map.terrain&&d.style.map.terrain.getTerrainData(H),Y=re.programConfigurations.get(n.id),ne=d.useProgram(P?"fillExtrusionPattern":"fillExtrusion",Y);P&&(d.context.activeTexture.set(E.TEXTURE0),N.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Y.updatePaintBuffers(F)),Uo(Y,C,q,N,n);const de=d.translatePosMatrix(H.posMatrix,N,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),pe=n.paint.get("fill-extrusion-vertical-gradient"),_e=P?ou(de,d,pe,Z,H,F,N):Vs(de,d,pe,Z);ne.draw(x,x.gl.TRIANGLES,h,m,v,Vt.backCCW,_e,ce,n.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,n.paint,d.transform.zoom,Y,d.style.map.terrain&&re.centroidVertexBuffer)}}function No(d,t,n,l,h,m,v){const x=d.context,E=x.gl,C=n.fbo;if(!C)return;const I=d.useProgram("hillshade"),P=d.style.map.terrain&&d.style.map.terrain.getTerrainData(t);x.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get()),I.draw(x,E.TRIANGLES,h,m,v,Vt.disabled,((F,Z,q,H)=>{const N=q.paint.get("hillshade-shadow-color"),re=q.paint.get("hillshade-highlight-color"),ce=q.paint.get("hillshade-accent-color");let Y=q.paint.get("hillshade-illumination-direction")*(Math.PI/180);q.paint.get("hillshade-illumination-anchor")==="viewport"&&(Y-=F.transform.angle);const ne=!F.options.moving;return{u_matrix:H?H.posMatrix:F.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),ne),u_image:0,u_latrange:Wl(0,Z.tileID),u_light:[q.paint.get("hillshade-exaggeration"),Y],u_shadow:N,u_highlight:re,u_accent:ce}})(d,n,l,P?t:null),P,l.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function Za(d,t,n,l,h,m){const v=d.context,x=v.gl,E=t.dem;if(E&&E.data){const C=E.dim,I=E.stride,P=E.getPixels();if(v.activeTexture.set(x.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(I),t.demTexture){const Z=t.demTexture;Z.update(P,{premultiply:!1}),Z.bind(x.NEAREST,x.CLAMP_TO_EDGE)}else t.demTexture=new tt(v,P,x.RGBA,{premultiply:!1}),t.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);v.activeTexture.set(x.TEXTURE0);let F=t.fbo;if(!F){const Z=new tt(v,{width:C,height:C,data:null},x.RGBA);Z.bind(x.LINEAR,x.CLAMP_TO_EDGE),F=t.fbo=v.createFramebuffer(C,C,!0,!1),F.colorAttachment.set(Z.texture)}v.bindFramebuffer.set(F.framebuffer),v.viewport.set([0,0,C,C]),d.useProgram("hillshadePrepare").draw(v,x.TRIANGLES,l,h,m,Vt.disabled,((Z,q)=>{const H=q.stride,N=o.create();return o.ortho(N,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(N,N,[0,-o.EXTENT,0]),{u_matrix:N,u_image:1,u_dimension:[H,H],u_zoom:Z.overscaledZ,u_unpack:q.getUnpackVector()}})(t.tileID,E),null,n.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function bu(d,t,n,l,h,m){const v=l.paint.get("raster-fade-duration");if(!m&&v>0){const x=o.browser.now(),E=(x-d.timeAdded)/v,C=t?(x-t.timeAdded)/v:-1,I=n.getSource(),P=h.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),F=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(d.tileID.overscaledZ-P),Z=F&&d.refreshedUponExpiration?1:o.clamp(F?E:1-C,0,1);return d.refreshedUponExpiration&&E>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const nc=new o.Color(1,0,0,1),ui=new o.Color(0,1,0,1),Jn=new o.Color(0,0,1,1),Pr=new o.Color(1,0,1,1),$a=new o.Color(0,1,1,1);function jo(d,t,n,l){gn(d,0,t+n/2,d.transform.width,n,l)}function Ga(d,t,n,l){gn(d,t-n/2,0,n,d.transform.height,l)}function gn(d,t,n,l,h,m){const v=d.context,x=v.gl;x.enable(x.SCISSOR_TEST),x.scissor(t*d.pixelRatio,n*d.pixelRatio,l*d.pixelRatio,h*d.pixelRatio),v.clear({color:m}),x.disable(x.SCISSOR_TEST)}function Xs(d,t,n){const l=d.context,h=l.gl,m=n.posMatrix,v=d.useProgram("debug"),x=vt.disabled,E=Ut.disabled,C=d.colorModeForRenderPass(),I="$debug",P=d.style.map.terrain&&d.style.map.terrain.getTerrainData(n);l.activeTexture.set(h.TEXTURE0);const F=t.getTileByID(n.key).latestRawTileData,Z=Math.floor((F&&F.byteLength||0)/1024),q=t.getTile(n).tileSize,H=512/Math.min(q,512)*(n.overscaledZ/d.transform.zoom)*.5;let N=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(N+=` => ${n.overscaledZ}`),function(re,ce){re.initDebugOverlayCanvas();const Y=re.debugOverlayCanvas,ne=re.context.gl,de=re.debugOverlayCanvas.getContext("2d");de.clearRect(0,0,Y.width,Y.height),de.shadowColor="white",de.shadowBlur=2,de.lineWidth=1.5,de.strokeStyle="white",de.textBaseline="top",de.font="bold 36px Open Sans, sans-serif",de.fillText(ce,5,5),de.strokeText(ce,5,5),re.debugOverlayTexture.update(Y),re.debugOverlayTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE)}(d,`${N} ${Z}kB`),v.draw(l,h.TRIANGLES,x,E,ei.alphaBlended,Vt.disabled,Gl(m,o.Color.transparent,H),null,I,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),v.draw(l,h.LINE_STRIP,x,E,C,Vt.disabled,Gl(m,o.Color.red),P,I,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function qo(d,t,n){const l=d.context,h=l.gl,m=d.colorModeForRenderPass(),v=new vt(h.LEQUAL,vt.ReadWrite,d.depthRangeFor3D),x=d.useProgram("terrain"),E=t.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,d.width,d.height]);for(const C of n){const I=d.renderToTexture.getTexture(C),P=t.getTerrainData(C.tileID);l.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,I.texture);const F={u_matrix:d.transform.calculatePosMatrix(C.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(d.transform.zoom)};x.draw(l,h.TRIANGLES,v,Ut.disabled,m,Vt.backCCW,F,P,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class sc{constructor(t,n){this.context=new Oo(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.create(),renderTime:0},this.setup(),this.numSublayers=Qt.maxUnderzooming+Qt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new li}resize(t,n,l){if(this.width=Math.floor(t*l),this.height=Math.floor(n*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,n=new o.PosArray;n.emplaceBack(0,0),n.emplaceBack(o.EXTENT,0),n.emplaceBack(0,o.EXTENT),n.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(n,To.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const l=new o.PosArray;l.emplaceBack(0,0),l.emplaceBack(o.EXTENT,0),l.emplaceBack(0,o.EXTENT),l.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=t.createVertexBuffer(l,To.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const h=new o.RasterBoundsArray;h.emplaceBack(0,0,0,0),h.emplaceBack(o.EXTENT,0,o.EXTENT,0),h.emplaceBack(0,o.EXTENT,0,o.EXTENT),h.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(h,Ki.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const m=new o.PosArray;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,To.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const v=new o.LineStripIndexArray;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(v);const x=new o.TriangleIndexArray;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const E=this.context.gl;this.stencilClearMode=new Ut({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=o.create();o.ortho(l,0,this.width,this.height,0,0,1),o.scale(l,l,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,vt.disabled,this.stencilClearMode,ei.disabled,Vt.disabled,Ao(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const l=this.context,h=l.gl;this.nextStencilID+n.length>256&&this.clearStencil(),l.setColorMode(ei.disabled),l.setDepthMode(vt.disabled);const m=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of n){const x=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);m.draw(l,h.TRIANGLES,vt.disabled,new Ut({func:h.ALWAYS,mask:0},x,255,h.KEEP,h.KEEP,h.REPLACE),ei.disabled,Vt.disabled,Ao(v.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Ut({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Ut({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,l=t.sort((v,x)=>x.overscaledZ-v.overscaledZ),h=l[l.length-1].overscaledZ,m=l[0].overscaledZ-h+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const v={};for(let x=0;x<m;x++)v[x+h]=new Ut({func:n.GEQUAL,mask:255},x+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=m,[v,l]}return[{[h]:Ut.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ei([t.CONSTANT_COLOR,t.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ei.unblended:ei.alphaBlended}depthModeForSublayer(t,n,l){if(!this.opaquePassEnabledForLayer())return vt.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new vt(l||this.context.gl.LEQUAL,n,[h,h])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.browser.now()),this.imageManager.beginFrame();const l=this.style._order,h=this.style.sourceCaches,m={},v={},x={};for(const E in h){const C=h[E];C.used&&C.prepare(this.context),m[E]=C.getVisibleCoordinates(),v[E]=m[E].slice().reverse(),x[E]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<l.length;E++)if(this.style._layers[l[E]].is3D()){this.opaquePassCutoff=E;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const E=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||E.length)&&(o.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(C,I){const P=C.context,F=P.gl,Z=ei.unblended,q=new vt(F.LEQUAL,vt.ReadWrite,[0,1]),H=I.getTerrainMesh(),N=I.sourceCache.getRenderableTiles(),re=C.useProgram("terrainDepth");P.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),P.clear({color:o.Color.transparent,depth:1});for(const ce of N){const Y=I.getTerrainData(ce.tileID),ne={u_matrix:C.transform.calculatePosMatrix(ce.tileID.toUnwrapped()),u_ele_delta:I.getMeshFrameDelta(C.transform.zoom)};re.draw(P,F.TRIANGLES,q,Ut.disabled,Z,Vt.backCCW,ne,Y,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain),function(C,I){const P=C.context,F=P.gl,Z=ei.unblended,q=new vt(F.LEQUAL,vt.ReadWrite,[0,1]),H=I.getTerrainMesh(),N=I.getCoordsTexture(),re=I.sourceCache.getRenderableTiles(),ce=C.useProgram("terrainCoords");P.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),P.clear({color:o.Color.transparent,depth:1}),I.coordsIndex=[];for(const Y of re){const ne=I.getTerrainData(Y.tileID);P.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,N.texture);const de={u_matrix:C.transform.calculatePosMatrix(Y.tileID.toUnwrapped()),u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(C.transform.zoom)};ce.draw(P,F.TRIANGLES,q,Ut.disabled,Z,Vt.backCCW,de,ne,"terrain",H.vertexBuffer,H.indexBuffer,H.segments),I.coordsIndex.push(Y.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const E of l){const C=this.style._layers[E];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const I=v[C.source];(C.type==="custom"||I.length)&&this.renderLayer(this,h[C.source],C,I)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[l[this.currentLayer]],C=h[E.source],I=m[E.source];this._renderTileClippingMasks(E,I),this.renderLayer(this,C,E,I)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const E=this.style._layers[l[this.currentLayer]],C=h[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;const I=(E.type==="symbol"?x:v)[E.source];this._renderTileClippingMasks(E,m[E.source]),this.renderLayer(this,C,E,I)}if(this.options.showTileBoundaries){const E=function(C,I){let P=null;const F=Object.values(C._layers).flatMap(N=>N.source&&!N.isHidden(I)?[C.sourceCaches[N.source]]:[]),Z=F.filter(N=>N.getSource().type==="vector"),q=F.filter(N=>N.getSource().type!=="vector"),H=N=>{(!P||P.getSource().maxzoom<N.getSource().maxzoom)&&(P=N)};return Z.forEach(N=>H(N)),P||q.forEach(N=>H(N)),P}(this.style,this.transform.zoom);E&&function(C,I,P){for(let F=0;F<P.length;F++)Xs(C,I,P[F])}(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const C=E.transform.padding;jo(E,E.transform.height-(C.top||0),3,nc),jo(E,C.bottom||0,3,ui),Ga(E,C.left||0,3,Jn),Ga(E,E.transform.width-(C.right||0),3,Pr);const I=E.transform.centerPoint;(function(P,F,Z,q){gn(P,F-1,Z-10,2,20,q),gn(P,F-10,Z-1,20,2,q)})(E,I.x,E.transform.height-I.y,$a)}(this),this.context.setDefault()}renderLayer(t,n,l,h){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(h||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(m,v,x,E,C){if(m.renderPass!=="translucent")return;const I=Ut.disabled,P=m.colorModeForRenderPass();(x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,Z,q,H,N,re,ce){const Y=Z.transform,ne=N==="map",de=re==="map";for(const pe of F){const _e=H.getTile(pe),Ee=_e.getBucket(q);if(!Ee||!Ee.text||!Ee.text.segments.get().length)continue;const we=o.evaluateSizeForZoom(Ee.textSizeData,Y.zoom),Ie=te(_e,1,Z.transform.zoom),$e=Ui(pe.posMatrix,de,ne,Z.transform,Ie),ft=q.layout.get("icon-text-fit")!=="none"&&Ee.hasIconData();if(we){const Le=Math.pow(2,Y.zoom-_e.tileID.overscaledZ);Na(Ee,ne,de,ce,Y,$e,pe.posMatrix,Le,we,ft,Z.style.map.terrain?(Ke,qe)=>Z.style.map.terrain.getElevation(pe,Ke,qe):null)}}}(E,m,x,v,x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),C),x.paint.get("icon-opacity").constantOr(1)!==0&&ja(m,v,x,E,!1,x.paint.get("icon-translate"),x.paint.get("icon-translate-anchor"),x.layout.get("icon-rotation-alignment"),x.layout.get("icon-pitch-alignment"),x.layout.get("icon-keep-upright"),I,P),x.paint.get("text-opacity").constantOr(1)!==0&&ja(m,v,x,E,!0,x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.layout.get("text-keep-upright"),I,P),v.map.showCollisionBoxes&&(Hs(m,v,x,E,x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),!0),Hs(m,v,x,E,x.paint.get("icon-translate"),x.paint.get("icon-translate-anchor"),!1))})(t,n,l,h,this.style.placement.variableOffsets);break;case"circle":(function(m,v,x,E){if(m.renderPass!=="translucent")return;const C=x.paint.get("circle-opacity"),I=x.paint.get("circle-stroke-width"),P=x.paint.get("circle-stroke-opacity"),F=!x.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(I.constantOr(1)===0||P.constantOr(1)===0))return;const Z=m.context,q=Z.gl,H=m.depthModeForSublayer(0,vt.ReadOnly),N=Ut.disabled,re=m.colorModeForRenderPass(),ce=[];for(let Y=0;Y<E.length;Y++){const ne=E[Y],de=v.getTile(ne),pe=de.getBucket(x);if(!pe)continue;const _e=pe.programConfigurations.get(x.id),Ee=m.useProgram("circle",_e),we=pe.layoutVertexBuffer,Ie=pe.indexBuffer,$e=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ne),ft={programConfiguration:_e,program:Ee,layoutVertexBuffer:we,indexBuffer:Ie,uniformValues:lu(m,ne,de,x),terrainData:$e};if(F){const Le=pe.segments.get();for(const Ke of Le)ce.push({segments:new o.SegmentVector([Ke]),sortKey:Ke.sortKey,state:ft})}else ce.push({segments:pe.segments,sortKey:0,state:ft})}F&&ce.sort((Y,ne)=>Y.sortKey-ne.sortKey);for(const Y of ce){const{programConfiguration:ne,program:de,layoutVertexBuffer:pe,indexBuffer:_e,uniformValues:Ee,terrainData:we}=Y.state;de.draw(Z,q.TRIANGLES,H,N,re,Vt.disabled,Ee,we,x.id,pe,_e,Y.segments,x.paint,m.transform.zoom,ne)}})(t,n,l,h);break;case"heatmap":(function(m,v,x,E){if(x.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const C=m.context,I=C.gl,P=Ut.disabled,F=new ei([I.ONE,I.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(Z,q,H){const N=Z.gl;Z.activeTexture.set(N.TEXTURE1),Z.viewport.set([0,0,q.width/4,q.height/4]);let re=H.heatmapFbo;if(re)N.bindTexture(N.TEXTURE_2D,re.colorAttachment.get()),Z.bindFramebuffer.set(re.framebuffer);else{const ce=N.createTexture();N.bindTexture(N.TEXTURE_2D,ce),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),re=H.heatmapFbo=Z.createFramebuffer(q.width/4,q.height/4,!1,!1),function(Y,ne,de,pe){var _e,Ee;const we=Y.gl,Ie=(_e=Y.HALF_FLOAT)!==null&&_e!==void 0?_e:we.UNSIGNED_BYTE,$e=(Ee=Y.RGBA16F)!==null&&Ee!==void 0?Ee:we.RGBA;we.texImage2D(we.TEXTURE_2D,0,$e,ne.width/4,ne.height/4,0,we.RGBA,Ie,null),pe.colorAttachment.set(de)}(Z,q,ce,re)}})(C,m,x),C.clear({color:o.Color.transparent});for(let Z=0;Z<E.length;Z++){const q=E[Z];if(v.hasRenderableParent(q))continue;const H=v.getTile(q),N=H.getBucket(x);if(!N)continue;const re=N.programConfigurations.get(x.id),ce=m.useProgram("heatmap",re),{zoom:Y}=m.transform;ce.draw(C,I.TRIANGLES,vt.disabled,P,F,Vt.disabled,Hl(q.posMatrix,H,Y,x.paint.get("heatmap-intensity")),null,x.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,x.paint,m.transform.zoom,re)}C.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(C,I){const P=C.context,F=P.gl,Z=I.heatmapFbo;if(!Z)return;P.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,Z.colorAttachment.get()),P.activeTexture.set(F.TEXTURE1);let q=I.colorRampTexture;q||(q=I.colorRampTexture=new tt(P,I.colorRamp,F.RGBA)),q.bind(F.LINEAR,F.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(P,F.TRIANGLES,vt.disabled,Ut.disabled,C.colorModeForRenderPass(),Vt.disabled,((H,N,re,ce)=>{const Y=o.create();o.ortho(Y,0,H.width,H.height,0,0,1);const ne=H.context.gl;return{u_matrix:Y,u_world:[ne.drawingBufferWidth,ne.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(C,I),null,I.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,I.paint,C.transform.zoom)}(m,x))})(t,n,l,h);break;case"line":(function(m,v,x,E){if(m.renderPass!=="translucent")return;const C=x.paint.get("line-opacity"),I=x.paint.get("line-width");if(C.constantOr(1)===0||I.constantOr(1)===0)return;const P=m.depthModeForSublayer(0,vt.ReadOnly),F=m.colorModeForRenderPass(),Z=x.paint.get("line-dasharray"),q=x.paint.get("line-pattern"),H=q.constantOr(1),N=x.paint.get("line-gradient"),re=x.getCrossfadeParameters(),ce=H?"linePattern":Z?"lineSDF":N?"lineGradient":"line",Y=m.context,ne=Y.gl;let de=!0;for(const pe of E){const _e=v.getTile(pe);if(H&&!_e.patternsLoaded())continue;const Ee=_e.getBucket(x);if(!Ee)continue;const we=Ee.programConfigurations.get(x.id),Ie=m.context.program.get(),$e=m.useProgram(ce,we),ft=de||$e.program!==Ie,Le=m.style.map.terrain&&m.style.map.terrain.getTerrainData(pe),Ke=q.constantOr(null);if(Ke&&_e.imageAtlas){const mt=_e.imageAtlas,Ye=mt.patternPositions[Ke.to.toString()],gt=mt.patternPositions[Ke.from.toString()];Ye&&gt&&we.setConstantPatternPositions(Ye,gt)}const qe=Le?pe:null,Ht=H?Hn(m,_e,x,re,qe):Z?Mo(m,_e,x,Z,re,qe):N?Xl(m,_e,x,Ee.lineClipsArray.length,qe):ko(m,_e,x,qe);if(H)Y.activeTexture.set(ne.TEXTURE0),_e.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),we.updatePaintBuffers(re);else if(Z&&(ft||m.lineAtlas.dirty))Y.activeTexture.set(ne.TEXTURE0),m.lineAtlas.bind(Y);else if(N){const mt=Ee.gradients[x.id];let Ye=mt.texture;if(x.gradientVersion!==mt.version){let gt=256;if(x.stepInterpolant){const Kt=v.getSource().maxzoom,Pt=pe.canonical.z===Kt?Math.ceil(1<<m.transform.maxZoom-pe.canonical.z):1;gt=o.clamp(o.nextPowerOfTwo(Ee.maxLineLength/o.EXTENT*1024*Pt),256,Y.maxTextureSize)}mt.gradient=o.renderColorRamp({expression:x.gradientExpression(),evaluationKey:"lineProgress",resolution:gt,image:mt.gradient||void 0,clips:Ee.lineClipsArray}),mt.texture?mt.texture.update(mt.gradient):mt.texture=new tt(Y,mt.gradient,ne.RGBA),mt.version=x.gradientVersion,Ye=mt.texture}Y.activeTexture.set(ne.TEXTURE0),Ye.bind(x.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}$e.draw(Y,ne.TRIANGLES,P,m.stencilModeForClipping(pe),F,Vt.disabled,Ht,Le,x.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,x.paint,m.transform.zoom,we,Ee.layoutVertexBuffer2),de=!1}})(t,n,l,h);break;case"fill":(function(m,v,x,E){const C=x.paint.get("fill-color"),I=x.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const P=m.colorModeForRenderPass(),F=x.paint.get("fill-pattern"),Z=m.opaquePassEnabledForLayer()&&!F.constantOr(1)&&C.constantOr(o.Color.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===Z){const q=m.depthModeForSublayer(1,m.renderPass==="opaque"?vt.ReadWrite:vt.ReadOnly);qa(m,v,x,E,q,P,!1)}if(m.renderPass==="translucent"&&x.paint.get("fill-antialias")){const q=m.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,vt.ReadOnly);qa(m,v,x,E,q,P,!0)}})(t,n,l,h);break;case"fill-extrusion":(function(m,v,x,E){const C=x.paint.get("fill-extrusion-opacity");if(C!==0&&m.renderPass==="translucent"){const I=new vt(m.context.gl.LEQUAL,vt.ReadWrite,m.depthRangeFor3D);if(C!==1||x.paint.get("fill-extrusion-pattern").constantOr(1))Vo(m,v,x,E,I,Ut.disabled,ei.disabled),Vo(m,v,x,E,I,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const P=m.colorModeForRenderPass();Vo(m,v,x,E,I,Ut.disabled,P)}}})(t,n,l,h);break;case"hillshade":(function(m,v,x,E){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const C=m.context,I=m.depthModeForSublayer(0,vt.ReadOnly),P=m.colorModeForRenderPass(),[F,Z]=m.renderPass==="translucent"?m.stencilConfigForOverlap(E):[{},E];for(const q of Z){const H=v.getTile(q);H.needsHillshadePrepare!==void 0&&H.needsHillshadePrepare&&m.renderPass==="offscreen"?Za(m,H,x,I,Ut.disabled,P):m.renderPass==="translucent"&&No(m,q,H,x,I,F[q.overscaledZ],P)}C.viewport.set([0,0,m.width,m.height])})(t,n,l,h);break;case"raster":(function(m,v,x,E){if(m.renderPass!=="translucent"||x.paint.get("raster-opacity")===0||!E.length)return;const C=m.context,I=C.gl,P=v.getSource(),F=m.useProgram("raster"),Z=m.colorModeForRenderPass(),[q,H]=P instanceof mr?[{},E]:m.stencilConfigForOverlap(E),N=H[H.length-1].overscaledZ,re=!m.options.moving;for(const ce of H){const Y=m.depthModeForSublayer(ce.overscaledZ-N,x.paint.get("raster-opacity")===1?vt.ReadWrite:vt.ReadOnly,I.LESS),ne=v.getTile(ce);ne.registerFadeDuration(x.paint.get("raster-fade-duration"));const de=v.findLoadedParent(ce,0),pe=bu(ne,de,v,x,m.transform,m.style.map.terrain);let _e,Ee;const we=x.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;C.activeTexture.set(I.TEXTURE0),ne.texture.bind(we,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(I.TEXTURE1),de?(de.texture.bind(we,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,de.tileID.overscaledZ-ne.tileID.overscaledZ),Ee=[ne.tileID.canonical.x*_e%1,ne.tileID.canonical.y*_e%1]):ne.texture.bind(we,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const Ie=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ce),$e=Ie?ce:null,ft=$e?$e.posMatrix:m.transform.calculatePosMatrix(ce.toUnwrapped(),re),Le=Po(ft,Ee||[0,0],_e||1,pe,x);P instanceof mr?F.draw(C,I.TRIANGLES,Y,Ut.disabled,Z,Vt.disabled,Le,Ie,x.id,P.boundsBuffer,m.quadTriangleIndexBuffer,P.boundsSegments):F.draw(C,I.TRIANGLES,Y,q[ce.overscaledZ],Z,Vt.disabled,Le,Ie,x.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}})(t,n,l,h);break;case"background":(function(m,v,x,E){const C=x.paint.get("background-color"),I=x.paint.get("background-opacity");if(I===0)return;const P=m.context,F=P.gl,Z=m.transform,q=Z.tileSize,H=x.paint.get("background-pattern");if(m.isPatternMissing(H))return;const N=!H&&C.a===1&&I===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==N)return;const re=Ut.disabled,ce=m.depthModeForSublayer(0,N==="opaque"?vt.ReadWrite:vt.ReadOnly),Y=m.colorModeForRenderPass(),ne=m.useProgram(H?"backgroundPattern":"background"),de=E||Z.coveringTiles({tileSize:q,terrain:m.style.map.terrain});H&&(P.activeTexture.set(F.TEXTURE0),m.imageManager.bind(m.context));const pe=x.getCrossfadeParameters();for(const _e of de){const Ee=E?_e.posMatrix:m.transform.calculatePosMatrix(_e.toUnwrapped()),we=H?Lo(Ee,I,m,H,{tileID:_e,tileSize:q},pe):Wn(Ee,I,C),Ie=m.style.map.terrain&&m.style.map.terrain.getTerrainData(_e);ne.draw(P,F.TRIANGLES,ce,re,Y,Vt.disabled,we,Ie,x.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}})(t,0,l,h);break;case"custom":(function(m,v,x){const E=m.context,C=x.implementation;if(m.renderPass==="offscreen"){const I=C.prerender;I&&(m.setCustomLayerDefaults(),E.setColorMode(m.colorModeForRenderPass()),I.call(C,E.gl,m.transform.customLayerMatrix()),E.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),E.setColorMode(m.colorModeForRenderPass()),E.setStencilMode(Ut.disabled);const I=C.renderingMode==="3d"?new vt(m.context.gl.LEQUAL,vt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,vt.ReadOnly);E.setDepthMode(I),C.render(E.gl,m.transform.customLayerMatrix()),E.setDirty(),m.setBaseState(),E.bindFramebuffer.set(null)}})(t,0,l)}}translatePosMatrix(t,n,l,h,m){if(!l[0]&&!l[1])return t;const v=m?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(v){const C=Math.sin(v),I=Math.cos(v);l=[l[0]*I-l[1]*C,l[0]*C+l[1]*I]}const x=[m?l[0]:te(n,l[0],this.transform.zoom),m?l[1]:te(n,l[1],this.transform.zoom),0],E=new Float32Array(16);return o.translate(E,t,x),E}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!n||!l}useProgram(t,n){this.cache=this.cache||{};const l=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new Ln(this.context,Us[t],n,yr[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new tt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}class Zo{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,l){const h=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const E=1/(x=o.transformMat4([],x,t))[3]/n*h;return o.mul$1(x,x,[E,E,1/x[3],E])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const E=function(F,Z){var q=Z[0],H=Z[1],N=Z[2],re=q*q+H*H+N*N;return re>0&&(re=1/Math.sqrt(re)),F[0]=Z[0]*re,F[1]=Z[1]*re,F[2]=Z[2]*re,F}([],function(F,Z,q){var H=Z[0],N=Z[1],re=Z[2],ce=q[0],Y=q[1],ne=q[2];return F[0]=N*ne-re*Y,F[1]=re*ce-H*ne,F[2]=H*Y-N*ce,F}([],ht([],m[x[0]],m[x[1]]),ht([],m[x[2]],m[x[1]]))),C=-((I=E)[0]*(P=m[x[1]])[0]+I[1]*P[1]+I[2]*P[2]);var I,P;return E.concat(C)});return new Zo(m,v)}}class Ks{constructor(t,n){this.min=t,this.max=n,this.center=function(l,h,m){return l[0]=.5*h[0],l[1]=.5*h[1],l[2]=.5*h[2],l}([],function(l,h,m){return l[0]=h[0]+m[0],l[1]=h[1]+m[1],l[2]=h[2]+m[2],l}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],l=lt(this.min),h=lt(this.max);for(let m=0;m<n.length;m++)l[m]=n[m]?this.min[m]:this.center[m],h[m]=n[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new Ks(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let h=0;h<t.planes.length;h++){const m=t.planes[h];let v=0;for(let x=0;x<n.length;x++)o.dot(m,n[x])>=0&&v++;if(v===0)return 0;v!==n.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let m=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let x=0;x<t.points.length;x++){const E=t.points[x][h]-this.min[h];m=Math.min(m,E),v=Math.max(v,E)}if(v<0||m>this.max[h]-this.min[h])return 0}return 1}}class $o{constructor(t=0,n=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=l,this.right=h}interpolate(t,n,l){return n.top!=null&&t.top!=null&&(this.top=o.interpolate.number(t.top,n.top,l)),n.bottom!=null&&t.bottom!=null&&(this.bottom=o.interpolate.number(t.bottom,n.bottom,l)),n.left!=null&&t.left!=null&&(this.left=o.interpolate.number(t.left,n.left,l)),n.right!=null&&t.right!=null&&(this.right=o.interpolate.number(t.right,n.right,l)),this}getCenter(t,n){const l=o.clamp((this.left+t-this.right)/2,0,t),h=o.clamp((this.top+n-this.bottom)/2,0,n);return new o.Point(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new $o(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Go{constructor(t,n,l,h,m){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=m===void 0||!!m,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=l??0,this._maxPitch=h??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new $o,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new Go(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-o.wrap(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var l=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,h,m){var v=h[0],x=h[1],E=h[2],C=h[3],I=Math.sin(m),P=Math.cos(m);l[0]=v*P+E*I,l[1]=x*P+C*I,l[2]=v*-I+E*P,l[3]=x*-I+C*P}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=o.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,l){this._unmodified=!1,this._edgeInsets.interpolate(t,n,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new o.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const l=this.pointCoordinate(new o.Point(0,0)),h=this.pointCoordinate(new o.Point(this.width,0)),m=this.pointCoordinate(new o.Point(this.width,this.height)),v=this.pointCoordinate(new o.Point(0,this.height)),x=Math.floor(Math.min(l.x,h.x,m.x,v.x)),E=Math.floor(Math.max(l.x,h.x,m.x,v.x)),C=1;for(let I=x-C;I<=E+C;I++)I!==0&&n.push(new o.UnwrappedTileID(I,t))}return n}coveringTiles(t){var n,l;let h=this.coveringZoomLevel(t);const m=h;if(t.minzoom!==void 0&&h<t.minzoom)return[];t.maxzoom!==void 0&&h>t.maxzoom&&(h=t.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),x=o.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,h),C=[E*v.x,E*v.y,0],I=[E*x.x,E*x.y,0],P=Zo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h);let F=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=h);const Z=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,q=Y=>({aabb:new Ks([Y*E,0,0],[(Y+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Y,fullyVisible:!1}),H=[],N=[],re=h,ce=t.reparseOverscaled?m:h;if(this._renderWorldCopies)for(let Y=1;Y<=3;Y++)H.push(q(-Y)),H.push(q(Y));for(H.push(q(0));H.length>0;){const Y=H.pop(),ne=Y.x,de=Y.y;let pe=Y.fullyVisible;if(!pe){const $e=Y.aabb.intersects(P);if($e===0)continue;pe=$e===2}const _e=t.terrain?C:I,Ee=Y.aabb.distanceX(_e),we=Y.aabb.distanceY(_e),Ie=Math.max(Math.abs(Ee),Math.abs(we));if(Y.zoom===re||Ie>Z+(1<<re-Y.zoom)-2&&Y.zoom>=F){const $e=re-Y.zoom,ft=C[0]-.5-(ne<<$e),Le=C[1]-.5-(de<<$e);N.push({tileID:new o.OverscaledTileID(Y.zoom===re?ce:Y.zoom,Y.wrap,Y.zoom,ne,de),distanceSq:st([I[0]-.5-ne,I[1]-.5-de]),tileDistanceToCamera:Math.sqrt(ft*ft+Le*Le)})}else for(let $e=0;$e<4;$e++){const ft=(ne<<1)+$e%2,Le=(de<<1)+($e>>1),Ke=Y.zoom+1;let qe=Y.aabb.quadrant($e);if(t.terrain){const Ht=new o.OverscaledTileID(Ke,Y.wrap,Ke,ft,Le),mt=t.terrain.getMinMaxElevation(Ht),Ye=(n=mt.minElevation)!==null&&n!==void 0?n:this.elevation,gt=(l=mt.maxElevation)!==null&&l!==void 0?l:this.elevation;qe=new Ks([qe.min[0],qe.min[1],Ye],[qe.max[0],qe.max[1],gt])}H.push({aabb:qe,zoom:Ke,x:ft,y:Le,wrap:Y.wrap,fullyVisible:pe})}}return N.sort((Y,ne)=>Y.distanceSq-ne.distanceSq).map(Y=>Y.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=o.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.Point(o.mercatorXfromLng(t.lng)*this.worldSize,o.mercatorYfromLat(n)*this.worldSize)}unproject(t){return new o.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),l=t.getElevationForLngLatZoom(n,this.tileZoom);if(!(this.elevation-l))return;const h=this.getCameraPosition(),m=o.MercatorCoordinate.fromLngLat(h.lngLat,h.altitude),v=o.MercatorCoordinate.fromLngLat(n,l),x=m.x-v.x,E=m.y-v.y,C=m.z-v.z,I=Math.sqrt(x*x+E*E+C*C),P=this.scaleZoom(this.cameraToCenterDistance/I/this.tileSize);this._elevation=l,this._center=n,this.zoom=P}setLocationAtPoint(t,n){const l=this.pointCoordinate(n),h=this.pointCoordinate(this.centerPoint),m=this.locationCoordinate(t),v=new o.MercatorCoordinate(m.x-(l.x-h.x),m.y-(l.y-h.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),n.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return o.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const F=n.pointCoordinate(t);if(F!=null)return F}const l=[t.x,t.y,0,1],h=[t.x,t.y,1,1];o.transformMat4(l,l,this.pixelMatrixInverse),o.transformMat4(h,h,this.pixelMatrixInverse);const m=l[3],v=h[3],x=l[1]/m,E=h[1]/v,C=l[2]/m,I=h[2]/v,P=C===I?0:(0-C)/(I-C);return new o.MercatorCoordinate(o.interpolate.number(l[0]/m,h[0]/v,P)/this.worldSize,o.interpolate.number(x,E,P)/this.worldSize)}coordinatePoint(t,n=0,l=this.pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,n,1];return o.transformMat4(h,h,l),new o.Point(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new kt().extend(this.pointLocation(new o.Point(0,t))).extend(this.pointLocation(new o.Point(this.width,t))).extend(this.pointLocation(new o.Point(this.width,this.height))).extend(this.pointLocation(new o.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new kt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const l=t.key,h=n?this._alignedPosMatrixCache:this._posMatrixCache;if(h[l])return h[l];const m=t.canonical,v=this.worldSize/this.zoomScale(m.z),x=m.x+Math.pow(2,m.z)*t.wrap,E=o.identity(new Float64Array(16));return o.translate(E,E,[x*v,m.y*v,0]),o.scale(E,E,[v/o.EXTENT,v/o.EXTENT,1]),o.multiply(E,n?this.alignedProjMatrix:this.projMatrix,E),h[l]=new Float32Array(E),h[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,l,h,m=-90,v=90,x=-180,E=180;const C=this.size,I=this._unmodified;if(this.latRange){const Z=this.latRange;m=o.mercatorYfromLat(Z[1])*this.worldSize,v=o.mercatorYfromLat(Z[0])*this.worldSize,t=v-m<C.y?C.y/(v-m):0}if(this.lngRange){const Z=this.lngRange;x=o.wrap(o.mercatorXfromLng(Z[0])*this.worldSize,0,this.worldSize),E=o.wrap(o.mercatorXfromLng(Z[1])*this.worldSize,0,this.worldSize),E<x&&(E+=this.worldSize),n=E-x<C.x?C.x/(E-x):0}const P=this.point,F=Math.max(n||0,t||0);if(F)return this.center=this.unproject(new o.Point(n?(E+x)/2:P.x,t?(v+m)/2:P.y)),this.zoom+=this.scaleZoom(F),this._unmodified=I,void(this._constraining=!1);if(this.latRange){const Z=P.y,q=C.y/2;Z-q<m&&(h=m+q),Z+q>v&&(h=v-q)}if(this.lngRange){const Z=(x+E)/2,q=o.wrap(P.x,Z-this.worldSize/2,Z+this.worldSize/2),H=C.x/2;q-H<x&&(l=x+H),q+H>E&&(l=E-H)}l===void 0&&h===void 0||(this.center=this.unproject(new o.Point(l!==void 0?l:P.x,h!==void 0?h:P.y)).wrap()),this._unmodified=I,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let h=o.identity(new Float64Array(16));o.scale(h,h,[this.width/2,-this.height/2,1]),o.translate(h,h,[1,-1,0]),this.labelPlaneMatrix=h,h=o.identity(new Float64Array(16)),o.scale(h,h,[1,-1,1]),o.translate(h,h,[-1,-1,0]),o.scale(h,h,[2/this.width,2/this.height,1]),this.glCoordMatrix=h;const m=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this._minEleveationForCurrentTile),x=m-v*this._pixelPerMeter/Math.cos(this._pitch),E=v<0?x:m,C=Math.PI/2+this._pitch,I=this._fov*(.5+t.y/this.height),P=Math.sin(I)*E/Math.sin(o.clamp(Math.PI-C-I,.01,Math.PI-.01)),F=this.getHorizon(),Z=2*Math.atan(F/this.cameraToCenterDistance)*(.5+t.y/(2*F)),q=Math.sin(Z)*E/Math.sin(o.clamp(Math.PI-C-Z,.01,Math.PI-.01)),H=Math.min(P,q),N=1.01*(Math.cos(Math.PI/2-this._pitch)*H+E),re=this.height/50;h=new Float64Array(16),o.perspective(h,this._fov,this.width/this.height,re,N),h[8]=2*-t.x/this.width,h[9]=2*t.y/this.height,o.scale(h,h,[1,-1,1]),o.translate(h,h,[0,0,-this.cameraToCenterDistance]),o.rotateX(h,h,this._pitch),o.rotateZ(h,h,this.angle),o.translate(h,h,[-n,-l,0]),this.mercatorMatrix=o.scale([],h,[this.worldSize,this.worldSize,this.worldSize]),o.scale(h,h,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,h),o.translate(h,h,[0,0,-this.elevation]),this.projMatrix=h,this.invProjMatrix=o.invert([],h),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,h);const ce=this.width%2/2,Y=this.height%2/2,ne=Math.cos(this.angle),de=Math.sin(this.angle),pe=n-Math.round(n)+ne*ce+de*Y,_e=l-Math.round(l)+ne*Y+de*ce,Ee=new Float64Array(h);if(o.translate(Ee,Ee,[pe>.5?pe-1:pe,_e>.5?_e-1:_e,0]),this.alignedProjMatrix=Ee,h=o.invert(new Float64Array(16),this.pixelMatrix),!h)throw new Error("failed to invert matrix");this.pixelMatrixInverse=h,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new o.Point(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let l=n.x,h=n.y,m=n.x,v=n.y;for(const x of t)l=Math.min(l,x.x),h=Math.min(h,x.y),m=Math.max(m,x.x),v=Math.max(v,x.y);return[new o.Point(l,h),new o.Point(m,h),new o.Point(m,v),new o.Point(l,v),new o.Point(l,h)]}}}function zn(d,t){let n,l=!1,h=null,m=null;const v=()=>{h=null,l&&(d.apply(m,n),h=setTimeout(v,t),l=!1)};return(...x)=>(l=!0,m=this,n=x,h||v(),h)}class oc{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(l=h)}),(l&&l[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:l,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}},this._updateHash=zn(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,h),v=Math.round(n.lng*m)/m,x=Math.round(n.lat*m)/m,E=this._map.getBearing(),C=this._map.getPitch();let I="";if(I+=t?`/${v}/${x}/${l}`:`${l}/${x}/${v}`,(E||C)&&(I+="/"+Math.round(10*E)/10),C&&(I+=`/${Math.round(C)}`),this._hashName){const P=this._hashName;let F=!1;const Z=window.location.hash.slice(1).split("&").map(q=>{const H=q.split("=")[0];return H===P?(F=!0,`${H}=${I}`):q}).filter(q=>q);return F||Z.push(`${P}=${I}`),`#${Z.join("&")}`}return`#${I}`}}const Ys={linearity:.3,easing:o.bezier(0,0,.3,1)},ac=o.extend({deceleration:2500,maxSpeed:1400},Ys),lc=o.extend({deceleration:20,maxSpeed:1400},Ys),cc=o.extend({deceleration:1e3,maxSpeed:360},Ys),uc=o.extend({deceleration:1e3,maxSpeed:90},Ys);class Js{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.browser.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=o.browser.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)n.zoom+=m.zoomDelta||0,n.bearing+=m.bearingDelta||0,n.pitch+=m.pitchDelta||0,m.panDelta&&n.pan._add(m.panDelta),m.around&&(n.around=m.around),m.pinchAround&&(n.pinchAround=m.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(n.pan.mag()){const m=xr(n.pan.mag(),l,o.extend({},ac,t||{}));h.offset=n.pan.mult(m.amount/n.pan.mag()),h.center=this._map.transform.center,Qs(h,m)}if(n.zoom){const m=xr(n.zoom,l,lc);h.zoom=this._map.transform.zoom+m.amount,Qs(h,m)}if(n.bearing){const m=xr(n.bearing,l,cc);h.bearing=this._map.transform.bearing+o.clamp(m.amount,-179,179),Qs(h,m)}if(n.pitch){const m=xr(n.pitch,l,uc);h.pitch=this._map.transform.pitch+m.amount,Qs(h,m)}if(h.zoom||h.bearing){const m=n.pinchAround===void 0?n.around:n.pinchAround;h.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),o.extend(h,{noMoveStart:!0})}}function Qs(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function xr(d,t,n){const{maxSpeed:l,linearity:h,deceleration:m}=n,v=o.clamp(d*h/(t/1e3),-l,l),x=Math.abs(v)/(m*h);return{easing:n.easing,duration:1e3*x,amount:v*(x/2)}}class bi extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l,h={}){const m=A.mousePos(n.getCanvasContainer(),l),v=n.unproject(m);super(t,o.extend({point:m,lngLat:v,originalEvent:l},h)),this._defaultPrevented=!1,this.target=n}}class eo extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l){const h=t==="touchend"?l.changedTouches:l.touches,m=A.touchPos(n.getCanvasContainer(),h),v=m.map(E=>n.unproject(E)),x=m.reduce((E,C,I,P)=>E.add(C.div(P.length)),new o.Point(0,0));super(t,{points:m,point:x,lngLats:v,lngLat:n.unproject(x),originalEvent:l}),this._defaultPrevented=!1}}class _n extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class to{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new _n(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new bi(t.type,this._map,t))}mouseup(t){this._map.fire(new bi(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new bi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new bi(t.type,this._map,t))}mouseover(t){this._map.fire(new bi(t.type,this._map,t))}mouseout(t){this._map.fire(new bi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new eo(t.type,this._map,t))}touchmove(t){this._map.fire(new eo(t.type,this._map,t))}touchend(t){this._map.fire(new eo(t.type,this._map,t))}touchcancel(t){this._map.fire(new eo(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wu{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new bi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new bi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new bi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class io{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(o.Point.convert(t),this._map.terrain)}}class Eu{constructor(t,n){this._map=t,this._tr=new io(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(A.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const l=n;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=A.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const m=Math.min(h.x,l.x),v=Math.max(h.x,l.x),x=Math.min(h.y,l.y),E=Math.max(h.y,l.y);A.setTransform(this._box,`translate(${m}px,${x}px)`),this._box.style.width=v-m+"px",this._box.style.height=E-x+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const l=this._startPos,h=n;if(this.reset(),A.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:m=>m.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(A.remove(this._box),this._box=null),A.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new o.Event(t,{originalEvent:n}))}}function Ho(d,t){if(d.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${t.length}`);const n={};for(let l=0;l<d.length;l++)n[d[l].identifier]=t[l];return n}class ro{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){const m=new o.Point(0,0);for(const v of h)m._add(v);return m.div(h.length)}(n),this.touches=Ho(l,n)))}touchmove(t,n,l){if(this.aborted||!this.centroid)return;const h=Ho(l,n);for(const m in this.touches){const v=h[m];(!v||v.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(t,n,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class on{constructor(t){this.singleTap=new ro(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,l){this.singleTap.touchstart(t,n,l)}touchmove(t,n,l){this.singleTap.touchmove(t,n,l)}touchend(t,n,l){const h=this.singleTap.touchend(t,n,l);if(h){const m=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(h)<30;if(m&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class Ve{constructor(t){this._tr=new io(t),this._zoomIn=new on({numTouches:1,numTaps:2}),this._zoomOut=new on({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,l){this._zoomIn.touchstart(t,n,l),this._zoomOut.touchstart(t,n,l)}touchmove(t,n,l){this._zoomIn.touchmove(t,n,l),this._zoomOut.touchmove(t,n,l)}touchend(t,n,l){const h=this._zoomIn.touchend(t,n,l),m=this._zoomOut.touchend(t,n,l),v=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(h)},{originalEvent:t})}):m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(m)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ts{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=n.length?n[0]:n;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&A.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const no={0:1,2:2};class Qn{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=A.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,l){const h=no[l];return n.buttons===void 0||(n.buttons&h)!==h}(t,this._eventButton)}isValidEndEvent(t){return A.mouseButton(t)===this._eventButton}}class Ha{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Re=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=function(t){t.preventDefault()}},Wo=({enable:d,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const l=new Qn({checkCorrectEvent:h=>A.mouseButton(h)===0&&h.ctrlKey||A.mouseButton(h)===2});return new Ts({clickTolerance:t,move:(h,m)=>({bearingDelta:(m.x-h.x)*n}),moveStateManager:l,enable:d,assignEvents:Re})},hc=({enable:d,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const l=new Qn({checkCorrectEvent:h=>A.mouseButton(h)===0&&h.ctrlKey||A.mouseButton(h)===2});return new Ts({clickTolerance:t,move:(h,m)=>({pitchDelta:(m.y-h.y)*n}),moveStateManager:l,enable:d,assignEvents:Re})};class Tu{constructor(t,n){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,n,l){return this._calculateTransform(t,n,l)}touchmove(t,n,l){if(this._map._cooperativeGestures&&(this._minTouches===2&&l.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,l.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(l.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,l)}touchend(t,n,l){this._calculateTransform(t,n,l),this._active&&l.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,l){l.length>0&&(this._active=!0);const h=Ho(l,n),m=new o.Point(0,0),v=new o.Point(0,0);let x=0;for(const C in h){const I=h[C],P=this._touches[C];P&&(m._add(I),v._add(I.sub(P)),x++,h[C]=I)}if(this._touches=h,x<this._minTouches||!v.mag())return;const E=v.div(x);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(x),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class so{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,m]=this._firstTwoTouches,v=oo(l,n,h),x=oo(l,n,m);if(!v||!x)return;const E=this._aroundCenter?null:v.add(x).div(2);return this._move([v,x],E,t)}touchend(t,n,l){if(!this._firstTwoTouches)return;const[h,m]=this._firstTwoTouches,v=oo(l,n,h),x=oo(l,n,m);v&&x||(this._active&&A.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function oo(d,t,n){for(let l=0;l<d.length;l++)if(d[l].identifier===n)return t[l]}function Wa(d,t){return Math.log(d/t)/Math.LN2}class Su extends so{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Wa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Wa(this._distance,l),pinchAround:n}}}function dc(d,t){return 180*d.angleWith(t)/Math.PI}class Xa extends so{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const l=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:dc(this._vector,l),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,l=dc(t,this._startVector);return Math.abs(l)<n}}function ao(d){return Math.abs(d.y)>Math.abs(d.x)}class Ka extends so{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,l){super.touchstart(t,n,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,ao(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,l){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),m=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,m,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,m=n.mag()>=2;if(!h&&!m)return;if(!h||!m)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=t.y>0==n.y>0;return ao(t)&&ao(n)&&v}}const Ya={panStep:100,bearingStep:15,pitchStep:10};class rr{constructor(t){this._tr=new io(t);const n=Ya;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,l=0,h=0,m=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),m=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),m=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:x=>{const E=this._tr;x.easeTo({duration:300,easeId:"keyboardHandler",easing:Dn,zoom:n?Math.round(E.zoom)+n*(t.shiftKey?2:1):E.zoom,bearing:E.bearing+l*this._bearingStep,pitch:E.pitch+h*this._pitchStep,offset:[-m*this._panStep,-v*this._panStep],center:E.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Dn(d){return d*(2-d)}const Ja=4.000244140625;class Qa{constructor(t,n){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new io(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=o.browser.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,n!==0&&n%Ja==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=A.mousePos(this._el,t),l=this._tr;this._around=o.LngLat.convert(this._aroundCenter?l.center:l.unproject(n)),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const x=this._type==="wheel"&&Math.abs(this._delta)>Ja?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*x)));this._delta<0&&E!==0&&(E=1/E);const C=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(C*E))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,l=this._startZoom,h=this._easing;let m,v=!1;if(this._type==="wheel"&&l&&h){const x=Math.min((o.browser.now()-this._lastWheelEventTime)/200,1),E=h(x);m=o.interpolate.number(l,n,E),x<1?this._frameId||(this._frameId=!0):v=!0}else m=n,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:m-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=o.defaultEasing;if(this._prevEase){const l=this._prevEase,h=(o.browser.now()-l.start)/l.duration,m=l.easing(h+.01)-l.easing(h),v=.27/Math.sqrt(m*m+1e-4)*.01,x=Math.sqrt(.0729-v*v);n=o.bezier(v,x,.25,1)}return this._prevEase={start:o.browser.now(),duration:t,easing:n},n}reset(){this._active=!1}}class el{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class tl{constructor(t){this._tr=new io(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pc{constructor(){this._tap=new on({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,l){if(!this._swipePoint)if(this._tapTime){const h=n[0],m=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(h)<30;m&&v?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,n,l)}touchmove(t,n,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=n[0],m=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(t,n,l)}touchend(t,n,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,n,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lr{constructor(t,n,l){this._el=t,this._mousePan=n,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gt{constructor(t,n,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xo{constructor(t,n,l,h){this._el=t,this._touchZoom=n,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ss=d=>d.zoom||d.drag||d.pitch||d.rotate;class fc extends o.Event{}function Ko(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class mc{constructor(t,n){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,m)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=h.type==="renderFrame"?void 0:h,x={needsRenderFrame:!1},E={},C={},I=h.touches,P=I?this._getMapTouches(I):void 0,F=P?A.touchPos(this._el,P):A.mousePos(this._el,h);for(const{handlerName:H,handler:N,allowed:re}of this._handlers){if(!N.isEnabled())continue;let ce;this._blockedByActive(C,re,H)?N.reset():N[m||h.type]&&(ce=N[m||h.type](h,F,P),this.mergeHandlerResult(x,E,ce,H,v),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||N.isActive())&&(C[H]=N)}const Z={};for(const H in this._previousActiveHandlers)C[H]||(Z[H]=v);this._previousActiveHandlers=C,(Object.keys(Z).length||Ko(x))&&(this._changes.push([x,E,Z]),this._triggerRenderFrame()),(Object.keys(C).length||Ko(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=x;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Js(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,m,v]of this._listeners)A.addEventListener(h,m,h===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,n,l]of this._listeners)A.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const n=this._map,l=n.getCanvasContainer();this._add("mapEvent",new to(n,t));const h=n.boxZoom=new Eu(n,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const m=new Ve(n),v=new tl(n);n.doubleClickZoom=new el(v,m),this._add("tapZoom",m),this._add("clickZoom",v),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const x=new pc;this._add("tapDragZoom",x);const E=n.touchPitch=new Ka(n);this._add("touchPitch",E),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const C=Wo(t),I=hc(t);n.dragRotate=new Gt(t,C,I),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const P=(({enable:re,clickTolerance:ce})=>{const Y=new Qn({checkCorrectEvent:ne=>A.mouseButton(ne)===0&&!ne.ctrlKey});return new Ts({clickTolerance:ce,move:(ne,de)=>({around:de,panDelta:de.sub(ne)}),activateOnStart:!0,moveStateManager:Y,enable:re,assignEvents:Re})})(t),F=new Tu(t,n);n.dragPan=new Lr(l,P,F),this._add("mousePan",P),this._add("touchPan",F,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const Z=new Xa,q=new Su;n.touchZoomRotate=new Xo(l,q,Z,x),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const H=n.scrollZoom=new Qa(n,()=>this._triggerRenderFrame());this._add("scrollZoom",H,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const N=n.keyboard=new rr(n);this._add("keyboard",N),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new wu(n))}_add(t,n,l){this._handlers.push({handlerName:t,handler:n,allowed:l}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ss(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,l){for(const h in t)if(h!==l&&(!n||n.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const l of t)this._el.contains(l.target)&&n.push(l);return n}mergeHandlerResult(t,n,l,h,m){if(!l)return;o.extend(t,l);const v={handlerName:h,originalEvent:l.originalEvent||m};l.zoomDelta!==void 0&&(n.zoom=v),l.panDelta!==void 0&&(n.drag=v),l.pitchDelta!==void 0&&(n.pitch=v),l.bearingDelta!==void 0&&(n.rotate=v)}_applyChanges(){const t={},n={},l={};for(const[h,m,v]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new o.Point(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),o.extend(n,m),o.extend(l,v);this._updateMapTransform(t,n,l),this._changes=[]}_updateMapTransform(t,n,l){const h=this._map,m=h._getTransformForUpdate(),v=h.terrain;if(!(Ko(t)||v&&this._terrainMovement))return this._fireEvents(n,l,!0);let{panDelta:x,zoomDelta:E,bearingDelta:C,pitchDelta:I,around:P,pinchAround:F}=t;F!==void 0&&(P=F),h._stop(!0),P=P||h.transform.centerPoint;const Z=m.pointLocation(x?P.sub(x):P);C&&(m.bearing+=C),I&&(m.pitch+=I),E&&(m.zoom+=E),v?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?m.center=m.pointLocation(m.centerPoint.sub(x)):m.setLocationAtPoint(Z,P):(this._terrainMovement=!0,this._map._elevationFreeze=!0,m.setLocationAtPoint(Z,P),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,m.recalculateZoom(h.terrain)})):m.setLocationAtPoint(Z,P),h._applyUpdatedTransform(m),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,l,!0)}_fireEvents(t,n,l){const h=Ss(this._eventsInProgress),m=Ss(t),v={};for(const I in t){const{originalEvent:P}=t[I];this._eventsInProgress[I]||(v[`${I}start`]=P),this._eventsInProgress[I]=t[I]}!h&&m&&this._fireEvent("movestart",m.originalEvent);for(const I in v)this._fireEvent(I,v[I]);m&&this._fireEvent("move",m.originalEvent);for(const I in t){const{originalEvent:P}=t[I];this._fireEvent(I,P)}const x={};let E;for(const I in this._eventsInProgress){const{handlerName:P,originalEvent:F}=this._eventsInProgress[I];this._handlersById[P].isActive()||(delete this._eventsInProgress[I],E=n[P]||F,x[`${I}end`]=E)}for(const I in x)this._fireEvent(I,x[I]);const C=Ss(this._eventsInProgress);if(l&&(h||m)&&!C){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;I?(P(I.bearing||this._map.getBearing())&&(I.bearing=0),I.freezeElevation=!0,this._map.easeTo(I,{originalEvent:E})):(this._map.fire(new o.Event("moveend",{originalEvent:E})),P(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new o.Event(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new fc("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Cu extends o.Evented{constructor(t,n){super(),this._renderFrameCallback=()=>{const l=Math.min((o.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,l){return t=o.Point.convert(t).mult(-1),this.panTo(this.transform.center,o.extend({offset:t},n),l)}panTo(t,n,l){return this.easeTo(o.extend({center:t},n),l)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,l){return this.easeTo(o.extend({zoom:t},n),l)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,l){return this.easeTo(o.extend({bearing:t},n),l)}resetNorth(t,n){return this.rotateTo(0,o.extend({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=kt.convert(t);const l=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,n)}_cameraForBoxAndBearing(t,n,l,h){const m={top:0,bottom:0,right:0,left:0};if(typeof(h=o.extend({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const de=h.padding;h.padding={top:de,bottom:de,right:de,left:de}}h.padding=o.extend(m,h.padding);const v=this.transform,x=v.padding,E=v.project(o.LngLat.convert(t)),C=v.project(o.LngLat.convert(n)),I=E.rotate(-l*Math.PI/180),P=C.rotate(-l*Math.PI/180),F=new o.Point(Math.max(I.x,P.x),Math.max(I.y,P.y)),Z=new o.Point(Math.min(I.x,P.x),Math.min(I.y,P.y)),q=F.sub(Z),H=(v.width-(x.left+x.right+h.padding.left+h.padding.right))/q.x,N=(v.height-(x.top+x.bottom+h.padding.top+h.padding.bottom))/q.y;if(N<0||H<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const re=Math.min(v.scaleZoom(v.scale*Math.min(H,N)),h.maxZoom),ce=o.Point.convert(h.offset),Y=new o.Point((h.padding.left-h.padding.right)/2,(h.padding.top-h.padding.bottom)/2).rotate(l*Math.PI/180),ne=ce.add(Y).mult(v.scale/v.zoomScale(re));return{center:v.unproject(E.add(C).div(2).sub(ne)),zoom:re,bearing:l}}fitBounds(t,n,l){return this._fitInternal(this.cameraForBounds(t,n),n,l)}fitScreenCoordinates(t,n,l,h,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.Point.convert(t)),this.transform.pointLocation(o.Point.convert(n)),l,h),h,m)}_fitInternal(t,n,l){return t?(delete(n=o.extend(t,n)).padding,n.linear?this.easeTo(n,l):this.flyTo(n,l)):this}jumpTo(t,n){this.stop();const l=this._getTransformForUpdate();let h=!1,m=!1,v=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(h=!0,l.zoom=+t.zoom),t.center!==void 0&&(l.center=o.LngLat.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(m=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(v=!0,l.pitch=+t.pitch),t.padding==null||l.isPaddingEqual(t.padding)||(l.padding=t.padding),this._applyUpdatedTransform(l),this.fire(new o.Event("movestart",n)).fire(new o.Event("move",n)),h&&this.fire(new o.Event("zoomstart",n)).fire(new o.Event("zoom",n)).fire(new o.Event("zoomend",n)),m&&this.fire(new o.Event("rotatestart",n)).fire(new o.Event("rotate",n)).fire(new o.Event("rotateend",n)),v&&this.fire(new o.Event("pitchstart",n)).fire(new o.Event("pitch",n)).fire(new o.Event("pitchend",n)),this.fire(new o.Event("moveend",n))}calculateCameraOptionsFromTo(t,n,l,h=0){const m=o.MercatorCoordinate.fromLngLat(t,n),v=o.MercatorCoordinate.fromLngLat(l,h),x=v.x-m.x,E=v.y-m.y,C=v.z-m.z,I=Math.hypot(x,E,C);if(I===0)throw new Error("Can't calculate camera options with same From and To");const P=Math.hypot(x,E),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/I/this.transform.tileSize),Z=180*Math.atan2(x,-E)/Math.PI;let q=180*Math.acos(P/I)/Math.PI;return q=C<0?90-q:90+q,{center:v.toLngLat(),zoom:F,pitch:q,bearing:Z}}easeTo(t,n){this._stop(!1,t.easeId),((t=o.extend({offset:[0,0],duration:500,easing:o.defaultEasing},t)).animate===!1||!t.essential&&o.browser.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),h=this.getZoom(),m=this.getBearing(),v=this.getPitch(),x=this.getPadding(),E="zoom"in t?+t.zoom:h,C="bearing"in t?this._normalizeBearing(t.bearing,m):m,I="pitch"in t?+t.pitch:v,P="padding"in t?t.padding:l.padding,F=o.Point.convert(t.offset);let Z=l.centerPoint.add(F);const q=l.pointLocation(Z),H=o.LngLat.convert(t.center||q);this._normalizeCenter(H);const N=l.project(q),re=l.project(H).sub(N),ce=l.zoomScale(E-h);let Y,ne;t.around&&(Y=o.LngLat.convert(t.around),ne=l.locationPoint(Y));const de={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||E!==h,this._rotating=this._rotating||m!==C,this._pitching=this._pitching||I!==v,this._padding=!l.isPaddingEqual(P),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,de),this.terrain&&this._prepareElevation(H),this._ease(pe=>{if(this._zooming&&(l.zoom=o.interpolate.number(h,E,pe)),this._rotating&&(l.bearing=o.interpolate.number(m,C,pe)),this._pitching&&(l.pitch=o.interpolate.number(v,I,pe)),this._padding&&(l.interpolatePadding(x,P,pe),Z=l.centerPoint.add(F)),this.terrain&&!t.freezeElevation&&this._updateElevation(pe),Y)l.setLocationAtPoint(Y,ne);else{const _e=l.zoomScale(l.zoom-h),Ee=E>h?Math.min(2,ce):Math.max(.5,ce),we=Math.pow(Ee,1-pe),Ie=l.unproject(N.add(re.mult(pe*we)).mult(_e));l.setLocationAtPoint(l.renderWorldCopies?Ie.wrap():Ie,Z)}this._applyUpdatedTransform(l),this._fireMoveEvents(n)},pe=>{this.terrain&&this._finalizeElevation(),this._afterEase(n,pe)},t),this}_prepareEase(t,n,l={}){this._moving=!0,n||l.moving||this.fire(new o.Event("movestart",t)),this._zooming&&!l.zooming&&this.fire(new o.Event("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new o.Event("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new o.Event("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(n-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=o.interpolate.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const n=t.clone(),{center:l,zoom:h,pitch:m,bearing:v,elevation:x}=this.transformCameraUpdate(n);l&&(n.center=l),h!==void 0&&(n.zoom=h),m!==void 0&&(n.pitch=m),v!==void 0&&(n.bearing=v),x!==void 0&&(n.elevation=x),this.transform.apply(n)}_fireMoveEvents(t){this.fire(new o.Event("move",t)),this._zooming&&this.fire(new o.Event("zoom",t)),this._rotating&&this.fire(new o.Event("rotate",t)),this._pitching&&this.fire(new o.Event("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const l=this._zooming,h=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new o.Event("zoomend",t)),h&&this.fire(new o.Event("rotateend",t)),m&&this.fire(new o.Event("pitchend",t)),this.fire(new o.Event("moveend",t))}flyTo(t,n){if(!t.essential&&o.browser.prefersReducedMotion){const qe=o.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qe,n)}this.stop(),t=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.defaultEasing},t);const l=this._getTransformForUpdate(),h=this.getZoom(),m=this.getBearing(),v=this.getPitch(),x=this.getPadding(),E="zoom"in t?o.clamp(+t.zoom,l.minZoom,l.maxZoom):h,C="bearing"in t?this._normalizeBearing(t.bearing,m):m,I="pitch"in t?+t.pitch:v,P="padding"in t?t.padding:l.padding,F=l.zoomScale(E-h),Z=o.Point.convert(t.offset);let q=l.centerPoint.add(Z);const H=l.pointLocation(q),N=o.LngLat.convert(t.center||H);this._normalizeCenter(N);const re=l.project(H),ce=l.project(N).sub(re);let Y=t.curve;const ne=Math.max(l.width,l.height),de=ne/F,pe=ce.mag();if("minZoom"in t){const qe=o.clamp(Math.min(t.minZoom,h,E),l.minZoom,l.maxZoom),Ht=ne/l.zoomScale(qe-h);Y=Math.sqrt(Ht/pe*2)}const _e=Y*Y;function Ee(qe){const Ht=(de*de-ne*ne+(qe?-1:1)*_e*_e*pe*pe)/(2*(qe?de:ne)*_e*pe);return Math.log(Math.sqrt(Ht*Ht+1)-Ht)}function we(qe){return(Math.exp(qe)-Math.exp(-qe))/2}function Ie(qe){return(Math.exp(qe)+Math.exp(-qe))/2}const $e=Ee(!1);let ft=function(qe){return Ie($e)/Ie($e+Y*qe)},Le=function(qe){return ne*((Ie($e)*(we(Ht=$e+Y*qe)/Ie(Ht))-we($e))/_e)/pe;var Ht},Ke=(Ee(!0)-$e)/Y;if(Math.abs(pe)<1e-6||!isFinite(Ke)){if(Math.abs(ne-de)<1e-6)return this.easeTo(t,n);const qe=de<ne?-1:1;Ke=Math.abs(Math.log(de/ne))/Y,Le=function(){return 0},ft=function(Ht){return Math.exp(qe*Y*Ht)}}return t.duration="duration"in t?+t.duration:1e3*Ke/("screenSpeed"in t?+t.screenSpeed/Y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=m!==C,this._pitching=I!==v,this._padding=!l.isPaddingEqual(P),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(N),this._ease(qe=>{const Ht=qe*Ke,mt=1/ft(Ht);l.zoom=qe===1?E:h+l.scaleZoom(mt),this._rotating&&(l.bearing=o.interpolate.number(m,C,qe)),this._pitching&&(l.pitch=o.interpolate.number(v,I,qe)),this._padding&&(l.interpolatePadding(x,P,qe),q=l.centerPoint.add(Z)),this.terrain&&!t.freezeElevation&&this._updateElevation(qe);const Ye=qe===1?N:l.unproject(re.add(ce.mult(Le(Ht))).mult(mt));l.setLocationAtPoint(l.renderWorldCopies?Ye.wrap():Ye,q),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,n)}if(!t){const l=this.handlers;l&&l.stop(!1)}return this}_ease(t,n,l){l.animate===!1||l.duration===0?(t(1),n()):(this._easeStart=o.browser.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=o.wrap(t,-180,180);const l=Math.abs(t-n);return Math.abs(t-360-n)<l&&(t-=360),Math.abs(t+360-n)<l&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const l=t.lng-n.center.lng;t.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(o.LngLat.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class Nr{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=A.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=A.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=A.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){A.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const l=this._map._getUIString(`AttributionControl.${n}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const n=this._map.style.sourceCaches;for(const h in n){const m=n[h];if(m.used||m.usedForTerrain){const v=m.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter(h=>String(h).trim()),t.sort((h,m)=>h.length-m.length),t=t.filter((h,m)=>{for(let v=m+1;v<t.length;v++)if(t[v].indexOf(h)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class lo{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=A.create("div","maplibregl-ctrl");const n=A.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){A.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class We{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,l=n?this._queue.concat(n):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const l of n)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const et={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Yo=o.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class il extends o.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const l={};for(const h of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.posMatrix=new Float64Array(16),o.ortho(h.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[h.key]=new $n(h,this.tileSize));for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const n in this._tiles){const l=this._tiles[n];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID;if(h.canonical.equals(t.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16),o.ortho(m.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),n[l]=m}else if(h.canonical.isChildOf(t.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16);const v=h.canonical.z-t.canonical.z,x=h.canonical.x-(h.canonical.x>>v<<v),E=h.canonical.y-(h.canonical.y>>v<<v),C=o.EXTENT>>v;o.ortho(m.posMatrix,0,C,0,C,0,1),o.translate(m.posMatrix,m.posMatrix,[-x*C,-E*C,0]),n[l]=m}else if(t.canonical.isChildOf(h.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16);const v=t.canonical.z-h.canonical.z,x=t.canonical.x-(t.canonical.x>>v<<v),E=t.canonical.y-(t.canonical.y>>v<<v),C=o.EXTENT>>v;o.ortho(m.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(m.posMatrix,m.posMatrix,[x*C,E*C,0]),o.scale(m.posMatrix,m.posMatrix,[1/2**v,1/2**v,0]),n[l]=m}}return n}getSourceTile(t,n){const l=this.sourceCache._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!m||!m.dem)&&n)for(;h>=l.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(t.scaledTo(h--).key);return m}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=t)}}class rl{constructor(t,n,l){this.painter=t,this.sourceCache=new il(n),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,l,h=o.EXTENT){var m;if(!(n>=0&&n<h&&l>=0&&l<h))return 0;const v=this.getTerrainData(t),x=(m=v.tile)===null||m===void 0?void 0:m.dem;if(!x)return 0;const E=function(q,H,N){var re=H[0],ce=H[1];return q[0]=N[0]*re+N[4]*ce+N[12],q[1]=N[1]*re+N[5]*ce+N[13],q}([],[n/h*o.EXTENT,l/h*o.EXTENT],v.u_terrain_matrix),C=[E[0]*x.dim,E[1]*x.dim],I=Math.floor(C[0]),P=Math.floor(C[1]),F=C[0]-I,Z=C[1]-P;return x.get(I,P)*(1-F)*(1-Z)+x.get(I+1,P)*F*(1-Z)+x.get(I,P+1)*(1-F)*Z+x.get(I+1,P+1)*F*Z}getElevationForLngLatZoom(t,n){const{tileID:l,mercatorX:h,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(l,h%o.EXTENT,m%o.EXTENT,o.EXTENT)}getElevation(t,n,l,h=o.EXTENT){return this.getDEMElevation(t,n,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,m=new o.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new tt(h,m,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new tt(h,new o.RGBAImage({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const h=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new tt(h,n.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),n.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const l=n&&n+n.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.sourceCache.sourceCache._source.maxzoom;let m=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?m=t.canonical.z-h:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>m<<m),x=t.canonical.y-(t.canonical.y>>m<<m),E=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<m),1/(o.EXTENT<<m),0]);o.translate(E,E,[v*o.EXTENT,x*o.EXTENT,0]),this._demMatrixCache[t.key]={matrix:E,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,l=n.width/devicePixelRatio,h=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new tt(n.context,{width:l,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new tt(n.context,{width:l,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,v=0;m<this._coordsTextureSize;m++)for(let x=0;x<this._coordsTextureSize;x++,v+=4)n[v+0]=255&x,n[v+1]=255&m,n[v+2]=x>>8<<4|m>>8,n[v+3]=0;const l=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),h=new tt(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){const n=new Uint8Array(4),l=this.painter.context,h=l.gl;l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null);const m=n[0]+(n[2]>>4<<8),v=n[1]+((15&n[2])<<8),x=this.coordsIndex[255-n[3]],E=x&&this.sourceCache.getTileByID(x);if(!E)return null;const C=this._coordsTextureSize,I=(1<<E.tileID.canonical.z)*C;return new o.MercatorCoordinate((E.tileID.canonical.x*C+m)/I,(E.tileID.canonical.y*C+v)/I,this.getElevation(E.tileID,m,v,C))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,n=new o.Pos3dArray,l=new o.TriangleIndexArray,h=this.meshSize,m=o.EXTENT/h,v=h*h;for(let P=0;P<=h;P++)for(let F=0;F<=h;F++)n.emplaceBack(F*m,P*m,0);for(let P=0;P<v;P+=h+1)for(let F=0;F<h;F++)l.emplaceBack(F+P,h+F+P+1,h+F+P+2),l.emplaceBack(F+P,h+F+P+2,F+P+1);const x=n.length,E=x+2*(h+1);for(const P of[0,1])for(let F=0;F<=h;F++)for(const Z of[0,1])n.emplaceBack(F*m,P*o.EXTENT,Z);for(let P=0;P<2*h;P+=2)l.emplaceBack(E+P,E+P+1,E+P+3),l.emplaceBack(E+P,E+P+3,E+P+2),l.emplaceBack(x+P,x+P+3,x+P+1),l.emplaceBack(x+P,x+P+2,x+P+3);const C=n.length,I=C+2*(h+1);for(const P of[0,1])for(let F=0;F<=h;F++)for(const Z of[0,1])n.emplaceBack(P*o.EXTENT,F*m,Z);for(let P=0;P<2*h;P+=2)l.emplaceBack(C+P,C+P+1,C+P+3),l.emplaceBack(C+P,C+P+3,C+P+2),l.emplaceBack(I+P,I+P+3,I+P+1),l.emplaceBack(I+P,I+P+2,I+P+3);return this._mesh={indexBuffer:t.createIndexBuffer(l),vertexBuffer:t.createVertexBuffer(n,Yo.members),segments:o.SegmentVector.simpleSegment(0,0,n.length,l.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*o.earthRadius/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,n){var l;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return n&&n.dem&&(l.minElevation=n.dem.min*this.exaggeration,l.maxElevation=n.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,n){const l=o.MercatorCoordinate.fromLngLat(t.wrap()),h=(1<<n)*o.EXTENT,m=l.x*h,v=l.y*h,x=Math.floor(m/o.EXTENT),E=Math.floor(v/o.EXTENT);return{tileID:new o.OverscaledTileID(n,0,n,x,E),mercatorX:m,mercatorY:v}}}class nr{constructor(t,n,l){this._context=t,this._size=n,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new tt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(l.texture),{id:t,fbo:n,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const es={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class an{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new nr(t.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(n)),this._coordsDescendingInv={};for(const l in t.sourceCaches){this._coordsDescendingInv[l]={};const h=t.sourceCaches[l].getVisibleCoordinates();for(const m of h){const v=this.terrain.sourceCache.getTerrainCoords(m);for(const x in v)this._coordsDescendingInv[l][x]||(this._coordsDescendingInv[l][x]=[]),this._coordsDescendingInv[l][x].push(v[x])}}this._coordsDescendingInvStr={};for(const l of t._order){const h=t._layers[l],m=h.source;if(es[h.type]&&!this._coordsDescendingInvStr[m]){this._coordsDescendingInvStr[m]={};for(const v in this._coordsDescendingInv[m])this._coordsDescendingInvStr[m][v]=this._coordsDescendingInv[m][v].map(x=>x.key).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsDescendingInvStr){const m=this._coordsDescendingInvStr[h][l.tileID.key];m&&m!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const n=t.type,l=this.painter,h=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(es[n]&&(this._prevType&&es[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!h))return!0;if(es[this._prevType]||es[n]&&h){this._prevType=n;const m=this._stacks.length-1,v=this._stacks[m]||[];for(const x of this._renderableTiles){if(this.pool.isFull()&&(qo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(x),x.rtt[m]){const C=this.pool.getObjectForId(x.rtt[m].id);if(C.stamp===x.rtt[m].stamp){this.pool.useObject(C);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),x.rtt[m]={id:E.id,stamp:E.stamp},l.context.bindFramebuffer.set(E.fbo.framebuffer),l.context.clear({color:o.Color.transparent,stencil:0}),l.currentStencilSource=void 0;for(let C=0;C<v.length;C++){const I=l.style._layers[v[C]],P=I.source?this._coordsDescendingInv[I.source][x.tileID.key]:[x.tileID];l.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),l._renderTileClippingMasks(I,P),l.renderLayer(l,l.style.sourceCaches[I.source],I,P),I.source&&(x.rttCoords[I.source]=this._coordsDescendingInvStr[I.source][x.tileID.key])}}return qo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),es[n]}return!1}}const Iu=z,co={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Xt=d=>{d.touchstart=d.dragStart,d.touchmoveWindow=d.dragMove,d.touchend=d.dragEnd},hi={showCompass:!0,showZoom:!0,visualizePitch:!1};class gc{constructor(t,n,l=!1){this.mousedown=v=>{this.startMouse(o.extend({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),A.mousePos(this.element,v)),A.addEventListener(window,"mousemove",this.mousemove),A.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,A.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=A.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),A.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=A.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const h=t.dragRotate._mouseRotate.getClickTolerance(),m=t.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=Wo({clickTolerance:h,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:x,bearingDegreesPerPixelMoved:E=.8})=>{const C=new Ha;return new Ts({clickTolerance:x,move:(I,P)=>({bearingDelta:(P.x-I.x)*E}),moveStateManager:C,enable:v,assignEvents:Xt})})({clickTolerance:h,enable:!0}),this.map=t,l&&(this.mousePitch=hc({clickTolerance:m,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:x,pitchDegreesPerPixelMoved:E=-.5})=>{const C=new Ha;return new Ts({clickTolerance:x,move:(I,P)=>({pitchDelta:(P.y-I.y)*E}),moveStateManager:C,enable:v,assignEvents:Xt})})({clickTolerance:m,enable:!0})),A.addEventListener(n,"mousedown",this.mousedown),A.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),A.addEventListener(n,"touchcancel",this.reset)}startMouse(t,n){this.mouseRotate.dragStart(t,n),this.mousePitch&&this.mousePitch.dragStart(t,n),A.disableDrag()}startTouch(t,n){this.touchRotate.dragStart(t,n),this.touchPitch&&this.touchPitch.dragStart(t,n),A.disableDrag()}moveMouse(t,n){const l=this.map,{bearingDelta:h}=this.mouseRotate.dragMove(t,n)||{};if(h&&l.setBearing(l.getBearing()+h),this.mousePitch){const{pitchDelta:m}=this.mousePitch.dragMove(t,n)||{};m&&l.setPitch(l.getPitch()+m)}}moveTouch(t,n){const l=this.map,{bearingDelta:h}=this.touchRotate.dragMove(t,n)||{};if(h&&l.setBearing(l.getBearing()+h),this.touchPitch){const{pitchDelta:m}=this.touchPitch.dragMove(t,n)||{};m&&l.setPitch(l.getPitch()+m)}}off(){const t=this.element;A.removeEventListener(t,"mousedown",this.mousedown),A.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),A.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.removeEventListener(window,"touchend",this.touchend),A.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){A.enableDrag(),A.removeEventListener(window,"mousemove",this.mousemove),A.removeEventListener(window,"mouseup",this.mouseup),A.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.removeEventListener(window,"touchend",this.touchend)}}let zr;function uo(d,t,n){if(d=new o.LngLat(d.lng,d.lat),t){const l=new o.LngLat(d.lng-360,d.lat),h=new o.LngLat(d.lng+360,d.lat),m=n.locationPoint(d).distSqr(t);n.locationPoint(l).distSqr(t)<m?d=l:n.locationPoint(h).distSqr(t)<m&&(d=h)}for(;Math.abs(d.lng-n.center.lng)>180;){const l=n.locationPoint(d);if(l.x>=0&&l.y>=0&&l.x<=n.width&&l.y<=n.height)break;d.lng>n.center.lng?d.lng-=360:d.lng+=360}return d}const ho={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Jo(d,t,n){const l=d.classList;for(const h in ho)l.remove(`maplibregl-${n}-anchor-${h}`);l.add(`maplibregl-${n}-anchor-${t}`)}class po extends o.Evented{constructor(t){if(super(),this._onKeyPress=n=>{const l=n.code,h=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=n=>{const l=n.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=n=>{if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=uo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let l="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?l=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(l=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let h="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?h="rotateX(0deg)":this._pitchAlignment==="map"&&(h=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),A.setTransform(this._element,`${ho[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${h} ${l}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const m=this._map.unproject(this._pos),v=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=m.distanceTo(this._lngLat)>20*v?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=n=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=o.Point.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=A.create("div"),this._element.setAttribute("aria-label","Map marker");const n=A.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${l}px`),n.setAttributeNS(null,"width",`${h}px`),n.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const m=A.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const v=A.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const x=A.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"transform","translate(3.0, 29.0)"),x.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of E){const ce=A.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",re.rx),ce.setAttributeNS(null,"ry",re.ry),x.appendChild(ce)}const C=A.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const I=A.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(I);const P=A.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"opacity","0.25"),P.setAttributeNS(null,"fill","#000000");const F=A.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),P.appendChild(F);const Z=A.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const q=A.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=A.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const N=A.createNS("http://www.w3.org/2000/svg","circle");N.setAttributeNS(null,"fill","#FFFFFF"),N.setAttributeNS(null,"cx","5.5"),N.setAttributeNS(null,"cy","5.5"),N.setAttributeNS(null,"r","5.4999962"),q.appendChild(H),q.appendChild(N),v.appendChild(x),v.appendChild(C),v.appendChild(P),v.appendChild(Z),v.appendChild(q),n.appendChild(v),n.setAttributeNS(null,"height",l*this._scale+"px"),n.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(n),this._offset=o.Point.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Jo(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),A.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=o.Point.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const fo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Cs=0,ts=!1;const nl={maxWidth:100,unit:"metric"};function Qo(d,t,n){const l=n&&n.maxWidth||100,h=d._container.clientHeight/2,m=d.unproject([0,h]),v=d.unproject([l,h]),x=m.distanceTo(v);if(n&&n.unit==="imperial"){const E=3.2808*x;E>5280?is(t,l,E/5280,d._getUIString("ScaleControl.Miles")):is(t,l,E,d._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?is(t,l,x/1852,d._getUIString("ScaleControl.NauticalMiles")):x>=1e3?is(t,l,x/1e3,d._getUIString("ScaleControl.Kilometers")):is(t,l,x,d._getUIString("ScaleControl.Meters"))}function is(d,t,n,l){const h=function(m){const v=Math.pow(10,`${Math.floor(m)}`.length-1);let x=m/v;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:x>=1?1:function(E){const C=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*C)/C}(x),v*x}(n);d.style.width=t*(h/n)+"px",d.innerHTML=`${h}&nbsp;${l}`}const sl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ol=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ea(d){if(d){if(typeof d=="number"){const t=Math.round(Math.abs(d)/Math.SQRT2);return{center:new o.Point(0,0),top:new o.Point(0,d),"top-left":new o.Point(t,t),"top-right":new o.Point(-t,t),bottom:new o.Point(0,-d),"bottom-left":new o.Point(t,-t),"bottom-right":new o.Point(-t,-t),left:new o.Point(d,0),right:new o.Point(-d,0)}}if(d instanceof o.Point||Array.isArray(d)){const t=o.Point.convert(d);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.Point.convert(d.center||[0,0]),top:o.Point.convert(d.top||[0,0]),"top-left":o.Point.convert(d["top-left"]||[0,0]),"top-right":o.Point.convert(d["top-right"]||[0,0]),bottom:o.Point.convert(d.bottom||[0,0]),"bottom-left":o.Point.convert(d["bottom-left"]||[0,0]),"bottom-right":o.Point.convert(d["bottom-right"]||[0,0]),left:o.Point.convert(d.left||[0,0]),right:o.Point.convert(d.right||[0,0])}}return ea(new o.Point(0,0))}const ta={extend:(d,...t)=>o.extend(d,...t),run(d){d()},logToElement(d,t=!1,n="log"){const l=window.document.getElementById(n);l&&(t&&(l.innerHTML=""),l.innerHTML+=`<br>${d}`)}},al=z;class St{static get version(){return al}static get workerCount(){return Yi.workerCount}static set workerCount(t){Yi.workerCount=t}static get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){o.config.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return o.config.WORKER_URL}static set workerUrl(t){o.config.WORKER_URL=t}static addProtocol(t,n){o.config.REGISTERED_PROTOCOLS[t]=n}static removeProtocol(t){delete o.config.REGISTERED_PROTOCOLS[t]}}return St.Map=class extends Cu{constructor(d){if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(d=o.extend({},co,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Go(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),{bearingSnap:d.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=d.interactive,this._cooperativeGestures=d.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=d.maxTileCacheSize,this._maxTileCacheZoomLevels=d.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new We,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},et,d.locale),this._clickTolerance=d.clickTolerance,this._overridePixelRatio=d.pixelRatio,this._maxCanvasSize=d.maxCanvasSize,this.transformCameraUpdate=d.transformCameraUpdate,this._imageQueueHandle=De.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ne(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const n=zn(l=>{this._trackResize&&!this._removed&&this.resize(l)._update()},50);this._resizeObserver=new ResizeObserver(l=>{t?n(l):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new mc(this,d),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=d.hash&&new oc(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,o.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,this._validateStyle=d.validateStyle,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Nr({customAttribution:d.customAttribution})),d.maplibreLogo&&this.addControl(new lo,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new o.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new o.Event(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new o.Event("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=d.onAdd(this);this._controls.push(d);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(n,l.firstChild):l.appendChild(n),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,t,n,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,t,n,l)}resize(d){var t;const n=this._containerDimensions(),l=n[0],h=n[1],m=this._getClampedPixelRatio(l,h);if(this._resizeCanvas(l,h,m),this.painter.resize(l,h,m),this.painter.overLimit()){const x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];const E=this._getClampedPixelRatio(l,h);this._resizeCanvas(l,h,E),this.painter.resize(l,h,E)}this.transform.resize(l,h),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,h);const v=!this._moving;return v&&(this.stop(),this.fire(new o.Event("movestart",d)).fire(new o.Event("move",d))),this.fire(new o.Event("resize",d)),v&&this.fire(new o.Event("moveend",d)),this}_getClampedPixelRatio(d,t){const{0:n,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),m=d*h,v=t*h;return Math.min(m>n?n/m:1,v>l?l/v:1)*h}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(kt.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(d){return this.transform.locationPoint(o.LngLat.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.pointLocation(o.Point.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,t,n){if(d==="mouseenter"||d==="mouseover"){let l=!1;return{layer:t,listener:n,delegates:{mousemove:m=>{const v=this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[];v.length?l||(l=!0,n.call(this,new bi(d,this,m.originalEvent,{features:v}))):l=!1},mouseout:()=>{l=!1}}}}if(d==="mouseleave"||d==="mouseout"){let l=!1;return{layer:t,listener:n,delegates:{mousemove:v=>{(this.getLayer(t)?this.queryRenderedFeatures(v.point,{layers:[t]}):[]).length?l=!0:l&&(l=!1,n.call(this,new bi(d,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,n.call(this,new bi(d,this,v.originalEvent)))}}}}{const l=h=>{const m=this.getLayer(t)?this.queryRenderedFeatures(h.point,{layers:[t]}):[];m.length&&(h.features=m,n.call(this,h),delete h.features)};return{layer:t,listener:n,delegates:{[d]:l}}}}on(d,t,n){if(n===void 0)return super.on(d,t);const l=this._createDelegatedListener(d,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(l);for(const h in l.delegates)this.on(h,l.delegates[h]);return this}once(d,t,n){if(n===void 0)return super.once(d,t);const l=this._createDelegatedListener(d,t,n);for(const h in l.delegates)this.once(h,l.delegates[h]);return this}off(d,t,n){return n===void 0?super.off(d,t):(this._delegatedListeners&&this._delegatedListeners[d]&&(l=>{const h=this._delegatedListeners[d];for(let m=0;m<h.length;m++){const v=h[m];if(v.layer===t&&v.listener===n){for(const x in v.delegates)this.off(x,v.delegates[x]);return h.splice(m,1),this}}})(),this)}queryRenderedFeatures(d,t){if(!this.style)return[];let n;const l=d instanceof o.Point||Array.isArray(d),h=l?d:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:d)||{},h instanceof o.Point||typeof h[0]=="number")n=[o.Point.convert(h)];else{const m=o.Point.convert(h[0]),v=o.Point.convert(h[1]);n=[m,new o.Point(v.x,m.y),v,new o.Point(m.x,v.y),m]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(d,t){return this.style.querySourceFeatures(d,t)}setStyle(d,t){return(t=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(d,t))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,t));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new Ni(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,t,n):this.style.loadJSON(d,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ni(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,t){if(typeof d=="string"){const n=this._requestManager.transformRequest(d,Se.Style);o.getJSON(n,(l,h)=>{l?this.fire(new o.ErrorEvent(l)):h&&this._updateDiff(h,t)})}else typeof d=="object"&&this._updateDiff(d,t)}_updateDiff(d,t){try{this.style.setState(d,t)&&this._update(!0)}catch(n){o.warnOnce(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(d,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(d,t){return this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)}isSourceLoaded(d){const t=this.style&&this.style.sourceCaches[d];if(t!==void 0)return t.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const t=this.style.sourceCaches[d.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);for(const n in this.style._layers){const l=this.style._layers[n];l.type==="hillshade"&&l.source===d.source&&o.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new rl(this.painter,t,d),this.painter.renderToTexture=new an(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==d.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.Event("terrain",{terrain:d})),this}getTerrain(){var d,t;return(t=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const t in d){const n=d[t]._tiles;for(const l in n){const h=n[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}addSourceType(d,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,n)}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,t,n={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:m,stretchY:v,content:x}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||o.isImageBitmap(t))){if(t.width===void 0||t.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:C,data:I}=t,P=t;return this.style.addImage(d,{data:new o.RGBAImage({width:E,height:C},new Uint8Array(I)),pixelRatio:l,stretchX:m,stretchY:v,content:x,sdf:h,version:0,userImage:P}),P.onAdd&&P.onAdd(this,d),this}}{const{width:E,height:C,data:I}=o.browser.getImageData(t);this.style.addImage(d,{data:new o.RGBAImage({width:E,height:C},I),pixelRatio:l,stretchX:m,stretchY:v,content:x,sdf:h,version:0})}}updateImage(d,t){const n=this.style.getImage(d);if(!n)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||o.isImageBitmap(t)?o.browser.getImageData(t):t,{width:h,height:m,data:v}=l;if(h===void 0||m===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==n.data.width||m!==n.data.height)return this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const x=!(t instanceof HTMLImageElement||o.isImageBitmap(t));return n.data.replace(v,x),this.style.updateImage(d,n),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,t){De.getImage(this._requestManager.transformRequest(d,Se.Image),t)}listImages(){return this.style.listImages()}addLayer(d,t){return this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)}moveLayer(d,t){return this.style.moveLayer(d,t),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,t,n){return this.style.setLayerZoomRange(d,t,n),this._update(!0)}setFilter(d,t,n={}){return this.style.setFilter(d,t,n),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,t,n,l={}){return this.style.setPaintProperty(d,t,n,l),this._update(!0)}getPaintProperty(d,t){return this.style.getPaintProperty(d,t)}setLayoutProperty(d,t,n,l={}){return this.style.setLayoutProperty(d,t,n,l),this._update(!0)}getLayoutProperty(d,t){return this.style.getLayoutProperty(d,t)}setGlyphs(d,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,t,n,l=>{l||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,t,n=>{n||this._update(!0)}),this}setLight(d,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(d,t){return this.style.setFeatureState(d,t),this._update()}removeFeatureState(d,t){return this.style.removeFeatureState(d,t),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,t=0;return this._container&&(d=this._container.clientWidth||400,t=this._container.clientHeight||300),[d,t]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const t=this._canvasContainer=A.create("div","maplibregl-canvas-container",d);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=A.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),l=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],l);const h=this._controlContainer=A.create("div","maplibregl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=A.create("div",`maplibregl-ctrl-${v} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=A.create("div","maplibregl-cooperative-gesture-screen",this._container);let d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${d}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){A.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(d,t,n){this._canvas.width=Math.floor(n*d),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const d={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:d},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});const n=this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d);if(!n){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new sc(n,this.transform),G.testSupport(n)}_onCooperativeGesture(d,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const h=this.transform.zoom,m=o.browser.now();this.style.zoomHistory.update(h,m);const v=new o.EvaluationParameters(h,{now:m,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),x=v.crossFadingFactor();x===1&&x===this._crossFadingFactor||(n=!0,this._crossFadingFactor=x),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),De.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),A.remove(this._canvasContainer),A.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.browser.frame(d=>{o.PerformanceUtils.frame(d),this._frame=null,this._render(d)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return Iu}getCameraTargetElevation(){return this.transform.elevation}},St.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,n)=>{const l=this._map._getUIString(`NavigationControl.${n}`);t.title=l,t.setAttribute("aria-label",l)},this.options=o.extend({},hi,d),this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),A.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),A.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=A.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){A.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,t){const n=A.create("button",d,this._container);return n.type="button",n.addEventListener("click",t),n}},St.GeolocateControl=class extends o.Evented{constructor(d){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.Event("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new o.LngLat(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),m=o.extend({bearing:h},this.options.fitBoundsOptions),v=kt.fromLngLat(n,l);this._map.fitBounds(v,m,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new o.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ts)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.Event("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=A.create("button","maplibregl-ctrl-geolocate",this._container),A.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=A.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new po({element:this._dotElement}),this._circleElement=A.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new po({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}},this.options=o.extend({},fo,d)}onAdd(d){return this._map=d,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,n=!1){zr===void 0||n?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(l=>{zr=l.state!=="denied",t(zr)}).catch(()=>{zr=!!window.navigator.geolocation,t(zr)}):(zr=!!window.navigator.geolocation,t(zr)):t(zr)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),A.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Cs=0,ts=!1}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),n=d.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const d=this._map.getBounds(),t=d.getSouthEast(),n=d.getNorthEast(),l=t.distanceTo(n),h=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Cs--,ts=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Cs++,Cs>1?(d={maximumAge:6e5,timeout:0},ts=!0):(d=this.options.positionOptions,ts=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},St.AttributionControl=Nr,St.LogoControl=lo,St.ScaleControl=class{constructor(d){this._onMove=()=>{Qo(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Qo(this._map,this._container,this.options)},this.options=o.extend({},nl,d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){A.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},St.FullscreenControl=class extends o.Evented{constructor(d={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){A.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=A.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);A.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new o.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},St.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=d}onAdd(d){return this._map=d,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=A.create("button","maplibregl-ctrl-terrain",this._container),A.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){A.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},St.Popup=class extends o.Evented{constructor(d){super(),this.remove=()=>(this._content&&A.remove(this._content),this._container&&(A.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=A.create("div","maplibregl-popup",this._map.getContainer()),this._tip=A.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=uo(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const n=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let l=this.options.anchor;const h=ea(this.options.offset);if(!l){const v=this._container.offsetWidth,x=this._container.offsetHeight;let E;E=n.y+h.bottom.y<x?["top"]:n.y>this._map.transform.height-x?["bottom"]:[],n.x<v/2?E.push("left"):n.x>this._map.transform.width-v/2&&E.push("right"),l=E.length===0?"bottom":E.join("-")}const m=n.add(h[l]).round();A.setTransform(this._container,`${ho[l]} translate(${m.x}px,${m.y}px)`),Jo(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=o.extend(Object.create(sl),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=o.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const t=document.createDocumentFragment(),n=document.createElement("body");let l;for(n.innerHTML=d;l=n.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=A.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){this._container&&this._container.classList.add(d)}removeClassName(d){this._container&&this._container.classList.remove(d)}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}_createCloseButton(){this.options.closeButton&&(this._closeButton=A.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(ol);d&&d.focus()}},St.Marker=po,St.Style=Ni,St.LngLat=o.LngLat,St.LngLatBounds=kt,St.Point=o.Point,St.MercatorCoordinate=o.MercatorCoordinate,St.Evented=o.Evented,St.AJAXError=o.AJAXError,St.config=o.config,St.CanvasSource=me,St.GeoJSONSource=Oi,St.ImageSource=mr,St.RasterDEMTileSource=Rt,St.RasterTileSource=ot,St.VectorTileSource=Be,St.VideoSource=Vr,St.setRTLTextPlugin=o.setRTLTextPlugin,St.getRTLTextPluginStatus=o.getRTLTextPluginStatus,St.prewarm=function(){An().acquire(Me)},St.clearPrewarmedResources=function(){const d=fn;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Me),fn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},ta.extend(St,{isSafari:o.isSafari,getPerformanceMetrics:o.PerformanceUtils.getPerformanceMetrics}),St});var M=w;return M})})(Nf);var Iv=Nf.exports;const Ul=If(Iv);function Gp(a){let u,p;return u=new H_({props:{$$slots:{default:[Av]},$$scope:{ctx:a}}}),u.$on("click",a[5]),{c(){ds(u.$$.fragment)},m(_,w){Nn(u,_,w),p=!0},p(_,w){const T={};w&128&&(T.$$scope={dirty:w,ctx:_}),u.$set(T)},i(_){p||(At(u.$$.fragment,_),p=!0)},o(_){jt(u.$$.fragment,_),p=!1},d(_){jn(u,_)}}}function Av(a){let u;return{c(){u=Rs("X")},m(p,_){Ii(p,u,_)},d(p){p&&ni(u)}}}function kv(a){let u,p,_,w,T,M,o,z,A,G,j=a[2]&&Gp(a);const fe=a[4].default,ge=Ta(fe,a,a[7],null);return{c(){u=Ci("div"),p=Ci("div"),_=Ci("div"),w=Ci("h1"),T=Rs(a[1]),M=Yr(),j&&j.c(),o=Yr(),ge&&ge.c(),Ft(w,"class","govuk-heading-l"),kp(_,"display","flex"),kp(_,"justify-content","space-between"),Ft(p,"class","content centered-fullscreen svelte-stcgp5"),Ft(u,"class","background svelte-stcgp5"),Vn(u,"open",a[0]),Vn(u,"closed",!a[0])},m(he,Ce){Ii(he,u,Ce),mi(u,p),mi(p,_),mi(_,w),mi(w,T),mi(_,M),j&&j.m(_,null),mi(p,o),ge&&ge.m(p,null),z=!0,A||(G=[Pl(p,"click",u_(Mv)),Pl(u,"click",a[6])],A=!0)},p(he,[Ce]){(!z||Ce&2)&&zl(T,he[1]),he[2]?j?(j.p(he,Ce),Ce&4&&At(j,1)):(j=Gp(he),j.c(),At(j,1),j.m(_,null)):j&&(Bl(),jt(j,1,1,()=>{j=null}),Rl()),ge&&ge.p&&(!z||Ce&128)&&Ca(ge,fe,he,he[7],z?Sa(fe,he[7],Ce,null):Ia(he[7]),null),(!z||Ce&1)&&Vn(u,"open",he[0]),(!z||Ce&1)&&Vn(u,"closed",!he[0])},i(he){z||(At(j),At(ge,he),z=!0)},o(he){jt(j),jt(ge,he),z=!1},d(he){he&&ni(u),j&&j.d(),ge&&ge.d(he),A=!1,fs(G)}}}const Mv=()=>null;function Pv(a,u,p){let{$$slots:_={},$$scope:w}=u,{title:T}=u,{open:M=!1}=u,{displayEscapeButton:o=!0}=u,{canCloseByClickingBackground:z=!0}=u;const A=()=>p(0,M=!1),G=()=>{z&&p(0,M=!1)};return a.$$set=j=>{"title"in j&&p(1,T=j.title),"open"in j&&p(0,M=j.open),"displayEscapeButton"in j&&p(2,o=j.displayEscapeButton),"canCloseByClickingBackground"in j&&p(3,z=j.canCloseByClickingBackground),"$$scope"in j&&p(7,w=j.$$scope)},[M,T,o,z,_,A,G,w]}class R0 extends Qr{constructor(u){super(),Jr(this,u,Pv,kv,Rr,{title:1,open:0,displayEscapeButton:2,canCloseByClickingBackground:3})}}/*! js-cookie v3.0.5 | MIT */function Uc(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var _ in p)a[_]=p[_]}return a}var Lv={read:function(a){return a[0]==='"'&&(a=a.slice(1,-1)),a.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(a){return encodeURIComponent(a).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Ih(a,u){function p(w,T,M){if(!(typeof document>"u")){M=Uc({},u,M),typeof M.expires=="number"&&(M.expires=new Date(Date.now()+M.expires*864e5)),M.expires&&(M.expires=M.expires.toUTCString()),w=encodeURIComponent(w).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var z in M)M[z]&&(o+="; "+z,M[z]!==!0&&(o+="="+M[z].split(";")[0]));return document.cookie=w+"="+a.write(T,w)+o}}function _(w){if(!(typeof document>"u"||arguments.length&&!w)){for(var T=document.cookie?document.cookie.split("; "):[],M={},o=0;o<T.length;o++){var z=T[o].split("="),A=z.slice(1).join("=");try{var G=decodeURIComponent(z[0]);if(M[G]=a.read(A,G),w===G)break}catch{}}return w?M[w]:M}}return Object.create({set:p,get:_,remove:function(w,T){p(w,"",Uc({},T,{expires:-1}))},withAttributes:function(w){return Ih(this.converter,Uc({},this.attributes,w))},withConverter:function(w){return Ih(Uc({},this.converter,w),this.attributes)}},{attributes:{value:Object.freeze(u)},converter:{value:Object.freeze(a)}})}var zv=Ih(Lv,{path:"/"});function Dv(a){let u,p,_,w;const T=[Rv,Bv],M=[];function o(z,A){return z[0]?0:1}return u=o(a),p=M[u]=T[u](a),{c(){p.c(),_=Jc()},m(z,A){M[u].m(z,A),Ii(z,_,A),w=!0},p(z,A){p.p(z,A)},i(z){w||(At(p),w=!0)},o(z){jt(p),w=!1},d(z){z&&ni(_),M[u].d(z)}}}function Bv(a){let u,p;return u=new V_({props:{errorMessage:"You shouldn't be able to view this app without being logged in!"}}),{c(){ds(u.$$.fragment)},m(_,w){Nn(u,_,w),p=!0},p:Wi,i(_){p||(At(u.$$.fragment,_),p=!0)},o(_){jt(u.$$.fragment,_),p=!1},d(_){jn(u,_)}}}function Rv(a){let u;return{c(){u=Ci("p"),u.textContent=`Logged in as ${a[0]}`},m(p,_){Ii(p,u,_)},p:Wi,i:Wi,o:Wi,d(p){p&&ni(u)}}}function Fv(a){let u=sm()=="Private (development)",p,_,w=u&&Dv(a);return{c(){w&&w.c(),p=Jc()},m(T,M){w&&w.m(T,M),Ii(T,p,M),_=!0},p(T,[M]){u&&w.p(T,M)},i(T){_||(At(w),_=!0)},o(T){jt(w),_=!1},d(T){T&&ni(p),w&&w.d(T)}}}function Ov(a){return[zv.get("email")]}class F0 extends Qr{constructor(u){super(),Jr(this,u,Ov,Fv,Rr,{})}}let Uv=Date.now();function O0(a){return`${a}-${Uv++}`}const qh=Symbol.for("svelte-maplibre");function Vl(){return x_(qh)}function Vv(){let a=new WeakMap;return u=>{var T;let p=a.get(u.originalEvent);if(p!==void 0)return p;let w=(T=u.target.queryRenderedFeatures(u.point)[0])==null?void 0:T.layer.id;return a.set(u.originalEvent,w),w}}function Nv(){return Ph(qh,{map:Si(null),source:vh(null),layer:vh(null),popupTarget:vh(null),cluster:Si(),loadedImages:Si(new Set),minzoom:Si(0),maxzoom:Si(24),layerEvent:Si(null),eventTopMost:Vv()})}function Hp(a){return{subscribe:a.subscribe}}function qf({key:a,setPopupTarget:u=!1,setCluster:p=!1,setMouseEvent:_=!1}){let w=Vl(),T=Si(null),M=Hp(T),o={...w,[a]:Hp(T)};if(u&&(o.popupTarget=M),_){let z=Si(null);o.layerEvent=z,w.layerEvent=z}return p&&(o.cluster=Si()),Ph(qh,o),{...w,self:T}}function U0(){return qf({key:"source",setCluster:!0})}function V0(){return qf({key:"layer",setPopupTarget:!0,setMouseEvent:!0})}var jv=qv;function qv(a){var u,p,_;if(a){if(Array.isArray(a)){for(u=[],p=a.length,_=0;_<p;_++){var w=a[_];w!=null&&u.push(w)}return u}if(typeof a=="object"){u={};var T=Object.keys(a);for(p=T.length,_=0;_<p;_++){var M=T[_],o=a[M];o!=null&&(u[M]=o)}return u}}}function Zv(a,u,p){let _;const{map:w}=Vl();Ea(a,w,z=>p(4,_=z));let{position:T="top-left"}=u,{container:M=void 0}=u,o=null;return Qc(()=>{_!=null&&_.loaded()&&o&&_.removeControl(o)}),a.$$set=z=>{"position"in z&&p(1,T=z.position),"container"in z&&p(2,M=z.container)},a.$$.update=()=>{if(a.$$.dirty&30&&_&&!o){let z;typeof M=="string"?z=document.querySelector(M)??void 0:z=M,p(3,o=new Ul.FullscreenControl({container:z})),_.addControl(o,T)}},[w,T,M,o,_]}class $v extends Qr{constructor(u){super(),Jr(this,u,Zv,null,Rr,{position:1,container:2})}}function Gv(a,u,p){let _;const{map:w}=Vl();Ea(a,w,fe=>p(8,_=fe));let{position:T="top-left"}=u,{positionOptions:M=void 0}=u,{fitBoundsOptions:o=void 0}=u,{trackUserLocation:z=!1}=u,{showAccuracyCircle:A=!0}=u,{showUserLocation:G=!0}=u,j=null;return Qc(()=>{_!=null&&_.loaded()&&j&&_.removeControl(j)}),a.$$set=fe=>{"position"in fe&&p(1,T=fe.position),"positionOptions"in fe&&p(2,M=fe.positionOptions),"fitBoundsOptions"in fe&&p(3,o=fe.fitBoundsOptions),"trackUserLocation"in fe&&p(4,z=fe.trackUserLocation),"showAccuracyCircle"in fe&&p(5,A=fe.showAccuracyCircle),"showUserLocation"in fe&&p(6,G=fe.showUserLocation)},a.$$.update=()=>{a.$$.dirty&510&&_&&!j&&(p(7,j=new Ul.GeolocateControl({positionOptions:M,fitBoundsOptions:o,trackUserLocation:z,showAccuracyCircle:A,showUserLocation:G})),_.addControl(j,T))},[w,T,M,o,z,A,G,j,_]}class Hv extends Qr{constructor(u){super(),Jr(this,u,Gv,null,Rr,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function Wv(a){let u=a.getCenter(),p=Math.round(a.getZoom()*100)/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,_),T=Math.round(u.lat*w)/w,M=Math.round(u.lng*w)/w,o=`${p}/${T}/${M}`,z=a.getBearing(),A=a.getPitch();return(z||A)&&(o+=`/${Math.round(z*10)/10}`),A&&(o+=`/${Math.round(A)}`),`#${o}`}function Xv(a){return a.replace("#","").split("/").map(parseFloat)}var Vc=Zh;function Zh(a,u){return a===u||a!==a&&u!==u?!0:typeof a!=typeof u||{}.toString.call(a)!={}.toString.call(u)||a!==Object(a)||!a?!1:Array.isArray(a)?Wp(a,u):{}.toString.call(a)=="[object Set]"?Wp(Array.from(a),Array.from(u)):{}.toString.call(a)=="[object Object]"?Yv(a,u):Kv(a,u)}function Kv(a,u){return a.toString()===u.toString()}function Wp(a,u){var p=a.length;if(p!=u.length)return!1;for(var _=0;_<p;_++)if(!Zh(a[_],u[_]))return!1;return!0}function Yv(a,u){var p=Object.keys(a),_=p.length;if(_!=Object.keys(u).length)return!1;for(var w=0;w<_;w++){var T=p[w];if(!(u.hasOwnProperty(T)&&Zh(a[T],u[T])))return!1}return!0}function Jv(a,u,p){let _;const{map:w}=Vl();Ea(a,w,G=>p(6,_=G));let{position:T="top-left"}=u,{showCompass:M=!0}=u,{showZoom:o=!0}=u,{visualizePitch:z=!1}=u,A=null;return Qc(()=>{_!=null&&_.loaded()&&A&&_.removeControl(A)}),a.$$set=G=>{"position"in G&&p(1,T=G.position),"showCompass"in G&&p(2,M=G.showCompass),"showZoom"in G&&p(3,o=G.showZoom),"visualizePitch"in G&&p(4,z=G.visualizePitch)},a.$$.update=()=>{a.$$.dirty&126&&_&&!A&&(p(5,A=new Ul.NavigationControl({showCompass:M,showZoom:o,visualizePitch:z})),_.addControl(A,T))},[w,T,M,o,z,A,_]}class Zf extends Qr{constructor(u){super(),Jr(this,u,Jv,null,Rr,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function Qv(a,u,p){let _;const{map:w}=Vl();Ea(a,w,A=>p(5,_=A));let{position:T="bottom-left"}=u,{maxWidth:M=void 0}=u,{unit:o="metric"}=u,z=null;return Qc(()=>{_!=null&&_.loaded()&&z&&_.removeControl(z)}),a.$$set=A=>{"position"in A&&p(1,T=A.position),"maxWidth"in A&&p(2,M=A.maxWidth),"unit"in A&&p(3,o=A.unit)},a.$$.update=()=>{a.$$.dirty&62&&_&&!z&&(p(4,z=new Ul.ScaleControl({maxWidth:M,unit:o})),_.addControl(z,T))},[w,T,M,o,z,_]}class $f extends Qr{constructor(u){super(),Jr(this,u,Qv,null,Rr,{position:1,maxWidth:2,unit:3})}}const ex=a=>({map:a[0]&8,loadedImages:a[0]&16,allImagesLoaded:a[0]&32}),Xp=a=>({map:a[3],loadedImages:a[4],allImagesLoaded:a[5]});function Kp(a){let u,p,_=a[2]&&Yp(a);const w=a[33].default,T=Ta(w,a,a[32],Xp);return{c(){_&&_.c(),u=Yr(),T&&T.c()},m(M,o){_&&_.m(M,o),Ii(M,u,o),T&&T.m(M,o),p=!0},p(M,o){M[2]?_?(_.p(M,o),o[0]&4&&At(_,1)):(_=Yp(M),_.c(),At(_,1),_.m(u.parentNode,u)):_&&(Bl(),jt(_,1,1,()=>{_=null}),Rl()),T&&T.p&&(!p||o[0]&56|o[1]&2)&&Ca(T,w,M,M[32],p?Sa(w,M[32],o,ex):Ia(M[32]),Xp)},i(M){p||(At(_),At(T,M),p=!0)},o(M){jt(_),jt(T,M),p=!1},d(M){M&&ni(u),_&&_.d(M),T&&T.d(M)}}}function Yp(a){let u,p,_,w,T,M,o,z;return u=new Zf({props:{position:a[6]}}),_=new Hv({props:{position:a[6],fitBoundsOptions:{maxZoom:12}}}),T=new $v({props:{position:a[6]}}),o=new $f({props:{position:a[6]}}),{c(){ds(u.$$.fragment),p=Yr(),ds(_.$$.fragment),w=Yr(),ds(T.$$.fragment),M=Yr(),ds(o.$$.fragment)},m(A,G){Nn(u,A,G),Ii(A,p,G),Nn(_,A,G),Ii(A,w,G),Nn(T,A,G),Ii(A,M,G),Nn(o,A,G),z=!0},p(A,G){const j={};G[0]&64&&(j.position=A[6]),u.$set(j);const fe={};G[0]&64&&(fe.position=A[6]),_.$set(fe);const ge={};G[0]&64&&(ge.position=A[6]),T.$set(ge);const he={};G[0]&64&&(he.position=A[6]),o.$set(he)},i(A){z||(At(u.$$.fragment,A),At(_.$$.fragment,A),At(T.$$.fragment,A),At(o.$$.fragment,A),z=!0)},o(A){jt(u.$$.fragment,A),jt(_.$$.fragment,A),jt(T.$$.fragment,A),jt(o.$$.fragment,A),z=!1},d(A){A&&(ni(p),ni(w),ni(M)),jn(u,A),jn(_,A),jn(T,A),jn(o,A)}}}function tx(a){let u,p,_,w,T,M=a[3]&&a[0]&&Kp(a);return{c(){u=Ci("div"),M&&M.c(),Ft(u,"class",p=Sp(a[1])+" svelte-p00lfq"),Vn(u,"expand-map",!a[1])},m(o,z){Ii(o,u,z),M&&M.m(u,null),_=!0,w||(T=r_(a[9].call(null,u)),w=!0)},p(o,z){o[3]&&o[0]?M?(M.p(o,z),z[0]&9&&At(M,1)):(M=Kp(o),M.c(),At(M,1),M.m(u,null)):M&&(Bl(),jt(M,1,1,()=>{M=null}),Rl()),(!_||z[0]&2&&p!==(p=Sp(o[1])+" svelte-p00lfq"))&&Ft(u,"class",p),(!_||z[0]&2)&&Vn(u,"expand-map",!o[1])},i(o){_||(At(M),_=!0)},o(o){jt(M),_=!1},d(o){o&&ni(u),M&&M.d(),w=!1,T()}}}function ix(a,u,p){let _,w,T,M,{$$slots:o={},$$scope:z}=u,{map:A=null}=u,{class:G=void 0}=u,{style:j}=u,{diffStyleUpdates:fe=!1}=u,{center:ge=void 0}=u,{zoom:he=void 0}=u,{pitch:Ce=0}=u,{bearing:De=0}=u,{bounds:Se=void 0}=u,{hash:Ne=!1}=u,{loaded:Ue=!1}=u,{minZoom:lt=0}=u,{maxZoom:pt=22}=u,{zoomOnDoubleClick:ht=!0}=u,{interactive:st=!0}=u,{attributionControl:xt=!0}=u,{preserveDrawingBuffer:_t=!1}=u,{maxBounds:tt=void 0}=u,{images:gi=[]}=u,{standardControls:Zt=!1}=u,{filterLayers:_i=void 0}=u,{transformRequest:fr=void 0}=u;const $t=v_(),{map:yi,loadedImages:er}=Nv();Ea(a,yi,Be=>p(3,T=Be)),Ea(a,er,Be=>p(4,M=Be));let Jt=new Set;function en(Be){T!=null&&T.loaded()&&("url"in Be?(Jt.add(Be.id),T.loadImage(Be.url,(ot,Rt)=>{Jt.delete(Be.id),ot?$t("error",ot):Rt&&(T==null||T.addImage(Be.id,Rt,Be.options),M.add(Be.id),er.set(M))})):(T.addImage(Be.id,Be.data,Be.options),M.add(Be.id),er.set(M)))}let Ur,Fi,oi,vi;function kt(Be){if(Ne){let ot=Xv(window.location.hash);ot.length>=3&&(p(11,he=ot[0]),p(10,ge=[ot[2],ot[1]])),ot.length==5&&(p(15,De=ot[3]),p(14,Ce=ot[4]))}return Cp(yi,T=new Ul.Map(jv({container:Be,style:j,center:ge,zoom:he,pitch:Ce,bearing:De,minZoom:lt,maxZoom:pt,interactive:st,preserveDrawingBuffer:_t,maxBounds:tt,bounds:Se,attributionControl:xt,transformRequest:fr})),T),T.on("load",ot=>{p(0,Ue=!0),$t("load",T)}),T.on("error",ot=>$t("error",{...ot,map:T})),T.on("movestart",ot=>$t("movestart",{...ot,map:T})),T.on("moveend",ot=>{if(p(10,ge=ot.target.getCenter()),p(11,he=ot.target.getZoom()),p(12,Se=ot.target.getBounds()),$t("moveend",{...ot,map:T}),Ne){let Rt=window.location.href.replace(/(#.+)?$/,Wv(T));window.history.replaceState(window.history.state,"",Rt)}}),T.on("zoomstart",ot=>$t("zoomstart",{...ot,map:T})),T.on("zoom",ot=>{p(11,he=ot.target.getZoom()),$t("zoom",{...ot,map:T})}),T.on("zoomend",ot=>{p(11,he=ot.target.getZoom()),$t("zoomend",{...ot,map:T})}),T.on("style.load",()=>{if(T){const ot=T.getStyle();if(p(29,Ur=ot.layers.map(Rt=>Rt.id)),p(30,Fi=Object.keys(ot.sources)),vi)for(const[Rt,Oi]of Object.entries(vi))T.addSource(Rt,Oi);if(oi)for(const Rt of oi)T.addLayer(Rt)}}),T.on("styledata",ot=>{if(T&&_i){const Rt=T.getStyle().layers;if(Rt)for(let Oi of Rt)_i(Oi)||T.setLayoutProperty(Oi.id,"visibility","none")}$t("styledata",{...ot,map:T})}),{destroy(){p(0,Ue=!1),T==null||T.remove(),Cp(yi,T=null,T)}}}let Xi=j;return a.$$set=Be=>{"map"in Be&&p(13,A=Be.map),"class"in Be&&p(1,G=Be.class),"style"in Be&&p(16,j=Be.style),"diffStyleUpdates"in Be&&p(17,fe=Be.diffStyleUpdates),"center"in Be&&p(10,ge=Be.center),"zoom"in Be&&p(11,he=Be.zoom),"pitch"in Be&&p(14,Ce=Be.pitch),"bearing"in Be&&p(15,De=Be.bearing),"bounds"in Be&&p(12,Se=Be.bounds),"hash"in Be&&p(18,Ne=Be.hash),"loaded"in Be&&p(0,Ue=Be.loaded),"minZoom"in Be&&p(19,lt=Be.minZoom),"maxZoom"in Be&&p(20,pt=Be.maxZoom),"zoomOnDoubleClick"in Be&&p(21,ht=Be.zoomOnDoubleClick),"interactive"in Be&&p(22,st=Be.interactive),"attributionControl"in Be&&p(23,xt=Be.attributionControl),"preserveDrawingBuffer"in Be&&p(24,_t=Be.preserveDrawingBuffer),"maxBounds"in Be&&p(25,tt=Be.maxBounds),"images"in Be&&p(26,gi=Be.images),"standardControls"in Be&&p(2,Zt=Be.standardControls),"filterLayers"in Be&&p(27,_i=Be.filterLayers),"transformRequest"in Be&&p(28,fr=Be.transformRequest),"$$scope"in Be&&p(32,z=Be.$$scope)},a.$$.update=()=>{if(a.$$.dirty[0]&4&&p(6,_=typeof Zt=="boolean"?void 0:Zt),a.$$.dirty[0]&8&&p(13,A=T),a.$$.dirty[0]&67108873&&Ue&&T!=null&&T.loaded())for(let Be of gi)!Jt.has(Be.id)&&!T.hasImage(Be.id)&&en(Be);if(a.$$.dirty[0]&67108880&&p(5,w=gi.every(Be=>M.has(Be.id))),a.$$.dirty[0]&1610809352|a.$$.dirty[1]&1&&T&&!Vc(j,Xi)){const Be=T.getStyle();if(Ur&&(oi=Be.layers.filter(ot=>!Ur.includes(ot.id))),Fi){const ot=Object.keys(Be.sources).filter(Rt=>!Fi.includes(Rt));vi={};for(const Rt of ot)vi[Rt]=Be.sources[Rt]}p(31,Xi=j),T.setStyle(j,{diff:fe})}a.$$.dirty[0]&1032&&ge&&!Vc(ge,T==null?void 0:T.getCenter())&&(T==null||T.panTo(ge)),a.$$.dirty[0]&2056&&he&&!Vc(he,T==null?void 0:T.getZoom())&&(T==null||T.zoomTo(he)),a.$$.dirty[0]&4104&&Se&&!Vc(Se,T==null?void 0:T.getBounds())&&(T==null||T.fitBounds(Se)),a.$$.dirty[0]&2097160&&(ht?T==null||T.doubleClickZoom.enable():T==null||T.doubleClickZoom.disable())},[Ue,G,Zt,T,M,w,_,yi,er,kt,ge,he,Se,A,Ce,De,j,fe,Ne,lt,pt,ht,st,xt,_t,tt,gi,_i,fr,Ur,Fi,Xi,z,o]}class rx extends Qr{constructor(u){super(),Jr(this,u,ix,tx,Rr,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,interactive:22,attributionControl:23,preserveDrawingBuffer:24,maxBounds:25,images:26,standardControls:2,filterLayers:27,transformRequest:28},null,[-1,-1])}}var Ir=(a,u,p)=>new Promise((_,w)=>{var T=z=>{try{o(p.next(z))}catch(A){w(A)}},M=z=>{try{o(p.throw(z))}catch(A){w(A)}},o=z=>z.done?_(z.value):Promise.resolve(z.value).then(T,M);o((p=p.apply(a,u)).next())}),Kr=Uint8Array,ya=Uint16Array,nx=Int32Array,Gf=new Kr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Hf=new Kr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),sx=new Kr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Wf=function(a,u){for(var p=new ya(31),_=0;_<31;++_)p[_]=u+=1<<a[_-1];for(var w=new nx(p[30]),_=1;_<30;++_)for(var T=p[_];T<p[_+1];++T)w[T]=T-p[_]<<5|_;return{b:p,r:w}},Xf=Wf(Gf,2),Kf=Xf.b,ox=Xf.r;Kf[28]=258,ox[258]=28;var ax=Wf(Hf,0),lx=ax.b,Ah=new ya(32768);for(Bt=0;Bt<32768;++Bt)cs=(Bt&43690)>>1|(Bt&21845)<<1,cs=(cs&52428)>>2|(cs&13107)<<2,cs=(cs&61680)>>4|(cs&3855)<<4,Ah[Bt]=((cs&65280)>>8|(cs&255)<<8)>>1;var cs,Bt,Ml=function(a,u,p){for(var _=a.length,w=0,T=new ya(u);w<_;++w)a[w]&&++T[a[w]-1];var M=new ya(u);for(w=1;w<u;++w)M[w]=M[w-1]+T[w-1]<<1;var o;if(p){o=new ya(1<<u);var z=15-u;for(w=0;w<_;++w)if(a[w])for(var A=w<<4|a[w],G=u-a[w],j=M[a[w]-1]++<<G,fe=j|(1<<G)-1;j<=fe;++j)o[Ah[j]>>z]=A}else for(o=new ya(_),w=0;w<_;++w)a[w]&&(o[w]=Ah[M[a[w]-1]++]>>15-a[w]);return o},Nl=new Kr(288);for(Bt=0;Bt<144;++Bt)Nl[Bt]=8;var Bt;for(Bt=144;Bt<256;++Bt)Nl[Bt]=9;var Bt;for(Bt=256;Bt<280;++Bt)Nl[Bt]=7;var Bt;for(Bt=280;Bt<288;++Bt)Nl[Bt]=8;var Bt,Yf=new Kr(32);for(Bt=0;Bt<32;++Bt)Yf[Bt]=5;var Bt,cx=Ml(Nl,9,1),ux=Ml(Yf,5,1),bh=function(a){for(var u=a[0],p=1;p<a.length;++p)a[p]>u&&(u=a[p]);return u},Cn=function(a,u,p){var _=u/8|0;return(a[_]|a[_+1]<<8)>>(u&7)&p},wh=function(a,u){var p=u/8|0;return(a[p]|a[p+1]<<8|a[p+2]<<16)>>(u&7)},hx=function(a){return(a+7)/8|0},dx=function(a,u,p){(u==null||u<0)&&(u=0),(p==null||p>a.length)&&(p=a.length);var _=new Kr(p-u);return _.set(a.subarray(u,p)),_},px=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Xr=function(a,u,p){var _=new Error(u||px[a]);if(_.code=a,Error.captureStackTrace&&Error.captureStackTrace(_,Xr),!p)throw _;return _},$h=function(a,u,p,_){var w=a.length,T=_?_.length:0;if(!w||u.f&&!u.l)return p||new Kr(0);var M=!p||u.i!=2,o=u.i;p||(p=new Kr(w*3));var z=function(Ki){var mr=p.length;if(Ki>mr){var Vr=new Kr(Math.max(mr*2,Ki));Vr.set(p),p=Vr}},A=u.f||0,G=u.p||0,j=u.b||0,fe=u.l,ge=u.d,he=u.m,Ce=u.n,De=w*8;do{if(!fe){A=Cn(a,G,1);var Se=Cn(a,G+1,3);if(G+=3,Se)if(Se==1)fe=cx,ge=ux,he=9,Ce=5;else if(Se==2){var pt=Cn(a,G,31)+257,ht=Cn(a,G+10,15)+4,st=pt+Cn(a,G+5,31)+1;G+=14;for(var xt=new Kr(st),_t=new Kr(19),tt=0;tt<ht;++tt)_t[sx[tt]]=Cn(a,G+tt*3,7);G+=ht*3;for(var gi=bh(_t),Zt=(1<<gi)-1,_i=Ml(_t,gi,1),tt=0;tt<st;){var fr=_i[Cn(a,G,Zt)];G+=fr&15;var Ne=fr>>4;if(Ne<16)xt[tt++]=Ne;else{var $t=0,yi=0;for(Ne==16?(yi=3+Cn(a,G,3),G+=2,$t=xt[tt-1]):Ne==17?(yi=3+Cn(a,G,7),G+=3):Ne==18&&(yi=11+Cn(a,G,127),G+=7);yi--;)xt[tt++]=$t}}var er=xt.subarray(0,pt),Jt=xt.subarray(pt);he=bh(er),Ce=bh(Jt),fe=Ml(er,he,1),ge=Ml(Jt,Ce,1)}else Xr(1);else{var Ne=hx(G)+4,Ue=a[Ne-4]|a[Ne-3]<<8,lt=Ne+Ue;if(lt>w){o&&Xr(0);break}M&&z(j+Ue),p.set(a.subarray(Ne,lt),j),u.b=j+=Ue,u.p=G=lt*8,u.f=A;continue}if(G>De){o&&Xr(0);break}}M&&z(j+131072);for(var en=(1<<he)-1,Ur=(1<<Ce)-1,Fi=G;;Fi=G){var $t=fe[wh(a,G)&en],oi=$t>>4;if(G+=$t&15,G>De){o&&Xr(0);break}if($t||Xr(2),oi<256)p[j++]=oi;else if(oi==256){Fi=G,fe=null;break}else{var vi=oi-254;if(oi>264){var tt=oi-257,kt=Gf[tt];vi=Cn(a,G,(1<<kt)-1)+Kf[tt],G+=kt}var Xi=ge[wh(a,G)&Ur],Be=Xi>>4;Xi||Xr(3),G+=Xi&15;var Jt=lx[Be];if(Be>3){var kt=Hf[Be];Jt+=wh(a,G)&(1<<kt)-1,G+=kt}if(G>De){o&&Xr(0);break}M&&z(j+131072);var ot=j+vi;if(j<Jt){var Rt=T-Jt,Oi=Math.min(Jt,ot);for(Rt+j<0&&Xr(3);j<Oi;++j)p[j]=_[Rt+j]}for(;j<ot;j+=4)p[j]=p[j-Jt],p[j+1]=p[j+1-Jt],p[j+2]=p[j+2-Jt],p[j+3]=p[j+3-Jt];j=ot}}u.l=fe,u.p=Fi,u.b=j,u.f=A,fe&&(A=1,u.m=he,u.d=ge,u.n=Ce)}while(!A);return j==p.length?p:dx(p,0,j)},fx=new Kr(0),mx=function(a){(a[0]!=31||a[1]!=139||a[2]!=8)&&Xr(6,"invalid gzip data");var u=a[3],p=10;u&4&&(p+=(a[10]|a[11]<<8)+2);for(var _=(u>>3&1)+(u>>4&1);_>0;_-=!a[p++]);return p+(u&2)},gx=function(a){var u=a.length;return(a[u-4]|a[u-3]<<8|a[u-2]<<16|a[u-1]<<24)>>>0},_x=function(a,u){return((a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31)&&Xr(6,"invalid zlib data"),(a[1]>>5&1)==+!u&&Xr(6,"invalid zlib data: "+(a[1]&32?"need":"unexpected")+" dictionary"),(a[1]>>3&4)+2};function yx(a,u){return $h(a,{i:2},u&&u.out,u&&u.dictionary)}function vx(a,u){var p=mx(a);return p+8>a.length&&Xr(6,"invalid gzip data"),$h(a.subarray(p,-8),{i:2},u&&u.out||new Kr(gx(a)),u&&u.dictionary)}function xx(a,u){return $h(a.subarray(_x(a,u&&u.dictionary),-4),{i:2},u&&u.out,u&&u.dictionary)}function kh(a,u){return a[0]==31&&a[1]==139&&a[2]==8?vx(a,u):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?yx(a,u):xx(a,u)}var bx=typeof TextDecoder<"u"&&new TextDecoder,wx=0;try{bx.decode(fx,{stream:!0}),wx=1}catch{}var Jf=(a,u)=>a*Math.pow(2,u),Il=(a,u)=>Math.floor(a/Math.pow(2,u)),Kc=(a,u)=>Jf(a.getUint16(u+1,!0),8)+a.getUint8(u),Qf=(a,u)=>Jf(a.getUint32(u+2,!0),16)+a.getUint16(u,!0),Ex=(a,u,p,_,w)=>{if(a!=_.getUint8(w))return a-_.getUint8(w);const T=Kc(_,w+1);if(u!=T)return u-T;const M=Kc(_,w+4);return p!=M?p-M:0},Tx=(a,u,p,_)=>{const w=em(a,u|128,p,_);return w?{z:u,x:p,y:_,offset:w[0],length:w[1],is_dir:!0}:null},Jp=(a,u,p,_)=>{const w=em(a,u,p,_);return w?{z:u,x:p,y:_,offset:w[0],length:w[1],is_dir:!1}:null},em=(a,u,p,_)=>{let w=0,T=a.byteLength/17-1;for(;w<=T;){const M=T+w>>1,o=Ex(u,p,_,a,M*17);if(o>0)w=M+1;else if(o<0)T=M-1;else return[Qf(a,M*17+7),a.getUint32(M*17+13,!0)]}return null},Sx=(a,u)=>a.is_dir&&!u.is_dir?1:!a.is_dir&&u.is_dir?-1:a.z!==u.z?a.z-u.z:a.x!==u.x?a.x-u.x:a.y-u.y,tm=(a,u)=>{const p=a.getUint8(u*17);return{z:p&127,x:Kc(a,u*17+1),y:Kc(a,u*17+4),offset:Qf(a,u*17+7),length:a.getUint32(u*17+13,!0),is_dir:p>>7===1}},Qp=a=>{const u=[],p=new DataView(a);for(let _=0;_<p.byteLength/17;_++)u.push(tm(p,_));return Cx(u)},Cx=a=>{a.sort(Sx);const u=new ArrayBuffer(17*a.length),p=new Uint8Array(u);for(let _=0;_<a.length;_++){const w=a[_];let T=w.z;w.is_dir&&(T=T|128),p[_*17]=T,p[_*17+1]=w.x&255,p[_*17+2]=w.x>>8&255,p[_*17+3]=w.x>>16&255,p[_*17+4]=w.y&255,p[_*17+5]=w.y>>8&255,p[_*17+6]=w.y>>16&255,p[_*17+7]=w.offset&255,p[_*17+8]=Il(w.offset,8)&255,p[_*17+9]=Il(w.offset,16)&255,p[_*17+10]=Il(w.offset,24)&255,p[_*17+11]=Il(w.offset,32)&255,p[_*17+12]=Il(w.offset,48)&255,p[_*17+13]=w.length&255,p[_*17+14]=w.length>>8&255,p[_*17+15]=w.length>>16&255,p[_*17+16]=w.length>>24&255}return u},Ix=(a,u)=>{if(a.byteLength<17)return null;const p=a.byteLength/17,_=tm(a,p-1);if(_.is_dir){const w=_.z,T=u.z-w,M=Math.trunc(u.x/(1<<T)),o=Math.trunc(u.y/(1<<T));return{z:w,x:M,y:o}}return null};function Ax(a){return Ir(this,null,function*(){const u=yield a.getBytes(0,512e3),p=new DataView(u.data),_=p.getUint32(4,!0),w=p.getUint16(8,!0),T=new TextDecoder("utf-8"),M=JSON.parse(T.decode(new DataView(u.data,10,_)));let o=0;M.compression==="gzip"&&(o=2);let z=0;"minzoom"in M&&(z=+M.minzoom);let A=0;"maxzoom"in M&&(A=+M.maxzoom);let G=0,j=0,fe=0,ge=-180,he=-85,Ce=180,De=85;if(M.bounds){const Ne=M.bounds.split(",");ge=+Ne[0],he=+Ne[1],Ce=+Ne[2],De=+Ne[3]}if(M.center){const Ne=M.center.split(",");G=+Ne[0],j=+Ne[1],fe=+Ne[2]}return{specVersion:p.getUint16(2,!0),rootDirectoryOffset:10+_,rootDirectoryLength:w*17,jsonMetadataOffset:10,jsonMetadataLength:_,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:z,maxZoom:A,minLon:ge,minLat:he,maxLon:Ce,maxLat:De,centerZoom:fe,centerLon:G,centerLat:j,etag:u.etag}})}function kx(a,u,p,_,w,T,M){return Ir(this,null,function*(){let o=yield p.getArrayBuffer(u,a.rootDirectoryOffset,a.rootDirectoryLength,a);a.specVersion===1&&(o=Qp(o));const z=Jp(new DataView(o),_,w,T);if(z){let j=(yield u.getBytes(z.offset,z.length,M)).data;const fe=new DataView(j);return fe.getUint8(0)==31&&fe.getUint8(1)==139&&(j=kh(new Uint8Array(j))),{data:j}}const A=Ix(new DataView(o),{z:_,x:w,y:T});if(A){const G=Tx(new DataView(o),A.z,A.x,A.y);if(G){let j=yield p.getArrayBuffer(u,G.offset,G.length,a);a.specVersion===1&&(j=Qp(j));const fe=Jp(new DataView(j),_,w,T);if(fe){let he=(yield u.getBytes(fe.offset,fe.length,M)).data;const Ce=new DataView(he);return Ce.getUint8(0)==31&&Ce.getUint8(1)==139&&(he=kh(new Uint8Array(he))),{data:he}}}}})}var im={getHeader:Ax,getZxy:kx},N0=class{constructor(){this.tile=(a,u)=>{if(a.type=="json"){const p=a.url.substr(10);let _=this.tiles.get(p);return _||(_=new ef(p),this.tiles.set(p,_)),_.getHeader().then(w=>{const T={tiles:[a.url+"/{z}/{x}/{y}"],minzoom:w.minZoom,maxzoom:w.maxZoom,bounds:[w.minLon,w.minLat,w.maxLon,w.maxLat]};u(null,T,null,null)}).catch(w=>{u(w,null,null,null)}),{cancel:()=>{}}}else{const p=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),_=a.url.match(p);if(!_)throw new Error("Invalid PMTiles protocol URL");const w=_[1];let T=this.tiles.get(w);T||(T=new ef(w),this.tiles.set(w,T));const M=_[2],o=_[3],z=_[4],A=new AbortController,G=A.signal;let j=()=>{A.abort()};return T.getHeader().then(fe=>{T.getZxy(+M,+o,+z,G).then(ge=>{ge?u(null,new Uint8Array(ge.data),ge.cacheControl,ge.expires):fe.tileType==1?u(null,new Uint8Array,null,null):u(null,null,null,null)}).catch(ge=>{ge.name!=="AbortError"&&u(ge,null,null,null)})}),{cancel:j}}},this.tiles=new Map}add(a){this.tiles.set(a.source.getKey(),a)}get(a){return this.tiles.get(a)}};function ma(a,u){return(u>>>0)*4294967296+(a>>>0)}function Mx(a,u){const p=u.buf;let _,w;if(w=p[u.pos++],_=(w&112)>>4,w<128||(w=p[u.pos++],_|=(w&127)<<3,w<128)||(w=p[u.pos++],_|=(w&127)<<10,w<128)||(w=p[u.pos++],_|=(w&127)<<17,w<128)||(w=p[u.pos++],_|=(w&127)<<24,w<128)||(w=p[u.pos++],_|=(w&1)<<31,w<128))return ma(a,_);throw new Error("Expected varint not more than 10 bytes")}function Al(a){const u=a.buf;let p,_;return _=u[a.pos++],p=_&127,_<128||(_=u[a.pos++],p|=(_&127)<<7,_<128)||(_=u[a.pos++],p|=(_&127)<<14,_<128)||(_=u[a.pos++],p|=(_&127)<<21,_<128)?p:(_=u[a.pos],p|=(_&15)<<28,Mx(p,a))}function Px(a,u,p,_){if(_==0){p==1&&(u[0]=a-1-u[0],u[1]=a-1-u[1]);const w=u[0];u[0]=u[1],u[1]=w}}var Lx=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function zx(a,u,p){if(a>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(u>Math.pow(2,a)-1||p>Math.pow(2,a)-1)throw Error("tile x/y outside zoom level bounds");const _=Lx[a],w=Math.pow(2,a);let T=0,M=0,o=0;const z=[u,p];let A=w/2;for(;A>0;)T=(z[0]&A)>0?1:0,M=(z[1]&A)>0?1:0,o+=A*A*(3*T^M),Px(A,z,T,M),A=A/2;return _+o}function rm(a,u){return Ir(this,null,function*(){if(u===1||u===0)return a;if(u===2){if(typeof globalThis.DecompressionStream>"u")return kh(new Uint8Array(a));{let _=new Response(a).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(_).arrayBuffer()}}else throw Error("Compression method not supported")})}var Dx=127;function Bx(a,u){let p=0,_=a.length-1;for(;p<=_;){const w=_+p>>1,T=u-a[w].tileId;if(T>0)p=w+1;else if(T<0)_=w-1;else return a[w]}return _>=0&&(a[_].runLength===0||u-a[_].tileId<a[_].runLength)?a[_]:null}var Rx=class{constructor(a){this.url=a}getKey(){return this.url}getBytes(a,u,p){return Ir(this,null,function*(){let _;p||(_=new AbortController,p=_.signal);let w=yield fetch(this.url,{signal:p,headers:{Range:"bytes="+a+"-"+(a+u-1)}});if(w.status===416&&a===0){const o=w.headers.get("Content-Range");if(!o||!o.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const z=+o.substr(8);w=yield fetch(this.url,{signal:p,headers:{Range:"bytes=0-"+(z-1)}})}if(w.status>=300)throw Error("Bad response code: "+w.status);const T=w.headers.get("Content-Length");if(w.status===200&&(!T||+T>u))throw _&&_.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield w.arrayBuffer(),etag:w.headers.get("ETag")||void 0,cacheControl:w.headers.get("Cache-Control")||void 0,expires:w.headers.get("Expires")||void 0}})}};function In(a,u){const p=a.getUint32(u+4,!0),_=a.getUint32(u+0,!0);return p*Math.pow(2,32)+_}function Fx(a,u){const p=new DataView(a),_=p.getUint8(7);if(_>3)throw Error(`Archive is spec version ${_} but this library supports up to spec version 3`);return{specVersion:_,rootDirectoryOffset:In(p,8),rootDirectoryLength:In(p,16),jsonMetadataOffset:In(p,24),jsonMetadataLength:In(p,32),leafDirectoryOffset:In(p,40),leafDirectoryLength:In(p,48),tileDataOffset:In(p,56),tileDataLength:In(p,64),numAddressedTiles:In(p,72),numTileEntries:In(p,80),numTileContents:In(p,88),clustered:p.getUint8(96)===1,internalCompression:p.getUint8(97),tileCompression:p.getUint8(98),tileType:p.getUint8(99),minZoom:p.getUint8(100),maxZoom:p.getUint8(101),minLon:p.getInt32(102,!0)/1e7,minLat:p.getInt32(106,!0)/1e7,maxLon:p.getInt32(110,!0)/1e7,maxLat:p.getInt32(114,!0)/1e7,centerZoom:p.getUint8(118),centerLon:p.getInt32(119,!0)/1e7,centerLat:p.getInt32(123,!0)/1e7,etag:u}}function nm(a){const u={buf:new Uint8Array(a),pos:0},p=Al(u),_=[];let w=0;for(let T=0;T<p;T++){const M=Al(u);_.push({tileId:w+M,offset:0,length:0,runLength:1}),w+=M}for(let T=0;T<p;T++)_[T].runLength=Al(u);for(let T=0;T<p;T++)_[T].length=Al(u);for(let T=0;T<p;T++){const M=Al(u);M===0&&T>0?_[T].offset=_[T-1].offset+_[T-1].length:_[T].offset=M-1}return _}function Ox(a){const u=new DataView(a);return u.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):u.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var va=class extends Error{};function Ux(a,u,p,_){return Ir(this,null,function*(){const w=yield a.getBytes(0,16384);if(new DataView(w.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Ox(w.data)<3)return[yield im.getHeader(a)];const M=w.data.slice(0,Dx);let o=w.etag;_&&w.etag!=_&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+a.getKey()),o=void 0);const z=Fx(M,o);if(p){const A=w.data.slice(z.rootDirectoryOffset,z.rootDirectoryOffset+z.rootDirectoryLength),G=a.getKey()+"|"+(z.etag||"")+"|"+z.rootDirectoryOffset+"|"+z.rootDirectoryLength,j=nm(yield u(A,z.internalCompression));return[z,[G,j.length,j]]}return[z,void 0]})}function Vx(a,u,p,_,w){return Ir(this,null,function*(){const T=yield a.getBytes(p,_);if(w.etag&&w.etag!==T.etag)throw new va(T.etag);const M=yield u(T.data,w.internalCompression),o=nm(M);if(o.length===0)throw new Error("Empty directory is invalid");return o})}var Nx=class{constructor(a=100,u=!0,p=rm){this.cache=new Map,this.maxCacheEntries=a,this.counter=1,this.prefetch=u,this.decompress=p}getHeader(a,u){return Ir(this,null,function*(){const p=a.getKey();if(this.cache.has(p))return this.cache.get(p).lastUsed=this.counter++,yield this.cache.get(p).data;const _=new Promise((w,T)=>{Ux(a,this.decompress,this.prefetch,u).then(M=>{M[1]&&this.cache.set(M[1][0],{lastUsed:this.counter++,data:Promise.resolve(M[1][2])}),w(M[0]),this.prune()}).catch(M=>{T(M)})});return this.cache.set(p,{lastUsed:this.counter++,data:_}),_})}getDirectory(a,u,p,_){return Ir(this,null,function*(){const w=a.getKey()+"|"+(_.etag||"")+"|"+u+"|"+p;if(this.cache.has(w))return this.cache.get(w).lastUsed=this.counter++,yield this.cache.get(w).data;const T=new Promise((M,o)=>{Vx(a,this.decompress,u,p,_).then(z=>{M(z),this.prune()}).catch(z=>{o(z)})});return this.cache.set(w,{lastUsed:this.counter++,data:T}),T})}getArrayBuffer(a,u,p,_){return Ir(this,null,function*(){const w=a.getKey()+"|"+(_.etag||"")+"|"+u+"|"+p;if(this.cache.has(w))return this.cache.get(w).lastUsed=this.counter++,yield this.cache.get(w).data;const T=new Promise((M,o)=>{a.getBytes(u,p).then(z=>{if(_.etag&&_.etag!==z.etag)throw new va(z.etag);M(z.data),this.cache.has(w),this.prune()}).catch(z=>{o(z)})});return this.cache.set(w,{lastUsed:this.counter++,data:T}),T})}prune(){if(this.cache.size>=this.maxCacheEntries){let a=1/0,u;this.cache.forEach((p,_)=>{p.lastUsed<a&&(a=p.lastUsed,u=_)}),u&&this.cache.delete(u)}}invalidate(a,u){return Ir(this,null,function*(){this.cache.delete(a.getKey()),yield this.getHeader(a,u)})}},ef=class{constructor(a,u,p){typeof a=="string"?this.source=new Rx(a):this.source=a,p?this.decompress=p:this.decompress=rm,u?this.cache=u:this.cache=new Nx}getHeader(){return Ir(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(a,u,p,_){return Ir(this,null,function*(){const w=zx(a,u,p),T=yield this.cache.getHeader(this.source);if(T.specVersion<3)return im.getZxy(T,this.source,this.cache,a,u,p,_);if(a<T.minZoom||a>T.maxZoom)return;let M=T.rootDirectoryOffset,o=T.rootDirectoryLength;for(let z=0;z<=3;z++){const A=yield this.cache.getDirectory(this.source,M,o,T),G=Bx(A,w);if(G)if(G.runLength>0){const j=yield this.source.getBytes(T.tileDataOffset+G.offset,G.length,_);if(T.etag&&T.etag!==j.etag)throw new va(j.etag);return{data:yield this.decompress(j.data,T.tileCompression),cacheControl:j.cacheControl,expires:j.expires}}else M=T.leafDirectoryOffset+G.offset,o=G.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(a,u,p,_){return Ir(this,null,function*(){try{return yield this.getZxyAttempt(a,u,p,_)}catch(w){if(w instanceof va)return this.cache.invalidate(this.source,w.message),yield this.getZxyAttempt(a,u,p,_);throw w}})}getMetadataAttempt(){return Ir(this,null,function*(){const a=yield this.cache.getHeader(this.source),u=yield this.source.getBytes(a.jsonMetadataOffset,a.jsonMetadataLength);if(a.etag&&a.etag!==u.etag)throw new va(u.etag);const p=yield this.decompress(u.data,a.internalCompression),_=new TextDecoder("utf-8");return JSON.parse(_.decode(p))})}getMetadata(){return Ir(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(a){if(a instanceof va)return this.cache.invalidate(this.source,a.message),yield this.getMetadataAttempt();throw a}})}};function tf(a){let u,p,_,w;function T(z){a[6](z)}function M(z){a[7](z)}let o={style:a[3],bounds:a[0],hash:!0,$$slots:{default:[jx]},$$scope:{ctx:a}};return a[2]!==void 0&&(o.loaded=a[2]),a[1]!==void 0&&(o.map=a[1]),u=new rx({props:o}),Gc.push(()=>zp(u,"loaded",T)),Gc.push(()=>zp(u,"map",M)),{c(){ds(u.$$.fragment)},m(z,A){Nn(u,z,A),w=!0},p(z,A){const G={};A&8&&(G.style=z[3]),A&1&&(G.bounds=z[0]),A&260&&(G.$$scope={dirty:A,ctx:z}),!p&&A&4&&(p=!0,G.loaded=z[2],Pp(()=>p=!1)),!_&&A&2&&(_=!0,G.map=z[1],Pp(()=>_=!1)),u.$set(G)},i(z){w||(At(u.$$.fragment,z),w=!0)},o(z){jt(u.$$.fragment,z),w=!1},d(z){jn(u,z)}}}function rf(a){let u,p,_,w,T;u=new $f({}),_=new Zf({props:{position:"bottom-right",visualizePitch:!0}});const M=a[5].default,o=Ta(M,a,a[8],null);return{c(){ds(u.$$.fragment),p=Yr(),ds(_.$$.fragment),w=Yr(),o&&o.c()},m(z,A){Nn(u,z,A),Ii(z,p,A),Nn(_,z,A),Ii(z,w,A),o&&o.m(z,A),T=!0},p(z,A){o&&o.p&&(!T||A&256)&&Ca(o,M,z,z[8],T?Sa(M,z[8],A,null):Ia(z[8]),null)},i(z){T||(At(u.$$.fragment,z),At(_.$$.fragment,z),At(o,z),T=!0)},o(z){jt(u.$$.fragment,z),jt(_.$$.fragment,z),jt(o,z),T=!1},d(z){z&&(ni(p),ni(w)),jn(u,z),jn(_,z),o&&o.d(z)}}}function jx(a){let u,p,_=a[2]&&rf(a);return{c(){_&&_.c(),u=Jc()},m(w,T){_&&_.m(w,T),Ii(w,u,T),p=!0},p(w,T){w[2]?_?(_.p(w,T),T&4&&At(_,1)):(_=rf(w),_.c(),At(_,1),_.m(u.parentNode,u)):_&&(Bl(),jt(_,1,1,()=>{_=null}),Rl())},i(w){p||(At(_),p=!0)},o(w){jt(_),p=!1},d(w){w&&ni(u),_&&_.d(w)}}}function qx(a){let u,p,_=a[3]&&tf(a);return{c(){u=Ci("div"),_&&_.c(),Ft(u,"class","map svelte-12dpf1u")},m(w,T){Ii(w,u,T),_&&_.m(u,null),p=!0},p(w,[T]){w[3]?_?(_.p(w,T),T&8&&At(_,1)):(_=tf(w),_.c(),At(_,1),_.m(u,null)):_&&(Bl(),jt(_,1,1,()=>{_=null}),Rl())},i(w){p||(At(_),p=!0)},o(w){jt(_),p=!1},d(w){w&&ni(u),_&&_.d()}}}function Zx(a,u,p){let{$$slots:_={},$$scope:w}=u,{style:T}=u,{startBounds:M=void 0}=u,o=null,z,A=!1;Ph("setCamera",!window.location.hash),y_(async()=>{p(3,o=await Vp(T))});async function G(ge){p(3,o=await Vp(T));let he=new URL(window.location.href);he.searchParams.set("style",ge),window.history.replaceState(null,"",he.toString())}function j(ge){A=ge,p(2,A)}function fe(ge){z=ge,p(1,z)}return a.$$set=ge=>{"style"in ge&&p(4,T=ge.style),"startBounds"in ge&&p(0,M=ge.startBounds),"$$scope"in ge&&p(8,w=ge.$$scope)},a.$$.update=()=>{a.$$.dirty&6&&A&&Uh.set(z),a.$$.dirty&16&&G(T)},[M,z,A,o,T,_,j,fe,w]}class j0 extends Qr{constructor(u){super(),Jr(this,u,Zx,qx,Rr,{style:4,startBounds:0})}}async function q0(){return await(await fetch(W_)).json()}function sm(){if(window.location.hostname=="localhost")return"Local development";if(window.location.hostname=="acteng.github.io"){let a=window.location.pathname.split("/");if(a.length==3&&a[0]==""&&a[1]=="atip")return"Public (development)";if(a.length==4&&a[0]==""&&a[1]=="atip")return`Public (dev branch: ${a[2]})`}else if(window.location.hostname.endsWith(".appspot.com"))return"Private (development)";return"Unknown"}function Z0(){return"https://atip.uk/layers"}function $x(){return"https://atip.uk/private_layers"}export{Jc as $,Uh as A,zl as B,Hx as C,Wi as D,V_ as E,s0 as F,yf as G,Bh as H,x_ as I,A0 as J,_0 as K,F0 as L,j0 as M,qc as N,S_ as O,r0 as P,xy as Q,o0 as R,Qr as S,Ey as T,wy as U,by as V,p0 as W,y0 as X,v0 as Y,x0 as Z,P0 as _,H_ as a,df as a$,d0 as a0,Ty as a1,Qc as a2,S0 as a3,ny as a4,xf as a5,Rh as a6,us as a7,ru as a8,iu as a9,Xx as aA,Lp as aB,l_ as aC,d_ as aD,fs as aE,Hc as aF,e0 as aG,k0 as aH,c_ as aI,Vn as aJ,Ta as aK,Ca as aL,Ia as aM,Sa as aN,i0 as aO,t0 as aP,g0 as aQ,u0 as aR,z0 as aS,B0 as aT,Ul as aU,O0 as aV,U0 as aW,Cp as aX,Qx as aY,jv as aZ,N0 as a_,ps as aa,_a as ab,D0 as ac,a0 as ad,l0 as ae,c0 as af,If as ag,qn as ah,wf as ai,b0 as aj,w0 as ak,T0 as al,E0 as am,ky as an,kp as ao,C0 as ap,Sy as aq,Bl as ar,Rl as as,m0 as at,of as au,h0 as av,Pa as aw,hy as ax,Xc as ay,R0 as az,Gc as b,Iv as b0,Z0 as b1,I0 as b2,Jx as b3,$x as b4,f0 as b5,Wx as b6,Vl as b7,vf as b8,my as b9,v_ as ba,V0 as bb,Ip as bc,Tp as bd,Kx as be,Yx as bf,M0 as bg,Sp as bh,L0 as bi,zp as c,Yr as d,Ci as e,sm as f,ds as g,Ft as h,Jr as i,Ii as j,mi as k,Pp as l,Nn as m,jt as n,ni as o,jn as p,Ea as q,y_ as r,Rr as s,At as t,Rs as u,Ap as v,Pl as w,Ay as x,n0 as y,q0 as z};
