import{S as K,i as Q,s as X,F as Y,b as z,a as x,e as f,c as y,t as tt,d as D,f as i,g as O,h as n,j as W,m as G,l as L,k as et,n as R,o as V,p as j,q as Z,r as ot,u as at,v as nt,w as lt}from"./maplibre_helpers-a1eee30b.js";import{A as st,a as it}from"./About-0a653e7b.js";function rt(o){let e,r,q,p,w,b,$,v,d,F,C,E,c,l,a,I,h,k,s,S,_,u,m,J,A,N,T,P,M;_=new Y({props:{label:"Upload ATIP GeoJSON file",uniqueId:"load-geojson",loadFile:o[4]}});function H(t){o[9](t)}let U={};return o[1]!==void 0&&(U.open=o[1]),A=new st({props:U}),z.push(()=>x(A,"open",H,o[1])),{c(){e=f("div"),r=f("h1"),r.textContent="Welcome to ATIP v2",q=y(),p=f("button"),p.textContent="About",w=y(),b=f("p"),b.textContent="Select Transport Authority or Local Authority District:",$=y(),v=f("div"),d=f("input"),F=y(),C=f("datalist"),E=y(),c=f("button"),l=tt("Start"),I=y(),h=f("p"),h.textContent="Or pick a Transport Authority on the map",k=y(),s=f("p"),s.textContent="Or upload an ATIP file:",S=y(),D(_.$$.fragment),u=y(),m=f("div"),J=y(),D(A.$$.fragment),i(r,"class","govuk-heading-l"),i(p,"class","govuk-button svelte-ynp6gq"),i(p,"type","button"),i(b,"class","govuk-body"),i(d,"data-testid","transport-authority"),i(d,"list","authorities-list"),i(C,"id","authorities-list"),i(c,"class","govuk-button svelte-ynp6gq"),i(c,"type","button"),c.disabled=a=!o[3],i(h,"class","govuk-body"),i(s,"class","govuk-body"),i(e,"class","left svelte-ynp6gq"),i(m,"id","map"),i(m,"class","svelte-ynp6gq")},m(t,g){O(t,e,g),n(e,r),n(e,q),n(e,p),n(e,w),n(e,b),n(e,$),n(e,v),n(v,d),W(d,o[0]),n(v,F),n(v,C),o[8](C),n(v,E),n(v,c),n(c,l),n(e,I),n(e,h),n(e,k),n(e,s),n(e,S),G(_,e,null),O(t,u,g),O(t,m,g),O(t,J,g),G(A,t,g),T=!0,P||(M=[L(p,"click",o[6]),L(d,"input",o[7]),L(c,"click",o[5])],P=!0)},p(t,[g]){g&1&&d.value!==t[0]&&W(d,t[0]),(!T||g&8&&a!==(a=!t[3]))&&(c.disabled=a);const B={};!N&&g&2&&(N=!0,B.open=t[1],et(()=>N=!1)),A.$set(B)},i(t){T||(R(_.$$.fragment,t),R(A.$$.fragment,t),T=!0)},o(t){V(_.$$.fragment,t),V(A.$$.fragment,t),T=!1},d(t){t&&j(e),o[8](null),Z(_),t&&j(u),t&&j(m),t&&j(J),Z(A,t),P=!1,ot(M)}}}function ut(o){if(o.features.length>0){let e=o.features[0].properties;for(let r of["planning","v2","criticals"])if(e&&r in e)return r}return"v1"}function pt(o,e,r){let q,p=!1,w,b,$=new Set;at(async()=>{let l="boundary",a="boundary-layer";const h=await(await fetch(it)).text(),k=JSON.parse(h);for(let u of k.features){let m=document.createElement("option");m.value=u.properties.name,b.appendChild(m),$.add(u.properties.name)}k.features=k.features.filter(u=>u.properties.level=="TA");let s=new nt.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"}),S=null;function _(){S!==null&&s.setFeatureState({source:l,id:S},{hover:!1})}s.on("load",function(){s.fitBounds(lt(k),{padding:20,animate:!1}),s.addSource(l,{type:"geojson",data:k,generateId:!0}),s.addLayer({id:a,source:l,type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),s.on("mousemove",a,u=>{u.features.length>0&&(_(),S=u.features[0].id,s.setFeatureState({source:l,id:S},{hover:!0}))}),s.on("mouseleave",a,()=>{_(),S=null}),s.on("click",a,function(u){let m=u.features[0].properties.name;window.location.href=`scheme.html?authority=${m}`})})});function v(l){try{let a=JSON.parse(l);if(!a.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!$.has(a.authority))throw new Error(`Unknown authority ${a.authority}`);let I=a.authority,h=ut(a);h!="v1"&&(I+=`_${h}`),window.localStorage.setItem(I,JSON.stringify(a)),window.location.href=`scheme.html?authority=${a.authority}&schema=${h}`}catch(a){window.alert(`Couldn't load scheme from a file: ${a}`)}}function d(){window.location.href=`scheme.html?authority=${w}`}const F=()=>r(1,p=!p);function C(){w=this.value,r(0,w)}function E(l){z[l?"unshift":"push"](()=>{b=l,r(2,b)})}function c(l){p=l,r(1,p)}return o.$$.update=()=>{o.$$.dirty&1&&r(3,q=$.has(w))},[w,p,b,q,v,d,F,C,E,c]}class ft extends K{constructor(e){super(),Q(this,e,pt,rt,X,{})}}new ft({target:document.getElementById("app")});
