import{S as K,i as Q,s as X,F as Y,b as z,a as x,e as f,c as y,t as tt,d as D,f as i,g as O,h as o,j as W,m as G,l as L,k as et,n as R,o as V,p as j,q as Z,r as at,u as nt,v as ot,w as lt}from"./maplibre_helpers-e7d4ec8d.js";import{A as st,a as it}from"./About-49dd9712.js";function rt(n){let t,r,q,p,w,b,$,v,d,F,C,E,c,l,a,I,h,k,s,S,g,u,m,J,A,N,T,P,M;g=new Y({props:{label:"Upload ATIP GeoJSON file",uniqueId:"load-geojson",loadFile:n[4]}});function H(e){n[9](e)}let U={};return n[1]!==void 0&&(U.open=n[1]),A=new st({props:U}),z.push(()=>x(A,"open",H)),{c(){t=f("div"),r=f("h1"),r.textContent="Welcome to ATIP v2",q=y(),p=f("button"),p.textContent="About",w=y(),b=f("p"),b.textContent="Select Transport Authority or Local Authority District:",$=y(),v=f("div"),d=f("input"),F=y(),C=f("datalist"),E=y(),c=f("button"),l=tt("Start"),I=y(),h=f("p"),h.textContent="Or pick a Transport Authority on the map",k=y(),s=f("p"),s.textContent="Or upload an ATIP file:",S=y(),D(g.$$.fragment),u=y(),m=f("div"),J=y(),D(A.$$.fragment),i(r,"class","govuk-heading-l"),i(p,"class","govuk-button svelte-ynp6gq"),i(p,"type","button"),i(b,"class","govuk-body"),i(d,"data-testid","transport-authority"),i(d,"list","authorities-list"),i(C,"id","authorities-list"),i(c,"class","govuk-button svelte-ynp6gq"),i(c,"type","button"),c.disabled=a=!n[3],i(h,"class","govuk-body"),i(s,"class","govuk-body"),i(t,"class","left svelte-ynp6gq"),i(m,"id","map"),i(m,"class","svelte-ynp6gq")},m(e,_){O(e,t,_),o(t,r),o(t,q),o(t,p),o(t,w),o(t,b),o(t,$),o(t,v),o(v,d),W(d,n[0]),o(v,F),o(v,C),n[8](C),o(v,E),o(v,c),o(c,l),o(t,I),o(t,h),o(t,k),o(t,s),o(t,S),G(g,t,null),O(e,u,_),O(e,m,_),O(e,J,_),G(A,e,_),T=!0,P||(M=[L(p,"click",n[6]),L(d,"input",n[7]),L(c,"click",n[5])],P=!0)},p(e,[_]){_&1&&d.value!==e[0]&&W(d,e[0]),(!T||_&8&&a!==(a=!e[3]))&&(c.disabled=a);const B={};!N&&_&2&&(N=!0,B.open=e[1],et(()=>N=!1)),A.$set(B)},i(e){T||(R(g.$$.fragment,e),R(A.$$.fragment,e),T=!0)},o(e){V(g.$$.fragment,e),V(A.$$.fragment,e),T=!1},d(e){e&&(j(t),j(u),j(m),j(J)),n[8](null),Z(g),Z(A,e),P=!1,at(M)}}}function ut(n){if(n.features.length>0){let t=n.features[0].properties;for(let r of["planning","v2","criticals"])if(t&&r in t)return r}return"v1"}function pt(n,t,r){let q,p=!1,w,b,$=new Set;nt(async()=>{let l="boundary",a="boundary-layer";const h=await(await fetch(it)).text(),k=JSON.parse(h);for(let u of k.features){let m=document.createElement("option");m.value=u.properties.name,b.appendChild(m),$.add(u.properties.name)}k.features=k.features.filter(u=>u.properties.level=="TA");let s=new ot.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"}),S=null;function g(){S!==null&&s.setFeatureState({source:l,id:S},{hover:!1})}s.on("load",function(){s.fitBounds(lt(k),{padding:20,animate:!1}),s.addSource(l,{type:"geojson",data:k,generateId:!0}),s.addLayer({id:a,source:l,type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),s.on("mousemove",a,u=>{u.features.length>0&&(g(),S=u.features[0].id,s.setFeatureState({source:l,id:S},{hover:!0}))}),s.on("mouseleave",a,()=>{g(),S=null}),s.on("click",a,function(u){let m=u.features[0].properties.name;window.location.href=`scheme.html?authority=${m}`})})});function v(l){try{let a=JSON.parse(l);if(!a.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!$.has(a.authority))throw new Error(`Unknown authority ${a.authority}`);let I=a.authority,h=ut(a);h!="v1"&&(I+=`_${h}`),window.localStorage.setItem(I,JSON.stringify(a)),window.location.href=`scheme.html?authority=${a.authority}&schema=${h}`}catch(a){window.alert(`Couldn't load scheme from a file: ${a}`)}}function d(){window.location.href=`scheme.html?authority=${w}`}const F=()=>r(1,p=!p);function C(){w=this.value,r(0,w)}function E(l){z[l?"unshift":"push"](()=>{b=l,r(2,b)})}function c(l){p=l,r(1,p)}return n.$$.update=()=>{n.$$.dirty&1&&r(3,q=$.has(w))},[w,p,b,q,v,d,F,C,E,c]}class ft extends K{constructor(t){super(),Q(this,t,pt,rt,X,{})}}new ft({target:document.getElementById("app")});
