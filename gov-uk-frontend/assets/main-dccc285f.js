import{S as ee,i as te,s as ne,P as W,F as ae,b as Y,a as oe,e as P,c as _,d as k,f as I,g as v,h as d,m as T,j as Q,l as se,k as le,t as F,n as C,o as w,p as E,q as re,r as q,u as ie,v as ue}from"./maplibre_helpers-ac43dd3e.js";import{B as X,A as fe,a as pe}from"./About-4eda7177.js";function ce(a){let e;return{c(){e=q("About")},m(n,r){v(n,e,r)},d(n){n&&w(e)}}}function $e(a){let e;return{c(){e=q("Select Transport Authority or Local Authority District:")},m(n,r){v(n,e,r)},d(n){n&&w(e)}}}function de(a){let e;return{c(){e=q("Start")},m(n,r){v(n,e,r)},d(n){n&&w(e)}}}function me(a){let e;return{c(){e=q("Or pick a Transport Authority on the map")},m(n,r){v(n,e,r)},d(n){n&&w(e)}}}function he(a){let e;return{c(){e=q("Or upload an ATIP file:")},m(n,r){v(n,e,r)},d(n){n&&w(e)}}}function _e(a){let e,n,r,i,y,$,O,g,m,B,j,N,h,u,o,J,f,S,l,b,A,p,c,M,L,U,G;i=new X({props:{$$slots:{default:[ce]},$$scope:{ctx:a}}}),i.$on("click",a[6]),$=new W({props:{$$slots:{default:[$e]},$$scope:{ctx:a}}}),h=new X({props:{disabled:!a[3],$$slots:{default:[de]},$$scope:{ctx:a}}}),h.$on("click",a[5]),o=new W({props:{$$slots:{default:[me]},$$scope:{ctx:a}}}),f=new W({props:{$$slots:{default:[he]},$$scope:{ctx:a}}}),l=new ae({props:{label:"Upload ATIP GeoJSON file",uniqueId:"load-geojson",loadFile:a[4]}});function x(t){a[9](t)}let R={};return a[1]!==void 0&&(R.open=a[1]),c=new fe({props:R}),Y.push(()=>oe(c,"open",x)),{c(){e=P("div"),n=P("h1"),n.textContent="Welcome to ATIP v2",r=_(),k(i.$$.fragment),y=_(),k($.$$.fragment),O=_(),g=P("div"),m=P("input"),B=_(),j=P("datalist"),N=_(),k(h.$$.fragment),u=_(),k(o.$$.fragment),J=_(),k(f.$$.fragment),S=_(),k(l.$$.fragment),b=_(),A=P("div"),p=_(),k(c.$$.fragment),I(n,"class","govuk-heading-l"),I(m,"data-testid","transport-authority"),I(m,"list","authorities-list"),I(j,"id","authorities-list"),I(e,"class","left svelte-mta9vv"),I(A,"id","map"),I(A,"class","svelte-mta9vv")},m(t,s){v(t,e,s),d(e,n),d(e,r),T(i,e,null),d(e,y),T($,e,null),d(e,O),d(e,g),d(g,m),Q(m,a[0]),d(g,B),d(g,j),a[8](j),d(g,N),T(h,g,null),d(e,u),T(o,e,null),d(e,J),T(f,e,null),d(e,S),T(l,e,null),v(t,b,s),v(t,A,s),v(t,p,s),T(c,t,s),L=!0,U||(G=se(m,"input",a[7]),U=!0)},p(t,[s]){const V={};s&2048&&(V.$$scope={dirty:s,ctx:t}),i.$set(V);const Z={};s&2048&&(Z.$$scope={dirty:s,ctx:t}),$.$set(Z),s&1&&m.value!==t[0]&&Q(m,t[0]);const D={};s&8&&(D.disabled=!t[3]),s&2048&&(D.$$scope={dirty:s,ctx:t}),h.$set(D);const z={};s&2048&&(z.$$scope={dirty:s,ctx:t}),o.$set(z);const H={};s&2048&&(H.$$scope={dirty:s,ctx:t}),f.$set(H);const K={};!M&&s&2&&(M=!0,K.open=t[1],le(()=>M=!1)),c.$set(K)},i(t){L||(F(i.$$.fragment,t),F($.$$.fragment,t),F(h.$$.fragment,t),F(o.$$.fragment,t),F(f.$$.fragment,t),F(l.$$.fragment,t),F(c.$$.fragment,t),L=!0)},o(t){C(i.$$.fragment,t),C($.$$.fragment,t),C(h.$$.fragment,t),C(o.$$.fragment,t),C(f.$$.fragment,t),C(l.$$.fragment,t),C(c.$$.fragment,t),L=!1},d(t){t&&(w(e),w(b),w(A),w(p)),E(i),E($),a[8](null),E(h),E(o),E(f),E(l),E(c,t),U=!1,G()}}}function ge(a){if(a.features.length>0){let e=a.features[0].properties;for(let n of["planning","v2","criticals"])if(e&&n in e)return n}return"v1"}function be(a,e,n){let r,i=!1,y,$,O=new Set;re(async()=>{let u="boundary",o="boundary-layer";const f=await(await fetch(pe)).text(),S=JSON.parse(f);for(let p of S.features){let c=document.createElement("option");c.value=p.properties.name,$.appendChild(c),O.add(p.properties.name)}S.features=S.features.filter(p=>p.properties.level=="TA");let l=new ie.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"}),b=null;function A(){b!==null&&l.setFeatureState({source:u,id:b},{hover:!1})}l.on("load",function(){l.fitBounds(ue(S),{padding:20,animate:!1}),l.addSource(u,{type:"geojson",data:S,generateId:!0}),l.addLayer({id:o,source:u,type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),l.on("mousemove",o,p=>{p.features.length>0&&(A(),b=p.features[0].id,l.setFeatureState({source:u,id:b},{hover:!0}))}),l.on("mouseleave",o,()=>{A(),b=null}),l.on("click",o,function(p){let c=p.features[0].properties.name;window.location.href=`scheme.html?authority=${c}`})})});function g(u){try{let o=JSON.parse(u);if(!o.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!O.has(o.authority))throw new Error(`Unknown authority ${o.authority}`);let J=o.authority,f=ge(o);f!="v1"&&(J+=`_${f}`),window.localStorage.setItem(J,JSON.stringify(o)),window.location.href=`scheme.html?authority=${o.authority}&schema=${f}`}catch(o){window.alert(`Couldn't load scheme from a file: ${o}`)}}function m(){window.location.href=`scheme.html?authority=${y}`}const B=()=>n(1,i=!i);function j(){y=this.value,n(0,y)}function N(u){Y[u?"unshift":"push"](()=>{$=u,n(2,$)})}function h(u){i=u,n(1,i)}return a.$$.update=()=>{a.$$.dirty&1&&n(3,r=O.has(y))},[y,i,$,r,g,m,B,j,N,h]}class ve extends ee{constructor(e){super(),te(this,e,be,_e,ne,{})}}new ve({target:document.getElementById("app")});
