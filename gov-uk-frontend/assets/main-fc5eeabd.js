import{S as ce,i as de,s as he,P as me,F as _e,b as fe,a as $e,e as d,c as m,d as O,t as D,f as C,g as V,h as ge,j as S,k as o,m as j,l as ie,n as ee,o as be,p as J,q as L,r as k,u as P,v as ve,w as we,x as ye,y as Ae,z as Se,A as ke}from"./maplibre_helpers-8455da5a.js";import{B as re,A as Ie,a as Ce}from"./About-13a182ee.js";function Te(n){let e;return{c(){e=D("About")},m(a,r){S(a,e,r)},d(a){a&&k(e)}}}function Fe(n){let e;return{c(){e=D("Select Transport Authority or Local Authority District:")},m(a,r){S(a,e,r)},d(a){a&&k(e)}}}function Be(n){let e;return{c(){e=D("Start")},m(a,r){S(a,e,r)},d(a){a&&k(e)}}}function ue(n){let e,a;return{c(){e=d("i"),a=D(n[4])},m(r,s){S(r,e,s),o(e,a)},p(r,s){s&16&&ye(a,r[4])},d(r){r&&k(e)}}}function Ee(n){let e,a,r,s,w,_,T,l,p,N,y,M,b,U,G,W,v,z,u,i,h,$,B,g,I,H,te,F,K,E,Q,A,X,R,Y,ne;s=new re({props:{$$slots:{default:[Te]},$$scope:{ctx:n}}}),s.$on("click",n[9]),_=new me({props:{$$slots:{default:[Fe]},$$scope:{ctx:n}}}),b=new re({props:{disabled:!n[5],$$slots:{default:[Be]},$$scope:{ctx:n}}}),b.$on("click",n[8]);let c=n[4]&&ue(n);F=new _e({props:{label:"Upload ATIP GeoJSON file",uniqueId:"load-geojson",loadFile:n[7]}});function pe(t){n[13](t)}let ae={};return n[1]!==void 0&&(ae.open=n[1]),A=new Ie({props:ae}),fe.push(()=>$e(A,"open",pe)),{c(){e=d("div"),a=d("h1"),a.textContent="Welcome to ATIP v2",r=m(),O(s.$$.fragment),w=m(),O(_.$$.fragment),T=m(),l=d("div"),p=d("input"),N=m(),y=d("datalist"),M=m(),O(b.$$.fragment),U=m(),G=d("hr"),W=m(),v=d("label"),z=D(`Or pick from the map:
    `),u=d("select"),i=d("option"),i.textContent="Transport Authorities",h=d("option"),h.textContent="Local Authority District",$=m(),c&&c.c(),B=m(),g=d("hr"),I=m(),H=d("p"),H.textContent="Or upload an ATIP file:",te=m(),O(F.$$.fragment),K=m(),E=d("div"),Q=m(),O(A.$$.fragment),C(a,"class","govuk-heading-l"),C(p,"data-testid","transport-authority"),C(p,"list","authorities-list"),C(y,"id","authorities-list"),i.__value="TA",V(i,i.__value),h.__value="LAD",V(h,h.__value),n[3]===void 0&&ge(()=>n[12].call(u)),C(e,"class","left svelte-mta9vv"),C(E,"id","map"),C(E,"class","svelte-mta9vv")},m(t,f){S(t,e,f),o(e,a),o(e,r),j(s,e,null),o(e,w),j(_,e,null),o(e,T),o(e,l),o(l,p),V(p,n[0]),o(l,N),o(l,y),n[11](y),o(l,M),j(b,l,null),o(e,U),o(e,G),o(e,W),o(e,v),o(v,z),o(v,u),o(u,i),o(u,h),ie(u,n[3],!0),o(v,$),c&&c.m(v,null),o(e,B),o(e,g),o(e,I),o(e,H),o(e,te),j(F,e,null),S(t,K,f),S(t,E,f),S(t,Q,f),j(A,t,f),R=!0,Y||(ne=[ee(p,"input",n[10]),ee(u,"change",n[12]),ee(u,"change",n[6])],Y=!0)},p(t,[f]){const oe={};f&65536&&(oe.$$scope={dirty:f,ctx:t}),s.$set(oe);const le={};f&65536&&(le.$$scope={dirty:f,ctx:t}),_.$set(le),f&1&&p.value!==t[0]&&V(p,t[0]);const x={};f&32&&(x.disabled=!t[5]),f&65536&&(x.$$scope={dirty:f,ctx:t}),b.$set(x),f&8&&ie(u,t[3]),t[4]?c?c.p(t,f):(c=ue(t),c.c(),c.m(v,null)):c&&(c.d(1),c=null);const se={};!X&&f&2&&(X=!0,se.open=t[1],be(()=>X=!1)),A.$set(se)},i(t){R||(J(s.$$.fragment,t),J(_.$$.fragment,t),J(b.$$.fragment,t),J(F.$$.fragment,t),J(A.$$.fragment,t),R=!0)},o(t){L(s.$$.fragment,t),L(_.$$.fragment,t),L(b.$$.fragment,t),L(F.$$.fragment,t),L(A.$$.fragment,t),R=!1},d(t){t&&(k(e),k(K),k(E),k(Q)),P(s),P(_),n[11](null),P(b),c&&c.d(),P(F),P(A,t),Y=!1,ve(ne)}}}let Z="boundary",q="boundary-layer";function Oe(n){if(n.features.length>0){let e=n.features[0].properties;for(let a of["planning","v2","criticals"])if(e&&a in e)return a}return"v1"}function je(n,e,a){let r,s=!1,w,_,T=new Set,l=null,p="TA";function N(){l==null||l.setFilter(q,["==",["get","level"],p])}let y=null;we(async()=>{const i=await(await fetch(Ce)).text(),h=JSON.parse(i);for(let g of h.features){let I=document.createElement("option");I.value=g.properties.name,_.appendChild(I),T.add(g.properties.name)}l=new Ae.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let $=null;function B(){$!==null&&l.setFeatureState({source:Z,id:$},{hover:!1})}l.on("load",function(){l.fitBounds(Se(h),{padding:20,animate:!1}),l.addSource(Z,{type:"geojson",data:h,generateId:!0}),l.addLayer({id:q,source:Z,filter:["==",["get","level"],p],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),l.on("mousemove",q,g=>{g.features.length>0&&(B(),$=g.features[0].id,a(4,y=g.features[0].properties.name),l.setFeatureState({source:Z,id:$},{hover:!0}))}),l.on("mouseleave",q,()=>{B(),$=null,a(4,y=null)}),l.on("click",q,function(g){let I=g.features[0].properties.name;window.location.href=`scheme.html?authority=${I}`})})});function M(u){try{let i=JSON.parse(u);if(!i.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!T.has(i.authority))throw new Error(`Unknown authority ${i.authority}`);let h=i.authority,$=Oe(i);$!="v1"&&(h+=`_${$}`),window.localStorage.setItem(h,JSON.stringify(i)),window.location.href=`scheme.html?authority=${i.authority}&schema=${$}`}catch(i){window.alert(`Couldn't load scheme from a file: ${i}`)}}function b(){window.location.href=`scheme.html?authority=${w}`}const U=()=>a(1,s=!s);function G(){w=this.value,a(0,w)}function W(u){fe[u?"unshift":"push"](()=>{_=u,a(2,_)})}function v(){p=ke(this),a(3,p)}function z(u){s=u,a(1,s)}return n.$$.update=()=>{n.$$.dirty&1&&a(5,r=T.has(w))},[w,s,_,p,y,r,N,M,b,U,G,W,v,z]}class Je extends ce{constructor(e){super(),de(this,e,je,Ee,he,{})}}new Je({target:document.getElementById("app")});
