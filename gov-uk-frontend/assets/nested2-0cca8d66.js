import{S as be,i as we,s as ye,d as J,m as G,n as k,o as C,q as T,z as ae,M as ke,F as ve,e as b,c as v,t as $,f as D,g as Z,h as o,j as ie,l as V,ab as E,a3 as he,a4 as de,p as A,ad as Se,r as ge,w as ue,K as Ce,L as Le}from"./maplibre_helpers-e7d4ec8d.js";import{L as Be,g as Y,Z as Fe,e as fe,q as Oe,I as je,B as Ie,t as ze,M as Ne,m as Me,C as qe}from"./ZoomOutMap-1daeb126.js";function ce(l,e,n){const r=l.slice();return r[17]=e[n],r}function pe(l){let e,n;return e=new qe({props:{label:`${l[17].scheme_reference}: ${l[17].num_features} features`,$$slots:{default:[Je]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(r,t){G(e,r,t),n=!0},p(r,t){const s={};t&1&&(s.label=`${r[17].scheme_reference}: ${r[17].num_features} features`),t&1048577&&(s.$$scope={dirty:t,ctx:r}),e.$set(s)},i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function Je(l){let e,n,r,t=l[17].authority_or_region+"",s,c,d,m,a=l[17].capital_scheme_id+"",p,I,z,S,O=l[17].funding_programme+"",L,H,h,j,N,i,f,w,B,U;function R(){return l[12](l[17])}function Q(){return l[13](l[17])}return{c(){e=b("ul"),n=b("li"),r=$("Authority or region: "),s=$(t),c=v(),d=b("li"),m=$("Capital scheme ID: "),p=$(a),I=v(),z=b("li"),S=$("Funding programme: "),L=$(O),H=v(),h=b("li"),j=b("button"),j.textContent="Show on map",N=v(),i=b("li"),f=b("button"),f.textContent="Edit scheme",w=v(),D(j,"type","button"),D(f,"type","button")},m(M,F){Z(M,e,F),o(e,n),o(n,r),o(n,s),o(e,c),o(e,d),o(d,m),o(d,p),o(e,I),o(e,z),o(z,S),o(z,L),o(e,H),o(e,h),o(h,j),o(e,N),o(e,i),o(i,f),Z(M,w,F),B||(U=[V(j,"click",R),V(f,"click",Q)],B=!0)},p(M,F){l=M,F&1&&t!==(t=l[17].authority_or_region+"")&&E(s,t),F&1&&a!==(a=l[17].capital_scheme_id+"")&&E(p,a),F&1&&O!==(O=l[17].funding_programme+"")&&E(L,O)},d(M){M&&(A(e),A(w)),B=!1,ge(U)}}}function me(l){let e=l[2].has(l[17].scheme_reference),n,r,t=e&&pe(l);return{c(){t&&t.c(),n=Ce()},m(s,c){t&&t.m(s,c),Z(s,n,c),r=!0},p(s,c){c&5&&(e=s[2].has(s[17].scheme_reference)),e?t?(t.p(s,c),c&5&&k(t,1)):(t=pe(s),t.c(),k(t,1),t.m(n.parentNode,n)):t&&(he(),C(t,1,1,()=>{t=null}),de())},i(s){r||(k(t),r=!0)},o(s){C(t),r=!1},d(s){s&&A(n),t&&t.d(s)}}}function Ge(l){let e,n,r,t,s,c,d,m,a,p,I,z,S,O,L,H,h,j,N=l[2].size+"",i,f,w=l[3].route+"",B,U,R=l[3].area+"",Q,M,F=l[3].crossing+"",x,re,W=l[3].other+"",ee,ne,le,X,q,te,oe;c=new Fe({props:{boundaryGeojson:l[4]}}),m=new ve({props:{label:"Load from GeoJSON",uniqueId:"load_geojson",loadFile:l[6]}});let K=fe(l[0]),_=[];for(let u=0;u<K.length;u+=1)_[u]=me(ce(l,K,u));const $e=u=>C(_[u],1,1,()=>{_[u]=null});return{c(){e=b("div"),n=b("button"),n.textContent="Home",r=v(),t=b("h1"),s=$(`Browse schemes
      `),J(c.$$.fragment),d=v(),J(m.$$.fragment),a=v(),p=b("div"),I=b("label"),z=$(`Filter by any field:
        `),S=b("input"),O=v(),L=b("button"),L.textContent="Clear",H=v(),h=b("p"),j=$("Showing "),i=$(N),f=$(" schemes ("),B=$(w),U=$(" routes, "),Q=$(R),M=$(` areas,
      `),x=$(F),re=$(" crossings, "),ee=$(W),ne=$(" other)"),le=v(),X=b("ul");for(let u=0;u<_.length;u+=1)_[u].c();D(n,"type","button"),D(S,"type","text"),D(L,"type","button"),D(h,"class","govuk-body"),D(e,"slot","sidebar")},m(u,g){Z(u,e,g),o(e,n),o(e,r),o(e,t),o(t,s),G(c,t,null),o(e,d),G(m,e,null),o(e,a),o(e,p),o(p,I),o(I,z),o(I,S),ie(S,l[1]),o(p,O),o(p,L),o(e,H),o(e,h),o(h,j),o(h,i),o(h,f),o(h,B),o(h,U),o(h,Q),o(h,M),o(h,x),o(h,re),o(h,ee),o(h,ne),o(e,le),o(e,X);for(let P=0;P<_.length;P+=1)_[P]&&_[P].m(X,null);q=!0,te||(oe=[V(n,"click",l[9]),V(S,"input",l[10]),V(L,"click",l[11])],te=!0)},p(u,g){const P={};if(g&16&&(P.boundaryGeojson=u[4]),c.$set(P),g&2&&S.value!==u[1]&&ie(S,u[1]),(!q||g&4)&&N!==(N=u[2].size+"")&&E(i,N),(!q||g&8)&&w!==(w=u[3].route+"")&&E(B,w),(!q||g&8)&&R!==(R=u[3].area+"")&&E(Q,R),(!q||g&8)&&F!==(F=u[3].crossing+"")&&E(x,F),(!q||g&8)&&W!==(W=u[3].other+"")&&E(ee,W),g&389){K=fe(u[0]);let y;for(y=0;y<K.length;y+=1){const se=ce(u,K,y);_[y]?(_[y].p(se,g),k(_[y],1)):(_[y]=me(se),_[y].c(),k(_[y],1),_[y].m(X,null))}for(he(),y=K.length;y<_.length;y+=1)$e(y);de()}},i(u){if(!q){k(c.$$.fragment,u),k(m.$$.fragment,u);for(let g=0;g<K.length;g+=1)k(_[g]);q=!0}},o(u){C(c.$$.fragment,u),C(m.$$.fragment,u),_=_.filter(Boolean);for(let g=0;g<_.length;g+=1)C(_[g]);q=!1},d(u){u&&A(e),T(c),T(m),Se(_,u),te=!1,ge(oe)}}}function Te(l){let e,n,r,t,s,c,d,m;return e=new je({props:{schema:_e}}),r=new Ie({props:{style:l[5]}}),s=new ze({props:{schema:_e}}),d=new Ne({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:Ze}}),{c(){J(e.$$.fragment),n=v(),J(r.$$.fragment),t=v(),J(s.$$.fragment),c=v(),J(d.$$.fragment)},m(a,p){G(e,a,p),Z(a,n,p),G(r,a,p),Z(a,t,p),G(s,a,p),Z(a,c,p),G(d,a,p),m=!0},p:Le,i(a){m||(k(e.$$.fragment,a),k(r.$$.fragment,a),k(s.$$.fragment,a),k(d.$$.fragment,a),m=!0)},o(a){C(e.$$.fragment,a),C(r.$$.fragment,a),C(s.$$.fragment,a),C(d.$$.fragment,a),m=!1},d(a){a&&(A(n),A(t),A(c)),T(e,a),T(r,a),T(s,a),T(d,a)}}}function De(l){let e,n,r;return n=new Oe({props:{style:l[5],$$slots:{default:[Te]},$$scope:{ctx:l}}}),{c(){e=b("div"),J(n.$$.fragment),D(e,"slot","main")},m(t,s){Z(t,e,s),G(n,e,null),r=!0},p(t,s){const c={};s&1048576&&(c.$$scope={dirty:s,ctx:t}),n.$set(c)},i(t){r||(k(n.$$.fragment,t),r=!0)},o(t){C(n.$$.fragment,t),r=!1},d(t){t&&A(e),T(n)}}}function Ee(l){let e,n;return e=new Be({props:{$$slots:{main:[De],sidebar:[Ge]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(r,t){G(e,r,t),n=!0},p(r,[t]){const s={};t&1048607&&(s.$$scope={dirty:t,ctx:r}),e.$set(s)},i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}const _e="v1";function Ze(l){var e="<table>";for(let[n,r]of Object.entries(l))e+=`<tr><td>${n}</td><td>${r}</td></tr>`;return e+="</table>",e}function Ae(l,e,n){let r,t;ae(l,Y,i=>n(4,r=i)),ae(l,Me,i=>n(14,t=i));let c=new URLSearchParams(window.location.search).get("style")||"streets",d=[],m="",a=new Set,p={area:0,route:0,crossing:0,other:0};ke(()=>{Y.set(null)});function I(i){try{let f=JSON.parse(i);Y.set(f),z(f),t==null||t.fitBounds(ue(f),{padding:20,animate:!1})}catch(f){window.alert(`Couldn't load schemes from a file: ${f}`)}}function z(i){let f={};for(let[w,B]of Object.entries(i.schemes))f[w]={scheme_reference:w,num_features:0,...B};for(let w of i.features)f[w.properties.scheme_reference].num_features++;n(0,d=Object.values(f))}function S(i){let f={type:"FeatureCollection",features:r.features.filter(w=>w.properties.scheme_reference==i.scheme_reference)};t==null||t.fitBounds(ue(f),{padding:20,animate:!1})}function O(i){let f={type:"FeatureCollection",features:r.features.filter(B=>B.properties.scheme_reference==i.scheme_reference)},w=i.authority_or_region;window.localStorage.setItem(w,JSON.stringify(f)),window.open(`scheme.html?authority=${i.authority_or_region}`,"_blank")}const L=()=>window.open("index.html");function H(){m=this.value,n(1,m)}const h=()=>n(1,m=""),j=i=>S(i),N=i=>O(i);return l.$$.update=()=>{if(l.$$.dirty&31){if(a.clear(),m){let i=m.toLowerCase();for(let f of r.features)JSON.stringify(f.properties).toLowerCase().includes(i)&&a.add(f.properties.scheme_reference)}else for(let i of d)a.add(i.scheme_reference);Y.update(i=>{if(!i)return null;for(let f of i.features)a.has(f.properties.scheme_reference)?delete f.properties.hide_while_editing:f.properties.hide_while_editing=!0;return i}),n(3,p={area:0,route:0,crossing:0,other:0});for(let i of r==null?void 0:r.features)a.has(i.properties.scheme_reference)&&n(3,p[i.properties.intervention_type]++,p);n(2,a),n(1,m),n(4,r),n(0,d),n(3,p)}},[d,m,a,p,r,c,I,S,O,L,H,h,j,N]}class He extends be{constructor(e){super(),we(this,e,Ae,Ee,ye,{})}}new He({target:document.getElementById("app")});
