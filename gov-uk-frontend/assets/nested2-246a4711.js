import{S as $e,i as be,s as we,d as q,m as G,n as k,o as C,q as T,z as ae,ab as ye,F as ke,e as b,c as v,t as $,f as D,g as Z,h as o,j as ie,l as V,a9 as E,a2 as _e,a3 as he,p as A,ac as ve,r as de,w as fe,K as Se,L as Ce}from"./maplibre_helpers-908e54aa.js";import{L as Le,g as Y,Z as je,i as Be,I as Fe,B as Oe,j as Ie,M as ze,m as Ne,C as Je}from"./ZoomOutMap-0cd8ed2e.js";function ue(l,e,n){const r=l.slice();return r[17]=e[n],r}function ce(l){let e,n;return e=new Je({props:{label:`${l[17].scheme_reference}: ${l[17].num_features} features`,$$slots:{default:[Me]},$$scope:{ctx:l}}}),{c(){q(e.$$.fragment)},m(r,t){G(e,r,t),n=!0},p(r,t){const a={};t&1&&(a.label=`${r[17].scheme_reference}: ${r[17].num_features} features`),t&1048577&&(a.$$scope={dirty:t,ctx:r}),e.$set(a)},i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function Me(l){let e,n,r,t=l[17].authority_or_region+"",a,c,d,m,s=l[17].capital_scheme_id+"",p,z,N,S,F=l[17].funding_programme+"",L,H,h,O,J,i,u,w,j,U;function P(){return l[12](l[17])}function Q(){return l[13](l[17])}return{c(){e=b("ul"),n=b("li"),r=$("Authority or region: "),a=$(t),c=v(),d=b("li"),m=$("Capital scheme ID: "),p=$(s),z=v(),N=b("li"),S=$("Funding programme: "),L=$(F),H=v(),h=b("li"),O=b("button"),O.textContent="Show on map",J=v(),i=b("li"),u=b("button"),u.textContent="Edit scheme",w=v(),D(O,"type","button"),D(u,"type","button")},m(I,B){Z(I,e,B),o(e,n),o(n,r),o(n,a),o(e,c),o(e,d),o(d,m),o(d,p),o(e,z),o(e,N),o(N,S),o(N,L),o(e,H),o(e,h),o(h,O),o(e,J),o(e,i),o(i,u),Z(I,w,B),j||(U=[V(O,"click",P),V(u,"click",Q)],j=!0)},p(I,B){l=I,B&1&&t!==(t=l[17].authority_or_region+"")&&E(a,t),B&1&&s!==(s=l[17].capital_scheme_id+"")&&E(p,s),B&1&&F!==(F=l[17].funding_programme+"")&&E(L,F)},d(I){I&&A(e),I&&A(w),j=!1,de(U)}}}function pe(l){let e=l[2].has(l[17].scheme_reference),n,r,t=e&&ce(l);return{c(){t&&t.c(),n=Se()},m(a,c){t&&t.m(a,c),Z(a,n,c),r=!0},p(a,c){c&5&&(e=a[2].has(a[17].scheme_reference)),e?t?(t.p(a,c),c&5&&k(t,1)):(t=ce(a),t.c(),k(t,1),t.m(n.parentNode,n)):t&&(_e(),C(t,1,1,()=>{t=null}),he())},i(a){r||(k(t),r=!0)},o(a){C(t),r=!1},d(a){t&&t.d(a),a&&A(n)}}}function qe(l){let e,n,r,t,a,c,d,m,s,p,z,N,S,F,L,H,h,O,J=l[2].size+"",i,u,w=l[3].route+"",j,U,P=l[3].area+"",Q,I,B=l[3].crossing+"",x,re,W=l[3].other+"",ee,ne,le,X,M,te,oe;c=new je({props:{boundaryGeojson:l[4]}}),m=new ke({props:{label:"Load from GeoJSON",uniqueId:"load_geojson",loadFile:l[6]}});let K=l[0],_=[];for(let f=0;f<K.length;f+=1)_[f]=pe(ue(l,K,f));const ge=f=>C(_[f],1,1,()=>{_[f]=null});return{c(){e=b("div"),n=b("button"),n.textContent="Home",r=v(),t=b("h1"),a=$(`Browse schemes
      `),q(c.$$.fragment),d=v(),q(m.$$.fragment),s=v(),p=b("div"),z=b("label"),N=$(`Filter by any field: 
        `),S=b("input"),F=v(),L=b("button"),L.textContent="Clear",H=v(),h=b("p"),O=$("Showing "),i=$(J),u=$(" schemes ("),j=$(w),U=$(" routes, "),Q=$(P),I=$(` areas,
      `),x=$(B),re=$(" crossings, "),ee=$(W),ne=$(" other)"),le=v(),X=b("ul");for(let f=0;f<_.length;f+=1)_[f].c();D(n,"type","button"),D(S,"type","text"),D(L,"type","button"),D(h,"class","govuk-body"),D(e,"slot","sidebar")},m(f,g){Z(f,e,g),o(e,n),o(e,r),o(e,t),o(t,a),G(c,t,null),o(e,d),G(m,e,null),o(e,s),o(e,p),o(p,z),o(z,N),o(z,S),ie(S,l[1]),o(p,F),o(p,L),o(e,H),o(e,h),o(h,O),o(h,i),o(h,u),o(h,j),o(h,U),o(h,Q),o(h,I),o(h,x),o(h,re),o(h,ee),o(h,ne),o(e,le),o(e,X);for(let R=0;R<_.length;R+=1)_[R].m(X,null);M=!0,te||(oe=[V(n,"click",l[9]),V(S,"input",l[10]),V(L,"click",l[11])],te=!0)},p(f,g){const R={};if(g&16&&(R.boundaryGeojson=f[4]),c.$set(R),g&2&&S.value!==f[1]&&ie(S,f[1]),(!M||g&4)&&J!==(J=f[2].size+"")&&E(i,J),(!M||g&8)&&w!==(w=f[3].route+"")&&E(j,w),(!M||g&8)&&P!==(P=f[3].area+"")&&E(Q,P),(!M||g&8)&&B!==(B=f[3].crossing+"")&&E(x,B),(!M||g&8)&&W!==(W=f[3].other+"")&&E(ee,W),g&389){K=f[0];let y;for(y=0;y<K.length;y+=1){const se=ue(f,K,y);_[y]?(_[y].p(se,g),k(_[y],1)):(_[y]=pe(se),_[y].c(),k(_[y],1),_[y].m(X,null))}for(_e(),y=K.length;y<_.length;y+=1)ge(y);he()}},i(f){if(!M){k(c.$$.fragment,f),k(m.$$.fragment,f);for(let g=0;g<K.length;g+=1)k(_[g]);M=!0}},o(f){C(c.$$.fragment,f),C(m.$$.fragment,f),_=_.filter(Boolean);for(let g=0;g<_.length;g+=1)C(_[g]);M=!1},d(f){f&&A(e),T(c),T(m),ve(_,f),te=!1,de(oe)}}}function Ge(l){let e,n,r,t,a,c,d,m;return e=new Fe({props:{schema:me}}),r=new Oe({props:{style:l[5]}}),a=new Ie({props:{schema:me}}),d=new ze({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:Ee}}),{c(){q(e.$$.fragment),n=v(),q(r.$$.fragment),t=v(),q(a.$$.fragment),c=v(),q(d.$$.fragment)},m(s,p){G(e,s,p),Z(s,n,p),G(r,s,p),Z(s,t,p),G(a,s,p),Z(s,c,p),G(d,s,p),m=!0},p:Ce,i(s){m||(k(e.$$.fragment,s),k(r.$$.fragment,s),k(a.$$.fragment,s),k(d.$$.fragment,s),m=!0)},o(s){C(e.$$.fragment,s),C(r.$$.fragment,s),C(a.$$.fragment,s),C(d.$$.fragment,s),m=!1},d(s){T(e,s),s&&A(n),T(r,s),s&&A(t),T(a,s),s&&A(c),T(d,s)}}}function Te(l){let e,n,r;return n=new Be({props:{style:l[5],$$slots:{default:[Ge]},$$scope:{ctx:l}}}),{c(){e=b("div"),q(n.$$.fragment),D(e,"slot","main")},m(t,a){Z(t,e,a),G(n,e,null),r=!0},p(t,a){const c={};a&1048576&&(c.$$scope={dirty:a,ctx:t}),n.$set(c)},i(t){r||(k(n.$$.fragment,t),r=!0)},o(t){C(n.$$.fragment,t),r=!1},d(t){t&&A(e),T(n)}}}function De(l){let e,n;return e=new Le({props:{$$slots:{main:[Te],sidebar:[qe]},$$scope:{ctx:l}}}),{c(){q(e.$$.fragment)},m(r,t){G(e,r,t),n=!0},p(r,[t]){const a={};t&1048607&&(a.$$scope={dirty:t,ctx:r}),e.$set(a)},i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}const me="v1";function Ee(l){var e="<table>";for(let[n,r]of Object.entries(l))e+=`<tr><td>${n}</td><td>${r}</td></tr>`;return e+="</table>",e}function Ze(l,e,n){let r,t;ae(l,Y,i=>n(4,r=i)),ae(l,Ne,i=>n(14,t=i));let c=new URLSearchParams(window.location.search).get("style")||"streets",d=[],m="",s=new Set,p={area:0,route:0,crossing:0,other:0};ye(()=>{Y.set(null)});function z(i){try{let u=JSON.parse(i);Y.set(u),N(u),t==null||t.fitBounds(fe(u),{padding:20,animate:!1})}catch(u){window.alert(`Couldn't load schemes from a file: ${u}`)}}function N(i){let u={};for(let[w,j]of Object.entries(i.schemes))u[w]={scheme_reference:w,num_features:0,...j};for(let w of i.features)u[w.properties.scheme_reference].num_features++;n(0,d=Object.values(u))}function S(i){let u={type:"FeatureCollection",features:r.features.filter(w=>w.properties.scheme_reference==i.scheme_reference)};t==null||t.fitBounds(fe(u),{padding:20,animate:!1})}function F(i){let u={type:"FeatureCollection",features:r.features.filter(j=>j.properties.scheme_reference==i.scheme_reference)},w=i.authority_or_region;window.localStorage.setItem(w,JSON.stringify(u)),window.open(`scheme.html?authority=${i.authority_or_region}`,"_blank")}const L=()=>window.open("index.html");function H(){m=this.value,n(1,m)}const h=()=>n(1,m=""),O=i=>S(i),J=i=>F(i);return l.$$.update=()=>{if(l.$$.dirty&31){if(s.clear(),m){let i=m.toLowerCase();for(let u of r.features)JSON.stringify(u.properties).toLowerCase().includes(i)&&s.add(u.properties.scheme_reference)}else for(let i of d)s.add(i.scheme_reference);Y.update(i=>{if(!i)return null;for(let u of i.features)s.has(u.properties.scheme_reference)?delete u.properties.hide_while_editing:u.properties.hide_while_editing=!0;return i}),n(3,p={area:0,route:0,crossing:0,other:0});for(let i of r==null?void 0:r.features)s.has(i.properties.scheme_reference)&&n(3,p[i.properties.intervention_type]++,p);n(2,s),n(1,m),n(4,r),n(0,d),n(3,p)}},[d,m,s,p,r,c,z,S,F,L,H,h,O,J]}class Ae extends $e{constructor(e){super(),be(this,e,Ze,De,we,{})}}new Ae({target:document.getElementById("app")});
