import{S as U,i as W,s as z,c as _e,a as Q,e as m,b as ae,d as B,l as H,u as he,g as me,f as ge,t as j,h as D,j as E,k as oe,m as pe,n as M,o as b,p as h,q as c,r as K,v as se,w as ie,x as ke,y as ye,z as R,A as we,B as X,C as ue,F as $e,D as J,E as L,G as re,H as O,I as Ae,J as Se,K as Be}from"./maplibre_helpers-8216c700.js";import{i as Ee}from"./all-4fc69598.js";import{g as Fe,S as Ie,A as Te,a as Ce}from"./About-ae457bd5.js";function Ne(l){let t,e,i,r;const u=l[2].default,o=_e(u,l,l[1],null);let s=[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},l[0]],a={};for(let n=0;n<s.length;n+=1)a=Q(a,s[n]);return{c(){t=m("button"),o&&o.c(),ae(t,a)},m(n,d){B(n,t,d),o&&o.m(t,null),t.autofocus&&t.focus(),e=!0,i||(r=H(t,"click",l[3]),i=!0)},p(n,[d]){o&&o.p&&(!e||d&2)&&he(o,u,n,n[1],e?ge(u,n[1],d,null):me(n[1]),null),ae(t,a=Fe(s,[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},d&1&&n[0]]))},i(n){e||(j(o,n),e=!0)},o(n){D(o,n),e=!1},d(n){n&&E(t),o&&o.d(n),i=!1,r()}}}function je(l,t,e){let{$$slots:i={},$$scope:r}=t;function u(o){pe.call(this,l,o)}return l.$$set=o=>{e(0,t=Q(Q({},t),oe(o))),"$$scope"in o&&e(1,r=o.$$scope)},t=oe(t),[t,r,i,u]}class De extends U{constructor(t){super(),W(this,t,je,Ne,z,{})}}function Je(l){let t,e,i,r,u;const o=l[3].default,s=_e(o,l,l[2],null);return{c(){t=m("div"),e=m("label"),i=M(l[0]),r=b(),s&&s.c(),h(e,"class","govuk-label"),h(e,"for",l[1]),h(t,"class","govuk-form-group")},m(a,n){B(a,t,n),c(t,e),c(e,i),c(t,r),s&&s.m(t,null),u=!0},p(a,[n]){(!u||n&1)&&K(i,a[0]),(!u||n&2)&&h(e,"for",a[1]),s&&s.p&&(!u||n&4)&&he(s,o,a,a[2],u?ge(o,a[2],n,null):me(a[2]),null)},i(a){u||(j(s,a),u=!0)},o(a){D(s,a),u=!1},d(a){a&&E(t),s&&s.d(a)}}}function Le(l,t,e){let{$$slots:i={},$$scope:r}=t,{label:u}=t,{id:o}=t;return l.$$set=s=>{"label"in s&&e(0,u=s.label),"id"in s&&e(1,o=s.id),"$$scope"in s&&e(2,r=s.$$scope)},[u,o,r,i]}class Oe extends U{constructor(t){super(),W(this,t,Le,Je,z,{label:0,id:1})}}function fe(l,t,e){const i=l.slice();return i[7]=t[e][0],i[8]=t[e][1],i}function de(l){let t,e,i,r,u=!1,o,s,a=l[8]+"",n,d,_,F,v,N;return F=ye(l[6][0]),{c(){t=m("div"),e=m("input"),o=b(),s=m("label"),n=M(a),_=b(),h(e,"class","govuk-radios__input"),h(e,"id",i=l[2]+l[7]),h(e,"type","radio"),e.__value=r=l[7],R(e,e.__value),h(s,"class","govuk-label govuk-radios__label"),h(s,"for",d=l[2]+l[7]),h(t,"class","govuk-radios__item"),F.p(e)},m(g,$){B(g,t,$),c(t,e),e.checked=e.__value===l[0],c(t,o),c(t,s),c(s,n),c(t,_),v||(N=[H(e,"change",l[5]),H(e,"change",l[4])],v=!0)},p(g,$){$&12&&i!==(i=g[2]+g[7])&&h(e,"id",i),$&8&&r!==(r=g[7])&&(e.__value=r,R(e,e.__value),u=!0),(u||$&9)&&(e.checked=e.__value===g[0]),$&8&&a!==(a=g[8]+"")&&K(n,a),$&12&&d!==(d=g[2]+g[7])&&h(s,"for",d)},d(g){g&&E(t),F.r(),v=!1,we(N)}}}function Me(l){let t,e,i,r,u,o,s=se(l[3]),a=[];for(let n=0;n<s.length;n+=1)a[n]=de(fe(l,s,n));return{c(){t=m("div"),e=m("fieldset"),i=m("legend"),r=M(l[1]),u=b(),o=m("div");for(let n=0;n<a.length;n+=1)a[n].c();h(i,"class","govuk-fieldset__legend"),h(o,"class","govuk-radios"),h(o,"data-module","govuk-radios"),h(e,"class","govuk-fieldset"),h(t,"class","govuk-form-group")},m(n,d){B(n,t,d),c(t,e),c(e,i),c(i,r),c(e,u),c(e,o);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(o,null)},p(n,[d]){if(d&2&&K(r,n[1]),d&13){s=se(n[3]);let _;for(_=0;_<s.length;_+=1){const F=fe(n,s,_);a[_]?a[_].p(F,d):(a[_]=de(F),a[_].c(),a[_].m(o,null))}for(;_<a.length;_+=1)a[_].d(1);a.length=s.length}},i:ie,o:ie,d(n){n&&E(t),ke(a,n)}}}function qe(l,t,e){let{legend:i}=t,{id:r}=t,{choices:u}=t,{value:o}=t;const s=[[]];function a(d){pe.call(this,l,d)}function n(){o=this.__value,e(0,o)}return l.$$set=d=>{"legend"in d&&e(1,i=d.legend),"id"in d&&e(2,r=d.id),"choices"in d&&e(3,u=d.choices),"value"in d&&e(0,o=d.value)},[o,i,r,u,a,n,s]}class Ge extends U{constructor(t){super(),W(this,t,qe,Me,z,{legend:1,id:2,choices:3,value:0})}}function Pe(l){let t;return{c(){t=M("About")},m(e,i){B(e,t,i)},d(e){e&&E(t)}}}function Ve(l){let t,e,i,r,u;return{c(){t=m("input"),e=b(),i=m("datalist"),h(t,"class","govuk-input govuk-input--width-20"),h(t,"id","inputValue"),h(t,"data-testid","transport-authority"),h(t,"list","authorities-list"),h(i,"id","authorities-list")},m(o,s){B(o,t,s),R(t,l[0]),B(o,e,s),B(o,i,s),l[11](i),r||(u=H(t,"input",l[10]),r=!0)},p(o,s){s&1&&t.value!==o[0]&&R(t,o[0])},d(o){o&&(E(t),E(e),E(i)),l[11](null),r=!1,u()}}}function He(l){let t;return{c(){t=M("Start")},m(e,i){B(e,t,i)},d(e){e&&E(t)}}}function ce(l){let t,e;return{c(){t=m("i"),e=M(l[4])},m(i,r){B(i,t,r),c(t,e)},p(i,r){r&16&&K(e,i[4])},d(i){i&&E(t)}}}function Re(l){let t,e,i,r,u,o,s,a,n,d,_,F,v,N,g,$,G,P,p,k,I,A,T,S,C;u=new Ie({props:{$$slots:{default:[Pe]},$$scope:{ctx:l}}}),u.$on("click",l[9]),s=new Oe({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[Ve]},$$scope:{ctx:l}}}),n=new De({props:{disabled:!l[5],$$slots:{default:[He]},$$scope:{ctx:l}}}),n.$on("click",l[8]);function ve(f){l[12](f)}let Y={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]]};l[3]!==void 0&&(Y.value=l[3]),v=new Ge({props:Y}),X.push(()=>ue(v,"value",ve)),v.$on("change",l[6]);let y=l[4]&&ce(l);p=new $e({props:{label:"Or upload an ATIP GeoJSON file",loadFile:l[7]}});function be(f){l[13](f)}let x={};return l[1]!==void 0&&(x.open=l[1]),T=new Te({props:x}),X.push(()=>ue(T,"open",be)),{c(){t=m("div"),e=m("div"),i=m("h1"),i.textContent="Welcome to ATIP v2",r=b(),J(u.$$.fragment),o=b(),J(s.$$.fragment),a=b(),J(n.$$.fragment),d=b(),_=m("hr"),F=b(),J(v.$$.fragment),g=b(),y&&y.c(),$=b(),G=m("hr"),P=b(),J(p.$$.fragment),k=b(),I=m("div"),I.innerHTML='<div id="map" class="svelte-lyn11h"></div>',A=b(),J(T.$$.fragment),h(i,"class","govuk-heading-l"),h(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),h(I,"class","govuk-grid-column-one-half"),h(t,"class","govuk-grid-row")},m(f,w){B(f,t,w),c(t,e),c(e,i),c(e,r),L(u,e,null),c(e,o),L(s,e,null),c(e,a),L(n,e,null),c(e,d),c(e,_),c(e,F),L(v,e,null),c(e,g),y&&y.m(e,null),c(e,$),c(e,G),c(e,P),L(p,e,null),c(t,k),c(t,I),B(f,A,w),L(T,f,w),C=!0},p(f,[w]){const ee={};w&65536&&(ee.$$scope={dirty:w,ctx:f}),u.$set(ee);const te={};w&65541&&(te.$$scope={dirty:w,ctx:f}),s.$set(te);const Z={};w&32&&(Z.disabled=!f[5]),w&65536&&(Z.$$scope={dirty:w,ctx:f}),n.$set(Z);const le={};!N&&w&8&&(N=!0,le.value=f[3],re(()=>N=!1)),v.$set(le),f[4]?y?y.p(f,w):(y=ce(f),y.c(),y.m(e,$)):y&&(y.d(1),y=null);const ne={};!S&&w&2&&(S=!0,ne.open=f[1],re(()=>S=!1)),T.$set(ne)},i(f){C||(j(u.$$.fragment,f),j(s.$$.fragment,f),j(n.$$.fragment,f),j(v.$$.fragment,f),j(p.$$.fragment,f),j(T.$$.fragment,f),C=!0)},o(f){D(u.$$.fragment,f),D(s.$$.fragment,f),D(n.$$.fragment,f),D(v.$$.fragment,f),D(p.$$.fragment,f),D(T.$$.fragment,f),C=!1},d(f){f&&(E(t),E(A)),O(u),O(s),O(n),O(v),y&&y.d(),O(p),O(T,f)}}}let V="boundary",q="boundary-layer";function Ue(l){if(l.features.length>0){let t=l.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function We(l,t,e){let i,r=!1,u,o,s=new Set,a=null,n="TA";function d(){a==null||a.setFilter(q,["==",["get","level"],n])}let _=null;Ae(async()=>{Ee();const k=await(await fetch(Ce)).text(),I=JSON.parse(k);for(let S of I.features){let C=document.createElement("option");C.value=S.properties.name,o.appendChild(C),s.add(S.properties.name)}a=new Se.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let A=null;function T(){A!==null&&a.setFeatureState({source:V,id:A},{hover:!1})}a.on("load",function(){a.fitBounds(Be(I),{padding:20,animate:!1}),a.addSource(V,{type:"geojson",data:I,generateId:!0}),a.addLayer({id:q,source:V,filter:["==",["get","level"],n],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),a.on("mousemove",q,S=>{S.features.length>0&&(T(),A=S.features[0].id,e(4,_=S.features[0].properties.name),a.setFeatureState({source:V,id:A},{hover:!0}))}),a.on("mouseleave",q,()=>{T(),A=null,e(4,_=null)}),a.on("click",q,function(S){let C=S.features[0].properties.name;window.location.href=`scheme.html?authority=${C}`})})});function F(p){try{let k=JSON.parse(p);if(!k.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!s.has(k.authority))throw new Error(`Unknown authority ${k.authority}`);let I=k.authority,A=Ue(k);A!="v1"&&(I+=`_${A}`),window.localStorage.setItem(I,JSON.stringify(k)),window.location.href=`scheme.html?authority=${k.authority}&schema=${A}`}catch(k){window.alert(`Couldn't load scheme from a file: ${k}`)}}function v(){window.location.href=`scheme.html?authority=${u}`}const N=()=>e(1,r=!r);function g(){u=this.value,e(0,u)}function $(p){X[p?"unshift":"push"](()=>{o=p,e(2,o)})}function G(p){n=p,e(3,n)}function P(p){r=p,e(1,r)}return l.$$.update=()=>{l.$$.dirty&1&&e(5,i=s.has(u))},[u,r,o,n,_,i,d,F,v,N,g,$,G,P]}class ze extends U{constructor(t){super(),W(this,t,We,Re,z,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new ze({target:document.getElementById("app")});
