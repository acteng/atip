import{S as z,i as K,s as R,c as oe,a as W,e as _,b as x,d as $,l as P,u as se,g as ae,f as ie,t as B,h as C,j as v,k as ee,m as fe,n as H,o as w,p as h,q as c,r as ue,F as ce,v as re,w as de,x as T,y as N,z as pe,A as j,B as me,C as V,D as _e,E as he,G as te,H as be,I as ge,J as $e,K as ve}from"./maplibre_helpers-1770e886.js";import{i as ye}from"./all-4fc69598.js";import{g as we,S as ke,A as Ae,a as Se}from"./About-0a746f16.js";function Be(l){let e,t,i,r;const u=l[2].default,s=oe(u,l,l[1],null);let a=[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},l[0]],o={};for(let n=0;n<a.length;n+=1)o=W(o,a[n]);return{c(){e=_("button"),s&&s.c(),x(e,o)},m(n,d){$(n,e,d),s&&s.m(e,null),e.autofocus&&e.focus(),t=!0,i||(r=P(e,"click",l[3]),i=!0)},p(n,[d]){s&&s.p&&(!t||d&2)&&se(s,u,n,n[1],t?ie(u,n[1],d,null):ae(n[1]),null),x(e,o=we(a,[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},d&1&&n[0]]))},i(n){t||(B(s,n),t=!0)},o(n){C(s,n),t=!1},d(n){n&&v(e),s&&s.d(n),i=!1,r()}}}function Ce(l,e,t){let{$$slots:i={},$$scope:r}=e;function u(s){fe.call(this,l,s)}return l.$$set=s=>{t(0,e=W(W({},e),ee(s))),"$$scope"in s&&t(1,r=s.$$scope)},e=ee(e),[e,r,i,u]}class Ee extends z{constructor(e){super(),K(this,e,Ce,Be,R,{})}}function Fe(l){let e,t,i,r,u;const s=l[3].default,a=oe(s,l,l[2],null);return{c(){e=_("div"),t=_("label"),i=H(l[0]),r=w(),a&&a.c(),h(t,"class","govuk-label"),h(t,"for",l[1]),h(e,"class","govuk-form-group")},m(o,n){$(o,e,n),c(e,t),c(t,i),c(e,r),a&&a.m(e,null),u=!0},p(o,[n]){(!u||n&1)&&ue(i,o[0]),(!u||n&2)&&h(t,"for",o[1]),a&&a.p&&(!u||n&4)&&se(a,s,o,o[2],u?ie(s,o[2],n,null):ae(o[2]),null)},i(o){u||(B(a,o),u=!0)},o(o){C(a,o),u=!1},d(o){o&&v(e),a&&a.d(o)}}}function Ie(l,e,t){let{$$slots:i={},$$scope:r}=e,{label:u}=e,{id:s}=e;return l.$$set=a=>{"label"in a&&t(0,u=a.label),"id"in a&&t(1,s=a.id),"$$scope"in a&&t(2,r=a.$$scope)},[u,s,r,i]}class le extends z{constructor(e){super(),K(this,e,Ie,Fe,R,{label:0,id:1})}}function Te(l){let e;return{c(){e=H("About")},m(t,i){$(t,e,i)},d(t){t&&v(e)}}}function Ne(l){let e,t,i,r,u;return{c(){e=_("input"),t=w(),i=_("datalist"),h(e,"class","govuk-input govuk-input--width-20"),h(e,"id","inputValue"),h(e,"data-testid","transport-authority"),h(e,"list","authorities-list"),h(i,"id","authorities-list")},m(s,a){$(s,e,a),V(e,l[0]),$(s,t,a),$(s,i,a),l[11](i),r||(u=P(e,"input",l[10]),r=!0)},p(s,a){a&1&&e.value!==s[0]&&V(e,s[0])},d(s){s&&(v(e),v(t),v(i)),l[11](null),r=!1,u()}}}function je(l){let e;return{c(){e=H("Start")},m(t,i){$(t,e,i)},d(t){t&&v(e)}}}function ne(l){let e,t;return{c(){e=_("i"),t=H(l[4])},m(i,r){$(i,e,r),c(e,t)},p(i,r){r&16&&ue(t,i[4])},d(i){i&&v(e)}}}function De(l){let e,t,i,r,u,s,a,o=l[4]&&ne(l);return{c(){e=_("select"),t=_("option"),t.textContent="Transport Authorities",i=_("option"),i.textContent="Local Authority District",r=w(),o&&o.c(),u=_e(),t.__value="TA",V(t,t.__value),i.__value="LAD",V(i,i.__value),h(e,"id","showBoundaries"),h(e,"class","govuk-select"),l[3]===void 0&&he(()=>l[12].call(e))},m(n,d){$(n,e,d),c(e,t),c(e,i),te(e,l[3],!0),$(n,r,d),o&&o.m(n,d),$(n,u,d),s||(a=[P(e,"change",l[12]),P(e,"change",l[6])],s=!0)},p(n,d){d&8&&te(e,n[3]),n[4]?o?o.p(n,d):(o=ne(n),o.c(),o.m(u.parentNode,u)):o&&(o.d(1),o=null)},d(n){n&&(v(e),v(r),v(u)),o&&o.d(n),s=!1,be(a)}}}function Je(l){let e,t,i,r,u,s,a,o,n,d,I,J,A,L,O,M,S,q,y,p,m,g,E;u=new ke({props:{$$slots:{default:[Te]},$$scope:{ctx:l}}}),u.$on("click",l[9]),a=new le({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[Ne]},$$scope:{ctx:l}}}),n=new Ee({props:{disabled:!l[5],$$slots:{default:[je]},$$scope:{ctx:l}}}),n.$on("click",l[8]),A=new le({props:{label:"Or pick from the map",id:"showBoundaries",$$slots:{default:[De]},$$scope:{ctx:l}}}),S=new ce({props:{label:"Or upload an ATIP GeoJSON file",loadFile:l[7]}});function k(f){l[13](f)}let F={};return l[1]!==void 0&&(F.open=l[1]),m=new Ae({props:F}),re.push(()=>de(m,"open",k)),{c(){e=_("div"),t=_("div"),i=_("h1"),i.textContent="Welcome to ATIP v2",r=w(),T(u.$$.fragment),s=w(),T(a.$$.fragment),o=w(),T(n.$$.fragment),d=w(),I=_("hr"),J=w(),T(A.$$.fragment),L=w(),O=_("hr"),M=w(),T(S.$$.fragment),q=w(),y=_("div"),y.innerHTML='<div id="map" class="svelte-lyn11h"></div>',p=w(),T(m.$$.fragment),h(i,"class","govuk-heading-l"),h(t,"class","govuk-grid-column-one-half left svelte-lyn11h"),h(y,"class","govuk-grid-column-one-half"),h(e,"class","govuk-grid-row")},m(f,b){$(f,e,b),c(e,t),c(t,i),c(t,r),N(u,t,null),c(t,s),N(a,t,null),c(t,o),N(n,t,null),c(t,d),c(t,I),c(t,J),N(A,t,null),c(t,L),c(t,O),c(t,M),N(S,t,null),c(e,q),c(e,y),$(f,p,b),N(m,f,b),E=!0},p(f,[b]){const Z={};b&65536&&(Z.$$scope={dirty:b,ctx:f}),u.$set(Z);const Q={};b&65541&&(Q.$$scope={dirty:b,ctx:f}),a.$set(Q);const U={};b&32&&(U.disabled=!f[5]),b&65536&&(U.$$scope={dirty:b,ctx:f}),n.$set(U);const X={};b&65560&&(X.$$scope={dirty:b,ctx:f}),A.$set(X);const Y={};!g&&b&2&&(g=!0,Y.open=f[1],pe(()=>g=!1)),m.$set(Y)},i(f){E||(B(u.$$.fragment,f),B(a.$$.fragment,f),B(n.$$.fragment,f),B(A.$$.fragment,f),B(S.$$.fragment,f),B(m.$$.fragment,f),E=!0)},o(f){C(u.$$.fragment,f),C(a.$$.fragment,f),C(n.$$.fragment,f),C(A.$$.fragment,f),C(S.$$.fragment,f),C(m.$$.fragment,f),E=!1},d(f){f&&(v(e),v(p)),j(u),j(a),j(n),j(A),j(S),j(m,f)}}}let G="boundary",D="boundary-layer";function Le(l){if(l.features.length>0){let e=l.features[0].properties;for(let t of["planning","v2","criticals"])if(e&&t in e)return t}return"v1"}function Oe(l,e,t){let i,r=!1,u,s,a=new Set,o=null,n="TA";function d(){o==null||o.setFilter(D,["==",["get","level"],n])}let I=null;me(async()=>{ye();const p=await(await fetch(Se)).text(),m=JSON.parse(p);for(let k of m.features){let F=document.createElement("option");F.value=k.properties.name,s.appendChild(F),a.add(k.properties.name)}o=new ge.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let g=null;function E(){g!==null&&o.setFeatureState({source:G,id:g},{hover:!1})}o.on("load",function(){o.fitBounds($e(m),{padding:20,animate:!1}),o.addSource(G,{type:"geojson",data:m,generateId:!0}),o.addLayer({id:D,source:G,filter:["==",["get","level"],n],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),o.on("mousemove",D,k=>{k.features.length>0&&(E(),g=k.features[0].id,t(4,I=k.features[0].properties.name),o.setFeatureState({source:G,id:g},{hover:!0}))}),o.on("mouseleave",D,()=>{E(),g=null,t(4,I=null)}),o.on("click",D,function(k){let F=k.features[0].properties.name;window.location.href=`scheme.html?authority=${F}`})})});function J(y){try{let p=JSON.parse(y);if(!p.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!a.has(p.authority))throw new Error(`Unknown authority ${p.authority}`);let m=p.authority,g=Le(p);g!="v1"&&(m+=`_${g}`),window.localStorage.setItem(m,JSON.stringify(p)),window.location.href=`scheme.html?authority=${p.authority}&schema=${g}`}catch(p){window.alert(`Couldn't load scheme from a file: ${p}`)}}function A(){window.location.href=`scheme.html?authority=${u}`}const L=()=>t(1,r=!r);function O(){u=this.value,t(0,u)}function M(y){re[y?"unshift":"push"](()=>{s=y,t(2,s)})}function S(){n=ve(this),t(3,n)}function q(y){r=y,t(1,r)}return l.$$.update=()=>{l.$$.dirty&1&&t(5,i=a.has(u))},[u,r,s,n,I,i,d,J,A,L,O,M,S,q]}class Me extends z{constructor(e){super(),K(this,e,Oe,Je,R,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Me({target:document.getElementById("app")});
