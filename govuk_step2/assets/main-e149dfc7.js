import{S as de,i as fe,s as pe,F as ce,b as ie,a as he,e as r,c as h,t as re,d as ee,f as l,g as V,h as me,j as W,k as t,l as te,m as oe,n as N,o as ve,p as ae,q as le,r as z,u as ne,v as be,w as ge,x as _e,y as ye,z as we,A as ke}from"./maplibre_helpers-ba9572ec.js";import{i as Ae}from"./main-cc41765e.js";import{A as Se,a as Ce}from"./About-38986094.js";function se(o){let i,e;return{c(){i=r("i"),e=re(o[4])},m(p,m){W(p,i,m),t(i,e)},p(p,m){m&16&&_e(e,p[4])},d(p){p&&z(i)}}}function Te(o){let i,e,p,m,v,T,b,s,S,c,B,F,L,w,O,I,J,D,k,n,g,_,u,d,y,H,R,Z,K,$,Q,M,P,C,G,E,U,X,f=o[4]&&se(o);$=new ce({props:{label:"Or upload an ATIP GeoJSON file",loadFile:o[7]}});function ue(a){o[13](a)}let Y={};return o[1]!==void 0&&(Y.open=o[1]),C=new Se({props:Y}),ie.push(()=>he(C,"open",ue)),{c(){i=r("div"),e=r("div"),p=r("h1"),p.textContent="Welcome to ATIP v2",m=h(),v=r("button"),v.textContent="About",T=h(),b=r("div"),s=r("label"),s.textContent="Select Transport Authority or Local Authority District",S=h(),c=r("input"),B=h(),F=r("datalist"),L=h(),w=r("button"),O=re("Start"),J=h(),D=r("hr"),k=h(),n=r("div"),g=r("label"),g.textContent="Or pick from the map",_=h(),u=r("select"),d=r("option"),d.textContent="Transport Authorities",y=r("option"),y.textContent="Local Authority District",H=h(),f&&f.c(),R=h(),Z=r("hr"),K=h(),ee($.$$.fragment),Q=h(),M=r("div"),M.innerHTML='<div id="map" class="svelte-lyn11h"></div>',P=h(),ee(C.$$.fragment),l(p,"class","govuk-heading-l"),l(v,"class","govuk-button govuk-button--secondary"),l(v,"data-module","govuk-button"),l(s,"class","govuk-label"),l(s,"for","inputValue"),l(c,"class","govuk-input govuk-input--width-20"),l(c,"id","inputValue"),l(c,"name","inputValue"),l(c,"data-testid","transport-authority"),l(c,"list","authorities-list"),l(F,"id","authorities-list"),l(b,"class","govuk-form-group"),l(w,"class","govuk-button"),l(w,"data-module","govuk-button"),w.disabled=I=!o[5],l(g,"class","govuk-label"),l(g,"for","showBoundaries"),d.__value="TA",V(d,d.__value),y.__value="LAD",V(y,y.__value),l(u,"id","showBoundaries"),l(u,"name","showBoundaries"),l(u,"class","govuk-select"),o[3]===void 0&&me(()=>o[12].call(u)),l(n,"class","govuk-form-group"),l(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),l(M,"class","govuk-grid-column-one-half"),l(i,"class","govuk-grid-row")},m(a,A){W(a,i,A),t(i,e),t(e,p),t(e,m),t(e,v),t(e,T),t(e,b),t(b,s),t(b,S),t(b,c),V(c,o[0]),t(b,B),t(b,F),o[11](F),t(e,L),t(e,w),t(w,O),t(e,J),t(e,D),t(e,k),t(e,n),t(n,g),t(n,_),t(n,u),t(u,d),t(u,y),te(u,o[3],!0),t(n,H),f&&f.m(n,null),t(e,R),t(e,Z),t(e,K),oe($,e,null),t(i,Q),t(i,M),W(a,P,A),oe(C,a,A),E=!0,U||(X=[N(v,"click",o[9]),N(c,"input",o[10]),N(w,"click",o[8]),N(u,"change",o[12]),N(u,"change",o[6])],U=!0)},p(a,[A]){A&1&&c.value!==a[0]&&V(c,a[0]),(!E||A&32&&I!==(I=!a[5]))&&(w.disabled=I),A&8&&te(u,a[3]),a[4]?f?f.p(a,A):(f=se(a),f.c(),f.m(n,null)):f&&(f.d(1),f=null);const x={};!G&&A&2&&(G=!0,x.open=a[1],ve(()=>G=!1)),C.$set(x)},i(a){E||(ae($.$$.fragment,a),ae(C.$$.fragment,a),E=!0)},o(a){le($.$$.fragment,a),le(C.$$.fragment,a),E=!1},d(a){a&&(z(i),z(P)),o[11](null),f&&f.d(),ne($),ne(C,a),U=!1,be(X)}}}let q="boundary",j="boundary-layer";function Be(o){if(o.features.length>0){let i=o.features[0].properties;for(let e of["planning","v2","criticals"])if(i&&e in i)return e}return"v1"}function Fe(o,i,e){let p,m=!1,v,T,b=new Set,s=null,S="TA";function c(){s==null||s.setFilter(j,["==",["get","level"],S])}let B=null;ge(async()=>{Ae();const n=await(await fetch(Ce)).text(),g=JSON.parse(n);for(let d of g.features){let y=document.createElement("option");y.value=d.properties.name,T.appendChild(y),b.add(d.properties.name)}s=new ye.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let _=null;function u(){_!==null&&s.setFeatureState({source:q,id:_},{hover:!1})}s.on("load",function(){s.fitBounds(we(g),{padding:20,animate:!1}),s.addSource(q,{type:"geojson",data:g,generateId:!0}),s.addLayer({id:j,source:q,filter:["==",["get","level"],S],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),s.on("mousemove",j,d=>{d.features.length>0&&(u(),_=d.features[0].id,e(4,B=d.features[0].properties.name),s.setFeatureState({source:q,id:_},{hover:!0}))}),s.on("mouseleave",j,()=>{u(),_=null,e(4,B=null)}),s.on("click",j,function(d){let y=d.features[0].properties.name;window.location.href=`scheme.html?authority=${y}`})})});function F(k){try{let n=JSON.parse(k);if(!n.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!b.has(n.authority))throw new Error(`Unknown authority ${n.authority}`);let g=n.authority,_=Be(n);_!="v1"&&(g+=`_${_}`),window.localStorage.setItem(g,JSON.stringify(n)),window.location.href=`scheme.html?authority=${n.authority}&schema=${_}`}catch(n){window.alert(`Couldn't load scheme from a file: ${n}`)}}function L(){window.location.href=`scheme.html?authority=${v}`}const w=()=>e(1,m=!m);function O(){v=this.value,e(0,v)}function I(k){ie[k?"unshift":"push"](()=>{T=k,e(2,T)})}function J(){S=ke(this),e(3,S)}function D(k){m=k,e(1,m)}return o.$$.update=()=>{o.$$.dirty&1&&e(5,p=b.has(v))},[v,m,T,S,B,p,c,F,L,w,O,I,J,D]}class Ie extends de{constructor(i){super(),fe(this,i,Fe,Te,pe,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Ie({target:document.getElementById("app")});
