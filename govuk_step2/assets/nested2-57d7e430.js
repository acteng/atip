import{S as Ce,i as Ne,s as Oe,d as I,m as M,p as v,q as C,u as J,D as pe,w as je,Q as Be,F as Fe,e as h,c as w,t as b,f as Q,j as q,k as s,g as _e,n as V,x as T,a9 as ye,aa as ke,r as A,ai as Le,v as ve,z as he,O as ze,P as Ie}from"./maplibre_helpers-ba9572ec.js";import{L as Me,g as ee,Z as Je,e as de,t as De,I as Ge,B as Te,v as qe,M as Ae,m as Ee,C as Pe}from"./ZoomOutMap-bce6f057.js";import{i as Ze}from"./main-cc41765e.js";function ge(l,e,n){const r=l.slice();return r[17]=e[n],r}function $e(l){let e,n;return e=new Pe({props:{label:`${l[17].scheme_reference}: ${l[17].num_features} features`,$$slots:{default:[He]},$$scope:{ctx:l}}}),{c(){I(e.$$.fragment)},m(r,t){M(e,r,t),n=!0},p(r,t){const o={};t&1&&(o.label=`${r[17].scheme_reference}: ${r[17].num_features} features`),t&1048577&&(o.$$scope={dirty:t,ctx:r}),e.$set(o)},i(r){n||(v(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){J(e,r)}}}function He(l){let e,n,r,t=l[17].authority_or_region+"",o,c,g,m,a=l[17].capital_scheme_id+"",d,E,F,D,S=l[17].funding_programme+"",N,P,G,B,O,i,f,y,_,U;function R(){return l[12](l[17])}function K(){return l[13](l[17])}return{c(){e=h("ul"),n=h("li"),r=b("Authority or region: "),o=b(t),c=w(),g=h("li"),m=b("Capital scheme ID: "),d=b(a),E=w(),F=h("li"),D=b("Funding programme: "),N=b(S),P=w(),G=h("li"),B=h("button"),B.textContent="Show on map",O=w(),i=h("li"),f=h("button"),f.textContent="Edit scheme",y=w(),Q(B,"type","button"),Q(f,"type","button")},m(L,j){q(L,e,j),s(e,n),s(n,r),s(n,o),s(e,c),s(e,g),s(g,m),s(g,d),s(e,E),s(e,F),s(F,D),s(F,N),s(e,P),s(e,G),s(G,B),s(e,O),s(e,i),s(i,f),q(L,y,j),_||(U=[V(B,"click",R),V(f,"click",K)],_=!0)},p(L,j){l=L,j&1&&t!==(t=l[17].authority_or_region+"")&&T(o,t),j&1&&a!==(a=l[17].capital_scheme_id+"")&&T(d,a),j&1&&S!==(S=l[17].funding_programme+"")&&T(N,S)},d(L){L&&(A(e),A(y)),_=!1,ve(U)}}}function be(l){let e=l[2].has(l[17].scheme_reference),n,r,t=e&&$e(l);return{c(){t&&t.c(),n=ze()},m(o,c){t&&t.m(o,c),q(o,n,c),r=!0},p(o,c){c&5&&(e=o[2].has(o[17].scheme_reference)),e?t?(t.p(o,c),c&5&&v(t,1)):(t=$e(o),t.c(),v(t,1),t.m(n.parentNode,n)):t&&(ye(),C(t,1,1,()=>{t=null}),ke())},i(o){r||(v(t),r=!0)},o(o){C(t),r=!1},d(o){o&&A(n),t&&t.d(o)}}}function Qe(l){let e,n,r,t,o,c,g,m,a,d,E,F,D,S,N,P,G,B,O,i,f,y,_,U,R=l[2].size+"",K,L,j=l[3].route+"",te,oe,W=l[3].area+"",re,ae,X=l[3].crossing+"",ne,ie,Y=l[3].other+"",le,ue,fe,x,z,se,ce;c=new Je({props:{boundaryGeojson:l[4]}}),m=new Fe({props:{label:"Load from GeoJSON",loadFile:l[6]}});let Z=de(l[0]),p=[];for(let u=0;u<Z.length;u+=1)p[u]=be(ge(l,Z,u));const Se=u=>C(p[u],1,1,()=>{p[u]=null});return{c(){e=h("div"),n=h("button"),n.textContent="Home",r=w(),t=h("h1"),o=b(`Browse schemes
      `),I(c.$$.fragment),g=w(),I(m.$$.fragment),a=w(),d=h("br"),E=w(),F=h("br"),D=w(),S=h("div"),N=h("label"),P=b("Filter by any field: "),G=h("br"),B=w(),O=h("input"),i=w(),f=h("button"),f.textContent="Clear",y=w(),_=h("p"),U=b("Showing "),K=b(R),L=b(" schemes ("),te=b(j),oe=b(" routes, "),re=b(W),ae=b(` areas,
      `),ne=b(X),ie=b(" crossings, "),le=b(Y),ue=b(" other)"),fe=w(),x=h("ul");for(let u=0;u<p.length;u+=1)p[u].c();Q(n,"type","button"),Q(O,"type","text"),Q(f,"type","button"),Q(e,"slot","sidebar")},m(u,$){q(u,e,$),s(e,n),s(e,r),s(e,t),s(t,o),M(c,t,null),s(e,g),M(m,e,null),s(e,a),s(e,d),s(e,E),s(e,F),s(e,D),s(e,S),s(S,N),s(N,P),s(N,G),s(N,B),s(N,O),_e(O,l[1]),s(S,i),s(S,f),s(e,y),s(e,_),s(_,U),s(_,K),s(_,L),s(_,te),s(_,oe),s(_,re),s(_,ae),s(_,ne),s(_,ie),s(_,le),s(_,ue),s(e,fe),s(e,x);for(let H=0;H<p.length;H+=1)p[H]&&p[H].m(x,null);z=!0,se||(ce=[V(n,"click",l[9]),V(O,"input",l[10]),V(f,"click",l[11])],se=!0)},p(u,$){const H={};if($&16&&(H.boundaryGeojson=u[4]),c.$set(H),$&2&&O.value!==u[1]&&_e(O,u[1]),(!z||$&4)&&R!==(R=u[2].size+"")&&T(K,R),(!z||$&8)&&j!==(j=u[3].route+"")&&T(te,j),(!z||$&8)&&W!==(W=u[3].area+"")&&T(re,W),(!z||$&8)&&X!==(X=u[3].crossing+"")&&T(ne,X),(!z||$&8)&&Y!==(Y=u[3].other+"")&&T(le,Y),$&389){Z=de(u[0]);let k;for(k=0;k<Z.length;k+=1){const me=ge(u,Z,k);p[k]?(p[k].p(me,$),v(p[k],1)):(p[k]=be(me),p[k].c(),v(p[k],1),p[k].m(x,null))}for(ye(),k=Z.length;k<p.length;k+=1)Se(k);ke()}},i(u){if(!z){v(c.$$.fragment,u),v(m.$$.fragment,u);for(let $=0;$<Z.length;$+=1)v(p[$]);z=!0}},o(u){C(c.$$.fragment,u),C(m.$$.fragment,u),p=p.filter(Boolean);for(let $=0;$<p.length;$+=1)C(p[$]);z=!1},d(u){u&&A(e),J(c),J(m),Le(p,u),se=!1,ve(ce)}}}function Re(l){let e,n,r,t,o,c,g,m;return e=new Ge({props:{schema:we}}),r=new Te({props:{style:l[5]}}),o=new qe({props:{schema:we}}),g=new Ae({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:Ve}}),{c(){I(e.$$.fragment),n=w(),I(r.$$.fragment),t=w(),I(o.$$.fragment),c=w(),I(g.$$.fragment)},m(a,d){M(e,a,d),q(a,n,d),M(r,a,d),q(a,t,d),M(o,a,d),q(a,c,d),M(g,a,d),m=!0},p:Ie,i(a){m||(v(e.$$.fragment,a),v(r.$$.fragment,a),v(o.$$.fragment,a),v(g.$$.fragment,a),m=!0)},o(a){C(e.$$.fragment,a),C(r.$$.fragment,a),C(o.$$.fragment,a),C(g.$$.fragment,a),m=!1},d(a){a&&(A(n),A(t),A(c)),J(e,a),J(r,a),J(o,a),J(g,a)}}}function Ue(l){let e,n,r;return n=new De({props:{style:l[5],$$slots:{default:[Re]},$$scope:{ctx:l}}}),{c(){e=h("div"),I(n.$$.fragment),Q(e,"slot","main")},m(t,o){q(t,e,o),M(n,e,null),r=!0},p(t,o){const c={};o&1048576&&(c.$$scope={dirty:o,ctx:t}),n.$set(c)},i(t){r||(v(n.$$.fragment,t),r=!0)},o(t){C(n.$$.fragment,t),r=!1},d(t){t&&A(e),J(n)}}}function Ke(l){let e,n;return e=new Me({props:{$$slots:{main:[Ue],sidebar:[Qe]},$$scope:{ctx:l}}}),{c(){I(e.$$.fragment)},m(r,t){M(e,r,t),n=!0},p(r,[t]){const o={};t&1048607&&(o.$$scope={dirty:t,ctx:r}),e.$set(o)},i(r){n||(v(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){J(e,r)}}}const we="v1";function Ve(l){var e="<table>";for(let[n,r]of Object.entries(l))e+=`<tr><td>${n}</td><td>${r}</td></tr>`;return e+="</table>",e}function We(l,e,n){let r,t;pe(l,ee,i=>n(4,r=i)),pe(l,Ee,i=>n(14,t=i)),je(()=>{Ze()});let c=new URLSearchParams(window.location.search).get("style")||"streets",g=[],m="",a=new Set,d={area:0,route:0,crossing:0,other:0};Be(()=>{ee.set(null)});function E(i){try{let f=JSON.parse(i);ee.set(f),F(f),t==null||t.fitBounds(he(f),{padding:20,animate:!1})}catch(f){window.alert(`Couldn't load schemes from a file: ${f}`)}}function F(i){let f={};for(let[y,_]of Object.entries(i.schemes))f[y]={scheme_reference:y,num_features:0,..._};for(let y of i.features)f[y.properties.scheme_reference].num_features++;n(0,g=Object.values(f))}function D(i){let f={type:"FeatureCollection",features:r.features.filter(y=>y.properties.scheme_reference==i.scheme_reference)};t==null||t.fitBounds(he(f),{padding:20,animate:!1})}function S(i){let f={type:"FeatureCollection",features:r.features.filter(_=>_.properties.scheme_reference==i.scheme_reference)},y=i.authority_or_region;window.localStorage.setItem(y,JSON.stringify(f)),window.open(`scheme.html?authority=${i.authority_or_region}`,"_blank")}const N=()=>window.open("index.html");function P(){m=this.value,n(1,m)}const G=()=>n(1,m=""),B=i=>D(i),O=i=>S(i);return l.$$.update=()=>{if(l.$$.dirty&31){if(a.clear(),m){let i=m.toLowerCase();for(let f of r.features)JSON.stringify(f.properties).toLowerCase().includes(i)&&a.add(f.properties.scheme_reference)}else for(let i of g)a.add(i.scheme_reference);ee.update(i=>{if(!i)return null;for(let f of i.features)a.has(f.properties.scheme_reference)?delete f.properties.hide_while_editing:f.properties.hide_while_editing=!0;return i}),n(3,d={area:0,route:0,crossing:0,other:0});for(let i of r==null?void 0:r.features)a.has(i.properties.scheme_reference)&&n(3,d[i.properties.intervention_type]++,d);n(2,a),n(1,m),n(4,r),n(0,g),n(3,d)}},[g,m,a,d,r,c,E,D,S,N,P,G,B,O]}class Xe extends Ce{constructor(e){super(),Ne(this,e,We,Ke,Oe,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Xe({target:document.getElementById("app")});
