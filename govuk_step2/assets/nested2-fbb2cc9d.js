import{S as Ce,i as Ne,s as Be,x as z,y as J,t as v,h as C,A as M,N as pe,B as je,Z as Fe,F as Le,e as h,o as w,n as b,p as R,d as G,q as s,C as _e,l as Q,r as D,ah as ye,ai as ke,j as T,aq as Oe,H as ve,J as he,D as Ie,Y as ze}from"./maplibre_helpers-1770e886.js";import{L as Je,g as ee,Z as Me,e as de,t as qe,I as Ae,B as De,v as Ge,M as Te,m as Ze,C as Ee}from"./ZoomOutMap-586e4465.js";import{i as He}from"./all-4fc69598.js";function ge(n,e,l){const r=n.slice();return r[17]=e[l],r}function $e(n){let e,l;return e=new Ee({props:{label:`${n[17].scheme_reference}: ${n[17].num_features} features`,$$slots:{default:[Pe]},$$scope:{ctx:n}}}),{c(){z(e.$$.fragment)},m(r,t){J(e,r,t),l=!0},p(r,t){const o={};t&1&&(o.label=`${r[17].scheme_reference}: ${r[17].num_features} features`),t&1048577&&(o.$$scope={dirty:t,ctx:r}),e.$set(o)},i(r){l||(v(e.$$.fragment,r),l=!0)},o(r){C(e.$$.fragment,r),l=!1},d(r){M(e,r)}}}function Pe(n){let e,l,r,t=n[17].authority_or_region+"",o,c,g,m,a=n[17].capital_scheme_id+"",d,Z,L,q,S=n[17].funding_programme+"",N,E,A,F,B,i,f,y,_,Y;function U(){return n[12](n[17])}function K(){return n[13](n[17])}return{c(){e=h("ul"),l=h("li"),r=b("Authority or region: "),o=b(t),c=w(),g=h("li"),m=b("Capital scheme ID: "),d=b(a),Z=w(),L=h("li"),q=b("Funding programme: "),N=b(S),E=w(),A=h("li"),F=h("button"),F.textContent="Show on map",B=w(),i=h("li"),f=h("button"),f.textContent="Edit scheme",y=w(),R(F,"type","button"),R(f,"type","button")},m(O,j){G(O,e,j),s(e,l),s(l,r),s(l,o),s(e,c),s(e,g),s(g,m),s(g,d),s(e,Z),s(e,L),s(L,q),s(L,N),s(e,E),s(e,A),s(A,F),s(e,B),s(e,i),s(i,f),G(O,y,j),_||(Y=[Q(F,"click",U),Q(f,"click",K)],_=!0)},p(O,j){n=O,j&1&&t!==(t=n[17].authority_or_region+"")&&D(o,t),j&1&&a!==(a=n[17].capital_scheme_id+"")&&D(d,a),j&1&&S!==(S=n[17].funding_programme+"")&&D(N,S)},d(O){O&&(T(e),T(y)),_=!1,ve(Y)}}}function be(n){let e=n[2].has(n[17].scheme_reference),l,r,t=e&&$e(n);return{c(){t&&t.c(),l=Ie()},m(o,c){t&&t.m(o,c),G(o,l,c),r=!0},p(o,c){c&5&&(e=o[2].has(o[17].scheme_reference)),e?t?(t.p(o,c),c&5&&v(t,1)):(t=$e(o),t.c(),v(t,1),t.m(l.parentNode,l)):t&&(ye(),C(t,1,1,()=>{t=null}),ke())},i(o){r||(v(t),r=!0)},o(o){C(t),r=!1},d(o){o&&T(l),t&&t.d(o)}}}function Re(n){let e,l,r,t,o,c,g,m,a,d,Z,L,q,S,N,E,A,F,B,i,f,y,_,Y,U=n[2].size+"",K,O,j=n[3].route+"",te,oe,V=n[3].area+"",re,ae,W=n[3].crossing+"",le,ie,X=n[3].other+"",ne,ue,fe,x,I,se,ce;c=new Me({props:{boundaryGeojson:n[4]}}),m=new Le({props:{label:"Load from GeoJSON",loadFile:n[6]}});let H=de(n[0]),p=[];for(let u=0;u<H.length;u+=1)p[u]=be(ge(n,H,u));const Se=u=>C(p[u],1,1,()=>{p[u]=null});return{c(){e=h("div"),l=h("button"),l.textContent="Home",r=w(),t=h("h1"),o=b(`Browse schemes
      `),z(c.$$.fragment),g=w(),z(m.$$.fragment),a=w(),d=h("br"),Z=w(),L=h("br"),q=w(),S=h("div"),N=h("label"),E=b("Filter by any field: "),A=h("br"),F=w(),B=h("input"),i=w(),f=h("button"),f.textContent="Clear",y=w(),_=h("p"),Y=b("Showing "),K=b(U),O=b(" schemes ("),te=b(j),oe=b(" routes, "),re=b(V),ae=b(` areas,
      `),le=b(W),ie=b(" crossings, "),ne=b(X),ue=b(" other)"),fe=w(),x=h("ul");for(let u=0;u<p.length;u+=1)p[u].c();R(l,"type","button"),R(B,"type","text"),R(f,"type","button"),R(e,"slot","sidebar")},m(u,$){G(u,e,$),s(e,l),s(e,r),s(e,t),s(t,o),J(c,t,null),s(e,g),J(m,e,null),s(e,a),s(e,d),s(e,Z),s(e,L),s(e,q),s(e,S),s(S,N),s(N,E),s(N,A),s(N,F),s(N,B),_e(B,n[1]),s(S,i),s(S,f),s(e,y),s(e,_),s(_,Y),s(_,K),s(_,O),s(_,te),s(_,oe),s(_,re),s(_,ae),s(_,le),s(_,ie),s(_,ne),s(_,ue),s(e,fe),s(e,x);for(let P=0;P<p.length;P+=1)p[P]&&p[P].m(x,null);I=!0,se||(ce=[Q(l,"click",n[9]),Q(B,"input",n[10]),Q(f,"click",n[11])],se=!0)},p(u,$){const P={};if($&16&&(P.boundaryGeojson=u[4]),c.$set(P),$&2&&B.value!==u[1]&&_e(B,u[1]),(!I||$&4)&&U!==(U=u[2].size+"")&&D(K,U),(!I||$&8)&&j!==(j=u[3].route+"")&&D(te,j),(!I||$&8)&&V!==(V=u[3].area+"")&&D(re,V),(!I||$&8)&&W!==(W=u[3].crossing+"")&&D(le,W),(!I||$&8)&&X!==(X=u[3].other+"")&&D(ne,X),$&389){H=de(u[0]);let k;for(k=0;k<H.length;k+=1){const me=ge(u,H,k);p[k]?(p[k].p(me,$),v(p[k],1)):(p[k]=be(me),p[k].c(),v(p[k],1),p[k].m(x,null))}for(ye(),k=H.length;k<p.length;k+=1)Se(k);ke()}},i(u){if(!I){v(c.$$.fragment,u),v(m.$$.fragment,u);for(let $=0;$<H.length;$+=1)v(p[$]);I=!0}},o(u){C(c.$$.fragment,u),C(m.$$.fragment,u),p=p.filter(Boolean);for(let $=0;$<p.length;$+=1)C(p[$]);I=!1},d(u){u&&T(e),M(c),M(m),Oe(p,u),se=!1,ve(ce)}}}function Ue(n){let e,l,r,t,o,c,g,m;return e=new Ae({props:{schema:we}}),r=new De({props:{style:n[5]}}),o=new Ge({props:{schema:we}}),g=new Te({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:Qe}}),{c(){z(e.$$.fragment),l=w(),z(r.$$.fragment),t=w(),z(o.$$.fragment),c=w(),z(g.$$.fragment)},m(a,d){J(e,a,d),G(a,l,d),J(r,a,d),G(a,t,d),J(o,a,d),G(a,c,d),J(g,a,d),m=!0},p:ze,i(a){m||(v(e.$$.fragment,a),v(r.$$.fragment,a),v(o.$$.fragment,a),v(g.$$.fragment,a),m=!0)},o(a){C(e.$$.fragment,a),C(r.$$.fragment,a),C(o.$$.fragment,a),C(g.$$.fragment,a),m=!1},d(a){a&&(T(l),T(t),T(c)),M(e,a),M(r,a),M(o,a),M(g,a)}}}function Ye(n){let e,l,r;return l=new qe({props:{style:n[5],$$slots:{default:[Ue]},$$scope:{ctx:n}}}),{c(){e=h("div"),z(l.$$.fragment),R(e,"slot","main")},m(t,o){G(t,e,o),J(l,e,null),r=!0},p(t,o){const c={};o&1048576&&(c.$$scope={dirty:o,ctx:t}),l.$set(c)},i(t){r||(v(l.$$.fragment,t),r=!0)},o(t){C(l.$$.fragment,t),r=!1},d(t){t&&T(e),M(l)}}}function Ke(n){let e,l;return e=new Je({props:{$$slots:{main:[Ye],sidebar:[Re]},$$scope:{ctx:n}}}),{c(){z(e.$$.fragment)},m(r,t){J(e,r,t),l=!0},p(r,[t]){const o={};t&1048607&&(o.$$scope={dirty:t,ctx:r}),e.$set(o)},i(r){l||(v(e.$$.fragment,r),l=!0)},o(r){C(e.$$.fragment,r),l=!1},d(r){M(e,r)}}}const we="v1";function Qe(n){var e="<table>";for(let[l,r]of Object.entries(n))e+=`<tr><td>${l}</td><td>${r}</td></tr>`;return e+="</table>",e}function Ve(n,e,l){let r,t;pe(n,ee,i=>l(4,r=i)),pe(n,Ze,i=>l(14,t=i)),je(()=>{He()});let c=new URLSearchParams(window.location.search).get("style")||"streets",g=[],m="",a=new Set,d={area:0,route:0,crossing:0,other:0};Fe(()=>{ee.set(null)});function Z(i){try{let f=JSON.parse(i);ee.set(f),L(f),t==null||t.fitBounds(he(f),{padding:20,animate:!1})}catch(f){window.alert(`Couldn't load schemes from a file: ${f}`)}}function L(i){let f={};for(let[y,_]of Object.entries(i.schemes))f[y]={scheme_reference:y,num_features:0,..._};for(let y of i.features)f[y.properties.scheme_reference].num_features++;l(0,g=Object.values(f))}function q(i){let f={type:"FeatureCollection",features:r.features.filter(y=>y.properties.scheme_reference==i.scheme_reference)};t==null||t.fitBounds(he(f),{padding:20,animate:!1})}function S(i){let f={type:"FeatureCollection",features:r.features.filter(_=>_.properties.scheme_reference==i.scheme_reference)},y=i.authority_or_region;window.localStorage.setItem(y,JSON.stringify(f)),window.open(`scheme.html?authority=${i.authority_or_region}`,"_blank")}const N=()=>window.open("index.html");function E(){m=this.value,l(1,m)}const A=()=>l(1,m=""),F=i=>q(i),B=i=>S(i);return n.$$.update=()=>{if(n.$$.dirty&31){if(a.clear(),m){let i=m.toLowerCase();for(let f of r.features)JSON.stringify(f.properties).toLowerCase().includes(i)&&a.add(f.properties.scheme_reference)}else for(let i of g)a.add(i.scheme_reference);ee.update(i=>{if(!i)return null;for(let f of i.features)a.has(f.properties.scheme_reference)?delete f.properties.hide_while_editing:f.properties.hide_while_editing=!0;return i}),l(3,d={area:0,route:0,crossing:0,other:0});for(let i of r==null?void 0:r.features)a.has(i.properties.scheme_reference)&&l(3,d[i.properties.intervention_type]++,d);l(2,a),l(1,m),l(4,r),l(0,g),l(3,d)}},[g,m,a,d,r,c,Z,q,S,N,E,A,F,B]}class We extends Ce{constructor(e){super(),Ne(this,e,Ve,Ke,Be,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new We({target:document.getElementById("app")});
