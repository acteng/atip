import{S as D,i as E,s as I,F as fe,g as H,m as V,t as C,n as O,p as W,ak as Q,e as m,N as de,h as p,av as me,j as b,k as _,aE as X,v as U,o as h,al as _e,au as pe,aq as ge,aF as be,u as K,r as L,w as ie,b as re,c as he,l as ve,O as F,J as ye,a8 as q,f as B,aG as Y,a9 as G,aa as R,ab as J,C as N,E as we,I as $,H as x,G as ke,M as Se,L as Ce,K as ee,y as T,P as ce,a7 as j,ac as Le,ad as Oe,aH as Ie,q as Me,a as Be,aj as De,z as Ee}from"./maplibre_helpers-ef63e28d.js";function te(n,e,s){const t=n.slice();return t[8]=e[s][0],t[9]=e[s][1],t}function se(n){let e;return{c(){e=m("option"),e.__value="",K(e,e.__value)},m(s,t){b(s,e,t)},d(s){s&&h(e)}}}function ne(n){let e,s=n[9]+"",t,l;return{c(){e=m("option"),t=L(s),e.__value=l=n[8],K(e,e.__value)},m(o,a){b(o,e,a),_(e,t)},p(o,a){a&8&&s!==(s=o[9]+"")&&ie(t,s),a&8&&l!==(l=o[8])&&(e.__value=l,K(e,e.__value))},d(o){o&&h(e)}}}function je(n){let e,s,t,l,o=n[4]&&se(),a=Q(n[3]),i=[];for(let u=0;u<a.length;u+=1)i[u]=ne(te(n,a,u));return{c(){e=m("select"),o&&o.c(),s=de();for(let u=0;u<i.length;u+=1)i[u].c();p(e,"class","govuk-select"),p(e,"id",n[2]),e.disabled=n[5],n[0]===void 0&&me(()=>n[7].call(e))},m(u,c){b(u,e,c),o&&o.m(e,null),_(e,s);for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(e,null);X(e,n[0],!0),t||(l=[U(e,"change",n[7]),U(e,"change",n[6])],t=!0)},p(u,c){if(u[4]?o||(o=se(),o.c(),o.m(e,s)):o&&(o.d(1),o=null),c&8){a=Q(u[3]);let r;for(r=0;r<a.length;r+=1){const d=te(u,a,r);i[r]?i[r].p(d,c):(i[r]=ne(d),i[r].c(),i[r].m(e,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=a.length}c&4&&p(e,"id",u[2]),c&32&&(e.disabled=u[5]),c&9&&X(e,u[0])},d(u){u&&h(e),o&&o.d(),_e(i,u),t=!1,pe(l)}}}function ze(n){let e,s;return e=new fe({props:{label:n[1],id:n[2],$$slots:{default:[je]},$$scope:{ctx:n}}}),{c(){H(e.$$.fragment)},m(t,l){V(e,t,l),s=!0},p(t,[l]){const o={};l&2&&(o.label=t[1]),l&4&&(o.id=t[2]),l&4157&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){s||(C(e.$$.fragment,t),s=!0)},o(t){O(e.$$.fragment,t),s=!1},d(t){W(e,t)}}}function Pe(n,e,s){let{label:t}=e,{id:l}=e,{choices:o}=e,{emptyOption:a=!1}=e,{disabled:i=!1}=e,{value:u}=e;function c(d){ge.call(this,n,d)}function r(){u=be(this),s(0,u),s(3,o)}return n.$$set=d=>{"label"in d&&s(1,t=d.label),"id"in d&&s(2,l=d.id),"choices"in d&&s(3,o=d.choices),"emptyOption"in d&&s(4,a=d.emptyOption),"disabled"in d&&s(5,i=d.disabled),"value"in d&&s(0,u=d.value)},[u,t,l,o,a,i,c,r]}class Fe extends D{constructor(e){super(),E(this,e,Pe,ze,I,{label:1,id:2,choices:3,emptyOption:4,disabled:5,value:0})}}function Te(n){let e,s,t,l;function o(i){n[2](i)}let a={label:"Basemap",id:"basemap",choices:[["streets","Streets"],["hybrid","Satellite"]]};return n[0]!==void 0&&(a.value=n[0]),s=new Fe({props:a}),re.push(()=>he(s,"value",o)),s.$on("change",n[1]),{c(){e=m("div"),H(s.$$.fragment),p(e,"class","svelte-1tbnm6i")},m(i,u){b(i,e,u),V(s,e,null),l=!0},p(i,[u]){const c={};!t&&u&1&&(t=!0,c.value=i[0],ve(()=>t=!1)),s.$set(c)},i(i){l||(C(s.$$.fragment,i),l=!0)},o(i){O(s.$$.fragment,i),l=!1},d(i){i&&h(e),W(s)}}}function qe(n,e,s){let{style:t}=e;function l(){let a=new URLSearchParams(window.location.search);a.set("style",t);let i=`${window.location.pathname}?${a.toString()}${window.location.hash}`;window.location.href=i}function o(a){t=a,s(0,t)}return n.$$set=a=>{"style"in a&&s(0,t=a.style)},[t,l,o]}class mt extends D{constructor(e){super(),E(this,e,qe,Te,I,{style:0})}}const P=[];function M(n,e=F){let s;const t=new Set;function l(i){if(I(n,i)&&(n=i,s)){const u=!P.length;for(const c of t)c[1](),P.push(c,n);if(u){for(let c=0;c<P.length;c+=2)P[c][0](P[c+1]);P.length=0}}}function o(i){l(i(n))}function a(i,u=F){const c=[i,u];return t.add(c),t.size===1&&(s=e(l,o)||F),i(n),()=>{t.delete(c),t.size===0&&s&&(s(),s=null)}}return{set:l,update:o,subscribe:a}}function Ge(n){return n=="google"||n=="bing"}function _t(n){return{v1:"Scheme Design",v2:"Experimental Scheme Design",planning:"Development Planning",criticals:"Critical Issues",atf4:"ATF4 Scheme"}[n]}const Z=M(null),pt=M(null),ue=M(ye()),Re=M(null),Je=M(null),Ne=M(null),He=M(null),Ve=M(We());Ve.subscribe(n=>window.localStorage.setItem("userSettings",JSON.stringify(n)));const gt=M("edit-attribute"),bt=M(!1);function ht(n){let e=new Set;for(let t of n.features)e.add(t.id);let s=e.size+1;for(;e.has(s);)s++;return s}function vt(n){console.log(`Deleting intervention ${n}`),ue.update(e=>(e.features=e.features.filter(s=>s.id!=n),e)),Re.set(null),Je.set(null),Ne.set(null),He.set(null)}function We(){let n={streetViewImagery:"google",avoidDoublingBack:!1};try{let e=JSON.parse(window.localStorage.getItem("userSettings")||"{}");Ge(e.streetViewImagery)&&(n.streetViewImagery=e.streetViewImagery),typeof e.avoidDoublingBack=="boolean"&&(n.avoidDoublingBack=e.avoidDoublingBack)}catch(e){console.log(`Couldn't parse userSettings from local storage: ${e}`)}return n}const Ze=n=>({}),le=n=>({}),Ae=n=>({}),oe=n=>({});function Ue(n){let e,s,t,l,o,a,i,u,c,r,d;const y=n[3].sidebar,g=q(y,n,n[2],oe),S=n[3].main,w=q(S,n,n[2],le);return{c(){e=m("div"),s=m("aside"),t=m("div"),g&&g.c(),l=B(),o=m("button"),o.textContent="â†’",i=B(),u=m("main"),w&&w.c(),p(t,"class","sidebar-content content-container svelte-ect12w"),p(o,"type","button"),p(o,"class","sidebar-toggle rounded-rect svelte-ect12w"),p(s,"class",a=Y(n[0]?"":"collapsed")+" svelte-ect12w"),p(u,"class","svelte-ect12w"),p(e,"class","overall-layout svelte-ect12w")},m(f,v){b(f,e,v),_(e,s),_(s,t),g&&g.m(t,null),_(s,l),_(s,o),_(e,i),_(e,u),w&&w.m(u,null),c=!0,r||(d=U(o,"click",n[1]),r=!0)},p(f,[v]){g&&g.p&&(!c||v&4)&&G(g,y,f,f[2],c?J(y,f[2],v,Ae):R(f[2]),oe),(!c||v&1&&a!==(a=Y(f[0]?"":"collapsed")+" svelte-ect12w"))&&p(s,"class",a),w&&w.p&&(!c||v&4)&&G(w,S,f,f[2],c?J(S,f[2],v,Ze):R(f[2]),le)},i(f){c||(C(g,f),C(w,f),c=!0)},o(f){O(g,f),O(w,f),c=!1},d(f){f&&h(e),g&&g.d(f),w&&w.d(f),r=!1,d()}}}function Ke(n,e,s){let{$$slots:t={},$$scope:l}=e,o=!0;function a(){s(0,o=!o)}return n.$$set=i=>{"$$scope"in i&&s(2,l=i.$$scope)},[o,a,l,t]}class yt extends D{constructor(e){super(),E(this,e,Ke,Ue,I,{})}}const k={area:"#D94324",route:"#555F5E",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Qe=10,A=10;let z="interventions";function Xe(n,e,s){let t,l;N(n,Z,r=>s(1,t=r)),N(n,ue,r=>s(2,l=r));let{schema:o}=e;we(t,z,l);const a=["match",["get","intervention_type"],"area",k.area,"route",k.route,"crossing",k.crossing,"other",k.other,"white"],i=["match",["get","reference_type",["get","planning"]],"preapp",k.preapp,"outline",k.outline,"reserved matters",k["reserved matters"],"local plan",k["local plan"],"white"],u=["!=","hide_while_editing",!0];return $(t,{id:"interventions-points",source:z,filter:["all",Se,u,["!=","endpoint",!0]],color:a,radius:Qe}),x(t,{id:"interventions-lines",source:z,filter:["all",Ce,u],color:a,width:A}),$(t,{id:"interventions-lines-endpoints",source:z,filter:["==","endpoint",!0],radius:.5*A,opacity:0,strokeColor:k.lineEndpointColor,strokeWidth:2}),ke(t,{id:"interventions-polygons",source:z,filter:["all",ee,u],color:o=="planning"?i:a,opacity:.2}),x(t,{id:"interventions-polygon-outlines",source:z,filter:["all",ee,u],color:o=="planning"?i:a,opacity:.5,width:.7*A}),n.$$set=r=>{"schema"in r&&s(0,o=r.schema)},n.$$.update=()=>{if(n.$$.dirty&6){let r=JSON.parse(JSON.stringify(l)),d=[];for(let y of r.features)if(y.geometry.type=="LineString"&&!y.properties.hide_while_editing)for(let g of[y.geometry.coordinates[0],y.geometry.coordinates[y.geometry.coordinates.length-1]])d.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:g}});r.features=r.features.concat(d),t.getSource(z).setData(r)}},[o,t,l]}class wt extends D{constructor(e){super(),E(this,e,Xe,null,I,{schema:0})}}function Ye(n){let e,s,t,l,o,a,i;const u=n[3].default,c=q(u,n,n[2],null);return{c(){e=m("details"),s=m("summary"),t=m("span"),l=L(n[0]),o=B(),a=m("div"),c&&c.c(),p(t,"class","govuk-details__summary-text"),p(s,"class","govuk-details__summary"),p(a,"class","govuk-details__text"),e.open=n[1],p(e,"class","govuk-details"),p(e,"data-module","govuk-details")},m(r,d){b(r,e,d),_(e,s),_(s,t),_(t,l),_(e,o),_(e,a),c&&c.m(a,null),i=!0},p(r,[d]){(!i||d&1)&&ie(l,r[0]),c&&c.p&&(!i||d&4)&&G(c,u,r,r[2],i?J(u,r[2],d,null):R(r[2]),null),(!i||d&2)&&(e.open=r[1])},i(r){i||(C(c,r),i=!0)},o(r){O(c,r),i=!1},d(r){r&&h(e),c&&c.d(r)}}}function $e(n,e,s){let{$$slots:t={},$$scope:l}=e,{label:o}=e,{open:a=!1}=e;return n.$$set=i=>{"label"in i&&s(0,o=i.label),"open"in i&&s(1,a=i.open),"$$scope"in i&&s(2,l=i.$$scope)},[o,a,l,t]}class xe extends D{constructor(e){super(),E(this,e,$e,Ye,I,{label:0,open:1})}}function et(n,e,s){let t;N(n,Z,c=>s(2,t=c));let{layers:l}=e,{contents:o}=e,a=new T.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"none"});t.on("mousemove",i),t.on("mouseout",u),ce(()=>{t.off("mousemove",i),t.off("mouseout",u),a.remove()});function i(c){if(!l.every(d=>t.getLayer(d))){a.remove();return}let r=t.queryRenderedFeatures(c.point,{layers:l});r.length>0?a.setLngLat(c.lngLat).setHTML(o(r[0].properties)).addTo(t):a.remove()}function u(){a.remove()}return n.$$set=c=>{"layers"in c&&s(0,l=c.layers),"contents"in c&&s(1,o=c.contents)},[l,o]}class kt extends D{constructor(e){super(),E(this,e,et,null,I,{layers:0,contents:1})}}function tt(n){let e,s,t,l,o,a,i,u,c,r,d,y,g,S,w;return{c(){e=m("li"),s=m("span"),t=L("Areas"),l=B(),o=m("li"),a=m("span"),i=L("Routes"),u=B(),c=m("li"),r=m("span"),d=L("Crossings"),y=B(),g=m("li"),S=m("span"),w=L("Other"),p(s,"class","svelte-l42ea0"),j(s,"background",k.area),p(a,"class","svelte-l42ea0"),j(a,"background",k.route),p(r,"class","svelte-l42ea0"),j(r,"background",k.crossing),p(S,"class","svelte-l42ea0"),j(S,"background",k.other)},m(f,v){b(f,e,v),_(e,s),_(e,t),b(f,l,v),b(f,o,v),_(o,a),_(o,i),b(f,u,v),b(f,c,v),_(c,r),_(c,d),b(f,y,v),b(f,g,v),_(g,S),_(g,w)},p:F,d(f){f&&(h(e),h(l),h(o),h(u),h(c),h(y),h(g))}}}function st(n){let e,s,t,l,o,a,i,u,c,r,d,y,g,S,w;return{c(){e=m("li"),s=m("span"),t=L("Preapp"),l=B(),o=m("li"),a=m("span"),i=L("Outline"),u=B(),c=m("li"),r=m("span"),d=L("Reserved matters"),y=B(),g=m("li"),S=m("span"),w=L("Local plan"),p(s,"class","svelte-l42ea0"),j(s,"background",k.preapp),p(a,"class","svelte-l42ea0"),j(a,"background",k.outline),p(r,"class","svelte-l42ea0"),j(r,"background",k["reserved matters"]),p(S,"class","svelte-l42ea0"),j(S,"background",k["local plan"])},m(f,v){b(f,e,v),_(e,s),_(e,t),b(f,l,v),b(f,o,v),_(o,a),_(o,i),b(f,u,v),b(f,c,v),_(c,r),_(c,d),b(f,y,v),b(f,g,v),_(g,S),_(g,w)},p:F,d(f){f&&(h(e),h(l),h(o),h(u),h(c),h(y),h(g))}}}function nt(n){let e;function s(o,a){return o[0]=="planning"?st:tt}let t=s(n),l=t(n);return{c(){e=m("ul"),l.c()},m(o,a){b(o,e,a),l.m(e,null)},p(o,a){t===(t=s(o))&&l?l.p(o,a):(l.d(1),l=t(o),l&&(l.c(),l.m(e,null)))},d(o){o&&h(e),l.d()}}}function lt(n){let e,s,t;return s=new xe({props:{label:"Objects",open:!0,$$slots:{default:[nt]},$$scope:{ctx:n}}}),{c(){e=m("div"),H(s.$$.fragment),p(e,"class","svelte-l42ea0")},m(l,o){b(l,e,o),V(s,e,null),t=!0},p(l,[o]){const a={};o&3&&(a.$$scope={dirty:o,ctx:l}),s.$set(a)},i(l){t||(C(s.$$.fragment,l),t=!0)},o(l){O(s.$$.fragment,l),t=!1},d(l){l&&h(e),W(s)}}}function ot(n,e,s){let{schema:t}=e;return n.$$set=l=>{"schema"in l&&s(0,t=l.schema)},[t]}class St extends D{constructor(e){super(),E(this,e,ot,lt,I,{schema:0})}}function ae(n){let e;const s=n[4].default,t=q(s,n,n[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&G(t,s,l,l[3],e?J(s,l[3],o,null):R(l[3]),null)},i(l){e||(C(t,l),e=!0)},o(l){O(t,l),e=!1},d(l){t&&t.d(l)}}}function at(n){let e,s,t=n[1]&&ae(n);return{c(){e=m("div"),t&&t.c(),p(e,"class","map svelte-12dpf1u")},m(l,o){b(l,e,o),t&&t.m(e,null),n[5](e),s=!0},p(l,[o]){l[1]?t?(t.p(l,o),o&2&&C(t,1)):(t=ae(l),t.c(),C(t,1),t.m(e,null)):t&&(Le(),O(t,1,1,()=>{t=null}),Oe())},i(l){s||(C(t),s=!0)},o(l){O(t),s=!1},d(l){l&&h(e),t&&t.d(),n[5](null)}}}function it(n,e,s){let{$$slots:t={},$$scope:l}=e,{style:o}=e,a,i,u=!1;Ie("setCamera",!window.location.hash),Me(()=>{a=new T.Map({container:i,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),a.addControl(new T.ScaleControl({})),a.addControl(new T.NavigationControl({visualizePitch:!0}),"bottom-right"),a.on("load",()=>{s(1,u=!0),Z.set(a)}),new ResizeObserver(()=>{a.resize()}).observe(i)}),ce(()=>{a.remove()});function c(r){re[r?"unshift":"push"](()=>{i=r,s(0,i)})}return n.$$set=r=>{"style"in r&&s(2,o=r.style),"$$scope"in r&&s(3,l=r.$$scope)},[i,u,o,l,t,c]}class Ct extends D{constructor(e){super(),E(this,e,it,at,I,{style:2})}}const rt="/atip/govuk_step3/assets/zoom_out_map-b2e1091a.svg";function ct(n){let e,s;return{c(){e=m("img"),De(e.src,s=rt)||p(e,"src",s),p(e,"alt","Zoom to show entire boundary")},m(t,l){b(t,e,l)},p:F,d(t){t&&h(e)}}}function ut(n){let e,s;return e=new Be({props:{title:"Zoom to show entire boundary",$$slots:{default:[ct]},$$scope:{ctx:n}}}),e.$on("click",n[0]),{c(){H(e.$$.fragment)},m(t,l){V(e,t,l),s=!0},p(t,[l]){const o={};l&8&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){s||(C(e.$$.fragment,t),s=!0)},o(t){O(e.$$.fragment,t),s=!1},d(t){W(e,t)}}}function ft(n,e,s){let t;N(n,Z,a=>s(2,t=a));let{boundaryGeojson:l}=e;function o(){t.fitBounds(Ee(l),{padding:20,animate:!0,duration:500})}return n.$$set=a=>{"boundaryGeojson"in a&&s(1,l=a.boundaryGeojson)},[o,l]}class Lt extends D{constructor(e){super(),E(this,e,ft,ut,I,{boundaryGeojson:1})}}export{mt as B,xe as C,wt as I,yt as L,kt as M,Fe as S,Lt as Z,Je as a,Qe as b,k as c,gt as d,vt as e,Re as f,ue as g,_t as h,bt as i,Ct as j,St as k,A as l,Z as m,ht as n,He as o,pt as r,Ne as s,Ve as u};
