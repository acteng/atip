import{S as oe,i as le,s as se,c as fe,a as V,e as k,b as Y,d as B,l as ie,u as de,g as ce,f as pe,h as me,t as F,j as I,k as E,m as x,n as he,o as _e,F as ge,p as H,q as ee,r as be,v as y,w as j,x as S,y as c,z as C,A as te,B as N,C as $e,D as U,E as ne,G as ve,H as ye,I as we,J as ke}from"./maplibre_helpers-daac31b3.js";import{R as Ae,A as Se,a as Be}from"./About-9e5380c2.js";function Ee(n){let t,e,s,u;const i=n[2].default,a=fe(i,n,n[1],null);let r=[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},n[0]],f={};for(let l=0;l<r.length;l+=1)f=V(f,r[l]);return{c(){t=k("button"),a&&a.c(),Y(t,f)},m(l,w){B(l,t,w),a&&a.m(t,null),t.autofocus&&t.focus(),e=!0,s||(u=ie(t,"click",n[3]),s=!0)},p(l,[w]){a&&a.p&&(!e||w&2)&&de(a,i,l,l[1],e?pe(i,l[1],w,null):ce(l[1]),null),Y(t,f=me(r,[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},w&1&&l[0]]))},i(l){e||(F(a,l),e=!0)},o(l){I(a,l),e=!1},d(l){l&&E(t),a&&a.d(l),s=!1,u()}}}function Fe(n,t,e){let{$$slots:s={},$$scope:u}=t;function i(a){he.call(this,n,a)}return n.$$set=a=>{e(0,t=V(V({},t),x(a))),"$$scope"in a&&e(1,u=a.$$scope)},t=x(t),[t,u,s,i]}class Ie extends oe{constructor(t){super(),le(this,t,Fe,Ee,se,{})}}function Te(n){let t;return{c(){t=U("About")},m(e,s){B(e,t,s)},d(e){e&&E(t)}}}function je(n){let t,e,s,u,i;return{c(){t=k("input"),e=y(),s=k("datalist"),S(t,"class","govuk-input govuk-input--width-20"),S(t,"id","inputValue"),S(t,"data-testid","transport-authority"),S(t,"list","authorities-list"),S(s,"id","authorities-list")},m(a,r){B(a,t,r),ne(t,n[0]),B(a,e,r),B(a,s,r),n[11](s),u||(i=ie(t,"input",n[10]),u=!0)},p(a,r){r&1&&t.value!==a[0]&&ne(t,a[0])},d(a){a&&(E(t),E(e),E(s)),n[11](null),u=!1,i()}}}function Ce(n){let t;return{c(){t=U("Start")},m(e,s){B(e,t,s)},d(e){e&&E(t)}}}function ae(n){let t,e;return{c(){t=k("i"),e=U(n[4])},m(s,u){B(s,t,u),c(t,e)},p(s,u){u&16&&ve(e,s[4])},d(s){s&&E(t)}}}function Ne(n){let t,e,s,u,i,a,r,f,l,w,T,O,b,D,M,J,q,G,d,p,$,_,v,g,A;i=new _e({props:{$$slots:{default:[Te]},$$scope:{ctx:n}}}),i.$on("click",n[9]),r=new ge({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[je]},$$scope:{ctx:n}}}),l=new Ie({props:{disabled:!n[5],$$slots:{default:[Ce]},$$scope:{ctx:n}}}),l.$on("click",n[8]);function ue(o){n[12](o)}let W={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]],inlineSmall:!0};n[3]!==void 0&&(W.value=n[3]),b=new Ae({props:W}),H.push(()=>ee(b,"value",ue)),b.$on("change",n[6]);let m=n[4]&&ae(n);d=new be({props:{label:"Or upload an ATIP GeoJSON file",loadFile:n[7],id:"load-geojson"}});function re(o){n[13](o)}let z={};return n[1]!==void 0&&(z.open=n[1]),v=new Se({props:z}),H.push(()=>ee(v,"open",re)),{c(){t=k("div"),e=k("div"),s=k("h1"),s.textContent="Welcome to ATIP v2",u=y(),j(i.$$.fragment),a=y(),j(r.$$.fragment),f=y(),j(l.$$.fragment),w=y(),T=k("hr"),O=y(),j(b.$$.fragment),M=y(),m&&m.c(),J=y(),q=k("hr"),G=y(),j(d.$$.fragment),p=y(),$=k("div"),$.innerHTML='<div id="map" class="svelte-lyn11h"></div>',_=y(),j(v.$$.fragment),S(s,"class","govuk-heading-l"),S(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),S($,"class","govuk-grid-column-one-half"),S(t,"class","govuk-grid-row")},m(o,h){B(o,t,h),c(t,e),c(e,s),c(e,u),C(i,e,null),c(e,a),C(r,e,null),c(e,f),C(l,e,null),c(e,w),c(e,T),c(e,O),C(b,e,null),c(e,M),m&&m.m(e,null),c(e,J),c(e,q),c(e,G),C(d,e,null),c(t,p),c(t,$),B(o,_,h),C(v,o,h),A=!0},p(o,[h]){const Z={};h&65536&&(Z.$$scope={dirty:h,ctx:o}),i.$set(Z);const K={};h&65541&&(K.$$scope={dirty:h,ctx:o}),r.$set(K);const R={};h&32&&(R.disabled=!o[5]),h&65536&&(R.$$scope={dirty:h,ctx:o}),l.$set(R);const Q={};!D&&h&8&&(D=!0,Q.value=o[3],te(()=>D=!1)),b.$set(Q),o[4]?m?m.p(o,h):(m=ae(o),m.c(),m.m(e,J)):m&&(m.d(1),m=null);const X={};!g&&h&2&&(g=!0,X.open=o[1],te(()=>g=!1)),v.$set(X)},i(o){A||(F(i.$$.fragment,o),F(r.$$.fragment,o),F(l.$$.fragment,o),F(b.$$.fragment,o),F(d.$$.fragment,o),F(v.$$.fragment,o),A=!0)},o(o){I(i.$$.fragment,o),I(r.$$.fragment,o),I(l.$$.fragment,o),I(b.$$.fragment,o),I(d.$$.fragment,o),I(v.$$.fragment,o),A=!1},d(o){o&&(E(t),E(_)),N(i),N(r),N(l),N(b),m&&m.d(),N(d),N(v,o)}}}let P="boundary",L="boundary-layer";function De(n){if(n.features.length>0){let t=n.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function Je(n,t,e){let s,u=!1,i,a,r=new Set,f=null,l="TA";function w(){f==null||f.setFilter(L,["==",["get","level"],l])}let T=null;$e(async()=>{ye();const p=await(await fetch(Be)).text(),$=JSON.parse(p);for(let g of $.features){let A=document.createElement("option");A.value=g.properties.name,a.appendChild(A),r.add(g.properties.name)}f=new we.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let _=null;function v(){_!==null&&f.setFeatureState({source:P,id:_},{hover:!1})}f.on("load",function(){f.fitBounds(ke($),{padding:20,animate:!1}),f.addSource(P,{type:"geojson",data:$,generateId:!0}),f.addLayer({id:L,source:P,filter:["==",["get","level"],l],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),f.on("mousemove",L,g=>{g.features.length>0&&(v(),_=g.features[0].id,e(4,T=g.features[0].properties.name),f.setFeatureState({source:P,id:_},{hover:!0}))}),f.on("mouseleave",L,()=>{v(),_=null,e(4,T=null)}),f.on("click",L,function(g){let A=g.features[0].properties.name;window.location.href=`scheme.html?authority=${A}`})})});function O(d){try{let p=JSON.parse(d);if(!p.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!r.has(p.authority))throw new Error(`Unknown authority ${p.authority}`);let $=p.authority,_=De(p);_!="v1"&&($+=`_${_}`),window.localStorage.setItem($,JSON.stringify(p)),window.location.href=`scheme.html?authority=${p.authority}&schema=${_}`}catch(p){window.alert(`Couldn't load scheme from a file: ${p}`)}}function b(){window.location.href=`scheme.html?authority=${i}`}const D=()=>e(1,u=!u);function M(){i=this.value,e(0,i)}function J(d){H[d?"unshift":"push"](()=>{a=d,e(2,a)})}function q(d){l=d,e(3,l)}function G(d){u=d,e(1,u)}return n.$$.update=()=>{n.$$.dirty&1&&e(5,s=r.has(i))},[i,u,a,l,T,s,w,O,b,D,M,J,q,G]}class Le extends oe{constructor(t){super(),le(this,t,Je,Ne,se,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Le({target:document.getElementById("app")});
