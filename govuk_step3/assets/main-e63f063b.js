import{S as ae,i as oe,s as le,a as se,F as ie,b as G,c as X,d as re,e as k,f as y,g as B,h as A,j as S,k as d,m as E,l as Y,t as I,n as j,o as F,p as N,q as ue,r as U,u as x,v as fe,w as de,x as pe,y as ce,z as me}from"./maplibre_helpers-6f9e01ef.js";import{D as he,R as ge,A as $e,a as _e}from"./About-66e0c331.js";function be(a){let t;return{c(){t=U("About")},m(e,o){S(e,t,o)},d(e){e&&F(t)}}}function ve(a){let t,e,o,i,l;return{c(){t=k("input"),e=y(),o=k("datalist"),A(t,"class","govuk-input govuk-input--width-20"),A(t,"id","inputValue"),A(t,"data-testid","transport-authority"),A(t,"list","authorities-list"),A(o,"id","authorities-list")},m(r,s){S(r,t,s),x(t,a[0]),S(r,e,s),S(r,o,s),a[11](o),i||(l=fe(t,"input",a[10]),i=!0)},p(r,s){s&1&&t.value!==r[0]&&x(t,r[0])},d(r){r&&(F(t),F(e),F(o)),a[11](null),i=!1,l()}}}function ye(a){let t;return{c(){t=U("Start")},m(e,o){S(e,t,o)},d(e){e&&F(t)}}}function ee(a){let t,e;return{c(){t=k("i"),e=U(a[4])},m(o,i){S(o,t,i),d(t,e)},p(o,i){i&16&&de(e,o[4])},d(o){o&&F(t)}}}function we(a){let t,e,o,i,l,r,s,u,p,O,T,J,_,C,M,D,q,P,f,c,b,g,v,$,w;l=new se({props:{$$slots:{default:[be]},$$scope:{ctx:a}}}),l.$on("click",a[9]),s=new ie({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[ve]},$$scope:{ctx:a}}}),p=new he({props:{disabled:!a[5],$$slots:{default:[ye]},$$scope:{ctx:a}}}),p.$on("click",a[8]);function te(n){a[12](n)}let W={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]],inlineSmall:!0};a[3]!==void 0&&(W.value=a[3]),_=new ge({props:W}),G.push(()=>X(_,"value",te)),_.$on("change",a[6]);let m=a[4]&&ee(a);f=new re({props:{label:"Or upload an ATIP GeoJSON file",loadFile:a[7],id:"load-geojson"}});function ne(n){a[13](n)}let z={};return a[1]!==void 0&&(z.open=a[1]),v=new $e({props:z}),G.push(()=>X(v,"open",ne)),{c(){t=k("div"),e=k("div"),o=k("h1"),o.textContent="Welcome to ATIP v2",i=y(),B(l.$$.fragment),r=y(),B(s.$$.fragment),u=y(),B(p.$$.fragment),O=y(),T=k("hr"),J=y(),B(_.$$.fragment),M=y(),m&&m.c(),D=y(),q=k("hr"),P=y(),B(f.$$.fragment),c=y(),b=k("div"),b.innerHTML='<div id="map" class="svelte-lyn11h"></div>',g=y(),B(v.$$.fragment),A(o,"class","govuk-heading-l"),A(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),A(b,"class","govuk-grid-column-one-half"),A(t,"class","govuk-grid-row")},m(n,h){S(n,t,h),d(t,e),d(e,o),d(e,i),E(l,e,null),d(e,r),E(s,e,null),d(e,u),E(p,e,null),d(e,O),d(e,T),d(e,J),E(_,e,null),d(e,M),m&&m.m(e,null),d(e,D),d(e,q),d(e,P),E(f,e,null),d(t,c),d(t,b),S(n,g,h),E(v,n,h),w=!0},p(n,[h]){const H={};h&65536&&(H.$$scope={dirty:h,ctx:n}),l.$set(H);const Z={};h&65541&&(Z.$$scope={dirty:h,ctx:n}),s.$set(Z);const V={};h&32&&(V.disabled=!n[5]),h&65536&&(V.$$scope={dirty:h,ctx:n}),p.$set(V);const K={};!C&&h&8&&(C=!0,K.value=n[3],Y(()=>C=!1)),_.$set(K),n[4]?m?m.p(n,h):(m=ee(n),m.c(),m.m(e,D)):m&&(m.d(1),m=null);const Q={};!$&&h&2&&($=!0,Q.open=n[1],Y(()=>$=!1)),v.$set(Q)},i(n){w||(I(l.$$.fragment,n),I(s.$$.fragment,n),I(p.$$.fragment,n),I(_.$$.fragment,n),I(f.$$.fragment,n),I(v.$$.fragment,n),w=!0)},o(n){j(l.$$.fragment,n),j(s.$$.fragment,n),j(p.$$.fragment,n),j(_.$$.fragment,n),j(f.$$.fragment,n),j(v.$$.fragment,n),w=!1},d(n){n&&(F(t),F(g)),N(l),N(s),N(p),N(_),m&&m.d(),N(f),N(v,n)}}}let R="boundary",L="boundary-layer";function ke(a){if(a.features.length>0){let t=a.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function Ae(a,t,e){let o,i=!1,l,r,s=new Set,u=null,p="TA";function O(){u==null||u.setFilter(L,["==",["get","level"],p])}let T=null;ue(async()=>{pe();const c=await(await fetch(_e)).text(),b=JSON.parse(c);for(let $ of b.features){let w=document.createElement("option");w.value=$.properties.name,r.appendChild(w),s.add($.properties.name)}u=new ce.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let g=null;function v(){g!==null&&u.setFeatureState({source:R,id:g},{hover:!1})}u.on("load",function(){u.fitBounds(me(b),{padding:20,animate:!1}),u.addSource(R,{type:"geojson",data:b,generateId:!0}),u.addLayer({id:L,source:R,filter:["==",["get","level"],p],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),u.on("mousemove",L,$=>{$.features.length>0&&(v(),g=$.features[0].id,e(4,T=$.features[0].properties.name),u.setFeatureState({source:R,id:g},{hover:!0}))}),u.on("mouseleave",L,()=>{v(),g=null,e(4,T=null)}),u.on("click",L,function($){let w=$.features[0].properties.name;window.location.href=`scheme.html?authority=${w}`})})});function J(f){try{let c=JSON.parse(f);if(!c.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!s.has(c.authority))throw new Error(`Unknown authority ${c.authority}`);let b=c.authority,g=ke(c);g!="v1"&&(b+=`_${g}`),window.localStorage.setItem(b,JSON.stringify(c)),window.location.href=`scheme.html?authority=${c.authority}&schema=${g}`}catch(c){window.alert(`Couldn't load scheme from a file: ${c}`)}}function _(){window.location.href=`scheme.html?authority=${l}`}const C=()=>e(1,i=!i);function M(){l=this.value,e(0,l)}function D(f){G[f?"unshift":"push"](()=>{r=f,e(2,r)})}function q(f){p=f,e(3,p)}function P(f){i=f,e(1,i)}return a.$$.update=()=>{a.$$.dirty&1&&e(5,o=s.has(l))},[l,i,r,p,T,o,O,J,_,C,M,D,q,P]}class Se extends ae{constructor(t){super(),oe(this,t,Ae,we,le,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Se({target:document.getElementById("app")});
