import{S as q,i as W,s as Y,g as L,f as A,e as N,u as B,m as S,j as T,k as U,T as J,t as d,l as $,p as k,q as D,Z as X,a1 as ae,r as Me,b as ee,c as te,F as Ut,o as re,a as _e,h as R,v as Ze,w as Mt,M as Be,C as ge,aV as rt,a0 as Bt,G as Ct,J as Et,K as At,L as zt,aU as Ce,a6 as Pt,x as Nt,D as nt,ay as Ft,aW as He,af as st,d as It,W as Re,y as me,n as he,z as Ot,A as jt,a8 as Vt,aO as Zt,E as Ht,U as Ke,V as Rt,ac as Kt}from"./data_getter-df6eed20.js";import{C as Ee,S as Se,d as ot,j as it,H as lt,h as xt,i as xe,g as at,L as Gt,Z as Jt,M as qt,I as Wt,b as Yt,B as Qt}from"./Map-e72bc6ba.js";function Xt(r){let e=new Map;for(let[n,t]of Object.entries(r.schemes))e.set(n,{scheme_reference:n,num_features:0,authority_or_region:t.authority_or_region,capital_scheme_id:t.capital_scheme_id,funding_programme:t.funding_programme});for(let n of r.features){let t=e.get(n.properties.scheme_reference);t.num_features++,n.properties.funding_programme=t.funding_programme}return e}function er(r){let e;return{c(){e=B("Clear")},m(n,t){T(n,e,t)},d(n){n&&k(e)}}}function tr(r){let e,n,t,s,o,l;return t=new _e({props:{$$slots:{default:[er]},$$scope:{ctx:r}}}),t.$on("click",r[11]),{c(){e=N("input"),n=A(),L(t.$$.fragment),R(e,"type","text"),R(e,"class","govuk-input govuk-input--width-10"),R(e,"id","filterText")},m(a,i){T(a,e,i),Ze(e,r[0]),T(a,n,i),S(t,a,i),s=!0,o||(l=Mt(e,"input",r[10]),o=!0)},p(a,i){i&1&&e.value!==a[0]&&Ze(e,a[0]);const f={};i&16384&&(f.$$scope={dirty:i,ctx:a}),t.$set(f)},i(a){s||(d(t.$$.fragment,a),s=!0)},o(a){$(t.$$.fragment,a),s=!1},d(a){a&&(k(e),k(n)),D(t,a),o=!1,l()}}}function rr(r){let e,n,t,s,o,l,a,i;function f(m){r[8](m)}let u={label:"Authority or region",id:"filterAuthority",choices:r[4],emptyOption:!0};r[2]!==void 0&&(u.value=r[2]),e=new Se({props:u}),ee.push(()=>te(e,"value",f));function c(m){r[9](m)}let v={label:"Funding programme",id:"filterFundingProgramme",choices:r[5],emptyOption:!0};return r[3]!==void 0&&(v.value=r[3]),s=new Se({props:v}),ee.push(()=>te(s,"value",c)),a=new Ut({props:{label:"Intervention name or description",id:"filterText",$$slots:{default:[tr]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),t=A(),L(s.$$.fragment),l=A(),L(a.$$.fragment)},m(m,g){S(e,m,g),T(m,t,g),S(s,m,g),T(m,l,g),S(a,m,g),i=!0},p(m,g){const _={};g&16&&(_.choices=m[4]),!n&&g&4&&(n=!0,_.value=m[2],re(()=>n=!1)),e.$set(_);const w={};g&32&&(w.choices=m[5]),!o&&g&8&&(o=!0,w.value=m[3],re(()=>o=!1)),s.$set(w);const p={};g&16385&&(p.$$scope={dirty:g,ctx:m}),a.$set(p)},i(m){i||(d(e.$$.fragment,m),d(s.$$.fragment,m),d(a.$$.fragment,m),i=!0)},o(m){$(e.$$.fragment,m),$(s.$$.fragment,m),$(a.$$.fragment,m),i=!1},d(m){m&&(k(t),k(l)),D(e,m),D(s,m),D(a,m)}}}function nr(r){let e,n,t,s,o=r[1].size+"",l,a,i=r[6].route+"",f,u,c=r[6].area+"",v,m,g=r[6].crossing+"",_,w,p=r[6].other+"",h,b,C;return e=new Ee({props:{label:"Filters",$$slots:{default:[rr]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),n=A(),t=N("p"),s=B("Showing "),l=B(o),a=B(" schemes ("),f=B(i),u=B(" routes, "),v=B(c),m=B(` areas,
  `),_=B(g),w=B(" crossings, "),h=B(p),b=B(" other)")},m(y,M){S(e,y,M),T(y,n,M),T(y,t,M),U(t,s),U(t,l),U(t,a),U(t,f),U(t,u),U(t,v),U(t,m),U(t,_),U(t,w),U(t,h),U(t,b),C=!0},p(y,[M]){const z={};M&16445&&(z.$$scope={dirty:M,ctx:y}),e.$set(z),(!C||M&2)&&o!==(o=y[1].size+"")&&J(l,o),(!C||M&64)&&i!==(i=y[6].route+"")&&J(f,i),(!C||M&64)&&c!==(c=y[6].area+"")&&J(v,c),(!C||M&64)&&g!==(g=y[6].crossing+"")&&J(_,g),(!C||M&64)&&p!==(p=y[6].other+"")&&J(h,p)},i(y){C||(d(e.$$.fragment,y),C=!0)},o(y){$(e.$$.fragment,y),C=!1},d(y){y&&(k(n),k(t)),D(e,y)}}}function sr(r,e,n){let t;X(r,ae,p=>n(12,t=p));let{schemes:s}=e,{schemesToBeShown:o=new Set}=e,{filterText:l=""}=e,a=[],i="",f=[],u="",c={area:0,route:0,crossing:0,other:0};Me(()=>{let p=new Set,h=new Set;for(let b of s.values())b.authority_or_region&&p.add(b.authority_or_region),b.funding_programme&&h.add(b.funding_programme);n(4,a=Array.from(p.entries())),a.sort(),n(5,f=Array.from(h.entries())),f.sort()});function v(p,h,b){let C=p.toLowerCase(),y=z=>{var P,K;if(C&&!((P=z.properties.name)!=null&&P.toLowerCase().includes(C))&&!((K=z.properties.description)!=null&&K.toLowerCase().includes(C)))return!1;if(h||b){let F=s.get(z.properties.scheme_reference);if(h&&F.authority_or_region!=h||b&&F.funding_programme!=b)return!1}return!0};n(1,o=new Set(t.features.filter(y).map(z=>z.properties.scheme_reference))),n(6,c={area:0,route:0,crossing:0,other:0});let M=z=>{var P,K;return!(!o.has(z.properties.scheme_reference)||C&&!((P=z.properties.name)!=null&&P.toLowerCase().includes(C))&&!((K=z.properties.description)!=null&&K.toLowerCase().includes(C)))};ae.update(z=>{for(let P of z.features)M(P)?(delete P.properties.hide_while_editing,n(6,c[P.properties.intervention_type]++,c)):P.properties.hide_while_editing=!0;return z}),n(6,c)}function m(p){i=p,n(2,i)}function g(p){u=p,n(3,u)}function _(){l=this.value,n(0,l)}const w=()=>n(0,l="");return r.$$set=p=>{"schemes"in p&&n(7,s=p.schemes),"schemesToBeShown"in p&&n(1,o=p.schemesToBeShown),"filterText"in p&&n(0,l=p.filterText)},r.$$.update=()=>{r.$$.dirty&13&&v(l,i,u)},[l,o,i,u,a,f,c,s,m,g,_,w]}class or extends q{constructor(e){super(),W(this,e,sr,nr,Y,{schemes:7,schemesToBeShown:1,filterText:0})}}const Q={schools:"#007DBB",hospitals:"#B73D25",mrn:"#006478",atf2:"#00AFFF",atf3:"#FF62DC",atf4:"#FFD833"};function ir(r){let e,n,t,s;return e=new it({props:{color:r[3]}}),{c(){L(e.$$.fragment),n=A(),t=B(r[1])},m(o,l){S(e,o,l),T(o,n,l),T(o,t,l),s=!0},p(o,l){(!s||l&2)&&J(t,o[1])},i(o){s||(d(e.$$.fragment,o),s=!0)},o(o){$(e.$$.fragment,o),s=!1},d(o){o&&(k(n),k(t)),D(e,o)}}}function lr(r){let e;const n=r[7].default,t=Ct(n,r,r[9],null);return{c(){t&&t.c()},m(s,o){t&&t.m(s,o),e=!0},p(s,o){t&&t.p&&(!e||o&512)&&Et(t,n,s,s[9],e?zt(n,s[9],o,null):At(s[9]),null)},i(s){e||(d(t,s),e=!0)},o(s){$(t,s),e=!1},d(s){t&&t.d(s)}}}function ar(r){let e,n,t;return n=new lt({props:{$$slots:{default:[lr]},$$scope:{ctx:r}}}),{c(){e=N("span"),L(n.$$.fragment),R(e,"slot","right")},m(s,o){T(s,e,o),S(n,e,null),t=!0},p(s,o){const l={};o&512&&(l.$$scope={dirty:o,ctx:s}),n.$set(l)},i(s){t||(d(n.$$.fragment,s),t=!0)},o(s){$(n.$$.fragment,s),t=!1},d(s){s&&k(e),D(n)}}}function fr(r){let e,n,t,s,o;function l(i){r[8](i)}let a={id:r[0],$$slots:{right:[ar],default:[ir]},$$scope:{ctx:r}};return r[2]!==void 0&&(a.checked=r[2]),e=new ot({props:a}),ee.push(()=>te(e,"checked",l)),s=new Be({props:{layers:[r[0]],contents:r[4]}}),{c(){L(e.$$.fragment),t=A(),L(s.$$.fragment)},m(i,f){S(e,i,f),T(i,t,f),S(s,i,f),o=!0},p(i,[f]){const u={};f&1&&(u.id=i[0]),f&514&&(u.$$scope={dirty:f,ctx:i}),!n&&f&4&&(n=!0,u.checked=i[2],re(()=>n=!1)),e.$set(u);const c={};f&1&&(c.layers=[i[0]]),s.$set(c)},i(i){o||(d(e.$$.fragment,i),d(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&k(t),D(e,i),D(s,i)}}}function ur(r,e,n){let t;X(r,ge,m=>n(6,t=m));let{$$slots:s={},$$scope:o}=e,{name:l}=e,{singularNoun:a}=e,{pluralNoun:i}=e,f=Q[l];rt(t,l,`https://atip.uk/layers/v1/${l}.pmtiles`),Bt(t,{id:l,source:l,sourceLayer:l,color:f,opacity:.8});let u=!1;function c(m){return`<p>${m.name??`Unnamed ${a}`}</p>`}function v(m){u=m,n(2,u)}return r.$$set=m=>{"name"in m&&n(0,l=m.name),"singularNoun"in m&&n(5,a=m.singularNoun),"pluralNoun"in m&&n(1,i=m.pluralNoun),"$$scope"in m&&n(9,o=m.$$scope)},r.$$.update=()=>{r.$$.dirty&69&&t.getLayer(l)&&t.setLayoutProperty(l,"visibility",u?"visible":"none")},[l,i,u,f,c,a,t,s,v,o]}class ft extends q{constructor(e){super(),W(this,e,ur,fr,Y,{name:0,singularNoun:5,pluralNoun:1})}}function cr(r){let e;return{c(){e=B("hospital")},m(n,t){T(n,e,t)},d(n){n&&k(e)}}}function mr(r){let e,n,t,s,o;return t=new Ce({props:{href:"https://wiki.openstreetmap.org/wiki/Tag:amenity%3Dhospital",$$slots:{default:[cr]},$$scope:{ctx:r}}}),{c(){e=N("p"),n=B("This shows "),L(t.$$.fragment),s=B(` data from OpenStreetMap. It doesn't include outpatient clinics
    or individual doctor's offices.`)},m(l,a){T(l,e,a),U(e,n),S(t,e,null),U(e,s),o=!0},p(l,a){const i={};a&1&&(i.$$scope={dirty:a,ctx:l}),t.$set(i)},i(l){o||(d(t.$$.fragment,l),o=!0)},o(l){$(t.$$.fragment,l),o=!1},d(l){l&&k(e),D(t)}}}function hr(r){let e,n;return e=new ft({props:{name:"hospitals",singularNoun:"hospital",pluralNoun:"Hospitals",$$slots:{default:[mr]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,s){S(e,t,s),n=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){D(e,t)}}}class pr extends q{constructor(e){super(),W(this,e,null,hr,Y,{})}}function gr(r){let e,n,t;return e=new it({props:{color:r[1]}}),{c(){L(e.$$.fragment),n=B(`
  MRN`)},m(s,o){S(e,s,o),T(s,n,o),t=!0},p:Nt,i(s){t||(d(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){s&&k(n),D(e,s)}}}function dr(r){let e;return{c(){e=B(`Major Road Network
        `)},m(n,t){T(n,e,t)},d(n){n&&k(e)}}}function $r(r){let e,n,t,s,o;return t=new Ce({props:{href:"https://maps.dft.gov.uk/major-road-network/index.html",$$slots:{default:[dr]},$$scope:{ctx:r}}}),{c(){e=N("p"),n=B("Data from the "),L(t.$$.fragment),s=B(".")},m(l,a){T(l,e,a),U(e,n),S(t,e,null),U(e,s),o=!0},p(l,a){const i={};a&16&&(i.$$scope={dirty:a,ctx:l}),t.$set(i)},i(l){o||(d(t.$$.fragment,l),o=!0)},o(l){$(t.$$.fragment,l),o=!1},d(l){l&&k(e),D(t)}}}function _r(r){let e,n,t;return n=new lt({props:{$$slots:{default:[$r]},$$scope:{ctx:r}}}),{c(){e=N("span"),L(n.$$.fragment),R(e,"slot","right")},m(s,o){T(s,e,o),S(n,e,null),t=!0},p(s,o){const l={};o&16&&(l.$$scope={dirty:o,ctx:s}),n.$set(l)},i(s){t||(d(n.$$.fragment,s),t=!0)},o(s){$(n.$$.fragment,s),t=!1},d(s){s&&k(e),D(n)}}}function vr(r){let e,n,t,s,o;function l(i){r[3](i)}let a={id:G,$$slots:{right:[_r],default:[gr]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.checked=r[0]),e=new ot({props:a}),ee.push(()=>te(e,"checked",l)),s=new Be({props:{layers:[G],contents:yr}}),{c(){L(e.$$.fragment),t=A(),L(s.$$.fragment)},m(i,f){S(e,i,f),T(i,t,f),S(s,i,f),o=!0},p(i,[f]){const u={};f&16&&(u.$$scope={dirty:f,ctx:i}),!n&&f&1&&(n=!0,u.checked=i[0],re(()=>n=!1)),e.$set(u)},i(i){o||(d(e.$$.fragment,i),d(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&k(t),D(e,i),D(s,i)}}}let G="mrn";function yr(r){return`<p>${r.name??"Unknown MRN road"}</p>`}function wr(r,e,n){let t;X(r,ge,a=>n(2,t=a));let s=Q.mrn;rt(t,G,`https://atip.uk/layers/v1/${G}.pmtiles`),Pt(t,{id:G,source:G,sourceLayer:G,color:s,width:7});let o=!1;function l(a){o=a,n(0,o)}return r.$$.update=()=>{r.$$.dirty&5&&t.getLayer(G)&&t.setLayoutProperty(G,"visibility",o?"visible":"none")},[o,s,t,l]}class br extends q{constructor(e){super(),W(this,e,wr,vr,Y,{})}}function Tr(r){let e;return{c(){e=B("Show on map")},m(n,t){T(n,e,t)},d(n){n&&k(e)}}}function kr(r){let e;return{c(){e=B("Edit scheme locally")},m(n,t){T(n,e,t)},d(n){n&&k(e)}}}function Lr(r){let e,n,t=r[0].authority_or_region+"",s,o,l,a,i=r[0].capital_scheme_id+"",f,u,c,v,m=r[0].funding_programme+"",g,_,w,p,h,b,C;return p=new _e({props:{$$slots:{default:[Tr]},$$scope:{ctx:r}}}),p.$on("click",r[3]),b=new _e({props:{disabled:r[1],title:r[2],$$slots:{default:[kr]},$$scope:{ctx:r}}}),b.$on("click",r[4]),{c(){e=N("p"),n=B("Authority or region: "),s=B(t),o=A(),l=N("p"),a=B("Capital scheme ID: "),f=B(i),u=A(),c=N("p"),v=B("Funding programme: "),g=B(m),_=A(),w=N("div"),L(p.$$.fragment),h=A(),L(b.$$.fragment),R(w,"class","govuk-button-group")},m(y,M){T(y,e,M),U(e,n),U(e,s),T(y,o,M),T(y,l,M),U(l,a),U(l,f),T(y,u,M),T(y,c,M),U(c,v),U(c,g),T(y,_,M),T(y,w,M),S(p,w,null),U(w,h),S(b,w,null),C=!0},p(y,M){(!C||M&1)&&t!==(t=y[0].authority_or_region+"")&&J(s,t),(!C||M&1)&&i!==(i=y[0].capital_scheme_id+"")&&J(f,i),(!C||M&1)&&m!==(m=y[0].funding_programme+"")&&J(g,m);const z={};M&256&&(z.$$scope={dirty:M,ctx:y}),p.$set(z);const P={};M&256&&(P.$$scope={dirty:M,ctx:y}),b.$set(P)},i(y){C||(d(p.$$.fragment,y),d(b.$$.fragment,y),C=!0)},o(y){$(p.$$.fragment,y),$(b.$$.fragment,y),C=!1},d(y){y&&(k(e),k(o),k(l),k(u),k(c),k(_),k(w)),D(p),D(b)}}}function Sr(r){let e,n;return e=new Ee({props:{label:`${r[0].scheme_reference}: ${r[0].num_features} features`,$$slots:{default:[Lr]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,s){S(e,t,s),n=!0},p(t,[s]){const o={};s&1&&(o.label=`${t[0].scheme_reference}: ${t[0].num_features} features`),s&257&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){D(e,t)}}}function Dr(r,e,n){let t,s;X(r,ae,c=>n(6,t=c)),X(r,ge,c=>n(7,s=c));let{scheme:o}=e,{authorityNames:l}=e,a=!l.has(o.authority_or_region),i=a?"This scheme doesn't have an authority specified correctly, so you can't edit this scheme. We're working to fix this problem.":void 0;function f(){let c={type:"FeatureCollection",features:t.features.filter(v=>v.properties.scheme_reference==o.scheme_reference)};s==null||s.fitBounds(nt(c),{padding:20,animate:!1})}function u(){let c={type:"FeatureCollection",features:t.features.filter(m=>m.properties.scheme_reference==o.scheme_reference)},v=o.authority_or_region;window.localStorage.setItem(v,JSON.stringify(c)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return r.$$set=c=>{"scheme"in c&&n(0,o=c.scheme),"authorityNames"in c&&n(5,l=c.authorityNames)},[o,a,i,f,u,l]}class Ur extends q{constructor(e){super(),W(this,e,Dr,Sr,Y,{scheme:0,authorityNames:5})}}function Mr(r){let e;return{c(){e=B("primary and secondary schools")},m(n,t){T(n,e,t)},d(n){n&&k(e)}}}function Br(r){let e,n,t,s,o;return t=new Ce({props:{href:"https://wiki.openstreetmap.org/wiki/Tag:amenity%3Dschool",$$slots:{default:[Mr]},$$scope:{ctx:r}}}),{c(){e=N("p"),n=B("This shows "),L(t.$$.fragment),s=B(` from OpenStreetMap. It doesn't include kindergartens, colleges,
    universities, or other training schools.`)},m(l,a){T(l,e,a),U(e,n),S(t,e,null),U(e,s),o=!0},p(l,a){const i={};a&1&&(i.$$scope={dirty:a,ctx:l}),t.$set(i)},i(l){o||(d(t.$$.fragment,l),o=!0)},o(l){$(t.$$.fragment,l),o=!1},d(l){l&&k(e),D(t)}}}function Cr(r){let e,n;return e=new ft({props:{name:"schools",singularNoun:"school",pluralNoun:"Schools",$$slots:{default:[Br]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,s){S(e,t,s),n=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){D(e,t)}}}class Er extends q{constructor(e){super(),W(this,e,null,Cr,Y,{})}}function Ar(r){let e,n,t,s,o;function l(i){r[3](i)}let a={label:"Color interventions",id:"colorInterventions",choices:[["interventionType","By intervention type"],["fundingProgramme","By funding programme"]]};return r[0]!==void 0&&(a.value=r[0]),e=new Se({props:a}),ee.push(()=>te(e,"value",l)),e.$on("change",r[2]),s=new xt({props:{rows:r[1]}}),{c(){L(e.$$.fragment),t=A(),L(s.$$.fragment)},m(i,f){S(e,i,f),T(i,t,f),S(s,i,f),o=!0},p(i,[f]){const u={};!n&&f&1&&(n=!0,u.value=i[0],re(()=>n=!1)),e.$set(u);const c={};f&2&&(c.rows=i[1]),s.$set(c)},i(i){o||(d(e.$$.fragment,i),d(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&k(t),D(e,i),D(s,i)}}}function zr(r,e,n){let t;X(r,ge,i=>n(4,t=i));let s="interventionType",o=xe("v1");function l(){let i;s=="interventionType"?(i=at("v1"),n(1,o=xe("v1"))):(i=Ft(["get","funding_programme"],{ATF2:Q.atf2,ATF3:Q.atf3,ATF4:Q.atf4},"grey"),n(1,o=[["ATF2",Q.atf2],["ATF3",Q.atf3],["ATF4",Q.atf4]])),t.setPaintProperty("interventions-points","circle-color",i),t.setPaintProperty("interventions-lines","line-color",i),t.setPaintProperty("interventions-polygons","fill-color",i),t.setPaintProperty("interventions-polygon-outlines","line-color",i)}function a(i){s=i,n(0,s)}return[s,o,l,a]}class Pr extends q{constructor(e){super(),W(this,e,zr,Ar,Y,{})}}var I=(r,e,n)=>new Promise((t,s)=>{var o=i=>{try{a(n.next(i))}catch(f){s(f)}},l=i=>{try{a(n.throw(i))}catch(f){s(f)}},a=i=>i.done?t(i.value):Promise.resolve(i.value).then(o,l);a((n=n.apply(r,e)).next())}),j=Uint8Array,ie=Uint16Array,Nr=Int32Array,ut=new j([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ct=new j([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Fr=new j([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mt=function(r,e){for(var n=new ie(31),t=0;t<31;++t)n[t]=e+=1<<r[t-1];for(var s=new Nr(n[30]),t=1;t<30;++t)for(var o=n[t];o<n[t+1];++o)s[o]=o-n[t]<<5|t;return{b:n,r:s}},ht=mt(ut,2),pt=ht.b,Ir=ht.r;pt[28]=258,Ir[258]=28;var Or=mt(ct,0),jr=Or.b,De=new ie(32768);for(E=0;E<32768;++E)x=(E&43690)>>1|(E&21845)<<1,x=(x&52428)>>2|(x&13107)<<2,x=(x&61680)>>4|(x&3855)<<4,De[E]=((x&65280)>>8|(x&255)<<8)>>1;var x,E,pe=function(r,e,n){for(var t=r.length,s=0,o=new ie(e);s<t;++s)r[s]&&++o[r[s]-1];var l=new ie(e);for(s=1;s<e;++s)l[s]=l[s-1]+o[s-1]<<1;var a;if(n){a=new ie(1<<e);var i=15-e;for(s=0;s<t;++s)if(r[s])for(var f=s<<4|r[s],u=e-r[s],c=l[r[s]-1]++<<u,v=c|(1<<u)-1;c<=v;++c)a[De[c]>>i]=f}else for(a=new ie(t),s=0;s<t;++s)r[s]&&(a[s]=De[l[r[s]-1]++]>>15-r[s]);return a},de=new j(288);for(E=0;E<144;++E)de[E]=8;var E;for(E=144;E<256;++E)de[E]=9;var E;for(E=256;E<280;++E)de[E]=7;var E;for(E=280;E<288;++E)de[E]=8;var E,gt=new j(32);for(E=0;E<32;++E)gt[E]=5;var E,Vr=pe(de,9,1),Zr=pe(gt,5,1),ke=function(r){for(var e=r[0],n=1;n<r.length;++n)r[n]>e&&(e=r[n]);return e},Z=function(r,e,n){var t=e/8|0;return(r[t]|r[t+1]<<8)>>(e&7)&n},Le=function(r,e){var n=e/8|0;return(r[n]|r[n+1]<<8|r[n+2]<<16)>>(e&7)},Hr=function(r){return(r+7)/8|0},Rr=function(r,e,n){(e==null||e<0)&&(e=0),(n==null||n>r.length)&&(n=r.length);var t=new j(n-e);return t.set(r.subarray(e,n)),t},Kr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],O=function(r,e,n){var t=new Error(e||Kr[r]);if(t.code=r,Error.captureStackTrace&&Error.captureStackTrace(t,O),!n)throw t;return t},Ae=function(r,e,n,t){var s=r.length,o=t?t.length:0;if(!s||e.f&&!e.l)return n||new j(0);var l=!n||e.i!=2,a=e.i;n||(n=new j(s*3));var i=function(Oe){var je=n.length;if(Oe>je){var Ve=new j(Math.max(je*2,Oe));Ve.set(n),n=Ve}},f=e.f||0,u=e.p||0,c=e.b||0,v=e.l,m=e.d,g=e.m,_=e.n,w=s*8;do{if(!v){f=Z(r,u,1);var p=Z(r,u+1,3);if(u+=3,p)if(p==1)v=Vr,m=Zr,g=9,_=5;else if(p==2){var y=Z(r,u,31)+257,M=Z(r,u+10,15)+4,z=y+Z(r,u+5,31)+1;u+=14;for(var P=new j(z),K=new j(19),F=0;F<M;++F)K[Fr[F]]=Z(r,u+F*3,7);u+=M*3;for(var ze=ke(K),Tt=(1<<ze)-1,kt=pe(K,ze,1),F=0;F<z;){var Pe=kt[Z(r,u,Tt)];u+=Pe&15;var h=Pe>>4;if(h<16)P[F++]=h;else{var ne=0,$e=0;for(h==16?($e=3+Z(r,u,3),u+=2,ne=P[F-1]):h==17?($e=3+Z(r,u,7),u+=3):h==18&&($e=11+Z(r,u,127),u+=7);$e--;)P[F++]=ne}}var Ne=P.subarray(0,y),V=P.subarray(y);g=ke(Ne),_=ke(V),v=pe(Ne,g,1),m=pe(V,_,1)}else O(1);else{var h=Hr(u)+4,b=r[h-4]|r[h-3]<<8,C=h+b;if(C>s){a&&O(0);break}l&&i(c+b),n.set(r.subarray(h,C),c),e.b=c+=b,e.p=u=C*8,e.f=f;continue}if(u>w){a&&O(0);break}}l&&i(c+131072);for(var Lt=(1<<g)-1,St=(1<<_)-1,ye=u;;ye=u){var ne=v[Le(r,u)&Lt],se=ne>>4;if(u+=ne&15,u>w){a&&O(0);break}if(ne||O(2),se<256)n[c++]=se;else if(se==256){ye=u,v=null;break}else{var Fe=se-254;if(se>264){var F=se-257,fe=ut[F];Fe=Z(r,u,(1<<fe)-1)+pt[F],u+=fe}var we=m[Le(r,u)&St],be=we>>4;we||O(3),u+=we&15;var V=jr[be];if(be>3){var fe=ct[be];V+=Le(r,u)&(1<<fe)-1,u+=fe}if(u>w){a&&O(0);break}l&&i(c+131072);var Te=c+Fe;if(c<V){var Ie=o-V,Dt=Math.min(V,Te);for(Ie+c<0&&O(3);c<Dt;++c)n[c]=t[Ie+c]}for(;c<Te;c+=4)n[c]=n[c-V],n[c+1]=n[c+1-V],n[c+2]=n[c+2-V],n[c+3]=n[c+3-V];c=Te}}e.l=v,e.p=ye,e.b=c,e.f=f,v&&(f=1,e.m=g,e.d=m,e.n=_)}while(!f);return c==n.length?n:Rr(n,0,c)},xr=new j(0),Gr=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&O(6,"invalid gzip data");var e=r[3],n=10;e&4&&(n+=(r[10]|r[11]<<8)+2);for(var t=(e>>3&1)+(e>>4&1);t>0;t-=!r[n++]);return n+(e&2)},Jr=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},qr=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&O(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&O(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function Wr(r,e){return Ae(r,{i:2},e&&e.out,e&&e.dictionary)}function Yr(r,e){var n=Gr(r);return n+8>r.length&&O(6,"invalid gzip data"),Ae(r.subarray(n,-8),{i:2},e&&e.out||new j(Jr(r)),e&&e.dictionary)}function Qr(r,e){return Ae(r.subarray(qr(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Ue(r,e){return r[0]==31&&r[1]==139&&r[2]==8?Yr(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Wr(r,e):Qr(r,e)}var Xr=typeof TextDecoder<"u"&&new TextDecoder,en=0;try{Xr.decode(xr,{stream:!0}),en=1}catch{}var dt=(r,e)=>r*Math.pow(2,e),ue=(r,e)=>Math.floor(r/Math.pow(2,e)),ve=(r,e)=>dt(r.getUint16(e+1,!0),8)+r.getUint8(e),$t=(r,e)=>dt(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),tn=(r,e,n,t,s)=>{if(r!=t.getUint8(s))return r-t.getUint8(s);const o=ve(t,s+1);if(e!=o)return e-o;const l=ve(t,s+4);return n!=l?n-l:0},rn=(r,e,n,t)=>{const s=_t(r,e|128,n,t);return s?{z:e,x:n,y:t,offset:s[0],length:s[1],is_dir:!0}:null},Ge=(r,e,n,t)=>{const s=_t(r,e,n,t);return s?{z:e,x:n,y:t,offset:s[0],length:s[1],is_dir:!1}:null},_t=(r,e,n,t)=>{let s=0,o=r.byteLength/17-1;for(;s<=o;){const l=o+s>>1,a=tn(e,n,t,r,l*17);if(a>0)s=l+1;else if(a<0)o=l-1;else return[$t(r,l*17+7),r.getUint32(l*17+13,!0)]}return null},nn=(r,e)=>r.is_dir&&!e.is_dir?1:!r.is_dir&&e.is_dir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,vt=(r,e)=>{const n=r.getUint8(e*17);return{z:n&127,x:ve(r,e*17+1),y:ve(r,e*17+4),offset:$t(r,e*17+7),length:r.getUint32(e*17+13,!0),is_dir:n>>7===1}},Je=r=>{const e=[],n=new DataView(r);for(let t=0;t<n.byteLength/17;t++)e.push(vt(n,t));return sn(e)},sn=r=>{r.sort(nn);const e=new ArrayBuffer(17*r.length),n=new Uint8Array(e);for(let t=0;t<r.length;t++){const s=r[t];let o=s.z;s.is_dir&&(o=o|128),n[t*17]=o,n[t*17+1]=s.x&255,n[t*17+2]=s.x>>8&255,n[t*17+3]=s.x>>16&255,n[t*17+4]=s.y&255,n[t*17+5]=s.y>>8&255,n[t*17+6]=s.y>>16&255,n[t*17+7]=s.offset&255,n[t*17+8]=ue(s.offset,8)&255,n[t*17+9]=ue(s.offset,16)&255,n[t*17+10]=ue(s.offset,24)&255,n[t*17+11]=ue(s.offset,32)&255,n[t*17+12]=ue(s.offset,48)&255,n[t*17+13]=s.length&255,n[t*17+14]=s.length>>8&255,n[t*17+15]=s.length>>16&255,n[t*17+16]=s.length>>24&255}return e},on=(r,e)=>{if(r.byteLength<17)return null;const n=r.byteLength/17,t=vt(r,n-1);if(t.is_dir){const s=t.z,o=e.z-s,l=Math.trunc(e.x/(1<<o)),a=Math.trunc(e.y/(1<<o));return{z:s,x:l,y:a}}return null};function ln(r){return I(this,null,function*(){const e=yield r.getBytes(0,512e3),n=new DataView(e.data),t=n.getUint32(4,!0),s=n.getUint16(8,!0),o=new TextDecoder("utf-8"),l=JSON.parse(o.decode(new DataView(e.data,10,t)));let a=0;l.compression==="gzip"&&(a=2);let i=0;"minzoom"in l&&(i=+l.minzoom);let f=0;"maxzoom"in l&&(f=+l.maxzoom);let u=0,c=0,v=0,m=-180,g=-85,_=180,w=85;if(l.bounds){const h=l.bounds.split(",");m=+h[0],g=+h[1],_=+h[2],w=+h[3]}if(l.center){const h=l.center.split(",");u=+h[0],c=+h[1],v=+h[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+t,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:t,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:i,maxZoom:f,minLon:m,minLat:g,maxLon:_,maxLat:w,centerZoom:v,centerLon:u,centerLat:c,etag:e.etag}})}function an(r,e,n,t,s,o,l){return I(this,null,function*(){let a=yield n.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=Je(a));const i=Ge(new DataView(a),t,s,o);if(i){let c=(yield e.getBytes(i.offset,i.length,l)).data;const v=new DataView(c);return v.getUint8(0)==31&&v.getUint8(1)==139&&(c=Ue(new Uint8Array(c))),{data:c}}const f=on(new DataView(a),{z:t,x:s,y:o});if(f){const u=rn(new DataView(a),f.z,f.x,f.y);if(u){let c=yield n.getArrayBuffer(e,u.offset,u.length,r);r.specVersion===1&&(c=Je(c));const v=Ge(new DataView(c),t,s,o);if(v){let g=(yield e.getBytes(v.offset,v.length,l)).data;const _=new DataView(g);return _.getUint8(0)==31&&_.getUint8(1)==139&&(g=Ue(new Uint8Array(g))),{data:g}}}}})}var yt={getHeader:ln,getZxy:an},fn=class{constructor(){this.tile=(r,e)=>{if(r.type=="json"){const n=r.url.substr(10);let t=this.tiles.get(n);return t||(t=new qe(n),this.tiles.set(n,t)),t.getHeader().then(s=>{const o={tiles:[r.url+"/{z}/{x}/{y}"],minzoom:s.minZoom,maxzoom:s.maxZoom,bounds:[s.minLon,s.minLat,s.maxLon,s.maxLat]};e(null,o,null,null)}).catch(s=>{e(s,null,null,null)}),{cancel:()=>{}}}else{const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),t=r.url.match(n);if(!t)throw new Error("Invalid PMTiles protocol URL");const s=t[1];let o=this.tiles.get(s);o||(o=new qe(s),this.tiles.set(s,o));const l=t[2],a=t[3],i=t[4],f=new AbortController,u=f.signal;let c=()=>{f.abort()};return o.getHeader().then(v=>{o.getZxy(+l,+a,+i,u).then(m=>{m?e(null,new Uint8Array(m.data),m.cacheControl,m.expires):v.tileType==1?e(null,new Uint8Array,null,null):e(null,null,null,null)}).catch(m=>{m.name!=="AbortError"&&e(m,null,null,null)})}),{cancel:c}}},this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function oe(r,e){return(e>>>0)*4294967296+(r>>>0)}function un(r,e){const n=e.buf;let t,s;if(s=n[e.pos++],t=(s&112)>>4,s<128||(s=n[e.pos++],t|=(s&127)<<3,s<128)||(s=n[e.pos++],t|=(s&127)<<10,s<128)||(s=n[e.pos++],t|=(s&127)<<17,s<128)||(s=n[e.pos++],t|=(s&127)<<24,s<128)||(s=n[e.pos++],t|=(s&1)<<31,s<128))return oe(r,t);throw new Error("Expected varint not more than 10 bytes")}function ce(r){const e=r.buf;let n,t;return t=e[r.pos++],n=t&127,t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,un(n,r))}function cn(r,e,n,t){if(t==0){n==1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}var mn=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function hn(r,e,n){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,r)-1||n>Math.pow(2,r)-1)throw Error("tile x/y outside zoom level bounds");const t=mn[r],s=Math.pow(2,r);let o=0,l=0,a=0;const i=[e,n];let f=s/2;for(;f>0;)o=(i[0]&f)>0?1:0,l=(i[1]&f)>0?1:0,a+=f*f*(3*o^l),cn(f,i,o,l),f=f/2;return t+a}function wt(r,e){return I(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Ue(new Uint8Array(r));{let t=new Response(r).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(t).arrayBuffer()}}else throw Error("Compression method not supported")})}var pn=127;function gn(r,e){let n=0,t=r.length-1;for(;n<=t;){const s=t+n>>1,o=e-r[s].tileId;if(o>0)n=s+1;else if(o<0)t=s-1;else return r[s]}return t>=0&&(r[t].runLength===0||e-r[t].tileId<r[t].runLength)?r[t]:null}var dn=class{constructor(r){this.url=r}getKey(){return this.url}getBytes(r,e,n){return I(this,null,function*(){let t;n||(t=new AbortController,n=t.signal);let s=yield fetch(this.url,{signal:n,headers:{Range:"bytes="+r+"-"+(r+e-1)}});if(s.status===416&&r===0){const a=s.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const i=+a.substr(8);s=yield fetch(this.url,{signal:n,headers:{Range:"bytes=0-"+(i-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw t&&t.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function H(r,e){const n=r.getUint32(e+4,!0),t=r.getUint32(e+0,!0);return n*Math.pow(2,32)+t}function $n(r,e){const n=new DataView(r),t=n.getUint8(7);if(t>3)throw Error(`Archive is spec version ${t} but this library supports up to spec version 3`);return{specVersion:t,rootDirectoryOffset:H(n,8),rootDirectoryLength:H(n,16),jsonMetadataOffset:H(n,24),jsonMetadataLength:H(n,32),leafDirectoryOffset:H(n,40),leafDirectoryLength:H(n,48),tileDataOffset:H(n,56),tileDataLength:H(n,64),numAddressedTiles:H(n,72),numTileEntries:H(n,80),numTileContents:H(n,88),clustered:n.getUint8(96)===1,internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:e}}function bt(r){const e={buf:new Uint8Array(r),pos:0},n=ce(e),t=[];let s=0;for(let o=0;o<n;o++){const l=ce(e);t.push({tileId:s+l,offset:0,length:0,runLength:1}),s+=l}for(let o=0;o<n;o++)t[o].runLength=ce(e);for(let o=0;o<n;o++)t[o].length=ce(e);for(let o=0;o<n;o++){const l=ce(e);l===0&&o>0?t[o].offset=t[o-1].offset+t[o-1].length:t[o].offset=l-1}return t}function _n(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var le=class extends Error{};function vn(r,e,n,t){return I(this,null,function*(){const s=yield r.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(_n(s.data)<3)return[yield yt.getHeader(r)];const l=s.data.slice(0,pn);let a=s.etag;t&&s.etag!=t&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+r.getKey()),a=void 0);const i=$n(l,a);if(n){const f=s.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),u=r.getKey()+"|"+(i.etag||"")+"|"+i.rootDirectoryOffset+"|"+i.rootDirectoryLength,c=bt(yield e(f,i.internalCompression));return[i,[u,c.length,c]]}return[i,void 0]})}function yn(r,e,n,t,s){return I(this,null,function*(){const o=yield r.getBytes(n,t);if(s.etag&&s.etag!==o.etag)throw new le(o.etag);const l=yield e(o.data,s.internalCompression),a=bt(l);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var wn=class{constructor(r=100,e=!0,n=wt){this.cache=new Map,this.maxCacheEntries=r,this.counter=1,this.prefetch=e,this.decompress=n}getHeader(r,e){return I(this,null,function*(){const n=r.getKey();if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const t=new Promise((s,o)=>{vn(r,this.decompress,this.prefetch,e).then(l=>{l[1]&&this.cache.set(l[1][0],{lastUsed:this.counter++,data:Promise.resolve(l[1][2])}),s(l[0]),this.prune()}).catch(l=>{o(l)})});return this.cache.set(n,{lastUsed:this.counter++,data:t}),t})}getDirectory(r,e,n,t){return I(this,null,function*(){const s=r.getKey()+"|"+(t.etag||"")+"|"+e+"|"+n;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((l,a)=>{yn(r,this.decompress,e,n,t).then(i=>{l(i),this.prune()}).catch(i=>{a(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}getArrayBuffer(r,e,n,t){return I(this,null,function*(){const s=r.getKey()+"|"+(t.etag||"")+"|"+e+"|"+n;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((l,a)=>{r.getBytes(e,n).then(i=>{if(t.etag&&t.etag!==i.etag)throw new le(i.etag);l(i.data),this.cache.has(s),this.prune()}).catch(i=>{a(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((n,t)=>{n.lastUsed<r&&(r=n.lastUsed,e=t)}),e&&this.cache.delete(e)}}invalidate(r,e){return I(this,null,function*(){this.cache.delete(r.getKey()),yield this.getHeader(r,e)})}},qe=class{constructor(r,e,n){typeof r=="string"?this.source=new dn(r):this.source=r,n?this.decompress=n:this.decompress=wt,e?this.cache=e:this.cache=new wn}getHeader(){return I(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,n,t){return I(this,null,function*(){const s=hn(r,e,n),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return yt.getZxy(o,this.source,this.cache,r,e,n,t);if(r<o.minZoom||r>o.maxZoom)return;let l=o.rootDirectoryOffset,a=o.rootDirectoryLength;for(let i=0;i<=3;i++){const f=yield this.cache.getDirectory(this.source,l,a,o),u=gn(f,s);if(u)if(u.runLength>0){const c=yield this.source.getBytes(o.tileDataOffset+u.offset,u.length,t);if(o.etag&&o.etag!==c.etag)throw new le(c.etag);return{data:yield this.decompress(c.data,o.tileCompression),cacheControl:c.cacheControl,expires:c.expires}}else l=o.leafDirectoryOffset+u.offset,a=u.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,n,t){return I(this,null,function*(){try{return yield this.getZxyAttempt(r,e,n,t)}catch(s){if(s instanceof le)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(r,e,n,t);throw s}})}getMetadataAttempt(){return I(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength);if(r.etag&&r.etag!==e.etag)throw new le(e.etag);const n=yield this.decompress(e.data,r.internalCompression),t=new TextDecoder("utf-8");return JSON.parse(t.decode(n))})}getMetadata(){return I(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof le)return this.cache.invalidate(this.source,r.message),yield this.getMetadataAttempt();throw r}})}};function bn(r){return Me(()=>{let e=new fn;He.addProtocol("pmtiles",e.tile)}),st(()=>{He.removeProtocol("pmtiles")}),[]}class Tn extends q{constructor(e){super(),W(this,e,bn,null,Y,{})}}function We(r,e,n){const t=r.slice();return t[15]=e[n],t}function kn(r){let e;return{c(){e=B("Home")},m(n,t){T(n,e,t)},d(n){n&&k(e)}}}function Ye(r){let e,n;return e=new Ht({props:{errorMessage:r[1]}}),{c(){L(e.$$.fragment)},m(t,s){S(e,t,s),n=!0},p(t,s){const o={};s&2&&(o.errorMessage=t[1]),e.$set(o)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){D(e,t)}}}function Qe(r){let e,n,t,s;function o(i){r[10](i)}function l(i){r[11](i)}let a={schemes:r[2]};return r[3]!==void 0&&(a.schemesToBeShown=r[3]),r[4]!==void 0&&(a.filterText=r[4]),e=new or({props:a}),ee.push(()=>te(e,"schemesToBeShown",o)),ee.push(()=>te(e,"filterText",l)),{c(){L(e.$$.fragment)},m(i,f){S(e,i,f),s=!0},p(i,f){const u={};f&4&&(u.schemes=i[2]),!n&&f&8&&(n=!0,u.schemesToBeShown=i[3],re(()=>n=!1)),!t&&f&16&&(t=!0,u.filterText=i[4],re(()=>t=!1)),e.$set(u)},i(i){s||(d(e.$$.fragment,i),s=!0)},o(i){$(e.$$.fragment,i),s=!1},d(i){D(e,i)}}}function Xe(r){let e,n,t=Ke(r[2].values()),s=[];for(let l=0;l<t.length;l+=1)s[l]=tt(We(r,t,l));const o=l=>$(s[l],1,1,()=>{s[l]=null});return{c(){e=N("ul");for(let l=0;l<s.length;l+=1)s[l].c()},m(l,a){T(l,e,a);for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(e,null);n=!0},p(l,a){if(a&13){t=Ke(l[2].values());let i;for(i=0;i<t.length;i+=1){const f=We(l,t,i);s[i]?(s[i].p(f,a),d(s[i],1)):(s[i]=tt(f),s[i].c(),d(s[i],1),s[i].m(e,null))}for(me(),i=t.length;i<s.length;i+=1)o(i);he()}},i(l){if(!n){for(let a=0;a<t.length;a+=1)d(s[a]);n=!0}},o(l){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)$(s[a]);n=!1},d(l){l&&k(e),Rt(s,l)}}}function et(r){let e,n;return e=new Ur({props:{scheme:r[15],authorityNames:r[0]}}),{c(){L(e.$$.fragment)},m(t,s){S(e,t,s),n=!0},p(t,s){const o={};s&4&&(o.scheme=t[15]),s&1&&(o.authorityNames=t[0]),e.$set(o)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){D(e,t)}}}function tt(r){let e=r[3].has(r[15].scheme_reference),n,t,s=e&&et(r);return{c(){s&&s.c(),n=Kt()},m(o,l){s&&s.m(o,l),T(o,n,l),t=!0},p(o,l){l&12&&(e=o[3].has(o[15].scheme_reference)),e?s?(s.p(o,l),l&12&&d(s,1)):(s=et(o),s.c(),d(s,1),s.m(n.parentNode,n)):s&&(me(),$(s,1,1,()=>{s=null}),he())},i(o){t||(d(s),t=!0)},o(o){$(s),t=!1},d(o){o&&k(n),s&&s.d(o)}}}function Ln(r){let e,n,t,s,o,l,a,i,f,u,c,v,m;n=new _e({props:{$$slots:{default:[kn]},$$scope:{ctx:r}}}),n.$on("click",r[9]),a=new Jt({props:{boundaryGeojson:r[5]}});let g=r[1]&&Ye(r);u=new It({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:r[7]}});let _=r[2].size>0&&Qe(r),w=r[0]&&Xe(r);return{c(){e=N("div"),L(n.$$.fragment),t=A(),s=N("div"),o=N("h1"),o.textContent="Browse schemes",l=A(),L(a.$$.fragment),i=A(),g&&g.c(),f=A(),L(u.$$.fragment),c=A(),_&&_.c(),v=A(),w&&w.c(),Re(s,"display","flex"),Re(s,"justify-content","space-between"),R(e,"slot","sidebar"),R(e,"class","govuk-prose")},m(p,h){T(p,e,h),S(n,e,null),U(e,t),U(e,s),U(s,o),U(s,l),S(a,s,null),U(e,i),g&&g.m(e,null),U(e,f),S(u,e,null),U(e,c),_&&_.m(e,null),U(e,v),w&&w.m(e,null),m=!0},p(p,h){const b={};h&262144&&(b.$$scope={dirty:h,ctx:p}),n.$set(b);const C={};h&32&&(C.boundaryGeojson=p[5]),a.$set(C),p[1]?g?(g.p(p,h),h&2&&d(g,1)):(g=Ye(p),g.c(),d(g,1),g.m(e,f)):g&&(me(),$(g,1,1,()=>{g=null}),he()),p[2].size>0?_?(_.p(p,h),h&4&&d(_,1)):(_=Qe(p),_.c(),d(_,1),_.m(e,v)):_&&(me(),$(_,1,1,()=>{_=null}),he()),p[0]?w?(w.p(p,h),h&1&&d(w,1)):(w=Xe(p),w.c(),d(w,1),w.m(e,null)):w&&(me(),$(w,1,1,()=>{w=null}),he())},i(p){m||(d(n.$$.fragment,p),d(a.$$.fragment,p),d(g),d(u.$$.fragment,p),d(_),d(w),m=!0)},o(p){$(n.$$.fragment,p),$(a.$$.fragment,p),$(g),$(u.$$.fragment,p),$(_),$(w),m=!1},d(p){p&&k(e),D(n),D(a),g&&g.d(),D(u),_&&_.d(),w&&w.d()}}}function Sn(r){let e,n,t,s,o,l;return e=new Er({}),t=new pr({}),o=new br({}),{c(){L(e.$$.fragment),n=A(),L(t.$$.fragment),s=A(),L(o.$$.fragment)},m(a,i){S(e,a,i),T(a,n,i),S(t,a,i),T(a,s,i),S(o,a,i),l=!0},i(a){l||(d(e.$$.fragment,a),d(t.$$.fragment,a),d(o.$$.fragment,a),l=!0)},o(a){$(e.$$.fragment,a),$(t.$$.fragment,a),$(o.$$.fragment,a),l=!1},d(a){a&&(k(n),k(s)),D(e,a),D(t,a),D(o,a)}}}function Dn(r){let e,n,t,s,o,l,a,i;return e=new Pr({}),o=new Yt({props:{small:!0,$$slots:{default:[Sn]},$$scope:{ctx:r}}}),a=new Qt({props:{style:r[6]}}),{c(){L(e.$$.fragment),n=A(),t=N("hr"),s=A(),L(o.$$.fragment),l=A(),L(a.$$.fragment)},m(f,u){S(e,f,u),T(f,n,u),T(f,t,u),T(f,s,u),S(o,f,u),T(f,l,u),S(a,f,u),i=!0},p(f,u){const c={};u&262144&&(c.$$scope={dirty:u,ctx:f}),o.$set(c)},i(f){i||(d(e.$$.fragment,f),d(o.$$.fragment,f),d(a.$$.fragment,f),i=!0)},o(f){$(e.$$.fragment,f),$(o.$$.fragment,f),$(a.$$.fragment,f),i=!1},d(f){f&&(k(n),k(t),k(s),k(l)),D(e,f),D(o,f),D(a,f)}}}function Un(r){let e,n,t,s,o,l,a;return e=new Wt({props:{colorInterventions:at("v1")}}),t=new Be({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:r[8]}}),l=new Ee({props:{label:"Layers",open:!0,$$slots:{default:[Dn]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),n=A(),L(t.$$.fragment),s=A(),o=N("div"),L(l.$$.fragment),R(o,"class","top-right svelte-nlvvhu")},m(i,f){S(e,i,f),T(i,n,f),S(t,i,f),T(i,s,f),T(i,o,f),S(l,o,null),a=!0},p(i,f){const u={};f&262144&&(u.$$scope={dirty:f,ctx:i}),l.$set(u)},i(i){a||(d(e.$$.fragment,i),d(t.$$.fragment,i),d(l.$$.fragment,i),a=!0)},o(i){$(e.$$.fragment,i),$(t.$$.fragment,i),$(l.$$.fragment,i),a=!1},d(i){i&&(k(n),k(s),k(o)),D(e,i),D(t,i),D(l)}}}function Mn(r){let e,n,t,s,o;return n=new Tn({}),s=new qt({props:{style:r[6],$$slots:{default:[Un]},$$scope:{ctx:r}}}),{c(){e=N("div"),L(n.$$.fragment),t=A(),L(s.$$.fragment),R(e,"slot","main")},m(l,a){T(l,e,a),S(n,e,null),U(e,t),S(s,e,null),o=!0},p(l,a){const i={};a&262144&&(i.$$scope={dirty:a,ctx:l}),s.$set(i)},i(l){o||(d(n.$$.fragment,l),d(s.$$.fragment,l),o=!0)},o(l){$(n.$$.fragment,l),$(s.$$.fragment,l),o=!1},d(l){l&&k(e),D(n),D(s)}}}function Bn(r){let e,n;return e=new Gt({props:{$$slots:{main:[Mn],sidebar:[Ln]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment)},m(t,s){S(e,t,s),n=!0},p(t,[s]){const o={};s&262207&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){D(e,t)}}}function Cn(r,e,n){let t,s;X(r,ge,h=>n(12,t=h)),X(r,ae,h=>n(5,s=h));let o=null;Me(async()=>{Ot();let h=await jt();n(0,o=new Set(h.features.map(b=>b.properties.name)))});let a=new URLSearchParams(window.location.search).get("style")||"dataviz",i="",f=new Map,u=new Set,c="";st(()=>{ae.set(Vt())});function v(h){try{let b=JSON.parse(h);n(2,f=Xt(b)),ae.set(b),n(1,i=""),t==null||t.fitBounds(nt(b),{padding:20,animate:!1})}catch(b){n(1,i=`Couldn't load schemes from a file: ${b}`)}}function m(h){var b='<div style="max-width: 30vw;">';return b+=`<h2>${g(h.name)} (${h.intervention_type})</h2>`,b+=`<p>Scheme reference: ${h.scheme_reference}</p>`,h.length_meters&&(b+=`<p>Length: ${Zt(h.length_meters)}</p>`),h.description&&(b+=`<p>${g(h.description)}</p>`),b+="</div>",b}function g(h){return c?h.replace(new RegExp(c,"gi"),b=>`<mark>${b}</mark>`):h}const _=()=>window.open("index.html");function w(h){u=h,n(3,u)}function p(h){c=h,n(4,c)}return[o,i,f,u,c,s,a,v,m,_,w,p]}class En extends q{constructor(e){super(),W(this,e,Cn,Bn,Y,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new En({target:document.getElementById("app")});
