var zr=Object.defineProperty;var Wr=(r,e,t)=>e in r?zr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var K=(r,e,t)=>(Wr(r,typeof e!="symbol"?e+"":e,t),t),Vr=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var it=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)};var oe=(r,e,t)=>(Vr(r,e,"access private method"),t);import{S as Q,i as ee,s as V,M as Zr,b as pe,a as Ke,d as H,m as J,k as Qe,n as F,o as $,q as z,e as w,c as A,g as S,x as q,p as x,y as Ae,f as C,z as Be,B as $e,C as Kr,D as On,E as tn,F as gt,G as wt,H as kt,I as St,J as xt,K as Yn,h as b,l as U,L as Qr,N as ei,O as te,P as ti,w as Pn,Q as et,R as ge,T as Cn,t as W,U as ke,j as ft,r as tt,V as Rn,W as qn,X as Se,Y as Xn,Z as Pr,_ as Un,$ as ni,a0 as ri,a1 as Me,a2 as ii,a3 as oi,a4 as si,a5 as Hn,a6 as li,a7 as Zt,a8 as vt,a9 as Kt,aa as Ot,ab as An,ac as un,ad as ui,ae as pt,af as In,ag as ze,ah as dt,ai,aj as Nn,ak as fi,al as ci,am as hi,an as Jn,ao as Xt,ap as pi,aq as di,ar as mi,A as gi,u as vi}from"./authorities-d8d13f53.js";function yi(r){let e,t,n,i,o,s,u,l,a,h,g,p,f;return{c(){e=w("p"),e.textContent="For each intervention:",t=A(),n=w("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=A(),o=w("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=A(),u=w("p"),u.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=A(),a=w("p"),a.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,h=A(),g=w("p"),g.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,p=A(),f=w("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(m,v){S(m,e,v),S(m,t,v),S(m,n,v),S(m,i,v),S(m,o,v),S(m,s,v),S(m,u,v),S(m,l,v),S(m,a,v),S(m,h,v),S(m,g,v),S(m,p,v),S(m,f,v)},p:q,d(m){m&&x(e),m&&x(t),m&&x(n),m&&x(i),m&&x(o),m&&x(s),m&&x(u),m&&x(l),m&&x(a),m&&x(h),m&&x(g),m&&x(p),m&&x(f)}}}function _i(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[yi]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new Zr({props:o}),pe.push(()=>Ke(e,"open",i,r[0])),{c(){H(e.$$.fragment)},m(s,u){J(e,s,u),n=!0},p(s,[u]){const l={};u&4&&(l.$$scope={dirty:u,ctx:s}),!t&&u&1&&(t=!0,l.open=s[0],Qe(()=>t=!1)),e.$set(l)},i(s){n||(F(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){z(e,s)}}}function bi(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class wi extends Q{constructor(e){super(),ee(this,e,bi,_i,V,{open:0})}}const ot=[];function yt(r,e=q){let t;const n=new Set;function i(u){if(V(r,u)&&(r=u,t)){const l=!ot.length;for(const a of n)a[1](),ot.push(a,r);if(l){for(let a=0;a<ot.length;a+=2)ot[a][0](ot[a+1]);ot.length=0}}}function o(u){i(u(r))}function s(u,l=q){const a=[u,l];return n.add(a),n.size===1&&(t=e(i)||q),u(r),()=>{n.delete(a),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ie=yt(null),ne=yt(Ae()),be=yt(null),Te=yt(null),Ut=yt(null),an=yt(null);function Qt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Cr(r){ne.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),be.set(null),Te.set(null),Ut.set(null)}function zn(r){let e;const t=r[4].default,n=wt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&kt(n,t,i,i[3],e?xt(t,i[3],o,null):St(i[3]),null)},i(i){e||(F(n,i),e=!0)},o(i){$(n,i),e=!1},d(i){n&&n.d(i)}}}function ki(r){let e,t,n=r[1]&&zn(r);return{c(){e=w("div"),n&&n.c(),C(e,"class","map svelte-12dpf1u")},m(i,o){S(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&F(n,1)):(n=zn(i),n.c(),F(n,1),n.m(e,null)):n&&(Be(),$(n,1,1,()=>{n=null}),$e())},i(i){t||(F(n),t=!0)},o(i){$(n),t=!1},d(i){i&&x(e),n&&n.d(),r[5](null)}}}function Si(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,u,l=!1;Kr("setCamera",!window.location.hash),On(()=>{s=new tn.Map({container:u,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new tn.ScaleControl({})),s.addControl(new tn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ie.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(u)}),gt(()=>{s.remove()});function a(h){pe[h?"unshift":"push"](()=>{u=h,t(0,u)})}return r.$$set=h=>{"style"in h&&t(2,o=h.style),"$$scope"in h&&t(3,i=h.$$scope)},[u,l,o,i,n,a]}class xi extends Q{constructor(e){super(),ee(this,e,Si,ki,V,{style:2})}}const Ei=r=>({}),Wn=r=>({}),Mi=r=>({}),Vn=r=>({}),Li=r=>({}),Zn=r=>({});function Oi(r){let e,t,n,i,o,s,u,l,a,h,g,p;const f=r[3].nav,m=wt(f,r,r[2],Zn),v=r[3].sidebar,_=wt(v,r,r[2],Vn),k=r[3].main,c=wt(k,r,r[2],Wn);return{c(){e=w("aside"),t=w("div"),n=w("nav"),m&&m.c(),i=A(),_&&_.c(),o=A(),s=w("button"),s.textContent="→",l=A(),a=w("main"),c&&c.c(),C(n,"class","svelte-1u7vg8a"),C(t,"class","sidebar-content content-container svelte-1u7vg8a"),C(s,"type","button"),C(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),C(e,"class",u=Yn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),C(a,"class","svelte-1u7vg8a")},m(d,y){S(d,e,y),b(e,t),b(t,n),m&&m.m(n,null),b(t,i),_&&_.m(t,null),b(e,o),b(e,s),S(d,l,y),S(d,a,y),c&&c.m(a,null),h=!0,g||(p=U(s,"click",r[1]),g=!0)},p(d,[y]){m&&m.p&&(!h||y&4)&&kt(m,f,d,d[2],h?xt(f,d[2],y,Li):St(d[2]),Zn),_&&_.p&&(!h||y&4)&&kt(_,v,d,d[2],h?xt(v,d[2],y,Mi):St(d[2]),Vn),(!h||y&1&&u!==(u=Yn(d[0]?"":"collapsed")+" svelte-1u7vg8a"))&&C(e,"class",u),c&&c.p&&(!h||y&4)&&kt(c,k,d,d[2],h?xt(k,d[2],y,Ei):St(d[2]),Wn)},i(d){h||(F(m,d),F(_,d),F(c,d),h=!0)},o(d){$(m,d),$(_,d),$(c,d),h=!1},d(d){d&&x(e),m&&m.d(d),_&&_.d(d),d&&x(l),d&&x(a),c&&c.d(d),g=!1,p()}}}function Pi(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=u=>{"$$scope"in u&&t(2,i=u.$$scope)},[o,s,i,n]}class Ci extends Q{constructor(e){super(),ee(this,e,Pi,Oi,V,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Ri(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(h){return l([a,h])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(h){a=[6,h],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var Ve=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Ai(r,e){return r>e?1:r<e?-1:0}function Xe(r,e,t){for(var n=new Ve(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function nn(r,e,t,n){var i=new Ve(r,e);if(t===null)return i.left=i.right=null,i;t=Xe(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Kn(r,e,t){var n=null,i=null;if(e){e=Xe(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Ii(r,e,t){return e===null?r:(r===null||(e=Xe(r.key,e,t),e.left=r),e)}function fn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&fn(r.left,o,!1,n,i),r.right&&fn(r.right,o,!0,n,i)}}var Fn=function(){function r(e){e===void 0&&(e=Ai),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=nn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ve(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Xe(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Xe(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Xe(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Xe(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Xe(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,u=this._root,l;o.length!==0||u;)if(u)o.push(u),u=u.left;else{if(u=o.pop(),l=s(u.key,t),l>0)break;if(s(u.key,e)>=0&&n.call(i,u))return this;u=u.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Fi(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&pn(e,t,0,i-1,o),this._root===null)this._root=cn(e,t,0,i),this._size=i;else{var s=Ti(this.toList(),Ni(e,t),o);i=this._size+i,this._root=hn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return fn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Kn(e,this._root,i),s=o.left,u=o.right;i(e,t)<0?u=nn(t,n,u,i):s=nn(t,n,s,i),this._root=Ii(s,u,i)},r.prototype.split=function(e){return Kn(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Ri(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function cn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],u=e[o],l=new Ve(s,u);return l.left=cn(r,e,t,o),l.right=cn(r,e,o+1,n),l}return null}function Ni(r,e){for(var t=new Ve(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ve(r[i],e[i]);return n.next=null,t.next}function Fi(r){for(var e=r,t=[],n=!1,i=new Ve(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function hn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=hn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=hn(r,i+1,t),s}return null}function Ti(r,e,t){for(var n=new Ve(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function pn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,u=n+1;;){do s++;while(i(r[s],o)<0);do u--;while(i(r[u],o)>0);if(s>=u)break;var l=r[s];r[s]=r[u],r[u]=l,l=e[s],e[s]=e[u],e[u]=l}pn(r,e,t,u,i),pn(r,e,u+1,n,i)}}function xe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Qn(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function ve(r,e,t){return e&&Qn(r.prototype,e),t&&Qn(r,t),r}var bt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},dn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},He=Number.EPSILON;He===void 0&&(He=Math.pow(2,-52));var Bi=He*He,mn=function(e,t){if(-He<e&&e<He&&-He<t&&t<He)return 0;var n=e-t;return n*n<Bi*e*t?0:e<t?-1:1},$i=function(){function r(){xe(this,r),this.reset()}return ve(r,[{key:"reset",value:function(){this.xRounder=new er,this.yRounder=new er}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),er=function(){function r(){xe(this,r),this.tree=new Fn,this.round(0)}return ve(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&mn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&mn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Pt=new $i,Et=function(e,t){return e.x*t.y-e.y*t.x},Rr=function(e,t){return e.x*t.x+e.y*t.y},tr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Et(i,o);return mn(s,0)},Ht=function(e){return Math.sqrt(Rr(e,e))},Di=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Et(o,i)/Ht(o)/Ht(i)},Gi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Rr(o,i)/Ht(o)/Ht(i)},nr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},rr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},ji=function(e,t,n,i){if(t.x===0)return rr(n,i,e.x);if(i.x===0)return rr(e,t,n.x);if(t.y===0)return nr(n,i,e.y);if(i.y===0)return nr(e,t,n.y);var o=Et(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},u=Et(s,t)/o,l=Et(s,i)/o,a=e.x+l*t.x,h=n.x+u*i.x,g=e.y+l*t.y,p=n.y+u*i.y,f=(a+h)/2,m=(g+p)/2;return{x:f,y:m}},Pe=function(){ve(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Jt.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){xe(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return ve(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(u){var l=u.otherSE;i.set(u,{sine:Di(n.point,t.point,l.point),cosine:Gi(n.point,t.point,l.point)})};return function(s,u){i.has(s)||o(s),i.has(u)||o(u);var l=i.get(s),a=l.sine,h=l.cosine,g=i.get(u),p=g.sine,f=g.cosine;return a>=0&&p>=0?h<f?1:h>f?-1:0:a<0&&p<0?h<f?-1:h>f?1:0:p<a?-1:p>a?1:0}}}]),r}(),Yi=0,Jt=function(){ve(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,u=n.rightSE.point.x;if(u<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,a=n.leftSE.point.y,h=t.rightSE.point.y,g=n.rightSE.point.y;if(i<o){if(a<l&&a<h)return 1;if(a>l&&a>h)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<a&&l<g)return-1;if(l>a&&l>g)return 1;var m=n.comparePoint(t.leftSE.point);if(m!==0)return m;var v=t.comparePoint(n.rightSE.point);return v<0?1:v>0?-1:1}if(l<a)return-1;if(l>a)return 1;if(s<u){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>u){var k=t.comparePoint(n.rightSE.point);if(k<0)return 1;if(k>0)return-1}if(s!==u){var c=h-l,d=s-i,y=g-a,M=u-o;if(c>d&&y<M)return 1;if(c<d&&y>M)return-1}return s>u?1:s<u||h<g?-1:h>g?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){xe(this,r),this.id=++Yi,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return ve(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,u=n.x+s*o.x;if(t.x===u)return 0;var l=(t.x-n.x)/o.x,a=n.y+l*o.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=dn(n,i);if(o===null)return null;var s=this.leftSE.point,u=this.rightSE.point,l=t.leftSE.point,a=t.rightSE.point,h=bt(n,l)&&this.comparePoint(l)===0,g=bt(i,s)&&t.comparePoint(s)===0,p=bt(n,a)&&this.comparePoint(a)===0,f=bt(i,u)&&t.comparePoint(u)===0;if(g&&h)return f&&!p?u:!f&&p?a:null;if(g)return p&&s.x===a.x&&s.y===a.y?null:s;if(h)return f&&u.x===l.x&&u.y===l.y?null:l;if(f&&p)return null;if(f)return u;if(p)return a;var m=ji(s,this.vector(),l,t.vector());return m===null||!bt(o,m)?null:Pt.round(m.x,m.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Pe(t,!0),s=new Pe(t,!1),u=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,u,this.rings.slice(),this.windings.slice());return Pe.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Pe.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var u=n;n=i,i=u}for(var l=0,a=i.rings.length;l<a;l++){var h=i.rings[l],g=i.windings[l],p=n.rings.indexOf(h);p===-1?(n.rings.push(h),n.windings.push(g)):n.windings[p]+=g}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,u=this.rings.length;s<u;s++){var l=this.rings[s],a=this.windings[s],h=n.indexOf(l);h===-1?(n.push(l),i.push(a)):i[h]+=a}for(var g=[],p=[],f=0,m=n.length;f<m;f++)if(i[f]!==0){var v=n[f],_=v.poly;if(p.indexOf(_)===-1)if(v.isExterior)g.push(_);else{p.indexOf(_)===-1&&p.push(_);var k=g.indexOf(v.poly);k!==-1&&g.splice(k,1)}}for(var c=0,d=g.length;c<d;c++){var y=g[c].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Le.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,u;t.length<n.length?(s=t.length,u=n.length):(s=n.length,u=t.length),this._isInResult=u===Le.numMultiPolys&&s<u;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var a=function(g){return g.length===1&&g[0].isSubject};this._isInResult=a(t)!==a(n);break}default:throw new Error("Unrecognized operation type found ".concat(Le.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,u,l=Pe.comparePoints(t,n);if(l<0)o=t,s=n,u=1;else if(l>0)o=n,s=t,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var a=new Pe(o,!0),h=new Pe(s,!1);return new r(a,h,[i],[u])}}]),r}(),ir=function(){function r(e,t,n){if(xe(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Pt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,u=e.length;s<u;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Pt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(Jt.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Jt.fromRing(o,i,this))}return ve(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),qi=function(){function r(e,t){if(xe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ir(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new ir(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return ve(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),or=function(){function r(e,t){if(xe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new qi(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return ve(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),Xi=function(){ve(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var u=null,l=s.leftSE,a=s.rightSE,h=[l],g=l.point,p=[];u=l,l=a,h.push(l),l.point!==g;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var m=h[0].point,v=h[h.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(m.x,",")+" ".concat(m.y,"]. Last matching segment found ends at")+" [".concat(v.x,", ").concat(v.y,"]."))}if(f.length===1){a=f[0].otherSE;break}for(var _=null,k=0,c=p.length;k<c;k++)if(p[k].point===l.point){_=k;break}if(_!==null){var d=p.splice(_)[0],y=h.splice(d.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}p.push({index:h.length,point:l.point});var M=l.getLeftmostComparator(u);a=f.sort(M)[0].otherSE;break}n.push(new r(h))}}return n}}]);function r(e){xe(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return ve(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,u=this.events[i+1].point;tr(s,t,u)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],a=n[1];tr(l,t,a)===0&&n.shift(),n.push(n[0]);for(var h=this.isExteriorRing()?1:-1,g=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,f=[],m=g;m!=p;m+=h)f.push([n[m].x,n[m].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Pe.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),u=s?s.prevInResult():null;;){if(!s)return null;if(!u)return s.ringOut;if(u.ringOut!==s.ringOut)return u.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=u.prevInResult(),u=s?s.prevInResult():null}}}]),r}(),sr=function(){function r(e){xe(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return ve(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),Ui=function(){function r(e){xe(this,r),this.rings=e,this.polys=this._composePolys(e)}return ve(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new sr(s));else{var u=s.enclosingRing();u.poly||n.push(new sr(u)),u.poly.addInterior(s)}}return n}}]),r}(),Hi=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jt.compare;xe(this,r),this.queue=e,this.tree=new Fn(t),this.segments=[]}return ve(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,u=o,l=void 0,a=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;a===void 0;)u=this.tree.next(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);if(t.isLeft){var h=null;if(l){var g=l.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(h=g),!l.isAnEndpoint(g)))for(var p=this._splitSafely(l,g),f=0,m=p.length;f<m;f++)i.push(p[f])}var v=null;if(a){var _=a.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(v=_),!a.isAnEndpoint(_)))for(var k=this._splitSafely(a,_),c=0,d=k.length;c<d;c++)i.push(k[c])}if(h!==null||v!==null){var y=null;if(h===null)y=v;else if(v===null)y=h;else{var M=Pe.comparePoints(h,v);y=M<=0?h:v}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var P=n.split(y),L=0,O=P.length;L<O;L++)i.push(P[L])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&a){var I=l.getIntersection(a);if(I!==null){if(!l.isAnEndpoint(I))for(var B=this._splitSafely(l,I),N=0,G=B.length;N<G;N++)i.push(B[N]);if(!a.isAnEndpoint(I))for(var E=this._splitSafely(a,I),T=0,ie=E.length;T<ie;T++)i.push(E[T])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),lr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ji=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,zi=function(){function r(){xe(this,r)}return ve(r,[{key:"run",value:function(t,n,i){Le.type=t,Pt.reset();for(var o=[new or(n,!0)],s=0,u=i.length;s<u;s++)o.push(new or(i[s],!1));if(Le.numMultiPolys=o.length,Le.type==="difference")for(var l=o[0],a=1;a<o.length;)dn(o[a].bbox,l.bbox)!==null?a++:o.splice(a,1);if(Le.type==="intersection"){for(var h=0,g=o.length;h<g;h++)for(var p=o[h],f=h+1,m=o.length;f<m;f++)if(dn(p.bbox,o[f].bbox)===null)return[]}for(var v=new Fn(Pe.compare),_=0,k=o.length;_<k;_++)for(var c=o[_].getSweepEvents(),d=0,y=c.length;d<y;d++)if(v.insert(c[d]),v.size>lr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new Hi(v),P=v.size,L=v.pop();L;){var O=L.key;if(v.size===P){var I=O.segment;throw new Error("Unable to pop() ".concat(O.isLeft?"left":"right"," SweepEvent ")+"[".concat(O.point.x,", ").concat(O.point.y,"] from segment #").concat(I.id," ")+"[".concat(I.leftSE.point.x,", ").concat(I.leftSE.point.y,"] -> ")+"[".concat(I.rightSE.point.x,", ").concat(I.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(v.size>lr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>Ji)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var B=M.process(O),N=0,G=B.length;N<G;N++){var E=B[N];E.consumedBy===void 0&&v.insert(E)}P=v.size,L=v.pop()}Pt.reset();var T=Xi.factory(M.segments),ie=new Ui(T);return ie.getGeom()}}]),r}(),Le=new zi,Wi=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Le.run("union",e,n)},Vi=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Le.run("intersection",e,n)},Zi=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Le.run("xor",e,n)},Ki=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Le.run("difference",e,n)},$t={union:Wi,intersection:Vi,xor:Zi,difference:Ki};function Qi(r,e){var t=to(e),n=null;return r.type==="FeatureCollection"?n=eo(r):n=Ar($t.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function eo(r){var e=r.features.length===2?$t.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):$t.union.apply($t,r.features.map(function(t){return t.geometry.coordinates}));return Ar(e)}function Ar(r){return Qr(r)}function to(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return ei(t)}function no(r,e,t){let n;te(r,Ie,s=>t(1,n=s));let{boundaryGeojson:i}=e;return ti("setCamera")&&n.fitBounds(Pn(i),{padding:20,animate:!1}),et(n,"boundary",{type:"geojson",data:Qi(i)}),ge(n,{id:"boundary",source:"boundary",...Cn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class ro extends Q{constructor(e){super(),ee(this,e,no,null,V,{boundaryGeojson:0})}}function ur(r){let e,t=ar(r[4])+"",n,i,o,s,u;return{c(){e=W("Length: "),n=W(t),i=A(),o=w("br"),s=A(),u=w("br")},m(l,a){S(l,e,a),S(l,n,a),S(l,i,a),S(l,o,a),S(l,s,a),S(l,u,a)},p(l,a){a&16&&t!==(t=ar(l[4])+"")&&Rn(n,t)},d(l){l&&x(e),l&&x(n),l&&x(i),l&&x(o),l&&x(s),l&&x(u)}}}function io(r){let e,t,n,i,o,s,u,l,a,h,g,p,f,m,v,_,k,c,d,y,M,P,L,O,I,B,N,G,E,T,ie,de,we,se,ye,Ee,me,Z,nt,De,Ge,ae,ce,rt,je,_t,re,he=r[4]&&ur(r);return{c(){e=w("label"),t=W("Name:"),n=w("br"),i=A(),o=w("input"),s=A(),u=w("br"),l=A(),a=w("br"),h=A(),g=w("label"),p=w("input"),f=W(`
  Area`),m=A(),v=w("label"),_=w("input"),k=W(`
  Route`),c=A(),d=w("label"),y=w("input"),M=W(`
  Crossing`),P=A(),L=w("label"),O=w("input"),I=W(`
  Other`),B=A(),N=w("br"),G=A(),E=w("br"),T=A(),ie=w("label"),de=W("Description:"),we=w("br"),se=A(),ye=w("textarea"),Ee=A(),me=w("br"),Z=A(),nt=w("br"),De=A(),he&&he.c(),Ge=A(),ae=w("div"),ce=w("button"),ce.textContent="Delete",rt=A(),je=w("button"),je.textContent="Save",C(o,"type","text"),ke(o,"width","100%"),C(p,"type","radio"),p.__value="area",p.value=p.__value,r[7][0].push(p),C(_,"type","radio"),_.__value="route",_.value=_.__value,r[7][0].push(_),C(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[7][0].push(y),C(O,"type","radio"),O.__value="other",O.value=O.__value,r[7][0].push(O),ke(ye,"width","100%"),C(ye,"rows","5"),C(ye,"class","svelte-15lna0i"),C(ce,"type","button"),C(je,"type","button"),ke(ae,"display","flex"),ke(ae,"justify-content","space-between")},m(R,j){S(R,e,j),b(e,t),b(e,n),b(e,i),b(e,o),ft(o,r[0]),S(R,s,j),S(R,u,j),S(R,l,j),S(R,a,j),S(R,h,j),S(R,g,j),b(g,p),p.checked=p.__value===r[1],b(g,f),S(R,m,j),S(R,v,j),b(v,_),_.checked=_.__value===r[1],b(v,k),S(R,c,j),S(R,d,j),b(d,y),y.checked=y.__value===r[1],b(d,M),S(R,P,j),S(R,L,j),b(L,O),O.checked=O.__value===r[1],b(L,I),S(R,B,j),S(R,N,j),S(R,G,j),S(R,E,j),S(R,T,j),S(R,ie,j),b(ie,de),b(ie,we),b(ie,se),b(ie,ye),ft(ye,r[2]),S(R,Ee,j),S(R,me,j),S(R,Z,j),S(R,nt,j),S(R,De,j),he&&he.m(R,j),S(R,Ge,j),S(R,ae,j),b(ae,ce),b(ae,rt),b(ae,je),_t||(re=[U(o,"input",r[5]),U(p,"change",r[6]),U(_,"change",r[8]),U(y,"change",r[9]),U(O,"change",r[10]),U(ye,"input",r[11]),U(ce,"click",r[12]),U(je,"click",r[13])],_t=!0)},p(R,[j]){j&1&&o.value!==R[0]&&ft(o,R[0]),j&2&&(p.checked=p.__value===R[1]),j&2&&(_.checked=_.__value===R[1]),j&2&&(y.checked=y.__value===R[1]),j&2&&(O.checked=O.__value===R[1]),j&4&&ft(ye,R[2]),R[4]?he?he.p(R,j):(he=ur(R),he.c(),he.m(Ge.parentNode,Ge)):he&&(he.d(1),he=null)},i:q,o:q,d(R){R&&x(e),R&&x(s),R&&x(u),R&&x(l),R&&x(a),R&&x(h),R&&x(g),r[7][0].splice(r[7][0].indexOf(p),1),R&&x(m),R&&x(v),r[7][0].splice(r[7][0].indexOf(_),1),R&&x(c),R&&x(d),r[7][0].splice(r[7][0].indexOf(y),1),R&&x(P),R&&x(L),r[7][0].splice(r[7][0].indexOf(O),1),R&&x(B),R&&x(N),R&&x(G),R&&x(E),R&&x(T),R&&x(ie),R&&x(Ee),R&&x(me),R&&x(Z),R&&x(nt),R&&x(De),he&&he.d(R),R&&x(Ge),R&&x(ae),_t=!1,tt(re)}}}function ar(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function oo(r,e,t){let{id:n}=e,{name:i}=e,{intervention_type:o}=e,{description:s}=e,{length_meters:u}=e;const l=[[]];function a(){i=this.value,t(0,i)}function h(){o=this.__value,t(1,o)}function g(){o=this.__value,t(1,o)}function p(){o=this.__value,t(1,o)}function f(){o=this.__value,t(1,o)}function m(){s=this.value,t(2,s)}const v=()=>Cr(n),_=()=>be.set(null);return r.$$set=k=>{"id"in k&&t(3,n=k.id),"name"in k&&t(0,i=k.name),"intervention_type"in k&&t(1,o=k.intervention_type),"description"in k&&t(2,s=k.description),"length_meters"in k&&t(4,u=k.length_meters)},[i,o,s,n,u,a,h,l,g,p,f,m,v,_]}class so extends Q{constructor(e){super(),ee(this,e,oo,io,V,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}function lo(r){const e=r-1;return e*e*e+1}function fr(r,{delay:e=0,duration:t=400,easing:n=lo}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),u=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),a=parseFloat(i.marginTop),h=parseFloat(i.marginBottom),g=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*u}px;padding-bottom: ${f*l}px;margin-top: ${f*a}px;margin-bottom: ${f*h}px;border-top-width: ${f*g}px;border-bottom-width: ${f*p}px;`}}function cr(r){let e,t,n,i,o;const s=r[10].default,u=wt(s,r,r[9],null);return{c(){e=w("div"),u&&u.c(),ke(e,"border","solid 1px black"),ke(e,"padding","10px")},m(l,a){S(l,e,a),u&&u.m(e,null),r[13](e),n=!0,i||(o=U(e,"introend",r[14]),i=!0)},p(l,a){u&&u.p&&(!n||a&512)&&kt(u,s,l,l[9],n?xt(s,l[9],a,null):St(l[9]),null)},i(l){n||(F(u,l),Pr(()=>{t||(t=Un(e,fr,{duration:100},!0)),t.run(1)}),n=!0)},o(l){$(u,l),t||(t=Un(e,fr,{duration:100},!1)),t.run(0),n=!1},d(l){l&&x(e),u&&u.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function uo(r){let e,t,n,i,o,s,u,l,a,h,g=r[4]&&cr(r);return{c(){e=w("button"),t=qn("svg"),n=qn("path"),i=A(),o=W(r[1]),s=A(),g&&g.c(),u=Se(),C(n,"d","M9 5l7 7-7 7"),C(t,"style","tran"),C(t,"width","20"),C(t,"height","20"),C(t,"fill","none"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"stroke-width","2"),C(t,"viewBox","0 0 24 24"),C(t,"stroke","currentColor"),C(t,"class","svelte-t7fpgu"),C(e,"aria-expanded",r[4]),C(e,"class","svelte-t7fpgu"),Xn(e,"underlined",r[3])},m(p,f){S(p,e,f),b(e,t),b(t,n),b(e,i),b(e,o),S(p,s,f),g&&g.m(p,f),S(p,u,f),l=!0,a||(h=[U(e,"click",r[5]),U(e,"mouseenter",r[11]),U(e,"mouseleave",r[12])],a=!0)},p(p,[f]){(!l||f&2)&&Rn(o,p[1]),(!l||f&16)&&C(e,"aria-expanded",p[4]),(!l||f&8)&&Xn(e,"underlined",p[3]),p[4]?g?(g.p(p,f),f&16&&F(g,1)):(g=cr(p),g.c(),F(g,1),g.m(u.parentNode,u)):g&&(Be(),$(g,1,1,()=>{g=null}),$e())},i(p){l||(F(g),l=!0)},o(p){$(g),l=!1},d(p){p&&x(e),p&&x(s),g&&g.d(p),p&&x(u),a=!1,tt(h)}}}function ao(r,e,t){let n,i,o,s;te(r,Te,c=>t(7,o=c)),te(r,be,c=>t(8,s=c));let{$$slots:u={},$$scope:l}=e,{id:a}=e,{label:h}=e;const g=()=>{be.update(c=>c==a?null:a),s==a&&(an.set(null),an.set(a))};let p;function f(){p==null||p.scrollIntoView({behavior:"smooth"})}const m=()=>Ut.set(a),v=()=>Ut.set(null);function _(c){pe[c?"unshift":"push"](()=>{p=c,t(2,p)})}const k=()=>f();return r.$$set=c=>{"id"in c&&t(0,a=c.id),"label"in c&&t(1,h=c.label),"$$scope"in c&&t(9,l=c.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==a),r.$$.dirty&129&&t(3,i=o==a)},[a,h,p,i,n,g,f,o,s,l,u,m,v,_,k]}class fo extends Q{constructor(e){super(),ee(this,e,ao,uo,V,{id:0,label:1})}}function hr(r,e,t){const n=r.slice();return n[6]=e[t],n[7]=e,n[8]=t,n}function co(r){let e,t,n,i,o,s;function u(g){r[2](g,r[6])}function l(g){r[3](g,r[6])}function a(g){r[4](g,r[6])}let h={id:r[6].id,length_meters:r[6].properties.length_meters};return r[6].properties.name!==void 0&&(h.name=r[6].properties.name),r[6].properties.intervention_type!==void 0&&(h.intervention_type=r[6].properties.intervention_type),r[6].properties.description!==void 0&&(h.description=r[6].properties.description),e=new so({props:h}),pe.push(()=>Ke(e,"name",u,r[6].properties.name)),pe.push(()=>Ke(e,"intervention_type",l,r[6].properties.intervention_type)),pe.push(()=>Ke(e,"description",a,r[6].properties.description)),{c(){H(e.$$.fragment),o=A()},m(g,p){J(e,g,p),S(g,o,p),s=!0},p(g,p){r=g;const f={};p&1&&(f.id=r[6].id),p&1&&(f.length_meters=r[6].properties.length_meters),!t&&p&1&&(t=!0,f.name=r[6].properties.name,Qe(()=>t=!1)),!n&&p&1&&(n=!0,f.intervention_type=r[6].properties.intervention_type,Qe(()=>n=!1)),!i&&p&1&&(i=!0,f.description=r[6].properties.description,Qe(()=>i=!1)),e.$set(f)},i(g){s||(F(e.$$.fragment,g),s=!0)},o(g){$(e.$$.fragment,g),s=!1},d(g){z(e,g),g&&x(o)}}}function pr(r,e){let t,n,i;return n=new fo({props:{id:e[6].id,label:e[8]+1+") "+dr(e[6]),$$slots:{default:[co]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=Se(),H(n.$$.fragment),this.first=t},m(o,s){S(o,t,s),J(n,o,s),i=!0},p(o,s){e=o;const u={};s&1&&(u.id=e[6].id),s&1&&(u.label=e[8]+1+") "+dr(e[6])),s&513&&(u.$$scope={dirty:s,ctx:e}),n.$set(u)},i(o){i||(F(n.$$.fragment,o),i=!0)},o(o){$(n.$$.fragment,o),i=!1},d(o){o&&x(t),z(n,o)}}}function ho(r){let e=[],t=new Map,n,i,o,s,u=r[0].features;const l=a=>a[6].id;for(let a=0;a<u.length;a+=1){let h=hr(r,u,a),g=l(h);t.set(g,e[a]=pr(g,h))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=Se()},m(a,h){for(let g=0;g<e.length;g+=1)e[g].m(a,h);S(a,n,h),i=!0,o||(s=U(window,"keydown",r[1]),o=!0)},p(a,[h]){h&1&&(u=a[0].features,Be(),e=ni(e,h,l,1,a,u,t,n.parentNode,ri,pr,n,hr),$e())},i(a){if(!i){for(let h=0;h<u.length;h+=1)F(e[h]);i=!0}},o(a){for(let h=0;h<e.length;h+=1)$(e[h]);i=!1},d(a){for(let h=0;h<e.length;h+=1)e[h].d(a);a&&x(n),o=!1,s()}}}function dr(r){if(r.properties.name)return r.properties.name;var e=r.properties.intervention_type;return e=="other"&&(r.geometry.type=="Point"?e="point":r.geometry.type=="LineString"?e="line":e="polygon"),`Untitled ${e}`}function po(r,e,t){let n,i;te(r,be,a=>t(5,n=a)),te(r,ne,a=>t(0,i=a));function o(a){if(a.key=="Delete"){const h=a.target.tagName;if(h=="INPUT"||h=="TEXTAREA")return;a.preventDefault();const g=n;g&&Cr(g)}}function s(a,h){r.$$.not_equal(h.properties.name,a)&&(h.properties.name=a,ne.set(i))}function u(a,h){r.$$.not_equal(h.properties.intervention_type,a)&&(h.properties.intervention_type=a,ne.set(i))}function l(a,h){r.$$.not_equal(h.properties.description,a)&&(h.properties.description=a,ne.set(i))}return[i,o,s,u,l]}class mo extends Q{constructor(e){super(),ee(this,e,po,ho,V,{})}}function We(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Re(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function gn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ue(r,e,t){t===void 0&&(t={});var n=We(r),i=We(e),o=Me(i[1]-n[1]),s=Me(i[0]-n[0]),u=Me(n[1]),l=Me(i[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return ii(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),t.units)}function Dt(r,e){return e===void 0&&(e={}),oi(r,function(t,n){var i=n.geometry.coordinates;return t+Ue(i[0],i[1],e)},0)}function go(r){let e,t,n,i,o,s,u,l,a,h,g,p,f,m,v,_,k,c,d,y=r[0].features.length+"",M,P,L,O,I,B,N,G;return{c(){e=w("div"),t=w("label"),n=W(`Scheme name:
    `),i=w("input"),o=A(),s=w("br"),u=A(),l=w("div"),a=w("label"),h=w("input"),g=A(),p=w("button"),p.textContent="Load from GeoJSON",f=A(),m=w("button"),m.textContent="Export to GeoJSON",v=A(),_=w("br"),k=A(),c=w("div"),d=w("span"),M=W(y),P=W(" interventions"),L=A(),O=w("button"),I=W("Clear all"),C(i,"type","text"),C(h,"type","file"),C(h,"id","load_geojson"),C(h,"class","svelte-lhyd1e"),C(p,"type","button"),C(m,"type","button"),C(m,"class","align-right svelte-lhyd1e"),C(O,"type","button"),C(O,"class","align-right svelte-lhyd1e"),O.disabled=B=r[0].features.length==0},m(E,T){S(E,e,T),b(e,t),b(t,n),b(t,i),ft(i,r[0].scheme_name),S(E,o,T),S(E,s,T),S(E,u,T),S(E,l,T),b(l,a),b(a,h),b(a,g),b(a,p),b(l,f),b(l,m),S(E,v,T),S(E,_,T),S(E,k,T),S(E,c,T),b(c,d),b(d,M),b(d,P),b(c,L),b(c,O),b(O,I),N||(G=[U(i,"input",r[5]),U(h,"change",r[3]),U(p,"click",yo),U(m,"click",r[2]),U(O,"click",r[1])],N=!0)},p(E,[T]){T&1&&i.value!==E[0].scheme_name&&ft(i,E[0].scheme_name),T&1&&y!==(y=E[0].features.length+"")&&Rn(M,y),T&1&&B!==(B=E[0].features.length==0)&&(O.disabled=B)},i:q,o:q,d(E){E&&x(e),E&&x(o),E&&x(s),E&&x(u),E&&x(l),E&&x(v),E&&x(_),E&&x(k),E&&x(c),N=!1,tt(G)}}}function vo(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function yo(){document.getElementById("load_geojson").click()}function _o(r,e,t){let n;te(r,ne,p=>t(0,n=p));let{authorityName:i}=e,o=window.localStorage.getItem(i);if(o)try{ne.set(h(JSON.parse(o)))}catch(p){console.log(`Failed to load from local storage: ${p}`)}function s(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&ne.update(p=>(delete p.scheme_name,p.features=[],p))}function u(){const p=JSON.parse(JSON.stringify(n));for(let f of p.features)delete f.properties.hide_while_editing;return p}function l(){let p=u();var f=i;p.authority=i,p.origin="atip-v1",p.scheme_name&&(f+="_"+p.scheme_name),f+=".txt",vo(f,JSON.stringify(p,null,"  "))}function a(p){const f=new FileReader;f.onload=v=>{try{ne.set(h(JSON.parse(v.target.result)))}catch(_){window.alert(`Couldn't load scheme from a file: ${_}`)}};let m=p.target.files;f.readAsText(m[0])}function h(p){let f=1;for(let m of p.features)m.properties||(m.properties={name:"",description:"",intervention_type:"other"}),m.geometry.type=="LineString"&&!m.properties.length_meters&&(m.properties.length_meters=Dt(m,{units:"kilometers"})*1e3),m.id=f++;return p}function g(){n.scheme_name=this.value,ne.set(n)}return r.$$set=p=>{"authorityName"in p&&t(4,i=p.authorityName)},r.$$.update=()=>{r.$$.dirty&17&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(i,JSON.stringify(u())))},[n,s,l,a,i,g]}class bo extends Q{constructor(e){super(),ee(this,e,_o,go,V,{authorityName:4})}}const wo="/atip/hmr_callbacks/assets/zoom_out_map-b2e1091a.svg";function ko(r){let e,t,n,i,o;return{c(){e=w("button"),t=w("img"),si(t.src,n=wo)||C(t,"src",n),C(t,"alt","Zoom to show entire boundary"),C(e,"type","button"),C(e,"title","Zoom to show entire boundary"),C(e,"class","svelte-qzjsqo")},m(s,u){S(s,e,u),b(e,t),i||(o=U(e,"click",r[0]),i=!0)},p:q,i:q,o:q,d(s){s&&x(e),i=!1,o()}}}function So(r,e,t){let n;te(r,Ie,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(Pn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class xo extends Q{constructor(e){super(),ee(this,e,So,ko,V,{boundaryGeojson:1})}}function Eo(r){let e,t,n,i,o,s,u;return{c(){e=w("div"),t=W(`Basemap:
  `),n=w("select"),i=w("option"),i.textContent="Streets",o=w("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&Pr(()=>r[2].call(n)),C(e,"class","svelte-1tbnm6i")},m(l,a){S(l,e,a),b(e,t),b(e,n),b(n,i),b(n,o),Hn(n,r[0]),s||(u=[U(n,"change",r[2]),U(n,"change",r[1])],s=!0)},p(l,[a]){a&1&&Hn(n,l[0])},i:q,o:q,d(l){l&&x(e),s=!1,tt(u)}}}function Mo(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let u=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=u}function o(){n=li(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Lo extends Q{constructor(e){super(),ee(this,e,Mo,Eo,V,{style:0})}}const _e={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",hovering:"black",lineEndpointColor:"black"},en=10,zt=10;function Oo(r){let e,t,n,i,o,s,u,l,a,h,g,p,f,m,v,_,k,c,d;return{c(){e=w("div"),t=w("h1"),t.textContent="Interventions",n=A(),i=w("ul"),o=w("li"),s=w("span"),u=W("Areas"),l=A(),a=w("li"),h=w("span"),g=W("Routes"),p=A(),f=w("li"),m=w("span"),v=W("Crossings"),_=A(),k=w("li"),c=w("span"),d=W("Other"),C(t,"class","svelte-p551i1"),C(s,"class","svelte-p551i1"),ke(s,"background",_e.area),C(h,"class","svelte-p551i1"),ke(h,"background",_e.route),C(m,"class","svelte-p551i1"),ke(m,"background",_e.crossing),C(c,"class","svelte-p551i1"),ke(c,"background",_e.other),C(e,"class","svelte-p551i1")},m(y,M){S(y,e,M),b(e,t),b(e,n),b(e,i),b(i,o),b(o,s),b(o,u),b(i,l),b(i,a),b(a,h),b(a,g),b(i,p),b(i,f),b(f,m),b(f,v),b(i,_),b(i,k),b(k,c),b(k,d)},p:q,i:q,o:q,d(y){y&&x(e)}}}class Po extends Q{constructor(e){super(),ee(this,e,null,Oo,V,{})}}let st="interventions";function Co(r,e,t){let n,i;te(r,Ie,l=>t(0,n=l)),te(r,ne,l=>t(1,i=l)),et(n,st,{type:"geojson",data:i});const o=["match",["get","intervention_type"],"area",_e.area,"route",_e.route,"crossing",_e.crossing,"other",_e.other,"white"],s=["!=","hide_while_editing",!0];return ge(n,{id:"interventions-points",source:st,filter:["all",Zt,s,["!=","endpoint",!0]],...vt(o,en)}),ge(n,{id:"interventions-lines",source:st,filter:["all",Kt,s],...Ot(o,zt)},"route-lines"),ge(n,{id:"interventions-lines-endpoints",source:st,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*zt,"circle-opacity":0,"circle-stroke-color":_e.lineEndpointColor,"circle-stroke-width":2}}),ge(n,{id:"interventions-polygons",source:st,filter:["all",An,s],...Cn(o,.5)},"hover-polygons"),r.$$.update=()=>{if(r.$$.dirty&3){let l=JSON.parse(JSON.stringify(i)),a=[];for(let h of l.features)if(h.geometry.type=="LineString")for(let g of[h.geometry.coordinates[0],h.geometry.coordinates[h.geometry.coordinates.length-1]])a.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:g}});l.features=l.features.concat(a),n.getSource(st).setData(l)}},[n,i]}class Ro extends Q{constructor(e){super(),ee(this,e,Co,null,V,{})}}let lt="hover";function Ao(r,e,t){let n,i,o,s,u;return te(r,Ie,l=>t(0,n=l)),te(r,ne,l=>t(1,i=l)),te(r,Ut,l=>t(2,o=l)),te(r,Te,l=>t(3,s=l)),te(r,be,l=>t(4,u=l)),et(n,lt,{type:"geojson",data:Ae()}),ge(n,{id:"hover-polygons",source:lt,filter:An,...Ot(_e.hovering,.5*zt,1)}),ge(n,{id:"hover-lines",source:lt,filter:Kt,...Ot(_e.hovering,1.5*zt,1)},"interventions-lines"),ge(n,{id:"hover-points",source:lt,filter:Zt,...vt(_e.hovering,1.5*en,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=u||s||o;l!=null?n.getSource(lt).setData(i.features.find(a=>a.id==l)):n.getSource(lt).setData(Ae())}},[n,i,o,s,u]}class Io extends Q{constructor(e){super(),ee(this,e,Ao,null,V,{})}}class Tn{constructor(e,t){K(this,"owner");K(this,"map");K(this,"mapHandlers",{});K(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Ft="edit-point-mode";var Rt,vn;class No{constructor(e){it(this,Rt);K(this,"map");K(this,"active");K(this,"eventListeners");K(this,"cursor");K(this,"events");this.map=e,this.active=!1,this.eventListeners=[],this.cursor=null,this.events=new Tn(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),et(e,Ft,{type:"geojson",data:Ae()}),ge(e,{id:"edit-point-mode",source:Ft,...vt(_e.hovering,en,1)})}onMouseMove(e){this.active&&(this.cursor=Fo(e.lngLat.toArray()),oe(this,Rt,vn).call(this))}onClick(){if(this.active&&this.cursor){for(let e of this.eventListeners)e(this.cursor);this.stop()}}addEventListener(e){this.eventListeners.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Ft),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,oe(this,Rt,vn).call(this)}}Rt=new WeakSet,vn=function(){let e=Ae();this.cursor&&e.features.push(this.cursor),this.map.getSource(Ft).setData(e)};function Fo(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Ir(r,e,t){if(t===void 0&&(t={}),t.final===!0)return To(r,e);var n=We(r),i=We(e),o=Me(n[0]),s=Me(i[0]),u=Me(n[1]),l=Me(i[1]),a=Math.sin(s-o)*Math.cos(l),h=Math.cos(u)*Math.sin(l)-Math.sin(u)*Math.cos(l)*Math.cos(s-o);return un(Math.atan2(a,h))}function To(r,e){var t=Ir(e,r);return t=(t+180)%360,t}function mr(r,e,t,n){n===void 0&&(n={});var i=We(r),o=Me(i[0]),s=Me(i[1]),u=Me(t),l=ui(e,n.units),a=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(u)),h=o+Math.atan2(Math.sin(u)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(a)),g=un(h),p=un(a);return pt([g,p],n.properties)}function yn(r){if(!r)throw new Error("geojson is required");var e=[];return In(r,function(t){Bo(t,e)}),ze(e)}function Bo(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Re(n);break;case"LineString":t=[Re(n)]}t.forEach(function(i){var o=$o(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function $o(r,e){var t=[];return r.reduce(function(n,i){var o=dt([n,i],e);return o.bbox=Do(n,i),t.push(o),i}),t}function Do(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,u=n<o?n:o,l=t>i?t:i,a=n>o?n:o;return[s,u,l,a]}var mt={},Go={get exports(){return mt},set exports(r){mt=r}},_n={},jo={get exports(){return _n},set exports(r){_n=r}};(function(r,e){(function(t,n){r.exports=n()})(ai,function(){function t(c,d,y,M,P){(function L(O,I,B,N,G){for(;N>B;){if(N-B>600){var E=N-B+1,T=I-B+1,ie=Math.log(E),de=.5*Math.exp(2*ie/3),we=.5*Math.sqrt(ie*de*(E-de)/E)*(T-E/2<0?-1:1),se=Math.max(B,Math.floor(I-T*de/E+we)),ye=Math.min(N,Math.floor(I+(E-T)*de/E+we));L(O,I,se,ye,G)}var Ee=O[I],me=B,Z=N;for(n(O,B,I),G(O[N],Ee)>0&&n(O,B,N);me<Z;){for(n(O,me,Z),me++,Z--;G(O[me],Ee)<0;)me++;for(;G(O[Z],Ee)>0;)Z--}G(O[B],Ee)===0?n(O,B,Z):n(O,++Z,N),Z<=I&&(B=Z+1),I<=Z&&(N=Z-1)}})(c,d,y||0,M||c.length-1,P||i)}function n(c,d,y){var M=c[d];c[d]=c[y],c[y]=M}function i(c,d){return c<d?-1:c>d?1:0}var o=function(c){c===void 0&&(c=9),this._maxEntries=Math.max(4,c),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(c,d,y){if(!y)return d.indexOf(c);for(var M=0;M<d.length;M++)if(y(c,d[M]))return M;return-1}function u(c,d){l(c,0,c.children.length,d,c)}function l(c,d,y,M,P){P||(P=_(null)),P.minX=1/0,P.minY=1/0,P.maxX=-1/0,P.maxY=-1/0;for(var L=d;L<y;L++){var O=c.children[L];a(P,c.leaf?M(O):O)}return P}function a(c,d){return c.minX=Math.min(c.minX,d.minX),c.minY=Math.min(c.minY,d.minY),c.maxX=Math.max(c.maxX,d.maxX),c.maxY=Math.max(c.maxY,d.maxY),c}function h(c,d){return c.minX-d.minX}function g(c,d){return c.minY-d.minY}function p(c){return(c.maxX-c.minX)*(c.maxY-c.minY)}function f(c){return c.maxX-c.minX+(c.maxY-c.minY)}function m(c,d){return c.minX<=d.minX&&c.minY<=d.minY&&d.maxX<=c.maxX&&d.maxY<=c.maxY}function v(c,d){return d.minX<=c.maxX&&d.minY<=c.maxY&&d.maxX>=c.minX&&d.maxY>=c.minY}function _(c){return{children:c,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function k(c,d,y,M,P){for(var L=[d,y];L.length;)if(!((y=L.pop())-(d=L.pop())<=M)){var O=d+Math.ceil((y-d)/M/2)*M;t(c,O,d,y,P),L.push(d,O,O,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(c){var d=this.data,y=[];if(!v(c,d))return y;for(var M=this.toBBox,P=[];d;){for(var L=0;L<d.children.length;L++){var O=d.children[L],I=d.leaf?M(O):O;v(c,I)&&(d.leaf?y.push(O):m(c,I)?this._all(O,y):P.push(O))}d=P.pop()}return y},o.prototype.collides=function(c){var d=this.data;if(!v(c,d))return!1;for(var y=[];d;){for(var M=0;M<d.children.length;M++){var P=d.children[M],L=d.leaf?this.toBBox(P):P;if(v(c,L)){if(d.leaf||m(c,L))return!0;y.push(P)}}d=y.pop()}return!1},o.prototype.load=function(c){if(!c||!c.length)return this;if(c.length<this._minEntries){for(var d=0;d<c.length;d++)this.insert(c[d]);return this}var y=this._build(c.slice(),0,c.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(c){return c&&this._insert(c,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(c,d){if(!c)return this;for(var y,M,P,L=this.data,O=this.toBBox(c),I=[],B=[];L||I.length;){if(L||(L=I.pop(),M=I[I.length-1],y=B.pop(),P=!0),L.leaf){var N=s(c,L.children,d);if(N!==-1)return L.children.splice(N,1),I.push(L),this._condense(I),this}P||L.leaf||!m(L,O)?M?(y++,L=M.children[y],P=!1):L=null:(I.push(L),B.push(y),y=0,M=L,L=L.children[0])}return this},o.prototype.toBBox=function(c){return c},o.prototype.compareMinX=function(c,d){return c.minX-d.minX},o.prototype.compareMinY=function(c,d){return c.minY-d.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(c){return this.data=c,this},o.prototype._all=function(c,d){for(var y=[];c;)c.leaf?d.push.apply(d,c.children):y.push.apply(y,c.children),c=y.pop();return d},o.prototype._build=function(c,d,y,M){var P,L=y-d+1,O=this._maxEntries;if(L<=O)return u(P=_(c.slice(d,y+1)),this.toBBox),P;M||(M=Math.ceil(Math.log(L)/Math.log(O)),O=Math.ceil(L/Math.pow(O,M-1))),(P=_([])).leaf=!1,P.height=M;var I=Math.ceil(L/O),B=I*Math.ceil(Math.sqrt(O));k(c,d,y,B,this.compareMinX);for(var N=d;N<=y;N+=B){var G=Math.min(N+B-1,y);k(c,N,G,I,this.compareMinY);for(var E=N;E<=G;E+=I){var T=Math.min(E+I-1,G);P.children.push(this._build(c,E,T,M-1))}}return u(P,this.toBBox),P},o.prototype._chooseSubtree=function(c,d,y,M){for(;M.push(d),!d.leaf&&M.length-1!==y;){for(var P=1/0,L=1/0,O=void 0,I=0;I<d.children.length;I++){var B=d.children[I],N=p(B),G=(E=c,T=B,(Math.max(T.maxX,E.maxX)-Math.min(T.minX,E.minX))*(Math.max(T.maxY,E.maxY)-Math.min(T.minY,E.minY))-N);G<L?(L=G,P=N<P?N:P,O=B):G===L&&N<P&&(P=N,O=B)}d=O||d.children[0]}var E,T;return d},o.prototype._insert=function(c,d,y){var M=y?c:this.toBBox(c),P=[],L=this._chooseSubtree(M,this.data,d,P);for(L.children.push(c),a(L,M);d>=0&&P[d].children.length>this._maxEntries;)this._split(P,d),d--;this._adjustParentBBoxes(M,P,d)},o.prototype._split=function(c,d){var y=c[d],M=y.children.length,P=this._minEntries;this._chooseSplitAxis(y,P,M);var L=this._chooseSplitIndex(y,P,M),O=_(y.children.splice(L,y.children.length-L));O.height=y.height,O.leaf=y.leaf,u(y,this.toBBox),u(O,this.toBBox),d?c[d-1].children.push(O):this._splitRoot(y,O)},o.prototype._splitRoot=function(c,d){this.data=_([c,d]),this.data.height=c.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(c,d,y){for(var M,P,L,O,I,B,N,G=1/0,E=1/0,T=d;T<=y-d;T++){var ie=l(c,0,T,this.toBBox),de=l(c,T,y,this.toBBox),we=(P=ie,L=de,O=void 0,I=void 0,B=void 0,N=void 0,O=Math.max(P.minX,L.minX),I=Math.max(P.minY,L.minY),B=Math.min(P.maxX,L.maxX),N=Math.min(P.maxY,L.maxY),Math.max(0,B-O)*Math.max(0,N-I)),se=p(ie)+p(de);we<G?(G=we,M=T,E=se<E?se:E):we===G&&se<E&&(E=se,M=T)}return M||y-d},o.prototype._chooseSplitAxis=function(c,d,y){var M=c.leaf?this.compareMinX:h,P=c.leaf?this.compareMinY:g;this._allDistMargin(c,d,y,M)<this._allDistMargin(c,d,y,P)&&c.children.sort(M)},o.prototype._allDistMargin=function(c,d,y,M){c.children.sort(M);for(var P=this.toBBox,L=l(c,0,d,P),O=l(c,y-d,y,P),I=f(L)+f(O),B=d;B<y-d;B++){var N=c.children[B];a(L,c.leaf?P(N):N),I+=f(L)}for(var G=y-d-1;G>=d;G--){var E=c.children[G];a(O,c.leaf?P(E):E),I+=f(O)}return I},o.prototype._adjustParentBBoxes=function(c,d,y){for(var M=y;M>=0;M--)a(d[M],c)},o.prototype._condense=function(c){for(var d=c.length-1,y=void 0;d>=0;d--)c[d].children.length===0?d>0?(y=c[d-1].children).splice(y.indexOf(c[d]),1):this.clear():u(c[d],this.toBBox)},o})})(jo);const Yo=Nn(fi),qo=Nn(ci),Xo=Nn(hi);var Oe=_n,Nr=Yo,Fr=qo,ut=Xo.default,Uo=Fr.featureEach;Fr.coordEach;Nr.polygon;var gr=Nr.featureCollection;function Tr(r){var e=new Oe(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ut(t),Oe.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ut(i),n.push(i)}):Uo(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ut(i),n.push(i)}),Oe.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ut(t),Oe.prototype.remove.call(this,t,n)},e.clear=function(){return Oe.prototype.clear.call(this)},e.search=function(t){var n=Oe.prototype.search.call(this,this.toBBox(t));return gr(n)},e.collides=function(t){return Oe.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Oe.prototype.all.call(this);return gr(t)},e.toJSON=function(){return Oe.prototype.toJSON.call(this)},e.fromJSON=function(t){return Oe.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ut(t);else if(t.type==="FeatureCollection")n=ut(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Go.exports=Tr;mt.default=Tr;function Br(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Jn(r)),e.type==="LineString"&&(e=Jn(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=vr(r,e);return i&&n.push(i),ze(n)}var o=mt();return o.load(yn(e)),Xt(yn(r),function(s){Xt(o.search(s),function(u){var l=vr(s,u);if(l){var a=Re(l).join(",");t[a]||(t[a]=!0,n.push(l))}})}),ze(n)}function vr(r,e){var t=Re(r),n=Re(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],u=t[1][1],l=n[0][0],a=n[0][1],h=n[1][0],g=n[1][1],p=(g-a)*(s-i)-(h-l)*(u-o),f=(h-l)*(o-a)-(g-a)*(i-l),m=(s-i)*(o-a)-(u-o)*(i-l);if(p===0)return f===0&&m===0,null;var v=f/p,_=m/p;if(v>=0&&v<=1&&_>=0&&_<=1){var k=i+v*(s-i),c=o+v*(u-o);return pt([k,c])}return null}function Ct(r,e,t){t===void 0&&(t={});var n=pt([1/0,1/0],{dist:1/0}),i=0;return In(r,function(o){for(var s=Re(o),u=0;u<s.length-1;u++){var l=pt(s[u]);l.properties.dist=Ue(e,l,t);var a=pt(s[u+1]);a.properties.dist=Ue(e,a,t);var h=Ue(l,a,t),g=Math.max(l.properties.dist,a.properties.dist),p=Ir(l,a),f=mr(e,g,p+90,t),m=mr(e,g,p-90,t),v=Br(dt([f.geometry.coordinates,m.geometry.coordinates]),dt([l.geometry.coordinates,a.geometry.coordinates])),_=null;v.features.length>0&&(_=v.features[0],_.properties.dist=Ue(e,_,t),_.properties.location=i+Ue(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=u,n.properties.location=i),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=u+1,n.properties.location=i+h),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=u),i+=h}}),n}const at="edit-polygon-mode";var Ne,Ze,At,bn,It,wn;class Ho{constructor(e){it(this,Ne);it(this,At);it(this,It);K(this,"map");K(this,"active");K(this,"eventListeners");K(this,"points");K(this,"cursor");K(this,"hover");K(this,"dragFrom");K(this,"events");this.map=e,this.active=!1,this.eventListeners=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new Tn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),et(e,at,{type:"geojson",data:Ae()}),ge(e,{id:"edit-polygon-fill",source:at,filter:An,...Cn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),ge(e,{id:"edit-polygon-lines",source:at,filter:Kt,...Ot("black",8,.5)}),ge(e,{id:"edit-polygon-vertices",source:at,filter:Zt,...vt(_e.hovering,en,["case",["boolean",["get","hover"],"false"],1,.5])})}onMouseMove(e){if(this.active&&!this.dragFrom)oe(this,At,bn).call(this,e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),oe(this,Ne,Ze).call(this)}}onClick(e){if(this.active&&this.cursor){let t=[];if(_r(this.points).forEach((n,i)=>{t.push([i+1,Ct(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;oe(this,Ne,Ze).call(this)}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,oe(this,Ne,Ze).call(this),oe(this,At,bn).call(this,e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){if(this.active&&e.key=="Enter"){e.preventDefault();let t=oe(this,It,wn).call(this);if(t)for(let n of this.eventListeners)n(t);this.stop()}}addEventListener(e){this.eventListeners.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(at),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=e.geometry.coordinates[0],this.points.pop(),oe(this,Ne,Ze).call(this)}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,oe(this,Ne,Ze).call(this)}}Ne=new WeakSet,Ze=function(){let e=Ae();this.points.forEach((n,i)=>{let o=yr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(_r(this.points));let t=oe(this,It,wn).call(this);t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(at).setData(e)},At=new WeakSet,bn=function(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=yr(e.lngLat.toArray())),oe(this,Ne,Ze).call(this)},It=new WeakSet,wn=function(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}};function yr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function _r(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let D;const $r=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});$r.decode();let Gt=new Uint8Array;function Mt(){return Gt.byteLength===0&&(Gt=new Uint8Array(D.memory.buffer)),Gt}function ct(r,e){return $r.decode(Mt().subarray(r,r+e))}const Fe=new Array(32).fill(void 0);Fe.push(void 0,null,!0,!1);let Lt=Fe.length;function le(r){Lt===Fe.length&&Fe.push(Fe.length+1);const e=Lt;return Lt=Fe[e],Fe[e]=r,e}function Y(r){return Fe[r]}function Jo(r){r<36||(Fe[r]=Lt,Lt=r)}function kn(r){const e=Y(r);return Jo(r),e}function rn(r){return r==null}let jt=new Float64Array;function zo(){return jt.byteLength===0&&(jt=new Float64Array(D.memory.buffer)),jt}let Yt=new Int32Array;function ue(){return Yt.byteLength===0&&(Yt=new Int32Array(D.memory.buffer)),Yt}let Je=0;const qt=new TextEncoder("utf-8"),Wo=typeof qt.encodeInto=="function"?function(r,e){return qt.encodeInto(r,e)}:function(r,e){const t=qt.encode(r);return e.set(t),{read:r.length,written:t.length}};function Tt(r,e,t){if(t===void 0){const u=qt.encode(r),l=e(u.length);return Mt().subarray(l,l+u.length).set(u),Je=u.length,l}let n=r.length,i=e(n);const o=Mt();let s=0;for(;s<n;s++){const u=r.charCodeAt(s);if(u>127)break;o[i+s]=u}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const u=Mt().subarray(i+s,i+n),l=Wo(r,u);s+=l.written}return Je=s,i}function Sn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Sn(r[0]));for(let s=1;s<i;s++)o+=", "+Sn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Vo(r,e){const t=e(r.length*1);return Mt().set(r,t/1),Je=r.length,t}function on(r,e){try{return r.apply(this,e)}catch(t){D.__wbindgen_exn_store(le(t))}}class Wt{static __wrap(e){const t=Object.create(Wt.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();D.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=D.__wbindgen_add_to_stack_pointer(-16),s=Vo(e,D.__wbindgen_malloc),u=Je;D.jsroutesnapper_new(o,s,u);var t=ue()[o/4+0],n=ue()[o/4+1],i=ue()[o/4+2];if(i)throw kn(n);return Wt.__wrap(t)}finally{D.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){D.jsroutesnapper_setConfig(this.ptr,le(e))}toFinalFeature(){try{const n=D.__wbindgen_add_to_stack_pointer(-16);D.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ue()[n/4+0],t=ue()[n/4+1];let i;return e!==0&&(i=ct(e,t).slice(),D.__wbindgen_free(e,t*1)),i}finally{D.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=D.__wbindgen_add_to_stack_pointer(-16);D.jsroutesnapper_renderGeojson(n,this.ptr);var e=ue()[n/4+0],t=ue()[n/4+1];return ct(e,t)}finally{D.__wbindgen_add_to_stack_pointer(16),D.__wbindgen_free(e,t)}}setSnapMode(e){D.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return D.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){D.jsroutesnapper_onClick(this.ptr)}onDragStart(){return D.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return D.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){D.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=D.__wbindgen_add_to_stack_pointer(-16);D.jsroutesnapper_editExisting(i,this.ptr,le(e));var t=ue()[i/4+0],n=ue()[i/4+1];if(n)throw kn(t)}finally{D.__wbindgen_add_to_stack_pointer(16)}}}async function Zo(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ko(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=ct(e,t);return le(n)},r.wbg.__wbindgen_object_drop_ref=function(e){kn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=Y(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ct(e,t));return le(n)},r.wbg.__wbindgen_is_object=function(e){const t=Y(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Y(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Y(e)in Y(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=Y(t),i=typeof n=="number"?n:void 0;zo()[e/8+1]=rn(i)?0:i,ue()[e/4+0]=!rn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Y(e)==Y(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Y(t),i=typeof n=="string"?n:void 0;var o=rn(i)?0:Tt(i,D.__wbindgen_malloc,D.__wbindgen_realloc),s=Je;ue()[e/4+1]=s,ue()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(Y(t)),i=Tt(n,D.__wbindgen_malloc,D.__wbindgen_realloc),o=Je;ue()[e/4+1]=o,ue()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Y(e);return le(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=Y(e)[Y(t)];return le(n)},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(Y(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=Y(e)[t>>>0];return le(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return Y(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Y(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=Y(e).next;return le(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return on(function(e){const t=Y(e).next();return le(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return Y(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=Y(e).value;return le(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return le(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return on(function(e,t){const n=Reflect.get(Y(e),Y(t));return le(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return on(function(e,t){const n=Y(e).call(Y(t));return le(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(Y(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=Y(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=Y(e).buffer;return le(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(Y(e));return le(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){Y(e).set(Y(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return Y(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=Y(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return le(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Y(t).stack,i=Tt(n,D.__wbindgen_malloc,D.__wbindgen_realloc),o=Je;ue()[e/4+1]=o,ue()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(ct(e,t))}finally{D.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=Sn(Y(t)),i=Tt(n,D.__wbindgen_malloc,D.__wbindgen_realloc),o=Je;ue()[e/4+1]=o,ue()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ct(e,t))},r.wbg.__wbindgen_memory=function(){const e=D.memory;return le(e)},r}function Qo(r,e){return D=r.exports,Dr.__wbindgen_wasm_module=e,jt=new Float64Array,Yt=new Int32Array,Gt=new Uint8Array,D}async function Dr(r){typeof r>"u"&&(r="/atip/hmr_callbacks/assets/route_snapper_bg.wasm");const e=Ko();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Zo(await r,e);return Qo(t,n)}const Bt="route-snapper",br=10,es=30;var Ce,Ye;class ts{constructor(e,t){it(this,Ce);K(this,"map");K(this,"inner");K(this,"active");K(this,"eventListenersSuccess");K(this,"eventListenersFailure");K(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Wt(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],et(e,Bt,{type:"geojson",data:Ae()}),ge(e,{id:"route-points",source:Bt,filter:Zt,...vt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",br/2,br])}),ge(e,{id:"route-lines",source:Bt,filter:Kt,...Ot("black",2.5)}),this.events=new Tn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-es,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&oe(this,Ce,Ye).call(this)}onClick(){this.active&&(this.inner.onClick(),oe(this,Ce,Ye).call(this))}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),oe(this,Ce,Ye).call(this))}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),oe(this,Ce,Ye).call(this))}start(){this.active||(this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),oe(this,Ce,Ye).call(this),this.map.boxZoom.enable()}editExisting(e){this.active&&window.alert("Bug: editExisting called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.start(),this.inner.editExisting(e.properties.waypoints),oe(this,Ce,Ye).call(this)}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setConfig(e){this.inner.setConfig(e),oe(this,Ce,Ye).call(this)}}Ce=new WeakSet,Ye=function(){this.map.getSource(Bt).setData(JSON.parse(this.inner.renderGeojson()))};function wr(r){let e;function t(o,s){return o[1]?rs:ns}let n=t(r),i=n(r);return{c(){i.c(),e=Se()},m(o,s){i.m(o,s),S(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&x(e)}}}function ns(r){let e;return{c(){e=w("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){S(t,e,n)},d(t){t&&x(e)}}}function rs(r){let e;return{c(){e=w("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){S(t,e,n)},d(t){t&&x(e)}}}function is(r){let e,t=r[0]==ht&&wr(r);return{c(){t&&t.c(),e=Se()},m(n,i){t&&t.m(n,i),S(n,e,i)},p(n,[i]){n[0]==ht?t?t.p(n,i):(t=wr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:q,o:q,d(n){t&&t.d(n),n&&x(e)}}}const ht="edit-attribute";function Gr(){}function os(r,e,t){let n,i,o,s;te(r,Ie,f=>t(5,n=f)),te(r,ne,f=>t(6,i=f)),te(r,an,f=>t(7,o=f)),te(r,be,f=>t(1,s=f));let{mode:u}=e,{changeMode:l}=e;function a(){be.set(null)}n.on("mousemove",h),n.on("mouseout",g),n.on("click",p),gt(()=>{n.off("mousemove",h),n.off("mouseout",g),n.off("click",p)});function h(f){var m;if(u==ht){let v=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Te.set(((m=v[0])==null?void 0:m.id)||null)}}function g(){u==ht&&Te.set(null)}function p(f){if(u==ht){let m=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0?be.set(m[0].id):be.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,u=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let m=i.features.find(v=>v.id==f);m.geometry.type=="Point"?n.flyTo({center:m.geometry.coordinates,duration:500}):n.fitBounds(Pn(m),{padding:200,duration:500}),l(ht)}}},[u,s,l,Gr,a,n,i,o]}class ss extends Q{constructor(e){super(),ee(this,e,os,is,V,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Gr}get stop(){return this.$$.ctx[4]}}function ls(r){let e;return{c(){e=w("p"),e.textContent="Click to add a new point"},m(t,n){S(t,e,n)},d(t){t&&x(e)}}}function us(r){let e;return{c(){e=w("p"),e.textContent="Click to move the point here"},m(t,n){S(t,e,n)},d(t){t&&x(e)}}}function as(r){let e;function t(o,s){return o[0]?us:ls}let n=t(r),i=n(r);return{c(){i.c(),e=Se()},m(o,s){i.m(o,s),S(o,e,s)},p(o,[s]){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},i:q,o:q,d(o){i.d(o),o&&x(e)}}}function fs(r,e,t){let{editingExisting:n}=e;return r.$$set=i=>{"editingExisting"in i&&t(0,n=i.editingExisting)},[n]}class jr extends Q{constructor(e){super(),ee(this,e,fs,as,V,{editingExisting:0})}}function cs(r){let e;return{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li>`},m(t,n){S(t,e,n)},p:q,i:q,o:q,d(t){t&&x(e)}}}class Yr extends Q{constructor(e){super(),ee(this,e,null,cs,V,{})}}function hs(r){let e,t,n,i,o,s,u,l,a,h,g,p;return{c(){e=w("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li>`,t=A(),n=w("label"),i=w("input"),o=W(`
  Avoid doubling back`),s=A(),u=w("div"),l=w("button"),l.textContent="Finish",a=A(),h=w("button"),h.textContent="Cancel",C(i,"type","checkbox"),C(l,"type","button"),C(h,"type","button"),ke(u,"display","flex"),ke(u,"justify-content","space-between")},m(f,m){S(f,e,m),S(f,t,m),S(f,n,m),b(n,i),i.checked=r[1],b(n,o),S(f,s,m),S(f,u,m),b(u,l),b(u,a),b(u,h),g||(p=[U(i,"change",r[2]),U(l,"click",r[3]),U(h,"click",r[4])],g=!0)},p(f,[m]){m&2&&(i.checked=f[1])},i:q,o:q,d(f){f&&x(e),f&&x(t),f&&x(n),f&&x(s),f&&x(u),g=!1,tt(p)}}}function ps(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),u=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setConfig({avoid_doubling_back:i})},[n,i,o,s,u]}class qr extends Q{constructor(e){super(),ee(this,e,ps,hs,V,{routeTool:0})}}function kr(r){let e,t,n,i;const o=[vs,gs,ms,ds],s=[];function u(l,a){return l[2]=="point"?0:l[2]=="polygon"?1:l[2]=="route"?2:3}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=Se()},m(l,a){s[e].m(l,a),S(l,n,a),i=!0},p(l,a){let h=e;e=u(l),e===h?s[e].p(l,a):(Be(),$(s[h],1,1,()=>{s[h]=null}),$e(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),F(t,1),t.m(n.parentNode,n))},i(l){i||(F(t),i=!0)},o(l){$(t),i=!1},d(l){s[e].d(l),l&&x(n)}}}function ds(r){let e;return{c(){e=w("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){S(t,e,n)},p:q,i:q,o:q,d(t){t&&x(e)}}}function ms(r){let e,t;return e=new qr({props:{routeTool:r[1]}}),{c(){H(e.$$.fragment)},m(n,i){J(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function gs(r){let e,t;return e=new Yr({}),{c(){H(e.$$.fragment)},m(n,i){J(e,n,i),t=!0},p:q,i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function vs(r){let e,t;return e=new jr({props:{editingExisting:!0}}),{c(){H(e.$$.fragment)},m(n,i){J(e,n,i),t=!0},p:q,i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function ys(r){let e,t,n=r[0]==qe&&kr(r);return{c(){n&&n.c(),e=Se()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==qe?n?(n.p(i,o),o&1&&F(n,1)):(n=kr(i),n.c(),F(n,1),n.m(e.parentNode,e)):n&&(Be(),$(n,1,1,()=>{n=null}),$e())},i(i){t||(F(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&x(e)}}}const qe="edit-geometry";function Xr(){}function _s(r,e,t){let n;te(r,Ie,v=>t(8,n=v));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:u}=e,l=null,a=null;function h(){l&&(o.stop(),s.stop(),u.stop(),ne.update(v=>{let _=v.features.find(k=>k.id==l);return delete _.properties.hide_while_editing,v})),l=null,t(2,a=null),Te.set(null)}n.on("mousemove",g),n.on("mouseout",p),n.on("click",f),gt(()=>{n.off("mousemove",g),n.off("mouseout",p),n.off("click",f)}),u.addEventListenerSuccess(v=>{i==qe&&(ne.update(_=>{let k=_.features.find(c=>c.id==l);return k.properties.length_meters=v.properties.length_meters,k.properties.waypoints=v.properties.waypoints,delete k.properties.hide_while_editing,k.geometry=v.geometry,_}),l=null,t(2,a=null))}),u.addEventListenerFailure(()=>{i==qe&&(ne.update(v=>{let _=v.features.find(k=>k.id==l);return delete _.properties.hide_while_editing,v}),l=null,t(2,a=null))});for(let v of[o,s])v.addEventListener(_=>{i==qe&&(ne.update(k=>{let c=k.features.find(d=>d.id==l);return c.geometry=_.geometry,delete c.properties.hide_while_editing,k}),l=null,t(2,a=null))});function g(v){var _;if(i==qe&&l==null){let k=n.queryRenderedFeatures(v.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Te.set(((_=k[0])==null?void 0:_.id)||null)}}function p(){i==qe&&l==null&&Te.set(null)}function f(v){if(i==qe&&l==null){let _=n.queryRenderedFeatures(v.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&m(_[0].id)}}function m(v){Te.set(null);let _=null;ne.update(c=>(_=c.features.find(d=>d.id==v),_.properties.hide_while_editing=!0,c));let k=_;l=v,k.geometry.type=="LineString"?(u.editExisting(k),t(2,a="route")):k.geometry.type=="Polygon"?(s.editExisting(k),t(2,a="polygon")):k.geometry.type=="Point"&&(o.start(),t(2,a="point"))}return r.$$set=v=>{"mode"in v&&t(0,i=v.mode),"pointTool"in v&&t(3,o=v.pointTool),"polygonTool"in v&&t(4,s=v.polygonTool),"routeTool"in v&&t(1,u=v.routeTool)},[i,u,a,o,s,Xr,h]}class bs extends Q{constructor(e){super(),ee(this,e,_s,ys,V,{mode:0,pointTool:3,polygonTool:4,routeTool:1,start:5,stop:6})}get start(){return Xr}get stop(){return this.$$.ctx[6]}}async function ws(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:a,value:h}=await n.read();if(a)break;s.push(h),o+=h.length;const g=100*o/i;e.style=`background: linear-gradient(to right, red ${g}%, transparent 0);`}let u=new Uint8Array(o),l=0;for(let a of s)u.set(a,l),l+=a.length;return u}function ks(r){let e,t;return e=new qr({props:{routeTool:r[0]}}),{c(){H(e.$$.fragment)},m(n,i){J(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function Ss(r){let e;return{c(){e=w("div"),e.textContent="Route tool loading..."},m(t,n){S(t,e,n),r[7](e)},p:q,i:q,o:q,d(t){t&&x(e),r[7](null)}}}function xs(r){let e,t,n,i;const o=[Ss,ks],s=[];function u(l,a){return l[0]?l[1]==xn?1:-1:0}return~(e=u(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=Se()},m(l,a){~e&&s[e].m(l,a),S(l,n,a),i=!0},p(l,[a]){let h=e;e=u(l),e===h?~e&&s[e].p(l,a):(t&&(Be(),$(s[h],1,1,()=>{s[h]=null}),$e()),~e?(t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),F(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(F(t),i=!0)},o(l){$(t),i=!1},d(l){~e&&s[e].d(l),l&&x(n)}}}const xn="route";function Es(r,e,t){let n;te(r,Ie,p=>t(8,n=p));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,u,{routeTool:l}=e;function a(){l.isActive()||l.start()}function h(){l==null||l.stop()}On(async()=>{await Dr(),console.log(`Grabbing ${s}`);try{const p=await ws(s,u);t(0,l=new ts(n,p))}catch(p){console.log(`Route tool broke: ${p}`),t(2,u.innerHTML="Failed to load",u);return}l.addEventListenerFailure(()=>{i==xn&&o("edit-attribute")}),l.addEventListenerSuccess(p=>{i==xn&&(ne.update(f=>(p.id=Qt(f),p.properties.intervention_type="route",f.features.push(p),f)),o("edit-attribute"),be.set(p.id))})}),gt(()=>{l==null||l.tearDown()});function g(p){pe[p?"unshift":"push"](()=>{u=p,t(2,u)})}return r.$$set=p=>{"mode"in p&&t(1,i=p.mode),"changeMode"in p&&t(3,o=p.changeMode),"url"in p&&t(4,s=p.url),"routeTool"in p&&t(0,l=p.routeTool)},[l,i,u,o,s,a,h,g]}class Ms extends Q{constructor(e){super(),ee(this,e,Es,xs,V,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Sr(r){let e,t;return e=new jr({props:{editingExisting:!1}}),{c(){H(e.$$.fragment)},m(n,i){J(e,n,i),t=!0},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function Ls(r){let e,t,n=r[0]==En&&Sr();return{c(){n&&n.c(),e=Se()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==En?n?o&1&&F(n,1):(n=Sr(),n.c(),F(n,1),n.m(e.parentNode,e)):n&&(Be(),$(n,1,1,()=>{n=null}),$e())},i(i){t||(F(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&x(e)}}}const En="point";function Os(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function u(){o.stop()}return o.addEventListener(l=>{n==En&&(ne.update(a=>(l.id=Qt(a),l.properties.intervention_type="other",a.features.push(l),a)),i("edit-attribute"),be.set(l.id))}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(1,i=l.changeMode),"pointTool"in l&&t(2,o=l.pointTool)},[n,i,o,s,u]}class Ps extends Q{constructor(e){super(),ee(this,e,Os,Ls,V,{mode:0,changeMode:1,pointTool:2,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function xr(r){let e,t;return e=new Yr({}),{c(){H(e.$$.fragment)},m(n,i){J(e,n,i),t=!0},i(n){t||(F(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){z(e,n)}}}function Cs(r){let e,t,n=r[0]==Mn&&xr();return{c(){n&&n.c(),e=Se()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Mn?n?o&1&&F(n,1):(n=xr(),n.c(),F(n,1),n.m(e.parentNode,e)):n&&(Be(),$(n,1,1,()=>{n=null}),$e())},i(i){t||(F(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&x(e)}}}const Mn="polygon";function Rs(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function u(){o.stop()}return o.addEventListener(l=>{n==Mn&&(ne.update(a=>(l.id=Qt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),be.set(l.id))}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(1,i=l.changeMode),"polygonTool"in l&&t(2,o=l.polygonTool)},[n,i,o,s,u]}class As extends Q{constructor(e){super(),ee(this,e,Rs,Cs,V,{mode:0,changeMode:1,polygonTool:2,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Is(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Ue(r.slice(0,2),[n,t]),s=Ue(r.slice(0,2),[e,i]);if(o>=s){var u=(t+i)/2;return[e,u-(n-e)/2,n,u+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Ns(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return pi(r,function(s){Fs(s,o,n)}),r}function Fs(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Ts(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=gn(r),n=gn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Ns(e,{precision:7});switch(n){case"Point":return Ln(r,i);case"MultiPoint":return Er(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Er(r,Br(r,i))}}function Er(r,e){var t=[],n=mt();return In(e,function(i){if(t.forEach(function(u,l){u.id=l}),!t.length)t=Ln(r,i).features,t.forEach(function(u){u.bbox||(u.bbox=Is(di(u)))}),n.load(ze(t));else{var o=n.search(i);if(o.features.length){var s=Ur(i,o);t=t.filter(function(u){return u.id!==s.id}),n.remove(s),Xt(Ln(s,i),function(u){t.push(u),n.insert(u)})}}}),ze(t)}function Ln(r,e){var t=[],n=Re(r)[0],i=Re(r)[r.geometry.coordinates.length-1];if(sn(n,We(e))||sn(i,We(e)))return ze([r]);var o=mt(),s=yn(r);o.load(s);var u=o.search(e);if(!u.features.length)return ze([r]);var l=Ur(e,u),a=[n],h=mi(s,function(g,p,f){var m=Re(p)[1],v=We(e);return f===l.id?(g.push(v),t.push(dt(g)),sn(v,m)?[v]:[v,m]):(g.push(m),g)},a);return h.length>1&&t.push(dt(h)),ze(t)}function Ur(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return Xt(e,function(i){var o=Ct(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function sn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Bs(r,e,t){var n=Re(t);if(gn(t)!=="LineString")throw new Error("line must be a LineString");var i=Ct(t,r),o=Ct(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var u=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)u.push(n[l]);return u.push(s[1].geometry.coordinates),dt(u,t.properties)}function Mr(r){let e;return{c(){e=w("p"),e.textContent="Click near a route to split it, or click on the map to cancel"},m(t,n){S(t,e,n)},d(t){t&&x(e)}}}function $s(r){let e,t=r[0]==Vt&&Mr();return{c(){t&&t.c(),e=Se()},m(n,i){t&&t.m(n,i),S(n,e,i)},p(n,[i]){n[0]==Vt?t||(t=Mr(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:q,o:q,d(n){t&&t.d(n),n&&x(e)}}}const Vt="split-route",Ds=10,Gs=30;let ln="split-route";function Hr(){}function Lr(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function js(r,e,t){let n,i;te(r,ne,m=>t(7,n=m)),te(r,Ie,m=>t(5,i=m));let{mode:o}=e,{changeMode:s}=e;function u(){t(4,l=null),a=null}let l=null,a=null;i.on("mousemove",h),i.on("click",g),gt(()=>{i.off("mousemove",h),i.off("click",g)}),et(i,ln,{type:"geojson",data:Ae()}),ge(i,{id:"draw-split-route",source:ln,...vt("black",Ds,["case",["==",["get","snapped"],!0],1,.5])});function h(m){if(o!=Vt)return;t(4,l=Lr(m.lngLat.toArray(),!1)),a=null;const v=[m.point.x-Gs,m.point.y],_=i.unproject(m.point).distanceTo(i.unproject(v))/1e3;let k=[];for(let[c,d]of n.features.entries())if(d.geometry.type=="LineString"){let y=Ct(d.geometry,l,{units:"kilometers"});y.properties.dist!=null&&y.properties.dist<=_&&k.push([c,y.geometry.coordinates,y.properties.dist])}k.sort((c,d)=>c[2]-d[2]),k.length>0&&(t(4,l=Lr(k[0][1],!0)),a=k[0][0])}function g(){if(o==Vt)if(a==null)s("edit-attribute");else{let m=Ts(n.features[a],l);if(m.features.length==2){let v=m.features[0],_=m.features[1];ne.update(k=>(v.id=k.features[a].id,_.id=Qt(k),v.properties=JSON.parse(JSON.stringify(k.features[a].properties)),_.properties=JSON.parse(JSON.stringify(v.properties)),p(k.features[a],v,_,l),k.features.splice(a,1,v,_),k))}u()}}function p(m,v,_,k){v.properties.length_meters=Dt(v,{units:"kilometers"})*1e3,_.properties.length_meters=Dt(_,{units:"kilometers"})*1e3,v.properties.waypoints=[],_.properties.waypoints=[];let c=f(m,k),d=!0,y=0;for(let M of m.properties.waypoints){let P=f(m,pt([M.lon,M.lat]));if(d)if(P<c)v.properties.waypoints.push(M);else{let L=M.snapped&&m.properties.waypoints[y-1].snapped;v.properties.waypoints.push({lon:k.geometry.coordinates[0],lat:k.geometry.coordinates[1],snapped:L}),d=!1,_.properties.waypoints.push({lon:k.geometry.coordinates[0],lat:k.geometry.coordinates[1],snapped:L}),_.properties.waypoints.push(M)}else _.properties.waypoints.push(M);y++}}function f(m,v){let _=m.geometry.coordinates[0],k=Bs(_,v,m);return Dt(k,{units:"kilometers"})*1e3}return r.$$set=m=>{"mode"in m&&t(0,o=m.mode),"changeMode"in m&&t(1,s=m.changeMode)},r.$$.update=()=>{if(r.$$.dirty&48){let m=Ae();l&&m.features.push(l),i.getSource(ln).setData(m)}},[o,s,Hr,u,l,i]}class Ys extends Q{constructor(e){super(),ee(this,e,js,$s,V,{mode:0,changeMode:1,start:2,stop:3})}get start(){return Hr}get stop(){return this.$$.ctx[3]}}function Or(r){let e,t,n={mode:r[2],pointTool:r[9],polygonTool:r[10],routeTool:r[1]};return e=new bs({props:n}),r[15](e),{c(){H(e.$$.fragment)},m(i,o){J(e,i,o),t=!0},p(i,o){const s={};o&4&&(s.mode=i[2]),o&2&&(s.routeTool=i[1]),e.$set(s)},i(i){t||(F(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){r[15](null),z(e,i)}}}function qs(r){let e,t,n,i,o,s,u,l,a,h,g,p,f,m,v,_,k,c,d,y,M,P,L,O,I,B,N,G,E,T,ie,de,we,se,ye,Ee,me,Z,nt,De,Ge,ae,ce,rt,je,_t={mode:r[2],changeMode:r[11]};u=new ss({props:_t}),r[13](u);let re=r[1]&&Or(r),he={mode:r[2],changeMode:r[11],pointTool:r[9]};y=new Ps({props:he}),r[17](y);let R={mode:r[2],changeMode:r[11],polygonTool:r[10]};N=new As({props:R}),r[19](N);function j(X){r[22](X)}let Bn={mode:r[2],changeMode:r[11],url:r[0]};r[1]!==void 0&&(Bn.routeTool=r[1]),se=new Ms({props:Bn}),r[21](se),pe.push(()=>Ke(se,"routeTool",j,r[1]));let Jr={mode:r[2],changeMode:r[11]};return ae=new Ys({props:Jr}),r[24](ae),{c(){e=w("div"),t=w("div"),n=w("button"),i=W("Edit attributes"),s=A(),H(u.$$.fragment),l=A(),a=w("div"),h=w("button"),g=W("Edit geometry"),f=A(),re&&re.c(),m=A(),v=w("div"),_=w("button"),k=W("New point"),d=A(),H(y.$$.fragment),M=A(),P=w("div"),L=w("button"),O=W("New polygon"),B=A(),H(N.$$.fragment),G=A(),E=w("div"),T=w("button"),ie=W("New route"),we=A(),H(se.$$.fragment),Ee=A(),me=w("div"),Z=w("button"),nt=W("Split route"),Ge=A(),H(ae.$$.fragment),C(n,"type","button"),n.disabled=o=r[2]=="edit-attribute",C(n,"class","svelte-cej5os"),C(h,"type","button"),h.disabled=p=r[2]=="edit-geometry",C(h,"class","svelte-cej5os"),C(_,"type","button"),_.disabled=c=r[2]=="point",C(_,"class","svelte-cej5os"),C(L,"type","button"),L.disabled=I=r[2]=="polygon",C(L,"class","svelte-cej5os"),C(T,"type","button"),T.disabled=de=r[2]=="route",C(T,"class","svelte-cej5os"),C(Z,"type","button"),Z.disabled=De=r[2]=="split-route",C(Z,"class","svelte-cej5os"),C(e,"class","toolbox svelte-cej5os")},m(X,fe){S(X,e,fe),b(e,t),b(t,n),b(n,i),b(t,s),J(u,t,null),b(e,l),b(e,a),b(a,h),b(h,g),b(a,f),re&&re.m(a,null),b(e,m),b(e,v),b(v,_),b(_,k),b(v,d),J(y,v,null),b(e,M),b(e,P),b(P,L),b(L,O),b(P,B),J(N,P,null),b(e,G),b(e,E),b(E,T),b(T,ie),b(E,we),J(se,E,null),b(e,Ee),b(e,me),b(me,Z),b(Z,nt),b(me,Ge),J(ae,me,null),ce=!0,rt||(je=[U(n,"click",r[12]),U(h,"click",r[14]),U(_,"click",r[16]),U(L,"click",r[18]),U(T,"click",r[20]),U(Z,"click",r[23])],rt=!0)},p(X,[fe]){(!ce||fe&4&&o!==(o=X[2]=="edit-attribute"))&&(n.disabled=o);const $n={};fe&4&&($n.mode=X[2]),u.$set($n),(!ce||fe&4&&p!==(p=X[2]=="edit-geometry"))&&(h.disabled=p),X[1]?re?(re.p(X,fe),fe&2&&F(re,1)):(re=Or(X),re.c(),F(re,1),re.m(a,null)):re&&(Be(),$(re,1,1,()=>{re=null}),$e()),(!ce||fe&4&&c!==(c=X[2]=="point"))&&(_.disabled=c);const Dn={};fe&4&&(Dn.mode=X[2]),y.$set(Dn),(!ce||fe&4&&I!==(I=X[2]=="polygon"))&&(L.disabled=I);const Gn={};fe&4&&(Gn.mode=X[2]),N.$set(Gn),(!ce||fe&4&&de!==(de=X[2]=="route"))&&(T.disabled=de);const Nt={};fe&4&&(Nt.mode=X[2]),fe&1&&(Nt.url=X[0]),!ye&&fe&2&&(ye=!0,Nt.routeTool=X[1],Qe(()=>ye=!1)),se.$set(Nt),(!ce||fe&4&&De!==(De=X[2]=="split-route"))&&(Z.disabled=De);const jn={};fe&4&&(jn.mode=X[2]),ae.$set(jn)},i(X){ce||(F(u.$$.fragment,X),F(re),F(y.$$.fragment,X),F(N.$$.fragment,X),F(se.$$.fragment,X),F(ae.$$.fragment,X),ce=!0)},o(X){$(u.$$.fragment,X),$(re),$(y.$$.fragment,X),$(N.$$.fragment,X),$(se.$$.fragment,X),$(ae.$$.fragment,X),ce=!1},d(X){X&&x(e),r[13](null),z(u),re&&re.d(),r[17](null),z(y),r[19](null),z(N),r[21](null),z(se),r[24](null),z(ae),rt=!1,tt(je)}}}function Xs(r,e,t){let n;te(r,Ie,E=>t(25,n=E));let{routeUrl:i}=e,o,s=new No(n),u=new Ho(n),l="edit-attribute",a,h,g,p,f,m;function v(E){let T={"edit-attribute":a,"edit-geometry":h,route:g,point:p,polygon:f,"split-route":m};if(l==E){console.log(`Mode is already ${l}, not changing`);return}console.log(`Stopping old mode ${l}`),T[l].stop(),t(2,l=E),console.log(`Starting new mode ${l}`),T[l].start()}gt(()=>{s==null||s.tearDown(),u==null||u.tearDown()});const _=()=>v("edit-attribute");function k(E){pe[E?"unshift":"push"](()=>{a=E,t(3,a)})}const c=()=>v("edit-geometry");function d(E){pe[E?"unshift":"push"](()=>{h=E,t(4,h)})}const y=()=>v("point");function M(E){pe[E?"unshift":"push"](()=>{p=E,t(6,p)})}const P=()=>v("polygon");function L(E){pe[E?"unshift":"push"](()=>{f=E,t(7,f)})}const O=()=>v("route");function I(E){pe[E?"unshift":"push"](()=>{g=E,t(5,g)})}function B(E){o=E,t(1,o)}const N=()=>v("split-route");function G(E){pe[E?"unshift":"push"](()=>{m=E,t(8,m)})}return r.$$set=E=>{"routeUrl"in E&&t(0,i=E.routeUrl)},[i,o,l,a,h,g,p,f,m,s,u,v,_,k,c,d,y,M,P,L,O,I,B,N,G]}class Us extends Q{constructor(e){super(),ee(this,e,Xs,qs,V,{routeUrl:0})}}function Hs(r){let e,t,n,i,o,s,u,l;return{c(){e=w("div"),t=w("button"),t.textContent="Home",n=A(),i=w("button"),i.textContent="About",o=A(),s=w("button"),s.textContent="Instructions",C(t,"type","button"),C(i,"type","button"),C(s,"type","button"),C(e,"slot","nav")},m(a,h){S(a,e,h),b(e,t),b(e,n),b(e,i),b(e,o),b(e,s),u||(l=[U(t,"click",r[8]),U(i,"click",r[6]),U(s,"click",r[7])],u=!0)},p:q,d(a){a&&x(e),u=!1,tt(l)}}}function Js(r){let e,t,n,i,o,s,u,l,a,h,g,p;return o=new xo({props:{boundaryGeojson:r[3]}}),u=new bo({props:{authorityName:r[4]}}),g=new mo({}),{c(){e=w("div"),t=w("h1"),n=W(r[4]),i=A(),H(o.$$.fragment),s=A(),H(u.$$.fragment),l=A(),a=w("br"),h=A(),H(g.$$.fragment),C(e,"slot","sidebar")},m(f,m){S(f,e,m),b(e,t),b(t,n),b(t,i),J(o,t,null),b(e,s),J(u,e,null),b(e,l),b(e,a),b(e,h),J(g,e,null),p=!0},p(f,m){const v={};m&8&&(v.boundaryGeojson=f[3]),o.$set(v)},i(f){p||(F(o.$$.fragment,f),F(u.$$.fragment,f),F(g.$$.fragment,f),p=!0)},o(f){$(o.$$.fragment,f),$(u.$$.fragment,f),$(g.$$.fragment,f),p=!1},d(f){f&&x(e),z(o),z(u),z(g)}}}function zs(r){let e,t,n,i,o,s,u,l,a,h,g,p;return e=new ro({props:{boundaryGeojson:r[3]}}),n=new Ro({}),o=new Io({}),u=new Us({props:{routeUrl:r[2]}}),a=new Lo({props:{style:r[5]}}),g=new Po({}),{c(){H(e.$$.fragment),t=A(),H(n.$$.fragment),i=A(),H(o.$$.fragment),s=A(),H(u.$$.fragment),l=A(),H(a.$$.fragment),h=A(),H(g.$$.fragment)},m(f,m){J(e,f,m),S(f,t,m),J(n,f,m),S(f,i,m),J(o,f,m),S(f,s,m),J(u,f,m),S(f,l,m),J(a,f,m),S(f,h,m),J(g,f,m),p=!0},p(f,m){const v={};m&8&&(v.boundaryGeojson=f[3]),e.$set(v);const _={};m&4&&(_.routeUrl=f[2]),u.$set(_)},i(f){p||(F(e.$$.fragment,f),F(n.$$.fragment,f),F(o.$$.fragment,f),F(u.$$.fragment,f),F(a.$$.fragment,f),F(g.$$.fragment,f),p=!0)},o(f){$(e.$$.fragment,f),$(n.$$.fragment,f),$(o.$$.fragment,f),$(u.$$.fragment,f),$(a.$$.fragment,f),$(g.$$.fragment,f),p=!1},d(f){z(e,f),f&&x(t),z(n,f),f&&x(i),z(o,f),f&&x(s),z(u,f),f&&x(l),z(a,f),f&&x(h),z(g,f)}}}function Ws(r){let e,t,n;return t=new xi({props:{style:r[5],$$slots:{default:[zs]},$$scope:{ctx:r}}}),{c(){e=w("div"),H(t.$$.fragment),C(e,"slot","main")},m(i,o){S(i,e,o),J(t,e,null),n=!0},p(i,o){const s={};o&16396&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(F(t.$$.fragment,i),n=!0)},o(i){$(t.$$.fragment,i),n=!1},d(i){i&&x(e),z(t)}}}function Vs(r){let e,t,n,i,o,s,u,l;e=new Ci({props:{$$slots:{main:[Ws],sidebar:[Js],nav:[Hs]},$$scope:{ctx:r}}});function a(f){r[9](f)}let h={};r[0]!==void 0&&(h.open=r[0]),n=new gi({props:h}),pe.push(()=>Ke(n,"open",a,r[0]));function g(f){r[10](f)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new wi({props:p}),pe.push(()=>Ke(s,"open",g,r[1])),{c(){H(e.$$.fragment),t=A(),H(n.$$.fragment),o=A(),H(s.$$.fragment)},m(f,m){J(e,f,m),S(f,t,m),J(n,f,m),S(f,o,m),J(s,f,m),l=!0},p(f,[m]){const v={};m&16396&&(v.$$scope={dirty:m,ctx:f}),e.$set(v);const _={};!i&&m&1&&(i=!0,_.open=f[0],Qe(()=>i=!1)),n.$set(_);const k={};!u&&m&2&&(u=!0,k.open=f[1],Qe(()=>u=!1)),s.$set(k)},i(f){l||(F(e.$$.fragment,f),F(n.$$.fragment,f),F(s.$$.fragment,f),l=!0)},o(f){$(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!1},d(f){z(e,f),f&&x(t),z(n,f),f&&x(o),z(s,f)}}}function Zs(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let u=s.get("authority"),l=s.get("style")||"streets";var a=`https://atip.uk/route-snappers/${u}.bin`;o||(a=`https://atip.uk/route-snappers-dev/${u}.bin`);function h(){t(0,n=!n),t(1,i=!1)}function g(){t(1,i=!i),t(0,n=!1)}let p;On(async()=>{t(3,p=await f())});async function f(){const c=await(await fetch(vi)).text(),d=JSON.parse(c);return d.features=d.features.filter(y=>{var M;return((M=y.properties)==null?void 0:M.name)==u}),d}const m=()=>window.open("index.html");function v(k){n=k,t(0,n)}function _(k){i=k,t(1,i)}return[n,i,a,p,u,l,h,g,m,v,_]}class Ks extends Q{constructor(e){super(),ee(this,e,Zs,Vs,V,{})}}new Ks({target:document.getElementById("app")});
