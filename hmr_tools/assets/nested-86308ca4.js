var Yi=Object.defineProperty;var Ji=(r,e,t)=>e in r?Yi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ie=(r,e,t)=>(Ji(r,typeof e!="symbol"?e+"":e,t),t);import{S as Q,i as ee,s as Z,M as Xi,b as le,a as Ee,d as B,m as D,k as Me,n as L,o as A,q as j,e as M,c as C,g as k,x as H,p as S,y as je,f as O,z as he,B as de,C as Wi,D as Zn,E as En,F as ze,G as pt,H as ht,I as dt,J as mt,K as hr,h as E,l as G,L as Vi,N as Ki,O as ae,P as Zi,w as Qn,Q as rt,R as ye,T as gn,t as V,U as me,V as ce,j as Oe,r as Ae,W as Ie,X as ui,Y as fi,Z as Gt,_ as gt,$ as rn,a0 as dr,a1 as Qi,a2 as eo,a3 as Te,a4 as to,a5 as no,a6 as Fn,a7 as on,a8 as ci,a9 as bn,aa as wt,ab as vn,ac as Nt,ad as yn,ae as In,af as ro,ag as _t,ah as er,ai as Ve,aj as bt,ak as io,al as tr,am as oo,an as so,ao as lo,ap as mr,aq as sn,ar as ao,as as uo,at as fo,A as co,u as po}from"./authorities-878dcfac.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pi=Symbol("Comlink.proxy"),ho=Symbol("Comlink.endpoint"),mo=Symbol("Comlink.releaseProxy"),Mn=Symbol("Comlink.finalizer"),Wt=Symbol("Comlink.thrown"),hi=r=>typeof r=="object"&&r!==null||typeof r=="function",_o={canHandle:r=>hi(r)&&r[pi],serialize(r){const{port1:e,port2:t}=new MessageChannel;return nr(r,e),[t,[t]]},deserialize(r){return r.start(),_i(r)}},go={canHandle:r=>hi(r)&&Wt in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},di=new Map([["proxy",_o],["throw",go]]);function bo(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function nr(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!bo(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(Qe);let u;try{const f=a.slice(0,-1).reduce((p,c)=>p[c],r),m=a.reduce((p,c)=>p[c],r);switch(s){case"GET":u=m;break;case"SET":f[a.slice(-1)[0]]=Qe(i.data.value),u=!0;break;case"APPLY":u=m.apply(f,l);break;case"CONSTRUCT":{const p=new m(...l);u=Eo(p)}break;case"ENDPOINT":{const{port1:p,port2:c}=new MessageChannel;nr(r,c),u=So(p,[p])}break;case"RELEASE":u=void 0;break;default:return}}catch(f){u={value:f,[Wt]:0}}Promise.resolve(u).catch(f=>({value:f,[Wt]:0})).then(f=>{const[m,p]=un(f);e.postMessage(Object.assign(Object.assign({},m),{id:o}),p),s==="RELEASE"&&(e.removeEventListener("message",n),mi(e),Mn in r&&typeof r[Mn]=="function"&&r[Mn]())}).catch(f=>{const[m,p]=un({value:new TypeError("Unserializable return value"),[Wt]:0});e.postMessage(Object.assign(Object.assign({},m),{id:o}),p)})}),e.start&&e.start()}function vo(r){return r.constructor.name==="MessagePort"}function mi(r){vo(r)&&r.close()}function _i(r,e){return Pn(r,[],e)}function Yt(r){if(r)throw new Error("Proxy has been released and is not useable")}function gi(r){return ut(r,{type:"RELEASE"}).then(()=>{mi(r)})}const ln=new WeakMap,an="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(ln.get(r)||0)-1;ln.set(r,e),e===0&&gi(r)});function yo(r,e){const t=(ln.get(e)||0)+1;ln.set(e,t),an&&an.register(r,e,r)}function wo(r){an&&an.unregister(r)}function Pn(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(Yt(n),s===mo)return()=>{wo(i),gi(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=ut(r,{type:"GET",path:e.map(l=>l.toString())}).then(Qe);return a.then.bind(a)}return Pn(r,[...e,s])},set(o,s,a){Yt(n);const[l,u]=un(a);return ut(r,{type:"SET",path:[...e,s].map(f=>f.toString()),value:l},u).then(Qe)},apply(o,s,a){Yt(n);const l=e[e.length-1];if(l===ho)return ut(r,{type:"ENDPOINT"}).then(Qe);if(l==="bind")return Pn(r,e.slice(0,-1));const[u,f]=_r(a);return ut(r,{type:"APPLY",path:e.map(m=>m.toString()),argumentList:u},f).then(Qe)},construct(o,s){Yt(n);const[a,l]=_r(s);return ut(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(Qe)}});return yo(i,r),i}function ko(r){return Array.prototype.concat.apply([],r)}function _r(r){const e=r.map(un);return[e.map(t=>t[0]),ko(e.map(t=>t[1]))]}const bi=new WeakMap;function So(r,e){return bi.set(r,e),r}function Eo(r){return Object.assign(r,{[pi]:!0})}function un(r){for(const[e,t]of di)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},bi.get(r)||[]]}function Qe(r){switch(r.type){case"HANDLER":return di.get(r.name).deserialize(r.value);case"RAW":return r.value}}function ut(r,e,t){return new Promise(n=>{const i=Mo();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function Mo(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Lo(){return new Worker("/atip/hmr_tools/assets/worker-566d7e34.js")}let se;const vi=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&vi.decode();let Lt=null;function Ct(){return(Lt===null||Lt.byteLength===0)&&(Lt=new Uint8Array(se.memory.buffer)),Lt}function $t(r,e){return r=r>>>0,vi.decode(Ct().subarray(r,r+e))}const Ue=new Array(128).fill(void 0);Ue.push(void 0,null,!0,!1);let Tt=Ue.length;function _e(r){Tt===Ue.length&&Ue.push(Ue.length+1);const e=Tt;return Tt=Ue[e],Ue[e]=r,e}function X(r){return Ue[r]}let tt=0;const Vt=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},$o=typeof Vt.encodeInto=="function"?function(r,e){return Vt.encodeInto(r,e)}:function(r,e){const t=Vt.encode(r);return e.set(t),{read:r.length,written:t.length}};function Ln(r,e,t){if(t===void 0){const a=Vt.encode(r),l=e(a.length)>>>0;return Ct().subarray(l,l+a.length).set(a),tt=a.length,l}let n=r.length,i=e(n)>>>0;const o=Ct();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3)>>>0;const a=Ct().subarray(i+s,i+n),l=$o(r,a);s+=l.written}return tt=s,i}function St(r){return r==null}let Ot=null;function ke(){return(Ot===null||Ot.byteLength===0)&&(Ot=new Int32Array(se.memory.buffer)),Ot}function Oo(r){r<132||(Ue[r]=Tt,Tt=r)}function xn(r){const e=X(r);return Oo(r),e}let At=null;function Ao(){return(At===null||At.byteLength===0)&&(At=new Float64Array(se.memory.buffer)),At}let Rt=null;function Ro(){return(Rt===null||Rt.byteLength===0)&&(Rt=new BigInt64Array(se.memory.buffer)),Rt}function Nn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Nn(r[0]));for(let s=1;s<i;s++)o+=", "+Nn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Co(r,e){const t=e(r.length*1)>>>0;return Ct().set(r,t/1),tt=r.length,t}function $n(r,e){try{return r.apply(this,e)}catch(t){se.__wbindgen_exn_store(_e(t))}}let Bn=class{static __wrap(e){e=e>>>0;const t=Object.create(Bn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();se.__wbg_routeinfo_free(e)}constructor(e){try{const o=se.__wbindgen_add_to_stack_pointer(-16),s=Co(e,se.__wbindgen_malloc),a=tt;se.routeinfo_new(o,s,a);var t=ke()[o/4+0],n=ke()[o/4+1],i=ke()[o/4+2];if(i)throw xn(n);return Bn.__wrap(t)}finally{se.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const f=se.__wbindgen_add_to_stack_pointer(-16);se.routeinfo_nameForRoute(f,this.__wbg_ptr,_e(e));var i=ke()[f/4+0],o=ke()[f/4+1],s=ke()[f/4+2],a=ke()[f/4+3],l=i,u=o;if(a)throw l=0,u=0,xn(s);return t=l,n=u,$t(l,u)}finally{se.__wbindgen_add_to_stack_pointer(16),se.__wbindgen_free(t,n)}}};async function To(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Fo(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=$t(e,t);return _e(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=X(t),i=typeof n=="string"?n:void 0;var o=St(i)?0:Ln(i,se.__wbindgen_malloc,se.__wbindgen_realloc),s=tt;ke()[e/4+1]=s,ke()[e/4+0]=o},r.wbg.__wbindgen_object_drop_ref=function(e){xn(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error($t(e,t));return _e(n)},r.wbg.__wbindgen_boolean_get=function(e){const t=X(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof X(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return _e(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return X(e)===X(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=X(t),i=typeof n=="number"?n:void 0;Ao()[e/8+1]=St(i)?0:i,ke()[e/4+0]=!St(i)},r.wbg.__wbindgen_is_object=function(e){const t=X(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return X(e)in X(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return _e(t)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return X(e)==X(t)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return _e(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=X(t).stack,i=Ln(n,se.__wbindgen_malloc,se.__wbindgen_realloc),o=tt;ke()[e/4+1]=o,ke()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error($t(e,t))}finally{se.__wbindgen_free(n,i)}},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(X(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=X(e)[t>>>0];return _e(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return X(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof X(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=X(e).next;return _e(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return $n(function(e){const t=X(e).next();return _e(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return X(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=X(e).value;return _e(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return _e(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return $n(function(e,t){const n=Reflect.get(X(e),X(t));return _e(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return $n(function(e,t){const n=X(e).call(X(t));return _e(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(X(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=X(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(X(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(X(e));return _e(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=X(e).buffer;return _e(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(X(e));return _e(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){X(e).set(X(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return X(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=X(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=X(t),i=typeof n=="bigint"?n:void 0;Ro()[e/8+1]=St(i)?BigInt(0):i,ke()[e/4+0]=!St(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Nn(X(t)),i=Ln(n,se.__wbindgen_malloc,se.__wbindgen_realloc),o=tt;ke()[e/4+1]=o,ke()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error($t(e,t))},r.wbg.__wbindgen_memory=function(){const e=se.memory;return _e(e)},r}function Io(r,e){return se=r.exports,yi.__wbindgen_wasm_module=e,Rt=null,At=null,Ot=null,Lt=null,se}async function yi(r){if(se!==void 0)return se;typeof r>"u"&&(r="/atip/hmr_tools/assets/route_info_bg.wasm");const e=Fo();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await To(await r,e);return Io(t,n)}class Po{constructor(){ie(this,"inner");this.inner=null}async loadFile(e){await yi(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new Bn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.nameForRoute(e)}}nr(Po);function xo(r){let e,t,n,i,o,s,a,l,u,f,m,p,c;return{c(){e=M("p"),e.textContent="For each intervention:",t=C(),n=M("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=C(),o=M("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=C(),a=M("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=C(),u=M("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,f=C(),m=M("p"),m.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,p=C(),c=M("p"),c.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(h,b){k(h,e,b),k(h,t,b),k(h,n,b),k(h,i,b),k(h,o,b),k(h,s,b),k(h,a,b),k(h,l,b),k(h,u,b),k(h,f,b),k(h,m,b),k(h,p,b),k(h,c,b)},p:H,d(h){h&&S(e),h&&S(t),h&&S(n),h&&S(i),h&&S(o),h&&S(s),h&&S(a),h&&S(l),h&&S(u),h&&S(f),h&&S(m),h&&S(p),h&&S(c)}}}function No(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[xo]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new Xi({props:o}),le.push(()=>Ee(e,"open",i,r[0])),{c(){B(e.$$.fragment)},m(s,a){D(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Me(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){j(e,s)}}}function Bo(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Do extends Q{constructor(e){super(),ee(this,e,Bo,No,Z,{open:0})}}const it=[];function kt(r,e=H){let t;const n=new Set;function i(a){if(Z(r,a)&&(r=a,t)){const l=!it.length;for(const u of n)u[1](),it.push(u,r);if(l){for(let u=0;u<it.length;u+=2)it[u][0](it[u+1]);it.length=0}}}function o(a){i(a(r))}function s(a,l=H){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||H),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const qe=kt(null),ne=kt(je()),Se=kt(null),Be=kt(null),Bt=kt(null),Dt=kt(null);function Ut(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function gr(r){console.log(`Deleting intervention ${r}`),ne.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Se.set(null),Be.set(null),Bt.set(null),Dt.set(null)}function br(r){let e;const t=r[4].default,n=pt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&ht(n,t,i,i[3],e?mt(t,i[3],o,null):dt(i[3]),null)},i(i){e||(L(n,i),e=!0)},o(i){A(n,i),e=!1},d(i){n&&n.d(i)}}}function jo(r){let e,t,n=r[1]&&br(r);return{c(){e=M("div"),n&&n.c(),O(e,"class","map svelte-12dpf1u")},m(i,o){k(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&L(n,1)):(n=br(i),n.c(),L(n,1),n.m(e,null)):n&&(he(),A(n,1,1,()=>{n=null}),de())},i(i){t||(L(n),t=!0)},o(i){A(n),t=!1},d(i){i&&S(e),n&&n.d(),r[5](null)}}}function qo(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;Wi("setCamera",!window.location.hash),Zn(()=>{s=new En.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new En.ScaleControl({})),s.addControl(new En.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),qe.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),ze(()=>{s.remove()});function u(f){le[f?"unshift":"push"](()=>{a=f,t(0,a)})}return r.$$set=f=>{"style"in f&&t(2,o=f.style),"$$scope"in f&&t(3,i=f.$$scope)},[a,l,o,i,n,u]}class Go extends Q{constructor(e){super(),ee(this,e,qo,jo,Z,{style:2})}}const Uo=r=>({}),vr=r=>({}),Ho=r=>({}),yr=r=>({}),zo=r=>({}),wr=r=>({});function Yo(r){let e,t,n,i,o,s,a,l,u,f,m,p;const c=r[3].nav,h=pt(c,r,r[2],wr),b=r[3].sidebar,g=pt(b,r,r[2],yr),y=r[3].main,d=pt(y,r,r[2],vr);return{c(){e=M("aside"),t=M("div"),n=M("nav"),h&&h.c(),i=C(),g&&g.c(),o=C(),s=M("button"),s.textContent="→",l=C(),u=M("main"),d&&d.c(),O(n,"class","svelte-1u7vg8a"),O(t,"class","sidebar-content content-container svelte-1u7vg8a"),O(s,"type","button"),O(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),O(e,"class",a=hr(r[0]?"":"collapsed")+" svelte-1u7vg8a"),O(u,"class","svelte-1u7vg8a")},m(_,v){k(_,e,v),E(e,t),E(t,n),h&&h.m(n,null),E(t,i),g&&g.m(t,null),E(e,o),E(e,s),k(_,l,v),k(_,u,v),d&&d.m(u,null),f=!0,m||(p=G(s,"click",r[1]),m=!0)},p(_,[v]){h&&h.p&&(!f||v&4)&&ht(h,c,_,_[2],f?mt(c,_[2],v,zo):dt(_[2]),wr),g&&g.p&&(!f||v&4)&&ht(g,b,_,_[2],f?mt(b,_[2],v,Ho):dt(_[2]),yr),(!f||v&1&&a!==(a=hr(_[0]?"":"collapsed")+" svelte-1u7vg8a"))&&O(e,"class",a),d&&d.p&&(!f||v&4)&&ht(d,y,_,_[2],f?mt(y,_[2],v,Uo):dt(_[2]),vr)},i(_){f||(L(h,_),L(g,_),L(d,_),f=!0)},o(_){A(h,_),A(g,_),A(d,_),f=!1},d(_){_&&S(e),h&&h.d(_),g&&g.d(_),_&&S(l),_&&S(u),d&&d.d(_),m=!1,p()}}}function Jo(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class Xo extends Q{constructor(e){super(),ee(this,e,Jo,Yo,Z,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Wo(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(f){return l([u,f])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(f){u=[6,f],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ze=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Vo(r,e){return r>e?1:r<e?-1:0}function Ye(r,e,t){for(var n=new Ze(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function On(r,e,t,n){var i=new Ze(r,e);if(t===null)return i.left=i.right=null,i;t=Ye(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function kr(r,e,t){var n=null,i=null;if(e){e=Ye(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Ko(r,e,t){return e===null?r:(r===null||(e=Ye(r.key,e,t),e.left=r),e)}function Dn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Dn(r.left,o,!1,n,i),r.right&&Dn(r.right,o,!0,n,i)}}var rr=function(){function r(e){e===void 0&&(e=Vo),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=On(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ze(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ye(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ye(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ye(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ye(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ye(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Qo(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Gn(e,t,0,i-1,o),this._root===null)this._root=jn(e,t,0,i),this._size=i;else{var s=es(this.toList(),Zo(e,t),o);i=this._size+i,this._root=qn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Dn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=kr(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=On(t,n,a,i):s=On(t,n,s,i),this._root=Ko(s,a,i)},r.prototype.split=function(e){return kr(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Wo(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function jn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ze(s,a);return l.left=jn(r,e,t,o),l.right=jn(r,e,o+1,n),l}return null}function Zo(r,e){for(var t=new Ze(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ze(r[i],e[i]);return n.next=null,t.next}function Qo(r){for(var e=r,t=[],n=!1,i=new Ze(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function qn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=qn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=qn(r,i+1,t),s}return null}function es(r,e,t){for(var n=new Ze(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Gn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Gn(r,e,t,a,i),Gn(r,e,a+1,n,i)}}function Re(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Sr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Le(r,e,t){return e&&Sr(r.prototype,e),t&&Sr(r,t),r}var Et=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Un=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Xe=Number.EPSILON;Xe===void 0&&(Xe=Math.pow(2,-52));var ts=Xe*Xe,Hn=function(e,t){if(-Xe<e&&e<Xe&&-Xe<t&&t<Xe)return 0;var n=e-t;return n*n<ts*e*t?0:e<t?-1:1},ns=function(){function r(){Re(this,r),this.reset()}return Le(r,[{key:"reset",value:function(){this.xRounder=new Er,this.yRounder=new Er}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Er=function(){function r(){Re(this,r),this.tree=new rr,this.round(0)}return Le(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Hn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Hn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),jt=new ns,Ft=function(e,t){return e.x*t.y-e.y*t.x},wi=function(e,t){return e.x*t.x+e.y*t.y},Mr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Ft(i,o);return Hn(s,0)},fn=function(e){return Math.sqrt(wi(e,e))},rs=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Ft(o,i)/fn(o)/fn(i)},is=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return wi(o,i)/fn(o)/fn(i)},Lr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},$r=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},os=function(e,t,n,i){if(t.x===0)return $r(n,i,e.x);if(i.x===0)return $r(e,t,n.x);if(t.y===0)return Lr(n,i,e.y);if(i.y===0)return Lr(e,t,n.y);var o=Ft(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=Ft(s,t)/o,l=Ft(s,i)/o,u=e.x+l*t.x,f=n.x+a*i.x,m=e.y+l*t.y,p=n.y+a*i.y,c=(u+f)/2,h=(m+p)/2;return{x:c,y:h}},Ne=function(){Le(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:cn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Re(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Le(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:rs(n.point,t.point,l.point),cosine:is(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,f=l.cosine,m=i.get(a),p=m.sine,c=m.cosine;return u>=0&&p>=0?f<c?1:f>c?-1:0:u<0&&p<0?f<c?-1:f>c?1:0:p<u?-1:p>u?1:0}}}]),r}(),ss=0,cn=function(){Le(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,f=t.rightSE.point.y,m=n.rightSE.point.y;if(i<o){if(u<l&&u<f)return 1;if(u>l&&u>f)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var c=n.comparePoint(t.rightSE.point);return c!==0?c:-1}if(i>o){if(l<u&&l<m)return-1;if(l>u&&l>m)return 1;var h=n.comparePoint(t.leftSE.point);if(h!==0)return h;var b=t.comparePoint(n.rightSE.point);return b<0?1:b>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var g=n.comparePoint(t.rightSE.point);if(g!==0)return g}if(s>a){var y=t.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(s!==a){var d=f-l,_=s-i,v=m-u,w=a-o;if(d>_&&v<w)return 1;if(d<_&&v>w)return-1}return s>a?1:s<a||f<m?-1:f>m?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Re(this,r),this.id=++ss,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Le(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Un(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,f=Et(n,l)&&this.comparePoint(l)===0,m=Et(i,s)&&t.comparePoint(s)===0,p=Et(n,u)&&this.comparePoint(u)===0,c=Et(i,a)&&t.comparePoint(a)===0;if(m&&f)return c&&!p?a:!c&&p?u:null;if(m)return p&&s.x===u.x&&s.y===u.y?null:s;if(f)return c&&a.x===l.x&&a.y===l.y?null:l;if(c&&p)return null;if(c)return a;if(p)return u;var h=os(s,this.vector(),l,t.vector());return h===null||!Et(o,h)?null:jt.round(h.x,h.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Ne(t,!0),s=new Ne(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Ne.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ne.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var f=i.rings[l],m=i.windings[l],p=n.rings.indexOf(f);p===-1?(n.rings.push(f),n.windings.push(m)):n.windings[p]+=m}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],f=n.indexOf(l);f===-1?(n.push(l),i.push(u)):i[f]+=u}for(var m=[],p=[],c=0,h=n.length;c<h;c++)if(i[c]!==0){var b=n[c],g=b.poly;if(p.indexOf(g)===-1)if(b.isExterior)m.push(g);else{p.indexOf(g)===-1&&p.push(g);var y=m.indexOf(b.poly);y!==-1&&m.splice(y,1)}}for(var d=0,_=m.length;d<_;d++){var v=m[d].multiPoly;o.indexOf(v)===-1&&o.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Fe.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Fe.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(m){return m.length===1&&m[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Fe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Ne.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Ne(o,!0),f=new Ne(s,!1);return new r(u,f,[i],[a])}}]),r}(),Or=function(){function r(e,t,n){if(Re(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=jt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=jt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(cn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(cn.fromRing(o,i,this))}return Le(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),ls=function(){function r(e,t){if(Re(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Or(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Or(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Le(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Ar=function(){function r(e,t){if(Re(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new ls(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Le(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),as=function(){Le(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,f=[l],m=l.point,p=[];a=l,l=u,f.push(l),l.point!==m;)for(;;){var c=l.getAvailableLinkedEvents();if(c.length===0){var h=f[0].point,b=f[f.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(b.x,", ").concat(b.y,"]."))}if(c.length===1){u=c[0].otherSE;break}for(var g=null,y=0,d=p.length;y<d;y++)if(p[y].point===l.point){g=y;break}if(g!==null){var _=p.splice(g)[0],v=f.splice(_.index);v.unshift(v[0].otherSE),n.push(new r(v.reverse()));continue}p.push({index:f.length,point:l.point});var w=l.getLeftmostComparator(a);u=c.sort(w)[0].otherSE;break}n.push(new r(f))}}return n}}]);function r(e){Re(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Le(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Mr(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Mr(l,t,u)===0&&n.shift(),n.push(n[0]);for(var f=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,c=[],h=m;h!=p;h+=f)c.push([n[h].x,n[h].y]);return c}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Ne.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Rr=function(){function r(e){Re(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Le(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),us=function(){function r(e){Re(this,r),this.rings=e,this.polys=this._composePolys(e)}return Le(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Rr(s));else{var a=s.enclosingRing();a.poly||n.push(new Rr(a)),a.poly.addInterior(s)}}return n}}]),r}(),fs=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:cn.compare;Re(this,r),this.queue=e,this.tree=new rr(t),this.segments=[]}return Le(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var f=null;if(l){var m=l.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(f=m),!l.isAnEndpoint(m)))for(var p=this._splitSafely(l,m),c=0,h=p.length;c<h;c++)i.push(p[c])}var b=null;if(u){var g=u.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(b=g),!u.isAnEndpoint(g)))for(var y=this._splitSafely(u,g),d=0,_=y.length;d<_;d++)i.push(y[d])}if(f!==null||b!==null){var v=null;if(f===null)v=b;else if(b===null)v=f;else{var w=Ne.comparePoints(f,b);v=w<=0?f:b}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var $=n.split(v),F=0,R=$.length;F<R;F++)i.push($[F])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var P=l.getIntersection(u);if(P!==null){if(!l.isAnEndpoint(P))for(var T=this._splitSafely(l,P),N=0,W=T.length;N<W;N++)i.push(T[N]);if(!u.isAnEndpoint(P))for(var I=this._splitSafely(u,P),z=0,oe=I.length;z<oe;z++)i.push(I[z])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Cr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,cs=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ps=function(){function r(){Re(this,r)}return Le(r,[{key:"run",value:function(t,n,i){Fe.type=t,jt.reset();for(var o=[new Ar(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Ar(i[s],!1));if(Fe.numMultiPolys=o.length,Fe.type==="difference")for(var l=o[0],u=1;u<o.length;)Un(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Fe.type==="intersection"){for(var f=0,m=o.length;f<m;f++)for(var p=o[f],c=f+1,h=o.length;c<h;c++)if(Un(p.bbox,o[c].bbox)===null)return[]}for(var b=new rr(Ne.compare),g=0,y=o.length;g<y;g++)for(var d=o[g].getSweepEvents(),_=0,v=d.length;_<v;_++)if(b.insert(d[_]),b.size>Cr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var w=new fs(b),$=b.size,F=b.pop();F;){var R=F.key;if(b.size===$){var P=R.segment;throw new Error("Unable to pop() ".concat(R.isLeft?"left":"right"," SweepEvent ")+"[".concat(R.point.x,", ").concat(R.point.y,"] from segment #").concat(P.id," ")+"[".concat(P.leftSE.point.x,", ").concat(P.leftSE.point.y,"] -> ")+"[".concat(P.rightSE.point.x,", ").concat(P.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(b.size>Cr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(w.segments.length>cs)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var T=w.process(R),N=0,W=T.length;N<W;N++){var I=T[N];I.consumedBy===void 0&&b.insert(I)}$=b.size,F=b.pop()}jt.reset();var z=as.factory(w.segments),oe=new us(z);return oe.getGeom()}}]),r}(),Fe=new ps,hs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Fe.run("union",e,n)},ds=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Fe.run("intersection",e,n)},ms=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Fe.run("xor",e,n)},_s=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Fe.run("difference",e,n)},Kt={union:hs,intersection:ds,xor:ms,difference:_s};function gs(r,e){var t=vs(e),n=null;return r.type==="FeatureCollection"?n=bs(r):n=ki(Kt.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function bs(r){var e=r.features.length===2?Kt.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Kt.union.apply(Kt,r.features.map(function(t){return t.geometry.coordinates}));return ki(e)}function ki(r){return Vi(r)}function vs(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return Ki(t)}function ys(r,e,t){let n;ae(r,qe,s=>t(1,n=s));let{boundaryGeojson:i}=e;return Zi("setCamera")&&n.fitBounds(Qn(i),{padding:20,animate:!1}),rt(n,"boundary",{type:"geojson",data:gs(i)}),ye(n,{id:"boundary",source:"boundary",...gn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class ws extends Q{constructor(e){super(),ee(this,e,ys,null,Z,{boundaryGeojson:0})}}function Tr(r){let e,t=Fr(r[3])+"",n,i,o,s,a,l;return{c(){e=V("Length: "),n=V(t),i=C(),o=M("br"),s=M("button"),s.textContent="Auto-fill details",O(s,"type","button")},m(u,f){k(u,e,f),k(u,n,f),k(u,i,f),k(u,o,f),k(u,s,f),a||(l=G(s,"click",r[14]),a=!0)},p(u,f){f&8&&t!==(t=Fr(u[3])+"")&&Ie(n,t)},d(u){u&&S(e),u&&S(n),u&&S(i),u&&S(o),u&&S(s),a=!1,l()}}}function ks(r){let e,t,n,i,o,s,a,l,u,f,m,p,c,h,b,g,y,d,_,v,w,$,F,R,P,T,N,W,I,z,oe,we,Ce,re,te,Pe,$e,K,pe,ve=r[3]&&Tr(r);return{c(){e=M("label"),t=V("Name:"),n=M("br"),i=C(),o=M("input"),s=C(),a=M("br"),l=C(),u=M("br"),f=C(),m=M("label"),p=M("input"),c=V(`
  Area`),h=C(),b=M("label"),g=M("input"),y=V(`
  Route`),d=C(),_=M("label"),v=M("input"),w=V(`
  Crossing`),$=C(),F=M("label"),R=M("input"),P=V(`
  Other`),T=C(),N=M("br"),W=C(),I=M("br"),z=C(),oe=M("label"),we=V("Description:"),Ce=M("br"),re=C(),te=M("textarea"),Pe=C(),ve&&ve.c(),$e=me(),O(o,"type","text"),ce(o,"width","100%"),O(p,"type","radio"),p.__value="area",p.value=p.__value,r[9][0].push(p),O(g,"type","radio"),g.__value="route",g.value=g.__value,r[9][0].push(g),O(v,"type","radio"),v.__value="crossing",v.value=v.__value,r[9][0].push(v),O(R,"type","radio"),R.__value="other",R.value=R.__value,r[9][0].push(R),ce(te,"width","100%"),O(te,"rows","5"),O(te,"class","svelte-15lna0i")},m(x,U){k(x,e,U),E(e,t),E(e,n),E(e,i),E(e,o),Oe(o,r[0]),k(x,s,U),k(x,a,U),k(x,l,U),k(x,u,U),k(x,f,U),k(x,m,U),E(m,p),p.checked=p.__value===r[1],E(m,c),k(x,h,U),k(x,b,U),E(b,g),g.checked=g.__value===r[1],E(b,y),k(x,d,U),k(x,_,U),E(_,v),v.checked=v.__value===r[1],E(_,w),k(x,$,U),k(x,F,U),E(F,R),R.checked=R.__value===r[1],E(F,P),k(x,T,U),k(x,N,U),k(x,W,U),k(x,I,U),k(x,z,U),k(x,oe,U),E(oe,we),E(oe,Ce),E(oe,re),E(oe,te),Oe(te,r[2]),k(x,Pe,U),ve&&ve.m(x,U),k(x,$e,U),K||(pe=[G(o,"input",r[7]),G(p,"change",r[8]),G(g,"change",r[10]),G(v,"change",r[11]),G(R,"change",r[12]),G(te,"input",r[13])],K=!0)},p(x,[U]){U&1&&o.value!==x[0]&&Oe(o,x[0]),U&2&&(p.checked=p.__value===x[1]),U&2&&(g.checked=g.__value===x[1]),U&2&&(v.checked=v.__value===x[1]),U&2&&(R.checked=R.__value===x[1]),U&4&&Oe(te,x[2]),x[3]?ve?ve.p(x,U):(ve=Tr(x),ve.c(),ve.m($e.parentNode,$e)):ve&&(ve.d(1),ve=null)},i:H,o:H,d(x){x&&S(e),x&&S(s),x&&S(a),x&&S(l),x&&S(u),x&&S(f),x&&S(m),r[9][0].splice(r[9][0].indexOf(p),1),x&&S(h),x&&S(b),r[9][0].splice(r[9][0].indexOf(g),1),x&&S(d),x&&S(_),r[9][0].splice(r[9][0].indexOf(v),1),x&&S($),x&&S(F),r[9][0].splice(r[9][0].indexOf(R),1),x&&S(T),x&&S(N),x&&S(W),x&&S(I),x&&S(z),x&&S(oe),x&&S(Pe),ve&&ve.d(x),x&&S($e),K=!1,Ae(pe)}}}function Fr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Ss(r,e,t){let n;ae(r,ne,_=>t(15,n=_));let{routeInfo:i}=e,{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function f(){let _=n.features.find(v=>v.id==o);try{t(0,s=await i.nameForRoute(_))}catch(v){window.alert(`Couldn't auto-name route: ${v}`)}}const m=[[]];function p(){s=this.value,t(0,s)}function c(){a=this.__value,t(1,a)}function h(){a=this.__value,t(1,a)}function b(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function y(){l=this.value,t(2,l)}const d=()=>f();return r.$$set=_=>{"routeInfo"in _&&t(5,i=_.routeInfo),"id"in _&&t(6,o=_.id),"name"in _&&t(0,s=_.name),"intervention_type"in _&&t(1,a=_.intervention_type),"description"in _&&t(2,l=_.description),"length_meters"in _&&t(3,u=_.length_meters)},[s,a,l,u,f,i,o,p,c,m,h,b,g,y,d]}class Es extends Q{constructor(e){super(),ee(this,e,Ss,ks,Z,{routeInfo:5,id:6,name:0,intervention_type:1,description:2,length_meters:3})}}const Ms="Intervention",Ls=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],$s={name:Ms,oneOf:Ls};function Os(r){const e=r-1;return e*e*e+1}function vt(r,{delay:e=0,duration:t=400,easing:n=Os}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),f=parseFloat(i.marginBottom),m=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:c=>`overflow: hidden;opacity: ${Math.min(c*20,1)*o};height: ${c*s}px;padding-top: ${c*a}px;padding-bottom: ${c*l}px;margin-top: ${c*u}px;margin-bottom: ${c*f}px;border-top-width: ${c*m}px;border-bottom-width: ${c*p}px;`}}function Si(r){return"members"in r}function Ei(r){return"oneOf"in r}function Mi(r){return typeof r=="string"}function Li(r){return typeof r=="object"&&"value"in r}function As(r){return"type"in r&&r.type=="number"}function $i(r){return"type"in r&&r.type=="one-liner"}function Oi(r){return"type"in r&&r.type=="textbox"}function Ai(r){return"type"in r&&r.type=="checkbox"}function Ir(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Pr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function xr(r){let e,t=r[1].description+"",n;return{c(){e=M("p"),n=V(t),O(e,"class","svelte-1b72l00")},m(i,o){k(i,e,o),E(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&Ie(n,t)},d(i){i&&S(e)}}}function Rs(r){let e,t,n;return{c(){e=M("input"),O(e,"type","checkbox")},m(i,o){k(i,e,o),e.checked=r[0],t||(n=G(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:H,o:H,d(i){i&&S(e),t=!1,n()}}}function Cs(r){let e,t,n;return{c(){e=M("textarea"),ce(e,"width","100%"),O(e,"rows","5"),O(e,"class","svelte-1b72l00")},m(i,o){k(i,e,o),Oe(e,r[0]),t||(n=G(e,"input",r[13]),t=!0)},p(i,o){o&1&&Oe(e,i[0])},i:H,o:H,d(i){i&&S(e),t=!1,n()}}}function Ts(r){let e,t,n;return{c(){e=M("input"),O(e,"type","text"),ce(e,"width","100%")},m(i,o){k(i,e,o),Oe(e,r[0]),t||(n=G(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Oe(e,i[0])},i:H,o:H,d(i){i&&S(e),t=!1,n()}}}function Fs(r){let e,t,n;return{c(){e=M("input"),O(e,"type","number")},m(i,o){k(i,e,o),Oe(e,r[0]),t||(n=G(e,"input",r[11]),t=!0)},p(i,o){o&1&&ui(e.value)!==i[0]&&Oe(e,i[0])},i:H,o:H,d(i){i&&S(e),t=!1,n()}}}function Is(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=Br(Ir(r,n,s));const o=s=>A(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=me()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);k(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Ir(s,n,l);i[l]?(i[l].p(u,a),L(i[l],1)):(i[l]=Br(u),i[l].c(),L(i[l],1),i[l].m(e.parentNode,e))}for(he(),l=n.length;l<i.length;l+=1)o(l);de()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)L(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)A(i[a]);t=!1},d(s){fi(i,s),s&&S(e)}}}function Ps(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=Dr(Pr(r,n,s));const o=s=>A(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=me()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);k(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Pr(s,n,l);i[l]?(i[l].p(u,a),L(i[l],1)):(i[l]=Dr(u),i[l].c(),L(i[l],1),i[l].m(e.parentNode,e))}for(he(),l=n.length;l<i.length;l+=1)o(l);de()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)L(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)A(i[a]);t=!1},d(s){fi(i,s),s&&S(e)}}}function xs(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,f,m,p,c=r[2]==r[15].name&&typeof r[0]=="object"&&Nr(r);return{c(){e=M("label"),t=M("input"),i=C(),s=V(o),a=M("br"),l=C(),c&&c.c(),u=me(),O(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(h,b){k(h,e,b),E(e,t),t.checked=t.__value===r[2],E(e,i),E(e,s),E(e,a),k(h,l,b),c&&c.m(h,b),k(h,u,b),f=!0,m||(p=[G(t,"change",r[9]),G(t,"change",r[4])],m=!0)},p(h,b){(!f||b&2&&n!==(n=h[15].name))&&(t.__value=n,t.value=t.__value),b&4&&(t.checked=t.__value===h[2]),(!f||b&2)&&o!==(o=h[15].name+"")&&Ie(s,o),h[2]==h[15].name&&typeof h[0]=="object"?c?(c.p(h,b),b&7&&L(c,1)):(c=Nr(h),c.c(),L(c,1),c.m(u.parentNode,u)):c&&(he(),A(c,1,1,()=>{c=null}),de())},i(h){f||(L(c),f=!0)},o(h){A(c),f=!1},d(h){h&&S(e),r[7][0].splice(r[7][0].indexOf(t),1),h&&S(l),c&&c.d(h),h&&S(u),m=!1,Ae(p)}}}function Ns(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,f;function m(h,b){return h[15].description?js:Ds}let p=m(r),c=p(r);return{c(){e=M("label"),t=M("input"),i=C(),s=V(o),a=C(),c.c(),l=C(),O(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(h,b){k(h,e,b),E(e,t),t.checked=t.__value===r[2],E(e,i),E(e,s),E(e,a),c.m(e,null),E(e,l),u||(f=[G(t,"change",r[8]),G(t,"change",r[3])],u=!0)},p(h,b){b&2&&n!==(n=h[15].value)&&(t.__value=n,t.value=t.__value),b&4&&(t.checked=t.__value===h[2]),b&2&&o!==(o=h[15].value+"")&&Ie(s,o),p===(p=m(h))&&c?c.p(h,b):(c.d(1),c=p(h),c&&(c.c(),c.m(e,l)))},i:H,o:H,d(h){h&&S(e),r[7][0].splice(r[7][0].indexOf(t),1),c.d(),u=!1,Ae(f)}}}function Bs(r){let e,t,n,i,o=r[15]+"",s,a,l,u,f,m;return{c(){e=M("label"),t=M("input"),i=C(),s=V(o),a=C(),l=M("br"),u=C(),O(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(p,c){k(p,e,c),E(e,t),t.checked=t.__value===r[2],E(e,i),E(e,s),E(e,a),E(e,l),E(e,u),f||(m=[G(t,"change",r[6]),G(t,"change",r[3])],f=!0)},p(p,c){c&2&&n!==(n=p[15])&&(t.__value=n,t.value=t.__value),c&4&&(t.checked=t.__value===p[2]),c&2&&o!==(o=p[15]+"")&&Ie(s,o)},i:H,o:H,d(p){p&&S(e),r[7][0].splice(r[7][0].indexOf(t),1),f=!1,Ae(m)}}}function Nr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Ht({props:l}),le.push(()=>Ee(t,"value",a,r[0][r[15].name])),{c(){e=M("div"),B(t.$$.fragment),i=C(),O(e,"class","svelte-1b72l00")},m(u,f){k(u,e,f),D(t,e,null),E(e,i),s=!0},p(u,f){r=u;const m={};f&2&&(m.spec=r[15]),!n&&f&3&&(n=!0,m.value=r[0][r[15].name],Me(()=>n=!1)),t.$set(m)},i(u){s||(L(t.$$.fragment,u),Gt(()=>{o||(o=gt(e,vt,{duration:500},!0)),o.run(1)}),s=!0)},o(u){A(t.$$.fragment,u),o||(o=gt(e,vt,{duration:500},!1)),o.run(0),s=!1},d(u){u&&S(e),j(t),u&&o&&o.end()}}}function Ds(r){let e;return{c(){e=M("br")},m(t,n){k(t,e,n)},p:H,d(t){t&&S(e)}}}function js(r){let e,t,n=r[15].description+"",i,o;return{c(){e=M("p"),t=V("("),i=V(n),o=V(")"),O(e,"class","svelte-1b72l00")},m(s,a){k(s,e,a),E(e,t),E(e,i),E(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&Ie(i,n)},d(s){s&&S(e)}}}function Br(r){let e,t,n,i,o,s;const a=[Bs,Ns,xs],l=[];function u(f,m){return m&2&&(e=null),m&2&&(t=null),e==null&&(e=!!Mi(f[15])),e?0:(t==null&&(t=!!Li(f[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=me()},m(f,m){l[n].m(f,m),k(f,o,m),s=!0},p(f,m){let p=n;n=u(f,m),n===p?l[n].p(f,m):(he(),A(l[p],1,1,()=>{l[p]=null}),de(),i=l[n],i?i.p(f,m):(i=l[n]=a[n](f),i.c()),L(i,1),i.m(o.parentNode,o))},i(f){s||(L(i),s=!0)},o(f){A(i),s=!1},d(f){l[n].d(f),f&&S(o)}}}function Dr(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function f(p){r[5](p,r[15])}let m={spec:r[15]};return r[0][r[15].name]!==void 0&&(m.value=r[0][r[15].name]),s=new Ht({props:m}),le.push(()=>Ee(s,"value",f,r[0][r[15].name])),{c(){e=M("div"),t=M("h3"),i=V(n),o=C(),B(s.$$.fragment),l=C(),O(e,"class","svelte-1b72l00")},m(p,c){k(p,e,c),E(e,t),E(t,i),E(e,o),D(s,e,null),E(e,l),u=!0},p(p,c){r=p,(!u||c&2)&&n!==(n=r[15].name+"")&&Ie(i,n);const h={};c&2&&(h.spec=r[15]),!a&&c&3&&(a=!0,h.value=r[0][r[15].name],Me(()=>a=!1)),s.$set(h)},i(p){u||(L(s.$$.fragment,p),u=!0)},o(p){A(s.$$.fragment,p),u=!1},d(p){p&&S(e),j(s)}}}function qs(r){let e,t,n,i,o,s,a,l,u,f,m,p=r[1].description&&xr(r);const c=[Ps,Is,Fs,Ts,Cs,Rs],h=[];function b(g,y){return y&2&&(t=null),y&2&&(n=null),y&2&&(i=null),y&2&&(o=null),y&2&&(s=null),y&2&&(a=null),t==null&&(t=!!Si(g[1])),t?0:(n==null&&(n=!!Ei(g[1])),n?1:(i==null&&(i=!!As(g[1])),i?2:(o==null&&(o=!!$i(g[1])),o?3:(s==null&&(s=!!Oi(g[1])),s?4:(a==null&&(a=!!Ai(g[1])),a?5:-1)))))}return~(l=b(r,-1))&&(u=h[l]=c[l](r)),{c(){p&&p.c(),e=C(),u&&u.c(),f=me()},m(g,y){p&&p.m(g,y),k(g,e,y),~l&&h[l].m(g,y),k(g,f,y),m=!0},p(g,[y]){g[1].description?p?p.p(g,y):(p=xr(g),p.c(),p.m(e.parentNode,e)):p&&(p.d(1),p=null);let d=l;l=b(g,y),l===d?~l&&h[l].p(g,y):(u&&(he(),A(h[d],1,1,()=>{h[d]=null}),de()),~l?(u=h[l],u?u.p(g,y):(u=h[l]=c[l](g),u.c()),L(u,1),u.m(f.parentNode,f)):u=null)},i(g){m||(L(u),m=!0)},o(g){A(u),m=!1},d(g){p&&p.d(g),g&&S(e),~l&&h[l].d(g),g&&S(f)}}}function Gs(r,e,t){var d,_,v;let{spec:n}=e,{value:i}=e,o="";if(Si(n)){i||(i={});for(let w of n.members)$i(w)||Oi(w)?i[d=w.name]||(i[d]=""):Ai(w)?i[_=w.name]||(i[_]=!1):i[v=w.name]||(i[v]={})}else Ei(n)&&(i||(i={}),Mi(i)?o=i:Li(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(w,$){r.$$.not_equal(i[$.name],w)&&(i[$.name]=w,t(0,i))}function f(){o=this.__value,t(2,o)}function m(){o=this.__value,t(2,o)}function p(){o=this.__value,t(2,o)}function c(w,$){r.$$.not_equal(i[$.name],w)&&(i[$.name]=w,t(0,i))}function h(){i=ui(this.value),t(0,i)}function b(){i=this.value,t(0,i)}function g(){i=this.value,t(0,i)}function y(){i=this.checked,t(0,i)}return r.$$set=w=>{"spec"in w&&t(1,n=w.spec),"value"in w&&t(0,i=w.value)},[i,n,o,s,a,u,f,l,m,p,c,h,b,g,y]}class Ht extends Q{constructor(e){super(),ee(this,e,Gs,qs,Z,{spec:1,value:0})}}function Us(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Ht({props:o}),le.push(()=>Ee(e,"value",i,r[0].v2)),{c(){B(e.$$.fragment)},m(s,a){D(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Me(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){j(e,s)}}}function Hs(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=$s;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class zs extends Q{constructor(e){super(),ee(this,e,Hs,Us,Z,{props:0})}}const Ys="Planning",Js=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],Xs={name:Ys,members:Js};function Ws(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Ht({props:o}),le.push(()=>Ee(e,"value",i,r[0].planning)),{c(){B(e.$$.fragment)},m(s,a){D(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Me(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){j(e,s)}}}function Vs(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=Xs;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Ks extends Q{constructor(e){super(),ee(this,e,Vs,Ws,Z,{props:0})}}const Zs="CriticalIssue",Qs=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],el={name:Zs,members:Qs};function tl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Ht({props:o}),le.push(()=>Ee(e,"value",i,r[0].criticals)),{c(){B(e.$$.fragment)},m(s,a){D(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Me(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){j(e,s)}}}function nl(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=el;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class rl extends Q{constructor(e){super(),ee(this,e,nl,tl,Z,{props:0})}}function jr(r){let e,t,n,i,o;const s=r[10].default,a=pt(s,r,r[9],null);return{c(){e=M("div"),a&&a.c(),ce(e,"border","solid 1px black"),ce(e,"padding","10px")},m(l,u){k(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=G(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&ht(a,s,l,l[9],n?mt(s,l[9],u,null):dt(l[9]),null)},i(l){n||(L(a,l),Gt(()=>{t||(t=gt(e,vt,{duration:100},!0)),t.run(1)}),n=!0)},o(l){A(a,l),t||(t=gt(e,vt,{duration:100},!1)),t.run(0),n=!1},d(l){l&&S(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function il(r){let e,t,n,i,o,s,a,l,u,f,m=r[4]&&jr(r);return{c(){e=M("button"),t=rn("svg"),n=rn("path"),i=C(),o=V(r[1]),s=C(),m&&m.c(),a=me(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-t7fpgu"),O(e,"aria-expanded",r[4]),O(e,"class","svelte-t7fpgu"),dr(e,"underlined",r[3])},m(p,c){k(p,e,c),E(e,t),E(t,n),E(e,i),E(e,o),k(p,s,c),m&&m.m(p,c),k(p,a,c),l=!0,u||(f=[G(e,"click",r[5]),G(e,"mouseenter",r[11]),G(e,"mouseleave",r[12])],u=!0)},p(p,[c]){(!l||c&2)&&Ie(o,p[1]),(!l||c&16)&&O(e,"aria-expanded",p[4]),(!l||c&8)&&dr(e,"underlined",p[3]),p[4]?m?(m.p(p,c),c&16&&L(m,1)):(m=jr(p),m.c(),L(m,1),m.m(a.parentNode,a)):m&&(he(),A(m,1,1,()=>{m=null}),de())},i(p){l||(L(m),l=!0)},o(p){A(m),l=!1},d(p){p&&S(e),p&&S(s),m&&m.d(p),p&&S(a),u=!1,Ae(f)}}}function ol(r,e,t){let n,i,o,s;ae(r,Be,d=>t(7,o=d)),ae(r,Se,d=>t(8,s=d));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:f}=e;const m=()=>{Se.update(d=>d==u?null:u),s==u&&(Dt.set(null),Dt.set(u))};let p;function c(){p==null||p.scrollIntoView({behavior:"smooth"})}const h=()=>Bt.set(u),b=()=>Bt.set(null);function g(d){le[d?"unshift":"push"](()=>{p=d,t(2,p)})}const y=()=>c();return r.$$set=d=>{"id"in d&&t(0,u=d.id),"label"in d&&t(1,f=d.label),"$$scope"in d&&t(9,l=d.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,f,p,i,n,m,c,o,s,l,a,h,b,g,y]}class sl extends Q{constructor(e){super(),ee(this,e,ol,il,Z,{id:0,label:1})}}function qr(r,e,t){const n=r.slice();return n[14]=e[t],n[15]=e,n[16]=t,n}function ll(r){let e,t,n;function i(s){r[10](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new rl({props:o}),le.push(()=>Ee(e,"props",i,r[14].properties)),{c(){B(e.$$.fragment)},m(s,a){D(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){j(e,s)}}}function al(r){let e,t,n;function i(s){r[9](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new Ks({props:o}),le.push(()=>Ee(e,"props",i,r[14].properties)),{c(){B(e.$$.fragment)},m(s,a){D(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){j(e,s)}}}function ul(r){let e,t,n;function i(s){r[8](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new zs({props:o}),le.push(()=>Ee(e,"props",i,r[14].properties)),{c(){B(e.$$.fragment)},m(s,a){D(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||(L(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){j(e,s)}}}function fl(r){let e,t,n,i,o;function s(f){r[5](f,r[14])}function a(f){r[6](f,r[14])}function l(f){r[7](f,r[14])}let u={routeInfo:r[1],id:r[14].id,length_meters:r[14].properties.length_meters};return r[14].properties.name!==void 0&&(u.name=r[14].properties.name),r[14].properties.intervention_type!==void 0&&(u.intervention_type=r[14].properties.intervention_type),r[14].properties.description!==void 0&&(u.description=r[14].properties.description),e=new Es({props:u}),le.push(()=>Ee(e,"name",s,r[14].properties.name)),le.push(()=>Ee(e,"intervention_type",a,r[14].properties.intervention_type)),le.push(()=>Ee(e,"description",l,r[14].properties.description)),{c(){B(e.$$.fragment)},m(f,m){D(e,f,m),o=!0},p(f,m){r=f;const p={};m&2&&(p.routeInfo=r[1]),m&4&&(p.id=r[14].id),m&4&&(p.length_meters=r[14].properties.length_meters),!t&&m&4&&(t=!0,p.name=r[14].properties.name,Me(()=>t=!1)),!n&&m&4&&(n=!0,p.intervention_type=r[14].properties.intervention_type,Me(()=>n=!1)),!i&&m&4&&(i=!0,p.description=r[14].properties.description,Me(()=>i=!1)),e.$set(p)},i(f){o||(L(e.$$.fragment,f),o=!0)},o(f){A(e.$$.fragment,f),o=!1},d(f){j(e,f)}}}function cl(r){let e,t,n,i,o,s,a,l,u,f,m,p,c,h,b;const g=[fl,ul,al,ll],y=[];function d(v,w){return v[0]=="v1"?0:v[0]=="v2"?1:v[0]=="planning"?2:v[0]=="criticals"?3:-1}~(e=d(r))&&(t=y[e]=g[e](r));function _(){return r[11](r[14])}return{c(){t&&t.c(),n=C(),i=M("br"),o=C(),s=M("br"),a=C(),l=M("div"),u=M("button"),u.textContent="Delete",f=C(),m=M("button"),m.textContent="Save",p=C(),O(u,"type","button"),O(m,"type","button"),ce(l,"display","flex"),ce(l,"justify-content","space-between")},m(v,w){~e&&y[e].m(v,w),k(v,n,w),k(v,i,w),k(v,o,w),k(v,s,w),k(v,a,w),k(v,l,w),E(l,u),E(l,f),E(l,m),k(v,p,w),c=!0,h||(b=[G(u,"click",_),G(m,"click",r[12])],h=!0)},p(v,w){r=v;let $=e;e=d(r),e===$?~e&&y[e].p(r,w):(t&&(he(),A(y[$],1,1,()=>{y[$]=null}),de()),~e?(t=y[e],t?t.p(r,w):(t=y[e]=g[e](r),t.c()),L(t,1),t.m(n.parentNode,n)):t=null)},i(v){c||(L(t),c=!0)},o(v){A(t),c=!1},d(v){~e&&y[e].d(v),v&&S(n),v&&S(i),v&&S(o),v&&S(s),v&&S(a),v&&S(l),v&&S(p),h=!1,Ae(b)}}}function Gr(r,e){let t,n,i;return n=new sl({props:{id:e[14].id,label:e[16]+1+") "+e[3](e[14]),$$slots:{default:[cl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=me(),B(n.$$.fragment),this.first=t},m(o,s){k(o,t,s),D(n,o,s),i=!0},p(o,s){e=o;const a={};s&4&&(a.id=e[14].id),s&4&&(a.label=e[16]+1+") "+e[3](e[14])),s&131079&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||(L(n.$$.fragment,o),i=!0)},o(o){A(n.$$.fragment,o),i=!1},d(o){o&&S(t),j(n,o)}}}function pl(r){let e=[],t=new Map,n,i,o,s,a=r[2].features;const l=u=>u[14].id;for(let u=0;u<a.length;u+=1){let f=qr(r,a,u),m=l(f);t.set(m,e[u]=Gr(m,f))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=me()},m(u,f){for(let m=0;m<e.length;m+=1)e[m].m(u,f);k(u,n,f),i=!0,o||(s=G(window,"keydown",r[4]),o=!0)},p(u,[f]){f&15&&(a=u[2].features,he(),e=Qi(e,f,l,1,u,a,t,n.parentNode,eo,Gr,n,qr),de())},i(u){if(!i){for(let f=0;f<a.length;f+=1)L(e[f]);i=!0}},o(u){for(let f=0;f<e.length;f+=1)A(e[f]);i=!1},d(u){for(let f=0;f<e.length;f+=1)e[f].d(u);u&&S(n),o=!1,s()}}}function hl(r,e,t){let n,i;ae(r,Se,y=>t(13,n=y)),ae(r,ne,y=>t(2,i=y));let{schema:o}=e,{routeInfo:s}=e;function a(y){var _,v,w,$,F;if(o=="planning")return((_=y.properties.planning)==null?void 0:_.name)||"Untitled polygon";if(o=="v2")return((w=(v=y.properties.v2)==null?void 0:v.Route)==null?void 0:w.name)||((F=($=y.properties.v2)==null?void 0:$.Crossing)==null?void 0:F.name)||"Untitled intervention";if(y.properties.name)return y.properties.name;var d=y.properties.intervention_type;return d=="other"&&(y.geometry.type=="Point"?d="point":y.geometry.type=="LineString"?d="line":d="polygon"),`Untitled ${d}`}function l(y){if(y.key=="Delete"){const d=y.target.tagName;if(d=="INPUT"||d=="TEXTAREA")return;y.preventDefault();const _=n;_&&gr(_)}}function u(y,d){r.$$.not_equal(d.properties.name,y)&&(d.properties.name=y,ne.set(i))}function f(y,d){r.$$.not_equal(d.properties.intervention_type,y)&&(d.properties.intervention_type=y,ne.set(i))}function m(y,d){r.$$.not_equal(d.properties.description,y)&&(d.properties.description=y,ne.set(i))}function p(y,d){r.$$.not_equal(d.properties,y)&&(d.properties=y,ne.set(i))}function c(y,d){r.$$.not_equal(d.properties,y)&&(d.properties=y,ne.set(i))}function h(y,d){r.$$.not_equal(d.properties,y)&&(d.properties=y,ne.set(i))}const b=y=>gr(y.id),g=()=>Se.set(null);return r.$$set=y=>{"schema"in y&&t(0,o=y.schema),"routeInfo"in y&&t(1,s=y.routeInfo)},[o,s,i,a,l,u,f,m,p,c,h,b,g]}class dl extends Q{constructor(e){super(),ee(this,e,hl,pl,Z,{schema:0,routeInfo:1})}}function Ke(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function De(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function zn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Je(r,e,t){t===void 0&&(t={});var n=Ke(r),i=Ke(e),o=Te(i[1]-n[1]),s=Te(i[0]-n[0]),a=Te(n[1]),l=Te(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return to(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Zt(r,e){return e===void 0&&(e={}),no(r,function(t,n){var i=n.geometry.coordinates;return t+Je(i[0],i[1],e)},0)}function ml(r){let e,t,n,i,o,s,a,l,u,f,m,p,c,h,b,g,y,d,_,v=r[0].features.length+"",w,$,F,R,P,T,N,W;return{c(){e=M("div"),t=M("label"),n=V(`Scheme name:
    `),i=M("input"),o=C(),s=M("br"),a=C(),l=M("div"),u=M("label"),f=M("input"),m=C(),p=M("button"),p.textContent="Load from GeoJSON",c=C(),h=M("button"),h.textContent="Export to GeoJSON",b=C(),g=M("br"),y=C(),d=M("div"),_=M("span"),w=V(v),$=V(" interventions"),F=C(),R=M("button"),P=V("Clear all"),O(i,"type","text"),O(f,"type","file"),O(f,"id","load_geojson"),O(f,"class","svelte-lhyd1e"),O(p,"type","button"),O(h,"type","button"),O(h,"class","align-right svelte-lhyd1e"),O(R,"type","button"),O(R,"class","align-right svelte-lhyd1e"),R.disabled=T=r[0].features.length==0},m(I,z){k(I,e,z),E(e,t),E(t,n),E(t,i),Oe(i,r[0].scheme_name),k(I,o,z),k(I,s,z),k(I,a,z),k(I,l,z),E(l,u),E(u,f),E(u,m),E(u,p),E(l,c),E(l,h),k(I,b,z),k(I,g,z),k(I,y,z),k(I,d,z),E(d,_),E(_,w),E(_,$),E(d,F),E(d,R),E(R,P),N||(W=[G(i,"input",r[7]),G(f,"change",r[3]),G(p,"click",gl),G(h,"click",r[2]),G(R,"click",r[1])],N=!0)},p(I,[z]){z&1&&i.value!==I[0].scheme_name&&Oe(i,I[0].scheme_name),z&1&&v!==(v=I[0].features.length+"")&&Ie(w,v),z&1&&T!==(T=I[0].features.length==0)&&(R.disabled=T)},i:H,o:H,d(I){I&&S(e),I&&S(o),I&&S(s),I&&S(a),I&&S(l),I&&S(b),I&&S(g),I&&S(y),I&&S(d),N=!1,Ae(W)}}}function _l(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function gl(){document.getElementById("load_geojson").click()}function bl(r,e,t){let n;ae(r,ne,h=>t(0,n=h));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=window.localStorage.getItem(s);if(a)try{ne.set(p(JSON.parse(a)))}catch(h){console.log(`Failed to load from local storage: ${h}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(ne.update(h=>(delete h.scheme_name,h.features=[],h)),Se.set(null),Be.set(null),Bt.set(null),Dt.set(null))}function u(){const h=JSON.parse(JSON.stringify(n));for(let b of h.features)delete b.properties.hide_while_editing;return h}function f(){let h=u();var b=s;h.authority=i,h.origin="atip-v1",h.scheme_name&&(b+="_"+h.scheme_name),b+=".txt",_l(b,JSON.stringify(h,null,"  "))}function m(h){const b=new FileReader;b.onload=y=>{try{ne.set(p(JSON.parse(y.target.result)))}catch(d){window.alert(`Couldn't load scheme from a file: ${d}`)}};let g=h.target.files;b.readAsText(g[0])}function p(h){let b=1;for(let g of h.features)g.properties||(g.properties={name:"",description:"",intervention_type:"other"}),g.geometry.type=="LineString"&&!g.properties.length_meters&&(g.properties.length_meters=Zt(g,{units:"kilometers"})*1e3),g.id=b++;return h}function c(){n.scheme_name=this.value,ne.set(n)}return r.$$set=h=>{"authorityName"in h&&t(4,i=h.authorityName),"schema"in h&&t(5,o=h.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,f,m,i,o,s,c]}class vl extends Q{constructor(e){super(),ee(this,e,bl,ml,Z,{authorityName:4,schema:5})}}const yl="/atip/hmr_tools/assets/zoom_out_map-b2e1091a.svg";function wl(r){let e,t,n,i,o;return{c(){e=M("button"),t=M("img"),Fn(t.src,n=yl)||O(t,"src",n),O(t,"alt","Zoom to show entire boundary"),O(e,"type","button"),O(e,"title","Zoom to show entire boundary"),O(e,"class","svelte-qzjsqo")},m(s,a){k(s,e,a),E(e,t),i||(o=G(e,"click",r[0]),i=!0)},p:H,i:H,o:H,d(s){s&&S(e),i=!1,o()}}}function kl(r,e,t){let n;ae(r,qe,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(Qn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class Sl extends Q{constructor(e){super(),ee(this,e,kl,wl,Z,{boundaryGeojson:1})}}function El(r){let e,t,n,i,o,s,a;return{c(){e=M("div"),t=V(`Basemap:
  `),n=M("select"),i=M("option"),i.textContent="Streets",o=M("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&Gt(()=>r[2].call(n)),O(e,"class","svelte-1tbnm6i")},m(l,u){k(l,e,u),E(e,t),E(e,n),E(n,i),E(n,o),on(n,r[0]),s||(a=[G(n,"change",r[2]),G(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&on(n,l[0])},i:H,o:H,d(l){l&&S(e),s=!1,Ae(a)}}}function Ml(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=ci(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Ll extends Q{constructor(e){super(),ee(this,e,Ml,El,Z,{style:0})}}const fe={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},wn=10,pn=10;function Ur(r){let e,t,n;const i=r[3].default,o=pt(i,r,r[2],null);return{c(){e=M("div"),o&&o.c()},m(s,a){k(s,e,a),o&&o.m(e,null),n=!0},p(s,a){o&&o.p&&(!n||a&4)&&ht(o,i,s,s[2],n?mt(i,s[2],a,null):dt(s[2]),null)},i(s){n||(L(o,s),Gt(()=>{t||(t=gt(e,vt,{duration:100},!0)),t.run(1)}),n=!0)},o(s){A(o,s),t||(t=gt(e,vt,{duration:100},!1)),t.run(0),n=!1},d(s){s&&S(e),o&&o.d(s),s&&t&&t.end()}}}function $l(r){let e,t,n,i,o,s,a,l,u,f,m=r[0]&&Ur(r);return{c(){e=M("button"),t=rn("svg"),n=rn("path"),i=C(),o=V(r[1]),s=C(),m&&m.c(),a=me(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-una9lq"),O(e,"aria-expanded",r[0]),O(e,"class","svelte-una9lq")},m(p,c){k(p,e,c),E(e,t),E(t,n),E(e,i),E(e,o),k(p,s,c),m&&m.m(p,c),k(p,a,c),l=!0,u||(f=G(e,"click",r[4]),u=!0)},p(p,[c]){(!l||c&2)&&Ie(o,p[1]),(!l||c&1)&&O(e,"aria-expanded",p[0]),p[0]?m?(m.p(p,c),c&1&&L(m,1)):(m=Ur(p),m.c(),L(m,1),m.m(a.parentNode,a)):m&&(he(),A(m,1,1,()=>{m=null}),de())},i(p){l||(L(m),l=!0)},o(p){A(m),l=!1},d(p){p&&S(e),p&&S(s),m&&m.d(p),p&&S(a),u=!1,f()}}}function Ol(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,o=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,i=l.$$scope)},[s,o,i,n,a]}class kn extends Q{constructor(e){super(),ee(this,e,Ol,$l,Z,{label:1,open:0})}}function Al(r){let e,t,n,i,o,s,a,l,u,f,m,p,c,h,b;return{c(){e=M("li"),t=M("span"),n=V("Areas"),i=C(),o=M("li"),s=M("span"),a=V("Routes"),l=C(),u=M("li"),f=M("span"),m=V("Crossings"),p=C(),c=M("li"),h=M("span"),b=V("Other"),O(t,"class","svelte-l42ea0"),ce(t,"background",fe.area),O(s,"class","svelte-l42ea0"),ce(s,"background",fe.route),O(f,"class","svelte-l42ea0"),ce(f,"background",fe.crossing),O(h,"class","svelte-l42ea0"),ce(h,"background",fe.other)},m(g,y){k(g,e,y),E(e,t),E(e,n),k(g,i,y),k(g,o,y),E(o,s),E(o,a),k(g,l,y),k(g,u,y),E(u,f),E(u,m),k(g,p,y),k(g,c,y),E(c,h),E(c,b)},p:H,d(g){g&&S(e),g&&S(i),g&&S(o),g&&S(l),g&&S(u),g&&S(p),g&&S(c)}}}function Rl(r){let e,t,n,i,o,s,a,l,u,f,m,p,c,h,b;return{c(){e=M("li"),t=M("span"),n=V("Preapp"),i=C(),o=M("li"),s=M("span"),a=V("Outline"),l=C(),u=M("li"),f=M("span"),m=V("Reserved matters"),p=C(),c=M("li"),h=M("span"),b=V("Local plan"),O(t,"class","svelte-l42ea0"),ce(t,"background",fe.preapp),O(s,"class","svelte-l42ea0"),ce(s,"background",fe.outline),O(f,"class","svelte-l42ea0"),ce(f,"background",fe["reserved matters"]),O(h,"class","svelte-l42ea0"),ce(h,"background",fe["local plan"])},m(g,y){k(g,e,y),E(e,t),E(e,n),k(g,i,y),k(g,o,y),E(o,s),E(o,a),k(g,l,y),k(g,u,y),E(u,f),E(u,m),k(g,p,y),k(g,c,y),E(c,h),E(c,b)},p:H,d(g){g&&S(e),g&&S(i),g&&S(o),g&&S(l),g&&S(u),g&&S(p),g&&S(c)}}}function Cl(r){let e;function t(o,s){return o[0]=="planning"?Rl:Al}let n=t(r),i=n(r);return{c(){e=M("ul"),i.c()},m(o,s){k(o,e,s),i.m(e,null)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&S(e),i.d()}}}function Tl(r){let e,t,n;return t=new kn({props:{label:"Interventions",open:!0,$$slots:{default:[Cl]},$$scope:{ctx:r}}}),{c(){e=M("div"),B(t.$$.fragment),O(e,"class","svelte-l42ea0")},m(i,o){k(i,e,o),D(t,e,null),n=!0},p(i,[o]){const s={};o&3&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(L(t.$$.fragment,i),n=!0)},o(i){A(t.$$.fragment,i),n=!1},d(i){i&&S(e),j(t)}}}function Fl(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class Il extends Q{constructor(e){super(),ee(this,e,Fl,Tl,Z,{schema:0})}}let ot="interventions";function Pl(r,e,t){let n,i;ae(r,qe,f=>t(1,n=f)),ae(r,ne,f=>t(2,i=f));let{schema:o}=e;rt(n,ot,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",fe.area,"route",fe.route,"crossing",fe.crossing,"other",fe.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",fe.preapp,"outline",fe.outline,"reserved matters",fe["reserved matters"],"local plan",fe["local plan"],"white"],l=["!=","hide_while_editing",!0];return ye(n,{id:"interventions-points",source:ot,filter:["all",bn,l,["!=","endpoint",!0]],...wt(s,wn)}),ye(n,{id:"interventions-lines",source:ot,filter:["all",vn,l],...Nt(s,pn)}),ye(n,{id:"interventions-lines-endpoints",source:ot,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*pn,"circle-opacity":0,"circle-stroke-color":fe.lineEndpointColor,"circle-stroke-width":2}}),ye(n,{id:"interventions-polygons",source:ot,filter:["all",yn,l],...gn(o=="planning"?a:s,.5)}),r.$$set=f=>{"schema"in f&&t(0,o=f.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let f=JSON.parse(JSON.stringify(i)),m=[];for(let p of f.features)if(p.geometry.type=="LineString")for(let c of[p.geometry.coordinates[0],p.geometry.coordinates[p.geometry.coordinates.length-1]])m.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:c}});f.features=f.features.concat(m),n.getSource(ot).setData(f)}},[o,n,i]}class xl extends Q{constructor(e){super(),ee(this,e,Pl,null,Z,{schema:0})}}let st="hover";function Nl(r,e,t){let n,i,o,s,a;return ae(r,qe,l=>t(0,n=l)),ae(r,ne,l=>t(1,i=l)),ae(r,Bt,l=>t(2,o=l)),ae(r,Be,l=>t(3,s=l)),ae(r,Se,l=>t(4,a=l)),rt(n,st,{type:"geojson",data:je()}),ye(n,{id:"hover-polygons",source:st,filter:yn,...Nt(fe.hovering,.5*pn,1)}),ye(n,{id:"hover-lines",source:st,filter:vn,...Nt(fe.hovering,1.5*pn,1)}),ye(n,{id:"hover-points",source:st,filter:bn,...wt(fe.hovering,1.5*wn,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(st).setData(i.features.find(u=>u.id==l)):n.getSource(st).setData(je())}},[n,i,o,s,a]}class Bl extends Q{constructor(e){super(),ee(this,e,Nl,null,Z,{})}}class ir{constructor(e,t){ie(this,"owner");ie(this,"map");ie(this,"mapHandlers",{});ie(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}function nt(r,e){let t=r.length;r=r.filter(n=>n!=e),t!=r.length-1&&window.alert("Bug: Tried to remove a callback that wasn't previously added")}const Jt="edit-point-mode";class Dl{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"cursor");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new ir(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),rt(e,Jt,{type:"geojson",data:je()}),ye(e,{id:"edit-point-mode",source:Jt,...wt(fe.hovering,wn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=jl(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}removeEventListenerSuccess(e){nt(this.eventListenersSuccess,e)}removeEventListenerFailure(e){nt(this.eventListenersFailure,e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Jt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=je();this.cursor&&e.features.push(this.cursor),this.map.getSource(Jt).setData(e)}}function jl(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Ri(r,e,t){if(t===void 0&&(t={}),t.final===!0)return ql(r,e);var n=Ke(r),i=Ke(e),o=Te(n[0]),s=Te(i[0]),a=Te(n[1]),l=Te(i[1]),u=Math.sin(s-o)*Math.cos(l),f=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return In(Math.atan2(u,f))}function ql(r,e){var t=Ri(e,r);return t=(t+180)%360,t}function Hr(r,e,t,n){n===void 0&&(n={});var i=Ke(r),o=Te(i[0]),s=Te(i[1]),a=Te(t),l=ro(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),f=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),m=In(f),p=In(u);return _t([m,p],n.properties)}function Yn(r){if(!r)throw new Error("geojson is required");var e=[];return er(r,function(t){Gl(t,e)}),Ve(e)}function Gl(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=De(n);break;case"LineString":t=[De(n)]}t.forEach(function(i){var o=Ul(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Ul(r,e){var t=[];return r.reduce(function(n,i){var o=bt([n,i],e);return o.bbox=Hl(n,i),t.push(o),i}),t}function Hl(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var yt={},zl={get exports(){return yt},set exports(r){yt=r}},Jn={},Yl={get exports(){return Jn},set exports(r){Jn=r}};(function(r,e){(function(t,n){r.exports=n()})(io,function(){function t(d,_,v,w,$){(function F(R,P,T,N,W){for(;N>T;){if(N-T>600){var I=N-T+1,z=P-T+1,oe=Math.log(I),we=.5*Math.exp(2*oe/3),Ce=.5*Math.sqrt(oe*we*(I-we)/I)*(z-I/2<0?-1:1),re=Math.max(T,Math.floor(P-z*we/I+Ce)),te=Math.min(N,Math.floor(P+(I-z)*we/I+Ce));F(R,P,re,te,W)}var Pe=R[P],$e=T,K=N;for(n(R,T,P),W(R[N],Pe)>0&&n(R,T,N);$e<K;){for(n(R,$e,K),$e++,K--;W(R[$e],Pe)<0;)$e++;for(;W(R[K],Pe)>0;)K--}W(R[T],Pe)===0?n(R,T,K):n(R,++K,N),K<=P&&(T=K+1),P<=K&&(N=K-1)}})(d,_,v||0,w||d.length-1,$||i)}function n(d,_,v){var w=d[_];d[_]=d[v],d[v]=w}function i(d,_){return d<_?-1:d>_?1:0}var o=function(d){d===void 0&&(d=9),this._maxEntries=Math.max(4,d),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(d,_,v){if(!v)return _.indexOf(d);for(var w=0;w<_.length;w++)if(v(d,_[w]))return w;return-1}function a(d,_){l(d,0,d.children.length,_,d)}function l(d,_,v,w,$){$||($=g(null)),$.minX=1/0,$.minY=1/0,$.maxX=-1/0,$.maxY=-1/0;for(var F=_;F<v;F++){var R=d.children[F];u($,d.leaf?w(R):R)}return $}function u(d,_){return d.minX=Math.min(d.minX,_.minX),d.minY=Math.min(d.minY,_.minY),d.maxX=Math.max(d.maxX,_.maxX),d.maxY=Math.max(d.maxY,_.maxY),d}function f(d,_){return d.minX-_.minX}function m(d,_){return d.minY-_.minY}function p(d){return(d.maxX-d.minX)*(d.maxY-d.minY)}function c(d){return d.maxX-d.minX+(d.maxY-d.minY)}function h(d,_){return d.minX<=_.minX&&d.minY<=_.minY&&_.maxX<=d.maxX&&_.maxY<=d.maxY}function b(d,_){return _.minX<=d.maxX&&_.minY<=d.maxY&&_.maxX>=d.minX&&_.maxY>=d.minY}function g(d){return{children:d,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(d,_,v,w,$){for(var F=[_,v];F.length;)if(!((v=F.pop())-(_=F.pop())<=w)){var R=_+Math.ceil((v-_)/w/2)*w;t(d,R,_,v,$),F.push(_,R,R,v)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(d){var _=this.data,v=[];if(!b(d,_))return v;for(var w=this.toBBox,$=[];_;){for(var F=0;F<_.children.length;F++){var R=_.children[F],P=_.leaf?w(R):R;b(d,P)&&(_.leaf?v.push(R):h(d,P)?this._all(R,v):$.push(R))}_=$.pop()}return v},o.prototype.collides=function(d){var _=this.data;if(!b(d,_))return!1;for(var v=[];_;){for(var w=0;w<_.children.length;w++){var $=_.children[w],F=_.leaf?this.toBBox($):$;if(b(d,F)){if(_.leaf||h(d,F))return!0;v.push($)}}_=v.pop()}return!1},o.prototype.load=function(d){if(!d||!d.length)return this;if(d.length<this._minEntries){for(var _=0;_<d.length;_++)this.insert(d[_]);return this}var v=this._build(d.slice(),0,d.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var w=this.data;this.data=v,v=w}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},o.prototype.insert=function(d){return d&&this._insert(d,this.data.height-1),this},o.prototype.clear=function(){return this.data=g([]),this},o.prototype.remove=function(d,_){if(!d)return this;for(var v,w,$,F=this.data,R=this.toBBox(d),P=[],T=[];F||P.length;){if(F||(F=P.pop(),w=P[P.length-1],v=T.pop(),$=!0),F.leaf){var N=s(d,F.children,_);if(N!==-1)return F.children.splice(N,1),P.push(F),this._condense(P),this}$||F.leaf||!h(F,R)?w?(v++,F=w.children[v],$=!1):F=null:(P.push(F),T.push(v),v=0,w=F,F=F.children[0])}return this},o.prototype.toBBox=function(d){return d},o.prototype.compareMinX=function(d,_){return d.minX-_.minX},o.prototype.compareMinY=function(d,_){return d.minY-_.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(d){return this.data=d,this},o.prototype._all=function(d,_){for(var v=[];d;)d.leaf?_.push.apply(_,d.children):v.push.apply(v,d.children),d=v.pop();return _},o.prototype._build=function(d,_,v,w){var $,F=v-_+1,R=this._maxEntries;if(F<=R)return a($=g(d.slice(_,v+1)),this.toBBox),$;w||(w=Math.ceil(Math.log(F)/Math.log(R)),R=Math.ceil(F/Math.pow(R,w-1))),($=g([])).leaf=!1,$.height=w;var P=Math.ceil(F/R),T=P*Math.ceil(Math.sqrt(R));y(d,_,v,T,this.compareMinX);for(var N=_;N<=v;N+=T){var W=Math.min(N+T-1,v);y(d,N,W,P,this.compareMinY);for(var I=N;I<=W;I+=P){var z=Math.min(I+P-1,W);$.children.push(this._build(d,I,z,w-1))}}return a($,this.toBBox),$},o.prototype._chooseSubtree=function(d,_,v,w){for(;w.push(_),!_.leaf&&w.length-1!==v;){for(var $=1/0,F=1/0,R=void 0,P=0;P<_.children.length;P++){var T=_.children[P],N=p(T),W=(I=d,z=T,(Math.max(z.maxX,I.maxX)-Math.min(z.minX,I.minX))*(Math.max(z.maxY,I.maxY)-Math.min(z.minY,I.minY))-N);W<F?(F=W,$=N<$?N:$,R=T):W===F&&N<$&&($=N,R=T)}_=R||_.children[0]}var I,z;return _},o.prototype._insert=function(d,_,v){var w=v?d:this.toBBox(d),$=[],F=this._chooseSubtree(w,this.data,_,$);for(F.children.push(d),u(F,w);_>=0&&$[_].children.length>this._maxEntries;)this._split($,_),_--;this._adjustParentBBoxes(w,$,_)},o.prototype._split=function(d,_){var v=d[_],w=v.children.length,$=this._minEntries;this._chooseSplitAxis(v,$,w);var F=this._chooseSplitIndex(v,$,w),R=g(v.children.splice(F,v.children.length-F));R.height=v.height,R.leaf=v.leaf,a(v,this.toBBox),a(R,this.toBBox),_?d[_-1].children.push(R):this._splitRoot(v,R)},o.prototype._splitRoot=function(d,_){this.data=g([d,_]),this.data.height=d.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(d,_,v){for(var w,$,F,R,P,T,N,W=1/0,I=1/0,z=_;z<=v-_;z++){var oe=l(d,0,z,this.toBBox),we=l(d,z,v,this.toBBox),Ce=($=oe,F=we,R=void 0,P=void 0,T=void 0,N=void 0,R=Math.max($.minX,F.minX),P=Math.max($.minY,F.minY),T=Math.min($.maxX,F.maxX),N=Math.min($.maxY,F.maxY),Math.max(0,T-R)*Math.max(0,N-P)),re=p(oe)+p(we);Ce<W?(W=Ce,w=z,I=re<I?re:I):Ce===W&&re<I&&(I=re,w=z)}return w||v-_},o.prototype._chooseSplitAxis=function(d,_,v){var w=d.leaf?this.compareMinX:f,$=d.leaf?this.compareMinY:m;this._allDistMargin(d,_,v,w)<this._allDistMargin(d,_,v,$)&&d.children.sort(w)},o.prototype._allDistMargin=function(d,_,v,w){d.children.sort(w);for(var $=this.toBBox,F=l(d,0,_,$),R=l(d,v-_,v,$),P=c(F)+c(R),T=_;T<v-_;T++){var N=d.children[T];u(F,d.leaf?$(N):N),P+=c(F)}for(var W=v-_-1;W>=_;W--){var I=d.children[W];u(R,d.leaf?$(I):I),P+=c(R)}return P},o.prototype._adjustParentBBoxes=function(d,_,v){for(var w=v;w>=0;w--)u(_[w],d)},o.prototype._condense=function(d){for(var _=d.length-1,v=void 0;_>=0;_--)d[_].children.length===0?_>0?(v=d[_-1].children).splice(v.indexOf(d[_]),1):this.clear():a(d[_],this.toBBox)},o})})(Yl);const Jl=tr(oo),Xl=tr(so),Wl=tr(lo);var xe=Jn,Ci=Jl,Ti=Xl,lt=Wl.default,Vl=Ti.featureEach;Ti.coordEach;Ci.polygon;var zr=Ci.featureCollection;function Fi(r){var e=new xe(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:lt(t),xe.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:lt(i),n.push(i)}):Vl(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:lt(i),n.push(i)}),xe.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:lt(t),xe.prototype.remove.call(this,t,n)},e.clear=function(){return xe.prototype.clear.call(this)},e.search=function(t){var n=xe.prototype.search.call(this,this.toBBox(t));return zr(n)},e.collides=function(t){return xe.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=xe.prototype.all.call(this);return zr(t)},e.toJSON=function(){return xe.prototype.toJSON.call(this)},e.fromJSON=function(t){return xe.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=lt(t);else if(t.type==="FeatureCollection")n=lt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}zl.exports=Fi;yt.default=Fi;function Ii(r,e){var t={},n=[];if(r.type==="LineString"&&(r=mr(r)),e.type==="LineString"&&(e=mr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Yr(r,e);return i&&n.push(i),Ve(n)}var o=yt();return o.load(Yn(e)),sn(Yn(r),function(s){sn(o.search(s),function(a){var l=Yr(s,a);if(l){var u=De(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),Ve(n)}function Yr(r,e){var t=De(r),n=De(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],f=n[1][0],m=n[1][1],p=(m-u)*(s-i)-(f-l)*(a-o),c=(f-l)*(o-u)-(m-u)*(i-l),h=(s-i)*(o-u)-(a-o)*(i-l);if(p===0)return c===0&&h===0,null;var b=c/p,g=h/p;if(b>=0&&b<=1&&g>=0&&g<=1){var y=i+b*(s-i),d=o+b*(a-o);return _t([y,d])}return null}function qt(r,e,t){t===void 0&&(t={});var n=_t([1/0,1/0],{dist:1/0}),i=0;return er(r,function(o){for(var s=De(o),a=0;a<s.length-1;a++){var l=_t(s[a]);l.properties.dist=Je(e,l,t);var u=_t(s[a+1]);u.properties.dist=Je(e,u,t);var f=Je(l,u,t),m=Math.max(l.properties.dist,u.properties.dist),p=Ri(l,u),c=Hr(e,m,p+90,t),h=Hr(e,m,p-90,t),b=Ii(bt([c.geometry.coordinates,h.geometry.coordinates]),bt([l.geometry.coordinates,u.geometry.coordinates])),g=null;b.features.length>0&&(g=b.features[0],g.properties.dist=Je(e,g,t),g.properties.location=i+Je(l,g,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+f),g&&g.properties.dist<n.properties.dist&&(n=g,n.properties.index=a),i+=f}}),n}const at="edit-polygon-mode";class Kl{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"points");ie(this,"cursor");ie(this,"hover");ie(this,"dragFrom");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new ir(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),rt(e,at,{type:"geojson",data:je()}),ye(e,{id:"edit-polygon-fill",source:at,filter:yn,...gn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),ye(e,{id:"edit-polygon-lines",source:at,filter:vn,...Nt("black",8,.5)}),ye(e,{id:"edit-polygon-vertices",source:at,filter:bn,...wt(fe.hovering,wn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Xr(this.points).forEach((n,i)=>{t.push([i+1,qt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}removeEventListenerSuccess(e){nt(this.eventListenersSuccess,e)}removeEventListenerFailure(e){nt(this.eventListenersFailure,e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(at),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=je();this.points.forEach((n,i)=>{let o=Jr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Xr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(at).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Jr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Jr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Xr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let J;const He=new Array(32).fill(void 0);He.push(void 0,null,!0,!1);function Y(r){return He[r]}let It=He.length;function Zl(r){r<36||(He[r]=It,It=r)}function Xn(r){const e=Y(r);return Zl(r),e}const Pi=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Pi.decode();let Qt=new Uint8Array;function Pt(){return Qt.byteLength===0&&(Qt=new Uint8Array(J.memory.buffer)),Qt}function ft(r,e){return Pi.decode(Pt().subarray(r,r+e))}function ge(r){It===He.length&&He.push(He.length+1);const e=It;return It=He[e],He[e]=r,e}function An(r){return r==null}let en=new Float64Array;function Ql(){return en.byteLength===0&&(en=new Float64Array(J.memory.buffer)),en}let tn=new Int32Array;function be(){return tn.byteLength===0&&(tn=new Int32Array(J.memory.buffer)),tn}let We=0;const nn=new TextEncoder("utf-8"),ea=typeof nn.encodeInto=="function"?function(r,e){return nn.encodeInto(r,e)}:function(r,e){const t=nn.encode(r);return e.set(t),{read:r.length,written:t.length}};function Xt(r,e,t){if(t===void 0){const a=nn.encode(r),l=e(a.length);return Pt().subarray(l,l+a.length).set(a),We=a.length,l}let n=r.length,i=e(n);const o=Pt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=Pt().subarray(i+s,i+n),l=ea(r,a);s+=l.written}return We=s,i}function Wn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Wn(r[0]));for(let s=1;s<i;s++)o+=", "+Wn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function ta(r,e){const t=e(r.length*1);return Pt().set(r,t/1),We=r.length,t}function Rn(r,e){try{return r.apply(this,e)}catch(t){J.__wbindgen_exn_store(ge(t))}}class hn{static __wrap(e){const t=Object.create(hn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();J.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=J.__wbindgen_add_to_stack_pointer(-16),s=ta(e,J.__wbindgen_malloc),a=We;J.jsroutesnapper_new(o,s,a);var t=be()[o/4+0],n=be()[o/4+1],i=be()[o/4+2];if(i)throw Xn(n);return hn.__wrap(t)}finally{J.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){J.jsroutesnapper_setConfig(this.ptr,ge(e))}toFinalFeature(){try{const n=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_toFinalFeature(n,this.ptr);var e=be()[n/4+0],t=be()[n/4+1];let i;return e!==0&&(i=ft(e,t).slice(),J.__wbindgen_free(e,t*1)),i}finally{J.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_renderGeojson(n,this.ptr);var e=be()[n/4+0],t=be()[n/4+1];return ft(e,t)}finally{J.__wbindgen_add_to_stack_pointer(16),J.__wbindgen_free(e,t)}}setSnapMode(e){J.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return J.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){J.jsroutesnapper_onClick(this.ptr)}onDragStart(){return J.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return J.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){J.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_editExisting(i,this.ptr,ge(e));var t=be()[i/4+0],n=be()[i/4+1];if(n)throw Xn(t)}finally{J.__wbindgen_add_to_stack_pointer(16)}}}async function na(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function ra(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Xn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=Y(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ft(e,t));return ge(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=ft(e,t);return ge(n)},r.wbg.__wbindgen_is_object=function(e){const t=Y(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Y(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Y(e)in Y(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=Y(t),i=typeof n=="number"?n:void 0;Ql()[e/8+1]=An(i)?0:i,be()[e/4+0]=!An(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Y(e)==Y(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Y(t),i=typeof n=="string"?n:void 0;var o=An(i)?0:Xt(i,J.__wbindgen_malloc,J.__wbindgen_realloc),s=We;be()[e/4+1]=s,be()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(Y(t)),i=Xt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),o=We;be()[e/4+1]=o,be()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Y(e);return ge(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=Y(e)[Y(t)];return ge(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(Y(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(Y(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(Y(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(Y(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(Y(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=Y(e)[t>>>0];return ge(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return Y(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Y(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=Y(e).next;return ge(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Rn(function(e){const t=Y(e).next();return ge(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return Y(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=Y(e).value;return ge(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ge(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Rn(function(e,t){const n=Reflect.get(Y(e),Y(t));return ge(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Rn(function(e,t){const n=Y(e).call(Y(t));return ge(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(Y(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=Y(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=Y(e).buffer;return ge(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(Y(e));return ge(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){Y(e).set(Y(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return Y(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=Y(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Y(t).stack,i=Xt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),o=We;be()[e/4+1]=o,be()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(ft(e,t))}finally{J.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=Wn(Y(t)),i=Xt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),o=We;be()[e/4+1]=o,be()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ft(e,t))},r.wbg.__wbindgen_memory=function(){const e=J.memory;return ge(e)},r}function ia(r,e){return J=r.exports,xi.__wbindgen_wasm_module=e,en=new Float64Array,tn=new Int32Array,Qt=new Uint8Array,J}async function xi(r){typeof r>"u"&&(r="/atip/hmr_tools/assets/route_snapper_bg.wasm");const e=ra();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await na(await r,e);return ia(t,n)}const Mt="route-snapper",Wr=10,oa=30;class sa{constructor(e,t){ie(this,"map");ie(this,"inner");ie(this,"active");ie(this,"eventListenersSuccessRoute");ie(this,"eventListenersSuccessArea");ie(this,"eventListenersFailure");ie(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new hn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],rt(e,Mt,{type:"geojson",data:je()}),ye(e,{id:"route-points",source:Mt,filter:bn,...wt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Wr/2,Wr])}),ye(e,{id:"route-lines",source:Mt,filter:vn,...Nt("black",2.5)}),ye(e,{id:"route-polygons",source:Mt,filter:yn,...gn("black",.5)}),this.events=new ir(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-oa,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}removeEventListenerSuccessRoute(e){nt(this.eventListenersSuccessRoute,e)}removeEventListenerSuccessArea(e){nt(this.eventListenersSuccessArea,e)}removeEventListenerFailure(e){nt(this.eventListenersFailure,e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Mt).setData(JSON.parse(this.inner.renderGeojson()))}}function la(r){let e,t,n,i,o,s,a,l;return{c(){e=M("button"),t=M("img"),i=C(),o=V(r[2]),Fn(t.src,n=r[3])||O(t,"src",n),O(t,"alt",r[2]),O(t,"class","svelte-1vvpkg9"),O(e,"type","button"),e.disabled=s=r[0]==r[1],O(e,"class","svelte-1vvpkg9")},m(u,f){k(u,e,f),E(e,t),E(e,i),E(e,o),a||(l=G(e,"click",r[5]),a=!0)},p(u,[f]){f&8&&!Fn(t.src,n=u[3])&&O(t,"src",n),f&4&&O(t,"alt",u[2]),f&4&&Ie(o,u[2]),f&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:H,o:H,d(u){u&&S(e),a=!1,l()}}}function aa(r,e,t){let{mode:n}=e,{thisMode:i}=e,{label:o}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(i);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,i=u.thisMode),"label"in u&&t(2,o=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,i,o,s,a,l]}class et extends Q{constructor(e){super(),ee(this,e,aa,la,Z,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function Vr(r){let e;function t(o,s){return o[1]?fa:ua}let n=t(r),i=n(r);return{c(){i.c(),e=me()},m(o,s){i.m(o,s),k(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&S(e)}}}function ua(r){let e;return{c(){e=M("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function fa(r){let e;return{c(){e=M("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function ca(r){let e,t=r[0]==ct&&Vr(r);return{c(){t&&t.c(),e=me()},m(n,i){t&&t.m(n,i),k(n,e,i)},p(n,[i]){n[0]==ct?t?t.p(n,i):(t=Vr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:H,o:H,d(n){t&&t.d(n),n&&S(e)}}}const ct="edit-attribute";function Ni(){}function pa(r,e,t){let n,i,o,s;ae(r,qe,c=>t(5,n=c)),ae(r,ne,c=>t(6,i=c)),ae(r,Dt,c=>t(7,o=c)),ae(r,Se,c=>t(1,s=c));let{mode:a}=e,{changeMode:l}=e;function u(){Se.set(null)}n.on("mousemove",f),n.on("mouseout",m),n.on("click",p),ze(()=>{n.off("mousemove",f),n.off("mouseout",m),n.off("click",p)});function f(c){var h;if(a==ct){let b=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Be.set(((h=b[0])==null?void 0:h.id)||null)}}function m(){a==ct&&Be.set(null)}function p(c){if(a==ct){let h=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});h.length>0?Se.set(h[0].id):Se.set(null)}}return r.$$set=c=>{"mode"in c&&t(0,a=c.mode),"changeMode"in c&&t(2,l=c.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let c=o;if(c){let h=i.features.find(b=>b.id==c);h.geometry.type=="Point"?n.flyTo({center:h.geometry.coordinates,duration:500}):n.fitBounds(Qn(h),{padding:200,duration:500}),l(ct)}}},[a,s,l,Ni,u,n,i,o]}class ha extends Q{constructor(e){super(),ee(this,e,pa,ca,Z,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Ni}get stop(){return this.$$.ctx[4]}}function da(r){let e,t;return{c:H,m(n,i){e||(t=G(window,"keydown",r[0]),e=!0)},p:H,i:H,o:H,d(n){e=!1,t()}}}function ma(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class Sn extends Q{constructor(e){super(),ee(this,e,ma,da,Z,{tool:1})}}function _a(r){let e;return{c(){e=M("li"),e.textContent="Click to add a new point"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function ga(r){let e;return{c(){e=M("li"),e.textContent="Click to move the point here"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function ba(r){let e,t,n,i,o,s,a,l,u,f;function m(h,b){return h[1]?ga:_a}let p=m(r),c=p(r);return a=new Sn({props:{tool:r[0]}}),{c(){e=M("ul"),c.c(),t=C(),n=M("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=C(),o=M("button"),o.textContent="Cancel",s=C(),B(a.$$.fragment),O(o,"type","button")},m(h,b){k(h,e,b),c.m(e,null),E(e,t),E(e,n),k(h,i,b),k(h,o,b),k(h,s,b),D(a,h,b),l=!0,u||(f=G(o,"click",r[2]),u=!0)},p(h,[b]){p!==(p=m(h))&&(c.d(1),c=p(h),c&&(c.c(),c.m(e,t)));const g={};b&1&&(g.tool=h[0]),a.$set(g)},i(h){l||(L(a.$$.fragment,h),l=!0)},o(h){A(a.$$.fragment,h),l=!1},d(h){h&&S(e),c.d(),h&&S(i),h&&S(o),h&&S(s),j(a,h),u=!1,f()}}}function va(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Bi extends Q{constructor(e){super(),ee(this,e,va,ba,Z,{pointTool:0,editingExisting:1})}}function ya(r){let e;return{c(){e=M("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},p:H,d(t){t&&S(e)}}}function wa(r){let e,t,n,i,o,s,a,l,u,f,m;return e=new kn({props:{label:"Help",$$slots:{default:[ya]},$$scope:{ctx:r}}}),l=new Sn({props:{tool:r[0]}}),{c(){B(e.$$.fragment),t=C(),n=M("div"),i=M("button"),i.textContent="Finish",o=C(),s=M("button"),s.textContent="Cancel",a=C(),B(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),ce(n,"display","flex"),ce(n,"justify-content","space-between")},m(p,c){D(e,p,c),k(p,t,c),k(p,n,c),E(n,i),E(n,o),E(n,s),k(p,a,c),D(l,p,c),u=!0,f||(m=[G(i,"click",r[1]),G(s,"click",r[2])],f=!0)},p(p,[c]){const h={};c&8&&(h.$$scope={dirty:c,ctx:p}),e.$set(h);const b={};c&1&&(b.tool=p[0]),l.$set(b)},i(p){u||(L(e.$$.fragment,p),L(l.$$.fragment,p),u=!0)},o(p){A(e.$$.fragment,p),A(l.$$.fragment,p),u=!1},d(p){j(e,p),p&&S(t),p&&S(n),p&&S(a),j(l,p),f=!1,Ae(m)}}}function ka(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Di extends Q{constructor(e){super(),ee(this,e,ka,wa,Z,{polygonTool:0})}}function Sa(r){let e;return{c(){e=M("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},p:H,d(t){t&&S(e)}}}function Ea(r){let e,t,n,i,o,s,a,l,u,f,m;return e=new kn({props:{label:"Help",$$slots:{default:[Sa]},$$scope:{ctx:r}}}),l=new Sn({props:{tool:r[0]}}),{c(){B(e.$$.fragment),t=C(),n=M("div"),i=M("button"),i.textContent="Finish",o=C(),s=M("button"),s.textContent="Cancel",a=C(),B(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),ce(n,"display","flex"),ce(n,"justify-content","space-between")},m(p,c){D(e,p,c),k(p,t,c),k(p,n,c),E(n,i),E(n,o),E(n,s),k(p,a,c),D(l,p,c),u=!0,f||(m=[G(i,"click",r[1]),G(s,"click",r[2])],f=!0)},p(p,[c]){const h={};c&8&&(h.$$scope={dirty:c,ctx:p}),e.$set(h);const b={};c&1&&(b.tool=p[0]),l.$set(b)},i(p){u||(L(e.$$.fragment,p),L(l.$$.fragment,p),u=!0)},o(p){A(e.$$.fragment,p),A(l.$$.fragment,p),u=!1},d(p){j(e,p),p&&S(t),p&&S(n),p&&S(a),j(l,p),f=!1,Ae(m)}}}function Ma(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class ji extends Q{constructor(e){super(),ee(this,e,Ma,Ea,Z,{routeTool:0})}}function La(r){let e;return{c(){e=M("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},p:H,d(t){t&&S(e)}}}function $a(r){let e,t,n,i,o,s,a,l,u,f,m,p,c,h,b;return e=new kn({props:{label:"Help",$$slots:{default:[La]},$$scope:{ctx:r}}}),p=new Sn({props:{tool:r[0]}}),{c(){B(e.$$.fragment),t=C(),n=M("label"),i=M("input"),o=V(`
  Avoid doubling back`),s=C(),a=M("div"),l=M("button"),l.textContent="Finish",u=C(),f=M("button"),f.textContent="Cancel",m=C(),B(p.$$.fragment),O(i,"type","checkbox"),O(l,"type","button"),O(f,"type","button"),ce(a,"display","flex"),ce(a,"justify-content","space-between")},m(g,y){D(e,g,y),k(g,t,y),k(g,n,y),E(n,i),i.checked=r[1],E(n,o),k(g,s,y),k(g,a,y),E(a,l),E(a,u),E(a,f),k(g,m,y),D(p,g,y),c=!0,h||(b=[G(i,"change",r[2]),G(l,"click",r[3]),G(f,"click",r[4])],h=!0)},p(g,[y]){const d={};y&32&&(d.$$scope={dirty:y,ctx:g}),e.$set(d),y&2&&(i.checked=g[1]);const _={};y&1&&(_.tool=g[0]),p.$set(_)},i(g){c||(L(e.$$.fragment,g),L(p.$$.fragment,g),c=!0)},o(g){A(e.$$.fragment,g),A(p.$$.fragment,g),c=!1},d(g){j(e,g),g&&S(t),g&&S(n),g&&S(s),g&&S(a),g&&S(m),j(p,g),h=!1,Ae(b)}}}function Oa(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class qi extends Q{constructor(e){super(),ee(this,e,Oa,$a,Z,{routeTool:0})}}function Kr(r){let e,t,n,i;const o=[Fa,Ta,Ca,Ra,Aa],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=me()},m(l,u){s[e].m(l,u),k(l,n,u),i=!0},p(l,u){let f=e;e=a(l),e===f?s[e].p(l,u):(he(),A(s[f],1,1,()=>{s[f]=null}),de(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),L(t,1),t.m(n.parentNode,n))},i(l){i||(L(t),i=!0)},o(l){A(t),i=!1},d(l){s[e].d(l),l&&S(n)}}}function Aa(r){let e;return{c(){e=M("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){k(t,e,n)},p:H,i:H,o:H,d(t){t&&S(e)}}}function Ra(r){let e,t;return e=new qi({props:{routeTool:r[3]}}),{c(){B(e.$$.fragment)},m(n,i){D(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Ca(r){let e,t;return e=new ji({props:{routeTool:r[3]}}),{c(){B(e.$$.fragment)},m(n,i){D(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Ta(r){let e,t;return e=new Di({props:{polygonTool:r[2]}}),{c(){B(e.$$.fragment)},m(n,i){D(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Fa(r){let e,t;return e=new Bi({props:{pointTool:r[1],editingExisting:!0}}),{c(){B(e.$$.fragment)},m(n,i){D(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Ia(r){let e,t,n=r[0]==Ge&&Kr(r);return{c(){n&&n.c(),e=me()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==Ge?n?(n.p(i,o),o&1&&L(n,1)):(n=Kr(i),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(he(),A(n,1,1,()=>{n=null}),de())},i(i){t||(L(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const Ge="edit-geometry";function Gi(){}function Pa(r,e,t){let n;ae(r,qe,_=>t(8,n=_));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function f(){l&&(o.stop(),s.stop(),a.stop(),ne.update(_=>{let v=_.features.find(w=>w.id==l);return delete v.properties.hide_while_editing,_})),l=null,t(4,u=null),Be.set(null)}n.on("mousemove",b),n.on("mouseout",g),n.on("click",y),a.addEventListenerSuccessRoute(m),a.addEventListenerSuccessArea(p),o.addEventListenerSuccess(c),s.addEventListenerSuccess(c),o.addEventListenerFailure(h),s.addEventListenerFailure(h),a.addEventListenerFailure(h),ze(()=>{n.off("mousemove",b),n.off("mouseout",g),n.off("click",y),a.removeEventListenerSuccessRoute(m),a.removeEventListenerSuccessArea(p),o.removeEventListenerSuccess(c),s.removeEventListenerSuccess(c),o.removeEventListenerFailure(h),s.removeEventListenerFailure(h),a.removeEventListenerFailure(h)});function m(_){i==Ge&&(ne.update(v=>{let w=v.features.find($=>$.id==l);return w.properties.length_meters=_.properties.length_meters,w.properties.waypoints=_.properties.waypoints,delete w.properties.hide_while_editing,w.geometry=_.geometry,v}),l=null,t(4,u=null))}function p(_){i==Ge&&(ne.update(v=>{let w=v.features.find($=>$.id==l);return w.properties.waypoints=_.properties.waypoints,delete w.properties.hide_while_editing,w.geometry=_.geometry,v}),l=null,t(4,u=null))}function c(_){i==Ge&&(ne.update(v=>{let w=v.features.find($=>$.id==l);return w.geometry=_.geometry,delete w.properties.hide_while_editing,v}),l=null,t(4,u=null))}function h(){i==Ge&&(ne.update(_=>{let v=_.features.find(w=>w.id==l);return delete v.properties.hide_while_editing,_}),l=null,t(4,u=null))}function b(_){var v;if(i==Ge&&l==null){let w=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Be.set(((v=w[0])==null?void 0:v.id)||null)}}function g(){i==Ge&&l==null&&Be.set(null)}function y(_){if(i==Ge&&l==null){let v=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});v.length>0&&d(v[0].id)}}function d(_){Be.set(null);let v=null;ne.update($=>(v=$.features.find(F=>F.id==_),v.properties.hide_while_editing=!0,$));let w=v;l=_,w.geometry.type=="LineString"?(a.editExistingRoute(w),t(4,u="route")):w.geometry.type=="Polygon"?w.properties.waypoints?(a.editExistingArea(w),t(4,u="snap-polygon")):(s.editExisting(w),t(4,u="free-polygon")):w.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=_=>{"mode"in _&&t(0,i=_.mode),"pointTool"in _&&t(1,o=_.pointTool),"polygonTool"in _&&t(2,s=_.polygonTool),"routeTool"in _&&t(3,a=_.routeTool)},[i,o,s,a,u,Gi,f]}class xa extends Q{constructor(e){super(),ee(this,e,Pa,Ia,Z,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Gi}get stop(){return this.$$.ctx[6]}}async function Na(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:f}=await n.read();if(u)break;s.push(f),o+=f.length;const m=100*o/i;e.style=`background: linear-gradient(to right, red ${m}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function Ba(r){let e,t;return e=new qi({props:{routeTool:r[0]}}),{c(){B(e.$$.fragment)},m(n,i){D(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Da(r){let e;return{c(){e=M("div"),e.textContent="Route tool loading..."},m(t,n){k(t,e,n),r[7](e)},p:H,i:H,o:H,d(t){t&&S(e),r[7](null)}}}function ja(r){let e,t,n,i;const o=[Da,Ba],s=[];function a(l,u){return l[0]?l[1]==Vn?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=me()},m(l,u){~e&&s[e].m(l,u),k(l,n,u),i=!0},p(l,[u]){let f=e;e=a(l),e===f?~e&&s[e].p(l,u):(t&&(he(),A(s[f],1,1,()=>{s[f]=null}),de()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),L(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(L(t),i=!0)},o(l){A(t),i=!1},d(l){~e&&s[e].d(l),l&&S(n)}}}const Vn="route";function qa(r,e,t){let n;ae(r,qe,h=>t(8,n=h));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function f(){l==null||l.stop()}Zn(async()=>{await xi(),console.log(`Grabbing ${s}`);try{const h=await Na(s,a);t(0,l=new sa(n,h))}catch(h){console.log(`Route tool broke: ${h}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerSuccessRoute(m),l.addEventListenerFailure(p)}),ze(()=>{l.removeEventListenerSuccessRoute(m),l.removeEventListenerFailure(p)});function m(h){i==Vn&&(ne.update(b=>(h.id=Ut(b),h.properties.intervention_type="route",b.features.push(h),b)),o("edit-attribute"),Se.set(h.id))}function p(){i==Vn&&o("edit-attribute")}function c(h){le[h?"unshift":"push"](()=>{a=h,t(2,a)})}return r.$$set=h=>{"mode"in h&&t(1,i=h.mode),"changeMode"in h&&t(3,o=h.changeMode),"url"in h&&t(4,s=h.url),"routeTool"in h&&t(0,l=h.routeTool)},[l,i,a,o,s,u,f,c]}class Ga extends Q{constructor(e){super(),ee(this,e,qa,ja,Z,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Zr(r){let e,t;return e=new Bi({props:{pointTool:r[1],editingExisting:!1}}),{c(){B(e.$$.fragment)},m(n,i){D(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Ua(r){let e,t,n=r[0]==dn&&Zr(r);return{c(){n&&n.c(),e=me()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==dn?n?(n.p(i,o),o&1&&L(n,1)):(n=Zr(i),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(he(),A(n,1,1,()=>{n=null}),de())},i(i){t||(L(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const dn="point";function Ha(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}o.addEventListenerSuccess(l),o.addEventListenerFailure(u),ze(()=>{o.removeEventListenerSuccess(l),o.removeEventListenerFailure(u)});function l(f){n==dn&&(ne.update(m=>(f.id=Ut(m),f.properties.intervention_type="other",m.features.push(f),m)),i("edit-attribute"),Se.set(f.id))}function u(){n==dn&&i("edit-attribute")}return r.$$set=f=>{"mode"in f&&t(0,n=f.mode),"changeMode"in f&&t(2,i=f.changeMode),"pointTool"in f&&t(1,o=f.pointTool)},[n,o,i,s,a]}class za extends Q{constructor(e){super(),ee(this,e,Ha,Ua,Z,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Qr(r){let e,t;return e=new Di({props:{polygonTool:r[1]}}),{c(){B(e.$$.fragment)},m(n,i){D(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Ya(r){let e,t,n=r[0]==mn&&Qr(r);return{c(){n&&n.c(),e=me()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==mn?n?(n.p(i,o),o&1&&L(n,1)):(n=Qr(i),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(he(),A(n,1,1,()=>{n=null}),de())},i(i){t||(L(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const mn="free-polygon";function Ja(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}o.addEventListenerSuccess(l),o.addEventListenerFailure(u),ze(()=>{o.removeEventListenerSuccess(l),o.removeEventListenerFailure(u)});function l(f){n==mn&&(ne.update(m=>(f.id=Ut(m),f.properties.intervention_type="area",m.features.push(f),m)),i("edit-attribute"),Se.set(f.id))}function u(){n==mn&&i("edit-attribute")}return r.$$set=f=>{"mode"in f&&t(0,n=f.mode),"changeMode"in f&&t(2,i=f.changeMode),"polygonTool"in f&&t(1,o=f.polygonTool)},[n,o,i,s,a]}class Xa extends Q{constructor(e){super(),ee(this,e,Ja,Ya,Z,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ei(r){let e,t;return e=new ji({props:{routeTool:r[1]}}),{c(){B(e.$$.fragment)},m(n,i){D(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Wa(r){let e,t,n=r[0]==_n&&ei(r);return{c(){n&&n.c(),e=me()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==_n?n?(n.p(i,o),o&1&&L(n,1)):(n=ei(i),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(he(),A(n,1,1,()=>{n=null}),de())},i(i){t||(L(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const _n="snap-polygon";function Va(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}o.addEventListenerSuccessArea(l),o.addEventListenerFailure(u),ze(()=>{o.removeEventListenerSuccessArea(l),o.removeEventListenerFailure(u)});function l(f){n==_n&&(ne.update(m=>(f.id=Ut(m),f.properties.intervention_type="area",m.features.push(f),m)),i("edit-attribute"),Se.set(f.id))}function u(){n==_n&&i("edit-attribute")}return r.$$set=f=>{"mode"in f&&t(0,n=f.mode),"changeMode"in f&&t(2,i=f.changeMode),"routeTool"in f&&t(1,o=f.routeTool)},[n,o,i,s,a]}class Ka extends Q{constructor(e){super(),ee(this,e,Va,Wa,Z,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Za(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Je(r.slice(0,2),[n,t]),s=Je(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Qa(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return ao(r,function(s){eu(s,o,n)}),r}function eu(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function tu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=zn(r),n=zn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Qa(e,{precision:7});switch(n){case"Point":return Kn(r,i);case"MultiPoint":return ti(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return ti(r,Ii(r,i))}}function ti(r,e){var t=[],n=yt();return er(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=Kn(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=Za(uo(a)))}),n.load(Ve(t));else{var o=n.search(i);if(o.features.length){var s=Ui(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),sn(Kn(s,i),function(a){t.push(a),n.insert(a)})}}}),Ve(t)}function Kn(r,e){var t=[],n=De(r)[0],i=De(r)[r.geometry.coordinates.length-1];if(Cn(n,Ke(e))||Cn(i,Ke(e)))return Ve([r]);var o=yt(),s=Yn(r);o.load(s);var a=o.search(e);if(!a.features.length)return Ve([r]);var l=Ui(e,a),u=[n],f=fo(s,function(m,p,c){var h=De(p)[1],b=Ke(e);return c===l.id?(m.push(b),t.push(bt(m)),Cn(b,h)?[b]:[b,h]):(m.push(h),m)},u);return f.length>1&&t.push(bt(f)),Ve(t)}function Ui(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return sn(e,function(i){var o=qt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function Cn(r,e){return r[0]===e[0]&&r[1]===e[1]}function nu(r,e,t){var n=De(t);if(zn(t)!=="LineString")throw new Error("line must be a LineString");var i=qt(t,r),o=qt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),bt(a,t.properties)}function ni(r){let e;return{c(){e=M("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function ru(r){let e,t,n,i=r[0]==xt&&ni();return{c(){i&&i.c(),e=me()},m(o,s){i&&i.m(o,s),k(o,e,s),t||(n=G(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==xt?i||(i=ni(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:H,o:H,d(o){i&&i.d(o),o&&S(e),t=!1,n()}}}const xt="split-route",iu=10,ou=30;let Tn="split-route";function Hi(){}function ri(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function su(r,e,t){let n,i;ae(r,ne,b=>t(8,n=b)),ae(r,qe,b=>t(6,i=b));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",f),i.on("click",m),ze(()=>{i.off("mousemove",f),i.off("click",m)}),rt(i,Tn,{type:"geojson",data:je()}),ye(i,{id:"draw-split-route",source:Tn,...wt("black",iu,["case",["==",["get","snapped"],!0],1,.5])});function f(b){if(o!=xt)return;t(5,l=ri(b.lngLat.toArray(),!1)),u=null;const g=[b.point.x-ou,b.point.y],y=i.unproject(b.point).distanceTo(i.unproject(g))/1e3;let d=[];for(let[_,v]of n.features.entries())if(v.geometry.type=="LineString"){let w=qt(v.geometry,l,{units:"kilometers"});w.properties.dist!=null&&w.properties.dist<=y&&d.push([_,w.geometry.coordinates,w.properties.dist])}d.sort((_,v)=>_[2]-v[2]),d.length>0&&(t(5,l=ri(d[0][1],!0)),u=d[0][0])}function m(){if(o==xt)if(u==null)s("edit-attribute");else{let b=tu(n.features[u],l);if(b.features.length==2){let g=b.features[0],y=b.features[1];ne.update(d=>(g.id=d.features[u].id,y.id=Ut(d),g.properties=JSON.parse(JSON.stringify(d.features[u].properties)),y.properties=JSON.parse(JSON.stringify(g.properties)),p(d.features[u],g,y,l),d.features.splice(u,1,g,y),d))}a()}}function p(b,g,y,d){g.properties.length_meters=Zt(g,{units:"kilometers"})*1e3,y.properties.length_meters=Zt(y,{units:"kilometers"})*1e3,g.properties.waypoints=[],y.properties.waypoints=[];let _=c(b,d),v=!0,w=0;for(let $ of b.properties.waypoints){let F=c(b,_t([$.lon,$.lat]));if(v)if(F<_)g.properties.waypoints.push($);else{let R=$.snapped&&b.properties.waypoints[w-1].snapped;g.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:R}),v=!1,y.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:R}),y.properties.waypoints.push($)}else y.properties.waypoints.push($);w++}}function c(b,g){let y=b.geometry.coordinates[0],d=nu(y,g,b);return Zt(d,{units:"kilometers"})*1e3}function h(b){o==xt&&b.key=="Escape"&&(s("edit-attribute"),b.preventDefault())}return r.$$set=b=>{"mode"in b&&t(0,o=b.mode),"changeMode"in b&&t(2,s=b.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let b=je();l&&b.features.push(l),i.getSource(Tn).setData(b)}},[o,h,s,Hi,a,l,i]}class lu extends Q{constructor(e){super(),ee(this,e,su,ru,Z,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Hi}get stop(){return this.$$.ctx[4]}}const au="/atip/hmr_tools/assets/edit_attributes-29b396e1.svg",uu="/atip/hmr_tools/assets/edit_geometry-02dad294.svg",fu="/atip/hmr_tools/assets/point-276f4055.svg",cu="/atip/hmr_tools/assets/polygon_snapped-18efbbea.svg",pu="/atip/hmr_tools/assets/polygon_freehand-cf965967.svg",hu="/atip/hmr_tools/assets/route-d3c0ebad.svg",du="/atip/hmr_tools/assets/split_route-9e0ea2da.svg";function ii(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new xa({props:n}),r[15](e),{c(){B(e.$$.fragment)},m(i,o){D(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){r[15](null),j(e,i)}}}function oi(r){let e,t;return e=new et({props:{mode:r[3],thisMode:"point",label:"New point",icon:fu,changeMode:r[13]}}),{c(){B(e.$$.fragment)},m(n,i){D(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function si(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Ka({props:n}),r[18](e),{c(){B(e.$$.fragment)},m(i,o){D(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){r[18](null),j(e,i)}}}function li(r){let e,t;return e=new et({props:{mode:r[3],thisMode:"route",label:"New route",icon:hu,changeMode:r[13]}}),{c(){B(e.$$.fragment)},m(n,i){D(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function ai(r){let e,t;return e=new et({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:du,changeMode:r[13]}}),{c(){B(e.$$.fragment)},m(n,i){D(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function mu(r){let e,t,n,i,o,s,a,l,u,f,m,p,c,h,b,g,y,d,_,v,w,$,F,R,P,T,N,W,I,z,oe,we;n=new et({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:au,changeMode:r[13]}});let Ce={mode:r[3],changeMode:r[13]};o=new ha({props:Ce}),r[14](o),l=new et({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:uu,changeMode:r[13]}});let re=r[2]&&ii(r),te=r[1]!="planning"&&oi(r),Pe={mode:r[3],changeMode:r[13],pointTool:r[11]};c=new za({props:Pe}),r[16](c),g=new et({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:pu,changeMode:r[13]}});let $e={mode:r[3],changeMode:r[13],polygonTool:r[12]};d=new Xa({props:$e}),r[17](d),w=new et({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:cu,changeMode:r[13]}});let K=r[2]&&si(r),pe=r[1]!="planning"&&li(r);function ve(q){r[20](q)}let x={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(x.routeTool=r[2]),T=new Ga({props:x}),r[19](T),le.push(()=>Ee(T,"routeTool",ve,r[2]));let U=r[1]!="planning"&&ai(r),zi={mode:r[3],changeMode:r[13]};return oe=new lu({props:zi}),r[21](oe),{c(){e=M("div"),t=M("div"),B(n.$$.fragment),i=C(),B(o.$$.fragment),s=C(),a=M("div"),B(l.$$.fragment),u=C(),re&&re.c(),f=C(),m=M("div"),te&&te.c(),p=C(),B(c.$$.fragment),h=C(),b=M("div"),B(g.$$.fragment),y=C(),B(d.$$.fragment),_=C(),v=M("div"),B(w.$$.fragment),$=C(),K&&K.c(),F=C(),R=M("div"),pe&&pe.c(),P=C(),B(T.$$.fragment),W=C(),I=M("div"),U&&U.c(),z=C(),B(oe.$$.fragment),O(e,"class","toolbox svelte-4s4d3o")},m(q,ue){k(q,e,ue),E(e,t),D(n,t,null),E(t,i),D(o,t,null),E(e,s),E(e,a),D(l,a,null),E(a,u),re&&re.m(a,null),E(e,f),E(e,m),te&&te.m(m,null),E(m,p),D(c,m,null),E(e,h),E(e,b),D(g,b,null),E(b,y),D(d,b,null),E(e,_),E(e,v),D(w,v,null),E(v,$),K&&K.m(v,null),E(e,F),E(e,R),pe&&pe.m(R,null),E(R,P),D(T,R,null),E(e,W),E(e,I),U&&U.m(I,null),E(I,z),D(oe,I,null),we=!0},p(q,[ue]){const or={};ue&8&&(or.mode=q[3]),n.$set(or);const sr={};ue&8&&(sr.mode=q[3]),o.$set(sr);const lr={};ue&8&&(lr.mode=q[3]),l.$set(lr),q[2]?re?(re.p(q,ue),ue&4&&L(re,1)):(re=ii(q),re.c(),L(re,1),re.m(a,null)):re&&(he(),A(re,1,1,()=>{re=null}),de()),q[1]!="planning"?te?(te.p(q,ue),ue&2&&L(te,1)):(te=oi(q),te.c(),L(te,1),te.m(m,p)):te&&(he(),A(te,1,1,()=>{te=null}),de());const ar={};ue&8&&(ar.mode=q[3]),c.$set(ar);const ur={};ue&8&&(ur.mode=q[3]),g.$set(ur);const fr={};ue&8&&(fr.mode=q[3]),d.$set(fr);const cr={};ue&8&&(cr.mode=q[3]),w.$set(cr),q[2]?K?(K.p(q,ue),ue&4&&L(K,1)):(K=si(q),K.c(),L(K,1),K.m(v,null)):K&&(he(),A(K,1,1,()=>{K=null}),de()),q[1]!="planning"?pe?(pe.p(q,ue),ue&2&&L(pe,1)):(pe=li(q),pe.c(),L(pe,1),pe.m(R,P)):pe&&(he(),A(pe,1,1,()=>{pe=null}),de());const zt={};ue&8&&(zt.mode=q[3]),ue&1&&(zt.url=q[0]),!N&&ue&4&&(N=!0,zt.routeTool=q[2],Me(()=>N=!1)),T.$set(zt),q[1]!="planning"?U?(U.p(q,ue),ue&2&&L(U,1)):(U=ai(q),U.c(),L(U,1),U.m(I,z)):U&&(he(),A(U,1,1,()=>{U=null}),de());const pr={};ue&8&&(pr.mode=q[3]),oe.$set(pr)},i(q){we||(L(n.$$.fragment,q),L(o.$$.fragment,q),L(l.$$.fragment,q),L(re),L(te),L(c.$$.fragment,q),L(g.$$.fragment,q),L(d.$$.fragment,q),L(w.$$.fragment,q),L(K),L(pe),L(T.$$.fragment,q),L(U),L(oe.$$.fragment,q),we=!0)},o(q){A(n.$$.fragment,q),A(o.$$.fragment,q),A(l.$$.fragment,q),A(re),A(te),A(c.$$.fragment,q),A(g.$$.fragment,q),A(d.$$.fragment,q),A(w.$$.fragment,q),A(K),A(pe),A(T.$$.fragment,q),A(U),A(oe.$$.fragment,q),we=!1},d(q){q&&S(e),j(n),r[14](null),j(o),j(l),re&&re.d(),te&&te.d(),r[16](null),j(c),j(g),r[17](null),j(d),j(w),K&&K.d(),pe&&pe.d(),r[19](null),j(T),U&&U.d(),r[21](null),j(oe)}}}function _u(r,e,t){let n;ae(r,qe,T=>t(22,n=T));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new Dl(n),l=new Kl(n),u="edit-attribute",f,m,p,c,h,b,g;function y(T){let N={"edit-attribute":f,"edit-geometry":m,route:p,point:c,"free-polygon":h,"snap-polygon":b,"split-route":g};if(u==T){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),N[u].stop(),t(3,u=T),console.log(`Starting new mode ${u}`),N[u].start()}ze(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function d(T){le[T?"unshift":"push"](()=>{f=T,t(4,f)})}function _(T){le[T?"unshift":"push"](()=>{m=T,t(5,m)})}function v(T){le[T?"unshift":"push"](()=>{c=T,t(7,c)})}function w(T){le[T?"unshift":"push"](()=>{h=T,t(8,h)})}function $(T){le[T?"unshift":"push"](()=>{b=T,t(9,b)})}function F(T){le[T?"unshift":"push"](()=>{p=T,t(6,p)})}function R(T){s=T,t(2,s)}function P(T){le[T?"unshift":"push"](()=>{g=T,t(10,g)})}return r.$$set=T=>{"routeSnapperUrl"in T&&t(0,i=T.routeSnapperUrl),"schema"in T&&t(1,o=T.schema)},[i,o,s,u,f,m,p,c,h,b,g,a,l,y,d,_,v,w,$,F,R,P]}class gu extends Q{constructor(e){super(),ee(this,e,_u,mu,Z,{routeSnapperUrl:0,schema:1})}}function bu(r){let e,t,n,i,o,s,a,l,u,f,m,p,c,h,b,g,y,d,_;return{c(){e=M("div"),t=M("div"),n=M("button"),n.textContent="Home",i=C(),o=M("button"),o.textContent="About",s=C(),a=M("button"),a.textContent="Instructions",l=C(),u=M("br"),f=C(),m=M("label"),p=V(`ATIP schema:
      `),c=M("select"),h=M("option"),h.textContent="v1",b=M("option"),b.textContent="v2",g=M("option"),g.textContent="Housing developments",y=M("option"),y.textContent="Critical issues",O(n,"type","button"),O(o,"type","button"),O(a,"type","button"),h.__value="v1",h.value=h.__value,b.__value="v2",b.value=b.__value,g.__value="planning",g.value=g.__value,y.__value="criticals",y.value=y.__value,r[2]===void 0&&Gt(()=>r[12].call(c)),O(e,"slot","nav")},m(v,w){k(v,e,w),E(e,t),E(t,n),E(t,i),E(t,o),E(t,s),E(t,a),E(e,l),E(e,u),E(e,f),E(e,m),E(m,p),E(m,c),E(c,h),E(c,b),E(c,g),E(c,y),on(c,r[2]),d||(_=[G(n,"click",r[11]),G(o,"click",r[8]),G(a,"click",r[9]),G(c,"change",r[12]),G(c,"change",r[10])],d=!0)},p(v,w){w&4&&on(c,v[2])},d(v){v&&S(e),d=!1,Ae(_)}}}function vu(r){let e,t,n,i,o,s,a,l,u,f,m,p;return o=new Sl({props:{boundaryGeojson:r[5]}}),a=new vl({props:{authorityName:r[6],schema:r[2]}}),m=new dl({props:{schema:r[2],routeInfo:r[4]}}),{c(){e=M("div"),t=M("h1"),n=V(r[6]),i=C(),B(o.$$.fragment),s=C(),B(a.$$.fragment),l=C(),u=M("br"),f=C(),B(m.$$.fragment),O(e,"slot","sidebar")},m(c,h){k(c,e,h),E(e,t),E(t,n),E(t,i),D(o,t,null),E(e,s),D(a,e,null),E(e,l),E(e,u),E(e,f),D(m,e,null),p=!0},p(c,h){const b={};h&32&&(b.boundaryGeojson=c[5]),o.$set(b);const g={};h&4&&(g.schema=c[2]),a.$set(g);const y={};h&4&&(y.schema=c[2]),h&16&&(y.routeInfo=c[4]),m.$set(y)},i(c){p||(L(o.$$.fragment,c),L(a.$$.fragment,c),L(m.$$.fragment,c),p=!0)},o(c){A(o.$$.fragment,c),A(a.$$.fragment,c),A(m.$$.fragment,c),p=!1},d(c){c&&S(e),j(o),j(a),j(m)}}}function yu(r){let e,t,n,i,o,s,a,l,u,f,m,p;return e=new ws({props:{boundaryGeojson:r[5]}}),n=new xl({props:{schema:r[2]}}),o=new Bl({}),a=new gu({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new Ll({props:{style:r[7]}}),m=new Il({props:{schema:r[2]}}),{c(){B(e.$$.fragment),t=C(),B(n.$$.fragment),i=C(),B(o.$$.fragment),s=C(),B(a.$$.fragment),l=C(),B(u.$$.fragment),f=C(),B(m.$$.fragment)},m(c,h){D(e,c,h),k(c,t,h),D(n,c,h),k(c,i,h),D(o,c,h),k(c,s,h),D(a,c,h),k(c,l,h),D(u,c,h),k(c,f,h),D(m,c,h),p=!0},p(c,h){const b={};h&32&&(b.boundaryGeojson=c[5]),e.$set(b);const g={};h&4&&(g.schema=c[2]),n.$set(g);const y={};h&8&&(y.routeSnapperUrl=c[3]),h&4&&(y.schema=c[2]),a.$set(y);const d={};h&4&&(d.schema=c[2]),m.$set(d)},i(c){p||(L(e.$$.fragment,c),L(n.$$.fragment,c),L(o.$$.fragment,c),L(a.$$.fragment,c),L(u.$$.fragment,c),L(m.$$.fragment,c),p=!0)},o(c){A(e.$$.fragment,c),A(n.$$.fragment,c),A(o.$$.fragment,c),A(a.$$.fragment,c),A(u.$$.fragment,c),A(m.$$.fragment,c),p=!1},d(c){j(e,c),c&&S(t),j(n,c),c&&S(i),j(o,c),c&&S(s),j(a,c),c&&S(l),j(u,c),c&&S(f),j(m,c)}}}function wu(r){let e,t,n;return t=new Go({props:{style:r[7],$$slots:{default:[yu]},$$scope:{ctx:r}}}),{c(){e=M("div"),B(t.$$.fragment),O(e,"slot","main")},m(i,o){k(i,e,o),D(t,e,null),n=!0},p(i,o){const s={};o&524332&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(L(t.$$.fragment,i),n=!0)},o(i){A(t.$$.fragment,i),n=!1},d(i){i&&S(e),j(t)}}}function ku(r){let e,t,n,i,o,s,a,l;e=new Xo({props:{$$slots:{main:[wu],sidebar:[vu],nav:[bu]},$$scope:{ctx:r}}});function u(c){r[13](c)}let f={};r[0]!==void 0&&(f.open=r[0]),n=new co({props:f}),le.push(()=>Ee(n,"open",u,r[0]));function m(c){r[14](c)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new Do({props:p}),le.push(()=>Ee(s,"open",m,r[1])),{c(){B(e.$$.fragment),t=C(),B(n.$$.fragment),o=C(),B(s.$$.fragment)},m(c,h){D(e,c,h),k(c,t,h),D(n,c,h),k(c,o,h),D(s,c,h),l=!0},p(c,[h]){const b={};h&524348&&(b.$$scope={dirty:h,ctx:c}),e.$set(b);const g={};!i&&h&1&&(i=!0,g.open=c[0],Me(()=>i=!1)),n.$set(g);const y={};!a&&h&2&&(a=!0,y.open=c[1],Me(()=>a=!1)),s.$set(y)},i(c){l||(L(e.$$.fragment,c),L(n.$$.fragment,c),L(s.$$.fragment,c),l=!0)},o(c){A(e.$$.fragment,c),A(n.$$.fragment,c),A(s.$$.fragment,c),l=!1},d(c){j(e,c),c&&S(t),j(n,c),c&&S(o),j(s,c)}}}function Su(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var f=`https://atip.uk/route-snappers/${a}.bin`,m=`https://atip.uk/route-info/${a}.bin`;o||(f=`https://atip.uk/route-snappers-dev/${a}.bin`,m=`https://atip.uk/route-info-dev/${a}.bin`);let p;function c(){t(0,n=!n),t(1,i=!1)}function h(){t(1,i=!i),t(0,n=!1)}let b;Zn(async()=>{t(5,b=await g());const $=_i(new Lo);t(4,p=await new $),await p.loadFile(m)});async function g(){const F=await(await fetch(po)).text(),R=JSON.parse(F);return R.features=R.features.filter(P=>{var T;return((T=P.properties)==null?void 0:T.name)==a}),R}function y(){let $=new URLSearchParams(window.location.search);$.set("schema",u);let F=`${window.location.pathname}?${$.toString()}${window.location.hash}`;window.location.href=F}const d=()=>window.open("index.html");function _(){u=ci(this),t(2,u)}function v($){n=$,t(0,n)}function w($){i=$,t(1,i)}return[n,i,u,f,p,b,a,l,c,h,y,d,_,v,w]}class Eu extends Q{constructor(e){super(),ee(this,e,Su,ku,Z,{})}}new Eu({target:document.getElementById("app")});
