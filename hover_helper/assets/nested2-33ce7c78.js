import{S as q,i as J,s as W,g as b,f as E,e as O,u as M,m as k,j as v,k as C,T as G,t as d,l as _,p as w,q as T,Z as Q,a1 as ae,r as Be,b as ee,c as te,F as Ut,o as re,a as we,h as R,v as Ze,w as Mt,I as pe,C as de,aV as rt,a0 as Ct,G as Bt,K as Et,L as At,M as zt,aU as fe,a6 as Ot,x as Pt,D as nt,ay as Nt,aW as He,af as st,d as It,W as Re,y as he,n as ge,z as Ft,A as jt,a8 as Vt,aO as Zt,E as Ht,U as Ke,V as Rt,ac as Kt}from"./data_getter-dd3bf3bc.js";import{C as Ee,S as Ue,d as ot,j as it,H as lt,h as xt,i as xe,g as at,L as Gt,Z as qt,M as Jt,I as Wt,b as Yt,B as Qt}from"./Map-93a693de.js";function Xt(r){let e=new Map;for(let[t,s]of Object.entries(r.schemes))e.set(t,{scheme_reference:t,num_features:0,authority_or_region:s.authority_or_region,capital_scheme_id:s.capital_scheme_id,funding_programme:s.funding_programme});let n=1;for(let t of r.features){let s=e.get(t.properties.scheme_reference);s.num_features++,t.properties.funding_programme=s.funding_programme,t.id=n++}return e}function er(r){let e;return{c(){e=M("Clear")},m(n,t){v(n,e,t)},d(n){n&&w(e)}}}function tr(r){let e,n,t,s,o,l;return t=new we({props:{$$slots:{default:[er]},$$scope:{ctx:r}}}),t.$on("click",r[11]),{c(){e=O("input"),n=E(),b(t.$$.fragment),R(e,"type","text"),R(e,"class","govuk-input govuk-input--width-10"),R(e,"id","filterText")},m(a,i){v(a,e,i),Ze(e,r[0]),v(a,n,i),k(t,a,i),s=!0,o||(l=Mt(e,"input",r[10]),o=!0)},p(a,i){i&1&&e.value!==a[0]&&Ze(e,a[0]);const u={};i&16384&&(u.$$scope={dirty:i,ctx:a}),t.$set(u)},i(a){s||(d(t.$$.fragment,a),s=!0)},o(a){_(t.$$.fragment,a),s=!1},d(a){a&&(w(e),w(n)),T(t,a),o=!1,l()}}}function rr(r){let e,n,t,s,o,l,a,i;function u(m){r[8](m)}let f={label:"Authority or region",id:"filterAuthority",choices:r[4],emptyOption:!0};r[2]!==void 0&&(f.value=r[2]),e=new Ue({props:f}),ee.push(()=>te(e,"value",u));function c(m){r[9](m)}let p={label:"Funding programme",id:"filterFundingProgramme",choices:r[5],emptyOption:!0};return r[3]!==void 0&&(p.value=r[3]),s=new Ue({props:p}),ee.push(()=>te(s,"value",c)),a=new Ut({props:{label:"Intervention name or description",id:"filterText",$$slots:{default:[tr]},$$scope:{ctx:r}}}),{c(){b(e.$$.fragment),t=E(),b(s.$$.fragment),l=E(),b(a.$$.fragment)},m(m,g){k(e,m,g),v(m,t,g),k(s,m,g),v(m,l,g),k(a,m,g),i=!0},p(m,g){const y={};g&16&&(y.choices=m[4]),!n&&g&4&&(n=!0,y.value=m[2],re(()=>n=!1)),e.$set(y);const S={};g&32&&(S.choices=m[5]),!o&&g&8&&(o=!0,S.value=m[3],re(()=>o=!1)),s.$set(S);const h={};g&16385&&(h.$$scope={dirty:g,ctx:m}),a.$set(h)},i(m){i||(d(e.$$.fragment,m),d(s.$$.fragment,m),d(a.$$.fragment,m),i=!0)},o(m){_(e.$$.fragment,m),_(s.$$.fragment,m),_(a.$$.fragment,m),i=!1},d(m){m&&(w(t),w(l)),T(e,m),T(s,m),T(a,m)}}}function nr(r){let e,n,t,s,o=r[1].size+"",l,a,i=r[6].route+"",u,f,c=r[6].area+"",p,m,g=r[6].crossing+"",y,S,h=r[6].other+"",$,L,U;return e=new Ee({props:{label:"Filters",$$slots:{default:[rr]},$$scope:{ctx:r}}}),{c(){b(e.$$.fragment),n=E(),t=O("p"),s=M("Showing "),l=M(o),a=M(" schemes ("),u=M(i),f=M(" routes, "),p=M(c),m=M(` areas,
  `),y=M(g),S=M(" crossings, "),$=M(h),L=M(" other)")},m(D,B){k(e,D,B),v(D,n,B),v(D,t,B),C(t,s),C(t,l),C(t,a),C(t,u),C(t,f),C(t,p),C(t,m),C(t,y),C(t,S),C(t,$),C(t,L),U=!0},p(D,[B]){const z={};B&16445&&(z.$$scope={dirty:B,ctx:D}),e.$set(z),(!U||B&2)&&o!==(o=D[1].size+"")&&G(l,o),(!U||B&64)&&i!==(i=D[6].route+"")&&G(u,i),(!U||B&64)&&c!==(c=D[6].area+"")&&G(p,c),(!U||B&64)&&g!==(g=D[6].crossing+"")&&G(y,g),(!U||B&64)&&h!==(h=D[6].other+"")&&G($,h)},i(D){U||(d(e.$$.fragment,D),U=!0)},o(D){_(e.$$.fragment,D),U=!1},d(D){D&&(w(n),w(t)),T(e,D)}}}function sr(r,e,n){let t;Q(r,ae,h=>n(12,t=h));let{schemes:s}=e,{schemesToBeShown:o=new Set}=e,{filterText:l=""}=e,a=[],i="",u=[],f="",c={area:0,route:0,crossing:0,other:0};Be(()=>{let h=new Set,$=new Set;for(let L of s.values())L.authority_or_region&&h.add(L.authority_or_region),L.funding_programme&&$.add(L.funding_programme);n(4,a=Array.from(h.entries())),a.sort(),n(5,u=Array.from($.entries())),u.sort()});function p(h,$,L){let U=h.toLowerCase(),D=z=>{var P,K;if(U&&!((P=z.properties.name)!=null&&P.toLowerCase().includes(U))&&!((K=z.properties.description)!=null&&K.toLowerCase().includes(U)))return!1;if($||L){let N=s.get(z.properties.scheme_reference);if($&&N.authority_or_region!=$||L&&N.funding_programme!=L)return!1}return!0};n(1,o=new Set(t.features.filter(D).map(z=>z.properties.scheme_reference))),n(6,c={area:0,route:0,crossing:0,other:0});let B=z=>{var P,K;return!(!o.has(z.properties.scheme_reference)||U&&!((P=z.properties.name)!=null&&P.toLowerCase().includes(U))&&!((K=z.properties.description)!=null&&K.toLowerCase().includes(U)))};ae.update(z=>{for(let P of z.features)B(P)?(delete P.properties.hide_while_editing,n(6,c[P.properties.intervention_type]++,c)):P.properties.hide_while_editing=!0;return z}),n(6,c)}function m(h){i=h,n(2,i)}function g(h){f=h,n(3,f)}function y(){l=this.value,n(0,l)}const S=()=>n(0,l="");return r.$$set=h=>{"schemes"in h&&n(7,s=h.schemes),"schemesToBeShown"in h&&n(1,o=h.schemesToBeShown),"filterText"in h&&n(0,l=h.filterText)},r.$$.update=()=>{r.$$.dirty&13&&p(l,i,f)},[l,o,i,f,a,u,c,s,m,g,y,S]}class or extends q{constructor(e){super(),J(this,e,sr,nr,W,{schemes:7,schemesToBeShown:1,filterText:0})}}const Y={schools:"#007DBB",hospitals:"#B73D25",mrn:"#006478",atf2:"#00AFFF",atf3:"#FF62DC",atf4:"#FFD833"};function ir(r){let e,n,t,s;return e=new it({props:{color:r[3]}}),{c(){b(e.$$.fragment),n=E(),t=M(r[1])},m(o,l){k(e,o,l),v(o,n,l),v(o,t,l),s=!0},p(o,l){(!s||l&2)&&G(t,o[1])},i(o){s||(d(e.$$.fragment,o),s=!0)},o(o){_(e.$$.fragment,o),s=!1},d(o){o&&(w(n),w(t)),T(e,o)}}}function lr(r){let e;const n=r[6].default,t=Bt(n,r,r[8],null);return{c(){t&&t.c()},m(s,o){t&&t.m(s,o),e=!0},p(s,o){t&&t.p&&(!e||o&256)&&Et(t,n,s,s[8],e?zt(n,s[8],o,null):At(s[8]),null)},i(s){e||(d(t,s),e=!0)},o(s){_(t,s),e=!1},d(s){t&&t.d(s)}}}function ar(r){let e,n,t;return n=new lt({props:{$$slots:{default:[lr]},$$scope:{ctx:r}}}),{c(){e=O("span"),b(n.$$.fragment),R(e,"slot","right")},m(s,o){v(s,e,o),k(n,e,null),t=!0},p(s,o){const l={};o&256&&(l.$$scope={dirty:o,ctx:s}),n.$set(l)},i(s){t||(d(n.$$.fragment,s),t=!0)},o(s){_(n.$$.fragment,s),t=!1},d(s){s&&w(e),T(n)}}}function fr(r){let e,n,t,s,o;function l(i){r[7](i)}let a={id:r[0],$$slots:{right:[ar],default:[ir]},$$scope:{ctx:r}};return r[2]!==void 0&&(a.checked=r[2]),e=new ot({props:a}),ee.push(()=>te(e,"checked",l)),s=new pe({props:{layer:r[0],tooltip:r[4],show:r[2]}}),{c(){b(e.$$.fragment),t=E(),b(s.$$.fragment)},m(i,u){k(e,i,u),v(i,t,u),k(s,i,u),o=!0},p(i,[u]){const f={};u&1&&(f.id=i[0]),u&258&&(f.$$scope={dirty:u,ctx:i}),!n&&u&4&&(n=!0,f.checked=i[2],re(()=>n=!1)),e.$set(f);const c={};u&1&&(c.layer=i[0]),u&4&&(c.show=i[2]),s.$set(c)},i(i){o||(d(e.$$.fragment,i),d(s.$$.fragment,i),o=!0)},o(i){_(e.$$.fragment,i),_(s.$$.fragment,i),o=!1},d(i){i&&w(t),T(e,i),T(s,i)}}}function ur(r,e,n){let t;Q(r,de,m=>n(9,t=m));let{$$slots:s={},$$scope:o}=e,{name:l}=e,{singularNoun:a}=e,{pluralNoun:i}=e,u=Y[l];rt(t,l,`https://atip.uk/layers/v1/${l}.pmtiles`),Ct(t,{id:l,source:l,sourceLayer:l,color:u,opacity:.8});let f=!1;function c(m){return`<p>${m.properties.name??`Unnamed ${a}`}</p>`}function p(m){f=m,n(2,f)}return r.$$set=m=>{"name"in m&&n(0,l=m.name),"singularNoun"in m&&n(5,a=m.singularNoun),"pluralNoun"in m&&n(1,i=m.pluralNoun),"$$scope"in m&&n(8,o=m.$$scope)},[l,i,f,u,c,a,s,p,o]}class ft extends q{constructor(e){super(),J(this,e,ur,fr,W,{name:0,singularNoun:5,pluralNoun:1})}}function cr(r){let e;return{c(){e=M("hospital")},m(n,t){v(n,e,t)},d(n){n&&w(e)}}}function mr(r){let e;return{c(){e=M("Open Data Commons Open Database License")},m(n,t){v(n,e,t)},d(n){n&&w(e)}}}function pr(r){let e,n,t,s,o,l,a,i,u;return t=new fe({props:{href:"https://wiki.openstreetmap.org/wiki/Tag:amenity%3Dhospital",$$slots:{default:[cr]},$$scope:{ctx:r}}}),i=new fe({props:{href:"https://www.openstreetmap.org/copyright",$$slots:{default:[mr]},$$scope:{ctx:r}}}),{c(){e=O("p"),n=M("This shows "),b(t.$$.fragment),s=M(` data from OpenStreetMap. It doesn't include outpatient clinics
    or individual doctor's offices.`),o=E(),l=O("p"),a=M("License: "),b(i.$$.fragment)},m(f,c){v(f,e,c),C(e,n),k(t,e,null),C(e,s),v(f,o,c),v(f,l,c),C(l,a),k(i,l,null),u=!0},p(f,c){const p={};c&1&&(p.$$scope={dirty:c,ctx:f}),t.$set(p);const m={};c&1&&(m.$$scope={dirty:c,ctx:f}),i.$set(m)},i(f){u||(d(t.$$.fragment,f),d(i.$$.fragment,f),u=!0)},o(f){_(t.$$.fragment,f),_(i.$$.fragment,f),u=!1},d(f){f&&(w(e),w(o),w(l)),T(t),T(i)}}}function hr(r){let e,n;return e=new ft({props:{name:"hospitals",singularNoun:"hospital",pluralNoun:"Hospitals",$$slots:{default:[pr]},$$scope:{ctx:r}}}),{c(){b(e.$$.fragment)},m(t,s){k(e,t,s),n=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){T(e,t)}}}class gr extends q{constructor(e){super(),J(this,e,null,hr,W,{})}}function $r(r){let e,n,t;return e=new it({props:{color:r[1]}}),{c(){b(e.$$.fragment),n=M(`
  MRN`)},m(s,o){k(e,s,o),v(s,n,o),t=!0},p:Pt,i(s){t||(d(e.$$.fragment,s),t=!0)},o(s){_(e.$$.fragment,s),t=!1},d(s){s&&w(n),T(e,s)}}}function dr(r){let e;return{c(){e=M(`Major Road Network
        `)},m(n,t){v(n,e,t)},d(n){n&&w(e)}}}function _r(r){let e;return{c(){e=M("Open Government License")},m(n,t){v(n,e,t)},d(n){n&&w(e)}}}function vr(r){let e,n,t,s,o,l,a,i,u;return t=new fe({props:{href:"https://maps.dft.gov.uk/major-road-network/index.html",$$slots:{default:[dr]},$$scope:{ctx:r}}}),i=new fe({props:{href:"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/",$$slots:{default:[_r]},$$scope:{ctx:r}}}),{c(){e=O("p"),n=M("Data from the "),b(t.$$.fragment),s=M("."),o=E(),l=O("p"),a=M("License: "),b(i.$$.fragment)},m(f,c){v(f,e,c),C(e,n),k(t,e,null),C(e,s),v(f,o,c),v(f,l,c),C(l,a),k(i,l,null),u=!0},p(f,c){const p={};c&16&&(p.$$scope={dirty:c,ctx:f}),t.$set(p);const m={};c&16&&(m.$$scope={dirty:c,ctx:f}),i.$set(m)},i(f){u||(d(t.$$.fragment,f),d(i.$$.fragment,f),u=!0)},o(f){_(t.$$.fragment,f),_(i.$$.fragment,f),u=!1},d(f){f&&(w(e),w(o),w(l)),T(t),T(i)}}}function wr(r){let e,n,t;return n=new lt({props:{$$slots:{default:[vr]},$$scope:{ctx:r}}}),{c(){e=O("span"),b(n.$$.fragment),R(e,"slot","right")},m(s,o){v(s,e,o),k(n,e,null),t=!0},p(s,o){const l={};o&16&&(l.$$scope={dirty:o,ctx:s}),n.$set(l)},i(s){t||(d(n.$$.fragment,s),t=!0)},o(s){_(n.$$.fragment,s),t=!1},d(s){s&&w(e),T(n)}}}function yr(r){let e,n,t,s,o;function l(i){r[2](i)}let a={id:X,$$slots:{right:[wr],default:[$r]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.checked=r[0]),e=new ot({props:a}),ee.push(()=>te(e,"checked",l)),s=new pe({props:{layer:X,tooltip:br,show:r[0]}}),{c(){b(e.$$.fragment),t=E(),b(s.$$.fragment)},m(i,u){k(e,i,u),v(i,t,u),k(s,i,u),o=!0},p(i,[u]){const f={};u&16&&(f.$$scope={dirty:u,ctx:i}),!n&&u&1&&(n=!0,f.checked=i[0],re(()=>n=!1)),e.$set(f);const c={};u&1&&(c.show=i[0]),s.$set(c)},i(i){o||(d(e.$$.fragment,i),d(s.$$.fragment,i),o=!0)},o(i){_(e.$$.fragment,i),_(s.$$.fragment,i),o=!1},d(i){i&&w(t),T(e,i),T(s,i)}}}let X="mrn";function br(r){return`<p>${r.properties.name??"Unknown MRN road"}</p>`}function kr(r,e,n){let t;Q(r,de,a=>n(3,t=a));let s=Y.mrn;rt(t,X,`https://atip.uk/layers/v1/${X}.pmtiles`),Ot(t,{id:X,source:X,sourceLayer:X,color:s,width:7});let o=!1;function l(a){o=a,n(0,o)}return[o,s,l]}class Tr extends q{constructor(e){super(),J(this,e,kr,yr,W,{})}}function Lr(r){let e;return{c(){e=M("Show on map")},m(n,t){v(n,e,t)},d(n){n&&w(e)}}}function Dr(r){let e;return{c(){e=M("Edit scheme locally")},m(n,t){v(n,e,t)},d(n){n&&w(e)}}}function Sr(r){let e,n,t=r[0].authority_or_region+"",s,o,l,a,i=r[0].capital_scheme_id+"",u,f,c,p,m=r[0].funding_programme+"",g,y,S,h,$,L,U;return h=new we({props:{$$slots:{default:[Lr]},$$scope:{ctx:r}}}),h.$on("click",r[3]),L=new we({props:{disabled:r[1],title:r[2],$$slots:{default:[Dr]},$$scope:{ctx:r}}}),L.$on("click",r[4]),{c(){e=O("p"),n=M("Authority or region: "),s=M(t),o=E(),l=O("p"),a=M("Capital scheme ID: "),u=M(i),f=E(),c=O("p"),p=M("Funding programme: "),g=M(m),y=E(),S=O("div"),b(h.$$.fragment),$=E(),b(L.$$.fragment),R(S,"class","govuk-button-group")},m(D,B){v(D,e,B),C(e,n),C(e,s),v(D,o,B),v(D,l,B),C(l,a),C(l,u),v(D,f,B),v(D,c,B),C(c,p),C(c,g),v(D,y,B),v(D,S,B),k(h,S,null),C(S,$),k(L,S,null),U=!0},p(D,B){(!U||B&1)&&t!==(t=D[0].authority_or_region+"")&&G(s,t),(!U||B&1)&&i!==(i=D[0].capital_scheme_id+"")&&G(u,i),(!U||B&1)&&m!==(m=D[0].funding_programme+"")&&G(g,m);const z={};B&256&&(z.$$scope={dirty:B,ctx:D}),h.$set(z);const P={};B&256&&(P.$$scope={dirty:B,ctx:D}),L.$set(P)},i(D){U||(d(h.$$.fragment,D),d(L.$$.fragment,D),U=!0)},o(D){_(h.$$.fragment,D),_(L.$$.fragment,D),U=!1},d(D){D&&(w(e),w(o),w(l),w(f),w(c),w(y),w(S)),T(h),T(L)}}}function Ur(r){let e,n;return e=new Ee({props:{label:`${r[0].scheme_reference}: ${r[0].num_features} features`,$$slots:{default:[Sr]},$$scope:{ctx:r}}}),{c(){b(e.$$.fragment)},m(t,s){k(e,t,s),n=!0},p(t,[s]){const o={};s&1&&(o.label=`${t[0].scheme_reference}: ${t[0].num_features} features`),s&257&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){T(e,t)}}}function Mr(r,e,n){let t,s;Q(r,ae,c=>n(6,t=c)),Q(r,de,c=>n(7,s=c));let{scheme:o}=e,{authorityNames:l}=e,a=!l.has(o.authority_or_region),i=a?"This scheme doesn't have an authority specified correctly, so you can't edit this scheme. We're working to fix this problem.":void 0;function u(){let c={type:"FeatureCollection",features:t.features.filter(p=>p.properties.scheme_reference==o.scheme_reference)};s==null||s.fitBounds(nt(c),{padding:20,animate:!1})}function f(){let c={type:"FeatureCollection",features:t.features.filter(m=>m.properties.scheme_reference==o.scheme_reference)},p=o.authority_or_region;window.localStorage.setItem(p,JSON.stringify(c)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return r.$$set=c=>{"scheme"in c&&n(0,o=c.scheme),"authorityNames"in c&&n(5,l=c.authorityNames)},[o,a,i,u,f,l]}class Cr extends q{constructor(e){super(),J(this,e,Mr,Ur,W,{scheme:0,authorityNames:5})}}function Br(r){let e;return{c(){e=M("primary and secondary schools")},m(n,t){v(n,e,t)},d(n){n&&w(e)}}}function Er(r){let e;return{c(){e=M("Open Data Commons Open Database License")},m(n,t){v(n,e,t)},d(n){n&&w(e)}}}function Ar(r){let e,n,t,s,o,l,a,i,u;return t=new fe({props:{href:"https://wiki.openstreetmap.org/wiki/Tag:amenity%3Dschool",$$slots:{default:[Br]},$$scope:{ctx:r}}}),i=new fe({props:{href:"https://www.openstreetmap.org/copyright",$$slots:{default:[Er]},$$scope:{ctx:r}}}),{c(){e=O("p"),n=M("This shows "),b(t.$$.fragment),s=M(` from OpenStreetMap. It doesn't include kindergartens, colleges,
    universities, or other training schools.`),o=E(),l=O("p"),a=M("License: "),b(i.$$.fragment)},m(f,c){v(f,e,c),C(e,n),k(t,e,null),C(e,s),v(f,o,c),v(f,l,c),C(l,a),k(i,l,null),u=!0},p(f,c){const p={};c&1&&(p.$$scope={dirty:c,ctx:f}),t.$set(p);const m={};c&1&&(m.$$scope={dirty:c,ctx:f}),i.$set(m)},i(f){u||(d(t.$$.fragment,f),d(i.$$.fragment,f),u=!0)},o(f){_(t.$$.fragment,f),_(i.$$.fragment,f),u=!1},d(f){f&&(w(e),w(o),w(l)),T(t),T(i)}}}function zr(r){let e,n;return e=new ft({props:{name:"schools",singularNoun:"school",pluralNoun:"Schools",$$slots:{default:[Ar]},$$scope:{ctx:r}}}),{c(){b(e.$$.fragment)},m(t,s){k(e,t,s),n=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){T(e,t)}}}class Or extends q{constructor(e){super(),J(this,e,null,zr,W,{})}}function Pr(r){let e,n,t,s,o;function l(i){r[3](i)}let a={label:"Color interventions",id:"colorInterventions",choices:[["interventionType","By intervention type"],["fundingProgramme","By funding programme"]]};return r[0]!==void 0&&(a.value=r[0]),e=new Ue({props:a}),ee.push(()=>te(e,"value",l)),e.$on("change",r[2]),s=new xt({props:{rows:r[1]}}),{c(){b(e.$$.fragment),t=E(),b(s.$$.fragment)},m(i,u){k(e,i,u),v(i,t,u),k(s,i,u),o=!0},p(i,[u]){const f={};!n&&u&1&&(n=!0,f.value=i[0],re(()=>n=!1)),e.$set(f);const c={};u&2&&(c.rows=i[1]),s.$set(c)},i(i){o||(d(e.$$.fragment,i),d(s.$$.fragment,i),o=!0)},o(i){_(e.$$.fragment,i),_(s.$$.fragment,i),o=!1},d(i){i&&w(t),T(e,i),T(s,i)}}}function Nr(r,e,n){let t;Q(r,de,i=>n(4,t=i));let s="interventionType",o=xe("v1");function l(){let i;s=="interventionType"?(i=at("v1"),n(1,o=xe("v1"))):(i=Nt(["get","funding_programme"],{ATF2:Y.atf2,ATF3:Y.atf3,ATF4:Y.atf4},"grey"),n(1,o=[["ATF2",Y.atf2],["ATF3",Y.atf3],["ATF4",Y.atf4]])),t.setPaintProperty("interventions-points","circle-color",i),t.setPaintProperty("interventions-lines","line-color",i),t.setPaintProperty("interventions-polygons","fill-color",i),t.setPaintProperty("interventions-polygon-outlines","line-color",i)}function a(i){s=i,n(0,s)}return[s,o,l,a]}class Ir extends q{constructor(e){super(),J(this,e,Nr,Pr,W,{})}}var I=(r,e,n)=>new Promise((t,s)=>{var o=i=>{try{a(n.next(i))}catch(u){s(u)}},l=i=>{try{a(n.throw(i))}catch(u){s(u)}},a=i=>i.done?t(i.value):Promise.resolve(i.value).then(o,l);a((n=n.apply(r,e)).next())}),j=Uint8Array,ie=Uint16Array,Fr=Int32Array,ut=new j([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ct=new j([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),jr=new j([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mt=function(r,e){for(var n=new ie(31),t=0;t<31;++t)n[t]=e+=1<<r[t-1];for(var s=new Fr(n[30]),t=1;t<30;++t)for(var o=n[t];o<n[t+1];++o)s[o]=o-n[t]<<5|t;return{b:n,r:s}},pt=mt(ut,2),ht=pt.b,Vr=pt.r;ht[28]=258,Vr[258]=28;var Zr=mt(ct,0),Hr=Zr.b,Me=new ie(32768);for(A=0;A<32768;++A)x=(A&43690)>>1|(A&21845)<<1,x=(x&52428)>>2|(x&13107)<<2,x=(x&61680)>>4|(x&3855)<<4,Me[A]=((x&65280)>>8|(x&255)<<8)>>1;var x,A,$e=function(r,e,n){for(var t=r.length,s=0,o=new ie(e);s<t;++s)r[s]&&++o[r[s]-1];var l=new ie(e);for(s=1;s<e;++s)l[s]=l[s-1]+o[s-1]<<1;var a;if(n){a=new ie(1<<e);var i=15-e;for(s=0;s<t;++s)if(r[s])for(var u=s<<4|r[s],f=e-r[s],c=l[r[s]-1]++<<f,p=c|(1<<f)-1;c<=p;++c)a[Me[c]>>i]=u}else for(a=new ie(t),s=0;s<t;++s)r[s]&&(a[s]=Me[l[r[s]-1]++]>>15-r[s]);return a},_e=new j(288);for(A=0;A<144;++A)_e[A]=8;var A;for(A=144;A<256;++A)_e[A]=9;var A;for(A=256;A<280;++A)_e[A]=7;var A;for(A=280;A<288;++A)_e[A]=8;var A,gt=new j(32);for(A=0;A<32;++A)gt[A]=5;var A,Rr=$e(_e,9,1),Kr=$e(gt,5,1),De=function(r){for(var e=r[0],n=1;n<r.length;++n)r[n]>e&&(e=r[n]);return e},Z=function(r,e,n){var t=e/8|0;return(r[t]|r[t+1]<<8)>>(e&7)&n},Se=function(r,e){var n=e/8|0;return(r[n]|r[n+1]<<8|r[n+2]<<16)>>(e&7)},xr=function(r){return(r+7)/8|0},Gr=function(r,e,n){(e==null||e<0)&&(e=0),(n==null||n>r.length)&&(n=r.length);var t=new j(n-e);return t.set(r.subarray(e,n)),t},qr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],F=function(r,e,n){var t=new Error(e||qr[r]);if(t.code=r,Error.captureStackTrace&&Error.captureStackTrace(t,F),!n)throw t;return t},Ae=function(r,e,n,t){var s=r.length,o=t?t.length:0;if(!s||e.f&&!e.l)return n||new j(0);var l=!n||e.i!=2,a=e.i;n||(n=new j(s*3));var i=function(Fe){var je=n.length;if(Fe>je){var Ve=new j(Math.max(je*2,Fe));Ve.set(n),n=Ve}},u=e.f||0,f=e.p||0,c=e.b||0,p=e.l,m=e.d,g=e.m,y=e.n,S=s*8;do{if(!p){u=Z(r,f,1);var h=Z(r,f+1,3);if(f+=3,h)if(h==1)p=Rr,m=Kr,g=9,y=5;else if(h==2){var D=Z(r,f,31)+257,B=Z(r,f+10,15)+4,z=D+Z(r,f+5,31)+1;f+=14;for(var P=new j(z),K=new j(19),N=0;N<B;++N)K[jr[N]]=Z(r,f+N*3,7);f+=B*3;for(var ze=De(K),kt=(1<<ze)-1,Tt=$e(K,ze,1),N=0;N<z;){var Oe=Tt[Z(r,f,kt)];f+=Oe&15;var $=Oe>>4;if($<16)P[N++]=$;else{var ne=0,ve=0;for($==16?(ve=3+Z(r,f,3),f+=2,ne=P[N-1]):$==17?(ve=3+Z(r,f,7),f+=3):$==18&&(ve=11+Z(r,f,127),f+=7);ve--;)P[N++]=ne}}var Pe=P.subarray(0,D),V=P.subarray(D);g=De(Pe),y=De(V),p=$e(Pe,g,1),m=$e(V,y,1)}else F(1);else{var $=xr(f)+4,L=r[$-4]|r[$-3]<<8,U=$+L;if(U>s){a&&F(0);break}l&&i(c+L),n.set(r.subarray($,U),c),e.b=c+=L,e.p=f=U*8,e.f=u;continue}if(f>S){a&&F(0);break}}l&&i(c+131072);for(var Lt=(1<<g)-1,Dt=(1<<y)-1,be=f;;be=f){var ne=p[Se(r,f)&Lt],se=ne>>4;if(f+=ne&15,f>S){a&&F(0);break}if(ne||F(2),se<256)n[c++]=se;else if(se==256){be=f,p=null;break}else{var Ne=se-254;if(se>264){var N=se-257,ue=ut[N];Ne=Z(r,f,(1<<ue)-1)+ht[N],f+=ue}var ke=m[Se(r,f)&Dt],Te=ke>>4;ke||F(3),f+=ke&15;var V=Hr[Te];if(Te>3){var ue=ct[Te];V+=Se(r,f)&(1<<ue)-1,f+=ue}if(f>S){a&&F(0);break}l&&i(c+131072);var Le=c+Ne;if(c<V){var Ie=o-V,St=Math.min(V,Le);for(Ie+c<0&&F(3);c<St;++c)n[c]=t[Ie+c]}for(;c<Le;c+=4)n[c]=n[c-V],n[c+1]=n[c+1-V],n[c+2]=n[c+2-V],n[c+3]=n[c+3-V];c=Le}}e.l=p,e.p=be,e.b=c,e.f=u,p&&(u=1,e.m=g,e.d=m,e.n=y)}while(!u);return c==n.length?n:Gr(n,0,c)},Jr=new j(0),Wr=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&F(6,"invalid gzip data");var e=r[3],n=10;e&4&&(n+=(r[10]|r[11]<<8)+2);for(var t=(e>>3&1)+(e>>4&1);t>0;t-=!r[n++]);return n+(e&2)},Yr=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},Qr=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&F(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&F(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function Xr(r,e){return Ae(r,{i:2},e&&e.out,e&&e.dictionary)}function en(r,e){var n=Wr(r);return n+8>r.length&&F(6,"invalid gzip data"),Ae(r.subarray(n,-8),{i:2},e&&e.out||new j(Yr(r)),e&&e.dictionary)}function tn(r,e){return Ae(r.subarray(Qr(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Ce(r,e){return r[0]==31&&r[1]==139&&r[2]==8?en(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Xr(r,e):tn(r,e)}var rn=typeof TextDecoder<"u"&&new TextDecoder,nn=0;try{rn.decode(Jr,{stream:!0}),nn=1}catch{}var $t=(r,e)=>r*Math.pow(2,e),ce=(r,e)=>Math.floor(r/Math.pow(2,e)),ye=(r,e)=>$t(r.getUint16(e+1,!0),8)+r.getUint8(e),dt=(r,e)=>$t(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),sn=(r,e,n,t,s)=>{if(r!=t.getUint8(s))return r-t.getUint8(s);const o=ye(t,s+1);if(e!=o)return e-o;const l=ye(t,s+4);return n!=l?n-l:0},on=(r,e,n,t)=>{const s=_t(r,e|128,n,t);return s?{z:e,x:n,y:t,offset:s[0],length:s[1],is_dir:!0}:null},Ge=(r,e,n,t)=>{const s=_t(r,e,n,t);return s?{z:e,x:n,y:t,offset:s[0],length:s[1],is_dir:!1}:null},_t=(r,e,n,t)=>{let s=0,o=r.byteLength/17-1;for(;s<=o;){const l=o+s>>1,a=sn(e,n,t,r,l*17);if(a>0)s=l+1;else if(a<0)o=l-1;else return[dt(r,l*17+7),r.getUint32(l*17+13,!0)]}return null},ln=(r,e)=>r.is_dir&&!e.is_dir?1:!r.is_dir&&e.is_dir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,vt=(r,e)=>{const n=r.getUint8(e*17);return{z:n&127,x:ye(r,e*17+1),y:ye(r,e*17+4),offset:dt(r,e*17+7),length:r.getUint32(e*17+13,!0),is_dir:n>>7===1}},qe=r=>{const e=[],n=new DataView(r);for(let t=0;t<n.byteLength/17;t++)e.push(vt(n,t));return an(e)},an=r=>{r.sort(ln);const e=new ArrayBuffer(17*r.length),n=new Uint8Array(e);for(let t=0;t<r.length;t++){const s=r[t];let o=s.z;s.is_dir&&(o=o|128),n[t*17]=o,n[t*17+1]=s.x&255,n[t*17+2]=s.x>>8&255,n[t*17+3]=s.x>>16&255,n[t*17+4]=s.y&255,n[t*17+5]=s.y>>8&255,n[t*17+6]=s.y>>16&255,n[t*17+7]=s.offset&255,n[t*17+8]=ce(s.offset,8)&255,n[t*17+9]=ce(s.offset,16)&255,n[t*17+10]=ce(s.offset,24)&255,n[t*17+11]=ce(s.offset,32)&255,n[t*17+12]=ce(s.offset,48)&255,n[t*17+13]=s.length&255,n[t*17+14]=s.length>>8&255,n[t*17+15]=s.length>>16&255,n[t*17+16]=s.length>>24&255}return e},fn=(r,e)=>{if(r.byteLength<17)return null;const n=r.byteLength/17,t=vt(r,n-1);if(t.is_dir){const s=t.z,o=e.z-s,l=Math.trunc(e.x/(1<<o)),a=Math.trunc(e.y/(1<<o));return{z:s,x:l,y:a}}return null};function un(r){return I(this,null,function*(){const e=yield r.getBytes(0,512e3),n=new DataView(e.data),t=n.getUint32(4,!0),s=n.getUint16(8,!0),o=new TextDecoder("utf-8"),l=JSON.parse(o.decode(new DataView(e.data,10,t)));let a=0;l.compression==="gzip"&&(a=2);let i=0;"minzoom"in l&&(i=+l.minzoom);let u=0;"maxzoom"in l&&(u=+l.maxzoom);let f=0,c=0,p=0,m=-180,g=-85,y=180,S=85;if(l.bounds){const $=l.bounds.split(",");m=+$[0],g=+$[1],y=+$[2],S=+$[3]}if(l.center){const $=l.center.split(",");f=+$[0],c=+$[1],p=+$[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+t,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:t,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:i,maxZoom:u,minLon:m,minLat:g,maxLon:y,maxLat:S,centerZoom:p,centerLon:f,centerLat:c,etag:e.etag}})}function cn(r,e,n,t,s,o,l){return I(this,null,function*(){let a=yield n.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=qe(a));const i=Ge(new DataView(a),t,s,o);if(i){let c=(yield e.getBytes(i.offset,i.length,l)).data;const p=new DataView(c);return p.getUint8(0)==31&&p.getUint8(1)==139&&(c=Ce(new Uint8Array(c))),{data:c}}const u=fn(new DataView(a),{z:t,x:s,y:o});if(u){const f=on(new DataView(a),u.z,u.x,u.y);if(f){let c=yield n.getArrayBuffer(e,f.offset,f.length,r);r.specVersion===1&&(c=qe(c));const p=Ge(new DataView(c),t,s,o);if(p){let g=(yield e.getBytes(p.offset,p.length,l)).data;const y=new DataView(g);return y.getUint8(0)==31&&y.getUint8(1)==139&&(g=Ce(new Uint8Array(g))),{data:g}}}}})}var wt={getHeader:un,getZxy:cn},mn=class{constructor(){this.tile=(r,e)=>{if(r.type=="json"){const n=r.url.substr(10);let t=this.tiles.get(n);return t||(t=new Je(n),this.tiles.set(n,t)),t.getHeader().then(s=>{const o={tiles:[r.url+"/{z}/{x}/{y}"],minzoom:s.minZoom,maxzoom:s.maxZoom,bounds:[s.minLon,s.minLat,s.maxLon,s.maxLat]};e(null,o,null,null)}).catch(s=>{e(s,null,null,null)}),{cancel:()=>{}}}else{const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),t=r.url.match(n);if(!t)throw new Error("Invalid PMTiles protocol URL");const s=t[1];let o=this.tiles.get(s);o||(o=new Je(s),this.tiles.set(s,o));const l=t[2],a=t[3],i=t[4],u=new AbortController,f=u.signal;let c=()=>{u.abort()};return o.getHeader().then(p=>{o.getZxy(+l,+a,+i,f).then(m=>{m?e(null,new Uint8Array(m.data),m.cacheControl,m.expires):p.tileType==1?e(null,new Uint8Array,null,null):e(null,null,null,null)}).catch(m=>{m.name!=="AbortError"&&e(m,null,null,null)})}),{cancel:c}}},this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function oe(r,e){return(e>>>0)*4294967296+(r>>>0)}function pn(r,e){const n=e.buf;let t,s;if(s=n[e.pos++],t=(s&112)>>4,s<128||(s=n[e.pos++],t|=(s&127)<<3,s<128)||(s=n[e.pos++],t|=(s&127)<<10,s<128)||(s=n[e.pos++],t|=(s&127)<<17,s<128)||(s=n[e.pos++],t|=(s&127)<<24,s<128)||(s=n[e.pos++],t|=(s&1)<<31,s<128))return oe(r,t);throw new Error("Expected varint not more than 10 bytes")}function me(r){const e=r.buf;let n,t;return t=e[r.pos++],n=t&127,t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,pn(n,r))}function hn(r,e,n,t){if(t==0){n==1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}var gn=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function $n(r,e,n){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,r)-1||n>Math.pow(2,r)-1)throw Error("tile x/y outside zoom level bounds");const t=gn[r],s=Math.pow(2,r);let o=0,l=0,a=0;const i=[e,n];let u=s/2;for(;u>0;)o=(i[0]&u)>0?1:0,l=(i[1]&u)>0?1:0,a+=u*u*(3*o^l),hn(u,i,o,l),u=u/2;return t+a}function yt(r,e){return I(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Ce(new Uint8Array(r));{let t=new Response(r).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(t).arrayBuffer()}}else throw Error("Compression method not supported")})}var dn=127;function _n(r,e){let n=0,t=r.length-1;for(;n<=t;){const s=t+n>>1,o=e-r[s].tileId;if(o>0)n=s+1;else if(o<0)t=s-1;else return r[s]}return t>=0&&(r[t].runLength===0||e-r[t].tileId<r[t].runLength)?r[t]:null}var vn=class{constructor(r){this.url=r}getKey(){return this.url}getBytes(r,e,n){return I(this,null,function*(){let t;n||(t=new AbortController,n=t.signal);let s=yield fetch(this.url,{signal:n,headers:{Range:"bytes="+r+"-"+(r+e-1)}});if(s.status===416&&r===0){const a=s.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const i=+a.substr(8);s=yield fetch(this.url,{signal:n,headers:{Range:"bytes=0-"+(i-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw t&&t.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function H(r,e){const n=r.getUint32(e+4,!0),t=r.getUint32(e+0,!0);return n*Math.pow(2,32)+t}function wn(r,e){const n=new DataView(r),t=n.getUint8(7);if(t>3)throw Error(`Archive is spec version ${t} but this library supports up to spec version 3`);return{specVersion:t,rootDirectoryOffset:H(n,8),rootDirectoryLength:H(n,16),jsonMetadataOffset:H(n,24),jsonMetadataLength:H(n,32),leafDirectoryOffset:H(n,40),leafDirectoryLength:H(n,48),tileDataOffset:H(n,56),tileDataLength:H(n,64),numAddressedTiles:H(n,72),numTileEntries:H(n,80),numTileContents:H(n,88),clustered:n.getUint8(96)===1,internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:e}}function bt(r){const e={buf:new Uint8Array(r),pos:0},n=me(e),t=[];let s=0;for(let o=0;o<n;o++){const l=me(e);t.push({tileId:s+l,offset:0,length:0,runLength:1}),s+=l}for(let o=0;o<n;o++)t[o].runLength=me(e);for(let o=0;o<n;o++)t[o].length=me(e);for(let o=0;o<n;o++){const l=me(e);l===0&&o>0?t[o].offset=t[o-1].offset+t[o-1].length:t[o].offset=l-1}return t}function yn(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var le=class extends Error{};function bn(r,e,n,t){return I(this,null,function*(){const s=yield r.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(yn(s.data)<3)return[yield wt.getHeader(r)];const l=s.data.slice(0,dn);let a=s.etag;t&&s.etag!=t&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+r.getKey()),a=void 0);const i=wn(l,a);if(n){const u=s.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),f=r.getKey()+"|"+(i.etag||"")+"|"+i.rootDirectoryOffset+"|"+i.rootDirectoryLength,c=bt(yield e(u,i.internalCompression));return[i,[f,c.length,c]]}return[i,void 0]})}function kn(r,e,n,t,s){return I(this,null,function*(){const o=yield r.getBytes(n,t);if(s.etag&&s.etag!==o.etag)throw new le(o.etag);const l=yield e(o.data,s.internalCompression),a=bt(l);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var Tn=class{constructor(r=100,e=!0,n=yt){this.cache=new Map,this.maxCacheEntries=r,this.counter=1,this.prefetch=e,this.decompress=n}getHeader(r,e){return I(this,null,function*(){const n=r.getKey();if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const t=new Promise((s,o)=>{bn(r,this.decompress,this.prefetch,e).then(l=>{l[1]&&this.cache.set(l[1][0],{lastUsed:this.counter++,data:Promise.resolve(l[1][2])}),s(l[0]),this.prune()}).catch(l=>{o(l)})});return this.cache.set(n,{lastUsed:this.counter++,data:t}),t})}getDirectory(r,e,n,t){return I(this,null,function*(){const s=r.getKey()+"|"+(t.etag||"")+"|"+e+"|"+n;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((l,a)=>{kn(r,this.decompress,e,n,t).then(i=>{l(i),this.prune()}).catch(i=>{a(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}getArrayBuffer(r,e,n,t){return I(this,null,function*(){const s=r.getKey()+"|"+(t.etag||"")+"|"+e+"|"+n;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((l,a)=>{r.getBytes(e,n).then(i=>{if(t.etag&&t.etag!==i.etag)throw new le(i.etag);l(i.data),this.cache.has(s),this.prune()}).catch(i=>{a(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((n,t)=>{n.lastUsed<r&&(r=n.lastUsed,e=t)}),e&&this.cache.delete(e)}}invalidate(r,e){return I(this,null,function*(){this.cache.delete(r.getKey()),yield this.getHeader(r,e)})}},Je=class{constructor(r,e,n){typeof r=="string"?this.source=new vn(r):this.source=r,n?this.decompress=n:this.decompress=yt,e?this.cache=e:this.cache=new Tn}getHeader(){return I(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,n,t){return I(this,null,function*(){const s=$n(r,e,n),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return wt.getZxy(o,this.source,this.cache,r,e,n,t);if(r<o.minZoom||r>o.maxZoom)return;let l=o.rootDirectoryOffset,a=o.rootDirectoryLength;for(let i=0;i<=3;i++){const u=yield this.cache.getDirectory(this.source,l,a,o),f=_n(u,s);if(f)if(f.runLength>0){const c=yield this.source.getBytes(o.tileDataOffset+f.offset,f.length,t);if(o.etag&&o.etag!==c.etag)throw new le(c.etag);return{data:yield this.decompress(c.data,o.tileCompression),cacheControl:c.cacheControl,expires:c.expires}}else l=o.leafDirectoryOffset+f.offset,a=f.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,n,t){return I(this,null,function*(){try{return yield this.getZxyAttempt(r,e,n,t)}catch(s){if(s instanceof le)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(r,e,n,t);throw s}})}getMetadataAttempt(){return I(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength);if(r.etag&&r.etag!==e.etag)throw new le(e.etag);const n=yield this.decompress(e.data,r.internalCompression),t=new TextDecoder("utf-8");return JSON.parse(t.decode(n))})}getMetadata(){return I(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof le)return this.cache.invalidate(this.source,r.message),yield this.getMetadataAttempt();throw r}})}};function Ln(r){return Be(()=>{let e=new mn;He.addProtocol("pmtiles",e.tile)}),st(()=>{He.removeProtocol("pmtiles")}),[]}class Dn extends q{constructor(e){super(),J(this,e,Ln,null,W,{})}}function We(r,e,n){const t=r.slice();return t[15]=e[n],t}function Sn(r){let e;return{c(){e=M("Home")},m(n,t){v(n,e,t)},d(n){n&&w(e)}}}function Ye(r){let e,n;return e=new Ht({props:{errorMessage:r[1]}}),{c(){b(e.$$.fragment)},m(t,s){k(e,t,s),n=!0},p(t,s){const o={};s&2&&(o.errorMessage=t[1]),e.$set(o)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){T(e,t)}}}function Qe(r){let e,n,t,s;function o(i){r[10](i)}function l(i){r[11](i)}let a={schemes:r[2]};return r[3]!==void 0&&(a.schemesToBeShown=r[3]),r[4]!==void 0&&(a.filterText=r[4]),e=new or({props:a}),ee.push(()=>te(e,"schemesToBeShown",o)),ee.push(()=>te(e,"filterText",l)),{c(){b(e.$$.fragment)},m(i,u){k(e,i,u),s=!0},p(i,u){const f={};u&4&&(f.schemes=i[2]),!n&&u&8&&(n=!0,f.schemesToBeShown=i[3],re(()=>n=!1)),!t&&u&16&&(t=!0,f.filterText=i[4],re(()=>t=!1)),e.$set(f)},i(i){s||(d(e.$$.fragment,i),s=!0)},o(i){_(e.$$.fragment,i),s=!1},d(i){T(e,i)}}}function Xe(r){let e,n,t=Ke(r[2].values()),s=[];for(let l=0;l<t.length;l+=1)s[l]=tt(We(r,t,l));const o=l=>_(s[l],1,1,()=>{s[l]=null});return{c(){e=O("ul");for(let l=0;l<s.length;l+=1)s[l].c()},m(l,a){v(l,e,a);for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(e,null);n=!0},p(l,a){if(a&13){t=Ke(l[2].values());let i;for(i=0;i<t.length;i+=1){const u=We(l,t,i);s[i]?(s[i].p(u,a),d(s[i],1)):(s[i]=tt(u),s[i].c(),d(s[i],1),s[i].m(e,null))}for(he(),i=t.length;i<s.length;i+=1)o(i);ge()}},i(l){if(!n){for(let a=0;a<t.length;a+=1)d(s[a]);n=!0}},o(l){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)_(s[a]);n=!1},d(l){l&&w(e),Rt(s,l)}}}function et(r){let e,n;return e=new Cr({props:{scheme:r[15],authorityNames:r[0]}}),{c(){b(e.$$.fragment)},m(t,s){k(e,t,s),n=!0},p(t,s){const o={};s&4&&(o.scheme=t[15]),s&1&&(o.authorityNames=t[0]),e.$set(o)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){T(e,t)}}}function tt(r){let e=r[3].has(r[15].scheme_reference),n,t,s=e&&et(r);return{c(){s&&s.c(),n=Kt()},m(o,l){s&&s.m(o,l),v(o,n,l),t=!0},p(o,l){l&12&&(e=o[3].has(o[15].scheme_reference)),e?s?(s.p(o,l),l&12&&d(s,1)):(s=et(o),s.c(),d(s,1),s.m(n.parentNode,n)):s&&(he(),_(s,1,1,()=>{s=null}),ge())},i(o){t||(d(s),t=!0)},o(o){_(s),t=!1},d(o){o&&w(n),s&&s.d(o)}}}function Un(r){let e,n,t,s,o,l,a,i,u,f,c,p,m;n=new we({props:{$$slots:{default:[Sn]},$$scope:{ctx:r}}}),n.$on("click",r[9]),a=new qt({props:{boundaryGeojson:r[5]}});let g=r[1]&&Ye(r);f=new It({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:r[7]}});let y=r[2].size>0&&Qe(r),S=r[0]&&Xe(r);return{c(){e=O("div"),b(n.$$.fragment),t=E(),s=O("div"),o=O("h1"),o.textContent="Browse schemes",l=E(),b(a.$$.fragment),i=E(),g&&g.c(),u=E(),b(f.$$.fragment),c=E(),y&&y.c(),p=E(),S&&S.c(),Re(s,"display","flex"),Re(s,"justify-content","space-between"),R(e,"slot","sidebar"),R(e,"class","govuk-prose")},m(h,$){v(h,e,$),k(n,e,null),C(e,t),C(e,s),C(s,o),C(s,l),k(a,s,null),C(e,i),g&&g.m(e,null),C(e,u),k(f,e,null),C(e,c),y&&y.m(e,null),C(e,p),S&&S.m(e,null),m=!0},p(h,$){const L={};$&262144&&(L.$$scope={dirty:$,ctx:h}),n.$set(L);const U={};$&32&&(U.boundaryGeojson=h[5]),a.$set(U),h[1]?g?(g.p(h,$),$&2&&d(g,1)):(g=Ye(h),g.c(),d(g,1),g.m(e,u)):g&&(he(),_(g,1,1,()=>{g=null}),ge()),h[2].size>0?y?(y.p(h,$),$&4&&d(y,1)):(y=Qe(h),y.c(),d(y,1),y.m(e,p)):y&&(he(),_(y,1,1,()=>{y=null}),ge()),h[0]?S?(S.p(h,$),$&1&&d(S,1)):(S=Xe(h),S.c(),d(S,1),S.m(e,null)):S&&(he(),_(S,1,1,()=>{S=null}),ge())},i(h){m||(d(n.$$.fragment,h),d(a.$$.fragment,h),d(g),d(f.$$.fragment,h),d(y),d(S),m=!0)},o(h){_(n.$$.fragment,h),_(a.$$.fragment,h),_(g),_(f.$$.fragment,h),_(y),_(S),m=!1},d(h){h&&w(e),T(n),T(a),g&&g.d(),T(f),y&&y.d(),S&&S.d()}}}function Mn(r){let e,n,t,s,o,l;return e=new Or({}),t=new gr({}),o=new Tr({}),{c(){b(e.$$.fragment),n=E(),b(t.$$.fragment),s=E(),b(o.$$.fragment)},m(a,i){k(e,a,i),v(a,n,i),k(t,a,i),v(a,s,i),k(o,a,i),l=!0},i(a){l||(d(e.$$.fragment,a),d(t.$$.fragment,a),d(o.$$.fragment,a),l=!0)},o(a){_(e.$$.fragment,a),_(t.$$.fragment,a),_(o.$$.fragment,a),l=!1},d(a){a&&(w(n),w(s)),T(e,a),T(t,a),T(o,a)}}}function Cn(r){let e,n,t,s,o,l,a,i;return e=new Ir({}),o=new Yt({props:{small:!0,$$slots:{default:[Mn]},$$scope:{ctx:r}}}),a=new Qt({props:{style:r[6]}}),{c(){b(e.$$.fragment),n=E(),t=O("hr"),s=E(),b(o.$$.fragment),l=E(),b(a.$$.fragment)},m(u,f){k(e,u,f),v(u,n,f),v(u,t,f),v(u,s,f),k(o,u,f),v(u,l,f),k(a,u,f),i=!0},p(u,f){const c={};f&262144&&(c.$$scope={dirty:f,ctx:u}),o.$set(c)},i(u){i||(d(e.$$.fragment,u),d(o.$$.fragment,u),d(a.$$.fragment,u),i=!0)},o(u){_(e.$$.fragment,u),_(o.$$.fragment,u),_(a.$$.fragment,u),i=!1},d(u){u&&(w(n),w(t),w(s),w(l)),T(e,u),T(o,u),T(a,u)}}}function Bn(r){let e,n,t,s,o,l,a,i,u,f,c;return e=new Wt({props:{colorInterventions:at("v1")}}),t=new pe({props:{layer:"interventions-points",tooltip:r[8]}}),o=new pe({props:{layer:"interventions-lines",tooltip:r[8]}}),a=new pe({props:{layer:"interventions-polygons",tooltip:r[8]}}),f=new Ee({props:{label:"Layers",open:!0,$$slots:{default:[Cn]},$$scope:{ctx:r}}}),{c(){b(e.$$.fragment),n=E(),b(t.$$.fragment),s=E(),b(o.$$.fragment),l=E(),b(a.$$.fragment),i=E(),u=O("div"),b(f.$$.fragment),R(u,"class","top-right svelte-nlvvhu")},m(p,m){k(e,p,m),v(p,n,m),k(t,p,m),v(p,s,m),k(o,p,m),v(p,l,m),k(a,p,m),v(p,i,m),v(p,u,m),k(f,u,null),c=!0},p(p,m){const g={};m&262144&&(g.$$scope={dirty:m,ctx:p}),f.$set(g)},i(p){c||(d(e.$$.fragment,p),d(t.$$.fragment,p),d(o.$$.fragment,p),d(a.$$.fragment,p),d(f.$$.fragment,p),c=!0)},o(p){_(e.$$.fragment,p),_(t.$$.fragment,p),_(o.$$.fragment,p),_(a.$$.fragment,p),_(f.$$.fragment,p),c=!1},d(p){p&&(w(n),w(s),w(l),w(i),w(u)),T(e,p),T(t,p),T(o,p),T(a,p),T(f)}}}function En(r){let e,n,t,s,o;return n=new Dn({}),s=new Jt({props:{style:r[6],$$slots:{default:[Bn]},$$scope:{ctx:r}}}),{c(){e=O("div"),b(n.$$.fragment),t=E(),b(s.$$.fragment),R(e,"slot","main")},m(l,a){v(l,e,a),k(n,e,null),C(e,t),k(s,e,null),o=!0},p(l,a){const i={};a&262144&&(i.$$scope={dirty:a,ctx:l}),s.$set(i)},i(l){o||(d(n.$$.fragment,l),d(s.$$.fragment,l),o=!0)},o(l){_(n.$$.fragment,l),_(s.$$.fragment,l),o=!1},d(l){l&&w(e),T(n),T(s)}}}function An(r){let e,n;return e=new Gt({props:{$$slots:{main:[En],sidebar:[Un]},$$scope:{ctx:r}}}),{c(){b(e.$$.fragment)},m(t,s){k(e,t,s),n=!0},p(t,[s]){const o={};s&262207&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(d(e.$$.fragment,t),n=!0)},o(t){_(e.$$.fragment,t),n=!1},d(t){T(e,t)}}}function zn(r,e,n){let t,s;Q(r,de,$=>n(12,t=$)),Q(r,ae,$=>n(5,s=$));let o=null;Be(async()=>{Ft();let $=await jt();n(0,o=new Set($.features.map(L=>L.properties.name)))});let a=new URLSearchParams(window.location.search).get("style")||"dataviz",i="",u=new Map,f=new Set,c="";st(()=>{ae.set(Vt())});function p($){try{let L=JSON.parse($);n(2,u=Xt(L)),ae.set(L),n(1,i=""),t==null||t.fitBounds(nt(L),{padding:20,animate:!1})}catch(L){n(1,i=`Couldn't load schemes from a file: ${L}`)}}function m($){let L=$.properties;var U='<div style="max-width: 30vw;">';return U+=`<h2>${g(L.name)} (${L.intervention_type})</h2>`,U+=`<p>Scheme reference: ${L.scheme_reference}</p>`,L.length_meters&&(U+=`<p>Length: ${Zt(L.length_meters)}</p>`),L.description&&(U+=`<p>${g(L.description)}</p>`),U+="</div>",U}function g($){return c?$.replace(new RegExp(c,"gi"),L=>`<mark>${L}</mark>`):$}const y=()=>window.open("index.html");function S($){f=$,n(3,f)}function h($){c=$,n(4,c)}return[o,i,u,f,c,s,a,p,m,y,S,h]}class On extends q{constructor(e){super(),J(this,e,zn,An,W,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new On({target:document.getElementById("app")});
