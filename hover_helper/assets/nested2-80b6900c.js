import{S as K,i as G,s as q,g as y,f as B,e as z,u as U,m as b,j as d,k as C,T as Q,t as h,l as $,p as _,q as k,Z as X,a1 as ue,r as Ee,b as ee,c as te,F as Et,o as ne,a as ye,h as R,v as Ge,w as At,I as ce,C as pe,aV as Ae,a0 as lt,G as zt,K as Ot,L as Pt,M as Nt,aU as re,a6 as at,x as ft,D as ut,ay as It,aW as qe,af as ct,d as Ft,W as Je,y as $e,n as de,z as jt,A as Vt,a8 as Zt,aO as Ht,E as Rt,U as We,V as xt,ac as Kt}from"./data_getter-d6abb702.js";import{C as ze,S as Ce,d as Oe,j as Pe,H as Ne,h as Gt,i as Ye,g as pt,L as qt,Z as Jt,M as Wt,I as Yt,b as Qt,B as Xt}from"./Map-4a622e90.js";function en(n){let e=new Map;for(let[t,s]of Object.entries(n.schemes))e.set(t,{scheme_reference:t,num_features:0,authority_or_region:s.authority_or_region,capital_scheme_id:s.capital_scheme_id,funding_programme:s.funding_programme});let r=1;for(let t of n.features){let s=e.get(t.properties.scheme_reference);s.num_features++,t.properties.funding_programme=s.funding_programme,t.id=r++}return e}function tn(n){let e;return{c(){e=U("Clear")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function nn(n){let e,r,t,s,o,l;return t=new ye({props:{$$slots:{default:[tn]},$$scope:{ctx:n}}}),t.$on("click",n[11]),{c(){e=z("input"),r=B(),y(t.$$.fragment),R(e,"type","text"),R(e,"class","govuk-input govuk-input--width-10"),R(e,"id","filterText")},m(u,i){d(u,e,i),Ge(e,n[0]),d(u,r,i),b(t,u,i),s=!0,o||(l=At(e,"input",n[10]),o=!0)},p(u,i){i&1&&e.value!==u[0]&&Ge(e,u[0]);const f={};i&16384&&(f.$$scope={dirty:i,ctx:u}),t.$set(f)},i(u){s||(h(t.$$.fragment,u),s=!0)},o(u){$(t.$$.fragment,u),s=!1},d(u){u&&(_(e),_(r)),k(t,u),o=!1,l()}}}function rn(n){let e,r,t,s,o,l,u,i;function f(p){n[8](p)}let a={label:"Authority or region",id:"filterAuthority",choices:n[4],emptyOption:!0};n[2]!==void 0&&(a.value=n[2]),e=new Ce({props:a}),ee.push(()=>te(e,"value",f));function c(p){n[9](p)}let m={label:"Funding programme",id:"filterFundingProgramme",choices:n[5],emptyOption:!0};return n[3]!==void 0&&(m.value=n[3]),s=new Ce({props:m}),ee.push(()=>te(s,"value",c)),u=new Et({props:{label:"Intervention name or description",id:"filterText",$$slots:{default:[nn]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment),l=B(),y(u.$$.fragment)},m(p,w){b(e,p,w),d(p,t,w),b(s,p,w),d(p,l,w),b(u,p,w),i=!0},p(p,w){const T={};w&16&&(T.choices=p[4]),!r&&w&4&&(r=!0,T.value=p[2],ne(()=>r=!1)),e.$set(T);const S={};w&32&&(S.choices=p[5]),!o&&w&8&&(o=!0,S.value=p[3],ne(()=>o=!1)),s.$set(S);const g={};w&16385&&(g.$$scope={dirty:w,ctx:p}),u.$set(g)},i(p){i||(h(e.$$.fragment,p),h(s.$$.fragment,p),h(u.$$.fragment,p),i=!0)},o(p){$(e.$$.fragment,p),$(s.$$.fragment,p),$(u.$$.fragment,p),i=!1},d(p){p&&(_(t),_(l)),k(e,p),k(s,p),k(u,p)}}}function sn(n){let e,r,t,s,o=n[1].size+"",l,u,i=n[6].route+"",f,a,c=n[6].area+"",m,p,w=n[6].crossing+"",T,S,g=n[6].other+"",v,L,M;return e=new ze({props:{label:"Filters",$$slots:{default:[rn]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment),r=B(),t=z("p"),s=U("Showing "),l=U(o),u=U(" schemes ("),f=U(i),a=U(" routes, "),m=U(c),p=U(` areas,
  `),T=U(w),S=U(" crossings, "),v=U(g),L=U(" other)")},m(D,E){b(e,D,E),d(D,r,E),d(D,t,E),C(t,s),C(t,l),C(t,u),C(t,f),C(t,a),C(t,m),C(t,p),C(t,T),C(t,S),C(t,v),C(t,L),M=!0},p(D,[E]){const O={};E&16445&&(O.$$scope={dirty:E,ctx:D}),e.$set(O),(!M||E&2)&&o!==(o=D[1].size+"")&&Q(l,o),(!M||E&64)&&i!==(i=D[6].route+"")&&Q(f,i),(!M||E&64)&&c!==(c=D[6].area+"")&&Q(m,c),(!M||E&64)&&w!==(w=D[6].crossing+"")&&Q(T,w),(!M||E&64)&&g!==(g=D[6].other+"")&&Q(v,g)},i(D){M||(h(e.$$.fragment,D),M=!0)},o(D){$(e.$$.fragment,D),M=!1},d(D){D&&(_(r),_(t)),k(e,D)}}}function on(n,e,r){let t;X(n,ue,g=>r(12,t=g));let{schemes:s}=e,{schemesToBeShown:o=new Set}=e,{filterText:l=""}=e,u=[],i="",f=[],a="",c={area:0,route:0,crossing:0,other:0};Ee(()=>{let g=new Set,v=new Set;for(let L of s.values())L.authority_or_region&&g.add(L.authority_or_region),L.funding_programme&&v.add(L.funding_programme);r(4,u=Array.from(g.entries())),u.sort(),r(5,f=Array.from(v.entries())),f.sort()});function m(g,v,L){let M=g.toLowerCase(),D=O=>{var P,J;if(M&&!((P=O.properties.name)!=null&&P.toLowerCase().includes(M))&&!((J=O.properties.description)!=null&&J.toLowerCase().includes(M)))return!1;if(v||L){let N=s.get(O.properties.scheme_reference);if(v&&N.authority_or_region!=v||L&&N.funding_programme!=L)return!1}return!0};r(1,o=new Set(t.features.filter(D).map(O=>O.properties.scheme_reference))),r(6,c={area:0,route:0,crossing:0,other:0});let E=O=>{var P,J;return!(!o.has(O.properties.scheme_reference)||M&&!((P=O.properties.name)!=null&&P.toLowerCase().includes(M))&&!((J=O.properties.description)!=null&&J.toLowerCase().includes(M)))};ue.update(O=>{for(let P of O.features)E(P)?(delete P.properties.hide_while_editing,r(6,c[P.properties.intervention_type]++,c)):P.properties.hide_while_editing=!0;return O}),r(6,c)}function p(g){i=g,r(2,i)}function w(g){a=g,r(3,a)}function T(){l=this.value,r(0,l)}const S=()=>r(0,l="");return n.$$set=g=>{"schemes"in g&&r(7,s=g.schemes),"schemesToBeShown"in g&&r(1,o=g.schemesToBeShown),"filterText"in g&&r(0,l=g.filterText)},n.$$.update=()=>{n.$$.dirty&13&&m(l,i,a)},[l,o,i,a,u,f,c,s,p,w,T,S]}class ln extends K{constructor(e){super(),G(this,e,on,sn,q,{schemes:7,schemesToBeShown:1,filterText:0})}}const Y={schools:"#007DBB",hospitals:"#B73D25",mrn:"#006478",parliamentary_constituencies:"#006E59",atf2:"#00AFFF",atf3:"#FF62DC",atf4:"#FFD833"};function an(n){let e,r,t,s;return e=new Pe({props:{color:n[3]}}),{c(){y(e.$$.fragment),r=B(),t=U(n[1])},m(o,l){b(e,o,l),d(o,r,l),d(o,t,l),s=!0},p(o,l){(!s||l&2)&&Q(t,o[1])},i(o){s||(h(e.$$.fragment,o),s=!0)},o(o){$(e.$$.fragment,o),s=!1},d(o){o&&(_(r),_(t)),k(e,o)}}}function fn(n){let e;const r=n[6].default,t=zt(r,n,n[8],null);return{c(){t&&t.c()},m(s,o){t&&t.m(s,o),e=!0},p(s,o){t&&t.p&&(!e||o&256)&&Ot(t,r,s,s[8],e?Nt(r,s[8],o,null):Pt(s[8]),null)},i(s){e||(h(t,s),e=!0)},o(s){$(t,s),e=!1},d(s){t&&t.d(s)}}}function un(n){let e,r,t;return r=new Ne({props:{$$slots:{default:[fn]},$$scope:{ctx:n}}}),{c(){e=z("span"),y(r.$$.fragment),R(e,"slot","right")},m(s,o){d(s,e,o),b(r,e,null),t=!0},p(s,o){const l={};o&256&&(l.$$scope={dirty:o,ctx:s}),r.$set(l)},i(s){t||(h(r.$$.fragment,s),t=!0)},o(s){$(r.$$.fragment,s),t=!1},d(s){s&&_(e),k(r)}}}function cn(n){let e,r,t,s,o;function l(i){n[7](i)}let u={id:n[0],$$slots:{right:[un],default:[an]},$$scope:{ctx:n}};return n[2]!==void 0&&(u.checked=n[2]),e=new Oe({props:u}),ee.push(()=>te(e,"checked",l)),s=new ce({props:{layer:n[0],tooltip:n[4],show:n[2]}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,f){b(e,i,f),d(i,t,f),b(s,i,f),o=!0},p(i,[f]){const a={};f&1&&(a.id=i[0]),f&258&&(a.$$scope={dirty:f,ctx:i}),!r&&f&4&&(r=!0,a.checked=i[2],ne(()=>r=!1)),e.$set(a);const c={};f&1&&(c.layer=i[0]),f&4&&(c.show=i[2]),s.$set(c)},i(i){o||(h(e.$$.fragment,i),h(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&_(t),k(e,i),k(s,i)}}}function pn(n,e,r){let t;X(n,pe,p=>r(9,t=p));let{$$slots:s={},$$scope:o}=e,{name:l}=e,{singularNoun:u}=e,{pluralNoun:i}=e,f=Y[l];Ae(t,l,`https://atip.uk/layers/v1/${l}.pmtiles`),lt(t,{id:l,source:l,sourceLayer:l,color:f,opacity:.8});let a=!1;function c(p){return`<p>${p.properties.name??`Unnamed ${u}`}</p>`}function m(p){a=p,r(2,a)}return n.$$set=p=>{"name"in p&&r(0,l=p.name),"singularNoun"in p&&r(5,u=p.singularNoun),"pluralNoun"in p&&r(1,i=p.pluralNoun),"$$scope"in p&&r(8,o=p.$$scope)},[l,i,a,f,c,u,s,m,o]}class mt extends K{constructor(e){super(),G(this,e,pn,cn,q,{name:0,singularNoun:5,pluralNoun:1})}}function mn(n){let e;return{c(){e=U("hospital")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function hn(n){let e;return{c(){e=U("Open Data Commons Open Database License")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function gn(n){let e,r,t,s,o,l,u,i,f;return t=new re({props:{href:"https://wiki.openstreetmap.org/wiki/Tag:amenity%3Dhospital",$$slots:{default:[mn]},$$scope:{ctx:n}}}),i=new re({props:{href:"https://www.openstreetmap.org/copyright",$$slots:{default:[hn]},$$scope:{ctx:n}}}),{c(){e=z("p"),r=U("This shows "),y(t.$$.fragment),s=U(` data from OpenStreetMap. It doesn't include outpatient clinics
    or individual doctor's offices.`),o=B(),l=z("p"),u=U("License: "),y(i.$$.fragment)},m(a,c){d(a,e,c),C(e,r),b(t,e,null),C(e,s),d(a,o,c),d(a,l,c),C(l,u),b(i,l,null),f=!0},p(a,c){const m={};c&1&&(m.$$scope={dirty:c,ctx:a}),t.$set(m);const p={};c&1&&(p.$$scope={dirty:c,ctx:a}),i.$set(p)},i(a){f||(h(t.$$.fragment,a),h(i.$$.fragment,a),f=!0)},o(a){$(t.$$.fragment,a),$(i.$$.fragment,a),f=!1},d(a){a&&(_(e),_(o),_(l)),k(t),k(i)}}}function $n(n){let e,r;return e=new mt({props:{name:"hospitals",singularNoun:"hospital",pluralNoun:"Hospitals",$$slots:{default:[gn]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),r=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){k(e,t)}}}class dn extends K{constructor(e){super(),G(this,e,null,$n,q,{})}}function _n(n){let e,r,t;return e=new Pe({props:{color:n[1]}}),{c(){y(e.$$.fragment),r=U(`
  MRN`)},m(s,o){b(e,s,o),d(s,r,o),t=!0},p:ft,i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){s&&_(r),k(e,s)}}}function wn(n){let e;return{c(){e=U(`Major Road Network
        `)},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function vn(n){let e;return{c(){e=U("Open Government License")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function yn(n){let e,r,t,s,o,l,u,i,f;return t=new re({props:{href:"https://maps.dft.gov.uk/major-road-network/index.html",$$slots:{default:[wn]},$$scope:{ctx:n}}}),i=new re({props:{href:"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/",$$slots:{default:[vn]},$$scope:{ctx:n}}}),{c(){e=z("p"),r=U("Data from the "),y(t.$$.fragment),s=U("."),o=B(),l=z("p"),u=U("License: "),y(i.$$.fragment)},m(a,c){d(a,e,c),C(e,r),b(t,e,null),C(e,s),d(a,o,c),d(a,l,c),C(l,u),b(i,l,null),f=!0},p(a,c){const m={};c&16&&(m.$$scope={dirty:c,ctx:a}),t.$set(m);const p={};c&16&&(p.$$scope={dirty:c,ctx:a}),i.$set(p)},i(a){f||(h(t.$$.fragment,a),h(i.$$.fragment,a),f=!0)},o(a){$(t.$$.fragment,a),$(i.$$.fragment,a),f=!1},d(a){a&&(_(e),_(o),_(l)),k(t),k(i)}}}function bn(n){let e,r,t;return r=new Ne({props:{$$slots:{default:[yn]},$$scope:{ctx:n}}}),{c(){e=z("span"),y(r.$$.fragment),R(e,"slot","right")},m(s,o){d(s,e,o),b(r,e,null),t=!0},p(s,o){const l={};o&16&&(l.$$scope={dirty:o,ctx:s}),r.$set(l)},i(s){t||(h(r.$$.fragment,s),t=!0)},o(s){$(r.$$.fragment,s),t=!1},d(s){s&&_(e),k(r)}}}function kn(n){let e,r,t,s,o;function l(i){n[2](i)}let u={id:se,$$slots:{right:[bn],default:[_n]},$$scope:{ctx:n}};return n[0]!==void 0&&(u.checked=n[0]),e=new Oe({props:u}),ee.push(()=>te(e,"checked",l)),s=new ce({props:{layer:se,tooltip:Tn,show:n[0]}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,f){b(e,i,f),d(i,t,f),b(s,i,f),o=!0},p(i,[f]){const a={};f&16&&(a.$$scope={dirty:f,ctx:i}),!r&&f&1&&(r=!0,a.checked=i[0],ne(()=>r=!1)),e.$set(a);const c={};f&1&&(c.show=i[0]),s.$set(c)},i(i){o||(h(e.$$.fragment,i),h(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&_(t),k(e,i),k(s,i)}}}let se="mrn";function Tn(n){return`<p>${n.properties.name??"Unknown MRN road"}</p>`}function Ln(n,e,r){let t;X(n,pe,u=>r(3,t=u));let s=Y.mrn;Ae(t,se,`https://atip.uk/layers/v1/${se}.pmtiles`),at(t,{id:se,source:se,sourceLayer:se,color:s,width:7});let o=!1;function l(u){o=u,r(0,o)}return[o,s,l]}class Dn extends K{constructor(e){super(),G(this,e,Ln,kn,q,{})}}function Sn(n){let e,r,t;return e=new Pe({props:{color:n[1]}}),{c(){y(e.$$.fragment),r=U(`
  Parliamentary constituencies`)},m(s,o){b(e,s,o),d(s,r,o),t=!0},p:ft,i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){s&&_(r),k(e,s)}}}function Un(n){let e;return{c(){e=U(`Ordnance Survey Boundary-Line
        `)},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function Cn(n){let e;return{c(){e=U("Open Government License")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function Mn(n){let e,r,t,s,o,l,u,i,f;return t=new re({props:{href:"https://www.ordnancesurvey.co.uk/products/boundary-line",$$slots:{default:[Un]},$$scope:{ctx:n}}}),i=new re({props:{href:"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/",$$slots:{default:[Cn]},$$scope:{ctx:n}}}),{c(){e=z("p"),r=U("Data from "),y(t.$$.fragment),s=U("."),o=B(),l=z("p"),u=U("License: "),y(i.$$.fragment)},m(a,c){d(a,e,c),C(e,r),b(t,e,null),C(e,s),d(a,o,c),d(a,l,c),C(l,u),b(i,l,null),f=!0},p(a,c){const m={};c&32&&(m.$$scope={dirty:c,ctx:a}),t.$set(m);const p={};c&32&&(p.$$scope={dirty:c,ctx:a}),i.$set(p)},i(a){f||(h(t.$$.fragment,a),h(i.$$.fragment,a),f=!0)},o(a){$(t.$$.fragment,a),$(i.$$.fragment,a),f=!1},d(a){a&&(_(e),_(o),_(l)),k(t),k(i)}}}function Bn(n){let e,r,t;return r=new Ne({props:{$$slots:{default:[Mn]},$$scope:{ctx:n}}}),{c(){e=z("span"),y(r.$$.fragment),R(e,"slot","right")},m(s,o){d(s,e,o),b(r,e,null),t=!0},p(s,o){const l={};o&32&&(l.$$scope={dirty:o,ctx:s}),r.$set(l)},i(s){t||(h(r.$$.fragment,s),t=!0)},o(s){$(r.$$.fragment,s),t=!1},d(s){s&&_(e),k(r)}}}function En(n){let e,r,t,s,o;function l(i){n[3](i)}let u={id:x,$$slots:{right:[Bn],default:[Sn]},$$scope:{ctx:n}};return n[0]!==void 0&&(u.checked=n[0]),e=new Oe({props:u}),ee.push(()=>te(e,"checked",l)),s=new ce({props:{layer:x,tooltip:An,show:n[0]}}),s.$on("click",zn),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,f){b(e,i,f),d(i,t,f),b(s,i,f),o=!0},p(i,[f]){const a={};f&32&&(a.$$scope={dirty:f,ctx:i}),!r&&f&1&&(r=!0,a.checked=i[0],ne(()=>r=!1)),e.$set(a);const c={};f&1&&(c.show=i[0]),s.$set(c)},i(i){o||(h(e.$$.fragment,i),h(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&_(t),k(e,i),k(s,i)}}}let x="parliamentary_constituencies";function An(n){return`<p>${n.properties.Name} (${n.properties.Census_Code})</p>`}function zn(n){window.open(`https://www.ons.gov.uk/visualisations/areas/${n.detail.properties.Census_Code}`,"_blank")}function On(n,e,r){let t;X(n,pe,i=>r(2,t=i));let s=Y.parliamentary_constituencies,o=`${x}-outline`;Ae(t,x,`https://atip.uk/layers/v1/${x}.pmtiles`),lt(t,{id:x,source:x,sourceLayer:x,color:s,opacity:["case",["boolean",["feature-state","hover"],!1],.5,.1]}),at(t,{id:o,source:x,sourceLayer:x,color:s,width:5});let l=!1;function u(i){l=i,r(0,l)}return n.$$.update=()=>{n.$$.dirty&5&&t.getLayer(o)&&t.setLayoutProperty(o,"visibility",l?"visible":"none")},[l,s,t,u]}class Pn extends K{constructor(e){super(),G(this,e,On,En,q,{})}}function Nn(n){let e;return{c(){e=U("Show on map")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function In(n){let e;return{c(){e=U("Edit scheme locally")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function Fn(n){let e,r,t=n[0].authority_or_region+"",s,o,l,u,i=n[0].capital_scheme_id+"",f,a,c,m,p=n[0].funding_programme+"",w,T,S,g,v,L,M;return g=new ye({props:{$$slots:{default:[Nn]},$$scope:{ctx:n}}}),g.$on("click",n[3]),L=new ye({props:{disabled:n[1],title:n[2],$$slots:{default:[In]},$$scope:{ctx:n}}}),L.$on("click",n[4]),{c(){e=z("p"),r=U("Authority or region: "),s=U(t),o=B(),l=z("p"),u=U("Capital scheme ID: "),f=U(i),a=B(),c=z("p"),m=U("Funding programme: "),w=U(p),T=B(),S=z("div"),y(g.$$.fragment),v=B(),y(L.$$.fragment),R(S,"class","govuk-button-group")},m(D,E){d(D,e,E),C(e,r),C(e,s),d(D,o,E),d(D,l,E),C(l,u),C(l,f),d(D,a,E),d(D,c,E),C(c,m),C(c,w),d(D,T,E),d(D,S,E),b(g,S,null),C(S,v),b(L,S,null),M=!0},p(D,E){(!M||E&1)&&t!==(t=D[0].authority_or_region+"")&&Q(s,t),(!M||E&1)&&i!==(i=D[0].capital_scheme_id+"")&&Q(f,i),(!M||E&1)&&p!==(p=D[0].funding_programme+"")&&Q(w,p);const O={};E&256&&(O.$$scope={dirty:E,ctx:D}),g.$set(O);const P={};E&256&&(P.$$scope={dirty:E,ctx:D}),L.$set(P)},i(D){M||(h(g.$$.fragment,D),h(L.$$.fragment,D),M=!0)},o(D){$(g.$$.fragment,D),$(L.$$.fragment,D),M=!1},d(D){D&&(_(e),_(o),_(l),_(a),_(c),_(T),_(S)),k(g),k(L)}}}function jn(n){let e,r;return e=new ze({props:{label:`${n[0].scheme_reference}: ${n[0].num_features} features`,$$slots:{default:[Fn]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),r=!0},p(t,[s]){const o={};s&1&&(o.label=`${t[0].scheme_reference}: ${t[0].num_features} features`),s&257&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){k(e,t)}}}function Vn(n,e,r){let t,s;X(n,ue,c=>r(6,t=c)),X(n,pe,c=>r(7,s=c));let{scheme:o}=e,{authorityNames:l}=e,u=!l.has(o.authority_or_region),i=u?"This scheme doesn't have an authority specified correctly, so you can't edit this scheme. We're working to fix this problem.":void 0;function f(){let c={type:"FeatureCollection",features:t.features.filter(m=>m.properties.scheme_reference==o.scheme_reference)};s==null||s.fitBounds(ut(c),{padding:20,animate:!1})}function a(){let c={type:"FeatureCollection",features:t.features.filter(p=>p.properties.scheme_reference==o.scheme_reference)},m=o.authority_or_region;window.localStorage.setItem(m,JSON.stringify(c)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return n.$$set=c=>{"scheme"in c&&r(0,o=c.scheme),"authorityNames"in c&&r(5,l=c.authorityNames)},[o,u,i,f,a,l]}class Zn extends K{constructor(e){super(),G(this,e,Vn,jn,q,{scheme:0,authorityNames:5})}}function Hn(n){let e;return{c(){e=U("primary and secondary schools")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function Rn(n){let e;return{c(){e=U("Open Data Commons Open Database License")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function xn(n){let e,r,t,s,o,l,u,i,f;return t=new re({props:{href:"https://wiki.openstreetmap.org/wiki/Tag:amenity%3Dschool",$$slots:{default:[Hn]},$$scope:{ctx:n}}}),i=new re({props:{href:"https://www.openstreetmap.org/copyright",$$slots:{default:[Rn]},$$scope:{ctx:n}}}),{c(){e=z("p"),r=U("This shows "),y(t.$$.fragment),s=U(` from OpenStreetMap. It doesn't include kindergartens, colleges,
    universities, or other training schools.`),o=B(),l=z("p"),u=U("License: "),y(i.$$.fragment)},m(a,c){d(a,e,c),C(e,r),b(t,e,null),C(e,s),d(a,o,c),d(a,l,c),C(l,u),b(i,l,null),f=!0},p(a,c){const m={};c&1&&(m.$$scope={dirty:c,ctx:a}),t.$set(m);const p={};c&1&&(p.$$scope={dirty:c,ctx:a}),i.$set(p)},i(a){f||(h(t.$$.fragment,a),h(i.$$.fragment,a),f=!0)},o(a){$(t.$$.fragment,a),$(i.$$.fragment,a),f=!1},d(a){a&&(_(e),_(o),_(l)),k(t),k(i)}}}function Kn(n){let e,r;return e=new mt({props:{name:"schools",singularNoun:"school",pluralNoun:"Schools",$$slots:{default:[xn]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),r=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){k(e,t)}}}class Gn extends K{constructor(e){super(),G(this,e,null,Kn,q,{})}}function qn(n){let e,r,t,s,o;function l(i){n[3](i)}let u={label:"Color interventions",id:"colorInterventions",choices:[["interventionType","By intervention type"],["fundingProgramme","By funding programme"]]};return n[0]!==void 0&&(u.value=n[0]),e=new Ce({props:u}),ee.push(()=>te(e,"value",l)),e.$on("change",n[2]),s=new Gt({props:{rows:n[1]}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,f){b(e,i,f),d(i,t,f),b(s,i,f),o=!0},p(i,[f]){const a={};!r&&f&1&&(r=!0,a.value=i[0],ne(()=>r=!1)),e.$set(a);const c={};f&2&&(c.rows=i[1]),s.$set(c)},i(i){o||(h(e.$$.fragment,i),h(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&_(t),k(e,i),k(s,i)}}}function Jn(n,e,r){let t;X(n,pe,i=>r(4,t=i));let s="interventionType",o=Ye("v1");function l(){let i;s=="interventionType"?(i=pt("v1"),r(1,o=Ye("v1"))):(i=It(["get","funding_programme"],{ATF2:Y.atf2,ATF3:Y.atf3,ATF4:Y.atf4},"grey"),r(1,o=[["ATF2",Y.atf2],["ATF3",Y.atf3],["ATF4",Y.atf4]])),t.setPaintProperty("interventions-points","circle-color",i),t.setPaintProperty("interventions-lines","line-color",i),t.setPaintProperty("interventions-polygons","fill-color",i),t.setPaintProperty("interventions-polygon-outlines","line-color",i)}function u(i){s=i,r(0,s)}return[s,o,l,u]}class Wn extends K{constructor(e){super(),G(this,e,Jn,qn,q,{})}}var I=(n,e,r)=>new Promise((t,s)=>{var o=i=>{try{u(r.next(i))}catch(f){s(f)}},l=i=>{try{u(r.throw(i))}catch(f){s(f)}},u=i=>i.done?t(i.value):Promise.resolve(i.value).then(o,l);u((r=r.apply(n,e)).next())}),j=Uint8Array,ae=Uint16Array,Yn=Int32Array,ht=new j([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gt=new j([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Qn=new j([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$t=function(n,e){for(var r=new ae(31),t=0;t<31;++t)r[t]=e+=1<<n[t-1];for(var s=new Yn(r[30]),t=1;t<30;++t)for(var o=r[t];o<r[t+1];++o)s[o]=o-r[t]<<5|t;return{b:r,r:s}},dt=$t(ht,2),_t=dt.b,Xn=dt.r;_t[28]=258,Xn[258]=28;var er=$t(gt,0),tr=er.b,Me=new ae(32768);for(A=0;A<32768;++A)W=(A&43690)>>1|(A&21845)<<1,W=(W&52428)>>2|(W&13107)<<2,W=(W&61680)>>4|(W&3855)<<4,Me[A]=((W&65280)>>8|(W&255)<<8)>>1;var W,A,_e=function(n,e,r){for(var t=n.length,s=0,o=new ae(e);s<t;++s)n[s]&&++o[n[s]-1];var l=new ae(e);for(s=1;s<e;++s)l[s]=l[s-1]+o[s-1]<<1;var u;if(r){u=new ae(1<<e);var i=15-e;for(s=0;s<t;++s)if(n[s])for(var f=s<<4|n[s],a=e-n[s],c=l[n[s]-1]++<<a,m=c|(1<<a)-1;c<=m;++c)u[Me[c]>>i]=f}else for(u=new ae(t),s=0;s<t;++s)n[s]&&(u[s]=Me[l[n[s]-1]++]>>15-n[s]);return u},we=new j(288);for(A=0;A<144;++A)we[A]=8;var A;for(A=144;A<256;++A)we[A]=9;var A;for(A=256;A<280;++A)we[A]=7;var A;for(A=280;A<288;++A)we[A]=8;var A,wt=new j(32);for(A=0;A<32;++A)wt[A]=5;var A,nr=_e(we,9,1),rr=_e(wt,5,1),Se=function(n){for(var e=n[0],r=1;r<n.length;++r)n[r]>e&&(e=n[r]);return e},Z=function(n,e,r){var t=e/8|0;return(n[t]|n[t+1]<<8)>>(e&7)&r},Ue=function(n,e){var r=e/8|0;return(n[r]|n[r+1]<<8|n[r+2]<<16)>>(e&7)},sr=function(n){return(n+7)/8|0},or=function(n,e,r){(e==null||e<0)&&(e=0),(r==null||r>n.length)&&(r=n.length);var t=new j(r-e);return t.set(n.subarray(e,r)),t},ir=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],F=function(n,e,r){var t=new Error(e||ir[n]);if(t.code=n,Error.captureStackTrace&&Error.captureStackTrace(t,F),!r)throw t;return t},Ie=function(n,e,r,t){var s=n.length,o=t?t.length:0;if(!s||e.f&&!e.l)return r||new j(0);var l=!r||e.i!=2,u=e.i;r||(r=new j(s*3));var i=function(Re){var xe=r.length;if(Re>xe){var Ke=new j(Math.max(xe*2,Re));Ke.set(r),r=Ke}},f=e.f||0,a=e.p||0,c=e.b||0,m=e.l,p=e.d,w=e.m,T=e.n,S=s*8;do{if(!m){f=Z(n,a,1);var g=Z(n,a+1,3);if(a+=3,g)if(g==1)m=nr,p=rr,w=9,T=5;else if(g==2){var D=Z(n,a,31)+257,E=Z(n,a+10,15)+4,O=D+Z(n,a+5,31)+1;a+=14;for(var P=new j(O),J=new j(19),N=0;N<E;++N)J[Qn[N]]=Z(n,a+N*3,7);a+=E*3;for(var Fe=Se(J),St=(1<<Fe)-1,Ut=_e(J,Fe,1),N=0;N<O;){var je=Ut[Z(n,a,St)];a+=je&15;var v=je>>4;if(v<16)P[N++]=v;else{var oe=0,ve=0;for(v==16?(ve=3+Z(n,a,3),a+=2,oe=P[N-1]):v==17?(ve=3+Z(n,a,7),a+=3):v==18&&(ve=11+Z(n,a,127),a+=7);ve--;)P[N++]=oe}}var Ve=P.subarray(0,D),V=P.subarray(D);w=Se(Ve),T=Se(V),m=_e(Ve,w,1),p=_e(V,T,1)}else F(1);else{var v=sr(a)+4,L=n[v-4]|n[v-3]<<8,M=v+L;if(M>s){u&&F(0);break}l&&i(c+L),r.set(n.subarray(v,M),c),e.b=c+=L,e.p=a=M*8,e.f=f;continue}if(a>S){u&&F(0);break}}l&&i(c+131072);for(var Ct=(1<<w)-1,Mt=(1<<T)-1,ke=a;;ke=a){var oe=m[Ue(n,a)&Ct],ie=oe>>4;if(a+=oe&15,a>S){u&&F(0);break}if(oe||F(2),ie<256)r[c++]=ie;else if(ie==256){ke=a,m=null;break}else{var Ze=ie-254;if(ie>264){var N=ie-257,me=ht[N];Ze=Z(n,a,(1<<me)-1)+_t[N],a+=me}var Te=p[Ue(n,a)&Mt],Le=Te>>4;Te||F(3),a+=Te&15;var V=tr[Le];if(Le>3){var me=gt[Le];V+=Ue(n,a)&(1<<me)-1,a+=me}if(a>S){u&&F(0);break}l&&i(c+131072);var De=c+Ze;if(c<V){var He=o-V,Bt=Math.min(V,De);for(He+c<0&&F(3);c<Bt;++c)r[c]=t[He+c]}for(;c<De;c+=4)r[c]=r[c-V],r[c+1]=r[c+1-V],r[c+2]=r[c+2-V],r[c+3]=r[c+3-V];c=De}}e.l=m,e.p=ke,e.b=c,e.f=f,m&&(f=1,e.m=w,e.d=p,e.n=T)}while(!f);return c==r.length?r:or(r,0,c)},lr=new j(0),ar=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&F(6,"invalid gzip data");var e=n[3],r=10;e&4&&(r+=(n[10]|n[11]<<8)+2);for(var t=(e>>3&1)+(e>>4&1);t>0;t-=!n[r++]);return r+(e&2)},fr=function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},ur=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&F(6,"invalid zlib data"),(n[1]>>5&1)==+!e&&F(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function cr(n,e){return Ie(n,{i:2},e&&e.out,e&&e.dictionary)}function pr(n,e){var r=ar(n);return r+8>n.length&&F(6,"invalid gzip data"),Ie(n.subarray(r,-8),{i:2},e&&e.out||new j(fr(n)),e&&e.dictionary)}function mr(n,e){return Ie(n.subarray(ur(n,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Be(n,e){return n[0]==31&&n[1]==139&&n[2]==8?pr(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?cr(n,e):mr(n,e)}var hr=typeof TextDecoder<"u"&&new TextDecoder,gr=0;try{hr.decode(lr,{stream:!0}),gr=1}catch{}var vt=(n,e)=>n*Math.pow(2,e),he=(n,e)=>Math.floor(n/Math.pow(2,e)),be=(n,e)=>vt(n.getUint16(e+1,!0),8)+n.getUint8(e),yt=(n,e)=>vt(n.getUint32(e+2,!0),16)+n.getUint16(e,!0),$r=(n,e,r,t,s)=>{if(n!=t.getUint8(s))return n-t.getUint8(s);const o=be(t,s+1);if(e!=o)return e-o;const l=be(t,s+4);return r!=l?r-l:0},dr=(n,e,r,t)=>{const s=bt(n,e|128,r,t);return s?{z:e,x:r,y:t,offset:s[0],length:s[1],is_dir:!0}:null},Qe=(n,e,r,t)=>{const s=bt(n,e,r,t);return s?{z:e,x:r,y:t,offset:s[0],length:s[1],is_dir:!1}:null},bt=(n,e,r,t)=>{let s=0,o=n.byteLength/17-1;for(;s<=o;){const l=o+s>>1,u=$r(e,r,t,n,l*17);if(u>0)s=l+1;else if(u<0)o=l-1;else return[yt(n,l*17+7),n.getUint32(l*17+13,!0)]}return null},_r=(n,e)=>n.is_dir&&!e.is_dir?1:!n.is_dir&&e.is_dir?-1:n.z!==e.z?n.z-e.z:n.x!==e.x?n.x-e.x:n.y-e.y,kt=(n,e)=>{const r=n.getUint8(e*17);return{z:r&127,x:be(n,e*17+1),y:be(n,e*17+4),offset:yt(n,e*17+7),length:n.getUint32(e*17+13,!0),is_dir:r>>7===1}},Xe=n=>{const e=[],r=new DataView(n);for(let t=0;t<r.byteLength/17;t++)e.push(kt(r,t));return wr(e)},wr=n=>{n.sort(_r);const e=new ArrayBuffer(17*n.length),r=new Uint8Array(e);for(let t=0;t<n.length;t++){const s=n[t];let o=s.z;s.is_dir&&(o=o|128),r[t*17]=o,r[t*17+1]=s.x&255,r[t*17+2]=s.x>>8&255,r[t*17+3]=s.x>>16&255,r[t*17+4]=s.y&255,r[t*17+5]=s.y>>8&255,r[t*17+6]=s.y>>16&255,r[t*17+7]=s.offset&255,r[t*17+8]=he(s.offset,8)&255,r[t*17+9]=he(s.offset,16)&255,r[t*17+10]=he(s.offset,24)&255,r[t*17+11]=he(s.offset,32)&255,r[t*17+12]=he(s.offset,48)&255,r[t*17+13]=s.length&255,r[t*17+14]=s.length>>8&255,r[t*17+15]=s.length>>16&255,r[t*17+16]=s.length>>24&255}return e},vr=(n,e)=>{if(n.byteLength<17)return null;const r=n.byteLength/17,t=kt(n,r-1);if(t.is_dir){const s=t.z,o=e.z-s,l=Math.trunc(e.x/(1<<o)),u=Math.trunc(e.y/(1<<o));return{z:s,x:l,y:u}}return null};function yr(n){return I(this,null,function*(){const e=yield n.getBytes(0,512e3),r=new DataView(e.data),t=r.getUint32(4,!0),s=r.getUint16(8,!0),o=new TextDecoder("utf-8"),l=JSON.parse(o.decode(new DataView(e.data,10,t)));let u=0;l.compression==="gzip"&&(u=2);let i=0;"minzoom"in l&&(i=+l.minzoom);let f=0;"maxzoom"in l&&(f=+l.maxzoom);let a=0,c=0,m=0,p=-180,w=-85,T=180,S=85;if(l.bounds){const v=l.bounds.split(",");p=+v[0],w=+v[1],T=+v[2],S=+v[3]}if(l.center){const v=l.center.split(",");a=+v[0],c=+v[1],m=+v[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+t,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:t,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:u,tileType:1,minZoom:i,maxZoom:f,minLon:p,minLat:w,maxLon:T,maxLat:S,centerZoom:m,centerLon:a,centerLat:c,etag:e.etag}})}function br(n,e,r,t,s,o,l){return I(this,null,function*(){let u=yield r.getArrayBuffer(e,n.rootDirectoryOffset,n.rootDirectoryLength,n);n.specVersion===1&&(u=Xe(u));const i=Qe(new DataView(u),t,s,o);if(i){let c=(yield e.getBytes(i.offset,i.length,l)).data;const m=new DataView(c);return m.getUint8(0)==31&&m.getUint8(1)==139&&(c=Be(new Uint8Array(c))),{data:c}}const f=vr(new DataView(u),{z:t,x:s,y:o});if(f){const a=dr(new DataView(u),f.z,f.x,f.y);if(a){let c=yield r.getArrayBuffer(e,a.offset,a.length,n);n.specVersion===1&&(c=Xe(c));const m=Qe(new DataView(c),t,s,o);if(m){let w=(yield e.getBytes(m.offset,m.length,l)).data;const T=new DataView(w);return T.getUint8(0)==31&&T.getUint8(1)==139&&(w=Be(new Uint8Array(w))),{data:w}}}}})}var Tt={getHeader:yr,getZxy:br},kr=class{constructor(){this.tile=(n,e)=>{if(n.type=="json"){const r=n.url.substr(10);let t=this.tiles.get(r);return t||(t=new et(r),this.tiles.set(r,t)),t.getHeader().then(s=>{const o={tiles:[n.url+"/{z}/{x}/{y}"],minzoom:s.minZoom,maxzoom:s.maxZoom,bounds:[s.minLon,s.minLat,s.maxLon,s.maxLat]};e(null,o,null,null)}).catch(s=>{e(s,null,null,null)}),{cancel:()=>{}}}else{const r=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),t=n.url.match(r);if(!t)throw new Error("Invalid PMTiles protocol URL");const s=t[1];let o=this.tiles.get(s);o||(o=new et(s),this.tiles.set(s,o));const l=t[2],u=t[3],i=t[4],f=new AbortController,a=f.signal;let c=()=>{f.abort()};return o.getHeader().then(m=>{o.getZxy(+l,+u,+i,a).then(p=>{p?e(null,new Uint8Array(p.data),p.cacheControl,p.expires):m.tileType==1?e(null,new Uint8Array,null,null):e(null,null,null,null)}).catch(p=>{p.name!=="AbortError"&&e(p,null,null,null)})}),{cancel:c}}},this.tiles=new Map}add(n){this.tiles.set(n.source.getKey(),n)}get(n){return this.tiles.get(n)}};function le(n,e){return(e>>>0)*4294967296+(n>>>0)}function Tr(n,e){const r=e.buf;let t,s;if(s=r[e.pos++],t=(s&112)>>4,s<128||(s=r[e.pos++],t|=(s&127)<<3,s<128)||(s=r[e.pos++],t|=(s&127)<<10,s<128)||(s=r[e.pos++],t|=(s&127)<<17,s<128)||(s=r[e.pos++],t|=(s&127)<<24,s<128)||(s=r[e.pos++],t|=(s&1)<<31,s<128))return le(n,t);throw new Error("Expected varint not more than 10 bytes")}function ge(n){const e=n.buf;let r,t;return t=e[n.pos++],r=t&127,t<128||(t=e[n.pos++],r|=(t&127)<<7,t<128)||(t=e[n.pos++],r|=(t&127)<<14,t<128)||(t=e[n.pos++],r|=(t&127)<<21,t<128)?r:(t=e[n.pos],r|=(t&15)<<28,Tr(r,n))}function Lr(n,e,r,t){if(t==0){r==1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}var Dr=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Sr(n,e,r){if(n>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,n)-1||r>Math.pow(2,n)-1)throw Error("tile x/y outside zoom level bounds");const t=Dr[n],s=Math.pow(2,n);let o=0,l=0,u=0;const i=[e,r];let f=s/2;for(;f>0;)o=(i[0]&f)>0?1:0,l=(i[1]&f)>0?1:0,u+=f*f*(3*o^l),Lr(f,i,o,l),f=f/2;return t+u}function Lt(n,e){return I(this,null,function*(){if(e===1||e===0)return n;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Be(new Uint8Array(n));{let t=new Response(n).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(t).arrayBuffer()}}else throw Error("Compression method not supported")})}var Ur=127;function Cr(n,e){let r=0,t=n.length-1;for(;r<=t;){const s=t+r>>1,o=e-n[s].tileId;if(o>0)r=s+1;else if(o<0)t=s-1;else return n[s]}return t>=0&&(n[t].runLength===0||e-n[t].tileId<n[t].runLength)?n[t]:null}var Mr=class{constructor(n){this.url=n}getKey(){return this.url}getBytes(n,e,r){return I(this,null,function*(){let t;r||(t=new AbortController,r=t.signal);let s=yield fetch(this.url,{signal:r,headers:{Range:"bytes="+n+"-"+(n+e-1)}});if(s.status===416&&n===0){const u=s.headers.get("Content-Range");if(!u||!u.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const i=+u.substr(8);s=yield fetch(this.url,{signal:r,headers:{Range:"bytes=0-"+(i-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw t&&t.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function H(n,e){const r=n.getUint32(e+4,!0),t=n.getUint32(e+0,!0);return r*Math.pow(2,32)+t}function Br(n,e){const r=new DataView(n),t=r.getUint8(7);if(t>3)throw Error(`Archive is spec version ${t} but this library supports up to spec version 3`);return{specVersion:t,rootDirectoryOffset:H(r,8),rootDirectoryLength:H(r,16),jsonMetadataOffset:H(r,24),jsonMetadataLength:H(r,32),leafDirectoryOffset:H(r,40),leafDirectoryLength:H(r,48),tileDataOffset:H(r,56),tileDataLength:H(r,64),numAddressedTiles:H(r,72),numTileEntries:H(r,80),numTileContents:H(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:e}}function Dt(n){const e={buf:new Uint8Array(n),pos:0},r=ge(e),t=[];let s=0;for(let o=0;o<r;o++){const l=ge(e);t.push({tileId:s+l,offset:0,length:0,runLength:1}),s+=l}for(let o=0;o<r;o++)t[o].runLength=ge(e);for(let o=0;o<r;o++)t[o].length=ge(e);for(let o=0;o<r;o++){const l=ge(e);l===0&&o>0?t[o].offset=t[o-1].offset+t[o-1].length:t[o].offset=l-1}return t}function Er(n){const e=new DataView(n);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var fe=class extends Error{};function Ar(n,e,r,t){return I(this,null,function*(){const s=yield n.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Er(s.data)<3)return[yield Tt.getHeader(n)];const l=s.data.slice(0,Ur);let u=s.etag;t&&s.etag!=t&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+n.getKey()),u=void 0);const i=Br(l,u);if(r){const f=s.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),a=n.getKey()+"|"+(i.etag||"")+"|"+i.rootDirectoryOffset+"|"+i.rootDirectoryLength,c=Dt(yield e(f,i.internalCompression));return[i,[a,c.length,c]]}return[i,void 0]})}function zr(n,e,r,t,s){return I(this,null,function*(){const o=yield n.getBytes(r,t);if(s.etag&&s.etag!==o.etag)throw new fe(o.etag);const l=yield e(o.data,s.internalCompression),u=Dt(l);if(u.length===0)throw new Error("Empty directory is invalid");return u})}var Or=class{constructor(n=100,e=!0,r=Lt){this.cache=new Map,this.maxCacheEntries=n,this.counter=1,this.prefetch=e,this.decompress=r}getHeader(n,e){return I(this,null,function*(){const r=n.getKey();if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const t=new Promise((s,o)=>{Ar(n,this.decompress,this.prefetch,e).then(l=>{l[1]&&this.cache.set(l[1][0],{lastUsed:this.counter++,data:Promise.resolve(l[1][2])}),s(l[0]),this.prune()}).catch(l=>{o(l)})});return this.cache.set(r,{lastUsed:this.counter++,data:t}),t})}getDirectory(n,e,r,t){return I(this,null,function*(){const s=n.getKey()+"|"+(t.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((l,u)=>{zr(n,this.decompress,e,r,t).then(i=>{l(i),this.prune()}).catch(i=>{u(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}getArrayBuffer(n,e,r,t){return I(this,null,function*(){const s=n.getKey()+"|"+(t.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((l,u)=>{n.getBytes(e,r).then(i=>{if(t.etag&&t.etag!==i.etag)throw new fe(i.etag);l(i.data),this.cache.has(s),this.prune()}).catch(i=>{u(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let n=1/0,e;this.cache.forEach((r,t)=>{r.lastUsed<n&&(n=r.lastUsed,e=t)}),e&&this.cache.delete(e)}}invalidate(n,e){return I(this,null,function*(){this.cache.delete(n.getKey()),yield this.getHeader(n,e)})}},et=class{constructor(n,e,r){typeof n=="string"?this.source=new Mr(n):this.source=n,r?this.decompress=r:this.decompress=Lt,e?this.cache=e:this.cache=new Or}getHeader(){return I(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(n,e,r,t){return I(this,null,function*(){const s=Sr(n,e,r),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return Tt.getZxy(o,this.source,this.cache,n,e,r,t);if(n<o.minZoom||n>o.maxZoom)return;let l=o.rootDirectoryOffset,u=o.rootDirectoryLength;for(let i=0;i<=3;i++){const f=yield this.cache.getDirectory(this.source,l,u,o),a=Cr(f,s);if(a)if(a.runLength>0){const c=yield this.source.getBytes(o.tileDataOffset+a.offset,a.length,t);if(o.etag&&o.etag!==c.etag)throw new fe(c.etag);return{data:yield this.decompress(c.data,o.tileCompression),cacheControl:c.cacheControl,expires:c.expires}}else l=o.leafDirectoryOffset+a.offset,u=a.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(n,e,r,t){return I(this,null,function*(){try{return yield this.getZxyAttempt(n,e,r,t)}catch(s){if(s instanceof fe)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(n,e,r,t);throw s}})}getMetadataAttempt(){return I(this,null,function*(){const n=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(n.jsonMetadataOffset,n.jsonMetadataLength);if(n.etag&&n.etag!==e.etag)throw new fe(e.etag);const r=yield this.decompress(e.data,n.internalCompression),t=new TextDecoder("utf-8");return JSON.parse(t.decode(r))})}getMetadata(){return I(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(n){if(n instanceof fe)return this.cache.invalidate(this.source,n.message),yield this.getMetadataAttempt();throw n}})}};function Pr(n){return Ee(()=>{let e=new kr;qe.addProtocol("pmtiles",e.tile)}),ct(()=>{qe.removeProtocol("pmtiles")}),[]}class Nr extends K{constructor(e){super(),G(this,e,Pr,null,q,{})}}function tt(n,e,r){const t=n.slice();return t[15]=e[r],t}function Ir(n){let e;return{c(){e=U("Home")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function nt(n){let e,r;return e=new Rt({props:{errorMessage:n[1]}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),r=!0},p(t,s){const o={};s&2&&(o.errorMessage=t[1]),e.$set(o)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){k(e,t)}}}function rt(n){let e,r,t,s;function o(i){n[10](i)}function l(i){n[11](i)}let u={schemes:n[2]};return n[3]!==void 0&&(u.schemesToBeShown=n[3]),n[4]!==void 0&&(u.filterText=n[4]),e=new ln({props:u}),ee.push(()=>te(e,"schemesToBeShown",o)),ee.push(()=>te(e,"filterText",l)),{c(){y(e.$$.fragment)},m(i,f){b(e,i,f),s=!0},p(i,f){const a={};f&4&&(a.schemes=i[2]),!r&&f&8&&(r=!0,a.schemesToBeShown=i[3],ne(()=>r=!1)),!t&&f&16&&(t=!0,a.filterText=i[4],ne(()=>t=!1)),e.$set(a)},i(i){s||(h(e.$$.fragment,i),s=!0)},o(i){$(e.$$.fragment,i),s=!1},d(i){k(e,i)}}}function st(n){let e,r,t=We(n[2].values()),s=[];for(let l=0;l<t.length;l+=1)s[l]=it(tt(n,t,l));const o=l=>$(s[l],1,1,()=>{s[l]=null});return{c(){e=z("ul");for(let l=0;l<s.length;l+=1)s[l].c()},m(l,u){d(l,e,u);for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(e,null);r=!0},p(l,u){if(u&13){t=We(l[2].values());let i;for(i=0;i<t.length;i+=1){const f=tt(l,t,i);s[i]?(s[i].p(f,u),h(s[i],1)):(s[i]=it(f),s[i].c(),h(s[i],1),s[i].m(e,null))}for($e(),i=t.length;i<s.length;i+=1)o(i);de()}},i(l){if(!r){for(let u=0;u<t.length;u+=1)h(s[u]);r=!0}},o(l){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)$(s[u]);r=!1},d(l){l&&_(e),xt(s,l)}}}function ot(n){let e,r;return e=new Zn({props:{scheme:n[15],authorityNames:n[0]}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),r=!0},p(t,s){const o={};s&4&&(o.scheme=t[15]),s&1&&(o.authorityNames=t[0]),e.$set(o)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){k(e,t)}}}function it(n){let e=n[3].has(n[15].scheme_reference),r,t,s=e&&ot(n);return{c(){s&&s.c(),r=Kt()},m(o,l){s&&s.m(o,l),d(o,r,l),t=!0},p(o,l){l&12&&(e=o[3].has(o[15].scheme_reference)),e?s?(s.p(o,l),l&12&&h(s,1)):(s=ot(o),s.c(),h(s,1),s.m(r.parentNode,r)):s&&($e(),$(s,1,1,()=>{s=null}),de())},i(o){t||(h(s),t=!0)},o(o){$(s),t=!1},d(o){o&&_(r),s&&s.d(o)}}}function Fr(n){let e,r,t,s,o,l,u,i,f,a,c,m,p;r=new ye({props:{$$slots:{default:[Ir]},$$scope:{ctx:n}}}),r.$on("click",n[9]),u=new Jt({props:{boundaryGeojson:n[5]}});let w=n[1]&&nt(n);a=new Ft({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:n[7]}});let T=n[2].size>0&&rt(n),S=n[0]&&st(n);return{c(){e=z("div"),y(r.$$.fragment),t=B(),s=z("div"),o=z("h1"),o.textContent="Browse schemes",l=B(),y(u.$$.fragment),i=B(),w&&w.c(),f=B(),y(a.$$.fragment),c=B(),T&&T.c(),m=B(),S&&S.c(),Je(s,"display","flex"),Je(s,"justify-content","space-between"),R(e,"slot","sidebar"),R(e,"class","govuk-prose")},m(g,v){d(g,e,v),b(r,e,null),C(e,t),C(e,s),C(s,o),C(s,l),b(u,s,null),C(e,i),w&&w.m(e,null),C(e,f),b(a,e,null),C(e,c),T&&T.m(e,null),C(e,m),S&&S.m(e,null),p=!0},p(g,v){const L={};v&262144&&(L.$$scope={dirty:v,ctx:g}),r.$set(L);const M={};v&32&&(M.boundaryGeojson=g[5]),u.$set(M),g[1]?w?(w.p(g,v),v&2&&h(w,1)):(w=nt(g),w.c(),h(w,1),w.m(e,f)):w&&($e(),$(w,1,1,()=>{w=null}),de()),g[2].size>0?T?(T.p(g,v),v&4&&h(T,1)):(T=rt(g),T.c(),h(T,1),T.m(e,m)):T&&($e(),$(T,1,1,()=>{T=null}),de()),g[0]?S?(S.p(g,v),v&1&&h(S,1)):(S=st(g),S.c(),h(S,1),S.m(e,null)):S&&($e(),$(S,1,1,()=>{S=null}),de())},i(g){p||(h(r.$$.fragment,g),h(u.$$.fragment,g),h(w),h(a.$$.fragment,g),h(T),h(S),p=!0)},o(g){$(r.$$.fragment,g),$(u.$$.fragment,g),$(w),$(a.$$.fragment,g),$(T),$(S),p=!1},d(g){g&&_(e),k(r),k(u),w&&w.d(),k(a),T&&T.d(),S&&S.d()}}}function jr(n){let e,r,t,s,o,l,u,i;return e=new Gn({}),t=new dn({}),o=new Dn({}),u=new Pn({}),{c(){y(e.$$.fragment),r=B(),y(t.$$.fragment),s=B(),y(o.$$.fragment),l=B(),y(u.$$.fragment)},m(f,a){b(e,f,a),d(f,r,a),b(t,f,a),d(f,s,a),b(o,f,a),d(f,l,a),b(u,f,a),i=!0},i(f){i||(h(e.$$.fragment,f),h(t.$$.fragment,f),h(o.$$.fragment,f),h(u.$$.fragment,f),i=!0)},o(f){$(e.$$.fragment,f),$(t.$$.fragment,f),$(o.$$.fragment,f),$(u.$$.fragment,f),i=!1},d(f){f&&(_(r),_(s),_(l)),k(e,f),k(t,f),k(o,f),k(u,f)}}}function Vr(n){let e,r,t,s,o,l,u,i;return e=new Wn({}),o=new Qt({props:{small:!0,$$slots:{default:[jr]},$$scope:{ctx:n}}}),u=new Xt({props:{style:n[6]}}),{c(){y(e.$$.fragment),r=B(),t=z("hr"),s=B(),y(o.$$.fragment),l=B(),y(u.$$.fragment)},m(f,a){b(e,f,a),d(f,r,a),d(f,t,a),d(f,s,a),b(o,f,a),d(f,l,a),b(u,f,a),i=!0},p(f,a){const c={};a&262144&&(c.$$scope={dirty:a,ctx:f}),o.$set(c)},i(f){i||(h(e.$$.fragment,f),h(o.$$.fragment,f),h(u.$$.fragment,f),i=!0)},o(f){$(e.$$.fragment,f),$(o.$$.fragment,f),$(u.$$.fragment,f),i=!1},d(f){f&&(_(r),_(t),_(s),_(l)),k(e,f),k(o,f),k(u,f)}}}function Zr(n){let e,r,t,s,o,l,u,i,f,a,c;return e=new Yt({props:{colorInterventions:pt("v1")}}),t=new ce({props:{layer:"interventions-points",tooltip:n[8]}}),o=new ce({props:{layer:"interventions-lines",tooltip:n[8]}}),u=new ce({props:{layer:"interventions-polygons",tooltip:n[8]}}),a=new ze({props:{label:"Layers",open:!0,$$slots:{default:[Vr]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment),r=B(),y(t.$$.fragment),s=B(),y(o.$$.fragment),l=B(),y(u.$$.fragment),i=B(),f=z("div"),y(a.$$.fragment),R(f,"class","top-right svelte-nlvvhu")},m(m,p){b(e,m,p),d(m,r,p),b(t,m,p),d(m,s,p),b(o,m,p),d(m,l,p),b(u,m,p),d(m,i,p),d(m,f,p),b(a,f,null),c=!0},p(m,p){const w={};p&262144&&(w.$$scope={dirty:p,ctx:m}),a.$set(w)},i(m){c||(h(e.$$.fragment,m),h(t.$$.fragment,m),h(o.$$.fragment,m),h(u.$$.fragment,m),h(a.$$.fragment,m),c=!0)},o(m){$(e.$$.fragment,m),$(t.$$.fragment,m),$(o.$$.fragment,m),$(u.$$.fragment,m),$(a.$$.fragment,m),c=!1},d(m){m&&(_(r),_(s),_(l),_(i),_(f)),k(e,m),k(t,m),k(o,m),k(u,m),k(a)}}}function Hr(n){let e,r,t,s,o;return r=new Nr({}),s=new Wt({props:{style:n[6],$$slots:{default:[Zr]},$$scope:{ctx:n}}}),{c(){e=z("div"),y(r.$$.fragment),t=B(),y(s.$$.fragment),R(e,"slot","main")},m(l,u){d(l,e,u),b(r,e,null),C(e,t),b(s,e,null),o=!0},p(l,u){const i={};u&262144&&(i.$$scope={dirty:u,ctx:l}),s.$set(i)},i(l){o||(h(r.$$.fragment,l),h(s.$$.fragment,l),o=!0)},o(l){$(r.$$.fragment,l),$(s.$$.fragment,l),o=!1},d(l){l&&_(e),k(r),k(s)}}}function Rr(n){let e,r;return e=new qt({props:{$$slots:{main:[Hr],sidebar:[Fr]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),r=!0},p(t,[s]){const o={};s&262207&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){k(e,t)}}}function xr(n,e,r){let t,s;X(n,pe,v=>r(12,t=v)),X(n,ue,v=>r(5,s=v));let o=null;Ee(async()=>{jt();let v=await Vt();r(0,o=new Set(v.features.map(L=>L.properties.name)))});let u=new URLSearchParams(window.location.search).get("style")||"dataviz",i="",f=new Map,a=new Set,c="";ct(()=>{ue.set(Zt())});function m(v){try{let L=JSON.parse(v);r(2,f=en(L)),ue.set(L),r(1,i=""),t==null||t.fitBounds(ut(L),{padding:20,animate:!1})}catch(L){r(1,i=`Couldn't load schemes from a file: ${L}`)}}function p(v){let L=v.properties;var M='<div style="max-width: 30vw;">';return M+=`<h2>${w(L.name)} (${L.intervention_type})</h2>`,M+=`<p>Scheme reference: ${L.scheme_reference}</p>`,L.length_meters&&(M+=`<p>Length: ${Ht(L.length_meters)}</p>`),L.description&&(M+=`<p>${w(L.description)}</p>`),M+="</div>",M}function w(v){return c?v.replace(new RegExp(c,"gi"),L=>`<mark>${L}</mark>`):v}const T=()=>window.open("index.html");function S(v){a=v,r(3,a)}function g(v){c=v,r(4,c)}return[o,i,f,a,c,s,u,m,p,T,S,g]}class Kr extends K{constructor(e){super(),G(this,e,xr,Rr,q,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Kr({target:document.getElementById("app")});
