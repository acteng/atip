import{S as K,i as G,s as q,g as y,f as B,e as z,u as U,m as b,j as d,k as C,U as Y,t as h,l as $,p as _,q as k,_ as Q,a2 as ue,r as Ee,b as ee,c as te,F as At,o as ne,a as ye,h as R,v as qe,w as zt,I as ce,C as pe,aW as Ae,a1 as at,G as ze,H as Pt,L as Ot,M as Nt,N as It,aV as re,a7 as ft,x as ut,D as ct,az as Ft,aX as Je,ag as pt,d as jt,X as We,y as $e,n as de,z as Vt,A as Ht,a9 as Zt,aP as Rt,E as xt,V as Xe,W as Kt,ad as Gt}from"./data_getter-8511f901.js";import{C as Pe,S as Ce,d as Oe,j as Ne,H as Ie,h as qt,i as Ye,g as mt,L as Jt,Z as Wt,M as Xt,I as Yt,b as Qt,B as en}from"./Map-d69c92a1.js";function tn(n){let e=new Map;for(let[t,s]of Object.entries(n.schemes))e.set(t,{scheme_reference:t,num_features:0,authority_or_region:s.authority_or_region,capital_scheme_id:s.capital_scheme_id,funding_programme:s.funding_programme});let r=1;for(let t of n.features){let s=e.get(t.properties.scheme_reference);s.num_features++,t.properties.funding_programme=s.funding_programme,t.id=r++}return e}function nn(n){let e;return{c(){e=U("Clear")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function rn(n){let e,r,t,s,o,l;return t=new ye({props:{$$slots:{default:[nn]},$$scope:{ctx:n}}}),t.$on("click",n[11]),{c(){e=z("input"),r=B(),y(t.$$.fragment),R(e,"type","text"),R(e,"class","govuk-input govuk-input--width-10"),R(e,"id","filterText")},m(u,i){d(u,e,i),qe(e,n[0]),d(u,r,i),b(t,u,i),s=!0,o||(l=zt(e,"input",n[10]),o=!0)},p(u,i){i&1&&e.value!==u[0]&&qe(e,u[0]);const f={};i&16384&&(f.$$scope={dirty:i,ctx:u}),t.$set(f)},i(u){s||(h(t.$$.fragment,u),s=!0)},o(u){$(t.$$.fragment,u),s=!1},d(u){u&&(_(e),_(r)),k(t,u),o=!1,l()}}}function sn(n){let e,r,t,s,o,l,u,i;function f(p){n[8](p)}let a={label:"Authority or region",id:"filterAuthority",choices:n[4],emptyOption:!0};n[2]!==void 0&&(a.value=n[2]),e=new Ce({props:a}),ee.push(()=>te(e,"value",f));function c(p){n[9](p)}let m={label:"Funding programme",id:"filterFundingProgramme",choices:n[5],emptyOption:!0};return n[3]!==void 0&&(m.value=n[3]),s=new Ce({props:m}),ee.push(()=>te(s,"value",c)),u=new At({props:{label:"Intervention name or description",id:"filterText",$$slots:{default:[rn]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment),l=B(),y(u.$$.fragment)},m(p,w){b(e,p,w),d(p,t,w),b(s,p,w),d(p,l,w),b(u,p,w),i=!0},p(p,w){const T={};w&16&&(T.choices=p[4]),!r&&w&4&&(r=!0,T.value=p[2],ne(()=>r=!1)),e.$set(T);const S={};w&32&&(S.choices=p[5]),!o&&w&8&&(o=!0,S.value=p[3],ne(()=>o=!1)),s.$set(S);const g={};w&16385&&(g.$$scope={dirty:w,ctx:p}),u.$set(g)},i(p){i||(h(e.$$.fragment,p),h(s.$$.fragment,p),h(u.$$.fragment,p),i=!0)},o(p){$(e.$$.fragment,p),$(s.$$.fragment,p),$(u.$$.fragment,p),i=!1},d(p){p&&(_(t),_(l)),k(e,p),k(s,p),k(u,p)}}}function on(n){let e,r,t,s,o=n[1].size+"",l,u,i=n[6].route+"",f,a,c=n[6].area+"",m,p,w=n[6].crossing+"",T,S,g=n[6].other+"",v,L,M;return e=new Pe({props:{label:"Filters",$$slots:{default:[sn]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment),r=B(),t=z("p"),s=U("Showing "),l=U(o),u=U(" schemes ("),f=U(i),a=U(" routes, "),m=U(c),p=U(` areas,
  `),T=U(w),S=U(" crossings, "),v=U(g),L=U(" other)")},m(D,E){b(e,D,E),d(D,r,E),d(D,t,E),C(t,s),C(t,l),C(t,u),C(t,f),C(t,a),C(t,m),C(t,p),C(t,T),C(t,S),C(t,v),C(t,L),M=!0},p(D,[E]){const P={};E&16445&&(P.$$scope={dirty:E,ctx:D}),e.$set(P),(!M||E&2)&&o!==(o=D[1].size+"")&&Y(l,o),(!M||E&64)&&i!==(i=D[6].route+"")&&Y(f,i),(!M||E&64)&&c!==(c=D[6].area+"")&&Y(m,c),(!M||E&64)&&w!==(w=D[6].crossing+"")&&Y(T,w),(!M||E&64)&&g!==(g=D[6].other+"")&&Y(v,g)},i(D){M||(h(e.$$.fragment,D),M=!0)},o(D){$(e.$$.fragment,D),M=!1},d(D){D&&(_(r),_(t)),k(e,D)}}}function ln(n,e,r){let t;Q(n,ue,g=>r(12,t=g));let{schemes:s}=e,{schemesToBeShown:o=new Set}=e,{filterText:l=""}=e,u=[],i="",f=[],a="",c={area:0,route:0,crossing:0,other:0};Ee(()=>{let g=new Set,v=new Set;for(let L of s.values())L.authority_or_region&&g.add(L.authority_or_region),L.funding_programme&&v.add(L.funding_programme);r(4,u=Array.from(g.entries())),u.sort(),r(5,f=Array.from(v.entries())),f.sort()});function m(g,v,L){let M=g.toLowerCase(),D=P=>{var O,J;if(M&&!((O=P.properties.name)!=null&&O.toLowerCase().includes(M))&&!((J=P.properties.description)!=null&&J.toLowerCase().includes(M)))return!1;if(v||L){let N=s.get(P.properties.scheme_reference);if(v&&N.authority_or_region!=v||L&&N.funding_programme!=L)return!1}return!0};r(1,o=new Set(t.features.filter(D).map(P=>P.properties.scheme_reference))),r(6,c={area:0,route:0,crossing:0,other:0});let E=P=>{var O,J;return!(!o.has(P.properties.scheme_reference)||M&&!((O=P.properties.name)!=null&&O.toLowerCase().includes(M))&&!((J=P.properties.description)!=null&&J.toLowerCase().includes(M)))};ue.update(P=>{for(let O of P.features)E(O)?(delete O.properties.hide_while_editing,r(6,c[O.properties.intervention_type]++,c)):O.properties.hide_while_editing=!0;return P}),r(6,c)}function p(g){i=g,r(2,i)}function w(g){a=g,r(3,a)}function T(){l=this.value,r(0,l)}const S=()=>r(0,l="");return n.$$set=g=>{"schemes"in g&&r(7,s=g.schemes),"schemesToBeShown"in g&&r(1,o=g.schemesToBeShown),"filterText"in g&&r(0,l=g.filterText)},n.$$.update=()=>{n.$$.dirty&13&&m(l,i,a)},[l,o,i,a,u,f,c,s,p,w,T,S]}class an extends K{constructor(e){super(),G(this,e,ln,on,q,{schemes:7,schemesToBeShown:1,filterText:0})}}const X={schools:"#007DBB",hospitals:"#B73D25",mrn:"#006478",parliamentary_constituencies:"#006E59",atf2:"#00AFFF",atf3:"#FF62DC",atf4:"#FFD833"};function fn(n){let e,r,t,s;return e=new Ne({props:{color:n[3]}}),{c(){y(e.$$.fragment),r=B(),t=U(n[1])},m(o,l){b(e,o,l),d(o,r,l),d(o,t,l),s=!0},p(o,l){(!s||l&2)&&Y(t,o[1])},i(o){s||(h(e.$$.fragment,o),s=!0)},o(o){$(e.$$.fragment,o),s=!1},d(o){o&&(_(r),_(t)),k(e,o)}}}function un(n){let e;const r=n[6].default,t=Pt(r,n,n[8],null);return{c(){t&&t.c()},m(s,o){t&&t.m(s,o),e=!0},p(s,o){t&&t.p&&(!e||o&256)&&Ot(t,r,s,s[8],e?It(r,s[8],o,null):Nt(s[8]),null)},i(s){e||(h(t,s),e=!0)},o(s){$(t,s),e=!1},d(s){t&&t.d(s)}}}function cn(n){let e,r,t;return r=new Ie({props:{$$slots:{default:[un]},$$scope:{ctx:n}}}),{c(){e=z("span"),y(r.$$.fragment),R(e,"slot","right")},m(s,o){d(s,e,o),b(r,e,null),t=!0},p(s,o){const l={};o&256&&(l.$$scope={dirty:o,ctx:s}),r.$set(l)},i(s){t||(h(r.$$.fragment,s),t=!0)},o(s){$(r.$$.fragment,s),t=!1},d(s){s&&_(e),k(r)}}}function pn(n){let e,r,t,s,o;function l(i){n[7](i)}let u={id:n[0],$$slots:{right:[cn],default:[fn]},$$scope:{ctx:n}};return n[2]!==void 0&&(u.checked=n[2]),e=new Oe({props:u}),ee.push(()=>te(e,"checked",l)),s=new ce({props:{layer:n[0],tooltip:n[4],show:n[2]}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,f){b(e,i,f),d(i,t,f),b(s,i,f),o=!0},p(i,[f]){const a={};f&1&&(a.id=i[0]),f&258&&(a.$$scope={dirty:f,ctx:i}),!r&&f&4&&(r=!0,a.checked=i[2],ne(()=>r=!1)),e.$set(a);const c={};f&1&&(c.layer=i[0]),f&4&&(c.show=i[2]),s.$set(c)},i(i){o||(h(e.$$.fragment,i),h(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&_(t),k(e,i),k(s,i)}}}function mn(n,e,r){let t;Q(n,pe,p=>r(9,t=p));let{$$slots:s={},$$scope:o}=e,{name:l}=e,{singularNoun:u}=e,{pluralNoun:i}=e,f=X[l];Ae(t,l,`https://atip.uk/layers/v1/${l}.pmtiles`),at(t,{id:l,source:l,sourceLayer:l,color:f,opacity:ze(1,.7)});let a=!1;function c(p){return`<p>${p.properties.name??`Unnamed ${u}`}</p>`}function m(p){a=p,r(2,a)}return n.$$set=p=>{"name"in p&&r(0,l=p.name),"singularNoun"in p&&r(5,u=p.singularNoun),"pluralNoun"in p&&r(1,i=p.pluralNoun),"$$scope"in p&&r(8,o=p.$$scope)},[l,i,a,f,c,u,s,m,o]}class ht extends K{constructor(e){super(),G(this,e,mn,pn,q,{name:0,singularNoun:5,pluralNoun:1})}}function hn(n){let e;return{c(){e=U("hospital")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function gn(n){let e;return{c(){e=U("Open Data Commons Open Database License")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function $n(n){let e,r,t,s,o,l,u,i,f;return t=new re({props:{href:"https://wiki.openstreetmap.org/wiki/Tag:amenity%3Dhospital",$$slots:{default:[hn]},$$scope:{ctx:n}}}),i=new re({props:{href:"https://www.openstreetmap.org/copyright",$$slots:{default:[gn]},$$scope:{ctx:n}}}),{c(){e=z("p"),r=U("This shows "),y(t.$$.fragment),s=U(` data from OpenStreetMap. It doesn't include outpatient clinics
    or individual doctor's offices.`),o=B(),l=z("p"),u=U("License: "),y(i.$$.fragment)},m(a,c){d(a,e,c),C(e,r),b(t,e,null),C(e,s),d(a,o,c),d(a,l,c),C(l,u),b(i,l,null),f=!0},p(a,c){const m={};c&1&&(m.$$scope={dirty:c,ctx:a}),t.$set(m);const p={};c&1&&(p.$$scope={dirty:c,ctx:a}),i.$set(p)},i(a){f||(h(t.$$.fragment,a),h(i.$$.fragment,a),f=!0)},o(a){$(t.$$.fragment,a),$(i.$$.fragment,a),f=!1},d(a){a&&(_(e),_(o),_(l)),k(t),k(i)}}}function dn(n){let e,r;return e=new ht({props:{name:"hospitals",singularNoun:"hospital",pluralNoun:"Hospitals",$$slots:{default:[$n]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),r=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){k(e,t)}}}class _n extends K{constructor(e){super(),G(this,e,null,dn,q,{})}}function wn(n){let e,r,t;return e=new Ne({props:{color:n[1]}}),{c(){y(e.$$.fragment),r=U(`
  MRN`)},m(s,o){b(e,s,o),d(s,r,o),t=!0},p:ut,i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){s&&_(r),k(e,s)}}}function vn(n){let e;return{c(){e=U(`Major Road Network
        `)},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function yn(n){let e;return{c(){e=U("Open Government License")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function bn(n){let e,r,t,s,o,l,u,i,f;return t=new re({props:{href:"https://maps.dft.gov.uk/major-road-network/index.html",$$slots:{default:[vn]},$$scope:{ctx:n}}}),i=new re({props:{href:"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/",$$slots:{default:[yn]},$$scope:{ctx:n}}}),{c(){e=z("p"),r=U("Data from the "),y(t.$$.fragment),s=U("."),o=B(),l=z("p"),u=U("License: "),y(i.$$.fragment)},m(a,c){d(a,e,c),C(e,r),b(t,e,null),C(e,s),d(a,o,c),d(a,l,c),C(l,u),b(i,l,null),f=!0},p(a,c){const m={};c&16&&(m.$$scope={dirty:c,ctx:a}),t.$set(m);const p={};c&16&&(p.$$scope={dirty:c,ctx:a}),i.$set(p)},i(a){f||(h(t.$$.fragment,a),h(i.$$.fragment,a),f=!0)},o(a){$(t.$$.fragment,a),$(i.$$.fragment,a),f=!1},d(a){a&&(_(e),_(o),_(l)),k(t),k(i)}}}function kn(n){let e,r,t;return r=new Ie({props:{$$slots:{default:[bn]},$$scope:{ctx:n}}}),{c(){e=z("span"),y(r.$$.fragment),R(e,"slot","right")},m(s,o){d(s,e,o),b(r,e,null),t=!0},p(s,o){const l={};o&16&&(l.$$scope={dirty:o,ctx:s}),r.$set(l)},i(s){t||(h(r.$$.fragment,s),t=!0)},o(s){$(r.$$.fragment,s),t=!1},d(s){s&&_(e),k(r)}}}function Tn(n){let e,r,t,s,o;function l(i){n[2](i)}let u={id:se,$$slots:{right:[kn],default:[wn]},$$scope:{ctx:n}};return n[0]!==void 0&&(u.checked=n[0]),e=new Oe({props:u}),ee.push(()=>te(e,"checked",l)),s=new ce({props:{layer:se,tooltip:Ln,show:n[0]}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,f){b(e,i,f),d(i,t,f),b(s,i,f),o=!0},p(i,[f]){const a={};f&16&&(a.$$scope={dirty:f,ctx:i}),!r&&f&1&&(r=!0,a.checked=i[0],ne(()=>r=!1)),e.$set(a);const c={};f&1&&(c.show=i[0]),s.$set(c)},i(i){o||(h(e.$$.fragment,i),h(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&_(t),k(e,i),k(s,i)}}}let se="mrn";function Ln(n){return`<p>${n.properties.name??"Unknown MRN road"}</p>`}function Dn(n,e,r){let t;Q(n,pe,u=>r(3,t=u));let s=X.mrn;Ae(t,se,`https://atip.uk/layers/v1/${se}.pmtiles`),ft(t,{id:se,source:se,sourceLayer:se,color:s,width:7,opacity:ze(.5,1)});let o=!1;function l(u){o=u,r(0,o)}return[o,s,l]}class Sn extends K{constructor(e){super(),G(this,e,Dn,Tn,q,{})}}function Un(n){let e,r,t;return e=new Ne({props:{color:n[1]}}),{c(){y(e.$$.fragment),r=U(`
  Parliamentary constituencies`)},m(s,o){b(e,s,o),d(s,r,o),t=!0},p:ut,i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){s&&_(r),k(e,s)}}}function Cn(n){let e;return{c(){e=U(`Ordnance Survey Boundary-Line
        `)},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function Mn(n){let e;return{c(){e=U("Open Government License")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function Bn(n){let e,r,t,s,o,l,u,i,f;return t=new re({props:{href:"https://www.ordnancesurvey.co.uk/products/boundary-line",$$slots:{default:[Cn]},$$scope:{ctx:n}}}),i=new re({props:{href:"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/",$$slots:{default:[Mn]},$$scope:{ctx:n}}}),{c(){e=z("p"),r=U("Data from "),y(t.$$.fragment),s=U("."),o=B(),l=z("p"),u=U("License: "),y(i.$$.fragment)},m(a,c){d(a,e,c),C(e,r),b(t,e,null),C(e,s),d(a,o,c),d(a,l,c),C(l,u),b(i,l,null),f=!0},p(a,c){const m={};c&32&&(m.$$scope={dirty:c,ctx:a}),t.$set(m);const p={};c&32&&(p.$$scope={dirty:c,ctx:a}),i.$set(p)},i(a){f||(h(t.$$.fragment,a),h(i.$$.fragment,a),f=!0)},o(a){$(t.$$.fragment,a),$(i.$$.fragment,a),f=!1},d(a){a&&(_(e),_(o),_(l)),k(t),k(i)}}}function En(n){let e,r,t;return r=new Ie({props:{$$slots:{default:[Bn]},$$scope:{ctx:n}}}),{c(){e=z("span"),y(r.$$.fragment),R(e,"slot","right")},m(s,o){d(s,e,o),b(r,e,null),t=!0},p(s,o){const l={};o&32&&(l.$$scope={dirty:o,ctx:s}),r.$set(l)},i(s){t||(h(r.$$.fragment,s),t=!0)},o(s){$(r.$$.fragment,s),t=!1},d(s){s&&_(e),k(r)}}}function An(n){let e,r,t,s,o;function l(i){n[3](i)}let u={id:x,$$slots:{right:[En],default:[Un]},$$scope:{ctx:n}};return n[0]!==void 0&&(u.checked=n[0]),e=new Oe({props:u}),ee.push(()=>te(e,"checked",l)),s=new ce({props:{layer:x,tooltip:zn,show:n[0]}}),s.$on("click",Pn),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,f){b(e,i,f),d(i,t,f),b(s,i,f),o=!0},p(i,[f]){const a={};f&32&&(a.$$scope={dirty:f,ctx:i}),!r&&f&1&&(r=!0,a.checked=i[0],ne(()=>r=!1)),e.$set(a);const c={};f&1&&(c.show=i[0]),s.$set(c)},i(i){o||(h(e.$$.fragment,i),h(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&_(t),k(e,i),k(s,i)}}}let x="parliamentary_constituencies";function zn(n){return`<p>${n.properties.Name} (${n.properties.Census_Code})</p>`}function Pn(n){window.open(`https://www.ons.gov.uk/visualisations/areas/${n.detail.properties.Census_Code}`,"_blank")}function On(n,e,r){let t;Q(n,pe,i=>r(2,t=i));let s=X.parliamentary_constituencies,o=`${x}-outline`;Ae(t,x,`https://atip.uk/layers/v1/${x}.pmtiles`),at(t,{id:x,source:x,sourceLayer:x,color:s,opacity:ze(.5,.1)}),ft(t,{id:o,source:x,sourceLayer:x,color:s,width:5});let l=!1;function u(i){l=i,r(0,l)}return n.$$.update=()=>{n.$$.dirty&5&&t.getLayer(o)&&t.setLayoutProperty(o,"visibility",l?"visible":"none")},[l,s,t,u]}class Nn extends K{constructor(e){super(),G(this,e,On,An,q,{})}}function In(n){let e;return{c(){e=U("Show on map")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function Fn(n){let e;return{c(){e=U("Edit scheme locally")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function jn(n){let e,r,t=n[0].authority_or_region+"",s,o,l,u,i=n[0].capital_scheme_id+"",f,a,c,m,p=n[0].funding_programme+"",w,T,S,g,v,L,M;return g=new ye({props:{$$slots:{default:[In]},$$scope:{ctx:n}}}),g.$on("click",n[3]),L=new ye({props:{disabled:n[1],title:n[2],$$slots:{default:[Fn]},$$scope:{ctx:n}}}),L.$on("click",n[4]),{c(){e=z("p"),r=U("Authority or region: "),s=U(t),o=B(),l=z("p"),u=U("Capital scheme ID: "),f=U(i),a=B(),c=z("p"),m=U("Funding programme: "),w=U(p),T=B(),S=z("div"),y(g.$$.fragment),v=B(),y(L.$$.fragment),R(S,"class","govuk-button-group")},m(D,E){d(D,e,E),C(e,r),C(e,s),d(D,o,E),d(D,l,E),C(l,u),C(l,f),d(D,a,E),d(D,c,E),C(c,m),C(c,w),d(D,T,E),d(D,S,E),b(g,S,null),C(S,v),b(L,S,null),M=!0},p(D,E){(!M||E&1)&&t!==(t=D[0].authority_or_region+"")&&Y(s,t),(!M||E&1)&&i!==(i=D[0].capital_scheme_id+"")&&Y(f,i),(!M||E&1)&&p!==(p=D[0].funding_programme+"")&&Y(w,p);const P={};E&256&&(P.$$scope={dirty:E,ctx:D}),g.$set(P);const O={};E&256&&(O.$$scope={dirty:E,ctx:D}),L.$set(O)},i(D){M||(h(g.$$.fragment,D),h(L.$$.fragment,D),M=!0)},o(D){$(g.$$.fragment,D),$(L.$$.fragment,D),M=!1},d(D){D&&(_(e),_(o),_(l),_(a),_(c),_(T),_(S)),k(g),k(L)}}}function Vn(n){let e,r;return e=new Pe({props:{label:`${n[0].scheme_reference}: ${n[0].num_features} features`,$$slots:{default:[jn]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),r=!0},p(t,[s]){const o={};s&1&&(o.label=`${t[0].scheme_reference}: ${t[0].num_features} features`),s&257&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){k(e,t)}}}function Hn(n,e,r){let t,s;Q(n,ue,c=>r(6,t=c)),Q(n,pe,c=>r(7,s=c));let{scheme:o}=e,{authorityNames:l}=e,u=!l.has(o.authority_or_region),i=u?"This scheme doesn't have an authority specified correctly, so you can't edit this scheme. We're working to fix this problem.":void 0;function f(){let c={type:"FeatureCollection",features:t.features.filter(m=>m.properties.scheme_reference==o.scheme_reference)};s==null||s.fitBounds(ct(c),{padding:20,animate:!1})}function a(){let c={type:"FeatureCollection",features:t.features.filter(p=>p.properties.scheme_reference==o.scheme_reference)},m=o.authority_or_region;window.localStorage.setItem(m,JSON.stringify(c)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return n.$$set=c=>{"scheme"in c&&r(0,o=c.scheme),"authorityNames"in c&&r(5,l=c.authorityNames)},[o,u,i,f,a,l]}class Zn extends K{constructor(e){super(),G(this,e,Hn,Vn,q,{scheme:0,authorityNames:5})}}function Rn(n){let e;return{c(){e=U("primary and secondary schools")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function xn(n){let e;return{c(){e=U("Open Data Commons Open Database License")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function Kn(n){let e,r,t,s,o,l,u,i,f;return t=new re({props:{href:"https://wiki.openstreetmap.org/wiki/Tag:amenity%3Dschool",$$slots:{default:[Rn]},$$scope:{ctx:n}}}),i=new re({props:{href:"https://www.openstreetmap.org/copyright",$$slots:{default:[xn]},$$scope:{ctx:n}}}),{c(){e=z("p"),r=U("This shows "),y(t.$$.fragment),s=U(` from OpenStreetMap. It doesn't include kindergartens, colleges,
    universities, or other training schools.`),o=B(),l=z("p"),u=U("License: "),y(i.$$.fragment)},m(a,c){d(a,e,c),C(e,r),b(t,e,null),C(e,s),d(a,o,c),d(a,l,c),C(l,u),b(i,l,null),f=!0},p(a,c){const m={};c&1&&(m.$$scope={dirty:c,ctx:a}),t.$set(m);const p={};c&1&&(p.$$scope={dirty:c,ctx:a}),i.$set(p)},i(a){f||(h(t.$$.fragment,a),h(i.$$.fragment,a),f=!0)},o(a){$(t.$$.fragment,a),$(i.$$.fragment,a),f=!1},d(a){a&&(_(e),_(o),_(l)),k(t),k(i)}}}function Gn(n){let e,r;return e=new ht({props:{name:"schools",singularNoun:"school",pluralNoun:"Schools",$$slots:{default:[Kn]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),r=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){k(e,t)}}}class qn extends K{constructor(e){super(),G(this,e,null,Gn,q,{})}}function Jn(n){let e,r,t,s,o;function l(i){n[3](i)}let u={label:"Color interventions",id:"colorInterventions",choices:[["interventionType","By intervention type"],["fundingProgramme","By funding programme"]]};return n[0]!==void 0&&(u.value=n[0]),e=new Ce({props:u}),ee.push(()=>te(e,"value",l)),e.$on("change",n[2]),s=new qt({props:{rows:n[1]}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,f){b(e,i,f),d(i,t,f),b(s,i,f),o=!0},p(i,[f]){const a={};!r&&f&1&&(r=!0,a.value=i[0],ne(()=>r=!1)),e.$set(a);const c={};f&2&&(c.rows=i[1]),s.$set(c)},i(i){o||(h(e.$$.fragment,i),h(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&_(t),k(e,i),k(s,i)}}}function Wn(n,e,r){let t;Q(n,pe,i=>r(4,t=i));let s="interventionType",o=Ye("v1");function l(){let i;s=="interventionType"?(i=mt("v1"),r(1,o=Ye("v1"))):(i=Ft(["get","funding_programme"],{ATF2:X.atf2,ATF3:X.atf3,ATF4:X.atf4},"grey"),r(1,o=[["ATF2",X.atf2],["ATF3",X.atf3],["ATF4",X.atf4]])),t.setPaintProperty("interventions-points","circle-color",i),t.setPaintProperty("interventions-lines","line-color",i),t.setPaintProperty("interventions-polygons","fill-color",i),t.setPaintProperty("interventions-polygon-outlines","line-color",i)}function u(i){s=i,r(0,s)}return[s,o,l,u]}class Xn extends K{constructor(e){super(),G(this,e,Wn,Jn,q,{})}}var I=(n,e,r)=>new Promise((t,s)=>{var o=i=>{try{u(r.next(i))}catch(f){s(f)}},l=i=>{try{u(r.throw(i))}catch(f){s(f)}},u=i=>i.done?t(i.value):Promise.resolve(i.value).then(o,l);u((r=r.apply(n,e)).next())}),j=Uint8Array,ae=Uint16Array,Yn=Int32Array,gt=new j([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),$t=new j([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Qn=new j([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dt=function(n,e){for(var r=new ae(31),t=0;t<31;++t)r[t]=e+=1<<n[t-1];for(var s=new Yn(r[30]),t=1;t<30;++t)for(var o=r[t];o<r[t+1];++o)s[o]=o-r[t]<<5|t;return{b:r,r:s}},_t=dt(gt,2),wt=_t.b,er=_t.r;wt[28]=258,er[258]=28;var tr=dt($t,0),nr=tr.b,Me=new ae(32768);for(A=0;A<32768;++A)W=(A&43690)>>1|(A&21845)<<1,W=(W&52428)>>2|(W&13107)<<2,W=(W&61680)>>4|(W&3855)<<4,Me[A]=((W&65280)>>8|(W&255)<<8)>>1;var W,A,_e=function(n,e,r){for(var t=n.length,s=0,o=new ae(e);s<t;++s)n[s]&&++o[n[s]-1];var l=new ae(e);for(s=1;s<e;++s)l[s]=l[s-1]+o[s-1]<<1;var u;if(r){u=new ae(1<<e);var i=15-e;for(s=0;s<t;++s)if(n[s])for(var f=s<<4|n[s],a=e-n[s],c=l[n[s]-1]++<<a,m=c|(1<<a)-1;c<=m;++c)u[Me[c]>>i]=f}else for(u=new ae(t),s=0;s<t;++s)n[s]&&(u[s]=Me[l[n[s]-1]++]>>15-n[s]);return u},we=new j(288);for(A=0;A<144;++A)we[A]=8;var A;for(A=144;A<256;++A)we[A]=9;var A;for(A=256;A<280;++A)we[A]=7;var A;for(A=280;A<288;++A)we[A]=8;var A,vt=new j(32);for(A=0;A<32;++A)vt[A]=5;var A,rr=_e(we,9,1),sr=_e(vt,5,1),Se=function(n){for(var e=n[0],r=1;r<n.length;++r)n[r]>e&&(e=n[r]);return e},H=function(n,e,r){var t=e/8|0;return(n[t]|n[t+1]<<8)>>(e&7)&r},Ue=function(n,e){var r=e/8|0;return(n[r]|n[r+1]<<8|n[r+2]<<16)>>(e&7)},or=function(n){return(n+7)/8|0},ir=function(n,e,r){(e==null||e<0)&&(e=0),(r==null||r>n.length)&&(r=n.length);var t=new j(r-e);return t.set(n.subarray(e,r)),t},lr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],F=function(n,e,r){var t=new Error(e||lr[n]);if(t.code=n,Error.captureStackTrace&&Error.captureStackTrace(t,F),!r)throw t;return t},Fe=function(n,e,r,t){var s=n.length,o=t?t.length:0;if(!s||e.f&&!e.l)return r||new j(0);var l=!r||e.i!=2,u=e.i;r||(r=new j(s*3));var i=function(xe){var Ke=r.length;if(xe>Ke){var Ge=new j(Math.max(Ke*2,xe));Ge.set(r),r=Ge}},f=e.f||0,a=e.p||0,c=e.b||0,m=e.l,p=e.d,w=e.m,T=e.n,S=s*8;do{if(!m){f=H(n,a,1);var g=H(n,a+1,3);if(a+=3,g)if(g==1)m=rr,p=sr,w=9,T=5;else if(g==2){var D=H(n,a,31)+257,E=H(n,a+10,15)+4,P=D+H(n,a+5,31)+1;a+=14;for(var O=new j(P),J=new j(19),N=0;N<E;++N)J[Qn[N]]=H(n,a+N*3,7);a+=E*3;for(var je=Se(J),Ut=(1<<je)-1,Ct=_e(J,je,1),N=0;N<P;){var Ve=Ct[H(n,a,Ut)];a+=Ve&15;var v=Ve>>4;if(v<16)O[N++]=v;else{var oe=0,ve=0;for(v==16?(ve=3+H(n,a,3),a+=2,oe=O[N-1]):v==17?(ve=3+H(n,a,7),a+=3):v==18&&(ve=11+H(n,a,127),a+=7);ve--;)O[N++]=oe}}var He=O.subarray(0,D),V=O.subarray(D);w=Se(He),T=Se(V),m=_e(He,w,1),p=_e(V,T,1)}else F(1);else{var v=or(a)+4,L=n[v-4]|n[v-3]<<8,M=v+L;if(M>s){u&&F(0);break}l&&i(c+L),r.set(n.subarray(v,M),c),e.b=c+=L,e.p=a=M*8,e.f=f;continue}if(a>S){u&&F(0);break}}l&&i(c+131072);for(var Mt=(1<<w)-1,Bt=(1<<T)-1,ke=a;;ke=a){var oe=m[Ue(n,a)&Mt],ie=oe>>4;if(a+=oe&15,a>S){u&&F(0);break}if(oe||F(2),ie<256)r[c++]=ie;else if(ie==256){ke=a,m=null;break}else{var Ze=ie-254;if(ie>264){var N=ie-257,me=gt[N];Ze=H(n,a,(1<<me)-1)+wt[N],a+=me}var Te=p[Ue(n,a)&Bt],Le=Te>>4;Te||F(3),a+=Te&15;var V=nr[Le];if(Le>3){var me=$t[Le];V+=Ue(n,a)&(1<<me)-1,a+=me}if(a>S){u&&F(0);break}l&&i(c+131072);var De=c+Ze;if(c<V){var Re=o-V,Et=Math.min(V,De);for(Re+c<0&&F(3);c<Et;++c)r[c]=t[Re+c]}for(;c<De;c+=4)r[c]=r[c-V],r[c+1]=r[c+1-V],r[c+2]=r[c+2-V],r[c+3]=r[c+3-V];c=De}}e.l=m,e.p=ke,e.b=c,e.f=f,m&&(f=1,e.m=w,e.d=p,e.n=T)}while(!f);return c==r.length?r:ir(r,0,c)},ar=new j(0),fr=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&F(6,"invalid gzip data");var e=n[3],r=10;e&4&&(r+=(n[10]|n[11]<<8)+2);for(var t=(e>>3&1)+(e>>4&1);t>0;t-=!n[r++]);return r+(e&2)},ur=function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},cr=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&F(6,"invalid zlib data"),(n[1]>>5&1)==+!e&&F(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function pr(n,e){return Fe(n,{i:2},e&&e.out,e&&e.dictionary)}function mr(n,e){var r=fr(n);return r+8>n.length&&F(6,"invalid gzip data"),Fe(n.subarray(r,-8),{i:2},e&&e.out||new j(ur(n)),e&&e.dictionary)}function hr(n,e){return Fe(n.subarray(cr(n,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Be(n,e){return n[0]==31&&n[1]==139&&n[2]==8?mr(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?pr(n,e):hr(n,e)}var gr=typeof TextDecoder<"u"&&new TextDecoder,$r=0;try{gr.decode(ar,{stream:!0}),$r=1}catch{}var yt=(n,e)=>n*Math.pow(2,e),he=(n,e)=>Math.floor(n/Math.pow(2,e)),be=(n,e)=>yt(n.getUint16(e+1,!0),8)+n.getUint8(e),bt=(n,e)=>yt(n.getUint32(e+2,!0),16)+n.getUint16(e,!0),dr=(n,e,r,t,s)=>{if(n!=t.getUint8(s))return n-t.getUint8(s);const o=be(t,s+1);if(e!=o)return e-o;const l=be(t,s+4);return r!=l?r-l:0},_r=(n,e,r,t)=>{const s=kt(n,e|128,r,t);return s?{z:e,x:r,y:t,offset:s[0],length:s[1],is_dir:!0}:null},Qe=(n,e,r,t)=>{const s=kt(n,e,r,t);return s?{z:e,x:r,y:t,offset:s[0],length:s[1],is_dir:!1}:null},kt=(n,e,r,t)=>{let s=0,o=n.byteLength/17-1;for(;s<=o;){const l=o+s>>1,u=dr(e,r,t,n,l*17);if(u>0)s=l+1;else if(u<0)o=l-1;else return[bt(n,l*17+7),n.getUint32(l*17+13,!0)]}return null},wr=(n,e)=>n.is_dir&&!e.is_dir?1:!n.is_dir&&e.is_dir?-1:n.z!==e.z?n.z-e.z:n.x!==e.x?n.x-e.x:n.y-e.y,Tt=(n,e)=>{const r=n.getUint8(e*17);return{z:r&127,x:be(n,e*17+1),y:be(n,e*17+4),offset:bt(n,e*17+7),length:n.getUint32(e*17+13,!0),is_dir:r>>7===1}},et=n=>{const e=[],r=new DataView(n);for(let t=0;t<r.byteLength/17;t++)e.push(Tt(r,t));return vr(e)},vr=n=>{n.sort(wr);const e=new ArrayBuffer(17*n.length),r=new Uint8Array(e);for(let t=0;t<n.length;t++){const s=n[t];let o=s.z;s.is_dir&&(o=o|128),r[t*17]=o,r[t*17+1]=s.x&255,r[t*17+2]=s.x>>8&255,r[t*17+3]=s.x>>16&255,r[t*17+4]=s.y&255,r[t*17+5]=s.y>>8&255,r[t*17+6]=s.y>>16&255,r[t*17+7]=s.offset&255,r[t*17+8]=he(s.offset,8)&255,r[t*17+9]=he(s.offset,16)&255,r[t*17+10]=he(s.offset,24)&255,r[t*17+11]=he(s.offset,32)&255,r[t*17+12]=he(s.offset,48)&255,r[t*17+13]=s.length&255,r[t*17+14]=s.length>>8&255,r[t*17+15]=s.length>>16&255,r[t*17+16]=s.length>>24&255}return e},yr=(n,e)=>{if(n.byteLength<17)return null;const r=n.byteLength/17,t=Tt(n,r-1);if(t.is_dir){const s=t.z,o=e.z-s,l=Math.trunc(e.x/(1<<o)),u=Math.trunc(e.y/(1<<o));return{z:s,x:l,y:u}}return null};function br(n){return I(this,null,function*(){const e=yield n.getBytes(0,512e3),r=new DataView(e.data),t=r.getUint32(4,!0),s=r.getUint16(8,!0),o=new TextDecoder("utf-8"),l=JSON.parse(o.decode(new DataView(e.data,10,t)));let u=0;l.compression==="gzip"&&(u=2);let i=0;"minzoom"in l&&(i=+l.minzoom);let f=0;"maxzoom"in l&&(f=+l.maxzoom);let a=0,c=0,m=0,p=-180,w=-85,T=180,S=85;if(l.bounds){const v=l.bounds.split(",");p=+v[0],w=+v[1],T=+v[2],S=+v[3]}if(l.center){const v=l.center.split(",");a=+v[0],c=+v[1],m=+v[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+t,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:t,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:u,tileType:1,minZoom:i,maxZoom:f,minLon:p,minLat:w,maxLon:T,maxLat:S,centerZoom:m,centerLon:a,centerLat:c,etag:e.etag}})}function kr(n,e,r,t,s,o,l){return I(this,null,function*(){let u=yield r.getArrayBuffer(e,n.rootDirectoryOffset,n.rootDirectoryLength,n);n.specVersion===1&&(u=et(u));const i=Qe(new DataView(u),t,s,o);if(i){let c=(yield e.getBytes(i.offset,i.length,l)).data;const m=new DataView(c);return m.getUint8(0)==31&&m.getUint8(1)==139&&(c=Be(new Uint8Array(c))),{data:c}}const f=yr(new DataView(u),{z:t,x:s,y:o});if(f){const a=_r(new DataView(u),f.z,f.x,f.y);if(a){let c=yield r.getArrayBuffer(e,a.offset,a.length,n);n.specVersion===1&&(c=et(c));const m=Qe(new DataView(c),t,s,o);if(m){let w=(yield e.getBytes(m.offset,m.length,l)).data;const T=new DataView(w);return T.getUint8(0)==31&&T.getUint8(1)==139&&(w=Be(new Uint8Array(w))),{data:w}}}}})}var Lt={getHeader:br,getZxy:kr},Tr=class{constructor(){this.tile=(n,e)=>{if(n.type=="json"){const r=n.url.substr(10);let t=this.tiles.get(r);return t||(t=new tt(r),this.tiles.set(r,t)),t.getHeader().then(s=>{const o={tiles:[n.url+"/{z}/{x}/{y}"],minzoom:s.minZoom,maxzoom:s.maxZoom,bounds:[s.minLon,s.minLat,s.maxLon,s.maxLat]};e(null,o,null,null)}).catch(s=>{e(s,null,null,null)}),{cancel:()=>{}}}else{const r=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),t=n.url.match(r);if(!t)throw new Error("Invalid PMTiles protocol URL");const s=t[1];let o=this.tiles.get(s);o||(o=new tt(s),this.tiles.set(s,o));const l=t[2],u=t[3],i=t[4],f=new AbortController,a=f.signal;let c=()=>{f.abort()};return o.getHeader().then(m=>{o.getZxy(+l,+u,+i,a).then(p=>{p?e(null,new Uint8Array(p.data),p.cacheControl,p.expires):m.tileType==1?e(null,new Uint8Array,null,null):e(null,null,null,null)}).catch(p=>{p.name!=="AbortError"&&e(p,null,null,null)})}),{cancel:c}}},this.tiles=new Map}add(n){this.tiles.set(n.source.getKey(),n)}get(n){return this.tiles.get(n)}};function le(n,e){return(e>>>0)*4294967296+(n>>>0)}function Lr(n,e){const r=e.buf;let t,s;if(s=r[e.pos++],t=(s&112)>>4,s<128||(s=r[e.pos++],t|=(s&127)<<3,s<128)||(s=r[e.pos++],t|=(s&127)<<10,s<128)||(s=r[e.pos++],t|=(s&127)<<17,s<128)||(s=r[e.pos++],t|=(s&127)<<24,s<128)||(s=r[e.pos++],t|=(s&1)<<31,s<128))return le(n,t);throw new Error("Expected varint not more than 10 bytes")}function ge(n){const e=n.buf;let r,t;return t=e[n.pos++],r=t&127,t<128||(t=e[n.pos++],r|=(t&127)<<7,t<128)||(t=e[n.pos++],r|=(t&127)<<14,t<128)||(t=e[n.pos++],r|=(t&127)<<21,t<128)?r:(t=e[n.pos],r|=(t&15)<<28,Lr(r,n))}function Dr(n,e,r,t){if(t==0){r==1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}var Sr=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Ur(n,e,r){if(n>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,n)-1||r>Math.pow(2,n)-1)throw Error("tile x/y outside zoom level bounds");const t=Sr[n],s=Math.pow(2,n);let o=0,l=0,u=0;const i=[e,r];let f=s/2;for(;f>0;)o=(i[0]&f)>0?1:0,l=(i[1]&f)>0?1:0,u+=f*f*(3*o^l),Dr(f,i,o,l),f=f/2;return t+u}function Dt(n,e){return I(this,null,function*(){if(e===1||e===0)return n;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Be(new Uint8Array(n));{let t=new Response(n).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(t).arrayBuffer()}}else throw Error("Compression method not supported")})}var Cr=127;function Mr(n,e){let r=0,t=n.length-1;for(;r<=t;){const s=t+r>>1,o=e-n[s].tileId;if(o>0)r=s+1;else if(o<0)t=s-1;else return n[s]}return t>=0&&(n[t].runLength===0||e-n[t].tileId<n[t].runLength)?n[t]:null}var Br=class{constructor(n){this.url=n}getKey(){return this.url}getBytes(n,e,r){return I(this,null,function*(){let t;r||(t=new AbortController,r=t.signal);let s=yield fetch(this.url,{signal:r,headers:{Range:"bytes="+n+"-"+(n+e-1)}});if(s.status===416&&n===0){const u=s.headers.get("Content-Range");if(!u||!u.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const i=+u.substr(8);s=yield fetch(this.url,{signal:r,headers:{Range:"bytes=0-"+(i-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw t&&t.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function Z(n,e){const r=n.getUint32(e+4,!0),t=n.getUint32(e+0,!0);return r*Math.pow(2,32)+t}function Er(n,e){const r=new DataView(n),t=r.getUint8(7);if(t>3)throw Error(`Archive is spec version ${t} but this library supports up to spec version 3`);return{specVersion:t,rootDirectoryOffset:Z(r,8),rootDirectoryLength:Z(r,16),jsonMetadataOffset:Z(r,24),jsonMetadataLength:Z(r,32),leafDirectoryOffset:Z(r,40),leafDirectoryLength:Z(r,48),tileDataOffset:Z(r,56),tileDataLength:Z(r,64),numAddressedTiles:Z(r,72),numTileEntries:Z(r,80),numTileContents:Z(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:e}}function St(n){const e={buf:new Uint8Array(n),pos:0},r=ge(e),t=[];let s=0;for(let o=0;o<r;o++){const l=ge(e);t.push({tileId:s+l,offset:0,length:0,runLength:1}),s+=l}for(let o=0;o<r;o++)t[o].runLength=ge(e);for(let o=0;o<r;o++)t[o].length=ge(e);for(let o=0;o<r;o++){const l=ge(e);l===0&&o>0?t[o].offset=t[o-1].offset+t[o-1].length:t[o].offset=l-1}return t}function Ar(n){const e=new DataView(n);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var fe=class extends Error{};function zr(n,e,r,t){return I(this,null,function*(){const s=yield n.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Ar(s.data)<3)return[yield Lt.getHeader(n)];const l=s.data.slice(0,Cr);let u=s.etag;t&&s.etag!=t&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+n.getKey()),u=void 0);const i=Er(l,u);if(r){const f=s.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),a=n.getKey()+"|"+(i.etag||"")+"|"+i.rootDirectoryOffset+"|"+i.rootDirectoryLength,c=St(yield e(f,i.internalCompression));return[i,[a,c.length,c]]}return[i,void 0]})}function Pr(n,e,r,t,s){return I(this,null,function*(){const o=yield n.getBytes(r,t);if(s.etag&&s.etag!==o.etag)throw new fe(o.etag);const l=yield e(o.data,s.internalCompression),u=St(l);if(u.length===0)throw new Error("Empty directory is invalid");return u})}var Or=class{constructor(n=100,e=!0,r=Dt){this.cache=new Map,this.maxCacheEntries=n,this.counter=1,this.prefetch=e,this.decompress=r}getHeader(n,e){return I(this,null,function*(){const r=n.getKey();if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const t=new Promise((s,o)=>{zr(n,this.decompress,this.prefetch,e).then(l=>{l[1]&&this.cache.set(l[1][0],{lastUsed:this.counter++,data:Promise.resolve(l[1][2])}),s(l[0]),this.prune()}).catch(l=>{o(l)})});return this.cache.set(r,{lastUsed:this.counter++,data:t}),t})}getDirectory(n,e,r,t){return I(this,null,function*(){const s=n.getKey()+"|"+(t.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((l,u)=>{Pr(n,this.decompress,e,r,t).then(i=>{l(i),this.prune()}).catch(i=>{u(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}getArrayBuffer(n,e,r,t){return I(this,null,function*(){const s=n.getKey()+"|"+(t.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((l,u)=>{n.getBytes(e,r).then(i=>{if(t.etag&&t.etag!==i.etag)throw new fe(i.etag);l(i.data),this.cache.has(s),this.prune()}).catch(i=>{u(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let n=1/0,e;this.cache.forEach((r,t)=>{r.lastUsed<n&&(n=r.lastUsed,e=t)}),e&&this.cache.delete(e)}}invalidate(n,e){return I(this,null,function*(){this.cache.delete(n.getKey()),yield this.getHeader(n,e)})}},tt=class{constructor(n,e,r){typeof n=="string"?this.source=new Br(n):this.source=n,r?this.decompress=r:this.decompress=Dt,e?this.cache=e:this.cache=new Or}getHeader(){return I(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(n,e,r,t){return I(this,null,function*(){const s=Ur(n,e,r),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return Lt.getZxy(o,this.source,this.cache,n,e,r,t);if(n<o.minZoom||n>o.maxZoom)return;let l=o.rootDirectoryOffset,u=o.rootDirectoryLength;for(let i=0;i<=3;i++){const f=yield this.cache.getDirectory(this.source,l,u,o),a=Mr(f,s);if(a)if(a.runLength>0){const c=yield this.source.getBytes(o.tileDataOffset+a.offset,a.length,t);if(o.etag&&o.etag!==c.etag)throw new fe(c.etag);return{data:yield this.decompress(c.data,o.tileCompression),cacheControl:c.cacheControl,expires:c.expires}}else l=o.leafDirectoryOffset+a.offset,u=a.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(n,e,r,t){return I(this,null,function*(){try{return yield this.getZxyAttempt(n,e,r,t)}catch(s){if(s instanceof fe)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(n,e,r,t);throw s}})}getMetadataAttempt(){return I(this,null,function*(){const n=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(n.jsonMetadataOffset,n.jsonMetadataLength);if(n.etag&&n.etag!==e.etag)throw new fe(e.etag);const r=yield this.decompress(e.data,n.internalCompression),t=new TextDecoder("utf-8");return JSON.parse(t.decode(r))})}getMetadata(){return I(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(n){if(n instanceof fe)return this.cache.invalidate(this.source,n.message),yield this.getMetadataAttempt();throw n}})}};function Nr(n){return Ee(()=>{let e=new Tr;Je.addProtocol("pmtiles",e.tile)}),pt(()=>{Je.removeProtocol("pmtiles")}),[]}class Ir extends K{constructor(e){super(),G(this,e,Nr,null,q,{})}}function nt(n,e,r){const t=n.slice();return t[15]=e[r],t}function Fr(n){let e;return{c(){e=U("Home")},m(r,t){d(r,e,t)},d(r){r&&_(e)}}}function rt(n){let e,r;return e=new xt({props:{errorMessage:n[1]}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),r=!0},p(t,s){const o={};s&2&&(o.errorMessage=t[1]),e.$set(o)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){k(e,t)}}}function st(n){let e,r,t,s;function o(i){n[10](i)}function l(i){n[11](i)}let u={schemes:n[2]};return n[3]!==void 0&&(u.schemesToBeShown=n[3]),n[4]!==void 0&&(u.filterText=n[4]),e=new an({props:u}),ee.push(()=>te(e,"schemesToBeShown",o)),ee.push(()=>te(e,"filterText",l)),{c(){y(e.$$.fragment)},m(i,f){b(e,i,f),s=!0},p(i,f){const a={};f&4&&(a.schemes=i[2]),!r&&f&8&&(r=!0,a.schemesToBeShown=i[3],ne(()=>r=!1)),!t&&f&16&&(t=!0,a.filterText=i[4],ne(()=>t=!1)),e.$set(a)},i(i){s||(h(e.$$.fragment,i),s=!0)},o(i){$(e.$$.fragment,i),s=!1},d(i){k(e,i)}}}function ot(n){let e,r,t=Xe(n[2].values()),s=[];for(let l=0;l<t.length;l+=1)s[l]=lt(nt(n,t,l));const o=l=>$(s[l],1,1,()=>{s[l]=null});return{c(){e=z("ul");for(let l=0;l<s.length;l+=1)s[l].c()},m(l,u){d(l,e,u);for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(e,null);r=!0},p(l,u){if(u&13){t=Xe(l[2].values());let i;for(i=0;i<t.length;i+=1){const f=nt(l,t,i);s[i]?(s[i].p(f,u),h(s[i],1)):(s[i]=lt(f),s[i].c(),h(s[i],1),s[i].m(e,null))}for($e(),i=t.length;i<s.length;i+=1)o(i);de()}},i(l){if(!r){for(let u=0;u<t.length;u+=1)h(s[u]);r=!0}},o(l){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)$(s[u]);r=!1},d(l){l&&_(e),Kt(s,l)}}}function it(n){let e,r;return e=new Zn({props:{scheme:n[15],authorityNames:n[0]}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),r=!0},p(t,s){const o={};s&4&&(o.scheme=t[15]),s&1&&(o.authorityNames=t[0]),e.$set(o)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){k(e,t)}}}function lt(n){let e=n[3].has(n[15].scheme_reference),r,t,s=e&&it(n);return{c(){s&&s.c(),r=Gt()},m(o,l){s&&s.m(o,l),d(o,r,l),t=!0},p(o,l){l&12&&(e=o[3].has(o[15].scheme_reference)),e?s?(s.p(o,l),l&12&&h(s,1)):(s=it(o),s.c(),h(s,1),s.m(r.parentNode,r)):s&&($e(),$(s,1,1,()=>{s=null}),de())},i(o){t||(h(s),t=!0)},o(o){$(s),t=!1},d(o){o&&_(r),s&&s.d(o)}}}function jr(n){let e,r,t,s,o,l,u,i,f,a,c,m,p;r=new ye({props:{$$slots:{default:[Fr]},$$scope:{ctx:n}}}),r.$on("click",n[9]),u=new Wt({props:{boundaryGeojson:n[5]}});let w=n[1]&&rt(n);a=new jt({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:n[7]}});let T=n[2].size>0&&st(n),S=n[0]&&ot(n);return{c(){e=z("div"),y(r.$$.fragment),t=B(),s=z("div"),o=z("h1"),o.textContent="Browse schemes",l=B(),y(u.$$.fragment),i=B(),w&&w.c(),f=B(),y(a.$$.fragment),c=B(),T&&T.c(),m=B(),S&&S.c(),We(s,"display","flex"),We(s,"justify-content","space-between"),R(e,"slot","sidebar"),R(e,"class","govuk-prose")},m(g,v){d(g,e,v),b(r,e,null),C(e,t),C(e,s),C(s,o),C(s,l),b(u,s,null),C(e,i),w&&w.m(e,null),C(e,f),b(a,e,null),C(e,c),T&&T.m(e,null),C(e,m),S&&S.m(e,null),p=!0},p(g,v){const L={};v&262144&&(L.$$scope={dirty:v,ctx:g}),r.$set(L);const M={};v&32&&(M.boundaryGeojson=g[5]),u.$set(M),g[1]?w?(w.p(g,v),v&2&&h(w,1)):(w=rt(g),w.c(),h(w,1),w.m(e,f)):w&&($e(),$(w,1,1,()=>{w=null}),de()),g[2].size>0?T?(T.p(g,v),v&4&&h(T,1)):(T=st(g),T.c(),h(T,1),T.m(e,m)):T&&($e(),$(T,1,1,()=>{T=null}),de()),g[0]?S?(S.p(g,v),v&1&&h(S,1)):(S=ot(g),S.c(),h(S,1),S.m(e,null)):S&&($e(),$(S,1,1,()=>{S=null}),de())},i(g){p||(h(r.$$.fragment,g),h(u.$$.fragment,g),h(w),h(a.$$.fragment,g),h(T),h(S),p=!0)},o(g){$(r.$$.fragment,g),$(u.$$.fragment,g),$(w),$(a.$$.fragment,g),$(T),$(S),p=!1},d(g){g&&_(e),k(r),k(u),w&&w.d(),k(a),T&&T.d(),S&&S.d()}}}function Vr(n){let e,r,t,s,o,l,u,i;return e=new qn({}),t=new _n({}),o=new Sn({}),u=new Nn({}),{c(){y(e.$$.fragment),r=B(),y(t.$$.fragment),s=B(),y(o.$$.fragment),l=B(),y(u.$$.fragment)},m(f,a){b(e,f,a),d(f,r,a),b(t,f,a),d(f,s,a),b(o,f,a),d(f,l,a),b(u,f,a),i=!0},i(f){i||(h(e.$$.fragment,f),h(t.$$.fragment,f),h(o.$$.fragment,f),h(u.$$.fragment,f),i=!0)},o(f){$(e.$$.fragment,f),$(t.$$.fragment,f),$(o.$$.fragment,f),$(u.$$.fragment,f),i=!1},d(f){f&&(_(r),_(s),_(l)),k(e,f),k(t,f),k(o,f),k(u,f)}}}function Hr(n){let e,r,t,s,o,l,u,i;return e=new Xn({}),o=new Qt({props:{small:!0,$$slots:{default:[Vr]},$$scope:{ctx:n}}}),u=new en({props:{style:n[6]}}),{c(){y(e.$$.fragment),r=B(),t=z("hr"),s=B(),y(o.$$.fragment),l=B(),y(u.$$.fragment)},m(f,a){b(e,f,a),d(f,r,a),d(f,t,a),d(f,s,a),b(o,f,a),d(f,l,a),b(u,f,a),i=!0},p(f,a){const c={};a&262144&&(c.$$scope={dirty:a,ctx:f}),o.$set(c)},i(f){i||(h(e.$$.fragment,f),h(o.$$.fragment,f),h(u.$$.fragment,f),i=!0)},o(f){$(e.$$.fragment,f),$(o.$$.fragment,f),$(u.$$.fragment,f),i=!1},d(f){f&&(_(r),_(t),_(s),_(l)),k(e,f),k(o,f),k(u,f)}}}function Zr(n){let e,r,t,s,o,l,u,i,f,a,c;return e=new Yt({props:{colorInterventions:mt("v1")}}),t=new ce({props:{layer:"interventions-points",tooltip:n[8]}}),o=new ce({props:{layer:"interventions-lines",tooltip:n[8]}}),u=new ce({props:{layer:"interventions-polygons",tooltip:n[8]}}),a=new Pe({props:{label:"Layers",open:!0,$$slots:{default:[Hr]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment),r=B(),y(t.$$.fragment),s=B(),y(o.$$.fragment),l=B(),y(u.$$.fragment),i=B(),f=z("div"),y(a.$$.fragment),R(f,"class","top-right svelte-nlvvhu")},m(m,p){b(e,m,p),d(m,r,p),b(t,m,p),d(m,s,p),b(o,m,p),d(m,l,p),b(u,m,p),d(m,i,p),d(m,f,p),b(a,f,null),c=!0},p(m,p){const w={};p&262144&&(w.$$scope={dirty:p,ctx:m}),a.$set(w)},i(m){c||(h(e.$$.fragment,m),h(t.$$.fragment,m),h(o.$$.fragment,m),h(u.$$.fragment,m),h(a.$$.fragment,m),c=!0)},o(m){$(e.$$.fragment,m),$(t.$$.fragment,m),$(o.$$.fragment,m),$(u.$$.fragment,m),$(a.$$.fragment,m),c=!1},d(m){m&&(_(r),_(s),_(l),_(i),_(f)),k(e,m),k(t,m),k(o,m),k(u,m),k(a)}}}function Rr(n){let e,r,t,s,o;return r=new Ir({}),s=new Xt({props:{style:n[6],$$slots:{default:[Zr]},$$scope:{ctx:n}}}),{c(){e=z("div"),y(r.$$.fragment),t=B(),y(s.$$.fragment),R(e,"slot","main")},m(l,u){d(l,e,u),b(r,e,null),C(e,t),b(s,e,null),o=!0},p(l,u){const i={};u&262144&&(i.$$scope={dirty:u,ctx:l}),s.$set(i)},i(l){o||(h(r.$$.fragment,l),h(s.$$.fragment,l),o=!0)},o(l){$(r.$$.fragment,l),$(s.$$.fragment,l),o=!1},d(l){l&&_(e),k(r),k(s)}}}function xr(n){let e,r;return e=new Jt({props:{$$slots:{main:[Rr],sidebar:[jr]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),r=!0},p(t,[s]){const o={};s&262207&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){$(e.$$.fragment,t),r=!1},d(t){k(e,t)}}}function Kr(n,e,r){let t,s;Q(n,pe,v=>r(12,t=v)),Q(n,ue,v=>r(5,s=v));let o=null;Ee(async()=>{Vt();let v=await Ht();r(0,o=new Set(v.features.map(L=>L.properties.name)))});let u=new URLSearchParams(window.location.search).get("style")||"dataviz",i="",f=new Map,a=new Set,c="";pt(()=>{ue.set(Zt())});function m(v){try{let L=JSON.parse(v);r(2,f=tn(L)),ue.set(L),r(1,i=""),t==null||t.fitBounds(ct(L),{padding:20,animate:!1})}catch(L){r(1,i=`Couldn't load schemes from a file: ${L}`)}}function p(v){let L=v.properties;var M='<div style="max-width: 30vw;">';return M+=`<h2>${w(L.name)} (${L.intervention_type})</h2>`,M+=`<p>Scheme reference: ${L.scheme_reference}</p>`,L.length_meters&&(M+=`<p>Length: ${Rt(L.length_meters)}</p>`),L.description&&(M+=`<p>${w(L.description)}</p>`),M+="</div>",M}function w(v){return c?v.replace(new RegExp(c,"gi"),L=>`<mark>${L}</mark>`):v}const T=()=>window.open("index.html");function S(v){a=v,r(3,a)}function g(v){c=v,r(4,c)}return[o,i,f,a,c,s,u,m,p,T,S,g]}class Gr extends K{constructor(e){super(),G(this,e,Kr,xr,q,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Gr({target:document.getElementById("app")});
