var oo=Object.defineProperty;var so=(r,e,t)=>e in r?oo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var se=(r,e,t)=>(so(r,typeof e!="symbol"?e+"":e,t),t);import{x as G,s as J,y as xe,S as Y,i as X,M as lo,b as ue,a as Ee,d as I,m as x,k as $e,n as $,o as L,q as N,e as E,c as O,g as w,p as k,f as C,z as fe,B as ce,C as ao,D as Lt,E as nn,F as tt,G as gt,H as bt,I as yt,J as vt,K as wr,h as S,l as q,L as uo,N as fo,O as te,P as co,w as lr,Q as Je,R as we,T as $n,U as pn,V as pe,t as K,W as Re,X as dn,Y as kt,Z as Mn,_ as be,$ as ot,a0 as Qe,a1 as Ln,j as Oe,r as Ae,a2 as Si,a3 as St,a4 as hn,a5 as kr,a6 as po,a7 as ho,a8 as Pe,a9 as mo,aa as _o,ab as Cn,ac as Ct,ad as On,ae as Rn,af as Hn,ag as go,ah as wt,ai as ar,aj as Ke,ak as Et,al as bo,am as ur,an as yo,ao as vo,ap as wo,aq as Sr,ar as mn,as as ko,at as So,au as Eo,A as $o,u as Mo}from"./authorities-d07e0c3c.js";const lt=[];function st(r,e=G){let t;const n=new Set;function i(a){if(J(r,a)&&(r=a,t)){const l=!lt.length;for(const u of n)u[1](),lt.push(u,r);if(l){for(let u=0;u<lt.length;u+=2)lt[u][0](lt[u+1]);lt.length=0}}}function o(a){i(a(r))}function s(a,l=G){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||G),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ce=st(null),Gt=st(null),re=st(xe()),ke=st(null),De=st(null),Ht=st(null),Jt=st(null);function Wt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Er(r){console.log(`Deleting intervention ${r}`),re.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),ke.set(null),De.set(null),Ht.set(null),Jt.set(null)}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ei=Symbol("Comlink.proxy"),Lo=Symbol("Comlink.endpoint"),Co=Symbol("Comlink.releaseProxy"),In=Symbol("Comlink.finalizer"),rn=Symbol("Comlink.thrown"),$i=r=>typeof r=="object"&&r!==null||typeof r=="function",Oo={canHandle:r=>$i(r)&&r[Ei],serialize(r){const{port1:e,port2:t}=new MessageChannel;return fr(r,e),[t,[t]]},deserialize(r){return r.start(),Ci(r)}},Ro={canHandle:r=>$i(r)&&rn in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},Mi=new Map([["proxy",Oo],["throw",Ro]]);function Ao(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function fr(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!Ao(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(nt);let u;try{const f=a.slice(0,-1).reduce((p,c)=>p[c],r),d=a.reduce((p,c)=>p[c],r);switch(s){case"GET":u=d;break;case"SET":f[a.slice(-1)[0]]=nt(i.data.value),u=!0;break;case"APPLY":u=d.apply(f,l);break;case"CONSTRUCT":{const p=new d(...l);u=No(p)}break;case"ENDPOINT":{const{port1:p,port2:c}=new MessageChannel;fr(r,c),u=xo(p,[p])}break;case"RELEASE":u=void 0;break;default:return}}catch(f){u={value:f,[rn]:0}}Promise.resolve(u).catch(f=>({value:f,[rn]:0})).then(f=>{const[d,p]=bn(f);e.postMessage(Object.assign(Object.assign({},d),{id:o}),p),s==="RELEASE"&&(e.removeEventListener("message",n),Li(e),In in r&&typeof r[In]=="function"&&r[In]())}).catch(f=>{const[d,p]=bn({value:new TypeError("Unserializable return value"),[rn]:0});e.postMessage(Object.assign(Object.assign({},d),{id:o}),p)})}),e.start&&e.start()}function To(r){return r.constructor.name==="MessagePort"}function Li(r){To(r)&&r.close()}function Ci(r,e){return Jn(r,[],e)}function Qt(r){if(r)throw new Error("Proxy has been released and is not useable")}function Oi(r){return dt(r,{type:"RELEASE"}).then(()=>{Li(r)})}const _n=new WeakMap,gn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(_n.get(r)||0)-1;_n.set(r,e),e===0&&Oi(r)});function Fo(r,e){const t=(_n.get(e)||0)+1;_n.set(e,t),gn&&gn.register(r,e,r)}function Po(r){gn&&gn.unregister(r)}function Jn(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(Qt(n),s===Co)return()=>{Po(i),Oi(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=dt(r,{type:"GET",path:e.map(l=>l.toString())}).then(nt);return a.then.bind(a)}return Jn(r,[...e,s])},set(o,s,a){Qt(n);const[l,u]=bn(a);return dt(r,{type:"SET",path:[...e,s].map(f=>f.toString()),value:l},u).then(nt)},apply(o,s,a){Qt(n);const l=e[e.length-1];if(l===Lo)return dt(r,{type:"ENDPOINT"}).then(nt);if(l==="bind")return Jn(r,e.slice(0,-1));const[u,f]=$r(a);return dt(r,{type:"APPLY",path:e.map(d=>d.toString()),argumentList:u},f).then(nt)},construct(o,s){Qt(n);const[a,l]=$r(s);return dt(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(nt)}});return Fo(i,r),i}function Io(r){return Array.prototype.concat.apply([],r)}function $r(r){const e=r.map(bn);return[e.map(t=>t[0]),Io(e.map(t=>t[1]))]}const Ri=new WeakMap;function xo(r,e){return Ri.set(r,e),r}function No(r){return Object.assign(r,{[Ei]:!0})}function bn(r){for(const[e,t]of Mi)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},Ri.get(r)||[]]}function nt(r){switch(r.type){case"HANDLER":return Mi.get(r.name).deserialize(r.value);case"RAW":return r.value}}function dt(r,e,t){return new Promise(n=>{const i=jo();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function jo(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Bo(){return new Worker("/atip/layer_lanes/assets/worker-44fb9253.js")}let Z;const Ai=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Ai.decode();let Ft=null;function Nt(){return(Ft===null||Ft.byteLength===0)&&(Ft=new Uint8Array(Z.memory.buffer)),Ft}function Xe(r,e){return r=r>>>0,Ai.decode(Nt().subarray(r,r+e))}const Ge=new Array(128).fill(void 0);Ge.push(void 0,null,!0,!1);let jt=Ge.length;function me(r){jt===Ge.length&&Ge.push(Ge.length+1);const e=jt;return jt=Ge[e],Ge[e]=r,e}function z(r){return Ge[r]}function Do(r){r<132||(Ge[r]=jt,jt=r)}function ht(r){const e=z(r);return Do(r),e}let it=0;const on=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Uo=typeof on.encodeInto=="function"?function(r,e){return on.encodeInto(r,e)}:function(r,e){const t=on.encode(r);return e.set(t),{read:r.length,written:t.length}};function xn(r,e,t){if(t===void 0){const a=on.encode(r),l=e(a.length)>>>0;return Nt().subarray(l,l+a.length).set(a),it=a.length,l}let n=r.length,i=e(n)>>>0;const o=Nt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3)>>>0;const a=Nt().subarray(i+s,i+n),l=Uo(r,a);s+=l.written}return it=s,i}function Ot(r){return r==null}let Pt=null;function le(){return(Pt===null||Pt.byteLength===0)&&(Pt=new Int32Array(Z.memory.buffer)),Pt}let It=null;function qo(){return(It===null||It.byteLength===0)&&(It=new Float64Array(Z.memory.buffer)),It}let xt=null;function Go(){return(xt===null||xt.byteLength===0)&&(xt=new BigInt64Array(Z.memory.buffer)),xt}function zn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=zn(r[0]));for(let s=1;s<i;s++)o+=", "+zn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ho(r,e){const t=e(r.length*1)>>>0;return Nt().set(r,t/1),it=r.length,t}function Nn(r,e){try{return r.apply(this,e)}catch(t){Z.__wbindgen_exn_store(me(t))}}let Yn=class{static __wrap(e){e=e>>>0;const t=Object.create(Yn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Z.__wbg_routeinfo_free(e)}constructor(e){try{const o=Z.__wbindgen_add_to_stack_pointer(-16),s=Ho(e,Z.__wbindgen_malloc),a=it;Z.routeinfo_new(o,s,a);var t=le()[o/4+0],n=le()[o/4+1],i=le()[o/4+2];if(i)throw ht(n);return Yn.__wrap(t)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const f=Z.__wbindgen_add_to_stack_pointer(-16);Z.routeinfo_nameForRoute(f,this.__wbg_ptr,me(e));var i=le()[f/4+0],o=le()[f/4+1],s=le()[f/4+2],a=le()[f/4+3],l=i,u=o;if(a)throw l=0,u=0,ht(s);return t=l,n=u,Xe(l,u)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const f=Z.__wbindgen_add_to_stack_pointer(-16);Z.routeinfo_speedLimitForRoute(f,this.__wbg_ptr,me(e));var i=le()[f/4+0],o=le()[f/4+1],s=le()[f/4+2],a=le()[f/4+3],l=i,u=o;if(a)throw l=0,u=0,ht(s);return t=l,n=u,Xe(l,u)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(t,n)}}allSpeedLimits(){let e,t;try{const u=Z.__wbindgen_add_to_stack_pointer(-16);Z.routeinfo_allSpeedLimits(u,this.__wbg_ptr);var n=le()[u/4+0],i=le()[u/4+1],o=le()[u/4+2],s=le()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,ht(o);return e=a,t=l,Xe(a,l)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(e,t)}}renderLaneDetailsForRoute(e){let t,n;try{const f=Z.__wbindgen_add_to_stack_pointer(-16);Z.routeinfo_renderLaneDetailsForRoute(f,this.__wbg_ptr,me(e));var i=le()[f/4+0],o=le()[f/4+1],s=le()[f/4+2],a=le()[f/4+3],l=i,u=o;if(a)throw l=0,u=0,ht(s);return t=l,n=u,Xe(l,u)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(t,n)}}};async function Jo(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function zo(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Xe(e,t);return me(n)},r.wbg.__wbindgen_object_drop_ref=function(e){ht(e)},r.wbg.__wbindgen_string_get=function(e,t){const n=z(t),i=typeof n=="string"?n:void 0;var o=Ot(i)?0:xn(i,Z.__wbindgen_malloc,Z.__wbindgen_realloc),s=it;le()[e/4+1]=s,le()[e/4+0]=o},r.wbg.__wbindgen_boolean_get=function(e){const t=z(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Xe(e,t));return me(n)},r.wbg.__wbindgen_is_bigint=function(e){return typeof z(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return me(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return z(e)===z(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=z(t),i=typeof n=="number"?n:void 0;qo()[e/8+1]=Ot(i)?0:i,le()[e/4+0]=!Ot(i)},r.wbg.__wbindgen_is_object=function(e){const t=z(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return z(e)in z(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return me(t)},r.wbg.__wbindgen_is_undefined=function(e){return z(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return z(e)==z(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=z(e);return me(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=z(e)[z(t)];return me(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return me(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=z(t).stack,i=xn(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=it;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Xe(e,t))}finally{Z.__wbindgen_free(n,i)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(z(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(z(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(z(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(z(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(z(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=z(e)[t>>>0];return me(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return z(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof z(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=z(e).next;return me(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return Nn(function(e){const t=z(e).next();return me(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return z(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=z(e).value;return me(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return me(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return Nn(function(e,t){const n=Reflect.get(z(e),z(t));return me(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return Nn(function(e,t){const n=z(e).call(z(t));return me(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(z(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=z(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(z(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(z(e));return me(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=z(e).buffer;return me(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(z(e));return me(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){z(e).set(z(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return z(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=z(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=z(t),i=typeof n=="bigint"?n:void 0;Go()[e/8+1]=Ot(i)?BigInt(0):i,le()[e/4+0]=!Ot(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=zn(z(t)),i=xn(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=it;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Xe(e,t))},r.wbg.__wbindgen_memory=function(){const e=Z.memory;return me(e)},r}function Yo(r,e){return Z=r.exports,Ti.__wbindgen_wasm_module=e,xt=null,It=null,Pt=null,Ft=null,Z}async function Ti(r){if(Z!==void 0)return Z;typeof r>"u"&&(r="/atip/layer_lanes/assets/route_info_bg.wasm");const e=zo();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Jo(await r,e);return Yo(t,n)}class Xo{constructor(){se(this,"inner");this.inner=null}async loadFile(e){await Ti(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new Yn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.speedLimitForRoute(e)}allSpeedLimits(){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.allSpeedLimits()}renderLaneDetailsForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return JSON.parse(this.inner.renderLaneDetailsForRoute(e))}}fr(Xo);function Wo(r){let e,t,n,i,o,s,a,l,u,f,d,p,c;return{c(){e=E("p"),e.textContent="For each intervention:",t=O(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=O(),o=E("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=O(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=O(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,f=O(),d=E("p"),d.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,p=O(),c=E("p"),c.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(h,g){w(h,e,g),w(h,t,g),w(h,n,g),w(h,i,g),w(h,o,g),w(h,s,g),w(h,a,g),w(h,l,g),w(h,u,g),w(h,f,g),w(h,d,g),w(h,p,g),w(h,c,g)},p:G,d(h){h&&k(e),h&&k(t),h&&k(n),h&&k(i),h&&k(o),h&&k(s),h&&k(a),h&&k(l),h&&k(u),h&&k(f),h&&k(d),h&&k(p),h&&k(c)}}}function Vo(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Wo]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new lo({props:o}),ue.push(()=>Ee(e,"open",i,r[0])),{c(){I(e.$$.fragment)},m(s,a){x(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function Ko(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Zo extends Y{constructor(e){super(),X(this,e,Ko,Vo,J,{open:0})}}function Mr(r){let e;const t=r[4].default,n=gt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&bt(n,t,i,i[3],e?vt(t,i[3],o,null):yt(i[3]),null)},i(i){e||($(n,i),e=!0)},o(i){L(n,i),e=!1},d(i){n&&n.d(i)}}}function Qo(r){let e,t,n=r[1]&&Mr(r);return{c(){e=E("div"),n&&n.c(),C(e,"class","map svelte-12dpf1u")},m(i,o){w(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&$(n,1)):(n=Mr(i),n.c(),$(n,1),n.m(e,null)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){i&&k(e),n&&n.d(),r[5](null)}}}function es(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;ao("setCamera",!window.location.hash),Lt(()=>{s=new nn.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new nn.ScaleControl({})),s.addControl(new nn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ce.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),tt(()=>{s.remove()});function u(f){ue[f?"unshift":"push"](()=>{a=f,t(0,a)})}return r.$$set=f=>{"style"in f&&t(2,o=f.style),"$$scope"in f&&t(3,i=f.$$scope)},[a,l,o,i,n,u]}class ts extends Y{constructor(e){super(),X(this,e,es,Qo,J,{style:2})}}const ns=r=>({}),Lr=r=>({}),rs=r=>({}),Cr=r=>({}),is=r=>({}),Or=r=>({});function os(r){let e,t,n,i,o,s,a,l,u,f,d,p;const c=r[3].nav,h=gt(c,r,r[2],Or),g=r[3].sidebar,m=gt(g,r,r[2],Cr),y=r[3].main,_=gt(y,r,r[2],Lr);return{c(){e=E("aside"),t=E("div"),n=E("nav"),h&&h.c(),i=O(),m&&m.c(),o=O(),s=E("button"),s.textContent="→",l=O(),u=E("main"),_&&_.c(),C(n,"class","svelte-1u7vg8a"),C(t,"class","sidebar-content content-container svelte-1u7vg8a"),C(s,"type","button"),C(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),C(e,"class",a=wr(r[0]?"":"collapsed")+" svelte-1u7vg8a"),C(u,"class","svelte-1u7vg8a")},m(b,v){w(b,e,v),S(e,t),S(t,n),h&&h.m(n,null),S(t,i),m&&m.m(t,null),S(e,o),S(e,s),w(b,l,v),w(b,u,v),_&&_.m(u,null),f=!0,d||(p=q(s,"click",r[1]),d=!0)},p(b,[v]){h&&h.p&&(!f||v&4)&&bt(h,c,b,b[2],f?vt(c,b[2],v,is):yt(b[2]),Or),m&&m.p&&(!f||v&4)&&bt(m,g,b,b[2],f?vt(g,b[2],v,rs):yt(b[2]),Cr),(!f||v&1&&a!==(a=wr(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&C(e,"class",a),_&&_.p&&(!f||v&4)&&bt(_,y,b,b[2],f?vt(y,b[2],v,ns):yt(b[2]),Lr)},i(b){f||($(h,b),$(m,b),$(_,b),f=!0)},o(b){L(h,b),L(m,b),L(_,b),f=!1},d(b){b&&k(e),h&&h.d(b),m&&m.d(b),b&&k(l),b&&k(u),_&&_.d(b),d=!1,p()}}}function ss(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class ls extends Y{constructor(e){super(),X(this,e,ss,os,J,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function as(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(f){return l([u,f])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(f){u=[6,f],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var et=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function us(r,e){return r>e?1:r<e?-1:0}function ze(r,e,t){for(var n=new et(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function jn(r,e,t,n){var i=new et(r,e);if(t===null)return i.left=i.right=null,i;t=ze(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Rr(r,e,t){var n=null,i=null;if(e){e=ze(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function fs(r,e,t){return e===null?r:(r===null||(e=ze(r.key,e,t),e.left=r),e)}function Xn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Xn(r.left,o,!1,n,i),r.right&&Xn(r.right,o,!0,n,i)}}var cr=function(){function r(e){e===void 0&&(e=us),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=jn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new et(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=ze(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=ze(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=ze(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ze(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ze(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return ps(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Kn(e,t,0,i-1,o),this._root===null)this._root=Wn(e,t,0,i),this._size=i;else{var s=ds(this.toList(),cs(e,t),o);i=this._size+i,this._root=Vn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Xn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Rr(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=jn(t,n,a,i):s=jn(t,n,s,i),this._root=fs(s,a,i)},r.prototype.split=function(e){return Rr(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return as(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Wn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new et(s,a);return l.left=Wn(r,e,t,o),l.right=Wn(r,e,o+1,n),l}return null}function cs(r,e){for(var t=new et(null,null),n=t,i=0;i<r.length;i++)n=n.next=new et(r[i],e[i]);return n.next=null,t.next}function ps(r){for(var e=r,t=[],n=!1,i=new et(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Vn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Vn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Vn(r,i+1,t),s}return null}function ds(r,e,t){for(var n=new et(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Kn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Kn(r,e,t,a,i),Kn(r,e,a+1,n,i)}}function Te(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Ar(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Me(r,e,t){return e&&Ar(r.prototype,e),t&&Ar(r,t),r}var Rt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Zn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},We=Number.EPSILON;We===void 0&&(We=Math.pow(2,-52));var hs=We*We,Qn=function(e,t){if(-We<e&&e<We&&-We<t&&t<We)return 0;var n=e-t;return n*n<hs*e*t?0:e<t?-1:1},ms=function(){function r(){Te(this,r),this.reset()}return Me(r,[{key:"reset",value:function(){this.xRounder=new Tr,this.yRounder=new Tr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Tr=function(){function r(){Te(this,r),this.tree=new cr,this.round(0)}return Me(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Qn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Qn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),zt=new ms,Bt=function(e,t){return e.x*t.y-e.y*t.x},Fi=function(e,t){return e.x*t.x+e.y*t.y},Fr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Bt(i,o);return Qn(s,0)},yn=function(e){return Math.sqrt(Fi(e,e))},_s=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Bt(o,i)/yn(o)/yn(i)},gs=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Fi(o,i)/yn(o)/yn(i)},Pr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Ir=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},bs=function(e,t,n,i){if(t.x===0)return Ir(n,i,e.x);if(i.x===0)return Ir(e,t,n.x);if(t.y===0)return Pr(n,i,e.y);if(i.y===0)return Pr(e,t,n.y);var o=Bt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=Bt(s,t)/o,l=Bt(s,i)/o,u=e.x+l*t.x,f=n.x+a*i.x,d=e.y+l*t.y,p=n.y+a*i.y,c=(u+f)/2,h=(d+p)/2;return{x:c,y:h}},Be=function(){Me(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:vn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Te(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Me(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:_s(n.point,t.point,l.point),cosine:gs(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,f=l.cosine,d=i.get(a),p=d.sine,c=d.cosine;return u>=0&&p>=0?f<c?1:f>c?-1:0:u<0&&p<0?f<c?-1:f>c?1:0:p<u?-1:p>u?1:0}}}]),r}(),ys=0,vn=function(){Me(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,f=t.rightSE.point.y,d=n.rightSE.point.y;if(i<o){if(u<l&&u<f)return 1;if(u>l&&u>f)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var c=n.comparePoint(t.rightSE.point);return c!==0?c:-1}if(i>o){if(l<u&&l<d)return-1;if(l>u&&l>d)return 1;var h=n.comparePoint(t.leftSE.point);if(h!==0)return h;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var m=n.comparePoint(t.rightSE.point);if(m!==0)return m}if(s>a){var y=t.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(s!==a){var _=f-l,b=s-i,v=d-u,M=a-o;if(_>b&&v<M)return 1;if(_<b&&v>M)return-1}return s>a?1:s<a||f<d?-1:f>d?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Te(this,r),this.id=++ys,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Me(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Zn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,f=Rt(n,l)&&this.comparePoint(l)===0,d=Rt(i,s)&&t.comparePoint(s)===0,p=Rt(n,u)&&this.comparePoint(u)===0,c=Rt(i,a)&&t.comparePoint(a)===0;if(d&&f)return c&&!p?a:!c&&p?u:null;if(d)return p&&s.x===u.x&&s.y===u.y?null:s;if(f)return c&&a.x===l.x&&a.y===l.y?null:l;if(c&&p)return null;if(c)return a;if(p)return u;var h=bs(s,this.vector(),l,t.vector());return h===null||!Rt(o,h)?null:zt.round(h.x,h.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Be(t,!0),s=new Be(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Be.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Be.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var f=i.rings[l],d=i.windings[l],p=n.rings.indexOf(f);p===-1?(n.rings.push(f),n.windings.push(d)):n.windings[p]+=d}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],f=n.indexOf(l);f===-1?(n.push(l),i.push(u)):i[f]+=u}for(var d=[],p=[],c=0,h=n.length;c<h;c++)if(i[c]!==0){var g=n[c],m=g.poly;if(p.indexOf(m)===-1)if(g.isExterior)d.push(m);else{p.indexOf(m)===-1&&p.push(m);var y=d.indexOf(g.poly);y!==-1&&d.splice(y,1)}}for(var _=0,b=d.length;_<b;_++){var v=d[_].multiPoly;o.indexOf(v)===-1&&o.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ie.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Ie.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(d){return d.length===1&&d[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ie.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Be.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Be(o,!0),f=new Be(s,!1);return new r(u,f,[i],[a])}}]),r}(),xr=function(){function r(e,t,n){if(Te(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=zt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=zt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(vn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(vn.fromRing(o,i,this))}return Me(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),vs=function(){function r(e,t){if(Te(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new xr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new xr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Me(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Nr=function(){function r(e,t){if(Te(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new vs(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Me(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),ws=function(){Me(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,f=[l],d=l.point,p=[];a=l,l=u,f.push(l),l.point!==d;)for(;;){var c=l.getAvailableLinkedEvents();if(c.length===0){var h=f[0].point,g=f[f.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(c.length===1){u=c[0].otherSE;break}for(var m=null,y=0,_=p.length;y<_;y++)if(p[y].point===l.point){m=y;break}if(m!==null){var b=p.splice(m)[0],v=f.splice(b.index);v.unshift(v[0].otherSE),n.push(new r(v.reverse()));continue}p.push({index:f.length,point:l.point});var M=l.getLeftmostComparator(a);u=c.sort(M)[0].otherSE;break}n.push(new r(f))}}return n}}]);function r(e){Te(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Me(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Fr(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Fr(l,t,u)===0&&n.shift(),n.push(n[0]);for(var f=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,c=[],h=d;h!=p;h+=f)c.push([n[h].x,n[h].y]);return c}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Be.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),jr=function(){function r(e){Te(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Me(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),ks=function(){function r(e){Te(this,r),this.rings=e,this.polys=this._composePolys(e)}return Me(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new jr(s));else{var a=s.enclosingRing();a.poly||n.push(new jr(a)),a.poly.addInterior(s)}}return n}}]),r}(),Ss=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vn.compare;Te(this,r),this.queue=e,this.tree=new cr(t),this.segments=[]}return Me(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var f=null;if(l){var d=l.getIntersection(n);if(d!==null&&(n.isAnEndpoint(d)||(f=d),!l.isAnEndpoint(d)))for(var p=this._splitSafely(l,d),c=0,h=p.length;c<h;c++)i.push(p[c])}var g=null;if(u){var m=u.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(g=m),!u.isAnEndpoint(m)))for(var y=this._splitSafely(u,m),_=0,b=y.length;_<b;_++)i.push(y[_])}if(f!==null||g!==null){var v=null;if(f===null)v=g;else if(g===null)v=f;else{var M=Be.comparePoints(f,g);v=M<=0?f:g}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var R=n.split(v),F=0,A=R.length;F<A;F++)i.push(R[F])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var B=l.getIntersection(u);if(B!==null){if(!l.isAnEndpoint(B))for(var T=this._splitSafely(l,B),D=0,Q=T.length;D<Q;D++)i.push(T[D]);if(!u.isAnEndpoint(B))for(var j=this._splitSafely(u,B),H=0,ae=j.length;H<ae;H++)i.push(j[H])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Br=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Es=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,$s=function(){function r(){Te(this,r)}return Me(r,[{key:"run",value:function(t,n,i){Ie.type=t,zt.reset();for(var o=[new Nr(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Nr(i[s],!1));if(Ie.numMultiPolys=o.length,Ie.type==="difference")for(var l=o[0],u=1;u<o.length;)Zn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Ie.type==="intersection"){for(var f=0,d=o.length;f<d;f++)for(var p=o[f],c=f+1,h=o.length;c<h;c++)if(Zn(p.bbox,o[c].bbox)===null)return[]}for(var g=new cr(Be.compare),m=0,y=o.length;m<y;m++)for(var _=o[m].getSweepEvents(),b=0,v=_.length;b<v;b++)if(g.insert(_[b]),g.size>Br)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new Ss(g),R=g.size,F=g.pop();F;){var A=F.key;if(g.size===R){var B=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(B.id," ")+"[".concat(B.leftSE.point.x,", ").concat(B.leftSE.point.y,"] -> ")+"[".concat(B.rightSE.point.x,", ").concat(B.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Br)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>Es)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var T=M.process(A),D=0,Q=T.length;D<Q;D++){var j=T[D];j.consumedBy===void 0&&g.insert(j)}R=g.size,F=g.pop()}zt.reset();var H=ws.factory(M.segments),ae=new ks(H);return ae.getGeom()}}]),r}(),Ie=new $s,Ms=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ie.run("union",e,n)},Ls=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ie.run("intersection",e,n)},Cs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ie.run("xor",e,n)},Os=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ie.run("difference",e,n)},sn={union:Ms,intersection:Ls,xor:Cs,difference:Os};function Rs(r,e){var t=Ts(e),n=null;return r.type==="FeatureCollection"?n=As(r):n=Pi(sn.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function As(r){var e=r.features.length===2?sn.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):sn.union.apply(sn,r.features.map(function(t){return t.geometry.coordinates}));return Pi(e)}function Pi(r){return uo(r)}function Ts(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return fo(t)}function Fs(r,e,t){let n;te(r,Ce,s=>t(1,n=s));let{boundaryGeojson:i}=e;return co("setCamera")&&n.fitBounds(lr(i),{padding:20,animate:!1}),Je(n,"boundary",Rs(i)),we(n,{id:"boundary",source:"boundary",...$n("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class Ps extends Y{constructor(e){super(),X(this,e,Fs,null,J,{boundaryGeojson:0})}}const _e={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},An=10,Yt=10;function Is(r,e,t){let n;te(r,Ce,u=>t(2,n=u));let{layer:i}=e,{contents:o}=e,s=new nn.Popup({closeButton:!1,closeOnClick:!1});n.on("mousemove",a),n.on("mouseout",l),tt(()=>{n.off("mousemove",a),n.off("mouseout",l),s.remove()});function a(u){if(!n.getLayer(i)){s.remove();return}let f=n.queryRenderedFeatures(u.point,{layers:[i]});f.length>0?s.setLngLat(u.lngLat).setHTML(o(f[0].properties)).addTo(n):s.remove()}function l(){s.remove()}return r.$$set=u=>{"layer"in u&&t(0,i=u.layer),"contents"in u&&t(1,o=u.contents)},[i,o]}class xs extends Y{constructor(e){super(),X(this,e,Is,null,J,{layer:0,contents:1})}}function Dr(r,e,t){const n=r.slice();return n[3]=e[t],n}function Ur(r,e,t){const n=r.slice();return n[6]=e[t],n}function qr(r){let e;return{c(){e=E("td"),C(e,"class","svelte-11t6rxo"),pe(e,"background-color",r[6])},m(t,n){w(t,e,n)},p(t,n){n&1&&pe(e,"background-color",t[6])},d(t){t&&k(e)}}}function Gr(r){let e,t=r[3]+"",n;return{c(){e=E("td"),n=K(t),C(e,"class","svelte-11t6rxo"),pe(e,"width",r[2])},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[3]+"")&&Re(n,t)},d(i){i&&k(e)}}}function Ns(r){let e,t,n,i,o=r[0],s=[];for(let u=0;u<o.length;u+=1)s[u]=qr(Ur(r,o,u));let a=r[1],l=[];for(let u=0;u<a.length;u+=1)l[u]=Gr(Dr(r,a,u));return{c(){e=E("table"),t=E("tr");for(let u=0;u<s.length;u+=1)s[u].c();n=O(),i=E("tr");for(let u=0;u<l.length;u+=1)l[u].c();C(t,"class","svelte-11t6rxo"),C(i,"class","svelte-11t6rxo"),C(e,"class","svelte-11t6rxo")},m(u,f){w(u,e,f),S(e,t);for(let d=0;d<s.length;d+=1)s[d].m(t,null);S(e,n),S(e,i);for(let d=0;d<l.length;d+=1)l[d].m(i,null)},p(u,[f]){if(f&1){o=u[0];let d;for(d=0;d<o.length;d+=1){const p=Ur(u,o,d);s[d]?s[d].p(p,f):(s[d]=qr(p),s[d].c(),s[d].m(t,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=o.length}if(f&6){a=u[1];let d;for(d=0;d<a.length;d+=1){const p=Dr(u,a,d);l[d]?l[d].p(p,f):(l[d]=Gr(p),l[d].c(),l[d].m(i,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},i:G,o:G,d(u){u&&k(e),pn(s,u),pn(l,u)}}}function js(r,e,t){let{colors:n}=e,{labels:i}=e;if(n.length!=i.length)throw new Error("colors and labels must match");let o=`${100/n.length}%`;return r.$$set=s=>{"colors"in s&&t(0,n=s.colors),"labels"in s&&t(1,i=s.labels)},[n,i,o]}class Bs extends Y{constructor(e){super(),X(this,e,js,Ns,J,{colors:0,labels:1})}}const Ds="/atip/layer_lanes/assets/help-d011708a.svg";function Us(r){let e,t;return{c(){e=E("img"),dn(e.src,t=Ds)||C(e,"src",t),C(e,"title",r[0]),C(e,"alt",r[0])},m(n,i){w(n,e,i)},p(n,[i]){i&1&&C(e,"title",n[0]),i&1&&C(e,"alt",n[0])},i:G,o:G,d(n){n&&k(e)}}}function qs(r,e,t){let{contents:n}=e;return r.$$set=i=>{"contents"in i&&t(0,n=i.contents)},[n]}class Ii extends Y{constructor(e){super(),X(this,e,qs,Us,J,{contents:0})}}function Gs(r){let e,t,n,i,o,s,a;return t=new Ii({props:{contents:"Data comes from OpenStreetMap, and may not always be correct. Unexpected values are treated as unknown. Freehand route segments and off-road paths generally have no speed data."}}),i=new Bs({props:{colors:r[0],labels:["< 20","20","30","40",">= 50"]}}),s=new xs({props:{layer:"speed-limits",contents:Js}}),{c(){e=K(`(mph)
`),I(t.$$.fragment),n=O(),I(i.$$.fragment),o=O(),I(s.$$.fragment)},m(l,u){w(l,e,u),x(t,l,u),w(l,n,u),x(i,l,u),w(l,o,u),x(s,l,u),a=!0},p:G,i(l){a||($(t.$$.fragment,l),$(i.$$.fragment,l),$(s.$$.fragment,l),a=!0)},o(l){L(t.$$.fragment,l),L(i.$$.fragment,l),L(s.$$.fragment,l),a=!1},d(l){l&&k(e),N(t,l),l&&k(n),N(i,l),l&&k(o),N(s,l)}}}let Hs="white",at="speed-limits",Bn="speed-limits",At=.8;function Js(r){return r.speed_limit?`${Math.round(r.speed_limit)} mph`:"Unknown"}function zs(r,e,t){let n,i,o;te(r,Ce,f=>t(2,n=f)),te(r,Gt,f=>t(3,i=f)),te(r,re,f=>t(4,o=f));let{id:s}=e,a=["#00AB4D","#8ECA4D","#F7BB00","#BB0000","#470000"];const l=["case",["<",["get","speed_limit"],20],a[0],["==",["get","speed_limit"],20],a[1],["==",["get","speed_limit"],30],a[2],["==",["get","speed_limit"],40],a[3],[">=",["get","speed_limit"],50],a[4],Hs],u=["case",["<",["get","speed_limit"],20],At,["==",["get","speed_limit"],20],At,["==",["get","speed_limit"],30],At,["==",["get","speed_limit"],40],At,[">=",["get","speed_limit"],50],At,0];return Je(n,at,xe()),we(n,{id:Bn,source:at,...kt(l,Yt,u)}),Lt(async()=>{try{if(s){let f=o.features.find(p=>p.id==s),d=JSON.parse(await i.speedLimitForRoute(f.properties.waypoints));n.getSource(at).setData(d)}else{let f=JSON.parse(await i.allSpeedLimits());n.getSource(at).setData(f)}}catch(f){window.alert(`Couldn't calculate speed limits for route: ${f}`)}}),tt(()=>{n.getLayer(Bn)&&n.removeLayer(Bn),n.getSource(at)&&n.removeSource(at)}),r.$$set=f=>{"id"in f&&t(1,s=f.id)},[a,s]}class xi extends Y{constructor(e){super(),X(this,e,zs,Gs,J,{id:1})}}function Ys(r,e,t){let n;te(r,Ce,l=>t(3,n=l));let{source:i}=e,{gj:o}=e,{style:s}=e,a=`${i}-layer`;return Je(n,i,o),we(n,{id:a,source:i,...s}),tt(()=>{n.getLayer(a)&&n.removeLayer(a),n.getSource(i)&&n.removeSource(i)}),r.$$set=l=>{"source"in l&&t(0,i=l.source),"gj"in l&&t(1,o=l.gj),"style"in l&&t(2,s=l.style)},[i,o,s]}class Tn extends Y{constructor(e){super(),X(this,e,Ys,null,J,{source:0,gj:1,style:2})}}function Xs(r){let e,t;return e=new Tn({props:{source:"lane-polygons",gj:r[0],style:r[1]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.gj=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Ws(r,e,t){let{gj:n}=e,i={type:"fill",paint:{"fill-color":Mn("type",{Driving:"black",Parking:"#333333",Sidewalk:"#CCCCCC",Shoulder:"#CCCCCC",Biking:"#0F7D4B",Bus:"#BE4A4C",SharedLeftTurn:"black",Construction:"#FF6D00",LightRail:"#844204",Footway:"#DDDDE8",SharedUse:"#E5E1BB","Buffer(Planters)":"#555555"},"red"),"fill-opacity":.9}};return r.$$set=o=>{"gj"in o&&t(0,n=o.gj)},[n,i]}class Vs extends Y{constructor(e){super(),X(this,e,Ws,Xs,J,{gj:0})}}function Ks(r){let e,t;return e=new Tn({props:{source:"lane-markings",gj:r[0],style:r[1]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.gj=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Zs(r,e,t){let{gj:n}=e,i={type:"fill",paint:{"fill-color":Mn("type",{"center line":"white","lane separator":"white","lane arrow":"white","buffer edge":"white","buffer stripe":"white","vehicle stop line":"white","bike stop line":"green"},"red"),"fill-opacity":.9}};return r.$$set=o=>{"gj"in o&&t(0,n=o.gj)},[n,i]}class Qs extends Y{constructor(e){super(),X(this,e,Zs,Ks,J,{gj:0})}}function el(r){let e,t;return e=new Tn({props:{source:"intersection-polygons",gj:r[0],style:r[1]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.gj=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function tl(r,e,t){let{gj:n}=e,i={type:"fill",filter:["==",["get","type"],"intersection"],paint:{"fill-color":Mn("intersection_kind",{MapEdge:"#696",Terminus:"black",Connection:"black",Fork:"black",Intersection:"black"},"red"),"fill-opacity":.9}};return r.$$set=o=>{"gj"in o&&t(0,n=o.gj)},[n,i]}class nl extends Y{constructor(e){super(),X(this,e,tl,el,J,{gj:0})}}function rl(r){let e,t;return e=new Tn({props:{source:"intersection-markings",gj:r[0],style:r[1]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.gj=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function il(r,e,t){let{gj:n}=e,i={type:"fill",paint:{"fill-color":Mn("type",{"sidewalk corner":"#CCCCCC"},"red"),"fill-opacity":.9}};return r.$$set=o=>{"gj"in o&&t(0,n=o.gj)},[n,i]}class ol extends Y{constructor(e){super(),X(this,e,il,rl,J,{gj:0})}}function Hr(r){let e,t,n,i,o,s,a,l;return e=new Vs({props:{gj:r[0]}}),n=new Qs({props:{gj:r[1]}}),o=new nl({props:{gj:r[2]}}),a=new ol({props:{gj:r[3]}}),{c(){I(e.$$.fragment),t=O(),I(n.$$.fragment),i=O(),I(o.$$.fragment),s=O(),I(a.$$.fragment)},m(u,f){x(e,u,f),w(u,t,f),x(n,u,f),w(u,i,f),x(o,u,f),w(u,s,f),x(a,u,f),l=!0},p(u,f){const d={};f&1&&(d.gj=u[0]),e.$set(d);const p={};f&2&&(p.gj=u[1]),n.$set(p);const c={};f&4&&(c.gj=u[2]),o.$set(c);const h={};f&8&&(h.gj=u[3]),a.$set(h)},i(u){l||($(e.$$.fragment,u),$(n.$$.fragment,u),$(o.$$.fragment,u),$(a.$$.fragment,u),l=!0)},o(u){L(e.$$.fragment,u),L(n.$$.fragment,u),L(o.$$.fragment,u),L(a.$$.fragment,u),l=!1},d(u){N(e,u),u&&k(t),N(n,u),u&&k(i),N(o,u),u&&k(s),N(a,u)}}}function sl(r){let e,t,n,i=r[0]&&Hr(r);return t=new Ii({props:{contents:"This visualizes lane data according to OpenStreetMap. There may be many errors with incorrect or missing lane data, lane width and intersection geometry, and markings. Use with caution."}}),{c(){i&&i.c(),e=O(),I(t.$$.fragment)},m(o,s){i&&i.m(o,s),w(o,e,s),x(t,o,s),n=!0},p(o,[s]){o[0]?i?(i.p(o,s),s&1&&$(i,1)):(i=Hr(o),i.c(),$(i,1),i.m(e.parentNode,e)):i&&(fe(),L(i,1,1,()=>{i=null}),ce())},i(o){n||($(i),$(t.$$.fragment,o),n=!0)},o(o){L(i),L(t.$$.fragment,o),n=!1},d(o){i&&i.d(o),o&&k(e),N(t,o)}}}function ll(r,e,t){let n,i;te(r,Gt,f=>t(5,n=f)),te(r,re,f=>t(6,i=f));let{id:o}=e,s,a,l,u;return Lt(async()=>{try{let f=i.features.find(p=>p.id==o),d=await n.renderLaneDetailsForRoute(f.properties.waypoints);t(0,s=JSON.parse(d[0])),t(1,a=JSON.parse(d[1])),t(2,l=JSON.parse(d[2])),t(3,u=JSON.parse(d[3]))}catch(f){window.alert(`Couldn't render lane details: ${f}`)}}),r.$$set=f=>{"id"in f&&t(4,o=f.id)},[s,a,l,u,o]}class al extends Y{constructor(e){super(),X(this,e,ll,sl,J,{id:4})}}function ul(r){let e,t;return e=new al({props:{id:r[0]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.id=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function fl(r){let e,t;return e=new xi({props:{id:r[0]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.id=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function cl(r){let e,t,n,i,o,s,a,l,u,f,d,p,c;const h=[fl,ul],g=[];function m(y,_){return y[1]=="speed limits"?0:y[1]=="lane details"?1:-1}return~(l=m(r))&&(u=g[l]=h[l](r)),{c(){e=E("label"),t=K(`Show details:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",s=E("option"),s.textContent="Lane details",a=O(),u&&u.c(),f=be(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,s.__value="lane details",s.value=s.__value,r[1]===void 0&&ot(()=>r[2].call(n))},m(y,_){w(y,e,_),S(e,t),S(e,n),S(n,i),S(n,o),S(n,s),Qe(n,r[1]),w(y,a,_),~l&&g[l].m(y,_),w(y,f,_),d=!0,p||(c=q(n,"change",r[2]),p=!0)},p(y,[_]){_&2&&Qe(n,y[1]);let b=l;l=m(y),l===b?~l&&g[l].p(y,_):(u&&(fe(),L(g[b],1,1,()=>{g[b]=null}),ce()),~l?(u=g[l],u?u.p(y,_):(u=g[l]=h[l](y),u.c()),$(u,1),u.m(f.parentNode,f)):u=null)},i(y){d||($(u),d=!0)},o(y){L(u),d=!1},d(y){y&&k(e),y&&k(a),~l&&g[l].d(y),y&&k(f),p=!1,c()}}}function pl(r,e,t){let{id:n}=e,i="none";function o(){i=Ln(this),t(1,i)}return r.$$set=s=>{"id"in s&&t(0,n=s.id)},[n,i,o]}class dl extends Y{constructor(e){super(),X(this,e,pl,cl,J,{id:0})}}function Jr(r){let e,t=zr(r[4])+"",n,i,o,s,a,l,u,f,d,p;return u=new dl({props:{id:r[3]}}),{c(){e=K("Length: "),n=K(t),i=O(),o=E("br"),s=E("button"),s.textContent="Auto-fill details",a=E("br"),l=O(),I(u.$$.fragment),C(s,"type","button")},m(c,h){w(c,e,h),w(c,n,h),w(c,i,h),w(c,o,h),w(c,s,h),w(c,a,h),w(c,l,h),x(u,c,h),f=!0,d||(p=q(s,"click",r[13]),d=!0)},p(c,h){(!f||h&16)&&t!==(t=zr(c[4])+"")&&Re(n,t);const g={};h&8&&(g.id=c[3]),u.$set(g)},i(c){f||($(u.$$.fragment,c),f=!0)},o(c){L(u.$$.fragment,c),f=!1},d(c){c&&k(e),c&&k(n),c&&k(i),c&&k(o),c&&k(s),c&&k(a),c&&k(l),N(u,c),d=!1,p()}}}function hl(r){let e,t,n,i,o,s,a,l,u,f,d,p,c,h,g,m,y,_,b,v,M,R,F,A,B,T,D,Q,j,H,ae,Se,Fe,oe,ie,Ne,Le,ee,he,Kt,ge=r[4]&&Jr(r);return{c(){e=E("label"),t=K("Name:"),n=E("br"),i=O(),o=E("input"),s=O(),a=E("br"),l=O(),u=E("br"),f=O(),d=E("label"),p=E("input"),c=K(`
  Area`),h=O(),g=E("label"),m=E("input"),y=K(`
  Route`),_=O(),b=E("label"),v=E("input"),M=K(`
  Crossing`),R=O(),F=E("label"),A=E("input"),B=K(`
  Other`),T=O(),D=E("br"),Q=O(),j=E("br"),H=O(),ae=E("label"),Se=K("Description:"),Fe=E("br"),oe=O(),ie=E("textarea"),Ne=O(),ge&&ge.c(),Le=be(),C(o,"type","text"),pe(o,"width","100%"),C(p,"type","radio"),p.__value="area",p.value=p.__value,r[8][0].push(p),C(m,"type","radio"),m.__value="route",m.value=m.__value,r[8][0].push(m),C(v,"type","radio"),v.__value="crossing",v.value=v.__value,r[8][0].push(v),C(A,"type","radio"),A.__value="other",A.value=A.__value,r[8][0].push(A),pe(ie,"width","100%"),C(ie,"rows","5"),C(ie,"class","svelte-15lna0i")},m(P,ne){w(P,e,ne),S(e,t),S(e,n),S(e,i),S(e,o),Oe(o,r[0]),w(P,s,ne),w(P,a,ne),w(P,l,ne),w(P,u,ne),w(P,f,ne),w(P,d,ne),S(d,p),p.checked=p.__value===r[1],S(d,c),w(P,h,ne),w(P,g,ne),S(g,m),m.checked=m.__value===r[1],S(g,y),w(P,_,ne),w(P,b,ne),S(b,v),v.checked=v.__value===r[1],S(b,M),w(P,R,ne),w(P,F,ne),S(F,A),A.checked=A.__value===r[1],S(F,B),w(P,T,ne),w(P,D,ne),w(P,Q,ne),w(P,j,ne),w(P,H,ne),w(P,ae,ne),S(ae,Se),S(ae,Fe),S(ae,oe),S(ae,ie),Oe(ie,r[2]),w(P,Ne,ne),ge&&ge.m(P,ne),w(P,Le,ne),ee=!0,he||(Kt=[q(o,"input",r[6]),q(p,"change",r[7]),q(m,"change",r[9]),q(v,"change",r[10]),q(A,"change",r[11]),q(ie,"input",r[12])],he=!0)},p(P,[ne]){ne&1&&o.value!==P[0]&&Oe(o,P[0]),ne&2&&(p.checked=p.__value===P[1]),ne&2&&(m.checked=m.__value===P[1]),ne&2&&(v.checked=v.__value===P[1]),ne&2&&(A.checked=A.__value===P[1]),ne&4&&Oe(ie,P[2]),P[4]?ge?(ge.p(P,ne),ne&16&&$(ge,1)):(ge=Jr(P),ge.c(),$(ge,1),ge.m(Le.parentNode,Le)):ge&&(fe(),L(ge,1,1,()=>{ge=null}),ce())},i(P){ee||($(ge),ee=!0)},o(P){L(ge),ee=!1},d(P){P&&k(e),P&&k(s),P&&k(a),P&&k(l),P&&k(u),P&&k(f),P&&k(d),r[8][0].splice(r[8][0].indexOf(p),1),P&&k(h),P&&k(g),r[8][0].splice(r[8][0].indexOf(m),1),P&&k(_),P&&k(b),r[8][0].splice(r[8][0].indexOf(v),1),P&&k(R),P&&k(F),r[8][0].splice(r[8][0].indexOf(A),1),P&&k(T),P&&k(D),P&&k(Q),P&&k(j),P&&k(H),P&&k(ae),P&&k(Ne),ge&&ge.d(P),P&&k(Le),he=!1,Ae(Kt)}}}function zr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function ml(r,e,t){let n,i;te(r,Gt,b=>t(14,n=b)),te(r,re,b=>t(15,i=b));let{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function f(){let b=i.features.find(v=>v.id==o);try{t(0,s=await n.nameForRoute(b))}catch(v){window.alert(`Couldn't auto-name route: ${v}`)}}const d=[[]];function p(){s=this.value,t(0,s)}function c(){a=this.__value,t(1,a)}function h(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function m(){a=this.__value,t(1,a)}function y(){l=this.value,t(2,l)}const _=()=>f();return r.$$set=b=>{"id"in b&&t(3,o=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(4,u=b.length_meters)},[s,a,l,o,u,f,p,c,d,h,g,m,y,_]}class _l extends Y{constructor(e){super(),X(this,e,ml,hl,J,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}const gl="Intervention",bl=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],yl={name:gl,oneOf:bl};function vl(r){const e=r-1;return e*e*e+1}function $t(r,{delay:e=0,duration:t=400,easing:n=vl}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),f=parseFloat(i.marginBottom),d=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:c=>`overflow: hidden;opacity: ${Math.min(c*20,1)*o};height: ${c*s}px;padding-top: ${c*a}px;padding-bottom: ${c*l}px;margin-top: ${c*u}px;margin-bottom: ${c*f}px;border-top-width: ${c*d}px;border-bottom-width: ${c*p}px;`}}function Ni(r){return"members"in r}function ji(r){return"oneOf"in r}function Bi(r){return typeof r=="string"}function Di(r){return typeof r=="object"&&"value"in r}function wl(r){return"type"in r&&r.type=="number"}function Ui(r){return"type"in r&&r.type=="one-liner"}function qi(r){return"type"in r&&r.type=="textbox"}function Gi(r){return"type"in r&&r.type=="checkbox"}function Yr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Xr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Wr(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=K(t),C(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&Re(n,t)},d(i){i&&k(e)}}}function kl(r){let e,t,n;return{c(){e=E("input"),C(e,"type","checkbox")},m(i,o){w(i,e,o),e.checked=r[0],t||(n=q(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function Sl(r){let e,t,n;return{c(){e=E("textarea"),pe(e,"width","100%"),C(e,"rows","5"),C(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),Oe(e,r[0]),t||(n=q(e,"input",r[13]),t=!0)},p(i,o){o&1&&Oe(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function El(r){let e,t,n;return{c(){e=E("input"),C(e,"type","text"),pe(e,"width","100%")},m(i,o){w(i,e,o),Oe(e,r[0]),t||(n=q(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Oe(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function $l(r){let e,t,n;return{c(){e=E("input"),C(e,"type","number")},m(i,o){w(i,e,o),Oe(e,r[0]),t||(n=q(e,"input",r[11]),t=!0)},p(i,o){o&1&&Si(e.value)!==i[0]&&Oe(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function Ml(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=Kr(Yr(r,n,s));const o=s=>L(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=be()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Yr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=Kr(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(fe(),l=n.length;l<i.length;l+=1)o(l);ce()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)L(i[a]);t=!1},d(s){pn(i,s),s&&k(e)}}}function Ll(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=Zr(Xr(r,n,s));const o=s=>L(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=be()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Xr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=Zr(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(fe(),l=n.length;l<i.length;l+=1)o(l);ce()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)L(i[a]);t=!1},d(s){pn(i,s),s&&k(e)}}}function Cl(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,f,d,p,c=r[2]==r[15].name&&typeof r[0]=="object"&&Vr(r);return{c(){e=E("label"),t=E("input"),i=O(),s=K(o),a=E("br"),l=O(),c&&c.c(),u=be(),C(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(h,g){w(h,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),w(h,l,g),c&&c.m(h,g),w(h,u,g),f=!0,d||(p=[q(t,"change",r[9]),q(t,"change",r[4])],d=!0)},p(h,g){(!f||g&2&&n!==(n=h[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),(!f||g&2)&&o!==(o=h[15].name+"")&&Re(s,o),h[2]==h[15].name&&typeof h[0]=="object"?c?(c.p(h,g),g&7&&$(c,1)):(c=Vr(h),c.c(),$(c,1),c.m(u.parentNode,u)):c&&(fe(),L(c,1,1,()=>{c=null}),ce())},i(h){f||($(c),f=!0)},o(h){L(c),f=!1},d(h){h&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),h&&k(l),c&&c.d(h),h&&k(u),d=!1,Ae(p)}}}function Ol(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,f;function d(h,g){return h[15].description?Tl:Al}let p=d(r),c=p(r);return{c(){e=E("label"),t=E("input"),i=O(),s=K(o),a=O(),c.c(),l=O(),C(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(h,g){w(h,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),c.m(e,null),S(e,l),u||(f=[q(t,"change",r[8]),q(t,"change",r[3])],u=!0)},p(h,g){g&2&&n!==(n=h[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),g&2&&o!==(o=h[15].value+"")&&Re(s,o),p===(p=d(h))&&c?c.p(h,g):(c.d(1),c=p(h),c&&(c.c(),c.m(e,l)))},i:G,o:G,d(h){h&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),c.d(),u=!1,Ae(f)}}}function Rl(r){let e,t,n,i,o=r[15]+"",s,a,l,u,f,d;return{c(){e=E("label"),t=E("input"),i=O(),s=K(o),a=O(),l=E("br"),u=O(),C(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(p,c){w(p,e,c),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),S(e,l),S(e,u),f||(d=[q(t,"change",r[6]),q(t,"change",r[3])],f=!0)},p(p,c){c&2&&n!==(n=p[15])&&(t.__value=n,t.value=t.__value),c&4&&(t.checked=t.__value===p[2]),c&2&&o!==(o=p[15]+"")&&Re(s,o)},i:G,o:G,d(p){p&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),f=!1,Ae(d)}}}function Vr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Vt({props:l}),ue.push(()=>Ee(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),I(t.$$.fragment),i=O(),C(e,"class","svelte-1b72l00")},m(u,f){w(u,e,f),x(t,e,null),S(e,i),s=!0},p(u,f){r=u;const d={};f&2&&(d.spec=r[15]),!n&&f&3&&(n=!0,d.value=r[0][r[15].name],$e(()=>n=!1)),t.$set(d)},i(u){s||($(t.$$.fragment,u),ot(()=>{o||(o=St(e,$t,{duration:500},!0)),o.run(1)}),s=!0)},o(u){L(t.$$.fragment,u),o||(o=St(e,$t,{duration:500},!1)),o.run(0),s=!1},d(u){u&&k(e),N(t),u&&o&&o.end()}}}function Al(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Tl(r){let e,t,n=r[15].description+"",i,o;return{c(){e=E("p"),t=K("("),i=K(n),o=K(")"),C(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,i),S(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&Re(i,n)},d(s){s&&k(e)}}}function Kr(r){let e,t,n,i,o,s;const a=[Rl,Ol,Cl],l=[];function u(f,d){return d&2&&(e=null),d&2&&(t=null),e==null&&(e=!!Bi(f[15])),e?0:(t==null&&(t=!!Di(f[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=be()},m(f,d){l[n].m(f,d),w(f,o,d),s=!0},p(f,d){let p=n;n=u(f,d),n===p?l[n].p(f,d):(fe(),L(l[p],1,1,()=>{l[p]=null}),ce(),i=l[n],i?i.p(f,d):(i=l[n]=a[n](f),i.c()),$(i,1),i.m(o.parentNode,o))},i(f){s||($(i),s=!0)},o(f){L(i),s=!1},d(f){l[n].d(f),f&&k(o)}}}function Zr(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function f(p){r[5](p,r[15])}let d={spec:r[15]};return r[0][r[15].name]!==void 0&&(d.value=r[0][r[15].name]),s=new Vt({props:d}),ue.push(()=>Ee(s,"value",f,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),i=K(n),o=O(),I(s.$$.fragment),l=O(),C(e,"class","svelte-1b72l00")},m(p,c){w(p,e,c),S(e,t),S(t,i),S(e,o),x(s,e,null),S(e,l),u=!0},p(p,c){r=p,(!u||c&2)&&n!==(n=r[15].name+"")&&Re(i,n);const h={};c&2&&(h.spec=r[15]),!a&&c&3&&(a=!0,h.value=r[0][r[15].name],$e(()=>a=!1)),s.$set(h)},i(p){u||($(s.$$.fragment,p),u=!0)},o(p){L(s.$$.fragment,p),u=!1},d(p){p&&k(e),N(s)}}}function Fl(r){let e,t,n,i,o,s,a,l,u,f,d,p=r[1].description&&Wr(r);const c=[Ll,Ml,$l,El,Sl,kl],h=[];function g(m,y){return y&2&&(t=null),y&2&&(n=null),y&2&&(i=null),y&2&&(o=null),y&2&&(s=null),y&2&&(a=null),t==null&&(t=!!Ni(m[1])),t?0:(n==null&&(n=!!ji(m[1])),n?1:(i==null&&(i=!!wl(m[1])),i?2:(o==null&&(o=!!Ui(m[1])),o?3:(s==null&&(s=!!qi(m[1])),s?4:(a==null&&(a=!!Gi(m[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=h[l]=c[l](r)),{c(){p&&p.c(),e=O(),u&&u.c(),f=be()},m(m,y){p&&p.m(m,y),w(m,e,y),~l&&h[l].m(m,y),w(m,f,y),d=!0},p(m,[y]){m[1].description?p?p.p(m,y):(p=Wr(m),p.c(),p.m(e.parentNode,e)):p&&(p.d(1),p=null);let _=l;l=g(m,y),l===_?~l&&h[l].p(m,y):(u&&(fe(),L(h[_],1,1,()=>{h[_]=null}),ce()),~l?(u=h[l],u?u.p(m,y):(u=h[l]=c[l](m),u.c()),$(u,1),u.m(f.parentNode,f)):u=null)},i(m){d||($(u),d=!0)},o(m){L(u),d=!1},d(m){p&&p.d(m),m&&k(e),~l&&h[l].d(m),m&&k(f)}}}function Pl(r,e,t){var _,b,v;let{spec:n}=e,{value:i}=e,o="";if(Ni(n)){i||(i={});for(let M of n.members)Ui(M)||qi(M)?i[_=M.name]||(i[_]=""):Gi(M)?i[b=M.name]||(i[b]=!1):i[v=M.name]||(i[v]={})}else ji(n)&&(i||(i={}),Bi(i)?o=i:Di(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,R){r.$$.not_equal(i[R.name],M)&&(i[R.name]=M,t(0,i))}function f(){o=this.__value,t(2,o)}function d(){o=this.__value,t(2,o)}function p(){o=this.__value,t(2,o)}function c(M,R){r.$$.not_equal(i[R.name],M)&&(i[R.name]=M,t(0,i))}function h(){i=Si(this.value),t(0,i)}function g(){i=this.value,t(0,i)}function m(){i=this.value,t(0,i)}function y(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,f,l,d,p,c,h,g,m,y]}class Vt extends Y{constructor(e){super(),X(this,e,Pl,Fl,J,{spec:1,value:0})}}function Il(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Vt({props:o}),ue.push(()=>Ee(e,"value",i,r[0].v2)),{c(){I(e.$$.fragment)},m(s,a){x(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function xl(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=yl;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Nl extends Y{constructor(e){super(),X(this,e,xl,Il,J,{props:0})}}const jl="Planning",Bl=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],Dl={name:jl,members:Bl};function Ul(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Vt({props:o}),ue.push(()=>Ee(e,"value",i,r[0].planning)),{c(){I(e.$$.fragment)},m(s,a){x(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function ql(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=Dl;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Gl extends Y{constructor(e){super(),X(this,e,ql,Ul,J,{props:0})}}const Hl="CriticalIssue",Jl=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],zl={name:Hl,members:Jl};function Yl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Vt({props:o}),ue.push(()=>Ee(e,"value",i,r[0].criticals)),{c(){I(e.$$.fragment)},m(s,a){x(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function Xl(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=zl;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Wl extends Y{constructor(e){super(),X(this,e,Xl,Yl,J,{props:0})}}function Qr(r){let e,t,n,i,o;const s=r[10].default,a=gt(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),pe(e,"border","solid 1px black"),pe(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=q(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&bt(a,s,l,l[9],n?vt(s,l[9],u,null):yt(l[9]),null)},i(l){n||($(a,l),ot(()=>{t||(t=St(e,$t,{duration:100},!0)),t.run(1)}),n=!0)},o(l){L(a,l),t||(t=St(e,$t,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Vl(r){let e,t,n,i,o,s,a,l,u,f,d=r[4]&&Qr(r);return{c(){e=E("button"),t=hn("svg"),n=hn("path"),i=O(),o=K(r[1]),s=O(),d&&d.c(),a=be(),C(n,"d","M9 5l7 7-7 7"),C(t,"style","tran"),C(t,"width","20"),C(t,"height","20"),C(t,"fill","none"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"stroke-width","2"),C(t,"viewBox","0 0 24 24"),C(t,"stroke","currentColor"),C(t,"class","svelte-t7fpgu"),C(e,"aria-expanded",r[4]),C(e,"class","svelte-t7fpgu"),kr(e,"underlined",r[3])},m(p,c){w(p,e,c),S(e,t),S(t,n),S(e,i),S(e,o),w(p,s,c),d&&d.m(p,c),w(p,a,c),l=!0,u||(f=[q(e,"click",r[5]),q(e,"mouseenter",r[11]),q(e,"mouseleave",r[12])],u=!0)},p(p,[c]){(!l||c&2)&&Re(o,p[1]),(!l||c&16)&&C(e,"aria-expanded",p[4]),(!l||c&8)&&kr(e,"underlined",p[3]),p[4]?d?(d.p(p,c),c&16&&$(d,1)):(d=Qr(p),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(fe(),L(d,1,1,()=>{d=null}),ce())},i(p){l||($(d),l=!0)},o(p){L(d),l=!1},d(p){p&&k(e),p&&k(s),d&&d.d(p),p&&k(a),u=!1,Ae(f)}}}function Kl(r,e,t){let n,i,o,s;te(r,De,_=>t(7,o=_)),te(r,ke,_=>t(8,s=_));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:f}=e;const d=()=>{ke.update(_=>_==u?null:u),s==u&&(Jt.set(null),Jt.set(u))};let p;function c(){p==null||p.scrollIntoView({behavior:"smooth"})}const h=()=>Ht.set(u),g=()=>Ht.set(null);function m(_){ue[_?"unshift":"push"](()=>{p=_,t(2,p)})}const y=()=>c();return r.$$set=_=>{"id"in _&&t(0,u=_.id),"label"in _&&t(1,f=_.label),"$$scope"in _&&t(9,l=_.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,f,p,i,n,d,c,o,s,l,a,h,g,m,y]}class Zl extends Y{constructor(e){super(),X(this,e,Kl,Vl,J,{id:0,label:1})}}function ei(r,e,t){const n=r.slice();return n[13]=e[t],n[14]=e,n[15]=t,n}function Ql(r){let e,t,n;function i(s){r[9](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Wl({props:o}),ue.push(()=>Ee(e,"props",i,r[13].properties)),{c(){I(e.$$.fragment)},m(s,a){x(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function ea(r){let e,t,n;function i(s){r[8](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Gl({props:o}),ue.push(()=>Ee(e,"props",i,r[13].properties)),{c(){I(e.$$.fragment)},m(s,a){x(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function ta(r){let e,t,n;function i(s){r[7](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Nl({props:o}),ue.push(()=>Ee(e,"props",i,r[13].properties)),{c(){I(e.$$.fragment)},m(s,a){x(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,$e(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function na(r){let e,t,n,i,o;function s(f){r[4](f,r[13])}function a(f){r[5](f,r[13])}function l(f){r[6](f,r[13])}let u={id:r[13].id,length_meters:r[13].properties.length_meters};return r[13].properties.name!==void 0&&(u.name=r[13].properties.name),r[13].properties.intervention_type!==void 0&&(u.intervention_type=r[13].properties.intervention_type),r[13].properties.description!==void 0&&(u.description=r[13].properties.description),e=new _l({props:u}),ue.push(()=>Ee(e,"name",s,r[13].properties.name)),ue.push(()=>Ee(e,"intervention_type",a,r[13].properties.intervention_type)),ue.push(()=>Ee(e,"description",l,r[13].properties.description)),{c(){I(e.$$.fragment)},m(f,d){x(e,f,d),o=!0},p(f,d){r=f;const p={};d&2&&(p.id=r[13].id),d&2&&(p.length_meters=r[13].properties.length_meters),!t&&d&2&&(t=!0,p.name=r[13].properties.name,$e(()=>t=!1)),!n&&d&2&&(n=!0,p.intervention_type=r[13].properties.intervention_type,$e(()=>n=!1)),!i&&d&2&&(i=!0,p.description=r[13].properties.description,$e(()=>i=!1)),e.$set(p)},i(f){o||($(e.$$.fragment,f),o=!0)},o(f){L(e.$$.fragment,f),o=!1},d(f){N(e,f)}}}function ra(r){let e,t,n,i,o,s,a,l,u,f,d,p,c,h,g;const m=[na,ta,ea,Ql],y=[];function _(v,M){return v[0]=="v1"?0:v[0]=="v2"?1:v[0]=="planning"?2:v[0]=="criticals"?3:-1}~(e=_(r))&&(t=y[e]=m[e](r));function b(){return r[10](r[13])}return{c(){t&&t.c(),n=O(),i=E("br"),o=O(),s=E("br"),a=O(),l=E("div"),u=E("button"),u.textContent="Delete",f=O(),d=E("button"),d.textContent="Save",p=O(),C(u,"type","button"),C(d,"type","button"),pe(l,"display","flex"),pe(l,"justify-content","space-between")},m(v,M){~e&&y[e].m(v,M),w(v,n,M),w(v,i,M),w(v,o,M),w(v,s,M),w(v,a,M),w(v,l,M),S(l,u),S(l,f),S(l,d),w(v,p,M),c=!0,h||(g=[q(u,"click",b),q(d,"click",r[11])],h=!0)},p(v,M){r=v;let R=e;e=_(r),e===R?~e&&y[e].p(r,M):(t&&(fe(),L(y[R],1,1,()=>{y[R]=null}),ce()),~e?(t=y[e],t?t.p(r,M):(t=y[e]=m[e](r),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(v){c||($(t),c=!0)},o(v){L(t),c=!1},d(v){~e&&y[e].d(v),v&&k(n),v&&k(i),v&&k(o),v&&k(s),v&&k(a),v&&k(l),v&&k(p),h=!1,Ae(g)}}}function ti(r,e){let t,n,i;return n=new Zl({props:{id:e[13].id,label:e[15]+1+") "+e[2](e[13]),$$slots:{default:[ra]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=be(),I(n.$$.fragment),this.first=t},m(o,s){w(o,t,s),x(n,o,s),i=!0},p(o,s){e=o;const a={};s&2&&(a.id=e[13].id),s&2&&(a.label=e[15]+1+") "+e[2](e[13])),s&65539&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){L(n.$$.fragment,o),i=!1},d(o){o&&k(t),N(n,o)}}}function ia(r){let e=[],t=new Map,n,i,o,s,a=r[1].features;const l=u=>u[13].id;for(let u=0;u<a.length;u+=1){let f=ei(r,a,u),d=l(f);t.set(d,e[u]=ti(d,f))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=be()},m(u,f){for(let d=0;d<e.length;d+=1)e[d].m(u,f);w(u,n,f),i=!0,o||(s=q(window,"keydown",r[3]),o=!0)},p(u,[f]){f&7&&(a=u[1].features,fe(),e=po(e,f,l,1,u,a,t,n.parentNode,ho,ti,n,ei),ce())},i(u){if(!i){for(let f=0;f<a.length;f+=1)$(e[f]);i=!0}},o(u){for(let f=0;f<e.length;f+=1)L(e[f]);i=!1},d(u){for(let f=0;f<e.length;f+=1)e[f].d(u);u&&k(n),o=!1,s()}}}function oa(r,e,t){let n,i;te(r,ke,m=>t(12,n=m)),te(r,re,m=>t(1,i=m));let{schema:o}=e;function s(m){var _,b,v,M,R;if(o=="planning")return((_=m.properties.planning)==null?void 0:_.name)||"Untitled polygon";if(o=="v2")return((v=(b=m.properties.v2)==null?void 0:b.Route)==null?void 0:v.name)||((R=(M=m.properties.v2)==null?void 0:M.Crossing)==null?void 0:R.name)||"Untitled intervention";if(m.properties.name)return m.properties.name;var y=m.properties.intervention_type;return y=="other"&&(m.geometry.type=="Point"?y="point":m.geometry.type=="LineString"?y="line":y="polygon"),`Untitled ${y}`}function a(m){if(m.key=="Delete"){const y=m.target.tagName;if(y=="INPUT"||y=="TEXTAREA")return;m.preventDefault();const _=n;_&&Er(_)}}function l(m,y){r.$$.not_equal(y.properties.name,m)&&(y.properties.name=m,re.set(i))}function u(m,y){r.$$.not_equal(y.properties.intervention_type,m)&&(y.properties.intervention_type=m,re.set(i))}function f(m,y){r.$$.not_equal(y.properties.description,m)&&(y.properties.description=m,re.set(i))}function d(m,y){r.$$.not_equal(y.properties,m)&&(y.properties=m,re.set(i))}function p(m,y){r.$$.not_equal(y.properties,m)&&(y.properties=m,re.set(i))}function c(m,y){r.$$.not_equal(y.properties,m)&&(y.properties=m,re.set(i))}const h=m=>Er(m.id),g=()=>ke.set(null);return r.$$set=m=>{"schema"in m&&t(0,o=m.schema)},[o,i,s,a,l,u,f,d,p,c,h,g]}class sa extends Y{constructor(e){super(),X(this,e,oa,ia,J,{schema:0})}}function ni(r){let e,t;return e=new xi({props:{id:void 0}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p:G,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function la(r){let e,t,n,i,o,s,a,l,u,f,d,p=r[1]=="speed limits"&&ni();return{c(){e=E("label"),t=K(`Show layer:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",a=O(),p&&p.c(),l=be(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,n.disabled=s=r[0]!=null,r[1]===void 0&&ot(()=>r[2].call(n))},m(c,h){w(c,e,h),S(e,t),S(e,n),S(n,i),S(n,o),Qe(n,r[1]),w(c,a,h),p&&p.m(c,h),w(c,l,h),u=!0,f||(d=q(n,"change",r[2]),f=!0)},p(c,[h]){(!u||h&1&&s!==(s=c[0]!=null))&&(n.disabled=s),h&2&&Qe(n,c[1]),c[1]=="speed limits"?p?(p.p(c,h),h&2&&$(p,1)):(p=ni(),p.c(),$(p,1),p.m(l.parentNode,l)):p&&(fe(),L(p,1,1,()=>{p=null}),ce())},i(c){u||($(p),u=!0)},o(c){L(p),u=!1},d(c){c&&k(e),c&&k(a),p&&p.d(c),c&&k(l),f=!1,d()}}}function aa(r,e,t){let n;te(r,ke,s=>t(0,n=s));let i="none";function o(){i=Ln(this),t(1,i),t(0,n)}return r.$$.update=()=>{r.$$.dirty&1&&n&&t(1,i="none")},[n,i,o]}class ua extends Y{constructor(e){super(),X(this,e,aa,la,J,{})}}function Ze(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ue(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function er(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ye(r,e,t){t===void 0&&(t={});var n=Ze(r),i=Ze(e),o=Pe(i[1]-n[1]),s=Pe(i[0]-n[0]),a=Pe(n[1]),l=Pe(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return mo(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function ln(r,e){return e===void 0&&(e={}),_o(r,function(t,n){var i=n.geometry.coordinates;return t+Ye(i[0],i[1],e)},0)}function fa(r){let e,t,n,i,o,s,a,l,u,f,d,p,c,h,g,m,y,_,b,v=r[0].features.length+"",M,R,F,A,B,T,D,Q;return{c(){e=E("div"),t=E("label"),n=K(`Scheme name:
    `),i=E("input"),o=O(),s=E("br"),a=O(),l=E("div"),u=E("label"),f=E("input"),d=O(),p=E("button"),p.textContent="Load from GeoJSON",c=O(),h=E("button"),h.textContent="Export to GeoJSON",g=O(),m=E("br"),y=O(),_=E("div"),b=E("span"),M=K(v),R=K(" objects"),F=O(),A=E("button"),B=K("Clear all"),C(i,"type","text"),C(f,"type","file"),C(f,"id","load_geojson"),C(f,"class","svelte-lhyd1e"),C(p,"type","button"),C(h,"type","button"),C(h,"class","align-right svelte-lhyd1e"),C(A,"type","button"),C(A,"class","align-right svelte-lhyd1e"),A.disabled=T=r[0].features.length==0},m(j,H){w(j,e,H),S(e,t),S(t,n),S(t,i),Oe(i,r[0].scheme_name),w(j,o,H),w(j,s,H),w(j,a,H),w(j,l,H),S(l,u),S(u,f),S(u,d),S(u,p),S(l,c),S(l,h),w(j,g,H),w(j,m,H),w(j,y,H),w(j,_,H),S(_,b),S(b,M),S(b,R),S(_,F),S(_,A),S(A,B),D||(Q=[q(i,"input",r[8]),q(f,"change",r[3]),q(p,"click",pa),q(h,"click",r[2]),q(A,"click",r[1])],D=!0)},p(j,[H]){H&1&&i.value!==j[0].scheme_name&&Oe(i,j[0].scheme_name),H&1&&v!==(v=j[0].features.length+"")&&Re(M,v),H&1&&T!==(T=j[0].features.length==0)&&(A.disabled=T)},i:G,o:G,d(j){j&&k(e),j&&k(o),j&&k(s),j&&k(a),j&&k(l),j&&k(g),j&&k(m),j&&k(y),j&&k(_),D=!1,Ae(Q)}}}function ca(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function pa(){document.getElementById("load_geojson").click()}function da(r,e,t){let n;te(r,re,h=>t(0,n=h));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=!1;Lt(async()=>{let g=new URLSearchParams(window.location.search).get("geojsonUrl"),m=window.localStorage.getItem(s);if(g){console.log(`Loading GeoJSON from ${g}`);try{let _=await(await fetch(g)).text();re.set(p(JSON.parse(_)))}catch(y){console.log(`Failed to load from URL: ${y}`)}}else if(m)try{re.set(p(JSON.parse(m)))}catch(y){console.log(`Failed to load from local storage: ${y}`)}t(7,a=!0)});function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(re.update(h=>(delete h.scheme_name,h.features=[],h)),ke.set(null),De.set(null),Ht.set(null),Jt.set(null))}function u(){const h=JSON.parse(JSON.stringify(n));for(let g of h.features)delete g.properties.hide_while_editing;return h}function f(){let h=u();var g=s;h.authority=i,h.origin="atip-v1",h.scheme_name&&(g+="_"+h.scheme_name),g+=".txt",ca(g,JSON.stringify(h,null,"  "))}function d(h){const g=new FileReader;g.onload=y=>{try{re.set(p(JSON.parse(y.target.result)))}catch(_){window.alert(`Couldn't load scheme from a file: ${_}`)}};let m=h.target.files;g.readAsText(m[0])}function p(h){let g=1;for(let m of h.features)m.properties||(m.properties={name:"",description:"",intervention_type:"other"}),m.geometry.type=="LineString"&&!m.properties.length_meters&&(m.properties.length_meters=ln(m,{units:"kilometers"})*1e3),m.id=g++;return h}function c(){n.scheme_name=this.value,re.set(n)}return r.$$set=h=>{"authorityName"in h&&t(4,i=h.authorityName),"schema"in h&&t(5,o=h.schema)},r.$$.update=()=>{r.$$.dirty&193&&a&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,f,d,i,o,s,a,c]}class ha extends Y{constructor(e){super(),X(this,e,da,fa,J,{authorityName:4,schema:5})}}const ma="/atip/layer_lanes/assets/zoom_out_map-b2e1091a.svg";function _a(r){let e,t,n,i,o;return{c(){e=E("button"),t=E("img"),dn(t.src,n=ma)||C(t,"src",n),C(t,"alt","Zoom to show entire boundary"),C(e,"type","button"),C(e,"title","Zoom to show entire boundary"),C(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),i||(o=q(e,"click",r[0]),i=!0)},p:G,i:G,o:G,d(s){s&&k(e),i=!1,o()}}}function ga(r,e,t){let n;te(r,Ce,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(lr(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class ba extends Y{constructor(e){super(),X(this,e,ga,_a,J,{boundaryGeojson:1})}}function ya(r){let e,t,n,i,o,s,a;return{c(){e=E("div"),t=K(`Basemap:
  `),n=E("select"),i=E("option"),i.textContent="Streets",o=E("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&ot(()=>r[2].call(n)),C(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,i),S(n,o),Qe(n,r[0]),s||(a=[q(n,"change",r[2]),q(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&Qe(n,l[0])},i:G,o:G,d(l){l&&k(e),s=!1,Ae(a)}}}function va(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=Ln(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class wa extends Y{constructor(e){super(),X(this,e,va,ya,J,{style:0})}}function ri(r){let e,t,n;const i=r[3].default,o=gt(i,r,r[2],null);return{c(){e=E("div"),o&&o.c()},m(s,a){w(s,e,a),o&&o.m(e,null),n=!0},p(s,a){o&&o.p&&(!n||a&4)&&bt(o,i,s,s[2],n?vt(i,s[2],a,null):yt(s[2]),null)},i(s){n||($(o,s),ot(()=>{t||(t=St(e,$t,{duration:100},!0)),t.run(1)}),n=!0)},o(s){L(o,s),t||(t=St(e,$t,{duration:100},!1)),t.run(0),n=!1},d(s){s&&k(e),o&&o.d(s),s&&t&&t.end()}}}function ka(r){let e,t,n,i,o,s,a,l,u,f,d=r[0]&&ri(r);return{c(){e=E("button"),t=hn("svg"),n=hn("path"),i=O(),o=K(r[1]),s=O(),d&&d.c(),a=be(),C(n,"d","M9 5l7 7-7 7"),C(t,"style","tran"),C(t,"width","20"),C(t,"height","20"),C(t,"fill","none"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"stroke-width","2"),C(t,"viewBox","0 0 24 24"),C(t,"stroke","currentColor"),C(t,"class","svelte-una9lq"),C(e,"aria-expanded",r[0]),C(e,"class","svelte-una9lq")},m(p,c){w(p,e,c),S(e,t),S(t,n),S(e,i),S(e,o),w(p,s,c),d&&d.m(p,c),w(p,a,c),l=!0,u||(f=q(e,"click",r[4]),u=!0)},p(p,[c]){(!l||c&2)&&Re(o,p[1]),(!l||c&1)&&C(e,"aria-expanded",p[0]),p[0]?d?(d.p(p,c),c&1&&$(d,1)):(d=ri(p),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(fe(),L(d,1,1,()=>{d=null}),ce())},i(p){l||($(d),l=!0)},o(p){L(d),l=!1},d(p){p&&k(e),p&&k(s),d&&d.d(p),p&&k(a),u=!1,f()}}}function Sa(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,o=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,i=l.$$scope)},[s,o,i,n,a]}class Fn extends Y{constructor(e){super(),X(this,e,Sa,ka,J,{label:1,open:0})}}function Ea(r){let e,t,n,i,o,s,a,l,u,f,d,p,c,h,g;return{c(){e=E("li"),t=E("span"),n=K("Areas"),i=O(),o=E("li"),s=E("span"),a=K("Routes"),l=O(),u=E("li"),f=E("span"),d=K("Crossings"),p=O(),c=E("li"),h=E("span"),g=K("Other"),C(t,"class","svelte-l42ea0"),pe(t,"background",_e.area),C(s,"class","svelte-l42ea0"),pe(s,"background",_e.route),C(f,"class","svelte-l42ea0"),pe(f,"background",_e.crossing),C(h,"class","svelte-l42ea0"),pe(h,"background",_e.other)},m(m,y){w(m,e,y),S(e,t),S(e,n),w(m,i,y),w(m,o,y),S(o,s),S(o,a),w(m,l,y),w(m,u,y),S(u,f),S(u,d),w(m,p,y),w(m,c,y),S(c,h),S(c,g)},p:G,d(m){m&&k(e),m&&k(i),m&&k(o),m&&k(l),m&&k(u),m&&k(p),m&&k(c)}}}function $a(r){let e,t,n,i,o,s,a,l,u,f,d,p,c,h,g;return{c(){e=E("li"),t=E("span"),n=K("Preapp"),i=O(),o=E("li"),s=E("span"),a=K("Outline"),l=O(),u=E("li"),f=E("span"),d=K("Reserved matters"),p=O(),c=E("li"),h=E("span"),g=K("Local plan"),C(t,"class","svelte-l42ea0"),pe(t,"background",_e.preapp),C(s,"class","svelte-l42ea0"),pe(s,"background",_e.outline),C(f,"class","svelte-l42ea0"),pe(f,"background",_e["reserved matters"]),C(h,"class","svelte-l42ea0"),pe(h,"background",_e["local plan"])},m(m,y){w(m,e,y),S(e,t),S(e,n),w(m,i,y),w(m,o,y),S(o,s),S(o,a),w(m,l,y),w(m,u,y),S(u,f),S(u,d),w(m,p,y),w(m,c,y),S(c,h),S(c,g)},p:G,d(m){m&&k(e),m&&k(i),m&&k(o),m&&k(l),m&&k(u),m&&k(p),m&&k(c)}}}function Ma(r){let e;function t(o,s){return o[0]=="planning"?$a:Ea}let n=t(r),i=n(r);return{c(){e=E("ul"),i.c()},m(o,s){w(o,e,s),i.m(e,null)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&k(e),i.d()}}}function La(r){let e,t,n;return t=new Fn({props:{label:"Objects",open:!0,$$slots:{default:[Ma]},$$scope:{ctx:r}}}),{c(){e=E("div"),I(t.$$.fragment),C(e,"class","svelte-l42ea0")},m(i,o){w(i,e,o),x(t,e,null),n=!0},p(i,[o]){const s={};o&3&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){L(t.$$.fragment,i),n=!1},d(i){i&&k(e),N(t)}}}function Ca(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class Oa extends Y{constructor(e){super(),X(this,e,Ca,La,J,{schema:0})}}let ut="interventions";function Ra(r,e,t){let n,i;te(r,Ce,f=>t(1,n=f)),te(r,re,f=>t(2,i=f));let{schema:o}=e;Je(n,ut,i);const s=["match",["get","intervention_type"],"area",_e.area,"route",_e.route,"crossing",_e.crossing,"other",_e.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",_e.preapp,"outline",_e.outline,"reserved matters",_e["reserved matters"],"local plan",_e["local plan"],"white"],l=["!=","hide_while_editing",!0];return we(n,{id:"interventions-points",source:ut,filter:["all",Cn,l,["!=","endpoint",!0]],...Ct(s,An)}),we(n,{id:"interventions-lines",source:ut,filter:["all",On,l],...kt(s,Yt)}),we(n,{id:"interventions-lines-endpoints",source:ut,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Yt,"circle-opacity":0,"circle-stroke-color":_e.lineEndpointColor,"circle-stroke-width":2}}),we(n,{id:"interventions-polygons",source:ut,filter:["all",Rn,l],...$n(o=="planning"?a:s,.5)}),r.$$set=f=>{"schema"in f&&t(0,o=f.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let f=JSON.parse(JSON.stringify(i)),d=[];for(let p of f.features)if(p.geometry.type=="LineString")for(let c of[p.geometry.coordinates[0],p.geometry.coordinates[p.geometry.coordinates.length-1]])d.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:c}});f.features=f.features.concat(d),n.getSource(ut).setData(f)}},[o,n,i]}class Aa extends Y{constructor(e){super(),X(this,e,Ra,null,J,{schema:0})}}let ft="hover";function Ta(r,e,t){let n,i,o,s,a;return te(r,Ce,l=>t(0,n=l)),te(r,re,l=>t(1,i=l)),te(r,Ht,l=>t(2,o=l)),te(r,De,l=>t(3,s=l)),te(r,ke,l=>t(4,a=l)),Je(n,ft,xe()),we(n,{id:"hover-polygons",source:ft,filter:Rn,...kt(_e.hovering,.5*Yt,1)}),we(n,{id:"hover-lines",source:ft,filter:On,...kt(_e.hovering,1.5*Yt,1)}),we(n,{id:"hover-points",source:ft,filter:Cn,...Ct(_e.hovering,1.5*An,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(ft).setData(i.features.find(u=>u.id==l)):n.getSource(ft).setData(xe())}},[n,i,o,s,a]}class Fa extends Y{constructor(e){super(),X(this,e,Ta,null,J,{})}}class pr{constructor(e,t){se(this,"owner");se(this,"map");se(this,"mapHandlers",{});se(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const en="edit-point-mode";class Pa{constructor(e){se(this,"map");se(this,"active");se(this,"eventListenersSuccess");se(this,"eventListenersFailure");se(this,"cursor");se(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new pr(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Je(e,en,xe()),we(e,{id:"edit-point-mode",source:en,...Ct(_e.hovering,An,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=Ia(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(en),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=xe();this.cursor&&e.features.push(this.cursor),this.map.getSource(en).setData(e)}}function Ia(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Hi(r,e,t){if(t===void 0&&(t={}),t.final===!0)return xa(r,e);var n=Ze(r),i=Ze(e),o=Pe(n[0]),s=Pe(i[0]),a=Pe(n[1]),l=Pe(i[1]),u=Math.sin(s-o)*Math.cos(l),f=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return Hn(Math.atan2(u,f))}function xa(r,e){var t=Hi(e,r);return t=(t+180)%360,t}function ii(r,e,t,n){n===void 0&&(n={});var i=Ze(r),o=Pe(i[0]),s=Pe(i[1]),a=Pe(t),l=go(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),f=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),d=Hn(f),p=Hn(u);return wt([d,p],n.properties)}function tr(r){if(!r)throw new Error("geojson is required");var e=[];return ar(r,function(t){Na(t,e)}),Ke(e)}function Na(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ue(n);break;case"LineString":t=[Ue(n)]}t.forEach(function(i){var o=ja(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function ja(r,e){var t=[];return r.reduce(function(n,i){var o=Et([n,i],e);return o.bbox=Ba(n,i),t.push(o),i}),t}function Ba(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var Mt={},Da={get exports(){return Mt},set exports(r){Mt=r}},nr={},Ua={get exports(){return nr},set exports(r){nr=r}};(function(r,e){(function(t,n){r.exports=n()})(bo,function(){function t(_,b,v,M,R){(function F(A,B,T,D,Q){for(;D>T;){if(D-T>600){var j=D-T+1,H=B-T+1,ae=Math.log(j),Se=.5*Math.exp(2*ae/3),Fe=.5*Math.sqrt(ae*Se*(j-Se)/j)*(H-j/2<0?-1:1),oe=Math.max(T,Math.floor(B-H*Se/j+Fe)),ie=Math.min(D,Math.floor(B+(j-H)*Se/j+Fe));F(A,B,oe,ie,Q)}var Ne=A[B],Le=T,ee=D;for(n(A,T,B),Q(A[D],Ne)>0&&n(A,T,D);Le<ee;){for(n(A,Le,ee),Le++,ee--;Q(A[Le],Ne)<0;)Le++;for(;Q(A[ee],Ne)>0;)ee--}Q(A[T],Ne)===0?n(A,T,ee):n(A,++ee,D),ee<=B&&(T=ee+1),B<=ee&&(D=ee-1)}})(_,b,v||0,M||_.length-1,R||i)}function n(_,b,v){var M=_[b];_[b]=_[v],_[v]=M}function i(_,b){return _<b?-1:_>b?1:0}var o=function(_){_===void 0&&(_=9),this._maxEntries=Math.max(4,_),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(_,b,v){if(!v)return b.indexOf(_);for(var M=0;M<b.length;M++)if(v(_,b[M]))return M;return-1}function a(_,b){l(_,0,_.children.length,b,_)}function l(_,b,v,M,R){R||(R=m(null)),R.minX=1/0,R.minY=1/0,R.maxX=-1/0,R.maxY=-1/0;for(var F=b;F<v;F++){var A=_.children[F];u(R,_.leaf?M(A):A)}return R}function u(_,b){return _.minX=Math.min(_.minX,b.minX),_.minY=Math.min(_.minY,b.minY),_.maxX=Math.max(_.maxX,b.maxX),_.maxY=Math.max(_.maxY,b.maxY),_}function f(_,b){return _.minX-b.minX}function d(_,b){return _.minY-b.minY}function p(_){return(_.maxX-_.minX)*(_.maxY-_.minY)}function c(_){return _.maxX-_.minX+(_.maxY-_.minY)}function h(_,b){return _.minX<=b.minX&&_.minY<=b.minY&&b.maxX<=_.maxX&&b.maxY<=_.maxY}function g(_,b){return b.minX<=_.maxX&&b.minY<=_.maxY&&b.maxX>=_.minX&&b.maxY>=_.minY}function m(_){return{children:_,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(_,b,v,M,R){for(var F=[b,v];F.length;)if(!((v=F.pop())-(b=F.pop())<=M)){var A=b+Math.ceil((v-b)/M/2)*M;t(_,A,b,v,R),F.push(b,A,A,v)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(_){var b=this.data,v=[];if(!g(_,b))return v;for(var M=this.toBBox,R=[];b;){for(var F=0;F<b.children.length;F++){var A=b.children[F],B=b.leaf?M(A):A;g(_,B)&&(b.leaf?v.push(A):h(_,B)?this._all(A,v):R.push(A))}b=R.pop()}return v},o.prototype.collides=function(_){var b=this.data;if(!g(_,b))return!1;for(var v=[];b;){for(var M=0;M<b.children.length;M++){var R=b.children[M],F=b.leaf?this.toBBox(R):R;if(g(_,F)){if(b.leaf||h(_,F))return!0;v.push(R)}}b=v.pop()}return!1},o.prototype.load=function(_){if(!_||!_.length)return this;if(_.length<this._minEntries){for(var b=0;b<_.length;b++)this.insert(_[b]);return this}var v=this._build(_.slice(),0,_.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var M=this.data;this.data=v,v=M}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},o.prototype.insert=function(_){return _&&this._insert(_,this.data.height-1),this},o.prototype.clear=function(){return this.data=m([]),this},o.prototype.remove=function(_,b){if(!_)return this;for(var v,M,R,F=this.data,A=this.toBBox(_),B=[],T=[];F||B.length;){if(F||(F=B.pop(),M=B[B.length-1],v=T.pop(),R=!0),F.leaf){var D=s(_,F.children,b);if(D!==-1)return F.children.splice(D,1),B.push(F),this._condense(B),this}R||F.leaf||!h(F,A)?M?(v++,F=M.children[v],R=!1):F=null:(B.push(F),T.push(v),v=0,M=F,F=F.children[0])}return this},o.prototype.toBBox=function(_){return _},o.prototype.compareMinX=function(_,b){return _.minX-b.minX},o.prototype.compareMinY=function(_,b){return _.minY-b.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(_){return this.data=_,this},o.prototype._all=function(_,b){for(var v=[];_;)_.leaf?b.push.apply(b,_.children):v.push.apply(v,_.children),_=v.pop();return b},o.prototype._build=function(_,b,v,M){var R,F=v-b+1,A=this._maxEntries;if(F<=A)return a(R=m(_.slice(b,v+1)),this.toBBox),R;M||(M=Math.ceil(Math.log(F)/Math.log(A)),A=Math.ceil(F/Math.pow(A,M-1))),(R=m([])).leaf=!1,R.height=M;var B=Math.ceil(F/A),T=B*Math.ceil(Math.sqrt(A));y(_,b,v,T,this.compareMinX);for(var D=b;D<=v;D+=T){var Q=Math.min(D+T-1,v);y(_,D,Q,B,this.compareMinY);for(var j=D;j<=Q;j+=B){var H=Math.min(j+B-1,Q);R.children.push(this._build(_,j,H,M-1))}}return a(R,this.toBBox),R},o.prototype._chooseSubtree=function(_,b,v,M){for(;M.push(b),!b.leaf&&M.length-1!==v;){for(var R=1/0,F=1/0,A=void 0,B=0;B<b.children.length;B++){var T=b.children[B],D=p(T),Q=(j=_,H=T,(Math.max(H.maxX,j.maxX)-Math.min(H.minX,j.minX))*(Math.max(H.maxY,j.maxY)-Math.min(H.minY,j.minY))-D);Q<F?(F=Q,R=D<R?D:R,A=T):Q===F&&D<R&&(R=D,A=T)}b=A||b.children[0]}var j,H;return b},o.prototype._insert=function(_,b,v){var M=v?_:this.toBBox(_),R=[],F=this._chooseSubtree(M,this.data,b,R);for(F.children.push(_),u(F,M);b>=0&&R[b].children.length>this._maxEntries;)this._split(R,b),b--;this._adjustParentBBoxes(M,R,b)},o.prototype._split=function(_,b){var v=_[b],M=v.children.length,R=this._minEntries;this._chooseSplitAxis(v,R,M);var F=this._chooseSplitIndex(v,R,M),A=m(v.children.splice(F,v.children.length-F));A.height=v.height,A.leaf=v.leaf,a(v,this.toBBox),a(A,this.toBBox),b?_[b-1].children.push(A):this._splitRoot(v,A)},o.prototype._splitRoot=function(_,b){this.data=m([_,b]),this.data.height=_.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(_,b,v){for(var M,R,F,A,B,T,D,Q=1/0,j=1/0,H=b;H<=v-b;H++){var ae=l(_,0,H,this.toBBox),Se=l(_,H,v,this.toBBox),Fe=(R=ae,F=Se,A=void 0,B=void 0,T=void 0,D=void 0,A=Math.max(R.minX,F.minX),B=Math.max(R.minY,F.minY),T=Math.min(R.maxX,F.maxX),D=Math.min(R.maxY,F.maxY),Math.max(0,T-A)*Math.max(0,D-B)),oe=p(ae)+p(Se);Fe<Q?(Q=Fe,M=H,j=oe<j?oe:j):Fe===Q&&oe<j&&(j=oe,M=H)}return M||v-b},o.prototype._chooseSplitAxis=function(_,b,v){var M=_.leaf?this.compareMinX:f,R=_.leaf?this.compareMinY:d;this._allDistMargin(_,b,v,M)<this._allDistMargin(_,b,v,R)&&_.children.sort(M)},o.prototype._allDistMargin=function(_,b,v,M){_.children.sort(M);for(var R=this.toBBox,F=l(_,0,b,R),A=l(_,v-b,v,R),B=c(F)+c(A),T=b;T<v-b;T++){var D=_.children[T];u(F,_.leaf?R(D):D),B+=c(F)}for(var Q=v-b-1;Q>=b;Q--){var j=_.children[Q];u(A,_.leaf?R(j):j),B+=c(A)}return B},o.prototype._adjustParentBBoxes=function(_,b,v){for(var M=v;M>=0;M--)u(b[M],_)},o.prototype._condense=function(_){for(var b=_.length-1,v=void 0;b>=0;b--)_[b].children.length===0?b>0?(v=_[b-1].children).splice(v.indexOf(_[b]),1):this.clear():a(_[b],this.toBBox)},o})})(Ua);const qa=ur(yo),Ga=ur(vo),Ha=ur(wo);var je=nr,Ji=qa,zi=Ga,ct=Ha.default,Ja=zi.featureEach;zi.coordEach;Ji.polygon;var oi=Ji.featureCollection;function Yi(r){var e=new je(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ct(t),je.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ct(i),n.push(i)}):Ja(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ct(i),n.push(i)}),je.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ct(t),je.prototype.remove.call(this,t,n)},e.clear=function(){return je.prototype.clear.call(this)},e.search=function(t){var n=je.prototype.search.call(this,this.toBBox(t));return oi(n)},e.collides=function(t){return je.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=je.prototype.all.call(this);return oi(t)},e.toJSON=function(){return je.prototype.toJSON.call(this)},e.fromJSON=function(t){return je.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ct(t);else if(t.type==="FeatureCollection")n=ct(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Da.exports=Yi;Mt.default=Yi;function Xi(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Sr(r)),e.type==="LineString"&&(e=Sr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=si(r,e);return i&&n.push(i),Ke(n)}var o=Mt();return o.load(tr(e)),mn(tr(r),function(s){mn(o.search(s),function(a){var l=si(s,a);if(l){var u=Ue(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),Ke(n)}function si(r,e){var t=Ue(r),n=Ue(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],f=n[1][0],d=n[1][1],p=(d-u)*(s-i)-(f-l)*(a-o),c=(f-l)*(o-u)-(d-u)*(i-l),h=(s-i)*(o-u)-(a-o)*(i-l);if(p===0)return c===0&&h===0,null;var g=c/p,m=h/p;if(g>=0&&g<=1&&m>=0&&m<=1){var y=i+g*(s-i),_=o+g*(a-o);return wt([y,_])}return null}function Xt(r,e,t){t===void 0&&(t={});var n=wt([1/0,1/0],{dist:1/0}),i=0;return ar(r,function(o){for(var s=Ue(o),a=0;a<s.length-1;a++){var l=wt(s[a]);l.properties.dist=Ye(e,l,t);var u=wt(s[a+1]);u.properties.dist=Ye(e,u,t);var f=Ye(l,u,t),d=Math.max(l.properties.dist,u.properties.dist),p=Hi(l,u),c=ii(e,d,p+90,t),h=ii(e,d,p-90,t),g=Xi(Et([c.geometry.coordinates,h.geometry.coordinates]),Et([l.geometry.coordinates,u.geometry.coordinates])),m=null;g.features.length>0&&(m=g.features[0],m.properties.dist=Ye(e,m,t),m.properties.location=i+Ye(l,m,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+f),m&&m.properties.dist<n.properties.dist&&(n=m,n.properties.index=a),i+=f}}),n}const pt="edit-polygon-mode";class za{constructor(e){se(this,"map");se(this,"active");se(this,"eventListenersSuccess");se(this,"eventListenersFailure");se(this,"points");se(this,"cursor");se(this,"hover");se(this,"dragFrom");se(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new pr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Je(e,pt,xe()),we(e,{id:"edit-polygon-fill",source:pt,filter:Rn,...$n("red",["case",["boolean",["get","hover"],"false"],1,.5])}),we(e,{id:"edit-polygon-lines",source:pt,filter:On,...kt("black",8,.5)}),we(e,{id:"edit-polygon-vertices",source:pt,filter:Cn,...Ct(_e.hovering,An,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(ai(this.points).forEach((n,i)=>{t.push([i+1,Xt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(pt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=xe();this.points.forEach((n,i)=>{let o=li(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(ai(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(pt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=li(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function li(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function ai(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let V;const He=new Array(32).fill(void 0);He.push(void 0,null,!0,!1);function W(r){return He[r]}let Dt=He.length;function Ya(r){r<36||(He[r]=Dt,Dt=r)}function rr(r){const e=W(r);return Ya(r),e}const Wi=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Wi.decode();let an=new Uint8Array;function Ut(){return an.byteLength===0&&(an=new Uint8Array(V.memory.buffer)),an}function mt(r,e){return Wi.decode(Ut().subarray(r,r+e))}function ye(r){Dt===He.length&&He.push(He.length+1);const e=Dt;return Dt=He[e],He[e]=r,e}function Dn(r){return r==null}let un=new Float64Array;function Xa(){return un.byteLength===0&&(un=new Float64Array(V.memory.buffer)),un}let fn=new Int32Array;function ve(){return fn.byteLength===0&&(fn=new Int32Array(V.memory.buffer)),fn}let Ve=0;const cn=new TextEncoder("utf-8"),Wa=typeof cn.encodeInto=="function"?function(r,e){return cn.encodeInto(r,e)}:function(r,e){const t=cn.encode(r);return e.set(t),{read:r.length,written:t.length}};function tn(r,e,t){if(t===void 0){const a=cn.encode(r),l=e(a.length);return Ut().subarray(l,l+a.length).set(a),Ve=a.length,l}let n=r.length,i=e(n);const o=Ut();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=Ut().subarray(i+s,i+n),l=Wa(r,a);s+=l.written}return Ve=s,i}function ir(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=ir(r[0]));for(let s=1;s<i;s++)o+=", "+ir(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Va(r,e){const t=e(r.length*1);return Ut().set(r,t/1),Ve=r.length,t}function Un(r,e){try{return r.apply(this,e)}catch(t){V.__wbindgen_exn_store(ye(t))}}class wn{static __wrap(e){const t=Object.create(wn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();V.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=V.__wbindgen_add_to_stack_pointer(-16),s=Va(e,V.__wbindgen_malloc),a=Ve;V.jsroutesnapper_new(o,s,a);var t=ve()[o/4+0],n=ve()[o/4+1],i=ve()[o/4+2];if(i)throw rr(n);return wn.__wrap(t)}finally{V.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){V.jsroutesnapper_setConfig(this.ptr,ye(e))}toFinalFeature(){try{const n=V.__wbindgen_add_to_stack_pointer(-16);V.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ve()[n/4+0],t=ve()[n/4+1];let i;return e!==0&&(i=mt(e,t).slice(),V.__wbindgen_free(e,t*1)),i}finally{V.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=V.__wbindgen_add_to_stack_pointer(-16);V.jsroutesnapper_renderGeojson(n,this.ptr);var e=ve()[n/4+0],t=ve()[n/4+1];return mt(e,t)}finally{V.__wbindgen_add_to_stack_pointer(16),V.__wbindgen_free(e,t)}}setSnapMode(e){V.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return V.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){V.jsroutesnapper_onClick(this.ptr)}onDragStart(){return V.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return V.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){V.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=V.__wbindgen_add_to_stack_pointer(-16);V.jsroutesnapper_editExisting(i,this.ptr,ye(e));var t=ve()[i/4+0],n=ve()[i/4+1];if(n)throw rr(t)}finally{V.__wbindgen_add_to_stack_pointer(16)}}}async function Ka(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Za(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){rr(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=W(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(mt(e,t));return ye(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=mt(e,t);return ye(n)},r.wbg.__wbindgen_is_object=function(e){const t=W(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return W(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return W(e)in W(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=W(t),i=typeof n=="number"?n:void 0;Xa()[e/8+1]=Dn(i)?0:i,ve()[e/4+0]=!Dn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return W(e)==W(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=W(t),i=typeof n=="string"?n:void 0;var o=Dn(i)?0:tn(i,V.__wbindgen_malloc,V.__wbindgen_realloc),s=Ve;ve()[e/4+1]=s,ve()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(W(t)),i=tn(n,V.__wbindgen_malloc,V.__wbindgen_realloc),o=Ve;ve()[e/4+1]=o,ve()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=W(e);return ye(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=W(e)[W(t)];return ye(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(W(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(W(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(W(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(W(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(W(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=W(e)[t>>>0];return ye(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return W(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof W(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=W(e).next;return ye(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Un(function(e){const t=W(e).next();return ye(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return W(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=W(e).value;return ye(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ye(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Un(function(e,t){const n=Reflect.get(W(e),W(t));return ye(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Un(function(e,t){const n=W(e).call(W(t));return ye(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(W(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=W(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=W(e).buffer;return ye(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(W(e));return ye(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){W(e).set(W(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return W(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=W(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ye(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=W(t).stack,i=tn(n,V.__wbindgen_malloc,V.__wbindgen_realloc),o=Ve;ve()[e/4+1]=o,ve()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(mt(e,t))}finally{V.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=ir(W(t)),i=tn(n,V.__wbindgen_malloc,V.__wbindgen_realloc),o=Ve;ve()[e/4+1]=o,ve()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(mt(e,t))},r.wbg.__wbindgen_memory=function(){const e=V.memory;return ye(e)},r}function Qa(r,e){return V=r.exports,Vi.__wbindgen_wasm_module=e,un=new Float64Array,fn=new Int32Array,an=new Uint8Array,V}async function Vi(r){typeof r>"u"&&(r="/atip/layer_lanes/assets/route_snapper_bg.wasm");const e=Za();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Ka(await r,e);return Qa(t,n)}const Tt="route-snapper",ui=10,eu=30;class tu{constructor(e,t){se(this,"map");se(this,"inner");se(this,"active");se(this,"eventListenersSuccessRoute");se(this,"eventListenersSuccessArea");se(this,"eventListenersFailure");se(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new wn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Je(e,Tt,xe()),we(e,{id:"route-points",source:Tt,filter:Cn,...Ct(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",ui/2,ui])}),we(e,{id:"route-lines",source:Tt,filter:On,...kt("black",2.5)}),we(e,{id:"route-polygons",source:Tt,filter:Rn,...$n("black",.5)}),this.events=new pr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-eu,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Tt).setData(JSON.parse(this.inner.renderGeojson()))}}function nu(r){let e,t,n,i,o,s,a,l;return{c(){e=E("button"),t=E("img"),i=O(),o=K(r[2]),dn(t.src,n=r[3])||C(t,"src",n),C(t,"alt",r[2]),C(t,"class","svelte-1vvpkg9"),C(e,"type","button"),e.disabled=s=r[0]==r[1],C(e,"class","svelte-1vvpkg9")},m(u,f){w(u,e,f),S(e,t),S(e,i),S(e,o),a||(l=q(e,"click",r[5]),a=!0)},p(u,[f]){f&8&&!dn(t.src,n=u[3])&&C(t,"src",n),f&4&&C(t,"alt",u[2]),f&4&&Re(o,u[2]),f&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:G,o:G,d(u){u&&k(e),a=!1,l()}}}function ru(r,e,t){let{mode:n}=e,{thisMode:i}=e,{label:o}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(i);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,i=u.thisMode),"label"in u&&t(2,o=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,i,o,s,a,l]}class rt extends Y{constructor(e){super(),X(this,e,ru,nu,J,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function fi(r){let e;function t(o,s){return o[1]?ou:iu}let n=t(r),i=n(r);return{c(){i.c(),e=be()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&k(e)}}}function iu(r){let e;return{c(){e=E("p"),e.textContent="Click an object to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function ou(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another object"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function su(r){let e,t=r[0]==_t&&fi(r);return{c(){t&&t.c(),e=be()},m(n,i){t&&t.m(n,i),w(n,e,i)},p(n,[i]){n[0]==_t?t?t.p(n,i):(t=fi(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&k(e)}}}const _t="edit-attribute";function Ki(){}function lu(r,e,t){let n,i,o,s;te(r,Ce,c=>t(5,n=c)),te(r,re,c=>t(6,i=c)),te(r,Jt,c=>t(7,o=c)),te(r,ke,c=>t(1,s=c));let{mode:a}=e,{changeMode:l}=e;function u(){ke.set(null)}n.on("mousemove",f),n.on("mouseout",d),n.on("click",p),tt(()=>{n.off("mousemove",f),n.off("mouseout",d),n.off("click",p)});function f(c){var h;if(a==_t){let g=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});De.set(((h=g[0])==null?void 0:h.id)||null)}}function d(){a==_t&&De.set(null)}function p(c){if(a==_t){let h=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});h.length>0?ke.set(h[0].id):ke.set(null)}}return r.$$set=c=>{"mode"in c&&t(0,a=c.mode),"changeMode"in c&&t(2,l=c.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let c=o;if(c){let h=i.features.find(g=>g.id==c);h.geometry.type=="Point"?n.flyTo({center:h.geometry.coordinates,duration:500}):n.fitBounds(lr(h),{padding:200,duration:500}),l(_t)}}},[a,s,l,Ki,u,n,i,o]}class au extends Y{constructor(e){super(),X(this,e,lu,su,J,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Ki}get stop(){return this.$$.ctx[4]}}function uu(r){let e,t;return{c:G,m(n,i){e||(t=q(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function fu(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class Pn extends Y{constructor(e){super(),X(this,e,fu,uu,J,{tool:1})}}function cu(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function pu(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function du(r){let e,t,n,i,o,s,a,l,u,f;function d(h,g){return h[1]?pu:cu}let p=d(r),c=p(r);return a=new Pn({props:{tool:r[0]}}),{c(){e=E("ul"),c.c(),t=O(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=O(),o=E("button"),o.textContent="Cancel",s=O(),I(a.$$.fragment),C(o,"type","button")},m(h,g){w(h,e,g),c.m(e,null),S(e,t),S(e,n),w(h,i,g),w(h,o,g),w(h,s,g),x(a,h,g),l=!0,u||(f=q(o,"click",r[2]),u=!0)},p(h,[g]){p!==(p=d(h))&&(c.d(1),c=p(h),c&&(c.c(),c.m(e,t)));const m={};g&1&&(m.tool=h[0]),a.$set(m)},i(h){l||($(a.$$.fragment,h),l=!0)},o(h){L(a.$$.fragment,h),l=!1},d(h){h&&k(e),c.d(),h&&k(i),h&&k(o),h&&k(s),N(a,h),u=!1,f()}}}function hu(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Zi extends Y{constructor(e){super(),X(this,e,hu,du,J,{pointTool:0,editingExisting:1})}}function mu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function _u(r){let e,t,n,i,o,s,a,l,u,f,d;return e=new Fn({props:{label:"Help",$$slots:{default:[mu]},$$scope:{ctx:r}}}),l=new Pn({props:{tool:r[0]}}),{c(){I(e.$$.fragment),t=O(),n=E("div"),i=E("button"),i.textContent="Finish",o=O(),s=E("button"),s.textContent="Cancel",a=O(),I(l.$$.fragment),C(i,"type","button"),C(s,"type","button"),pe(n,"display","flex"),pe(n,"justify-content","space-between")},m(p,c){x(e,p,c),w(p,t,c),w(p,n,c),S(n,i),S(n,o),S(n,s),w(p,a,c),x(l,p,c),u=!0,f||(d=[q(i,"click",r[1]),q(s,"click",r[2])],f=!0)},p(p,[c]){const h={};c&8&&(h.$$scope={dirty:c,ctx:p}),e.$set(h);const g={};c&1&&(g.tool=p[0]),l.$set(g)},i(p){u||($(e.$$.fragment,p),$(l.$$.fragment,p),u=!0)},o(p){L(e.$$.fragment,p),L(l.$$.fragment,p),u=!1},d(p){N(e,p),p&&k(t),p&&k(n),p&&k(a),N(l,p),f=!1,Ae(d)}}}function gu(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Qi extends Y{constructor(e){super(),X(this,e,gu,_u,J,{polygonTool:0})}}function bu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function yu(r){let e,t,n,i,o,s,a,l,u,f,d;return e=new Fn({props:{label:"Help",$$slots:{default:[bu]},$$scope:{ctx:r}}}),l=new Pn({props:{tool:r[0]}}),{c(){I(e.$$.fragment),t=O(),n=E("div"),i=E("button"),i.textContent="Finish",o=O(),s=E("button"),s.textContent="Cancel",a=O(),I(l.$$.fragment),C(i,"type","button"),C(s,"type","button"),pe(n,"display","flex"),pe(n,"justify-content","space-between")},m(p,c){x(e,p,c),w(p,t,c),w(p,n,c),S(n,i),S(n,o),S(n,s),w(p,a,c),x(l,p,c),u=!0,f||(d=[q(i,"click",r[1]),q(s,"click",r[2])],f=!0)},p(p,[c]){const h={};c&8&&(h.$$scope={dirty:c,ctx:p}),e.$set(h);const g={};c&1&&(g.tool=p[0]),l.$set(g)},i(p){u||($(e.$$.fragment,p),$(l.$$.fragment,p),u=!0)},o(p){L(e.$$.fragment,p),L(l.$$.fragment,p),u=!1},d(p){N(e,p),p&&k(t),p&&k(n),p&&k(a),N(l,p),f=!1,Ae(d)}}}function vu(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class eo extends Y{constructor(e){super(),X(this,e,vu,yu,J,{routeTool:0})}}function wu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function ku(r){let e,t,n,i,o,s,a,l,u,f,d,p,c,h,g;return e=new Fn({props:{label:"Help",$$slots:{default:[wu]},$$scope:{ctx:r}}}),p=new Pn({props:{tool:r[0]}}),{c(){I(e.$$.fragment),t=O(),n=E("label"),i=E("input"),o=K(`
  Avoid doubling back`),s=O(),a=E("div"),l=E("button"),l.textContent="Finish",u=O(),f=E("button"),f.textContent="Cancel",d=O(),I(p.$$.fragment),C(i,"type","checkbox"),C(l,"type","button"),C(f,"type","button"),pe(a,"display","flex"),pe(a,"justify-content","space-between")},m(m,y){x(e,m,y),w(m,t,y),w(m,n,y),S(n,i),i.checked=r[1],S(n,o),w(m,s,y),w(m,a,y),S(a,l),S(a,u),S(a,f),w(m,d,y),x(p,m,y),c=!0,h||(g=[q(i,"change",r[2]),q(l,"click",r[3]),q(f,"click",r[4])],h=!0)},p(m,[y]){const _={};y&32&&(_.$$scope={dirty:y,ctx:m}),e.$set(_),y&2&&(i.checked=m[1]);const b={};y&1&&(b.tool=m[0]),p.$set(b)},i(m){c||($(e.$$.fragment,m),$(p.$$.fragment,m),c=!0)},o(m){L(e.$$.fragment,m),L(p.$$.fragment,m),c=!1},d(m){N(e,m),m&&k(t),m&&k(n),m&&k(s),m&&k(a),m&&k(d),N(p,m),h=!1,Ae(g)}}}function Su(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class to extends Y{constructor(e){super(),X(this,e,Su,ku,J,{routeTool:0})}}function ci(r){let e,t,n,i;const o=[Cu,Lu,Mu,$u,Eu],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=be()},m(l,u){s[e].m(l,u),w(l,n,u),i=!0},p(l,u){let f=e;e=a(l),e===f?s[e].p(l,u):(fe(),L(s[f],1,1,()=>{s[f]=null}),ce(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){i||($(t),i=!0)},o(l){L(t),i=!1},d(l){s[e].d(l),l&&k(n)}}}function Eu(r){let e;return{c(){e=E("p"),e.textContent="Click an object to edit its geometry"},m(t,n){w(t,e,n)},p:G,i:G,o:G,d(t){t&&k(e)}}}function $u(r){let e,t;return e=new to({props:{routeTool:r[3]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Mu(r){let e,t;return e=new eo({props:{routeTool:r[3]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Lu(r){let e,t;return e=new Qi({props:{polygonTool:r[2]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Cu(r){let e,t;return e=new Zi({props:{pointTool:r[1],editingExisting:!0}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Ou(r){let e,t,n=r[0]==qe&&ci(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==qe?n?(n.p(i,o),o&1&&$(n,1)):(n=ci(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const qe="edit-geometry";function no(){}function Ru(r,e,t){let n;te(r,Ce,g=>t(8,n=g));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function f(){l&&(o.stop(),s.stop(),a.stop(),re.update(g=>{let m=g.features.find(y=>y.id==l);return delete m.properties.hide_while_editing,g})),l=null,t(4,u=null),De.set(null)}n.on("mousemove",d),n.on("mouseout",p),n.on("click",c),tt(()=>{n.off("mousemove",d),n.off("mouseout",p),n.off("click",c)}),a.addEventListenerSuccessRoute(g=>{i==qe&&(re.update(m=>{let y=m.features.find(_=>_.id==l);return y.properties.length_meters=g.properties.length_meters,y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,m}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{i==qe&&(re.update(m=>{let y=m.features.find(_=>_.id==l);return y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,m}),l=null,t(4,u=null))});for(let g of[o,s])g.addEventListenerSuccess(m=>{i==qe&&(re.update(y=>{let _=y.features.find(b=>b.id==l);return _.geometry=m.geometry,delete _.properties.hide_while_editing,y}),l=null,t(4,u=null))});for(let g of[o,s,a])g.addEventListenerFailure(()=>{i==qe&&(re.update(m=>{let y=m.features.find(_=>_.id==l);return delete y.properties.hide_while_editing,m}),l=null,t(4,u=null))});function d(g){var m;if(i==qe&&l==null){let y=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});De.set(((m=y[0])==null?void 0:m.id)||null)}}function p(){i==qe&&l==null&&De.set(null)}function c(g){if(i==qe&&l==null){let m=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0&&h(m[0].id)}}function h(g){De.set(null);let m=null;re.update(_=>(m=_.features.find(b=>b.id==g),m.properties.hide_while_editing=!0,_));let y=m;l=g,y.geometry.type=="LineString"?(a.editExistingRoute(y),t(4,u="route")):y.geometry.type=="Polygon"?y.properties.waypoints?(a.editExistingArea(y),t(4,u="snap-polygon")):(s.editExisting(y),t(4,u="free-polygon")):y.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"pointTool"in g&&t(1,o=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[i,o,s,a,u,no,f]}class Au extends Y{constructor(e){super(),X(this,e,Ru,Ou,J,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return no}get stop(){return this.$$.ctx[6]}}async function Tu(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:f}=await n.read();if(u)break;s.push(f),o+=f.length;const d=100*o/i;e.style=`background: linear-gradient(to right, red ${d}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function Fu(r){let e,t;return e=new to({props:{routeTool:r[0]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Pu(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&k(e),r[7](null)}}}function Iu(r){let e,t,n,i;const o=[Pu,Fu],s=[];function a(l,u){return l[0]?l[1]==or?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=be()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),i=!0},p(l,[u]){let f=e;e=a(l),e===f?~e&&s[e].p(l,u):(t&&(fe(),L(s[f],1,1,()=>{s[f]=null}),ce()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||($(t),i=!0)},o(l){L(t),i=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const or="route";function xu(r,e,t){let n;te(r,Ce,p=>t(8,n=p));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function f(){l==null||l.stop()}Lt(async()=>{await Vi(),console.log(`Grabbing ${s}`);try{const p=await Tu(s,a);t(0,l=new tu(n,p))}catch(p){console.log(`Route tool broke: ${p}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==or&&o("edit-attribute")}),l.addEventListenerSuccessRoute(p=>{i==or&&(re.update(c=>(p.id=Wt(c),p.properties.intervention_type="route",c.features.push(p),c)),o("edit-attribute"),ke.set(p.id))})});function d(p){ue[p?"unshift":"push"](()=>{a=p,t(2,a)})}return r.$$set=p=>{"mode"in p&&t(1,i=p.mode),"changeMode"in p&&t(3,o=p.changeMode),"url"in p&&t(4,s=p.url),"routeTool"in p&&t(0,l=p.routeTool)},[l,i,a,o,s,u,f,d]}class Nu extends Y{constructor(e){super(),X(this,e,xu,Iu,J,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function pi(r){let e,t;return e=new Zi({props:{pointTool:r[1],editingExisting:!1}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function ju(r){let e,t,n=r[0]==kn&&pi(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==kn?n?(n.p(i,o),o&1&&$(n,1)):(n=pi(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const kn="point";function Bu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==kn&&(re.update(u=>(l.id=Wt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),ke.set(l.id))}),o.addEventListenerFailure(()=>{n==kn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class Du extends Y{constructor(e){super(),X(this,e,Bu,ju,J,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function di(r){let e,t;return e=new Qi({props:{polygonTool:r[1]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Uu(r){let e,t,n=r[0]==Sn&&di(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==Sn?n?(n.p(i,o),o&1&&$(n,1)):(n=di(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const Sn="free-polygon";function qu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Sn&&(re.update(u=>(l.id=Wt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),ke.set(l.id))}),o.addEventListenerFailure(()=>{n==Sn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Gu extends Y{constructor(e){super(),X(this,e,qu,Uu,J,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function hi(r){let e,t;return e=new eo({props:{routeTool:r[1]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Hu(r){let e,t,n=r[0]==En&&hi(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==En?n?(n.p(i,o),o&1&&$(n,1)):(n=hi(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const En="snap-polygon";function Ju(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==En&&(re.update(u=>(l.id=Wt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),ke.set(l.id))}),o.addEventListenerFailure(()=>{n==En&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class zu extends Y{constructor(e){super(),X(this,e,Ju,Hu,J,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Yu(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Ye(r.slice(0,2),[n,t]),s=Ye(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Xu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return ko(r,function(s){Wu(s,o,n)}),r}function Wu(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Vu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=er(r),n=er(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Xu(e,{precision:7});switch(n){case"Point":return sr(r,i);case"MultiPoint":return mi(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return mi(r,Xi(r,i))}}function mi(r,e){var t=[],n=Mt();return ar(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=sr(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=Yu(So(a)))}),n.load(Ke(t));else{var o=n.search(i);if(o.features.length){var s=ro(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),mn(sr(s,i),function(a){t.push(a),n.insert(a)})}}}),Ke(t)}function sr(r,e){var t=[],n=Ue(r)[0],i=Ue(r)[r.geometry.coordinates.length-1];if(qn(n,Ze(e))||qn(i,Ze(e)))return Ke([r]);var o=Mt(),s=tr(r);o.load(s);var a=o.search(e);if(!a.features.length)return Ke([r]);var l=ro(e,a),u=[n],f=Eo(s,function(d,p,c){var h=Ue(p)[1],g=Ze(e);return c===l.id?(d.push(g),t.push(Et(d)),qn(g,h)?[g]:[g,h]):(d.push(h),d)},u);return f.length>1&&t.push(Et(f)),Ke(t)}function ro(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return mn(e,function(i){var o=Xt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function qn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Ku(r,e,t){var n=Ue(t);if(er(t)!=="LineString")throw new Error("line must be a LineString");var i=Xt(t,r),o=Xt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),Et(a,t.properties)}function _i(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Zu(r){let e,t,n,i=r[0]==qt&&_i();return{c(){i&&i.c(),e=be()},m(o,s){i&&i.m(o,s),w(o,e,s),t||(n=q(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==qt?i||(i=_i(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:G,o:G,d(o){i&&i.d(o),o&&k(e),t=!1,n()}}}const qt="split-route",Qu=10,ef=30;let Gn="split-route";function io(){}function gi(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function tf(r,e,t){let n,i;te(r,re,g=>t(8,n=g)),te(r,Ce,g=>t(6,i=g));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",f),i.on("click",d),tt(()=>{i.off("mousemove",f),i.off("click",d)}),Je(i,Gn,xe()),we(i,{id:"draw-split-route",source:Gn,...Ct("black",Qu,["case",["==",["get","snapped"],!0],1,.5])});function f(g){if(o!=qt)return;t(5,l=gi(g.lngLat.toArray(),!1)),u=null;const m=[g.point.x-ef,g.point.y],y=i.unproject(g.point).distanceTo(i.unproject(m))/1e3;let _=[];for(let[b,v]of n.features.entries())if(v.geometry.type=="LineString"){let M=Xt(v.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=y&&_.push([b,M.geometry.coordinates,M.properties.dist])}_.sort((b,v)=>b[2]-v[2]),_.length>0&&(t(5,l=gi(_[0][1],!0)),u=_[0][0])}function d(){if(o==qt)if(u==null)s("edit-attribute");else{let g=Vu(n.features[u],l);if(g.features.length==2){let m=g.features[0],y=g.features[1];re.update(_=>(m.id=_.features[u].id,y.id=Wt(_),m.properties=JSON.parse(JSON.stringify(_.features[u].properties)),y.properties=JSON.parse(JSON.stringify(m.properties)),p(_.features[u],m,y,l),_.features.splice(u,1,m,y),_))}a()}}function p(g,m,y,_){m.properties.length_meters=ln(m,{units:"kilometers"})*1e3,y.properties.length_meters=ln(y,{units:"kilometers"})*1e3,m.properties.waypoints=[],y.properties.waypoints=[];let b=c(g,_),v=!0,M=0;for(let R of g.properties.waypoints){let F=c(g,wt([R.lon,R.lat]));if(v)if(F<b)m.properties.waypoints.push(R);else{let A=R.snapped&&g.properties.waypoints[M-1].snapped;m.properties.waypoints.push({lon:_.geometry.coordinates[0],lat:_.geometry.coordinates[1],snapped:A}),v=!1,y.properties.waypoints.push({lon:_.geometry.coordinates[0],lat:_.geometry.coordinates[1],snapped:A}),y.properties.waypoints.push(R)}else y.properties.waypoints.push(R);M++}}function c(g,m){let y=g.geometry.coordinates[0],_=Ku(y,m,g);return ln(_,{units:"kilometers"})*1e3}function h(g){o==qt&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=xe();l&&g.features.push(l),i.getSource(Gn).setData(g)}},[o,h,s,io,a,l,i]}class nf extends Y{constructor(e){super(),X(this,e,tf,Zu,J,{mode:0,changeMode:2,start:3,stop:4})}get start(){return io}get stop(){return this.$$.ctx[4]}}const rf="/atip/layer_lanes/assets/edit_attributes-29b396e1.svg",of="/atip/layer_lanes/assets/edit_geometry-02dad294.svg",sf="/atip/layer_lanes/assets/point-276f4055.svg",lf="/atip/layer_lanes/assets/polygon_snapped-18efbbea.svg",af="/atip/layer_lanes/assets/polygon_freehand-cf965967.svg",uf="/atip/layer_lanes/assets/route-d3c0ebad.svg",ff="/atip/layer_lanes/assets/split_route-9e0ea2da.svg";function bi(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new Au({props:n}),r[15](e),{c(){I(e.$$.fragment)},m(i,o){x(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){r[15](null),N(e,i)}}}function yi(r){let e,t;return e=new rt({props:{mode:r[3],thisMode:"point",label:"New point",icon:sf,changeMode:r[13]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function vi(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new zu({props:n}),r[18](e),{c(){I(e.$$.fragment)},m(i,o){x(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){r[18](null),N(e,i)}}}function wi(r){let e,t;return e=new rt({props:{mode:r[3],thisMode:"route",label:"New route",icon:uf,changeMode:r[13]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function ki(r){let e,t;return e=new rt({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:ff,changeMode:r[13]}}),{c(){I(e.$$.fragment)},m(n,i){x(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function cf(r){let e,t,n,i,o,s,a,l,u,f,d,p,c,h,g,m,y,_,b,v,M,R,F,A,B,T,D,Q,j,H,ae,Se;n=new rt({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:rf,changeMode:r[13]}});let Fe={mode:r[3],changeMode:r[13]};o=new au({props:Fe}),r[14](o),l=new rt({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:of,changeMode:r[13]}});let oe=r[2]&&bi(r),ie=r[1]!="planning"&&yi(r),Ne={mode:r[3],changeMode:r[13],pointTool:r[11]};c=new Du({props:Ne}),r[16](c),m=new rt({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:af,changeMode:r[13]}});let Le={mode:r[3],changeMode:r[13],polygonTool:r[12]};_=new Gu({props:Le}),r[17](_),M=new rt({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:lf,changeMode:r[13]}});let ee=r[2]&&vi(r),he=r[1]!="planning"&&wi(r);function Kt(U){r[20](U)}let ge={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(ge.routeTool=r[2]),T=new Nu({props:ge}),r[19](T),ue.push(()=>Ee(T,"routeTool",Kt,r[2]));let P=r[1]!="planning"&&ki(r),ne={mode:r[3],changeMode:r[13]};return ae=new nf({props:ne}),r[21](ae),{c(){e=E("div"),t=E("div"),I(n.$$.fragment),i=O(),I(o.$$.fragment),s=O(),a=E("div"),I(l.$$.fragment),u=O(),oe&&oe.c(),f=O(),d=E("div"),ie&&ie.c(),p=O(),I(c.$$.fragment),h=O(),g=E("div"),I(m.$$.fragment),y=O(),I(_.$$.fragment),b=O(),v=E("div"),I(M.$$.fragment),R=O(),ee&&ee.c(),F=O(),A=E("div"),he&&he.c(),B=O(),I(T.$$.fragment),Q=O(),j=E("div"),P&&P.c(),H=O(),I(ae.$$.fragment),C(e,"class","toolbox svelte-4s4d3o")},m(U,de){w(U,e,de),S(e,t),x(n,t,null),S(t,i),x(o,t,null),S(e,s),S(e,a),x(l,a,null),S(a,u),oe&&oe.m(a,null),S(e,f),S(e,d),ie&&ie.m(d,null),S(d,p),x(c,d,null),S(e,h),S(e,g),x(m,g,null),S(g,y),x(_,g,null),S(e,b),S(e,v),x(M,v,null),S(v,R),ee&&ee.m(v,null),S(e,F),S(e,A),he&&he.m(A,null),S(A,B),x(T,A,null),S(e,Q),S(e,j),P&&P.m(j,null),S(j,H),x(ae,j,null),Se=!0},p(U,[de]){const dr={};de&8&&(dr.mode=U[3]),n.$set(dr);const hr={};de&8&&(hr.mode=U[3]),o.$set(hr);const mr={};de&8&&(mr.mode=U[3]),l.$set(mr),U[2]?oe?(oe.p(U,de),de&4&&$(oe,1)):(oe=bi(U),oe.c(),$(oe,1),oe.m(a,null)):oe&&(fe(),L(oe,1,1,()=>{oe=null}),ce()),U[1]!="planning"?ie?(ie.p(U,de),de&2&&$(ie,1)):(ie=yi(U),ie.c(),$(ie,1),ie.m(d,p)):ie&&(fe(),L(ie,1,1,()=>{ie=null}),ce());const _r={};de&8&&(_r.mode=U[3]),c.$set(_r);const gr={};de&8&&(gr.mode=U[3]),m.$set(gr);const br={};de&8&&(br.mode=U[3]),_.$set(br);const yr={};de&8&&(yr.mode=U[3]),M.$set(yr),U[2]?ee?(ee.p(U,de),de&4&&$(ee,1)):(ee=vi(U),ee.c(),$(ee,1),ee.m(v,null)):ee&&(fe(),L(ee,1,1,()=>{ee=null}),ce()),U[1]!="planning"?he?(he.p(U,de),de&2&&$(he,1)):(he=wi(U),he.c(),$(he,1),he.m(A,B)):he&&(fe(),L(he,1,1,()=>{he=null}),ce());const Zt={};de&8&&(Zt.mode=U[3]),de&1&&(Zt.url=U[0]),!D&&de&4&&(D=!0,Zt.routeTool=U[2],$e(()=>D=!1)),T.$set(Zt),U[1]!="planning"?P?(P.p(U,de),de&2&&$(P,1)):(P=ki(U),P.c(),$(P,1),P.m(j,H)):P&&(fe(),L(P,1,1,()=>{P=null}),ce());const vr={};de&8&&(vr.mode=U[3]),ae.$set(vr)},i(U){Se||($(n.$$.fragment,U),$(o.$$.fragment,U),$(l.$$.fragment,U),$(oe),$(ie),$(c.$$.fragment,U),$(m.$$.fragment,U),$(_.$$.fragment,U),$(M.$$.fragment,U),$(ee),$(he),$(T.$$.fragment,U),$(P),$(ae.$$.fragment,U),Se=!0)},o(U){L(n.$$.fragment,U),L(o.$$.fragment,U),L(l.$$.fragment,U),L(oe),L(ie),L(c.$$.fragment,U),L(m.$$.fragment,U),L(_.$$.fragment,U),L(M.$$.fragment,U),L(ee),L(he),L(T.$$.fragment,U),L(P),L(ae.$$.fragment,U),Se=!1},d(U){U&&k(e),N(n),r[14](null),N(o),N(l),oe&&oe.d(),ie&&ie.d(),r[16](null),N(c),N(m),r[17](null),N(_),N(M),ee&&ee.d(),he&&he.d(),r[19](null),N(T),P&&P.d(),r[21](null),N(ae)}}}function pf(r,e,t){let n;te(r,Ce,T=>t(22,n=T));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new Pa(n),l=new za(n),u="edit-attribute",f,d,p,c,h,g,m;function y(T){let D={"edit-attribute":f,"edit-geometry":d,route:p,point:c,"free-polygon":h,"snap-polygon":g,"split-route":m};if(u==T){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),D[u].stop(),t(3,u=T),console.log(`Starting new mode ${u}`),D[u].start()}tt(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function _(T){ue[T?"unshift":"push"](()=>{f=T,t(4,f)})}function b(T){ue[T?"unshift":"push"](()=>{d=T,t(5,d)})}function v(T){ue[T?"unshift":"push"](()=>{c=T,t(7,c)})}function M(T){ue[T?"unshift":"push"](()=>{h=T,t(8,h)})}function R(T){ue[T?"unshift":"push"](()=>{g=T,t(9,g)})}function F(T){ue[T?"unshift":"push"](()=>{p=T,t(6,p)})}function A(T){s=T,t(2,s)}function B(T){ue[T?"unshift":"push"](()=>{m=T,t(10,m)})}return r.$$set=T=>{"routeSnapperUrl"in T&&t(0,i=T.routeSnapperUrl),"schema"in T&&t(1,o=T.schema)},[i,o,s,u,f,d,p,c,h,g,m,a,l,y,_,b,v,M,R,F,A,B]}class df extends Y{constructor(e){super(),X(this,e,pf,cf,J,{routeSnapperUrl:0,schema:1})}}function hf(r){let e,t,n,i,o,s,a,l,u,f,d,p,c,h,g,m,y,_,b;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",i=O(),o=E("button"),o.textContent="About",s=O(),a=E("button"),a.textContent="Instructions",l=O(),u=E("br"),f=O(),d=E("label"),p=K(`ATIP schema:
      `),c=E("select"),h=E("option"),h.textContent="v1",g=E("option"),g.textContent="v2",m=E("option"),m.textContent="Housing developments",y=E("option"),y.textContent="Critical issues",C(n,"type","button"),C(o,"type","button"),C(a,"type","button"),h.__value="v1",h.value=h.__value,g.__value="v2",g.value=g.__value,m.__value="planning",m.value=m.__value,y.__value="criticals",y.value=y.__value,r[2]===void 0&&ot(()=>r[11].call(c)),C(e,"slot","nav")},m(v,M){w(v,e,M),S(e,t),S(t,n),S(t,i),S(t,o),S(t,s),S(t,a),S(e,l),S(e,u),S(e,f),S(e,d),S(d,p),S(d,c),S(c,h),S(c,g),S(c,m),S(c,y),Qe(c,r[2]),_||(b=[q(n,"click",r[10]),q(o,"click",r[7]),q(a,"click",r[8]),q(c,"change",r[11]),q(c,"change",r[9])],_=!0)},p(v,M){M&4&&Qe(c,v[2])},d(v){v&&k(e),_=!1,Ae(b)}}}function mf(r){let e,t,n,i,o,s,a,l,u,f,d,p,c,h,g,m;return o=new ba({props:{boundaryGeojson:r[4]}}),a=new ha({props:{authorityName:r[5],schema:r[2]}}),d=new sa({props:{schema:r[2]}}),g=new ua({}),{c(){e=E("div"),t=E("h1"),n=K(r[5]),i=O(),I(o.$$.fragment),s=O(),I(a.$$.fragment),l=O(),u=E("br"),f=O(),I(d.$$.fragment),p=O(),c=E("hr"),h=O(),I(g.$$.fragment),C(e,"slot","sidebar")},m(y,_){w(y,e,_),S(e,t),S(t,n),S(t,i),x(o,t,null),S(e,s),x(a,e,null),S(e,l),S(e,u),S(e,f),x(d,e,null),S(e,p),S(e,c),S(e,h),x(g,e,null),m=!0},p(y,_){const b={};_&16&&(b.boundaryGeojson=y[4]),o.$set(b);const v={};_&4&&(v.schema=y[2]),a.$set(v);const M={};_&4&&(M.schema=y[2]),d.$set(M)},i(y){m||($(o.$$.fragment,y),$(a.$$.fragment,y),$(d.$$.fragment,y),$(g.$$.fragment,y),m=!0)},o(y){L(o.$$.fragment,y),L(a.$$.fragment,y),L(d.$$.fragment,y),L(g.$$.fragment,y),m=!1},d(y){y&&k(e),N(o),N(a),N(d),N(g)}}}function _f(r){let e,t,n,i,o,s,a,l,u,f,d,p;return e=new Ps({props:{boundaryGeojson:r[4]}}),n=new Aa({props:{schema:r[2]}}),o=new Fa({}),a=new df({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new wa({props:{style:r[6]}}),d=new Oa({props:{schema:r[2]}}),{c(){I(e.$$.fragment),t=O(),I(n.$$.fragment),i=O(),I(o.$$.fragment),s=O(),I(a.$$.fragment),l=O(),I(u.$$.fragment),f=O(),I(d.$$.fragment)},m(c,h){x(e,c,h),w(c,t,h),x(n,c,h),w(c,i,h),x(o,c,h),w(c,s,h),x(a,c,h),w(c,l,h),x(u,c,h),w(c,f,h),x(d,c,h),p=!0},p(c,h){const g={};h&16&&(g.boundaryGeojson=c[4]),e.$set(g);const m={};h&4&&(m.schema=c[2]),n.$set(m);const y={};h&8&&(y.routeSnapperUrl=c[3]),h&4&&(y.schema=c[2]),a.$set(y);const _={};h&4&&(_.schema=c[2]),d.$set(_)},i(c){p||($(e.$$.fragment,c),$(n.$$.fragment,c),$(o.$$.fragment,c),$(a.$$.fragment,c),$(u.$$.fragment,c),$(d.$$.fragment,c),p=!0)},o(c){L(e.$$.fragment,c),L(n.$$.fragment,c),L(o.$$.fragment,c),L(a.$$.fragment,c),L(u.$$.fragment,c),L(d.$$.fragment,c),p=!1},d(c){N(e,c),c&&k(t),N(n,c),c&&k(i),N(o,c),c&&k(s),N(a,c),c&&k(l),N(u,c),c&&k(f),N(d,c)}}}function gf(r){let e,t,n;return t=new ts({props:{style:r[6],$$slots:{default:[_f]},$$scope:{ctx:r}}}),{c(){e=E("div"),I(t.$$.fragment),C(e,"slot","main")},m(i,o){w(i,e,o),x(t,e,null),n=!0},p(i,o){const s={};o&524316&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){L(t.$$.fragment,i),n=!1},d(i){i&&k(e),N(t)}}}function bf(r){let e,t,n,i,o,s,a,l;e=new ls({props:{$$slots:{main:[gf],sidebar:[mf],nav:[hf]},$$scope:{ctx:r}}});function u(c){r[12](c)}let f={};r[0]!==void 0&&(f.open=r[0]),n=new $o({props:f}),ue.push(()=>Ee(n,"open",u,r[0]));function d(c){r[13](c)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new Zo({props:p}),ue.push(()=>Ee(s,"open",d,r[1])),{c(){I(e.$$.fragment),t=O(),I(n.$$.fragment),o=O(),I(s.$$.fragment)},m(c,h){x(e,c,h),w(c,t,h),x(n,c,h),w(c,o,h),x(s,c,h),l=!0},p(c,[h]){const g={};h&524316&&(g.$$scope={dirty:h,ctx:c}),e.$set(g);const m={};!i&&h&1&&(i=!0,m.open=c[0],$e(()=>i=!1)),n.$set(m);const y={};!a&&h&2&&(a=!0,y.open=c[1],$e(()=>a=!1)),s.$set(y)},i(c){l||($(e.$$.fragment,c),$(n.$$.fragment,c),$(s.$$.fragment,c),l=!0)},o(c){L(e.$$.fragment,c),L(n.$$.fragment,c),L(s.$$.fragment,c),l=!1},d(c){N(e,c),c&&k(t),N(n,c),c&&k(o),N(s,c)}}}function yf(r,e,t){let n;te(r,Gt,R=>t(15,n=R));let i=!1,o=!1,s=window.location.hostname.includes("atip.uk");const a=new URLSearchParams(window.location.search);let l=a.get("authority"),u=a.get("style")||"streets",f=a.get("schema")||"v1";var d=`https://atip.uk/route-snappers/${l}.bin`,p=`https://atip.uk/route-info/${l}.bin`;s||(d=`https://atip.uk/route-snappers-dev/${l}.bin`,p=`https://atip.uk/route-info-dev/${l}.bin`);function c(){t(0,i=!i),t(1,o=!1)}function h(){t(1,o=!o),t(0,i=!1)}let g;Lt(async()=>{t(4,g=await m());const R=Ci(new Bo);Gt.set(await new R),await n.loadFile(p)});async function m(){const F=await(await fetch(Mo)).text(),A=JSON.parse(F);return A.features=A.features.filter(B=>{var T;return((T=B.properties)==null?void 0:T.name)==l}),A}function y(){let R=new URLSearchParams(window.location.search);R.set("schema",f);let F=`${window.location.pathname}?${R.toString()}${window.location.hash}`;window.location.href=F}const _=()=>window.open("index.html");function b(){f=Ln(this),t(2,f)}function v(R){i=R,t(0,i)}function M(R){o=R,t(1,o)}return[i,o,f,d,g,l,u,c,h,y,_,b,v,M]}class vf extends Y{constructor(e){super(),X(this,e,yf,bf,J,{})}}new vf({target:document.getElementById("app")});
