var io=Object.defineProperty;var oo=(r,e,t)=>e in r?io(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var le=(r,e,t)=>(oo(r,typeof e!="symbol"?e+"":e,t),t);import{x as H,s as Y,y as Ne,S as W,i as V,M as so,b as ue,a as Ee,d as x,m as N,k as Me,n as M,o as L,q as B,e as E,c as R,g as w,p as k,f as C,z as fe,B as ce,C as lo,D as Lt,E as nn,F as nt,G as gt,H as bt,I as yt,J as vt,K as yr,h as S,l as G,L as ao,N as uo,O as ne,P as fo,w as or,Q as Ye,R as we,T as Mn,U as pn,V as pe,t as Q,W as Ae,X as dn,Y as kt,Z as vi,_ as ge,$ as st,a0 as et,a1 as $n,j as Re,r as Te,a2 as wi,a3 as St,a4 as hn,a5 as vr,a6 as co,a7 as po,a8 as Ie,a9 as ho,aa as _o,ab as Ln,ac as Ct,ad as Cn,ae as On,af as qn,ag as mo,ah as wt,ai as sr,aj as Ze,ak as Et,al as go,am as lr,an as bo,ao as yo,ap as vo,aq as wr,ar as _n,as as wo,at as ko,au as So,A as Eo,u as Mo}from"./authorities-d07e0c3c.js";const at=[];function lt(r,e=H){let t;const n=new Set;function i(a){if(Y(r,a)&&(r=a,t)){const l=!at.length;for(const u of n)u[1](),at.push(u,r);if(l){for(let u=0;u<at.length;u+=2)at[u][0](at[u+1]);at.length=0}}}function o(a){i(a(r))}function s(a,l=H){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||H),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ce=lt(null),Gt=lt(null),ie=lt(Ne()),ke=lt(null),qe=lt(null),Ht=lt(null),zt=lt(null);function Wt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function kr(r){console.log(`Deleting intervention ${r}`),ie.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),ke.set(null),qe.set(null),Ht.set(null),zt.set(null)}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ki=Symbol("Comlink.proxy"),$o=Symbol("Comlink.endpoint"),Lo=Symbol("Comlink.releaseProxy"),Fn=Symbol("Comlink.finalizer"),rn=Symbol("Comlink.thrown"),Si=r=>typeof r=="object"&&r!==null||typeof r=="function",Co={canHandle:r=>Si(r)&&r[ki],serialize(r){const{port1:e,port2:t}=new MessageChannel;return ar(r,e),[t,[t]]},deserialize(r){return r.start(),$i(r)}},Oo={canHandle:r=>Si(r)&&rn in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},Ei=new Map([["proxy",Co],["throw",Oo]]);function Ro(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function ar(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!Ro(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(rt);let u;try{const f=a.slice(0,-1).reduce((p,c)=>p[c],r),h=a.reduce((p,c)=>p[c],r);switch(s){case"GET":u=h;break;case"SET":f[a.slice(-1)[0]]=rt(i.data.value),u=!0;break;case"APPLY":u=h.apply(f,l);break;case"CONSTRUCT":{const p=new h(...l);u=xo(p)}break;case"ENDPOINT":{const{port1:p,port2:c}=new MessageChannel;ar(r,c),u=Io(p,[p])}break;case"RELEASE":u=void 0;break;default:return}}catch(f){u={value:f,[rn]:0}}Promise.resolve(u).catch(f=>({value:f,[rn]:0})).then(f=>{const[h,p]=bn(f);e.postMessage(Object.assign(Object.assign({},h),{id:o}),p),s==="RELEASE"&&(e.removeEventListener("message",n),Mi(e),Fn in r&&typeof r[Fn]=="function"&&r[Fn]())}).catch(f=>{const[h,p]=bn({value:new TypeError("Unserializable return value"),[rn]:0});e.postMessage(Object.assign(Object.assign({},h),{id:o}),p)})}),e.start&&e.start()}function Ao(r){return r.constructor.name==="MessagePort"}function Mi(r){Ao(r)&&r.close()}function $i(r,e){return Gn(r,[],e)}function Qt(r){if(r)throw new Error("Proxy has been released and is not useable")}function Li(r){return ht(r,{type:"RELEASE"}).then(()=>{Mi(r)})}const mn=new WeakMap,gn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(mn.get(r)||0)-1;mn.set(r,e),e===0&&Li(r)});function To(r,e){const t=(mn.get(e)||0)+1;mn.set(e,t),gn&&gn.register(r,e,r)}function Fo(r){gn&&gn.unregister(r)}function Gn(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(Qt(n),s===Lo)return()=>{Fo(i),Li(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=ht(r,{type:"GET",path:e.map(l=>l.toString())}).then(rt);return a.then.bind(a)}return Gn(r,[...e,s])},set(o,s,a){Qt(n);const[l,u]=bn(a);return ht(r,{type:"SET",path:[...e,s].map(f=>f.toString()),value:l},u).then(rt)},apply(o,s,a){Qt(n);const l=e[e.length-1];if(l===$o)return ht(r,{type:"ENDPOINT"}).then(rt);if(l==="bind")return Gn(r,e.slice(0,-1));const[u,f]=Sr(a);return ht(r,{type:"APPLY",path:e.map(h=>h.toString()),argumentList:u},f).then(rt)},construct(o,s){Qt(n);const[a,l]=Sr(s);return ht(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(rt)}});return To(i,r),i}function Po(r){return Array.prototype.concat.apply([],r)}function Sr(r){const e=r.map(bn);return[e.map(t=>t[0]),Po(e.map(t=>t[1]))]}const Ci=new WeakMap;function Io(r,e){return Ci.set(r,e),r}function xo(r){return Object.assign(r,{[ki]:!0})}function bn(r){for(const[e,t]of Ei)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},Ci.get(r)||[]]}function rt(r){switch(r.type){case"HANDLER":return Ei.get(r.name).deserialize(r.value);case"RAW":return r.value}}function ht(r,e,t){return new Promise(n=>{const i=No();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function No(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Bo(){return new Worker("/atip/layer_lanes/assets/worker-04bda48e.js")}let U;const Oi=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Oi.decode();let Ft=null;function Nt(){return(Ft===null||Ft.byteLength===0)&&(Ft=new Uint8Array(U.memory.buffer)),Ft}function Oe(r,e){return r=r>>>0,Oi.decode(Nt().subarray(r,r+e))}const ze=new Array(128).fill(void 0);ze.push(void 0,null,!0,!1);let Bt=ze.length;function _e(r){Bt===ze.length&&ze.push(ze.length+1);const e=Bt;return Bt=ze[e],ze[e]=r,e}function J(r){return ze[r]}function jo(r){r<132||(ze[r]=Bt,Bt=r)}function De(r){const e=J(r);return jo(r),e}let ot=0;const on=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Do=typeof on.encodeInto=="function"?function(r,e){return on.encodeInto(r,e)}:function(r,e){const t=on.encode(r);return e.set(t),{read:r.length,written:t.length}};function Pn(r,e,t){if(t===void 0){const a=on.encode(r),l=e(a.length)>>>0;return Nt().subarray(l,l+a.length).set(a),ot=a.length,l}let n=r.length,i=e(n)>>>0;const o=Nt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3)>>>0;const a=Nt().subarray(i+s,i+n),l=Do(r,a);s+=l.written}return ot=s,i}function Ot(r){return r==null}let Pt=null;function X(){return(Pt===null||Pt.byteLength===0)&&(Pt=new Int32Array(U.memory.buffer)),Pt}let It=null;function Uo(){return(It===null||It.byteLength===0)&&(It=new Float64Array(U.memory.buffer)),It}let xt=null;function qo(){return(xt===null||xt.byteLength===0)&&(xt=new BigInt64Array(U.memory.buffer)),xt}function Hn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Hn(r[0]));for(let s=1;s<i;s++)o+=", "+Hn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Go(r,e){const t=e(r.length*1)>>>0;return Nt().set(r,t/1),ot=r.length,t}function In(r,e){try{return r.apply(this,e)}catch(t){U.__wbindgen_exn_store(_e(t))}}let zn=class{static __wrap(e){e=e>>>0;const t=Object.create(zn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();U.__wbg_routeinfo_free(e)}constructor(e){try{const o=U.__wbindgen_add_to_stack_pointer(-16),s=Go(e,U.__wbindgen_malloc),a=ot;U.routeinfo_new(o,s,a);var t=X()[o/4+0],n=X()[o/4+1],i=X()[o/4+2];if(i)throw De(n);return zn.__wrap(t)}finally{U.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const f=U.__wbindgen_add_to_stack_pointer(-16);U.routeinfo_nameForRoute(f,this.__wbg_ptr,_e(e));var i=X()[f/4+0],o=X()[f/4+1],s=X()[f/4+2],a=X()[f/4+3],l=i,u=o;if(a)throw l=0,u=0,De(s);return t=l,n=u,Oe(l,u)}finally{U.__wbindgen_add_to_stack_pointer(16),U.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const f=U.__wbindgen_add_to_stack_pointer(-16);U.routeinfo_speedLimitForRoute(f,this.__wbg_ptr,_e(e));var i=X()[f/4+0],o=X()[f/4+1],s=X()[f/4+2],a=X()[f/4+3],l=i,u=o;if(a)throw l=0,u=0,De(s);return t=l,n=u,Oe(l,u)}finally{U.__wbindgen_add_to_stack_pointer(16),U.__wbindgen_free(t,n)}}allSpeedLimits(){let e,t;try{const u=U.__wbindgen_add_to_stack_pointer(-16);U.routeinfo_allSpeedLimits(u,this.__wbg_ptr);var n=X()[u/4+0],i=X()[u/4+1],o=X()[u/4+2],s=X()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,De(o);return e=a,t=l,Oe(a,l)}finally{U.__wbindgen_add_to_stack_pointer(16),U.__wbindgen_free(e,t)}}renderLanePolygons(){let e,t;try{const u=U.__wbindgen_add_to_stack_pointer(-16);U.routeinfo_renderLanePolygons(u,this.__wbg_ptr);var n=X()[u/4+0],i=X()[u/4+1],o=X()[u/4+2],s=X()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,De(o);return e=a,t=l,Oe(a,l)}finally{U.__wbindgen_add_to_stack_pointer(16),U.__wbindgen_free(e,t)}}renderLaneMarkings(){let e,t;try{const u=U.__wbindgen_add_to_stack_pointer(-16);U.routeinfo_renderLaneMarkings(u,this.__wbg_ptr);var n=X()[u/4+0],i=X()[u/4+1],o=X()[u/4+2],s=X()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,De(o);return e=a,t=l,Oe(a,l)}finally{U.__wbindgen_add_to_stack_pointer(16),U.__wbindgen_free(e,t)}}renderIntersectionPolygons(){let e,t;try{const u=U.__wbindgen_add_to_stack_pointer(-16);U.routeinfo_renderIntersectionPolygons(u,this.__wbg_ptr);var n=X()[u/4+0],i=X()[u/4+1],o=X()[u/4+2],s=X()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,De(o);return e=a,t=l,Oe(a,l)}finally{U.__wbindgen_add_to_stack_pointer(16),U.__wbindgen_free(e,t)}}renderIntersectionMarkings(){let e,t;try{const u=U.__wbindgen_add_to_stack_pointer(-16);U.routeinfo_renderIntersectionMarkings(u,this.__wbg_ptr);var n=X()[u/4+0],i=X()[u/4+1],o=X()[u/4+2],s=X()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,De(o);return e=a,t=l,Oe(a,l)}finally{U.__wbindgen_add_to_stack_pointer(16),U.__wbindgen_free(e,t)}}renderLaneDetailsForRoute(e){let t,n;try{const f=U.__wbindgen_add_to_stack_pointer(-16);U.routeinfo_renderLaneDetailsForRoute(f,this.__wbg_ptr,_e(e));var i=X()[f/4+0],o=X()[f/4+1],s=X()[f/4+2],a=X()[f/4+3],l=i,u=o;if(a)throw l=0,u=0,De(s);return t=l,n=u,Oe(l,u)}finally{U.__wbindgen_add_to_stack_pointer(16),U.__wbindgen_free(t,n)}}};async function Ho(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function zo(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Oe(e,t);return _e(n)},r.wbg.__wbindgen_object_drop_ref=function(e){De(e)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=Ot(i)?0:Pn(i,U.__wbindgen_malloc,U.__wbindgen_realloc),s=ot;X()[e/4+1]=s,X()[e/4+0]=o},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Oe(e,t));return _e(n)},r.wbg.__wbindgen_is_bigint=function(e){return typeof J(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return _e(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return J(e)===J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;Uo()[e/8+1]=Ot(i)?0:i,X()[e/4+0]=!Ot(i)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return _e(t)},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return _e(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=J(e)[J(t)];return _e(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return _e(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=Pn(n,U.__wbindgen_malloc,U.__wbindgen_realloc),o=ot;X()[e/4+1]=o,X()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Oe(e,t))}finally{U.__wbindgen_free(n,i)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(J(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(J(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(J(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(J(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(J(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=J(e)[t>>>0];return _e(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=J(e).next;return _e(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return In(function(e){const t=J(e).next();return _e(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return J(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=J(e).value;return _e(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return _e(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return In(function(e,t){const n=Reflect.get(J(e),J(t));return _e(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return In(function(e,t){const n=J(e).call(J(t));return _e(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(J(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(J(e));return _e(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=J(e).buffer;return _e(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(J(e));return _e(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=J(t),i=typeof n=="bigint"?n:void 0;qo()[e/8+1]=Ot(i)?BigInt(0):i,X()[e/4+0]=!Ot(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Hn(J(t)),i=Pn(n,U.__wbindgen_malloc,U.__wbindgen_realloc),o=ot;X()[e/4+1]=o,X()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Oe(e,t))},r.wbg.__wbindgen_memory=function(){const e=U.memory;return _e(e)},r}function Jo(r,e){return U=r.exports,Ri.__wbindgen_wasm_module=e,xt=null,It=null,Pt=null,Ft=null,U}async function Ri(r){if(U!==void 0)return U;typeof r>"u"&&(r="/atip/layer_lanes/assets/route_info_bg.wasm");const e=zo();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Ho(await r,e);return Jo(t,n)}class Yo{constructor(){le(this,"inner");this.inner=null}async loadFile(e){await Ri(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new zn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.speedLimitForRoute(e)}allSpeedLimits(){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.allSpeedLimits()}renderAllLaneDetails(){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");console.log("do 1");let e=this.inner.renderLanePolygons();console.log("do 2");let t=this.inner.renderLaneMarkings();return[e,t,"",""]}renderLaneDetailsForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return JSON.parse(this.inner.renderLaneDetailsForRoute(e))}}ar(Yo);function Xo(r){let e,t,n,i,o,s,a,l,u,f,h,p,c;return{c(){e=E("p"),e.textContent="For each intervention:",t=R(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=R(),o=E("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=R(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=R(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,f=R(),h=E("p"),h.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,p=R(),c=E("p"),c.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(m,g){w(m,e,g),w(m,t,g),w(m,n,g),w(m,i,g),w(m,o,g),w(m,s,g),w(m,a,g),w(m,l,g),w(m,u,g),w(m,f,g),w(m,h,g),w(m,p,g),w(m,c,g)},p:H,d(m){m&&k(e),m&&k(t),m&&k(n),m&&k(i),m&&k(o),m&&k(s),m&&k(a),m&&k(l),m&&k(u),m&&k(f),m&&k(h),m&&k(p),m&&k(c)}}}function Wo(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Xo]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new so({props:o}),ue.push(()=>Ee(e,"open",i,r[0])),{c(){x(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Me(()=>t=!1)),e.$set(l)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function Vo(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Ko extends W{constructor(e){super(),V(this,e,Vo,Wo,Y,{open:0})}}function Er(r){let e;const t=r[4].default,n=gt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&bt(n,t,i,i[3],e?vt(t,i[3],o,null):yt(i[3]),null)},i(i){e||(M(n,i),e=!0)},o(i){L(n,i),e=!1},d(i){n&&n.d(i)}}}function Zo(r){let e,t,n=r[1]&&Er(r);return{c(){e=E("div"),n&&n.c(),C(e,"class","map svelte-12dpf1u")},m(i,o){w(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&M(n,1)):(n=Er(i),n.c(),M(n,1),n.m(e,null)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||(M(n),t=!0)},o(i){L(n),t=!1},d(i){i&&k(e),n&&n.d(),r[5](null)}}}function Qo(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;lo("setCamera",!window.location.hash),Lt(()=>{s=new nn.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new nn.ScaleControl({})),s.addControl(new nn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ce.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),nt(()=>{s.remove()});function u(f){ue[f?"unshift":"push"](()=>{a=f,t(0,a)})}return r.$$set=f=>{"style"in f&&t(2,o=f.style),"$$scope"in f&&t(3,i=f.$$scope)},[a,l,o,i,n,u]}class es extends W{constructor(e){super(),V(this,e,Qo,Zo,Y,{style:2})}}const ts=r=>({}),Mr=r=>({}),ns=r=>({}),$r=r=>({}),rs=r=>({}),Lr=r=>({});function is(r){let e,t,n,i,o,s,a,l,u,f,h,p;const c=r[3].nav,m=gt(c,r,r[2],Lr),g=r[3].sidebar,_=gt(g,r,r[2],$r),y=r[3].main,d=gt(y,r,r[2],Mr);return{c(){e=E("aside"),t=E("div"),n=E("nav"),m&&m.c(),i=R(),_&&_.c(),o=R(),s=E("button"),s.textContent="→",l=R(),u=E("main"),d&&d.c(),C(n,"class","svelte-1u7vg8a"),C(t,"class","sidebar-content content-container svelte-1u7vg8a"),C(s,"type","button"),C(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),C(e,"class",a=yr(r[0]?"":"collapsed")+" svelte-1u7vg8a"),C(u,"class","svelte-1u7vg8a")},m(b,v){w(b,e,v),S(e,t),S(t,n),m&&m.m(n,null),S(t,i),_&&_.m(t,null),S(e,o),S(e,s),w(b,l,v),w(b,u,v),d&&d.m(u,null),f=!0,h||(p=G(s,"click",r[1]),h=!0)},p(b,[v]){m&&m.p&&(!f||v&4)&&bt(m,c,b,b[2],f?vt(c,b[2],v,rs):yt(b[2]),Lr),_&&_.p&&(!f||v&4)&&bt(_,g,b,b[2],f?vt(g,b[2],v,ns):yt(b[2]),$r),(!f||v&1&&a!==(a=yr(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&C(e,"class",a),d&&d.p&&(!f||v&4)&&bt(d,y,b,b[2],f?vt(y,b[2],v,ts):yt(b[2]),Mr)},i(b){f||(M(m,b),M(_,b),M(d,b),f=!0)},o(b){L(m,b),L(_,b),L(d,b),f=!1},d(b){b&&k(e),m&&m.d(b),_&&_.d(b),b&&k(l),b&&k(u),d&&d.d(b),h=!1,p()}}}function os(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class ss extends W{constructor(e){super(),V(this,e,os,is,Y,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function ls(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(f){return l([u,f])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(f){u=[6,f],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var tt=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function as(r,e){return r>e?1:r<e?-1:0}function Xe(r,e,t){for(var n=new tt(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function xn(r,e,t,n){var i=new tt(r,e);if(t===null)return i.left=i.right=null,i;t=Xe(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Cr(r,e,t){var n=null,i=null;if(e){e=Xe(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function us(r,e,t){return e===null?r:(r===null||(e=Xe(r.key,e,t),e.left=r),e)}function Jn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Jn(r.left,o,!1,n,i),r.right&&Jn(r.right,o,!0,n,i)}}var ur=function(){function r(e){e===void 0&&(e=as),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=xn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new tt(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Xe(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Xe(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Xe(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Xe(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Xe(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return cs(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Wn(e,t,0,i-1,o),this._root===null)this._root=Yn(e,t,0,i),this._size=i;else{var s=ps(this.toList(),fs(e,t),o);i=this._size+i,this._root=Xn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Jn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Cr(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=xn(t,n,a,i):s=xn(t,n,s,i),this._root=us(s,a,i)},r.prototype.split=function(e){return Cr(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return ls(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Yn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new tt(s,a);return l.left=Yn(r,e,t,o),l.right=Yn(r,e,o+1,n),l}return null}function fs(r,e){for(var t=new tt(null,null),n=t,i=0;i<r.length;i++)n=n.next=new tt(r[i],e[i]);return n.next=null,t.next}function cs(r){for(var e=r,t=[],n=!1,i=new tt(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Xn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Xn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Xn(r,i+1,t),s}return null}function ps(r,e,t){for(var n=new tt(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Wn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Wn(r,e,t,a,i),Wn(r,e,a+1,n,i)}}function Fe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Or(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function $e(r,e,t){return e&&Or(r.prototype,e),t&&Or(r,t),r}var Rt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Vn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Ve=Number.EPSILON;Ve===void 0&&(Ve=Math.pow(2,-52));var ds=Ve*Ve,Kn=function(e,t){if(-Ve<e&&e<Ve&&-Ve<t&&t<Ve)return 0;var n=e-t;return n*n<ds*e*t?0:e<t?-1:1},hs=function(){function r(){Fe(this,r),this.reset()}return $e(r,[{key:"reset",value:function(){this.xRounder=new Rr,this.yRounder=new Rr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Rr=function(){function r(){Fe(this,r),this.tree=new ur,this.round(0)}return $e(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Kn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Kn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Jt=new hs,jt=function(e,t){return e.x*t.y-e.y*t.x},Ai=function(e,t){return e.x*t.x+e.y*t.y},Ar=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=jt(i,o);return Kn(s,0)},yn=function(e){return Math.sqrt(Ai(e,e))},_s=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return jt(o,i)/yn(o)/yn(i)},ms=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Ai(o,i)/yn(o)/yn(i)},Tr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Fr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},gs=function(e,t,n,i){if(t.x===0)return Fr(n,i,e.x);if(i.x===0)return Fr(e,t,n.x);if(t.y===0)return Tr(n,i,e.y);if(i.y===0)return Tr(e,t,n.y);var o=jt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=jt(s,t)/o,l=jt(s,i)/o,u=e.x+l*t.x,f=n.x+a*i.x,h=e.y+l*t.y,p=n.y+a*i.y,c=(u+f)/2,m=(h+p)/2;return{x:c,y:m}},Ue=function(){$e(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:vn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Fe(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return $e(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:_s(n.point,t.point,l.point),cosine:ms(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,f=l.cosine,h=i.get(a),p=h.sine,c=h.cosine;return u>=0&&p>=0?f<c?1:f>c?-1:0:u<0&&p<0?f<c?-1:f>c?1:0:p<u?-1:p>u?1:0}}}]),r}(),bs=0,vn=function(){$e(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,f=t.rightSE.point.y,h=n.rightSE.point.y;if(i<o){if(u<l&&u<f)return 1;if(u>l&&u>f)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var c=n.comparePoint(t.rightSE.point);return c!==0?c:-1}if(i>o){if(l<u&&l<h)return-1;if(l>u&&l>h)return 1;var m=n.comparePoint(t.leftSE.point);if(m!==0)return m;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>a){var y=t.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(s!==a){var d=f-l,b=s-i,v=h-u,$=a-o;if(d>b&&v<$)return 1;if(d<b&&v>$)return-1}return s>a?1:s<a||f<h?-1:f>h?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Fe(this,r),this.id=++bs,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return $e(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Vn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,f=Rt(n,l)&&this.comparePoint(l)===0,h=Rt(i,s)&&t.comparePoint(s)===0,p=Rt(n,u)&&this.comparePoint(u)===0,c=Rt(i,a)&&t.comparePoint(a)===0;if(h&&f)return c&&!p?a:!c&&p?u:null;if(h)return p&&s.x===u.x&&s.y===u.y?null:s;if(f)return c&&a.x===l.x&&a.y===l.y?null:l;if(c&&p)return null;if(c)return a;if(p)return u;var m=gs(s,this.vector(),l,t.vector());return m===null||!Rt(o,m)?null:Jt.round(m.x,m.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Ue(t,!0),s=new Ue(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Ue.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ue.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var f=i.rings[l],h=i.windings[l],p=n.rings.indexOf(f);p===-1?(n.rings.push(f),n.windings.push(h)):n.windings[p]+=h}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],f=n.indexOf(l);f===-1?(n.push(l),i.push(u)):i[f]+=u}for(var h=[],p=[],c=0,m=n.length;c<m;c++)if(i[c]!==0){var g=n[c],_=g.poly;if(p.indexOf(_)===-1)if(g.isExterior)h.push(_);else{p.indexOf(_)===-1&&p.push(_);var y=h.indexOf(g.poly);y!==-1&&h.splice(y,1)}}for(var d=0,b=h.length;d<b;d++){var v=h[d].multiPoly;o.indexOf(v)===-1&&o.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(xe.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===xe.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(h){return h.length===1&&h[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(xe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Ue.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Ue(o,!0),f=new Ue(s,!1);return new r(u,f,[i],[a])}}]),r}(),Pr=function(){function r(e,t,n){if(Fe(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Jt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Jt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(vn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(vn.fromRing(o,i,this))}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),ys=function(){function r(e,t){if(Fe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Pr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Pr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Ir=function(){function r(e,t){if(Fe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new ys(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),vs=function(){$e(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,f=[l],h=l.point,p=[];a=l,l=u,f.push(l),l.point!==h;)for(;;){var c=l.getAvailableLinkedEvents();if(c.length===0){var m=f[0].point,g=f[f.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(m.x,",")+" ".concat(m.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(c.length===1){u=c[0].otherSE;break}for(var _=null,y=0,d=p.length;y<d;y++)if(p[y].point===l.point){_=y;break}if(_!==null){var b=p.splice(_)[0],v=f.splice(b.index);v.unshift(v[0].otherSE),n.push(new r(v.reverse()));continue}p.push({index:f.length,point:l.point});var $=l.getLeftmostComparator(a);u=c.sort($)[0].otherSE;break}n.push(new r(f))}}return n}}]);function r(e){Fe(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return $e(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Ar(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Ar(l,t,u)===0&&n.shift(),n.push(n[0]);for(var f=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,c=[],m=h;m!=p;m+=f)c.push([n[m].x,n[m].y]);return c}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Ue.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),xr=function(){function r(e){Fe(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return $e(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),ws=function(){function r(e){Fe(this,r),this.rings=e,this.polys=this._composePolys(e)}return $e(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new xr(s));else{var a=s.enclosingRing();a.poly||n.push(new xr(a)),a.poly.addInterior(s)}}return n}}]),r}(),ks=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vn.compare;Fe(this,r),this.queue=e,this.tree=new ur(t),this.segments=[]}return $e(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var f=null;if(l){var h=l.getIntersection(n);if(h!==null&&(n.isAnEndpoint(h)||(f=h),!l.isAnEndpoint(h)))for(var p=this._splitSafely(l,h),c=0,m=p.length;c<m;c++)i.push(p[c])}var g=null;if(u){var _=u.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(g=_),!u.isAnEndpoint(_)))for(var y=this._splitSafely(u,_),d=0,b=y.length;d<b;d++)i.push(y[d])}if(f!==null||g!==null){var v=null;if(f===null)v=g;else if(g===null)v=f;else{var $=Ue.comparePoints(f,g);v=$<=0?f:g}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var O=n.split(v),F=0,A=O.length;F<A;F++)i.push(O[F])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var j=l.getIntersection(u);if(j!==null){if(!l.isAnEndpoint(j))for(var T=this._splitSafely(l,j),D=0,ee=T.length;D<ee;D++)i.push(T[D]);if(!u.isAnEndpoint(j))for(var I=this._splitSafely(u,j),z=0,ae=I.length;z<ae;z++)i.push(I[z])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Nr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ss=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Es=function(){function r(){Fe(this,r)}return $e(r,[{key:"run",value:function(t,n,i){xe.type=t,Jt.reset();for(var o=[new Ir(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Ir(i[s],!1));if(xe.numMultiPolys=o.length,xe.type==="difference")for(var l=o[0],u=1;u<o.length;)Vn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(xe.type==="intersection"){for(var f=0,h=o.length;f<h;f++)for(var p=o[f],c=f+1,m=o.length;c<m;c++)if(Vn(p.bbox,o[c].bbox)===null)return[]}for(var g=new ur(Ue.compare),_=0,y=o.length;_<y;_++)for(var d=o[_].getSweepEvents(),b=0,v=d.length;b<v;b++)if(g.insert(d[b]),g.size>Nr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var $=new ks(g),O=g.size,F=g.pop();F;){var A=F.key;if(g.size===O){var j=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(j.id," ")+"[".concat(j.leftSE.point.x,", ").concat(j.leftSE.point.y,"] -> ")+"[".concat(j.rightSE.point.x,", ").concat(j.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Nr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if($.segments.length>Ss)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var T=$.process(A),D=0,ee=T.length;D<ee;D++){var I=T[D];I.consumedBy===void 0&&g.insert(I)}O=g.size,F=g.pop()}Jt.reset();var z=vs.factory($.segments),ae=new ws(z);return ae.getGeom()}}]),r}(),xe=new Es,Ms=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe.run("union",e,n)},$s=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe.run("intersection",e,n)},Ls=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe.run("xor",e,n)},Cs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe.run("difference",e,n)},sn={union:Ms,intersection:$s,xor:Ls,difference:Cs};function Os(r,e){var t=As(e),n=null;return r.type==="FeatureCollection"?n=Rs(r):n=Ti(sn.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function Rs(r){var e=r.features.length===2?sn.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):sn.union.apply(sn,r.features.map(function(t){return t.geometry.coordinates}));return Ti(e)}function Ti(r){return ao(r)}function As(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return uo(t)}function Ts(r,e,t){let n;ne(r,Ce,s=>t(1,n=s));let{boundaryGeojson:i}=e;return fo("setCamera")&&n.fitBounds(or(i),{padding:20,animate:!1}),Ye(n,"boundary",Os(i)),we(n,{id:"boundary",source:"boundary",...Mn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class Fs extends W{constructor(e){super(),V(this,e,Ts,null,Y,{boundaryGeojson:0})}}const me={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Rn=10,Yt=10;function Ps(r,e,t){let n;ne(r,Ce,u=>t(2,n=u));let{layer:i}=e,{contents:o}=e,s=new nn.Popup({closeButton:!1,closeOnClick:!1});n.on("mousemove",a),n.on("mouseout",l),nt(()=>{n.off("mousemove",a),n.off("mouseout",l),s.remove()});function a(u){if(!n.getLayer(i)){s.remove();return}let f=n.queryRenderedFeatures(u.point,{layers:[i]});f.length>0?s.setLngLat(u.lngLat).setHTML(o(f[0].properties)).addTo(n):s.remove()}function l(){s.remove()}return r.$$set=u=>{"layer"in u&&t(0,i=u.layer),"contents"in u&&t(1,o=u.contents)},[i,o]}class Is extends W{constructor(e){super(),V(this,e,Ps,null,Y,{layer:0,contents:1})}}function Br(r,e,t){const n=r.slice();return n[3]=e[t],n}function jr(r,e,t){const n=r.slice();return n[6]=e[t],n}function Dr(r){let e;return{c(){e=E("td"),C(e,"class","svelte-11t6rxo"),pe(e,"background-color",r[6])},m(t,n){w(t,e,n)},p(t,n){n&1&&pe(e,"background-color",t[6])},d(t){t&&k(e)}}}function Ur(r){let e,t=r[3]+"",n;return{c(){e=E("td"),n=Q(t),C(e,"class","svelte-11t6rxo"),pe(e,"width",r[2])},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[3]+"")&&Ae(n,t)},d(i){i&&k(e)}}}function xs(r){let e,t,n,i,o=r[0],s=[];for(let u=0;u<o.length;u+=1)s[u]=Dr(jr(r,o,u));let a=r[1],l=[];for(let u=0;u<a.length;u+=1)l[u]=Ur(Br(r,a,u));return{c(){e=E("table"),t=E("tr");for(let u=0;u<s.length;u+=1)s[u].c();n=R(),i=E("tr");for(let u=0;u<l.length;u+=1)l[u].c();C(t,"class","svelte-11t6rxo"),C(i,"class","svelte-11t6rxo"),C(e,"class","svelte-11t6rxo")},m(u,f){w(u,e,f),S(e,t);for(let h=0;h<s.length;h+=1)s[h].m(t,null);S(e,n),S(e,i);for(let h=0;h<l.length;h+=1)l[h].m(i,null)},p(u,[f]){if(f&1){o=u[0];let h;for(h=0;h<o.length;h+=1){const p=jr(u,o,h);s[h]?s[h].p(p,f):(s[h]=Dr(p),s[h].c(),s[h].m(t,null))}for(;h<s.length;h+=1)s[h].d(1);s.length=o.length}if(f&6){a=u[1];let h;for(h=0;h<a.length;h+=1){const p=Br(u,a,h);l[h]?l[h].p(p,f):(l[h]=Ur(p),l[h].c(),l[h].m(i,null))}for(;h<l.length;h+=1)l[h].d(1);l.length=a.length}},i:H,o:H,d(u){u&&k(e),pn(s,u),pn(l,u)}}}function Ns(r,e,t){let{colors:n}=e,{labels:i}=e;if(n.length!=i.length)throw new Error("colors and labels must match");let o=`${100/n.length}%`;return r.$$set=s=>{"colors"in s&&t(0,n=s.colors),"labels"in s&&t(1,i=s.labels)},[n,i,o]}class Bs extends W{constructor(e){super(),V(this,e,Ns,xs,Y,{colors:0,labels:1})}}const js="/atip/layer_lanes/assets/help-d011708a.svg";function Ds(r){let e,t;return{c(){e=E("img"),dn(e.src,t=js)||C(e,"src",t),C(e,"title",r[0]),C(e,"alt",r[0])},m(n,i){w(n,e,i)},p(n,[i]){i&1&&C(e,"title",n[0]),i&1&&C(e,"alt",n[0])},i:H,o:H,d(n){n&&k(e)}}}function Us(r,e,t){let{contents:n}=e;return r.$$set=i=>{"contents"in i&&t(0,n=i.contents)},[n]}class qs extends W{constructor(e){super(),V(this,e,Us,Ds,Y,{contents:0})}}function Gs(r){let e,t,n,i,o,s,a;return t=new qs({props:{contents:"Data comes from OpenStreetMap, and may not always be correct. Unexpected values are treated as unknown. Freehand route segments and off-road paths generally have no speed data."}}),i=new Bs({props:{colors:r[0],labels:["< 20","20","30","40",">= 50"]}}),s=new Is({props:{layer:"speed-limits",contents:zs}}),{c(){e=Q(`(mph)
`),x(t.$$.fragment),n=R(),x(i.$$.fragment),o=R(),x(s.$$.fragment)},m(l,u){w(l,e,u),N(t,l,u),w(l,n,u),N(i,l,u),w(l,o,u),N(s,l,u),a=!0},p:H,i(l){a||(M(t.$$.fragment,l),M(i.$$.fragment,l),M(s.$$.fragment,l),a=!0)},o(l){L(t.$$.fragment,l),L(i.$$.fragment,l),L(s.$$.fragment,l),a=!1},d(l){l&&k(e),B(t,l),l&&k(n),B(i,l),l&&k(o),B(s,l)}}}let Hs="white",ut="speed-limits",Nn="speed-limits",At=.8;function zs(r){return r.speed_limit?`${Math.round(r.speed_limit)} mph`:"Unknown"}function Js(r,e,t){let n,i,o;ne(r,Ce,f=>t(2,n=f)),ne(r,Gt,f=>t(3,i=f)),ne(r,ie,f=>t(4,o=f));let{id:s}=e,a=["#00AB4D","#8ECA4D","#F7BB00","#BB0000","#470000"];const l=["case",["<",["get","speed_limit"],20],a[0],["==",["get","speed_limit"],20],a[1],["==",["get","speed_limit"],30],a[2],["==",["get","speed_limit"],40],a[3],[">=",["get","speed_limit"],50],a[4],Hs],u=["case",["<",["get","speed_limit"],20],At,["==",["get","speed_limit"],20],At,["==",["get","speed_limit"],30],At,["==",["get","speed_limit"],40],At,[">=",["get","speed_limit"],50],At,0];return Ye(n,ut,Ne()),we(n,{id:Nn,source:ut,...kt(l,Yt,u)}),Lt(async()=>{try{if(s){let f=o.features.find(p=>p.id==s),h=JSON.parse(await i.speedLimitForRoute(f.properties.waypoints));n.getSource(ut).setData(h)}else{let f=JSON.parse(await i.allSpeedLimits());n.getSource(ut).setData(f)}}catch(f){window.alert(`Couldn't calculate speed limits for route: ${f}`)}}),nt(()=>{n.getLayer(Nn)&&n.removeLayer(Nn),n.getSource(ut)&&n.removeSource(ut)}),r.$$set=f=>{"id"in f&&t(1,s=f.id)},[a,s]}class Fi extends W{constructor(e){super(),V(this,e,Js,Gs,Y,{id:1})}}function Ys(r,e,t){let n;ne(r,Ce,l=>t(3,n=l));let{source:i}=e,{gj:o}=e,{style:s}=e,a=`${i}-layer`;return Ye(n,i,o),we(n,{id:a,source:i,...s}),nt(()=>{n.getLayer(a)&&n.removeLayer(a),n.getSource(i)&&n.removeSource(i)}),r.$$set=l=>{"source"in l&&t(0,i=l.source),"gj"in l&&t(1,o=l.gj),"style"in l&&t(2,s=l.style)},[i,o,s]}class Pi extends W{constructor(e){super(),V(this,e,Ys,null,Y,{source:0,gj:1,style:2})}}function Xs(r){let e,t;return e=new Pi({props:{source:"lane-polygons",gj:r[0],style:r[1]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.gj=n[0]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Ws(r,e,t){let{gj:n}=e,i={type:"fill",paint:{"fill-color":vi("type",{Driving:"black",Parking:"#333333",Sidewalk:"#CCCCCC",Shoulder:"#CCCCCC",Biking:"#0F7D4B",Bus:"#BE4A4C",SharedLeftTurn:"black",Construction:"#FF6D00",LightRail:"#844204",Footway:"#DDDDE8",SharedUse:"#E5E1BB","Buffer(Planters)":"#555555"},"red"),"fill-opacity":.9}};return r.$$set=o=>{"gj"in o&&t(0,n=o.gj)},[n,i]}class Vs extends W{constructor(e){super(),V(this,e,Ws,Xs,Y,{gj:0})}}function Ks(r){let e,t;return e=new Pi({props:{source:"lane-markings",gj:r[0],style:r[1]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.gj=n[0]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Zs(r,e,t){let{gj:n}=e,i={type:"fill",paint:{"fill-color":vi("type",{"center line":"yellow","lane separator":"white","lane arrow":"white","buffer edge":"white","buffer stripe":"white","vehicle stop line":"white","bike stop line":"green"},"red"),"fill-opacity":.9}};return r.$$set=o=>{"gj"in o&&t(0,n=o.gj)},[n,i]}class Qs extends W{constructor(e){super(),V(this,e,Zs,Ks,Y,{gj:0})}}function qr(r){let e,t,n,i;return e=new Vs({props:{gj:r[0]}}),n=new Qs({props:{gj:r[1]}}),{c(){x(e.$$.fragment),t=R(),x(n.$$.fragment)},m(o,s){N(e,o,s),w(o,t,s),N(n,o,s),i=!0},p(o,s){const a={};s&1&&(a.gj=o[0]),e.$set(a);const l={};s&2&&(l.gj=o[1]),n.$set(l)},i(o){i||(M(e.$$.fragment,o),M(n.$$.fragment,o),i=!0)},o(o){L(e.$$.fragment,o),L(n.$$.fragment,o),i=!1},d(o){B(e,o),o&&k(t),B(n,o)}}}function el(r){let e,t,n=r[0]&&qr(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&M(n,1)):(n=qr(i),n.c(),M(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||(M(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}function tl(r,e,t){let n,i;ne(r,Gt,l=>t(3,n=l)),ne(r,ie,l=>t(4,i=l));let{id:o}=e,s,a;return Lt(async()=>{try{let l;if(o){let u=i.features.find(f=>f.id==o);l=await n.renderLaneDetailsForRoute(u.properties.waypoints)}else l=await n.renderAllLaneDetails();t(0,s=JSON.parse(l[0])),t(1,a=JSON.parse(l[1]))}catch(l){window.alert(`Couldn't render lane details: ${l}`)}}),r.$$set=l=>{"id"in l&&t(2,o=l.id)},[s,a,o]}class Ii extends W{constructor(e){super(),V(this,e,tl,el,Y,{id:2})}}function nl(r){let e,t;return e=new Ii({props:{id:r[0]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.id=n[0]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function rl(r){let e,t;return e=new Fi({props:{id:r[0]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.id=n[0]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function il(r){let e,t,n,i,o,s,a,l,u,f,h,p,c;const m=[rl,nl],g=[];function _(y,d){return y[1]=="speed limits"?0:y[1]=="lane details"?1:-1}return~(l=_(r))&&(u=g[l]=m[l](r)),{c(){e=E("label"),t=Q(`Show details:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",s=E("option"),s.textContent="Lane details",a=R(),u&&u.c(),f=ge(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,s.__value="lane details",s.value=s.__value,r[1]===void 0&&st(()=>r[2].call(n))},m(y,d){w(y,e,d),S(e,t),S(e,n),S(n,i),S(n,o),S(n,s),et(n,r[1]),w(y,a,d),~l&&g[l].m(y,d),w(y,f,d),h=!0,p||(c=G(n,"change",r[2]),p=!0)},p(y,[d]){d&2&&et(n,y[1]);let b=l;l=_(y),l===b?~l&&g[l].p(y,d):(u&&(fe(),L(g[b],1,1,()=>{g[b]=null}),ce()),~l?(u=g[l],u?u.p(y,d):(u=g[l]=m[l](y),u.c()),M(u,1),u.m(f.parentNode,f)):u=null)},i(y){h||(M(u),h=!0)},o(y){L(u),h=!1},d(y){y&&k(e),y&&k(a),~l&&g[l].d(y),y&&k(f),p=!1,c()}}}function ol(r,e,t){let{id:n}=e,i="none";function o(){i=$n(this),t(1,i)}return r.$$set=s=>{"id"in s&&t(0,n=s.id)},[n,i,o]}class sl extends W{constructor(e){super(),V(this,e,ol,il,Y,{id:0})}}function Gr(r){let e,t=Hr(r[4])+"",n,i,o,s,a,l,u,f,h,p;return u=new sl({props:{id:r[3]}}),{c(){e=Q("Length: "),n=Q(t),i=R(),o=E("br"),s=E("button"),s.textContent="Auto-fill details",a=E("br"),l=R(),x(u.$$.fragment),C(s,"type","button")},m(c,m){w(c,e,m),w(c,n,m),w(c,i,m),w(c,o,m),w(c,s,m),w(c,a,m),w(c,l,m),N(u,c,m),f=!0,h||(p=G(s,"click",r[13]),h=!0)},p(c,m){(!f||m&16)&&t!==(t=Hr(c[4])+"")&&Ae(n,t);const g={};m&8&&(g.id=c[3]),u.$set(g)},i(c){f||(M(u.$$.fragment,c),f=!0)},o(c){L(u.$$.fragment,c),f=!1},d(c){c&&k(e),c&&k(n),c&&k(i),c&&k(o),c&&k(s),c&&k(a),c&&k(l),B(u,c),h=!1,p()}}}function ll(r){let e,t,n,i,o,s,a,l,u,f,h,p,c,m,g,_,y,d,b,v,$,O,F,A,j,T,D,ee,I,z,ae,Se,Pe,se,oe,Be,Le,te,he,Kt,be=r[4]&&Gr(r);return{c(){e=E("label"),t=Q("Name:"),n=E("br"),i=R(),o=E("input"),s=R(),a=E("br"),l=R(),u=E("br"),f=R(),h=E("label"),p=E("input"),c=Q(`
  Area`),m=R(),g=E("label"),_=E("input"),y=Q(`
  Route`),d=R(),b=E("label"),v=E("input"),$=Q(`
  Crossing`),O=R(),F=E("label"),A=E("input"),j=Q(`
  Other`),T=R(),D=E("br"),ee=R(),I=E("br"),z=R(),ae=E("label"),Se=Q("Description:"),Pe=E("br"),se=R(),oe=E("textarea"),Be=R(),be&&be.c(),Le=ge(),C(o,"type","text"),pe(o,"width","100%"),C(p,"type","radio"),p.__value="area",p.value=p.__value,r[8][0].push(p),C(_,"type","radio"),_.__value="route",_.value=_.__value,r[8][0].push(_),C(v,"type","radio"),v.__value="crossing",v.value=v.__value,r[8][0].push(v),C(A,"type","radio"),A.__value="other",A.value=A.__value,r[8][0].push(A),pe(oe,"width","100%"),C(oe,"rows","5"),C(oe,"class","svelte-15lna0i")},m(P,re){w(P,e,re),S(e,t),S(e,n),S(e,i),S(e,o),Re(o,r[0]),w(P,s,re),w(P,a,re),w(P,l,re),w(P,u,re),w(P,f,re),w(P,h,re),S(h,p),p.checked=p.__value===r[1],S(h,c),w(P,m,re),w(P,g,re),S(g,_),_.checked=_.__value===r[1],S(g,y),w(P,d,re),w(P,b,re),S(b,v),v.checked=v.__value===r[1],S(b,$),w(P,O,re),w(P,F,re),S(F,A),A.checked=A.__value===r[1],S(F,j),w(P,T,re),w(P,D,re),w(P,ee,re),w(P,I,re),w(P,z,re),w(P,ae,re),S(ae,Se),S(ae,Pe),S(ae,se),S(ae,oe),Re(oe,r[2]),w(P,Be,re),be&&be.m(P,re),w(P,Le,re),te=!0,he||(Kt=[G(o,"input",r[6]),G(p,"change",r[7]),G(_,"change",r[9]),G(v,"change",r[10]),G(A,"change",r[11]),G(oe,"input",r[12])],he=!0)},p(P,[re]){re&1&&o.value!==P[0]&&Re(o,P[0]),re&2&&(p.checked=p.__value===P[1]),re&2&&(_.checked=_.__value===P[1]),re&2&&(v.checked=v.__value===P[1]),re&2&&(A.checked=A.__value===P[1]),re&4&&Re(oe,P[2]),P[4]?be?(be.p(P,re),re&16&&M(be,1)):(be=Gr(P),be.c(),M(be,1),be.m(Le.parentNode,Le)):be&&(fe(),L(be,1,1,()=>{be=null}),ce())},i(P){te||(M(be),te=!0)},o(P){L(be),te=!1},d(P){P&&k(e),P&&k(s),P&&k(a),P&&k(l),P&&k(u),P&&k(f),P&&k(h),r[8][0].splice(r[8][0].indexOf(p),1),P&&k(m),P&&k(g),r[8][0].splice(r[8][0].indexOf(_),1),P&&k(d),P&&k(b),r[8][0].splice(r[8][0].indexOf(v),1),P&&k(O),P&&k(F),r[8][0].splice(r[8][0].indexOf(A),1),P&&k(T),P&&k(D),P&&k(ee),P&&k(I),P&&k(z),P&&k(ae),P&&k(Be),be&&be.d(P),P&&k(Le),he=!1,Te(Kt)}}}function Hr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function al(r,e,t){let n,i;ne(r,Gt,b=>t(14,n=b)),ne(r,ie,b=>t(15,i=b));let{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function f(){let b=i.features.find(v=>v.id==o);try{t(0,s=await n.nameForRoute(b))}catch(v){window.alert(`Couldn't auto-name route: ${v}`)}}const h=[[]];function p(){s=this.value,t(0,s)}function c(){a=this.__value,t(1,a)}function m(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function _(){a=this.__value,t(1,a)}function y(){l=this.value,t(2,l)}const d=()=>f();return r.$$set=b=>{"id"in b&&t(3,o=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(4,u=b.length_meters)},[s,a,l,o,u,f,p,c,h,m,g,_,y,d]}class ul extends W{constructor(e){super(),V(this,e,al,ll,Y,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}const fl="Intervention",cl=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],pl={name:fl,oneOf:cl};function dl(r){const e=r-1;return e*e*e+1}function Mt(r,{delay:e=0,duration:t=400,easing:n=dl}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),f=parseFloat(i.marginBottom),h=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:c=>`overflow: hidden;opacity: ${Math.min(c*20,1)*o};height: ${c*s}px;padding-top: ${c*a}px;padding-bottom: ${c*l}px;margin-top: ${c*u}px;margin-bottom: ${c*f}px;border-top-width: ${c*h}px;border-bottom-width: ${c*p}px;`}}function xi(r){return"members"in r}function Ni(r){return"oneOf"in r}function Bi(r){return typeof r=="string"}function ji(r){return typeof r=="object"&&"value"in r}function hl(r){return"type"in r&&r.type=="number"}function Di(r){return"type"in r&&r.type=="one-liner"}function Ui(r){return"type"in r&&r.type=="textbox"}function qi(r){return"type"in r&&r.type=="checkbox"}function zr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Jr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Yr(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=Q(t),C(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&Ae(n,t)},d(i){i&&k(e)}}}function _l(r){let e,t,n;return{c(){e=E("input"),C(e,"type","checkbox")},m(i,o){w(i,e,o),e.checked=r[0],t||(n=G(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:H,o:H,d(i){i&&k(e),t=!1,n()}}}function ml(r){let e,t,n;return{c(){e=E("textarea"),pe(e,"width","100%"),C(e,"rows","5"),C(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),Re(e,r[0]),t||(n=G(e,"input",r[13]),t=!0)},p(i,o){o&1&&Re(e,i[0])},i:H,o:H,d(i){i&&k(e),t=!1,n()}}}function gl(r){let e,t,n;return{c(){e=E("input"),C(e,"type","text"),pe(e,"width","100%")},m(i,o){w(i,e,o),Re(e,r[0]),t||(n=G(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Re(e,i[0])},i:H,o:H,d(i){i&&k(e),t=!1,n()}}}function bl(r){let e,t,n;return{c(){e=E("input"),C(e,"type","number")},m(i,o){w(i,e,o),Re(e,r[0]),t||(n=G(e,"input",r[11]),t=!0)},p(i,o){o&1&&wi(e.value)!==i[0]&&Re(e,i[0])},i:H,o:H,d(i){i&&k(e),t=!1,n()}}}function yl(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=Wr(zr(r,n,s));const o=s=>L(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=zr(s,n,l);i[l]?(i[l].p(u,a),M(i[l],1)):(i[l]=Wr(u),i[l].c(),M(i[l],1),i[l].m(e.parentNode,e))}for(fe(),l=n.length;l<i.length;l+=1)o(l);ce()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)M(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)L(i[a]);t=!1},d(s){pn(i,s),s&&k(e)}}}function vl(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=Vr(Jr(r,n,s));const o=s=>L(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Jr(s,n,l);i[l]?(i[l].p(u,a),M(i[l],1)):(i[l]=Vr(u),i[l].c(),M(i[l],1),i[l].m(e.parentNode,e))}for(fe(),l=n.length;l<i.length;l+=1)o(l);ce()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)M(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)L(i[a]);t=!1},d(s){pn(i,s),s&&k(e)}}}function wl(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,f,h,p,c=r[2]==r[15].name&&typeof r[0]=="object"&&Xr(r);return{c(){e=E("label"),t=E("input"),i=R(),s=Q(o),a=E("br"),l=R(),c&&c.c(),u=ge(),C(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(m,g){w(m,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),w(m,l,g),c&&c.m(m,g),w(m,u,g),f=!0,h||(p=[G(t,"change",r[9]),G(t,"change",r[4])],h=!0)},p(m,g){(!f||g&2&&n!==(n=m[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===m[2]),(!f||g&2)&&o!==(o=m[15].name+"")&&Ae(s,o),m[2]==m[15].name&&typeof m[0]=="object"?c?(c.p(m,g),g&7&&M(c,1)):(c=Xr(m),c.c(),M(c,1),c.m(u.parentNode,u)):c&&(fe(),L(c,1,1,()=>{c=null}),ce())},i(m){f||(M(c),f=!0)},o(m){L(c),f=!1},d(m){m&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),m&&k(l),c&&c.d(m),m&&k(u),h=!1,Te(p)}}}function kl(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,f;function h(m,g){return m[15].description?Ml:El}let p=h(r),c=p(r);return{c(){e=E("label"),t=E("input"),i=R(),s=Q(o),a=R(),c.c(),l=R(),C(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(m,g){w(m,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),c.m(e,null),S(e,l),u||(f=[G(t,"change",r[8]),G(t,"change",r[3])],u=!0)},p(m,g){g&2&&n!==(n=m[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===m[2]),g&2&&o!==(o=m[15].value+"")&&Ae(s,o),p===(p=h(m))&&c?c.p(m,g):(c.d(1),c=p(m),c&&(c.c(),c.m(e,l)))},i:H,o:H,d(m){m&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),c.d(),u=!1,Te(f)}}}function Sl(r){let e,t,n,i,o=r[15]+"",s,a,l,u,f,h;return{c(){e=E("label"),t=E("input"),i=R(),s=Q(o),a=R(),l=E("br"),u=R(),C(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(p,c){w(p,e,c),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),S(e,l),S(e,u),f||(h=[G(t,"change",r[6]),G(t,"change",r[3])],f=!0)},p(p,c){c&2&&n!==(n=p[15])&&(t.__value=n,t.value=t.__value),c&4&&(t.checked=t.__value===p[2]),c&2&&o!==(o=p[15]+"")&&Ae(s,o)},i:H,o:H,d(p){p&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),f=!1,Te(h)}}}function Xr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Vt({props:l}),ue.push(()=>Ee(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),x(t.$$.fragment),i=R(),C(e,"class","svelte-1b72l00")},m(u,f){w(u,e,f),N(t,e,null),S(e,i),s=!0},p(u,f){r=u;const h={};f&2&&(h.spec=r[15]),!n&&f&3&&(n=!0,h.value=r[0][r[15].name],Me(()=>n=!1)),t.$set(h)},i(u){s||(M(t.$$.fragment,u),st(()=>{o||(o=St(e,Mt,{duration:500},!0)),o.run(1)}),s=!0)},o(u){L(t.$$.fragment,u),o||(o=St(e,Mt,{duration:500},!1)),o.run(0),s=!1},d(u){u&&k(e),B(t),u&&o&&o.end()}}}function El(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function Ml(r){let e,t,n=r[15].description+"",i,o;return{c(){e=E("p"),t=Q("("),i=Q(n),o=Q(")"),C(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,i),S(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&Ae(i,n)},d(s){s&&k(e)}}}function Wr(r){let e,t,n,i,o,s;const a=[Sl,kl,wl],l=[];function u(f,h){return h&2&&(e=null),h&2&&(t=null),e==null&&(e=!!Bi(f[15])),e?0:(t==null&&(t=!!ji(f[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=ge()},m(f,h){l[n].m(f,h),w(f,o,h),s=!0},p(f,h){let p=n;n=u(f,h),n===p?l[n].p(f,h):(fe(),L(l[p],1,1,()=>{l[p]=null}),ce(),i=l[n],i?i.p(f,h):(i=l[n]=a[n](f),i.c()),M(i,1),i.m(o.parentNode,o))},i(f){s||(M(i),s=!0)},o(f){L(i),s=!1},d(f){l[n].d(f),f&&k(o)}}}function Vr(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function f(p){r[5](p,r[15])}let h={spec:r[15]};return r[0][r[15].name]!==void 0&&(h.value=r[0][r[15].name]),s=new Vt({props:h}),ue.push(()=>Ee(s,"value",f,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),i=Q(n),o=R(),x(s.$$.fragment),l=R(),C(e,"class","svelte-1b72l00")},m(p,c){w(p,e,c),S(e,t),S(t,i),S(e,o),N(s,e,null),S(e,l),u=!0},p(p,c){r=p,(!u||c&2)&&n!==(n=r[15].name+"")&&Ae(i,n);const m={};c&2&&(m.spec=r[15]),!a&&c&3&&(a=!0,m.value=r[0][r[15].name],Me(()=>a=!1)),s.$set(m)},i(p){u||(M(s.$$.fragment,p),u=!0)},o(p){L(s.$$.fragment,p),u=!1},d(p){p&&k(e),B(s)}}}function $l(r){let e,t,n,i,o,s,a,l,u,f,h,p=r[1].description&&Yr(r);const c=[vl,yl,bl,gl,ml,_l],m=[];function g(_,y){return y&2&&(t=null),y&2&&(n=null),y&2&&(i=null),y&2&&(o=null),y&2&&(s=null),y&2&&(a=null),t==null&&(t=!!xi(_[1])),t?0:(n==null&&(n=!!Ni(_[1])),n?1:(i==null&&(i=!!hl(_[1])),i?2:(o==null&&(o=!!Di(_[1])),o?3:(s==null&&(s=!!Ui(_[1])),s?4:(a==null&&(a=!!qi(_[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=m[l]=c[l](r)),{c(){p&&p.c(),e=R(),u&&u.c(),f=ge()},m(_,y){p&&p.m(_,y),w(_,e,y),~l&&m[l].m(_,y),w(_,f,y),h=!0},p(_,[y]){_[1].description?p?p.p(_,y):(p=Yr(_),p.c(),p.m(e.parentNode,e)):p&&(p.d(1),p=null);let d=l;l=g(_,y),l===d?~l&&m[l].p(_,y):(u&&(fe(),L(m[d],1,1,()=>{m[d]=null}),ce()),~l?(u=m[l],u?u.p(_,y):(u=m[l]=c[l](_),u.c()),M(u,1),u.m(f.parentNode,f)):u=null)},i(_){h||(M(u),h=!0)},o(_){L(u),h=!1},d(_){p&&p.d(_),_&&k(e),~l&&m[l].d(_),_&&k(f)}}}function Ll(r,e,t){var d,b,v;let{spec:n}=e,{value:i}=e,o="";if(xi(n)){i||(i={});for(let $ of n.members)Di($)||Ui($)?i[d=$.name]||(i[d]=""):qi($)?i[b=$.name]||(i[b]=!1):i[v=$.name]||(i[v]={})}else Ni(n)&&(i||(i={}),Bi(i)?o=i:ji(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u($,O){r.$$.not_equal(i[O.name],$)&&(i[O.name]=$,t(0,i))}function f(){o=this.__value,t(2,o)}function h(){o=this.__value,t(2,o)}function p(){o=this.__value,t(2,o)}function c($,O){r.$$.not_equal(i[O.name],$)&&(i[O.name]=$,t(0,i))}function m(){i=wi(this.value),t(0,i)}function g(){i=this.value,t(0,i)}function _(){i=this.value,t(0,i)}function y(){i=this.checked,t(0,i)}return r.$$set=$=>{"spec"in $&&t(1,n=$.spec),"value"in $&&t(0,i=$.value)},[i,n,o,s,a,u,f,l,h,p,c,m,g,_,y]}class Vt extends W{constructor(e){super(),V(this,e,Ll,$l,Y,{spec:1,value:0})}}function Cl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Vt({props:o}),ue.push(()=>Ee(e,"value",i,r[0].v2)),{c(){x(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Me(()=>t=!1)),e.$set(l)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function Ol(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=pl;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Rl extends W{constructor(e){super(),V(this,e,Ol,Cl,Y,{props:0})}}const Al="Planning",Tl=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],Fl={name:Al,members:Tl};function Pl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Vt({props:o}),ue.push(()=>Ee(e,"value",i,r[0].planning)),{c(){x(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Me(()=>t=!1)),e.$set(l)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function Il(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=Fl;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class xl extends W{constructor(e){super(),V(this,e,Il,Pl,Y,{props:0})}}const Nl="CriticalIssue",Bl=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],jl={name:Nl,members:Bl};function Dl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Vt({props:o}),ue.push(()=>Ee(e,"value",i,r[0].criticals)),{c(){x(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Me(()=>t=!1)),e.$set(l)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function Ul(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=jl;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class ql extends W{constructor(e){super(),V(this,e,Ul,Dl,Y,{props:0})}}function Kr(r){let e,t,n,i,o;const s=r[10].default,a=gt(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),pe(e,"border","solid 1px black"),pe(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=G(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&bt(a,s,l,l[9],n?vt(s,l[9],u,null):yt(l[9]),null)},i(l){n||(M(a,l),st(()=>{t||(t=St(e,Mt,{duration:100},!0)),t.run(1)}),n=!0)},o(l){L(a,l),t||(t=St(e,Mt,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Gl(r){let e,t,n,i,o,s,a,l,u,f,h=r[4]&&Kr(r);return{c(){e=E("button"),t=hn("svg"),n=hn("path"),i=R(),o=Q(r[1]),s=R(),h&&h.c(),a=ge(),C(n,"d","M9 5l7 7-7 7"),C(t,"style","tran"),C(t,"width","20"),C(t,"height","20"),C(t,"fill","none"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"stroke-width","2"),C(t,"viewBox","0 0 24 24"),C(t,"stroke","currentColor"),C(t,"class","svelte-t7fpgu"),C(e,"aria-expanded",r[4]),C(e,"class","svelte-t7fpgu"),vr(e,"underlined",r[3])},m(p,c){w(p,e,c),S(e,t),S(t,n),S(e,i),S(e,o),w(p,s,c),h&&h.m(p,c),w(p,a,c),l=!0,u||(f=[G(e,"click",r[5]),G(e,"mouseenter",r[11]),G(e,"mouseleave",r[12])],u=!0)},p(p,[c]){(!l||c&2)&&Ae(o,p[1]),(!l||c&16)&&C(e,"aria-expanded",p[4]),(!l||c&8)&&vr(e,"underlined",p[3]),p[4]?h?(h.p(p,c),c&16&&M(h,1)):(h=Kr(p),h.c(),M(h,1),h.m(a.parentNode,a)):h&&(fe(),L(h,1,1,()=>{h=null}),ce())},i(p){l||(M(h),l=!0)},o(p){L(h),l=!1},d(p){p&&k(e),p&&k(s),h&&h.d(p),p&&k(a),u=!1,Te(f)}}}function Hl(r,e,t){let n,i,o,s;ne(r,qe,d=>t(7,o=d)),ne(r,ke,d=>t(8,s=d));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:f}=e;const h=()=>{ke.update(d=>d==u?null:u),s==u&&(zt.set(null),zt.set(u))};let p;function c(){p==null||p.scrollIntoView({behavior:"smooth"})}const m=()=>Ht.set(u),g=()=>Ht.set(null);function _(d){ue[d?"unshift":"push"](()=>{p=d,t(2,p)})}const y=()=>c();return r.$$set=d=>{"id"in d&&t(0,u=d.id),"label"in d&&t(1,f=d.label),"$$scope"in d&&t(9,l=d.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,f,p,i,n,h,c,o,s,l,a,m,g,_,y]}class zl extends W{constructor(e){super(),V(this,e,Hl,Gl,Y,{id:0,label:1})}}function Zr(r,e,t){const n=r.slice();return n[13]=e[t],n[14]=e,n[15]=t,n}function Jl(r){let e,t,n;function i(s){r[9](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new ql({props:o}),ue.push(()=>Ee(e,"props",i,r[13].properties)),{c(){x(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function Yl(r){let e,t,n;function i(s){r[8](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new xl({props:o}),ue.push(()=>Ee(e,"props",i,r[13].properties)),{c(){x(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function Xl(r){let e,t,n;function i(s){r[7](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Rl({props:o}),ue.push(()=>Ee(e,"props",i,r[13].properties)),{c(){x(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||(M(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function Wl(r){let e,t,n,i,o;function s(f){r[4](f,r[13])}function a(f){r[5](f,r[13])}function l(f){r[6](f,r[13])}let u={id:r[13].id,length_meters:r[13].properties.length_meters};return r[13].properties.name!==void 0&&(u.name=r[13].properties.name),r[13].properties.intervention_type!==void 0&&(u.intervention_type=r[13].properties.intervention_type),r[13].properties.description!==void 0&&(u.description=r[13].properties.description),e=new ul({props:u}),ue.push(()=>Ee(e,"name",s,r[13].properties.name)),ue.push(()=>Ee(e,"intervention_type",a,r[13].properties.intervention_type)),ue.push(()=>Ee(e,"description",l,r[13].properties.description)),{c(){x(e.$$.fragment)},m(f,h){N(e,f,h),o=!0},p(f,h){r=f;const p={};h&2&&(p.id=r[13].id),h&2&&(p.length_meters=r[13].properties.length_meters),!t&&h&2&&(t=!0,p.name=r[13].properties.name,Me(()=>t=!1)),!n&&h&2&&(n=!0,p.intervention_type=r[13].properties.intervention_type,Me(()=>n=!1)),!i&&h&2&&(i=!0,p.description=r[13].properties.description,Me(()=>i=!1)),e.$set(p)},i(f){o||(M(e.$$.fragment,f),o=!0)},o(f){L(e.$$.fragment,f),o=!1},d(f){B(e,f)}}}function Vl(r){let e,t,n,i,o,s,a,l,u,f,h,p,c,m,g;const _=[Wl,Xl,Yl,Jl],y=[];function d(v,$){return v[0]=="v1"?0:v[0]=="v2"?1:v[0]=="planning"?2:v[0]=="criticals"?3:-1}~(e=d(r))&&(t=y[e]=_[e](r));function b(){return r[10](r[13])}return{c(){t&&t.c(),n=R(),i=E("br"),o=R(),s=E("br"),a=R(),l=E("div"),u=E("button"),u.textContent="Delete",f=R(),h=E("button"),h.textContent="Save",p=R(),C(u,"type","button"),C(h,"type","button"),pe(l,"display","flex"),pe(l,"justify-content","space-between")},m(v,$){~e&&y[e].m(v,$),w(v,n,$),w(v,i,$),w(v,o,$),w(v,s,$),w(v,a,$),w(v,l,$),S(l,u),S(l,f),S(l,h),w(v,p,$),c=!0,m||(g=[G(u,"click",b),G(h,"click",r[11])],m=!0)},p(v,$){r=v;let O=e;e=d(r),e===O?~e&&y[e].p(r,$):(t&&(fe(),L(y[O],1,1,()=>{y[O]=null}),ce()),~e?(t=y[e],t?t.p(r,$):(t=y[e]=_[e](r),t.c()),M(t,1),t.m(n.parentNode,n)):t=null)},i(v){c||(M(t),c=!0)},o(v){L(t),c=!1},d(v){~e&&y[e].d(v),v&&k(n),v&&k(i),v&&k(o),v&&k(s),v&&k(a),v&&k(l),v&&k(p),m=!1,Te(g)}}}function Qr(r,e){let t,n,i;return n=new zl({props:{id:e[13].id,label:e[15]+1+") "+e[2](e[13]),$$slots:{default:[Vl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=ge(),x(n.$$.fragment),this.first=t},m(o,s){w(o,t,s),N(n,o,s),i=!0},p(o,s){e=o;const a={};s&2&&(a.id=e[13].id),s&2&&(a.label=e[15]+1+") "+e[2](e[13])),s&65539&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||(M(n.$$.fragment,o),i=!0)},o(o){L(n.$$.fragment,o),i=!1},d(o){o&&k(t),B(n,o)}}}function Kl(r){let e=[],t=new Map,n,i,o,s,a=r[1].features;const l=u=>u[13].id;for(let u=0;u<a.length;u+=1){let f=Zr(r,a,u),h=l(f);t.set(h,e[u]=Qr(h,f))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=ge()},m(u,f){for(let h=0;h<e.length;h+=1)e[h].m(u,f);w(u,n,f),i=!0,o||(s=G(window,"keydown",r[3]),o=!0)},p(u,[f]){f&7&&(a=u[1].features,fe(),e=co(e,f,l,1,u,a,t,n.parentNode,po,Qr,n,Zr),ce())},i(u){if(!i){for(let f=0;f<a.length;f+=1)M(e[f]);i=!0}},o(u){for(let f=0;f<e.length;f+=1)L(e[f]);i=!1},d(u){for(let f=0;f<e.length;f+=1)e[f].d(u);u&&k(n),o=!1,s()}}}function Zl(r,e,t){let n,i;ne(r,ke,_=>t(12,n=_)),ne(r,ie,_=>t(1,i=_));let{schema:o}=e;function s(_){var d,b,v,$,O;if(o=="planning")return((d=_.properties.planning)==null?void 0:d.name)||"Untitled polygon";if(o=="v2")return((v=(b=_.properties.v2)==null?void 0:b.Route)==null?void 0:v.name)||((O=($=_.properties.v2)==null?void 0:$.Crossing)==null?void 0:O.name)||"Untitled intervention";if(_.properties.name)return _.properties.name;var y=_.properties.intervention_type;return y=="other"&&(_.geometry.type=="Point"?y="point":_.geometry.type=="LineString"?y="line":y="polygon"),`Untitled ${y}`}function a(_){if(_.key=="Delete"){const y=_.target.tagName;if(y=="INPUT"||y=="TEXTAREA")return;_.preventDefault();const d=n;d&&kr(d)}}function l(_,y){r.$$.not_equal(y.properties.name,_)&&(y.properties.name=_,ie.set(i))}function u(_,y){r.$$.not_equal(y.properties.intervention_type,_)&&(y.properties.intervention_type=_,ie.set(i))}function f(_,y){r.$$.not_equal(y.properties.description,_)&&(y.properties.description=_,ie.set(i))}function h(_,y){r.$$.not_equal(y.properties,_)&&(y.properties=_,ie.set(i))}function p(_,y){r.$$.not_equal(y.properties,_)&&(y.properties=_,ie.set(i))}function c(_,y){r.$$.not_equal(y.properties,_)&&(y.properties=_,ie.set(i))}const m=_=>kr(_.id),g=()=>ke.set(null);return r.$$set=_=>{"schema"in _&&t(0,o=_.schema)},[o,i,s,a,l,u,f,h,p,c,m,g]}class Ql extends W{constructor(e){super(),V(this,e,Zl,Kl,Y,{schema:0})}}function ea(r){let e,t;return e=new Ii({}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p:H,i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function ta(r){let e,t;return e=new Fi({props:{id:void 0}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p:H,i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function na(r){let e,t,n,i,o,s,a,l,u,f,h,p,c,m;const g=[ta,ea],_=[];function y(d,b){return d[1]=="speed limits"?0:d[1]=="lane details"?1:-1}return~(u=y(r))&&(f=_[u]=g[u](r)),{c(){e=E("label"),t=Q(`Show layer:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",s=E("option"),s.textContent="Lane details",l=R(),f&&f.c(),h=ge(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,s.__value="lane details",s.value=s.__value,n.disabled=a=r[0]!=null,r[1]===void 0&&st(()=>r[2].call(n))},m(d,b){w(d,e,b),S(e,t),S(e,n),S(n,i),S(n,o),S(n,s),et(n,r[1]),w(d,l,b),~u&&_[u].m(d,b),w(d,h,b),p=!0,c||(m=G(n,"change",r[2]),c=!0)},p(d,[b]){(!p||b&1&&a!==(a=d[0]!=null))&&(n.disabled=a),b&2&&et(n,d[1]);let v=u;u=y(d),u===v?~u&&_[u].p(d,b):(f&&(fe(),L(_[v],1,1,()=>{_[v]=null}),ce()),~u?(f=_[u],f?f.p(d,b):(f=_[u]=g[u](d),f.c()),M(f,1),f.m(h.parentNode,h)):f=null)},i(d){p||(M(f),p=!0)},o(d){L(f),p=!1},d(d){d&&k(e),d&&k(l),~u&&_[u].d(d),d&&k(h),c=!1,m()}}}function ra(r,e,t){let n;ne(r,ke,s=>t(0,n=s));let i="none";function o(){i=$n(this),t(1,i),t(0,n)}return r.$$.update=()=>{r.$$.dirty&1&&n&&t(1,i="none")},[n,i,o]}class ia extends W{constructor(e){super(),V(this,e,ra,na,Y,{})}}function Qe(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ge(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Zn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function We(r,e,t){t===void 0&&(t={});var n=Qe(r),i=Qe(e),o=Ie(i[1]-n[1]),s=Ie(i[0]-n[0]),a=Ie(n[1]),l=Ie(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return ho(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function ln(r,e){return e===void 0&&(e={}),_o(r,function(t,n){var i=n.geometry.coordinates;return t+We(i[0],i[1],e)},0)}function oa(r){let e,t,n,i,o,s,a,l,u,f,h,p,c,m,g,_,y,d,b,v=r[0].features.length+"",$,O,F,A,j,T,D,ee;return{c(){e=E("div"),t=E("label"),n=Q(`Scheme name:
    `),i=E("input"),o=R(),s=E("br"),a=R(),l=E("div"),u=E("label"),f=E("input"),h=R(),p=E("button"),p.textContent="Load from GeoJSON",c=R(),m=E("button"),m.textContent="Export to GeoJSON",g=R(),_=E("br"),y=R(),d=E("div"),b=E("span"),$=Q(v),O=Q(" objects"),F=R(),A=E("button"),j=Q("Clear all"),C(i,"type","text"),C(f,"type","file"),C(f,"id","load_geojson"),C(f,"class","svelte-lhyd1e"),C(p,"type","button"),C(m,"type","button"),C(m,"class","align-right svelte-lhyd1e"),C(A,"type","button"),C(A,"class","align-right svelte-lhyd1e"),A.disabled=T=r[0].features.length==0},m(I,z){w(I,e,z),S(e,t),S(t,n),S(t,i),Re(i,r[0].scheme_name),w(I,o,z),w(I,s,z),w(I,a,z),w(I,l,z),S(l,u),S(u,f),S(u,h),S(u,p),S(l,c),S(l,m),w(I,g,z),w(I,_,z),w(I,y,z),w(I,d,z),S(d,b),S(b,$),S(b,O),S(d,F),S(d,A),S(A,j),D||(ee=[G(i,"input",r[8]),G(f,"change",r[3]),G(p,"click",la),G(m,"click",r[2]),G(A,"click",r[1])],D=!0)},p(I,[z]){z&1&&i.value!==I[0].scheme_name&&Re(i,I[0].scheme_name),z&1&&v!==(v=I[0].features.length+"")&&Ae($,v),z&1&&T!==(T=I[0].features.length==0)&&(A.disabled=T)},i:H,o:H,d(I){I&&k(e),I&&k(o),I&&k(s),I&&k(a),I&&k(l),I&&k(g),I&&k(_),I&&k(y),I&&k(d),D=!1,Te(ee)}}}function sa(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function la(){document.getElementById("load_geojson").click()}function aa(r,e,t){let n;ne(r,ie,m=>t(0,n=m));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=!1;Lt(async()=>{let g=new URLSearchParams(window.location.search).get("geojsonUrl"),_=window.localStorage.getItem(s);if(g){console.log(`Loading GeoJSON from ${g}`);try{let d=await(await fetch(g)).text();ie.set(p(JSON.parse(d)))}catch(y){console.log(`Failed to load from URL: ${y}`)}}else if(_)try{ie.set(p(JSON.parse(_)))}catch(y){console.log(`Failed to load from local storage: ${y}`)}t(7,a=!0)});function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(ie.update(m=>(delete m.scheme_name,m.features=[],m)),ke.set(null),qe.set(null),Ht.set(null),zt.set(null))}function u(){const m=JSON.parse(JSON.stringify(n));for(let g of m.features)delete g.properties.hide_while_editing;return m}function f(){let m=u();var g=s;m.authority=i,m.origin="atip-v1",m.scheme_name&&(g+="_"+m.scheme_name),g+=".txt",sa(g,JSON.stringify(m,null,"  "))}function h(m){const g=new FileReader;g.onload=y=>{try{ie.set(p(JSON.parse(y.target.result)))}catch(d){window.alert(`Couldn't load scheme from a file: ${d}`)}};let _=m.target.files;g.readAsText(_[0])}function p(m){let g=1;for(let _ of m.features)_.properties||(_.properties={name:"",description:"",intervention_type:"other"}),_.geometry.type=="LineString"&&!_.properties.length_meters&&(_.properties.length_meters=ln(_,{units:"kilometers"})*1e3),_.id=g++;return m}function c(){n.scheme_name=this.value,ie.set(n)}return r.$$set=m=>{"authorityName"in m&&t(4,i=m.authorityName),"schema"in m&&t(5,o=m.schema)},r.$$.update=()=>{r.$$.dirty&193&&a&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,f,h,i,o,s,a,c]}class ua extends W{constructor(e){super(),V(this,e,aa,oa,Y,{authorityName:4,schema:5})}}const fa="/atip/layer_lanes/assets/zoom_out_map-b2e1091a.svg";function ca(r){let e,t,n,i,o;return{c(){e=E("button"),t=E("img"),dn(t.src,n=fa)||C(t,"src",n),C(t,"alt","Zoom to show entire boundary"),C(e,"type","button"),C(e,"title","Zoom to show entire boundary"),C(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),i||(o=G(e,"click",r[0]),i=!0)},p:H,i:H,o:H,d(s){s&&k(e),i=!1,o()}}}function pa(r,e,t){let n;ne(r,Ce,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(or(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class da extends W{constructor(e){super(),V(this,e,pa,ca,Y,{boundaryGeojson:1})}}function ha(r){let e,t,n,i,o,s,a;return{c(){e=E("div"),t=Q(`Basemap:
  `),n=E("select"),i=E("option"),i.textContent="Streets",o=E("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&st(()=>r[2].call(n)),C(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,i),S(n,o),et(n,r[0]),s||(a=[G(n,"change",r[2]),G(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&et(n,l[0])},i:H,o:H,d(l){l&&k(e),s=!1,Te(a)}}}function _a(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=$n(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class ma extends W{constructor(e){super(),V(this,e,_a,ha,Y,{style:0})}}function ei(r){let e,t,n;const i=r[3].default,o=gt(i,r,r[2],null);return{c(){e=E("div"),o&&o.c()},m(s,a){w(s,e,a),o&&o.m(e,null),n=!0},p(s,a){o&&o.p&&(!n||a&4)&&bt(o,i,s,s[2],n?vt(i,s[2],a,null):yt(s[2]),null)},i(s){n||(M(o,s),st(()=>{t||(t=St(e,Mt,{duration:100},!0)),t.run(1)}),n=!0)},o(s){L(o,s),t||(t=St(e,Mt,{duration:100},!1)),t.run(0),n=!1},d(s){s&&k(e),o&&o.d(s),s&&t&&t.end()}}}function ga(r){let e,t,n,i,o,s,a,l,u,f,h=r[0]&&ei(r);return{c(){e=E("button"),t=hn("svg"),n=hn("path"),i=R(),o=Q(r[1]),s=R(),h&&h.c(),a=ge(),C(n,"d","M9 5l7 7-7 7"),C(t,"style","tran"),C(t,"width","20"),C(t,"height","20"),C(t,"fill","none"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"stroke-width","2"),C(t,"viewBox","0 0 24 24"),C(t,"stroke","currentColor"),C(t,"class","svelte-una9lq"),C(e,"aria-expanded",r[0]),C(e,"class","svelte-una9lq")},m(p,c){w(p,e,c),S(e,t),S(t,n),S(e,i),S(e,o),w(p,s,c),h&&h.m(p,c),w(p,a,c),l=!0,u||(f=G(e,"click",r[4]),u=!0)},p(p,[c]){(!l||c&2)&&Ae(o,p[1]),(!l||c&1)&&C(e,"aria-expanded",p[0]),p[0]?h?(h.p(p,c),c&1&&M(h,1)):(h=ei(p),h.c(),M(h,1),h.m(a.parentNode,a)):h&&(fe(),L(h,1,1,()=>{h=null}),ce())},i(p){l||(M(h),l=!0)},o(p){L(h),l=!1},d(p){p&&k(e),p&&k(s),h&&h.d(p),p&&k(a),u=!1,f()}}}function ba(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,o=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,i=l.$$scope)},[s,o,i,n,a]}class An extends W{constructor(e){super(),V(this,e,ba,ga,Y,{label:1,open:0})}}function ya(r){let e,t,n,i,o,s,a,l,u,f,h,p,c,m,g;return{c(){e=E("li"),t=E("span"),n=Q("Areas"),i=R(),o=E("li"),s=E("span"),a=Q("Routes"),l=R(),u=E("li"),f=E("span"),h=Q("Crossings"),p=R(),c=E("li"),m=E("span"),g=Q("Other"),C(t,"class","svelte-l42ea0"),pe(t,"background",me.area),C(s,"class","svelte-l42ea0"),pe(s,"background",me.route),C(f,"class","svelte-l42ea0"),pe(f,"background",me.crossing),C(m,"class","svelte-l42ea0"),pe(m,"background",me.other)},m(_,y){w(_,e,y),S(e,t),S(e,n),w(_,i,y),w(_,o,y),S(o,s),S(o,a),w(_,l,y),w(_,u,y),S(u,f),S(u,h),w(_,p,y),w(_,c,y),S(c,m),S(c,g)},p:H,d(_){_&&k(e),_&&k(i),_&&k(o),_&&k(l),_&&k(u),_&&k(p),_&&k(c)}}}function va(r){let e,t,n,i,o,s,a,l,u,f,h,p,c,m,g;return{c(){e=E("li"),t=E("span"),n=Q("Preapp"),i=R(),o=E("li"),s=E("span"),a=Q("Outline"),l=R(),u=E("li"),f=E("span"),h=Q("Reserved matters"),p=R(),c=E("li"),m=E("span"),g=Q("Local plan"),C(t,"class","svelte-l42ea0"),pe(t,"background",me.preapp),C(s,"class","svelte-l42ea0"),pe(s,"background",me.outline),C(f,"class","svelte-l42ea0"),pe(f,"background",me["reserved matters"]),C(m,"class","svelte-l42ea0"),pe(m,"background",me["local plan"])},m(_,y){w(_,e,y),S(e,t),S(e,n),w(_,i,y),w(_,o,y),S(o,s),S(o,a),w(_,l,y),w(_,u,y),S(u,f),S(u,h),w(_,p,y),w(_,c,y),S(c,m),S(c,g)},p:H,d(_){_&&k(e),_&&k(i),_&&k(o),_&&k(l),_&&k(u),_&&k(p),_&&k(c)}}}function wa(r){let e;function t(o,s){return o[0]=="planning"?va:ya}let n=t(r),i=n(r);return{c(){e=E("ul"),i.c()},m(o,s){w(o,e,s),i.m(e,null)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&k(e),i.d()}}}function ka(r){let e,t,n;return t=new An({props:{label:"Objects",open:!0,$$slots:{default:[wa]},$$scope:{ctx:r}}}),{c(){e=E("div"),x(t.$$.fragment),C(e,"class","svelte-l42ea0")},m(i,o){w(i,e,o),N(t,e,null),n=!0},p(i,[o]){const s={};o&3&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(M(t.$$.fragment,i),n=!0)},o(i){L(t.$$.fragment,i),n=!1},d(i){i&&k(e),B(t)}}}function Sa(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class Ea extends W{constructor(e){super(),V(this,e,Sa,ka,Y,{schema:0})}}let ft="interventions";function Ma(r,e,t){let n,i;ne(r,Ce,f=>t(1,n=f)),ne(r,ie,f=>t(2,i=f));let{schema:o}=e;Ye(n,ft,i);const s=["match",["get","intervention_type"],"area",me.area,"route",me.route,"crossing",me.crossing,"other",me.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",me.preapp,"outline",me.outline,"reserved matters",me["reserved matters"],"local plan",me["local plan"],"white"],l=["!=","hide_while_editing",!0];return we(n,{id:"interventions-points",source:ft,filter:["all",Ln,l,["!=","endpoint",!0]],...Ct(s,Rn)}),we(n,{id:"interventions-lines",source:ft,filter:["all",Cn,l],...kt(s,Yt)}),we(n,{id:"interventions-lines-endpoints",source:ft,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Yt,"circle-opacity":0,"circle-stroke-color":me.lineEndpointColor,"circle-stroke-width":2}}),we(n,{id:"interventions-polygons",source:ft,filter:["all",On,l],...Mn(o=="planning"?a:s,.5)}),r.$$set=f=>{"schema"in f&&t(0,o=f.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let f=JSON.parse(JSON.stringify(i)),h=[];for(let p of f.features)if(p.geometry.type=="LineString")for(let c of[p.geometry.coordinates[0],p.geometry.coordinates[p.geometry.coordinates.length-1]])h.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:c}});f.features=f.features.concat(h),n.getSource(ft).setData(f)}},[o,n,i]}class $a extends W{constructor(e){super(),V(this,e,Ma,null,Y,{schema:0})}}let ct="hover";function La(r,e,t){let n,i,o,s,a;return ne(r,Ce,l=>t(0,n=l)),ne(r,ie,l=>t(1,i=l)),ne(r,Ht,l=>t(2,o=l)),ne(r,qe,l=>t(3,s=l)),ne(r,ke,l=>t(4,a=l)),Ye(n,ct,Ne()),we(n,{id:"hover-polygons",source:ct,filter:On,...kt(me.hovering,.5*Yt,1)}),we(n,{id:"hover-lines",source:ct,filter:Cn,...kt(me.hovering,1.5*Yt,1)}),we(n,{id:"hover-points",source:ct,filter:Ln,...Ct(me.hovering,1.5*Rn,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(ct).setData(i.features.find(u=>u.id==l)):n.getSource(ct).setData(Ne())}},[n,i,o,s,a]}class Ca extends W{constructor(e){super(),V(this,e,La,null,Y,{})}}class fr{constructor(e,t){le(this,"owner");le(this,"map");le(this,"mapHandlers",{});le(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const en="edit-point-mode";class Oa{constructor(e){le(this,"map");le(this,"active");le(this,"eventListenersSuccess");le(this,"eventListenersFailure");le(this,"cursor");le(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new fr(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Ye(e,en,Ne()),we(e,{id:"edit-point-mode",source:en,...Ct(me.hovering,Rn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=Ra(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(en),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Ne();this.cursor&&e.features.push(this.cursor),this.map.getSource(en).setData(e)}}function Ra(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Gi(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Aa(r,e);var n=Qe(r),i=Qe(e),o=Ie(n[0]),s=Ie(i[0]),a=Ie(n[1]),l=Ie(i[1]),u=Math.sin(s-o)*Math.cos(l),f=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return qn(Math.atan2(u,f))}function Aa(r,e){var t=Gi(e,r);return t=(t+180)%360,t}function ti(r,e,t,n){n===void 0&&(n={});var i=Qe(r),o=Ie(i[0]),s=Ie(i[1]),a=Ie(t),l=mo(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),f=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),h=qn(f),p=qn(u);return wt([h,p],n.properties)}function Qn(r){if(!r)throw new Error("geojson is required");var e=[];return sr(r,function(t){Ta(t,e)}),Ze(e)}function Ta(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ge(n);break;case"LineString":t=[Ge(n)]}t.forEach(function(i){var o=Fa(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Fa(r,e){var t=[];return r.reduce(function(n,i){var o=Et([n,i],e);return o.bbox=Pa(n,i),t.push(o),i}),t}function Pa(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var $t={},Ia={get exports(){return $t},set exports(r){$t=r}},er={},xa={get exports(){return er},set exports(r){er=r}};(function(r,e){(function(t,n){r.exports=n()})(go,function(){function t(d,b,v,$,O){(function F(A,j,T,D,ee){for(;D>T;){if(D-T>600){var I=D-T+1,z=j-T+1,ae=Math.log(I),Se=.5*Math.exp(2*ae/3),Pe=.5*Math.sqrt(ae*Se*(I-Se)/I)*(z-I/2<0?-1:1),se=Math.max(T,Math.floor(j-z*Se/I+Pe)),oe=Math.min(D,Math.floor(j+(I-z)*Se/I+Pe));F(A,j,se,oe,ee)}var Be=A[j],Le=T,te=D;for(n(A,T,j),ee(A[D],Be)>0&&n(A,T,D);Le<te;){for(n(A,Le,te),Le++,te--;ee(A[Le],Be)<0;)Le++;for(;ee(A[te],Be)>0;)te--}ee(A[T],Be)===0?n(A,T,te):n(A,++te,D),te<=j&&(T=te+1),j<=te&&(D=te-1)}})(d,b,v||0,$||d.length-1,O||i)}function n(d,b,v){var $=d[b];d[b]=d[v],d[v]=$}function i(d,b){return d<b?-1:d>b?1:0}var o=function(d){d===void 0&&(d=9),this._maxEntries=Math.max(4,d),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(d,b,v){if(!v)return b.indexOf(d);for(var $=0;$<b.length;$++)if(v(d,b[$]))return $;return-1}function a(d,b){l(d,0,d.children.length,b,d)}function l(d,b,v,$,O){O||(O=_(null)),O.minX=1/0,O.minY=1/0,O.maxX=-1/0,O.maxY=-1/0;for(var F=b;F<v;F++){var A=d.children[F];u(O,d.leaf?$(A):A)}return O}function u(d,b){return d.minX=Math.min(d.minX,b.minX),d.minY=Math.min(d.minY,b.minY),d.maxX=Math.max(d.maxX,b.maxX),d.maxY=Math.max(d.maxY,b.maxY),d}function f(d,b){return d.minX-b.minX}function h(d,b){return d.minY-b.minY}function p(d){return(d.maxX-d.minX)*(d.maxY-d.minY)}function c(d){return d.maxX-d.minX+(d.maxY-d.minY)}function m(d,b){return d.minX<=b.minX&&d.minY<=b.minY&&b.maxX<=d.maxX&&b.maxY<=d.maxY}function g(d,b){return b.minX<=d.maxX&&b.minY<=d.maxY&&b.maxX>=d.minX&&b.maxY>=d.minY}function _(d){return{children:d,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(d,b,v,$,O){for(var F=[b,v];F.length;)if(!((v=F.pop())-(b=F.pop())<=$)){var A=b+Math.ceil((v-b)/$/2)*$;t(d,A,b,v,O),F.push(b,A,A,v)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(d){var b=this.data,v=[];if(!g(d,b))return v;for(var $=this.toBBox,O=[];b;){for(var F=0;F<b.children.length;F++){var A=b.children[F],j=b.leaf?$(A):A;g(d,j)&&(b.leaf?v.push(A):m(d,j)?this._all(A,v):O.push(A))}b=O.pop()}return v},o.prototype.collides=function(d){var b=this.data;if(!g(d,b))return!1;for(var v=[];b;){for(var $=0;$<b.children.length;$++){var O=b.children[$],F=b.leaf?this.toBBox(O):O;if(g(d,F)){if(b.leaf||m(d,F))return!0;v.push(O)}}b=v.pop()}return!1},o.prototype.load=function(d){if(!d||!d.length)return this;if(d.length<this._minEntries){for(var b=0;b<d.length;b++)this.insert(d[b]);return this}var v=this._build(d.slice(),0,d.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var $=this.data;this.data=v,v=$}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},o.prototype.insert=function(d){return d&&this._insert(d,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(d,b){if(!d)return this;for(var v,$,O,F=this.data,A=this.toBBox(d),j=[],T=[];F||j.length;){if(F||(F=j.pop(),$=j[j.length-1],v=T.pop(),O=!0),F.leaf){var D=s(d,F.children,b);if(D!==-1)return F.children.splice(D,1),j.push(F),this._condense(j),this}O||F.leaf||!m(F,A)?$?(v++,F=$.children[v],O=!1):F=null:(j.push(F),T.push(v),v=0,$=F,F=F.children[0])}return this},o.prototype.toBBox=function(d){return d},o.prototype.compareMinX=function(d,b){return d.minX-b.minX},o.prototype.compareMinY=function(d,b){return d.minY-b.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(d){return this.data=d,this},o.prototype._all=function(d,b){for(var v=[];d;)d.leaf?b.push.apply(b,d.children):v.push.apply(v,d.children),d=v.pop();return b},o.prototype._build=function(d,b,v,$){var O,F=v-b+1,A=this._maxEntries;if(F<=A)return a(O=_(d.slice(b,v+1)),this.toBBox),O;$||($=Math.ceil(Math.log(F)/Math.log(A)),A=Math.ceil(F/Math.pow(A,$-1))),(O=_([])).leaf=!1,O.height=$;var j=Math.ceil(F/A),T=j*Math.ceil(Math.sqrt(A));y(d,b,v,T,this.compareMinX);for(var D=b;D<=v;D+=T){var ee=Math.min(D+T-1,v);y(d,D,ee,j,this.compareMinY);for(var I=D;I<=ee;I+=j){var z=Math.min(I+j-1,ee);O.children.push(this._build(d,I,z,$-1))}}return a(O,this.toBBox),O},o.prototype._chooseSubtree=function(d,b,v,$){for(;$.push(b),!b.leaf&&$.length-1!==v;){for(var O=1/0,F=1/0,A=void 0,j=0;j<b.children.length;j++){var T=b.children[j],D=p(T),ee=(I=d,z=T,(Math.max(z.maxX,I.maxX)-Math.min(z.minX,I.minX))*(Math.max(z.maxY,I.maxY)-Math.min(z.minY,I.minY))-D);ee<F?(F=ee,O=D<O?D:O,A=T):ee===F&&D<O&&(O=D,A=T)}b=A||b.children[0]}var I,z;return b},o.prototype._insert=function(d,b,v){var $=v?d:this.toBBox(d),O=[],F=this._chooseSubtree($,this.data,b,O);for(F.children.push(d),u(F,$);b>=0&&O[b].children.length>this._maxEntries;)this._split(O,b),b--;this._adjustParentBBoxes($,O,b)},o.prototype._split=function(d,b){var v=d[b],$=v.children.length,O=this._minEntries;this._chooseSplitAxis(v,O,$);var F=this._chooseSplitIndex(v,O,$),A=_(v.children.splice(F,v.children.length-F));A.height=v.height,A.leaf=v.leaf,a(v,this.toBBox),a(A,this.toBBox),b?d[b-1].children.push(A):this._splitRoot(v,A)},o.prototype._splitRoot=function(d,b){this.data=_([d,b]),this.data.height=d.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(d,b,v){for(var $,O,F,A,j,T,D,ee=1/0,I=1/0,z=b;z<=v-b;z++){var ae=l(d,0,z,this.toBBox),Se=l(d,z,v,this.toBBox),Pe=(O=ae,F=Se,A=void 0,j=void 0,T=void 0,D=void 0,A=Math.max(O.minX,F.minX),j=Math.max(O.minY,F.minY),T=Math.min(O.maxX,F.maxX),D=Math.min(O.maxY,F.maxY),Math.max(0,T-A)*Math.max(0,D-j)),se=p(ae)+p(Se);Pe<ee?(ee=Pe,$=z,I=se<I?se:I):Pe===ee&&se<I&&(I=se,$=z)}return $||v-b},o.prototype._chooseSplitAxis=function(d,b,v){var $=d.leaf?this.compareMinX:f,O=d.leaf?this.compareMinY:h;this._allDistMargin(d,b,v,$)<this._allDistMargin(d,b,v,O)&&d.children.sort($)},o.prototype._allDistMargin=function(d,b,v,$){d.children.sort($);for(var O=this.toBBox,F=l(d,0,b,O),A=l(d,v-b,v,O),j=c(F)+c(A),T=b;T<v-b;T++){var D=d.children[T];u(F,d.leaf?O(D):D),j+=c(F)}for(var ee=v-b-1;ee>=b;ee--){var I=d.children[ee];u(A,d.leaf?O(I):I),j+=c(A)}return j},o.prototype._adjustParentBBoxes=function(d,b,v){for(var $=v;$>=0;$--)u(b[$],d)},o.prototype._condense=function(d){for(var b=d.length-1,v=void 0;b>=0;b--)d[b].children.length===0?b>0?(v=d[b-1].children).splice(v.indexOf(d[b]),1):this.clear():a(d[b],this.toBBox)},o})})(xa);const Na=lr(bo),Ba=lr(yo),ja=lr(vo);var je=er,Hi=Na,zi=Ba,pt=ja.default,Da=zi.featureEach;zi.coordEach;Hi.polygon;var ni=Hi.featureCollection;function Ji(r){var e=new je(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:pt(t),je.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:pt(i),n.push(i)}):Da(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:pt(i),n.push(i)}),je.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:pt(t),je.prototype.remove.call(this,t,n)},e.clear=function(){return je.prototype.clear.call(this)},e.search=function(t){var n=je.prototype.search.call(this,this.toBBox(t));return ni(n)},e.collides=function(t){return je.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=je.prototype.all.call(this);return ni(t)},e.toJSON=function(){return je.prototype.toJSON.call(this)},e.fromJSON=function(t){return je.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=pt(t);else if(t.type==="FeatureCollection")n=pt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ia.exports=Ji;$t.default=Ji;function Yi(r,e){var t={},n=[];if(r.type==="LineString"&&(r=wr(r)),e.type==="LineString"&&(e=wr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=ri(r,e);return i&&n.push(i),Ze(n)}var o=$t();return o.load(Qn(e)),_n(Qn(r),function(s){_n(o.search(s),function(a){var l=ri(s,a);if(l){var u=Ge(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),Ze(n)}function ri(r,e){var t=Ge(r),n=Ge(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],f=n[1][0],h=n[1][1],p=(h-u)*(s-i)-(f-l)*(a-o),c=(f-l)*(o-u)-(h-u)*(i-l),m=(s-i)*(o-u)-(a-o)*(i-l);if(p===0)return c===0&&m===0,null;var g=c/p,_=m/p;if(g>=0&&g<=1&&_>=0&&_<=1){var y=i+g*(s-i),d=o+g*(a-o);return wt([y,d])}return null}function Xt(r,e,t){t===void 0&&(t={});var n=wt([1/0,1/0],{dist:1/0}),i=0;return sr(r,function(o){for(var s=Ge(o),a=0;a<s.length-1;a++){var l=wt(s[a]);l.properties.dist=We(e,l,t);var u=wt(s[a+1]);u.properties.dist=We(e,u,t);var f=We(l,u,t),h=Math.max(l.properties.dist,u.properties.dist),p=Gi(l,u),c=ti(e,h,p+90,t),m=ti(e,h,p-90,t),g=Yi(Et([c.geometry.coordinates,m.geometry.coordinates]),Et([l.geometry.coordinates,u.geometry.coordinates])),_=null;g.features.length>0&&(_=g.features[0],_.properties.dist=We(e,_,t),_.properties.location=i+We(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+f),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a),i+=f}}),n}const dt="edit-polygon-mode";class Ua{constructor(e){le(this,"map");le(this,"active");le(this,"eventListenersSuccess");le(this,"eventListenersFailure");le(this,"points");le(this,"cursor");le(this,"hover");le(this,"dragFrom");le(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new fr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Ye(e,dt,Ne()),we(e,{id:"edit-polygon-fill",source:dt,filter:On,...Mn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),we(e,{id:"edit-polygon-lines",source:dt,filter:Cn,...kt("black",8,.5)}),we(e,{id:"edit-polygon-vertices",source:dt,filter:Ln,...Ct(me.hovering,Rn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(oi(this.points).forEach((n,i)=>{t.push([i+1,Xt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(dt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Ne();this.points.forEach((n,i)=>{let o=ii(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(oi(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(dt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=ii(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function ii(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function oi(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let Z;const Je=new Array(32).fill(void 0);Je.push(void 0,null,!0,!1);function K(r){return Je[r]}let Dt=Je.length;function qa(r){r<36||(Je[r]=Dt,Dt=r)}function tr(r){const e=K(r);return qa(r),e}const Xi=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Xi.decode();let an=new Uint8Array;function Ut(){return an.byteLength===0&&(an=new Uint8Array(Z.memory.buffer)),an}function _t(r,e){return Xi.decode(Ut().subarray(r,r+e))}function ye(r){Dt===Je.length&&Je.push(Je.length+1);const e=Dt;return Dt=Je[e],Je[e]=r,e}function Bn(r){return r==null}let un=new Float64Array;function Ga(){return un.byteLength===0&&(un=new Float64Array(Z.memory.buffer)),un}let fn=new Int32Array;function ve(){return fn.byteLength===0&&(fn=new Int32Array(Z.memory.buffer)),fn}let Ke=0;const cn=new TextEncoder("utf-8"),Ha=typeof cn.encodeInto=="function"?function(r,e){return cn.encodeInto(r,e)}:function(r,e){const t=cn.encode(r);return e.set(t),{read:r.length,written:t.length}};function tn(r,e,t){if(t===void 0){const a=cn.encode(r),l=e(a.length);return Ut().subarray(l,l+a.length).set(a),Ke=a.length,l}let n=r.length,i=e(n);const o=Ut();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=Ut().subarray(i+s,i+n),l=Ha(r,a);s+=l.written}return Ke=s,i}function nr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=nr(r[0]));for(let s=1;s<i;s++)o+=", "+nr(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function za(r,e){const t=e(r.length*1);return Ut().set(r,t/1),Ke=r.length,t}function jn(r,e){try{return r.apply(this,e)}catch(t){Z.__wbindgen_exn_store(ye(t))}}class wn{static __wrap(e){const t=Object.create(wn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Z.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=Z.__wbindgen_add_to_stack_pointer(-16),s=za(e,Z.__wbindgen_malloc),a=Ke;Z.jsroutesnapper_new(o,s,a);var t=ve()[o/4+0],n=ve()[o/4+1],i=ve()[o/4+2];if(i)throw tr(n);return wn.__wrap(t)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){Z.jsroutesnapper_setConfig(this.ptr,ye(e))}toFinalFeature(){try{const n=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ve()[n/4+0],t=ve()[n/4+1];let i;return e!==0&&(i=_t(e,t).slice(),Z.__wbindgen_free(e,t*1)),i}finally{Z.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_renderGeojson(n,this.ptr);var e=ve()[n/4+0],t=ve()[n/4+1];return _t(e,t)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(e,t)}}setSnapMode(e){Z.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return Z.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){Z.jsroutesnapper_onClick(this.ptr)}onDragStart(){return Z.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return Z.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){Z.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_editExisting(i,this.ptr,ye(e));var t=ve()[i/4+0],n=ve()[i/4+1];if(n)throw tr(t)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}}async function Ja(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ya(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){tr(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=K(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(_t(e,t));return ye(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=_t(e,t);return ye(n)},r.wbg.__wbindgen_is_object=function(e){const t=K(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return K(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return K(e)in K(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=K(t),i=typeof n=="number"?n:void 0;Ga()[e/8+1]=Bn(i)?0:i,ve()[e/4+0]=!Bn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return K(e)==K(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=K(t),i=typeof n=="string"?n:void 0;var o=Bn(i)?0:tn(i,Z.__wbindgen_malloc,Z.__wbindgen_realloc),s=Ke;ve()[e/4+1]=s,ve()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(K(t)),i=tn(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=Ke;ve()[e/4+1]=o,ve()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=K(e);return ye(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=K(e)[K(t)];return ye(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(K(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(K(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(K(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(K(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(K(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=K(e)[t>>>0];return ye(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return K(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof K(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=K(e).next;return ye(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return jn(function(e){const t=K(e).next();return ye(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return K(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=K(e).value;return ye(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ye(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return jn(function(e,t){const n=Reflect.get(K(e),K(t));return ye(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return jn(function(e,t){const n=K(e).call(K(t));return ye(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(K(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=K(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=K(e).buffer;return ye(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(K(e));return ye(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){K(e).set(K(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return K(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=K(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ye(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=K(t).stack,i=tn(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=Ke;ve()[e/4+1]=o,ve()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(_t(e,t))}finally{Z.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=nr(K(t)),i=tn(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=Ke;ve()[e/4+1]=o,ve()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(_t(e,t))},r.wbg.__wbindgen_memory=function(){const e=Z.memory;return ye(e)},r}function Xa(r,e){return Z=r.exports,Wi.__wbindgen_wasm_module=e,un=new Float64Array,fn=new Int32Array,an=new Uint8Array,Z}async function Wi(r){typeof r>"u"&&(r="/atip/layer_lanes/assets/route_snapper_bg.wasm");const e=Ya();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Ja(await r,e);return Xa(t,n)}const Tt="route-snapper",si=10,Wa=30;class Va{constructor(e,t){le(this,"map");le(this,"inner");le(this,"active");le(this,"eventListenersSuccessRoute");le(this,"eventListenersSuccessArea");le(this,"eventListenersFailure");le(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new wn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Ye(e,Tt,Ne()),we(e,{id:"route-points",source:Tt,filter:Ln,...Ct(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",si/2,si])}),we(e,{id:"route-lines",source:Tt,filter:Cn,...kt("black",2.5)}),we(e,{id:"route-polygons",source:Tt,filter:On,...Mn("black",.5)}),this.events=new fr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Wa,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Tt).setData(JSON.parse(this.inner.renderGeojson()))}}function Ka(r){let e,t,n,i,o,s,a,l;return{c(){e=E("button"),t=E("img"),i=R(),o=Q(r[2]),dn(t.src,n=r[3])||C(t,"src",n),C(t,"alt",r[2]),C(t,"class","svelte-1vvpkg9"),C(e,"type","button"),e.disabled=s=r[0]==r[1],C(e,"class","svelte-1vvpkg9")},m(u,f){w(u,e,f),S(e,t),S(e,i),S(e,o),a||(l=G(e,"click",r[5]),a=!0)},p(u,[f]){f&8&&!dn(t.src,n=u[3])&&C(t,"src",n),f&4&&C(t,"alt",u[2]),f&4&&Ae(o,u[2]),f&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:H,o:H,d(u){u&&k(e),a=!1,l()}}}function Za(r,e,t){let{mode:n}=e,{thisMode:i}=e,{label:o}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(i);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,i=u.thisMode),"label"in u&&t(2,o=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,i,o,s,a,l]}class it extends W{constructor(e){super(),V(this,e,Za,Ka,Y,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function li(r){let e;function t(o,s){return o[1]?eu:Qa}let n=t(r),i=n(r);return{c(){i.c(),e=ge()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&k(e)}}}function Qa(r){let e;return{c(){e=E("p"),e.textContent="Click an object to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function eu(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another object"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function tu(r){let e,t=r[0]==mt&&li(r);return{c(){t&&t.c(),e=ge()},m(n,i){t&&t.m(n,i),w(n,e,i)},p(n,[i]){n[0]==mt?t?t.p(n,i):(t=li(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:H,o:H,d(n){t&&t.d(n),n&&k(e)}}}const mt="edit-attribute";function Vi(){}function nu(r,e,t){let n,i,o,s;ne(r,Ce,c=>t(5,n=c)),ne(r,ie,c=>t(6,i=c)),ne(r,zt,c=>t(7,o=c)),ne(r,ke,c=>t(1,s=c));let{mode:a}=e,{changeMode:l}=e;function u(){ke.set(null)}n.on("mousemove",f),n.on("mouseout",h),n.on("click",p),nt(()=>{n.off("mousemove",f),n.off("mouseout",h),n.off("click",p)});function f(c){var m;if(a==mt){let g=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});qe.set(((m=g[0])==null?void 0:m.id)||null)}}function h(){a==mt&&qe.set(null)}function p(c){if(a==mt){let m=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0?ke.set(m[0].id):ke.set(null)}}return r.$$set=c=>{"mode"in c&&t(0,a=c.mode),"changeMode"in c&&t(2,l=c.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let c=o;if(c){let m=i.features.find(g=>g.id==c);m.geometry.type=="Point"?n.flyTo({center:m.geometry.coordinates,duration:500}):n.fitBounds(or(m),{padding:200,duration:500}),l(mt)}}},[a,s,l,Vi,u,n,i,o]}class ru extends W{constructor(e){super(),V(this,e,nu,tu,Y,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Vi}get stop(){return this.$$.ctx[4]}}function iu(r){let e,t;return{c:H,m(n,i){e||(t=G(window,"keydown",r[0]),e=!0)},p:H,i:H,o:H,d(n){e=!1,t()}}}function ou(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class Tn extends W{constructor(e){super(),V(this,e,ou,iu,Y,{tool:1})}}function su(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function lu(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function au(r){let e,t,n,i,o,s,a,l,u,f;function h(m,g){return m[1]?lu:su}let p=h(r),c=p(r);return a=new Tn({props:{tool:r[0]}}),{c(){e=E("ul"),c.c(),t=R(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=R(),o=E("button"),o.textContent="Cancel",s=R(),x(a.$$.fragment),C(o,"type","button")},m(m,g){w(m,e,g),c.m(e,null),S(e,t),S(e,n),w(m,i,g),w(m,o,g),w(m,s,g),N(a,m,g),l=!0,u||(f=G(o,"click",r[2]),u=!0)},p(m,[g]){p!==(p=h(m))&&(c.d(1),c=p(m),c&&(c.c(),c.m(e,t)));const _={};g&1&&(_.tool=m[0]),a.$set(_)},i(m){l||(M(a.$$.fragment,m),l=!0)},o(m){L(a.$$.fragment,m),l=!1},d(m){m&&k(e),c.d(),m&&k(i),m&&k(o),m&&k(s),B(a,m),u=!1,f()}}}function uu(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Ki extends W{constructor(e){super(),V(this,e,uu,au,Y,{pointTool:0,editingExisting:1})}}function fu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function cu(r){let e,t,n,i,o,s,a,l,u,f,h;return e=new An({props:{label:"Help",$$slots:{default:[fu]},$$scope:{ctx:r}}}),l=new Tn({props:{tool:r[0]}}),{c(){x(e.$$.fragment),t=R(),n=E("div"),i=E("button"),i.textContent="Finish",o=R(),s=E("button"),s.textContent="Cancel",a=R(),x(l.$$.fragment),C(i,"type","button"),C(s,"type","button"),pe(n,"display","flex"),pe(n,"justify-content","space-between")},m(p,c){N(e,p,c),w(p,t,c),w(p,n,c),S(n,i),S(n,o),S(n,s),w(p,a,c),N(l,p,c),u=!0,f||(h=[G(i,"click",r[1]),G(s,"click",r[2])],f=!0)},p(p,[c]){const m={};c&8&&(m.$$scope={dirty:c,ctx:p}),e.$set(m);const g={};c&1&&(g.tool=p[0]),l.$set(g)},i(p){u||(M(e.$$.fragment,p),M(l.$$.fragment,p),u=!0)},o(p){L(e.$$.fragment,p),L(l.$$.fragment,p),u=!1},d(p){B(e,p),p&&k(t),p&&k(n),p&&k(a),B(l,p),f=!1,Te(h)}}}function pu(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Zi extends W{constructor(e){super(),V(this,e,pu,cu,Y,{polygonTool:0})}}function du(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function hu(r){let e,t,n,i,o,s,a,l,u,f,h;return e=new An({props:{label:"Help",$$slots:{default:[du]},$$scope:{ctx:r}}}),l=new Tn({props:{tool:r[0]}}),{c(){x(e.$$.fragment),t=R(),n=E("div"),i=E("button"),i.textContent="Finish",o=R(),s=E("button"),s.textContent="Cancel",a=R(),x(l.$$.fragment),C(i,"type","button"),C(s,"type","button"),pe(n,"display","flex"),pe(n,"justify-content","space-between")},m(p,c){N(e,p,c),w(p,t,c),w(p,n,c),S(n,i),S(n,o),S(n,s),w(p,a,c),N(l,p,c),u=!0,f||(h=[G(i,"click",r[1]),G(s,"click",r[2])],f=!0)},p(p,[c]){const m={};c&8&&(m.$$scope={dirty:c,ctx:p}),e.$set(m);const g={};c&1&&(g.tool=p[0]),l.$set(g)},i(p){u||(M(e.$$.fragment,p),M(l.$$.fragment,p),u=!0)},o(p){L(e.$$.fragment,p),L(l.$$.fragment,p),u=!1},d(p){B(e,p),p&&k(t),p&&k(n),p&&k(a),B(l,p),f=!1,Te(h)}}}function _u(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Qi extends W{constructor(e){super(),V(this,e,_u,hu,Y,{routeTool:0})}}function mu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function gu(r){let e,t,n,i,o,s,a,l,u,f,h,p,c,m,g;return e=new An({props:{label:"Help",$$slots:{default:[mu]},$$scope:{ctx:r}}}),p=new Tn({props:{tool:r[0]}}),{c(){x(e.$$.fragment),t=R(),n=E("label"),i=E("input"),o=Q(`
  Avoid doubling back`),s=R(),a=E("div"),l=E("button"),l.textContent="Finish",u=R(),f=E("button"),f.textContent="Cancel",h=R(),x(p.$$.fragment),C(i,"type","checkbox"),C(l,"type","button"),C(f,"type","button"),pe(a,"display","flex"),pe(a,"justify-content","space-between")},m(_,y){N(e,_,y),w(_,t,y),w(_,n,y),S(n,i),i.checked=r[1],S(n,o),w(_,s,y),w(_,a,y),S(a,l),S(a,u),S(a,f),w(_,h,y),N(p,_,y),c=!0,m||(g=[G(i,"change",r[2]),G(l,"click",r[3]),G(f,"click",r[4])],m=!0)},p(_,[y]){const d={};y&32&&(d.$$scope={dirty:y,ctx:_}),e.$set(d),y&2&&(i.checked=_[1]);const b={};y&1&&(b.tool=_[0]),p.$set(b)},i(_){c||(M(e.$$.fragment,_),M(p.$$.fragment,_),c=!0)},o(_){L(e.$$.fragment,_),L(p.$$.fragment,_),c=!1},d(_){B(e,_),_&&k(t),_&&k(n),_&&k(s),_&&k(a),_&&k(h),B(p,_),m=!1,Te(g)}}}function bu(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class eo extends W{constructor(e){super(),V(this,e,bu,gu,Y,{routeTool:0})}}function ai(r){let e,t,n,i;const o=[Su,ku,wu,vu,yu],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=ge()},m(l,u){s[e].m(l,u),w(l,n,u),i=!0},p(l,u){let f=e;e=a(l),e===f?s[e].p(l,u):(fe(),L(s[f],1,1,()=>{s[f]=null}),ce(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),M(t,1),t.m(n.parentNode,n))},i(l){i||(M(t),i=!0)},o(l){L(t),i=!1},d(l){s[e].d(l),l&&k(n)}}}function yu(r){let e;return{c(){e=E("p"),e.textContent="Click an object to edit its geometry"},m(t,n){w(t,e,n)},p:H,i:H,o:H,d(t){t&&k(e)}}}function vu(r){let e,t;return e=new eo({props:{routeTool:r[3]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function wu(r){let e,t;return e=new Qi({props:{routeTool:r[3]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function ku(r){let e,t;return e=new Zi({props:{polygonTool:r[2]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Su(r){let e,t;return e=new Ki({props:{pointTool:r[1],editingExisting:!0}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Eu(r){let e,t,n=r[0]==He&&ai(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==He?n?(n.p(i,o),o&1&&M(n,1)):(n=ai(i),n.c(),M(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||(M(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const He="edit-geometry";function to(){}function Mu(r,e,t){let n;ne(r,Ce,g=>t(8,n=g));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function f(){l&&(o.stop(),s.stop(),a.stop(),ie.update(g=>{let _=g.features.find(y=>y.id==l);return delete _.properties.hide_while_editing,g})),l=null,t(4,u=null),qe.set(null)}n.on("mousemove",h),n.on("mouseout",p),n.on("click",c),nt(()=>{n.off("mousemove",h),n.off("mouseout",p),n.off("click",c)}),a.addEventListenerSuccessRoute(g=>{i==He&&(ie.update(_=>{let y=_.features.find(d=>d.id==l);return y.properties.length_meters=g.properties.length_meters,y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,_}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{i==He&&(ie.update(_=>{let y=_.features.find(d=>d.id==l);return y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,_}),l=null,t(4,u=null))});for(let g of[o,s])g.addEventListenerSuccess(_=>{i==He&&(ie.update(y=>{let d=y.features.find(b=>b.id==l);return d.geometry=_.geometry,delete d.properties.hide_while_editing,y}),l=null,t(4,u=null))});for(let g of[o,s,a])g.addEventListenerFailure(()=>{i==He&&(ie.update(_=>{let y=_.features.find(d=>d.id==l);return delete y.properties.hide_while_editing,_}),l=null,t(4,u=null))});function h(g){var _;if(i==He&&l==null){let y=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});qe.set(((_=y[0])==null?void 0:_.id)||null)}}function p(){i==He&&l==null&&qe.set(null)}function c(g){if(i==He&&l==null){let _=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&m(_[0].id)}}function m(g){qe.set(null);let _=null;ie.update(d=>(_=d.features.find(b=>b.id==g),_.properties.hide_while_editing=!0,d));let y=_;l=g,y.geometry.type=="LineString"?(a.editExistingRoute(y),t(4,u="route")):y.geometry.type=="Polygon"?y.properties.waypoints?(a.editExistingArea(y),t(4,u="snap-polygon")):(s.editExisting(y),t(4,u="free-polygon")):y.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"pointTool"in g&&t(1,o=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[i,o,s,a,u,to,f]}class $u extends W{constructor(e){super(),V(this,e,Mu,Eu,Y,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return to}get stop(){return this.$$.ctx[6]}}async function Lu(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:f}=await n.read();if(u)break;s.push(f),o+=f.length;const h=100*o/i;e.style=`background: linear-gradient(to right, red ${h}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function Cu(r){let e,t;return e=new eo({props:{routeTool:r[0]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Ou(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:H,i:H,o:H,d(t){t&&k(e),r[7](null)}}}function Ru(r){let e,t,n,i;const o=[Ou,Cu],s=[];function a(l,u){return l[0]?l[1]==rr?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=ge()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),i=!0},p(l,[u]){let f=e;e=a(l),e===f?~e&&s[e].p(l,u):(t&&(fe(),L(s[f],1,1,()=>{s[f]=null}),ce()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),M(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(M(t),i=!0)},o(l){L(t),i=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const rr="route";function Au(r,e,t){let n;ne(r,Ce,p=>t(8,n=p));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function f(){l==null||l.stop()}Lt(async()=>{await Wi(),console.log(`Grabbing ${s}`);try{const p=await Lu(s,a);t(0,l=new Va(n,p))}catch(p){console.log(`Route tool broke: ${p}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==rr&&o("edit-attribute")}),l.addEventListenerSuccessRoute(p=>{i==rr&&(ie.update(c=>(p.id=Wt(c),p.properties.intervention_type="route",c.features.push(p),c)),o("edit-attribute"),ke.set(p.id))})});function h(p){ue[p?"unshift":"push"](()=>{a=p,t(2,a)})}return r.$$set=p=>{"mode"in p&&t(1,i=p.mode),"changeMode"in p&&t(3,o=p.changeMode),"url"in p&&t(4,s=p.url),"routeTool"in p&&t(0,l=p.routeTool)},[l,i,a,o,s,u,f,h]}class Tu extends W{constructor(e){super(),V(this,e,Au,Ru,Y,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function ui(r){let e,t;return e=new Ki({props:{pointTool:r[1],editingExisting:!1}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function Fu(r){let e,t,n=r[0]==kn&&ui(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==kn?n?(n.p(i,o),o&1&&M(n,1)):(n=ui(i),n.c(),M(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||(M(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const kn="point";function Pu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==kn&&(ie.update(u=>(l.id=Wt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),ke.set(l.id))}),o.addEventListenerFailure(()=>{n==kn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class Iu extends W{constructor(e){super(),V(this,e,Pu,Fu,Y,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function fi(r){let e,t;return e=new Zi({props:{polygonTool:r[1]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function xu(r){let e,t,n=r[0]==Sn&&fi(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==Sn?n?(n.p(i,o),o&1&&M(n,1)):(n=fi(i),n.c(),M(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||(M(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const Sn="free-polygon";function Nu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Sn&&(ie.update(u=>(l.id=Wt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),ke.set(l.id))}),o.addEventListenerFailure(()=>{n==Sn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Bu extends W{constructor(e){super(),V(this,e,Nu,xu,Y,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ci(r){let e,t;return e=new Qi({props:{routeTool:r[1]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function ju(r){let e,t,n=r[0]==En&&ci(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==En?n?(n.p(i,o),o&1&&M(n,1)):(n=ci(i),n.c(),M(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||(M(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const En="snap-polygon";function Du(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==En&&(ie.update(u=>(l.id=Wt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),ke.set(l.id))}),o.addEventListenerFailure(()=>{n==En&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class Uu extends W{constructor(e){super(),V(this,e,Du,ju,Y,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function qu(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=We(r.slice(0,2),[n,t]),s=We(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Gu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return wo(r,function(s){Hu(s,o,n)}),r}function Hu(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function zu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Zn(r),n=Zn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Gu(e,{precision:7});switch(n){case"Point":return ir(r,i);case"MultiPoint":return pi(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return pi(r,Yi(r,i))}}function pi(r,e){var t=[],n=$t();return sr(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=ir(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=qu(ko(a)))}),n.load(Ze(t));else{var o=n.search(i);if(o.features.length){var s=no(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),_n(ir(s,i),function(a){t.push(a),n.insert(a)})}}}),Ze(t)}function ir(r,e){var t=[],n=Ge(r)[0],i=Ge(r)[r.geometry.coordinates.length-1];if(Dn(n,Qe(e))||Dn(i,Qe(e)))return Ze([r]);var o=$t(),s=Qn(r);o.load(s);var a=o.search(e);if(!a.features.length)return Ze([r]);var l=no(e,a),u=[n],f=So(s,function(h,p,c){var m=Ge(p)[1],g=Qe(e);return c===l.id?(h.push(g),t.push(Et(h)),Dn(g,m)?[g]:[g,m]):(h.push(m),h)},u);return f.length>1&&t.push(Et(f)),Ze(t)}function no(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return _n(e,function(i){var o=Xt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function Dn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Ju(r,e,t){var n=Ge(t);if(Zn(t)!=="LineString")throw new Error("line must be a LineString");var i=Xt(t,r),o=Xt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),Et(a,t.properties)}function di(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Yu(r){let e,t,n,i=r[0]==qt&&di();return{c(){i&&i.c(),e=ge()},m(o,s){i&&i.m(o,s),w(o,e,s),t||(n=G(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==qt?i||(i=di(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:H,o:H,d(o){i&&i.d(o),o&&k(e),t=!1,n()}}}const qt="split-route",Xu=10,Wu=30;let Un="split-route";function ro(){}function hi(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Vu(r,e,t){let n,i;ne(r,ie,g=>t(8,n=g)),ne(r,Ce,g=>t(6,i=g));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",f),i.on("click",h),nt(()=>{i.off("mousemove",f),i.off("click",h)}),Ye(i,Un,Ne()),we(i,{id:"draw-split-route",source:Un,...Ct("black",Xu,["case",["==",["get","snapped"],!0],1,.5])});function f(g){if(o!=qt)return;t(5,l=hi(g.lngLat.toArray(),!1)),u=null;const _=[g.point.x-Wu,g.point.y],y=i.unproject(g.point).distanceTo(i.unproject(_))/1e3;let d=[];for(let[b,v]of n.features.entries())if(v.geometry.type=="LineString"){let $=Xt(v.geometry,l,{units:"kilometers"});$.properties.dist!=null&&$.properties.dist<=y&&d.push([b,$.geometry.coordinates,$.properties.dist])}d.sort((b,v)=>b[2]-v[2]),d.length>0&&(t(5,l=hi(d[0][1],!0)),u=d[0][0])}function h(){if(o==qt)if(u==null)s("edit-attribute");else{let g=zu(n.features[u],l);if(g.features.length==2){let _=g.features[0],y=g.features[1];ie.update(d=>(_.id=d.features[u].id,y.id=Wt(d),_.properties=JSON.parse(JSON.stringify(d.features[u].properties)),y.properties=JSON.parse(JSON.stringify(_.properties)),p(d.features[u],_,y,l),d.features.splice(u,1,_,y),d))}a()}}function p(g,_,y,d){_.properties.length_meters=ln(_,{units:"kilometers"})*1e3,y.properties.length_meters=ln(y,{units:"kilometers"})*1e3,_.properties.waypoints=[],y.properties.waypoints=[];let b=c(g,d),v=!0,$=0;for(let O of g.properties.waypoints){let F=c(g,wt([O.lon,O.lat]));if(v)if(F<b)_.properties.waypoints.push(O);else{let A=O.snapped&&g.properties.waypoints[$-1].snapped;_.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:A}),v=!1,y.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:A}),y.properties.waypoints.push(O)}else y.properties.waypoints.push(O);$++}}function c(g,_){let y=g.geometry.coordinates[0],d=Ju(y,_,g);return ln(d,{units:"kilometers"})*1e3}function m(g){o==qt&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=Ne();l&&g.features.push(l),i.getSource(Un).setData(g)}},[o,m,s,ro,a,l,i]}class Ku extends W{constructor(e){super(),V(this,e,Vu,Yu,Y,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ro}get stop(){return this.$$.ctx[4]}}const Zu="/atip/layer_lanes/assets/edit_attributes-29b396e1.svg",Qu="/atip/layer_lanes/assets/edit_geometry-02dad294.svg",ef="/atip/layer_lanes/assets/point-276f4055.svg",tf="/atip/layer_lanes/assets/polygon_snapped-18efbbea.svg",nf="/atip/layer_lanes/assets/polygon_freehand-cf965967.svg",rf="/atip/layer_lanes/assets/route-d3c0ebad.svg",of="/atip/layer_lanes/assets/split_route-9e0ea2da.svg";function _i(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new $u({props:n}),r[15](e),{c(){x(e.$$.fragment)},m(i,o){N(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(M(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){r[15](null),B(e,i)}}}function mi(r){let e,t;return e=new it({props:{mode:r[3],thisMode:"point",label:"New point",icon:ef,changeMode:r[13]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function gi(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Uu({props:n}),r[18](e),{c(){x(e.$$.fragment)},m(i,o){N(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(M(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){r[18](null),B(e,i)}}}function bi(r){let e,t;return e=new it({props:{mode:r[3],thisMode:"route",label:"New route",icon:rf,changeMode:r[13]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function yi(r){let e,t;return e=new it({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:of,changeMode:r[13]}}),{c(){x(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||(M(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){B(e,n)}}}function sf(r){let e,t,n,i,o,s,a,l,u,f,h,p,c,m,g,_,y,d,b,v,$,O,F,A,j,T,D,ee,I,z,ae,Se;n=new it({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:Zu,changeMode:r[13]}});let Pe={mode:r[3],changeMode:r[13]};o=new ru({props:Pe}),r[14](o),l=new it({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:Qu,changeMode:r[13]}});let se=r[2]&&_i(r),oe=r[1]!="planning"&&mi(r),Be={mode:r[3],changeMode:r[13],pointTool:r[11]};c=new Iu({props:Be}),r[16](c),_=new it({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:nf,changeMode:r[13]}});let Le={mode:r[3],changeMode:r[13],polygonTool:r[12]};d=new Bu({props:Le}),r[17](d),$=new it({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:tf,changeMode:r[13]}});let te=r[2]&&gi(r),he=r[1]!="planning"&&bi(r);function Kt(q){r[20](q)}let be={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(be.routeTool=r[2]),T=new Tu({props:be}),r[19](T),ue.push(()=>Ee(T,"routeTool",Kt,r[2]));let P=r[1]!="planning"&&yi(r),re={mode:r[3],changeMode:r[13]};return ae=new Ku({props:re}),r[21](ae),{c(){e=E("div"),t=E("div"),x(n.$$.fragment),i=R(),x(o.$$.fragment),s=R(),a=E("div"),x(l.$$.fragment),u=R(),se&&se.c(),f=R(),h=E("div"),oe&&oe.c(),p=R(),x(c.$$.fragment),m=R(),g=E("div"),x(_.$$.fragment),y=R(),x(d.$$.fragment),b=R(),v=E("div"),x($.$$.fragment),O=R(),te&&te.c(),F=R(),A=E("div"),he&&he.c(),j=R(),x(T.$$.fragment),ee=R(),I=E("div"),P&&P.c(),z=R(),x(ae.$$.fragment),C(e,"class","toolbox svelte-4s4d3o")},m(q,de){w(q,e,de),S(e,t),N(n,t,null),S(t,i),N(o,t,null),S(e,s),S(e,a),N(l,a,null),S(a,u),se&&se.m(a,null),S(e,f),S(e,h),oe&&oe.m(h,null),S(h,p),N(c,h,null),S(e,m),S(e,g),N(_,g,null),S(g,y),N(d,g,null),S(e,b),S(e,v),N($,v,null),S(v,O),te&&te.m(v,null),S(e,F),S(e,A),he&&he.m(A,null),S(A,j),N(T,A,null),S(e,ee),S(e,I),P&&P.m(I,null),S(I,z),N(ae,I,null),Se=!0},p(q,[de]){const cr={};de&8&&(cr.mode=q[3]),n.$set(cr);const pr={};de&8&&(pr.mode=q[3]),o.$set(pr);const dr={};de&8&&(dr.mode=q[3]),l.$set(dr),q[2]?se?(se.p(q,de),de&4&&M(se,1)):(se=_i(q),se.c(),M(se,1),se.m(a,null)):se&&(fe(),L(se,1,1,()=>{se=null}),ce()),q[1]!="planning"?oe?(oe.p(q,de),de&2&&M(oe,1)):(oe=mi(q),oe.c(),M(oe,1),oe.m(h,p)):oe&&(fe(),L(oe,1,1,()=>{oe=null}),ce());const hr={};de&8&&(hr.mode=q[3]),c.$set(hr);const _r={};de&8&&(_r.mode=q[3]),_.$set(_r);const mr={};de&8&&(mr.mode=q[3]),d.$set(mr);const gr={};de&8&&(gr.mode=q[3]),$.$set(gr),q[2]?te?(te.p(q,de),de&4&&M(te,1)):(te=gi(q),te.c(),M(te,1),te.m(v,null)):te&&(fe(),L(te,1,1,()=>{te=null}),ce()),q[1]!="planning"?he?(he.p(q,de),de&2&&M(he,1)):(he=bi(q),he.c(),M(he,1),he.m(A,j)):he&&(fe(),L(he,1,1,()=>{he=null}),ce());const Zt={};de&8&&(Zt.mode=q[3]),de&1&&(Zt.url=q[0]),!D&&de&4&&(D=!0,Zt.routeTool=q[2],Me(()=>D=!1)),T.$set(Zt),q[1]!="planning"?P?(P.p(q,de),de&2&&M(P,1)):(P=yi(q),P.c(),M(P,1),P.m(I,z)):P&&(fe(),L(P,1,1,()=>{P=null}),ce());const br={};de&8&&(br.mode=q[3]),ae.$set(br)},i(q){Se||(M(n.$$.fragment,q),M(o.$$.fragment,q),M(l.$$.fragment,q),M(se),M(oe),M(c.$$.fragment,q),M(_.$$.fragment,q),M(d.$$.fragment,q),M($.$$.fragment,q),M(te),M(he),M(T.$$.fragment,q),M(P),M(ae.$$.fragment,q),Se=!0)},o(q){L(n.$$.fragment,q),L(o.$$.fragment,q),L(l.$$.fragment,q),L(se),L(oe),L(c.$$.fragment,q),L(_.$$.fragment,q),L(d.$$.fragment,q),L($.$$.fragment,q),L(te),L(he),L(T.$$.fragment,q),L(P),L(ae.$$.fragment,q),Se=!1},d(q){q&&k(e),B(n),r[14](null),B(o),B(l),se&&se.d(),oe&&oe.d(),r[16](null),B(c),B(_),r[17](null),B(d),B($),te&&te.d(),he&&he.d(),r[19](null),B(T),P&&P.d(),r[21](null),B(ae)}}}function lf(r,e,t){let n;ne(r,Ce,T=>t(22,n=T));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new Oa(n),l=new Ua(n),u="edit-attribute",f,h,p,c,m,g,_;function y(T){let D={"edit-attribute":f,"edit-geometry":h,route:p,point:c,"free-polygon":m,"snap-polygon":g,"split-route":_};if(u==T){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),D[u].stop(),t(3,u=T),console.log(`Starting new mode ${u}`),D[u].start()}nt(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function d(T){ue[T?"unshift":"push"](()=>{f=T,t(4,f)})}function b(T){ue[T?"unshift":"push"](()=>{h=T,t(5,h)})}function v(T){ue[T?"unshift":"push"](()=>{c=T,t(7,c)})}function $(T){ue[T?"unshift":"push"](()=>{m=T,t(8,m)})}function O(T){ue[T?"unshift":"push"](()=>{g=T,t(9,g)})}function F(T){ue[T?"unshift":"push"](()=>{p=T,t(6,p)})}function A(T){s=T,t(2,s)}function j(T){ue[T?"unshift":"push"](()=>{_=T,t(10,_)})}return r.$$set=T=>{"routeSnapperUrl"in T&&t(0,i=T.routeSnapperUrl),"schema"in T&&t(1,o=T.schema)},[i,o,s,u,f,h,p,c,m,g,_,a,l,y,d,b,v,$,O,F,A,j]}class af extends W{constructor(e){super(),V(this,e,lf,sf,Y,{routeSnapperUrl:0,schema:1})}}function uf(r){let e,t,n,i,o,s,a,l,u,f,h,p,c,m,g,_,y,d,b;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",i=R(),o=E("button"),o.textContent="About",s=R(),a=E("button"),a.textContent="Instructions",l=R(),u=E("br"),f=R(),h=E("label"),p=Q(`ATIP schema:
      `),c=E("select"),m=E("option"),m.textContent="v1",g=E("option"),g.textContent="v2",_=E("option"),_.textContent="Housing developments",y=E("option"),y.textContent="Critical issues",C(n,"type","button"),C(o,"type","button"),C(a,"type","button"),m.__value="v1",m.value=m.__value,g.__value="v2",g.value=g.__value,_.__value="planning",_.value=_.__value,y.__value="criticals",y.value=y.__value,r[2]===void 0&&st(()=>r[11].call(c)),C(e,"slot","nav")},m(v,$){w(v,e,$),S(e,t),S(t,n),S(t,i),S(t,o),S(t,s),S(t,a),S(e,l),S(e,u),S(e,f),S(e,h),S(h,p),S(h,c),S(c,m),S(c,g),S(c,_),S(c,y),et(c,r[2]),d||(b=[G(n,"click",r[10]),G(o,"click",r[7]),G(a,"click",r[8]),G(c,"change",r[11]),G(c,"change",r[9])],d=!0)},p(v,$){$&4&&et(c,v[2])},d(v){v&&k(e),d=!1,Te(b)}}}function ff(r){let e,t,n,i,o,s,a,l,u,f,h,p,c,m,g,_;return o=new da({props:{boundaryGeojson:r[4]}}),a=new ua({props:{authorityName:r[5],schema:r[2]}}),h=new Ql({props:{schema:r[2]}}),g=new ia({}),{c(){e=E("div"),t=E("h1"),n=Q(r[5]),i=R(),x(o.$$.fragment),s=R(),x(a.$$.fragment),l=R(),u=E("br"),f=R(),x(h.$$.fragment),p=R(),c=E("hr"),m=R(),x(g.$$.fragment),C(e,"slot","sidebar")},m(y,d){w(y,e,d),S(e,t),S(t,n),S(t,i),N(o,t,null),S(e,s),N(a,e,null),S(e,l),S(e,u),S(e,f),N(h,e,null),S(e,p),S(e,c),S(e,m),N(g,e,null),_=!0},p(y,d){const b={};d&16&&(b.boundaryGeojson=y[4]),o.$set(b);const v={};d&4&&(v.schema=y[2]),a.$set(v);const $={};d&4&&($.schema=y[2]),h.$set($)},i(y){_||(M(o.$$.fragment,y),M(a.$$.fragment,y),M(h.$$.fragment,y),M(g.$$.fragment,y),_=!0)},o(y){L(o.$$.fragment,y),L(a.$$.fragment,y),L(h.$$.fragment,y),L(g.$$.fragment,y),_=!1},d(y){y&&k(e),B(o),B(a),B(h),B(g)}}}function cf(r){let e,t,n,i,o,s,a,l,u,f,h,p;return e=new Fs({props:{boundaryGeojson:r[4]}}),n=new $a({props:{schema:r[2]}}),o=new Ca({}),a=new af({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new ma({props:{style:r[6]}}),h=new Ea({props:{schema:r[2]}}),{c(){x(e.$$.fragment),t=R(),x(n.$$.fragment),i=R(),x(o.$$.fragment),s=R(),x(a.$$.fragment),l=R(),x(u.$$.fragment),f=R(),x(h.$$.fragment)},m(c,m){N(e,c,m),w(c,t,m),N(n,c,m),w(c,i,m),N(o,c,m),w(c,s,m),N(a,c,m),w(c,l,m),N(u,c,m),w(c,f,m),N(h,c,m),p=!0},p(c,m){const g={};m&16&&(g.boundaryGeojson=c[4]),e.$set(g);const _={};m&4&&(_.schema=c[2]),n.$set(_);const y={};m&8&&(y.routeSnapperUrl=c[3]),m&4&&(y.schema=c[2]),a.$set(y);const d={};m&4&&(d.schema=c[2]),h.$set(d)},i(c){p||(M(e.$$.fragment,c),M(n.$$.fragment,c),M(o.$$.fragment,c),M(a.$$.fragment,c),M(u.$$.fragment,c),M(h.$$.fragment,c),p=!0)},o(c){L(e.$$.fragment,c),L(n.$$.fragment,c),L(o.$$.fragment,c),L(a.$$.fragment,c),L(u.$$.fragment,c),L(h.$$.fragment,c),p=!1},d(c){B(e,c),c&&k(t),B(n,c),c&&k(i),B(o,c),c&&k(s),B(a,c),c&&k(l),B(u,c),c&&k(f),B(h,c)}}}function pf(r){let e,t,n;return t=new es({props:{style:r[6],$$slots:{default:[cf]},$$scope:{ctx:r}}}),{c(){e=E("div"),x(t.$$.fragment),C(e,"slot","main")},m(i,o){w(i,e,o),N(t,e,null),n=!0},p(i,o){const s={};o&524316&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(M(t.$$.fragment,i),n=!0)},o(i){L(t.$$.fragment,i),n=!1},d(i){i&&k(e),B(t)}}}function df(r){let e,t,n,i,o,s,a,l;e=new ss({props:{$$slots:{main:[pf],sidebar:[ff],nav:[uf]},$$scope:{ctx:r}}});function u(c){r[12](c)}let f={};r[0]!==void 0&&(f.open=r[0]),n=new Eo({props:f}),ue.push(()=>Ee(n,"open",u,r[0]));function h(c){r[13](c)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new Ko({props:p}),ue.push(()=>Ee(s,"open",h,r[1])),{c(){x(e.$$.fragment),t=R(),x(n.$$.fragment),o=R(),x(s.$$.fragment)},m(c,m){N(e,c,m),w(c,t,m),N(n,c,m),w(c,o,m),N(s,c,m),l=!0},p(c,[m]){const g={};m&524316&&(g.$$scope={dirty:m,ctx:c}),e.$set(g);const _={};!i&&m&1&&(i=!0,_.open=c[0],Me(()=>i=!1)),n.$set(_);const y={};!a&&m&2&&(a=!0,y.open=c[1],Me(()=>a=!1)),s.$set(y)},i(c){l||(M(e.$$.fragment,c),M(n.$$.fragment,c),M(s.$$.fragment,c),l=!0)},o(c){L(e.$$.fragment,c),L(n.$$.fragment,c),L(s.$$.fragment,c),l=!1},d(c){B(e,c),c&&k(t),B(n,c),c&&k(o),B(s,c)}}}function hf(r,e,t){let n;ne(r,Gt,O=>t(15,n=O));let i=!1,o=!1,s=window.location.hostname.includes("atip.uk");const a=new URLSearchParams(window.location.search);let l=a.get("authority"),u=a.get("style")||"streets",f=a.get("schema")||"v1";var h=`https://atip.uk/route-snappers/${l}.bin`,p=`https://atip.uk/route-info/${l}.bin`;s||(h=`https://atip.uk/route-snappers-dev/${l}.bin`,p=`https://atip.uk/route-info-dev/${l}.bin`);function c(){t(0,i=!i),t(1,o=!1)}function m(){t(1,o=!o),t(0,i=!1)}let g;Lt(async()=>{t(4,g=await _());const O=$i(new Bo);Gt.set(await new O),await n.loadFile(p)});async function _(){const F=await(await fetch(Mo)).text(),A=JSON.parse(F);return A.features=A.features.filter(j=>{var T;return((T=j.properties)==null?void 0:T.name)==l}),A}function y(){let O=new URLSearchParams(window.location.search);O.set("schema",f);let F=`${window.location.pathname}?${O.toString()}${window.location.hash}`;window.location.href=F}const d=()=>window.open("index.html");function b(){f=$n(this),t(2,f)}function v(O){i=O,t(0,i)}function $(O){o=O,t(1,o)}return[i,o,f,h,g,l,u,c,m,y,d,b,v,$]}class _f extends W{constructor(e){super(),V(this,e,hf,df,Y,{})}}new _f({target:document.getElementById("app")});
