var os=Object.defineProperty;var ss=(n,e,r)=>e in n?os(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var ne=(n,e,r)=>(ss(n,typeof e!="symbol"?e+"":e,r),r);import{S as Q,i as x,s as V,f as ue,j as P,o as L,t as k,p as E,u as C,Q as Rr,T as Nr,U as Or,V as Ir,W as ls,X as xi,Y as as,Z as eo,_ as us,$ as fs,a0 as Ze,a1 as le,c as $,y as te,q as re,d as w,v as X,a2 as Be,a3 as Te,n as H,a as O,a4 as cs,O as st,a5 as _n,a6 as vn,a7 as ps,a8 as hs,a9 as ds,aa as fe,ab as ce,ac as pe,e as j,m as G,ad as St,x as T,D as me,g as ye,h as Me,b as Y,r as Le,P as ms,ae as Ve,af as Ce,ag as dr,k as ie,ah as qt,w as Xe,ai as W,aj as sr,ak as Dt,al as dt,am as mr,an as _t,ao as lr,ap as Rn,aq as Re,ar as Wr,as as gs,at as _s,au as Fe,av as gr,aw as Nn,ax as rt,ay as to,az as Kt,R as vs,aA as at,C as ro,aB as bs,J as ys,N as $s,E as Wt,aC as _r,aD as On,aE as In,aF as vr,aG as bn,L as no,F as ws,aH as ks,aI as Ss,aJ as Es,aK as Br,aL as Bn,z as Ms,A as Ps,aM as Ls}from"./files-0e5d83f7.js";import{M as Hr,b as io,e as Et,R as Cs,i as mt,a as Yt,c as Xt,C as Mt,d as As,f as Nt,S as Fs,g as Rs,W as Ns,B as Os,G as Is}from"./RasterLayer-a07f3b90.js";import{m as Ie,l as Z,C as oo,a as Zr,S as Bs,H as js}from"./colors-593d518e.js";import{g as so,u as Ds,r as Gs,b as Ts,c as Us,F as Ht,m as zs,d as qs,i as Ys,e as Xs,G as gt,D as Qe,a as Pt,P as yn,f as Js,M as Ks,A as Ws,L as Hs}from"./MapLibreMap-4e5a1e21.js";import{A as Zs}from"./About-8232049b.js";import{T as Vs,B as ut,b as Qs,W as jr,c as We}from"./config-53d2c231.js";function xs(n){let e;const r=n[1].default,t=Rr(r,n,n[3],null);return{c(){t&&t.c()},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&8)&&Nr(t,r,o,o[3],e?Ir(r,o[3],i,null):Or(o[3]),null)},i(o){e||(k(t,o),e=!0)},o(o){E(t,o),e=!1},d(o){t&&t.d(o)}}}function el(n){let e,r;return e=new ue({props:{style:"margin-bottom: 0px",disabled:n[0],$$slots:{default:[xs]},$$scope:{ctx:n}}}),e.$on("click",n[2]),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,[o]){const i={};o&1&&(i.disabled=t[0]),o&8&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function tl(n,e,r){let{$$slots:t={},$$scope:o}=e,{disabled:i=!1}=e;function s(l){ls.call(this,n,l)}return n.$$set=l=>{"disabled"in l&&r(0,i=l.disabled),"$$scope"in l&&r(3,o=l.$$scope)},[i,t,s,o]}class ct extends Q{constructor(e){super(),x(this,e,tl,el,V,{disabled:0})}}class rl{constructor(e){ne(this,"map");ne(this,"active");ne(this,"eventListenersSuccess");ne(this,"eventListenersFailure");ne(this,"cursor");ne(this,"onMouseMove",e=>{this.active&&(this.cursor={type:"Feature",properties:{},geometry:{type:"Point",coordinates:xi(e.lngLat.toArray())}})});ne(this,"onClick",()=>{if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}});ne(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),document.removeEventListener("keydown",this.onKeyDown)}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersFailure=[]}start(){this.map.getCanvas().style.cursor="crosshair",this.active=!0}stop(){this.map.getCanvas().style.cursor="inherit",this.cursor=null,this.active=!1}}function nl(n){var e=n%(2*Math.PI);return e*180/Math.PI}function xt(n){var e=n%360;return e*Math.PI/180}function ot(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ue(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Vr(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function lo(n,e,r){if(r===void 0&&(r={}),r.final===!0)return il(n,e);var t=ot(n),o=ot(e),i=xt(t[0]),s=xt(o[0]),l=xt(t[1]),a=xt(o[1]),u=Math.sin(s-i)*Math.cos(a),c=Math.cos(l)*Math.sin(a)-Math.sin(l)*Math.cos(a)*Math.cos(s-i);return nl(Math.atan2(u,c))}function il(n,e){var r=lo(e,n);return r=(r+180)%360,r}var Se=63710088e-1,ol={centimeters:Se*100,centimetres:Se*100,degrees:Se/111325,feet:Se*3.28084,inches:Se*39.37,kilometers:Se/1e3,kilometres:Se/1e3,meters:Se,metres:Se,miles:Se/1609.344,millimeters:Se*1e3,millimetres:Se*1e3,nauticalmiles:Se/1852,radians:1,yards:Se*1.0936};function sl(n,e){e===void 0&&(e="kilometers");var r=ol[e];if(!r)throw new Error(e+" units is invalid");return n*r}function er(n){var e=n%360;return e*Math.PI/180}function et(n,e,r){r===void 0&&(r={});var t=ot(n),o=ot(e),i=er(o[1]-t[1]),s=er(o[0]-t[0]),l=er(t[1]),a=er(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(a);return sl(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),r.units)}var Ee=63710088e-1,ll={centimeters:Ee*100,centimetres:Ee*100,degrees:Ee/111325,feet:Ee*3.28084,inches:Ee*39.37,kilometers:Ee/1e3,kilometres:Ee/1e3,meters:Ee,metres:Ee,miles:Ee/1609.344,millimeters:Ee*1e3,millimetres:Ee*1e3,nauticalmiles:Ee/1852,radians:1,yards:Ee*1.0936};function al(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function ul(n,e,r){if(r===void 0&&(r={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Dn(n[0])||!Dn(n[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:n};return al(t,e,r)}function fl(n,e){e===void 0&&(e="kilometers");var r=ll[e];if(!r)throw new Error(e+" units is invalid");return n/r}function jn(n){var e=n%(2*Math.PI);return e*180/Math.PI}function Tr(n){var e=n%360;return e*Math.PI/180}function Dn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Gn(n,e,r,t){t===void 0&&(t={});var o=ot(n),i=Tr(o[0]),s=Tr(o[1]),l=Tr(r),a=fl(e,t.units),u=Math.asin(Math.sin(s)*Math.cos(a)+Math.cos(s)*Math.sin(a)*Math.cos(l)),c=i+Math.atan2(Math.sin(l)*Math.sin(a)*Math.cos(s),Math.cos(a)-Math.sin(s)*Math.sin(u)),f=jn(c),d=jn(u);return ul([f,d],t.properties)}function Qr(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function cl(n,e,r){if(r===void 0&&(r={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Un(n[0])||!Un(n[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:n};return Qr(t,e,r)}function Tn(n,e){e===void 0&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=n,r}function Un(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function pl(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function hl(n,e,r){if(r===void 0&&(r={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:n};return pl(t,e,r)}function dl(n,e){e===void 0&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=n,r}function br(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function yt(n,e,r){if(r===void 0&&(r={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!zn(n[0])||!zn(n[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:n};return br(t,e,r)}function kt(n,e,r){if(r===void 0&&(r={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:n};return br(t,e,r)}function zn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function ao(n){return!!n&&n.constructor===Object}function vt(n,e,r){if(n!==null)for(var t,o,i,s,l,a,u,c=0,f=0,d,p=n.type,m=p==="FeatureCollection",_=p==="Feature",v=m?n.features.length:1,y=0;y<v;y++){u=m?n.features[y].geometry:_?n.geometry:n,d=u?u.type==="GeometryCollection":!1,l=d?u.geometries.length:1;for(var h=0;h<l;h++){var g=0,S=0;if(s=d?u.geometries[h]:u,s!==null){a=s.coordinates;var b=s.type;switch(c=r&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(a,f,y,g,S)===!1)return!1;f++,g++;break;case"LineString":case"MultiPoint":for(t=0;t<a.length;t++){if(e(a[t],f,y,g,S)===!1)return!1;f++,b==="MultiPoint"&&g++}b==="LineString"&&g++;break;case"Polygon":case"MultiLineString":for(t=0;t<a.length;t++){for(o=0;o<a[t].length-c;o++){if(e(a[t][o],f,y,g,S)===!1)return!1;f++}b==="MultiLineString"&&g++,b==="Polygon"&&S++}b==="Polygon"&&g++;break;case"MultiPolygon":for(t=0;t<a.length;t++){for(S=0,o=0;o<a[t].length;o++){for(i=0;i<a[t][o].length-c;i++){if(e(a[t][o][i],f,y,g,S)===!1)return!1;f++}S++}g++}break;case"GeometryCollection":for(t=0;t<s.geometries.length;t++)if(vt(s.geometries[t],e,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ml(n,e,r,t){var o=r;return vt(n,function(i,s,l,a,u){s===0&&r===void 0?o=i:o=e(o,i,s,l,a,u)},t),o}function uo(n,e){var r;switch(n.type){case"FeatureCollection":for(r=0;r<n.features.length&&e(n.features[r].properties,r)!==!1;r++);break;case"Feature":e(n.properties,0);break}}function gl(n,e,r){var t=r;return uo(n,function(o,i){i===0&&r===void 0?t=o:t=e(t,o,i)}),t}function Lt(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var r=0;r<n.features.length&&e(n.features[r],r)!==!1;r++);}function fo(n,e,r){var t=r;return Lt(n,function(o,i){i===0&&r===void 0?t=o:t=e(t,o,i)}),t}function _l(n){var e=[];return vt(n,function(r){e.push(r)}),e}function $n(n,e){var r,t,o,i,s,l,a,u,c,f,d=0,p=n.type==="FeatureCollection",m=n.type==="Feature",_=p?n.features.length:1;for(r=0;r<_;r++){for(l=p?n.features[r].geometry:m?n.geometry:n,u=p?n.features[r].properties:m?n.properties:{},c=p?n.features[r].bbox:m?n.bbox:void 0,f=p?n.features[r].id:m?n.id:void 0,a=l?l.type==="GeometryCollection":!1,s=a?l.geometries.length:1,o=0;o<s;o++){if(i=a?l.geometries[o]:l,i===null){if(e(null,d,u,c,f)===!1)return!1;continue}switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(i,d,u,c,f)===!1)return!1;break}case"GeometryCollection":{for(t=0;t<i.geometries.length;t++)if(e(i.geometries[t],d,u,c,f)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}d++}}function vl(n,e,r){var t=r;return $n(n,function(o,i,s,l,a){i===0&&r===void 0?t=o:t=e(t,o,i,s,l,a)}),t}function bt(n,e){$n(n,function(r,t,o,i,s){var l=r===null?null:r.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(br(r,o,{bbox:i,id:s}),t,0)===!1?!1:void 0}var a;switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<r.coordinates.length;u++){var c=r.coordinates[u],f={type:a,coordinates:c};if(e(br(f,o),t,u)===!1)return!1}})}function bl(n,e,r){var t=r;return bt(n,function(o,i,s){i===0&&s===0&&r===void 0?t=o:t=e(t,o,i,s)}),t}function co(n,e){bt(n,function(r,t,o){var i=0;if(r.geometry){var s=r.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,a=0,u=0,c=0;if(vt(r,function(f,d,p,m,_){if(l===void 0||t>a||m>u||_>c){l=f,a=t,u=m,c=_,i=0;return}var v=kt([l,f],r.properties);if(e(v,t,o,_,i)===!1)return!1;i++,l=f})===!1)return!1}}})}function po(n,e,r){var t=r,o=!1;return co(n,function(i,s,l,a,u){o===!1&&r===void 0?t=i:t=e(t,i,s,l,a,u),o=!0}),t}function ho(n,e){if(!n)throw new Error("geojson is required");bt(n,function(r,t,o){if(r.geometry!==null){var i=r.geometry.type,s=r.geometry.coordinates;switch(i){case"LineString":if(e(r,t,o,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(e(kt(s[l],r.properties),t,o,l)===!1)return!1;break}}})}function yl(n,e,r){var t=r;return ho(n,function(o,i,s,l){i===0&&r===void 0?t=o:t=e(t,o,i,s,l)}),t}function $l(n,e){if(e=e||{},!ao(e))throw new Error("options is invalid");var r=e.featureIndex||0,t=e.multiFeatureIndex||0,o=e.geometryIndex||0,i=e.segmentIndex||0,s=e.properties,l;switch(n.type){case"FeatureCollection":r<0&&(r=n.features.length+r),s=s||n.features[r].properties,l=n.features[r].geometry;break;case"Feature":s=s||n.properties,l=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=n;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var a=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return i<0&&(i=a.length+i-1),kt([a[i],a[i+1]],s,e);case"Polygon":return o<0&&(o=a.length+o),i<0&&(i=a[o].length+i-1),kt([a[o][i],a[o][i+1]],s,e);case"MultiLineString":return t<0&&(t=a.length+t),i<0&&(i=a[t].length+i-1),kt([a[t][i],a[t][i+1]],s,e);case"MultiPolygon":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),i<0&&(i=a[t][o].length-i-1),kt([a[t][o][i],a[t][o][i+1]],s,e)}throw new Error("geojson is invalid")}function wl(n,e){if(e=e||{},!ao(e))throw new Error("options is invalid");var r=e.featureIndex||0,t=e.multiFeatureIndex||0,o=e.geometryIndex||0,i=e.coordIndex||0,s=e.properties,l;switch(n.type){case"FeatureCollection":r<0&&(r=n.features.length+r),s=s||n.features[r].properties,l=n.features[r].geometry;break;case"Feature":s=s||n.properties,l=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=n;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var a=l.coordinates;switch(l.type){case"Point":return yt(a,s,e);case"MultiPoint":return t<0&&(t=a.length+t),yt(a[t],s,e);case"LineString":return i<0&&(i=a.length+i),yt(a[i],s,e);case"Polygon":return o<0&&(o=a.length+o),i<0&&(i=a[o].length+i),yt(a[o][i],s,e);case"MultiLineString":return t<0&&(t=a.length+t),i<0&&(i=a[t].length+i),yt(a[t][i],s,e);case"MultiPolygon":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),i<0&&(i=a[t][o].length-i),yt(a[t][o][i],s,e)}throw new Error("geojson is invalid")}const kl=Object.freeze(Object.defineProperty({__proto__:null,coordAll:_l,coordEach:vt,coordReduce:ml,featureEach:Lt,featureReduce:fo,findPoint:wl,findSegment:$l,flattenEach:bt,flattenReduce:bl,geomEach:$n,geomReduce:vl,lineEach:ho,lineReduce:yl,propEach:uo,propReduce:gl,segmentEach:co,segmentReduce:po},Symbol.toStringTag,{value:"Module"}));function xr(n){if(!n)throw new Error("geojson is required");var e=[];return bt(n,function(r){Sl(r,e)}),dl(e)}function Sl(n,e){var r=[],t=n.geometry;if(t!==null){switch(t.type){case"Polygon":r=Ue(t);break;case"LineString":r=[Ue(t)]}r.forEach(function(o){var i=El(o,n.properties);i.forEach(function(s){s.id=e.length,e.push(s)})})}}function El(n,e){var r=[];return n.reduce(function(t,o){var i=hl([t,o],e);return i.bbox=Ml(t,o),r.push(i),o}),r}function Ml(n,e){var r=n[0],t=n[1],o=e[0],i=e[1],s=r<o?r:o,l=t<i?t:i,a=r>o?r:o,u=t>i?t:i;return[s,l,a,u]}var wn={exports:{}},mo={exports:{}};(function(n,e){(function(r,t){n.exports=t()})(as,function(){function r(h,g,S,b,A){(function F(B,D,I,M,N){for(;M>I;){if(M-I>600){var R=M-I+1,U=D-I+1,se=Math.log(R),oe=.5*Math.exp(2*se/3),de=.5*Math.sqrt(se*oe*(R-oe)/R)*(U-R/2<0?-1:1),Pe=Math.max(I,Math.floor(D-U*oe/R+de)),At=Math.min(M,Math.floor(D+(R-U)*oe/R+de));F(B,D,Pe,At,N)}var xe=B[D],Je=I,ge=M;for(t(B,I,D),N(B[M],xe)>0&&t(B,I,M);Je<ge;){for(t(B,Je,ge),Je++,ge--;N(B[Je],xe)<0;)Je++;for(;N(B[ge],xe)>0;)ge--}N(B[I],xe)===0?t(B,I,ge):t(B,++ge,M),ge<=D&&(I=ge+1),D<=ge&&(M=ge-1)}})(h,g,S||0,b||h.length-1,A||o)}function t(h,g,S){var b=h[g];h[g]=h[S],h[S]=b}function o(h,g){return h<g?-1:h>g?1:0}var i=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(h,g,S){if(!S)return g.indexOf(h);for(var b=0;b<g.length;b++)if(S(h,g[b]))return b;return-1}function l(h,g){a(h,0,h.children.length,g,h)}function a(h,g,S,b,A){A||(A=v(null)),A.minX=1/0,A.minY=1/0,A.maxX=-1/0,A.maxY=-1/0;for(var F=g;F<S;F++){var B=h.children[F];u(A,h.leaf?b(B):B)}return A}function u(h,g){return h.minX=Math.min(h.minX,g.minX),h.minY=Math.min(h.minY,g.minY),h.maxX=Math.max(h.maxX,g.maxX),h.maxY=Math.max(h.maxY,g.maxY),h}function c(h,g){return h.minX-g.minX}function f(h,g){return h.minY-g.minY}function d(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function p(h){return h.maxX-h.minX+(h.maxY-h.minY)}function m(h,g){return h.minX<=g.minX&&h.minY<=g.minY&&g.maxX<=h.maxX&&g.maxY<=h.maxY}function _(h,g){return g.minX<=h.maxX&&g.minY<=h.maxY&&g.maxX>=h.minX&&g.maxY>=h.minY}function v(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(h,g,S,b,A){for(var F=[g,S];F.length;)if(!((S=F.pop())-(g=F.pop())<=b)){var B=g+Math.ceil((S-g)/b/2)*b;r(h,B,g,S,A),F.push(g,B,B,S)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(h){var g=this.data,S=[];if(!_(h,g))return S;for(var b=this.toBBox,A=[];g;){for(var F=0;F<g.children.length;F++){var B=g.children[F],D=g.leaf?b(B):B;_(h,D)&&(g.leaf?S.push(B):m(h,D)?this._all(B,S):A.push(B))}g=A.pop()}return S},i.prototype.collides=function(h){var g=this.data;if(!_(h,g))return!1;for(var S=[];g;){for(var b=0;b<g.children.length;b++){var A=g.children[b],F=g.leaf?this.toBBox(A):A;if(_(h,F)){if(g.leaf||m(h,F))return!0;S.push(A)}}g=S.pop()}return!1},i.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var g=0;g<h.length;g++)this.insert(h[g]);return this}var S=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===S.height)this._splitRoot(this.data,S);else{if(this.data.height<S.height){var b=this.data;this.data=S,S=b}this._insert(S,this.data.height-S.height-1,!0)}else this.data=S;return this},i.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},i.prototype.clear=function(){return this.data=v([]),this},i.prototype.remove=function(h,g){if(!h)return this;for(var S,b,A,F=this.data,B=this.toBBox(h),D=[],I=[];F||D.length;){if(F||(F=D.pop(),b=D[D.length-1],S=I.pop(),A=!0),F.leaf){var M=s(h,F.children,g);if(M!==-1)return F.children.splice(M,1),D.push(F),this._condense(D),this}A||F.leaf||!m(F,B)?b?(S++,F=b.children[S],A=!1):F=null:(D.push(F),I.push(S),S=0,b=F,F=F.children[0])}return this},i.prototype.toBBox=function(h){return h},i.prototype.compareMinX=function(h,g){return h.minX-g.minX},i.prototype.compareMinY=function(h,g){return h.minY-g.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(h){return this.data=h,this},i.prototype._all=function(h,g){for(var S=[];h;)h.leaf?g.push.apply(g,h.children):S.push.apply(S,h.children),h=S.pop();return g},i.prototype._build=function(h,g,S,b){var A,F=S-g+1,B=this._maxEntries;if(F<=B)return l(A=v(h.slice(g,S+1)),this.toBBox),A;b||(b=Math.ceil(Math.log(F)/Math.log(B)),B=Math.ceil(F/Math.pow(B,b-1))),(A=v([])).leaf=!1,A.height=b;var D=Math.ceil(F/B),I=D*Math.ceil(Math.sqrt(B));y(h,g,S,I,this.compareMinX);for(var M=g;M<=S;M+=I){var N=Math.min(M+I-1,S);y(h,M,N,D,this.compareMinY);for(var R=M;R<=N;R+=D){var U=Math.min(R+D-1,N);A.children.push(this._build(h,R,U,b-1))}}return l(A,this.toBBox),A},i.prototype._chooseSubtree=function(h,g,S,b){for(;b.push(g),!g.leaf&&b.length-1!==S;){for(var A=1/0,F=1/0,B=void 0,D=0;D<g.children.length;D++){var I=g.children[D],M=d(I),N=(R=h,U=I,(Math.max(U.maxX,R.maxX)-Math.min(U.minX,R.minX))*(Math.max(U.maxY,R.maxY)-Math.min(U.minY,R.minY))-M);N<F?(F=N,A=M<A?M:A,B=I):N===F&&M<A&&(A=M,B=I)}g=B||g.children[0]}var R,U;return g},i.prototype._insert=function(h,g,S){var b=S?h:this.toBBox(h),A=[],F=this._chooseSubtree(b,this.data,g,A);for(F.children.push(h),u(F,b);g>=0&&A[g].children.length>this._maxEntries;)this._split(A,g),g--;this._adjustParentBBoxes(b,A,g)},i.prototype._split=function(h,g){var S=h[g],b=S.children.length,A=this._minEntries;this._chooseSplitAxis(S,A,b);var F=this._chooseSplitIndex(S,A,b),B=v(S.children.splice(F,S.children.length-F));B.height=S.height,B.leaf=S.leaf,l(S,this.toBBox),l(B,this.toBBox),g?h[g-1].children.push(B):this._splitRoot(S,B)},i.prototype._splitRoot=function(h,g){this.data=v([h,g]),this.data.height=h.height+1,this.data.leaf=!1,l(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(h,g,S){for(var b,A,F,B,D,I,M,N=1/0,R=1/0,U=g;U<=S-g;U++){var se=a(h,0,U,this.toBBox),oe=a(h,U,S,this.toBBox),de=(A=se,F=oe,B=void 0,D=void 0,I=void 0,M=void 0,B=Math.max(A.minX,F.minX),D=Math.max(A.minY,F.minY),I=Math.min(A.maxX,F.maxX),M=Math.min(A.maxY,F.maxY),Math.max(0,I-B)*Math.max(0,M-D)),Pe=d(se)+d(oe);de<N?(N=de,b=U,R=Pe<R?Pe:R):de===N&&Pe<R&&(R=Pe,b=U)}return b||S-g},i.prototype._chooseSplitAxis=function(h,g,S){var b=h.leaf?this.compareMinX:c,A=h.leaf?this.compareMinY:f;this._allDistMargin(h,g,S,b)<this._allDistMargin(h,g,S,A)&&h.children.sort(b)},i.prototype._allDistMargin=function(h,g,S,b){h.children.sort(b);for(var A=this.toBBox,F=a(h,0,g,A),B=a(h,S-g,S,A),D=p(F)+p(B),I=g;I<S-g;I++){var M=h.children[I];u(F,h.leaf?A(M):M),D+=p(F)}for(var N=S-g-1;N>=g;N--){var R=h.children[N];u(B,h.leaf?A(R):R),D+=p(B)}return D},i.prototype._adjustParentBBoxes=function(h,g,S){for(var b=S;b>=0;b--)u(g[b],h)},i.prototype._condense=function(h){for(var g=h.length-1,S=void 0;g>=0;g--)h[g].children.length===0?g>0?(S=h[g-1].children).splice(S.indexOf(h[g]),1):this.clear():l(h[g],this.toBBox)},i})})(mo);var Pl=mo.exports,go={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.earthRadius=63710088e-1,n.factors={centimeters:n.earthRadius*100,centimetres:n.earthRadius*100,degrees:n.earthRadius/111325,feet:n.earthRadius*3.28084,inches:n.earthRadius*39.37,kilometers:n.earthRadius/1e3,kilometres:n.earthRadius/1e3,meters:n.earthRadius,metres:n.earthRadius,miles:n.earthRadius/1609.344,millimeters:n.earthRadius*1e3,millimetres:n.earthRadius*1e3,nauticalmiles:n.earthRadius/1852,radians:1,yards:n.earthRadius*1.0936},n.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/n.earthRadius,yards:1.0936133},n.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function e(M,N,R){R===void 0&&(R={});var U={type:"Feature"};return(R.id===0||R.id)&&(U.id=R.id),R.bbox&&(U.bbox=R.bbox),U.properties=N||{},U.geometry=M,U}n.feature=e;function r(M,N,R){switch(M){case"Point":return t(N).geometry;case"LineString":return l(N).geometry;case"Polygon":return i(N).geometry;case"MultiPoint":return f(N).geometry;case"MultiLineString":return c(N).geometry;case"MultiPolygon":return d(N).geometry;default:throw new Error(M+" is invalid")}}n.geometry=r;function t(M,N,R){if(R===void 0&&(R={}),!M)throw new Error("coordinates is required");if(!Array.isArray(M))throw new Error("coordinates must be an Array");if(M.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!F(M[0])||!F(M[1]))throw new Error("coordinates must contain numbers");var U={type:"Point",coordinates:M};return e(U,N,R)}n.point=t;function o(M,N,R){return R===void 0&&(R={}),u(M.map(function(U){return t(U,N)}),R)}n.points=o;function i(M,N,R){R===void 0&&(R={});for(var U=0,se=M;U<se.length;U++){var oe=se[U];if(oe.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var de=0;de<oe[oe.length-1].length;de++)if(oe[oe.length-1][de]!==oe[0][de])throw new Error("First and last Position are not equivalent.")}var Pe={type:"Polygon",coordinates:M};return e(Pe,N,R)}n.polygon=i;function s(M,N,R){return R===void 0&&(R={}),u(M.map(function(U){return i(U,N)}),R)}n.polygons=s;function l(M,N,R){if(R===void 0&&(R={}),M.length<2)throw new Error("coordinates must be an array of two or more positions");var U={type:"LineString",coordinates:M};return e(U,N,R)}n.lineString=l;function a(M,N,R){return R===void 0&&(R={}),u(M.map(function(U){return l(U,N)}),R)}n.lineStrings=a;function u(M,N){N===void 0&&(N={});var R={type:"FeatureCollection"};return N.id&&(R.id=N.id),N.bbox&&(R.bbox=N.bbox),R.features=M,R}n.featureCollection=u;function c(M,N,R){R===void 0&&(R={});var U={type:"MultiLineString",coordinates:M};return e(U,N,R)}n.multiLineString=c;function f(M,N,R){R===void 0&&(R={});var U={type:"MultiPoint",coordinates:M};return e(U,N,R)}n.multiPoint=f;function d(M,N,R){R===void 0&&(R={});var U={type:"MultiPolygon",coordinates:M};return e(U,N,R)}n.multiPolygon=d;function p(M,N,R){R===void 0&&(R={});var U={type:"GeometryCollection",geometries:M};return e(U,N,R)}n.geometryCollection=p;function m(M,N){if(N===void 0&&(N=0),N&&!(N>=0))throw new Error("precision must be a positive number");var R=Math.pow(10,N||0);return Math.round(M*R)/R}n.round=m;function _(M,N){N===void 0&&(N="kilometers");var R=n.factors[N];if(!R)throw new Error(N+" units is invalid");return M*R}n.radiansToLength=_;function v(M,N){N===void 0&&(N="kilometers");var R=n.factors[N];if(!R)throw new Error(N+" units is invalid");return M/R}n.lengthToRadians=v;function y(M,N){return g(v(M,N))}n.lengthToDegrees=y;function h(M){var N=M%360;return N<0&&(N+=360),N}n.bearingToAzimuth=h;function g(M){var N=M%(2*Math.PI);return N*180/Math.PI}n.radiansToDegrees=g;function S(M){var N=M%360;return N*Math.PI/180}n.degreesToRadians=S;function b(M,N,R){if(N===void 0&&(N="kilometers"),R===void 0&&(R="kilometers"),!(M>=0))throw new Error("length must be a positive number");return _(v(M,N),R)}n.convertLength=b;function A(M,N,R){if(N===void 0&&(N="meters"),R===void 0&&(R="kilometers"),!(M>=0))throw new Error("area must be a positive number");var U=n.areaFactors[N];if(!U)throw new Error("invalid original units");var se=n.areaFactors[R];if(!se)throw new Error("invalid final units");return M/U*se}n.convertArea=A;function F(M){return!isNaN(M)&&M!==null&&!Array.isArray(M)}n.isNumber=F;function B(M){return!!M&&M.constructor===Object}n.isObject=B;function D(M){if(!M)throw new Error("bbox is required");if(!Array.isArray(M))throw new Error("bbox must be an Array");if(M.length!==4&&M.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");M.forEach(function(N){if(!F(N))throw new Error("bbox must only contain numbers")})}n.validateBBox=D;function I(M){if(!M)throw new Error("id is required");if(["string","number"].indexOf(typeof M)===-1)throw new Error("id must be a number or a string")}n.validateId=I})(go);const Ll=eo(kl),Cl=eo(us);var je=Pl,_o=go,vo=Ll,$t=Cl.default,Al=vo.featureEach;vo.coordEach;_o.polygon;var qn=_o.featureCollection;function bo(n){var e=new je(n);return e.insert=function(r){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:$t(r),je.prototype.insert.call(this,r)},e.load=function(r){var t=[];return Array.isArray(r)?r.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:$t(o),t.push(o)}):Al(r,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:$t(o),t.push(o)}),je.prototype.load.call(this,t)},e.remove=function(r,t){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:$t(r),je.prototype.remove.call(this,r,t)},e.clear=function(){return je.prototype.clear.call(this)},e.search=function(r){var t=je.prototype.search.call(this,this.toBBox(r));return qn(t)},e.collides=function(r){return je.prototype.collides.call(this,this.toBBox(r))},e.all=function(){var r=je.prototype.all.call(this);return qn(r)},e.toJSON=function(){return je.prototype.toJSON.call(this)},e.fromJSON=function(r){return je.prototype.fromJSON.call(this,r)},e.toBBox=function(r){var t;if(r.bbox)t=r.bbox;else if(Array.isArray(r)&&r.length===4)t=r;else if(Array.isArray(r)&&r.length===6)t=[r[0],r[1],r[3],r[4]];else if(r.type==="Feature")t=$t(r);else if(r.type==="FeatureCollection")t=$t(r);else throw new Error("invalid geojson");return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},e}wn.exports=bo;wn.exports.default=bo;var Fl=wn.exports;const kn=fs(Fl);function yo(n,e){var r={},t=[];if(n.type==="LineString"&&(n=Qr(n)),e.type==="LineString"&&(e=Qr(e)),n.type==="Feature"&&e.type==="Feature"&&n.geometry!==null&&e.geometry!==null&&n.geometry.type==="LineString"&&e.geometry.type==="LineString"&&n.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=Yn(n,e);return o&&t.push(o),Tn(t)}var i=kn();return i.load(xr(e)),Lt(xr(n),function(s){Lt(i.search(s),function(l){var a=Yn(s,l);if(a){var u=Ue(a).join(",");r[u]||(r[u]=!0,t.push(a))}})}),Tn(t)}function Yn(n,e){var r=Ue(n),t=Ue(e);if(r.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(t.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=r[0][0],i=r[0][1],s=r[1][0],l=r[1][1],a=t[0][0],u=t[0][1],c=t[1][0],f=t[1][1],d=(f-u)*(s-o)-(c-a)*(l-i),p=(c-a)*(i-u)-(f-u)*(o-a),m=(s-o)*(i-u)-(l-i)*(o-a);if(d===0)return null;var _=p/d,v=m/d;if(_>=0&&_<=1&&v>=0&&v<=1){var y=o+_*(s-o),h=i+_*(l-i);return cl([y,h])}return null}function $o(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function Ur(n,e,r){if(r===void 0&&(r={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Jn(n[0])||!Jn(n[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:n};return $o(t,e,r)}function Xn(n,e,r){if(r===void 0&&(r={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:n};return $o(t,e,r)}function Jn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function yr(n,e,r){r===void 0&&(r={});var t=Ur([1/0,1/0],{dist:1/0}),o=0;return bt(n,function(i){for(var s=Ue(i),l=0;l<s.length-1;l++){var a=Ur(s[l]);a.properties.dist=et(e,a,r);var u=Ur(s[l+1]);u.properties.dist=et(e,u,r);var c=et(a,u,r),f=Math.max(a.properties.dist,u.properties.dist),d=lo(a,u),p=Gn(e,f,d+90,r),m=Gn(e,f,d-90,r),_=yo(Xn([p.geometry.coordinates,m.geometry.coordinates]),Xn([a.geometry.coordinates,u.geometry.coordinates])),v=null;_.features.length>0&&(v=_.features[0],v.properties.dist=et(e,v,r),v.properties.location=o+et(a,v,r)),a.properties.dist<t.properties.dist&&(t=a,t.properties.index=l,t.properties.location=o),u.properties.dist<t.properties.dist&&(t=u,t.properties.index=l+1,t.properties.location=o+c),v&&v.properties.dist<t.properties.dist&&(t=v,t.properties.index=l),o+=c}}),t}function wo(){return{type:"FeatureCollection",features:[]}}function zr(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:ko(n)}}}function ko(n){return[Math.round(n[0]*1e7)/1e7,Math.round(n[1]*1e7)/1e7]}const So=Ze(wo()),Eo=Ze(0),Rl=100;class Nl{constructor(e){ne(this,"map");ne(this,"active");ne(this,"eventListenersSuccess");ne(this,"eventListenersUpdated");ne(this,"eventListenersFailure");ne(this,"points");ne(this,"cursor");ne(this,"hover");ne(this,"dragFrom");ne(this,"previousStates");ne(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let r=this.dragFrom[0]-e.lngLat.lng,t=this.dragFrom[1]-e.lngLat.lat;for(let o of this.points)o[0]-=r,o[1]-=t}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});ne(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let r=[];if(Kn(this.points).forEach((t,o)=>{r.push([o+1,yr(t,this.cursor).properties.dist])}),r.sort((t,o)=>t[1]-o[1]),r.length>0){let t=r[0][0];this.points.splice(t,0,this.cursor.geometry.coordinates),this.hover=t}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});ne(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=zr(e.lngLat.toArray()),this.onClick(e),this.finish())});ne(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});ne(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});ne(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});ne(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let r of this.eventListenersSuccess)r(e);else for(let r of this.eventListenersFailure)r();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=wo();this.points.forEach((o,i)=>{let s=zr(o);s.properties.hover=this.hover==i,s.properties.idx=i,e.features.push(s)}),e.features=e.features.concat(Kn(this.points));let r=this.polygonFeature();r&&(r.properties.hover=this.hover=="polygon",e.features.push(r)),So.set(e);let t="crosshair";this.hover!=null&&(t=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=t,Eo.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let r of this.eventListenersUpdated)r(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let r of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(r.geometry.type=="Polygon"){this.hover="polygon";break}else if(r.geometry.type=="Point"&&Object.hasOwn(r.properties,"idx")){this.hover=r.properties.idx;break}this.hover==null&&(this.cursor=zr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(ko),r=[JSON.parse(JSON.stringify(e))];return r[0].push(JSON.parse(JSON.stringify(r[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:r},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>Rl&&this.previousStates.shift()}}function Kn(n){let e=[];for(let r=0;r<n.length-1;r++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[r],n[r+1]]},properties:{}});return n.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[n.length-1],n[0]]},properties:{}}),e}class qr{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const r=this._partials;let t=0;for(let o=0;o<this._n&&o<32;o++){const i=r[o],s=e+i,l=Math.abs(e)<Math.abs(i)?e-(s-i):i-(s-e);l&&(r[t++]=l),e=s}return r[t]=e,this._n=t+1,this}valueOf(){const e=this._partials;let r=this._n,t,o,i,s=0;if(r>0){for(s=e[--r];r>0&&(t=s,o=e[--r],s=t+o,i=o-(s-t),!i););r>0&&(i<0&&e[r-1]<0||i>0&&e[r-1]>0)&&(o=i*2,t=s+o,o==t-s&&(s=t))}return s}}var Ol=1e-6,Wn=1e-12,Sn=Math.PI,Hn=Sn/2,Zn=180/Sn,ze=Sn/180,Mo=Math.atan2,qe=Math.cos,en=Math.hypot,Ye=Math.sin,Il=Math.sqrt;function Po(n){return n>1?Hn:n<-1?-Hn:Math.asin(n)}function Bl(){}function $r(n,e){n&&Qn.hasOwnProperty(n.type)&&Qn[n.type](n,e)}var Vn={Feature:function(n,e){$r(n.geometry,e)},FeatureCollection:function(n,e){for(var r=n.features,t=-1,o=r.length;++t<o;)$r(r[t].geometry,e)}},Qn={Sphere:function(n,e){e.sphere()},Point:function(n,e){n=n.coordinates,e.point(n[0],n[1],n[2])},MultiPoint:function(n,e){for(var r=n.coordinates,t=-1,o=r.length;++t<o;)n=r[t],e.point(n[0],n[1],n[2])},LineString:function(n,e){tn(n.coordinates,e,0)},MultiLineString:function(n,e){for(var r=n.coordinates,t=-1,o=r.length;++t<o;)tn(r[t],e,0)},Polygon:function(n,e){xn(n.coordinates,e)},MultiPolygon:function(n,e){for(var r=n.coordinates,t=-1,o=r.length;++t<o;)xn(r[t],e)},GeometryCollection:function(n,e){for(var r=n.geometries,t=-1,o=r.length;++t<o;)$r(r[t],e)}};function tn(n,e,r){var t=-1,o=n.length-r,i;for(e.lineStart();++t<o;)i=n[t],e.point(i[0],i[1],i[2]);e.lineEnd()}function xn(n,e){var r=-1,t=n.length;for(e.polygonStart();++r<t;)tn(n[r],e,1);e.polygonEnd()}function jl(n,e){n&&Vn.hasOwnProperty(n.type)?Vn[n.type](n,e):$r(n,e)}var Ot,wr,kr,Sr,Er,Mr,Pr,Lr,rn,nn,on,Lo,Co,_e,ve,be,Ne={sphere:Bl,point:En,lineStart:ei,lineEnd:ti,polygonStart:function(){Ne.lineStart=Tl,Ne.lineEnd=Ul},polygonEnd:function(){Ne.lineStart=ei,Ne.lineEnd=ti}};function En(n,e){n*=ze,e*=ze;var r=qe(e);Zt(r*qe(n),r*Ye(n),Ye(e))}function Zt(n,e,r){++Ot,kr+=(n-kr)/Ot,Sr+=(e-Sr)/Ot,Er+=(r-Er)/Ot}function ei(){Ne.point=Dl}function Dl(n,e){n*=ze,e*=ze;var r=qe(e);_e=r*qe(n),ve=r*Ye(n),be=Ye(e),Ne.point=Gl,Zt(_e,ve,be)}function Gl(n,e){n*=ze,e*=ze;var r=qe(e),t=r*qe(n),o=r*Ye(n),i=Ye(e),s=Mo(Il((s=ve*i-be*o)*s+(s=be*t-_e*i)*s+(s=_e*o-ve*t)*s),_e*t+ve*o+be*i);wr+=s,Mr+=s*(_e+(_e=t)),Pr+=s*(ve+(ve=o)),Lr+=s*(be+(be=i)),Zt(_e,ve,be)}function ti(){Ne.point=En}function Tl(){Ne.point=zl}function Ul(){Ao(Lo,Co),Ne.point=En}function zl(n,e){Lo=n,Co=e,n*=ze,e*=ze,Ne.point=Ao;var r=qe(e);_e=r*qe(n),ve=r*Ye(n),be=Ye(e),Zt(_e,ve,be)}function Ao(n,e){n*=ze,e*=ze;var r=qe(e),t=r*qe(n),o=r*Ye(n),i=Ye(e),s=ve*i-be*o,l=be*t-_e*i,a=_e*o-ve*t,u=en(s,l,a),c=Po(u),f=u&&-c/u;rn.add(f*s),nn.add(f*l),on.add(f*a),wr+=c,Mr+=c*(_e+(_e=t)),Pr+=c*(ve+(ve=o)),Lr+=c*(be+(be=i)),Zt(_e,ve,be)}function ql(n){Ot=wr=kr=Sr=Er=Mr=Pr=Lr=0,rn=new qr,nn=new qr,on=new qr,jl(n,Ne);var e=+rn,r=+nn,t=+on,o=en(e,r,t);return o<Wn&&(e=Mr,r=Pr,t=Lr,wr<Ol&&(e=kr,r=Sr,t=Er),o=en(e,r,t),o<Wn)?[NaN,NaN]:[Mo(r,e)*Zn,Po(t/o)*Zn]}let q;const Fo=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Fo.decode();let It=null;function Gt(){return(It===null||It.byteLength===0)&&(It=new Uint8Array(q.memory.buffer)),It}function Ge(n,e){return n=n>>>0,Fo.decode(Gt().subarray(n,n+e))}const He=new Array(128).fill(void 0);He.push(void 0,null,!0,!1);let Tt=He.length;function ae(n){Tt===He.length&&He.push(He.length+1);const e=Tt;return Tt=He[e],He[e]=n,e}function K(n){return He[n]}function Yl(n){n<132||(He[n]=Tt,Tt=n)}function ar(n){const e=K(n);return Yl(n),e}function Yr(n){return n==null}let Bt=null;function Xl(){return(Bt===null||Bt.byteLength===0)&&(Bt=new Float64Array(q.memory.buffer)),Bt}let jt=null;function ee(){return(jt===null||jt.byteLength===0)&&(jt=new Int32Array(q.memory.buffer)),jt}let nt=0;const ur=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Jl=typeof ur.encodeInto=="function"?function(n,e){return ur.encodeInto(n,e)}:function(n,e){const r=ur.encode(n);return e.set(r),{read:n.length,written:r.length}};function tr(n,e,r){if(r===void 0){const l=ur.encode(n),a=e(l.length,1)>>>0;return Gt().subarray(a,a+l.length).set(l),nt=l.length,a}let t=n.length,o=e(t,1)>>>0;const i=Gt();let s=0;for(;s<t;s++){const l=n.charCodeAt(s);if(l>127)break;i[o+s]=l}if(s!==t){s!==0&&(n=n.slice(s)),o=r(o,t,t=s+n.length*3,1)>>>0;const l=Gt().subarray(o+s,o+t),a=Jl(n,l);s+=a.written}return nt=s,o}function sn(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const o=n.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=n.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(n)){const o=n.length;let i="[";o>0&&(i+=sn(n[0]));for(let s=1;s<o;s++)i+=", "+sn(n[s]);return i+="]",i}const r=/\[object ([^\]]+)\]/.exec(toString.call(n));let t;if(r.length>1)t=r[1];else return toString.call(n);if(t=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:t}function Kl(n,e){const r=e(n.length*1,1)>>>0;return Gt().set(n,r/1),nt=n.length,r}function Xr(n,e){try{return n.apply(this,e)}catch(r){q.__wbindgen_exn_store(ae(r))}}class Cr{static __wrap(e){e=e>>>0;const r=Object.create(Cr.prototype);return r.__wbg_ptr=e,r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();q.__wbg_jsroutesnapper_free(e)}constructor(e){try{const i=q.__wbindgen_add_to_stack_pointer(-16),s=Kl(e,q.__wbindgen_malloc),l=nt;q.jsroutesnapper_new(i,s,l);var r=ee()[i/4+0],t=ee()[i/4+1],o=ee()[i/4+2];if(o)throw ar(t);return Cr.__wrap(r)}finally{q.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){q.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ae(e))}setAreaMode(){q.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,r;try{const i=q.__wbindgen_add_to_stack_pointer(-16);q.jsroutesnapper_getConfig(i,this.__wbg_ptr);var t=ee()[i/4+0],o=ee()[i/4+1];return e=t,r=o,Ge(t,o)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,r,1)}}toFinalFeature(){try{const t=q.__wbindgen_add_to_stack_pointer(-16);q.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=ee()[t/4+0],r=ee()[t/4+1];let o;return e!==0&&(o=Ge(e,r).slice(),q.__wbindgen_free(e,r*1)),o}finally{q.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,r;try{const i=q.__wbindgen_add_to_stack_pointer(-16);q.jsroutesnapper_renderGeojson(i,this.__wbg_ptr);var t=ee()[i/4+0],o=ee()[i/4+1];return e=t,r=o,Ge(t,o)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,r,1)}}toggleSnapMode(){q.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,r,t){return q.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,r,t)!==0}onClick(){q.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return q.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return q.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){q.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.jsroutesnapper_editExisting(o,this.__wbg_ptr,ae(e));var r=ee()[o/4+0],t=ee()[o/4+1];if(t)throw ar(r)}finally{q.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,r;try{const i=q.__wbindgen_add_to_stack_pointer(-16);q.jsroutesnapper_debugRenderGraph(i,this.__wbg_ptr);var t=ee()[i/4+0],o=ee()[i/4+1];return e=t,r=o,Ge(t,o)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,r,1)}}debugSnappableNodes(){let e,r;try{const i=q.__wbindgen_add_to_stack_pointer(-16);q.jsroutesnapper_debugSnappableNodes(i,this.__wbg_ptr);var t=ee()[i/4+0],o=ee()[i/4+1];return e=t,r=o,Ge(t,o)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,r,1)}}routeNameForWaypoints(e){let r,t;try{const c=q.__wbindgen_add_to_stack_pointer(-16);q.jsroutesnapper_routeNameForWaypoints(c,this.__wbg_ptr,ae(e));var o=ee()[c/4+0],i=ee()[c/4+1],s=ee()[c/4+2],l=ee()[c/4+3],a=o,u=i;if(l)throw a=0,u=0,ar(s);return r=a,t=u,Ge(a,u)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(r,t,1)}}addSnappedWaypoint(e,r){q.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,r)}undo(){q.jsroutesnapper_undo(this.__wbg_ptr)}}async function Wl(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(t){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const r=await n.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(n,e);return r instanceof WebAssembly.Instance?{instance:r,module:n}:r}}function Hl(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,r){const t=Ge(e,r);return ae(t)},n.wbg.__wbindgen_object_drop_ref=function(e){ar(e)},n.wbg.__wbindgen_error_new=function(e,r){const t=new Error(Ge(e,r));return ae(t)},n.wbg.__wbindgen_is_object=function(e){const r=K(e);return typeof r=="object"&&r!==null},n.wbg.__wbindgen_is_undefined=function(e){return K(e)===void 0},n.wbg.__wbindgen_in=function(e,r){return K(e)in K(r)},n.wbg.__wbindgen_number_get=function(e,r){const t=K(r),o=typeof t=="number"?t:void 0;Xl()[e/8+1]=Yr(o)?0:o,ee()[e/4+0]=!Yr(o)},n.wbg.__wbindgen_boolean_get=function(e){const r=K(e);return typeof r=="boolean"?r?1:0:2},n.wbg.__wbindgen_jsval_loose_eq=function(e,r){return K(e)==K(r)},n.wbg.__wbindgen_string_get=function(e,r){const t=K(r),o=typeof t=="string"?t:void 0;var i=Yr(o)?0:tr(o,q.__wbindgen_malloc,q.__wbindgen_realloc),s=nt;ee()[e/4+1]=s,ee()[e/4+0]=i},n.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,r){const t=K(e)[K(r)];return ae(t)},n.wbg.__wbindgen_object_clone_ref=function(e){const r=K(e);return ae(r)},n.wbg.__wbg_String_4370c5505c674d30=function(e,r){const t=String(K(r)),o=tr(t,q.__wbindgen_malloc,q.__wbindgen_realloc),i=nt;ee()[e/4+1]=i,ee()[e/4+0]=o},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ae(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,r){const t=K(r).stack,o=tr(t,q.__wbindgen_malloc,q.__wbindgen_realloc),i=nt;ee()[e/4+1]=i,ee()[e/4+0]=o},n.wbg.__wbg_error_f851667af71bcfc6=function(e,r){let t,o;try{t=e,o=r,console.error(Ge(e,r))}finally{q.__wbindgen_free(t,o,1)}},n.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(K(e))},n.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(K(e))},n.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(K(e))},n.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(K(e))},n.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(K(e))},n.wbg.__wbg_get_44be0491f933a435=function(e,r){const t=K(e)[r>>>0];return ae(t)},n.wbg.__wbg_length_fff51ee6522a1a18=function(e){return K(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof K(e)=="function"},n.wbg.__wbg_next_526fc47e980da008=function(e){const r=K(e).next;return ae(r)},n.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Xr(function(e){const r=K(e).next();return ae(r)},arguments)},n.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return K(e).done},n.wbg.__wbg_value_1695675138684bd5=function(e){const r=K(e).value;return ae(r)},n.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ae(Symbol.iterator)},n.wbg.__wbg_get_97b561fb56f034b5=function(){return Xr(function(e,r){const t=Reflect.get(K(e),K(r));return ae(t)},arguments)},n.wbg.__wbg_call_cb65541d95d71282=function(){return Xr(function(e,r){const t=K(e).call(K(r));return ae(t)},arguments)},n.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(K(e))},n.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let r;try{r=K(e)instanceof ArrayBuffer}catch{r=!1}return r},n.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const r=K(e).buffer;return ae(r)},n.wbg.__wbg_new_8125e318e6245eed=function(e){const r=new Uint8Array(K(e));return ae(r)},n.wbg.__wbg_set_5cf90238115182c3=function(e,r,t){K(e).set(K(r),t>>>0)},n.wbg.__wbg_length_72e2208bbc0efc61=function(e){return K(e).length},n.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let r;try{r=K(e)instanceof Uint8Array}catch{r=!1}return r},n.wbg.__wbindgen_debug_string=function(e,r){const t=sn(K(r)),o=tr(t,q.__wbindgen_malloc,q.__wbindgen_realloc),i=nt;ee()[e/4+1]=i,ee()[e/4+0]=o},n.wbg.__wbindgen_throw=function(e,r){throw new Error(Ge(e,r))},n.wbg.__wbindgen_memory=function(){const e=q.memory;return ae(e)},n}function Zl(n,e){return q=n.exports,Ro.__wbindgen_wasm_module=e,Bt=null,jt=null,It=null,q}async function Ro(n){if(q!==void 0)return q;typeof n>"u"&&(n="/atip/manage_files/assets/route_snapper_bg.wasm");const e=Hl();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:r,module:t}=await Wl(await n,e);return Zl(r,t)}function Vl(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function Ql(n,e,r){if(r===void 0&&(r={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ri(n[0])||!ri(n[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:n};return Vl(t,e,r)}function ri(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function ln(n,e){return e===void 0&&(e={}),po(n,function(r,t){var o=t.geometry.coordinates;return r+et(o[0],o[1],e)},0)}function xl(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function ea(n,e,r){if(r===void 0&&(r={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:n};return xl(t,e,r)}function ta(n,e,r){var t=Ue(r);if(Vr(r)!=="LineString")throw new Error("line must be a LineString");var o=yr(r,n),i=yr(r,e),s;o.properties.index<=i.properties.index?s=[o,i]:s=[i,o];for(var l=[s[0].geometry.coordinates],a=s[0].properties.index+1;a<s[1].properties.index+1;a++)l.push(t[a]);return l.push(s[1].geometry.coordinates),ea(l,r.properties)}function ra(n){var e=n[0],r=n[1],t=n[2],o=n[3],i=et(n.slice(0,2),[t,r]),s=et(n.slice(0,2),[e,o]);if(i>=s){var l=(r+o)/2;return[e,l-(t-e)/2,t,l+(t-e)/2]}else{var a=(e+t)/2;return[a-(o-r)/2,r,a+(o-r)/2,o]}}function an(n){var e=[1/0,1/0,-1/0,-1/0];return vt(n,function(r){e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])}),e}an.default=an;function na(n,e){e===void 0&&(e={});var r=e.precision,t=e.coordinates,o=e.mutate;if(r=r==null||isNaN(r)?6:r,t=t==null||isNaN(t)?3:t,!n)throw new Error("<geojson> is required");if(typeof r!="number")throw new Error("<precision> must be a number");if(typeof t!="number")throw new Error("<coordinates> must be a number");(o===!1||o===void 0)&&(n=JSON.parse(JSON.stringify(n)));var i=Math.pow(10,r);return vt(n,function(s){ia(s,i,t)}),n}function ia(n,e,r){n.length>r&&n.splice(r,n.length);for(var t=0;t<n.length;t++)n[t]=Math.round(n[t]*e)/e;return n}function oa(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function ni(n,e,r){if(r===void 0&&(r={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:n};return oa(t,e,r)}function Ut(n,e){e===void 0&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=n,r}function sa(n,e){if(!n)throw new Error("line is required");if(!e)throw new Error("splitter is required");var r=Vr(n),t=Vr(e);if(r!=="LineString")throw new Error("line must be LineString");if(t==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(t==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var o=na(e,{precision:7});switch(t){case"Point":return un(n,o);case"MultiPoint":return ii(n,o);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return ii(n,yo(n,o))}}function ii(n,e){var r=[],t=kn();return bt(e,function(o){if(r.forEach(function(l,a){l.id=a}),!r.length)r=un(n,o).features,r.forEach(function(l){l.bbox||(l.bbox=ra(an(l)))}),t.load(Ut(r));else{var i=t.search(o);if(i.features.length){var s=No(o,i);r=r.filter(function(l){return l.id!==s.id}),t.remove(s),Lt(un(s,o),function(l){r.push(l),t.insert(l)})}}}),Ut(r)}function un(n,e){var r=[],t=Ue(n)[0],o=Ue(n)[n.geometry.coordinates.length-1];if(Jr(t,ot(e))||Jr(o,ot(e)))return Ut([n]);var i=kn(),s=xr(n);i.load(s);var l=i.search(e);if(!l.features.length)return Ut([n]);var a=No(e,l),u=[t],c=fo(s,function(f,d,p){var m=Ue(d)[1],_=ot(e);return p===a.id?(f.push(_),r.push(ni(f)),Jr(_,m)?[_]:[_,m]):(f.push(m),f)},u);return c.length>1&&r.push(ni(c)),Ut(r)}function No(n,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var r,t=1/0;return Lt(e,function(o){var i=yr(o,n),s=i.properties.dist;s<t&&(r=o,t=s)}),r}function Jr(n,e){return n[0]===e[0]&&n[1]===e[1]}function la(n,e){let r=sa(n,e);if(r.features.length!=2)return null;let t=r.features[0],o=r.features[1];return t.geometry.coordinates=t.geometry.coordinates.map(si),o.geometry.coordinates=o.geometry.coordinates.map(si),t.properties=JSON.parse(JSON.stringify(n.properties)),o.properties=JSON.parse(JSON.stringify(n.properties)),aa(n,t,o,e),[t,o]}function aa(n,e,r,t){e.properties.length_meters=ln(e,{units:"kilometers"})*1e3,r.properties.length_meters=ln(r,{units:"kilometers"})*1e3,e.properties.waypoints=[],r.properties.waypoints=[];let o=oi(n,t),i=!0,s=0;for(let l of n.properties.waypoints){let a=oi(n,Ql([l.lon,l.lat]));if(i)if(a<o)e.properties.waypoints.push(l);else{let u=l.snapped&&n.properties.waypoints[s-1].snapped;e.properties.waypoints.push({lon:t.geometry.coordinates[0],lat:t.geometry.coordinates[1],snapped:u}),i=!1,r.properties.waypoints.push({lon:t.geometry.coordinates[0],lat:t.geometry.coordinates[1],snapped:u}),r.properties.waypoints.push(l)}else r.properties.waypoints.push(l);s++}}function oi(n,e){let r=n.geometry.coordinates[0],t=ta(r,e,n);return ln(t,{units:"kilometers"})*1e3}function si(n){return[Math.round(n[0]*1e7)/1e7,Math.round(n[1]*1e7)/1e7]}const ua=30;class fa{constructor(e,r,t,o,i){this.onMouseMove=s=>{if(!this.active)return;const l=[s.point.x-ua,s.point.y],a=this.map.unproject(s.point).distanceTo(this.map.unproject(l));this.inner.onMouseMove(s.lngLat.lng,s.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=s=>{this.active&&(s.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=s=>{this.active&&s.key=="Escape"&&(s.stopPropagation(),this.cancel())},this.onKeyPress=s=>{this.active&&s.target.tagName!="INPUT"&&(s.key=="Enter"?(s.stopPropagation(),this.finish()):s.key=="s"||s.key=="S"?(s.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):s.key=="z"&&s.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Cr(r),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=o,this.undoLength=i,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersSuccess)r(JSON.parse(e));else for(let r of this.eventListenersFailure)r();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersUpdated)r(JSON.parse(e))}}async function ca(n,e){let r=await fetch(n),t=r.body.getReader(),o=r.headers.get("Content-Length");if(!o)throw new Error(`No Content-Length header from ${n}`);let i=parseInt(o),s=0,l=[];for(;;){let{done:c,value:f}=await t.read();if(c)break;f&&(l.push(f),s+=f.length,e(100*s/i))}let a=new Uint8Array(s),u=0;for(let c of l)a.set(c,u),u+=c.length;return a}function li(n){let e=n[0],r,t,o=ai(n);return{c(){o.c(),r=le()},m(i,s){o.m(i,s),$(i,r,s),t=!0},p(i,s){s&1&&V(e,e=i[0])?(te(),E(o,1,1,H),re(),o=ai(i),o.c(),k(o,1),o.m(r.parentNode,r)):o.p(i,s)},i(i){t||(k(o),t=!0)},o(i){E(o),t=!1},d(i){i&&w(r),o.d(i)}}}function ai(n){let e;const r=n[10].default,t=Rr(r,n,n[9],null);return{c(){t&&t.c()},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&512)&&Nr(t,r,o,o[9],e?Ir(r,o[9],i,null):Or(o[9]),null)},i(o){e||(k(t,o),e=!0)},o(o){E(t,o),e=!1},d(o){t&&t.d(o)}}}function pa(n){let e,r,t=n[0]&&li(n);return{c(){t&&t.c(),e=le()},m(o,i){t&&t.m(o,i),$(o,e,i),r=!0},p(o,[i]){o[0]?t?(t.p(o,i),i&1&&k(t,1)):(t=li(o),t.c(),k(t,1),t.m(e.parentNode,e)):t&&(te(),E(t,1,1,()=>{t=null}),re())},i(o){r||(k(t),r=!0)},o(o){E(t),r=!1},d(o){o&&w(e),t&&t.d(o)}}}function ha(n,e,r){let t,o,{$$slots:i={},$$scope:s}=e,{id:l=so("image")}=e,{url:a}=e,{coordinates:u}=e;const{map:c,self:f}=Ds();X(n,c,m=>r(8,o=m)),X(n,f,m=>r(0,t=m));let d,p=!0;return Be(()=>{t&&o&&(Gs(c,t,d),Te(f,t=null,t),r(6,d=void 0))}),n.$$set=m=>{"id"in m&&r(3,l=m.id),"url"in m&&r(4,a=m.url),"coordinates"in m&&r(5,u=m.coordinates),"$$scope"in m&&r(9,s=m.$$scope)},n.$$.update=()=>{n.$$.dirty&313&&o&&t!==l&&(Te(f,t=l,t),Ts(o,t,Us({type:"image",url:a,coordinates:u}),m=>o&&m===t,()=>{t&&(r(6,d=o==null?void 0:o.getSource(t)),r(7,p=!0))})),n.$$.dirty&264&&(o==null||o.on("style.load",()=>{r(6,d=o==null?void 0:o.getSource(l))})),n.$$.dirty&224&&d&&(p?r(7,p=!1):d.setCoordinates(u))},[t,c,f,l,a,u,d,p,o,s,i]}class da extends Q{constructor(e){super(),x(this,e,ha,pa,V,{id:3,url:4,coordinates:5})}}const{Map:ma}=Xs;function ui(n,e,r){const t=n.slice();t[40]=e[r];const o=t[1](t[40]);t[41]=o;const i=typeof t[7]=="function"?t[7](t[40]):t[7];return t[42]=i,t}const ga=n=>({feature:n[0]&1024,position:n[0]&1026}),fi=n=>({feature:n[40],position:n[41]});function ci(n){let e=[],r=new ma,t,o,i=st(n[10]);const s=l=>l[40].id;for(let l=0;l<i.length;l+=1){let a=ui(n,i,l),u=s(a);r.set(u,e[l]=pi(u,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=le()},m(l,a){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(l,a);$(l,t,a),o=!0},p(l,a){a[0]&264095|a[1]&4&&(i=st(l[10]),te(),e=_n(e,a,s,1,l,i,r,t.parentNode,vn,pi,t,ui),re())},i(l){if(!o){for(let a=0;a<i.length;a+=1)k(e[a]);o=!0}},o(l){for(let a=0;a<e.length;a+=1)E(e[a]);o=!1},d(l){l&&w(t);for(let a=0;a<e.length;a+=1)e[a].d(l)}}}function _a(n){let e,r;const t=n[24].default,o=Rr(t,n,n[33],fi);return{c(){o&&o.c(),e=O()},m(i,s){o&&o.m(i,s),$(i,e,s),r=!0},p(i,s){o&&o.p&&(!r||s[0]&1026|s[1]&4)&&Nr(o,t,i,i[33],r?Ir(t,i[33],s,ga):Or(i[33]),fi)},i(i){r||(k(o,i),r=!0)},o(i){E(o,i),r=!1},d(i){i&&w(e),o&&o.d(i)}}}function pi(n,e){let r,t,o;function i(){return e[25](e[40])}function s(){return e[26](e[40])}function l(...p){return e[27](e[40],...p)}function a(...p){return e[28](e[40],...p)}function u(...p){return e[29](e[40],...p)}function c(...p){return e[30](e[40],...p)}function f(...p){return e[31](e[40],...p)}function d(...p){return e[32](e[40],...p)}return t=new Hr({props:{asButton:e[3],interactive:e[2],draggable:e[4],class:e[8],zIndex:e[42],lngLat:e[41],$$slots:{default:[_a]},$$scope:{ctx:e}}}),t.$on("mouseenter",i),t.$on("mouseleave",s),t.$on("dragstart",l),t.$on("drag",a),t.$on("dragend",u),t.$on("click",c),t.$on("dblclick",f),t.$on("contextmenu",d),{key:n,first:null,c(){r=le(),P(t.$$.fragment),this.first=r},m(p,m){$(p,r,m),L(t,p,m),o=!0},p(p,m){e=p;const _={};m[0]&8&&(_.asButton=e[3]),m[0]&4&&(_.interactive=e[2]),m[0]&16&&(_.draggable=e[4]),m[0]&256&&(_.class=e[8]),m[0]&1152&&(_.zIndex=e[42]),m[0]&1026&&(_.lngLat=e[41]),m[0]&1026|m[1]&4&&(_.$$scope={dirty:m,ctx:e}),t.$set(_)},i(p){o||(k(t.$$.fragment,p),o=!0)},o(p){E(t.$$.fragment,p),o=!1},d(p){p&&w(r),C(t,p)}}}function va(n){let e,r,t,o;e=new Ht({props:{minzoom:n[5],maxzoom:n[6],paint:{"fill-opacity":0},beforeLayerType:"symbol"}});let i=n[11]>=n[13]&&n[11]<=n[12]&&ci(n);return{c(){P(e.$$.fragment),r=O(),i&&i.c(),t=le()},m(s,l){L(e,s,l),$(s,r,l),i&&i.m(s,l),$(s,t,l),o=!0},p(s,l){const a={};l[0]&32&&(a.minzoom=s[5]),l[0]&64&&(a.maxzoom=s[6]),e.$set(a),s[11]>=s[13]&&s[11]<=s[12]?i?(i.p(s,l),l[0]&14336&&k(i,1)):(i=ci(s),i.c(),k(i,1),i.m(t.parentNode,t)):i&&(te(),E(i,1,1,()=>{i=null}),re())},i(s){o||(k(e.$$.fragment,s),k(i),o=!0)},o(s){E(e.$$.fragment,s),E(i),o=!1},d(s){s&&(w(r),w(t)),C(e,s),i&&i.d(s)}}}function ba(n,e,r){let t,o,i,s,l,a,u,{$$slots:c={},$$scope:f}=e;const{map:d,source:p,minzoom:m,maxzoom:_}=zs();X(n,d,J=>r(21,s=J)),X(n,p,J=>r(9,l=J)),X(n,m,J=>r(23,u=J)),X(n,_,J=>r(22,a=J));const v=cs();let{applyToClusters:y=void 0}=e,{filter:h=void 0}=e,{markerLngLat:g=ql}=e,{interactive:S=!0}=e,{asButton:b=!1}=e,{draggable:A=!1}=e,{minzoom:F=void 0}=e,{maxzoom:B=void 0}=e,{hovered:D=null}=e,{zIndex:I=void 0}=e,{class:M=void 0}=e,N=!1;function R(){s&&(N=!0,s.on("zoom",Pe),s.on("move",oe),s.on("moveend",oe),s.loaded()?s.once("load",oe):oe())}function U(J){J.sourceId===l&&J.isSourceLoaded&&(N?oe():R())}Be(()=>{s&&(s.off("zoom",Pe),s.off("move",oe),s.off("moveend",oe),s.off("sourcedata",U))});let se=[];function oe(){var Fn;if(!s||!l)return;let J=s.querySourceFeatures(l,{filter:i}),ke=new Map;for(let Ke of J)Ke.id||((Fn=Ke.properties)!=null&&Fn.cluster_id?Ke.id="autocluster_"+Ke.properties.cluster_id:Ke.id=so("autofeat")),ke.set(Ke.id,Ke);r(10,se=[...ke.values()].sort((Ke,is)=>Ke.id.toString().localeCompare(is.id.toString())))}let de=(s==null?void 0:s.getZoom())??0;function Pe(J){r(11,de=s.getZoom()),oe()}const At=J=>{r(0,D=J)},xe=J=>{(D==null?void 0:D.id)===J.id&&r(0,D=null)},Je=(J,ke)=>v("dragstart",{...ke.detail,source:l,feature:J}),ge=(J,ke)=>v("drag",{...ke.detail,source:l,feature:J}),z=(J,ke)=>v("dragend",{...ke.detail,source:l,feature:J}),we=(J,ke)=>v("click",{...ke.detail,source:l,feature:J}),Ft=(J,ke)=>v("dblclick",{...ke.detail,source:l,feature:J}),Gr=(J,ke)=>v("contextmenu",{...ke.detail,source:l,feature:J});return n.$$set=J=>{"applyToClusters"in J&&r(19,y=J.applyToClusters),"filter"in J&&r(20,h=J.filter),"markerLngLat"in J&&r(1,g=J.markerLngLat),"interactive"in J&&r(2,S=J.interactive),"asButton"in J&&r(3,b=J.asButton),"draggable"in J&&r(4,A=J.draggable),"minzoom"in J&&r(5,F=J.minzoom),"maxzoom"in J&&r(6,B=J.maxzoom),"hovered"in J&&r(0,D=J.hovered),"zIndex"in J&&r(7,I=J.zIndex),"class"in J&&r(8,M=J.class),"$$scope"in J&&r(33,f=J.$$scope)},n.$$.update=()=>{if(n.$$.dirty[0]&8388640&&r(13,t=F??u),n.$$.dirty[0]&4194368&&r(12,o=B??a),n.$$.dirty[0]&1572864&&(i=qs("all",Ys(y),h)),n.$$.dirty[0]&2097664&&s&&l){let J=s.getSource(l);J!=null&&J.loaded()?R():s.on("sourcedata",U)}},[D,g,S,b,A,F,B,I,M,l,se,de,o,t,d,p,m,_,v,y,h,s,a,u,c,At,xe,Je,ge,z,we,Ft,Gr,f]}class ya extends Q{constructor(e){super(),x(this,e,ba,va,V,{applyToClusters:19,filter:20,markerLngLat:1,interactive:2,asButton:3,draggable:4,minzoom:5,maxzoom:6,hovered:0,zIndex:7,class:8},null,[-1,-1])}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function $a(n,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},t,o,i,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(u){return function(c){return a([u,c])}}function a(u){if(t)throw new TypeError("Generator is already executing.");for(;r;)try{if(t=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,o=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(n,r)}catch(c){u=[6,c],o=0}finally{t=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var lt=function(){function n(e,r){this.next=null,this.key=e,this.data=r,this.left=null,this.right=null}return n}();function wa(n,e){return n>e?1:n<e?-1:0}function tt(n,e,r){for(var t=new lt(null,null),o=t,i=t;;){var s=r(n,e.key);if(s<0){if(e.left===null)break;if(r(n,e.left.key)<0){var l=e.left;if(e.left=l.right,l.right=e,e=l,e.left===null)break}i.left=e,i=e,e=e.left}else if(s>0){if(e.right===null)break;if(r(n,e.right.key)>0){var l=e.right;if(e.right=l.left,l.left=e,e=l,e.right===null)break}o.right=e,o=e,e=e.right}else break}return o.right=e.left,i.left=e.right,e.left=t.right,e.right=t.left,e}function Kr(n,e,r,t){var o=new lt(n,e);if(r===null)return o.left=o.right=null,o;r=tt(n,r,t);var i=t(n,r.key);return i<0?(o.left=r.left,o.right=r,r.left=null):i>=0&&(o.right=r.right,o.left=r,r.right=null),o}function hi(n,e,r){var t=null,o=null;if(e){e=tt(n,e,r);var i=r(e.key,n);i===0?(t=e.left,o=e.right):i<0?(o=e.right,e.right=null,t=e):(t=e.left,e.left=null,o=e)}return{left:t,right:o}}function ka(n,e,r){return e===null?n:(n===null||(e=tt(n.key,e,r),e.left=n),e)}function fn(n,e,r,t,o){if(n){t(""+e+(r?"└── ":"├── ")+o(n)+`
`);var i=e+(r?"    ":"│   ");n.left&&fn(n.left,i,!1,t,o),n.right&&fn(n.right,i,!0,t,o)}}var Mn=function(){function n(e){e===void 0&&(e=wa),this._root=null,this._size=0,this._comparator=e}return n.prototype.insert=function(e,r){return this._size++,this._root=Kr(e,r,this._root,this._comparator)},n.prototype.add=function(e,r){var t=new lt(e,r);this._root===null&&(t.left=t.right=null,this._size++,this._root=t);var o=this._comparator,i=tt(e,this._root,o),s=o(e,i.key);return s===0?this._root=i:(s<0?(t.left=i.left,t.right=i,i.left=null):s>0&&(t.right=i.right,t.left=i,i.right=null),this._size++,this._root=t),this._root},n.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},n.prototype._remove=function(e,r,t){var o;if(r===null)return null;r=tt(e,r,t);var i=t(e,r.key);return i===0?(r.left===null?o=r.right:(o=tt(e,r.left,t),o.right=r.right),this._size--,o):r},n.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=tt(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},n.prototype.findStatic=function(e){for(var r=this._root,t=this._comparator;r;){var o=t(e,r.key);if(o===0)return r;o<0?r=r.left:r=r.right}return null},n.prototype.find=function(e){return this._root&&(this._root=tt(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},n.prototype.contains=function(e){for(var r=this._root,t=this._comparator;r;){var o=t(e,r.key);if(o===0)return!0;o<0?r=r.left:r=r.right}return!1},n.prototype.forEach=function(e,r){for(var t=this._root,o=[],i=!1;!i;)t!==null?(o.push(t),t=t.left):o.length!==0?(t=o.pop(),e.call(r,t),t=t.right):i=!0;return this},n.prototype.range=function(e,r,t,o){for(var i=[],s=this._comparator,l=this._root,a;i.length!==0||l;)if(l)i.push(l),l=l.left;else{if(l=i.pop(),a=s(l.key,r),a>0)break;if(s(l.key,e)>=0&&t.call(o,l))return this;l=l.right}return this},n.prototype.keys=function(){var e=[];return this.forEach(function(r){var t=r.key;return e.push(t)}),e},n.prototype.values=function(){var e=[];return this.forEach(function(r){var t=r.data;return e.push(t)}),e},n.prototype.min=function(){return this._root?this.minNode(this._root).key:null},n.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},n.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},n.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},n.prototype.at=function(e){for(var r=this._root,t=!1,o=0,i=[];!t;)if(r)i.push(r),r=r.left;else if(i.length>0){if(r=i.pop(),o===e)return r;o++,r=r.right}else t=!0;return null},n.prototype.next=function(e){var r=this._root,t=null;if(e.right){for(t=e.right;t.left;)t=t.left;return t}for(var o=this._comparator;r;){var i=o(e.key,r.key);if(i===0)break;i<0?(t=r,r=r.left):r=r.right}return t},n.prototype.prev=function(e){var r=this._root,t=null;if(e.left!==null){for(t=e.left;t.right;)t=t.right;return t}for(var o=this._comparator;r;){var i=o(e.key,r.key);if(i===0)break;i<0?r=r.left:(t=r,r=r.right)}return t},n.prototype.clear=function(){return this._root=null,this._size=0,this},n.prototype.toList=function(){return Ea(this._root)},n.prototype.load=function(e,r,t){r===void 0&&(r=[]),t===void 0&&(t=!1);var o=e.length,i=this._comparator;if(t&&hn(e,r,0,o-1,i),this._root===null)this._root=cn(e,r,0,o),this._size=o;else{var s=Ma(this.toList(),Sa(e,r),i);o=this._size+o,this._root=pn({head:s},0,o)}return this},n.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){e===void 0&&(e=function(t){return String(t.key)});var r=[];return fn(this._root,"",!0,function(t){return r.push(t)},e),r.join("")},n.prototype.update=function(e,r,t){var o=this._comparator,i=hi(e,this._root,o),s=i.left,l=i.right;o(e,r)<0?l=Kr(r,t,l,o):s=Kr(r,t,s,o),this._root=ka(s,l,o)},n.prototype.split=function(e){return hi(e,this._root,this._comparator)},n.prototype[Symbol.iterator]=function(){var e;return $a(this,function(r){switch(r.label){case 0:e=this.minNode(),r.label=1;case 1:return e?[4,e]:[3,3];case 2:return r.sent(),e=this.next(e),[3,1];case 3:return[2]}})},n}();function cn(n,e,r,t){var o=t-r;if(o>0){var i=r+Math.floor(o/2),s=n[i],l=e[i],a=new lt(s,l);return a.left=cn(n,e,r,i),a.right=cn(n,e,i+1,t),a}return null}function Sa(n,e){for(var r=new lt(null,null),t=r,o=0;o<n.length;o++)t=t.next=new lt(n[o],e[o]);return t.next=null,r.next}function Ea(n){for(var e=n,r=[],t=!1,o=new lt(null,null),i=o;!t;)e?(r.push(e),e=e.left):r.length>0?(e=i=i.next=r.pop(),e=e.right):t=!0;return i.next=null,o.next}function pn(n,e,r){var t=r-e;if(t>0){var o=e+Math.floor(t/2),i=pn(n,e,o),s=n.head;return s.left=i,n.head=n.head.next,s.right=pn(n,o+1,r),s}return null}function Ma(n,e,r){for(var t=new lt(null,null),o=t,i=n,s=e;i!==null&&s!==null;)r(i.key,s.key)<0?(o.next=i,i=i.next):(o.next=s,s=s.next),o=o.next;return i!==null?o.next=i:s!==null&&(o.next=s),t.next}function hn(n,e,r,t,o){if(!(r>=t)){for(var i=n[r+t>>1],s=r-1,l=t+1;;){do s++;while(o(n[s],i)<0);do l--;while(o(n[l],i)>0);if(s>=l)break;var a=n[s];n[s]=n[l],n[l]=a,a=e[s],e[s]=e[l],e[l]=a}hn(n,e,r,l,o),hn(n,e,l+1,t,o)}}function Ae(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function di(n,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function $e(n,e,r){return e&&di(n.prototype,e),r&&di(n,r),n}var Rt=function(e,r){return e.ll.x<=r.x&&r.x<=e.ur.x&&e.ll.y<=r.y&&r.y<=e.ur.y},dn=function(e,r){if(r.ur.x<e.ll.x||e.ur.x<r.ll.x||r.ur.y<e.ll.y||e.ur.y<r.ll.y)return null;var t=e.ll.x<r.ll.x?r.ll.x:e.ll.x,o=e.ur.x<r.ur.x?e.ur.x:r.ur.x,i=e.ll.y<r.ll.y?r.ll.y:e.ll.y,s=e.ur.y<r.ur.y?e.ur.y:r.ur.y;return{ll:{x:t,y:i},ur:{x:o,y:s}}},it=Number.EPSILON;it===void 0&&(it=Math.pow(2,-52));var Pa=it*it,mn=function(e,r){if(-it<e&&e<it&&-it<r&&r<it)return 0;var t=e-r;return t*t<Pa*e*r?0:e<r?-1:1},La=function(){function n(){Ae(this,n),this.reset()}return $e(n,[{key:"reset",value:function(){this.xRounder=new mi,this.yRounder=new mi}},{key:"round",value:function(r,t){return{x:this.xRounder.round(r),y:this.yRounder.round(t)}}}]),n}(),mi=function(){function n(){Ae(this,n),this.tree=new Mn,this.round(0)}return $e(n,[{key:"round",value:function(r){var t=this.tree.add(r),o=this.tree.prev(t);if(o!==null&&mn(t.key,o.key)===0)return this.tree.remove(r),o.key;var i=this.tree.next(t);return i!==null&&mn(t.key,i.key)===0?(this.tree.remove(r),i.key):r}}]),n}(),Jt=new La,zt=function(e,r){return e.x*r.y-e.y*r.x},Oo=function(e,r){return e.x*r.x+e.y*r.y},gi=function(e,r,t){var o={x:r.x-e.x,y:r.y-e.y},i={x:t.x-e.x,y:t.y-e.y},s=zt(o,i);return mn(s,0)},Ar=function(e){return Math.sqrt(Oo(e,e))},Ca=function(e,r,t){var o={x:r.x-e.x,y:r.y-e.y},i={x:t.x-e.x,y:t.y-e.y};return zt(i,o)/Ar(i)/Ar(o)},Aa=function(e,r,t){var o={x:r.x-e.x,y:r.y-e.y},i={x:t.x-e.x,y:t.y-e.y};return Oo(i,o)/Ar(i)/Ar(o)},_i=function(e,r,t){return r.y===0?null:{x:e.x+r.x/r.y*(t-e.y),y:t}},vi=function(e,r,t){return r.x===0?null:{x:t,y:e.y+r.y/r.x*(t-e.x)}},Fa=function(e,r,t,o){if(r.x===0)return vi(t,o,e.x);if(o.x===0)return vi(e,r,t.x);if(r.y===0)return _i(t,o,e.y);if(o.y===0)return _i(e,r,t.y);var i=zt(r,o);if(i==0)return null;var s={x:t.x-e.x,y:t.y-e.y},l=zt(s,r)/i,a=zt(s,o)/i,u=e.x+a*r.x,c=t.x+l*o.x,f=e.y+a*r.y,d=t.y+l*o.y,p=(u+c)/2,m=(f+d)/2;return{x:p,y:m}},De=function(){$e(n,null,[{key:"compare",value:function(r,t){var o=n.comparePoints(r.point,t.point);return o!==0?o:(r.point!==t.point&&r.link(t),r.isLeft!==t.isLeft?r.isLeft?1:-1:Fr.compare(r.segment,t.segment))}},{key:"comparePoints",value:function(r,t){return r.x<t.x?-1:r.x>t.x?1:r.y<t.y?-1:r.y>t.y?1:0}}]);function n(e,r){Ae(this,n),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=r}return $e(n,[{key:"link",value:function(r){if(r.point===this.point)throw new Error("Tried to link already linked events");for(var t=r.point.events,o=0,i=t.length;o<i;o++){var s=t[o];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var r=this.point.events.length,t=0;t<r;t++){var o=this.point.events[t];if(o.segment.consumedBy===void 0)for(var i=t+1;i<r;i++){var s=this.point.events[i];s.consumedBy===void 0&&o.otherSE.point.events===s.otherSE.point.events&&o.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var r=[],t=0,o=this.point.events.length;t<o;t++){var i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&r.push(i)}return r}},{key:"getLeftmostComparator",value:function(r){var t=this,o=new Map,i=function(l){var a=l.otherSE;o.set(l,{sine:Ca(t.point,r.point,a.point),cosine:Aa(t.point,r.point,a.point)})};return function(s,l){o.has(s)||i(s),o.has(l)||i(l);var a=o.get(s),u=a.sine,c=a.cosine,f=o.get(l),d=f.sine,p=f.cosine;return u>=0&&d>=0?c<p?1:c>p?-1:0:u<0&&d<0?c<p?-1:c>p?1:0:d<u?-1:d>u?1:0}}}]),n}(),Ra=0,Fr=function(){$e(n,null,[{key:"compare",value:function(r,t){var o=r.leftSE.point.x,i=t.leftSE.point.x,s=r.rightSE.point.x,l=t.rightSE.point.x;if(l<o)return 1;if(s<i)return-1;var a=r.leftSE.point.y,u=t.leftSE.point.y,c=r.rightSE.point.y,f=t.rightSE.point.y;if(o<i){if(u<a&&u<c)return 1;if(u>a&&u>c)return-1;var d=r.comparePoint(t.leftSE.point);if(d<0)return 1;if(d>0)return-1;var p=t.comparePoint(r.rightSE.point);return p!==0?p:-1}if(o>i){if(a<u&&a<f)return-1;if(a>u&&a>f)return 1;var m=t.comparePoint(r.leftSE.point);if(m!==0)return m;var _=r.comparePoint(t.rightSE.point);return _<0?1:_>0?-1:1}if(a<u)return-1;if(a>u)return 1;if(s<l){var v=t.comparePoint(r.rightSE.point);if(v!==0)return v}if(s>l){var y=r.comparePoint(t.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(s!==l){var h=c-a,g=s-o,S=f-u,b=l-i;if(h>g&&S<b)return 1;if(h<g&&S>b)return-1}return s>l?1:s<l||c<f?-1:c>f?1:r.id<t.id?-1:r.id>t.id?1:0}}]);function n(e,r,t,o){Ae(this,n),this.id=++Ra,this.leftSE=e,e.segment=this,e.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=e,this.rings=t,this.windings=o}return $e(n,[{key:"replaceRightSE",value:function(r){this.rightSE=r,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var r=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:r<t?r:t},ur:{x:this.rightSE.point.x,y:r>t?r:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(r){return r.x===this.leftSE.point.x&&r.y===this.leftSE.point.y||r.x===this.rightSE.point.x&&r.y===this.rightSE.point.y}},{key:"comparePoint",value:function(r){if(this.isAnEndpoint(r))return 0;var t=this.leftSE.point,o=this.rightSE.point,i=this.vector();if(t.x===o.x)return r.x===t.x?0:r.x<t.x?1:-1;var s=(r.y-t.y)/i.y,l=t.x+s*i.x;if(r.x===l)return 0;var a=(r.x-t.x)/i.x,u=t.y+a*i.y;return r.y===u?0:r.y<u?-1:1}},{key:"getIntersection",value:function(r){var t=this.bbox(),o=r.bbox(),i=dn(t,o);if(i===null)return null;var s=this.leftSE.point,l=this.rightSE.point,a=r.leftSE.point,u=r.rightSE.point,c=Rt(t,a)&&this.comparePoint(a)===0,f=Rt(o,s)&&r.comparePoint(s)===0,d=Rt(t,u)&&this.comparePoint(u)===0,p=Rt(o,l)&&r.comparePoint(l)===0;if(f&&c)return p&&!d?l:!p&&d?u:null;if(f)return d&&s.x===u.x&&s.y===u.y?null:s;if(c)return p&&l.x===a.x&&l.y===a.y?null:a;if(p&&d)return null;if(p)return l;if(d)return u;var m=Fa(s,this.vector(),a,r.vector());return m===null||!Rt(i,m)?null:Jt.round(m.x,m.y)}},{key:"split",value:function(r){var t=[],o=r.events!==void 0,i=new De(r,!0),s=new De(r,!1),l=this.rightSE;this.replaceRightSE(s),t.push(s),t.push(i);var a=new n(i,l,this.rings.slice(),this.windings.slice());return De.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),De.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(i.checkForConsuming(),s.checkForConsuming()),t}},{key:"swapEvents",value:function(){var r=this.rightSE;this.rightSE=this.leftSE,this.leftSE=r,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,o=this.windings.length;t<o;t++)this.windings[t]*=-1}},{key:"consume",value:function(r){for(var t=this,o=r;t.consumedBy;)t=t.consumedBy;for(;o.consumedBy;)o=o.consumedBy;var i=n.compare(t,o);if(i!==0){if(i>0){var s=t;t=o,o=s}if(t.prev===o){var l=t;t=o,o=l}for(var a=0,u=o.rings.length;a<u;a++){var c=o.rings[a],f=o.windings[a],d=t.rings.indexOf(c);d===-1?(t.rings.push(c),t.windings.push(f)):t.windings[d]+=f}o.rings=null,o.windings=null,o.consumedBy=t,o.leftSE.consumedBy=t.leftSE,o.rightSE.consumedBy=t.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var r=this.prev.consumedBy||this.prev;this._beforeState=r.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var r=this.beforeState();this._afterState={rings:r.rings.slice(0),windings:r.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,o=this._afterState.windings,i=this._afterState.multiPolys,s=0,l=this.rings.length;s<l;s++){var a=this.rings[s],u=this.windings[s],c=t.indexOf(a);c===-1?(t.push(a),o.push(u)):o[c]+=u}for(var f=[],d=[],p=0,m=t.length;p<m;p++)if(o[p]!==0){var _=t[p],v=_.poly;if(d.indexOf(v)===-1)if(_.isExterior)f.push(v);else{d.indexOf(v)===-1&&d.push(v);var y=f.indexOf(_.poly);y!==-1&&f.splice(y,1)}}for(var h=0,g=f.length;h<g;h++){var S=f[h].multiPoly;i.indexOf(S)===-1&&i.push(S)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var r=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Oe.type){case"union":{var o=r.length===0,i=t.length===0;this._isInResult=o!==i;break}case"intersection":{var s,l;r.length<t.length?(s=r.length,l=t.length):(s=t.length,l=r.length),this._isInResult=l===Oe.numMultiPolys&&s<l;break}case"xor":{var a=Math.abs(r.length-t.length);this._isInResult=a%2===1;break}case"difference":{var u=function(f){return f.length===1&&f[0].isSubject};this._isInResult=u(r)!==u(t);break}default:throw new Error("Unrecognized operation type found ".concat(Oe.type))}return this._isInResult}}],[{key:"fromRing",value:function(r,t,o){var i,s,l,a=De.comparePoints(r,t);if(a<0)i=r,s=t,l=1;else if(a>0)i=t,s=r,l=-1;else throw new Error("Tried to create degenerate segment at [".concat(r.x,", ").concat(r.y,"]"));var u=new De(i,!0),c=new De(s,!1);return new n(u,c,[o],[l])}}]),n}(),bi=function(){function n(e,r,t){if(Ae(this,n),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=t,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=Jt.round(e[0][0],e[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var i=o,s=1,l=e.length;s<l;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var a=Jt.round(e[s][0],e[s][1]);a.x===i.x&&a.y===i.y||(this.segments.push(Fr.fromRing(i,a,this)),a.x<this.bbox.ll.x&&(this.bbox.ll.x=a.x),a.y<this.bbox.ll.y&&(this.bbox.ll.y=a.y),a.x>this.bbox.ur.x&&(this.bbox.ur.x=a.x),a.y>this.bbox.ur.y&&(this.bbox.ur.y=a.y),i=a)}(o.x!==i.x||o.y!==i.y)&&this.segments.push(Fr.fromRing(i,o,this))}return $e(n,[{key:"getSweepEvents",value:function(){for(var r=[],t=0,o=this.segments.length;t<o;t++){var i=this.segments[t];r.push(i.leftSE),r.push(i.rightSE)}return r}}]),n}(),Na=function(){function n(e,r){if(Ae(this,n),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new bi(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var t=1,o=e.length;t<o;t++){var i=new bi(e[t],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=r}return $e(n,[{key:"getSweepEvents",value:function(){for(var r=this.exteriorRing.getSweepEvents(),t=0,o=this.interiorRings.length;t<o;t++)for(var i=this.interiorRings[t].getSweepEvents(),s=0,l=i.length;s<l;s++)r.push(i[s]);return r}}]),n}(),yi=function(){function n(e,r){if(Ae(this,n),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var t=0,o=e.length;t<o;t++){var i=new Na(e[t],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=r}return $e(n,[{key:"getSweepEvents",value:function(){for(var r=[],t=0,o=this.polys.length;t<o;t++)for(var i=this.polys[t].getSweepEvents(),s=0,l=i.length;s<l;s++)r.push(i[s]);return r}}]),n}(),Oa=function(){$e(n,null,[{key:"factory",value:function(r){for(var t=[],o=0,i=r.length;o<i;o++){var s=r[o];if(!(!s.isInResult()||s.ringOut)){for(var l=null,a=s.leftSE,u=s.rightSE,c=[a],f=a.point,d=[];l=a,a=u,c.push(a),a.point!==f;)for(;;){var p=a.getAvailableLinkedEvents();if(p.length===0){var m=c[0].point,_=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(m.x,",")+" ".concat(m.y,"]. Last matching segment found ends at")+" [".concat(_.x,", ").concat(_.y,"]."))}if(p.length===1){u=p[0].otherSE;break}for(var v=null,y=0,h=d.length;y<h;y++)if(d[y].point===a.point){v=y;break}if(v!==null){var g=d.splice(v)[0],S=c.splice(g.index);S.unshift(S[0].otherSE),t.push(new n(S.reverse()));continue}d.push({index:c.length,point:a.point});var b=a.getLeftmostComparator(l);u=p.sort(b)[0].otherSE;break}t.push(new n(c))}}return t}}]);function n(e){Ae(this,n),this.events=e;for(var r=0,t=e.length;r<t;r++)e[r].segment.ringOut=this;this.poly=null}return $e(n,[{key:"getGeom",value:function(){for(var r=this.events[0].point,t=[r],o=1,i=this.events.length-1;o<i;o++){var s=this.events[o].point,l=this.events[o+1].point;gi(s,r,l)!==0&&(t.push(s),r=s)}if(t.length===1)return null;var a=t[0],u=t[1];gi(a,r,u)===0&&t.shift(),t.push(t[0]);for(var c=this.isExteriorRing()?1:-1,f=this.isExteriorRing()?0:t.length-1,d=this.isExteriorRing()?t.length:-1,p=[],m=f;m!=d;m+=c)p.push([t[m].x,t[m].y]);return p}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var r=this.enclosingRing();this._isExteriorRing=r?!r.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var r=this.events[0],t=1,o=this.events.length;t<o;t++){var i=this.events[t];De.compare(r,i)>0&&(r=i)}for(var s=r.segment.prevInResult(),l=s?s.prevInResult():null;;){if(!s)return null;if(!l)return s.ringOut;if(l.ringOut!==s.ringOut)return l.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=l.prevInResult(),l=s?s.prevInResult():null}}}]),n}(),$i=function(){function n(e){Ae(this,n),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return $e(n,[{key:"addInterior",value:function(r){this.interiorRings.push(r),r.poly=this}},{key:"getGeom",value:function(){var r=[this.exteriorRing.getGeom()];if(r[0]===null)return null;for(var t=0,o=this.interiorRings.length;t<o;t++){var i=this.interiorRings[t].getGeom();i!==null&&r.push(i)}return r}}]),n}(),Ia=function(){function n(e){Ae(this,n),this.rings=e,this.polys=this._composePolys(e)}return $e(n,[{key:"getGeom",value:function(){for(var r=[],t=0,o=this.polys.length;t<o;t++){var i=this.polys[t].getGeom();i!==null&&r.push(i)}return r}},{key:"_composePolys",value:function(r){for(var t=[],o=0,i=r.length;o<i;o++){var s=r[o];if(!s.poly)if(s.isExteriorRing())t.push(new $i(s));else{var l=s.enclosingRing();l.poly||t.push(new $i(l)),l.poly.addInterior(s)}}return t}}]),n}(),Ba=function(){function n(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Fr.compare;Ae(this,n),this.queue=e,this.tree=new Mn(r),this.segments=[]}return $e(n,[{key:"process",value:function(r){var t=r.segment,o=[];if(r.consumedBy)return r.isLeft?this.queue.remove(r.otherSE):this.tree.remove(t),o;var i=r.isLeft?this.tree.insert(t):this.tree.find(t);if(!i)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=i,l=i,a=void 0,u=void 0;a===void 0;)s=this.tree.prev(s),s===null?a=null:s.key.consumedBy===void 0&&(a=s.key);for(;u===void 0;)l=this.tree.next(l),l===null?u=null:l.key.consumedBy===void 0&&(u=l.key);if(r.isLeft){var c=null;if(a){var f=a.getIntersection(t);if(f!==null&&(t.isAnEndpoint(f)||(c=f),!a.isAnEndpoint(f)))for(var d=this._splitSafely(a,f),p=0,m=d.length;p<m;p++)o.push(d[p])}var _=null;if(u){var v=u.getIntersection(t);if(v!==null&&(t.isAnEndpoint(v)||(_=v),!u.isAnEndpoint(v)))for(var y=this._splitSafely(u,v),h=0,g=y.length;h<g;h++)o.push(y[h])}if(c!==null||_!==null){var S=null;if(c===null)S=_;else if(_===null)S=c;else{var b=De.comparePoints(c,_);S=b<=0?c:_}this.queue.remove(t.rightSE),o.push(t.rightSE);for(var A=t.split(S),F=0,B=A.length;F<B;F++)o.push(A[F])}o.length>0?(this.tree.remove(t),o.push(r)):(this.segments.push(t),t.prev=a)}else{if(a&&u){var D=a.getIntersection(u);if(D!==null){if(!a.isAnEndpoint(D))for(var I=this._splitSafely(a,D),M=0,N=I.length;M<N;M++)o.push(I[M]);if(!u.isAnEndpoint(D))for(var R=this._splitSafely(u,D),U=0,se=R.length;U<se;U++)o.push(R[U])}}this.tree.remove(t)}return o}},{key:"_splitSafely",value:function(r,t){this.tree.remove(r);var o=r.rightSE;this.queue.remove(o);var i=r.split(t);return i.push(o),r.consumedBy===void 0&&this.tree.insert(r),i}}]),n}(),wi=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ja=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Da=function(){function n(){Ae(this,n)}return $e(n,[{key:"run",value:function(r,t,o){Oe.type=r,Jt.reset();for(var i=[new yi(t,!0)],s=0,l=o.length;s<l;s++)i.push(new yi(o[s],!1));if(Oe.numMultiPolys=i.length,Oe.type==="difference")for(var a=i[0],u=1;u<i.length;)dn(i[u].bbox,a.bbox)!==null?u++:i.splice(u,1);if(Oe.type==="intersection"){for(var c=0,f=i.length;c<f;c++)for(var d=i[c],p=c+1,m=i.length;p<m;p++)if(dn(d.bbox,i[p].bbox)===null)return[]}for(var _=new Mn(De.compare),v=0,y=i.length;v<y;v++)for(var h=i[v].getSweepEvents(),g=0,S=h.length;g<S;g++)if(_.insert(h[g]),_.size>wi)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var b=new Ba(_),A=_.size,F=_.pop();F;){var B=F.key;if(_.size===A){var D=B.segment;throw new Error("Unable to pop() ".concat(B.isLeft?"left":"right"," SweepEvent ")+"[".concat(B.point.x,", ").concat(B.point.y,"] from segment #").concat(D.id," ")+"[".concat(D.leftSE.point.x,", ").concat(D.leftSE.point.y,"] -> ")+"[".concat(D.rightSE.point.x,", ").concat(D.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(_.size>wi)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(b.segments.length>ja)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var I=b.process(B),M=0,N=I.length;M<N;M++){var R=I[M];R.consumedBy===void 0&&_.insert(R)}A=_.size,F=_.pop()}Jt.reset();var U=Oa.factory(b.segments),se=new Ia(U);return se.getGeom()}}]),n}(),Oe=new Da,Ga=function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),o=1;o<r;o++)t[o-1]=arguments[o];return Oe.run("union",e,t)},Ta=function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),o=1;o<r;o++)t[o-1]=arguments[o];return Oe.run("intersection",e,t)},Ua=function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),o=1;o<r;o++)t[o-1]=arguments[o];return Oe.run("xor",e,t)},za=function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),o=1;o<r;o++)t[o-1]=arguments[o];return Oe.run("difference",e,t)},fr={union:Ga,intersection:Ta,xor:Ua,difference:za},qa=Object.defineProperty,Dr=(n,e)=>qa(n,"name",{value:e,configurable:!0});function Io(n,e){var r=jo(e),t=null;return n.type==="FeatureCollection"?t=Bo(n):t=Pn(fr.union(n.geometry.coordinates)),t.geometry.coordinates.forEach(function(o){r.geometry.coordinates.push(o[0])}),r}Dr(Io,"mask");function Bo(n){var e=n.features.length===2?fr.union(n.features[0].geometry.coordinates,n.features[1].geometry.coordinates):fr.union.apply(fr,n.features.map(function(r){return r.geometry.coordinates}));return Pn(e)}Dr(Bo,"unionFc");function Pn(n){return ps(n)}Dr(Pn,"createGeomFromPolygonClippingOutput");function jo(n){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],r=n&&n.geometry.coordinates||e;return hs(r)}Dr(jo,"createMask");var ki=Io;function Ya(n){let e,r;const t=[Z(n[0],"boundary"),{paint:{"fill-color":"black","fill-opacity":.5}}];let o={};for(let i=0;i<t.length;i+=1)o=fe(o,t[i]);return e=new Ht({props:o}),{c(){P(e.$$.fragment)},m(i,s){L(e,i,s),r=!0},p(i,s){const l=s&1?ce(t,[pe(Z(i[0],"boundary")),t[1]]):{};e.$set(l)},i(i){r||(k(e.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),r=!1},d(i){C(e,i)}}}function Xa(n){let e,r;return e=new gt({props:{data:ki(n[1]),$$slots:{default:[Ya]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,[o]){const i={};o&2&&(i.data=ki(t[1])),o&17&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Ja(n,e,r){let t;X(n,Ie,l=>r(3,t=l));let{cfg:o}=e,{boundaryGeojson:i}=e,{fitBoundsAtStart:s=!1}=e;return(ds("setCamera")||s)&&(t==null||t.fitBounds(io(i),{padding:20,animate:!1})),n.$$set=l=>{"cfg"in l&&r(0,o=l.cfg),"boundaryGeojson"in l&&r(1,i=l.boundaryGeojson),"fitBoundsAtStart"in l&&r(2,s=l.fitBoundsAtStart)},[o,i,s]}class Ka extends Q{constructor(e){super(),x(this,e,Ja,Xa,V,{cfg:0,boundaryGeojson:1,fitBoundsAtStart:2})}}function Wa(n){let e;return{c(){e=j("li"),e.textContent="Click to add a new point"},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Ha(n){let e;return{c(){e=j("li"),e.textContent="Click to move the point here"},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Za(n){let e,r,t;function o(l,a){return l[0]?Ha:Wa}let i=o(n),s=i(n);return{c(){e=j("ul"),s.c(),r=O(),t=j("li"),t.innerHTML=`Press <b>Escape</b>
    to cancel`},m(l,a){$(l,e,a),s.m(e,null),G(e,r),G(e,t)},p(l,[a]){i!==(i=o(l))&&(s.d(1),s=i(l),s&&(s.c(),s.m(e,r)))},i:H,o:H,d(l){l&&w(e),s.d()}}}function Va(n,e,r){let{editingExisting:t}=e;return n.$$set=o=>{"editingExisting"in o&&r(0,t=o.editingExisting)},[t]}class Do extends Q{constructor(e){super(),x(this,e,Va,Za,V,{editingExisting:0})}}function Qa(n){let e,r,t;return{c(){e=T("Undo ("),r=T(n[0]),t=T(")")},m(o,i){$(o,e,i),$(o,r,i),$(o,t,i)},p(o,i){i&1&&me(r,o[0])},d(o){o&&(w(e),w(r),w(t))}}}function xa(n){let e;return{c(){e=T("Undo")},m(r,t){$(r,e,t)},p:H,d(r){r&&w(e)}}}function eu(n){let e;function r(i,s){return i[0]==0?xa:Qa}let t=r(n),o=t(n);return{c(){o.c(),e=le()},m(i,s){o.m(i,s),$(i,e,s)},p(i,s){t===(t=r(i))&&o?o.p(i,s):(o.d(1),o=t(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){i&&w(e),o.d(i)}}}function tu(n){let e,r,t,o;return e=new ue({props:{disabled:n[0]==0,$$slots:{default:[eu]},$$scope:{ctx:n}}}),e.$on("click",n[1]),{c(){P(e.$$.fragment),r=O(),t=j("ul"),t.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`},m(i,s){L(e,i,s),$(i,r,s),$(i,t,s),o=!0},p(i,[s]){const l={};s&1&&(l.disabled=i[0]==0),s&9&&(l.$$scope={dirty:s,ctx:i}),e.$set(l)},i(i){o||(k(e.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),o=!1},d(i){i&&(w(r),w(t)),C(e,i)}}}function ru(n,e,r){let t,o;X(n,St,s=>r(2,t=s)),X(n,Eo,s=>r(0,o=s));function i(){t.undo()}return[o,i]}class Go extends Q{constructor(e){super(),x(this,e,ru,tu,V,{})}}const To=Ze(Et()),cr=Ze(Et()),Uo=Ze(!0),Ln=Ze(0);function Si(n,e,r){const t=n.slice();return t[9]=e[r],t}function Ei(n){let e,r,t=n[9].place_name+"",o,i,s;function l(...a){return n[5](n[9],...a)}return{c(){e=j("li"),r=j("a"),o=T(t),Y(r,"href","#")},m(a,u){$(a,e,u),G(e,r),G(r,o),i||(s=Ce(r,"click",l),i=!0)},p(a,u){n=a,u&2&&t!==(t=n[9].place_name+"")&&me(o,t)},d(a){a&&w(e),i=!1,s()}}}function nu(n){let e,r,t,o,i;function s(c){n[4](c)}let l={label:"Add waypoint by search"};n[0]!==void 0&&(l.value=n[0]),e=new Vs({props:l}),ye.push(()=>Me(e,"value",s));let a=st(n[1].features),u=[];for(let c=0;c<a.length;c+=1)u[c]=Ei(Si(n,a,c));return{c(){P(e.$$.fragment),t=O(),o=j("ol");for(let c=0;c<u.length;c+=1)u[c].c();Y(o,"class","govuk-list govuk-list--number")},m(c,f){L(e,c,f),$(c,t,f),$(c,o,f);for(let d=0;d<u.length;d+=1)u[d]&&u[d].m(o,null);i=!0},p(c,[f]){const d={};if(!r&&f&1&&(r=!0,d.value=c[0],Le(()=>r=!1)),e.$set(d),f&6){a=st(c[1].features);let p;for(p=0;p<a.length;p+=1){const m=Si(c,a,p);u[p]?u[p].p(m,f):(u[p]=Ei(m),u[p].c(),u[p].m(o,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=a.length}},i(c){i||(k(e.$$.fragment,c),i=!0)},o(c){E(e.$$.fragment,c),i=!1},d(c){c&&(w(t),w(o)),C(e,c),ms(u,c)}}}function iu(n,e,r){let t,o,i;X(n,Ve,d=>r(6,t=d)),X(n,cr,d=>r(1,o=d)),X(n,Ie,d=>r(7,i=d));let{maptilerApiKey:s}=e,l="";async function a(d){if(!d){Te(cr,o=Et(),o);return}let p=new URLSearchParams({country:"gb",proximity:i.getCenter().toArray().join(","),fuzzyMatch:"true",key:s}).toString(),m=`https://api.maptiler.com/geocoding/${d}.json?${p}`,v=await(await fetch(m)).json(),y=1;for(let h of v.features)h.properties.number=y++;Te(cr,o=v,o)}function u(d,p){d.preventDefault(),t.addSnappedWaypoint(p),r(0,l="")}function c(d){l=d,r(0,l)}const f=(d,p)=>u(p,d.center);return n.$$set=d=>{"maptilerApiKey"in d&&r(3,s=d.maptilerApiKey)},n.$$.update=()=>{n.$$.dirty&1&&a(l)},[l,o,u,s,c,f]}class ou extends Q{constructor(e){super(),x(this,e,iu,nu,V,{maptilerApiKey:3})}}function su(n){let e,r,t;return{c(){e=T("Undo ("),r=T(n[3]),t=T(")")},m(o,i){$(o,e,i),$(o,r,i),$(o,t,i)},p(o,i){i&8&&me(r,o[3])},d(o){o&&(w(e),w(r),w(t))}}}function lu(n){let e;return{c(){e=T("Undo")},m(r,t){$(r,e,t)},p:H,d(r){r&&w(e)}}}function au(n){let e;function r(i,s){return i[3]==0?lu:su}let t=r(n),o=t(n);return{c(){o.c(),e=le()},m(i,s){o.m(i,s),$(i,e,s)},p(i,s){t===(t=r(i))&&o?o.p(i,s):(o.d(1),o=t(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){i&&w(e),o.d(i)}}}function uu(n){let e,r,t,o;return t=new ue({props:{$$slots:{default:[cu]},$$scope:{ctx:n}}}),t.$on("click",n[6]),{c(){e=j("p"),e.innerHTML=`Drawing points anywhere. Press <b>s</b>
    or click below to snap to roads`,r=O(),P(t.$$.fragment),ie(e,"background","blue"),ie(e,"color","white"),ie(e,"padding","8px")},m(i,s){$(i,e,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&1024&&(l.$$scope={dirty:s,ctx:i}),t.$set(l)},i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){E(t.$$.fragment,i),o=!1},d(i){i&&(w(e),w(r)),C(t,i)}}}function fu(n){let e,r,t,o;return t=new ue({props:{$$slots:{default:[pu]},$$scope:{ctx:n}}}),t.$on("click",n[6]),{c(){e=j("p"),e.innerHTML=`Snapping to existing roads. Press <b>s</b>
    or click below to draw anywhere`,r=O(),P(t.$$.fragment),ie(e,"background","red"),ie(e,"color","white"),ie(e,"padding","8px")},m(i,s){$(i,e,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&1024&&(l.$$scope={dirty:s,ctx:i}),t.$set(l)},i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){E(t.$$.fragment,i),o=!1},d(i){i&&(w(e),w(r)),C(t,i)}}}function cu(n){let e;return{c(){e=T("Snap to roads")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function pu(n){let e;return{c(){e=T("Draw anywhere")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function hu(n){let e;return{c(){e=T("Add points to end")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function du(n){let e;return{c(){e=T("Avoid doubling back")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function mu(n){let e,r,t,o,i,s;function l(f){n[8](f)}let a={hint:"Keep clicking to add more points to the end of the route",$$slots:{default:[hu]},$$scope:{ctx:n}};n[0]!==void 0&&(a.checked=n[0]),e=new Zr({props:a}),ye.push(()=>Me(e,"checked",l));function u(f){n[9](f)}let c={hint:"Try to make the route avoid using the same streets with multiple waypoints",$$slots:{default:[du]},$$scope:{ctx:n}};return n[2].avoidDoublingBack!==void 0&&(c.checked=n[2].avoidDoublingBack),o=new Zr({props:c}),ye.push(()=>Me(o,"checked",u)),{c(){P(e.$$.fragment),t=O(),P(o.$$.fragment)},m(f,d){L(e,f,d),$(f,t,d),L(o,f,d),s=!0},p(f,d){const p={};d&1024&&(p.$$scope={dirty:d,ctx:f}),!r&&d&1&&(r=!0,p.checked=f[0],Le(()=>r=!1)),e.$set(p);const m={};d&1024&&(m.$$scope={dirty:d,ctx:f}),!i&&d&4&&(i=!0,m.checked=f[2].avoidDoublingBack,Le(()=>i=!1)),o.$set(m)},i(f){s||(k(e.$$.fragment,f),k(o.$$.fragment,f),s=!0)},o(f){E(e.$$.fragment,f),E(o.$$.fragment,f),s=!1},d(f){f&&w(t),C(e,f),C(o,f)}}}function Mi(n){let e,r;return e=new ou({props:{maptilerApiKey:n[1]}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&2&&(i.maptilerApiKey=t[1]),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function gu(n){let e,r,t,o,i,s,l,a,u,c,f;e=new ue({props:{disabled:n[3]==0,$$slots:{default:[au]},$$scope:{ctx:n}}}),e.$on("click",n[5]);const d=[fu,uu],p=[];function m(v,y){return v[4]?0:1}t=m(n),o=p[t]=d[t](n),a=new oo({props:{small:!0,$$slots:{default:[mu]},$$scope:{ctx:n}}});let _=n[1]&&Mi(n);return{c(){P(e.$$.fragment),r=O(),o.c(),i=O(),s=j("ul"),s.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li>Press <b>s</b>
    to switch between snapping points to existing roads and drawing anywhere</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,l=O(),P(a.$$.fragment),u=O(),_&&_.c(),c=le()},m(v,y){L(e,v,y),$(v,r,y),p[t].m(v,y),$(v,i,y),$(v,s,y),$(v,l,y),L(a,v,y),$(v,u,y),_&&_.m(v,y),$(v,c,y),f=!0},p(v,[y]){const h={};y&8&&(h.disabled=v[3]==0),y&1032&&(h.$$scope={dirty:y,ctx:v}),e.$set(h);let g=t;t=m(v),t===g?p[t].p(v,y):(te(),E(p[g],1,1,()=>{p[g]=null}),re(),o=p[t],o?o.p(v,y):(o=p[t]=d[t](v),o.c()),k(o,1),o.m(i.parentNode,i));const S={};y&1029&&(S.$$scope={dirty:y,ctx:v}),a.$set(S),v[1]?_?(_.p(v,y),y&2&&k(_,1)):(_=Mi(v),_.c(),k(_,1),_.m(c.parentNode,c)):_&&(te(),E(_,1,1,()=>{_=null}),re())},i(v){f||(k(e.$$.fragment,v),k(o),k(a.$$.fragment,v),k(_),f=!0)},o(v){E(e.$$.fragment,v),E(o),E(a.$$.fragment,v),E(_),f=!1},d(v){v&&(w(r),w(i),w(s),w(l),w(u),w(c)),C(e,v),p[t].d(v),C(a,v),_&&_.d(v)}}}function _u(n,e,r){let t,o,i,s;X(n,Ve,p=>r(7,t=p)),X(n,dr,p=>r(2,o=p)),X(n,Ln,p=>r(3,i=p)),X(n,Uo,p=>r(4,s=p));let{maptilerApiKey:l}=e,{extendRoute:a}=e;function u(){t.undo()}function c(){t.toggleSnapMode()}function f(p){a=p,r(0,a)}function d(p){n.$$.not_equal(o.avoidDoublingBack,p)&&(o.avoidDoublingBack=p,dr.set(o))}return n.$$set=p=>{"maptilerApiKey"in p&&r(1,l=p.maptilerApiKey),"extendRoute"in p&&r(0,a=p.extendRoute)},n.$$.update=()=>{n.$$.dirty&133&&t.setRouteConfig({avoid_doubling_back:o.avoidDoublingBack,extend_route:a})},[a,l,o,i,s,u,c,t,f,d]}class zo extends Q{constructor(e){super(),x(this,e,_u,gu,V,{maptilerApiKey:1,extendRoute:0})}}function vu(n){let e,r,t;return{c(){e=T("Undo ("),r=T(n[0]),t=T(")")},m(o,i){$(o,e,i),$(o,r,i),$(o,t,i)},p(o,i){i&1&&me(r,o[0])},d(o){o&&(w(e),w(r),w(t))}}}function bu(n){let e;return{c(){e=T("Undo")},m(r,t){$(r,e,t)},p:H,d(r){r&&w(e)}}}function yu(n){let e;function r(i,s){return i[0]==0?bu:vu}let t=r(n),o=t(n);return{c(){o.c(),e=le()},m(i,s){o.m(i,s),$(i,e,s)},p(i,s){t===(t=r(i))&&o?o.p(i,s):(o.d(1),o=t(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){i&&w(e),o.d(i)}}}function $u(n){let e,r,t,o;return e=new ue({props:{disabled:n[0]==0,$$slots:{default:[yu]},$$scope:{ctx:n}}}),e.$on("click",n[1]),{c(){P(e.$$.fragment),r=O(),t=j("ul"),t.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`},m(i,s){L(e,i,s),$(i,r,s),$(i,t,s),o=!0},p(i,[s]){const l={};s&1&&(l.disabled=i[0]==0),s&9&&(l.$$scope={dirty:s,ctx:i}),e.$set(l)},i(i){o||(k(e.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),o=!1},d(i){i&&(w(r),w(t)),C(e,i)}}}function wu(n,e,r){let t,o;X(n,Ve,s=>r(2,t=s)),X(n,Ln,s=>r(0,o=s));function i(){t.undo()}return[o,i]}class qo extends Q{constructor(e){super(),x(this,e,wu,$u,V,{})}}function ku(n){let e;return{c(){e=T("Finish")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Su(n){let e;return{c(){e=T("Cancel")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Eu(n){let e,r,t,o;return e=new Qe({props:{$$slots:{default:[ku]},$$scope:{ctx:n}}}),e.$on("click",n[3]),t=new ue({props:{$$slots:{default:[Su]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(i,s){L(e,i,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&32768&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&32768&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),o=!1},d(i){i&&w(r),C(e,i),C(t,i)}}}function Mu(n){let e,r;return e=new qo({}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p:H,i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Pu(n){let e,r;return e=new Go({}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p:H,i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Lu(n){let e,r;return e=new zo({props:{maptilerApiKey:n[0].maptilerApiKey,extendRoute:!1}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.maptilerApiKey=t[0].maptilerApiKey),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Cu(n){let e,r;return e=new Do({props:{editingExisting:!0}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p:H,i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Au(n){let e,r,t,o,i,s,l,a,u,c;i=new ut({props:{$$slots:{default:[Eu]},$$scope:{ctx:n}}});const f=[Cu,Lu,Pu,Mu],d=[];function p(m,_){return m[2]=="point"?0:m[2]=="route"?1:m[2]=="freehand-polygon"?2:m[2]=="snapped-polygon"?3:-1}return~(l=p(n))&&(a=d[l]=f[l](n)),{c(){e=j("h2"),r=T("Editing "),t=T(n[1]),o=O(),P(i.$$.fragment),s=O(),a&&a.c(),u=le()},m(m,_){$(m,e,_),G(e,r),G(e,t),$(m,o,_),L(i,m,_),$(m,s,_),~l&&d[l].m(m,_),$(m,u,_),c=!0},p(m,[_]){(!c||_&2)&&me(t,m[1]);const v={};_&32768&&(v.$$scope={dirty:_,ctx:m}),i.$set(v);let y=l;l=p(m),l===y?~l&&d[l].p(m,_):(a&&(te(),E(d[y],1,1,()=>{d[y]=null}),re()),~l?(a=d[l],a?a.p(m,_):(a=d[l]=f[l](m),a.c()),k(a,1),a.m(u.parentNode,u)):a=null)},i(m){c||(k(i.$$.fragment,m),k(a),c=!0)},o(m){E(i.$$.fragment,m),E(a),c=!1},d(m){m&&(w(e),w(o),w(s),w(u)),C(i,m),~l&&d[l].d(m)}}}function Fu(n,e,r){let t,o,i;X(n,St,h=>r(8,t=h)),X(n,Ve,h=>r(9,o=h)),X(n,qt,h=>r(10,i=h));let{cfg:s}=e,{gjSchemes:l}=e,{id:a}=e,u="",c="",f=null;Xe(()=>{let h=null;l.update(S=>(h=S.features.find(b=>b.id==a),h.properties.hide_while_editing=!0,S));let g=h;r(1,u=s.interventionName(g)),g.geometry.type=="LineString"?(o==null||o.editExistingRoute(g),o==null||o.addEventListenerSuccess(d),o==null||o.addEventListenerUpdated(p),o==null||o.addEventListenerFailure(m),r(2,c="route")):g.geometry.type=="Polygon"?g.properties.waypoints?(o==null||o.editExistingArea(g),o==null||o.addEventListenerSuccess(d),o==null||o.addEventListenerUpdated(p),o==null||o.addEventListenerFailure(m),r(2,c="snapped-polygon")):(t==null||t.editExisting(g),t==null||t.addEventListenerSuccess(d),t==null||t.addEventListenerUpdated(p),t==null||t.addEventListenerFailure(m),r(2,c="freehand-polygon")):g.geometry.type=="Point"&&(i==null||i.start(),i==null||i.addEventListenerSuccess(d),i==null||i.addEventListenerFailure(m),r(2,c="point"))}),Be(()=>{i==null||i.stop(),i==null||i.clearEventListeners(),o==null||o.stop(),o==null||o.clearEventListeners(),t==null||t.stop(),t==null||t.clearEventListeners(),l.update(h=>{let g=h.features.find(S=>S.id==a);return delete g.properties.hide_while_editing,f&&_(g,f),h})});function d(h){h.properties??(h.properties={}),f=h,W.set({mode:"edit-form",id:a})}function p(h){f=h}function m(){f=null,W.set({mode:"edit-form",id:a})}function _(h,g){h.geometry=g.geometry,g.properties.length_meters&&(h.properties.length_meters=g.properties.length_meters),g.properties.waypoints&&(h.properties.waypoints=g.properties.waypoints),s.updateFeature(h,g)}function v(){W.set({mode:"edit-form",id:a})}function y(){f=null,W.set({mode:"edit-form",id:a})}return n.$$set=h=>{"cfg"in h&&r(0,s=h.cfg),"gjSchemes"in h&&r(5,l=h.gjSchemes),"id"in h&&r(6,a=h.id)},[s,u,c,v,y,l,a]}class Ru extends Q{constructor(e){super(),x(this,e,Fu,Au,V,{cfg:0,gjSchemes:5,id:6})}}const pr=Ze(null),hr=Ze(100);function Pi(n){let e,r;return e=new da({props:{url:n[3],coordinates:[[n[1].lng,n[1].lat],[n[4].lng,n[1].lat],[n[4].lng,n[4].lat],[n[1].lng,n[4].lat]],$$slots:{default:[Nu]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.url=t[3]),o&18&&(i.coordinates=[[t[1].lng,t[1].lat],[t[4].lng,t[1].lat],[t[4].lng,t[4].lat],[t[1].lng,t[4].lat]]),o&545&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Nu(n){let e,r;const t=[Z(n[0],"georeferenced-image"),{paint:{"raster-fade-duration":0,"raster-opacity":n[5]/100}}];let o={};for(let i=0;i<t.length;i+=1)o=fe(o,t[i]);return e=new Cs({props:o}),{c(){P(e.$$.fragment)},m(i,s){L(e,i,s),r=!0},p(i,s){const l=s&33?ce(t,[s&1&&pe(Z(i[0],"georeferenced-image")),s&32&&{paint:{"raster-fade-duration":0,"raster-opacity":i[5]/100}}]):{};e.$set(l)},i(i){r||(k(e.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),r=!1},d(i){C(e,i)}}}function Li(n){let e,r,t,o,i,s;function l(f){n[7](f)}let a={draggable:!0,$$slots:{default:[Ou]},$$scope:{ctx:n}};n[1]!==void 0&&(a.lngLat=n[1]),e=new Hr({props:a}),ye.push(()=>Me(e,"lngLat",l));function u(f){n[8](f)}let c={draggable:!0,$$slots:{default:[Iu]},$$scope:{ctx:n}};return n[4]!==void 0&&(c.lngLat=n[4]),o=new Hr({props:c}),ye.push(()=>Me(o,"lngLat",u)),{c(){P(e.$$.fragment),t=O(),P(o.$$.fragment)},m(f,d){L(e,f,d),$(f,t,d),L(o,f,d),s=!0},p(f,d){const p={};d&512&&(p.$$scope={dirty:d,ctx:f}),!r&&d&2&&(r=!0,p.lngLat=f[1],Le(()=>r=!1)),e.$set(p);const m={};d&512&&(m.$$scope={dirty:d,ctx:f}),!i&&d&16&&(i=!0,m.lngLat=f[4],Le(()=>i=!1)),o.$set(m)},i(f){s||(k(e.$$.fragment,f),k(o.$$.fragment,f),s=!0)},o(f){E(e.$$.fragment,f),E(o.$$.fragment,f),s=!1},d(f){f&&w(t),C(e,f),C(o,f)}}}function Ou(n){let e;return{c(){e=j("span"),Y(e,"class","dot svelte-1tmbx1c"),ie(e,"background-color","red")},m(r,t){$(r,e,t)},p:H,d(r){r&&w(e)}}}function Iu(n){let e;return{c(){e=j("span"),Y(e,"class","dot svelte-1tmbx1c"),ie(e,"background-color","blue")},m(r,t){$(r,e,t)},p:H,d(r){r&&w(e)}}}function Bu(n){let e,r,t,o=n[3]&&Pi(n),i=n[3]&&n[2].mode=="set-image"&&Li(n);return{c(){o&&o.c(),e=O(),i&&i.c(),r=le()},m(s,l){o&&o.m(s,l),$(s,e,l),i&&i.m(s,l),$(s,r,l),t=!0},p(s,[l]){s[3]?o?(o.p(s,l),l&8&&k(o,1)):(o=Pi(s),o.c(),k(o,1),o.m(e.parentNode,e)):o&&(te(),E(o,1,1,()=>{o=null}),re()),s[3]&&s[2].mode=="set-image"?i?(i.p(s,l),l&12&&k(i,1)):(i=Li(s),i.c(),k(i,1),i.m(r.parentNode,r)):i&&(te(),E(i,1,1,()=>{i=null}),re())},i(s){t||(k(o),k(i),t=!0)},o(s){E(o),E(i),t=!1},d(s){s&&(w(e),w(r)),o&&o.d(s),i&&i.d(s)}}}function ju(n,e,r){let t,o,i,s;X(n,Ie,d=>r(6,t=d)),X(n,W,d=>r(2,o=d)),X(n,pr,d=>r(3,i=d)),X(n,hr,d=>r(5,s=d));let{cfg:l}=e,a={lng:0,lat:0},u={lng:0,lat:0};function c(d){a=d,r(1,a),r(6,t),r(3,i),r(2,o)}function f(d){u=d,r(4,u),r(6,t),r(3,i),r(2,o),r(1,a)}return n.$$set=d=>{"cfg"in d&&r(0,l=d.cfg)},n.$$.update=()=>{if(n.$$.dirty&78&&t&&i&&o.mode=="set-image"&&a.lng==0&&a.lat==0){let d=t.getBounds();r(1,a.lng=d.getWest()+.4*(d.getEast()-d.getWest()),a),r(4,u.lng=d.getWest()+.6*(d.getEast()-d.getWest()),u),r(1,a.lat=d.getNorth()+.4*(d.getSouth()-d.getNorth()),a),r(4,u.lat=d.getNorth()+.6*(d.getSouth()-d.getNorth()),u)}},[l,a,o,i,u,s,t,c,f]}class Du extends Q{constructor(e){super(),x(this,e,ju,Bu,V,{cfg:0})}}function Gu(n){let e,r,t,o,i,s;const l=[Z(n[0],"hover-polygons"),{filter:mt},{paint:{"line-color":Dt.hovering,"line-width":.5*dt}}];let a={};for(let p=0;p<l.length;p+=1)a=fe(a,l[p]);e=new Pt({props:a});const u=[Z(n[0],"hover-lines"),{filter:Yt},{paint:{"line-color":Dt.hovering,"line-width":1.5*dt}}];let c={};for(let p=0;p<u.length;p+=1)c=fe(c,u[p]);t=new Pt({props:c});const f=[Z(n[0],"hover-points"),{filter:Xt},{paint:{"circle-color":Dt.hovering,"circle-radius":1.5*mr}}];let d={};for(let p=0;p<f.length;p+=1)d=fe(d,f[p]);return i=new Mt({props:d}),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment),o=O(),P(i.$$.fragment)},m(p,m){L(e,p,m),$(p,r,m),L(t,p,m),$(p,o,m),L(i,p,m),s=!0},p(p,m){const _=m&1?ce(l,[pe(Z(p[0],"hover-polygons")),l[1],l[2]]):{};e.$set(_);const v=m&1?ce(u,[pe(Z(p[0],"hover-lines")),u[1],u[2]]):{};t.$set(v);const y=m&1?ce(f,[pe(Z(p[0],"hover-points")),f[1],f[2]]):{};i.$set(y)},i(p){s||(k(e.$$.fragment,p),k(t.$$.fragment,p),k(i.$$.fragment,p),s=!0)},o(p){E(e.$$.fragment,p),E(t.$$.fragment,p),E(i.$$.fragment,p),s=!1},d(p){p&&(w(r),w(o)),C(e,p),C(t,p),C(i,p)}}}function Tu(n){let e,r;return e=new gt({props:{data:n[2],$$slots:{default:[Gu]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,[o]){const i={};o&4&&(i.data=t[2]),o&33&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Uu(n,e,r){let t,o,i,s=H,l=()=>(s(),s=_t(u,c=>r(4,i=c)),u);X(n,sr,c=>r(3,o=c)),n.$$.on_destroy.push(()=>s());let{cfg:a}=e,{gjSchemes:u}=e;return l(),n.$$set=c=>{"cfg"in c&&r(0,a=c.cfg),"gjSchemes"in c&&l(r(1,u=c.gjSchemes))},n.$$.update=()=>{n.$$.dirty&24&&r(2,t=o==null?Et():i.features.find(c=>c.id==o))},[a,u,t,o,i]}class zu extends Q{constructor(e){super(),x(this,e,Uu,Tu,V,{cfg:0,gjSchemes:1})}}function Ci(n){let e,r;return e=new yn({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[qu,({features:t})=>({16:t}),({features:t})=>t?65536:0]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&196608&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function qu(n){let e,r,t=n[9](n[16])+"",o;return{c(){e=j("div"),r=j("p"),o=T(t),Y(e,"class","govuk-prose")},m(i,s){$(i,e,s),G(e,r),G(r,o)},p(i,s){s&65536&&t!==(t=i[9](i[16])+"")&&me(o,t)},d(i){i&&w(e)}}}function Yu(n){let e,r,t=n[4]&&Ci(n);return{c(){t&&t.c(),e=le()},m(o,i){t&&t.m(o,i),$(o,e,i),r=!0},p(o,i){o[4]?t?(t.p(o,i),i&16&&k(t,1)):(t=Ci(o),t.c(),k(t,1),t.m(e.parentNode,e)):t&&(te(),E(t,1,1,()=>{t=null}),re())},i(o){r||(k(t),r=!0)},o(o){E(t),r=!1},d(o){o&&w(e),t&&t.d(o)}}}function Ai(n){let e,r;return e=new yn({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[Xu,({features:t})=>({16:t}),({features:t})=>t?65536:0]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&196608&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Xu(n){let e,r,t=n[9](n[16])+"",o;return{c(){e=j("div"),r=j("p"),o=T(t),Y(e,"class","govuk-prose")},m(i,s){$(i,e,s),G(e,r),G(r,o)},p(i,s){s&65536&&t!==(t=i[9](i[16])+"")&&me(o,t)},d(i){i&&w(e)}}}function Ju(n){let e,r,t=n[4]&&Ai(n);return{c(){t&&t.c(),e=le()},m(o,i){t&&t.m(o,i),$(o,e,i),r=!0},p(o,i){o[4]?t?(t.p(o,i),i&16&&k(t,1)):(t=Ai(o),t.c(),k(t,1),t.m(e.parentNode,e)):t&&(te(),E(t,1,1,()=>{t=null}),re())},i(o){r||(k(t),r=!0)},o(o){E(t),r=!1},d(o){o&&w(e),t&&t.d(o)}}}function Fi(n){let e,r;return e=new yn({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[Ku,({features:t})=>({16:t}),({features:t})=>t?65536:0]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&196608&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Ku(n){let e,r,t=n[9](n[16])+"",o;return{c(){e=j("div"),r=j("p"),o=T(t),Y(e,"class","govuk-prose")},m(i,s){$(i,e,s),G(e,r),G(r,o)},p(i,s){s&65536&&t!==(t=i[9](i[16])+"")&&me(o,t)},d(i){i&&w(e)}}}function Wu(n){let e,r,t=n[4]&&Fi(n);return{c(){t&&t.c(),e=le()},m(o,i){t&&t.m(o,i),$(o,e,i),r=!0},p(o,i){o[4]?t?(t.p(o,i),i&16&&k(t,1)):(t=Fi(o),t.c(),k(t,1),t.m(e.parentNode,e)):t&&(te(),E(t,1,1,()=>{t=null}),re())},i(o){r||(k(t),r=!0)},o(o){E(t),r=!1},d(o){o&&w(e),t&&t.d(o)}}}function Hu(n){let e,r,t,o,i,s,l,a,u,c;const f=[Z(n[0],"interventions-points"),{filter:["all",Xt,n[6],n[7],n[3]]},{paint:{"circle-color":n[2],"circle-radius":mr}},{hoverCursor:n[4]?"pointer":void 0},{manageHoverState:n[4]}];let d={$$slots:{default:[Yu]},$$scope:{ctx:n}};for(let b=0;b<f.length;b+=1)d=fe(d,f[b]);e=new Mt({props:d}),e.$on("click",n[8]);const p=[Z(n[0],"interventions-lines"),{filter:["all",Yt,n[6],n[3]]},{paint:{"line-color":n[2],"line-width":dt}},{hoverCursor:n[4]?"pointer":void 0},{manageHoverState:n[4]}];let m={$$slots:{default:[Ju]},$$scope:{ctx:n}};for(let b=0;b<p.length;b+=1)m=fe(m,p[b]);t=new Pt({props:m}),t.$on("click",n[8]);const _=[Z(n[0],"interventions-lines-endpoints"),{filter:["all",["==",["get","endpoint"],!0],n[3]]},{paint:{"circle-radius":.5*dt,"circle-opacity":0,"circle-stroke-color":Dt.lineEndpointColor,"circle-stroke-width":2}}];let v={};for(let b=0;b<_.length;b+=1)v=fe(v,_[b]);i=new Mt({props:v});const y=[Z(n[0],"interventions-polygons"),{filter:["all",mt,n[6],n[3]]},{paint:{"fill-color":n[2],"fill-opacity":.2}},{hoverCursor:n[4]?"pointer":void 0},{manageHoverState:n[4]}];let h={$$slots:{default:[Wu]},$$scope:{ctx:n}};for(let b=0;b<y.length;b+=1)h=fe(h,y[b]);l=new Ht({props:h}),l.$on("click",n[8]);const g=[Z(n[0],"interventions-polygons-outlines"),{filter:["all",mt,n[6],n[3]]},{paint:{"line-color":n[2],"line-opacity":.5,"line-width":.7*dt}}];let S={};for(let b=0;b<g.length;b+=1)S=fe(S,g[b]);return u=new Pt({props:S}),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment),o=O(),P(i.$$.fragment),s=O(),P(l.$$.fragment),a=O(),P(u.$$.fragment)},m(b,A){L(e,b,A),$(b,r,A),L(t,b,A),$(b,o,A),L(i,b,A),$(b,s,A),L(l,b,A),$(b,a,A),L(u,b,A),c=!0},p(b,A){const F=A&221?ce(f,[A&1&&pe(Z(b[0],"interventions-points")),A&200&&{filter:["all",Xt,b[6],b[7],b[3]]},A&4&&{paint:{"circle-color":b[2],"circle-radius":mr}},A&16&&{hoverCursor:b[4]?"pointer":void 0},A&16&&{manageHoverState:b[4]}]):{};A&131088&&(F.$$scope={dirty:A,ctx:b}),e.$set(F);const B=A&93?ce(p,[A&1&&pe(Z(b[0],"interventions-lines")),A&72&&{filter:["all",Yt,b[6],b[3]]},A&4&&{paint:{"line-color":b[2],"line-width":dt}},A&16&&{hoverCursor:b[4]?"pointer":void 0},A&16&&{manageHoverState:b[4]}]):{};A&131088&&(B.$$scope={dirty:A,ctx:b}),t.$set(B);const D=A&9?ce(_,[A&1&&pe(Z(b[0],"interventions-lines-endpoints")),A&8&&{filter:["all",["==",["get","endpoint"],!0],b[3]]},_[2]]):{};i.$set(D);const I=A&93?ce(y,[A&1&&pe(Z(b[0],"interventions-polygons")),A&72&&{filter:["all",mt,b[6],b[3]]},A&4&&{paint:{"fill-color":b[2],"fill-opacity":.2}},A&16&&{hoverCursor:b[4]?"pointer":void 0},A&16&&{manageHoverState:b[4]}]):{};A&131088&&(I.$$scope={dirty:A,ctx:b}),l.$set(I);const M=A&77?ce(g,[A&1&&pe(Z(b[0],"interventions-polygons-outlines")),A&72&&{filter:["all",mt,b[6],b[3]]},A&4&&{paint:{"line-color":b[2],"line-opacity":.5,"line-width":.7*dt}}]):{};u.$set(M)},i(b){c||(k(e.$$.fragment,b),k(t.$$.fragment,b),k(i.$$.fragment,b),k(l.$$.fragment,b),k(u.$$.fragment,b),c=!0)},o(b){E(e.$$.fragment,b),E(t.$$.fragment,b),E(i.$$.fragment,b),E(l.$$.fragment,b),E(u.$$.fragment,b),c=!1},d(b){b&&(w(r),w(o),w(s),w(a)),C(e,b),C(t,b),C(i,b),C(l,b),C(u,b)}}}function Zu(n){let e,r;return e=new gt({props:{data:n[5],$$slots:{default:[Hu]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,[o]){const i={};o&32&&(i.data=t[5]),o&131101&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Vu(n){let e=["all"];for(let r of n.keys())e.push(["!=",["get","scheme_reference"],r]);return e}function Qu(n,e,r){let t,o,i,s,l,a=H,u=()=>(a(),a=_t(m,b=>r(11,l=b)),m),c,f,d;X(n,Ie,b=>r(14,c=b)),X(n,W,b=>r(12,f=b)),X(n,lr,b=>r(13,d=b)),n.$$.on_destroy.push(()=>a());let{cfg:p}=e,{gjSchemes:m}=e;u();const _=["!=",["get","hide_while_editing"],!0],v=["!=",["get","endpoint"],!0];let y;function h(b){return Nt(["get","scheme_reference"],Object.fromEntries(Object.values(b.schemes).map(A=>[A.scheme_reference,A.color])),"black")}function g(b){f.mode!="list"||!c||b.detail.features[0]&&(c.getCanvas().style.cursor="inherit",W.set({mode:"edit-form",id:b.detail.features[0].id}))}function S(b){if(b){let A=b[0],F=p.interventionName(A),B=p.schemeName(l.schemes[A.properties.scheme_reference]);return`${F} (${B})`}return"Tooltip bug"}return n.$$set=b=>{"cfg"in b&&r(0,p=b.cfg),"gjSchemes"in b&&u(r(1,m=b.gjSchemes))},n.$$.update=()=>{if(n.$$.dirty&2048&&r(5,t=As(l)),n.$$.dirty&4096&&r(4,o=f.mode=="list"),n.$$.dirty&8192&&r(3,i=Vu(d)),n.$$.dirty&2048&&r(10,s=h(l)),n.$$.dirty&5120){let b="grey";f.mode=="edit-form"?r(2,y=["case",["==",["id"],f.id],s,b]):f.mode=="list"?r(2,y=s):f.mode=="split-route"?r(2,y=["case",["==","intervention_type","route"],s,b]):r(2,y=b)}},[p,m,y,i,o,t,_,v,g,S,s,l,f,d]}class xu extends Q{constructor(e){super(),x(this,e,Qu,Zu,V,{cfg:0,gjSchemes:1})}}function ef(n){let e,r,t,o,i,s;const l=[Z(n[0],"edit-polygon-fill"),{filter:mt},{paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}];let a={};for(let p=0;p<l.length;p+=1)a=fe(a,l[p]);e=new Ht({props:a});const u=[Z(n[0],"edit-polygon-lines"),{filter:Yt},{paint:{"line-color":"black","line-width":8,"line-opacity":.5}}];let c={};for(let p=0;p<u.length;p+=1)c=fe(c,u[p]);t=new Pt({props:c});const f=[Z(n[0],"edit-polygon-vertices"),{filter:Xt},{paint:{"circle-color":Dt.hovering,"circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":mr}}];let d={};for(let p=0;p<f.length;p+=1)d=fe(d,f[p]);return i=new Mt({props:d}),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment),o=O(),P(i.$$.fragment)},m(p,m){L(e,p,m),$(p,r,m),L(t,p,m),$(p,o,m),L(i,p,m),s=!0},p(p,m){const _=m&1?ce(l,[pe(Z(p[0],"edit-polygon-fill")),l[1],l[2]]):{};e.$set(_);const v=m&1?ce(u,[pe(Z(p[0],"edit-polygon-lines")),u[1],u[2]]):{};t.$set(v);const y=m&1?ce(f,[pe(Z(p[0],"edit-polygon-vertices")),f[1],f[2]]):{};i.$set(y)},i(p){s||(k(e.$$.fragment,p),k(t.$$.fragment,p),k(i.$$.fragment,p),s=!0)},o(p){E(e.$$.fragment,p),E(t.$$.fragment,p),E(i.$$.fragment,p),s=!1},d(p){p&&(w(r),w(o)),C(e,p),C(t,p),C(i,p)}}}function tf(n){let e,r;return e=new gt({props:{data:n[1],$$slots:{default:[ef]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,[o]){const i={};o&2&&(i.data=t[1]),o&5&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function rf(n,e,r){let t;X(n,So,i=>r(1,t=i));let{cfg:o}=e;return n.$$set=i=>{"cfg"in i&&r(0,o=i.cfg)},[o,t]}class nf extends Q{constructor(e){super(),x(this,e,rf,tf,V,{cfg:0})}}function of(n){let e,r,t,o,i,s;const l=[Z(n[0],"route-points"),{filter:Xt},{paint:{"circle-color":Nt(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Nt(["get","type"],{node:rr/2},rr)}}];let a={};for(let p=0;p<l.length;p+=1)a=fe(a,l[p]);e=new Mt({props:a});const u=[Z(n[0],"route-lines"),{filter:Yt},{paint:{"line-color":["case",["get","snapped"],"red","blue"],"line-width":2.5}}];let c={};for(let p=0;p<u.length;p+=1)c=fe(c,u[p]);t=new Pt({props:c});const f=[Z(n[0],"route-polygons"),{filter:mt},{paint:{"fill-color":"black","fill-opacity":.5}}];let d={};for(let p=0;p<f.length;p+=1)d=fe(d,f[p]);return i=new Ht({props:d}),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment),o=O(),P(i.$$.fragment)},m(p,m){L(e,p,m),$(p,r,m),L(t,p,m),$(p,o,m),L(i,p,m),s=!0},p(p,m){const _=m&1?ce(l,[m&1&&pe(Z(p[0],"route-points")),l[1],m&0&&{paint:{"circle-color":Nt(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Nt(["get","type"],{node:rr/2},rr)}}]):{};e.$set(_);const v=m&1?ce(u,[pe(Z(p[0],"route-lines")),u[1],u[2]]):{};t.$set(v);const y=m&1?ce(f,[pe(Z(p[0],"route-polygons")),f[1],f[2]]):{};i.$set(y)},i(p){s||(k(e.$$.fragment,p),k(t.$$.fragment,p),k(i.$$.fragment,p),s=!0)},o(p){E(e.$$.fragment,p),E(t.$$.fragment,p),E(i.$$.fragment,p),s=!1},d(p){p&&(w(r),w(o)),C(e,p),C(t,p),C(i,p)}}}function sf(n){let e,r=Ri(n[3])+"",t;return{c(){e=j("div"),t=T(r),ie(e,"font-size","30px"),ie(e,"background","white"),ie(e,"padding","16px"),ie(e,"border-radius","50%")},m(o,i){$(o,e,i),G(e,t)},p(o,i){i&8&&r!==(r=Ri(o[3])+"")&&me(t,r)},d(o){o&&w(e)}}}function lf(n){let e,r;return e=new ya({props:{$$slots:{default:[sf,({feature:t})=>({3:t}),({feature:t})=>t?8:0]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&24&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function af(n){let e,r,t,o;return e=new gt({props:{data:n[1],$$slots:{default:[of]},$$scope:{ctx:n}}}),t=new gt({props:{data:n[2],$$slots:{default:[lf]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(i,s){L(e,i,s),$(i,r,s),L(t,i,s),o=!0},p(i,[s]){const l={};s&2&&(l.data=i[1]),s&17&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&4&&(a.data=i[2]),s&16&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),o=!1},d(i){i&&w(r),C(e,i),C(t,i)}}}const rr=10;function Ri(n){var e;return(e=n.properties)==null?void 0:e.number}function uf(n,e,r){let t,o;X(n,To,s=>r(1,t=s)),X(n,cr,s=>r(2,o=s));let{cfg:i}=e;return n.$$set=s=>{"cfg"in s&&r(0,i=s.cfg)},[i,t,o]}class ff extends Q{constructor(e){super(),x(this,e,uf,af,V,{cfg:0})}}var cf=Object.defineProperty,ft=(n,e)=>cf(n,"name",{value:e,configurable:!0});function Ct(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ft(Ct,"getCoord");function Yo(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ft(Yo,"getCoords");function Xo(n){if(n.length>1&&Rn(n[0])&&Rn(n[1]))return!0;if(Array.isArray(n[0])&&n[0].length)return Xo(n[0]);throw new Error("coordinates must only contain numbers")}ft(Xo,"containsNumber");function pf(n,e,r){if(!e||!r)throw new Error("type and name required");if(!n||n.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.type)}ft(pf,"geojsonType");function hf(n,e,r){if(!n)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}ft(hf,"featureOf");function df(n,e,r){if(!n)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!n||n.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const t of n.features){if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}}ft(df,"collectionOf");function mf(n){return n.type==="Feature"?n.geometry:n}ft(mf,"getGeom");function gf(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}ft(gf,"getType");var _f=Object.defineProperty,Jo=(n,e)=>_f(n,"name",{value:e,configurable:!0});function Cn(n,e,r={}){if(r.final===!0)return Ko(n,e);const t=Ct(n),o=Ct(e),i=Re(t[0]),s=Re(o[0]),l=Re(t[1]),a=Re(o[1]),u=Math.sin(s-i)*Math.cos(a),c=Math.cos(l)*Math.sin(a)-Math.sin(l)*Math.cos(a)*Math.cos(s-i);return Wr(Math.atan2(u,c))}Jo(Cn,"bearing");function Ko(n,e){let r=Cn(e,n);return r=(r+180)%360,r}Jo(Ko,"calculateFinalBearing");var vf=Object.defineProperty,bf=(n,e)=>vf(n,"name",{value:e,configurable:!0});function wt(n,e,r={}){var t=Ct(n),o=Ct(e),i=Re(o[1]-t[1]),s=Re(o[0]-t[0]),l=Re(t[1]),a=Re(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(a);return gs(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),r.units)}bf(wt,"distance");var yf=Object.defineProperty,$f=(n,e)=>yf(n,"name",{value:e,configurable:!0});function gn(n,e,r,t={}){const o=Ct(n),i=Re(o[0]),s=Re(o[1]),l=Re(r),a=_s(e,t.units),u=Math.asin(Math.sin(s)*Math.cos(a)+Math.cos(s)*Math.sin(a)*Math.cos(l)),c=i+Math.atan2(Math.sin(l)*Math.sin(a)*Math.cos(s),Math.cos(a)-Math.sin(s)*Math.sin(u)),f=Wr(c),d=Wr(u);return Fe([f,d],t.properties)}$f(gn,"destination");class Wo{constructor(e=[],r=wf){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:t}=this,o=r[e];for(;e>0;){const i=e-1>>1,s=r[i];if(t(o,s)>=0)break;r[e]=s,e=i}r[e]=o}_down(e){const{data:r,compare:t}=this,o=this.length>>1,i=r[e];for(;e<o;){let s=(e<<1)+1,l=r[s];const a=s+1;if(a<this.length&&t(r[a],l)<0&&(s=a,l=r[a]),t(l,i)>=0)break;r[e]=l,e=s}r[e]=i}}function wf(n,e){return n<e?-1:n>e?1:0}function Ho(n,e){return n.p.x>e.p.x?1:n.p.x<e.p.x?-1:n.p.y!==e.p.y?n.p.y>e.p.y?1:-1:1}function kf(n,e){return n.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:n.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:n.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?n.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class Ni{constructor(e,r,t,o){this.p={x:e[0],y:e[1]},this.featureId=r,this.ringId=t,this.eventId=o,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}function Sf(n,e){if(n.type==="FeatureCollection"){const r=n.features;for(let t=0;t<r.length;t++)Oi(r[t],e)}else Oi(n,e)}let nr=0,ir=0,or=0;function Oi(n,e){const r=n.type==="Feature"?n.geometry:n;let t=r.coordinates;(r.type==="Polygon"||r.type==="MultiLineString")&&(t=[t]),r.type==="LineString"&&(t=[[t]]);for(let o=0;o<t.length;o++)for(let i=0;i<t[o].length;i++){let s=t[o][i][0],l=null;ir=ir+1;for(let a=0;a<t[o][i].length-1;a++){l=t[o][i][a+1];const u=new Ni(s,nr,ir,or),c=new Ni(l,nr,ir,or+1);u.otherEvent=c,c.otherEvent=u,Ho(u,c)>0?(c.isLeftEndpoint=!0,u.isLeftEndpoint=!1):(u.isLeftEndpoint=!0,c.isLeftEndpoint=!1),e.push(u),e.push(c),s=l,or=or+1}}nr=nr+1}class Ef{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function Mf(n,e){if(n===null||e===null||n.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(n.rightSweepEvent.isSamePoint(e.leftSweepEvent)||n.rightSweepEvent.isSamePoint(e.leftSweepEvent)||n.rightSweepEvent.isSamePoint(e.rightSweepEvent)||n.leftSweepEvent.isSamePoint(e.leftSweepEvent)||n.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const r=n.leftSweepEvent.p.x,t=n.leftSweepEvent.p.y,o=n.rightSweepEvent.p.x,i=n.rightSweepEvent.p.y,s=e.leftSweepEvent.p.x,l=e.leftSweepEvent.p.y,a=e.rightSweepEvent.p.x,u=e.rightSweepEvent.p.y,c=(u-l)*(o-r)-(a-s)*(i-t),f=(a-s)*(t-l)-(u-l)*(r-s),d=(o-r)*(t-l)-(i-t)*(r-s);if(c===0)return!1;const p=f/c,m=d/c;if(p>=0&&p<=1&&m>=0&&m<=1){const _=r+p*(o-r),v=t+p*(i-t);return[_,v]}return!1}function Pf(n,e){e=e||!1;const r=[],t=new Wo([],kf);for(;n.length;){const o=n.pop();if(o.isLeftEndpoint){const i=new Ef(o);for(let s=0;s<t.data.length;s++){const l=t.data[s];if(e&&l.leftSweepEvent.featureId===o.featureId)continue;const a=Mf(i,l);a!==!1&&r.push(a)}t.push(i)}else o.isLeftEndpoint===!1&&t.pop()}return r}function Lf(n,e){const r=new Wo([],Ho);return Sf(n,r),Pf(r,e)}var Cf=Object.defineProperty,Af=(n,e)=>Cf(n,"name",{value:e,configurable:!0}),Ff=Lf;function Zo(n,e,r={}){const{removeDuplicates:t=!0,ignoreSelfIntersections:o=!1}=r;let i=[];n.type==="FeatureCollection"?i=i.concat(n.features):n.type==="Feature"?i.push(n):(n.type==="LineString"||n.type==="Polygon"||n.type==="MultiLineString"||n.type==="MultiPolygon")&&i.push(gr(n)),e.type==="FeatureCollection"?i=i.concat(e.features):e.type==="Feature"?i.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&i.push(gr(e));const s=Ff(Nn(i),o);let l=[];if(t){const a={};s.forEach(u=>{const c=u.join(",");a[c]||(a[c]=!0,l.push(u))})}else l=s;return Nn(l.map(a=>Fe(a)))}Af(Zo,"lineIntersect");var Rf=Object.defineProperty,he=(n,e)=>Rf(n,"name",{value:e,configurable:!0});function Vt(n,e,r){if(n!==null)for(var t,o,i,s,l,a,u,c=0,f=0,d,p=n.type,m=p==="FeatureCollection",_=p==="Feature",v=m?n.features.length:1,y=0;y<v;y++){u=m?n.features[y].geometry:_?n.geometry:n,d=u?u.type==="GeometryCollection":!1,l=d?u.geometries.length:1;for(var h=0;h<l;h++){var g=0,S=0;if(s=d?u.geometries[h]:u,s!==null){a=s.coordinates;var b=s.type;switch(c=r&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(a,f,y,g,S)===!1)return!1;f++,g++;break;case"LineString":case"MultiPoint":for(t=0;t<a.length;t++){if(e(a[t],f,y,g,S)===!1)return!1;f++,b==="MultiPoint"&&g++}b==="LineString"&&g++;break;case"Polygon":case"MultiLineString":for(t=0;t<a.length;t++){for(o=0;o<a[t].length-c;o++){if(e(a[t][o],f,y,g,S)===!1)return!1;f++}b==="MultiLineString"&&g++,b==="Polygon"&&S++}b==="Polygon"&&g++;break;case"MultiPolygon":for(t=0;t<a.length;t++){for(S=0,o=0;o<a[t].length;o++){for(i=0;i<a[t][o].length-c;i++){if(e(a[t][o][i],f,y,g,S)===!1)return!1;f++}S++}g++}break;case"GeometryCollection":for(t=0;t<s.geometries.length;t++)if(Vt(s.geometries[t],e,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}he(Vt,"coordEach");function Nf(n,e,r,t){var o=r;return Vt(n,function(i,s,l,a,u){s===0&&r===void 0?o=i:o=e(o,i,s,l,a,u)},t),o}he(Nf,"coordReduce");function Vo(n,e){var r;switch(n.type){case"FeatureCollection":for(r=0;r<n.features.length&&e(n.features[r].properties,r)!==!1;r++);break;case"Feature":e(n.properties,0);break}}he(Vo,"propEach");function Of(n,e,r){var t=r;return Vo(n,function(o,i){i===0&&r===void 0?t=o:t=e(t,o,i)}),t}he(Of,"propReduce");function Qo(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var r=0;r<n.features.length&&e(n.features[r],r)!==!1;r++);}he(Qo,"featureEach");function If(n,e,r){var t=r;return Qo(n,function(o,i){i===0&&r===void 0?t=o:t=e(t,o,i)}),t}he(If,"featureReduce");function Bf(n){var e=[];return Vt(n,function(r){e.push(r)}),e}he(Bf,"coordAll");function An(n,e){var r,t,o,i,s,l,a,u,c,f,d=0,p=n.type==="FeatureCollection",m=n.type==="Feature",_=p?n.features.length:1;for(r=0;r<_;r++){for(l=p?n.features[r].geometry:m?n.geometry:n,u=p?n.features[r].properties:m?n.properties:{},c=p?n.features[r].bbox:m?n.bbox:void 0,f=p?n.features[r].id:m?n.id:void 0,a=l?l.type==="GeometryCollection":!1,s=a?l.geometries.length:1,o=0;o<s;o++){if(i=a?l.geometries[o]:l,i===null){if(e(null,d,u,c,f)===!1)return!1;continue}switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(i,d,u,c,f)===!1)return!1;break}case"GeometryCollection":{for(t=0;t<i.geometries.length;t++)if(e(i.geometries[t],d,u,c,f)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}d++}}he(An,"geomEach");function jf(n,e,r){var t=r;return An(n,function(o,i,s,l,a){i===0&&r===void 0?t=o:t=e(t,o,i,s,l,a)}),t}he(jf,"geomReduce");function Qt(n,e){An(n,function(r,t,o,i,s){var l=r===null?null:r.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(gr(r,o,{bbox:i,id:s}),t,0)===!1?!1:void 0}var a;switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<r.coordinates.length;u++){var c=r.coordinates[u],f={type:a,coordinates:c};if(e(gr(f,o),t,u)===!1)return!1}})}he(Qt,"flattenEach");function Df(n,e,r){var t=r;return Qt(n,function(o,i,s){i===0&&s===0&&r===void 0?t=o:t=e(t,o,i,s)}),t}he(Df,"flattenReduce");function xo(n,e){Qt(n,function(r,t,o){var i=0;if(r.geometry){var s=r.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,a=0,u=0,c=0;if(Vt(r,function(f,d,p,m,_){if(l===void 0||t>a||m>u||_>c){l=f,a=t,u=m,c=_,i=0;return}var v=rt([l,f],r.properties);if(e(v,t,o,_,i)===!1)return!1;i++,l=f})===!1)return!1}}})}he(xo,"segmentEach");function Gf(n,e,r){var t=r,o=!1;return xo(n,function(i,s,l,a,u){o===!1&&r===void 0?t=i:t=e(t,i,s,l,a,u),o=!0}),t}he(Gf,"segmentReduce");function es(n,e){if(!n)throw new Error("geojson is required");Qt(n,function(r,t,o){if(r.geometry!==null){var i=r.geometry.type,s=r.geometry.coordinates;switch(i){case"LineString":if(e(r,t,o,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(e(rt(s[l],r.properties),t,o,l)===!1)return!1;break}}})}he(es,"lineEach");function Tf(n,e,r){var t=r;return es(n,function(o,i,s,l){i===0&&r===void 0?t=o:t=e(t,o,i,s,l)}),t}he(Tf,"lineReduce");function Uf(n,e){if(e=e||{},!to(e))throw new Error("options is invalid");var r=e.featureIndex||0,t=e.multiFeatureIndex||0,o=e.geometryIndex||0,i=e.segmentIndex||0,s=e.properties,l;switch(n.type){case"FeatureCollection":r<0&&(r=n.features.length+r),s=s||n.features[r].properties,l=n.features[r].geometry;break;case"Feature":s=s||n.properties,l=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=n;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var a=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return i<0&&(i=a.length+i-1),rt([a[i],a[i+1]],s,e);case"Polygon":return o<0&&(o=a.length+o),i<0&&(i=a[o].length+i-1),rt([a[o][i],a[o][i+1]],s,e);case"MultiLineString":return t<0&&(t=a.length+t),i<0&&(i=a[t].length+i-1),rt([a[t][i],a[t][i+1]],s,e);case"MultiPolygon":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),i<0&&(i=a[t][o].length-i-1),rt([a[t][o][i],a[t][o][i+1]],s,e)}throw new Error("geojson is invalid")}he(Uf,"findSegment");function zf(n,e){if(e=e||{},!to(e))throw new Error("options is invalid");var r=e.featureIndex||0,t=e.multiFeatureIndex||0,o=e.geometryIndex||0,i=e.coordIndex||0,s=e.properties,l;switch(n.type){case"FeatureCollection":r<0&&(r=n.features.length+r),s=s||n.features[r].properties,l=n.features[r].geometry;break;case"Feature":s=s||n.properties,l=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=n;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var a=l.coordinates;switch(l.type){case"Point":return Fe(a,s,e);case"MultiPoint":return t<0&&(t=a.length+t),Fe(a[t],s,e);case"LineString":return i<0&&(i=a.length+i),Fe(a[i],s,e);case"Polygon":return o<0&&(o=a.length+o),i<0&&(i=a[o].length+i),Fe(a[o][i],s,e);case"MultiLineString":return t<0&&(t=a.length+t),i<0&&(i=a[t].length+i),Fe(a[t][i],s,e);case"MultiPolygon":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),i<0&&(i=a[t][o].length-i),Fe(a[t][o][i],s,e)}throw new Error("geojson is invalid")}he(zf,"findPoint");var ts=Object.defineProperty,qf=Object.defineProperties,Yf=Object.getOwnPropertyDescriptors,Ii=Object.getOwnPropertySymbols,Xf=Object.prototype.hasOwnProperty,Jf=Object.prototype.propertyIsEnumerable,Bi=(n,e,r)=>e in n?ts(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,pt=(n,e)=>{for(var r in e||(e={}))Xf.call(e,r)&&Bi(n,r,e[r]);if(Ii)for(var r of Ii(e))Jf.call(e,r)&&Bi(n,r,e[r]);return n},ht=(n,e)=>qf(n,Yf(e)),Kf=(n,e)=>ts(n,"name",{value:e,configurable:!0});function rs(n,e,r={}){if(!n||!e)throw new Error("lines and pt are required arguments");let t=Fe([1/0,1/0],{dist:1/0,index:-1,location:-1}),o=0;return Qt(n,function(i){const s=Yo(i);for(let l=0;l<s.length-1;l++){const a=Fe(s[l]);a.properties.dist=wt(e,a,r);const u=Fe(s[l+1]);u.properties.dist=wt(e,u,r);const c=wt(a,u,r),f=Math.max(a.properties.dist,u.properties.dist),d=Cn(a,u),p=gn(e,f,d+90,r),m=gn(e,f,d-90,r),_=Zo(rt([p.geometry.coordinates,m.geometry.coordinates]),rt([a.geometry.coordinates,u.geometry.coordinates]));let v;_.features.length>0&&_.features[0]&&(v=ht(pt({},_.features[0]),{properties:{dist:wt(e,_.features[0],r),location:o+wt(a,_.features[0],r)}})),a.properties.dist<t.properties.dist&&(t=ht(pt({},a),{properties:ht(pt({},a.properties),{index:l,location:o})})),u.properties.dist<t.properties.dist&&(t=ht(pt({},u),{properties:ht(pt({},u.properties),{index:l+1,location:o+c})})),v&&v.properties.dist<t.properties.dist&&(t=ht(pt({},v),{properties:ht(pt({},v.properties),{index:l})})),o+=c}}),t}Kf(rs,"nearestPointOnLine");var Wf=rs;const ns="/atip/manage_files/assets/split_route-9e0ea2da.svg";function Hf(n){let e,r;const t=[Z(n[0],"draw-split-route"),{paint:{"circle-color":"black","circle-radius":ji}}];let o={};for(let i=0;i<t.length;i+=1)o=fe(o,t[i]);return e=new Mt({props:o}),{c(){P(e.$$.fragment)},m(i,s){L(e,i,s),r=!0},p(i,s){const l=s&1?ce(t,[s&1&&pe(Z(i[0],"draw-split-route")),s&0&&{paint:{"circle-color":"black","circle-radius":ji}}]):{};e.$set(l)},i(i){r||(k(e.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),r=!1},d(i){C(e,i)}}}function Zf(n){let e,r,t,o,i,s;return e=new Js({}),e.$on("mousemove",n[3]),e.$on("click",n[4]),t=new gt({props:{data:n[2],$$slots:{default:[Hf]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(l,a){L(e,l,a),$(l,r,a),L(t,l,a),o=!0,i||(s=Ce(window,"keydown",n[5]),i=!0)},p(l,[a]){const u={};a&4&&(u.data=l[2]),a&2049&&(u.$$scope={dirty:a,ctx:l}),t.$set(u)},i(l){o||(k(e.$$.fragment,l),k(t.$$.fragment,l),o=!0)},o(l){E(e.$$.fragment,l),E(t.$$.fragment,l),o=!1},d(l){l&&w(r),C(e,l),C(t,l),i=!1,s()}}}const ji=10,Vf=30;function Qf(n,e,r){let t,o=H,i=()=>(o(),o=_t(a,v=>r(8,t=v)),a),s;X(n,Ie,v=>r(9,s=v)),n.$$.on_destroy.push(()=>o());let{cfg:l}=e,{gjSchemes:a}=e;i(),Xe(()=>{s&&(s.getCanvas().style.cursor=`url(${ns}), crosshair`)}),Be(()=>{s&&(s.getCanvas().style.cursor="inherit")});let u=null,c=null,f=Et();function d(v){if(!s)return;r(6,u=null),c=null;let y=_(v.detail.lngLat.toArray());const h=[v.detail.point.x-Vf,v.detail.point.y],g=s.unproject(v.detail.point).distanceTo(s.unproject(h))/1e3;let S=[];for(let[b,A]of t.features.entries())if(A.geometry.type=="LineString"){let F=Wf(A.geometry,y,{units:"kilometers"});F.properties.dist!=null&&F.properties.dist<=g&&S.push([b,F.geometry.coordinates,F.properties.dist])}S.sort((b,A)=>b[2]-A[2]),S.length>0&&(r(6,u=_(S[0][1])),c=S[0][0])}function p(){if(c==null){W.set({mode:"list"});return}let v=la(t.features[c],u);if(v!=null){let[y,h]=v;a.update(g=>(y.id=g.features[c].id,h.id=Kt(g),g.features.splice(c,1,y,h),g))}r(6,u=null),c=null}function m(v){v.key=="Escape"&&(v.stopPropagation(),W.set({mode:"list"}))}function _(v){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:xi(v)}}}return n.$$set=v=>{"cfg"in v&&r(0,l=v.cfg),"gjSchemes"in v&&i(r(1,a=v.gjSchemes))},n.$$.update=()=>{if(n.$$.dirty&64){let v=Et();u&&v.features.push(u),r(2,f=v)}},[l,a,f,d,p,m,u]}class xf extends Q{constructor(e){super(),x(this,e,Qf,Zf,V,{cfg:0,gjSchemes:1})}}function ec(n){let e;return{c(){e=T("Finish")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function tc(n){let e,r,t,o,i,s,l,a,u,c;function f(_){n[4](_)}let d={cfg:n[0],map:n[2],showControls:!1};n[1]!==void 0&&(d.enabled=n[1]),e=new Fs({props:d}),ye.push(()=>Me(e,"enabled",f)),o=new Qe({props:{$$slots:{default:[ec]},$$scope:{ctx:n}}}),o.$on("click",n[5]);function p(_){n[6](_)}let m={label:"Source",choices:[["google","Google Street View"],["bing","Bing Streetside"]],inlineSmall:!0};return n[3].streetViewImagery!==void 0&&(m.value=n[3].streetViewImagery),s=new vs({props:m}),ye.push(()=>Me(s,"value",p)),u=new Rs({}),{c(){P(e.$$.fragment),t=O(),P(o.$$.fragment),i=O(),P(s.$$.fragment),a=O(),P(u.$$.fragment)},m(_,v){L(e,_,v),$(_,t,v),L(o,_,v),$(_,i,v),L(s,_,v),$(_,a,v),L(u,_,v),c=!0},p(_,[v]){const y={};v&1&&(y.cfg=_[0]),v&4&&(y.map=_[2]),!r&&v&2&&(r=!0,y.enabled=_[1],Le(()=>r=!1)),e.$set(y);const h={};v&128&&(h.$$scope={dirty:v,ctx:_}),o.$set(h);const g={};!l&&v&8&&(l=!0,g.value=_[3].streetViewImagery,Le(()=>l=!1)),s.$set(g)},i(_){c||(k(e.$$.fragment,_),k(o.$$.fragment,_),k(s.$$.fragment,_),k(u.$$.fragment,_),c=!0)},o(_){E(e.$$.fragment,_),E(o.$$.fragment,_),E(s.$$.fragment,_),E(u.$$.fragment,_),c=!1},d(_){_&&(w(t),w(i),w(a)),C(e,_),C(o,_),C(s,_),C(u,_)}}}function rc(n,e,r){let t,o;X(n,Ie,c=>r(2,t=c)),X(n,dr,c=>r(3,o=c));let{cfg:i}=e,s=!0;function l(c){s=c,r(1,s)}const a=()=>r(1,s=!1);function u(c){n.$$.not_equal(o.streetViewImagery,c)&&(o.streetViewImagery=c,dr.set(o))}return n.$$set=c=>{"cfg"in c&&r(0,i=c.cfg)},n.$$.update=()=>{n.$$.dirty&2&&(s||W.set({mode:"list"}))},[i,s,t,o,l,a,u]}class nc extends Q{constructor(e){super(),x(this,e,rc,tc,V,{cfg:0})}}const ic="/atip/manage_files/assets/image-3e3a13e8.svg",oc="/atip/manage_files/assets/point-276f4055.svg",sc="/atip/manage_files/assets/polygon_freehand-cf965967.svg",lc="/atip/manage_files/assets/polygon_snapped-18efbbea.svg",ac="/atip/manage_files/assets/route-d3c0ebad.svg",uc="/atip/manage_files/assets/street_view-48580b6a.svg";function fc(n){let e,r,t;return{c(){e=j("img"),t=T(`
    New point`),at(e.src,r=oc)||Y(e,"src",r),Y(e,"alt","New point")},m(o,i){$(o,e,i),$(o,t,i)},p:H,d(o){o&&(w(e),w(t))}}}function cc(n){let e,r,t;return{c(){e=j("img"),t=T(`
    New route`),at(e.src,r=ac)||Y(e,"src",r),Y(e,"alt","New route")},m(o,i){$(o,e,i),$(o,t,i)},p:H,d(o){o&&(w(e),w(t))}}}function pc(n){let e,r,t;return{c(){e=j("img"),t=T(`
    New polygon (freehand)`),at(e.src,r=sc)||Y(e,"src",r),Y(e,"alt","New polygon (freehand)")},m(o,i){$(o,e,i),$(o,t,i)},p:H,d(o){o&&(w(e),w(t))}}}function hc(n){let e,r,t;return{c(){e=j("img"),t=T(`
    New polygon (snapped)`),at(e.src,r=lc)||Y(e,"src",r),Y(e,"alt","New polygon (snapped)")},m(o,i){$(o,e,i),$(o,t,i)},p:H,d(o){o&&(w(e),w(t))}}}function dc(n){let e,r,t;return{c(){e=j("img"),t=T(`
    Split route`),at(e.src,r=ns)||Y(e,"src",r),Y(e,"alt","Split route")},m(o,i){$(o,e,i),$(o,t,i)},p:H,d(o){o&&(w(e),w(t))}}}function mc(n){let e,r,t;return{c(){e=j("img"),t=T(`
    Georeference image`),at(e.src,r=ic)||Y(e,"src",r),Y(e,"alt","Georeference image")},m(o,i){$(o,e,i),$(o,t,i)},p:H,d(o){o&&(w(e),w(t))}}}function gc(n){let e,r,t;return{c(){e=j("img"),t=T(`
    StreetView`),at(e.src,r=uc)||Y(e,"src",r),Y(e,"alt","StreetView")},m(o,i){$(o,e,i),$(o,t,i)},p:H,d(o){o&&(w(e),w(t))}}}function _c(n){let e,r,t,o,i,s,l,a,u,c,f,d,p,m,_,v,y;return e=new zu({props:{cfg:n[0],gjSchemes:n[1]}}),o=new ct({props:{disabled:!n[2],$$slots:{default:[fc]},$$scope:{ctx:n}}}),o.$on("click",n[5]),s=new ct({props:{disabled:!n[3],$$slots:{default:[cc]},$$scope:{ctx:n}}}),s.$on("click",n[6]),a=new ct({props:{disabled:!n[4],$$slots:{default:[pc]},$$scope:{ctx:n}}}),a.$on("click",n[7]),c=new ct({props:{disabled:!n[3],$$slots:{default:[hc]},$$scope:{ctx:n}}}),c.$on("click",n[8]),d=new ct({props:{$$slots:{default:[dc]},$$scope:{ctx:n}}}),d.$on("click",n[9]),m=new ct({props:{$$slots:{default:[mc]},$$scope:{ctx:n}}}),m.$on("click",n[10]),v=new ct({props:{$$slots:{default:[gc]},$$scope:{ctx:n}}}),v.$on("click",n[11]),{c(){P(e.$$.fragment),r=O(),t=j("div"),P(o.$$.fragment),i=O(),P(s.$$.fragment),l=O(),P(a.$$.fragment),u=O(),P(c.$$.fragment),f=O(),P(d.$$.fragment),p=O(),P(m.$$.fragment),_=O(),P(v.$$.fragment),Y(t,"class","top govuk-prose svelte-11p79x5")},m(h,g){L(e,h,g),$(h,r,g),$(h,t,g),L(o,t,null),G(t,i),L(s,t,null),G(t,l),L(a,t,null),G(t,u),L(c,t,null),G(t,f),L(d,t,null),G(t,p),L(m,t,null),G(t,_),L(v,t,null),y=!0},p(h,[g]){const S={};g&1&&(S.cfg=h[0]),g&2&&(S.gjSchemes=h[1]),e.$set(S);const b={};g&4&&(b.disabled=!h[2]),g&4096&&(b.$$scope={dirty:g,ctx:h}),o.$set(b);const A={};g&8&&(A.disabled=!h[3]),g&4096&&(A.$$scope={dirty:g,ctx:h}),s.$set(A);const F={};g&16&&(F.disabled=!h[4]),g&4096&&(F.$$scope={dirty:g,ctx:h}),a.$set(F);const B={};g&8&&(B.disabled=!h[3]),g&4096&&(B.$$scope={dirty:g,ctx:h}),c.$set(B);const D={};g&4096&&(D.$$scope={dirty:g,ctx:h}),d.$set(D);const I={};g&4096&&(I.$$scope={dirty:g,ctx:h}),m.$set(I);const M={};g&4096&&(M.$$scope={dirty:g,ctx:h}),v.$set(M)},i(h){y||(k(e.$$.fragment,h),k(o.$$.fragment,h),k(s.$$.fragment,h),k(a.$$.fragment,h),k(c.$$.fragment,h),k(d.$$.fragment,h),k(m.$$.fragment,h),k(v.$$.fragment,h),y=!0)},o(h){E(e.$$.fragment,h),E(o.$$.fragment,h),E(s.$$.fragment,h),E(a.$$.fragment,h),E(c.$$.fragment,h),E(d.$$.fragment,h),E(m.$$.fragment,h),E(v.$$.fragment,h),y=!1},d(h){h&&(w(r),w(t)),C(e,h),C(o),C(s),C(a),C(c),C(d),C(m),C(v)}}}function vc(n,e,r){let t,o,i;X(n,qt,_=>r(2,t=_)),X(n,Ve,_=>r(3,o=_)),X(n,St,_=>r(4,i=_));let{cfg:s}=e,{gjSchemes:l}=e;const a=()=>W.set({mode:"new-point"}),u=()=>W.set({mode:"new-route"}),c=()=>W.set({mode:"new-freehand-polygon"}),f=()=>W.set({mode:"new-snapped-polygon"}),d=()=>W.set({mode:"split-route"}),p=()=>W.set({mode:"set-image"}),m=()=>W.set({mode:"streetview"});return n.$$set=_=>{"cfg"in _&&r(0,s=_.cfg),"gjSchemes"in _&&r(1,l=_.gjSchemes)},[s,l,t,o,i,a,u,c,f,d,p,m]}class bc extends Q{constructor(e){super(),x(this,e,vc,_c,V,{cfg:0,gjSchemes:1})}}function Di(n){let e,r,t,o,i,s,l,a,u,c,f,d,p,m,_,v,y,h,g,S,b,A,F,B,D,I,M;return B=new ue({props:{style:"margin-bottom: 8px",$$slots:{default:[yc]},$$scope:{ctx:n}}}),B.$on("click",n[7]),{c(){e=j("nav"),r=j("ol"),t=j("li"),o=j("a"),i=T("Change area"),l=O(),a=j("li"),u=j("a"),c=T("Manage files"),d=O(),p=j("li"),p.textContent="Sketch",m=O(),_=j("div"),v=j("div"),y=j("b"),y.textContent="You are editing",h=O(),g=j("br"),S=O(),b=j("span"),A=T(n[2]),F=O(),P(B.$$.fragment),D=O(),I=j("a"),I.textContent="Open Scheme Browser",Y(o,"class","govuk-breadcrumbs__link"),Y(o,"href",s=`index.html?scheme=${n[5]}`),Y(t,"class","govuk-breadcrumbs__list-item"),Y(u,"class","govuk-breadcrumbs__link"),Y(u,"href",f="files.html?authority="+n[1]+"&schema="+n[5]),Y(a,"class","govuk-breadcrumbs__list-item"),Y(p,"class","govuk-breadcrumbs__list-item"),Y(r,"class","govuk-breadcrumbs__list"),Y(e,"class","govuk-breadcrumbs"),Y(e,"aria-label","Breadcrumb"),ie(_,"display","flex"),ie(_,"justify-content","space-between"),Y(I,"href","browse.html"),Y(I,"target","_blank")},m(N,R){$(N,e,R),G(e,r),G(r,t),G(t,o),G(o,i),G(r,l),G(r,a),G(a,u),G(u,c),G(r,d),G(r,p),$(N,m,R),$(N,_,R),G(_,v),G(v,y),G(v,h),G(v,g),G(v,S),G(v,b),G(b,A),G(_,F),L(B,_,null),$(N,D,R),$(N,I,R),M=!0},p(N,R){(!M||R&32&&s!==(s=`index.html?scheme=${N[5]}`))&&Y(o,"href",s),(!M||R&34&&f!==(f="files.html?authority="+N[1]+"&schema="+N[5]))&&Y(u,"href",f),(!M||R&4)&&me(A,N[2]);const U={};R&512&&(U.$$scope={dirty:R,ctx:N}),B.$set(U)},i(N){M||(k(B.$$.fragment,N),M=!0)},o(N){E(B.$$.fragment,N),M=!1},d(N){N&&(w(e),w(m),w(_),w(D),w(I)),C(B)}}}function yc(n){let e;return{c(){e=T("Export")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function $c(n){let e,r,t=n[4].mode=="list"&&Di(n);return{c(){t&&t.c(),e=le()},m(o,i){t&&t.m(o,i),$(o,e,i),r=!0},p(o,[i]){o[4].mode=="list"?t?(t.p(o,i),i&16&&k(t,1)):(t=Di(o),t.c(),k(t,1),t.m(e.parentNode,e)):t&&(te(),E(t,1,1,()=>{t=null}),re())},i(o){r||(k(t),r=!0)},o(o){E(t),r=!1},d(o){o&&w(e),t&&t.d(o)}}}function wc(n,e,r){let t,o=H,i=()=>(o(),o=_t(a,m=>r(3,t=m)),a),s,l;X(n,W,m=>r(4,s=m)),X(n,ro,m=>r(5,l=m)),n.$$.on_destroy.push(()=>o());let{gjSchemes:a}=e;i();let{authority:u}=e,{filename:c}=e,f=ys(u,c),d=!1;Xe(()=>{try{let m=JSON.parse(window.localStorage.getItem(f)||"");a.set(Qs(m))}catch(m){console.log(`Failed to load from local storage: ${m}`)}r(6,d=!0)});const p=()=>$s(u,c,t);return n.$$set=m=>{"gjSchemes"in m&&i(r(0,a=m.gjSchemes)),"authority"in m&&r(1,u=m.authority),"filename"in m&&r(2,c=m.filename)},n.$$.update=()=>{n.$$.dirty&74&&d&&t&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(f,JSON.stringify(bs(u,t))))},[a,u,c,t,s,l,d,p]}class kc extends Q{constructor(e){super(),x(this,e,wc,$c,V,{gjSchemes:0,authority:1,filename:2})}}function Sc(n){let e;return{c(){e=T("Save")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Ec(n){let e;return{c(){e=T("Edit geometry")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Mc(n){let e;return{c(){e=T("Delete")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Pc(n){let e,r,t,o,i,s;return e=new Qe({props:{$$slots:{default:[Sc]},$$scope:{ctx:n}}}),e.$on("click",n[5]),t=new ue({props:{$$slots:{default:[Ec]},$$scope:{ctx:n}}}),t.$on("click",n[6]),i=new jr({props:{$$slots:{default:[Mc]},$$scope:{ctx:n}}}),i.$on("click",n[7]),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment),o=O(),P(i.$$.fragment)},m(l,a){L(e,l,a),$(l,r,a),L(t,l,a),$(l,o,a),L(i,l,a),s=!0},p(l,a){const u={};a&8192&&(u.$$scope={dirty:a,ctx:l}),e.$set(u);const c={};a&8192&&(c.$$scope={dirty:a,ctx:l}),t.$set(c);const f={};a&8192&&(f.$$scope={dirty:a,ctx:l}),i.$set(f)},i(l){s||(k(e.$$.fragment,l),k(t.$$.fragment,l),k(i.$$.fragment,l),s=!0)},o(l){E(e.$$.fragment,l),E(t.$$.fragment,l),E(i.$$.fragment,l),s=!1},d(l){l&&(w(r),w(o)),C(e,l),C(t,l),C(i,l)}}}function Lc(n){let e,r,t=n[0].interventionName(n[3])+"",o,i,s,l,a,u,c,f,d,p,m,_;s=new ut({props:{$$slots:{default:[Pc]},$$scope:{ctx:n}}}),a=new Wt({props:{errorMessage:n[0].interventionWarning(n[3])}});function v(g){n[8](g)}var y=n[0].editFeatureForm;function h(g,S){let b={cfg:g[0],gjSchemes:g[1],id:g[2]};return g[3].properties!==void 0&&(b.props=g[3].properties),{props:b}}return y&&(c=_r(y,h(n)),ye.push(()=>Me(c,"props",v))),{c(){e=j("h2"),r=T("Editing "),o=T(t),i=O(),P(s.$$.fragment),l=O(),P(a.$$.fragment),u=O(),c&&P(c.$$.fragment),d=le()},m(g,S){$(g,e,S),G(e,r),G(e,o),$(g,i,S),L(s,g,S),$(g,l,S),L(a,g,S),$(g,u,S),c&&L(c,g,S),$(g,d,S),p=!0,m||(_=Ce(window,"keydown",n[4]),m=!0)},p(g,[S]){(!p||S&9)&&t!==(t=g[0].interventionName(g[3])+"")&&me(o,t);const b={};S&8198&&(b.$$scope={dirty:S,ctx:g}),s.$set(b);const A={};if(S&9&&(A.errorMessage=g[0].interventionWarning(g[3])),a.$set(A),S&1&&y!==(y=g[0].editFeatureForm)){if(c){te();const F=c;E(F.$$.fragment,1,0,()=>{C(F,1)}),re()}y?(c=_r(y,h(g)),ye.push(()=>Me(c,"props",v)),P(c.$$.fragment),k(c.$$.fragment,1),L(c,d.parentNode,d)):c=null}else if(y){const F={};S&1&&(F.cfg=g[0]),S&2&&(F.gjSchemes=g[1]),S&4&&(F.id=g[2]),!f&&S&8&&(f=!0,F.props=g[3].properties,Le(()=>f=!1)),c.$set(F)}},i(g){p||(k(s.$$.fragment,g),k(a.$$.fragment,g),c&&k(c.$$.fragment,g),p=!0)},o(g){E(s.$$.fragment,g),E(a.$$.fragment,g),c&&E(c.$$.fragment,g),p=!1},d(g){g&&(w(e),w(i),w(l),w(u),w(d)),C(s,g),C(a,g),c&&C(c,g),m=!1,_()}}}function Cc(n,e,r){let t,o,i=H,s=()=>(i(),i=_t(a,h=>r(10,o=h)),a);X(n,Ie,h=>r(9,t=h)),n.$$.on_destroy.push(()=>i());let{cfg:l}=e,{gjSchemes:a}=e;s();let{id:u}=e,c=o.features.find(h=>h.id==u);function f(h){a.set(o)}Xe(()=>{t==null||t.on("click",d)}),Be(()=>{t==null||t.off("click",d)});function d(h){for(let g of t.queryRenderedFeatures(h.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]}))if(g.id==u)return;W.set({mode:"list"})}function p(h){if(h.key=="Escape"){h.stopPropagation(),W.set({mode:"list"});return}if(h.key=="Delete"){const g=h.target.tagName;if(g=="INPUT"||g=="TEXTAREA")return;h.stopPropagation(),On(a,u)}if(h.key=="e"){const g=h.target.tagName;if(g=="INPUT"||g=="TEXTAREA")return;h.stopPropagation(),W.set({mode:"edit-geometry",id:u})}}const m=()=>W.set({mode:"list"}),_=()=>W.set({mode:"edit-geometry",id:u}),v=()=>On(a,u);function y(h){n.$$.not_equal(c.properties,h)&&(c.properties=h,r(3,c))}return n.$$set=h=>{"cfg"in h&&r(0,l=h.cfg),"gjSchemes"in h&&s(r(1,a=h.gjSchemes)),"id"in h&&r(2,u=h.id)},n.$$.update=()=>{n.$$.dirty&8&&f()},[l,a,u,c,p,m,_,v,y]}class Ac extends Q{constructor(e){super(),x(this,e,Cc,Lc,V,{cfg:0,gjSchemes:1,id:2})}}const Fc="/atip/manage_files/assets/delete-3c023172.svg";function Gi(n,e,r){const t=n.slice();t[34]=e[r];const o=t[0].interventionWarning(t[34]);return t[35]=o,t}function Rc(n){let e,r=n[0].schemeName(n[3].schemes[n[2]])+"",t;return{c(){e=j("b"),t=T(r)},m(o,i){$(o,e,i),G(e,t)},p(o,i){i[0]&13&&r!==(r=o[0].schemeName(o[3].schemes[o[2]])+"")&&me(t,r)},d(o){o&&w(e)}}}function Nc(n){let e,r,t;function o(s){n[18](s)}let i={$$slots:{default:[Rc]},$$scope:{ctx:n}};return n[7]!==void 0&&(i.checked=n[7]),e=new Zr({props:i}),ye.push(()=>Me(e,"checked",o)),e.$on("change",n[15]),{c(){P(e.$$.fragment)},m(s,l){L(e,s,l),t=!0},p(s,l){const a={};l[0]&13|l[1]&1&&(a.$$scope={dirty:l,ctx:s}),!r&&l[0]&128&&(r=!0,a.checked=s[7],Le(()=>r=!1)),e.$set(a)},i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){E(e.$$.fragment,s),t=!1},d(s){C(e,s)}}}function Oc(n){let e;return{c(){e=T("Edit")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Ti(n){let e,r,t,o,i,s=[],l=new Map,a;const u=[Bc,Ic],c=[];function f(_,v){return _[9]==1?0:_[9]>0?1:-1}~(e=f(n))&&(r=c[e]=u[e](n));let d=n[8]==0&&Ui(),p=st(n[3].features.filter(n[21]));const m=_=>_[34].id;for(let _=0;_<p.length;_+=1){let v=Gi(n,p,_),y=m(v);l.set(y,s[_]=qi(y,v))}return{c(){r&&r.c(),t=O(),d&&d.c(),o=O(),i=j("ol");for(let _=0;_<s.length;_+=1)s[_].c();Y(i,"class","govuk-list govuk-list--number")},m(_,v){~e&&c[e].m(_,v),$(_,t,v),d&&d.m(_,v),$(_,o,v),$(_,i,v);for(let y=0;y<s.length;y+=1)s[y]&&s[y].m(i,null);a=!0},p(_,v){let y=e;e=f(_),e===y?~e&&c[e].p(_,v):(r&&(te(),E(c[y],1,1,()=>{c[y]=null}),re()),~e?(r=c[e],r?r.p(_,v):(r=c[e]=u[e](_),r.c()),k(r,1),r.m(t.parentNode,t)):r=null),_[8]==0?d||(d=Ui(),d.c(),d.m(o.parentNode,o)):d&&(d.d(1),d=null),v[0]&3085&&(p=st(_[3].features.filter(_[21])),te(),s=_n(s,v,m,1,_,p,l,i,vn,qi,null,Gi),re())},i(_){if(!a){k(r);for(let v=0;v<p.length;v+=1)k(s[v]);a=!0}},o(_){E(r);for(let v=0;v<s.length;v+=1)E(s[v]);a=!1},d(_){_&&(w(t),w(o),w(i)),~e&&c[e].d(_),d&&d.d(_);for(let v=0;v<s.length;v+=1)s[v].d()}}}function Ic(n){let e,r;return e=new Wt({props:{errorMessage:"There's a problem with "+n[9]+" interventions below"}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o[0]&512&&(i.errorMessage="There's a problem with "+t[9]+" interventions below"),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Bc(n){let e,r;return e=new Wt({props:{errorMessage:"There's a problem with one intervention below"}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p:H,i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Ui(n){let e;return{c(){e=j("p"),e.textContent="There are no interventions in this scheme"},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function zi(n){let e,r;return e=new Ns({props:{text:n[35]}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o[0]&13&&(i.text=t[35]),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function qi(n,e){let r,t,o,i=e[0].interventionName(e[34])+"",s,l,a,u,c,f=e[35]&&zi(e);function d(..._){return e[22](e[34],..._)}function p(){return e[23](e[34])}function m(){return e[24](e[34])}return{key:n,first:null,c(){r=j("li"),t=j("a"),f&&f.c(),o=O(),s=T(i),l=O(),Y(t,"href","#"),this.first=r},m(_,v){$(_,r,v),G(r,t),f&&f.m(t,null),G(t,o),G(t,s),G(r,l),a=!0,u||(c=[Ce(t,"click",d),Ce(t,"mouseenter",p),Ce(t,"mouseleave",m)],u=!0)},p(_,v){e=_,e[35]?f?(f.p(e,v),v[0]&13&&k(f,1)):(f=zi(e),f.c(),k(f,1),f.m(t,o)):f&&(te(),E(f,1,1,()=>{f=null}),re()),(!a||v[0]&13)&&i!==(i=e[0].interventionName(e[34])+"")&&me(s,i)},i(_){a||(k(f),a=!0)},o(_){E(f),a=!1},d(_){_&&w(r),f&&f.d(),u=!1,bn(c)}}}function Yi(n){let e,r,t;var o=n[0].editSchemeForm;function i(s,l){return{props:{gjSchemes:s[1],scheme_reference:s[2]}}}return o&&(e=_r(o,i(n))),{c(){e&&P(e.$$.fragment),r=le()},m(s,l){e&&L(e,s,l),$(s,r,l),t=!0},p(s,l){if(l[0]&1&&o!==(o=s[0].editSchemeForm)){if(e){te();const a=e;E(a.$$.fragment,1,0,()=>{C(a,1)}),re()}o?(e=_r(o,i(s)),P(e.$$.fragment),k(e.$$.fragment,1),L(e,r.parentNode,r)):e=null}else if(o){const a={};l[0]&2&&(a.gjSchemes=s[1]),l[0]&4&&(a.scheme_reference=s[2]),e.$set(a)}},i(s){t||(e&&k(e.$$.fragment,s),t=!0)},o(s){e&&E(e.$$.fragment,s),t=!1},d(s){s&&w(r),e&&C(e,s)}}}function jc(n){let e;return{c(){e=T("Save changes")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Dc(n){let e,r,t;return{c(){e=j("img"),t=T(`
      Delete`),at(e.src,r=Fc)||Y(e,"src",r),Y(e,"alt","Delete scheme")},m(o,i){$(o,e,i),$(o,t,i)},p:H,d(o){o&&(w(e),w(t))}}}function Gc(n){let e,r,t,o;return e=new Qe({props:{$$slots:{default:[jc]},$$scope:{ctx:n}}}),e.$on("click",n[25]),t=new jr({props:{$$slots:{default:[Dc]},$$scope:{ctx:n}}}),t.$on("click",n[26]),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(i,s){L(e,i,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s[1]&1&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s[1]&1&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),o=!1},d(i){i&&w(r),C(e,i),C(t,i)}}}function Tc(n){let e,r,t,o=n[4]&&Yi(n);return r=new ut({props:{$$slots:{default:[Gc]},$$scope:{ctx:n}}}),{c(){o&&o.c(),e=O(),P(r.$$.fragment)},m(i,s){o&&o.m(i,s),$(i,e,s),L(r,i,s),t=!0},p(i,s){i[4]?o?(o.p(i,s),s[0]&16&&k(o,1)):(o=Yi(i),o.c(),k(o,1),o.m(e.parentNode,e)):o&&(te(),E(o,1,1,()=>{o=null}),re());const l={};s[0]&48|s[1]&1&&(l.$$scope={dirty:s,ctx:i}),r.$set(l)},i(i){t||(k(o),k(r.$$.fragment,i),t=!0)},o(i){E(o),E(r.$$.fragment,i),t=!1},d(i){i&&w(e),o&&o.d(i),C(r,i)}}}function Xi(n){let e,r,t,o,i=n[8]==1?"intervention":"interventions",s,l,a,u,c,f;function d(m){n[28](m)}let p={label:"Move interventions to another scheme",choices:n[14]()};return n[6]!==void 0&&(p.value=n[6]),u=new Bs({props:p}),ye.push(()=>Me(u,"value",d)),u.$on("change",n[13]),{c(){e=j("p"),r=T("Do you want to first move "),t=T(n[8]),o=O(),s=T(i),l=T(" to another scheme?"),a=O(),P(u.$$.fragment)},m(m,_){$(m,e,_),G(e,r),G(e,t),G(e,o),G(e,s),G(e,l),$(m,a,_),L(u,m,_),f=!0},p(m,_){(!f||_[0]&256)&&me(t,m[8]),(!f||_[0]&256)&&i!==(i=m[8]==1?"intervention":"interventions")&&me(s,i);const v={};!c&&_[0]&64&&(c=!0,v.value=m[6],Le(()=>c=!1)),u.$set(v)},i(m){f||(k(u.$$.fragment,m),f=!0)},o(m){E(u.$$.fragment,m),f=!1},d(m){m&&(w(e),w(a)),C(u,m)}}}function Uc(n){let e;return{c(){e=T("Delete scheme")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function zc(n){let e;return{c(){e=T("Cancel")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function qc(n){let e,r,t,o;return e=new jr({props:{$$slots:{default:[Uc]},$$scope:{ctx:n}}}),e.$on("click",n[12]),t=new ue({props:{$$slots:{default:[zc]},$$scope:{ctx:n}}}),t.$on("click",n[29]),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(i,s){L(e,i,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s[1]&1&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s[1]&1&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),o=!1},d(i){i&&w(r),C(e,i),C(t,i)}}}function Yc(n){let e=n[8]>0&&n[14]().length>0,r,t,o,i=e&&Xi(n);return t=new ut({props:{$$slots:{default:[qc]},$$scope:{ctx:n}}}),{c(){i&&i.c(),r=O(),P(t.$$.fragment)},m(s,l){i&&i.m(s,l),$(s,r,l),L(t,s,l),o=!0},p(s,l){l[0]&256&&(e=s[8]>0&&s[14]().length>0),e?i?(i.p(s,l),l[0]&256&&k(i,1)):(i=Xi(s),i.c(),k(i,1),i.m(r.parentNode,r)):i&&(te(),E(i,1,1,()=>{i=null}),re());const a={};l[0]&32|l[1]&1&&(a.$$scope={dirty:l,ctx:s}),t.$set(a)},i(s){o||(k(i),k(t.$$.fragment,s),o=!0)},o(s){E(i),E(t.$$.fragment,s),o=!1},d(s){s&&w(r),i&&i.d(s),C(t,s)}}}function Xc(n){let e,r,t,o,i,s,l,a,u,c,f,d,p,m,_,v,y,h;e=new oo({props:{small:!0,$$slots:{default:[Nc]},$$scope:{ctx:n}}});const g=n[17].default,S=Rr(g,n,n[31],null);a=new ue({props:{noBottomMargin:!0,$$slots:{default:[Oc]},$$scope:{ctx:n}}}),a.$on("click",n[20]);let b=n[7]&&Ti(n);function A(I){n[27](I)}let F={title:"Edit scheme",$$slots:{default:[Tc]},$$scope:{ctx:n}};n[4]!==void 0&&(F.open=n[4]),f=new In({props:F}),ye.push(()=>Me(f,"open",A));function B(I){n[30](I)}let D={title:"Delete this scheme?",displayEscapeButton:!1,$$slots:{default:[Yc]},$$scope:{ctx:n}};return n[5]!==void 0&&(D.open=n[5]),m=new In({props:D}),ye.push(()=>Me(m,"open",B)),{c(){P(e.$$.fragment),r=O(),t=j("div"),o=j("input"),i=O(),s=j("div"),S&&S.c(),l=O(),P(a.$$.fragment),u=O(),b&&b.c(),c=O(),P(f.$$.fragment),p=O(),P(m.$$.fragment),Y(o,"type","color"),ie(t,"display","flex"),ie(t,"justify-content","space-between")},m(I,M){L(e,I,M),$(I,r,M),$(I,t,M),G(t,o),vr(o,n[3].schemes[n[2]].color),G(t,i),G(t,s),S&&S.m(s,null),G(s,l),L(a,s,null),$(I,u,M),b&&b.m(I,M),$(I,c,M),L(f,I,M),$(I,p,M),L(m,I,M),v=!0,y||(h=[Ce(window,"keydown",n[16]),Ce(o,"input",n[19])],y=!0)},p(I,M){const N={};M[0]&141|M[1]&1&&(N.$$scope={dirty:M,ctx:I}),e.$set(N),M[0]&12&&vr(o,I[3].schemes[I[2]].color),S&&S.p&&(!v||M[1]&1)&&Nr(S,g,I,I[31],v?Ir(g,I[31],M,null):Or(I[31]),null);const R={};M[1]&1&&(R.$$scope={dirty:M,ctx:I}),a.$set(R),I[7]?b?(b.p(I,M),M[0]&128&&k(b,1)):(b=Ti(I),b.c(),k(b,1),b.m(c.parentNode,c)):b&&(te(),E(b,1,1,()=>{b=null}),re());const U={};M[0]&55|M[1]&1&&(U.$$scope={dirty:M,ctx:I}),!d&&M[0]&16&&(d=!0,U.open=I[4],Le(()=>d=!1)),f.$set(U);const se={};M[0]&352|M[1]&1&&(se.$$scope={dirty:M,ctx:I}),!_&&M[0]&32&&(_=!0,se.open=I[5],Le(()=>_=!1)),m.$set(se)},i(I){v||(k(e.$$.fragment,I),k(S,I),k(a.$$.fragment,I),k(b),k(f.$$.fragment,I),k(m.$$.fragment,I),v=!0)},o(I){E(e.$$.fragment,I),E(S,I),E(a.$$.fragment,I),E(b),E(f.$$.fragment,I),E(m.$$.fragment,I),v=!1},d(I){I&&(w(r),w(t),w(u),w(c),w(p)),C(e,I),S&&S.d(I),C(a),b&&b.d(I),C(f,I),C(m,I),y=!1,bn(h)}}}function Jc(n,e,r){let t,o,i,s,l=H,a=()=>(l(),l=_t(p,z=>r(3,s=z)),p),u;X(n,lr,z=>r(32,i=z)),X(n,Ie,z=>r(33,u=z)),n.$$.on_destroy.push(()=>l());let{$$slots:c={},$$scope:f}=e,{cfg:d}=e,{gjSchemes:p}=e;a();let{scheme_reference:m}=e,_=!1,v=!1;Be(()=>{sr.set(null)});function y(z,we){z.preventDefault();let Ft=s.features.find(Gr=>Gr.id==we);Ft.geometry.type=="Point"?u==null||u.flyTo({center:Ft.geometry.coordinates,duration:500}):u==null||u.fitBounds(io(Ft),{padding:200,duration:500}),W.set({mode:"edit-form",id:we})}function h(z){sr.update(we=>we==z?null:we)}function g(){p.update(z=>(z.features=z.features.filter(we=>we.properties.scheme_reference!=m),delete z.schemes[m],Object.keys(z.schemes).length==0&&(z=no(d)),z)),lr.update(z=>(z.delete(m),z)),r(5,v=!1)}let S="";function b(){S&&p.update(z=>{for(let we of z.features)we.properties.scheme_reference==m&&(we.properties.scheme_reference=S);return z})}function A(){return Object.values(s.schemes).filter(z=>z.scheme_reference!=m).map(z=>[z.scheme_reference,d.schemeName(z)])}let F=!i.has(m);function B(){lr.update(z=>(F?z.delete(m):z.add(m),z))}function D(z){_&&z.key=="Escape"&&(z.stopPropagation(),r(4,_=!1))}function I(z){F=z,r(7,F)}function M(){s.schemes[m].color=this.value,p.set(s)}const N=()=>r(4,_=!0),R=z=>z.properties.scheme_reference==m,U=(z,we)=>y(we,z.id),se=z=>sr.set(z.id),oe=z=>h(z.id),de=()=>r(4,_=!1),Pe=()=>{r(4,_=!1),r(5,v=!0)};function At(z){_=z,r(4,_)}function xe(z){S=z,r(6,S)}const Je=()=>r(5,v=!1);function ge(z){v=z,r(5,v)}return n.$$set=z=>{"cfg"in z&&r(0,d=z.cfg),"gjSchemes"in z&&a(r(1,p=z.gjSchemes)),"scheme_reference"in z&&r(2,m=z.scheme_reference),"$$scope"in z&&r(31,f=z.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&13&&r(9,t=s.features.filter(z=>z.properties.scheme_reference==m&&d.interventionWarning(z)!=null).length),n.$$.dirty[0]&12&&r(8,o=s.features.filter(z=>z.properties.scheme_reference==m).length)},[d,p,m,s,_,v,S,F,o,t,y,h,g,b,A,B,D,c,I,M,N,R,U,se,oe,de,Pe,At,xe,Je,ge,f]}class Kc extends Q{constructor(e){super(),x(this,e,Jc,Xc,V,{cfg:0,gjSchemes:1,scheme_reference:2},null,[-1,-1])}}function Ji(n,e,r){const t=n.slice();return t[9]=e[r],t[11]=r,t}function Wc(n){let e;return{c(){e=T("Add blank scheme")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Hc(n){let e;return{c(){e=T("↑")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Zc(n){let e;return{c(){e=T("↓")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Vc(n){let e,r,t,o;function i(){return n[7](n[9])}e=new ue({props:{disabled:n[11]==0,noBottomMargin:!0,$$slots:{default:[Hc]},$$scope:{ctx:n}}}),e.$on("click",i);function s(){return n[8](n[9])}return t=new ue({props:{disabled:n[11]==Object.keys(n[3].schemes).length-1,noBottomMargin:!0,$$slots:{default:[Zc]},$$scope:{ctx:n}}}),t.$on("click",s),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(l,a){L(e,l,a),$(l,r,a),L(t,l,a),o=!0},p(l,a){n=l;const u={};a&8&&(u.disabled=n[11]==0),a&4096&&(u.$$scope={dirty:a,ctx:n}),e.$set(u);const c={};a&8&&(c.disabled=n[11]==Object.keys(n[3].schemes).length-1),a&4096&&(c.$$scope={dirty:a,ctx:n}),t.$set(c)},i(l){o||(k(e.$$.fragment,l),k(t.$$.fragment,l),o=!0)},o(l){E(e.$$.fragment,l),E(t.$$.fragment,l),o=!1},d(l){l&&w(r),C(e,l),C(t,l)}}}function Ki(n,e){let r,t,o,i,s;return t=new Kc({props:{cfg:e[0],gjSchemes:e[1],scheme_reference:e[9],$$slots:{default:[Vc]},$$scope:{ctx:e}}}),{key:n,first:null,c(){r=le(),P(t.$$.fragment),o=O(),i=j("hr"),this.first=r},m(l,a){$(l,r,a),L(t,l,a),$(l,o,a),$(l,i,a),s=!0},p(l,a){e=l;const u={};a&1&&(u.cfg=e[0]),a&2&&(u.gjSchemes=e[1]),a&8&&(u.scheme_reference=e[9]),a&4104&&(u.$$scope={dirty:a,ctx:e}),t.$set(u)},i(l){s||(k(t.$$.fragment,l),s=!0)},o(l){E(t.$$.fragment,l),s=!1},d(l){l&&(w(r),w(o),w(i)),C(t,l)}}}function Qc(n){let e,r,t,o,i,s,l,a,u,c,f=[],d=new Map,p;t=new ue({props:{$$slots:{default:[Wc]},$$scope:{ctx:n}}}),t.$on("click",n[4]),i=new ws({props:{label:"Add scheme from file",onLoad:n[5]}}),l=new Wt({props:{errorMessage:n[2]}});let m=st(Object.keys(n[3].schemes));const _=v=>v[9];for(let v=0;v<m.length;v+=1){let y=Ji(n,m,v),h=_(y);d.set(h,f[v]=Ki(h,y))}return{c(){e=j("div"),r=j("div"),P(t.$$.fragment),o=O(),P(i.$$.fragment),s=O(),P(l.$$.fragment),a=O(),u=j("hr"),c=O();for(let v=0;v<f.length;v+=1)f[v].c();ie(r,"display","flex"),ie(r,"justify-content","space-between"),ie(e,"border","1px solid black"),ie(e,"padding","8px")},m(v,y){$(v,e,y),G(e,r),L(t,r,null),G(r,o),L(i,r,null),G(e,s),L(l,e,null),G(e,a),G(e,u),G(e,c);for(let h=0;h<f.length;h+=1)f[h]&&f[h].m(e,null);p=!0},p(v,[y]){const h={};y&4096&&(h.$$scope={dirty:y,ctx:v}),t.$set(h);const g={};y&4&&(g.errorMessage=v[2]),l.$set(g),y&75&&(m=st(Object.keys(v[3].schemes)),te(),f=_n(f,y,_,1,v,m,d,e,vn,Ki,null,Ji),re())},i(v){if(!p){k(t.$$.fragment,v),k(i.$$.fragment,v),k(l.$$.fragment,v);for(let y=0;y<m.length;y+=1)k(f[y]);p=!0}},o(v){E(t.$$.fragment,v),E(i.$$.fragment,v),E(l.$$.fragment,v);for(let y=0;y<f.length;y+=1)E(f[y]);p=!1},d(v){v&&w(e),C(t),C(i),C(l);for(let y=0;y<f.length;y+=1)f[y].d()}}}function xc(n,e,r){[n[e],n[r]]=[n[r],n[e]]}function ep(n,e){const r={};return n.forEach(t=>{r[t]=e[t]}),r}function tp(n,e,r){let t,o=H,i=()=>(o(),o=_t(l,m=>r(3,t=m)),l);n.$$.on_destroy.push(()=>o());let{cfg:s}=e,{gjSchemes:l}=e;i();function a(){ks(s,t),l.set(t)}let u="";function c(m,_){try{let v=s.backfill(JSON.parse(_));for(let h of Object.values(v.schemes)){if(h.scheme_reference in t.schemes)throw new Error("The file you're loading seems to contain duplicate data. Are you merging in the same file accidentally?");Te(l,t.schemes[h.scheme_reference]=h,t)}Te(l,t.features=t.features.concat(v.features),t);let y=1;t.features.forEach(h=>{h.id=y++}),l.set(t),r(2,u="")}catch(v){r(2,u=`Couldn't load scheme from a file: ${v}`)}}function f(m,_){const v=JSON.parse(JSON.stringify(Object.keys(t.schemes))),y=v.indexOf(m);if(y+_>=0&&y+_<v.length){xc(v,y,y+_);const h=ep(v,t.schemes);Te(l,t.schemes=h,t),l.set(t)}}const d=m=>f(m,-1),p=m=>f(m,1);return n.$$set=m=>{"cfg"in m&&r(0,s=m.cfg),"gjSchemes"in m&&i(r(1,l=m.gjSchemes))},[s,l,u,t,a,c,f,d,p]}class rp extends Q{constructor(e){super(),x(this,e,tp,Qc,V,{cfg:0,gjSchemes:1})}}function np(n){let e;return{c(){e=T("Save")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function ip(n){let e;return{c(){e=T("Delete")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function op(n){let e,r,t,o;return e=new Qe({props:{$$slots:{default:[np]},$$scope:{ctx:n}}}),e.$on("click",n[6]),t=new jr({props:{disabled:!n[2],$$slots:{default:[ip]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(i,s){L(e,i,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&512&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&4&&(a.disabled=!i[2]),s&512&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),o=!1},d(i){i&&w(r),C(e,i),C(t,i)}}}function sp(n){let e,r,t;return{c(){e=j("input"),Y(e,"class","govuk-file-upload"),Y(e,"id","load-image"),Y(e,"type","file")},m(o,i){$(o,e,i),n[7](e),r||(t=Ce(e,"change",n[3]),r=!0)},p:H,d(o){o&&w(e),n[7](null),r=!1,t()}}}function Wi(n){let e,r,t,o,i,s,l,a;return{c(){e=j("div"),r=j("label"),t=j("input"),o=T(`
      Opacity: `),i=T(n[1]),s=T("%"),Y(t,"type","range"),Y(t,"min","0"),Y(t,"max","100")},m(u,c){$(u,e,c),G(e,r),G(r,t),vr(t,n[1]),G(r,o),G(r,i),G(r,s),l||(a=[Ce(t,"change",n[8]),Ce(t,"input",n[8])],l=!0)},p(u,c){c&2&&vr(t,u[1]),c&2&&me(i,u[1])},d(u){u&&w(e),l=!1,bn(a)}}}function lp(n){let e,r,t,o,i,s,l,a,u;e=new ut({props:{$$slots:{default:[op]},$$scope:{ctx:n}}}),t=new Ss({props:{label:"Load an image",id:"load-image",$$slots:{default:[sp]},$$scope:{ctx:n}}});let c=n[2]&&Wi(n);return{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment),o=O(),c&&c.c(),i=O(),s=j("p"),s.textContent=`Note this image isn't saved as part of this scheme. When you close this page,
  it'll be lost.`},m(f,d){L(e,f,d),$(f,r,d),L(t,f,d),$(f,o,d),c&&c.m(f,d),$(f,i,d),$(f,s,d),l=!0,a||(u=Ce(window,"keydown",n[5]),a=!0)},p(f,[d]){const p={};d&516&&(p.$$scope={dirty:d,ctx:f}),e.$set(p);const m={};d&513&&(m.$$scope={dirty:d,ctx:f}),t.$set(m),f[2]?c?c.p(f,d):(c=Wi(f),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null)},i(f){l||(k(e.$$.fragment,f),k(t.$$.fragment,f),l=!0)},o(f){E(e.$$.fragment,f),E(t.$$.fragment,f),l=!1},d(f){f&&(w(r),w(o),w(i),w(s)),C(e,f),C(t,f),c&&c.d(f),a=!1,u()}}}function ap(n,e,r){let t,o;X(n,hr,d=>r(1,t=d)),X(n,pr,d=>r(2,o=d));let i;async function s(d){let p=await i.files[0].arrayBuffer(),m=new Blob([new Uint8Array(p)]);Te(pr,o=URL.createObjectURL(m),o)}function l(){Te(pr,o=null,o),Te(hr,t=100,t)}function a(d){d.key=="Escape"&&(d.stopPropagation(),W.set({mode:"list"}))}const u=()=>W.set({mode:"list"});function c(d){ye[d?"unshift":"push"](()=>{i=d,r(0,i)})}function f(){t=Es(this.value),hr.set(t)}return[i,t,o,s,l,a,u,c,f]}class up extends Q{constructor(e){super(),x(this,e,ap,lp,V,{})}}function fp(n){let e;return{c(){e=T("Cancel")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function cp(n){let e,r,t,o;return e=new ue({props:{$$slots:{default:[fp]},$$scope:{ctx:n}}}),e.$on("click",n[0]),t=new Do({props:{editingExisting:!1}}),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(i,s){L(e,i,s),$(i,r,s),L(t,i,s),o=!0},p(i,[s]){const l={};s&32&&(l.$$scope={dirty:s,ctx:i}),e.$set(l)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),o=!1},d(i){i&&w(r),C(e,i),C(t,i)}}}function pp(n,e,r){let t;X(n,qt,a=>r(3,t=a));let{cfg:o}=e,{gjSchemes:i}=e;Xe(()=>{t.start(),t.addEventListenerSuccess(s),t.addEventListenerFailure(l)}),Be(()=>{t.stop(),t.clearEventListeners()});function s(a){a.properties||(a.properties={});let u=a;i.update(c=>(u.id=Kt(c),u.properties.scheme_reference=Br(c),o.newPointFeature(u),c.features.push(u),c)),W.set({mode:"edit-form",id:u.id})}function l(){W.set({mode:"list"})}return n.$$set=a=>{"cfg"in a&&r(1,o=a.cfg),"gjSchemes"in a&&r(2,i=a.gjSchemes)},[l,o,i]}class hp extends Q{constructor(e){super(),x(this,e,pp,cp,V,{cfg:1,gjSchemes:2})}}function dp(n){let e;return{c(){e=T("Finish")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function mp(n){let e;return{c(){e=T("Cancel")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function gp(n){let e,r,t,o;return e=new Qe({props:{$$slots:{default:[dp]},$$scope:{ctx:n}}}),e.$on("click",n[1]),t=new ue({props:{$$slots:{default:[mp]},$$scope:{ctx:n}}}),t.$on("click",n[0]),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(i,s){L(e,i,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&64&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&64&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),o=!1},d(i){i&&w(r),C(e,i),C(t,i)}}}function _p(n){let e,r,t,o;return e=new ut({props:{$$slots:{default:[gp]},$$scope:{ctx:n}}}),t=new Go({}),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(i,s){L(e,i,s),$(i,r,s),L(t,i,s),o=!0},p(i,[s]){const l={};s&64&&(l.$$scope={dirty:s,ctx:i}),e.$set(l)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),o=!1},d(i){i&&w(r),C(e,i),C(t,i)}}}function vp(n,e,r){let t;X(n,St,u=>r(4,t=u));let{cfg:o}=e,{gjSchemes:i}=e;Xe(()=>{t.startNew(),t.addEventListenerSuccess(s),t.addEventListenerFailure(l)}),Be(()=>{t.stop(),t.clearEventListeners()});function s(u){u.properties||(u.properties={});let c=u;i.update(f=>(c.id=Kt(f),c.properties.scheme_reference=Br(f),o.newPolygonFeature(c),f.features.push(c),f)),W.set({mode:"edit-form",id:c.id})}function l(){W.set({mode:"list"})}function a(){t.finish()}return n.$$set=u=>{"cfg"in u&&r(2,o=u.cfg),"gjSchemes"in u&&r(3,i=u.gjSchemes)},[l,a,o,i]}class bp extends Q{constructor(e){super(),x(this,e,vp,_p,V,{cfg:2,gjSchemes:3})}}function yp(n){let e;return{c(){e=T("Finish")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function $p(n){let e;return{c(){e=T("Cancel")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function wp(n){let e,r,t,o;return e=new Qe({props:{$$slots:{default:[yp]},$$scope:{ctx:n}}}),e.$on("click",n[2]),t=new ue({props:{$$slots:{default:[$p]},$$scope:{ctx:n}}}),t.$on("click",n[1]),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(i,s){L(e,i,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&64&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&64&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),o=!1},d(i){i&&w(r),C(e,i),C(t,i)}}}function kp(n){let e,r,t,o;return e=new ut({props:{$$slots:{default:[wp]},$$scope:{ctx:n}}}),t=new zo({props:{maptilerApiKey:n[0].maptilerApiKey,extendRoute:!0}}),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(i,s){L(e,i,s),$(i,r,s),L(t,i,s),o=!0},p(i,[s]){const l={};s&64&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&1&&(a.maptilerApiKey=i[0].maptilerApiKey),t.$set(a)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),o=!1},d(i){i&&w(r),C(e,i),C(t,i)}}}function Sp(n,e,r){let t;X(n,Ve,u=>r(4,t=u));let{cfg:o}=e,{gjSchemes:i}=e;Xe(()=>{t.startRoute(),t.addEventListenerSuccess(s),t.addEventListenerFailure(l)}),Be(()=>{t.stop(),t.clearEventListeners()});function s(u){let c=u;i.update(f=>(c.id=Kt(f),c.properties.scheme_reference=Br(f),o.newLineStringFeature(c),f.features.push(c),f)),W.set({mode:"edit-form",id:c.id})}function l(){W.set({mode:"list"})}function a(){t.finish()}return n.$$set=u=>{"cfg"in u&&r(0,o=u.cfg),"gjSchemes"in u&&r(3,i=u.gjSchemes)},[o,l,a,i]}class Ep extends Q{constructor(e){super(),x(this,e,Sp,kp,V,{cfg:0,gjSchemes:3})}}function Mp(n){let e,r;return e=new Wt({props:{errorMessage:"Failed to load route snapper"}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p:H,i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Pp(n){let e,r,t;return{c(){e=j("label"),e.textContent="Route data unpacking",r=O(),t=j("progress"),Y(e,"for","route-unpacking"),Y(t,"id","route-unpacking"),Y(t,"class","svelte-q3473n")},m(o,i){$(o,e,i),$(o,r,i),$(o,t,i)},p:H,i:H,o:H,d(o){o&&(w(e),w(r),w(t))}}}function Lp(n){let e,r,t;return{c(){e=j("label"),e.textContent="Route tool loading",r=O(),t=j("progress"),Y(e,"for","route-loading"),Y(t,"id","route-loading"),t.value=n[0],Y(t,"class","svelte-q3473n")},m(o,i){$(o,e,i),$(o,r,i),$(o,t,i)},p(o,i){i&1&&(t.value=o[0])},i:H,o:H,d(o){o&&(w(e),w(r),w(t))}}}function Cp(n){let e,r,t,o;const i=[Lp,Pp,Mp],s=[];function l(a,u){return!a[1]&&!a[2]&&!a[3]?0:a[3]&&!a[1]&&!a[2]?1:a[2]?2:-1}return~(e=l(n))&&(r=s[e]=i[e](n)),{c(){r&&r.c(),t=le()},m(a,u){~e&&s[e].m(a,u),$(a,t,u),o=!0},p(a,[u]){let c=e;e=l(a),e===c?~e&&s[e].p(a,u):(r&&(te(),E(s[c],1,1,()=>{s[c]=null}),re()),~e?(r=s[e],r?r.p(a,u):(r=s[e]=i[e](a),r.c()),k(r,1),r.m(t.parentNode,t)):r=null)},i(a){o||(k(r),o=!0)},o(a){E(r),o=!1},d(a){a&&w(t),~e&&s[e].d(a)}}}function Ap(n,e,r){let t,{map:o}=e,{url:i}=e,s=0,l=!1,a=!1;return Xe(async()=>{await Ro(),console.log(`Grabbing ${i}`);try{const u=await ca(i,c=>{r(0,s=c)});Ve.set(new fa(o,u,To,Uo,Ln)),r(0,s=100),r(1,l=!0)}catch(u){console.log(`Route tool broke: ${u}`),r(2,a=!0)}}),n.$$set=u=>{"map"in u&&r(4,o=u.map),"url"in u&&r(5,i=u.url)},n.$$.update=()=>{n.$$.dirty&1&&r(3,t=s>=100)},[s,l,a,t,o,i]}class Fp extends Q{constructor(e){super(),x(this,e,Ap,Cp,V,{map:4,url:5})}}function Rp(n){let e;return{c(){e=T("Finish")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Np(n){let e;return{c(){e=T("Cancel")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Op(n){let e,r,t,o;return e=new Qe({props:{$$slots:{default:[Rp]},$$scope:{ctx:n}}}),e.$on("click",n[1]),t=new ue({props:{$$slots:{default:[Np]},$$scope:{ctx:n}}}),t.$on("click",n[0]),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(i,s){L(e,i,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&64&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&64&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),o=!1},d(i){i&&w(r),C(e,i),C(t,i)}}}function Ip(n){let e,r,t,o;return e=new ut({props:{$$slots:{default:[Op]},$$scope:{ctx:n}}}),t=new qo({}),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment)},m(i,s){L(e,i,s),$(i,r,s),L(t,i,s),o=!0},p(i,[s]){const l={};s&64&&(l.$$scope={dirty:s,ctx:i}),e.$set(l)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),o=!1},d(i){i&&w(r),C(e,i),C(t,i)}}}function Bp(n,e,r){let t;X(n,Ve,u=>r(4,t=u));let{cfg:o}=e,{gjSchemes:i}=e;Xe(()=>{t.startArea(),t.addEventListenerSuccess(s),t.addEventListenerFailure(l)}),Be(()=>{t.stop(),t.clearEventListeners()});function s(u){let c=u;i.update(f=>(c.id=Kt(f),c.properties.scheme_reference=Br(f),o.newPolygonFeature(c),f.features.push(c),f)),W.set({mode:"edit-form",id:c.id})}function l(){W.set({mode:"list"})}function a(){t.finish()}return n.$$set=u=>{"cfg"in u&&r(2,o=u.cfg),"gjSchemes"in u&&r(3,i=u.gjSchemes)},[l,a,o,i]}class jp extends Q{constructor(e){super(),x(this,e,Bp,Ip,V,{cfg:2,gjSchemes:3})}}function Hi(n){let e,r;return e=new Fp({props:{map:n[3],url:n[2]}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&8&&(i.map=t[3]),o&4&&(i.url=t[2]),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Dp(n){let e,r,t,o;return t=new nc({props:{cfg:n[0]}}),{c(){e=j("h2"),e.textContent="StreetView",r=O(),P(t.$$.fragment)},m(i,s){$(i,e,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&1&&(l.cfg=i[0]),t.$set(l)},i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){E(t.$$.fragment,i),o=!1},d(i){i&&(w(e),w(r)),C(t,i)}}}function Gp(n){let e,r,t,o;return t=new up({}),{c(){e=j("h2"),e.textContent="Georeference image",r=O(),P(t.$$.fragment)},m(i,s){$(i,e,s),$(i,r,s),L(t,i,s),o=!0},p:H,i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){E(t.$$.fragment,i),o=!1},d(i){i&&(w(e),w(r)),C(t,i)}}}function Tp(n){let e,r,t,o,i,s;return t=new Qe({props:{$$slots:{default:[Wp]},$$scope:{ctx:n}}}),t.$on("click",n[7]),{c(){e=j("h2"),e.textContent="Split route",r=O(),P(t.$$.fragment),o=O(),i=j("ul"),i.innerHTML=`<li><b>Click</b>
      on a route to split it</li> <li><b>Click</b>
      on the map or press
      <b>Escape</b>
      to cancel</li>`},m(l,a){$(l,e,a),$(l,r,a),L(t,l,a),$(l,o,a),$(l,i,a),s=!0},p(l,a){const u={};a&512&&(u.$$scope={dirty:a,ctx:l}),t.$set(u)},i(l){s||(k(t.$$.fragment,l),s=!0)},o(l){E(t.$$.fragment,l),s=!1},d(l){l&&(w(e),w(r),w(o),w(i)),C(t,l)}}}function Up(n){let e,r,t,o;return t=new jp({props:{cfg:n[0],gjSchemes:n[1]}}),{c(){e=j("h2"),e.textContent="New polygon (snapped)",r=O(),P(t.$$.fragment)},m(i,s){$(i,e,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&1&&(l.cfg=i[0]),s&2&&(l.gjSchemes=i[1]),t.$set(l)},i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){E(t.$$.fragment,i),o=!1},d(i){i&&(w(e),w(r)),C(t,i)}}}function zp(n){let e,r,t,o;return t=new bp({props:{cfg:n[0],gjSchemes:n[1]}}),{c(){e=j("h2"),e.textContent="New polygon (freehand)",r=O(),P(t.$$.fragment)},m(i,s){$(i,e,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&1&&(l.cfg=i[0]),s&2&&(l.gjSchemes=i[1]),t.$set(l)},i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){E(t.$$.fragment,i),o=!1},d(i){i&&(w(e),w(r)),C(t,i)}}}function qp(n){let e,r,t,o;return t=new Ep({props:{cfg:n[0],gjSchemes:n[1]}}),{c(){e=j("h2"),e.textContent="New route",r=O(),P(t.$$.fragment)},m(i,s){$(i,e,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&1&&(l.cfg=i[0]),s&2&&(l.gjSchemes=i[1]),t.$set(l)},i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){E(t.$$.fragment,i),o=!1},d(i){i&&(w(e),w(r)),C(t,i)}}}function Yp(n){let e,r,t,o;return t=new hp({props:{cfg:n[0],gjSchemes:n[1]}}),{c(){e=j("h2"),e.textContent="New point",r=O(),P(t.$$.fragment)},m(i,s){$(i,e,s),$(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&1&&(l.cfg=i[0]),s&2&&(l.gjSchemes=i[1]),t.$set(l)},i(i){o||(k(t.$$.fragment,i),o=!0)},o(i){E(t.$$.fragment,i),o=!1},d(i){i&&(w(e),w(r)),C(t,i)}}}function Xp(n){let e,r;return e=new Ru({props:{cfg:n[0],gjSchemes:n[1],id:n[4].id}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.cfg=t[0]),o&2&&(i.gjSchemes=t[1]),o&16&&(i.id=t[4].id),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Jp(n){let e,r;return e=new Ac({props:{cfg:n[0],gjSchemes:n[1],id:n[4].id}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.cfg=t[0]),o&2&&(i.gjSchemes=t[1]),o&16&&(i.id=t[4].id),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Kp(n){let e,r;return e=new rp({props:{cfg:n[0],gjSchemes:n[1]}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.cfg=t[0]),o&2&&(i.gjSchemes=t[1]),e.$set(i)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Wp(n){let e;return{c(){e=T("Finish")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Hp(n){let e,r,t,o,i,s,l=n[3]&&Hi(n);const a=[Kp,Jp,Xp,Yp,qp,zp,Up,Tp,Gp,Dp],u=[];function c(f,d){return f[4].mode=="list"?0:f[4].mode=="edit-form"?1:f[4].mode=="edit-geometry"?2:f[4].mode=="new-point"?3:f[4].mode=="new-route"?4:f[4].mode=="new-freehand-polygon"?5:f[4].mode=="new-snapped-polygon"?6:f[4].mode=="split-route"?7:f[4].mode=="set-image"?8:f[4].mode=="streetview"?9:-1}return~(t=c(n))&&(o=u[t]=a[t](n)),{c(){e=j("div"),l&&l.c(),r=O(),o&&o.c(),i=le(),ie(e,"visibility",n[4].mode=="list"?"visible":"hidden")},m(f,d){$(f,e,d),l&&l.m(e,null),$(f,r,d),~t&&u[t].m(f,d),$(f,i,d),s=!0},p(f,[d]){f[3]?l?(l.p(f,d),d&8&&k(l,1)):(l=Hi(f),l.c(),k(l,1),l.m(e,null)):l&&(te(),E(l,1,1,()=>{l=null}),re()),d&16&&ie(e,"visibility",f[4].mode=="list"?"visible":"hidden");let p=t;t=c(f),t===p?~t&&u[t].p(f,d):(o&&(te(),E(u[p],1,1,()=>{u[p]=null}),re()),~t?(o=u[t],o?o.p(f,d):(o=u[t]=a[t](f),o.c()),k(o,1),o.m(i.parentNode,i)):o=null)},i(f){s||(k(l),k(o),s=!0)},o(f){E(l),E(o),s=!1},d(f){f&&(w(e),w(r),w(i)),l&&l.d(),~t&&u[t].d(f)}}}function Zp(n,e,r){let t,o,i,s,l;X(n,Ve,d=>r(8,t=d)),X(n,St,d=>r(5,o=d)),X(n,qt,d=>r(6,i=d)),X(n,Ie,d=>r(3,s=d)),X(n,W,d=>r(4,l=d));let{cfg:a}=e,{gjSchemes:u}=e,{routeSnapperUrl:c}=e;Be(()=>{i==null||i.tearDown(),o==null||o.tearDown(),t==null||t.tearDown()});const f=()=>W.set({mode:"list"});return n.$$set=d=>{"cfg"in d&&r(0,a=d.cfg),"gjSchemes"in d&&r(1,u=d.gjSchemes),"routeSnapperUrl"in d&&r(2,c=d.routeSnapperUrl)},n.$$.update=()=>{n.$$.dirty&72&&s&&!i&&qt.set(new rl(s)),n.$$.dirty&40&&s&&!o&&St.set(new Nl(s))},[a,u,c,s,l,o,i,f]}class Vp extends Q{constructor(e){super(),x(this,e,Zp,Hp,V,{cfg:0,gjSchemes:1,routeSnapperUrl:2})}}function Zi(n){let e,r,t,o,i,s,l,a,u,c;return e=new Ws({}),o=new Hs({}),u=new ue({props:{noBottomMargin:!0,$$slots:{default:[Qp]},$$scope:{ctx:n}}}),u.$on("click",n[10]),{c(){P(e.$$.fragment),r=O(),t=j("div"),P(o.$$.fragment),i=O(),s=j("div"),l=j("h2"),l.textContent="Scheme Sketcher",a=O(),P(u.$$.fragment),ie(t,"border-bottom","1px solid #b1b4b6"),Y(t,"class","svelte-1750ds5"),ie(l,"margin-bottom","0px"),Y(l,"class","svelte-1750ds5"),ie(s,"display","flex"),ie(s,"justify-content","space-between"),Y(s,"class","svelte-1750ds5")},m(f,d){L(e,f,d),$(f,r,d),$(f,t,d),L(o,t,null),$(f,i,d),$(f,s,d),G(s,l),G(s,a),L(u,s,null),c=!0},p(f,d){const p={};d&32768&&(p.$$scope={dirty:d,ctx:f}),u.$set(p)},i(f){c||(k(e.$$.fragment,f),k(o.$$.fragment,f),k(u.$$.fragment,f),c=!0)},o(f){E(e.$$.fragment,f),E(o.$$.fragment,f),E(u.$$.fragment,f),c=!1},d(f){f&&(w(r),w(t),w(i),w(s)),C(e,f),C(o),C(u)}}}function Qp(n){let e;return{c(){e=T("About")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Vi(n){let e;return{c(){e=j("hr"),Y(e,"class","svelte-1750ds5")},m(r,t){$(r,e,t)},d(r){r&&w(e)}}}function Qi(n){let e,r,t,o,i,s,l,a,u,c,f,d,p;e=new Ka({props:{cfg:We,boundaryGeojson:n[1]}}),t=new xu({props:{cfg:We,gjSchemes:n[5]}}),i=new Du({props:{cfg:We}});const m=[eh,xp],_=[];function v(y,h){return y[2].mode=="list"?0:y[2].mode=="split-route"?1:-1}return~(l=v(n))&&(a=_[l]=m[l](n)),c=new ff({props:{cfg:We}}),d=new nf({props:{cfg:We}}),{c(){P(e.$$.fragment),r=O(),P(t.$$.fragment),o=O(),P(i.$$.fragment),s=O(),a&&a.c(),u=O(),P(c.$$.fragment),f=O(),P(d.$$.fragment)},m(y,h){L(e,y,h),$(y,r,h),L(t,y,h),$(y,o,h),L(i,y,h),$(y,s,h),~l&&_[l].m(y,h),$(y,u,h),L(c,y,h),$(y,f,h),L(d,y,h),p=!0},p(y,h){const g={};h&2&&(g.boundaryGeojson=y[1]),e.$set(g);let S=l;l=v(y),l===S?~l&&_[l].p(y,h):(a&&(te(),E(_[S],1,1,()=>{_[S]=null}),re()),~l?(a=_[l],a?a.p(y,h):(a=_[l]=m[l](y),a.c()),k(a,1),a.m(u.parentNode,u)):a=null)},i(y){p||(k(e.$$.fragment,y),k(t.$$.fragment,y),k(i.$$.fragment,y),k(a),k(c.$$.fragment,y),k(d.$$.fragment,y),p=!0)},o(y){E(e.$$.fragment,y),E(t.$$.fragment,y),E(i.$$.fragment,y),E(a),E(c.$$.fragment,y),E(d.$$.fragment,y),p=!1},d(y){y&&(w(r),w(o),w(s),w(u),w(f)),C(e,y),C(t,y),C(i,y),~l&&_[l].d(y),C(c,y),C(d,y)}}}function xp(n){let e,r;return e=new xf({props:{cfg:We,gjSchemes:n[5]}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p:H,i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function eh(n){let e,r;return e=new bc({props:{cfg:We,gjSchemes:n[5]}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p:H,i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function th(n){let e,r,t,o;e=new Is({props:{position:"top-right"}});let i=n[4]&&Qi(n);return{c(){P(e.$$.fragment),r=O(),i&&i.c(),t=le()},m(s,l){L(e,s,l),$(s,r,l),i&&i.m(s,l),$(s,t,l),o=!0},p(s,l){s[4]?i?(i.p(s,l),l&16&&k(i,1)):(i=Qi(s),i.c(),k(i,1),i.m(t.parentNode,t)):i&&(te(),E(i,1,1,()=>{i=null}),re())},i(s){o||(k(e.$$.fragment,s),k(i),o=!0)},o(s){E(e.$$.fragment,s),E(i),o=!1},d(s){s&&(w(r),w(t)),C(e,s),i&&i.d(s)}}}function rh(n){let e,r,t,o,i,s,l,a,u,c,f,d,p,m,_,v,y,h;t=new js({});let g=n[2].mode=="list"&&Zi(n);s=new kc({props:{gjSchemes:n[5],authority:n[6],filename:n[7]}}),a=new Vp({props:{cfg:We,gjSchemes:n[5],routeSnapperUrl:n[8]}});let S=n[2].mode!="list"&&Vi();f=new Os({}),m=new Ks({props:{style:n[3],$$slots:{default:[th]},$$scope:{ctx:n}}});function b(F){n[11](F)}let A={};return n[0]!==void 0&&(A.open=n[0]),v=new Zs({props:A}),ye.push(()=>Me(v,"open",b)),{c(){e=j("div"),r=j("div"),P(t.$$.fragment),o=O(),g&&g.c(),i=O(),P(s.$$.fragment),l=O(),P(a.$$.fragment),u=O(),S&&S.c(),c=O(),P(f.$$.fragment),d=O(),p=j("div"),P(m.$$.fragment),_=O(),P(v.$$.fragment),Y(r,"class","sidebar govuk-prose svelte-1750ds5"),Y(p,"class","main svelte-1750ds5"),Y(e,"class","overall-layout svelte-1750ds5")},m(F,B){$(F,e,B),G(e,r),L(t,r,null),G(r,o),g&&g.m(r,null),G(r,i),L(s,r,null),G(r,l),L(a,r,null),G(r,u),S&&S.m(r,null),G(r,c),L(f,r,null),G(e,d),G(e,p),L(m,p,null),$(F,_,B),L(v,F,B),h=!0},p(F,[B]){F[2].mode=="list"?g?(g.p(F,B),B&4&&k(g,1)):(g=Zi(F),g.c(),k(g,1),g.m(r,i)):g&&(te(),E(g,1,1,()=>{g=null}),re()),F[2].mode!="list"?S||(S=Vi(),S.c(),S.m(r,c)):S&&(S.d(1),S=null);const D={};B&8&&(D.style=F[3]),B&32790&&(D.$$scope={dirty:B,ctx:F}),m.$set(D);const I={};!y&&B&1&&(y=!0,I.open=F[0],Le(()=>y=!1)),v.$set(I)},i(F){h||(k(t.$$.fragment,F),k(g),k(s.$$.fragment,F),k(a.$$.fragment,F),k(f.$$.fragment,F),k(m.$$.fragment,F),k(v.$$.fragment,F),h=!0)},o(F){E(t.$$.fragment,F),E(g),E(s.$$.fragment,F),E(a.$$.fragment,F),E(f.$$.fragment,F),E(m.$$.fragment,F),E(v.$$.fragment,F),h=!1},d(F){F&&(w(e),w(_)),C(t),g&&g.d(),C(s),C(a),S&&S.d(),C(f),C(m),C(v,F)}}}function nh(n,e,r){let t,o,i,s,l;X(n,Ls,h=>r(9,t=h)),X(n,ro,h=>r(12,o=h)),X(n,W,h=>r(2,i=h)),X(n,Bn,h=>r(3,s=h)),X(n,Ie,h=>r(4,l=h));let a=Ze(no(We)),u=!1,c=new URLSearchParams(window.location.search),f=c.get("authority"),d=c.get("file");Bn.set(c.get("style")||"streets");let p=`https://atip.uk/route-snappers/v3/${f}.bin.gz`,m;Xe(async()=>{Ms(),r(1,m=await _())});async function _(){let h=await Ps();return h.features=h.features.filter(g=>g.properties.full_name==f),h.features.length===0&&(window.location.href=`index.html?schema=${o}&error=Authority name not found: ${f}`),h}const v=()=>r(0,u=!0);function y(h){u=h,r(0,u)}return n.$$.update=()=>{n.$$.dirty&512&&t&&Ie.set(t)},[u,m,i,s,l,a,f,d,p,t,v,y]}class ih extends Q{constructor(e){super(),x(this,e,nh,rh,V,{})}}document.body.className+=" js-enabled"+("noModule"in HTMLScriptElement.prototype?" govuk-frontend-supported":"");new ih({target:document.getElementById("app")});
