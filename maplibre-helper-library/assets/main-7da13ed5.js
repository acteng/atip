import{S as pe,i as ce,s as de,a as me,F as he,b as V,c as x,d as ge,e as E,f as $,g as M,h as k,j as L,k as p,m as T,t as h,l as _,n as ee,o as te,p as B,q as I,r as $e,u as ie,E as _e,v as ne,w as be,I as ve,x as we,y as ae,z as ye,A as ke,B as Ae,M as oe}from"./MapLibreMap.svelte_svelte_type_style_lang-c000e451.js";import{D as Se,R as Ee,A as Me,g as Te}from"./About-771e84aa.js";function Ie(n){let t;return{c(){t=ie("About")},m(e,o){L(e,t,o)},d(e){e&&B(t)}}}function se(n){let t,e;return t=new _e({props:{errorMessage:n[2]}}),{c(){M(t.$$.fragment)},m(o,r){T(t,o,r),e=!0},p(o,r){const c={};r&4&&(c.errorMessage=o[2]),t.$set(c)},i(o){e||(h(t.$$.fragment,o),e=!0)},o(o){_(t.$$.fragment,o),e=!1},d(o){I(t,o)}}}function Le(n){let t,e,o,r,c;return{c(){t=E("input"),e=$(),o=E("datalist"),k(t,"class","govuk-input govuk-input--width-20"),k(t,"id","inputValue"),k(t,"data-testid","transport-authority"),k(t,"list","authorities-list"),k(o,"id","authorities-list")},m(g,d){L(g,t,d),ne(t,n[0]),L(g,e,d),L(g,o,d),n[12](o),r||(c=be(t,"input",n[11]),r=!0)},p(g,d){d&1&&t.value!==g[0]&&ne(t,g[0])},d(g){g&&(B(t),B(e),B(o)),n[12](null),r=!1,c()}}}function Be(n){let t;return{c(){t=ie("Start")},m(e,o){L(e,t,o)},d(e){e&&B(t)}}}function re(n){let t,e;return t=new ve({props:{layer:W,clickable:!0,tooltip:Ne}}),t.$on("click",De),{c(){M(t.$$.fragment)},m(o,r){T(t,o,r),e=!0},p:we,i(o){e||(h(t.$$.fragment,o),e=!0)},o(o){_(t.$$.fragment,o),e=!1},d(o){I(t,o)}}}function je(n){let t,e,o,r,c,g,d,b,j,m,A,F,D,v,C,N,J,O,P,s,l,w,y,q,S,G,R;c=new me({props:{$$slots:{default:[Ie]},$$scope:{ctx:n}}}),c.$on("click",n[10]);let i=n[2]&&se(n);b=new he({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[Le]},$$scope:{ctx:n}}}),m=new Se({props:{disabled:!n[6],$$slots:{default:[Be]},$$scope:{ctx:n}}}),m.$on("click",n[9]);function ue(a){n[13](a)}let z={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]],inlineSmall:!0};n[5]!==void 0&&(z.value=n[5]),v=new Ee({props:z}),V.push(()=>x(v,"value",ue)),v.$on("change",n[7]);let H=Ce;s=new ge({props:{label:"Or upload an ATIP GeoJSON file",loadFile:n[8],id:"load-geojson"}});let u=n[4]&&re();function fe(a){n[14](a)}let Z={};return n[1]!==void 0&&(Z.open=n[1]),S=new Me({props:Z}),V.push(()=>x(S,"open",fe)),{c(){t=E("div"),e=E("div"),o=E("h1"),o.textContent="Welcome to ATIP v2",r=$(),M(c.$$.fragment),g=$(),i&&i.c(),d=$(),M(b.$$.fragment),j=$(),M(m.$$.fragment),A=$(),F=E("hr"),D=$(),M(v.$$.fragment),N=$(),J=E("hr"),O=$(),P=$(),M(s.$$.fragment),l=$(),w=E("div"),w.innerHTML='<div id="map" class="svelte-lyn11h"></div>',y=$(),u&&u.c(),q=$(),M(S.$$.fragment),k(o,"class","govuk-heading-l"),k(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),k(w,"class","govuk-grid-column-one-half"),k(t,"class","govuk-grid-row")},m(a,f){L(a,t,f),p(t,e),p(e,o),p(e,r),T(c,e,null),p(e,g),i&&i.m(e,null),p(e,d),T(b,e,null),p(e,j),T(m,e,null),p(e,A),p(e,F),p(e,D),T(v,e,null),p(e,N),p(e,J),p(e,O),p(e,P),T(s,e,null),p(t,l),p(t,w),p(t,y),u&&u.m(t,null),L(a,q,f),T(S,a,f),R=!0},p(a,[f]){const K={};f&131072&&(K.$$scope={dirty:f,ctx:a}),c.$set(K),a[2]?i?(i.p(a,f),f&4&&h(i,1)):(i=se(a),i.c(),h(i,1),i.m(e,d)):i&&(ae(),_(i,1,1,()=>{i=null}),ee());const Q={};f&131081&&(Q.$$scope={dirty:f,ctx:a}),b.$set(Q);const U={};f&64&&(U.disabled=!a[6]),f&131072&&(U.$$scope={dirty:f,ctx:a}),m.$set(U);const X={};!C&&f&32&&(C=!0,X.value=a[5],te(()=>C=!1)),v.$set(X),a[4]?u?(u.p(a,f),f&16&&h(u,1)):(u=re(),u.c(),h(u,1),u.m(t,null)):u&&(ae(),_(u,1,1,()=>{u=null}),ee());const Y={};!G&&f&2&&(G=!0,Y.open=a[1],te(()=>G=!1)),S.$set(Y)},i(a){R||(h(c.$$.fragment,a),h(i),h(b.$$.fragment,a),h(m.$$.fragment,a),h(v.$$.fragment,a),h(H),h(s.$$.fragment,a),h(u),h(S.$$.fragment,a),R=!0)},o(a){_(c.$$.fragment,a),_(i),_(b.$$.fragment,a),_(m.$$.fragment,a),_(v.$$.fragment,a),_(H),_(s.$$.fragment,a),_(u),_(S.$$.fragment,a),R=!1},d(a){a&&(B(t),B(q)),I(c),i&&i.d(),I(b),I(m),I(v),I(s),u&&u.d(),I(S,a)}}}let Ce="",le="boundary",W="boundary-layer";function Fe(n){if(n.features.length>0){let t=n.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function De(n){window.location.href=`scheme.html?authority=${n.detail.properties.name}`}function Ne(n){return`<p>${n.properties.name}</p>`}function Je(n,t,e){let o,r=!1,g=new URLSearchParams(window.location.search).get("error")||"",d,b,j=new Set,m=null,A="TA";function F(){m==null||m.setFilter(W,["==",["get","level"],A])}$e(async()=>{ye();const s=await Te();for(let w of s.features){let y=document.createElement("option");y.value=w.properties.name,b.appendChild(y),j.add(w.properties.name)}let l=new ke.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});e(4,m=l),Ae.set(m),l.on("load",function(){l.fitBounds(oe.bbox(s),{padding:20,animate:!1}),l.addSource(le,{type:"geojson",data:s,generateId:!0}),l.addLayer({id:W,source:le,filter:["==",["get","level"],A],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":oe.hoveredToggle(.8,.4)}})})});function D(s){try{let l=JSON.parse(s);if(!l.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!j.has(l.authority))throw new Error(`Unknown authority ${l.authority}`);let w=l.authority,y=Fe(l);y!="v1"&&(w+=`_${y}`),window.localStorage.setItem(w,JSON.stringify(l)),window.location.href=`scheme.html?authority=${l.authority}&schema=${y}`}catch(l){e(2,g=`Couldn't load scheme from a file: ${l}`)}}function v(){window.location.href=`scheme.html?authority=${d}`}const C=()=>e(1,r=!r);function N(){d=this.value,e(0,d)}function J(s){V[s?"unshift":"push"](()=>{b=s,e(3,b)})}function O(s){A=s,e(5,A)}function P(s){r=s,e(1,r)}return n.$$.update=()=>{n.$$.dirty&1&&e(6,o=j.has(d))},[d,r,g,b,m,A,o,F,D,v,C,N,J,O,P]}class Oe extends pe{constructor(t){super(),ce(this,t,Je,je,de,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Oe({target:document.getElementById("app")});
