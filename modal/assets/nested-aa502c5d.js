var li=Object.defineProperty;var ai=(r,e,t)=>e in r?li(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var me=(r,e,t)=>(ai(r,typeof e!="symbol"?e+"":e,t),t),ui=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var We=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)};var V=(r,e,t)=>(ui(r,e,"access private method"),t);import{S as ne,i as re,s as ee,M as fi,b as ae,a as ze,d as Q,m as Z,k as Je,n as Y,o as z,q as K,e as E,c as T,g as k,x as U,p as x,f as F,y as $t,z as jt,B as ci,C as Ln,D as en,E as Rn,F as dt,G as gt,H as vt,I as mt,J as Wn,h as b,l as J,K as te,L as hi,w as On,t as j,N as pt,j as rt,r as at,O as An,P as Hn,Q as je,R as Vn,T as Nr,U as Qn,V as pi,W as di,X as gi,Y as Zn,Z as vi,_ as mi,$ as Cn,A as yi,u as _i}from"./authorities-93ac0e7d.js";function bi(r){let e,t,n,i,o,s,a,l,u,c,v,p,f,g,y,_,L,h,d,m,S,R,M,A,C;return{c(){e=E("p"),e.textContent="For each intervention:",t=T(),n=E("br"),i=T(),o=E("ol"),o.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,s=T(),a=E("br"),l=T(),u=E("p"),u.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,c=T(),v=E("br"),p=T(),f=E("p"),f.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,g=T(),y=E("br"),_=T(),L=E("p"),L.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,h=T(),d=E("br"),m=T(),S=E("p"),S.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,R=T(),M=E("br"),A=T(),C=E("p"),C.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(w,P){k(w,e,P),k(w,t,P),k(w,n,P),k(w,i,P),k(w,o,P),k(w,s,P),k(w,a,P),k(w,l,P),k(w,u,P),k(w,c,P),k(w,v,P),k(w,p,P),k(w,f,P),k(w,g,P),k(w,y,P),k(w,_,P),k(w,L,P),k(w,h,P),k(w,d,P),k(w,m,P),k(w,S,P),k(w,R,P),k(w,M,P),k(w,A,P),k(w,C,P)},p:U,d(w){w&&x(e),w&&x(t),w&&x(n),w&&x(i),w&&x(o),w&&x(s),w&&x(a),w&&x(l),w&&x(u),w&&x(c),w&&x(v),w&&x(p),w&&x(f),w&&x(g),w&&x(y),w&&x(_),w&&x(L),w&&x(h),w&&x(d),w&&x(m),w&&x(S),w&&x(R),w&&x(M),w&&x(A),w&&x(C)}}}function wi(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[bi]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new fi({props:o}),ae.push(()=>ze(e,"open",i,r[0])),{c(){Q(e.$$.fragment)},m(s,a){Z(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Je(()=>t=!1)),e.$set(l)},i(s){n||(Y(e.$$.fragment,s),n=!0)},o(s){z(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function Si(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Ei extends ne{constructor(e){super(),re(this,e,Si,wi,ee,{open:0})}}const Ze=[];function ut(r,e=U){let t;const n=new Set;function i(a){if(ee(r,a)&&(r=a,t)){const l=!Ze.length;for(const u of n)u[1](),Ze.push(u,r);if(l){for(let u=0;u<Ze.length;u+=2)Ze[u][0](Ze[u+1]);Ze.length=0}}}function o(a){i(a(r))}function s(a,l=U){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||U),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const ki={"line-cap":"round","line-join":"round"},Nn=["==","$type","Polygon"],Fn=["==","$type","LineString"],Tn=["==","$type","Point"];function Bt(r,e,t=1){return{type:"line",layout:ki,paint:{"line-color":r,"line-width":e,"line-opacity":t}}}function In(r,e){return{type:"fill",paint:{"fill-color":r,"fill-opacity":e}}}function Lt(r,e,t=1){return{type:"circle",paint:{"circle-radius":e,"circle-color":r,"circle-opacity":t}}}function ft(r,e,t){if(r.getSource(e)){let n=[];for(let i of r.getStyle().layers)i.source==e&&n.push(i.id);for(let i of n)r.removeLayer(i);r.removeSource(e)}r.addSource(e,t)}function be(r,e,t=null){r.getLayer(e.id)&&r.removeLayer(e.id),t&&!r.getLayer(t)&&(t=null),r.addLayer(e,t)}function Ie(){return{type:"FeatureCollection",features:[]}}const Ce=ut(null),W=ut(Ie()),Se=ut(null),Te=ut(null),Dt=ut(null),an=ut(null);function Wt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Fr(r){W.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Se.set(null),Te.set(null),Dt.set(null)}function Kn(r){let e;const t=r[4].default,n=dt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&gt(n,t,i,i[3],e?mt(t,i[3],o,null):vt(i[3]),null)},i(i){e||(Y(n,i),e=!0)},o(i){z(n,i),e=!1},d(i){n&&n.d(i)}}}function xi(r){let e,t,n=r[1]&&Kn(r);return{c(){e=E("div"),n&&n.c(),F(e,"class","map svelte-12dpf1u")},m(i,o){k(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&Y(n,1)):(n=Kn(i),n.c(),Y(n,1),n.m(e,null)):n&&($t(),z(n,1,1,()=>{n=null}),jt())},i(i){t||(Y(n),t=!0)},o(i){z(n),t=!1},d(i){i&&x(e),n&&n.d(),r[5](null)}}}function Mi(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;ci("setCamera",!window.location.hash),Ln(()=>{s=new en.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new en.ScaleControl({})),s.addControl(new en.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ce.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),Rn(()=>{s.remove()});function u(c){ae[c?"unshift":"push"](()=>{a=c,t(0,a)})}return r.$$set=c=>{"style"in c&&t(2,o=c.style),"$$scope"in c&&t(3,i=c.$$scope)},[a,l,o,i,n,u]}class Pi extends ne{constructor(e){super(),re(this,e,Mi,xi,ee,{style:2})}}const Li=r=>({}),er=r=>({}),Ri=r=>({}),tr=r=>({}),Oi=r=>({}),nr=r=>({});function Ai(r){let e,t,n,i,o,s,a,l,u,c,v,p;const f=r[3].nav,g=dt(f,r,r[2],nr),y=r[3].sidebar,_=dt(y,r,r[2],tr),L=r[3].main,h=dt(L,r,r[2],er);return{c(){e=E("aside"),t=E("div"),n=E("nav"),g&&g.c(),i=T(),_&&_.c(),o=T(),s=E("button"),s.textContent="→",l=T(),u=E("main"),h&&h.c(),F(n,"class","svelte-1u7vg8a"),F(t,"class","sidebar-content content-container svelte-1u7vg8a"),F(s,"type","button"),F(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),F(e,"class",a=Wn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),F(u,"class","svelte-1u7vg8a")},m(d,m){k(d,e,m),b(e,t),b(t,n),g&&g.m(n,null),b(t,i),_&&_.m(t,null),b(e,o),b(e,s),k(d,l,m),k(d,u,m),h&&h.m(u,null),c=!0,v||(p=J(s,"click",r[1]),v=!0)},p(d,[m]){g&&g.p&&(!c||m&4)&&gt(g,f,d,d[2],c?mt(f,d[2],m,Oi):vt(d[2]),nr),_&&_.p&&(!c||m&4)&&gt(_,y,d,d[2],c?mt(y,d[2],m,Ri):vt(d[2]),tr),(!c||m&1&&a!==(a=Wn(d[0]?"":"collapsed")+" svelte-1u7vg8a"))&&F(e,"class",a),h&&h.p&&(!c||m&4)&&gt(h,L,d,d[2],c?mt(L,d[2],m,Li):vt(d[2]),er)},i(d){c||(Y(g,d),Y(_,d),Y(h,d),c=!0)},o(d){z(g,d),z(_,d),z(h,d),c=!1},d(d){d&&x(e),g&&g.d(d),_&&_.d(d),d&&x(l),d&&x(u),h&&h.d(d),v=!1,p()}}}function Ci(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class Ni extends ne{constructor(e){super(),re(this,e,Ci,Ai,ee,{})}}var ce=63710088e-1,Bn={centimeters:ce*100,centimetres:ce*100,degrees:ce/111325,feet:ce*3.28084,inches:ce*39.37,kilometers:ce/1e3,kilometres:ce/1e3,meters:ce,metres:ce,miles:ce/1609.344,millimeters:ce*1e3,millimetres:ce*1e3,nauticalmiles:ce/1852,radians:1,yards:ce*1.0936},Fi={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ce,yards:1.0936133},un={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ke(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Ti(r,e,t){switch(r){case"Point":return de(e).geometry;case"LineString":return ge(e).geometry;case"Polygon":return Ht(e).geometry;case"MultiPoint":return Ir(e).geometry;case"MultiLineString":return Tr(e).geometry;case"MultiPolygon":return Dn(e).geometry;default:throw new Error(r+" is invalid")}}function de(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Gt(r[0])||!Gt(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return ke(n,e,t)}function Ii(r,e,t){return t===void 0&&(t={}),Ee(r.map(function(n){return de(n,e)}),t)}function Ht(r,e,t){t===void 0&&(t={});for(var n=0,i=r;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:r};return ke(a,e,t)}function Bi(r,e,t){return t===void 0&&(t={}),Ee(r.map(function(n){return Ht(n,e)}),t)}function ge(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return ke(n,e,t)}function Di(r,e,t){return t===void 0&&(t={}),Ee(r.map(function(n){return ge(n,e)}),t)}function Ee(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Tr(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return ke(n,e,t)}function Ir(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return ke(n,e,t)}function Dn(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return ke(n,e,t)}function Gi(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return ke(n,e,t)}function qi(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function Gn(r,e){e===void 0&&(e="kilometers");var t=Bn[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Vt(r,e){e===void 0&&(e="kilometers");var t=Bn[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Yi(r,e){return wt(Vt(r,e))}function Xi(r){var e=r%360;return e<0&&(e+=360),e}function wt(r){var e=r%(2*Math.PI);return e*180/Math.PI}function we(r){var e=r%360;return e*Math.PI/180}function zi(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return Gn(Vt(r,e),t)}function Ji(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=un[e];if(!n)throw new Error("invalid original units");var i=un[t];if(!i)throw new Error("invalid final units");return r/n*i}function Gt(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function qn(r){return!!r&&r.constructor===Object}function Ui(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!Gt(e))throw new Error("bbox must only contain numbers")})}function $i(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const ji=Object.freeze(Object.defineProperty({__proto__:null,earthRadius:ce,factors:Bn,unitsFactors:Fi,areaFactors:un,feature:ke,geometry:Ti,point:de,points:Ii,polygon:Ht,polygons:Bi,lineString:ge,lineStrings:Di,featureCollection:Ee,multiLineString:Tr,multiPoint:Ir,multiPolygon:Dn,geometryCollection:Gi,round:qi,radiansToLength:Gn,lengthToRadians:Vt,lengthToDegrees:Yi,bearingToAzimuth:Xi,radiansToDegrees:wt,degreesToRadians:we,convertLength:zi,convertArea:Ji,isNumber:Gt,isObject:qn,validateBBox:Ui,validateId:$i},Symbol.toStringTag,{value:"Module"}));/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Wi(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(c){u=[6,c],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var $e=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Hi(r,e){return r>e?1:r<e?-1:0}function Ge(r,e,t){for(var n=new $e(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function tn(r,e,t,n){var i=new $e(r,e);if(t===null)return i.left=i.right=null,i;t=Ge(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function rr(r,e,t){var n=null,i=null;if(e){e=Ge(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Vi(r,e,t){return e===null?r:(r===null||(e=Ge(r.key,e,t),e.left=r),e)}function fn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&fn(r.left,o,!1,n,i),r.right&&fn(r.right,o,!0,n,i)}}var Yn=function(){function r(e){e===void 0&&(e=Hi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=tn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new $e(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ge(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ge(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ge(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ge(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ge(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Zi(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&pn(e,t,0,i-1,o),this._root===null)this._root=cn(e,t,0,i),this._size=i;else{var s=Ki(this.toList(),Qi(e,t),o);i=this._size+i,this._root=hn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return fn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=rr(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=tn(t,n,a,i):s=tn(t,n,s,i),this._root=Vi(s,a,i)},r.prototype.split=function(e){return rr(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Wi(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function cn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new $e(s,a);return l.left=cn(r,e,t,o),l.right=cn(r,e,o+1,n),l}return null}function Qi(r,e){for(var t=new $e(null,null),n=t,i=0;i<r.length;i++)n=n.next=new $e(r[i],e[i]);return n.next=null,t.next}function Zi(r){for(var e=r,t=[],n=!1,i=new $e(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function hn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=hn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=hn(r,i+1,t),s}return null}function Ki(r,e,t){for(var n=new $e(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function pn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}pn(r,e,t,a,i),pn(r,e,a+1,n,i)}}function xe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function ir(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function ve(r,e,t){return e&&ir(r.prototype,e),t&&ir(r,t),r}var ht=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},dn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Ye=Number.EPSILON;Ye===void 0&&(Ye=Math.pow(2,-52));var eo=Ye*Ye,gn=function(e,t){if(-Ye<e&&e<Ye&&-Ye<t&&t<Ye)return 0;var n=e-t;return n*n<eo*e*t?0:e<t?-1:1},to=function(){function r(){xe(this,r),this.reset()}return ve(r,[{key:"reset",value:function(){this.xRounder=new or,this.yRounder=new or}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),or=function(){function r(){xe(this,r),this.tree=new Yn,this.round(0)}return ve(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&gn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&gn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),St=new to,yt=function(e,t){return e.x*t.y-e.y*t.x},Br=function(e,t){return e.x*t.x+e.y*t.y},sr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=yt(i,o);return gn(s,0)},qt=function(e){return Math.sqrt(Br(e,e))},no=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return yt(o,i)/qt(o)/qt(i)},ro=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Br(o,i)/qt(o)/qt(i)},lr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},ar=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},io=function(e,t,n,i){if(t.x===0)return ar(n,i,e.x);if(i.x===0)return ar(e,t,n.x);if(t.y===0)return lr(n,i,e.y);if(i.y===0)return lr(e,t,n.y);var o=yt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=yt(s,t)/o,l=yt(s,i)/o,u=e.x+l*t.x,c=n.x+a*i.x,v=e.y+l*t.y,p=n.y+a*i.y,f=(u+c)/2,g=(v+p)/2;return{x:f,y:g}},Re=function(){ve(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Yt.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){xe(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return ve(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:no(n.point,t.point,l.point),cosine:ro(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,c=l.cosine,v=i.get(a),p=v.sine,f=v.cosine;return u>=0&&p>=0?c<f?1:c>f?-1:0:u<0&&p<0?c<f?-1:c>f?1:0:p<u?-1:p>u?1:0}}}]),r}(),oo=0,Yt=function(){ve(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,c=t.rightSE.point.y,v=n.rightSE.point.y;if(i<o){if(u<l&&u<c)return 1;if(u>l&&u>c)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<v)return-1;if(l>u&&l>v)return 1;var g=n.comparePoint(t.leftSE.point);if(g!==0)return g;var y=t.comparePoint(n.rightSE.point);return y<0?1:y>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>a){var L=t.comparePoint(n.rightSE.point);if(L<0)return 1;if(L>0)return-1}if(s!==a){var h=c-l,d=s-i,m=v-u,S=a-o;if(h>d&&m<S)return 1;if(h<d&&m>S)return-1}return s>a?1:s<a||c<v?-1:c>v?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){xe(this,r),this.id=++oo,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return ve(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=dn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,c=ht(n,l)&&this.comparePoint(l)===0,v=ht(i,s)&&t.comparePoint(s)===0,p=ht(n,u)&&this.comparePoint(u)===0,f=ht(i,a)&&t.comparePoint(a)===0;if(v&&c)return f&&!p?a:!f&&p?u:null;if(v)return p&&s.x===u.x&&s.y===u.y?null:s;if(c)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&p)return null;if(f)return a;if(p)return u;var g=io(s,this.vector(),l,t.vector());return g===null||!ht(o,g)?null:St.round(g.x,g.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Re(t,!0),s=new Re(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Re.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Re.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var c=i.rings[l],v=i.windings[l],p=n.rings.indexOf(c);p===-1?(n.rings.push(c),n.windings.push(v)):n.windings[p]+=v}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],c=n.indexOf(l);c===-1?(n.push(l),i.push(u)):i[c]+=u}for(var v=[],p=[],f=0,g=n.length;f<g;f++)if(i[f]!==0){var y=n[f],_=y.poly;if(p.indexOf(_)===-1)if(y.isExterior)v.push(_);else{p.indexOf(_)===-1&&p.push(_);var L=v.indexOf(y.poly);L!==-1&&v.splice(L,1)}}for(var h=0,d=v.length;h<d;h++){var m=v[h].multiPoly;o.indexOf(m)===-1&&o.push(m)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Pe.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Pe.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(v){return v.length===1&&v[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Pe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Re.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Re(o,!0),c=new Re(s,!1);return new r(u,c,[i],[a])}}]),r}(),ur=function(){function r(e,t,n){if(xe(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=St.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=St.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(Yt.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Yt.fromRing(o,i,this))}return ve(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),so=function(){function r(e,t){if(xe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ur(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new ur(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return ve(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),fr=function(){function r(e,t){if(xe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new so(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return ve(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),lo=function(){ve(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,c=[l],v=l.point,p=[];a=l,l=u,c.push(l),l.point!==v;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var g=c[0].point,y=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(g.x,",")+" ".concat(g.y,"]. Last matching segment found ends at")+" [".concat(y.x,", ").concat(y.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var _=null,L=0,h=p.length;L<h;L++)if(p[L].point===l.point){_=L;break}if(_!==null){var d=p.splice(_)[0],m=c.splice(d.index);m.unshift(m[0].otherSE),n.push(new r(m.reverse()));continue}p.push({index:c.length,point:l.point});var S=l.getLeftmostComparator(a);u=f.sort(S)[0].otherSE;break}n.push(new r(c))}}return n}}]);function r(e){xe(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return ve(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;sr(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];sr(l,t,u)===0&&n.shift(),n.push(n[0]);for(var c=this.isExteriorRing()?1:-1,v=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,f=[],g=v;g!=p;g+=c)f.push([n[g].x,n[g].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Re.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),cr=function(){function r(e){xe(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return ve(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),ao=function(){function r(e){xe(this,r),this.rings=e,this.polys=this._composePolys(e)}return ve(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new cr(s));else{var a=s.enclosingRing();a.poly||n.push(new cr(a)),a.poly.addInterior(s)}}return n}}]),r}(),uo=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Yt.compare;xe(this,r),this.queue=e,this.tree=new Yn(t),this.segments=[]}return ve(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var c=null;if(l){var v=l.getIntersection(n);if(v!==null&&(n.isAnEndpoint(v)||(c=v),!l.isAnEndpoint(v)))for(var p=this._splitSafely(l,v),f=0,g=p.length;f<g;f++)i.push(p[f])}var y=null;if(u){var _=u.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(y=_),!u.isAnEndpoint(_)))for(var L=this._splitSafely(u,_),h=0,d=L.length;h<d;h++)i.push(L[h])}if(c!==null||y!==null){var m=null;if(c===null)m=y;else if(y===null)m=c;else{var S=Re.comparePoints(c,y);m=S<=0?c:y}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var R=n.split(m),M=0,A=R.length;M<A;M++)i.push(R[M])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var C=l.getIntersection(u);if(C!==null){if(!l.isAnEndpoint(C))for(var w=this._splitSafely(l,C),P=0,G=w.length;P<G;P++)i.push(w[P]);if(!u.isAnEndpoint(C))for(var N=this._splitSafely(u,C),O=0,H=N.length;O<H;O++)i.push(N[O])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),hr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,fo=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,co=function(){function r(){xe(this,r)}return ve(r,[{key:"run",value:function(t,n,i){Pe.type=t,St.reset();for(var o=[new fr(n,!0)],s=0,a=i.length;s<a;s++)o.push(new fr(i[s],!1));if(Pe.numMultiPolys=o.length,Pe.type==="difference")for(var l=o[0],u=1;u<o.length;)dn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Pe.type==="intersection"){for(var c=0,v=o.length;c<v;c++)for(var p=o[c],f=c+1,g=o.length;f<g;f++)if(dn(p.bbox,o[f].bbox)===null)return[]}for(var y=new Yn(Re.compare),_=0,L=o.length;_<L;_++)for(var h=o[_].getSweepEvents(),d=0,m=h.length;d<m;d++)if(y.insert(h[d]),y.size>hr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var S=new uo(y),R=y.size,M=y.pop();M;){var A=M.key;if(y.size===R){var C=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(C.id," ")+"[".concat(C.leftSE.point.x,", ").concat(C.leftSE.point.y,"] -> ")+"[".concat(C.rightSE.point.x,", ").concat(C.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(y.size>hr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(S.segments.length>fo)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var w=S.process(A),P=0,G=w.length;P<G;P++){var N=w[P];N.consumedBy===void 0&&y.insert(N)}R=y.size,M=y.pop()}St.reset();var O=lo.factory(S.segments),H=new ao(O);return H.getGeom()}}]),r}(),Pe=new co,ho=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Pe.run("union",e,n)},po=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Pe.run("intersection",e,n)},go=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Pe.run("xor",e,n)},vo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Pe.run("difference",e,n)},At={union:ho,intersection:po,xor:go,difference:vo};function mo(r,e){var t=_o(e),n=null;return r.type==="FeatureCollection"?n=yo(r):n=Dr(At.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function yo(r){var e=r.features.length===2?At.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):At.union.apply(At,r.features.map(function(t){return t.geometry.coordinates}));return Dr(e)}function Dr(r){return Dn(r)}function _o(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return Ht(t)}function bo(r,e,t){let n;te(r,Ce,s=>t(1,n=s));let{boundaryGeojson:i}=e;return hi("setCamera")&&n.fitBounds(On(i),{padding:20,animate:!1}),ft(n,"boundary",{type:"geojson",data:mo(i)}),be(n,{id:"boundary",source:"boundary",...In("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class wo extends ne{constructor(e){super(),re(this,e,bo,null,ee,{boundaryGeojson:0})}}function pr(r){let e,t,n=dr(r[4])+"",i,o,s;return{c(){e=E("p"),t=j("Length: "),i=j(n),o=T(),s=E("br")},m(a,l){k(a,e,l),b(e,t),b(e,i),k(a,o,l),k(a,s,l)},p(a,l){l&16&&n!==(n=dr(a[4])+"")&&An(i,n)},d(a){a&&x(e),a&&x(o),a&&x(s)}}}function So(r){let e,t,n,i,o,s,a,l,u,c,v,p,f,g,y,_,L,h,d,m,S,R,M,A,C,w,P,G,N,O,H,ie,he,pe,ue,Me,_e,$=r[4]&&pr(r);return{c(){e=E("label"),t=j(`Name
  `),n=E("input"),i=T(),o=E("br"),s=T(),a=E("label"),l=E("input"),u=j(`
  Area`),c=T(),v=E("label"),p=E("input"),f=j(`
  Route`),g=T(),y=E("label"),_=E("input"),L=j(`
  Crossing`),h=T(),d=E("label"),m=E("input"),S=j(`
  Other`),R=T(),M=E("br"),A=T(),C=E("label"),w=j(`Description
  `),P=E("textarea"),G=T(),N=E("br"),O=T(),$&&$.c(),H=T(),ie=E("div"),he=E("button"),he.textContent="Delete",pe=T(),ue=E("button"),ue.textContent="Save",F(n,"type","text"),F(l,"type","radio"),l.__value="area",l.value=l.__value,r[7][0].push(l),F(p,"type","radio"),p.__value="route",p.value=p.__value,r[7][0].push(p),F(_,"type","radio"),_.__value="crossing",_.value=_.__value,r[7][0].push(_),F(m,"type","radio"),m.__value="other",m.value=m.__value,r[7][0].push(m),F(P,"class","svelte-15lna0i"),F(he,"type","button"),F(ue,"type","button"),pt(ue,"float","right")},m(I,B){k(I,e,B),b(e,t),b(e,n),rt(n,r[0]),k(I,i,B),k(I,o,B),k(I,s,B),k(I,a,B),b(a,l),l.checked=l.__value===r[1],b(a,u),k(I,c,B),k(I,v,B),b(v,p),p.checked=p.__value===r[1],b(v,f),k(I,g,B),k(I,y,B),b(y,_),_.checked=_.__value===r[1],b(y,L),k(I,h,B),k(I,d,B),b(d,m),m.checked=m.__value===r[1],b(d,S),k(I,R,B),k(I,M,B),k(I,A,B),k(I,C,B),b(C,w),b(C,P),rt(P,r[2]),k(I,G,B),k(I,N,B),k(I,O,B),$&&$.m(I,B),k(I,H,B),k(I,ie,B),b(ie,he),b(ie,pe),b(ie,ue),Me||(_e=[J(n,"input",r[5]),J(l,"change",r[6]),J(p,"change",r[8]),J(_,"change",r[9]),J(m,"change",r[10]),J(P,"input",r[11]),J(he,"click",r[12]),J(ue,"click",r[13])],Me=!0)},p(I,[B]){B&1&&n.value!==I[0]&&rt(n,I[0]),B&2&&(l.checked=l.__value===I[1]),B&2&&(p.checked=p.__value===I[1]),B&2&&(_.checked=_.__value===I[1]),B&2&&(m.checked=m.__value===I[1]),B&4&&rt(P,I[2]),I[4]?$?$.p(I,B):($=pr(I),$.c(),$.m(H.parentNode,H)):$&&($.d(1),$=null)},i:U,o:U,d(I){I&&x(e),I&&x(i),I&&x(o),I&&x(s),I&&x(a),r[7][0].splice(r[7][0].indexOf(l),1),I&&x(c),I&&x(v),r[7][0].splice(r[7][0].indexOf(p),1),I&&x(g),I&&x(y),r[7][0].splice(r[7][0].indexOf(_),1),I&&x(h),I&&x(d),r[7][0].splice(r[7][0].indexOf(m),1),I&&x(R),I&&x(M),I&&x(A),I&&x(C),I&&x(G),I&&x(N),I&&x(O),$&&$.d(I),I&&x(H),I&&x(ie),Me=!1,at(_e)}}}function dr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Eo(r,e,t){let{id:n}=e,{name:i}=e,{intervention_type:o}=e,{description:s}=e,{length_meters:a}=e;const l=[[]];function u(){i=this.value,t(0,i)}function c(){o=this.__value,t(1,o)}function v(){o=this.__value,t(1,o)}function p(){o=this.__value,t(1,o)}function f(){o=this.__value,t(1,o)}function g(){s=this.value,t(2,s)}const y=()=>Fr(n),_=()=>Se.set(null);return r.$$set=L=>{"id"in L&&t(3,n=L.id),"name"in L&&t(0,i=L.name),"intervention_type"in L&&t(1,o=L.intervention_type),"description"in L&&t(2,s=L.description),"length_meters"in L&&t(4,a=L.length_meters)},[i,o,s,n,a,u,c,l,v,p,f,g,y,_]}class ko extends ne{constructor(e){super(),re(this,e,Eo,So,ee,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}function xo(r){const e=r-1;return e*e*e+1}function gr(r,{delay:e=0,duration:t=400,easing:n=xo}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),c=parseFloat(i.marginBottom),v=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*c}px;border-top-width: ${f*v}px;border-bottom-width: ${f*p}px;`}}function vr(r){let e,t,n,i,o;const s=r[10].default,a=dt(s,r,r[9],null);return{c(){e=E("div"),a&&a.c()},m(l,u){k(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=J(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&gt(a,s,l,l[9],n?mt(s,l[9],u,null):vt(l[9]),null)},i(l){n||(Y(a,l),Nr(()=>{t||(t=Qn(e,gr,{duration:100},!0)),t.run(1)}),n=!0)},o(l){z(a,l),t||(t=Qn(e,gr,{duration:100},!1)),t.run(0),n=!1},d(l){l&&x(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Mo(r){let e,t,n,i,o,s,a,l,u,c,v=r[4]&&vr(r);return{c(){e=E("button"),t=Hn("svg"),n=Hn("path"),i=T(),o=j(r[1]),s=T(),v&&v.c(),a=je(),F(n,"d","M9 5l7 7-7 7"),F(t,"style","tran"),F(t,"width","20"),F(t,"height","20"),F(t,"fill","none"),F(t,"stroke-linecap","round"),F(t,"stroke-linejoin","round"),F(t,"stroke-width","2"),F(t,"viewBox","0 0 24 24"),F(t,"stroke","currentColor"),F(t,"class","svelte-75u8ea"),F(e,"aria-expanded",r[4]),F(e,"class","svelte-75u8ea"),Vn(e,"underlined",r[3])},m(p,f){k(p,e,f),b(e,t),b(t,n),b(e,i),b(e,o),k(p,s,f),v&&v.m(p,f),k(p,a,f),l=!0,u||(c=[J(e,"click",r[5]),J(e,"mouseenter",r[11]),J(e,"mouseleave",r[12])],u=!0)},p(p,[f]){(!l||f&2)&&An(o,p[1]),(!l||f&16)&&F(e,"aria-expanded",p[4]),(!l||f&8)&&Vn(e,"underlined",p[3]),p[4]?v?(v.p(p,f),f&16&&Y(v,1)):(v=vr(p),v.c(),Y(v,1),v.m(a.parentNode,a)):v&&($t(),z(v,1,1,()=>{v=null}),jt())},i(p){l||(Y(v),l=!0)},o(p){z(v),l=!1},d(p){p&&x(e),p&&x(s),v&&v.d(p),p&&x(a),u=!1,at(c)}}}function Po(r,e,t){let n,i,o,s;te(r,Te,h=>t(7,o=h)),te(r,Se,h=>t(8,s=h));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:c}=e;const v=()=>{Se.update(h=>h==u?null:u),s==u&&(an.set(null),an.set(u))};let p;function f(){p==null||p.scrollIntoView({behavior:"smooth"})}const g=()=>Dt.set(u),y=()=>Dt.set(null);function _(h){ae[h?"unshift":"push"](()=>{p=h,t(2,p)})}const L=()=>f();return r.$$set=h=>{"id"in h&&t(0,u=h.id),"label"in h&&t(1,c=h.label),"$$scope"in h&&t(9,l=h.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,c,p,i,n,v,f,o,s,l,a,g,y,_,L]}class Lo extends ne{constructor(e){super(),re(this,e,Po,Mo,ee,{id:0,label:1})}}function mr(r,e,t){const n=r.slice();return n[6]=e[t],n[7]=e,n[8]=t,n}function Ro(r){let e,t,n,i,o,s;function a(v){r[2](v,r[6])}function l(v){r[3](v,r[6])}function u(v){r[4](v,r[6])}let c={id:r[6].id,length_meters:r[6].properties.length_meters};return r[6].properties.name!==void 0&&(c.name=r[6].properties.name),r[6].properties.intervention_type!==void 0&&(c.intervention_type=r[6].properties.intervention_type),r[6].properties.description!==void 0&&(c.description=r[6].properties.description),e=new ko({props:c}),ae.push(()=>ze(e,"name",a,r[6].properties.name)),ae.push(()=>ze(e,"intervention_type",l,r[6].properties.intervention_type)),ae.push(()=>ze(e,"description",u,r[6].properties.description)),{c(){Q(e.$$.fragment),o=T()},m(v,p){Z(e,v,p),k(v,o,p),s=!0},p(v,p){r=v;const f={};p&1&&(f.id=r[6].id),p&1&&(f.length_meters=r[6].properties.length_meters),!t&&p&1&&(t=!0,f.name=r[6].properties.name,Je(()=>t=!1)),!n&&p&1&&(n=!0,f.intervention_type=r[6].properties.intervention_type,Je(()=>n=!1)),!i&&p&1&&(i=!0,f.description=r[6].properties.description,Je(()=>i=!1)),e.$set(f)},i(v){s||(Y(e.$$.fragment,v),s=!0)},o(v){z(e.$$.fragment,v),s=!1},d(v){K(e,v),v&&x(o)}}}function yr(r,e){let t,n,i;return n=new Lo({props:{id:e[6].id,label:e[8]+1+") "+_r(e[6]),$$slots:{default:[Ro]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=je(),Q(n.$$.fragment),this.first=t},m(o,s){k(o,t,s),Z(n,o,s),i=!0},p(o,s){e=o;const a={};s&1&&(a.id=e[6].id),s&1&&(a.label=e[8]+1+") "+_r(e[6])),s&513&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||(Y(n.$$.fragment,o),i=!0)},o(o){z(n.$$.fragment,o),i=!1},d(o){o&&x(t),K(n,o)}}}function Oo(r){let e=[],t=new Map,n,i,o,s,a=r[0].features;const l=u=>u[6].id;for(let u=0;u<a.length;u+=1){let c=mr(r,a,u),v=l(c);t.set(v,e[u]=yr(v,c))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=je()},m(u,c){for(let v=0;v<e.length;v+=1)e[v].m(u,c);k(u,n,c),i=!0,o||(s=J(window,"keydown",r[1]),o=!0)},p(u,[c]){c&1&&(a=u[0].features,$t(),e=pi(e,c,l,1,u,a,t,n.parentNode,di,yr,n,mr),jt())},i(u){if(!i){for(let c=0;c<a.length;c+=1)Y(e[c]);i=!0}},o(u){for(let c=0;c<e.length;c+=1)z(e[c]);i=!1},d(u){for(let c=0;c<e.length;c+=1)e[c].d(u);u&&x(n),o=!1,s()}}}function _r(r){if(r.properties.name)return r.properties.name;var e=r.properties.intervention_type;return e=="other"&&(r.geometry.type=="Point"?e="point":r.geometry.type=="LineString"?e="line":e="polygon"),`Untitled ${e}`}function Ao(r,e,t){let n,i;te(r,Se,u=>t(5,n=u)),te(r,W,u=>t(0,i=u));function o(u){if(u.key=="Delete"){const c=u.target.tagName;if(c=="INPUT"||c=="TEXTAREA")return;u.preventDefault();const v=n;v&&Fr(v)}}function s(u,c){r.$$.not_equal(c.properties.name,u)&&(c.properties.name=u,W.set(i))}function a(u,c){r.$$.not_equal(c.properties.intervention_type,u)&&(c.properties.intervention_type=u,W.set(i))}function l(u,c){r.$$.not_equal(c.properties.description,u)&&(c.properties.description=u,W.set(i))}return[i,o,s,a,l]}class Co extends ne{constructor(e){super(),re(this,e,Ao,Oo,ee,{})}}function Ue(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ae(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function vn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function qe(r,e,t){t===void 0&&(t={});var n=Ue(r),i=Ue(e),o=we(i[1]-n[1]),s=we(i[0]-n[0]),a=we(n[1]),l=we(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return Gn(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Ve(r,e,t){if(r!==null)for(var n,i,o,s,a,l,u,c=0,v=0,p,f=r.type,g=f==="FeatureCollection",y=f==="Feature",_=g?r.features.length:1,L=0;L<_;L++){u=g?r.features[L].geometry:y?r.geometry:r,p=u?u.type==="GeometryCollection":!1,a=p?u.geometries.length:1;for(var h=0;h<a;h++){var d=0,m=0;if(s=p?u.geometries[h]:u,s!==null){l=s.coordinates;var S=s.type;switch(c=t&&(S==="Polygon"||S==="MultiPolygon")?1:0,S){case null:break;case"Point":if(e(l,v,L,d,m)===!1)return!1;v++,d++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(e(l[n],v,L,d,m)===!1)return!1;v++,S==="MultiPoint"&&d++}S==="LineString"&&d++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-c;i++){if(e(l[n][i],v,L,d,m)===!1)return!1;v++}S==="MultiLineString"&&d++,S==="Polygon"&&m++}S==="Polygon"&&d++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(m=0,i=0;i<l[n].length;i++){for(o=0;o<l[n][i].length-c;o++){if(e(l[n][i][o],v,L,d,m)===!1)return!1;v++}m++}d++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(Ve(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function No(r,e,t,n){var i=t;return Ve(r,function(o,s,a,l,u){s===0&&t===void 0?i=o:i=e(i,o,s,a,l,u)},n),i}function Gr(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function Fo(r,e,t){var n=t;return Gr(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function st(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function qr(r,e,t){var n=t;return st(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function To(r){var e=[];return Ve(r,function(t){e.push(t)}),e}function Xn(r,e){var t,n,i,o,s,a,l,u,c,v,p=0,f=r.type==="FeatureCollection",g=r.type==="Feature",y=f?r.features.length:1;for(t=0;t<y;t++){for(a=f?r.features[t].geometry:g?r.geometry:r,u=f?r.features[t].properties:g?r.properties:{},c=f?r.features[t].bbox:g?r.bbox:void 0,v=f?r.features[t].id:g?r.id:void 0,l=a?a.type==="GeometryCollection":!1,s=l?a.geometries.length:1,i=0;i<s;i++){if(o=l?a.geometries[i]:a,o===null){if(e(null,p,u,c,v)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,p,u,c,v)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],p,u,c,v)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}p++}}function Io(r,e,t){var n=t;return Xn(r,function(i,o,s,a,l){o===0&&t===void 0?n=i:n=e(n,i,o,s,a,l)}),n}function Qe(r,e){Xn(r,function(t,n,i,o,s){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(ke(t,i,{bbox:o,id:s}),n,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var c=t.coordinates[u],v={type:l,coordinates:c};if(e(ke(v,i),n,u)===!1)return!1}})}function Bo(r,e,t){var n=t;return Qe(r,function(i,o,s){o===0&&s===0&&t===void 0?n=i:n=e(n,i,o,s)}),n}function Yr(r,e){Qe(r,function(t,n,i){var o=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var a,l=0,u=0,c=0;if(Ve(t,function(v,p,f,g,y){if(a===void 0||n>l||g>u||y>c){a=v,l=n,u=g,c=y,o=0;return}var _=ge([a,v],t.properties);if(e(_,n,i,y,o)===!1)return!1;o++,a=v})===!1)return!1}}})}function Xr(r,e,t){var n=t,i=!1;return Yr(r,function(o,s,a,l,u){i===!1&&t===void 0?n=o:n=e(n,o,s,a,l,u),i=!0}),n}function zr(r,e){if(!r)throw new Error("geojson is required");Qe(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,s=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<s.length;a++)if(e(ge(s[a],t.properties),n,i,a)===!1)return!1;break}}})}function Do(r,e,t){var n=t;return zr(r,function(i,o,s,a){o===0&&t===void 0?n=i:n=e(n,i,o,s,a)}),n}function Go(r,e){if(e=e||{},!qn(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,s=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),s=s||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":s=s||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=l.length+o-1),ge([l[o],l[o+1]],s,e);case"Polygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o-1),ge([l[i][o],l[i][o+1]],s,e);case"MultiLineString":return n<0&&(n=l.length+n),o<0&&(o=l[n].length+o-1),ge([l[n][o],l[n][o+1]],s,e);case"MultiPolygon":return n<0&&(n=l.length+n),i<0&&(i=l[n].length+i),o<0&&(o=l[n][i].length-o-1),ge([l[n][i][o],l[n][i][o+1]],s,e)}throw new Error("geojson is invalid")}function qo(r,e){if(e=e||{},!qn(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,s=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),s=s||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":s=s||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var l=a.coordinates;switch(a.type){case"Point":return de(l,s,e);case"MultiPoint":return n<0&&(n=l.length+n),de(l[n],s,e);case"LineString":return o<0&&(o=l.length+o),de(l[o],s,e);case"Polygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),de(l[i][o],s,e);case"MultiLineString":return n<0&&(n=l.length+n),o<0&&(o=l[n].length+o),de(l[n][o],s,e);case"MultiPolygon":return n<0&&(n=l.length+n),i<0&&(i=l[n].length+i),o<0&&(o=l[n][i].length-o),de(l[n][i][o],s,e)}throw new Error("geojson is invalid")}const Yo=Object.freeze(Object.defineProperty({__proto__:null,coordAll:To,coordEach:Ve,coordReduce:No,featureEach:st,featureReduce:qr,findPoint:qo,findSegment:Go,flattenEach:Qe,flattenReduce:Bo,geomEach:Xn,geomReduce:Io,lineEach:zr,lineReduce:Do,propEach:Gr,propReduce:Fo,segmentEach:Yr,segmentReduce:Xr},Symbol.toStringTag,{value:"Module"}));function Ct(r,e){return e===void 0&&(e={}),Xr(r,function(t,n){var i=n.geometry.coordinates;return t+qe(i[0],i[1],e)},0)}function Xo(r){let e,t,n,i,o,s,a,l,u,c,v,p,f,g,y,_,L,h,d,m=r[0].features.length+"",S,R,M,A,C,w,P,G;return{c(){e=E("div"),t=E("label"),n=j(`Scheme name:
    `),i=E("input"),o=T(),s=E("br"),a=T(),l=E("div"),u=E("label"),c=E("input"),v=T(),p=E("button"),p.textContent="Load from GeoJSON",f=T(),g=E("button"),g.textContent="Export to GeoJSON",y=T(),_=E("br"),L=T(),h=E("div"),d=E("span"),S=j(m),R=j(" interventions"),M=T(),A=E("button"),C=j("Clear all"),F(i,"type","text"),F(c,"type","file"),F(c,"id","load_geojson"),F(c,"class","svelte-lhyd1e"),F(p,"type","button"),F(g,"type","button"),F(g,"class","align-right svelte-lhyd1e"),F(A,"type","button"),F(A,"class","align-right svelte-lhyd1e"),A.disabled=w=r[0].features.length==0},m(N,O){k(N,e,O),b(e,t),b(t,n),b(t,i),rt(i,r[0].scheme_name),k(N,o,O),k(N,s,O),k(N,a,O),k(N,l,O),b(l,u),b(u,c),b(u,v),b(u,p),b(l,f),b(l,g),k(N,y,O),k(N,_,O),k(N,L,O),k(N,h,O),b(h,d),b(d,S),b(d,R),b(h,M),b(h,A),b(A,C),P||(G=[J(i,"input",r[5]),J(c,"change",r[3]),J(p,"click",r[6]),J(g,"click",r[2]),J(A,"click",r[1])],P=!0)},p(N,[O]){O&1&&i.value!==N[0].scheme_name&&rt(i,N[0].scheme_name),O&1&&m!==(m=N[0].features.length+"")&&An(S,m),O&1&&w!==(w=N[0].features.length==0)&&(A.disabled=w)},i:U,o:U,d(N){N&&x(e),N&&x(o),N&&x(s),N&&x(a),N&&x(l),N&&x(y),N&&x(_),N&&x(L),N&&x(h),P=!1,at(G)}}}function zo(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Jo(r,e,t){let n;te(r,W,f=>t(0,n=f));let{authorityName:i}=e,o=window.localStorage.getItem(i);if(o)try{W.set(c(JSON.parse(o)))}catch(f){console.log(`Failed to load from local storage: ${f}`)}function s(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&W.update(f=>(delete f.scheme_name,f.features=[],f))}function a(){const f=JSON.parse(JSON.stringify(n));for(let g of f.features)delete g.properties.hide_while_editing;return f}function l(){let f=a();var g=i;f.authority=i,f.origin="atip-v1",f.scheme_name&&(g+="_"+f.scheme_name),g+=".txt",zo(g,JSON.stringify(f,null,"  "))}function u(f){const g=new FileReader;g.onload=y=>{try{W.set(c(JSON.parse(y.target.result)))}catch(_){window.alert(`Couldn't load scheme from a file: ${_}`)}},g.readAsText(f.target.files[0])}function c(f){let g=1;for(let y of f.features)y.geometry.type=="LineString"&&!y.properties.length_meters&&(y.properties.length_meters=Ct(y,{units:"kilometers"})*1e3),y.id=g++;return f}function v(){n.scheme_name=this.value,W.set(n)}const p=()=>document.getElementById("load_geojson").click();return r.$$set=f=>{"authorityName"in f&&t(4,i=f.authorityName)},r.$$.update=()=>{r.$$.dirty&17&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(i,JSON.stringify(a())))},[n,s,l,u,i,v,p]}class Uo extends ne{constructor(e){super(),re(this,e,Jo,Xo,ee,{authorityName:4})}}const $o="/atip/modal/assets/zoom_out_map-b2e1091a.svg";function jo(r){let e,t,n,i,o;return{c(){e=E("button"),t=E("img"),gi(t.src,n=$o)||F(t,"src",n),F(t,"alt","Zoom to show entire boundary"),F(e,"type","button"),F(e,"title","Zoom to show entire boundary"),F(e,"class","svelte-qzjsqo")},m(s,a){k(s,e,a),b(e,t),i||(o=J(e,"click",r[0]),i=!0)},p:U,i:U,o:U,d(s){s&&x(e),i=!1,o()}}}function Wo(r,e,t){let n;te(r,Ce,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(On(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class Ho extends ne{constructor(e){super(),re(this,e,Wo,jo,ee,{boundaryGeojson:1})}}function Vo(r){let e,t,n,i,o,s,a;return{c(){e=E("div"),t=j(`Basemap:
  `),n=E("select"),i=E("option"),i.textContent="Streets",o=E("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&Nr(()=>r[2].call(n)),F(e,"class","svelte-1tbnm6i")},m(l,u){k(l,e,u),b(e,t),b(e,n),b(n,i),b(n,o),Zn(n,r[0]),s||(a=[J(n,"change",r[2]),J(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&Zn(n,l[0])},i:U,o:U,d(l){l&&x(e),s=!1,at(a)}}}function Qo(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=vi(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Zo extends ne{constructor(e){super(),re(this,e,Qo,Vo,ee,{style:0})}}const ye={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",hovering:"black",lineEndpointColor:"black"},Qt=10,Xt=10;function Ko(r){let e,t,n,i,o,s,a,l,u,c,v,p,f,g,y,_,L,h,d;return{c(){e=E("div"),t=E("h1"),t.textContent="Interventions",n=T(),i=E("ul"),o=E("li"),s=E("span"),a=j("Areas"),l=T(),u=E("li"),c=E("span"),v=j("Routes"),p=T(),f=E("li"),g=E("span"),y=j("Crossings"),_=T(),L=E("li"),h=E("span"),d=j("Other"),F(t,"class","svelte-p551i1"),F(s,"class","svelte-p551i1"),pt(s,"background",ye.area),F(c,"class","svelte-p551i1"),pt(c,"background",ye.route),F(g,"class","svelte-p551i1"),pt(g,"background",ye.crossing),F(h,"class","svelte-p551i1"),pt(h,"background",ye.other),F(e,"class","svelte-p551i1")},m(m,S){k(m,e,S),b(e,t),b(e,n),b(e,i),b(i,o),b(o,s),b(o,a),b(i,l),b(i,u),b(u,c),b(u,v),b(i,p),b(i,f),b(f,g),b(f,y),b(i,_),b(i,L),b(L,h),b(L,d)},p:U,i:U,o:U,d(m){m&&x(e)}}}class es extends ne{constructor(e){super(),re(this,e,null,Ko,ee,{})}}let Ke="interventions";function ts(r,e,t){let n,i;te(r,Ce,l=>t(0,n=l)),te(r,W,l=>t(1,i=l)),ft(n,Ke,{type:"geojson",data:i});const o=["match",["get","intervention_type"],"area",ye.area,"route",ye.route,"crossing",ye.crossing,"other",ye.other,"white"],s=["!=","hide_while_editing",!0];return be(n,{id:"interventions-points",source:Ke,filter:["all",Tn,s,["!=","endpoint",!0]],...Lt(o,Qt)}),be(n,{id:"interventions-lines",source:Ke,filter:["all",Fn,s],...Bt(o,Xt)},"route-lines"),be(n,{id:"interventions-lines-endpoints",source:Ke,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Xt,"circle-opacity":0,"circle-stroke-color":ye.lineEndpointColor,"circle-stroke-width":2}}),be(n,{id:"interventions-polygons",source:Ke,filter:["all",Nn,s],...In(o,.5)},"hover-polygons"),r.$$.update=()=>{if(r.$$.dirty&3){let l=JSON.parse(JSON.stringify(i)),u=[];for(let c of l.features)if(c.geometry.type=="LineString")for(let v of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])u.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:v}});l.features=l.features.concat(u),n.getSource(Ke).setData(l)}},[n,i]}class ns extends ne{constructor(e){super(),re(this,e,ts,null,ee,{})}}let et="hover";function rs(r,e,t){let n,i,o,s,a;return te(r,Ce,l=>t(0,n=l)),te(r,W,l=>t(1,i=l)),te(r,Dt,l=>t(2,o=l)),te(r,Te,l=>t(3,s=l)),te(r,Se,l=>t(4,a=l)),ft(n,et,{type:"geojson",data:Ie()}),be(n,{id:"hover-polygons",source:et,filter:Nn,...Bt(ye.hovering,.5*Xt,1)}),be(n,{id:"hover-lines",source:et,filter:Fn,...Bt(ye.hovering,1.5*Xt,1)},"interventions-lines"),be(n,{id:"hover-points",source:et,filter:Tn,...Lt(ye.hovering,1.5*Qt,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(et).setData(i.features.find(u=>u.id==l)):n.getSource(et).setData(Ie())}},[n,i,o,s,a]}class is extends ne{constructor(e){super(),re(this,e,rs,null,ee,{})}}const Rt="edit-point-mode";var kt,mn;class os{constructor(e){We(this,kt);me(this,"map");me(this,"active");me(this,"eventListeners");me(this,"cursor");this.map=e,this.active=!1,this.eventListeners=[],this.cursor=null,e.on("mousemove",t=>{this.active&&(this.cursor=ss(t.lngLat.toArray()),V(this,kt,mn).call(this))}),e.on("click",()=>{if(this.active&&this.cursor){for(let t of this.eventListeners)t(this.cursor);this.stop()}}),ft(e,Rt,{type:"geojson",data:Ie()}),be(e,{id:"edit-point-mode",source:Rt,...Lt(ye.hovering,Qt,1)})}addEventListener(e){this.eventListeners.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Rt)}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,V(this,kt,mn).call(this)}}kt=new WeakSet,mn=function(){let e=Ie();this.cursor&&e.features.push(this.cursor),this.map.getSource(Rt).setData(e)};function ss(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Jr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return ls(r,e);var n=Ue(r),i=Ue(e),o=we(n[0]),s=we(i[0]),a=we(n[1]),l=we(i[1]),u=Math.sin(s-o)*Math.cos(l),c=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return wt(Math.atan2(u,c))}function ls(r,e){var t=Jr(e,r);return t=(t+180)%360,t}function br(r,e,t,n){n===void 0&&(n={});var i=Ue(r),o=we(i[0]),s=we(i[1]),a=we(t),l=Vt(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),v=wt(c),p=wt(u);return de([v,p],n.properties)}function yn(r){if(!r)throw new Error("geojson is required");var e=[];return Qe(r,function(t){as(t,e)}),Ee(e)}function as(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ae(n);break;case"LineString":t=[Ae(n)]}t.forEach(function(i){var o=us(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function us(r,e){var t=[];return r.reduce(function(n,i){var o=ge([n,i],e);return o.bbox=fs(n,i),t.push(o),i}),t}function fs(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var lt={},cs={get exports(){return lt},set exports(r){lt=r}},_n={},hs={get exports(){return _n},set exports(r){_n=r}};(function(r,e){(function(t,n){r.exports=n()})(mi,function(){function t(h,d,m,S,R){(function M(A,C,w,P,G){for(;P>w;){if(P-w>600){var N=P-w+1,O=C-w+1,H=Math.log(N),ie=.5*Math.exp(2*H/3),he=.5*Math.sqrt(H*ie*(N-ie)/N)*(O-N/2<0?-1:1),pe=Math.max(w,Math.floor(C-O*ie/N+he)),ue=Math.min(P,Math.floor(C+(N-O)*ie/N+he));M(A,C,pe,ue,G)}var Me=A[C],_e=w,$=P;for(n(A,w,C),G(A[P],Me)>0&&n(A,w,P);_e<$;){for(n(A,_e,$),_e++,$--;G(A[_e],Me)<0;)_e++;for(;G(A[$],Me)>0;)$--}G(A[w],Me)===0?n(A,w,$):n(A,++$,P),$<=C&&(w=$+1),C<=$&&(P=$-1)}})(h,d,m||0,S||h.length-1,R||i)}function n(h,d,m){var S=h[d];h[d]=h[m],h[m]=S}function i(h,d){return h<d?-1:h>d?1:0}var o=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(h,d,m){if(!m)return d.indexOf(h);for(var S=0;S<d.length;S++)if(m(h,d[S]))return S;return-1}function a(h,d){l(h,0,h.children.length,d,h)}function l(h,d,m,S,R){R||(R=_(null)),R.minX=1/0,R.minY=1/0,R.maxX=-1/0,R.maxY=-1/0;for(var M=d;M<m;M++){var A=h.children[M];u(R,h.leaf?S(A):A)}return R}function u(h,d){return h.minX=Math.min(h.minX,d.minX),h.minY=Math.min(h.minY,d.minY),h.maxX=Math.max(h.maxX,d.maxX),h.maxY=Math.max(h.maxY,d.maxY),h}function c(h,d){return h.minX-d.minX}function v(h,d){return h.minY-d.minY}function p(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function f(h){return h.maxX-h.minX+(h.maxY-h.minY)}function g(h,d){return h.minX<=d.minX&&h.minY<=d.minY&&d.maxX<=h.maxX&&d.maxY<=h.maxY}function y(h,d){return d.minX<=h.maxX&&d.minY<=h.maxY&&d.maxX>=h.minX&&d.maxY>=h.minY}function _(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function L(h,d,m,S,R){for(var M=[d,m];M.length;)if(!((m=M.pop())-(d=M.pop())<=S)){var A=d+Math.ceil((m-d)/S/2)*S;t(h,A,d,m,R),M.push(d,A,A,m)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(h){var d=this.data,m=[];if(!y(h,d))return m;for(var S=this.toBBox,R=[];d;){for(var M=0;M<d.children.length;M++){var A=d.children[M],C=d.leaf?S(A):A;y(h,C)&&(d.leaf?m.push(A):g(h,C)?this._all(A,m):R.push(A))}d=R.pop()}return m},o.prototype.collides=function(h){var d=this.data;if(!y(h,d))return!1;for(var m=[];d;){for(var S=0;S<d.children.length;S++){var R=d.children[S],M=d.leaf?this.toBBox(R):R;if(y(h,M)){if(d.leaf||g(h,M))return!0;m.push(R)}}d=m.pop()}return!1},o.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var d=0;d<h.length;d++)this.insert(h[d]);return this}var m=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===m.height)this._splitRoot(this.data,m);else{if(this.data.height<m.height){var S=this.data;this.data=m,m=S}this._insert(m,this.data.height-m.height-1,!0)}else this.data=m;return this},o.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(h,d){if(!h)return this;for(var m,S,R,M=this.data,A=this.toBBox(h),C=[],w=[];M||C.length;){if(M||(M=C.pop(),S=C[C.length-1],m=w.pop(),R=!0),M.leaf){var P=s(h,M.children,d);if(P!==-1)return M.children.splice(P,1),C.push(M),this._condense(C),this}R||M.leaf||!g(M,A)?S?(m++,M=S.children[m],R=!1):M=null:(C.push(M),w.push(m),m=0,S=M,M=M.children[0])}return this},o.prototype.toBBox=function(h){return h},o.prototype.compareMinX=function(h,d){return h.minX-d.minX},o.prototype.compareMinY=function(h,d){return h.minY-d.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(h){return this.data=h,this},o.prototype._all=function(h,d){for(var m=[];h;)h.leaf?d.push.apply(d,h.children):m.push.apply(m,h.children),h=m.pop();return d},o.prototype._build=function(h,d,m,S){var R,M=m-d+1,A=this._maxEntries;if(M<=A)return a(R=_(h.slice(d,m+1)),this.toBBox),R;S||(S=Math.ceil(Math.log(M)/Math.log(A)),A=Math.ceil(M/Math.pow(A,S-1))),(R=_([])).leaf=!1,R.height=S;var C=Math.ceil(M/A),w=C*Math.ceil(Math.sqrt(A));L(h,d,m,w,this.compareMinX);for(var P=d;P<=m;P+=w){var G=Math.min(P+w-1,m);L(h,P,G,C,this.compareMinY);for(var N=P;N<=G;N+=C){var O=Math.min(N+C-1,G);R.children.push(this._build(h,N,O,S-1))}}return a(R,this.toBBox),R},o.prototype._chooseSubtree=function(h,d,m,S){for(;S.push(d),!d.leaf&&S.length-1!==m;){for(var R=1/0,M=1/0,A=void 0,C=0;C<d.children.length;C++){var w=d.children[C],P=p(w),G=(N=h,O=w,(Math.max(O.maxX,N.maxX)-Math.min(O.minX,N.minX))*(Math.max(O.maxY,N.maxY)-Math.min(O.minY,N.minY))-P);G<M?(M=G,R=P<R?P:R,A=w):G===M&&P<R&&(R=P,A=w)}d=A||d.children[0]}var N,O;return d},o.prototype._insert=function(h,d,m){var S=m?h:this.toBBox(h),R=[],M=this._chooseSubtree(S,this.data,d,R);for(M.children.push(h),u(M,S);d>=0&&R[d].children.length>this._maxEntries;)this._split(R,d),d--;this._adjustParentBBoxes(S,R,d)},o.prototype._split=function(h,d){var m=h[d],S=m.children.length,R=this._minEntries;this._chooseSplitAxis(m,R,S);var M=this._chooseSplitIndex(m,R,S),A=_(m.children.splice(M,m.children.length-M));A.height=m.height,A.leaf=m.leaf,a(m,this.toBBox),a(A,this.toBBox),d?h[d-1].children.push(A):this._splitRoot(m,A)},o.prototype._splitRoot=function(h,d){this.data=_([h,d]),this.data.height=h.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(h,d,m){for(var S,R,M,A,C,w,P,G=1/0,N=1/0,O=d;O<=m-d;O++){var H=l(h,0,O,this.toBBox),ie=l(h,O,m,this.toBBox),he=(R=H,M=ie,A=void 0,C=void 0,w=void 0,P=void 0,A=Math.max(R.minX,M.minX),C=Math.max(R.minY,M.minY),w=Math.min(R.maxX,M.maxX),P=Math.min(R.maxY,M.maxY),Math.max(0,w-A)*Math.max(0,P-C)),pe=p(H)+p(ie);he<G?(G=he,S=O,N=pe<N?pe:N):he===G&&pe<N&&(N=pe,S=O)}return S||m-d},o.prototype._chooseSplitAxis=function(h,d,m){var S=h.leaf?this.compareMinX:c,R=h.leaf?this.compareMinY:v;this._allDistMargin(h,d,m,S)<this._allDistMargin(h,d,m,R)&&h.children.sort(S)},o.prototype._allDistMargin=function(h,d,m,S){h.children.sort(S);for(var R=this.toBBox,M=l(h,0,d,R),A=l(h,m-d,m,R),C=f(M)+f(A),w=d;w<m-d;w++){var P=h.children[w];u(M,h.leaf?R(P):P),C+=f(M)}for(var G=m-d-1;G>=d;G--){var N=h.children[G];u(A,h.leaf?R(N):N),C+=f(A)}return C},o.prototype._adjustParentBBoxes=function(h,d,m){for(var S=m;S>=0;S--)u(d[S],h)},o.prototype._condense=function(h){for(var d=h.length-1,m=void 0;d>=0;d--)h[d].children.length===0?d>0?(m=h[d-1].children).splice(m.indexOf(h[d]),1):this.clear():a(h[d],this.toBBox)},o})})(hs);const ps=Cn(ji),ds=Cn(Yo);function zt(r){var e=[1/0,1/0,-1/0,-1/0];return Ve(r,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}zt.default=zt;const gs=Object.freeze(Object.defineProperty({__proto__:null,default:zt},Symbol.toStringTag,{value:"Module"})),vs=Cn(gs);var Le=_n,Ur=ps,$r=ds,tt=vs.default,ms=$r.featureEach;$r.coordEach;Ur.polygon;var wr=Ur.featureCollection;function jr(r){var e=new Le(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:tt(t),Le.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:tt(i),n.push(i)}):ms(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:tt(i),n.push(i)}),Le.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:tt(t),Le.prototype.remove.call(this,t,n)},e.clear=function(){return Le.prototype.clear.call(this)},e.search=function(t){var n=Le.prototype.search.call(this,this.toBBox(t));return wr(n)},e.collides=function(t){return Le.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Le.prototype.all.call(this);return wr(t)},e.toJSON=function(){return Le.prototype.toJSON.call(this)},e.fromJSON=function(t){return Le.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=tt(t);else if(t.type==="FeatureCollection")n=tt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}cs.exports=jr;lt.default=jr;function Wr(r,e){var t={},n=[];if(r.type==="LineString"&&(r=ke(r)),e.type==="LineString"&&(e=ke(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Sr(r,e);return i&&n.push(i),Ee(n)}var o=lt();return o.load(yn(e)),st(yn(r),function(s){st(o.search(s),function(a){var l=Sr(s,a);if(l){var u=Ae(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),Ee(n)}function Sr(r,e){var t=Ae(r),n=Ae(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],c=n[1][0],v=n[1][1],p=(v-u)*(s-i)-(c-l)*(a-o),f=(c-l)*(o-u)-(v-u)*(i-l),g=(s-i)*(o-u)-(a-o)*(i-l);if(p===0)return f===0&&g===0,null;var y=f/p,_=g/p;if(y>=0&&y<=1&&_>=0&&_<=1){var L=i+y*(s-i),h=o+y*(a-o);return de([L,h])}return null}function Et(r,e,t){t===void 0&&(t={});var n=de([1/0,1/0],{dist:1/0}),i=0;return Qe(r,function(o){for(var s=Ae(o),a=0;a<s.length-1;a++){var l=de(s[a]);l.properties.dist=qe(e,l,t);var u=de(s[a+1]);u.properties.dist=qe(e,u,t);var c=qe(l,u,t),v=Math.max(l.properties.dist,u.properties.dist),p=Jr(l,u),f=br(e,v,p+90,t),g=br(e,v,p-90,t),y=Wr(ge([f.geometry.coordinates,g.geometry.coordinates]),ge([l.geometry.coordinates,u.geometry.coordinates])),_=null;y.features.length>0&&(_=y.features[0],_.properties.dist=qe(e,_,t),_.properties.location=i+qe(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+c),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a),i+=c}}),n}const nt="edit-polygon-mode";var Ne,He,xt,bn,Mt,wn;class ys{constructor(e){We(this,Ne);We(this,xt);We(this,Mt);me(this,"map");me(this,"active");me(this,"eventListeners");me(this,"points");me(this,"cursor");me(this,"hoverPolyon");me(this,"hoverPoint");me(this,"dragging");me(this,"dragFrom");this.map=e,this.active=!1,this.eventListeners=[],this.points=[],this.cursor=null,this.hoverPolyon=!1,this.hoverPoint=null,this.dragging=!1,this.dragFrom=null,e.on("mousemove",t=>{if(this.active&&!this.dragging)V(this,xt,bn).call(this,t);else if(this.active&&this.dragging){if(this.hoverPolyon){let n=this.dragFrom[0]-t.lngLat.lng,i=this.dragFrom[1]-t.lngLat.lat;for(let o of this.points)o[0]-=n,o[1]-=i}else this.points[this.hoverPoint]=t.lngLat.toArray();this.dragFrom=t.lngLat.toArray(),V(this,Ne,He).call(this)}}),e.on("click",t=>{if(this.active&&this.cursor){let n=[];if(kr(this.points).forEach((i,o)=>{n.push([o+1,Et(i,this.cursor).properties.dist])}),n.sort((i,o)=>i[1]-o[1]),n.length>0){let i=n[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hoverPoint=i}else this.points.push(this.cursor.geometry.coordinates),this.hoverPoint=this.points.length-1;V(this,Ne,He).call(this)}else this.active&&this.hoverPoint!=null&&(this.points.splice(this.hoverPoint,1),this.hoverPoint=null,V(this,Ne,He).call(this),V(this,xt,bn).call(this,t))}),e.on("mousedown",t=>{this.active&&!this.dragging&&(this.hoverPolyon||this.hoverPoint!=null)&&(t.preventDefault(),this.cursor=null,this.dragging=!0,this.dragFrom=t.lngLat.toArray())}),e.on("mouseup",()=>{this.active&&this.dragging&&(this.dragging=!1,this.dragFrom=null)}),document.addEventListener("keypress",t=>{if(this.active&&t.key=="Enter"){t.preventDefault();let n=V(this,Mt,wn).call(this);if(n)for(let i of this.eventListeners)i(n);this.stop()}}),ft(e,nt,{type:"geojson",data:Ie()}),be(e,{id:"edit-polygon-fill",source:nt,filter:Nn,...In("red",["case",["boolean",["get","hover"],"false"],1,.5])}),be(e,{id:"edit-polygon-lines",source:nt,filter:Fn,...Bt("black",8,.5)}),be(e,{id:"edit-polygon-vertices",source:nt,filter:Tn,...Lt(ye.hovering,Qt,["case",["boolean",["get","hover"],"false"],1,.5])})}addEventListener(e){this.eventListeners.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(nt)}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=e.geometry.coordinates[0],this.points.pop(),V(this,Ne,He).call(this)}stop(){this.points=[],this.cursor=null,this.active=!1,this.hoverPolyon=!1,this.hoverPoint=null,this.dragging=!1,this.dragFrom=null,V(this,Ne,He).call(this)}}Ne=new WeakSet,He=function(){let e=Ie();this.points.forEach((n,i)=>{let o=Er(n);o.properties.hover=this.hoverPoint==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(kr(this.points));let t=V(this,Mt,wn).call(this);t&&(t.properties.hover=this.hoverPolyon,e.features.push(t)),this.map.getSource(nt).setData(e)},xt=new WeakSet,bn=function(e){this.cursor=null,this.hoverPolyon=!1,this.hoverPoint=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hoverPolyon=!0;break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hoverPoint=t.properties.idx;break}!this.hoverPolyon&&this.hoverPoint==null&&(this.cursor=Er(e.lngLat.toArray())),V(this,Ne,He).call(this)},Mt=new WeakSet,wn=function(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}};function Er(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function kr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]}}),e}function xr(r){let e;return{c(){e=E("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){k(t,e,n)},d(t){t&&x(e)}}}function _s(r){let e,t=r[0]==it&&xr();return{c(){t&&t.c(),e=je()},m(n,i){t&&t.m(n,i),k(n,e,i)},p(n,[i]){n[0]==it?t||(t=xr(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&x(e)}}}const it="edit-attribute";function Hr(){}function bs(r,e,t){let n,i;te(r,Ce,l=>t(4,n=l)),te(r,W,l=>t(5,i=l));let{mode:o}=e,{changeMode:s}=e;function a(){Se.set(null)}return n.on("mousemove",l=>{if(o==it){let c=n.queryRenderedFeatures(l.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});var u=null;c.length>0&&(u=c[0].id),Te.set(u)}}),n.on("mouseout",()=>{o==it&&Te.set(null)}),n.on("click",l=>{if(o==it){let u=n.queryRenderedFeatures(l.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});u.length>0?Se.set(u[0].id):Se.set(null)}}),an.subscribe(l=>{if(l){let u=i.features.find(c=>c.id==l);u.geometry.type=="Point"?n.flyTo({center:u.geometry.coordinates}):n.fitBounds(On(u),{padding:200,animate:!0,duration:500}),s(it)}}),r.$$set=l=>{"mode"in l&&t(0,o=l.mode),"changeMode"in l&&t(1,s=l.changeMode)},[o,s,Hr,a]}class ws extends ne{constructor(e){super(),re(this,e,bs,_s,ee,{mode:0,changeMode:1,start:2,stop:3})}get start(){return Hr}get stop(){return this.$$.ctx[3]}}function Mr(r){let e;return{c(){e=E("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){k(t,e,n)},d(t){t&&x(e)}}}function Ss(r){let e,t=r[0]==De&&Mr();return{c(){t&&t.c(),e=je()},m(n,i){t&&t.m(n,i),k(n,e,i)},p(n,[i]){n[0]==De?t||(t=Mr(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&x(e)}}}const De="edit-geometry";function Vr(){}function Es(r,e,t){let n;te(r,Ce,p=>t(8,n=p));let{mode:i}=e,{routeSnapper:o}=e,{snapTool:s}=e,{pointTool:a}=e,{polygonTool:l}=e;function u(){c&&(o.stop(),a.stop(),l.stop(),W.update(p=>{let f=p.features.find(g=>g.id==c);return delete f.properties.hide_while_editing,p})),c=null,Te.set(null)}let c=null;n.on("mousemove",p=>{if(i==De&&c==null){let g=n.queryRenderedFeatures(p.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});var f=null;g.length>0&&(f=g[0].id),Te.set(f)}}),n.on("mouseout",()=>{i==De&&c==null&&Te.set(null)}),n.on("click",p=>{if(i==De&&c==null){let f=n.queryRenderedFeatures(p.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});f.length>0&&v(f[0].id)}}),s.addEventListener("new-route",p=>{if(i==De){const f=p.detail;W.update(g=>{let y=g.features.find(_=>_.id==c);return y.properties.length_meters=f.properties.length_meters,y.properties.waypoints=f.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=f.geometry,g}),c=null}}),s.addEventListener("no-new-route",()=>{i==De&&(W.update(p=>{let f=p.features.find(g=>g.id==c);return delete f.properties.hide_while_editing,p}),c=null)});for(let p of[a,l])p.addEventListener(f=>{i==De&&(W.update(g=>{let y=g.features.find(_=>_.id==c);return y.geometry=f.geometry,delete y.properties.hide_while_editing,g}),c=null)});function v(p){Te.set(null);let f;W.update(g=>(f=g.features.find(y=>y.id==p),f.properties.hide_while_editing=!0,g)),c=p,f.geometry.type=="LineString"?o.editExisting(f):f.geometry.type=="Polygon"?l.editExisting(f):f.geometry.type=="Point"&&a.start()}return r.$$set=p=>{"mode"in p&&t(0,i=p.mode),"routeSnapper"in p&&t(1,o=p.routeSnapper),"snapTool"in p&&t(2,s=p.snapTool),"pointTool"in p&&t(3,a=p.pointTool),"polygonTool"in p&&t(4,l=p.polygonTool)},[i,o,s,a,l,Vr,u]}class ks extends ne{constructor(e){super(),re(this,e,Es,Ss,ee,{mode:0,routeSnapper:1,snapTool:2,pointTool:3,polygonTool:4,start:5,stop:6})}get start(){return Vr}get stop(){return this.$$.ctx[6]}}let D;const Qr=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Qr.decode();let Nt=new Uint8Array;function _t(){return Nt.byteLength===0&&(Nt=new Uint8Array(D.memory.buffer)),Nt}function ot(r,e){return Qr.decode(_t().subarray(r,r+e))}const Fe=new Array(32).fill(void 0);Fe.push(void 0,null,!0,!1);let bt=Fe.length;function se(r){bt===Fe.length&&Fe.push(Fe.length+1);const e=bt;return bt=Fe[e],Fe[e]=r,e}function X(r){return Fe[r]}function xs(r){r<36||(Fe[r]=bt,bt=r)}function Sn(r){const e=X(r);return xs(r),e}function nn(r){return r==null}let Ft=new Float64Array;function Ms(){return Ft.byteLength===0&&(Ft=new Float64Array(D.memory.buffer)),Ft}let Tt=new Int32Array;function le(){return Tt.byteLength===0&&(Tt=new Int32Array(D.memory.buffer)),Tt}let Xe=0;const It=new TextEncoder("utf-8"),Ps=typeof It.encodeInto=="function"?function(r,e){return It.encodeInto(r,e)}:function(r,e){const t=It.encode(r);return e.set(t),{read:r.length,written:t.length}};function Ot(r,e,t){if(t===void 0){const a=It.encode(r),l=e(a.length);return _t().subarray(l,l+a.length).set(a),Xe=a.length,l}let n=r.length,i=e(n);const o=_t();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=_t().subarray(i+s,i+n),l=Ps(r,a);s+=l.written}return Xe=s,i}function En(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=En(r[0]));for(let s=1;s<i;s++)o+=", "+En(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ls(r,e){const t=e(r.length*1);return _t().set(r,t/1),Xe=r.length,t}function rn(r,e){try{return r.apply(this,e)}catch(t){D.__wbindgen_exn_store(se(t))}}class Jt{static __wrap(e){const t=Object.create(Jt.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();D.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=D.__wbindgen_add_to_stack_pointer(-16),s=Ls(e,D.__wbindgen_malloc),a=Xe;D.jsroutesnapper_new(o,s,a);var t=le()[o/4+0],n=le()[o/4+1],i=le()[o/4+2];if(i)throw Sn(n);return Jt.__wrap(t)}finally{D.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){D.jsroutesnapper_setConfig(this.ptr,se(e))}toFinalFeature(){try{const n=D.__wbindgen_add_to_stack_pointer(-16);D.jsroutesnapper_toFinalFeature(n,this.ptr);var e=le()[n/4+0],t=le()[n/4+1];let i;return e!==0&&(i=ot(e,t).slice(),D.__wbindgen_free(e,t*1)),i}finally{D.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=D.__wbindgen_add_to_stack_pointer(-16);D.jsroutesnapper_renderGeojson(n,this.ptr);var e=le()[n/4+0],t=le()[n/4+1];return ot(e,t)}finally{D.__wbindgen_add_to_stack_pointer(16),D.__wbindgen_free(e,t)}}setSnapMode(e){D.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return D.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){D.jsroutesnapper_onClick(this.ptr)}onDragStart(){return D.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return D.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){D.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=D.__wbindgen_add_to_stack_pointer(-16);D.jsroutesnapper_editExisting(i,this.ptr,se(e));var t=le()[i/4+0],n=le()[i/4+1];if(n)throw Sn(t)}finally{D.__wbindgen_add_to_stack_pointer(16)}}}async function Rs(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Os(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=ot(e,t);return se(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Sn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=X(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ot(e,t));return se(n)},r.wbg.__wbindgen_is_object=function(e){const t=X(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return X(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return X(e)in X(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=X(t),i=typeof n=="number"?n:void 0;Ms()[e/8+1]=nn(i)?0:i,le()[e/4+0]=!nn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return X(e)==X(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=X(t),i=typeof n=="string"?n:void 0;var o=nn(i)?0:Ot(i,D.__wbindgen_malloc,D.__wbindgen_realloc),s=Xe;le()[e/4+1]=s,le()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(X(t)),i=Ot(n,D.__wbindgen_malloc,D.__wbindgen_realloc),o=Xe;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=X(e);return se(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=X(e)[X(t)];return se(n)},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(X(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=X(e)[t>>>0];return se(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return X(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof X(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=X(e).next;return se(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return rn(function(e){const t=X(e).next();return se(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return X(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=X(e).value;return se(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return se(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return rn(function(e,t){const n=Reflect.get(X(e),X(t));return se(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return rn(function(e,t){const n=X(e).call(X(t));return se(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(X(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=X(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=X(e).buffer;return se(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(X(e));return se(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){X(e).set(X(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return X(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=X(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return se(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=X(t).stack,i=Ot(n,D.__wbindgen_malloc,D.__wbindgen_realloc),o=Xe;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(ot(e,t))}finally{D.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=En(X(t)),i=Ot(n,D.__wbindgen_malloc,D.__wbindgen_realloc),o=Xe;le()[e/4+1]=o,le()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ot(e,t))},r.wbg.__wbindgen_memory=function(){const e=D.memory;return se(e)},r}function As(r,e){return D=r.exports,Zr.__wbindgen_wasm_module=e,Ft=new Float64Array,Tt=new Int32Array,Nt=new Uint8Array,D}async function Zr(r){typeof r>"u"&&(r="/atip/modal/assets/route_snapper_bg.wasm");const e=Os();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Rs(await r,e);return As(t,n)}var Pt,kn,Oe,Be;class Cs{constructor(e,t,n){We(this,Pt);We(this,Oe);this.controlDiv=n,this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Jt(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),console.log("JsRouteSnapper ready, waiting for idle event"),this.active=!1,this.loaded=!1,this.map.once("idle",()=>{console.log("JsRouteSnapper now usable"),this.map.addSource("route-snapper",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"route-points",type:"circle",source:"route-snapper",paint:{"circle-radius":["match",["get","type"],"unimportant",10/2,10],"circle-color":["match",["get","type"],"hovered","green","important","red","black"]},filter:["in","$type","Point"]}),this.map.addLayer({id:"route-lines",type:"line",source:"route-snapper",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":2.5},filter:["in","$type","LineString"]}),this.loaded=!0,this.map.on("mousemove",s=>{if(!this.active)return;const a={x:s.point.x-30,y:s.point.y},l=this.map.unproject(s.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(s.lngLat.lng,s.lngLat.lat,l)&&V(this,Oe,Be).call(this)}),this.map.on("click",()=>{this.active&&(this.inner.onClick(),V(this,Oe,Be).call(this))}),this.map.on("dragstart",s=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}),this.map.on("mouseup",s=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}),document.addEventListener("keypress",s=>{this.active&&s.key=="Enter"&&(s.preventDefault(),V(this,Pt,kn).call(this))}),document.addEventListener("keydown",s=>{this.active&&s.key=="Shift"&&(s.preventDefault(),this.inner.setSnapMode(!1),V(this,Oe,Be).call(this))}),document.addEventListener("keyup",s=>{this.active&&s.key=="Shift"&&(s.preventDefault(),this.inner.setSnapMode(!0),V(this,Oe,Be).call(this))}),this.stop()})}isActive(){return this.active}tearDown(){this.loaded&&(this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeSource("route-snapper"))}editExisting(e){if(!this.loaded){console.error("editExisting called before the map idle event received. Not starting tool.");return}e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.start(),this.inner.editExisting(e.properties.waypoints),V(this,Oe,Be).call(this)}stop(){if(!this.loaded)return;this.active=!1,this.inner.clearState(),V(this,Oe,Be).call(this),this.controlDiv.innerHTML="";let e=document.createElement("button");e.innerText="Route tool",e.type="button",e.onclick=()=>{this.controlDiv.dispatchEvent(new CustomEvent("activate")),this.start()},this.controlDiv.appendChild(e)}start(){if(this.active)return;this.active=!0;let e=document.createElement("button");e.type="button",e.innerText="Finish route",e.onclick=()=>{V(this,Pt,kn).call(this)};let t=document.createElement("button");t.type="button",t.innerText="Cancel",t.onclick=()=>{this.controlDiv.dispatchEvent(new CustomEvent("no-new-route")),this.stop()},this.controlDiv.innerHTML="";let n=document.createElement("div");n.style="display: flex; justify-content: space-evenly;",n.appendChild(e),n.appendChild(t),this.controlDiv.appendChild(n);let i=document.createElement("input");i.type="checkbox",i.id="avoidDoublingBack",i.onclick=()=>{this.inner.setConfig({avoid_doubling_back:i.checked}),V(this,Oe,Be).call(this)};let o=document.createElement("label");o.innerText="Avoid doubling back",o.for=i.id;let s=document.createElement("div");s.appendChild(i),s.appendChild(o),this.controlDiv.append(s);const a=document.createElement("ul");a.innerHTML="<li><b>Click</b> green points on the transport network</br>to create snapped routes</li><li>Hold <b>Shift</b> to draw a point anywhere</li><li><b>Click and drag</b> any point to move it</li><li><b>Click</b> a red waypoint to delete it</li><li>Press <b>Enter</b> to finish route</li>",this.controlDiv.appendChild(a)}}Pt=new WeakSet,kn=function(){const e=this.inner.toFinalFeature();e?this.controlDiv.dispatchEvent(new CustomEvent("new-route",{detail:JSON.parse(e)})):this.controlDiv.dispatchEvent(new CustomEvent("no-new-route")),this.stop()},Oe=new WeakSet,Be=function(){this.loaded&&this.map.getSource("route-snapper").setData(JSON.parse(this.inner.renderGeojson()))};async function Ns(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:c}=await n.read();if(u)break;s.push(c),o+=c.length;const v=100*o/i;e.style=`background: linear-gradient(to right, red ${v}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function Fs(r){let e,t;return{c(){e=E("div"),t=E("div"),t.textContent="Route tool loading..."},m(n,i){k(n,e,i),b(e,t),r[8](t),r[9](e)},p:U,i:U,o:U,d(n){n&&x(e),r[8](null),r[9](null)}}}const on="route";function Ts(r,e,t){let n;te(r,Ce,g=>t(10,n=g));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,{snapTool:a}=e,l,{routeSnapper:u}=e;function c(){u.isActive()||u.start()}function v(){u==null||u.stop()}Ln(async()=>{await Zr(),console.log(`Grabbing ${s}`);try{const g=await Ns(s,l);t(2,u=new Cs(n,g,a))}catch(g){console.log(`Route tool broke: ${g}`),t(0,a.innerHTML="Failed to load",a)}a.addEventListener("activate",()=>{o(on)}),a.addEventListener("no-new-route",()=>{i==on&&o("edit-attribute")}),a.addEventListener("new-route",g=>{if(i==on){const y=g.detail;W.update(_=>(y.id=Wt(_),y.properties.intervention_type="route",_.features.push(y),_)),o("edit-attribute"),Se.set(y.id)}})}),Rn(()=>{u==null||u.tearDown()});function p(g){ae[g?"unshift":"push"](()=>{l=g,t(1,l)})}function f(g){ae[g?"unshift":"push"](()=>{a=g,t(0,a)})}return r.$$set=g=>{"mode"in g&&t(3,i=g.mode),"changeMode"in g&&t(4,o=g.changeMode),"url"in g&&t(5,s=g.url),"snapTool"in g&&t(0,a=g.snapTool),"routeSnapper"in g&&t(2,u=g.routeSnapper)},[a,l,u,i,o,s,c,v,p,f]}class Is extends ne{constructor(e){super(),re(this,e,Ts,Fs,ee,{mode:3,changeMode:4,url:5,snapTool:0,routeSnapper:2,start:6,stop:7})}get start(){return this.$$.ctx[6]}get stop(){return this.$$.ctx[7]}}function Pr(r){let e;return{c(){e=E("p"),e.textContent="Click to add a new point"},m(t,n){k(t,e,n)},d(t){t&&x(e)}}}function Bs(r){let e,t=r[0]==xn&&Pr();return{c(){t&&t.c(),e=je()},m(n,i){t&&t.m(n,i),k(n,e,i)},p(n,[i]){n[0]==xn?t||(t=Pr(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&x(e)}}}const xn="point";function Ds(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListener(l=>{n==xn&&(W.update(u=>(l.id=Wt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),Se.set(l.id))}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(1,i=l.changeMode),"pointTool"in l&&t(2,o=l.pointTool)},[n,i,o,s,a]}class Gs extends ne{constructor(e){super(),re(this,e,Ds,Bs,ee,{mode:0,changeMode:1,pointTool:2,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Lr(r){let e;return{c(){e=E("p"),e.innerHTML="Click the map to add a vertex, or click a vertex to delete it. Press <strong>Enter</strong> to finish. Drag a vertex or the polygon to move."},m(t,n){k(t,e,n)},d(t){t&&x(e)}}}function qs(r){let e,t=r[0]==Mn&&Lr();return{c(){t&&t.c(),e=je()},m(n,i){t&&t.m(n,i),k(n,e,i)},p(n,[i]){n[0]==Mn?t||(t=Lr(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&x(e)}}}const Mn="polygon";function Ys(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListener(l=>{n==Mn&&(W.update(u=>(l.id=Wt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Se.set(l.id))}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(1,i=l.changeMode),"polygonTool"in l&&t(2,o=l.polygonTool)},[n,i,o,s,a]}class Xs extends ne{constructor(e){super(),re(this,e,Ys,qs,ee,{mode:0,changeMode:1,polygonTool:2,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function zs(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=qe(r.slice(0,2),[n,t]),s=qe(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Js(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return Ve(r,function(s){Us(s,o,n)}),r}function Us(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function $s(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=vn(r),n=vn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Js(e,{precision:7});switch(n){case"Point":return Pn(r,i);case"MultiPoint":return Rr(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Rr(r,Wr(r,i))}}function Rr(r,e){var t=[],n=lt();return Qe(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=Pn(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=zs(zt(a)))}),n.load(Ee(t));else{var o=n.search(i);if(o.features.length){var s=Kr(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),st(Pn(s,i),function(a){t.push(a),n.insert(a)})}}}),Ee(t)}function Pn(r,e){var t=[],n=Ae(r)[0],i=Ae(r)[r.geometry.coordinates.length-1];if(sn(n,Ue(e))||sn(i,Ue(e)))return Ee([r]);var o=lt(),s=yn(r);o.load(s);var a=o.search(e);if(!a.features.length)return Ee([r]);var l=Kr(e,a),u=[n],c=qr(s,function(v,p,f){var g=Ae(p)[1],y=Ue(e);return f===l.id?(v.push(y),t.push(ge(v)),sn(y,g)?[y]:[y,g]):(v.push(g),v)},u);return c.length>1&&t.push(ge(c)),Ee(t)}function Kr(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return st(e,function(i){var o=Et(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function sn(r,e){return r[0]===e[0]&&r[1]===e[1]}function js(r,e,t){var n=Ae(t);if(vn(t)!=="LineString")throw new Error("line must be a LineString");var i=Et(t,r),o=Et(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),ge(a,t.properties)}function Or(r){let e;return{c(){e=E("p"),e.textContent="Click near a route to split it, or click on the map to cancel"},m(t,n){k(t,e,n)},d(t){t&&x(e)}}}function Ws(r){let e,t=r[0]==Ut&&Or();return{c(){t&&t.c(),e=je()},m(n,i){t&&t.m(n,i),k(n,e,i)},p(n,[i]){n[0]==Ut?t||(t=Or(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&x(e)}}}const Ut="split-route",Hs=10,Vs=30;let ln="split-route";function ei(){}function Ar(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Qs(r,e,t){let n,i;te(r,Ce,p=>t(5,n=p)),te(r,W,p=>t(7,i=p));let{mode:o}=e,{changeMode:s}=e;function a(){t(4,l=null),u=null}let l=null,u=null;n.on("mousemove",p=>{if(o!=Ut)return;t(4,l=Ar(p.lngLat.toArray(),!1)),u=null;const f=[p.point.x-Vs,p.point.y],g=n.unproject(p.point).distanceTo(n.unproject(f))/1e3;let y=[];for(let[_,L]of i.features.entries())if(L.geometry.type=="LineString"){let h=Et(L.geometry,l,{units:"kilometers"});h.properties.dist<=g&&y.push([_,h.geometry.coordinates,h.properties.dist])}y.sort((_,L)=>_[2]-L[2]),y.length>0&&(t(4,l=Ar(y[0][1],!0)),u=y[0][0])}),n.on("click",()=>{if(o==Ut)if(u==null)s("edit-attribute");else{let p=$s(i.features[u],l);if(p.features.length==2){let f=p.features[0],g=p.features[1];W.update(y=>(f.id=y.features[u].id,g.id=Wt(y),f.properties=JSON.parse(JSON.stringify(y.features[u].properties)),g.properties=JSON.parse(JSON.stringify(f.properties)),c(y.features[u],f,g,l),y.features.splice(u,1,f,g),y))}a()}}),ft(n,ln,{type:"geojson",data:Ie()}),be(n,{id:"draw-split-route",source:ln,...Lt("black",Hs,["case",["==",["get","snapped"],!0],1,.5])});function c(p,f,g,y){f.properties.length_meters=Ct(f,{units:"kilometers"})*1e3,g.properties.length_meters=Ct(g,{units:"kilometers"})*1e3,f.properties.waypoints=[],g.properties.waypoints=[];let _=v(p,y),L=!0,h=0;for(let d of p.properties.waypoints){let m=v(p,de([d.lon,d.lat]));if(L)if(m<_)f.properties.waypoints.push(d);else{let S=d.snapped&&p.properties.waypoints[h-1].snapped;f.properties.waypoints.push({lon:y.geometry.coordinates[0],lat:y.geometry.coordinates[1],snapped:S}),L=!1,g.properties.waypoints.push({lon:y.geometry.coordinates[0],lat:y.geometry.coordinates[1],snapped:S}),g.properties.waypoints.push(d)}else g.properties.waypoints.push(d);h++}}function v(p,f){let g=p.geometry.coordinates[0],y=js(g,f,p);return Ct(y,{units:"kilometers"})*1e3}return r.$$set=p=>{"mode"in p&&t(0,o=p.mode),"changeMode"in p&&t(1,s=p.changeMode)},r.$$.update=()=>{if(r.$$.dirty&48){let p=Ie();l&&p.features.push(l),n.getSource(ln).setData(p)}},[o,s,ei,a,l,n]}class Zs extends ne{constructor(e){super(),re(this,e,Qs,Ws,ee,{mode:0,changeMode:1,start:2,stop:3})}get start(){return ei}get stop(){return this.$$.ctx[3]}}function Cr(r){let e,t,n={mode:r[3],routeSnapper:r[1],snapTool:r[2],pointTool:r[10],polygonTool:r[11]};return e=new ks({props:n}),r[16](e),{c(){Q(e.$$.fragment)},m(i,o){Z(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&2&&(s.routeSnapper=i[1]),o&4&&(s.snapTool=i[2]),e.$set(s)},i(i){t||(Y(e.$$.fragment,i),t=!0)},o(i){z(e.$$.fragment,i),t=!1},d(i){r[16](null),K(e,i)}}}function Ks(r){let e,t,n,i,o,s,a,l,u,c,v,p,f,g,y,_,L,h,d,m,S,R,M,A,C,w,P,G,N,O,H,ie,he,pe,ue,Me,_e,$,I,B,Zt,zn,ti={mode:r[3],changeMode:r[12]};a=new ws({props:ti}),r[14](a);let oe=r[1]&&r[2]&&Cr(r),ni={mode:r[3],changeMode:r[12],pointTool:r[10]};m=new Gs({props:ni}),r[18](m);let ri={mode:r[3],changeMode:r[12],polygonTool:r[11]};P=new Xs({props:ri}),r[20](P);function ii(q){r[22](q)}function oi(q){r[23](q)}let Kt={mode:r[3],changeMode:r[12],url:r[0]};r[1]!==void 0&&(Kt.routeSnapper=r[1]),r[2]!==void 0&&(Kt.snapTool=r[2]),O=new Is({props:Kt}),r[21](O),ae.push(()=>ze(O,"routeSnapper",ii,r[1])),ae.push(()=>ze(O,"snapTool",oi,r[2]));let si={mode:r[3],changeMode:r[12]};return I=new Zs({props:si}),r[25](I),{c(){e=E("div"),t=E("div"),n=E("button"),i=j("Edit attributes"),s=T(),Q(a.$$.fragment),l=T(),u=E("div"),c=E("button"),v=j("Edit geometry"),f=T(),oe&&oe.c(),g=T(),y=E("div"),_=E("button"),L=j("New point"),d=T(),Q(m.$$.fragment),S=T(),R=E("div"),M=E("button"),A=j("New polygon"),w=T(),Q(P.$$.fragment),G=T(),N=E("div"),Q(O.$$.fragment),he=T(),pe=E("div"),ue=E("button"),Me=j("Split route"),$=T(),Q(I.$$.fragment),F(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",F(n,"class","svelte-cej5os"),F(c,"type","button"),c.disabled=p=r[3]=="edit-geometry",F(c,"class","svelte-cej5os"),F(_,"type","button"),_.disabled=h=r[3]=="point",F(_,"class","svelte-cej5os"),F(M,"type","button"),M.disabled=C=r[3]=="polygon",F(M,"class","svelte-cej5os"),F(ue,"type","button"),ue.disabled=_e=r[3]=="split-route",F(ue,"class","svelte-cej5os"),F(e,"class","toolbox svelte-cej5os")},m(q,fe){k(q,e,fe),b(e,t),b(t,n),b(n,i),b(t,s),Z(a,t,null),b(e,l),b(e,u),b(u,c),b(c,v),b(u,f),oe&&oe.m(u,null),b(e,g),b(e,y),b(y,_),b(_,L),b(y,d),Z(m,y,null),b(e,S),b(e,R),b(R,M),b(M,A),b(R,w),Z(P,R,null),b(e,G),b(e,N),Z(O,N,null),b(e,he),b(e,pe),b(pe,ue),b(ue,Me),b(pe,$),Z(I,pe,null),B=!0,Zt||(zn=[J(n,"click",r[13]),J(c,"click",r[15]),J(_,"click",r[17]),J(M,"click",r[19]),J(ue,"click",r[24])],Zt=!0)},p(q,[fe]){(!B||fe&8&&o!==(o=q[3]=="edit-attribute"))&&(n.disabled=o);const Jn={};fe&8&&(Jn.mode=q[3]),a.$set(Jn),(!B||fe&8&&p!==(p=q[3]=="edit-geometry"))&&(c.disabled=p),q[1]&&q[2]?oe?(oe.p(q,fe),fe&6&&Y(oe,1)):(oe=Cr(q),oe.c(),Y(oe,1),oe.m(u,null)):oe&&($t(),z(oe,1,1,()=>{oe=null}),jt()),(!B||fe&8&&h!==(h=q[3]=="point"))&&(_.disabled=h);const Un={};fe&8&&(Un.mode=q[3]),m.$set(Un),(!B||fe&8&&C!==(C=q[3]=="polygon"))&&(M.disabled=C);const $n={};fe&8&&($n.mode=q[3]),P.$set($n);const ct={};fe&8&&(ct.mode=q[3]),fe&1&&(ct.url=q[0]),!H&&fe&2&&(H=!0,ct.routeSnapper=q[1],Je(()=>H=!1)),!ie&&fe&4&&(ie=!0,ct.snapTool=q[2],Je(()=>ie=!1)),O.$set(ct),(!B||fe&8&&_e!==(_e=q[3]=="split-route"))&&(ue.disabled=_e);const jn={};fe&8&&(jn.mode=q[3]),I.$set(jn)},i(q){B||(Y(a.$$.fragment,q),Y(oe),Y(m.$$.fragment,q),Y(P.$$.fragment,q),Y(O.$$.fragment,q),Y(I.$$.fragment,q),B=!0)},o(q){z(a.$$.fragment,q),z(oe),z(m.$$.fragment,q),z(P.$$.fragment,q),z(O.$$.fragment,q),z(I.$$.fragment,q),B=!1},d(q){q&&x(e),r[14](null),K(a),oe&&oe.d(),r[18](null),K(m),r[20](null),K(P),r[21](null),K(O),r[25](null),K(I),Zt=!1,at(zn)}}}function el(r,e,t){let n;te(r,Ce,O=>t(26,n=O));let{routeUrl:i}=e,o,s,a=new os(n),l=new ys(n),u="edit-attribute",c,v,p,f,g,y;function _(O){let H={"edit-attribute":c,"edit-geometry":v,route:p,point:f,polygon:g,"split-route":y};if(u==O){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),H[u].stop(),t(3,u=O),console.log(`Starting new mode ${u}`),H[u].start()}Rn(()=>{a==null||a.tearDown(),l==null||l.tearDown()});const L=()=>_("edit-attribute");function h(O){ae[O?"unshift":"push"](()=>{c=O,t(4,c)})}const d=()=>_("edit-geometry");function m(O){ae[O?"unshift":"push"](()=>{v=O,t(5,v)})}const S=()=>_("point");function R(O){ae[O?"unshift":"push"](()=>{f=O,t(7,f)})}const M=()=>_("polygon");function A(O){ae[O?"unshift":"push"](()=>{g=O,t(8,g)})}function C(O){ae[O?"unshift":"push"](()=>{p=O,t(6,p)})}function w(O){o=O,t(1,o)}function P(O){s=O,t(2,s)}const G=()=>_("split-route");function N(O){ae[O?"unshift":"push"](()=>{y=O,t(9,y)})}return r.$$set=O=>{"routeUrl"in O&&t(0,i=O.routeUrl)},[i,o,s,u,c,v,p,f,g,y,a,l,_,L,h,d,m,S,R,M,A,C,w,P,G,N]}class tl extends ne{constructor(e){super(),re(this,e,el,Ks,ee,{routeUrl:0})}}function nl(r){let e,t,n,i,o,s,a,l;return{c(){e=E("div"),t=E("button"),t.textContent="Home",n=T(),i=E("button"),i.textContent="About",o=T(),s=E("button"),s.textContent="Instructions",F(t,"type","button"),F(i,"type","button"),F(s,"type","button"),F(e,"slot","nav")},m(u,c){k(u,e,c),b(e,t),b(e,n),b(e,i),b(e,o),b(e,s),a||(l=[J(t,"click",r[8]),J(i,"click",r[6]),J(s,"click",r[7])],a=!0)},p:U,d(u){u&&x(e),a=!1,at(l)}}}function rl(r){let e,t,n,i,o,s,a,l,u,c,v,p;return o=new Ho({props:{boundaryGeojson:r[3]}}),a=new Uo({props:{authorityName:r[4]}}),v=new Co({}),{c(){e=E("div"),t=E("h1"),n=j(r[4]),i=T(),Q(o.$$.fragment),s=T(),Q(a.$$.fragment),l=T(),u=E("br"),c=T(),Q(v.$$.fragment),F(e,"slot","sidebar")},m(f,g){k(f,e,g),b(e,t),b(t,n),b(t,i),Z(o,t,null),b(e,s),Z(a,e,null),b(e,l),b(e,u),b(e,c),Z(v,e,null),p=!0},p(f,g){const y={};g&8&&(y.boundaryGeojson=f[3]),o.$set(y)},i(f){p||(Y(o.$$.fragment,f),Y(a.$$.fragment,f),Y(v.$$.fragment,f),p=!0)},o(f){z(o.$$.fragment,f),z(a.$$.fragment,f),z(v.$$.fragment,f),p=!1},d(f){f&&x(e),K(o),K(a),K(v)}}}function il(r){let e,t,n,i,o,s,a,l,u,c,v,p;return e=new wo({props:{boundaryGeojson:r[3]}}),n=new ns({}),o=new is({}),a=new tl({props:{routeUrl:r[2]}}),u=new Zo({props:{style:r[5]}}),v=new es({}),{c(){Q(e.$$.fragment),t=T(),Q(n.$$.fragment),i=T(),Q(o.$$.fragment),s=T(),Q(a.$$.fragment),l=T(),Q(u.$$.fragment),c=T(),Q(v.$$.fragment)},m(f,g){Z(e,f,g),k(f,t,g),Z(n,f,g),k(f,i,g),Z(o,f,g),k(f,s,g),Z(a,f,g),k(f,l,g),Z(u,f,g),k(f,c,g),Z(v,f,g),p=!0},p(f,g){const y={};g&8&&(y.boundaryGeojson=f[3]),e.$set(y);const _={};g&4&&(_.routeUrl=f[2]),a.$set(_)},i(f){p||(Y(e.$$.fragment,f),Y(n.$$.fragment,f),Y(o.$$.fragment,f),Y(a.$$.fragment,f),Y(u.$$.fragment,f),Y(v.$$.fragment,f),p=!0)},o(f){z(e.$$.fragment,f),z(n.$$.fragment,f),z(o.$$.fragment,f),z(a.$$.fragment,f),z(u.$$.fragment,f),z(v.$$.fragment,f),p=!1},d(f){K(e,f),f&&x(t),K(n,f),f&&x(i),K(o,f),f&&x(s),K(a,f),f&&x(l),K(u,f),f&&x(c),K(v,f)}}}function ol(r){let e,t,n;return t=new Pi({props:{style:r[5],$$slots:{default:[il]},$$scope:{ctx:r}}}),{c(){e=E("div"),Q(t.$$.fragment),F(e,"slot","main")},m(i,o){k(i,e,o),Z(t,e,null),n=!0},p(i,o){const s={};o&16396&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(Y(t.$$.fragment,i),n=!0)},o(i){z(t.$$.fragment,i),n=!1},d(i){i&&x(e),K(t)}}}function sl(r){let e,t,n,i,o,s,a,l;e=new Ni({props:{$$slots:{main:[ol],sidebar:[rl],nav:[nl]},$$scope:{ctx:r}}});function u(f){r[9](f)}let c={};r[0]!==void 0&&(c.open=r[0]),n=new yi({props:c}),ae.push(()=>ze(n,"open",u,r[0]));function v(f){r[10](f)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new Ei({props:p}),ae.push(()=>ze(s,"open",v,r[1])),{c(){Q(e.$$.fragment),t=T(),Q(n.$$.fragment),o=T(),Q(s.$$.fragment)},m(f,g){Z(e,f,g),k(f,t,g),Z(n,f,g),k(f,o,g),Z(s,f,g),l=!0},p(f,[g]){const y={};g&16396&&(y.$$scope={dirty:g,ctx:f}),e.$set(y);const _={};!i&&g&1&&(i=!0,_.open=f[0],Je(()=>i=!1)),n.$set(_);const L={};!a&&g&2&&(a=!0,L.open=f[1],Je(()=>a=!1)),s.$set(L)},i(f){l||(Y(e.$$.fragment,f),Y(n.$$.fragment,f),Y(s.$$.fragment,f),l=!0)},o(f){z(e.$$.fragment,f),z(n.$$.fragment,f),z(s.$$.fragment,f),l=!1},d(f){K(e,f),f&&x(t),K(n,f),f&&x(o),K(s,f)}}}function ll(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets";var u=`https://atip.uk/route-snappers/${a}.bin`;o||(u=`https://atip.uk/route-snappers-dev/${a}.bin`);function c(){t(0,n=!n),t(1,i=!1)}function v(){t(1,i=!i),t(0,n=!1)}let p;Ln(async()=>{t(3,p=await f())});async function f(){const h=await(await fetch(_i)).text(),d=JSON.parse(h);return d.features=d.features.filter(m=>m.properties.name==a),d}const g=()=>window.open("index.html");function y(L){n=L,t(0,n)}function _(L){i=L,t(1,i)}return[n,i,u,p,a,l,c,v,g,y,_]}class al extends ne{constructor(e){super(),re(this,e,ll,sl,ee,{})}}new al({target:document.getElementById("app")});
