var Vi=Object.defineProperty;var Zi=(n,e,t)=>e in n?Vi(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Se=(n,e,t)=>(Zi(n,typeof e!="symbol"?e+"":e,t),t),Qi=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var ct=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)};var de=(n,e,t)=>(Qi(n,e,"access private method"),t);import{S as oe,i as le,s as ie,M as Ki,b as ue,a as Be,d as K,m as $,k as qe,n as B,o as G,q as ee,e as L,c as q,g as P,x as Q,p as x,f as O,y as Ee,z as Me,B as yi,C as un,D as bn,E as Jn,F as ze,G as Ge,H as De,I as Ye,J as ar,h as S,l as X,K as fe,L as Un,w as jn,N as he,O as xe,P as St,Q as ht,R as Le,T as We,t as H,U as pe,V as T,W as st,r as He,X as fn,Y as ae,Z as wi,_ as ur,$ as $i,j as Et,a0 as Rt,a1 as ut,a2 as ki,a3 as fr,a4 as eo,a5 as to,a6 as no,a7 as cr,a8 as ro,a9 as io,aa as Wn,A as oo,u as lo}from"./authorities-956e8f70.js";function so(n){let e,t,r,i,o,l,s,a,u,c,g,d,f,m,v,k,R,h,p,b,w,_,N,M,F;return{c(){e=L("p"),e.textContent="For each intervention:",t=q(),r=L("br"),i=q(),o=L("ol"),o.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,l=q(),s=L("br"),a=q(),u=L("p"),u.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,c=q(),g=L("br"),d=q(),f=L("p"),f.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,m=q(),v=L("br"),k=q(),R=L("p"),R.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,h=q(),p=L("br"),b=q(),w=L("p"),w.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,_=q(),N=L("br"),M=q(),F=L("p"),F.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(E,C){P(E,e,C),P(E,t,C),P(E,r,C),P(E,i,C),P(E,o,C),P(E,l,C),P(E,s,C),P(E,a,C),P(E,u,C),P(E,c,C),P(E,g,C),P(E,d,C),P(E,f,C),P(E,m,C),P(E,v,C),P(E,k,C),P(E,R,C),P(E,h,C),P(E,p,C),P(E,b,C),P(E,w,C),P(E,_,C),P(E,N,C),P(E,M,C),P(E,F,C)},p:Q,d(E){E&&x(e),E&&x(t),E&&x(r),E&&x(i),E&&x(o),E&&x(l),E&&x(s),E&&x(a),E&&x(u),E&&x(c),E&&x(g),E&&x(d),E&&x(f),E&&x(m),E&&x(v),E&&x(k),E&&x(R),E&&x(h),E&&x(p),E&&x(b),E&&x(w),E&&x(_),E&&x(N),E&&x(M),E&&x(F)}}}function ao(n){let e,t,r;function i(l){n[1](l)}let o={title:"Instructions",$$slots:{default:[so]},$$scope:{ctx:n}};return n[0]!==void 0&&(o.open=n[0]),e=new Ki({props:o}),ue.push(()=>Be(e,"open",i,n[0])),{c(){K(e.$$.fragment)},m(l,s){$(e,l,s),r=!0},p(l,[s]){const a={};s&4&&(a.$$scope={dirty:s,ctx:l}),!t&&s&1&&(t=!0,a.open=l[0],qe(()=>t=!1)),e.$set(a)},i(l){r||(B(e.$$.fragment,l),r=!0)},o(l){G(e.$$.fragment,l),r=!1},d(l){ee(e,l)}}}function uo(n,e,t){let{open:r}=e;function i(o){r=o,t(0,r)}return n.$$set=o=>{"open"in o&&t(0,r=o.open)},[r,i]}class fo extends oe{constructor(e){super(),le(this,e,uo,ao,ie,{open:0})}}const gt=[];function ft(n,e=Q){let t;const r=new Set;function i(s){if(ie(n,s)&&(n=s,t)){const a=!gt.length;for(const u of r)u[1](),gt.push(u,n);if(a){for(let u=0;u<gt.length;u+=2)gt[u][0](gt[u+1]);gt.length=0}}}function o(s){i(s(n))}function l(s,a=Q){const u=[s,a];return r.add(u),r.size===1&&(t=e(i)||Q),s(n),()=>{r.delete(u),r.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:l}}const co={"line-cap":"round","line-join":"round"},Hn=["==","$type","Polygon"],Vn=["==","$type","LineString"],Zn=["==","$type","Point"];function $t(n,e,t=1){return{type:"line",layout:co,paint:{"line-color":n,"line-width":e,"line-opacity":t}}}function Qn(n,e){return{type:"fill",paint:{"fill-color":n,"fill-opacity":e}}}function Yt(n,e,t=1){return{type:"circle",paint:{"circle-radius":e,"circle-color":n,"circle-opacity":t}}}function xt(n,e,t){if(n.getSource(e)){let r=[];for(let i of n.getStyle().layers)i.source==e&&r.push(i.id);for(let i of r)n.removeLayer(i);n.removeSource(e)}n.addSource(e,t)}function Te(n,e,t=null){n.getLayer(e.id)&&n.removeLayer(e.id),t&&!n.getLayer(t)&&(t=null),n.addLayer(e,t)}function $e(){return{type:"FeatureCollection",features:[]}}const Ve=ft(null),ce=ft($e()),Re=ft(null),Ke=ft(null),en=ft(null),En=ft(null);function cn(n){let e=new Set;for(let r of n.features)e.add(r.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Si(n){ce.update(e=>(e.features=e.features.filter(t=>t.id!=n),e)),Re.set(null),Ke.set(null),en.set(null)}function dr(n){let e;const t=n[4].default,r=ze(t,n,n[3],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&8)&&Ge(r,t,i,i[3],e?Ye(t,i[3],o,null):De(i[3]),null)},i(i){e||(B(r,i),e=!0)},o(i){G(r,i),e=!1},d(i){r&&r.d(i)}}}function ho(n){let e,t,r=n[1]&&dr(n);return{c(){e=L("div"),r&&r.c(),O(e,"class","map svelte-12dpf1u")},m(i,o){P(i,e,o),r&&r.m(e,null),n[5](e),t=!0},p(i,[o]){i[1]?r?(r.p(i,o),o&2&&B(r,1)):(r=dr(i),r.c(),B(r,1),r.m(e,null)):r&&(Ee(),G(r,1,1,()=>{r=null}),Me())},i(i){t||(B(r),t=!0)},o(i){G(r),t=!1},d(i){i&&x(e),r&&r.d(),n[5](null)}}}function po(n,e,t){let{$$slots:r={},$$scope:i}=e,{style:o}=e,l,s,a=!1;yi("setCamera",!window.location.hash),un(()=>{l=new bn.Map({container:s,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),l.addControl(new bn.ScaleControl({})),l.addControl(new bn.NavigationControl({visualizePitch:!0}),"bottom-right"),l.on("load",()=>{t(1,a=!0),Ve.set(l)}),new ResizeObserver(()=>{l.resize()}).observe(s)}),Jn(()=>{l.remove()});function u(c){ue[c?"unshift":"push"](()=>{s=c,t(0,s)})}return n.$$set=c=>{"style"in c&&t(2,o=c.style),"$$scope"in c&&t(3,i=c.$$scope)},[s,a,o,i,r,u]}class mo extends oe{constructor(e){super(),le(this,e,po,ho,ie,{style:2})}}const go=n=>({}),hr=n=>({}),bo=n=>({}),pr=n=>({}),vo=n=>({}),mr=n=>({});function _o(n){let e,t,r,i,o,l,s,a,u,c,g,d;const f=n[3].nav,m=ze(f,n,n[2],mr),v=n[3].sidebar,k=ze(v,n,n[2],pr),R=n[3].main,h=ze(R,n,n[2],hr);return{c(){e=L("aside"),t=L("div"),r=L("nav"),m&&m.c(),i=q(),k&&k.c(),o=q(),l=L("button"),l.textContent="â†’",a=q(),u=L("main"),h&&h.c(),O(r,"class","svelte-1u7vg8a"),O(t,"class","sidebar-content content-container svelte-1u7vg8a"),O(l,"type","button"),O(l,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),O(e,"class",s=ar(n[0]?"":"collapsed")+" svelte-1u7vg8a"),O(u,"class","svelte-1u7vg8a")},m(p,b){P(p,e,b),S(e,t),S(t,r),m&&m.m(r,null),S(t,i),k&&k.m(t,null),S(e,o),S(e,l),P(p,a,b),P(p,u,b),h&&h.m(u,null),c=!0,g||(d=X(l,"click",n[1]),g=!0)},p(p,[b]){m&&m.p&&(!c||b&4)&&Ge(m,f,p,p[2],c?Ye(f,p[2],b,vo):De(p[2]),mr),k&&k.p&&(!c||b&4)&&Ge(k,v,p,p[2],c?Ye(v,p[2],b,bo):De(p[2]),pr),(!c||b&1&&s!==(s=ar(p[0]?"":"collapsed")+" svelte-1u7vg8a"))&&O(e,"class",s),h&&h.p&&(!c||b&4)&&Ge(h,R,p,p[2],c?Ye(R,p[2],b,go):De(p[2]),hr)},i(p){c||(B(m,p),B(k,p),B(h,p),c=!0)},o(p){G(m,p),G(k,p),G(h,p),c=!1},d(p){p&&x(e),m&&m.d(p),k&&k.d(p),p&&x(a),p&&x(u),h&&h.d(p),g=!1,d()}}}function yo(n,e,t){let{$$slots:r={},$$scope:i}=e,o=!0;function l(){t(0,o=!o)}return n.$$set=s=>{"$$scope"in s&&t(2,i=s.$$scope)},[o,l,i,r]}class wo extends oe{constructor(e){super(),le(this,e,yo,_o,ie,{})}}var _e=63710088e-1,Kn={centimeters:_e*100,centimetres:_e*100,degrees:_e/111325,feet:_e*3.28084,inches:_e*39.37,kilometers:_e/1e3,kilometres:_e/1e3,meters:_e,metres:_e,miles:_e/1609.344,millimeters:_e*1e3,millimetres:_e*1e3,nauticalmiles:_e/1852,radians:1,yards:_e*1.0936},ko={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/_e,yards:1.0936133},Mn={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Oe(n,e,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function So(n,e,t){switch(n){case"Point":return ye(e).geometry;case"LineString":return we(e).geometry;case"Polygon":return dn(e).geometry;case"MultiPoint":return Mi(e).geometry;case"MultiLineString":return Ei(e).geometry;case"MultiPolygon":return $n(e).geometry;default:throw new Error(n+" is invalid")}}function ye(n,e,t){if(t===void 0&&(t={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!tn(n[0])||!tn(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return Oe(r,e,t)}function Eo(n,e,t){return t===void 0&&(t={}),Ae(n.map(function(r){return ye(r,e)}),t)}function dn(n,e,t){t===void 0&&(t={});for(var r=0,i=n;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:n};return Oe(s,e,t)}function Mo(n,e,t){return t===void 0&&(t={}),Ae(n.map(function(r){return dn(r,e)}),t)}function we(n,e,t){if(t===void 0&&(t={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:n};return Oe(r,e,t)}function Po(n,e,t){return t===void 0&&(t={}),Ae(n.map(function(r){return we(r,e)}),t)}function Ae(n,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function Ei(n,e,t){t===void 0&&(t={});var r={type:"MultiLineString",coordinates:n};return Oe(r,e,t)}function Mi(n,e,t){t===void 0&&(t={});var r={type:"MultiPoint",coordinates:n};return Oe(r,e,t)}function $n(n,e,t){t===void 0&&(t={});var r={type:"MultiPolygon",coordinates:n};return Oe(r,e,t)}function xo(n,e,t){t===void 0&&(t={});var r={type:"GeometryCollection",geometries:n};return Oe(r,e,t)}function Lo(n,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(n*t)/t}function er(n,e){e===void 0&&(e="kilometers");var t=Kn[e];if(!t)throw new Error(e+" units is invalid");return n*t}function hn(n,e){e===void 0&&(e="kilometers");var t=Kn[e];if(!t)throw new Error(e+" units is invalid");return n/t}function To(n,e){return Ft(hn(n,e))}function Co(n){var e=n%360;return e<0&&(e+=360),e}function Ft(n){var e=n%(2*Math.PI);return e*180/Math.PI}function Ce(n){var e=n%360;return e*Math.PI/180}function Ro(n,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(n>=0))throw new Error("length must be a positive number");return er(hn(n,e),t)}function Ao(n,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(n>=0))throw new Error("area must be a positive number");var r=Mn[e];if(!r)throw new Error("invalid original units");var i=Mn[t];if(!i)throw new Error("invalid final units");return n/r*i}function tn(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function tr(n){return!!n&&n.constructor===Object}function Oo(n){if(!n)throw new Error("bbox is required");if(!Array.isArray(n))throw new Error("bbox must be an Array");if(n.length!==4&&n.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");n.forEach(function(e){if(!tn(e))throw new Error("bbox must only contain numbers")})}function No(n){if(!n)throw new Error("id is required");if(["string","number"].indexOf(typeof n)===-1)throw new Error("id must be a number or a string")}const Fo=Object.freeze(Object.defineProperty({__proto__:null,earthRadius:_e,factors:Kn,unitsFactors:ko,areaFactors:Mn,feature:Oe,geometry:So,point:ye,points:Eo,polygon:dn,polygons:Mo,lineString:we,lineStrings:Po,featureCollection:Ae,multiLineString:Ei,multiPoint:Mi,multiPolygon:$n,geometryCollection:xo,round:Lo,radiansToLength:er,lengthToRadians:hn,lengthToDegrees:To,bearingToAzimuth:Co,radiansToDegrees:Ft,degreesToRadians:Ce,convertLength:Ro,convertArea:Ao,isNumber:tn,isObject:tr,validateBBox:Oo,validateId:No},Symbol.toStringTag,{value:"Module"}));/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Io(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(u){return function(c){return a([u,c])}}function a(u){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(c){u=[6,c],i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var at=function(){function n(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return n}();function Bo(n,e){return n>e?1:n<e?-1:0}function nt(n,e,t){for(var r=new at(null,null),i=r,o=r;;){var l=t(n,e.key);if(l<0){if(e.left===null)break;if(t(n,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}o.left=e,o=e,e=e.left}else if(l>0){if(e.right===null)break;if(t(n,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=r.right,e.right=r.left,e}function vn(n,e,t,r){var i=new at(n,e);if(t===null)return i.left=i.right=null,i;t=nt(n,t,r);var o=r(n,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function gr(n,e,t){var r=null,i=null;if(e){e=nt(n,e,t);var o=t(e.key,n);o===0?(r=e.left,i=e.right):o<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function qo(n,e,t){return e===null?n:(n===null||(e=nt(n.key,e,t),e.left=n),e)}function Pn(n,e,t,r,i){if(n){r(""+e+(t?"â””â”€â”€ ":"â”œâ”€â”€ ")+i(n)+`
`);var o=e+(t?"    ":"â”‚   ");n.left&&Pn(n.left,o,!1,r,i),n.right&&Pn(n.right,o,!0,r,i)}}var nr=function(){function n(e){e===void 0&&(e=Bo),this._root=null,this._size=0,this._comparator=e}return n.prototype.insert=function(e,t){return this._size++,this._root=vn(e,t,this._root,this._comparator)},n.prototype.add=function(e,t){var r=new at(e,t);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,o=nt(e,this._root,i),l=i(e,o.key);return l===0?this._root=o:(l<0?(r.left=o.left,r.right=o,o.left=null):l>0&&(r.right=o.right,r.left=o,o.right=null),this._size++,this._root=r),this._root},n.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},n.prototype._remove=function(e,t,r){var i;if(t===null)return null;t=nt(e,t,r);var o=r(e,t.key);return o===0?(t.left===null?i=t.right:(i=nt(e,t.left,r),i.right=t.right),this._size--,i):t},n.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=nt(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},n.prototype.findStatic=function(e){for(var t=this._root,r=this._comparator;t;){var i=r(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},n.prototype.find=function(e){return this._root&&(this._root=nt(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},n.prototype.contains=function(e){for(var t=this._root,r=this._comparator;t;){var i=r(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},n.prototype.forEach=function(e,t){for(var r=this._root,i=[],o=!1;!o;)r!==null?(i.push(r),r=r.left):i.length!==0?(r=i.pop(),e.call(t,r),r=r.right):o=!0;return this},n.prototype.range=function(e,t,r,i){for(var o=[],l=this._comparator,s=this._root,a;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),a=l(s.key,t),a>0)break;if(l(s.key,e)>=0&&r.call(i,s))return this;s=s.right}return this},n.prototype.keys=function(){var e=[];return this.forEach(function(t){var r=t.key;return e.push(r)}),e},n.prototype.values=function(){var e=[];return this.forEach(function(t){var r=t.data;return e.push(r)}),e},n.prototype.min=function(){return this._root?this.minNode(this._root).key:null},n.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},n.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},n.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},n.prototype.at=function(e){for(var t=this._root,r=!1,i=0,o=[];!r;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else r=!0;return null},n.prototype.next=function(e){var t=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(r=t,t=t.left):t=t.right}return r},n.prototype.prev=function(e){var t=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(r=t,t=t.right)}return r},n.prototype.clear=function(){return this._root=null,this._size=0,this},n.prototype.toList=function(){return Go(this._root)},n.prototype.load=function(e,t,r){t===void 0&&(t=[]),r===void 0&&(r=!1);var i=e.length,o=this._comparator;if(r&&Tn(e,t,0,i-1,o),this._root===null)this._root=xn(e,t,0,i),this._size=i;else{var l=Do(this.toList(),zo(e,t),o);i=this._size+i,this._root=Ln({head:l},0,i)}return this},n.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var t=[];return Pn(this._root,"",!0,function(r){return t.push(r)},e),t.join("")},n.prototype.update=function(e,t,r){var i=this._comparator,o=gr(e,this._root,i),l=o.left,s=o.right;i(e,t)<0?s=vn(t,r,s,i):l=vn(t,r,l,i),this._root=qo(l,s,i)},n.prototype.split=function(e){return gr(e,this._root,this._comparator)},n.prototype[Symbol.iterator]=function(){var e;return Io(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},n}();function xn(n,e,t,r){var i=r-t;if(i>0){var o=t+Math.floor(i/2),l=n[o],s=e[o],a=new at(l,s);return a.left=xn(n,e,t,o),a.right=xn(n,e,o+1,r),a}return null}function zo(n,e){for(var t=new at(null,null),r=t,i=0;i<n.length;i++)r=r.next=new at(n[i],e[i]);return r.next=null,t.next}function Go(n){for(var e=n,t=[],r=!1,i=new at(null,null),o=i;!r;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):r=!0;return o.next=null,i.next}function Ln(n,e,t){var r=t-e;if(r>0){var i=e+Math.floor(r/2),o=Ln(n,e,i),l=n.head;return l.left=o,n.head=n.head.next,l.right=Ln(n,i+1,t),l}return null}function Do(n,e,t){for(var r=new at(null,null),i=r,o=n,l=e;o!==null&&l!==null;)t(o.key,l.key)<0?(i.next=o,o=o.next):(i.next=l,l=l.next),i=i.next;return o!==null?i.next=o:l!==null&&(i.next=l),r.next}function Tn(n,e,t,r,i){if(!(t>=r)){for(var o=n[t+r>>1],l=t-1,s=r+1;;){do l++;while(i(n[l],o)<0);do s--;while(i(n[s],o)>0);if(l>=s)break;var a=n[l];n[l]=n[s],n[s]=a,a=e[l],e[l]=e[s],e[s]=a}Tn(n,e,t,s,i),Tn(n,e,s+1,r,i)}}function Ne(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function br(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function ke(n,e,t){return e&&br(n.prototype,e),t&&br(n,t),n}var Ct=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Cn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var r=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,l=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:r,y:o},ur:{x:i,y:l}}},it=Number.EPSILON;it===void 0&&(it=Math.pow(2,-52));var Yo=it*it,Rn=function(e,t){if(-it<e&&e<it&&-it<t&&t<it)return 0;var r=e-t;return r*r<Yo*e*t?0:e<t?-1:1},Xo=function(){function n(){Ne(this,n),this.reset()}return ke(n,[{key:"reset",value:function(){this.xRounder=new vr,this.yRounder=new vr}},{key:"round",value:function(t,r){return{x:this.xRounder.round(t),y:this.yRounder.round(r)}}}]),n}(),vr=function(){function n(){Ne(this,n),this.tree=new nr,this.round(0)}return ke(n,[{key:"round",value:function(t){var r=this.tree.add(t),i=this.tree.prev(r);if(i!==null&&Rn(r.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(r);return o!==null&&Rn(r.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),n}(),It=new Xo,At=function(e,t){return e.x*t.y-e.y*t.x},Pi=function(e,t){return e.x*t.x+e.y*t.y},_r=function(e,t,r){var i={x:t.x-e.x,y:t.y-e.y},o={x:r.x-e.x,y:r.y-e.y},l=At(i,o);return Rn(l,0)},nn=function(e){return Math.sqrt(Pi(e,e))},Jo=function(e,t,r){var i={x:t.x-e.x,y:t.y-e.y},o={x:r.x-e.x,y:r.y-e.y};return At(o,i)/nn(o)/nn(i)},Uo=function(e,t,r){var i={x:t.x-e.x,y:t.y-e.y},o={x:r.x-e.x,y:r.y-e.y};return Pi(o,i)/nn(o)/nn(i)},yr=function(e,t,r){return t.y===0?null:{x:e.x+t.x/t.y*(r-e.y),y:r}},wr=function(e,t,r){return t.x===0?null:{x:r,y:e.y+t.y/t.x*(r-e.x)}},jo=function(e,t,r,i){if(t.x===0)return wr(r,i,e.x);if(i.x===0)return wr(e,t,r.x);if(t.y===0)return yr(r,i,e.y);if(i.y===0)return yr(e,t,r.y);var o=At(t,i);if(o==0)return null;var l={x:r.x-e.x,y:r.y-e.y},s=At(l,t)/o,a=At(l,i)/o,u=e.x+a*t.x,c=r.x+s*i.x,g=e.y+a*t.y,d=r.y+s*i.y,f=(u+c)/2,m=(g+d)/2;return{x:f,y:m}},Je=function(){ke(n,null,[{key:"compare",value:function(t,r){var i=n.comparePoints(t.point,r.point);return i!==0?i:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:rn.compare(t.segment,r.segment))}},{key:"comparePoints",value:function(t,r){return t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0}}]);function n(e,t){Ne(this,n),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return ke(n,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var r=t.point.events,i=0,o=r.length;i<o;i++){var l=r[i];this.point.events.push(l),l.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,r=0;r<t;r++){var i=this.point.events[r];if(i.segment.consumedBy===void 0)for(var o=r+1;o<t;o++){var l=this.point.events[o];l.consumedBy===void 0&&i.otherSE.point.events===l.otherSE.point.events&&i.segment.consume(l.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],r=0,i=this.point.events.length;r<i;r++){var o=this.point.events[r];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var r=this,i=new Map,o=function(s){var a=s.otherSE;i.set(s,{sine:Jo(r.point,t.point,a.point),cosine:Uo(r.point,t.point,a.point)})};return function(l,s){i.has(l)||o(l),i.has(s)||o(s);var a=i.get(l),u=a.sine,c=a.cosine,g=i.get(s),d=g.sine,f=g.cosine;return u>=0&&d>=0?c<f?1:c>f?-1:0:u<0&&d<0?c<f?-1:c>f?1:0:d<u?-1:d>u?1:0}}}]),n}(),Wo=0,rn=function(){ke(n,null,[{key:"compare",value:function(t,r){var i=t.leftSE.point.x,o=r.leftSE.point.x,l=t.rightSE.point.x,s=r.rightSE.point.x;if(s<i)return 1;if(l<o)return-1;var a=t.leftSE.point.y,u=r.leftSE.point.y,c=t.rightSE.point.y,g=r.rightSE.point.y;if(i<o){if(u<a&&u<c)return 1;if(u>a&&u>c)return-1;var d=t.comparePoint(r.leftSE.point);if(d<0)return 1;if(d>0)return-1;var f=r.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(a<u&&a<g)return-1;if(a>u&&a>g)return 1;var m=r.comparePoint(t.leftSE.point);if(m!==0)return m;var v=t.comparePoint(r.rightSE.point);return v<0?1:v>0?-1:1}if(a<u)return-1;if(a>u)return 1;if(l<s){var k=r.comparePoint(t.rightSE.point);if(k!==0)return k}if(l>s){var R=t.comparePoint(r.rightSE.point);if(R<0)return 1;if(R>0)return-1}if(l!==s){var h=c-a,p=l-i,b=g-u,w=s-o;if(h>p&&b<w)return 1;if(h<p&&b>w)return-1}return l>s?1:l<s||c<g?-1:c>g?1:t.id<r.id?-1:t.id>r.id?1:0}}]);function n(e,t,r,i){Ne(this,n),this.id=++Wo,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=r,this.windings=i}return ke(n,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<r?t:r},ur:{x:this.rightSE.point.x,y:t>r?t:r}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var r=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(r.x===i.x)return t.x===r.x?0:t.x<r.x?1:-1;var l=(t.y-r.y)/o.y,s=r.x+l*o.x;if(t.x===s)return 0;var a=(t.x-r.x)/o.x,u=r.y+a*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var r=this.bbox(),i=t.bbox(),o=Cn(r,i);if(o===null)return null;var l=this.leftSE.point,s=this.rightSE.point,a=t.leftSE.point,u=t.rightSE.point,c=Ct(r,a)&&this.comparePoint(a)===0,g=Ct(i,l)&&t.comparePoint(l)===0,d=Ct(r,u)&&this.comparePoint(u)===0,f=Ct(i,s)&&t.comparePoint(s)===0;if(g&&c)return f&&!d?s:!f&&d?u:null;if(g)return d&&l.x===u.x&&l.y===u.y?null:l;if(c)return f&&s.x===a.x&&s.y===a.y?null:a;if(f&&d)return null;if(f)return s;if(d)return u;var m=jo(l,this.vector(),a,t.vector());return m===null||!Ct(o,m)?null:It.round(m.x,m.y)}},{key:"split",value:function(t){var r=[],i=t.events!==void 0,o=new Je(t,!0),l=new Je(t,!1),s=this.rightSE;this.replaceRightSE(l),r.push(l),r.push(o);var a=new n(o,s,this.rings.slice(),this.windings.slice());return Je.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Je.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),l.checkForConsuming()),r}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var r=0,i=this.windings.length;r<i;r++)this.windings[r]*=-1}},{key:"consume",value:function(t){for(var r=this,i=t;r.consumedBy;)r=r.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=n.compare(r,i);if(o!==0){if(o>0){var l=r;r=i,i=l}if(r.prev===i){var s=r;r=i,i=s}for(var a=0,u=i.rings.length;a<u;a++){var c=i.rings[a],g=i.windings[a],d=r.rings.indexOf(c);d===-1?(r.rings.push(c),r.windings.push(g)):r.windings[d]+=g}i.rings=null,i.windings=null,i.consumedBy=r,i.leftSE.consumedBy=r.leftSE,i.rightSE.consumedBy=r.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var r=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,l=0,s=this.rings.length;l<s;l++){var a=this.rings[l],u=this.windings[l],c=r.indexOf(a);c===-1?(r.push(a),i.push(u)):i[c]+=u}for(var g=[],d=[],f=0,m=r.length;f<m;f++)if(i[f]!==0){var v=r[f],k=v.poly;if(d.indexOf(k)===-1)if(v.isExterior)g.push(k);else{d.indexOf(k)===-1&&d.push(k);var R=g.indexOf(v.poly);R!==-1&&g.splice(R,1)}}for(var h=0,p=g.length;h<p;h++){var b=g[h].multiPoly;o.indexOf(b)===-1&&o.push(b)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(Ie.type){case"union":{var i=t.length===0,o=r.length===0;this._isInResult=i!==o;break}case"intersection":{var l,s;t.length<r.length?(l=t.length,s=r.length):(l=r.length,s=t.length),this._isInResult=s===Ie.numMultiPolys&&l<s;break}case"xor":{var a=Math.abs(t.length-r.length);this._isInResult=a%2===1;break}case"difference":{var u=function(g){return g.length===1&&g[0].isSubject};this._isInResult=u(t)!==u(r);break}default:throw new Error("Unrecognized operation type found ".concat(Ie.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,r,i){var o,l,s,a=Je.comparePoints(t,r);if(a<0)o=t,l=r,s=1;else if(a>0)o=r,l=t,s=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Je(o,!0),c=new Je(l,!1);return new n(u,c,[i],[s])}}]),n}(),kr=function(){function n(e,t,r){if(Ne(this,n),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=It.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,l=1,s=e.length;l<s;l++){if(typeof e[l][0]!="number"||typeof e[l][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var a=It.round(e[l][0],e[l][1]);a.x===o.x&&a.y===o.y||(this.segments.push(rn.fromRing(o,a,this)),a.x<this.bbox.ll.x&&(this.bbox.ll.x=a.x),a.y<this.bbox.ll.y&&(this.bbox.ll.y=a.y),a.x>this.bbox.ur.x&&(this.bbox.ur.x=a.x),a.y>this.bbox.ur.y&&(this.bbox.ur.y=a.y),o=a)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(rn.fromRing(o,i,this))}return ke(n,[{key:"getSweepEvents",value:function(){for(var t=[],r=0,i=this.segments.length;r<i;r++){var o=this.segments[r];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),n}(),Ho=function(){function n(e,t){if(Ne(this,n),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new kr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var o=new kr(e[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return ke(n,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),r=0,i=this.interiorRings.length;r<i;r++)for(var o=this.interiorRings[r].getSweepEvents(),l=0,s=o.length;l<s;l++)t.push(o[l]);return t}}]),n}(),Sr=function(){function n(e,t){if(Ne(this,n),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var o=new Ho(e[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return ke(n,[{key:"getSweepEvents",value:function(){for(var t=[],r=0,i=this.polys.length;r<i;r++)for(var o=this.polys[r].getSweepEvents(),l=0,s=o.length;l<s;l++)t.push(o[l]);return t}}]),n}(),Vo=function(){ke(n,null,[{key:"factory",value:function(t){for(var r=[],i=0,o=t.length;i<o;i++){var l=t[i];if(!(!l.isInResult()||l.ringOut)){for(var s=null,a=l.leftSE,u=l.rightSE,c=[a],g=a.point,d=[];s=a,a=u,c.push(a),a.point!==g;)for(;;){var f=a.getAvailableLinkedEvents();if(f.length===0){var m=c[0].point,v=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(m.x,",")+" ".concat(m.y,"]. Last matching segment found ends at")+" [".concat(v.x,", ").concat(v.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var k=null,R=0,h=d.length;R<h;R++)if(d[R].point===a.point){k=R;break}if(k!==null){var p=d.splice(k)[0],b=c.splice(p.index);b.unshift(b[0].otherSE),r.push(new n(b.reverse()));continue}d.push({index:c.length,point:a.point});var w=a.getLeftmostComparator(s);u=f.sort(w)[0].otherSE;break}r.push(new n(c))}}return r}}]);function n(e){Ne(this,n),this.events=e;for(var t=0,r=e.length;t<r;t++)e[t].segment.ringOut=this;this.poly=null}return ke(n,[{key:"getGeom",value:function(){for(var t=this.events[0].point,r=[t],i=1,o=this.events.length-1;i<o;i++){var l=this.events[i].point,s=this.events[i+1].point;_r(l,t,s)!==0&&(r.push(l),t=l)}if(r.length===1)return null;var a=r[0],u=r[1];_r(a,t,u)===0&&r.shift(),r.push(r[0]);for(var c=this.isExteriorRing()?1:-1,g=this.isExteriorRing()?0:r.length-1,d=this.isExteriorRing()?r.length:-1,f=[],m=g;m!=d;m+=c)f.push([r[m].x,r[m].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],r=1,i=this.events.length;r<i;r++){var o=this.events[r];Je.compare(t,o)>0&&(t=o)}for(var l=t.segment.prevInResult(),s=l?l.prevInResult():null;;){if(!l)return null;if(!s)return l.ringOut;if(s.ringOut!==l.ringOut)return s.ringOut.enclosingRing()!==l.ringOut?l.ringOut:l.ringOut.enclosingRing();l=s.prevInResult(),s=l?l.prevInResult():null}}}]),n}(),Er=function(){function n(e){Ne(this,n),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return ke(n,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var r=0,i=this.interiorRings.length;r<i;r++){var o=this.interiorRings[r].getGeom();o!==null&&t.push(o)}return t}}]),n}(),Zo=function(){function n(e){Ne(this,n),this.rings=e,this.polys=this._composePolys(e)}return ke(n,[{key:"getGeom",value:function(){for(var t=[],r=0,i=this.polys.length;r<i;r++){var o=this.polys[r].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var r=[],i=0,o=t.length;i<o;i++){var l=t[i];if(!l.poly)if(l.isExteriorRing())r.push(new Er(l));else{var s=l.enclosingRing();s.poly||r.push(new Er(s)),s.poly.addInterior(l)}}return r}}]),n}(),Qo=function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:rn.compare;Ne(this,n),this.queue=e,this.tree=new nr(t),this.segments=[]}return ke(n,[{key:"process",value:function(t){var r=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(r),i;var o=t.isLeft?this.tree.insert(r):this.tree.find(r);if(!o)throw new Error("Unable to find segment #".concat(r.id," ")+"[".concat(r.leftSE.point.x,", ").concat(r.leftSE.point.y,"] -> ")+"[".concat(r.rightSE.point.x,", ").concat(r.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var l=o,s=o,a=void 0,u=void 0;a===void 0;)l=this.tree.prev(l),l===null?a=null:l.key.consumedBy===void 0&&(a=l.key);for(;u===void 0;)s=this.tree.next(s),s===null?u=null:s.key.consumedBy===void 0&&(u=s.key);if(t.isLeft){var c=null;if(a){var g=a.getIntersection(r);if(g!==null&&(r.isAnEndpoint(g)||(c=g),!a.isAnEndpoint(g)))for(var d=this._splitSafely(a,g),f=0,m=d.length;f<m;f++)i.push(d[f])}var v=null;if(u){var k=u.getIntersection(r);if(k!==null&&(r.isAnEndpoint(k)||(v=k),!u.isAnEndpoint(k)))for(var R=this._splitSafely(u,k),h=0,p=R.length;h<p;h++)i.push(R[h])}if(c!==null||v!==null){var b=null;if(c===null)b=v;else if(v===null)b=c;else{var w=Je.comparePoints(c,v);b=w<=0?c:v}this.queue.remove(r.rightSE),i.push(r.rightSE);for(var _=r.split(b),N=0,M=_.length;N<M;N++)i.push(_[N])}i.length>0?(this.tree.remove(r),i.push(t)):(this.segments.push(r),r.prev=a)}else{if(a&&u){var F=a.getIntersection(u);if(F!==null){if(!a.isAnEndpoint(F))for(var E=this._splitSafely(a,F),C=0,Y=E.length;C<Y;C++)i.push(E[C]);if(!u.isAnEndpoint(F))for(var I=this._splitSafely(u,F),A=0,z=I.length;A<z;A++)i.push(I[A])}}this.tree.remove(r)}return i}},{key:"_splitSafely",value:function(t,r){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(r);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),n}(),Mr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ko=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,$o=function(){function n(){Ne(this,n)}return ke(n,[{key:"run",value:function(t,r,i){Ie.type=t,It.reset();for(var o=[new Sr(r,!0)],l=0,s=i.length;l<s;l++)o.push(new Sr(i[l],!1));if(Ie.numMultiPolys=o.length,Ie.type==="difference")for(var a=o[0],u=1;u<o.length;)Cn(o[u].bbox,a.bbox)!==null?u++:o.splice(u,1);if(Ie.type==="intersection"){for(var c=0,g=o.length;c<g;c++)for(var d=o[c],f=c+1,m=o.length;f<m;f++)if(Cn(d.bbox,o[f].bbox)===null)return[]}for(var v=new nr(Je.compare),k=0,R=o.length;k<R;k++)for(var h=o[k].getSweepEvents(),p=0,b=h.length;p<b;p++)if(v.insert(h[p]),v.size>Mr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var w=new Qo(v),_=v.size,N=v.pop();N;){var M=N.key;if(v.size===_){var F=M.segment;throw new Error("Unable to pop() ".concat(M.isLeft?"left":"right"," SweepEvent ")+"[".concat(M.point.x,", ").concat(M.point.y,"] from segment #").concat(F.id," ")+"[".concat(F.leftSE.point.x,", ").concat(F.leftSE.point.y,"] -> ")+"[".concat(F.rightSE.point.x,", ").concat(F.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(v.size>Mr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(w.segments.length>Ko)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var E=w.process(M),C=0,Y=E.length;C<Y;C++){var I=E[C];I.consumedBy===void 0&&v.insert(I)}_=v.size,N=v.pop()}It.reset();var A=Vo.factory(w.segments),z=new Zo(A);return z.getGeom()}}]),n}(),Ie=new $o,el=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Ie.run("union",e,r)},tl=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Ie.run("intersection",e,r)},nl=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Ie.run("xor",e,r)},rl=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Ie.run("difference",e,r)},Wt={union:el,intersection:tl,xor:nl,difference:rl};function il(n,e){var t=ll(e),r=null;return n.type==="FeatureCollection"?r=ol(n):r=xi(Wt.union(n.geometry.coordinates)),r.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function ol(n){var e=n.features.length===2?Wt.union(n.features[0].geometry.coordinates,n.features[1].geometry.coordinates):Wt.union.apply(Wt,n.features.map(function(t){return t.geometry.coordinates}));return xi(e)}function xi(n){return $n(n)}function ll(n){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=n&&n.geometry.coordinates||e;return dn(t)}function sl(n,e,t){let r;fe(n,Ve,l=>t(1,r=l));let{boundaryGeojson:i}=e;return Un("setCamera")&&r.fitBounds(jn(i),{padding:20,animate:!1}),xt(r,"boundary",{type:"geojson",data:il(i)}),Te(r,{id:"boundary",source:"boundary",...Qn("black",.5)}),n.$$set=l=>{"boundaryGeojson"in l&&t(0,i=l.boundaryGeojson)},[i]}class al extends oe{constructor(e){super(),le(this,e,sl,null,ie,{boundaryGeojson:0})}}function Pr(n){let e,t;return{c(){e=xe("title"),t=H(n[1])},m(r,i){P(r,e,i),S(e,t)},p(r,i){i&2&&pe(t,r[1])},d(r){r&&x(e)}}}function ul(n){let e,t,r,i=n[1]&&Pr(n),o=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],l={};for(let s=0;s<o.length;s+=1)l=he(l,o[s]);return{c(){e=xe("svg"),i&&i.c(),t=xe("path"),r=xe("path"),O(t,"d","M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14C30,8.3,23.7,2,16,2z M14.9,8h2.2v11h-2.2V8z M16,25	c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22c0.8,0,1.5,0.7,1.5,1.5S16.8,25,16,25z"),O(r,"fill","none"),O(r,"d","M17.5,23.5c0,0.8-0.7,1.5-1.5,1.5c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22	C16.8,22,17.5,22.7,17.5,23.5z M17.1,8h-2.2v11h2.2V8z"),O(r,"data-icon-path","inner-path"),O(r,"opacity","0"),St(e,l)},m(s,a){P(s,e,a),i&&i.m(e,null),S(e,t),S(e,r)},p(s,[a]){s[1]?i?i.p(s,a):(i=Pr(s),i.c(),i.m(e,t)):i&&(i.d(1),i=null),St(e,l=ht(o,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:s[0]},a&1&&{height:s[0]},a&4&&s[2],a&8&&s[3]]))},i:Q,o:Q,d(s){s&&x(e),i&&i.d()}}}function fl(n,e,t){let r,i;const o=["size","title"];let l=Le(e,o),{size:s=16}=e,{title:a=void 0}=e;return n.$$set=u=>{t(5,e=he(he({},e),We(u))),t(3,l=Le(e,o)),"size"in u&&t(0,s=u.size),"title"in u&&t(1,a=u.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||a),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=We(e),[s,a,i,l,r]}class cl extends oe{constructor(e){super(),le(this,e,fl,ul,ie,{size:0,title:1})}}const Li=cl;function xr(n){let e,t;return{c(){e=xe("title"),t=H(n[1])},m(r,i){P(r,e,i),S(e,t)},p(r,i){i&2&&pe(t,r[1])},d(r){r&&x(e)}}}function dl(n){let e,t,r,i,o=n[1]&&xr(n),l=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],s={};for(let a=0;a<l.length;a+=1)s=he(s,l[a]);return{c(){e=xe("svg"),o&&o.c(),t=xe("path"),r=xe("path"),i=xe("path"),O(t,"fill","none"),O(t,"d","M16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Zm-1.125-5h2.25V12h-2.25Z"),O(t,"data-icon-path","inner-path"),O(r,"d","M16.002,6.1714h-.004L4.6487,27.9966,4.6506,28H27.3494l.0019-.0034ZM14.875,12h2.25v9h-2.25ZM16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Z"),O(i,"d","M29,30H3a1,1,0,0,1-.8872-1.4614l13-25a1,1,0,0,1,1.7744,0l13,25A1,1,0,0,1,29,30ZM4.6507,28H27.3493l.002-.0033L16.002,6.1714h-.004L4.6487,27.9967Z"),St(e,s)},m(a,u){P(a,e,u),o&&o.m(e,null),S(e,t),S(e,r),S(e,i)},p(a,[u]){a[1]?o?o.p(a,u):(o=xr(a),o.c(),o.m(e,t)):o&&(o.d(1),o=null),St(e,s=ht(l,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},u&1&&{width:a[0]},u&1&&{height:a[0]},u&4&&a[2],u&8&&a[3]]))},i:Q,o:Q,d(a){a&&x(e),o&&o.d()}}}function hl(n,e,t){let r,i;const o=["size","title"];let l=Le(e,o),{size:s=16}=e,{title:a=void 0}=e;return n.$$set=u=>{t(5,e=he(he({},e),We(u))),t(3,l=Le(e,o)),"size"in u&&t(0,s=u.size),"title"in u&&t(1,a=u.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||a),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=We(e),[s,a,i,l,r]}class pl extends oe{constructor(e){super(),le(this,e,hl,dl,ie,{size:0,title:1})}}const ml=pl,gl=n=>({}),Lr=n=>({});function Tr(n){let e,t;const r=n[16].labelText,i=ze(r,n,n[15],Lr),o=i||bl(n);return{c(){e=L("span"),o&&o.c(),T(e,"bx--visually-hidden",n[7])},m(l,s){P(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s&32768)&&Ge(i,r,l,l[15],t?Ye(r,l[15],s,gl):De(l[15]),Lr):o&&o.p&&(!t||s&64)&&o.p(l,t?s:-1),(!t||s&128)&&T(e,"bx--visually-hidden",l[7])},i(l){t||(B(o,l),t=!0)},o(l){G(o,l),t=!1},d(l){l&&x(e),o&&o.d(l)}}}function bl(n){let e;return{c(){e=H(n[6])},m(t,r){P(t,e,r)},p(t,r){r&64&&pe(e,t[6])},d(t){t&&x(e)}}}function vl(n){let e,t,r,i,o,l,s,a,u,c=(n[6]||n[13].labelText)&&Tr(n),g=[n[12]],d={};for(let f=0;f<g.length;f+=1)d=he(d,g[f]);return{c(){e=L("div"),t=L("input"),r=q(),i=L("label"),o=L("span"),l=q(),c&&c.c(),O(t,"type","radio"),O(t,"id",n[8]),O(t,"name",n[9]),t.checked=n[0],t.disabled=n[3],t.required=n[4],t.value=n[2],T(t,"bx--radio-button",!0),T(o,"bx--radio-button__appearance",!0),O(i,"for",n[8]),T(i,"bx--radio-button__label",!0),st(e,d),T(e,"bx--radio-button-wrapper",!0),T(e,"bx--radio-button-wrapper--label-left",n[5]==="left")},m(f,m){P(f,e,m),S(e,t),n[18](t),S(e,r),S(e,i),S(i,o),S(i,l),c&&c.m(i,null),s=!0,a||(u=[X(t,"change",n[17]),X(t,"change",n[19])],a=!0)},p(f,[m]){(!s||m&256)&&O(t,"id",f[8]),(!s||m&512)&&O(t,"name",f[9]),(!s||m&1)&&(t.checked=f[0]),(!s||m&8)&&(t.disabled=f[3]),(!s||m&16)&&(t.required=f[4]),(!s||m&4)&&(t.value=f[2]),f[6]||f[13].labelText?c?(c.p(f,m),m&8256&&B(c,1)):(c=Tr(f),c.c(),B(c,1),c.m(i,null)):c&&(Ee(),G(c,1,1,()=>{c=null}),Me()),(!s||m&256)&&O(i,"for",f[8]),st(e,d=ht(g,[m&4096&&f[12]])),T(e,"bx--radio-button-wrapper",!0),T(e,"bx--radio-button-wrapper--label-left",f[5]==="left")},i(f){s||(B(c),s=!0)},o(f){G(c),s=!1},d(f){f&&x(e),n[18](null),c&&c.d(),a=!1,He(u)}}}function _l(n,e,t){const r=["value","checked","disabled","required","labelPosition","labelText","hideLabel","id","name","ref"];let i=Le(e,r),o,{$$slots:l={},$$scope:s}=e;const a=fn(l);let{value:u=""}=e,{checked:c=!1}=e,{disabled:g=!1}=e,{required:d=!1}=e,{labelPosition:f="right"}=e,{labelText:m=""}=e,{hideLabel:v=!1}=e,{id:k="ccs-"+Math.random().toString(36)}=e,{name:R=""}=e,{ref:h=null}=e;const p=Un("RadioButtonGroup"),b=p?p.selectedValue:ft(c?u:void 0);fe(n,b,M=>t(14,o=M)),p&&p.add({id:k,checked:c,disabled:g,value:u});function w(M){ae.call(this,n,M)}function _(M){ue[M?"unshift":"push"](()=>{h=M,t(1,h)})}const N=()=>{p&&p.update(u)};return n.$$set=M=>{e=he(he({},e),We(M)),t(12,i=Le(e,r)),"value"in M&&t(2,u=M.value),"checked"in M&&t(0,c=M.checked),"disabled"in M&&t(3,g=M.disabled),"required"in M&&t(4,d=M.required),"labelPosition"in M&&t(5,f=M.labelPosition),"labelText"in M&&t(6,m=M.labelText),"hideLabel"in M&&t(7,v=M.hideLabel),"id"in M&&t(8,k=M.id),"name"in M&&t(9,R=M.name),"ref"in M&&t(1,h=M.ref),"$$scope"in M&&t(15,s=M.$$scope)},n.$$.update=()=>{n.$$.dirty&16388&&t(0,c=o===u)},[c,h,u,g,d,f,m,v,k,R,p,b,i,a,o,s,l,w,_,N]}class yl extends oe{constructor(e){super(),le(this,e,_l,vl,ie,{value:2,checked:0,disabled:3,required:4,labelPosition:5,labelText:6,hideLabel:7,id:8,name:9,ref:1})}}const Jt=yl;function wl(n){const e=n-1;return e*e*e+1}function Cr(n,{delay:e=0,duration:t=400,easing:r=wl}={}){const i=getComputedStyle(n),o=+i.opacity,l=parseFloat(i.height),s=parseFloat(i.paddingTop),a=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),c=parseFloat(i.marginBottom),g=parseFloat(i.borderTopWidth),d=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:r,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*l}px;padding-top: ${f*s}px;padding-bottom: ${f*a}px;margin-top: ${f*u}px;margin-bottom: ${f*c}px;border-top-width: ${f*g}px;border-bottom-width: ${f*d}px;`}}function Rr(n){let e,t;return{c(){e=xe("title"),t=H(n[1])},m(r,i){P(r,e,i),S(e,t)},p(r,i){i&2&&pe(t,r[1])},d(r){r&&x(e)}}}function kl(n){let e,t,r=n[1]&&Rr(n),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],o={};for(let l=0;l<i.length;l+=1)o=he(o,i[l]);return{c(){e=xe("svg"),r&&r.c(),t=xe("path"),O(t,"d","M30 28.6L3.4 2 2 3.4l10.1 10.1L4 21.6V28h6.4l8.1-8.1L28.6 30 30 28.6zM9.6 26H6v-3.6l7.5-7.5 3.6 3.6L9.6 26zM29.4 6.2L29.4 6.2l-3.6-3.6c-.8-.8-2-.8-2.8 0l0 0 0 0-8 8 1.4 1.4L20 8.4l3.6 3.6L20 15.6l1.4 1.4 8-8C30.2 8.2 30.2 7 29.4 6.2L29.4 6.2zM25 10.6L21.4 7l3-3L28 7.6 25 10.6z"),St(e,o)},m(l,s){P(l,e,s),r&&r.m(e,null),S(e,t)},p(l,[s]){l[1]?r?r.p(l,s):(r=Rr(l),r.c(),r.m(e,t)):r&&(r.d(1),r=null),St(e,o=ht(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},s&1&&{width:l[0]},s&1&&{height:l[0]},s&4&&l[2],s&8&&l[3]]))},i:Q,o:Q,d(l){l&&x(e),r&&r.d()}}}function Sl(n,e,t){let r,i;const o=["size","title"];let l=Le(e,o),{size:s=16}=e,{title:a=void 0}=e;return n.$$set=u=>{t(5,e=he(he({},e),We(u))),t(3,l=Le(e,o)),"size"in u&&t(0,s=u.size),"title"in u&&t(1,a=u.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||a),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=We(e),[s,a,i,l,r]}class El extends oe{constructor(e){super(),le(this,e,Sl,kl,ie,{size:0,title:1})}}const Ml=El,Pl=n=>({}),Ar=n=>({});function Or(n){let e,t;const r=n[11].legendText,i=ze(r,n,n[10],Ar),o=i||xl(n);return{c(){e=L("legend"),o&&o.c(),T(e,"bx--label",!0),T(e,"bx--visually-hidden",n[2])},m(l,s){P(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s&1024)&&Ge(i,r,l,l[10],t?Ye(r,l[10],s,Pl):De(l[10]),Ar):o&&o.p&&(!t||s&2)&&o.p(l,t?s:-1),(!t||s&4)&&T(e,"bx--visually-hidden",l[2])},i(l){t||(B(o,l),t=!0)},o(l){G(o,l),t=!1},d(l){l&&x(e),o&&o.d(l)}}}function xl(n){let e;return{c(){e=H(n[1])},m(t,r){P(t,e,r)},p(t,r){r&2&&pe(e,t[1])},d(t){t&&x(e)}}}function Ll(n){let e,t,r,i,o,l,s=(n[1]||n[8].legendText)&&Or(n);const a=n[11].default,u=ze(a,n,n[10],null);let c=[{id:n[5]},n[7]],g={};for(let d=0;d<c.length;d+=1)g=he(g,c[d]);return{c(){e=L("div"),t=L("fieldset"),s&&s.c(),r=q(),u&&u.c(),t.disabled=n[0],T(t,"bx--radio-button-group",!0),T(t,"bx--radio-button-group--vertical",n[4]==="vertical"),T(t,"bx--radio-button-group--label-left",n[3]==="left"),T(t,"bx--radio-button-group--label-right",n[3]==="right"),st(e,g),T(e,"bx--form-item",!0)},m(d,f){P(d,e,f),S(e,t),s&&s.m(t,null),S(t,r),u&&u.m(t,null),i=!0,o||(l=[X(e,"click",n[12]),X(e,"mouseover",n[13]),X(e,"mouseenter",n[14]),X(e,"mouseleave",n[15])],o=!0)},p(d,[f]){d[1]||d[8].legendText?s?(s.p(d,f),f&258&&B(s,1)):(s=Or(d),s.c(),B(s,1),s.m(t,r)):s&&(Ee(),G(s,1,1,()=>{s=null}),Me()),u&&u.p&&(!i||f&1024)&&Ge(u,a,d,d[10],i?Ye(a,d[10],f,null):De(d[10]),null),(!i||f&1)&&(t.disabled=d[0]),(!i||f&16)&&T(t,"bx--radio-button-group--vertical",d[4]==="vertical"),(!i||f&8)&&T(t,"bx--radio-button-group--label-left",d[3]==="left"),(!i||f&8)&&T(t,"bx--radio-button-group--label-right",d[3]==="right"),st(e,g=ht(c,[(!i||f&32)&&{id:d[5]},f&128&&d[7]])),T(e,"bx--form-item",!0)},i(d){i||(B(s),B(u,d),i=!0)},o(d){G(s),G(u,d),i=!1},d(d){d&&x(e),s&&s.d(),u&&u.d(d),o=!1,He(l)}}}function Tl(n,e,t){const r=["selected","disabled","legendText","hideLegend","labelPosition","orientation","id"];let i=Le(e,r),o,{$$slots:l={},$$scope:s}=e;const a=fn(l);let{selected:u=void 0}=e,{disabled:c=!1}=e,{legendText:g=""}=e,{hideLegend:d=!1}=e,{labelPosition:f="right"}=e,{orientation:m="horizontal"}=e,{id:v=void 0}=e;const k=wi(),R=ft(u);fe(n,R,_=>t(16,o=_)),yi("RadioButtonGroup",{selectedValue:R,add:({checked:_,value:N})=>{_&&R.set(N)},update:_=>{t(9,u=_)}}),un(()=>{ur(R,o=u,o)}),$i(()=>{ur(R,o=u,o)}),R.subscribe(_=>{t(9,u=_),k("change",_)});function h(_){ae.call(this,n,_)}function p(_){ae.call(this,n,_)}function b(_){ae.call(this,n,_)}function w(_){ae.call(this,n,_)}return n.$$set=_=>{e=he(he({},e),We(_)),t(7,i=Le(e,r)),"selected"in _&&t(9,u=_.selected),"disabled"in _&&t(0,c=_.disabled),"legendText"in _&&t(1,g=_.legendText),"hideLegend"in _&&t(2,d=_.hideLegend),"labelPosition"in _&&t(3,f=_.labelPosition),"orientation"in _&&t(4,m=_.orientation),"id"in _&&t(5,v=_.id),"$$scope"in _&&t(10,s=_.$$scope)},[c,g,d,f,m,v,R,i,a,u,s,l,h,p,b,w]}class Cl extends oe{constructor(e){super(),le(this,e,Tl,Ll,ie,{selected:9,disabled:0,legendText:1,hideLegend:2,labelPosition:3,orientation:4,id:5})}}const Rl=Cl,Al=n=>({}),Nr=n=>({});function Fr(n){let e,t,r,i;const o=n[20].labelText,l=ze(o,n,n[19],Nr),s=l||Ol(n);let a=n[5]&&Ir(n);return{c(){e=L("div"),t=L("label"),s&&s.c(),r=q(),a&&a.c(),O(t,"for",n[14]),T(t,"bx--label",!0),T(t,"bx--visually-hidden",n[11]),T(t,"bx--label--disabled",n[7]),T(e,"bx--text-area__label-wrapper",!0)},m(u,c){P(u,e,c),S(e,t),s&&s.m(t,null),S(e,r),a&&a.m(e,null),i=!0},p(u,c){l?l.p&&(!i||c[0]&524288)&&Ge(l,o,u,u[19],i?Ye(o,u[19],c,Al):De(u[19]),Nr):s&&s.p&&(!i||c[0]&1024)&&s.p(u,i?c:[-1,-1]),(!i||c[0]&16384)&&O(t,"for",u[14]),(!i||c[0]&2048)&&T(t,"bx--visually-hidden",u[11]),(!i||c[0]&128)&&T(t,"bx--label--disabled",u[7]),u[5]?a?a.p(u,c):(a=Ir(u),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i(u){i||(B(s,u),i=!0)},o(u){G(s,u),i=!1},d(u){u&&x(e),s&&s.d(u),a&&a.d()}}}function Ol(n){let e;return{c(){e=H(n[10])},m(t,r){P(t,e,r)},p(t,r){r[0]&1024&&pe(e,t[10])},d(t){t&&x(e)}}}function Ir(n){let e,t=n[0].length+"",r,i,o;return{c(){e=L("div"),r=H(t),i=H("/"),o=H(n[5]),T(e,"bx--label",!0),T(e,"bx--label--disabled",n[7])},m(l,s){P(l,e,s),S(e,r),S(e,i),S(e,o)},p(l,s){s[0]&1&&t!==(t=l[0].length+"")&&pe(r,t),s[0]&32&&pe(o,l[5]),s[0]&128&&T(e,"bx--label--disabled",l[7])},d(l){l&&x(e)}}}function Br(n){let e,t;return e=new Li({props:{class:"bx--text-area__invalid-icon"}}),{c(){K(e.$$.fragment)},m(r,i){$(e,r,i),t=!0},i(r){t||(B(e.$$.fragment,r),t=!0)},o(r){G(e.$$.fragment,r),t=!1},d(r){ee(e,r)}}}function qr(n){let e,t;return{c(){e=L("div"),t=H(n[9]),T(e,"bx--form__helper-text",!0),T(e,"bx--form__helper-text--disabled",n[7])},m(r,i){P(r,e,i),S(e,t)},p(r,i){i[0]&512&&pe(t,r[9]),i[0]&128&&T(e,"bx--form__helper-text--disabled",r[7])},d(r){r&&x(e)}}}function zr(n){let e,t;return{c(){e=L("div"),t=H(n[13]),O(e,"id",n[16]),T(e,"bx--form-requirement",!0)},m(r,i){P(r,e,i),S(e,t)},p(r,i){i[0]&8192&&pe(t,r[13]),i[0]&65536&&O(e,"id",r[16])},d(r){r&&x(e)}}}function Nl(n){let e,t,r,i,o,l,s,a,u,c,g,d,f,m,v=(n[10]||n[17].labelText)&&!n[11]&&Fr(n),k=n[12]&&Br(),R=[{"aria-invalid":l=n[12]||void 0},{"aria-describedby":s=n[12]?n[16]:void 0},{disabled:n[7]},{id:n[14]},{name:n[15]},{cols:n[3]},{rows:n[4]},{placeholder:n[2]},{readOnly:n[8]},{maxlength:a=n[5]??void 0},n[18]],h={};for(let w=0;w<R.length;w+=1)h=he(h,R[w]);let p=!n[12]&&n[9]&&qr(n),b=n[12]&&zr(n);return{c(){e=L("div"),v&&v.c(),t=q(),r=L("div"),k&&k.c(),i=q(),o=L("textarea"),c=q(),p&&p.c(),g=q(),b&&b.c(),st(o,h),T(o,"bx--text-area",!0),T(o,"bx--text-area--light",n[6]),T(o,"bx--text-area--invalid",n[12]),O(r,"data-invalid",u=n[12]||void 0),T(r,"bx--text-area__wrapper",!0),T(e,"bx--form-item",!0)},m(w,_){P(w,e,_),v&&v.m(e,null),S(e,t),S(e,r),k&&k.m(r,null),S(r,i),S(r,o),o.autofocus&&o.focus(),n[32](o),Et(o,n[0]),S(e,c),p&&p.m(e,null),S(e,g),b&&b.m(e,null),d=!0,f||(m=[X(o,"input",n[33]),X(o,"change",n[25]),X(o,"input",n[26]),X(o,"keydown",n[27]),X(o,"keyup",n[28]),X(o,"focus",n[29]),X(o,"blur",n[30]),X(o,"paste",n[31]),X(e,"click",n[21]),X(e,"mouseover",n[22]),X(e,"mouseenter",n[23]),X(e,"mouseleave",n[24])],f=!0)},p(w,_){(w[10]||w[17].labelText)&&!w[11]?v?(v.p(w,_),_[0]&134144&&B(v,1)):(v=Fr(w),v.c(),B(v,1),v.m(e,t)):v&&(Ee(),G(v,1,1,()=>{v=null}),Me()),w[12]?k?_[0]&4096&&B(k,1):(k=Br(),k.c(),B(k,1),k.m(r,i)):k&&(Ee(),G(k,1,1,()=>{k=null}),Me()),st(o,h=ht(R,[(!d||_[0]&4096&&l!==(l=w[12]||void 0))&&{"aria-invalid":l},(!d||_[0]&69632&&s!==(s=w[12]?w[16]:void 0))&&{"aria-describedby":s},(!d||_[0]&128)&&{disabled:w[7]},(!d||_[0]&16384)&&{id:w[14]},(!d||_[0]&32768)&&{name:w[15]},(!d||_[0]&8)&&{cols:w[3]},(!d||_[0]&16)&&{rows:w[4]},(!d||_[0]&4)&&{placeholder:w[2]},(!d||_[0]&256)&&{readOnly:w[8]},(!d||_[0]&32&&a!==(a=w[5]??void 0))&&{maxlength:a},_[0]&262144&&w[18]])),_[0]&1&&Et(o,w[0]),T(o,"bx--text-area",!0),T(o,"bx--text-area--light",w[6]),T(o,"bx--text-area--invalid",w[12]),(!d||_[0]&4096&&u!==(u=w[12]||void 0))&&O(r,"data-invalid",u),!w[12]&&w[9]?p?p.p(w,_):(p=qr(w),p.c(),p.m(e,g)):p&&(p.d(1),p=null),w[12]?b?b.p(w,_):(b=zr(w),b.c(),b.m(e,null)):b&&(b.d(1),b=null)},i(w){d||(B(v),B(k),d=!0)},o(w){G(v),G(k),d=!1},d(w){w&&x(e),v&&v.d(),k&&k.d(),n[32](null),p&&p.d(),b&&b.d(),f=!1,He(m)}}}function Fl(n,e,t){let r;const i=["value","placeholder","cols","rows","maxCount","light","disabled","readonly","helperText","labelText","hideLabel","invalid","invalidText","id","name","ref"];let o=Le(e,i),{$$slots:l={},$$scope:s}=e;const a=fn(l);let{value:u=""}=e,{placeholder:c=""}=e,{cols:g=50}=e,{rows:d=4}=e,{maxCount:f=void 0}=e,{light:m=!1}=e,{disabled:v=!1}=e,{readonly:k=!1}=e,{helperText:R=""}=e,{labelText:h=""}=e,{hideLabel:p=!1}=e,{invalid:b=!1}=e,{invalidText:w=""}=e,{id:_="ccs-"+Math.random().toString(36)}=e,{name:N=void 0}=e,{ref:M=null}=e;function F(y){ae.call(this,n,y)}function E(y){ae.call(this,n,y)}function C(y){ae.call(this,n,y)}function Y(y){ae.call(this,n,y)}function I(y){ae.call(this,n,y)}function A(y){ae.call(this,n,y)}function z(y){ae.call(this,n,y)}function J(y){ae.call(this,n,y)}function ne(y){ae.call(this,n,y)}function Z(y){ae.call(this,n,y)}function te(y){ae.call(this,n,y)}function se(y){ue[y?"unshift":"push"](()=>{M=y,t(1,M)})}function re(){u=this.value,t(0,u)}return n.$$set=y=>{e=he(he({},e),We(y)),t(18,o=Le(e,i)),"value"in y&&t(0,u=y.value),"placeholder"in y&&t(2,c=y.placeholder),"cols"in y&&t(3,g=y.cols),"rows"in y&&t(4,d=y.rows),"maxCount"in y&&t(5,f=y.maxCount),"light"in y&&t(6,m=y.light),"disabled"in y&&t(7,v=y.disabled),"readonly"in y&&t(8,k=y.readonly),"helperText"in y&&t(9,R=y.helperText),"labelText"in y&&t(10,h=y.labelText),"hideLabel"in y&&t(11,p=y.hideLabel),"invalid"in y&&t(12,b=y.invalid),"invalidText"in y&&t(13,w=y.invalidText),"id"in y&&t(14,_=y.id),"name"in y&&t(15,N=y.name),"ref"in y&&t(1,M=y.ref),"$$scope"in y&&t(19,s=y.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&16384&&t(16,r=`error-${_}`)},[u,M,c,g,d,f,m,v,k,R,h,p,b,w,_,N,r,a,o,s,l,F,E,C,Y,I,A,z,J,ne,Z,te,se,re]}class Il extends oe{constructor(e){super(),le(this,e,Fl,Nl,ie,{value:0,placeholder:2,cols:3,rows:4,maxCount:5,light:6,disabled:7,readonly:8,helperText:9,labelText:10,hideLabel:11,invalid:12,invalidText:13,id:14,name:15,ref:1},null,[-1,-1])}}const Bl=Il,ql=n=>({}),Gr=n=>({}),zl=n=>({}),Dr=n=>({});function Yr(n){let e,t,r,i=n[9]&&Xr(n),o=!n[20]&&n[6]&&Jr(n);return{c(){e=L("div"),i&&i.c(),t=q(),o&&o.c(),T(e,"bx--text-input__label-helper-wrapper",!0)},m(l,s){P(l,e,s),i&&i.m(e,null),S(e,t),o&&o.m(e,null),r=!0},p(l,s){l[9]?i?(i.p(l,s),s[0]&512&&B(i,1)):(i=Xr(l),i.c(),B(i,1),i.m(e,t)):i&&(Ee(),G(i,1,1,()=>{i=null}),Me()),!l[20]&&l[6]?o?o.p(l,s):(o=Jr(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(l){r||(B(i),r=!0)},o(l){G(i),r=!1},d(l){l&&x(e),i&&i.d(),o&&o.d()}}}function Xr(n){let e,t;const r=n[26].labelText,i=ze(r,n,n[25],Dr),o=i||Gl(n);return{c(){e=L("label"),o&&o.c(),O(e,"for",n[7]),T(e,"bx--label",!0),T(e,"bx--visually-hidden",n[10]),T(e,"bx--label--disabled",n[5]),T(e,"bx--label--inline",n[16]),T(e,"bx--label--inline--sm",n[2]==="sm"),T(e,"bx--label--inline--xl",n[2]==="xl")},m(l,s){P(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s[0]&33554432)&&Ge(i,r,l,l[25],t?Ye(r,l[25],s,zl):De(l[25]),Dr):o&&o.p&&(!t||s[0]&512)&&o.p(l,t?s:[-1,-1]),(!t||s[0]&128)&&O(e,"for",l[7]),(!t||s[0]&1024)&&T(e,"bx--visually-hidden",l[10]),(!t||s[0]&32)&&T(e,"bx--label--disabled",l[5]),(!t||s[0]&65536)&&T(e,"bx--label--inline",l[16]),(!t||s[0]&4)&&T(e,"bx--label--inline--sm",l[2]==="sm"),(!t||s[0]&4)&&T(e,"bx--label--inline--xl",l[2]==="xl")},i(l){t||(B(o,l),t=!0)},o(l){G(o,l),t=!1},d(l){l&&x(e),o&&o.d(l)}}}function Gl(n){let e;return{c(){e=H(n[9])},m(t,r){P(t,e,r)},p(t,r){r[0]&512&&pe(e,t[9])},d(t){t&&x(e)}}}function Jr(n){let e,t;return{c(){e=L("div"),t=H(n[6]),T(e,"bx--form__helper-text",!0),T(e,"bx--form__helper-text--disabled",n[5]),T(e,"bx--form__helper-text--inline",n[16])},m(r,i){P(r,e,i),S(e,t)},p(r,i){i[0]&64&&pe(t,r[6]),i[0]&32&&T(e,"bx--form__helper-text--disabled",r[5]),i[0]&65536&&T(e,"bx--form__helper-text--inline",r[16])},d(r){r&&x(e)}}}function Ur(n){let e,t;const r=n[26].labelText,i=ze(r,n,n[25],Gr),o=i||Dl(n);return{c(){e=L("label"),o&&o.c(),O(e,"for",n[7]),T(e,"bx--label",!0),T(e,"bx--visually-hidden",n[10]),T(e,"bx--label--disabled",n[5]),T(e,"bx--label--inline",n[16]),T(e,"bx--label--inline-sm",n[16]&&n[2]==="sm"),T(e,"bx--label--inline-xl",n[16]&&n[2]==="xl")},m(l,s){P(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s[0]&33554432)&&Ge(i,r,l,l[25],t?Ye(r,l[25],s,ql):De(l[25]),Gr):o&&o.p&&(!t||s[0]&512)&&o.p(l,t?s:[-1,-1]),(!t||s[0]&128)&&O(e,"for",l[7]),(!t||s[0]&1024)&&T(e,"bx--visually-hidden",l[10]),(!t||s[0]&32)&&T(e,"bx--label--disabled",l[5]),(!t||s[0]&65536)&&T(e,"bx--label--inline",l[16]),(!t||s[0]&65540)&&T(e,"bx--label--inline-sm",l[16]&&l[2]==="sm"),(!t||s[0]&65540)&&T(e,"bx--label--inline-xl",l[16]&&l[2]==="xl")},i(l){t||(B(o,l),t=!0)},o(l){G(o,l),t=!1},d(l){l&&x(e),o&&o.d(l)}}}function Dl(n){let e;return{c(){e=H(n[9])},m(t,r){P(t,e,r)},p(t,r){r[0]&512&&pe(e,t[9])},d(t){t&&x(e)}}}function jr(n){let e,t;return e=new Li({props:{class:"bx--text-input__invalid-icon"}}),{c(){K(e.$$.fragment)},m(r,i){$(e,r,i),t=!0},i(r){t||(B(e.$$.fragment,r),t=!0)},o(r){G(e.$$.fragment,r),t=!1},d(r){ee(e,r)}}}function Wr(n){let e,t;return e=new ml({props:{class:`bx--text-input__invalid-icon
            bx--text-input__invalid-icon--warning`}}),{c(){K(e.$$.fragment)},m(r,i){$(e,r,i),t=!0},i(r){t||(B(e.$$.fragment,r),t=!0)},o(r){G(e.$$.fragment,r),t=!1},d(r){ee(e,r)}}}function Hr(n){let e,t;return e=new Ml({props:{class:"bx--text-input__readonly-icon"}}),{c(){K(e.$$.fragment)},m(r,i){$(e,r,i),t=!0},i(r){t||(B(e.$$.fragment,r),t=!0)},o(r){G(e.$$.fragment,r),t=!1},d(r){ee(e,r)}}}function Vr(n){let e;return{c(){e=L("hr"),T(e,"bx--text-input__divider",!0)},m(t,r){P(t,e,r)},d(t){t&&x(e)}}}function Zr(n){let e,t;return{c(){e=L("div"),t=H(n[12]),O(e,"id",n[19]),T(e,"bx--form-requirement",!0)},m(r,i){P(r,e,i),S(e,t)},p(r,i){i[0]&4096&&pe(t,r[12]),i[0]&524288&&O(e,"id",r[19])},d(r){r&&x(e)}}}function Qr(n){let e,t;return{c(){e=L("div"),t=H(n[14]),O(e,"id",n[18]),T(e,"bx--form-requirement",!0)},m(r,i){P(r,e,i),S(e,t)},p(r,i){i[0]&16384&&pe(t,r[14]),i[0]&262144&&O(e,"id",r[18])},d(r){r&&x(e)}}}function Kr(n){let e,t;return{c(){e=L("div"),t=H(n[6]),T(e,"bx--form__helper-text",!0),T(e,"bx--form__helper-text--disabled",n[5]),T(e,"bx--form__helper-text--inline",n[16])},m(r,i){P(r,e,i),S(e,t)},p(r,i){i[0]&64&&pe(t,r[6]),i[0]&32&&T(e,"bx--form__helper-text--disabled",r[5]),i[0]&65536&&T(e,"bx--form__helper-text--inline",r[16])},d(r){r&&x(e)}}}function $r(n){let e,t;return{c(){e=L("div"),t=H(n[12]),O(e,"id",n[19]),T(e,"bx--form-requirement",!0)},m(r,i){P(r,e,i),S(e,t)},p(r,i){i[0]&4096&&pe(t,r[12]),i[0]&524288&&O(e,"id",r[19])},d(r){r&&x(e)}}}function ei(n){let e,t;return{c(){e=L("div"),t=H(n[14]),O(e,"id",n[18]),T(e,"bx--form-requirement",!0)},m(r,i){P(r,e,i),S(e,t)},p(r,i){i[0]&16384&&pe(t,r[14]),i[0]&262144&&O(e,"id",r[18])},d(r){r&&x(e)}}}function Yl(n){let e,t,r,i,o,l,s,a,u,c,g,d,f,m,v,k,R,h,p,b,w,_,N,M,F=n[16]&&Yr(n),E=!n[16]&&(n[9]||n[24].labelText)&&Ur(n),C=n[11]&&jr(),Y=!n[11]&&n[13]&&Wr(),I=n[17]&&Hr(),A=[{"data-invalid":c=n[11]||void 0},{"aria-invalid":g=n[11]||void 0},{"data-warn":d=n[13]||void 0},{"aria-describedby":f=n[11]?n[19]:n[13]?n[18]:void 0},{disabled:n[5]},{id:n[7]},{name:n[8]},{placeholder:n[3]},{required:n[15]},{readOnly:n[17]},n[23]],z={};for(let y=0;y<A.length;y+=1)z=he(z,A[y]);let J=n[20]&&Vr(),ne=n[20]&&!n[16]&&n[11]&&Zr(n),Z=n[20]&&!n[16]&&n[13]&&Qr(n),te=!n[11]&&!n[13]&&!n[20]&&!n[16]&&n[6]&&Kr(n),se=!n[20]&&n[11]&&$r(n),re=!n[20]&&!n[11]&&n[13]&&ei(n);return{c(){e=L("div"),F&&F.c(),t=q(),E&&E.c(),r=q(),i=L("div"),o=L("div"),C&&C.c(),l=q(),Y&&Y.c(),s=q(),I&&I.c(),a=q(),u=L("input"),m=q(),J&&J.c(),v=q(),ne&&ne.c(),k=q(),Z&&Z.c(),p=q(),te&&te.c(),b=q(),se&&se.c(),w=q(),re&&re.c(),st(u,z),T(u,"bx--text-input",!0),T(u,"bx--text-input--light",n[4]),T(u,"bx--text-input--invalid",n[11]),T(u,"bx--text-input--warn",n[13]),T(u,"bx--text-input--sm",n[2]==="sm"),T(u,"bx--text-input--xl",n[2]==="xl"),O(o,"data-invalid",R=n[11]||void 0),O(o,"data-warn",h=n[13]||void 0),T(o,"bx--text-input__field-wrapper",!0),T(o,"bx--text-input__field-wrapper--warning",!n[11]&&n[13]),T(i,"bx--text-input__field-outer-wrapper",!0),T(i,"bx--text-input__field-outer-wrapper--inline",n[16]),T(e,"bx--form-item",!0),T(e,"bx--text-input-wrapper",!0),T(e,"bx--text-input-wrapper--inline",n[16]),T(e,"bx--text-input-wrapper--light",n[4]),T(e,"bx--text-input-wrapper--readonly",n[17])},m(y,U){P(y,e,U),F&&F.m(e,null),S(e,t),E&&E.m(e,null),S(e,r),S(e,i),S(i,o),C&&C.m(o,null),S(o,l),Y&&Y.m(o,null),S(o,s),I&&I.m(o,null),S(o,a),S(o,u),u.autofocus&&u.focus(),n[36](u),Et(u,n[0]),S(o,m),J&&J.m(o,null),S(o,v),ne&&ne.m(o,null),S(o,k),Z&&Z.m(o,null),S(i,p),te&&te.m(i,null),S(i,b),se&&se.m(i,null),S(i,w),re&&re.m(i,null),_=!0,N||(M=[X(u,"input",n[37]),X(u,"change",n[22]),X(u,"input",n[21]),X(u,"keydown",n[31]),X(u,"keyup",n[32]),X(u,"focus",n[33]),X(u,"blur",n[34]),X(u,"paste",n[35]),X(e,"click",n[27]),X(e,"mouseover",n[28]),X(e,"mouseenter",n[29]),X(e,"mouseleave",n[30])],N=!0)},p(y,U){y[16]?F?(F.p(y,U),U[0]&65536&&B(F,1)):(F=Yr(y),F.c(),B(F,1),F.m(e,t)):F&&(Ee(),G(F,1,1,()=>{F=null}),Me()),!y[16]&&(y[9]||y[24].labelText)?E?(E.p(y,U),U[0]&16843264&&B(E,1)):(E=Ur(y),E.c(),B(E,1),E.m(e,r)):E&&(Ee(),G(E,1,1,()=>{E=null}),Me()),y[11]?C?U[0]&2048&&B(C,1):(C=jr(),C.c(),B(C,1),C.m(o,l)):C&&(Ee(),G(C,1,1,()=>{C=null}),Me()),!y[11]&&y[13]?Y?U[0]&10240&&B(Y,1):(Y=Wr(),Y.c(),B(Y,1),Y.m(o,s)):Y&&(Ee(),G(Y,1,1,()=>{Y=null}),Me()),y[17]?I?U[0]&131072&&B(I,1):(I=Hr(),I.c(),B(I,1),I.m(o,a)):I&&(Ee(),G(I,1,1,()=>{I=null}),Me()),st(u,z=ht(A,[(!_||U[0]&2048&&c!==(c=y[11]||void 0))&&{"data-invalid":c},(!_||U[0]&2048&&g!==(g=y[11]||void 0))&&{"aria-invalid":g},(!_||U[0]&8192&&d!==(d=y[13]||void 0))&&{"data-warn":d},(!_||U[0]&796672&&f!==(f=y[11]?y[19]:y[13]?y[18]:void 0))&&{"aria-describedby":f},(!_||U[0]&32)&&{disabled:y[5]},(!_||U[0]&128)&&{id:y[7]},(!_||U[0]&256)&&{name:y[8]},(!_||U[0]&8)&&{placeholder:y[3]},(!_||U[0]&32768)&&{required:y[15]},(!_||U[0]&131072)&&{readOnly:y[17]},U[0]&8388608&&y[23]])),U[0]&1&&u.value!==y[0]&&Et(u,y[0]),T(u,"bx--text-input",!0),T(u,"bx--text-input--light",y[4]),T(u,"bx--text-input--invalid",y[11]),T(u,"bx--text-input--warn",y[13]),T(u,"bx--text-input--sm",y[2]==="sm"),T(u,"bx--text-input--xl",y[2]==="xl"),y[20]?J||(J=Vr(),J.c(),J.m(o,v)):J&&(J.d(1),J=null),y[20]&&!y[16]&&y[11]?ne?ne.p(y,U):(ne=Zr(y),ne.c(),ne.m(o,k)):ne&&(ne.d(1),ne=null),y[20]&&!y[16]&&y[13]?Z?Z.p(y,U):(Z=Qr(y),Z.c(),Z.m(o,null)):Z&&(Z.d(1),Z=null),(!_||U[0]&2048&&R!==(R=y[11]||void 0))&&O(o,"data-invalid",R),(!_||U[0]&8192&&h!==(h=y[13]||void 0))&&O(o,"data-warn",h),(!_||U[0]&10240)&&T(o,"bx--text-input__field-wrapper--warning",!y[11]&&y[13]),!y[11]&&!y[13]&&!y[20]&&!y[16]&&y[6]?te?te.p(y,U):(te=Kr(y),te.c(),te.m(i,b)):te&&(te.d(1),te=null),!y[20]&&y[11]?se?se.p(y,U):(se=$r(y),se.c(),se.m(i,w)):se&&(se.d(1),se=null),!y[20]&&!y[11]&&y[13]?re?re.p(y,U):(re=ei(y),re.c(),re.m(i,null)):re&&(re.d(1),re=null),(!_||U[0]&65536)&&T(i,"bx--text-input__field-outer-wrapper--inline",y[16]),(!_||U[0]&65536)&&T(e,"bx--text-input-wrapper--inline",y[16]),(!_||U[0]&16)&&T(e,"bx--text-input-wrapper--light",y[4]),(!_||U[0]&131072)&&T(e,"bx--text-input-wrapper--readonly",y[17])},i(y){_||(B(F),B(E),B(C),B(Y),B(I),_=!0)},o(y){G(F),G(E),G(C),G(Y),G(I),_=!1},d(y){y&&x(e),F&&F.d(),E&&E.d(),C&&C.d(),Y&&Y.d(),I&&I.d(),n[36](null),J&&J.d(),ne&&ne.d(),Z&&Z.d(),te&&te.d(),se&&se.d(),re&&re.d(),N=!1,He(M)}}}function Xl(n,e,t){let r,i,o;const l=["size","value","placeholder","light","disabled","helperText","id","name","labelText","hideLabel","invalid","invalidText","warn","warnText","ref","required","inline","readonly"];let s=Le(e,l),{$$slots:a={},$$scope:u}=e;const c=fn(a);let{size:g=void 0}=e,{value:d=""}=e,{placeholder:f=""}=e,{light:m=!1}=e,{disabled:v=!1}=e,{helperText:k=""}=e,{id:R="ccs-"+Math.random().toString(36)}=e,{name:h=void 0}=e,{labelText:p=""}=e,{hideLabel:b=!1}=e,{invalid:w=!1}=e,{invalidText:_=""}=e,{warn:N=!1}=e,{warnText:M=""}=e,{ref:F=null}=e,{required:E=!1}=e,{inline:C=!1}=e,{readonly:Y=!1}=e;const I=Un("Form"),A=wi();function z(D){return s.type!=="number"?D:D!=""?Number(D):null}const J=D=>{t(0,d=z(D.target.value)),A("input",d)},ne=D=>{A("change",z(D.target.value))};function Z(D){ae.call(this,n,D)}function te(D){ae.call(this,n,D)}function se(D){ae.call(this,n,D)}function re(D){ae.call(this,n,D)}function y(D){ae.call(this,n,D)}function U(D){ae.call(this,n,D)}function Fe(D){ae.call(this,n,D)}function Lt(D){ae.call(this,n,D)}function Xt(D){ae.call(this,n,D)}function mn(D){ue[D?"unshift":"push"](()=>{F=D,t(1,F)})}function me(){d=this.value,t(0,d)}return n.$$set=D=>{e=he(he({},e),We(D)),t(23,s=Le(e,l)),"size"in D&&t(2,g=D.size),"value"in D&&t(0,d=D.value),"placeholder"in D&&t(3,f=D.placeholder),"light"in D&&t(4,m=D.light),"disabled"in D&&t(5,v=D.disabled),"helperText"in D&&t(6,k=D.helperText),"id"in D&&t(7,R=D.id),"name"in D&&t(8,h=D.name),"labelText"in D&&t(9,p=D.labelText),"hideLabel"in D&&t(10,b=D.hideLabel),"invalid"in D&&t(11,w=D.invalid),"invalidText"in D&&t(12,_=D.invalidText),"warn"in D&&t(13,N=D.warn),"warnText"in D&&t(14,M=D.warnText),"ref"in D&&t(1,F=D.ref),"required"in D&&t(15,E=D.required),"inline"in D&&t(16,C=D.inline),"readonly"in D&&t(17,Y=D.readonly),"$$scope"in D&&t(25,u=D.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&128&&t(19,i=`error-${R}`),n.$$.dirty[0]&128&&t(18,o=`warn-${R}`)},t(20,r=!!I&&I.isFluid),[d,F,g,f,m,v,k,R,h,p,b,w,_,N,M,E,C,Y,o,i,r,J,ne,s,c,u,a,Z,te,se,re,y,U,Fe,Lt,Xt,mn,me]}class Jl extends oe{constructor(e){super(),le(this,e,Xl,Yl,ie,{size:2,value:0,placeholder:3,light:4,disabled:5,helperText:6,id:7,name:8,labelText:9,hideLabel:10,invalid:11,invalidText:12,warn:13,warnText:14,ref:1,required:15,inline:16,readonly:17},null,[-1,-1])}}const Ul=Jl;function jl(n){let e,t,r,i,o,l,s,a;return e=new Jt({props:{labelText:"Area",value:"area"}}),r=new Jt({props:{labelText:"Route",value:"route"}}),o=new Jt({props:{labelText:"Crossing",value:"crossing"}}),s=new Jt({props:{labelText:"Other",value:"other"}}),{c(){K(e.$$.fragment),t=q(),K(r.$$.fragment),i=q(),K(o.$$.fragment),l=q(),K(s.$$.fragment)},m(u,c){$(e,u,c),P(u,t,c),$(r,u,c),P(u,i,c),$(o,u,c),P(u,l,c),$(s,u,c),a=!0},p:Q,i(u){a||(B(e.$$.fragment,u),B(r.$$.fragment,u),B(o.$$.fragment,u),B(s.$$.fragment,u),a=!0)},o(u){G(e.$$.fragment,u),G(r.$$.fragment,u),G(o.$$.fragment,u),G(s.$$.fragment,u),a=!1},d(u){ee(e,u),u&&x(t),ee(r,u),u&&x(i),ee(o,u),u&&x(l),ee(s,u)}}}function ti(n){let e,t,r=ni(n[4])+"",i,o,l;return{c(){e=L("p"),t=H("Length: "),i=H(r),o=q(),l=L("br")},m(s,a){P(s,e,a),S(e,t),S(e,i),P(s,o,a),P(s,l,a)},p(s,a){a&16&&r!==(r=ni(s[4])+"")&&pe(i,r)},d(s){s&&x(e),s&&x(o),s&&x(l)}}}function Wl(n){let e,t,r,i,o,l,s,a,u,c,g,d,f,m,v,k,R,h,p,b,w,_,N;function M(z){n[5](z)}let F={labelText:"Name"};n[0]!==void 0&&(F.value=n[0]),e=new Ul({props:F}),ue.push(()=>Be(e,"value",M,n[0]));function E(z){n[6](z)}let C={$$slots:{default:[jl]},$$scope:{ctx:n}};n[1]!==void 0&&(C.selected=n[1]),l=new Rl({props:C}),ue.push(()=>Be(l,"selected",E,n[1]));function Y(z){n[7](z)}let I={labelText:"Description"};n[2]!==void 0&&(I.value=n[2]),g=new Bl({props:I}),ue.push(()=>Be(g,"value",Y,n[2]));let A=n[4]&&ti(n);return{c(){K(e.$$.fragment),r=q(),i=L("br"),o=q(),K(l.$$.fragment),a=q(),u=L("br"),c=q(),K(g.$$.fragment),f=q(),m=L("br"),v=q(),A&&A.c(),k=q(),R=L("div"),h=L("button"),h.textContent="Delete",p=q(),b=L("button"),b.textContent="Save",O(h,"type","button"),O(b,"type","button"),Rt(b,"float","right")},m(z,J){$(e,z,J),P(z,r,J),P(z,i,J),P(z,o,J),$(l,z,J),P(z,a,J),P(z,u,J),P(z,c,J),$(g,z,J),P(z,f,J),P(z,m,J),P(z,v,J),A&&A.m(z,J),P(z,k,J),P(z,R,J),S(R,h),S(R,p),S(R,b),w=!0,_||(N=[X(h,"click",n[8]),X(b,"click",n[9])],_=!0)},p(z,[J]){const ne={};!t&&J&1&&(t=!0,ne.value=z[0],qe(()=>t=!1)),e.$set(ne);const Z={};J&1024&&(Z.$$scope={dirty:J,ctx:z}),!s&&J&2&&(s=!0,Z.selected=z[1],qe(()=>s=!1)),l.$set(Z);const te={};!d&&J&4&&(d=!0,te.value=z[2],qe(()=>d=!1)),g.$set(te),z[4]?A?A.p(z,J):(A=ti(z),A.c(),A.m(k.parentNode,k)):A&&(A.d(1),A=null)},i(z){w||(B(e.$$.fragment,z),B(l.$$.fragment,z),B(g.$$.fragment,z),w=!0)},o(z){G(e.$$.fragment,z),G(l.$$.fragment,z),G(g.$$.fragment,z),w=!1},d(z){ee(e,z),z&&x(r),z&&x(i),z&&x(o),ee(l,z),z&&x(a),z&&x(u),z&&x(c),ee(g,z),z&&x(f),z&&x(m),z&&x(v),A&&A.d(z),z&&x(k),z&&x(R),_=!1,He(N)}}}function ni(n){return n<1e3?Math.round(n)+" m":(n/1e3).toFixed(1)+"km"}function Hl(n,e,t){let{id:r}=e,{name:i}=e,{intervention_type:o}=e,{description:l}=e,{length_meters:s}=e;function a(f){i=f,t(0,i)}function u(f){o=f,t(1,o)}function c(f){l=f,t(2,l)}const g=()=>Si(r),d=()=>Re.set(null);return n.$$set=f=>{"id"in f&&t(3,r=f.id),"name"in f&&t(0,i=f.name),"intervention_type"in f&&t(1,o=f.intervention_type),"description"in f&&t(2,l=f.description),"length_meters"in f&&t(4,s=f.length_meters)},[i,o,l,r,s,a,u,c,g,d]}class Vl extends oe{constructor(e){super(),le(this,e,Hl,Wl,ie,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}function ri(n){let e,t,r,i,o;const l=n[10].default,s=ze(l,n,n[9],null);return{c(){e=L("div"),s&&s.c()},m(a,u){P(a,e,u),s&&s.m(e,null),n[13](e),r=!0,i||(o=X(e,"introend",n[14]),i=!0)},p(a,u){s&&s.p&&(!r||u&512)&&Ge(s,l,a,a[9],r?Ye(l,a[9],u,null):De(a[9]),null)},i(a){r||(B(s,a),ki(()=>{t||(t=fr(e,Cr,{duration:100},!0)),t.run(1)}),r=!0)},o(a){G(s,a),t||(t=fr(e,Cr,{duration:100},!1)),t.run(0),r=!1},d(a){a&&x(e),s&&s.d(a),n[13](null),a&&t&&t.end(),i=!1,o()}}}function Zl(n){let e,t,r,i,o,l,s,a,u,c,g=n[4]&&ri(n);return{c(){e=L("button"),t=xe("svg"),r=xe("path"),i=q(),o=H(n[1]),l=q(),g&&g.c(),s=ut(),O(r,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-75u8ea"),O(e,"aria-expanded",n[4]),O(e,"class","svelte-75u8ea"),T(e,"underlined",n[3])},m(d,f){P(d,e,f),S(e,t),S(t,r),S(e,i),S(e,o),P(d,l,f),g&&g.m(d,f),P(d,s,f),a=!0,u||(c=[X(e,"click",n[5]),X(e,"mouseenter",n[11]),X(e,"mouseleave",n[12])],u=!0)},p(d,[f]){(!a||f&2)&&pe(o,d[1]),(!a||f&16)&&O(e,"aria-expanded",d[4]),(!a||f&8)&&T(e,"underlined",d[3]),d[4]?g?(g.p(d,f),f&16&&B(g,1)):(g=ri(d),g.c(),B(g,1),g.m(s.parentNode,s)):g&&(Ee(),G(g,1,1,()=>{g=null}),Me())},i(d){a||(B(g),a=!0)},o(d){G(g),a=!1},d(d){d&&x(e),d&&x(l),g&&g.d(d),d&&x(s),u=!1,He(c)}}}function Ql(n,e,t){let r,i,o,l;fe(n,Ke,h=>t(7,o=h)),fe(n,Re,h=>t(8,l=h));let{$$slots:s={},$$scope:a}=e,{id:u}=e,{label:c}=e;const g=()=>{Re.update(h=>h==u?null:u),l==u&&(En.set(null),En.set(u))};let d;function f(){d==null||d.scrollIntoView({behavior:"smooth"})}const m=()=>en.set(u),v=()=>en.set(null);function k(h){ue[h?"unshift":"push"](()=>{d=h,t(2,d)})}const R=()=>f();return n.$$set=h=>{"id"in h&&t(0,u=h.id),"label"in h&&t(1,c=h.label),"$$scope"in h&&t(9,a=h.$$scope)},n.$$.update=()=>{n.$$.dirty&257&&t(4,r=l==u),n.$$.dirty&129&&t(3,i=o==u)},[u,c,d,i,r,g,f,o,l,a,s,m,v,k,R]}class Kl extends oe{constructor(e){super(),le(this,e,Ql,Zl,ie,{id:0,label:1})}}function ii(n,e,t){const r=n.slice();return r[6]=e[t],r[7]=e,r[8]=t,r}function $l(n){let e,t,r,i,o,l;function s(g){n[2](g,n[6])}function a(g){n[3](g,n[6])}function u(g){n[4](g,n[6])}let c={id:n[6].id,length_meters:n[6].properties.length_meters};return n[6].properties.name!==void 0&&(c.name=n[6].properties.name),n[6].properties.intervention_type!==void 0&&(c.intervention_type=n[6].properties.intervention_type),n[6].properties.description!==void 0&&(c.description=n[6].properties.description),e=new Vl({props:c}),ue.push(()=>Be(e,"name",s,n[6].properties.name)),ue.push(()=>Be(e,"intervention_type",a,n[6].properties.intervention_type)),ue.push(()=>Be(e,"description",u,n[6].properties.description)),{c(){K(e.$$.fragment),o=q()},m(g,d){$(e,g,d),P(g,o,d),l=!0},p(g,d){n=g;const f={};d&1&&(f.id=n[6].id),d&1&&(f.length_meters=n[6].properties.length_meters),!t&&d&1&&(t=!0,f.name=n[6].properties.name,qe(()=>t=!1)),!r&&d&1&&(r=!0,f.intervention_type=n[6].properties.intervention_type,qe(()=>r=!1)),!i&&d&1&&(i=!0,f.description=n[6].properties.description,qe(()=>i=!1)),e.$set(f)},i(g){l||(B(e.$$.fragment,g),l=!0)},o(g){G(e.$$.fragment,g),l=!1},d(g){ee(e,g),g&&x(o)}}}function oi(n,e){let t,r,i;return r=new Kl({props:{id:e[6].id,label:e[8]+1+") "+li(e[6]),$$slots:{default:[$l]},$$scope:{ctx:e}}}),{key:n,first:null,c(){t=ut(),K(r.$$.fragment),this.first=t},m(o,l){P(o,t,l),$(r,o,l),i=!0},p(o,l){e=o;const s={};l&1&&(s.id=e[6].id),l&1&&(s.label=e[8]+1+") "+li(e[6])),l&513&&(s.$$scope={dirty:l,ctx:e}),r.$set(s)},i(o){i||(B(r.$$.fragment,o),i=!0)},o(o){G(r.$$.fragment,o),i=!1},d(o){o&&x(t),ee(r,o)}}}function es(n){let e=[],t=new Map,r,i,o,l,s=n[0].features;const a=u=>u[6].id;for(let u=0;u<s.length;u+=1){let c=ii(n,s,u),g=a(c);t.set(g,e[u]=oi(g,c))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();r=ut()},m(u,c){for(let g=0;g<e.length;g+=1)e[g].m(u,c);P(u,r,c),i=!0,o||(l=X(window,"keydown",n[1]),o=!0)},p(u,[c]){c&1&&(s=u[0].features,Ee(),e=eo(e,c,a,1,u,s,t,r.parentNode,to,oi,r,ii),Me())},i(u){if(!i){for(let c=0;c<s.length;c+=1)B(e[c]);i=!0}},o(u){for(let c=0;c<e.length;c+=1)G(e[c]);i=!1},d(u){for(let c=0;c<e.length;c+=1)e[c].d(u);u&&x(r),o=!1,l()}}}function li(n){if(n.properties.name)return n.properties.name;var e=n.properties.intervention_type;return e=="other"&&(n.geometry.type=="Point"?e="point":n.geometry.type=="LineString"?e="line":e="polygon"),`Untitled ${e}`}function ts(n,e,t){let r,i;fe(n,Re,u=>t(5,r=u)),fe(n,ce,u=>t(0,i=u));function o(u){if(u.key=="Delete"){const c=u.target.tagName;if(c=="INPUT"||c=="TEXTAREA")return;u.preventDefault();const g=r;g&&Si(g)}}function l(u,c){n.$$.not_equal(c.properties.name,u)&&(c.properties.name=u,ce.set(i))}function s(u,c){n.$$.not_equal(c.properties.intervention_type,u)&&(c.properties.intervention_type=u,ce.set(i))}function a(u,c){n.$$.not_equal(c.properties.description,u)&&(c.properties.description=u,ce.set(i))}return[i,o,l,s,a]}class ns extends oe{constructor(e){super(),le(this,e,ts,es,ie,{})}}function lt(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function je(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function An(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function rt(n,e,t){t===void 0&&(t={});var r=lt(n),i=lt(e),o=Ce(i[1]-r[1]),l=Ce(i[0]-r[0]),s=Ce(r[1]),a=Ce(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(s)*Math.cos(a);return er(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function pt(n,e,t){if(n!==null)for(var r,i,o,l,s,a,u,c=0,g=0,d,f=n.type,m=f==="FeatureCollection",v=f==="Feature",k=m?n.features.length:1,R=0;R<k;R++){u=m?n.features[R].geometry:v?n.geometry:n,d=u?u.type==="GeometryCollection":!1,s=d?u.geometries.length:1;for(var h=0;h<s;h++){var p=0,b=0;if(l=d?u.geometries[h]:u,l!==null){a=l.coordinates;var w=l.type;switch(c=t&&(w==="Polygon"||w==="MultiPolygon")?1:0,w){case null:break;case"Point":if(e(a,g,R,p,b)===!1)return!1;g++,p++;break;case"LineString":case"MultiPoint":for(r=0;r<a.length;r++){if(e(a[r],g,R,p,b)===!1)return!1;g++,w==="MultiPoint"&&p++}w==="LineString"&&p++;break;case"Polygon":case"MultiLineString":for(r=0;r<a.length;r++){for(i=0;i<a[r].length-c;i++){if(e(a[r][i],g,R,p,b)===!1)return!1;g++}w==="MultiLineString"&&p++,w==="Polygon"&&b++}w==="Polygon"&&p++;break;case"MultiPolygon":for(r=0;r<a.length;r++){for(b=0,i=0;i<a[r].length;i++){for(o=0;o<a[r][i].length-c;o++){if(e(a[r][i][o],g,R,p,b)===!1)return!1;g++}b++}p++}break;case"GeometryCollection":for(r=0;r<l.geometries.length;r++)if(pt(l.geometries[r],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function rs(n,e,t,r){var i=t;return pt(n,function(o,l,s,a,u){l===0&&t===void 0?i=o:i=e(i,o,l,s,a,u)},r),i}function Ti(n,e){var t;switch(n.type){case"FeatureCollection":for(t=0;t<n.features.length&&e(n.features[t].properties,t)!==!1;t++);break;case"Feature":e(n.properties,0);break}}function is(n,e,t){var r=t;return Ti(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}function Mt(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function Ci(n,e,t){var r=t;return Mt(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}function os(n){var e=[];return pt(n,function(t){e.push(t)}),e}function rr(n,e){var t,r,i,o,l,s,a,u,c,g,d=0,f=n.type==="FeatureCollection",m=n.type==="Feature",v=f?n.features.length:1;for(t=0;t<v;t++){for(s=f?n.features[t].geometry:m?n.geometry:n,u=f?n.features[t].properties:m?n.properties:{},c=f?n.features[t].bbox:m?n.bbox:void 0,g=f?n.features[t].id:m?n.id:void 0,a=s?s.type==="GeometryCollection":!1,l=a?s.geometries.length:1,i=0;i<l;i++){if(o=a?s.geometries[i]:s,o===null){if(e(null,d,u,c,g)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,d,u,c,g)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],d,u,c,g)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}d++}}function ls(n,e,t){var r=t;return rr(n,function(i,o,l,s,a){o===0&&t===void 0?r=i:r=e(r,i,o,l,s,a)}),r}function mt(n,e){rr(n,function(t,r,i,o,l){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Oe(t,i,{bbox:o,id:l}),r,0)===!1?!1:void 0}var a;switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var c=t.coordinates[u],g={type:a,coordinates:c};if(e(Oe(g,i),r,u)===!1)return!1}})}function ss(n,e,t){var r=t;return mt(n,function(i,o,l){o===0&&l===0&&t===void 0?r=i:r=e(r,i,o,l)}),r}function Ri(n,e){mt(n,function(t,r,i){var o=0;if(t.geometry){var l=t.geometry.type;if(!(l==="Point"||l==="MultiPoint")){var s,a=0,u=0,c=0;if(pt(t,function(g,d,f,m,v){if(s===void 0||r>a||m>u||v>c){s=g,a=r,u=m,c=v,o=0;return}var k=we([s,g],t.properties);if(e(k,r,i,v,o)===!1)return!1;o++,s=g})===!1)return!1}}})}function Ai(n,e,t){var r=t,i=!1;return Ri(n,function(o,l,s,a,u){i===!1&&t===void 0?r=o:r=e(r,o,l,s,a,u),i=!0}),r}function Oi(n,e){if(!n)throw new Error("geojson is required");mt(n,function(t,r,i){if(t.geometry!==null){var o=t.geometry.type,l=t.geometry.coordinates;switch(o){case"LineString":if(e(t,r,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<l.length;s++)if(e(we(l[s],t.properties),r,i,s)===!1)return!1;break}}})}function as(n,e,t){var r=t;return Oi(n,function(i,o,l,s){o===0&&t===void 0?r=i:r=e(r,i,o,l,s)}),r}function us(n,e){if(e=e||{},!tr(e))throw new Error("options is invalid");var t=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,l=e.properties,s;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),l=l||n.features[t].properties,s=n.features[t].geometry;break;case"Feature":l=l||n.properties,s=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=n;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=a.length+o-1),we([a[o],a[o+1]],l,e);case"Polygon":return i<0&&(i=a.length+i),o<0&&(o=a[i].length+o-1),we([a[i][o],a[i][o+1]],l,e);case"MultiLineString":return r<0&&(r=a.length+r),o<0&&(o=a[r].length+o-1),we([a[r][o],a[r][o+1]],l,e);case"MultiPolygon":return r<0&&(r=a.length+r),i<0&&(i=a[r].length+i),o<0&&(o=a[r][i].length-o-1),we([a[r][i][o],a[r][i][o+1]],l,e)}throw new Error("geojson is invalid")}function fs(n,e){if(e=e||{},!tr(e))throw new Error("options is invalid");var t=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,l=e.properties,s;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),l=l||n.features[t].properties,s=n.features[t].geometry;break;case"Feature":l=l||n.properties,s=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=n;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":return ye(a,l,e);case"MultiPoint":return r<0&&(r=a.length+r),ye(a[r],l,e);case"LineString":return o<0&&(o=a.length+o),ye(a[o],l,e);case"Polygon":return i<0&&(i=a.length+i),o<0&&(o=a[i].length+o),ye(a[i][o],l,e);case"MultiLineString":return r<0&&(r=a.length+r),o<0&&(o=a[r].length+o),ye(a[r][o],l,e);case"MultiPolygon":return r<0&&(r=a.length+r),i<0&&(i=a[r].length+i),o<0&&(o=a[r][i].length-o),ye(a[r][i][o],l,e)}throw new Error("geojson is invalid")}const cs=Object.freeze(Object.defineProperty({__proto__:null,coordAll:os,coordEach:pt,coordReduce:rs,featureEach:Mt,featureReduce:Ci,findPoint:fs,findSegment:us,flattenEach:mt,flattenReduce:ss,geomEach:rr,geomReduce:ls,lineEach:Oi,lineReduce:as,propEach:Ti,propReduce:is,segmentEach:Ri,segmentReduce:Ai},Symbol.toStringTag,{value:"Module"}));function Ht(n,e){return e===void 0&&(e={}),Ai(n,function(t,r){var i=r.geometry.coordinates;return t+rt(i[0],i[1],e)},0)}function ds(n){let e,t,r,i,o,l,s,a,u,c,g,d,f,m,v,k,R,h,p,b=n[0].features.length+"",w,_,N,M,F,E,C,Y;return{c(){e=L("div"),t=L("label"),r=H(`Scheme name:
    `),i=L("input"),o=q(),l=L("br"),s=q(),a=L("div"),u=L("label"),c=L("input"),g=q(),d=L("button"),d.textContent="Load from GeoJSON",f=q(),m=L("button"),m.textContent="Export to GeoJSON",v=q(),k=L("br"),R=q(),h=L("div"),p=L("span"),w=H(b),_=H(" interventions"),N=q(),M=L("button"),F=H("Clear all"),O(i,"type","text"),O(c,"type","file"),O(c,"id","load_geojson"),O(c,"class","svelte-lhyd1e"),O(d,"type","button"),O(m,"type","button"),O(m,"class","align-right svelte-lhyd1e"),O(M,"type","button"),O(M,"class","align-right svelte-lhyd1e"),M.disabled=E=n[0].features.length==0},m(I,A){P(I,e,A),S(e,t),S(t,r),S(t,i),Et(i,n[0].scheme_name),P(I,o,A),P(I,l,A),P(I,s,A),P(I,a,A),S(a,u),S(u,c),S(u,g),S(u,d),S(a,f),S(a,m),P(I,v,A),P(I,k,A),P(I,R,A),P(I,h,A),S(h,p),S(p,w),S(p,_),S(h,N),S(h,M),S(M,F),C||(Y=[X(i,"input",n[5]),X(c,"change",n[3]),X(d,"click",n[6]),X(m,"click",n[2]),X(M,"click",n[1])],C=!0)},p(I,[A]){A&1&&i.value!==I[0].scheme_name&&Et(i,I[0].scheme_name),A&1&&b!==(b=I[0].features.length+"")&&pe(w,b),A&1&&E!==(E=I[0].features.length==0)&&(M.disabled=E)},i:Q,o:Q,d(I){I&&x(e),I&&x(o),I&&x(l),I&&x(s),I&&x(a),I&&x(v),I&&x(k),I&&x(R),I&&x(h),C=!1,He(Y)}}}function hs(n,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",n),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function ps(n,e,t){let r;fe(n,ce,f=>t(0,r=f));let{authorityName:i}=e,o=window.localStorage.getItem(i);if(o)try{ce.set(c(JSON.parse(o)))}catch(f){console.log(`Failed to load from local storage: ${f}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&ce.update(f=>(delete f.scheme_name,f.features=[],f))}function s(){const f=JSON.parse(JSON.stringify(r));for(let m of f.features)delete m.properties.hide_while_editing;return f}function a(){let f=s();var m=i;f.authority=i,f.origin="atip-v1",f.scheme_name&&(m+="_"+f.scheme_name),m+=".txt",hs(m,JSON.stringify(f,null,"  "))}function u(f){const m=new FileReader;m.onload=v=>{try{ce.set(c(JSON.parse(v.target.result)))}catch(k){window.alert(`Couldn't load scheme from a file: ${k}`)}},m.readAsText(f.target.files[0])}function c(f){let m=1;for(let v of f.features)v.geometry.type=="LineString"&&!v.properties.length_meters&&(v.properties.length_meters=Ht(v,{units:"kilometers"})*1e3),v.id=m++;return f}function g(){r.scheme_name=this.value,ce.set(r)}const d=()=>document.getElementById("load_geojson").click();return n.$$set=f=>{"authorityName"in f&&t(4,i=f.authorityName)},n.$$.update=()=>{n.$$.dirty&17&&r&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(i,JSON.stringify(s())))},[r,l,a,u,i,g,d]}class ms extends oe{constructor(e){super(),le(this,e,ps,ds,ie,{authorityName:4})}}const gs="/atip/modal/assets/zoom_out_map-b2e1091a.svg";function bs(n){let e,t,r,i,o;return{c(){e=L("button"),t=L("img"),no(t.src,r=gs)||O(t,"src",r),O(t,"alt","Zoom to show entire boundary"),O(e,"type","button"),O(e,"title","Zoom to show entire boundary"),O(e,"class","svelte-qzjsqo")},m(l,s){P(l,e,s),S(e,t),i||(o=X(e,"click",n[0]),i=!0)},p:Q,i:Q,o:Q,d(l){l&&x(e),i=!1,o()}}}function vs(n,e,t){let r;fe(n,Ve,l=>t(2,r=l));let{boundaryGeojson:i}=e;function o(){r.fitBounds(jn(i),{padding:20,animate:!0,duration:500})}return n.$$set=l=>{"boundaryGeojson"in l&&t(1,i=l.boundaryGeojson)},[o,i]}class _s extends oe{constructor(e){super(),le(this,e,vs,bs,ie,{boundaryGeojson:1})}}function ys(n){let e,t,r,i,o,l,s;return{c(){e=L("div"),t=H(`Basemap:
  `),r=L("select"),i=L("option"),i.textContent="Streets",o=L("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,n[0]===void 0&&ki(()=>n[2].call(r)),O(e,"class","svelte-1tbnm6i")},m(a,u){P(a,e,u),S(e,t),S(e,r),S(r,i),S(r,o),cr(r,n[0]),l||(s=[X(r,"change",n[2]),X(r,"change",n[1])],l=!0)},p(a,[u]){u&1&&cr(r,a[0])},i:Q,o:Q,d(a){a&&x(e),l=!1,He(s)}}}function ws(n,e,t){let{style:r}=e;function i(){let l=new URLSearchParams(window.location.search);l.set("style",r);let s=`${window.location.pathname}?${l.toString()}${window.location.hash}`;window.location.href=s}function o(){r=ro(this),t(0,r)}return n.$$set=l=>{"style"in l&&t(0,r=l.style)},[r,i,o]}class ks extends oe{constructor(e){super(),le(this,e,ws,ys,ie,{style:0})}}const Pe={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",hovering:"black",lineEndpointColor:"black"},pn=10,on=10;function Ss(n){let e,t,r,i,o,l,s,a,u,c,g,d,f,m,v,k,R,h,p;return{c(){e=L("div"),t=L("h1"),t.textContent="Interventions",r=q(),i=L("ul"),o=L("li"),l=L("span"),s=H("Areas"),a=q(),u=L("li"),c=L("span"),g=H("Routes"),d=q(),f=L("li"),m=L("span"),v=H("Crossings"),k=q(),R=L("li"),h=L("span"),p=H("Other"),O(t,"class","svelte-p551i1"),O(l,"class","svelte-p551i1"),Rt(l,"background",Pe.area),O(c,"class","svelte-p551i1"),Rt(c,"background",Pe.route),O(m,"class","svelte-p551i1"),Rt(m,"background",Pe.crossing),O(h,"class","svelte-p551i1"),Rt(h,"background",Pe.other),O(e,"class","svelte-p551i1")},m(b,w){P(b,e,w),S(e,t),S(e,r),S(e,i),S(i,o),S(o,l),S(o,s),S(i,a),S(i,u),S(u,c),S(u,g),S(i,d),S(i,f),S(f,m),S(f,v),S(i,k),S(i,R),S(R,h),S(R,p)},p:Q,i:Q,o:Q,d(b){b&&x(e)}}}class Es extends oe{constructor(e){super(),le(this,e,null,Ss,ie,{})}}let bt="interventions";function Ms(n,e,t){let r,i;fe(n,Ve,a=>t(0,r=a)),fe(n,ce,a=>t(1,i=a)),xt(r,bt,{type:"geojson",data:i});const o=["match",["get","intervention_type"],"area",Pe.area,"route",Pe.route,"crossing",Pe.crossing,"other",Pe.other,"white"],l=["!=","hide_while_editing",!0];return Te(r,{id:"interventions-points",source:bt,filter:["all",Zn,l,["!=","endpoint",!0]],...Yt(o,pn)}),Te(r,{id:"interventions-lines",source:bt,filter:["all",Vn,l],...$t(o,on)},"route-lines"),Te(r,{id:"interventions-lines-endpoints",source:bt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*on,"circle-opacity":0,"circle-stroke-color":Pe.lineEndpointColor,"circle-stroke-width":2}}),Te(r,{id:"interventions-polygons",source:bt,filter:["all",Hn,l],...Qn(o,.5)},"hover-polygons"),n.$$.update=()=>{if(n.$$.dirty&3){let a=JSON.parse(JSON.stringify(i)),u=[];for(let c of a.features)if(c.geometry.type=="LineString")for(let g of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])u.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:g}});a.features=a.features.concat(u),r.getSource(bt).setData(a)}},[r,i]}class Ps extends oe{constructor(e){super(),le(this,e,Ms,null,ie,{})}}let vt="hover";function xs(n,e,t){let r,i,o,l,s;return fe(n,Ve,a=>t(0,r=a)),fe(n,ce,a=>t(1,i=a)),fe(n,en,a=>t(2,o=a)),fe(n,Ke,a=>t(3,l=a)),fe(n,Re,a=>t(4,s=a)),xt(r,vt,{type:"geojson",data:$e()}),Te(r,{id:"hover-polygons",source:vt,filter:Hn,...$t(Pe.hovering,.5*on,1)}),Te(r,{id:"hover-lines",source:vt,filter:Vn,...$t(Pe.hovering,1.5*on,1)},"interventions-lines"),Te(r,{id:"hover-points",source:vt,filter:Zn,...Yt(Pe.hovering,1.5*pn,1)},"interventions-points"),n.$$.update=()=>{if(n.$$.dirty&31){let a=s||l||o;a!=null?r.getSource(vt).setData(i.features.find(u=>u.id==a)):r.getSource(vt).setData($e())}},[r,i,o,l,s]}class Ls extends oe{constructor(e){super(),le(this,e,xs,null,ie,{})}}const Ut="edit-point-mode";var qt,On;class Ts{constructor(e){ct(this,qt);Se(this,"map");Se(this,"active");Se(this,"eventListeners");Se(this,"cursor");this.map=e,this.active=!1,this.eventListeners=[],this.cursor=null,e.on("mousemove",t=>{this.active&&(this.cursor=Cs(t.lngLat.toArray()),de(this,qt,On).call(this))}),e.on("click",()=>{if(this.active&&this.cursor){for(let t of this.eventListeners)t(this.cursor);this.stop()}}),xt(e,Ut,{type:"geojson",data:$e()}),Te(e,{id:"edit-point-mode",source:Ut,...Yt(Pe.hovering,pn,1)})}addEventListener(e){this.eventListeners.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Ut)}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,de(this,qt,On).call(this)}}qt=new WeakSet,On=function(){let e=$e();this.cursor&&e.features.push(this.cursor),this.map.getSource(Ut).setData(e)};function Cs(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function Ni(n,e,t){if(t===void 0&&(t={}),t.final===!0)return Rs(n,e);var r=lt(n),i=lt(e),o=Ce(r[0]),l=Ce(i[0]),s=Ce(r[1]),a=Ce(i[1]),u=Math.sin(l-o)*Math.cos(a),c=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(l-o);return Ft(Math.atan2(u,c))}function Rs(n,e){var t=Ni(e,n);return t=(t+180)%360,t}function si(n,e,t,r){r===void 0&&(r={});var i=lt(n),o=Ce(i[0]),l=Ce(i[1]),s=Ce(t),a=hn(e,r.units),u=Math.asin(Math.sin(l)*Math.cos(a)+Math.cos(l)*Math.sin(a)*Math.cos(s)),c=o+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(l),Math.cos(a)-Math.sin(l)*Math.sin(u)),g=Ft(c),d=Ft(u);return ye([g,d],r.properties)}function Nn(n){if(!n)throw new Error("geojson is required");var e=[];return mt(n,function(t){As(t,e)}),Ae(e)}function As(n,e){var t=[],r=n.geometry;if(r!==null){switch(r.type){case"Polygon":t=je(r);break;case"LineString":t=[je(r)]}t.forEach(function(i){var o=Os(i,n.properties);o.forEach(function(l){l.id=e.length,e.push(l)})})}}function Os(n,e){var t=[];return n.reduce(function(r,i){var o=we([r,i],e);return o.bbox=Ns(r,i),t.push(o),i}),t}function Ns(n,e){var t=n[0],r=n[1],i=e[0],o=e[1],l=t<i?t:i,s=r<o?r:o,a=t>i?t:i,u=r>o?r:o;return[l,s,a,u]}var Pt={},Fs={get exports(){return Pt},set exports(n){Pt=n}},Fn={},Is={get exports(){return Fn},set exports(n){Fn=n}};(function(n,e){(function(t,r){n.exports=r()})(io,function(){function t(h,p,b,w,_){(function N(M,F,E,C,Y){for(;C>E;){if(C-E>600){var I=C-E+1,A=F-E+1,z=Math.log(I),J=.5*Math.exp(2*z/3),ne=.5*Math.sqrt(z*J*(I-J)/I)*(A-I/2<0?-1:1),Z=Math.max(E,Math.floor(F-A*J/I+ne)),te=Math.min(C,Math.floor(F+(I-A)*J/I+ne));N(M,F,Z,te,Y)}var se=M[F],re=E,y=C;for(r(M,E,F),Y(M[C],se)>0&&r(M,E,C);re<y;){for(r(M,re,y),re++,y--;Y(M[re],se)<0;)re++;for(;Y(M[y],se)>0;)y--}Y(M[E],se)===0?r(M,E,y):r(M,++y,C),y<=F&&(E=y+1),F<=y&&(C=y-1)}})(h,p,b||0,w||h.length-1,_||i)}function r(h,p,b){var w=h[p];h[p]=h[b],h[b]=w}function i(h,p){return h<p?-1:h>p?1:0}var o=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function l(h,p,b){if(!b)return p.indexOf(h);for(var w=0;w<p.length;w++)if(b(h,p[w]))return w;return-1}function s(h,p){a(h,0,h.children.length,p,h)}function a(h,p,b,w,_){_||(_=k(null)),_.minX=1/0,_.minY=1/0,_.maxX=-1/0,_.maxY=-1/0;for(var N=p;N<b;N++){var M=h.children[N];u(_,h.leaf?w(M):M)}return _}function u(h,p){return h.minX=Math.min(h.minX,p.minX),h.minY=Math.min(h.minY,p.minY),h.maxX=Math.max(h.maxX,p.maxX),h.maxY=Math.max(h.maxY,p.maxY),h}function c(h,p){return h.minX-p.minX}function g(h,p){return h.minY-p.minY}function d(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function f(h){return h.maxX-h.minX+(h.maxY-h.minY)}function m(h,p){return h.minX<=p.minX&&h.minY<=p.minY&&p.maxX<=h.maxX&&p.maxY<=h.maxY}function v(h,p){return p.minX<=h.maxX&&p.minY<=h.maxY&&p.maxX>=h.minX&&p.maxY>=h.minY}function k(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function R(h,p,b,w,_){for(var N=[p,b];N.length;)if(!((b=N.pop())-(p=N.pop())<=w)){var M=p+Math.ceil((b-p)/w/2)*w;t(h,M,p,b,_),N.push(p,M,M,b)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(h){var p=this.data,b=[];if(!v(h,p))return b;for(var w=this.toBBox,_=[];p;){for(var N=0;N<p.children.length;N++){var M=p.children[N],F=p.leaf?w(M):M;v(h,F)&&(p.leaf?b.push(M):m(h,F)?this._all(M,b):_.push(M))}p=_.pop()}return b},o.prototype.collides=function(h){var p=this.data;if(!v(h,p))return!1;for(var b=[];p;){for(var w=0;w<p.children.length;w++){var _=p.children[w],N=p.leaf?this.toBBox(_):_;if(v(h,N)){if(p.leaf||m(h,N))return!0;b.push(_)}}p=b.pop()}return!1},o.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var p=0;p<h.length;p++)this.insert(h[p]);return this}var b=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===b.height)this._splitRoot(this.data,b);else{if(this.data.height<b.height){var w=this.data;this.data=b,b=w}this._insert(b,this.data.height-b.height-1,!0)}else this.data=b;return this},o.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},o.prototype.clear=function(){return this.data=k([]),this},o.prototype.remove=function(h,p){if(!h)return this;for(var b,w,_,N=this.data,M=this.toBBox(h),F=[],E=[];N||F.length;){if(N||(N=F.pop(),w=F[F.length-1],b=E.pop(),_=!0),N.leaf){var C=l(h,N.children,p);if(C!==-1)return N.children.splice(C,1),F.push(N),this._condense(F),this}_||N.leaf||!m(N,M)?w?(b++,N=w.children[b],_=!1):N=null:(F.push(N),E.push(b),b=0,w=N,N=N.children[0])}return this},o.prototype.toBBox=function(h){return h},o.prototype.compareMinX=function(h,p){return h.minX-p.minX},o.prototype.compareMinY=function(h,p){return h.minY-p.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(h){return this.data=h,this},o.prototype._all=function(h,p){for(var b=[];h;)h.leaf?p.push.apply(p,h.children):b.push.apply(b,h.children),h=b.pop();return p},o.prototype._build=function(h,p,b,w){var _,N=b-p+1,M=this._maxEntries;if(N<=M)return s(_=k(h.slice(p,b+1)),this.toBBox),_;w||(w=Math.ceil(Math.log(N)/Math.log(M)),M=Math.ceil(N/Math.pow(M,w-1))),(_=k([])).leaf=!1,_.height=w;var F=Math.ceil(N/M),E=F*Math.ceil(Math.sqrt(M));R(h,p,b,E,this.compareMinX);for(var C=p;C<=b;C+=E){var Y=Math.min(C+E-1,b);R(h,C,Y,F,this.compareMinY);for(var I=C;I<=Y;I+=F){var A=Math.min(I+F-1,Y);_.children.push(this._build(h,I,A,w-1))}}return s(_,this.toBBox),_},o.prototype._chooseSubtree=function(h,p,b,w){for(;w.push(p),!p.leaf&&w.length-1!==b;){for(var _=1/0,N=1/0,M=void 0,F=0;F<p.children.length;F++){var E=p.children[F],C=d(E),Y=(I=h,A=E,(Math.max(A.maxX,I.maxX)-Math.min(A.minX,I.minX))*(Math.max(A.maxY,I.maxY)-Math.min(A.minY,I.minY))-C);Y<N?(N=Y,_=C<_?C:_,M=E):Y===N&&C<_&&(_=C,M=E)}p=M||p.children[0]}var I,A;return p},o.prototype._insert=function(h,p,b){var w=b?h:this.toBBox(h),_=[],N=this._chooseSubtree(w,this.data,p,_);for(N.children.push(h),u(N,w);p>=0&&_[p].children.length>this._maxEntries;)this._split(_,p),p--;this._adjustParentBBoxes(w,_,p)},o.prototype._split=function(h,p){var b=h[p],w=b.children.length,_=this._minEntries;this._chooseSplitAxis(b,_,w);var N=this._chooseSplitIndex(b,_,w),M=k(b.children.splice(N,b.children.length-N));M.height=b.height,M.leaf=b.leaf,s(b,this.toBBox),s(M,this.toBBox),p?h[p-1].children.push(M):this._splitRoot(b,M)},o.prototype._splitRoot=function(h,p){this.data=k([h,p]),this.data.height=h.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(h,p,b){for(var w,_,N,M,F,E,C,Y=1/0,I=1/0,A=p;A<=b-p;A++){var z=a(h,0,A,this.toBBox),J=a(h,A,b,this.toBBox),ne=(_=z,N=J,M=void 0,F=void 0,E=void 0,C=void 0,M=Math.max(_.minX,N.minX),F=Math.max(_.minY,N.minY),E=Math.min(_.maxX,N.maxX),C=Math.min(_.maxY,N.maxY),Math.max(0,E-M)*Math.max(0,C-F)),Z=d(z)+d(J);ne<Y?(Y=ne,w=A,I=Z<I?Z:I):ne===Y&&Z<I&&(I=Z,w=A)}return w||b-p},o.prototype._chooseSplitAxis=function(h,p,b){var w=h.leaf?this.compareMinX:c,_=h.leaf?this.compareMinY:g;this._allDistMargin(h,p,b,w)<this._allDistMargin(h,p,b,_)&&h.children.sort(w)},o.prototype._allDistMargin=function(h,p,b,w){h.children.sort(w);for(var _=this.toBBox,N=a(h,0,p,_),M=a(h,b-p,b,_),F=f(N)+f(M),E=p;E<b-p;E++){var C=h.children[E];u(N,h.leaf?_(C):C),F+=f(N)}for(var Y=b-p-1;Y>=p;Y--){var I=h.children[Y];u(M,h.leaf?_(I):I),F+=f(M)}return F},o.prototype._adjustParentBBoxes=function(h,p,b){for(var w=b;w>=0;w--)u(p[w],h)},o.prototype._condense=function(h){for(var p=h.length-1,b=void 0;p>=0;p--)h[p].children.length===0?p>0?(b=h[p-1].children).splice(b.indexOf(h[p]),1):this.clear():s(h[p],this.toBBox)},o})})(Is);const Bs=Wn(Fo),qs=Wn(cs);function ln(n){var e=[1/0,1/0,-1/0,-1/0];return pt(n,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}ln.default=ln;const zs=Object.freeze(Object.defineProperty({__proto__:null,default:ln},Symbol.toStringTag,{value:"Module"})),Gs=Wn(zs);var Xe=Fn,Fi=Bs,Ii=qs,_t=Gs.default,Ds=Ii.featureEach;Ii.coordEach;Fi.polygon;var ai=Fi.featureCollection;function Bi(n){var e=new Xe(n);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:_t(t),Xe.prototype.insert.call(this,t)},e.load=function(t){var r=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:_t(i),r.push(i)}):Ds(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:_t(i),r.push(i)}),Xe.prototype.load.call(this,r)},e.remove=function(t,r){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:_t(t),Xe.prototype.remove.call(this,t,r)},e.clear=function(){return Xe.prototype.clear.call(this)},e.search=function(t){var r=Xe.prototype.search.call(this,this.toBBox(t));return ai(r)},e.collides=function(t){return Xe.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Xe.prototype.all.call(this);return ai(t)},e.toJSON=function(){return Xe.prototype.toJSON.call(this)},e.fromJSON=function(t){return Xe.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var r;if(t.bbox)r=t.bbox;else if(Array.isArray(t)&&t.length===4)r=t;else if(Array.isArray(t)&&t.length===6)r=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")r=_t(t);else if(t.type==="FeatureCollection")r=_t(t);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},e}Fs.exports=Bi;Pt.default=Bi;function qi(n,e){var t={},r=[];if(n.type==="LineString"&&(n=Oe(n)),e.type==="LineString"&&(e=Oe(e)),n.type==="Feature"&&e.type==="Feature"&&n.geometry!==null&&e.geometry!==null&&n.geometry.type==="LineString"&&e.geometry.type==="LineString"&&n.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=ui(n,e);return i&&r.push(i),Ae(r)}var o=Pt();return o.load(Nn(e)),Mt(Nn(n),function(l){Mt(o.search(l),function(s){var a=ui(l,s);if(a){var u=je(a).join(",");t[u]||(t[u]=!0,r.push(a))}})}),Ae(r)}function ui(n,e){var t=je(n),r=je(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],l=t[1][0],s=t[1][1],a=r[0][0],u=r[0][1],c=r[1][0],g=r[1][1],d=(g-u)*(l-i)-(c-a)*(s-o),f=(c-a)*(o-u)-(g-u)*(i-a),m=(l-i)*(o-u)-(s-o)*(i-a);if(d===0)return f===0&&m===0,null;var v=f/d,k=m/d;if(v>=0&&v<=1&&k>=0&&k<=1){var R=i+v*(l-i),h=o+v*(s-o);return ye([R,h])}return null}function Bt(n,e,t){t===void 0&&(t={});var r=ye([1/0,1/0],{dist:1/0}),i=0;return mt(n,function(o){for(var l=je(o),s=0;s<l.length-1;s++){var a=ye(l[s]);a.properties.dist=rt(e,a,t);var u=ye(l[s+1]);u.properties.dist=rt(e,u,t);var c=rt(a,u,t),g=Math.max(a.properties.dist,u.properties.dist),d=Ni(a,u),f=si(e,g,d+90,t),m=si(e,g,d-90,t),v=qi(we([f.geometry.coordinates,m.geometry.coordinates]),we([a.geometry.coordinates,u.geometry.coordinates])),k=null;v.features.length>0&&(k=v.features[0],k.properties.dist=rt(e,k,t),k.properties.location=i+rt(a,k,t)),a.properties.dist<r.properties.dist&&(r=a,r.properties.index=s,r.properties.location=i),u.properties.dist<r.properties.dist&&(r=u,r.properties.index=s+1,r.properties.location=i+c),k&&k.properties.dist<r.properties.dist&&(r=k,r.properties.index=s),i+=c}}),r}const yt="edit-polygon-mode";var Ze,dt,zt,In,Gt,Bn;class Ys{constructor(e){ct(this,Ze);ct(this,zt);ct(this,Gt);Se(this,"map");Se(this,"active");Se(this,"eventListeners");Se(this,"points");Se(this,"cursor");Se(this,"hoverPolyon");Se(this,"hoverPoint");Se(this,"dragging");Se(this,"dragFrom");this.map=e,this.active=!1,this.eventListeners=[],this.points=[],this.cursor=null,this.hoverPolyon=!1,this.hoverPoint=null,this.dragging=!1,this.dragFrom=null,e.on("mousemove",t=>{if(this.active&&!this.dragging)de(this,zt,In).call(this,t);else if(this.active&&this.dragging){if(this.hoverPolyon){let r=this.dragFrom[0]-t.lngLat.lng,i=this.dragFrom[1]-t.lngLat.lat;for(let o of this.points)o[0]-=r,o[1]-=i}else this.points[this.hoverPoint]=t.lngLat.toArray();this.dragFrom=t.lngLat.toArray(),de(this,Ze,dt).call(this)}}),e.on("click",t=>{if(this.active&&this.cursor){let r=[];if(ci(this.points).forEach((i,o)=>{r.push([o+1,Bt(i,this.cursor).properties.dist])}),r.sort((i,o)=>i[1]-o[1]),r.length>0){let i=r[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hoverPoint=i}else this.points.push(this.cursor.geometry.coordinates),this.hoverPoint=this.points.length-1;de(this,Ze,dt).call(this)}else this.active&&this.hoverPoint!=null&&(this.points.splice(this.hoverPoint,1),this.hoverPoint=null,de(this,Ze,dt).call(this),de(this,zt,In).call(this,t))}),e.on("mousedown",t=>{this.active&&!this.dragging&&(this.hoverPolyon||this.hoverPoint!=null)&&(t.preventDefault(),this.cursor=null,this.dragging=!0,this.dragFrom=t.lngLat.toArray())}),e.on("mouseup",()=>{this.active&&this.dragging&&(this.dragging=!1,this.dragFrom=null)}),document.addEventListener("keypress",t=>{if(this.active&&t.key=="Enter"){t.preventDefault();let r=de(this,Gt,Bn).call(this);if(r)for(let i of this.eventListeners)i(r);this.stop()}}),xt(e,yt,{type:"geojson",data:$e()}),Te(e,{id:"edit-polygon-fill",source:yt,filter:Hn,...Qn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Te(e,{id:"edit-polygon-lines",source:yt,filter:Vn,...$t("black",8,.5)}),Te(e,{id:"edit-polygon-vertices",source:yt,filter:Zn,...Yt(Pe.hovering,pn,["case",["boolean",["get","hover"],"false"],1,.5])})}addEventListener(e){this.eventListeners.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(yt)}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=e.geometry.coordinates[0],this.points.pop(),de(this,Ze,dt).call(this)}stop(){this.points=[],this.cursor=null,this.active=!1,this.hoverPolyon=!1,this.hoverPoint=null,this.dragging=!1,this.dragFrom=null,de(this,Ze,dt).call(this)}}Ze=new WeakSet,dt=function(){let e=$e();this.points.forEach((r,i)=>{let o=fi(r);o.properties.hover=this.hoverPoint==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(ci(this.points));let t=de(this,Gt,Bn).call(this);t&&(t.properties.hover=this.hoverPolyon,e.features.push(t)),this.map.getSource(yt).setData(e)},zt=new WeakSet,In=function(e){this.cursor=null,this.hoverPolyon=!1,this.hoverPoint=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hoverPolyon=!0;break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hoverPoint=t.properties.idx;break}!this.hoverPolyon&&this.hoverPoint==null&&(this.cursor=fi(e.lngLat.toArray())),de(this,Ze,dt).call(this)},Gt=new WeakSet,Bn=function(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}};function fi(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function ci(n){let e=[];for(let t=0;t<n.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[t],n[t+1]]}});return n.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[n.length-1],n[0]]}}),e}function di(n){let e;return{c(){e=L("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,r){P(t,e,r)},d(t){t&&x(e)}}}function Xs(n){let e,t=n[0]==wt&&di();return{c(){t&&t.c(),e=ut()},m(r,i){t&&t.m(r,i),P(r,e,i)},p(r,[i]){r[0]==wt?t||(t=di(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Q,o:Q,d(r){t&&t.d(r),r&&x(e)}}}const wt="edit-attribute";function zi(){}function Js(n,e,t){let r,i;fe(n,Ve,a=>t(4,r=a)),fe(n,ce,a=>t(5,i=a));let{mode:o}=e,{changeMode:l}=e;function s(){Re.set(null)}return r.on("mousemove",a=>{if(o==wt){let c=r.queryRenderedFeatures(a.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});var u=null;c.length>0&&(u=c[0].id),Ke.set(u)}}),r.on("mouseout",()=>{o==wt&&Ke.set(null)}),r.on("click",a=>{if(o==wt){let u=r.queryRenderedFeatures(a.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});u.length>0?Re.set(u[0].id):Re.set(null)}}),En.subscribe(a=>{if(a){let u=i.features.find(c=>c.id==a);u.geometry.type=="Point"?r.flyTo({center:u.geometry.coordinates}):r.fitBounds(jn(u),{padding:200,animate:!0,duration:500}),l(wt)}}),n.$$set=a=>{"mode"in a&&t(0,o=a.mode),"changeMode"in a&&t(1,l=a.changeMode)},[o,l,zi,s]}class Us extends oe{constructor(e){super(),le(this,e,Js,Xs,ie,{mode:0,changeMode:1,start:2,stop:3})}get start(){return zi}get stop(){return this.$$.ctx[3]}}function hi(n){let e;return{c(){e=L("p"),e.textContent="Click an intervention to edit its geometry"},m(t,r){P(t,e,r)},d(t){t&&x(e)}}}function js(n){let e,t=n[0]==tt&&hi();return{c(){t&&t.c(),e=ut()},m(r,i){t&&t.m(r,i),P(r,e,i)},p(r,[i]){r[0]==tt?t||(t=hi(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Q,o:Q,d(r){t&&t.d(r),r&&x(e)}}}const tt="edit-geometry";function Gi(){}function Ws(n,e,t){let r;fe(n,Ve,d=>t(8,r=d));let{mode:i}=e,{routeSnapper:o}=e,{snapTool:l}=e,{pointTool:s}=e,{polygonTool:a}=e;function u(){c&&(o.stop(),s.stop(),a.stop(),ce.update(d=>{let f=d.features.find(m=>m.id==c);return delete f.properties.hide_while_editing,d})),c=null,Ke.set(null)}let c=null;r.on("mousemove",d=>{if(i==tt&&c==null){let m=r.queryRenderedFeatures(d.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});var f=null;m.length>0&&(f=m[0].id),Ke.set(f)}}),r.on("mouseout",()=>{i==tt&&c==null&&Ke.set(null)}),r.on("click",d=>{if(i==tt&&c==null){let f=r.queryRenderedFeatures(d.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});f.length>0&&g(f[0].id)}}),l.addEventListener("new-route",d=>{if(i==tt){const f=d.detail;ce.update(m=>{let v=m.features.find(k=>k.id==c);return v.properties.length_meters=f.properties.length_meters,v.properties.waypoints=f.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=f.geometry,m}),c=null}}),l.addEventListener("no-new-route",()=>{i==tt&&(ce.update(d=>{let f=d.features.find(m=>m.id==c);return delete f.properties.hide_while_editing,d}),c=null)});for(let d of[s,a])d.addEventListener(f=>{i==tt&&(ce.update(m=>{let v=m.features.find(k=>k.id==c);return v.geometry=f.geometry,delete v.properties.hide_while_editing,m}),c=null)});function g(d){Ke.set(null);let f;ce.update(m=>(f=m.features.find(v=>v.id==d),f.properties.hide_while_editing=!0,m)),c=d,f.geometry.type=="LineString"?o.editExisting(f):f.geometry.type=="Polygon"?a.editExisting(f):f.geometry.type=="Point"&&s.start()}return n.$$set=d=>{"mode"in d&&t(0,i=d.mode),"routeSnapper"in d&&t(1,o=d.routeSnapper),"snapTool"in d&&t(2,l=d.snapTool),"pointTool"in d&&t(3,s=d.pointTool),"polygonTool"in d&&t(4,a=d.polygonTool)},[i,o,l,s,a,Gi,u]}class Hs extends oe{constructor(e){super(),le(this,e,Ws,js,ie,{mode:0,routeSnapper:1,snapTool:2,pointTool:3,polygonTool:4,start:5,stop:6})}get start(){return Gi}get stop(){return this.$$.ctx[6]}}let j;const Di=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Di.decode();let Vt=new Uint8Array;function Ot(){return Vt.byteLength===0&&(Vt=new Uint8Array(j.memory.buffer)),Vt}function kt(n,e){return Di.decode(Ot().subarray(n,n+e))}const Qe=new Array(32).fill(void 0);Qe.push(void 0,null,!0,!1);let Nt=Qe.length;function ge(n){Nt===Qe.length&&Qe.push(Qe.length+1);const e=Nt;return Nt=Qe[e],Qe[e]=n,e}function V(n){return Qe[n]}function Vs(n){n<36||(Qe[n]=Nt,Nt=n)}function qn(n){const e=V(n);return Vs(n),e}function _n(n){return n==null}let Zt=new Float64Array;function Zs(){return Zt.byteLength===0&&(Zt=new Float64Array(j.memory.buffer)),Zt}let Qt=new Int32Array;function be(){return Qt.byteLength===0&&(Qt=new Int32Array(j.memory.buffer)),Qt}let ot=0;const Kt=new TextEncoder("utf-8"),Qs=typeof Kt.encodeInto=="function"?function(n,e){return Kt.encodeInto(n,e)}:function(n,e){const t=Kt.encode(n);return e.set(t),{read:n.length,written:t.length}};function jt(n,e,t){if(t===void 0){const s=Kt.encode(n),a=e(s.length);return Ot().subarray(a,a+s.length).set(s),ot=s.length,a}let r=n.length,i=e(r);const o=Ot();let l=0;for(;l<r;l++){const s=n.charCodeAt(l);if(s>127)break;o[i+l]=s}if(l!==r){l!==0&&(n=n.slice(l)),i=t(i,r,r=l+n.length*3);const s=Ot().subarray(i+l,i+r),a=Qs(n,s);l+=a.written}return ot=l,i}function zn(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){const i=n.length;let o="[";i>0&&(o+=zn(n[0]));for(let l=1;l<i;l++)o+=", "+zn(n[l]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function Ks(n,e){const t=e(n.length*1);return Ot().set(n,t/1),ot=n.length,t}function yn(n,e){try{return n.apply(this,e)}catch(t){j.__wbindgen_exn_store(ge(t))}}class sn{static __wrap(e){const t=Object.create(sn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();j.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=j.__wbindgen_add_to_stack_pointer(-16),l=Ks(e,j.__wbindgen_malloc),s=ot;j.jsroutesnapper_new(o,l,s);var t=be()[o/4+0],r=be()[o/4+1],i=be()[o/4+2];if(i)throw qn(r);return sn.__wrap(t)}finally{j.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){j.jsroutesnapper_setConfig(this.ptr,ge(e))}toFinalFeature(){try{const r=j.__wbindgen_add_to_stack_pointer(-16);j.jsroutesnapper_toFinalFeature(r,this.ptr);var e=be()[r/4+0],t=be()[r/4+1];let i;return e!==0&&(i=kt(e,t).slice(),j.__wbindgen_free(e,t*1)),i}finally{j.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const r=j.__wbindgen_add_to_stack_pointer(-16);j.jsroutesnapper_renderGeojson(r,this.ptr);var e=be()[r/4+0],t=be()[r/4+1];return kt(e,t)}finally{j.__wbindgen_add_to_stack_pointer(16),j.__wbindgen_free(e,t)}}setSnapMode(e){j.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,r){return j.jsroutesnapper_onMouseMove(this.ptr,e,t,r)!==0}onClick(){j.jsroutesnapper_onClick(this.ptr)}onDragStart(){return j.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return j.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){j.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=j.__wbindgen_add_to_stack_pointer(-16);j.jsroutesnapper_editExisting(i,this.ptr,ge(e));var t=be()[i/4+0],r=be()[i/4+1];if(r)throw qn(t)}finally{j.__wbindgen_add_to_stack_pointer(16)}}}async function $s(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function ea(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,t){const r=kt(e,t);return ge(r)},n.wbg.__wbindgen_object_drop_ref=function(e){qn(e)},n.wbg.__wbindgen_boolean_get=function(e){const t=V(e);return typeof t=="boolean"?t?1:0:2},n.wbg.__wbindgen_error_new=function(e,t){const r=new Error(kt(e,t));return ge(r)},n.wbg.__wbindgen_is_object=function(e){const t=V(e);return typeof t=="object"&&t!==null},n.wbg.__wbindgen_is_undefined=function(e){return V(e)===void 0},n.wbg.__wbindgen_in=function(e,t){return V(e)in V(t)},n.wbg.__wbindgen_number_get=function(e,t){const r=V(t),i=typeof r=="number"?r:void 0;Zs()[e/8+1]=_n(i)?0:i,be()[e/4+0]=!_n(i)},n.wbg.__wbindgen_jsval_loose_eq=function(e,t){return V(e)==V(t)},n.wbg.__wbindgen_string_get=function(e,t){const r=V(t),i=typeof r=="string"?r:void 0;var o=_n(i)?0:jt(i,j.__wbindgen_malloc,j.__wbindgen_realloc),l=ot;be()[e/4+1]=l,be()[e/4+0]=o},n.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const r=String(V(t)),i=jt(r,j.__wbindgen_malloc,j.__wbindgen_realloc),o=ot;be()[e/4+1]=o,be()[e/4+0]=i},n.wbg.__wbindgen_object_clone_ref=function(e){const t=V(e);return ge(t)},n.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const r=V(e)[V(t)];return ge(r)},n.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(V(e))},n.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const r=V(e)[t>>>0];return ge(r)},n.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return V(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof V(e)=="function"},n.wbg.__wbg_next_579e583d33566a86=function(e){const t=V(e).next;return ge(t)},n.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return yn(function(e){const t=V(e).next();return ge(t)},arguments)},n.wbg.__wbg_done_1b73b0672e15f234=function(e){return V(e).done},n.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=V(e).value;return ge(t)},n.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ge(Symbol.iterator)},n.wbg.__wbg_get_765201544a2b6869=function(){return yn(function(e,t){const r=Reflect.get(V(e),V(t));return ge(r)},arguments)},n.wbg.__wbg_call_97ae9d8645dc388b=function(){return yn(function(e,t){const r=V(e).call(V(t));return ge(r)},arguments)},n.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(V(e))},n.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=V(e)instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=V(e).buffer;return ge(t)},n.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(V(e));return ge(t)},n.wbg.__wbg_set_83db9690f9353e79=function(e,t,r){V(e).set(V(t),r>>>0)},n.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return V(e).length},n.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=V(e)instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=V(t).stack,i=jt(r,j.__wbindgen_malloc,j.__wbindgen_realloc),o=ot;be()[e/4+1]=o,be()[e/4+0]=i},n.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(kt(e,t))}finally{j.__wbindgen_free(e,t)}},n.wbg.__wbindgen_debug_string=function(e,t){const r=zn(V(t)),i=jt(r,j.__wbindgen_malloc,j.__wbindgen_realloc),o=ot;be()[e/4+1]=o,be()[e/4+0]=i},n.wbg.__wbindgen_throw=function(e,t){throw new Error(kt(e,t))},n.wbg.__wbindgen_memory=function(){const e=j.memory;return ge(e)},n}function ta(n,e){return j=n.exports,Yi.__wbindgen_wasm_module=e,Zt=new Float64Array,Qt=new Int32Array,Vt=new Uint8Array,j}async function Yi(n){typeof n>"u"&&(n="/atip/modal/assets/route_snapper_bg.wasm");const e=ea();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await $s(await n,e);return ta(t,r)}var Dt,Gn,Ue,et;class na{constructor(e,t,r){ct(this,Dt);ct(this,Ue);this.controlDiv=r,this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new sn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),console.log("JsRouteSnapper ready, waiting for idle event"),this.active=!1,this.loaded=!1,this.map.once("idle",()=>{console.log("JsRouteSnapper now usable"),this.map.addSource("route-snapper",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"route-points",type:"circle",source:"route-snapper",paint:{"circle-radius":["match",["get","type"],"unimportant",10/2,10],"circle-color":["match",["get","type"],"hovered","green","important","red","black"]},filter:["in","$type","Point"]}),this.map.addLayer({id:"route-lines",type:"line",source:"route-snapper",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":2.5},filter:["in","$type","LineString"]}),this.loaded=!0,this.map.on("mousemove",l=>{if(!this.active)return;const s={x:l.point.x-30,y:l.point.y},a=this.map.unproject(l.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(l.lngLat.lng,l.lngLat.lat,a)&&de(this,Ue,et).call(this)}),this.map.on("click",()=>{this.active&&(this.inner.onClick(),de(this,Ue,et).call(this))}),this.map.on("dragstart",l=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}),this.map.on("mouseup",l=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}),document.addEventListener("keypress",l=>{this.active&&l.key=="Enter"&&(l.preventDefault(),de(this,Dt,Gn).call(this))}),document.addEventListener("keydown",l=>{this.active&&l.key=="Shift"&&(l.preventDefault(),this.inner.setSnapMode(!1),de(this,Ue,et).call(this))}),document.addEventListener("keyup",l=>{this.active&&l.key=="Shift"&&(l.preventDefault(),this.inner.setSnapMode(!0),de(this,Ue,et).call(this))}),this.stop()})}isActive(){return this.active}tearDown(){this.loaded&&(this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeSource("route-snapper"))}editExisting(e){if(!this.loaded){console.error("editExisting called before the map idle event received. Not starting tool.");return}e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.start(),this.inner.editExisting(e.properties.waypoints),de(this,Ue,et).call(this)}stop(){if(!this.loaded)return;this.active=!1,this.inner.clearState(),de(this,Ue,et).call(this),this.controlDiv.innerHTML="";let e=document.createElement("button");e.innerText="Route tool",e.type="button",e.onclick=()=>{this.controlDiv.dispatchEvent(new CustomEvent("activate")),this.start()},this.controlDiv.appendChild(e)}start(){if(this.active)return;this.active=!0;let e=document.createElement("button");e.type="button",e.innerText="Finish route",e.onclick=()=>{de(this,Dt,Gn).call(this)};let t=document.createElement("button");t.type="button",t.innerText="Cancel",t.onclick=()=>{this.controlDiv.dispatchEvent(new CustomEvent("no-new-route")),this.stop()},this.controlDiv.innerHTML="";let r=document.createElement("div");r.style="display: flex; justify-content: space-evenly;",r.appendChild(e),r.appendChild(t),this.controlDiv.appendChild(r);let i=document.createElement("input");i.type="checkbox",i.id="avoidDoublingBack",i.onclick=()=>{this.inner.setConfig({avoid_doubling_back:i.checked}),de(this,Ue,et).call(this)};let o=document.createElement("label");o.innerText="Avoid doubling back",o.for=i.id;let l=document.createElement("div");l.appendChild(i),l.appendChild(o),this.controlDiv.append(l);const s=document.createElement("ul");s.innerHTML="<li><b>Click</b> green points on the transport network</br>to create snapped routes</li><li>Hold <b>Shift</b> to draw a point anywhere</li><li><b>Click and drag</b> any point to move it</li><li><b>Click</b> a red waypoint to delete it</li><li>Press <b>Enter</b> to finish route</li>",this.controlDiv.appendChild(s)}}Dt=new WeakSet,Gn=function(){const e=this.inner.toFinalFeature();e?this.controlDiv.dispatchEvent(new CustomEvent("new-route",{detail:JSON.parse(e)})):this.controlDiv.dispatchEvent(new CustomEvent("no-new-route")),this.stop()},Ue=new WeakSet,et=function(){this.loaded&&this.map.getSource("route-snapper").setData(JSON.parse(this.inner.renderGeojson()))};async function ra(n,e){const t=await fetch(n),r=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,l=[];for(;;){const{done:u,value:c}=await r.read();if(u)break;l.push(c),o+=c.length;const g=100*o/i;e.style=`background: linear-gradient(to right, red ${g}%, transparent 0);`}let s=new Uint8Array(o),a=0;for(let u of l)s.set(u,a),a+=u.length;return s}function ia(n){let e,t;return{c(){e=L("div"),t=L("div"),t.textContent="Route tool loading..."},m(r,i){P(r,e,i),S(e,t),n[8](t),n[9](e)},p:Q,i:Q,o:Q,d(r){r&&x(e),n[8](null),n[9](null)}}}const wn="route";function oa(n,e,t){let r;fe(n,Ve,m=>t(10,r=m));let{mode:i}=e,{changeMode:o}=e,{url:l}=e,{snapTool:s}=e,a,{routeSnapper:u}=e;function c(){u.isActive()||u.start()}function g(){u==null||u.stop()}un(async()=>{await Yi(),console.log(`Grabbing ${l}`);try{const m=await ra(l,a);t(2,u=new na(r,m,s))}catch(m){console.log(`Route tool broke: ${m}`),t(0,s.innerHTML="Failed to load",s)}s.addEventListener("activate",()=>{o(wn)}),s.addEventListener("no-new-route",()=>{i==wn&&o("edit-attribute")}),s.addEventListener("new-route",m=>{if(i==wn){const v=m.detail;ce.update(k=>(v.id=cn(k),v.properties.intervention_type="route",k.features.push(v),k)),o("edit-attribute"),Re.set(v.id)}})}),Jn(()=>{u==null||u.tearDown()});function d(m){ue[m?"unshift":"push"](()=>{a=m,t(1,a)})}function f(m){ue[m?"unshift":"push"](()=>{s=m,t(0,s)})}return n.$$set=m=>{"mode"in m&&t(3,i=m.mode),"changeMode"in m&&t(4,o=m.changeMode),"url"in m&&t(5,l=m.url),"snapTool"in m&&t(0,s=m.snapTool),"routeSnapper"in m&&t(2,u=m.routeSnapper)},[s,a,u,i,o,l,c,g,d,f]}class la extends oe{constructor(e){super(),le(this,e,oa,ia,ie,{mode:3,changeMode:4,url:5,snapTool:0,routeSnapper:2,start:6,stop:7})}get start(){return this.$$.ctx[6]}get stop(){return this.$$.ctx[7]}}function pi(n){let e;return{c(){e=L("p"),e.textContent="Click to add a new point"},m(t,r){P(t,e,r)},d(t){t&&x(e)}}}function sa(n){let e,t=n[0]==Dn&&pi();return{c(){t&&t.c(),e=ut()},m(r,i){t&&t.m(r,i),P(r,e,i)},p(r,[i]){r[0]==Dn?t||(t=pi(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Q,o:Q,d(r){t&&t.d(r),r&&x(e)}}}const Dn="point";function aa(n,e,t){let{mode:r}=e,{changeMode:i}=e,{pointTool:o}=e;function l(){o.start()}function s(){o.stop()}return o.addEventListener(a=>{r==Dn&&(ce.update(u=>(a.id=cn(u),a.properties.intervention_type="other",u.features.push(a),u)),i("edit-attribute"),Re.set(a.id))}),n.$$set=a=>{"mode"in a&&t(0,r=a.mode),"changeMode"in a&&t(1,i=a.changeMode),"pointTool"in a&&t(2,o=a.pointTool)},[r,i,o,l,s]}class ua extends oe{constructor(e){super(),le(this,e,aa,sa,ie,{mode:0,changeMode:1,pointTool:2,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function mi(n){let e;return{c(){e=L("p"),e.innerHTML="Click the map to add a vertex, or click a vertex to delete it. Press <strong>Enter</strong> to finish. Drag a vertex or the polygon to move."},m(t,r){P(t,e,r)},d(t){t&&x(e)}}}function fa(n){let e,t=n[0]==Yn&&mi();return{c(){t&&t.c(),e=ut()},m(r,i){t&&t.m(r,i),P(r,e,i)},p(r,[i]){r[0]==Yn?t||(t=mi(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Q,o:Q,d(r){t&&t.d(r),r&&x(e)}}}const Yn="polygon";function ca(n,e,t){let{mode:r}=e,{changeMode:i}=e,{polygonTool:o}=e;function l(){o.startNew()}function s(){o.stop()}return o.addEventListener(a=>{r==Yn&&(ce.update(u=>(a.id=cn(u),a.properties.intervention_type="area",u.features.push(a),u)),i("edit-attribute"),Re.set(a.id))}),n.$$set=a=>{"mode"in a&&t(0,r=a.mode),"changeMode"in a&&t(1,i=a.changeMode),"polygonTool"in a&&t(2,o=a.polygonTool)},[r,i,o,l,s]}class da extends oe{constructor(e){super(),le(this,e,ca,fa,ie,{mode:0,changeMode:1,polygonTool:2,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ha(n){var e=n[0],t=n[1],r=n[2],i=n[3],o=rt(n.slice(0,2),[r,t]),l=rt(n.slice(0,2),[e,i]);if(o>=l){var s=(t+i)/2;return[e,s-(r-e)/2,r,s+(r-e)/2]}else{var a=(e+r)/2;return[a-(i-t)/2,t,a+(i-t)/2,i]}}function pa(n,e){e===void 0&&(e={});var t=e.precision,r=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,r=r==null||isNaN(r)?3:r,!n)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof r!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(n=JSON.parse(JSON.stringify(n)));var o=Math.pow(10,t);return pt(n,function(l){ma(l,o,r)}),n}function ma(n,e,t){n.length>t&&n.splice(t,n.length);for(var r=0;r<n.length;r++)n[r]=Math.round(n[r]*e)/e;return n}function ga(n,e){if(!n)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=An(n),r=An(e);if(t!=="LineString")throw new Error("line must be LineString");if(r==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(r==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=pa(e,{precision:7});switch(r){case"Point":return Xn(n,i);case"MultiPoint":return gi(n,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return gi(n,qi(n,i))}}function gi(n,e){var t=[],r=Pt();return mt(e,function(i){if(t.forEach(function(s,a){s.id=a}),!t.length)t=Xn(n,i).features,t.forEach(function(s){s.bbox||(s.bbox=ha(ln(s)))}),r.load(Ae(t));else{var o=r.search(i);if(o.features.length){var l=Xi(i,o);t=t.filter(function(s){return s.id!==l.id}),r.remove(l),Mt(Xn(l,i),function(s){t.push(s),r.insert(s)})}}}),Ae(t)}function Xn(n,e){var t=[],r=je(n)[0],i=je(n)[n.geometry.coordinates.length-1];if(kn(r,lt(e))||kn(i,lt(e)))return Ae([n]);var o=Pt(),l=Nn(n);o.load(l);var s=o.search(e);if(!s.features.length)return Ae([n]);var a=Xi(e,s),u=[r],c=Ci(l,function(g,d,f){var m=je(d)[1],v=lt(e);return f===a.id?(g.push(v),t.push(we(g)),kn(v,m)?[v]:[v,m]):(g.push(m),g)},u);return c.length>1&&t.push(we(c)),Ae(t)}function Xi(n,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,r=1/0;return Mt(e,function(i){var o=Bt(i,n),l=o.properties.dist;l<r&&(t=i,r=l)}),t}function kn(n,e){return n[0]===e[0]&&n[1]===e[1]}function ba(n,e,t){var r=je(t);if(An(t)!=="LineString")throw new Error("line must be a LineString");var i=Bt(t,n),o=Bt(t,e),l;i.properties.index<=o.properties.index?l=[i,o]:l=[o,i];for(var s=[l[0].geometry.coordinates],a=l[0].properties.index+1;a<l[1].properties.index+1;a++)s.push(r[a]);return s.push(l[1].geometry.coordinates),we(s,t.properties)}function bi(n){let e;return{c(){e=L("p"),e.textContent="Click near a route to split it, or click on the map to cancel"},m(t,r){P(t,e,r)},d(t){t&&x(e)}}}function va(n){let e,t=n[0]==an&&bi();return{c(){t&&t.c(),e=ut()},m(r,i){t&&t.m(r,i),P(r,e,i)},p(r,[i]){r[0]==an?t||(t=bi(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Q,o:Q,d(r){t&&t.d(r),r&&x(e)}}}const an="split-route",_a=10,ya=30;let Sn="split-route";function Ji(){}function vi(n,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:n}}}function wa(n,e,t){let r,i;fe(n,Ve,d=>t(5,r=d)),fe(n,ce,d=>t(7,i=d));let{mode:o}=e,{changeMode:l}=e;function s(){t(4,a=null),u=null}let a=null,u=null;r.on("mousemove",d=>{if(o!=an)return;t(4,a=vi(d.lngLat.toArray(),!1)),u=null;const f=[d.point.x-ya,d.point.y],m=r.unproject(d.point).distanceTo(r.unproject(f))/1e3;let v=[];for(let[k,R]of i.features.entries())if(R.geometry.type=="LineString"){let h=Bt(R.geometry,a,{units:"kilometers"});h.properties.dist<=m&&v.push([k,h.geometry.coordinates,h.properties.dist])}v.sort((k,R)=>k[2]-R[2]),v.length>0&&(t(4,a=vi(v[0][1],!0)),u=v[0][0])}),r.on("click",()=>{if(o==an)if(u==null)l("edit-attribute");else{let d=ga(i.features[u],a);if(d.features.length==2){let f=d.features[0],m=d.features[1];ce.update(v=>(f.id=v.features[u].id,m.id=cn(v),f.properties=JSON.parse(JSON.stringify(v.features[u].properties)),m.properties=JSON.parse(JSON.stringify(f.properties)),c(v.features[u],f,m,a),v.features.splice(u,1,f,m),v))}s()}}),xt(r,Sn,{type:"geojson",data:$e()}),Te(r,{id:"draw-split-route",source:Sn,...Yt("black",_a,["case",["==",["get","snapped"],!0],1,.5])});function c(d,f,m,v){f.properties.length_meters=Ht(f,{units:"kilometers"})*1e3,m.properties.length_meters=Ht(m,{units:"kilometers"})*1e3,f.properties.waypoints=[],m.properties.waypoints=[];let k=g(d,v),R=!0,h=0;for(let p of d.properties.waypoints){let b=g(d,ye([p.lon,p.lat]));if(R)if(b<k)f.properties.waypoints.push(p);else{let w=p.snapped&&d.properties.waypoints[h-1].snapped;f.properties.waypoints.push({lon:v.geometry.coordinates[0],lat:v.geometry.coordinates[1],snapped:w}),R=!1,m.properties.waypoints.push({lon:v.geometry.coordinates[0],lat:v.geometry.coordinates[1],snapped:w}),m.properties.waypoints.push(p)}else m.properties.waypoints.push(p);h++}}function g(d,f){let m=d.geometry.coordinates[0],v=ba(m,f,d);return Ht(v,{units:"kilometers"})*1e3}return n.$$set=d=>{"mode"in d&&t(0,o=d.mode),"changeMode"in d&&t(1,l=d.changeMode)},n.$$.update=()=>{if(n.$$.dirty&48){let d=$e();a&&d.features.push(a),r.getSource(Sn).setData(d)}},[o,l,Ji,s,a,r]}class ka extends oe{constructor(e){super(),le(this,e,wa,va,ie,{mode:0,changeMode:1,start:2,stop:3})}get start(){return Ji}get stop(){return this.$$.ctx[3]}}function _i(n){let e,t,r={mode:n[3],routeSnapper:n[1],snapTool:n[2],pointTool:n[10],polygonTool:n[11]};return e=new Hs({props:r}),n[16](e),{c(){K(e.$$.fragment)},m(i,o){$(e,i,o),t=!0},p(i,o){const l={};o&8&&(l.mode=i[3]),o&2&&(l.routeSnapper=i[1]),o&4&&(l.snapTool=i[2]),e.$set(l)},i(i){t||(B(e.$$.fragment,i),t=!0)},o(i){G(e.$$.fragment,i),t=!1},d(i){n[16](null),ee(e,i)}}}function Sa(n){let e,t,r,i,o,l,s,a,u,c,g,d,f,m,v,k,R,h,p,b,w,_,N,M,F,E,C,Y,I,A,z,J,ne,Z,te,se,re,y,U,Fe,Lt,Xt,mn={mode:n[3],changeMode:n[12]};s=new Us({props:mn}),n[14](s);let me=n[1]&&n[2]&&_i(n),D={mode:n[3],changeMode:n[12],pointTool:n[10]};b=new ua({props:D}),n[18](b);let Ui={mode:n[3],changeMode:n[12],polygonTool:n[11]};C=new da({props:Ui}),n[20](C);function ji(W){n[22](W)}function Wi(W){n[23](W)}let gn={mode:n[3],changeMode:n[12],url:n[0]};n[1]!==void 0&&(gn.routeSnapper=n[1]),n[2]!==void 0&&(gn.snapTool=n[2]),A=new la({props:gn}),n[21](A),ue.push(()=>Be(A,"routeSnapper",ji,n[1])),ue.push(()=>Be(A,"snapTool",Wi,n[2]));let Hi={mode:n[3],changeMode:n[12]};return U=new ka({props:Hi}),n[25](U),{c(){e=L("div"),t=L("div"),r=L("button"),i=H("Edit attributes"),l=q(),K(s.$$.fragment),a=q(),u=L("div"),c=L("button"),g=H("Edit geometry"),f=q(),me&&me.c(),m=q(),v=L("div"),k=L("button"),R=H("New point"),p=q(),K(b.$$.fragment),w=q(),_=L("div"),N=L("button"),M=H("New polygon"),E=q(),K(C.$$.fragment),Y=q(),I=L("div"),K(A.$$.fragment),ne=q(),Z=L("div"),te=L("button"),se=H("Split route"),y=q(),K(U.$$.fragment),O(r,"type","button"),r.disabled=o=n[3]=="edit-attribute",O(r,"class","svelte-cej5os"),O(c,"type","button"),c.disabled=d=n[3]=="edit-geometry",O(c,"class","svelte-cej5os"),O(k,"type","button"),k.disabled=h=n[3]=="point",O(k,"class","svelte-cej5os"),O(N,"type","button"),N.disabled=F=n[3]=="polygon",O(N,"class","svelte-cej5os"),O(te,"type","button"),te.disabled=re=n[3]=="split-route",O(te,"class","svelte-cej5os"),O(e,"class","toolbox svelte-cej5os")},m(W,ve){P(W,e,ve),S(e,t),S(t,r),S(r,i),S(t,l),$(s,t,null),S(e,a),S(e,u),S(u,c),S(c,g),S(u,f),me&&me.m(u,null),S(e,m),S(e,v),S(v,k),S(k,R),S(v,p),$(b,v,null),S(e,w),S(e,_),S(_,N),S(N,M),S(_,E),$(C,_,null),S(e,Y),S(e,I),$(A,I,null),S(e,ne),S(e,Z),S(Z,te),S(te,se),S(Z,y),$(U,Z,null),Fe=!0,Lt||(Xt=[X(r,"click",n[13]),X(c,"click",n[15]),X(k,"click",n[17]),X(N,"click",n[19]),X(te,"click",n[24])],Lt=!0)},p(W,[ve]){(!Fe||ve&8&&o!==(o=W[3]=="edit-attribute"))&&(r.disabled=o);const ir={};ve&8&&(ir.mode=W[3]),s.$set(ir),(!Fe||ve&8&&d!==(d=W[3]=="edit-geometry"))&&(c.disabled=d),W[1]&&W[2]?me?(me.p(W,ve),ve&6&&B(me,1)):(me=_i(W),me.c(),B(me,1),me.m(u,null)):me&&(Ee(),G(me,1,1,()=>{me=null}),Me()),(!Fe||ve&8&&h!==(h=W[3]=="point"))&&(k.disabled=h);const or={};ve&8&&(or.mode=W[3]),b.$set(or),(!Fe||ve&8&&F!==(F=W[3]=="polygon"))&&(N.disabled=F);const lr={};ve&8&&(lr.mode=W[3]),C.$set(lr);const Tt={};ve&8&&(Tt.mode=W[3]),ve&1&&(Tt.url=W[0]),!z&&ve&2&&(z=!0,Tt.routeSnapper=W[1],qe(()=>z=!1)),!J&&ve&4&&(J=!0,Tt.snapTool=W[2],qe(()=>J=!1)),A.$set(Tt),(!Fe||ve&8&&re!==(re=W[3]=="split-route"))&&(te.disabled=re);const sr={};ve&8&&(sr.mode=W[3]),U.$set(sr)},i(W){Fe||(B(s.$$.fragment,W),B(me),B(b.$$.fragment,W),B(C.$$.fragment,W),B(A.$$.fragment,W),B(U.$$.fragment,W),Fe=!0)},o(W){G(s.$$.fragment,W),G(me),G(b.$$.fragment,W),G(C.$$.fragment,W),G(A.$$.fragment,W),G(U.$$.fragment,W),Fe=!1},d(W){W&&x(e),n[14](null),ee(s),me&&me.d(),n[18](null),ee(b),n[20](null),ee(C),n[21](null),ee(A),n[25](null),ee(U),Lt=!1,He(Xt)}}}function Ea(n,e,t){let r;fe(n,Ve,A=>t(26,r=A));let{routeUrl:i}=e,o,l,s=new Ts(r),a=new Ys(r),u="edit-attribute",c,g,d,f,m,v;function k(A){let z={"edit-attribute":c,"edit-geometry":g,route:d,point:f,polygon:m,"split-route":v};if(u==A){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),z[u].stop(),t(3,u=A),console.log(`Starting new mode ${u}`),z[u].start()}Jn(()=>{s==null||s.tearDown(),a==null||a.tearDown()});const R=()=>k("edit-attribute");function h(A){ue[A?"unshift":"push"](()=>{c=A,t(4,c)})}const p=()=>k("edit-geometry");function b(A){ue[A?"unshift":"push"](()=>{g=A,t(5,g)})}const w=()=>k("point");function _(A){ue[A?"unshift":"push"](()=>{f=A,t(7,f)})}const N=()=>k("polygon");function M(A){ue[A?"unshift":"push"](()=>{m=A,t(8,m)})}function F(A){ue[A?"unshift":"push"](()=>{d=A,t(6,d)})}function E(A){o=A,t(1,o)}function C(A){l=A,t(2,l)}const Y=()=>k("split-route");function I(A){ue[A?"unshift":"push"](()=>{v=A,t(9,v)})}return n.$$set=A=>{"routeUrl"in A&&t(0,i=A.routeUrl)},[i,o,l,u,c,g,d,f,m,v,s,a,k,R,h,p,b,w,_,N,M,F,E,C,Y,I]}class Ma extends oe{constructor(e){super(),le(this,e,Ea,Sa,ie,{routeUrl:0})}}function Pa(n){let e,t,r,i,o,l,s,a;return{c(){e=L("div"),t=L("button"),t.textContent="Home",r=q(),i=L("button"),i.textContent="About",o=q(),l=L("button"),l.textContent="Instructions",O(t,"type","button"),O(i,"type","button"),O(l,"type","button"),O(e,"slot","nav")},m(u,c){P(u,e,c),S(e,t),S(e,r),S(e,i),S(e,o),S(e,l),s||(a=[X(t,"click",n[8]),X(i,"click",n[6]),X(l,"click",n[7])],s=!0)},p:Q,d(u){u&&x(e),s=!1,He(a)}}}function xa(n){let e,t,r,i,o,l,s,a,u,c,g,d;return o=new _s({props:{boundaryGeojson:n[3]}}),s=new ms({props:{authorityName:n[4]}}),g=new ns({}),{c(){e=L("div"),t=L("h1"),r=H(n[4]),i=q(),K(o.$$.fragment),l=q(),K(s.$$.fragment),a=q(),u=L("br"),c=q(),K(g.$$.fragment),O(e,"slot","sidebar")},m(f,m){P(f,e,m),S(e,t),S(t,r),S(t,i),$(o,t,null),S(e,l),$(s,e,null),S(e,a),S(e,u),S(e,c),$(g,e,null),d=!0},p(f,m){const v={};m&8&&(v.boundaryGeojson=f[3]),o.$set(v)},i(f){d||(B(o.$$.fragment,f),B(s.$$.fragment,f),B(g.$$.fragment,f),d=!0)},o(f){G(o.$$.fragment,f),G(s.$$.fragment,f),G(g.$$.fragment,f),d=!1},d(f){f&&x(e),ee(o),ee(s),ee(g)}}}function La(n){let e,t,r,i,o,l,s,a,u,c,g,d;return e=new al({props:{boundaryGeojson:n[3]}}),r=new Ps({}),o=new Ls({}),s=new Ma({props:{routeUrl:n[2]}}),u=new ks({props:{style:n[5]}}),g=new Es({}),{c(){K(e.$$.fragment),t=q(),K(r.$$.fragment),i=q(),K(o.$$.fragment),l=q(),K(s.$$.fragment),a=q(),K(u.$$.fragment),c=q(),K(g.$$.fragment)},m(f,m){$(e,f,m),P(f,t,m),$(r,f,m),P(f,i,m),$(o,f,m),P(f,l,m),$(s,f,m),P(f,a,m),$(u,f,m),P(f,c,m),$(g,f,m),d=!0},p(f,m){const v={};m&8&&(v.boundaryGeojson=f[3]),e.$set(v);const k={};m&4&&(k.routeUrl=f[2]),s.$set(k)},i(f){d||(B(e.$$.fragment,f),B(r.$$.fragment,f),B(o.$$.fragment,f),B(s.$$.fragment,f),B(u.$$.fragment,f),B(g.$$.fragment,f),d=!0)},o(f){G(e.$$.fragment,f),G(r.$$.fragment,f),G(o.$$.fragment,f),G(s.$$.fragment,f),G(u.$$.fragment,f),G(g.$$.fragment,f),d=!1},d(f){ee(e,f),f&&x(t),ee(r,f),f&&x(i),ee(o,f),f&&x(l),ee(s,f),f&&x(a),ee(u,f),f&&x(c),ee(g,f)}}}function Ta(n){let e,t,r;return t=new mo({props:{style:n[5],$$slots:{default:[La]},$$scope:{ctx:n}}}),{c(){e=L("div"),K(t.$$.fragment),O(e,"slot","main")},m(i,o){P(i,e,o),$(t,e,null),r=!0},p(i,o){const l={};o&16396&&(l.$$scope={dirty:o,ctx:i}),t.$set(l)},i(i){r||(B(t.$$.fragment,i),r=!0)},o(i){G(t.$$.fragment,i),r=!1},d(i){i&&x(e),ee(t)}}}function Ca(n){let e,t,r,i,o,l,s,a;e=new wo({props:{$$slots:{main:[Ta],sidebar:[xa],nav:[Pa]},$$scope:{ctx:n}}});function u(f){n[9](f)}let c={};n[0]!==void 0&&(c.open=n[0]),r=new oo({props:c}),ue.push(()=>Be(r,"open",u,n[0]));function g(f){n[10](f)}let d={};return n[1]!==void 0&&(d.open=n[1]),l=new fo({props:d}),ue.push(()=>Be(l,"open",g,n[1])),{c(){K(e.$$.fragment),t=q(),K(r.$$.fragment),o=q(),K(l.$$.fragment)},m(f,m){$(e,f,m),P(f,t,m),$(r,f,m),P(f,o,m),$(l,f,m),a=!0},p(f,[m]){const v={};m&16396&&(v.$$scope={dirty:m,ctx:f}),e.$set(v);const k={};!i&&m&1&&(i=!0,k.open=f[0],qe(()=>i=!1)),r.$set(k);const R={};!s&&m&2&&(s=!0,R.open=f[1],qe(()=>s=!1)),l.$set(R)},i(f){a||(B(e.$$.fragment,f),B(r.$$.fragment,f),B(l.$$.fragment,f),a=!0)},o(f){G(e.$$.fragment,f),G(r.$$.fragment,f),G(l.$$.fragment,f),a=!1},d(f){ee(e,f),f&&x(t),ee(r,f),f&&x(o),ee(l,f)}}}function Ra(n,e,t){let r=!1,i=!1,o=window.location.hostname.includes("atip.uk");const l=new URLSearchParams(window.location.search);let s=l.get("authority"),a=l.get("style")||"streets";var u=`https://atip.uk/route-snappers/${s}.bin`;o||(u=`https://atip.uk/route-snappers-dev/${s}.bin`);function c(){t(0,r=!r),t(1,i=!1)}function g(){t(1,i=!i),t(0,r=!1)}let d;un(async()=>{t(3,d=await f())});async function f(){const h=await(await fetch(lo)).text(),p=JSON.parse(h);return p.features=p.features.filter(b=>b.properties.name==s),p}const m=()=>window.open("index.html");function v(R){r=R,t(0,r)}function k(R){i=R,t(1,i)}return[r,i,u,d,s,a,c,g,m,v,k]}class Aa extends oe{constructor(e){super(),le(this,e,Ra,Ca,ie,{})}}new Aa({target:document.getElementById("app")});
