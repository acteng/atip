import{S as J,i as Q,s as Y,F as ie,g as v,d as C,m as D,j as h,t as b,n as w,o as k,p as y,E as ae,e as B,h as R,v as G,w as H,aG as be,b as A,c as F,l as q,u as X,ay as we,a as he,k as T,ar as ke,q as ge,B as ve,r as de,a5 as De,b7 as ye,f as $e,aM as ce,L as Ce,a2 as Se,a3 as Ie,M as Me,y as Ee,H as se}from"./index-502a69ed.js";import{D as Le}from"./DefaultButton-0eed91b9.js";import{C as Re,h as Te,S as pe,i as Be,G as Pe,B as Ae}from"./LineLayer-e3964c18.js";import{T as _e,W as je}from"./WarningButton-9328bf9f.js";import{S as Fe,L as qe}from"./StreetViewController-40a45cb1.js";const Ve=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function We(r){let e,n,t,l,o,s;return e=new ae({props:{errorMessage:r[1]}}),{c(){v(e.$$.fragment),n=C(),t=B("input"),R(t,"type","text"),R(t,"class","govuk-input"),R(t,"id","locationDescription")},m(i,a){D(e,i,a),h(i,n,a),h(i,t,a),G(t,r[0]),l=!0,o||(s=[H(t,"input",r[5]),H(t,"change",r[3])],o=!0)},p(i,a){const f={};a&2&&(f.errorMessage=i[1]),e.$set(f),a&1&&t.value!==i[0]&&G(t,i[0])},i(i){l||(b(e.$$.fragment,i),l=!0)},o(i){w(e.$$.fragment,i),l=!1},d(i){i&&(k(n),k(t)),y(e,i),o=!1,be(s)}}}function Ge(r){let e;return{c(){e=X("Lookup location description automatically")},m(n,t){h(n,e,t)},d(n){n&&k(e)}}}function He(r){let e,n,t;function l(s){r[6](s)}let o={id:"lookupLocation",$$slots:{default:[Ge]},$$scope:{ctx:r}};return r[2]!==void 0&&(o.checked=r[2]),e=new Te({props:o}),A.push(()=>F(e,"checked",l)),{c(){v(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,i){const a={};i&256&&(a.$$scope={dirty:i,ctx:s}),!n&&i&4&&(n=!0,a.checked=s[2],q(()=>n=!1)),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){y(e,s)}}}function Oe(r){let e,n,t,l;return e=new ie({props:{label:"Describe this location",id:"locationDescription",$$slots:{default:[We]},$$scope:{ctx:r}}}),t=new Re({props:{small:!0,$$slots:{default:[He]},$$scope:{ctx:r}}}),{c(){v(e.$$.fragment),n=C(),v(t.$$.fragment)},m(o,s){D(e,o,s),h(o,n,s),D(t,o,s),l=!0},p(o,[s]){const i={};s&259&&(i.$$scope={dirty:s,ctx:o}),e.$set(i);const a={};s&260&&(a.$$scope={dirty:s,ctx:o}),t.$set(a)},i(o){l||(b(e.$$.fragment,o),b(t.$$.fragment,o),l=!0)},o(o){w(e.$$.fragment,o),w(t.$$.fragment,o),l=!1},d(o){o&&k(n),y(e,o),y(t,o)}}}function Ke(r,e,n){let{locationDescription:t}=e,{locationDescriptionError:l}=e,{pt:o}=e,s=!0;async function i(p){if(!s)return;let _=`https://nominatim.openstreetmap.org/reverse?lat=${p.lat}&lon=${p.lng}&format=json`;try{n(0,t="Loading...");let m=await(await fetch(_)).json();n(0,t=m.address.road??m.display_name)}catch(c){console.log(`Location lookup failed: ${c}`)}}function a(){n(2,s=!1)}function f(){t=this.value,n(0,t)}function $(p){s=p,n(2,s)}return r.$$set=p=>{"locationDescription"in p&&n(0,t=p.locationDescription),"locationDescriptionError"in p&&n(1,l=p.locationDescriptionError),"pt"in p&&n(4,o=p.pt)},r.$$.update=()=>{r.$$.dirty&16&&i(o)},[t,l,s,a,o,f,$]}class Ne extends J{constructor(e){super(),Q(this,e,Ke,Oe,Y,{locationDescription:0,locationDescriptionError:1,pt:4})}}function Ue(r){let e,n,t,l,o,s;return e=new ae({props:{errorMessage:r[7]}}),{c(){v(e.$$.fragment),n=C(),t=B("input"),R(t,"type","text"),R(t,"class","govuk-input"),R(t,"id","inspector")},m(i,a){D(e,i,a),h(i,n,a),h(i,t,a),G(t,r[1]),l=!0,o||(s=H(t,"input",r[18]),o=!0)},p(i,a){const f={};a&128&&(f.errorMessage=i[7]),e.$set(f),a&2&&t.value!==i[1]&&G(t,i[1])},i(i){l||(b(e.$$.fragment,i),l=!0)},o(i){w(e.$$.fragment,i),l=!1},d(i){i&&(k(n),k(t)),y(e,i),o=!1,s()}}}function ze(r){let e,n,t,l,o,s,i,a;return t=new ae({props:{errorMessage:r[8]}}),{c(){e=B("div"),e.textContent="Example: ATF2_WLT_01",n=C(),v(t.$$.fragment),l=C(),o=B("input"),R(e,"class","govuk-hint"),R(o,"type","text"),R(o,"class","govuk-input"),R(o,"id","schemeReference")},m(f,$){h(f,e,$),h(f,n,$),D(t,f,$),h(f,l,$),h(f,o,$),G(o,r[2]),s=!0,i||(a=H(o,"input",r[19]),i=!0)},p(f,$){const p={};$&256&&(p.errorMessage=f[8]),t.$set(p),$&4&&o.value!==f[2]&&G(o,f[2])},i(f){s||(b(t.$$.fragment,f),s=!0)},o(f){w(t.$$.fragment,f),s=!1},d(f){f&&(k(e),k(n),k(l),k(o)),y(t,f),i=!1,a()}}}function Je(r){let e;return{c(){e=X("Export")},m(n,t){h(n,e,t)},d(n){n&&k(e)}}}function Qe(r){let e;return{c(){e=X("Keep editing this issue")},m(n,t){h(n,e,t)},d(n){n&&k(e)}}}function Ye(r){let e;return{c(){e=X("Done! Enter a new critical")},m(n,t){h(n,e,t)},d(n){n&&k(e)}}}function Xe(r){let e,n,t,l,o,s,i,a,f,$,p,_;return s=new _e({props:{label:"The new row has already been copied to your clipboard. If it didn't work, copy from below",value:r[14]}}),f=new he({props:{$$slots:{default:[Qe]},$$scope:{ctx:r}}}),f.$on("click",r[24]),p=new je({props:{$$slots:{default:[Ye]},$$scope:{ctx:r}}}),p.$on("click",et),{c(){e=B("div"),n=B("p"),n.innerHTML=`Edit <i>Inspectors Log.xlsx</i>
      , add a new row at the bottom of
      <i>Form Input</i>
      , and press
      <i>Control+V</i>
      to paste.`,t=C(),l=B("p"),l.innerHTML="<b>You have to manually fill out the first ID column!</b>",o=C(),v(s.$$.fragment),i=C(),a=B("div"),v(f.$$.fragment),$=C(),v(p.$$.fragment),R(a,"class","govuk-button-group"),R(e,"class","govuk-prose")},m(c,m){h(c,e,m),T(e,n),T(e,t),T(e,l),T(e,o),D(s,e,null),T(e,i),T(e,a),D(f,a,null),T(a,$),D(p,a,null),_=!0},p(c,m){const I={};m&16384&&(I.value=c[14]),s.$set(I);const S={};m&134217728&&(S.$$scope={dirty:m,ctx:c}),f.$set(S);const M={};m&134217728&&(M.$$scope={dirty:m,ctx:c}),p.$set(M)},i(c){_||(b(s.$$.fragment,c),b(f.$$.fragment,c),b(p.$$.fragment,c),_=!0)},o(c){w(s.$$.fragment,c),w(f.$$.fragment,c),w(p.$$.fragment,c),_=!1},d(c){c&&k(e),y(s),y(f),y(p)}}}function Ze(r){let e,n,t,l,o,s,i,a,f,$,p,_,c,m,I,S,M,j,g,E,P;e=new ie({props:{label:"Inspector name",id:"inspector",$$slots:{default:[Ue]},$$scope:{ctx:r}}}),t=new ie({props:{label:"Scheme reference",id:"schemeReference",$$slots:{default:[ze]},$$scope:{ctx:r}}});function W(u){r[20](u)}let V={label:"Current design stage",id:"currentDesignStage",choices:r[15],emptyOption:!0,errorMessage:r[9]};r[3]!==void 0&&(V.value=r[3]),o=new pe({props:V}),A.push(()=>F(o,"value",W));function Z(u){r[21](u)}let O={pt:r[0],locationDescriptionError:r[11]};r[5]!==void 0&&(O.locationDescription=r[5]),a=new Ne({props:O}),A.push(()=>F(a,"locationDescription",Z));function x(u){r[22](u)}let K={label:"Critical issue type",id:"criticalIssueType",choices:r[16],emptyOption:!0,errorMessage:r[10]};r[4]!==void 0&&(K.value=r[4]),p=new pe({props:K}),A.push(()=>F(p,"value",x));function ee(u){r[23](u)}let N={label:"Comments or notes",errorMessage:r[12]};r[6]!==void 0&&(N.value=r[6]),m=new _e({props:N}),A.push(()=>F(m,"value",ee)),M=new Le({props:{$$slots:{default:[Je]},$$scope:{ctx:r}}}),M.$on("click",r[17]);function L(u){r[25](u)}let U={title:"Almost done!",displayEscapeButton:!1,canCloseByClickingBackground:!1,$$slots:{default:[Xe]},$$scope:{ctx:r}};return r[13]!==void 0&&(U.open=r[13]),g=new we({props:U}),A.push(()=>F(g,"open",L)),{c(){v(e.$$.fragment),n=C(),v(t.$$.fragment),l=C(),v(o.$$.fragment),i=C(),v(a.$$.fragment),$=C(),v(p.$$.fragment),c=C(),v(m.$$.fragment),S=C(),v(M.$$.fragment),j=C(),v(g.$$.fragment)},m(u,d){D(e,u,d),h(u,n,d),D(t,u,d),h(u,l,d),D(o,u,d),h(u,i,d),D(a,u,d),h(u,$,d),D(p,u,d),h(u,c,d),D(m,u,d),h(u,S,d),D(M,u,d),h(u,j,d),D(g,u,d),P=!0},p(u,[d]){const le={};d&134217858&&(le.$$scope={dirty:d,ctx:u}),e.$set(le);const ue={};d&134217988&&(ue.$$scope={dirty:d,ctx:u}),t.$set(ue);const te={};d&512&&(te.errorMessage=u[9]),!s&&d&8&&(s=!0,te.value=u[3],q(()=>s=!1)),o.$set(te);const z={};d&1&&(z.pt=u[0]),d&2048&&(z.locationDescriptionError=u[11]),!f&&d&32&&(f=!0,z.locationDescription=u[5],q(()=>f=!1)),a.$set(z);const ne={};d&1024&&(ne.errorMessage=u[10]),!_&&d&16&&(_=!0,ne.value=u[4],q(()=>_=!1)),p.$set(ne);const re={};d&4096&&(re.errorMessage=u[12]),!I&&d&64&&(I=!0,re.value=u[6],q(()=>I=!1)),m.$set(re);const fe={};d&134217728&&(fe.$$scope={dirty:d,ctx:u}),M.$set(fe);const oe={};d&134242304&&(oe.$$scope={dirty:d,ctx:u}),!E&&d&8192&&(E=!0,oe.open=u[13],q(()=>E=!1)),g.$set(oe)},i(u){P||(b(e.$$.fragment,u),b(t.$$.fragment,u),b(o.$$.fragment,u),b(a.$$.fragment,u),b(p.$$.fragment,u),b(m.$$.fragment,u),b(M.$$.fragment,u),b(g.$$.fragment,u),P=!0)},o(u){w(e.$$.fragment,u),w(t.$$.fragment,u),w(o.$$.fragment,u),w(a.$$.fragment,u),w(p.$$.fragment,u),w(m.$$.fragment,u),w(M.$$.fragment,u),w(g.$$.fragment,u),P=!1},d(u){u&&(k(n),k(l),k(i),k($),k(c),k(S),k(j)),y(e,u),y(t,u),y(o,u),y(a,u),y(p,u),y(m,u),y(M,u),y(g,u)}}}function me(r){return r.map(e=>[e,e])}function xe(r){let e=25569,t=24*(60*60*1e3);return r.getTime()/t+e}function et(){location.reload()}function tt(r,e,n){let{pt:t}=e,l=window.localStorage.getItem("inspector")??"",o=window.localStorage.getItem("schemeReference")??"",s=window.localStorage.getItem("currentDesignStage")??"",i="",a="",f="",$="",p="",_="",c="",m="",I="",S=!1,M="",j=me(["Baseline","Feasibility Design","Preliminary Design","Outline Design","Detailed Design","Inspection"]),g=me(["1 - Conflict at Side Roads","2 - Conflict at Major Junctions / Roundabouts","3 - Collision Alongside or from Behind","4 - Trip Hazard","5 - Kerbside Activity","6A - Risk of Crossing Conflict (Busy Roads)","6B - Risk of Crossing Conflict (Quieter Roads)","7A - Standard of Crossing Facility (Busy Roads)","7B - Standard of Crossing Facility (Junction)","8 - Traffic Speed (>37mph)","9A - Traffic Volume (>10,000vpd)","9B - Traffic Volume (>5% HGVs)","10 - Crossing Speed","11A - Footway Width (Absolute Minimum <1m)","11B - Footway Width (at Pinchpoints)","11C - Footway Width - Poor Pedestrian Comfort","12 - Tram - Insufficient width next to Tram Track","13 - Tram/Rail - Poor Crossing Angle","14 - Major Cycle Surface Defect","15 - Major Pedestrian Surface Defect","16 - Inappropriate Shared Use","17 - Barriers, Steps and/or Dismount signs","18 - Route isn't direct, logical or intuitive to all users","19 - Inappropriate Surface Materials","20 - Inappropriate Lighting","21 - Routes must join other facilities as a network"]);function E(){let L=0,U=xe(new Date);return[L,l,U,o,s,i,ke(t.toArray().reverse()).join(", "),a,f].join("	")}function P(){n(7,$=l?"":"Required"),n(8,p=o?"":"Required"),n(9,_=s?"":"Required"),n(10,c=i?"":"Required"),n(11,m=a?"":"Required"),n(12,I=f?"":"Required"),!($||p||_||c||m||I)&&(n(14,M=E()),navigator.clipboard.writeText(M),n(13,S=!0))}function W(){l=this.value,n(1,l)}function V(){o=this.value,n(2,o)}function Z(L){s=L,n(3,s)}function O(L){a=L,n(5,a)}function x(L){i=L,n(4,i)}function K(L){f=L,n(6,f)}const ee=()=>n(13,S=!1);function N(L){S=L,n(13,S)}return r.$$set=L=>{"pt"in L&&n(0,t=L.pt)},r.$$.update=()=>{r.$$.dirty&2&&window.localStorage.setItem("inspector",l),r.$$.dirty&4&&window.localStorage.setItem("schemeReference",o),r.$$.dirty&8&&window.localStorage.setItem("currentDesignStage",s)},[t,l,o,s,i,a,f,$,p,_,c,m,I,S,M,j,g,P,W,V,Z,O,x,K,ee,N]}class nt extends J{constructor(e){super(),Q(this,e,tt,Ze,Y,{pt:0})}}function rt(r,e,n){let t;ge(r,ve,a=>n(3,t=a));let{enableAdding:l}=e,o=null,{markerPosition:s=null}=e;de(()=>{t.on("click",i),t.getCanvas().style.cursor="crosshair"}),De(()=>{o&&o.remove(),t.off("click",i)});function i(a){o||!l||(t.getCanvas().style.cursor="inherit",o=new ye.Marker({draggable:!0}).setLngLat(a.lngLat).addTo(t),n(0,s=o.getLngLat()),o.on("dragstart",()=>{t.getCanvas().style.cursor="grabbing"}),o.on("dragend",()=>{t.getCanvas().style.cursor="inherit",n(0,s=o.getLngLat())}))}return r.$$set=a=>{"enableAdding"in a&&n(1,l=a.enableAdding),"markerPosition"in a&&n(0,s=a.markerPosition)},[s,l]}class ot extends J{constructor(e){super(),Q(this,e,rt,null,Y,{enableAdding:1,markerPosition:0})}}const{window:st}=Ve;function it(r){let e;return{c(){e=B("p"),e.textContent="Click the map to add a critical"},m(n,t){h(n,e,t)},p:se,i:se,o:se,d(n){n&&k(e)}}}function at(r){let e,n;return e=new nt({props:{pt:r[0]}}),{c(){v(e.$$.fragment)},m(t,l){D(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.pt=t[0]),e.$set(o)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){y(e,t)}}}function lt(r){let e,n,t,l,o,s,i,a,f,$;s=new Ce({});const p=[at,it],_=[];function c(m,I){return m[0]?0:1}return a=c(r),f=_[a]=p[a](r),{c(){e=B("div"),n=B("h1"),n.textContent="Critical issue entry",t=C(),l=B("p"),l.textContent=`App version: ${$e()}`,o=C(),v(s.$$.fragment),i=C(),f.c(),R(e,"slot","sidebar"),R(e,"class","govuk-prose")},m(m,I){h(m,e,I),T(e,n),T(e,t),T(e,l),T(e,o),D(s,e,null),T(e,i),_[a].m(e,null),$=!0},p(m,I){let S=a;a=c(m),a===S?_[a].p(m,I):(Se(),w(_[S],1,1,()=>{_[S]=null}),Ie(),f=_[a],f?f.p(m,I):(f=_[a]=p[a](m),f.c()),b(f,1),f.m(e,null))},i(m){$||(b(s.$$.fragment,m),b(f),$=!0)},o(m){w(s.$$.fragment,m),w(f),$=!1},d(m){m&&k(e),y(s),_[a].d()}}}function ut(r){let e,n,t,l,o,s,i,a,f,$,p,_,c,m;e=new Pe({});function I(g){r[5](g)}let S={enableAdding:r[1]};r[0]!==void 0&&(S.markerPosition=r[0]),t=new ot({props:S}),A.push(()=>F(t,"markerPosition",I)),i=new Ae({props:{disabled:!r[1]}});function M(g){r[7](g)}let j={displayEnableButton:!0};return r[1]!==void 0&&(j.isInactive=r[1]),f=new Fe({props:j}),r[6](f),A.push(()=>F(f,"isInactive",M)),c=new qe({}),{c(){v(e.$$.fragment),n=C(),v(t.$$.fragment),o=C(),s=B("div"),v(i.$$.fragment),a=C(),v(f.$$.fragment),p=C(),_=B("div"),v(c.$$.fragment),R(s,"class","top-right svelte-nlvvhu")},m(g,E){D(e,g,E),h(g,n,E),D(t,g,E),h(g,o,E),h(g,s,E),D(i,s,null),T(s,a),D(f,s,null),T(s,p),T(s,_),D(c,_,null),m=!0},p(g,E){const P={};E&2&&(P.enableAdding=g[1]),!l&&E&1&&(l=!0,P.markerPosition=g[0],q(()=>l=!1)),t.$set(P);const W={};E&2&&(W.disabled=!g[1]),i.$set(W);const V={};!$&&E&2&&($=!0,V.isInactive=g[1],q(()=>$=!1)),f.$set(V)},i(g){m||(b(e.$$.fragment,g),b(t.$$.fragment,g),b(i.$$.fragment,g),b(f.$$.fragment,g),b(c.$$.fragment,g),m=!0)},o(g){w(e.$$.fragment,g),w(t.$$.fragment,g),w(i.$$.fragment,g),w(f.$$.fragment,g),w(c.$$.fragment,g),m=!1},d(g){g&&(k(n),k(o),k(s)),y(e,g),y(t,g),y(i),r[6](null),y(f),y(c)}}}function ft(r){let e,n,t;return n=new Me({props:{style:r[3],startBounds:[-5.96,49.89,2.31,55.94],$$slots:{default:[ut]},$$scope:{ctx:r}}}),{c(){e=B("div"),v(n.$$.fragment),R(e,"slot","main")},m(l,o){h(l,e,o),D(n,e,null),t=!0},p(l,o){const s={};o&8&&(s.style=l[3]),o&1031&&(s.$$scope={dirty:o,ctx:l}),n.$set(s)},i(l){t||(b(n.$$.fragment,l),t=!0)},o(l){w(n.$$.fragment,l),t=!1},d(l){l&&k(e),y(n)}}}function ct(r){let e,n,t,l;return e=new Be({props:{sidebarWidth:"35rem",$$slots:{main:[ft],sidebar:[lt]},$$scope:{ctx:r}}}),{c(){v(e.$$.fragment)},m(o,s){D(e,o,s),n=!0,t||(l=H(st,"keydown",r[4]),t=!0)},p(o,[s]){const i={};s&1039&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(o){n||(b(e.$$.fragment,o),n=!0)},o(o){w(e.$$.fragment,o),n=!1},d(o){y(e,o),t=!1,l()}}}function pt(r,e,n){let t;ge(r,ce,c=>n(3,t=c)),de(()=>{Ee()});const l=new URLSearchParams(window.location.search);let o=$e()=="Private (development)"?"Road":"dataviz";ce.set(l.get("style")||o);let s=null,i=!0,a;function f(c){!i&&c.key=="Escape"&&(a.disableStreetView(),c.preventDefault())}function $(c){s=c,n(0,s)}function p(c){A[c?"unshift":"push"](()=>{a=c,n(2,a)})}function _(c){i=c,n(1,i)}return[s,i,a,t,f,$,p,_]}class mt extends J{constructor(e){super(),Q(this,e,pt,ct,Y,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new mt({target:document.getElementById("app")});
