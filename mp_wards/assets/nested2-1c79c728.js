import{S as K,i as G,s as J,g as y,f as B,e as P,u as U,m as b,j as d,k as M,T as X,t as h,l as $,p as _,q as k,Z as ee,a1 as ue,r as Ee,b as te,c as ne,F as Et,o as re,a as we,h as R,v as Ge,w as At,M as be,C as ce,aV as Ae,a0 as lt,G as Pt,J as zt,K as Ot,L as Nt,aU as se,a6 as at,x as ft,D as ut,ay as Ft,aW as Je,af as ct,d as It,W as qe,y as ge,n as $e,z as jt,A as Vt,a8 as xt,aO as Zt,E as Ht,U as We,V as Rt,ac as Kt}from"./data_getter-32c0b909.js";import{C as Pe,S as Me,d as ze,j as Oe,H as Ne,h as Gt,i as Ye,g as mt,L as Jt,Z as qt,M as Wt,I as Yt,b as Qt,B as Xt}from"./Map-caa30ad9.js";function en(r){let e=new Map;for(let[n,t]of Object.entries(r.schemes))e.set(n,{scheme_reference:n,num_features:0,authority_or_region:t.authority_or_region,capital_scheme_id:t.capital_scheme_id,funding_programme:t.funding_programme});for(let n of r.features){let t=e.get(n.properties.scheme_reference);t.num_features++,n.properties.funding_programme=t.funding_programme}return e}function tn(r){let e;return{c(){e=U("Clear")},m(n,t){d(n,e,t)},d(n){n&&_(e)}}}function nn(r){let e,n,t,s,o,l;return t=new we({props:{$$slots:{default:[tn]},$$scope:{ctx:r}}}),t.$on("click",r[11]),{c(){e=P("input"),n=B(),y(t.$$.fragment),R(e,"type","text"),R(e,"class","govuk-input govuk-input--width-10"),R(e,"id","filterText")},m(u,i){d(u,e,i),Ge(e,r[0]),d(u,n,i),b(t,u,i),s=!0,o||(l=At(e,"input",r[10]),o=!0)},p(u,i){i&1&&e.value!==u[0]&&Ge(e,u[0]);const f={};i&16384&&(f.$$scope={dirty:i,ctx:u}),t.$set(f)},i(u){s||(h(t.$$.fragment,u),s=!0)},o(u){$(t.$$.fragment,u),s=!1},d(u){u&&(_(e),_(n)),k(t,u),o=!1,l()}}}function rn(r){let e,n,t,s,o,l,u,i;function f(m){r[8](m)}let a={label:"Authority or region",id:"filterAuthority",choices:r[4],emptyOption:!0};r[2]!==void 0&&(a.value=r[2]),e=new Me({props:a}),te.push(()=>ne(e,"value",f));function c(m){r[9](m)}let w={label:"Funding programme",id:"filterFundingProgramme",choices:r[5],emptyOption:!0};return r[3]!==void 0&&(w.value=r[3]),s=new Me({props:w}),te.push(()=>ne(s,"value",c)),u=new Et({props:{label:"Intervention name or description",id:"filterText",$$slots:{default:[nn]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment),l=B(),y(u.$$.fragment)},m(m,v){b(e,m,v),d(m,t,v),b(s,m,v),d(m,l,v),b(u,m,v),i=!0},p(m,v){const L={};v&16&&(L.choices=m[4]),!n&&v&4&&(n=!0,L.value=m[2],re(()=>n=!1)),e.$set(L);const D={};v&32&&(D.choices=m[5]),!o&&v&8&&(o=!0,D.value=m[3],re(()=>o=!1)),s.$set(D);const g={};v&16385&&(g.$$scope={dirty:v,ctx:m}),u.$set(g)},i(m){i||(h(e.$$.fragment,m),h(s.$$.fragment,m),h(u.$$.fragment,m),i=!0)},o(m){$(e.$$.fragment,m),$(s.$$.fragment,m),$(u.$$.fragment,m),i=!1},d(m){m&&(_(t),_(l)),k(e,m),k(s,m),k(u,m)}}}function sn(r){let e,n,t,s,o=r[1].size+"",l,u,i=r[6].route+"",f,a,c=r[6].area+"",w,m,v=r[6].crossing+"",L,D,g=r[6].other+"",p,S,E;return e=new Pe({props:{label:"Filters",$$slots:{default:[rn]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment),n=B(),t=P("p"),s=U("Showing "),l=U(o),u=U(" schemes ("),f=U(i),a=U(" routes, "),w=U(c),m=U(` areas,
  `),L=U(v),D=U(" crossings, "),p=U(g),S=U(" other)")},m(T,C){b(e,T,C),d(T,n,C),d(T,t,C),M(t,s),M(t,l),M(t,u),M(t,f),M(t,a),M(t,w),M(t,m),M(t,L),M(t,D),M(t,p),M(t,S),E=!0},p(T,[C]){const z={};C&16445&&(z.$$scope={dirty:C,ctx:T}),e.$set(z),(!E||C&2)&&o!==(o=T[1].size+"")&&X(l,o),(!E||C&64)&&i!==(i=T[6].route+"")&&X(f,i),(!E||C&64)&&c!==(c=T[6].area+"")&&X(w,c),(!E||C&64)&&v!==(v=T[6].crossing+"")&&X(L,v),(!E||C&64)&&g!==(g=T[6].other+"")&&X(p,g)},i(T){E||(h(e.$$.fragment,T),E=!0)},o(T){$(e.$$.fragment,T),E=!1},d(T){T&&(_(n),_(t)),k(e,T)}}}function on(r,e,n){let t;ee(r,ue,g=>n(12,t=g));let{schemes:s}=e,{schemesToBeShown:o=new Set}=e,{filterText:l=""}=e,u=[],i="",f=[],a="",c={area:0,route:0,crossing:0,other:0};Ee(()=>{let g=new Set,p=new Set;for(let S of s.values())S.authority_or_region&&g.add(S.authority_or_region),S.funding_programme&&p.add(S.funding_programme);n(4,u=Array.from(g.entries())),u.sort(),n(5,f=Array.from(p.entries())),f.sort()});function w(g,p,S){let E=g.toLowerCase(),T=z=>{var O,q;if(E&&!((O=z.properties.name)!=null&&O.toLowerCase().includes(E))&&!((q=z.properties.description)!=null&&q.toLowerCase().includes(E)))return!1;if(p||S){let N=s.get(z.properties.scheme_reference);if(p&&N.authority_or_region!=p||S&&N.funding_programme!=S)return!1}return!0};n(1,o=new Set(t.features.filter(T).map(z=>z.properties.scheme_reference))),n(6,c={area:0,route:0,crossing:0,other:0});let C=z=>{var O,q;return!(!o.has(z.properties.scheme_reference)||E&&!((O=z.properties.name)!=null&&O.toLowerCase().includes(E))&&!((q=z.properties.description)!=null&&q.toLowerCase().includes(E)))};ue.update(z=>{for(let O of z.features)C(O)?(delete O.properties.hide_while_editing,n(6,c[O.properties.intervention_type]++,c)):O.properties.hide_while_editing=!0;return z}),n(6,c)}function m(g){i=g,n(2,i)}function v(g){a=g,n(3,a)}function L(){l=this.value,n(0,l)}const D=()=>n(0,l="");return r.$$set=g=>{"schemes"in g&&n(7,s=g.schemes),"schemesToBeShown"in g&&n(1,o=g.schemesToBeShown),"filterText"in g&&n(0,l=g.filterText)},r.$$.update=()=>{r.$$.dirty&13&&w(l,i,a)},[l,o,i,a,u,f,c,s,m,v,L,D]}class ln extends K{constructor(e){super(),G(this,e,on,sn,J,{schemes:7,schemesToBeShown:1,filterText:0})}}const Q={schools:"#007DBB",hospitals:"#B73D25",mrn:"#006478",parliamentary_constituencies:"#006E59",atf2:"#00AFFF",atf3:"#FF62DC",atf4:"#FFD833"};function an(r){let e,n,t,s;return e=new Oe({props:{color:r[3]}}),{c(){y(e.$$.fragment),n=B(),t=U(r[1])},m(o,l){b(e,o,l),d(o,n,l),d(o,t,l),s=!0},p(o,l){(!s||l&2)&&X(t,o[1])},i(o){s||(h(e.$$.fragment,o),s=!0)},o(o){$(e.$$.fragment,o),s=!1},d(o){o&&(_(n),_(t)),k(e,o)}}}function fn(r){let e;const n=r[7].default,t=Pt(n,r,r[9],null);return{c(){t&&t.c()},m(s,o){t&&t.m(s,o),e=!0},p(s,o){t&&t.p&&(!e||o&512)&&zt(t,n,s,s[9],e?Nt(n,s[9],o,null):Ot(s[9]),null)},i(s){e||(h(t,s),e=!0)},o(s){$(t,s),e=!1},d(s){t&&t.d(s)}}}function un(r){let e,n,t;return n=new Ne({props:{$$slots:{default:[fn]},$$scope:{ctx:r}}}),{c(){e=P("span"),y(n.$$.fragment),R(e,"slot","right")},m(s,o){d(s,e,o),b(n,e,null),t=!0},p(s,o){const l={};o&512&&(l.$$scope={dirty:o,ctx:s}),n.$set(l)},i(s){t||(h(n.$$.fragment,s),t=!0)},o(s){$(n.$$.fragment,s),t=!1},d(s){s&&_(e),k(n)}}}function cn(r){let e,n,t,s,o;function l(i){r[8](i)}let u={id:r[0],$$slots:{right:[un],default:[an]},$$scope:{ctx:r}};return r[2]!==void 0&&(u.checked=r[2]),e=new ze({props:u}),te.push(()=>ne(e,"checked",l)),s=new be({props:{layers:[r[0]],contents:r[4]}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,f){b(e,i,f),d(i,t,f),b(s,i,f),o=!0},p(i,[f]){const a={};f&1&&(a.id=i[0]),f&514&&(a.$$scope={dirty:f,ctx:i}),!n&&f&4&&(n=!0,a.checked=i[2],re(()=>n=!1)),e.$set(a);const c={};f&1&&(c.layers=[i[0]]),s.$set(c)},i(i){o||(h(e.$$.fragment,i),h(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&_(t),k(e,i),k(s,i)}}}function mn(r,e,n){let t;ee(r,ce,m=>n(6,t=m));let{$$slots:s={},$$scope:o}=e,{name:l}=e,{singularNoun:u}=e,{pluralNoun:i}=e,f=Q[l];Ae(t,l,`https://atip.uk/layers/v1/${l}.pmtiles`),lt(t,{id:l,source:l,sourceLayer:l,color:f,opacity:.8});let a=!1;function c(m){return`<p>${m.name??`Unnamed ${u}`}</p>`}function w(m){a=m,n(2,a)}return r.$$set=m=>{"name"in m&&n(0,l=m.name),"singularNoun"in m&&n(5,u=m.singularNoun),"pluralNoun"in m&&n(1,i=m.pluralNoun),"$$scope"in m&&n(9,o=m.$$scope)},r.$$.update=()=>{r.$$.dirty&69&&t.getLayer(l)&&t.setLayoutProperty(l,"visibility",a?"visible":"none")},[l,i,a,f,c,u,t,s,w,o]}class pt extends K{constructor(e){super(),G(this,e,mn,cn,J,{name:0,singularNoun:5,pluralNoun:1})}}function pn(r){let e;return{c(){e=U("hospital")},m(n,t){d(n,e,t)},d(n){n&&_(e)}}}function hn(r){let e;return{c(){e=U("Open Data Commons Open Database License")},m(n,t){d(n,e,t)},d(n){n&&_(e)}}}function gn(r){let e,n,t,s,o,l,u,i,f;return t=new se({props:{href:"https://wiki.openstreetmap.org/wiki/Tag:amenity%3Dhospital",$$slots:{default:[pn]},$$scope:{ctx:r}}}),i=new se({props:{href:"https://www.openstreetmap.org/copyright",$$slots:{default:[hn]},$$scope:{ctx:r}}}),{c(){e=P("p"),n=U("This shows "),y(t.$$.fragment),s=U(` data from OpenStreetMap. It doesn't include outpatient clinics
    or individual doctor's offices.`),o=B(),l=P("p"),u=U("License: "),y(i.$$.fragment)},m(a,c){d(a,e,c),M(e,n),b(t,e,null),M(e,s),d(a,o,c),d(a,l,c),M(l,u),b(i,l,null),f=!0},p(a,c){const w={};c&1&&(w.$$scope={dirty:c,ctx:a}),t.$set(w);const m={};c&1&&(m.$$scope={dirty:c,ctx:a}),i.$set(m)},i(a){f||(h(t.$$.fragment,a),h(i.$$.fragment,a),f=!0)},o(a){$(t.$$.fragment,a),$(i.$$.fragment,a),f=!1},d(a){a&&(_(e),_(o),_(l)),k(t),k(i)}}}function $n(r){let e,n;return e=new pt({props:{name:"hospitals",singularNoun:"hospital",pluralNoun:"Hospitals",$$slots:{default:[gn]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),n=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}class dn extends K{constructor(e){super(),G(this,e,null,$n,J,{})}}function _n(r){let e,n,t;return e=new Oe({props:{color:r[1]}}),{c(){y(e.$$.fragment),n=U(`
  MRN`)},m(s,o){b(e,s,o),d(s,n,o),t=!0},p:ft,i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){s&&_(n),k(e,s)}}}function vn(r){let e;return{c(){e=U(`Major Road Network
        `)},m(n,t){d(n,e,t)},d(n){n&&_(e)}}}function wn(r){let e;return{c(){e=U("Open Government License")},m(n,t){d(n,e,t)},d(n){n&&_(e)}}}function yn(r){let e,n,t,s,o,l,u,i,f;return t=new se({props:{href:"https://maps.dft.gov.uk/major-road-network/index.html",$$slots:{default:[vn]},$$scope:{ctx:r}}}),i=new se({props:{href:"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/",$$slots:{default:[wn]},$$scope:{ctx:r}}}),{c(){e=P("p"),n=U("Data from the "),y(t.$$.fragment),s=U("."),o=B(),l=P("p"),u=U("License: "),y(i.$$.fragment)},m(a,c){d(a,e,c),M(e,n),b(t,e,null),M(e,s),d(a,o,c),d(a,l,c),M(l,u),b(i,l,null),f=!0},p(a,c){const w={};c&16&&(w.$$scope={dirty:c,ctx:a}),t.$set(w);const m={};c&16&&(m.$$scope={dirty:c,ctx:a}),i.$set(m)},i(a){f||(h(t.$$.fragment,a),h(i.$$.fragment,a),f=!0)},o(a){$(t.$$.fragment,a),$(i.$$.fragment,a),f=!1},d(a){a&&(_(e),_(o),_(l)),k(t),k(i)}}}function bn(r){let e,n,t;return n=new Ne({props:{$$slots:{default:[yn]},$$scope:{ctx:r}}}),{c(){e=P("span"),y(n.$$.fragment),R(e,"slot","right")},m(s,o){d(s,e,o),b(n,e,null),t=!0},p(s,o){const l={};o&16&&(l.$$scope={dirty:o,ctx:s}),n.$set(l)},i(s){t||(h(n.$$.fragment,s),t=!0)},o(s){$(n.$$.fragment,s),t=!1},d(s){s&&_(e),k(n)}}}function kn(r){let e,n,t,s,o;function l(i){r[3](i)}let u={id:Y,$$slots:{right:[bn],default:[_n]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.checked=r[0]),e=new ze({props:u}),te.push(()=>ne(e,"checked",l)),s=new be({props:{layers:[Y],contents:Ln}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,f){b(e,i,f),d(i,t,f),b(s,i,f),o=!0},p(i,[f]){const a={};f&16&&(a.$$scope={dirty:f,ctx:i}),!n&&f&1&&(n=!0,a.checked=i[0],re(()=>n=!1)),e.$set(a)},i(i){o||(h(e.$$.fragment,i),h(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&_(t),k(e,i),k(s,i)}}}let Y="mrn";function Ln(r){return`<p>${r.name??"Unknown MRN road"}</p>`}function Tn(r,e,n){let t;ee(r,ce,u=>n(2,t=u));let s=Q.mrn;Ae(t,Y,`https://atip.uk/layers/v1/${Y}.pmtiles`),at(t,{id:Y,source:Y,sourceLayer:Y,color:s,width:7});let o=!1;function l(u){o=u,n(0,o)}return r.$$.update=()=>{r.$$.dirty&5&&t.getLayer(Y)&&t.setLayoutProperty(Y,"visibility",o?"visible":"none")},[o,s,t,l]}class Dn extends K{constructor(e){super(),G(this,e,Tn,kn,J,{})}}function Sn(r){let e,n,t;return e=new Oe({props:{color:r[1]}}),{c(){y(e.$$.fragment),n=U(`
  Parliamentary constituencies`)},m(s,o){b(e,s,o),d(s,n,o),t=!0},p:ft,i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){$(e.$$.fragment,s),t=!1},d(s){s&&_(n),k(e,s)}}}function Un(r){let e;return{c(){e=U(`Ordnance Survey Boundary-Line
        `)},m(n,t){d(n,e,t)},d(n){n&&_(e)}}}function Mn(r){let e;return{c(){e=U("Open Government License")},m(n,t){d(n,e,t)},d(n){n&&_(e)}}}function Cn(r){let e,n,t,s,o,l,u,i,f;return t=new se({props:{href:"https://www.ordnancesurvey.co.uk/products/boundary-line",$$slots:{default:[Un]},$$scope:{ctx:r}}}),i=new se({props:{href:"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/",$$slots:{default:[Mn]},$$scope:{ctx:r}}}),{c(){e=P("p"),n=U("Data from "),y(t.$$.fragment),s=U("."),o=B(),l=P("p"),u=U("License: "),y(i.$$.fragment)},m(a,c){d(a,e,c),M(e,n),b(t,e,null),M(e,s),d(a,o,c),d(a,l,c),M(l,u),b(i,l,null),f=!0},p(a,c){const w={};c&16&&(w.$$scope={dirty:c,ctx:a}),t.$set(w);const m={};c&16&&(m.$$scope={dirty:c,ctx:a}),i.$set(m)},i(a){f||(h(t.$$.fragment,a),h(i.$$.fragment,a),f=!0)},o(a){$(t.$$.fragment,a),$(i.$$.fragment,a),f=!1},d(a){a&&(_(e),_(o),_(l)),k(t),k(i)}}}function Bn(r){let e,n,t;return n=new Ne({props:{$$slots:{default:[Cn]},$$scope:{ctx:r}}}),{c(){e=P("span"),y(n.$$.fragment),R(e,"slot","right")},m(s,o){d(s,e,o),b(n,e,null),t=!0},p(s,o){const l={};o&16&&(l.$$scope={dirty:o,ctx:s}),n.$set(l)},i(s){t||(h(n.$$.fragment,s),t=!0)},o(s){$(n.$$.fragment,s),t=!1},d(s){s&&_(e),k(n)}}}function En(r){let e,n,t,s,o;function l(i){r[3](i)}let u={id:V,$$slots:{right:[Bn],default:[Sn]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.checked=r[0]),e=new ze({props:u}),te.push(()=>ne(e,"checked",l)),s=new be({props:{layers:[V],contents:An}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,f){b(e,i,f),d(i,t,f),b(s,i,f),o=!0},p(i,[f]){const a={};f&16&&(a.$$scope={dirty:f,ctx:i}),!n&&f&1&&(n=!0,a.checked=i[0],re(()=>n=!1)),e.$set(a)},i(i){o||(h(e.$$.fragment,i),h(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&_(t),k(e,i),k(s,i)}}}let V="parliamentary_constituencies";function An(r){return`<p>${r.Name} (${r.Census_Code})</p>`}function Pn(r,e,n){let t;ee(r,ce,u=>n(2,t=u));let s=Q.parliamentary_constituencies;Ae(t,V,`https://atip.uk/layers/v1/${V}.pmtiles`),lt(t,{id:V,source:V,sourceLayer:V,color:s,opacity:.1}),at(t,{id:`${V}-outline`,source:V,sourceLayer:V,color:s,width:5});let o=!1;function l(u){o=u,n(0,o)}return r.$$.update=()=>{if(r.$$.dirty&5)for(let u of[V,`${V}-outline`])t.getLayer(u)&&t.setLayoutProperty(u,"visibility",o?"visible":"none")},[o,s,t,l]}class zn extends K{constructor(e){super(),G(this,e,Pn,En,J,{})}}function On(r){let e;return{c(){e=U("Show on map")},m(n,t){d(n,e,t)},d(n){n&&_(e)}}}function Nn(r){let e;return{c(){e=U("Edit scheme locally")},m(n,t){d(n,e,t)},d(n){n&&_(e)}}}function Fn(r){let e,n,t=r[0].authority_or_region+"",s,o,l,u,i=r[0].capital_scheme_id+"",f,a,c,w,m=r[0].funding_programme+"",v,L,D,g,p,S,E;return g=new we({props:{$$slots:{default:[On]},$$scope:{ctx:r}}}),g.$on("click",r[3]),S=new we({props:{disabled:r[1],title:r[2],$$slots:{default:[Nn]},$$scope:{ctx:r}}}),S.$on("click",r[4]),{c(){e=P("p"),n=U("Authority or region: "),s=U(t),o=B(),l=P("p"),u=U("Capital scheme ID: "),f=U(i),a=B(),c=P("p"),w=U("Funding programme: "),v=U(m),L=B(),D=P("div"),y(g.$$.fragment),p=B(),y(S.$$.fragment),R(D,"class","govuk-button-group")},m(T,C){d(T,e,C),M(e,n),M(e,s),d(T,o,C),d(T,l,C),M(l,u),M(l,f),d(T,a,C),d(T,c,C),M(c,w),M(c,v),d(T,L,C),d(T,D,C),b(g,D,null),M(D,p),b(S,D,null),E=!0},p(T,C){(!E||C&1)&&t!==(t=T[0].authority_or_region+"")&&X(s,t),(!E||C&1)&&i!==(i=T[0].capital_scheme_id+"")&&X(f,i),(!E||C&1)&&m!==(m=T[0].funding_programme+"")&&X(v,m);const z={};C&256&&(z.$$scope={dirty:C,ctx:T}),g.$set(z);const O={};C&256&&(O.$$scope={dirty:C,ctx:T}),S.$set(O)},i(T){E||(h(g.$$.fragment,T),h(S.$$.fragment,T),E=!0)},o(T){$(g.$$.fragment,T),$(S.$$.fragment,T),E=!1},d(T){T&&(_(e),_(o),_(l),_(a),_(c),_(L),_(D)),k(g),k(S)}}}function In(r){let e,n;return e=new Pe({props:{label:`${r[0].scheme_reference}: ${r[0].num_features} features`,$$slots:{default:[Fn]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),n=!0},p(t,[s]){const o={};s&1&&(o.label=`${t[0].scheme_reference}: ${t[0].num_features} features`),s&257&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}function jn(r,e,n){let t,s;ee(r,ue,c=>n(6,t=c)),ee(r,ce,c=>n(7,s=c));let{scheme:o}=e,{authorityNames:l}=e,u=!l.has(o.authority_or_region),i=u?"This scheme doesn't have an authority specified correctly, so you can't edit this scheme. We're working to fix this problem.":void 0;function f(){let c={type:"FeatureCollection",features:t.features.filter(w=>w.properties.scheme_reference==o.scheme_reference)};s==null||s.fitBounds(ut(c),{padding:20,animate:!1})}function a(){let c={type:"FeatureCollection",features:t.features.filter(m=>m.properties.scheme_reference==o.scheme_reference)},w=o.authority_or_region;window.localStorage.setItem(w,JSON.stringify(c)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return r.$$set=c=>{"scheme"in c&&n(0,o=c.scheme),"authorityNames"in c&&n(5,l=c.authorityNames)},[o,u,i,f,a,l]}class Vn extends K{constructor(e){super(),G(this,e,jn,In,J,{scheme:0,authorityNames:5})}}function xn(r){let e;return{c(){e=U("primary and secondary schools")},m(n,t){d(n,e,t)},d(n){n&&_(e)}}}function Zn(r){let e;return{c(){e=U("Open Data Commons Open Database License")},m(n,t){d(n,e,t)},d(n){n&&_(e)}}}function Hn(r){let e,n,t,s,o,l,u,i,f;return t=new se({props:{href:"https://wiki.openstreetmap.org/wiki/Tag:amenity%3Dschool",$$slots:{default:[xn]},$$scope:{ctx:r}}}),i=new se({props:{href:"https://www.openstreetmap.org/copyright",$$slots:{default:[Zn]},$$scope:{ctx:r}}}),{c(){e=P("p"),n=U("This shows "),y(t.$$.fragment),s=U(` from OpenStreetMap. It doesn't include kindergartens, colleges,
    universities, or other training schools.`),o=B(),l=P("p"),u=U("License: "),y(i.$$.fragment)},m(a,c){d(a,e,c),M(e,n),b(t,e,null),M(e,s),d(a,o,c),d(a,l,c),M(l,u),b(i,l,null),f=!0},p(a,c){const w={};c&1&&(w.$$scope={dirty:c,ctx:a}),t.$set(w);const m={};c&1&&(m.$$scope={dirty:c,ctx:a}),i.$set(m)},i(a){f||(h(t.$$.fragment,a),h(i.$$.fragment,a),f=!0)},o(a){$(t.$$.fragment,a),$(i.$$.fragment,a),f=!1},d(a){a&&(_(e),_(o),_(l)),k(t),k(i)}}}function Rn(r){let e,n;return e=new pt({props:{name:"schools",singularNoun:"school",pluralNoun:"Schools",$$slots:{default:[Hn]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),n=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}class Kn extends K{constructor(e){super(),G(this,e,null,Rn,J,{})}}function Gn(r){let e,n,t,s,o;function l(i){r[3](i)}let u={label:"Color interventions",id:"colorInterventions",choices:[["interventionType","By intervention type"],["fundingProgramme","By funding programme"]]};return r[0]!==void 0&&(u.value=r[0]),e=new Me({props:u}),te.push(()=>ne(e,"value",l)),e.$on("change",r[2]),s=new Gt({props:{rows:r[1]}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,f){b(e,i,f),d(i,t,f),b(s,i,f),o=!0},p(i,[f]){const a={};!n&&f&1&&(n=!0,a.value=i[0],re(()=>n=!1)),e.$set(a);const c={};f&2&&(c.rows=i[1]),s.$set(c)},i(i){o||(h(e.$$.fragment,i),h(s.$$.fragment,i),o=!0)},o(i){$(e.$$.fragment,i),$(s.$$.fragment,i),o=!1},d(i){i&&_(t),k(e,i),k(s,i)}}}function Jn(r,e,n){let t;ee(r,ce,i=>n(4,t=i));let s="interventionType",o=Ye("v1");function l(){let i;s=="interventionType"?(i=mt("v1"),n(1,o=Ye("v1"))):(i=Ft(["get","funding_programme"],{ATF2:Q.atf2,ATF3:Q.atf3,ATF4:Q.atf4},"grey"),n(1,o=[["ATF2",Q.atf2],["ATF3",Q.atf3],["ATF4",Q.atf4]])),t.setPaintProperty("interventions-points","circle-color",i),t.setPaintProperty("interventions-lines","line-color",i),t.setPaintProperty("interventions-polygons","fill-color",i),t.setPaintProperty("interventions-polygon-outlines","line-color",i)}function u(i){s=i,n(0,s)}return[s,o,l,u]}class qn extends K{constructor(e){super(),G(this,e,Jn,Gn,J,{})}}var F=(r,e,n)=>new Promise((t,s)=>{var o=i=>{try{u(n.next(i))}catch(f){s(f)}},l=i=>{try{u(n.throw(i))}catch(f){s(f)}},u=i=>i.done?t(i.value):Promise.resolve(i.value).then(o,l);u((n=n.apply(r,e)).next())}),j=Uint8Array,ae=Uint16Array,Wn=Int32Array,ht=new j([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gt=new j([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Yn=new j([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$t=function(r,e){for(var n=new ae(31),t=0;t<31;++t)n[t]=e+=1<<r[t-1];for(var s=new Wn(n[30]),t=1;t<30;++t)for(var o=n[t];o<n[t+1];++o)s[o]=o-n[t]<<5|t;return{b:n,r:s}},dt=$t(ht,2),_t=dt.b,Qn=dt.r;_t[28]=258,Qn[258]=28;var Xn=$t(gt,0),er=Xn.b,Ce=new ae(32768);for(A=0;A<32768;++A)W=(A&43690)>>1|(A&21845)<<1,W=(W&52428)>>2|(W&13107)<<2,W=(W&61680)>>4|(W&3855)<<4,Ce[A]=((W&65280)>>8|(W&255)<<8)>>1;var W,A,de=function(r,e,n){for(var t=r.length,s=0,o=new ae(e);s<t;++s)r[s]&&++o[r[s]-1];var l=new ae(e);for(s=1;s<e;++s)l[s]=l[s-1]+o[s-1]<<1;var u;if(n){u=new ae(1<<e);var i=15-e;for(s=0;s<t;++s)if(r[s])for(var f=s<<4|r[s],a=e-r[s],c=l[r[s]-1]++<<a,w=c|(1<<a)-1;c<=w;++c)u[Ce[c]>>i]=f}else for(u=new ae(t),s=0;s<t;++s)r[s]&&(u[s]=Ce[l[r[s]-1]++]>>15-r[s]);return u},_e=new j(288);for(A=0;A<144;++A)_e[A]=8;var A;for(A=144;A<256;++A)_e[A]=9;var A;for(A=256;A<280;++A)_e[A]=7;var A;for(A=280;A<288;++A)_e[A]=8;var A,vt=new j(32);for(A=0;A<32;++A)vt[A]=5;var A,tr=de(_e,9,1),nr=de(vt,5,1),Se=function(r){for(var e=r[0],n=1;n<r.length;++n)r[n]>e&&(e=r[n]);return e},Z=function(r,e,n){var t=e/8|0;return(r[t]|r[t+1]<<8)>>(e&7)&n},Ue=function(r,e){var n=e/8|0;return(r[n]|r[n+1]<<8|r[n+2]<<16)>>(e&7)},rr=function(r){return(r+7)/8|0},sr=function(r,e,n){(e==null||e<0)&&(e=0),(n==null||n>r.length)&&(n=r.length);var t=new j(n-e);return t.set(r.subarray(e,n)),t},or=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],I=function(r,e,n){var t=new Error(e||or[r]);if(t.code=r,Error.captureStackTrace&&Error.captureStackTrace(t,I),!n)throw t;return t},Fe=function(r,e,n,t){var s=r.length,o=t?t.length:0;if(!s||e.f&&!e.l)return n||new j(0);var l=!n||e.i!=2,u=e.i;n||(n=new j(s*3));var i=function(He){var Re=n.length;if(He>Re){var Ke=new j(Math.max(Re*2,He));Ke.set(n),n=Ke}},f=e.f||0,a=e.p||0,c=e.b||0,w=e.l,m=e.d,v=e.m,L=e.n,D=s*8;do{if(!w){f=Z(r,a,1);var g=Z(r,a+1,3);if(a+=3,g)if(g==1)w=tr,m=nr,v=9,L=5;else if(g==2){var T=Z(r,a,31)+257,C=Z(r,a+10,15)+4,z=T+Z(r,a+5,31)+1;a+=14;for(var O=new j(z),q=new j(19),N=0;N<C;++N)q[Yn[N]]=Z(r,a+N*3,7);a+=C*3;for(var Ie=Se(q),St=(1<<Ie)-1,Ut=de(q,Ie,1),N=0;N<z;){var je=Ut[Z(r,a,St)];a+=je&15;var p=je>>4;if(p<16)O[N++]=p;else{var oe=0,ve=0;for(p==16?(ve=3+Z(r,a,3),a+=2,oe=O[N-1]):p==17?(ve=3+Z(r,a,7),a+=3):p==18&&(ve=11+Z(r,a,127),a+=7);ve--;)O[N++]=oe}}var Ve=O.subarray(0,T),x=O.subarray(T);v=Se(Ve),L=Se(x),w=de(Ve,v,1),m=de(x,L,1)}else I(1);else{var p=rr(a)+4,S=r[p-4]|r[p-3]<<8,E=p+S;if(E>s){u&&I(0);break}l&&i(c+S),n.set(r.subarray(p,E),c),e.b=c+=S,e.p=a=E*8,e.f=f;continue}if(a>D){u&&I(0);break}}l&&i(c+131072);for(var Mt=(1<<v)-1,Ct=(1<<L)-1,ke=a;;ke=a){var oe=w[Ue(r,a)&Mt],ie=oe>>4;if(a+=oe&15,a>D){u&&I(0);break}if(oe||I(2),ie<256)n[c++]=ie;else if(ie==256){ke=a,w=null;break}else{var xe=ie-254;if(ie>264){var N=ie-257,me=ht[N];xe=Z(r,a,(1<<me)-1)+_t[N],a+=me}var Le=m[Ue(r,a)&Ct],Te=Le>>4;Le||I(3),a+=Le&15;var x=er[Te];if(Te>3){var me=gt[Te];x+=Ue(r,a)&(1<<me)-1,a+=me}if(a>D){u&&I(0);break}l&&i(c+131072);var De=c+xe;if(c<x){var Ze=o-x,Bt=Math.min(x,De);for(Ze+c<0&&I(3);c<Bt;++c)n[c]=t[Ze+c]}for(;c<De;c+=4)n[c]=n[c-x],n[c+1]=n[c+1-x],n[c+2]=n[c+2-x],n[c+3]=n[c+3-x];c=De}}e.l=w,e.p=ke,e.b=c,e.f=f,w&&(f=1,e.m=v,e.d=m,e.n=L)}while(!f);return c==n.length?n:sr(n,0,c)},ir=new j(0),lr=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&I(6,"invalid gzip data");var e=r[3],n=10;e&4&&(n+=(r[10]|r[11]<<8)+2);for(var t=(e>>3&1)+(e>>4&1);t>0;t-=!r[n++]);return n+(e&2)},ar=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},fr=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&I(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&I(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function ur(r,e){return Fe(r,{i:2},e&&e.out,e&&e.dictionary)}function cr(r,e){var n=lr(r);return n+8>r.length&&I(6,"invalid gzip data"),Fe(r.subarray(n,-8),{i:2},e&&e.out||new j(ar(r)),e&&e.dictionary)}function mr(r,e){return Fe(r.subarray(fr(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Be(r,e){return r[0]==31&&r[1]==139&&r[2]==8?cr(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?ur(r,e):mr(r,e)}var pr=typeof TextDecoder<"u"&&new TextDecoder,hr=0;try{pr.decode(ir,{stream:!0}),hr=1}catch{}var wt=(r,e)=>r*Math.pow(2,e),pe=(r,e)=>Math.floor(r/Math.pow(2,e)),ye=(r,e)=>wt(r.getUint16(e+1,!0),8)+r.getUint8(e),yt=(r,e)=>wt(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),gr=(r,e,n,t,s)=>{if(r!=t.getUint8(s))return r-t.getUint8(s);const o=ye(t,s+1);if(e!=o)return e-o;const l=ye(t,s+4);return n!=l?n-l:0},$r=(r,e,n,t)=>{const s=bt(r,e|128,n,t);return s?{z:e,x:n,y:t,offset:s[0],length:s[1],is_dir:!0}:null},Qe=(r,e,n,t)=>{const s=bt(r,e,n,t);return s?{z:e,x:n,y:t,offset:s[0],length:s[1],is_dir:!1}:null},bt=(r,e,n,t)=>{let s=0,o=r.byteLength/17-1;for(;s<=o;){const l=o+s>>1,u=gr(e,n,t,r,l*17);if(u>0)s=l+1;else if(u<0)o=l-1;else return[yt(r,l*17+7),r.getUint32(l*17+13,!0)]}return null},dr=(r,e)=>r.is_dir&&!e.is_dir?1:!r.is_dir&&e.is_dir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,kt=(r,e)=>{const n=r.getUint8(e*17);return{z:n&127,x:ye(r,e*17+1),y:ye(r,e*17+4),offset:yt(r,e*17+7),length:r.getUint32(e*17+13,!0),is_dir:n>>7===1}},Xe=r=>{const e=[],n=new DataView(r);for(let t=0;t<n.byteLength/17;t++)e.push(kt(n,t));return _r(e)},_r=r=>{r.sort(dr);const e=new ArrayBuffer(17*r.length),n=new Uint8Array(e);for(let t=0;t<r.length;t++){const s=r[t];let o=s.z;s.is_dir&&(o=o|128),n[t*17]=o,n[t*17+1]=s.x&255,n[t*17+2]=s.x>>8&255,n[t*17+3]=s.x>>16&255,n[t*17+4]=s.y&255,n[t*17+5]=s.y>>8&255,n[t*17+6]=s.y>>16&255,n[t*17+7]=s.offset&255,n[t*17+8]=pe(s.offset,8)&255,n[t*17+9]=pe(s.offset,16)&255,n[t*17+10]=pe(s.offset,24)&255,n[t*17+11]=pe(s.offset,32)&255,n[t*17+12]=pe(s.offset,48)&255,n[t*17+13]=s.length&255,n[t*17+14]=s.length>>8&255,n[t*17+15]=s.length>>16&255,n[t*17+16]=s.length>>24&255}return e},vr=(r,e)=>{if(r.byteLength<17)return null;const n=r.byteLength/17,t=kt(r,n-1);if(t.is_dir){const s=t.z,o=e.z-s,l=Math.trunc(e.x/(1<<o)),u=Math.trunc(e.y/(1<<o));return{z:s,x:l,y:u}}return null};function wr(r){return F(this,null,function*(){const e=yield r.getBytes(0,512e3),n=new DataView(e.data),t=n.getUint32(4,!0),s=n.getUint16(8,!0),o=new TextDecoder("utf-8"),l=JSON.parse(o.decode(new DataView(e.data,10,t)));let u=0;l.compression==="gzip"&&(u=2);let i=0;"minzoom"in l&&(i=+l.minzoom);let f=0;"maxzoom"in l&&(f=+l.maxzoom);let a=0,c=0,w=0,m=-180,v=-85,L=180,D=85;if(l.bounds){const p=l.bounds.split(",");m=+p[0],v=+p[1],L=+p[2],D=+p[3]}if(l.center){const p=l.center.split(",");a=+p[0],c=+p[1],w=+p[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+t,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:t,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:u,tileType:1,minZoom:i,maxZoom:f,minLon:m,minLat:v,maxLon:L,maxLat:D,centerZoom:w,centerLon:a,centerLat:c,etag:e.etag}})}function yr(r,e,n,t,s,o,l){return F(this,null,function*(){let u=yield n.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(u=Xe(u));const i=Qe(new DataView(u),t,s,o);if(i){let c=(yield e.getBytes(i.offset,i.length,l)).data;const w=new DataView(c);return w.getUint8(0)==31&&w.getUint8(1)==139&&(c=Be(new Uint8Array(c))),{data:c}}const f=vr(new DataView(u),{z:t,x:s,y:o});if(f){const a=$r(new DataView(u),f.z,f.x,f.y);if(a){let c=yield n.getArrayBuffer(e,a.offset,a.length,r);r.specVersion===1&&(c=Xe(c));const w=Qe(new DataView(c),t,s,o);if(w){let v=(yield e.getBytes(w.offset,w.length,l)).data;const L=new DataView(v);return L.getUint8(0)==31&&L.getUint8(1)==139&&(v=Be(new Uint8Array(v))),{data:v}}}}})}var Lt={getHeader:wr,getZxy:yr},br=class{constructor(){this.tile=(r,e)=>{if(r.type=="json"){const n=r.url.substr(10);let t=this.tiles.get(n);return t||(t=new et(n),this.tiles.set(n,t)),t.getHeader().then(s=>{const o={tiles:[r.url+"/{z}/{x}/{y}"],minzoom:s.minZoom,maxzoom:s.maxZoom,bounds:[s.minLon,s.minLat,s.maxLon,s.maxLat]};e(null,o,null,null)}).catch(s=>{e(s,null,null,null)}),{cancel:()=>{}}}else{const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),t=r.url.match(n);if(!t)throw new Error("Invalid PMTiles protocol URL");const s=t[1];let o=this.tiles.get(s);o||(o=new et(s),this.tiles.set(s,o));const l=t[2],u=t[3],i=t[4],f=new AbortController,a=f.signal;let c=()=>{f.abort()};return o.getHeader().then(w=>{o.getZxy(+l,+u,+i,a).then(m=>{m?e(null,new Uint8Array(m.data),m.cacheControl,m.expires):w.tileType==1?e(null,new Uint8Array,null,null):e(null,null,null,null)}).catch(m=>{m.name!=="AbortError"&&e(m,null,null,null)})}),{cancel:c}}},this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function le(r,e){return(e>>>0)*4294967296+(r>>>0)}function kr(r,e){const n=e.buf;let t,s;if(s=n[e.pos++],t=(s&112)>>4,s<128||(s=n[e.pos++],t|=(s&127)<<3,s<128)||(s=n[e.pos++],t|=(s&127)<<10,s<128)||(s=n[e.pos++],t|=(s&127)<<17,s<128)||(s=n[e.pos++],t|=(s&127)<<24,s<128)||(s=n[e.pos++],t|=(s&1)<<31,s<128))return le(r,t);throw new Error("Expected varint not more than 10 bytes")}function he(r){const e=r.buf;let n,t;return t=e[r.pos++],n=t&127,t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,kr(n,r))}function Lr(r,e,n,t){if(t==0){n==1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}var Tr=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Dr(r,e,n){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,r)-1||n>Math.pow(2,r)-1)throw Error("tile x/y outside zoom level bounds");const t=Tr[r],s=Math.pow(2,r);let o=0,l=0,u=0;const i=[e,n];let f=s/2;for(;f>0;)o=(i[0]&f)>0?1:0,l=(i[1]&f)>0?1:0,u+=f*f*(3*o^l),Lr(f,i,o,l),f=f/2;return t+u}function Tt(r,e){return F(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Be(new Uint8Array(r));{let t=new Response(r).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(t).arrayBuffer()}}else throw Error("Compression method not supported")})}var Sr=127;function Ur(r,e){let n=0,t=r.length-1;for(;n<=t;){const s=t+n>>1,o=e-r[s].tileId;if(o>0)n=s+1;else if(o<0)t=s-1;else return r[s]}return t>=0&&(r[t].runLength===0||e-r[t].tileId<r[t].runLength)?r[t]:null}var Mr=class{constructor(r){this.url=r}getKey(){return this.url}getBytes(r,e,n){return F(this,null,function*(){let t;n||(t=new AbortController,n=t.signal);let s=yield fetch(this.url,{signal:n,headers:{Range:"bytes="+r+"-"+(r+e-1)}});if(s.status===416&&r===0){const u=s.headers.get("Content-Range");if(!u||!u.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const i=+u.substr(8);s=yield fetch(this.url,{signal:n,headers:{Range:"bytes=0-"+(i-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw t&&t.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function H(r,e){const n=r.getUint32(e+4,!0),t=r.getUint32(e+0,!0);return n*Math.pow(2,32)+t}function Cr(r,e){const n=new DataView(r),t=n.getUint8(7);if(t>3)throw Error(`Archive is spec version ${t} but this library supports up to spec version 3`);return{specVersion:t,rootDirectoryOffset:H(n,8),rootDirectoryLength:H(n,16),jsonMetadataOffset:H(n,24),jsonMetadataLength:H(n,32),leafDirectoryOffset:H(n,40),leafDirectoryLength:H(n,48),tileDataOffset:H(n,56),tileDataLength:H(n,64),numAddressedTiles:H(n,72),numTileEntries:H(n,80),numTileContents:H(n,88),clustered:n.getUint8(96)===1,internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:e}}function Dt(r){const e={buf:new Uint8Array(r),pos:0},n=he(e),t=[];let s=0;for(let o=0;o<n;o++){const l=he(e);t.push({tileId:s+l,offset:0,length:0,runLength:1}),s+=l}for(let o=0;o<n;o++)t[o].runLength=he(e);for(let o=0;o<n;o++)t[o].length=he(e);for(let o=0;o<n;o++){const l=he(e);l===0&&o>0?t[o].offset=t[o-1].offset+t[o-1].length:t[o].offset=l-1}return t}function Br(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var fe=class extends Error{};function Er(r,e,n,t){return F(this,null,function*(){const s=yield r.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Br(s.data)<3)return[yield Lt.getHeader(r)];const l=s.data.slice(0,Sr);let u=s.etag;t&&s.etag!=t&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+r.getKey()),u=void 0);const i=Cr(l,u);if(n){const f=s.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),a=r.getKey()+"|"+(i.etag||"")+"|"+i.rootDirectoryOffset+"|"+i.rootDirectoryLength,c=Dt(yield e(f,i.internalCompression));return[i,[a,c.length,c]]}return[i,void 0]})}function Ar(r,e,n,t,s){return F(this,null,function*(){const o=yield r.getBytes(n,t);if(s.etag&&s.etag!==o.etag)throw new fe(o.etag);const l=yield e(o.data,s.internalCompression),u=Dt(l);if(u.length===0)throw new Error("Empty directory is invalid");return u})}var Pr=class{constructor(r=100,e=!0,n=Tt){this.cache=new Map,this.maxCacheEntries=r,this.counter=1,this.prefetch=e,this.decompress=n}getHeader(r,e){return F(this,null,function*(){const n=r.getKey();if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const t=new Promise((s,o)=>{Er(r,this.decompress,this.prefetch,e).then(l=>{l[1]&&this.cache.set(l[1][0],{lastUsed:this.counter++,data:Promise.resolve(l[1][2])}),s(l[0]),this.prune()}).catch(l=>{o(l)})});return this.cache.set(n,{lastUsed:this.counter++,data:t}),t})}getDirectory(r,e,n,t){return F(this,null,function*(){const s=r.getKey()+"|"+(t.etag||"")+"|"+e+"|"+n;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((l,u)=>{Ar(r,this.decompress,e,n,t).then(i=>{l(i),this.prune()}).catch(i=>{u(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}getArrayBuffer(r,e,n,t){return F(this,null,function*(){const s=r.getKey()+"|"+(t.etag||"")+"|"+e+"|"+n;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((l,u)=>{r.getBytes(e,n).then(i=>{if(t.etag&&t.etag!==i.etag)throw new fe(i.etag);l(i.data),this.cache.has(s),this.prune()}).catch(i=>{u(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((n,t)=>{n.lastUsed<r&&(r=n.lastUsed,e=t)}),e&&this.cache.delete(e)}}invalidate(r,e){return F(this,null,function*(){this.cache.delete(r.getKey()),yield this.getHeader(r,e)})}},et=class{constructor(r,e,n){typeof r=="string"?this.source=new Mr(r):this.source=r,n?this.decompress=n:this.decompress=Tt,e?this.cache=e:this.cache=new Pr}getHeader(){return F(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,n,t){return F(this,null,function*(){const s=Dr(r,e,n),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return Lt.getZxy(o,this.source,this.cache,r,e,n,t);if(r<o.minZoom||r>o.maxZoom)return;let l=o.rootDirectoryOffset,u=o.rootDirectoryLength;for(let i=0;i<=3;i++){const f=yield this.cache.getDirectory(this.source,l,u,o),a=Ur(f,s);if(a)if(a.runLength>0){const c=yield this.source.getBytes(o.tileDataOffset+a.offset,a.length,t);if(o.etag&&o.etag!==c.etag)throw new fe(c.etag);return{data:yield this.decompress(c.data,o.tileCompression),cacheControl:c.cacheControl,expires:c.expires}}else l=o.leafDirectoryOffset+a.offset,u=a.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,n,t){return F(this,null,function*(){try{return yield this.getZxyAttempt(r,e,n,t)}catch(s){if(s instanceof fe)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(r,e,n,t);throw s}})}getMetadataAttempt(){return F(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength);if(r.etag&&r.etag!==e.etag)throw new fe(e.etag);const n=yield this.decompress(e.data,r.internalCompression),t=new TextDecoder("utf-8");return JSON.parse(t.decode(n))})}getMetadata(){return F(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof fe)return this.cache.invalidate(this.source,r.message),yield this.getMetadataAttempt();throw r}})}};function zr(r){return Ee(()=>{let e=new br;Je.addProtocol("pmtiles",e.tile)}),ct(()=>{Je.removeProtocol("pmtiles")}),[]}class Or extends K{constructor(e){super(),G(this,e,zr,null,J,{})}}function tt(r,e,n){const t=r.slice();return t[15]=e[n],t}function Nr(r){let e;return{c(){e=U("Home")},m(n,t){d(n,e,t)},d(n){n&&_(e)}}}function nt(r){let e,n;return e=new Ht({props:{errorMessage:r[1]}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),n=!0},p(t,s){const o={};s&2&&(o.errorMessage=t[1]),e.$set(o)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}function rt(r){let e,n,t,s;function o(i){r[10](i)}function l(i){r[11](i)}let u={schemes:r[2]};return r[3]!==void 0&&(u.schemesToBeShown=r[3]),r[4]!==void 0&&(u.filterText=r[4]),e=new ln({props:u}),te.push(()=>ne(e,"schemesToBeShown",o)),te.push(()=>ne(e,"filterText",l)),{c(){y(e.$$.fragment)},m(i,f){b(e,i,f),s=!0},p(i,f){const a={};f&4&&(a.schemes=i[2]),!n&&f&8&&(n=!0,a.schemesToBeShown=i[3],re(()=>n=!1)),!t&&f&16&&(t=!0,a.filterText=i[4],re(()=>t=!1)),e.$set(a)},i(i){s||(h(e.$$.fragment,i),s=!0)},o(i){$(e.$$.fragment,i),s=!1},d(i){k(e,i)}}}function st(r){let e,n,t=We(r[2].values()),s=[];for(let l=0;l<t.length;l+=1)s[l]=it(tt(r,t,l));const o=l=>$(s[l],1,1,()=>{s[l]=null});return{c(){e=P("ul");for(let l=0;l<s.length;l+=1)s[l].c()},m(l,u){d(l,e,u);for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(e,null);n=!0},p(l,u){if(u&13){t=We(l[2].values());let i;for(i=0;i<t.length;i+=1){const f=tt(l,t,i);s[i]?(s[i].p(f,u),h(s[i],1)):(s[i]=it(f),s[i].c(),h(s[i],1),s[i].m(e,null))}for(ge(),i=t.length;i<s.length;i+=1)o(i);$e()}},i(l){if(!n){for(let u=0;u<t.length;u+=1)h(s[u]);n=!0}},o(l){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)$(s[u]);n=!1},d(l){l&&_(e),Rt(s,l)}}}function ot(r){let e,n;return e=new Vn({props:{scheme:r[15],authorityNames:r[0]}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),n=!0},p(t,s){const o={};s&4&&(o.scheme=t[15]),s&1&&(o.authorityNames=t[0]),e.$set(o)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}function it(r){let e=r[3].has(r[15].scheme_reference),n,t,s=e&&ot(r);return{c(){s&&s.c(),n=Kt()},m(o,l){s&&s.m(o,l),d(o,n,l),t=!0},p(o,l){l&12&&(e=o[3].has(o[15].scheme_reference)),e?s?(s.p(o,l),l&12&&h(s,1)):(s=ot(o),s.c(),h(s,1),s.m(n.parentNode,n)):s&&(ge(),$(s,1,1,()=>{s=null}),$e())},i(o){t||(h(s),t=!0)},o(o){$(s),t=!1},d(o){o&&_(n),s&&s.d(o)}}}function Fr(r){let e,n,t,s,o,l,u,i,f,a,c,w,m;n=new we({props:{$$slots:{default:[Nr]},$$scope:{ctx:r}}}),n.$on("click",r[9]),u=new qt({props:{boundaryGeojson:r[5]}});let v=r[1]&&nt(r);a=new It({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:r[7]}});let L=r[2].size>0&&rt(r),D=r[0]&&st(r);return{c(){e=P("div"),y(n.$$.fragment),t=B(),s=P("div"),o=P("h1"),o.textContent="Browse schemes",l=B(),y(u.$$.fragment),i=B(),v&&v.c(),f=B(),y(a.$$.fragment),c=B(),L&&L.c(),w=B(),D&&D.c(),qe(s,"display","flex"),qe(s,"justify-content","space-between"),R(e,"slot","sidebar"),R(e,"class","govuk-prose")},m(g,p){d(g,e,p),b(n,e,null),M(e,t),M(e,s),M(s,o),M(s,l),b(u,s,null),M(e,i),v&&v.m(e,null),M(e,f),b(a,e,null),M(e,c),L&&L.m(e,null),M(e,w),D&&D.m(e,null),m=!0},p(g,p){const S={};p&262144&&(S.$$scope={dirty:p,ctx:g}),n.$set(S);const E={};p&32&&(E.boundaryGeojson=g[5]),u.$set(E),g[1]?v?(v.p(g,p),p&2&&h(v,1)):(v=nt(g),v.c(),h(v,1),v.m(e,f)):v&&(ge(),$(v,1,1,()=>{v=null}),$e()),g[2].size>0?L?(L.p(g,p),p&4&&h(L,1)):(L=rt(g),L.c(),h(L,1),L.m(e,w)):L&&(ge(),$(L,1,1,()=>{L=null}),$e()),g[0]?D?(D.p(g,p),p&1&&h(D,1)):(D=st(g),D.c(),h(D,1),D.m(e,null)):D&&(ge(),$(D,1,1,()=>{D=null}),$e())},i(g){m||(h(n.$$.fragment,g),h(u.$$.fragment,g),h(v),h(a.$$.fragment,g),h(L),h(D),m=!0)},o(g){$(n.$$.fragment,g),$(u.$$.fragment,g),$(v),$(a.$$.fragment,g),$(L),$(D),m=!1},d(g){g&&_(e),k(n),k(u),v&&v.d(),k(a),L&&L.d(),D&&D.d()}}}function Ir(r){let e,n,t,s,o,l,u,i;return e=new Kn({}),t=new dn({}),o=new Dn({}),u=new zn({}),{c(){y(e.$$.fragment),n=B(),y(t.$$.fragment),s=B(),y(o.$$.fragment),l=B(),y(u.$$.fragment)},m(f,a){b(e,f,a),d(f,n,a),b(t,f,a),d(f,s,a),b(o,f,a),d(f,l,a),b(u,f,a),i=!0},i(f){i||(h(e.$$.fragment,f),h(t.$$.fragment,f),h(o.$$.fragment,f),h(u.$$.fragment,f),i=!0)},o(f){$(e.$$.fragment,f),$(t.$$.fragment,f),$(o.$$.fragment,f),$(u.$$.fragment,f),i=!1},d(f){f&&(_(n),_(s),_(l)),k(e,f),k(t,f),k(o,f),k(u,f)}}}function jr(r){let e,n,t,s,o,l,u,i;return e=new qn({}),o=new Qt({props:{small:!0,$$slots:{default:[Ir]},$$scope:{ctx:r}}}),u=new Xt({props:{style:r[6]}}),{c(){y(e.$$.fragment),n=B(),t=P("hr"),s=B(),y(o.$$.fragment),l=B(),y(u.$$.fragment)},m(f,a){b(e,f,a),d(f,n,a),d(f,t,a),d(f,s,a),b(o,f,a),d(f,l,a),b(u,f,a),i=!0},p(f,a){const c={};a&262144&&(c.$$scope={dirty:a,ctx:f}),o.$set(c)},i(f){i||(h(e.$$.fragment,f),h(o.$$.fragment,f),h(u.$$.fragment,f),i=!0)},o(f){$(e.$$.fragment,f),$(o.$$.fragment,f),$(u.$$.fragment,f),i=!1},d(f){f&&(_(n),_(t),_(s),_(l)),k(e,f),k(o,f),k(u,f)}}}function Vr(r){let e,n,t,s,o,l,u;return e=new Yt({props:{colorInterventions:mt("v1")}}),t=new be({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:r[8]}}),l=new Pe({props:{label:"Layers",open:!0,$$slots:{default:[jr]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment),n=B(),y(t.$$.fragment),s=B(),o=P("div"),y(l.$$.fragment),R(o,"class","top-right svelte-nlvvhu")},m(i,f){b(e,i,f),d(i,n,f),b(t,i,f),d(i,s,f),d(i,o,f),b(l,o,null),u=!0},p(i,f){const a={};f&262144&&(a.$$scope={dirty:f,ctx:i}),l.$set(a)},i(i){u||(h(e.$$.fragment,i),h(t.$$.fragment,i),h(l.$$.fragment,i),u=!0)},o(i){$(e.$$.fragment,i),$(t.$$.fragment,i),$(l.$$.fragment,i),u=!1},d(i){i&&(_(n),_(s),_(o)),k(e,i),k(t,i),k(l)}}}function xr(r){let e,n,t,s,o;return n=new Or({}),s=new Wt({props:{style:r[6],$$slots:{default:[Vr]},$$scope:{ctx:r}}}),{c(){e=P("div"),y(n.$$.fragment),t=B(),y(s.$$.fragment),R(e,"slot","main")},m(l,u){d(l,e,u),b(n,e,null),M(e,t),b(s,e,null),o=!0},p(l,u){const i={};u&262144&&(i.$$scope={dirty:u,ctx:l}),s.$set(i)},i(l){o||(h(n.$$.fragment,l),h(s.$$.fragment,l),o=!0)},o(l){$(n.$$.fragment,l),$(s.$$.fragment,l),o=!1},d(l){l&&_(e),k(n),k(s)}}}function Zr(r){let e,n;return e=new Jt({props:{$$slots:{main:[xr],sidebar:[Fr]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),n=!0},p(t,[s]){const o={};s&262207&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}function Hr(r,e,n){let t,s;ee(r,ce,p=>n(12,t=p)),ee(r,ue,p=>n(5,s=p));let o=null;Ee(async()=>{jt();let p=await Vt();n(0,o=new Set(p.features.map(S=>S.properties.name)))});let u=new URLSearchParams(window.location.search).get("style")||"dataviz",i="",f=new Map,a=new Set,c="";ct(()=>{ue.set(xt())});function w(p){try{let S=JSON.parse(p);n(2,f=en(S)),ue.set(S),n(1,i=""),t==null||t.fitBounds(ut(S),{padding:20,animate:!1})}catch(S){n(1,i=`Couldn't load schemes from a file: ${S}`)}}function m(p){var S='<div style="max-width: 30vw;">';return S+=`<h2>${v(p.name)} (${p.intervention_type})</h2>`,S+=`<p>Scheme reference: ${p.scheme_reference}</p>`,p.length_meters&&(S+=`<p>Length: ${Zt(p.length_meters)}</p>`),p.description&&(S+=`<p>${v(p.description)}</p>`),S+="</div>",S}function v(p){return c?p.replace(new RegExp(c,"gi"),S=>`<mark>${S}</mark>`):p}const L=()=>window.open("index.html");function D(p){a=p,n(3,a)}function g(p){c=p,n(4,c)}return[o,i,f,a,c,s,u,w,m,L,D,g]}class Rr extends K{constructor(e){super(),G(this,e,Hr,Zr,J,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Rr({target:document.getElementById("app")});
