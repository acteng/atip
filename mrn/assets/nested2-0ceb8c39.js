import{S as J,i as W,s as Y,g as T,f as z,e as V,u as B,m as k,j as U,k as C,R as q,t as _,l as b,p as D,q as L,Z as X,a1 as se,r as Ue,b as oe,c as ie,F as Lt,o as ae,a as de,h as G,v as Ve,w as St,M as De,C as $e,aX as et,a0 as Ut,x as Me,a6 as Dt,D as tt,aY as Ze,af as rt,d as Mt,V as He,y as ce,n as me,z as Et,A as Ct,a8 as Bt,aP as zt,E as At,T as Fe,U as Nt,ac as Ot}from"./data_getter-ab54baf6.js";import{C as Ee,S as Re,d as nt,e as st,L as Pt,Z as jt,M as It,I as Vt,B as Zt,b as Ht}from"./Map-3f3255fe.js";function Ft(t){let e=new Map;for(let[r,n]of Object.entries(t.schemes))e.set(r,{scheme_reference:r,num_features:0,authority_or_region:n.authority_or_region,capital_scheme_id:n.capital_scheme_id,funding_programme:n.funding_programme});for(let r of t.features)e.get(r.properties.scheme_reference).num_features++,delete r.properties.id,delete r.properties.authority_or_region,delete r.properties.capital_scheme_id,delete r.properties.funding_programme,delete r.properties.valid,delete r.properties.centroid_lon,delete r.properties.centroid_lat;return e}function Rt(t){let e;return{c(){e=B("Clear")},m(r,n){U(r,e,n)},d(r){r&&D(e)}}}function Kt(t){let e,r,n,s,o,a;return n=new de({props:{$$slots:{default:[Rt]},$$scope:{ctx:t}}}),n.$on("click",t[11]),{c(){e=V("input"),r=z(),T(n.$$.fragment),G(e,"type","text"),G(e,"class","govuk-input govuk-input--width-10"),G(e,"id","filterText")},m(l,i){U(l,e,i),Ve(e,t[0]),U(l,r,i),k(n,l,i),s=!0,o||(a=St(e,"input",t[10]),o=!0)},p(l,i){i&1&&e.value!==l[0]&&Ve(e,l[0]);const f={};i&16384&&(f.$$scope={dirty:i,ctx:l}),n.$set(f)},i(l){s||(_(n.$$.fragment,l),s=!0)},o(l){b(n.$$.fragment,l),s=!1},d(l){l&&(D(e),D(r)),L(n,l),o=!1,a()}}}function xt(t){let e,r,n,s,o,a,l,i;function f(h){t[8](h)}let u={label:"Authority or region",id:"filterAuthority",choices:t[4],emptyOption:!0};t[2]!==void 0&&(u.value=t[2]),e=new Re({props:u}),oe.push(()=>ie(e,"value",f));function c(h){t[9](h)}let g={label:"Funding programme",id:"filterFundingProgramme",choices:t[5],emptyOption:!0};return t[3]!==void 0&&(g.value=t[3]),s=new Re({props:g}),oe.push(()=>ie(s,"value",c)),l=new Lt({props:{label:"Intervention name or description",id:"filterText",$$slots:{default:[Kt]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment),n=z(),T(s.$$.fragment),a=z(),T(l.$$.fragment)},m(h,d){k(e,h,d),U(h,n,d),k(s,h,d),U(h,a,d),k(l,h,d),i=!0},p(h,d){const $={};d&16&&($.choices=h[4]),!r&&d&4&&(r=!0,$.value=h[2],ae(()=>r=!1)),e.$set($);const v={};d&32&&(v.choices=h[5]),!o&&d&8&&(o=!0,v.value=h[3],ae(()=>o=!1)),s.$set(v);const p={};d&16385&&(p.$$scope={dirty:d,ctx:h}),l.$set(p)},i(h){i||(_(e.$$.fragment,h),_(s.$$.fragment,h),_(l.$$.fragment,h),i=!0)},o(h){b(e.$$.fragment,h),b(s.$$.fragment,h),b(l.$$.fragment,h),i=!1},d(h){h&&(D(n),D(a)),L(e,h),L(s,h),L(l,h)}}}function qt(t){let e,r,n,s,o=t[1].size+"",a,l,i=t[6].route+"",f,u,c=t[6].area+"",g,h,d=t[6].crossing+"",$,v,p=t[6].other+"",m,w,M;return e=new Ee({props:{label:"Filters",$$slots:{default:[xt]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment),r=z(),n=V("p"),s=B("Showing "),a=B(o),l=B(" schemes ("),f=B(i),u=B(" routes, "),g=B(c),h=B(` areas,
  `),$=B(d),v=B(" crossings, "),m=B(p),w=B(" other)")},m(y,S){k(e,y,S),U(y,r,S),U(y,n,S),C(n,s),C(n,a),C(n,l),C(n,f),C(n,u),C(n,g),C(n,h),C(n,$),C(n,v),C(n,m),C(n,w),M=!0},p(y,[S]){const A={};S&16445&&(A.$$scope={dirty:S,ctx:y}),e.$set(A),(!M||S&2)&&o!==(o=y[1].size+"")&&q(a,o),(!M||S&64)&&i!==(i=y[6].route+"")&&q(f,i),(!M||S&64)&&c!==(c=y[6].area+"")&&q(g,c),(!M||S&64)&&d!==(d=y[6].crossing+"")&&q($,d),(!M||S&64)&&p!==(p=y[6].other+"")&&q(m,p)},i(y){M||(_(e.$$.fragment,y),M=!0)},o(y){b(e.$$.fragment,y),M=!1},d(y){y&&(D(r),D(n)),L(e,y)}}}function Gt(t,e,r){let n;X(t,se,p=>r(12,n=p));let{schemes:s}=e,{schemesToBeShown:o=new Set}=e,{filterText:a=""}=e,l=[],i="",f=[],u="",c={area:0,route:0,crossing:0,other:0};Ue(()=>{let p=new Set,m=new Set;for(let w of s.values())w.authority_or_region&&p.add(w.authority_or_region),w.funding_programme&&m.add(w.funding_programme);r(4,l=Array.from(p.entries())),l.sort(),r(5,f=Array.from(m.entries())),f.sort()});function g(p,m,w){let M=p.toLowerCase(),y=A=>{var N,R;if(M&&!((N=A.properties.name)!=null&&N.toLowerCase().includes(M))&&!((R=A.properties.description)!=null&&R.toLowerCase().includes(M)))return!1;if(m||w){let O=s.get(A.properties.scheme_reference);if(m&&O.authority_or_region!=m||w&&O.funding_programme!=w)return!1}return!0};r(1,o=new Set(n.features.filter(y).map(A=>A.properties.scheme_reference))),r(6,c={area:0,route:0,crossing:0,other:0});let S=A=>{var N,R;return!(!o.has(A.properties.scheme_reference)||M&&!((N=A.properties.name)!=null&&N.toLowerCase().includes(M))&&!((R=A.properties.description)!=null&&R.toLowerCase().includes(M)))};se.update(A=>{for(let N of A.features)S(N)?(delete N.properties.hide_while_editing,r(6,c[N.properties.intervention_type]++,c)):N.properties.hide_while_editing=!0;return A}),r(6,c)}function h(p){i=p,r(2,i)}function d(p){u=p,r(3,u)}function $(){a=this.value,r(0,a)}const v=()=>r(0,a="");return t.$$set=p=>{"schemes"in p&&r(7,s=p.schemes),"schemesToBeShown"in p&&r(1,o=p.schemesToBeShown),"filterText"in p&&r(0,a=p.filterText)},t.$$.update=()=>{t.$$.dirty&13&&g(a,i,u)},[a,o,i,u,l,f,c,s,h,d,$,v]}class Jt extends J{constructor(e){super(),W(this,e,Gt,qt,Y,{schemes:7,schemesToBeShown:1,filterText:0})}}function Wt(t){let e,r,n,s;return e=new st({props:{color:t[2]}}),{c(){T(e.$$.fragment),r=z(),n=B(t[1])},m(o,a){k(e,o,a),U(o,r,a),U(o,n,a),s=!0},p(o,a){const l={};a&4&&(l.color=o[2]),e.$set(l),(!s||a&2)&&q(n,o[1])},i(o){s||(_(e.$$.fragment,o),s=!0)},o(o){b(e.$$.fragment,o),s=!1},d(o){o&&(D(r),D(n)),L(e,o)}}}function Yt(t){let e,r,n,s,o;function a(i){t[8](i)}let l={id:t[0],hint:t[3],$$slots:{default:[Wt]},$$scope:{ctx:t}};return t[4]!==void 0&&(l.checked=t[4]),e=new nt({props:l}),oe.push(()=>ie(e,"checked",a)),s=new De({props:{layers:[t[0]],contents:t[5]}}),{c(){T(e.$$.fragment),n=z(),T(s.$$.fragment)},m(i,f){k(e,i,f),U(i,n,f),k(s,i,f),o=!0},p(i,[f]){const u={};f&1&&(u.id=i[0]),f&8&&(u.hint=i[3]),f&518&&(u.$$scope={dirty:f,ctx:i}),!r&&f&16&&(r=!0,u.checked=i[4],ae(()=>r=!1)),e.$set(u);const c={};f&1&&(c.layers=[i[0]]),s.$set(c)},i(i){o||(_(e.$$.fragment,i),_(s.$$.fragment,i),o=!0)},o(i){b(e.$$.fragment,i),b(s.$$.fragment,i),o=!1},d(i){i&&D(n),L(e,i),L(s,i)}}}function Xt(t,e,r){let n;X(t,$e,g=>r(7,n=g));let{name:s}=e,{singularNoun:o}=e,{pluralNoun:a}=e,{color:l}=e,{hint:i}=e;et(n,s,`https://atip.uk/layers/v1/${s}.pmtiles`),Ut(n,{id:s,source:s,sourceLayer:s,color:l,opacity:.8});let f=!1;function u(g){return`<p>${g.name??`Unnamed ${o}`}</p>`}function c(g){f=g,r(4,f)}return t.$$set=g=>{"name"in g&&r(0,s=g.name),"singularNoun"in g&&r(6,o=g.singularNoun),"pluralNoun"in g&&r(1,a=g.pluralNoun),"color"in g&&r(2,l=g.color),"hint"in g&&r(3,i=g.hint)},t.$$.update=()=>{t.$$.dirty&145&&n.getLayer(s)&&n.setLayoutProperty(s,"visibility",f?"visible":"none")},[s,a,l,i,f,u,o,n,c]}class ot extends J{constructor(e){super(),W(this,e,Xt,Yt,Y,{name:0,singularNoun:6,pluralNoun:1,color:2,hint:3})}}function Qt(t){let e,r;return e=new ot({props:{name:"hospitals",singularNoun:"hospital",pluralNoun:"Hospitals",color:"blue",hint:"Hospital data from OpenStreetMap. Doesn't include outpatient clinics or individual doctor's offices."}}),{c(){T(e.$$.fragment)},m(n,s){k(e,n,s),r=!0},p:Me,i(n){r||(_(e.$$.fragment,n),r=!0)},o(n){b(e.$$.fragment,n),r=!1},d(n){L(e,n)}}}class er extends J{constructor(e){super(),W(this,e,null,Qt,Y,{})}}function tr(t){let e,r,n;return e=new st({props:{color:it}}),{c(){T(e.$$.fragment),r=B(`
  MRN`)},m(s,o){k(e,s,o),U(s,r,o),n=!0},p:Me,i(s){n||(_(e.$$.fragment,s),n=!0)},o(s){b(e.$$.fragment,s),n=!1},d(s){s&&D(r),L(e,s)}}}function rr(t){let e,r,n,s,o;function a(i){t[2](i)}let l={id:x,hint:nr,$$slots:{default:[tr]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.checked=t[0]),e=new nt({props:l}),oe.push(()=>ie(e,"checked",a)),s=new De({props:{layers:[x],contents:sr}}),{c(){T(e.$$.fragment),n=z(),T(s.$$.fragment)},m(i,f){k(e,i,f),U(i,n,f),k(s,i,f),o=!0},p(i,[f]){const u={};f&8&&(u.$$scope={dirty:f,ctx:i}),!r&&f&1&&(r=!0,u.checked=i[0],ae(()=>r=!1)),e.$set(u)},i(i){o||(_(e.$$.fragment,i),_(s.$$.fragment,i),o=!0)},o(i){b(e.$$.fragment,i),b(s.$$.fragment,i),o=!1},d(i){i&&D(n),L(e,i),L(s,i)}}}let x="mrn",it="purple",nr="Major Road Network";function sr(t){return`<p>${t.name??"Unknown MRN road"}</p>`}function or(t,e,r){let n;X(t,$e,a=>r(1,n=a)),et(n,x,`https://atip.uk/layers/v1/${x}.pmtiles`),Dt(n,{id:x,source:x,sourceLayer:x,color:it,width:10});let s=!1;function o(a){s=a,r(0,s)}return t.$$.update=()=>{t.$$.dirty&3&&n.getLayer(x)&&n.setLayoutProperty(x,"visibility",s?"visible":"none")},[s,n,o]}class ir extends J{constructor(e){super(),W(this,e,or,rr,Y,{})}}function ar(t){let e;return{c(){e=B("Show on map")},m(r,n){U(r,e,n)},d(r){r&&D(e)}}}function lr(t){let e;return{c(){e=B("Edit scheme locally")},m(r,n){U(r,e,n)},d(r){r&&D(e)}}}function fr(t){let e,r,n=t[0].authority_or_region+"",s,o,a,l,i=t[0].capital_scheme_id+"",f,u,c,g,h=t[0].funding_programme+"",d,$,v,p,m,w,M;return p=new de({props:{$$slots:{default:[ar]},$$scope:{ctx:t}}}),p.$on("click",t[3]),w=new de({props:{disabled:t[1],title:t[2],$$slots:{default:[lr]},$$scope:{ctx:t}}}),w.$on("click",t[4]),{c(){e=V("p"),r=B("Authority or region: "),s=B(n),o=z(),a=V("p"),l=B("Capital scheme ID: "),f=B(i),u=z(),c=V("p"),g=B("Funding programme: "),d=B(h),$=z(),v=V("div"),T(p.$$.fragment),m=z(),T(w.$$.fragment),G(v,"class","govuk-button-group")},m(y,S){U(y,e,S),C(e,r),C(e,s),U(y,o,S),U(y,a,S),C(a,l),C(a,f),U(y,u,S),U(y,c,S),C(c,g),C(c,d),U(y,$,S),U(y,v,S),k(p,v,null),C(v,m),k(w,v,null),M=!0},p(y,S){(!M||S&1)&&n!==(n=y[0].authority_or_region+"")&&q(s,n),(!M||S&1)&&i!==(i=y[0].capital_scheme_id+"")&&q(f,i),(!M||S&1)&&h!==(h=y[0].funding_programme+"")&&q(d,h);const A={};S&256&&(A.$$scope={dirty:S,ctx:y}),p.$set(A);const N={};S&256&&(N.$$scope={dirty:S,ctx:y}),w.$set(N)},i(y){M||(_(p.$$.fragment,y),_(w.$$.fragment,y),M=!0)},o(y){b(p.$$.fragment,y),b(w.$$.fragment,y),M=!1},d(y){y&&(D(e),D(o),D(a),D(u),D(c),D($),D(v)),L(p),L(w)}}}function ur(t){let e,r;return e=new Ee({props:{label:`${t[0].scheme_reference}: ${t[0].num_features} features`,$$slots:{default:[fr]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},m(n,s){k(e,n,s),r=!0},p(n,[s]){const o={};s&1&&(o.label=`${n[0].scheme_reference}: ${n[0].num_features} features`),s&257&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){r||(_(e.$$.fragment,n),r=!0)},o(n){b(e.$$.fragment,n),r=!1},d(n){L(e,n)}}}function cr(t,e,r){let n,s;X(t,se,c=>r(6,n=c)),X(t,$e,c=>r(7,s=c));let{scheme:o}=e,{authorityNames:a}=e,l=!a.has(o.authority_or_region),i=l?"This scheme doesn't have an authority specified correctly, so you can't edit this scheme. We're working to fix this problem.":void 0;function f(){let c={type:"FeatureCollection",features:n.features.filter(g=>g.properties.scheme_reference==o.scheme_reference)};s==null||s.fitBounds(tt(c),{padding:20,animate:!1})}function u(){let c={type:"FeatureCollection",features:n.features.filter(h=>h.properties.scheme_reference==o.scheme_reference)},g=o.authority_or_region;window.localStorage.setItem(g,JSON.stringify(c)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return t.$$set=c=>{"scheme"in c&&r(0,o=c.scheme),"authorityNames"in c&&r(5,a=c.authorityNames)},[o,l,i,f,u,a]}class mr extends J{constructor(e){super(),W(this,e,cr,ur,Y,{scheme:0,authorityNames:5})}}function hr(t){let e,r;return e=new ot({props:{name:"schools",singularNoun:"school",pluralNoun:"Schools",color:"red",hint:"Primary and secondary schools, from OpenStreetMap."}}),{c(){T(e.$$.fragment)},m(n,s){k(e,n,s),r=!0},p:Me,i(n){r||(_(e.$$.fragment,n),r=!0)},o(n){b(e.$$.fragment,n),r=!1},d(n){L(e,n)}}}class pr extends J{constructor(e){super(),W(this,e,null,hr,Y,{})}}var P=(t,e,r)=>new Promise((n,s)=>{var o=i=>{try{l(r.next(i))}catch(f){s(f)}},a=i=>{try{l(r.throw(i))}catch(f){s(f)}},l=i=>i.done?n(i.value):Promise.resolve(i.value).then(o,a);l((r=r.apply(t,e)).next())}),I=Uint8Array,re=Uint16Array,gr=Int32Array,at=new I([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),lt=new I([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dr=new I([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ft=function(t,e){for(var r=new re(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new gr(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)s[o]=o-r[n]<<5|n;return{b:r,r:s}},ut=ft(at,2),ct=ut.b,_r=ut.r;ct[28]=258,_r[258]=28;var $r=ft(lt,0),yr=$r.b,Le=new re(32768);for(E=0;E<32768;++E)K=(E&43690)>>1|(E&21845)<<1,K=(K&52428)>>2|(K&13107)<<2,K=(K&61680)>>4|(K&3855)<<4,Le[E]=((K&65280)>>8|(K&255)<<8)>>1;var K,E,he=function(t,e,r){for(var n=t.length,s=0,o=new re(e);s<n;++s)t[s]&&++o[t[s]-1];var a=new re(e);for(s=1;s<e;++s)a[s]=a[s-1]+o[s-1]<<1;var l;if(r){l=new re(1<<e);var i=15-e;for(s=0;s<n;++s)if(t[s])for(var f=s<<4|t[s],u=e-t[s],c=a[t[s]-1]++<<u,g=c|(1<<u)-1;c<=g;++c)l[Le[c]>>i]=f}else for(l=new re(n),s=0;s<n;++s)t[s]&&(l[s]=Le[a[t[s]-1]++]>>15-t[s]);return l},pe=new I(288);for(E=0;E<144;++E)pe[E]=8;var E;for(E=144;E<256;++E)pe[E]=9;var E;for(E=256;E<280;++E)pe[E]=7;var E;for(E=280;E<288;++E)pe[E]=8;var E,mt=new I(32);for(E=0;E<32;++E)mt[E]=5;var E,vr=he(pe,9,1),wr=he(mt,5,1),Te=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},H=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},ke=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},br=function(t){return(t+7)/8|0},Tr=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var n=new I(r-e);return n.set(t.subarray(e,r)),n},kr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],j=function(t,e,r){var n=new Error(e||kr[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,j),!r)throw n;return n},Ce=function(t,e,r,n){var s=t.length,o=n?n.length:0;if(!s||e.f&&!e.l)return r||new I(0);var a=!r||e.i!=2,l=e.i;r||(r=new I(s*3));var i=function(Pe){var je=r.length;if(Pe>je){var Ie=new I(Math.max(je*2,Pe));Ie.set(r),r=Ie}},f=e.f||0,u=e.p||0,c=e.b||0,g=e.l,h=e.d,d=e.m,$=e.n,v=s*8;do{if(!g){f=H(t,u,1);var p=H(t,u+1,3);if(u+=3,p)if(p==1)g=vr,h=wr,d=9,$=5;else if(p==2){var y=H(t,u,31)+257,S=H(t,u+10,15)+4,A=y+H(t,u+5,31)+1;u+=14;for(var N=new I(A),R=new I(19),O=0;O<S;++O)R[dr[O]]=H(t,u+O*3,7);u+=S*3;for(var Be=Te(R),vt=(1<<Be)-1,wt=he(R,Be,1),O=0;O<A;){var ze=wt[H(t,u,vt)];u+=ze&15;var m=ze>>4;if(m<16)N[O++]=m;else{var Q=0,ge=0;for(m==16?(ge=3+H(t,u,3),u+=2,Q=N[O-1]):m==17?(ge=3+H(t,u,7),u+=3):m==18&&(ge=11+H(t,u,127),u+=7);ge--;)N[O++]=Q}}var Ae=N.subarray(0,y),Z=N.subarray(y);d=Te(Ae),$=Te(Z),g=he(Ae,d,1),h=he(Z,$,1)}else j(1);else{var m=br(u)+4,w=t[m-4]|t[m-3]<<8,M=m+w;if(M>s){l&&j(0);break}a&&i(c+w),r.set(t.subarray(m,M),c),e.b=c+=w,e.p=u=M*8,e.f=f;continue}if(u>v){l&&j(0);break}}a&&i(c+131072);for(var bt=(1<<d)-1,Tt=(1<<$)-1,ye=u;;ye=u){var Q=g[ke(t,u)&bt],ee=Q>>4;if(u+=Q&15,u>v){l&&j(0);break}if(Q||j(2),ee<256)r[c++]=ee;else if(ee==256){ye=u,g=null;break}else{var Ne=ee-254;if(ee>264){var O=ee-257,le=at[O];Ne=H(t,u,(1<<le)-1)+ct[O],u+=le}var ve=h[ke(t,u)&Tt],we=ve>>4;ve||j(3),u+=ve&15;var Z=yr[we];if(we>3){var le=lt[we];Z+=ke(t,u)&(1<<le)-1,u+=le}if(u>v){l&&j(0);break}a&&i(c+131072);var be=c+Ne;if(c<Z){var Oe=o-Z,kt=Math.min(Z,be);for(Oe+c<0&&j(3);c<kt;++c)r[c]=n[Oe+c]}for(;c<be;c+=4)r[c]=r[c-Z],r[c+1]=r[c+1-Z],r[c+2]=r[c+2-Z],r[c+3]=r[c+3-Z];c=be}}e.l=g,e.p=ye,e.b=c,e.f=f,g&&(f=1,e.m=d,e.d=h,e.n=$)}while(!f);return c==r.length?r:Tr(r,0,c)},Lr=new I(0),Sr=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&j(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=(t[10]|t[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[r++]);return r+(e&2)},Ur=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},Dr=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&j(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&j(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function Mr(t,e){return Ce(t,{i:2},e&&e.out,e&&e.dictionary)}function Er(t,e){var r=Sr(t);return r+8>t.length&&j(6,"invalid gzip data"),Ce(t.subarray(r,-8),{i:2},e&&e.out||new I(Ur(t)),e&&e.dictionary)}function Cr(t,e){return Ce(t.subarray(Dr(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Se(t,e){return t[0]==31&&t[1]==139&&t[2]==8?Er(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?Mr(t,e):Cr(t,e)}var Br=typeof TextDecoder<"u"&&new TextDecoder,zr=0;try{Br.decode(Lr,{stream:!0}),zr=1}catch{}var ht=(t,e)=>t*Math.pow(2,e),fe=(t,e)=>Math.floor(t/Math.pow(2,e)),_e=(t,e)=>ht(t.getUint16(e+1,!0),8)+t.getUint8(e),pt=(t,e)=>ht(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),Ar=(t,e,r,n,s)=>{if(t!=n.getUint8(s))return t-n.getUint8(s);const o=_e(n,s+1);if(e!=o)return e-o;const a=_e(n,s+4);return r!=a?r-a:0},Nr=(t,e,r,n)=>{const s=gt(t,e|128,r,n);return s?{z:e,x:r,y:n,offset:s[0],length:s[1],is_dir:!0}:null},Ke=(t,e,r,n)=>{const s=gt(t,e,r,n);return s?{z:e,x:r,y:n,offset:s[0],length:s[1],is_dir:!1}:null},gt=(t,e,r,n)=>{let s=0,o=t.byteLength/17-1;for(;s<=o;){const a=o+s>>1,l=Ar(e,r,n,t,a*17);if(l>0)s=a+1;else if(l<0)o=a-1;else return[pt(t,a*17+7),t.getUint32(a*17+13,!0)]}return null},Or=(t,e)=>t.is_dir&&!e.is_dir?1:!t.is_dir&&e.is_dir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,dt=(t,e)=>{const r=t.getUint8(e*17);return{z:r&127,x:_e(t,e*17+1),y:_e(t,e*17+4),offset:pt(t,e*17+7),length:t.getUint32(e*17+13,!0),is_dir:r>>7===1}},xe=t=>{const e=[],r=new DataView(t);for(let n=0;n<r.byteLength/17;n++)e.push(dt(r,n));return Pr(e)},Pr=t=>{t.sort(Or);const e=new ArrayBuffer(17*t.length),r=new Uint8Array(e);for(let n=0;n<t.length;n++){const s=t[n];let o=s.z;s.is_dir&&(o=o|128),r[n*17]=o,r[n*17+1]=s.x&255,r[n*17+2]=s.x>>8&255,r[n*17+3]=s.x>>16&255,r[n*17+4]=s.y&255,r[n*17+5]=s.y>>8&255,r[n*17+6]=s.y>>16&255,r[n*17+7]=s.offset&255,r[n*17+8]=fe(s.offset,8)&255,r[n*17+9]=fe(s.offset,16)&255,r[n*17+10]=fe(s.offset,24)&255,r[n*17+11]=fe(s.offset,32)&255,r[n*17+12]=fe(s.offset,48)&255,r[n*17+13]=s.length&255,r[n*17+14]=s.length>>8&255,r[n*17+15]=s.length>>16&255,r[n*17+16]=s.length>>24&255}return e},jr=(t,e)=>{if(t.byteLength<17)return null;const r=t.byteLength/17,n=dt(t,r-1);if(n.is_dir){const s=n.z,o=e.z-s,a=Math.trunc(e.x/(1<<o)),l=Math.trunc(e.y/(1<<o));return{z:s,x:a,y:l}}return null};function Ir(t){return P(this,null,function*(){const e=yield t.getBytes(0,512e3),r=new DataView(e.data),n=r.getUint32(4,!0),s=r.getUint16(8,!0),o=new TextDecoder("utf-8"),a=JSON.parse(o.decode(new DataView(e.data,10,n)));let l=0;a.compression==="gzip"&&(l=2);let i=0;"minzoom"in a&&(i=+a.minzoom);let f=0;"maxzoom"in a&&(f=+a.maxzoom);let u=0,c=0,g=0,h=-180,d=-85,$=180,v=85;if(a.bounds){const m=a.bounds.split(",");h=+m[0],d=+m[1],$=+m[2],v=+m[3]}if(a.center){const m=a.center.split(",");u=+m[0],c=+m[1],g=+m[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:l,tileType:1,minZoom:i,maxZoom:f,minLon:h,minLat:d,maxLon:$,maxLat:v,centerZoom:g,centerLon:u,centerLat:c,etag:e.etag}})}function Vr(t,e,r,n,s,o,a){return P(this,null,function*(){let l=yield r.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(l=xe(l));const i=Ke(new DataView(l),n,s,o);if(i){let c=(yield e.getBytes(i.offset,i.length,a)).data;const g=new DataView(c);return g.getUint8(0)==31&&g.getUint8(1)==139&&(c=Se(new Uint8Array(c))),{data:c}}const f=jr(new DataView(l),{z:n,x:s,y:o});if(f){const u=Nr(new DataView(l),f.z,f.x,f.y);if(u){let c=yield r.getArrayBuffer(e,u.offset,u.length,t);t.specVersion===1&&(c=xe(c));const g=Ke(new DataView(c),n,s,o);if(g){let d=(yield e.getBytes(g.offset,g.length,a)).data;const $=new DataView(d);return $.getUint8(0)==31&&$.getUint8(1)==139&&(d=Se(new Uint8Array(d))),{data:d}}}}})}var _t={getHeader:Ir,getZxy:Vr},Zr=class{constructor(){this.tile=(t,e)=>{if(t.type=="json"){const r=t.url.substr(10);let n=this.tiles.get(r);return n||(n=new qe(r),this.tiles.set(r,n)),n.getHeader().then(s=>{const o={tiles:[t.url+"/{z}/{x}/{y}"],minzoom:s.minZoom,maxzoom:s.maxZoom,bounds:[s.minLon,s.minLat,s.maxLon,s.maxLat]};e(null,o,null,null)}).catch(s=>{e(s,null,null,null)}),{cancel:()=>{}}}else{const r=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=t.url.match(r);if(!n)throw new Error("Invalid PMTiles protocol URL");const s=n[1];let o=this.tiles.get(s);o||(o=new qe(s),this.tiles.set(s,o));const a=n[2],l=n[3],i=n[4],f=new AbortController,u=f.signal;let c=()=>{f.abort()};return o.getHeader().then(g=>{o.getZxy(+a,+l,+i,u).then(h=>{h?e(null,new Uint8Array(h.data),h.cacheControl,h.expires):g.tileType==1?e(null,new Uint8Array,null,null):e(null,null,null,null)}).catch(h=>{h.name!=="AbortError"&&e(h,null,null,null)})}),{cancel:c}}},this.tiles=new Map}add(t){this.tiles.set(t.source.getKey(),t)}get(t){return this.tiles.get(t)}};function te(t,e){return(e>>>0)*4294967296+(t>>>0)}function Hr(t,e){const r=e.buf;let n,s;if(s=r[e.pos++],n=(s&112)>>4,s<128||(s=r[e.pos++],n|=(s&127)<<3,s<128)||(s=r[e.pos++],n|=(s&127)<<10,s<128)||(s=r[e.pos++],n|=(s&127)<<17,s<128)||(s=r[e.pos++],n|=(s&127)<<24,s<128)||(s=r[e.pos++],n|=(s&1)<<31,s<128))return te(t,n);throw new Error("Expected varint not more than 10 bytes")}function ue(t){const e=t.buf;let r,n;return n=e[t.pos++],r=n&127,n<128||(n=e[t.pos++],r|=(n&127)<<7,n<128)||(n=e[t.pos++],r|=(n&127)<<14,n<128)||(n=e[t.pos++],r|=(n&127)<<21,n<128)?r:(n=e[t.pos],r|=(n&15)<<28,Hr(r,t))}function Fr(t,e,r,n){if(n==0){r==1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}var Rr=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Kr(t,e,r){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,t)-1||r>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");const n=Rr[t],s=Math.pow(2,t);let o=0,a=0,l=0;const i=[e,r];let f=s/2;for(;f>0;)o=(i[0]&f)>0?1:0,a=(i[1]&f)>0?1:0,l+=f*f*(3*o^a),Fr(f,i,o,a),f=f/2;return n+l}function $t(t,e){return P(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Se(new Uint8Array(t));{let n=new Response(t).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}}else throw Error("Compression method not supported")})}var xr=127;function qr(t,e){let r=0,n=t.length-1;for(;r<=n;){const s=n+r>>1,o=e-t[s].tileId;if(o>0)r=s+1;else if(o<0)n=s-1;else return t[s]}return n>=0&&(t[n].runLength===0||e-t[n].tileId<t[n].runLength)?t[n]:null}var Gr=class{constructor(t){this.url=t}getKey(){return this.url}getBytes(t,e,r){return P(this,null,function*(){let n;r||(n=new AbortController,r=n.signal);let s=yield fetch(this.url,{signal:r,headers:{Range:"bytes="+t+"-"+(t+e-1)}});if(s.status===416&&t===0){const l=s.headers.get("Content-Range");if(!l||!l.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const i=+l.substr(8);s=yield fetch(this.url,{signal:r,headers:{Range:"bytes=0-"+(i-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function F(t,e){const r=t.getUint32(e+4,!0),n=t.getUint32(e+0,!0);return r*Math.pow(2,32)+n}function Jr(t,e){const r=new DataView(t),n=r.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:F(r,8),rootDirectoryLength:F(r,16),jsonMetadataOffset:F(r,24),jsonMetadataLength:F(r,32),leafDirectoryOffset:F(r,40),leafDirectoryLength:F(r,48),tileDataOffset:F(r,56),tileDataLength:F(r,64),numAddressedTiles:F(r,72),numTileEntries:F(r,80),numTileContents:F(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:e}}function yt(t){const e={buf:new Uint8Array(t),pos:0},r=ue(e),n=[];let s=0;for(let o=0;o<r;o++){const a=ue(e);n.push({tileId:s+a,offset:0,length:0,runLength:1}),s+=a}for(let o=0;o<r;o++)n[o].runLength=ue(e);for(let o=0;o<r;o++)n[o].length=ue(e);for(let o=0;o<r;o++){const a=ue(e);a===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=a-1}return n}function Wr(t){const e=new DataView(t);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var ne=class extends Error{};function Yr(t,e,r,n){return P(this,null,function*(){const s=yield t.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Wr(s.data)<3)return[yield _t.getHeader(t)];const a=s.data.slice(0,xr);let l=s.etag;n&&s.etag!=n&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),l=void 0);const i=Jr(a,l);if(r){const f=s.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),u=t.getKey()+"|"+(i.etag||"")+"|"+i.rootDirectoryOffset+"|"+i.rootDirectoryLength,c=yt(yield e(f,i.internalCompression));return[i,[u,c.length,c]]}return[i,void 0]})}function Xr(t,e,r,n,s){return P(this,null,function*(){const o=yield t.getBytes(r,n);if(s.etag&&s.etag!==o.etag)throw new ne(o.etag);const a=yield e(o.data,s.internalCompression),l=yt(a);if(l.length===0)throw new Error("Empty directory is invalid");return l})}var Qr=class{constructor(t=100,e=!0,r=$t){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.prefetch=e,this.decompress=r}getHeader(t,e){return P(this,null,function*(){const r=t.getKey();if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const n=new Promise((s,o)=>{Yr(t,this.decompress,this.prefetch,e).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),s(a[0]),this.prune()}).catch(a=>{o(a)})});return this.cache.set(r,{lastUsed:this.counter++,data:n}),n})}getDirectory(t,e,r,n){return P(this,null,function*(){const s=t.getKey()+"|"+(n.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((a,l)=>{Xr(t,this.decompress,e,r,n).then(i=>{a(i),this.prune()}).catch(i=>{l(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}getArrayBuffer(t,e,r,n){return P(this,null,function*(){const s=t.getKey()+"|"+(n.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((a,l)=>{t.getBytes(e,r).then(i=>{if(n.etag&&n.etag!==i.etag)throw new ne(i.etag);a(i.data),this.cache.has(s),this.prune()}).catch(i=>{l(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((r,n)=>{r.lastUsed<t&&(t=r.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(t,e){return P(this,null,function*(){this.cache.delete(t.getKey()),yield this.getHeader(t,e)})}},qe=class{constructor(t,e,r){typeof t=="string"?this.source=new Gr(t):this.source=t,r?this.decompress=r:this.decompress=$t,e?this.cache=e:this.cache=new Qr}getHeader(){return P(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,r,n){return P(this,null,function*(){const s=Kr(t,e,r),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return _t.getZxy(o,this.source,this.cache,t,e,r,n);if(t<o.minZoom||t>o.maxZoom)return;let a=o.rootDirectoryOffset,l=o.rootDirectoryLength;for(let i=0;i<=3;i++){const f=yield this.cache.getDirectory(this.source,a,l,o),u=qr(f,s);if(u)if(u.runLength>0){const c=yield this.source.getBytes(o.tileDataOffset+u.offset,u.length,n);if(o.etag&&o.etag!==c.etag)throw new ne(c.etag);return{data:yield this.decompress(c.data,o.tileCompression),cacheControl:c.cacheControl,expires:c.expires}}else a=o.leafDirectoryOffset+u.offset,l=u.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,r,n){return P(this,null,function*(){try{return yield this.getZxyAttempt(t,e,r,n)}catch(s){if(s instanceof ne)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(t,e,r,n);throw s}})}getMetadataAttempt(){return P(this,null,function*(){const t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength);if(t.etag&&t.etag!==e.etag)throw new ne(e.etag);const r=yield this.decompress(e.data,t.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(r))})}getMetadata(){return P(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof ne)return this.cache.invalidate(this.source,t.message),yield this.getMetadataAttempt();throw t}})}};function en(t){return Ue(()=>{let e=new Zr;Ze.addProtocol("pmtiles",e.tile)}),rt(()=>{Ze.removeProtocol("pmtiles")}),[]}class tn extends J{constructor(e){super(),W(this,e,en,null,Y,{})}}function Ge(t,e,r){const n=t.slice();return n[15]=e[r],n}function rn(t){let e;return{c(){e=B("Home")},m(r,n){U(r,e,n)},d(r){r&&D(e)}}}function Je(t){let e,r;return e=new At({props:{errorMessage:t[1]}}),{c(){T(e.$$.fragment)},m(n,s){k(e,n,s),r=!0},p(n,s){const o={};s&2&&(o.errorMessage=n[1]),e.$set(o)},i(n){r||(_(e.$$.fragment,n),r=!0)},o(n){b(e.$$.fragment,n),r=!1},d(n){L(e,n)}}}function We(t){let e,r,n,s;function o(i){t[10](i)}function a(i){t[11](i)}let l={schemes:t[2]};return t[3]!==void 0&&(l.schemesToBeShown=t[3]),t[4]!==void 0&&(l.filterText=t[4]),e=new Jt({props:l}),oe.push(()=>ie(e,"schemesToBeShown",o)),oe.push(()=>ie(e,"filterText",a)),{c(){T(e.$$.fragment)},m(i,f){k(e,i,f),s=!0},p(i,f){const u={};f&4&&(u.schemes=i[2]),!r&&f&8&&(r=!0,u.schemesToBeShown=i[3],ae(()=>r=!1)),!n&&f&16&&(n=!0,u.filterText=i[4],ae(()=>n=!1)),e.$set(u)},i(i){s||(_(e.$$.fragment,i),s=!0)},o(i){b(e.$$.fragment,i),s=!1},d(i){L(e,i)}}}function Ye(t){let e,r,n=Fe(t[2].values()),s=[];for(let a=0;a<n.length;a+=1)s[a]=Qe(Ge(t,n,a));const o=a=>b(s[a],1,1,()=>{s[a]=null});return{c(){e=V("ul");for(let a=0;a<s.length;a+=1)s[a].c()},m(a,l){U(a,e,l);for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(e,null);r=!0},p(a,l){if(l&13){n=Fe(a[2].values());let i;for(i=0;i<n.length;i+=1){const f=Ge(a,n,i);s[i]?(s[i].p(f,l),_(s[i],1)):(s[i]=Qe(f),s[i].c(),_(s[i],1),s[i].m(e,null))}for(ce(),i=n.length;i<s.length;i+=1)o(i);me()}},i(a){if(!r){for(let l=0;l<n.length;l+=1)_(s[l]);r=!0}},o(a){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)b(s[l]);r=!1},d(a){a&&D(e),Nt(s,a)}}}function Xe(t){let e,r;return e=new mr({props:{scheme:t[15],authorityNames:t[0]}}),{c(){T(e.$$.fragment)},m(n,s){k(e,n,s),r=!0},p(n,s){const o={};s&4&&(o.scheme=n[15]),s&1&&(o.authorityNames=n[0]),e.$set(o)},i(n){r||(_(e.$$.fragment,n),r=!0)},o(n){b(e.$$.fragment,n),r=!1},d(n){L(e,n)}}}function Qe(t){let e=t[3].has(t[15].scheme_reference),r,n,s=e&&Xe(t);return{c(){s&&s.c(),r=Ot()},m(o,a){s&&s.m(o,a),U(o,r,a),n=!0},p(o,a){a&12&&(e=o[3].has(o[15].scheme_reference)),e?s?(s.p(o,a),a&12&&_(s,1)):(s=Xe(o),s.c(),_(s,1),s.m(r.parentNode,r)):s&&(ce(),b(s,1,1,()=>{s=null}),me())},i(o){n||(_(s),n=!0)},o(o){b(s),n=!1},d(o){o&&D(r),s&&s.d(o)}}}function nn(t){let e,r,n,s,o,a,l,i,f,u,c,g,h;r=new de({props:{$$slots:{default:[rn]},$$scope:{ctx:t}}}),r.$on("click",t[9]),l=new jt({props:{boundaryGeojson:t[5]}});let d=t[1]&&Je(t);u=new Mt({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:t[7]}});let $=t[2].size>0&&We(t),v=t[0]&&Ye(t);return{c(){e=V("div"),T(r.$$.fragment),n=z(),s=V("div"),o=V("h1"),o.textContent="Browse schemes",a=z(),T(l.$$.fragment),i=z(),d&&d.c(),f=z(),T(u.$$.fragment),c=z(),$&&$.c(),g=z(),v&&v.c(),He(s,"display","flex"),He(s,"justify-content","space-between"),G(e,"slot","sidebar"),G(e,"class","govuk-prose")},m(p,m){U(p,e,m),k(r,e,null),C(e,n),C(e,s),C(s,o),C(s,a),k(l,s,null),C(e,i),d&&d.m(e,null),C(e,f),k(u,e,null),C(e,c),$&&$.m(e,null),C(e,g),v&&v.m(e,null),h=!0},p(p,m){const w={};m&262144&&(w.$$scope={dirty:m,ctx:p}),r.$set(w);const M={};m&32&&(M.boundaryGeojson=p[5]),l.$set(M),p[1]?d?(d.p(p,m),m&2&&_(d,1)):(d=Je(p),d.c(),_(d,1),d.m(e,f)):d&&(ce(),b(d,1,1,()=>{d=null}),me()),p[2].size>0?$?($.p(p,m),m&4&&_($,1)):($=We(p),$.c(),_($,1),$.m(e,g)):$&&(ce(),b($,1,1,()=>{$=null}),me()),p[0]?v?(v.p(p,m),m&1&&_(v,1)):(v=Ye(p),v.c(),_(v,1),v.m(e,null)):v&&(ce(),b(v,1,1,()=>{v=null}),me())},i(p){h||(_(r.$$.fragment,p),_(l.$$.fragment,p),_(d),_(u.$$.fragment,p),_($),_(v),h=!0)},o(p){b(r.$$.fragment,p),b(l.$$.fragment,p),b(d),b(u.$$.fragment,p),b($),b(v),h=!1},d(p){p&&D(e),L(r),L(l),d&&d.d(),L(u),$&&$.d(),v&&v.d()}}}function sn(t){let e,r,n,s,o,a;return e=new pr({}),n=new er({}),o=new ir({}),{c(){T(e.$$.fragment),r=z(),T(n.$$.fragment),s=z(),T(o.$$.fragment)},m(l,i){k(e,l,i),U(l,r,i),k(n,l,i),U(l,s,i),k(o,l,i),a=!0},i(l){a||(_(e.$$.fragment,l),_(n.$$.fragment,l),_(o.$$.fragment,l),a=!0)},o(l){b(e.$$.fragment,l),b(n.$$.fragment,l),b(o.$$.fragment,l),a=!1},d(l){l&&(D(r),D(s)),L(e,l),L(n,l),L(o,l)}}}function on(t){let e,r,n,s;return e=new Zt({props:{style:t[6]}}),n=new Ht({props:{small:!0,$$slots:{default:[sn]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment),r=z(),T(n.$$.fragment)},m(o,a){k(e,o,a),U(o,r,a),k(n,o,a),s=!0},p(o,a){const l={};a&262144&&(l.$$scope={dirty:a,ctx:o}),n.$set(l)},i(o){s||(_(e.$$.fragment,o),_(n.$$.fragment,o),s=!0)},o(o){b(e.$$.fragment,o),b(n.$$.fragment,o),s=!1},d(o){o&&D(r),L(e,o),L(n,o)}}}function an(t){let e,r,n,s,o,a,l;return e=new Vt({props:{schema:un}}),n=new De({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:t[8]}}),a=new Ee({props:{label:"Layers",open:!0,$$slots:{default:[on]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment),r=z(),T(n.$$.fragment),s=z(),o=V("div"),T(a.$$.fragment),G(o,"class","top-right svelte-nlvvhu")},m(i,f){k(e,i,f),U(i,r,f),k(n,i,f),U(i,s,f),U(i,o,f),k(a,o,null),l=!0},p(i,f){const u={};f&262144&&(u.$$scope={dirty:f,ctx:i}),a.$set(u)},i(i){l||(_(e.$$.fragment,i),_(n.$$.fragment,i),_(a.$$.fragment,i),l=!0)},o(i){b(e.$$.fragment,i),b(n.$$.fragment,i),b(a.$$.fragment,i),l=!1},d(i){i&&(D(r),D(s),D(o)),L(e,i),L(n,i),L(a)}}}function ln(t){let e,r,n,s,o;return r=new tn({}),s=new It({props:{style:t[6],$$slots:{default:[an]},$$scope:{ctx:t}}}),{c(){e=V("div"),T(r.$$.fragment),n=z(),T(s.$$.fragment),G(e,"slot","main")},m(a,l){U(a,e,l),k(r,e,null),C(e,n),k(s,e,null),o=!0},p(a,l){const i={};l&262144&&(i.$$scope={dirty:l,ctx:a}),s.$set(i)},i(a){o||(_(r.$$.fragment,a),_(s.$$.fragment,a),o=!0)},o(a){b(r.$$.fragment,a),b(s.$$.fragment,a),o=!1},d(a){a&&D(e),L(r),L(s)}}}function fn(t){let e,r;return e=new Pt({props:{$$slots:{main:[ln],sidebar:[nn]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},m(n,s){k(e,n,s),r=!0},p(n,[s]){const o={};s&262207&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){r||(_(e.$$.fragment,n),r=!0)},o(n){b(e.$$.fragment,n),r=!1},d(n){L(e,n)}}}const un="v1";function cn(t,e,r){let n,s;X(t,$e,m=>r(12,n=m)),X(t,se,m=>r(5,s=m));let o=null;Ue(async()=>{Et();let m=await Ct();r(0,o=new Set(m.features.map(w=>w.properties.name)))});let l=new URLSearchParams(window.location.search).get("style")||"streets",i="",f=new Map,u=new Set,c="";rt(()=>{se.set(Bt())});function g(m){try{let w=JSON.parse(m);r(2,f=Ft(w)),se.set(w),r(1,i=""),n==null||n.fitBounds(tt(w),{padding:20,animate:!1})}catch(w){r(1,i=`Couldn't load schemes from a file: ${w}`)}}function h(m){var w='<div style="max-width: 30vw;">';return w+=`<h2>${d(m.name)} (${m.intervention_type})</h2>`,w+=`<p>Scheme reference: ${m.scheme_reference}</p>`,m.length_meters&&(w+=`<p>Length: ${zt(m.length_meters)}</p>`),m.description&&(w+=`<p>${d(m.description)}</p>`),w+="</div>",w}function d(m){return c?m.replace(new RegExp(c,"gi"),w=>`<mark>${w}</mark>`):m}const $=()=>window.open("index.html");function v(m){u=m,r(3,u)}function p(m){c=m,r(4,c)}return[o,i,f,u,c,s,l,g,h,$,v,p]}class mn extends J{constructor(e){super(),W(this,e,cn,fn,Y,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new mn({target:document.getElementById("app")});
