import{S as K,i as Z,s as Q,c as me,a as W,e as p,b as ae,d as I,l as H,u as ge,g as ve,f as be,h as ke,t as C,j as L,k as T,m as oe,n as _e,o as se,p as q,q as w,r as h,v as _,w as X,x as ie,y as ye,z as we,A as R,B as $e,C as Ae,F as Se,D as z,E as ue,G as Be,H as D,I as J,J as re,K as O,L as Ee,M as Fe,N as Ie}from"./maplibre_helpers-5d84afaa.js";import{i as Te}from"./all-9c3b21fd.js";import{A as Ne,a as je}from"./About-e3bb572d.js";function Ce(l){let t,e,o,u;const f=l[2].default,a=me(f,l,l[1],null);let i=[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},l[0]],s={};for(let n=0;n<i.length;n+=1)s=W(s,i[n]);return{c(){t=p("button"),a&&a.c(),ae(t,s)},m(n,d){I(n,t,d),a&&a.m(t,null),t.autofocus&&t.focus(),e=!0,o||(u=H(t,"click",l[3]),o=!0)},p(n,[d]){a&&a.p&&(!e||d&2)&&ge(a,f,n,n[1],e?be(f,n[1],d,null):ve(n[1]),null),ae(t,s=ke(i,[{type:"button"},{class:"govuk-button"},{"data-module":"govuk-button"},d&1&&n[0]]))},i(n){e||(C(a,n),e=!0)},o(n){L(a,n),e=!1},d(n){n&&T(t),a&&a.d(n),o=!1,u()}}}function Le(l,t,e){let{$$slots:o={},$$scope:u}=t;function f(a){_e.call(this,l,a)}return l.$$set=a=>{e(0,t=W(W({},t),oe(a))),"$$scope"in a&&e(1,u=a.$$scope)},t=oe(t),[t,u,o,f]}class De extends K{constructor(t){super(),Z(this,t,Le,Ce,Q,{})}}function fe(l,t,e){const o=l.slice();return o[7]=t[e][0],o[8]=t[e][1],o}function de(l){let t,e,o,u,f=!1,a,i,s=l[8]+"",n,d,c,B,v,j;return B=we(l[6][0]),{c(){t=p("div"),e=p("input"),a=w(),i=p("label"),n=q(s),c=w(),h(e,"class","govuk-radios__input"),h(e,"id",o=l[2]+l[7]),h(e,"type","radio"),e.__value=u=l[7],R(e,e.__value),h(i,"class","govuk-label govuk-radios__label"),h(i,"for",d=l[2]+l[7]),h(t,"class","govuk-radios__item"),B.p(e)},m(m,$){I(m,t,$),_(t,e),e.checked=e.__value===l[0],_(t,a),_(t,i),_(i,n),_(t,c),v||(j=[H(e,"change",l[5]),H(e,"change",l[4])],v=!0)},p(m,$){$&12&&o!==(o=m[2]+m[7])&&h(e,"id",o),$&8&&u!==(u=m[7])&&(e.__value=u,R(e,e.__value),f=!0),(f||$&9)&&(e.checked=e.__value===m[0]),$&8&&s!==(s=m[8]+"")&&X(n,s),$&12&&d!==(d=m[2]+m[7])&&h(i,"for",d)},d(m){m&&T(t),B.r(),v=!1,$e(j)}}}function Je(l){let t,e,o,u,f,a,i=se(l[3]),s=[];for(let n=0;n<i.length;n+=1)s[n]=de(fe(l,i,n));return{c(){t=p("div"),e=p("fieldset"),o=p("legend"),u=q(l[1]),f=w(),a=p("div");for(let n=0;n<s.length;n+=1)s[n].c();h(o,"class","govuk-fieldset__legend"),h(a,"class","govuk-radios"),h(a,"data-module","govuk-radios"),h(e,"class","govuk-fieldset"),h(t,"class","govuk-form-group")},m(n,d){I(n,t,d),_(t,e),_(e,o),_(o,u),_(e,f),_(e,a);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(a,null)},p(n,[d]){if(d&2&&X(u,n[1]),d&13){i=se(n[3]);let c;for(c=0;c<i.length;c+=1){const B=fe(n,i,c);s[c]?s[c].p(B,d):(s[c]=de(B),s[c].c(),s[c].m(a,null))}for(;c<s.length;c+=1)s[c].d(1);s.length=i.length}},i:ie,o:ie,d(n){n&&T(t),ye(s,n)}}}function Oe(l,t,e){let{legend:o}=t,{id:u}=t,{choices:f}=t,{value:a}=t;const i=[[]];function s(d){_e.call(this,l,d)}function n(){a=this.__value,e(0,a)}return l.$$set=d=>{"legend"in d&&e(1,o=d.legend),"id"in d&&e(2,u=d.id),"choices"in d&&e(3,f=d.choices),"value"in d&&e(0,a=d.value)},[a,o,u,f,s,n,i]}class Me extends K{constructor(t){super(),Z(this,t,Oe,Je,Q,{legend:1,id:2,choices:3,value:0})}}function qe(l){let t;return{c(){t=q("About")},m(e,o){I(e,t,o)},d(e){e&&T(t)}}}function Ge(l){let t,e,o,u,f;return{c(){t=p("input"),e=w(),o=p("datalist"),h(t,"class","govuk-input govuk-input--width-20"),h(t,"id","inputValue"),h(t,"data-testid","transport-authority"),h(t,"list","authorities-list"),h(o,"id","authorities-list")},m(a,i){I(a,t,i),R(t,l[0]),I(a,e,i),I(a,o,i),l[11](o),u||(f=H(t,"input",l[10]),u=!0)},p(a,i){i&1&&t.value!==a[0]&&R(t,a[0])},d(a){a&&(T(t),T(e),T(o)),l[11](null),u=!1,f()}}}function Pe(l){let t;return{c(){t=q("Start")},m(e,o){I(e,t,o)},d(e){e&&T(t)}}}function ce(l){let t,e;return{c(){t=p("i"),e=q(l[4])},m(o,u){I(o,t,u),_(t,e)},p(o,u){u&16&&X(e,o[4])},d(o){o&&T(t)}}}function Ve(l){let t,e,o,u,f,a,i,s,n,d,c,B,v,j,m,$,G,P,g,b,E,A,F,S,N;f=new Ae({props:{$$slots:{default:[qe]},$$scope:{ctx:l}}}),f.$on("click",l[9]),i=new Se({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[Ge]},$$scope:{ctx:l}}}),n=new De({props:{disabled:!l[5],$$slots:{default:[Pe]},$$scope:{ctx:l}}}),n.$on("click",l[8]);function he(r){l[12](r)}let Y={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]]};l[3]!==void 0&&(Y.value=l[3]),v=new Me({props:Y}),z.push(()=>ue(v,"value",he)),v.$on("change",l[6]);let k=l[4]&&ce(l);g=new Be({props:{label:"Or upload an ATIP GeoJSON file",loadFile:l[7],id:"load-geojson"}});function pe(r){l[13](r)}let x={};return l[1]!==void 0&&(x.open=l[1]),F=new Ne({props:x}),z.push(()=>ue(F,"open",pe)),{c(){t=p("div"),e=p("div"),o=p("h1"),o.textContent="Welcome to ATIP v2",u=w(),D(f.$$.fragment),a=w(),D(i.$$.fragment),s=w(),D(n.$$.fragment),d=w(),c=p("hr"),B=w(),D(v.$$.fragment),m=w(),k&&k.c(),$=w(),G=p("hr"),P=w(),D(g.$$.fragment),b=w(),E=p("div"),E.innerHTML='<div id="map" class="svelte-lyn11h"></div>',A=w(),D(F.$$.fragment),h(o,"class","govuk-heading-l"),h(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),h(E,"class","govuk-grid-column-one-half"),h(t,"class","govuk-grid-row")},m(r,y){I(r,t,y),_(t,e),_(e,o),_(e,u),J(f,e,null),_(e,a),J(i,e,null),_(e,s),J(n,e,null),_(e,d),_(e,c),_(e,B),J(v,e,null),_(e,m),k&&k.m(e,null),_(e,$),_(e,G),_(e,P),J(g,e,null),_(t,b),_(t,E),I(r,A,y),J(F,r,y),N=!0},p(r,[y]){const ee={};y&65536&&(ee.$$scope={dirty:y,ctx:r}),f.$set(ee);const te={};y&65541&&(te.$$scope={dirty:y,ctx:r}),i.$set(te);const U={};y&32&&(U.disabled=!r[5]),y&65536&&(U.$$scope={dirty:y,ctx:r}),n.$set(U);const le={};!j&&y&8&&(j=!0,le.value=r[3],re(()=>j=!1)),v.$set(le),r[4]?k?k.p(r,y):(k=ce(r),k.c(),k.m(e,$)):k&&(k.d(1),k=null);const ne={};!S&&y&2&&(S=!0,ne.open=r[1],re(()=>S=!1)),F.$set(ne)},i(r){N||(C(f.$$.fragment,r),C(i.$$.fragment,r),C(n.$$.fragment,r),C(v.$$.fragment,r),C(g.$$.fragment,r),C(F.$$.fragment,r),N=!0)},o(r){L(f.$$.fragment,r),L(i.$$.fragment,r),L(n.$$.fragment,r),L(v.$$.fragment,r),L(g.$$.fragment,r),L(F.$$.fragment,r),N=!1},d(r){r&&(T(t),T(A)),O(f),O(i),O(n),O(v),k&&k.d(),O(g),O(F,r)}}}let V="boundary",M="boundary-layer";function He(l){if(l.features.length>0){let t=l.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function Re(l,t,e){let o,u=!1,f,a,i=new Set,s=null,n="TA";function d(){s==null||s.setFilter(M,["==",["get","level"],n])}let c=null;Ee(async()=>{Te();const b=await(await fetch(je)).text(),E=JSON.parse(b);for(let S of E.features){let N=document.createElement("option");N.value=S.properties.name,a.appendChild(N),i.add(S.properties.name)}s=new Fe.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let A=null;function F(){A!==null&&s.setFeatureState({source:V,id:A},{hover:!1})}s.on("load",function(){s.fitBounds(Ie(E),{padding:20,animate:!1}),s.addSource(V,{type:"geojson",data:E,generateId:!0}),s.addLayer({id:M,source:V,filter:["==",["get","level"],n],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),s.on("mousemove",M,S=>{S.features.length>0&&(F(),A=S.features[0].id,e(4,c=S.features[0].properties.name),s.setFeatureState({source:V,id:A},{hover:!0}))}),s.on("mouseleave",M,()=>{F(),A=null,e(4,c=null)}),s.on("click",M,function(S){let N=S.features[0].properties.name;window.location.href=`scheme.html?authority=${N}`})})});function B(g){try{let b=JSON.parse(g);if(!b.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!i.has(b.authority))throw new Error(`Unknown authority ${b.authority}`);let E=b.authority,A=He(b);A!="v1"&&(E+=`_${A}`),window.localStorage.setItem(E,JSON.stringify(b)),window.location.href=`scheme.html?authority=${b.authority}&schema=${A}`}catch(b){window.alert(`Couldn't load scheme from a file: ${b}`)}}function v(){window.location.href=`scheme.html?authority=${f}`}const j=()=>e(1,u=!u);function m(){f=this.value,e(0,f)}function $(g){z[g?"unshift":"push"](()=>{a=g,e(2,a)})}function G(g){n=g,e(3,n)}function P(g){u=g,e(1,u)}return l.$$.update=()=>{l.$$.dirty&1&&e(5,o=i.has(f))},[f,u,a,n,c,o,d,B,v,j,m,$,G,P]}class Ue extends K{constructor(t){super(),Z(this,t,Re,Ve,Q,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Ue({target:document.getElementById("app")});
