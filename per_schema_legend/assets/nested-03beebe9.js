var Wi=Object.defineProperty;var Vi=(r,e,t)=>e in r?Wi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ne=(r,e,t)=>(Vi(r,typeof e!="symbol"?e+"":e,t),t);import{S as Q,i as ee,s as Z,M as Ki,b as ie,a as Oe,d as j,m as q,k as $e,n as C,o as T,q as U,e as E,c as A,g as k,x as z,p as S,y as ze,f as O,z as we,B as ke,C as Zi,D as er,E as $n,F as zt,G as ht,H as mt,I as _t,J as gt,K as pr,h as w,l as B,L as Qi,N as eo,O as oe,P as to,w as tr,Q as ot,R as Se,T as vn,t as Y,U as he,V as fe,j as Pe,r as xe,W as He,X as ai,Y as ui,Z as Ht,_ as yt,$ as ln,a0 as dr,a1 as no,a2 as ro,a3 as Be,a4 as io,a5 as oo,a6 as so,a7 as an,a8 as fi,a9 as wn,aa as St,ab as kn,ac as Dt,ad as Sn,ae as Fn,af as lo,ag as bt,ah as nr,ai as et,aj as vt,ak as ao,al as rr,am as uo,an as fo,ao as co,ap as hr,aq as un,ar as po,as as ho,at as mo,A as _o,u as go}from"./authorities-645e0394.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ci=Symbol("Comlink.proxy"),bo=Symbol("Comlink.endpoint"),yo=Symbol("Comlink.releaseProxy"),Ln=Symbol("Comlink.finalizer"),Zt=Symbol("Comlink.thrown"),pi=r=>typeof r=="object"&&r!==null||typeof r=="function",vo={canHandle:r=>pi(r)&&r[ci],serialize(r){const{port1:e,port2:t}=new MessageChannel;return ir(r,e),[t,[t]]},deserialize(r){return r.start(),mi(r)}},wo={canHandle:r=>pi(r)&&Zt in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},di=new Map([["proxy",vo],["throw",wo]]);function ko(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function ir(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!ko(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(rt);let u;try{const p=a.slice(0,-1).reduce((c,f)=>c[f],r),m=a.reduce((c,f)=>c[f],r);switch(s){case"GET":u=m;break;case"SET":p[a.slice(-1)[0]]=rt(i.data.value),u=!0;break;case"APPLY":u=m.apply(p,l);break;case"CONSTRUCT":{const c=new m(...l);u=Lo(c)}break;case"ENDPOINT":{const{port1:c,port2:f}=new MessageChannel;ir(r,f),u=$o(c,[c])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[Zt]:0}}Promise.resolve(u).catch(p=>({value:p,[Zt]:0})).then(p=>{const[m,c]=pn(p);e.postMessage(Object.assign(Object.assign({},m),{id:o}),c),s==="RELEASE"&&(e.removeEventListener("message",n),hi(e),Ln in r&&typeof r[Ln]=="function"&&r[Ln]())}).catch(p=>{const[m,c]=pn({value:new TypeError("Unserializable return value"),[Zt]:0});e.postMessage(Object.assign(Object.assign({},m),{id:o}),c)})}),e.start&&e.start()}function So(r){return r.constructor.name==="MessagePort"}function hi(r){So(r)&&r.close()}function mi(r,e){return Nn(r,[],e)}function Wt(r){if(r)throw new Error("Proxy has been released and is not useable")}function _i(r){return ct(r,{type:"RELEASE"}).then(()=>{hi(r)})}const fn=new WeakMap,cn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(fn.get(r)||0)-1;fn.set(r,e),e===0&&_i(r)});function Eo(r,e){const t=(fn.get(e)||0)+1;fn.set(e,t),cn&&cn.register(r,e,r)}function Mo(r){cn&&cn.unregister(r)}function Nn(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(Wt(n),s===yo)return()=>{Mo(i),_i(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=ct(r,{type:"GET",path:e.map(l=>l.toString())}).then(rt);return a.then.bind(a)}return Nn(r,[...e,s])},set(o,s,a){Wt(n);const[l,u]=pn(a);return ct(r,{type:"SET",path:[...e,s].map(p=>p.toString()),value:l},u).then(rt)},apply(o,s,a){Wt(n);const l=e[e.length-1];if(l===bo)return ct(r,{type:"ENDPOINT"}).then(rt);if(l==="bind")return Nn(r,e.slice(0,-1));const[u,p]=mr(a);return ct(r,{type:"APPLY",path:e.map(m=>m.toString()),argumentList:u},p).then(rt)},construct(o,s){Wt(n);const[a,l]=mr(s);return ct(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(rt)}});return Eo(i,r),i}function Oo(r){return Array.prototype.concat.apply([],r)}function mr(r){const e=r.map(pn);return[e.map(t=>t[0]),Oo(e.map(t=>t[1]))]}const gi=new WeakMap;function $o(r,e){return gi.set(r,e),r}function Lo(r){return Object.assign(r,{[ci]:!0})}function pn(r){for(const[e,t]of di)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},gi.get(r)||[]]}function rt(r){switch(r.type){case"HANDLER":return di.get(r.name).deserialize(r.value);case"RAW":return r.value}}function ct(r,e,t){return new Promise(n=>{const i=Co();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function Co(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Ao(){return new Worker("/atip/per_schema_legend/assets/worker-77208dc1.js")}let re;const bi=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&bi.decode();let Lt=null;function xt(){return(Lt===null||Lt.byteLength===0)&&(Lt=new Uint8Array(re.memory.buffer)),Lt}function Ct(r,e){return r=r>>>0,bi.decode(xt().subarray(r,r+e))}const Xe=new Array(128).fill(void 0);Xe.push(void 0,null,!0,!1);let Pt=Xe.length;function be(r){Pt===Xe.length&&Xe.push(Xe.length+1);const e=Pt;return Pt=Xe[e],Xe[e]=r,e}function V(r){return Xe[r]}let it=0;const Qt=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Ro=typeof Qt.encodeInto=="function"?function(r,e){return Qt.encodeInto(r,e)}:function(r,e){const t=Qt.encode(r);return e.set(t),{read:r.length,written:t.length}};function Cn(r,e,t){if(t===void 0){const a=Qt.encode(r),l=e(a.length)>>>0;return xt().subarray(l,l+a.length).set(a),it=a.length,l}let n=r.length,i=e(n)>>>0;const o=xt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3)>>>0;const a=xt().subarray(i+s,i+n),l=Ro(r,a);s+=l.written}return it=s,i}function Mt(r){return r==null}let At=null;function Ee(){return(At===null||At.byteLength===0)&&(At=new Int32Array(re.memory.buffer)),At}function To(r){r<132||(Xe[r]=Pt,Pt=r)}function Bn(r){const e=V(r);return To(r),e}let Rt=null;function xo(){return(Rt===null||Rt.byteLength===0)&&(Rt=new Float64Array(re.memory.buffer)),Rt}let Tt=null;function Po(){return(Tt===null||Tt.byteLength===0)&&(Tt=new BigInt64Array(re.memory.buffer)),Tt}function Dn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Dn(r[0]));for(let s=1;s<i;s++)o+=", "+Dn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Io(r,e){const t=e(r.length*1)>>>0;return xt().set(r,t/1),it=r.length,t}function An(r,e){try{return r.apply(this,e)}catch(t){re.__wbindgen_exn_store(be(t))}}let jn=class{static __wrap(e){e=e>>>0;const t=Object.create(jn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();re.__wbg_routeinfo_free(e)}constructor(e){try{const o=re.__wbindgen_add_to_stack_pointer(-16),s=Io(e,re.__wbindgen_malloc),a=it;re.routeinfo_new(o,s,a);var t=Ee()[o/4+0],n=Ee()[o/4+1],i=Ee()[o/4+2];if(i)throw Bn(n);return jn.__wrap(t)}finally{re.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const p=re.__wbindgen_add_to_stack_pointer(-16);re.routeinfo_nameForRoute(p,this.__wbg_ptr,be(e));var i=Ee()[p/4+0],o=Ee()[p/4+1],s=Ee()[p/4+2],a=Ee()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,Bn(s);return t=l,n=u,Ct(l,u)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(t,n)}}};async function Fo(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function No(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Ct(e,t);return be(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=V(t),i=typeof n=="string"?n:void 0;var o=Mt(i)?0:Cn(i,re.__wbindgen_malloc,re.__wbindgen_realloc),s=it;Ee()[e/4+1]=s,Ee()[e/4+0]=o},r.wbg.__wbindgen_object_drop_ref=function(e){Bn(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Ct(e,t));return be(n)},r.wbg.__wbindgen_boolean_get=function(e){const t=V(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof V(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return be(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return V(e)===V(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=V(t),i=typeof n=="number"?n:void 0;xo()[e/8+1]=Mt(i)?0:i,Ee()[e/4+0]=!Mt(i)},r.wbg.__wbindgen_is_object=function(e){const t=V(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return V(e)in V(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return be(t)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return V(e)==V(t)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return be(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=V(t).stack,i=Cn(n,re.__wbindgen_malloc,re.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Ct(e,t))}finally{re.__wbindgen_free(n,i)}},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(V(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=V(e)[t>>>0];return be(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return V(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof V(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=V(e).next;return be(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return An(function(e){const t=V(e).next();return be(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return V(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=V(e).value;return be(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return be(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return An(function(e,t){const n=Reflect.get(V(e),V(t));return be(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return An(function(e,t){const n=V(e).call(V(t));return be(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(V(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=V(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(V(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(V(e));return be(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=V(e).buffer;return be(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(V(e));return be(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){V(e).set(V(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return V(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=V(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=V(t),i=typeof n=="bigint"?n:void 0;Po()[e/8+1]=Mt(i)?BigInt(0):i,Ee()[e/4+0]=!Mt(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Dn(V(t)),i=Cn(n,re.__wbindgen_malloc,re.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Ct(e,t))},r.wbg.__wbindgen_memory=function(){const e=re.memory;return be(e)},r}function Bo(r,e){return re=r.exports,yi.__wbindgen_wasm_module=e,Tt=null,Rt=null,At=null,Lt=null,re}async function yi(r){if(re!==void 0)return re;typeof r>"u"&&(r="/atip/per_schema_legend/assets/route_info_bg.wasm");const e=No();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Fo(await r,e);return Bo(t,n)}class Do{constructor(){ne(this,"inner");this.inner=null}async loadFile(e){await yi(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new jn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.nameForRoute(e)}}ir(Do);function jo(r){let e,t,n,i,o,s,a,l,u,p,m,c,f;return{c(){e=E("p"),e.textContent="For each intervention:",t=A(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=A(),o=E("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=A(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=A(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=A(),m=E("p"),m.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=A(),f=E("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(h,g){k(h,e,g),k(h,t,g),k(h,n,g),k(h,i,g),k(h,o,g),k(h,s,g),k(h,a,g),k(h,l,g),k(h,u,g),k(h,p,g),k(h,m,g),k(h,c,g),k(h,f,g)},p:z,d(h){h&&S(e),h&&S(t),h&&S(n),h&&S(i),h&&S(o),h&&S(s),h&&S(a),h&&S(l),h&&S(u),h&&S(p),h&&S(m),h&&S(c),h&&S(f)}}}function qo(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[jo]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new Ki({props:o}),ie.push(()=>Oe(e,"open",i,r[0])),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],$e(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Uo(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Go extends Q{constructor(e){super(),ee(this,e,Uo,qo,Z,{open:0})}}const st=[];function Et(r,e=z){let t;const n=new Set;function i(a){if(Z(r,a)&&(r=a,t)){const l=!st.length;for(const u of n)u[1](),st.push(u,r);if(l){for(let u=0;u<st.length;u+=2)st[u][0](st[u+1]);st.length=0}}}function o(a){i(a(r))}function s(a,l=z){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||z),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ye=Et(null),te=Et(ze()),Me=Et(null),Ue=Et(null),jt=Et(null),qt=Et(null);function Yt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function _r(r){console.log(`Deleting intervention ${r}`),te.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Me.set(null),Ue.set(null),jt.set(null),qt.set(null)}function gr(r){let e;const t=r[4].default,n=ht(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&mt(n,t,i,i[3],e?gt(t,i[3],o,null):_t(i[3]),null)},i(i){e||(C(n,i),e=!0)},o(i){T(n,i),e=!1},d(i){n&&n.d(i)}}}function zo(r){let e,t,n=r[1]&&gr(r);return{c(){e=E("div"),n&&n.c(),O(e,"class","map svelte-12dpf1u")},m(i,o){k(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&C(n,1)):(n=gr(i),n.c(),C(n,1),n.m(e,null)):n&&(we(),T(n,1,1,()=>{n=null}),ke())},i(i){t||(C(n),t=!0)},o(i){T(n),t=!1},d(i){i&&S(e),n&&n.d(),r[5](null)}}}function Ho(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;Zi("setCamera",!window.location.hash),er(()=>{s=new $n.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new $n.ScaleControl({})),s.addControl(new $n.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ye.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),zt(()=>{s.remove()});function u(p){ie[p?"unshift":"push"](()=>{a=p,t(0,a)})}return r.$$set=p=>{"style"in p&&t(2,o=p.style),"$$scope"in p&&t(3,i=p.$$scope)},[a,l,o,i,n,u]}class Yo extends Q{constructor(e){super(),ee(this,e,Ho,zo,Z,{style:2})}}const Jo=r=>({}),br=r=>({}),Xo=r=>({}),yr=r=>({}),Wo=r=>({}),vr=r=>({});function Vo(r){let e,t,n,i,o,s,a,l,u,p,m,c;const f=r[3].nav,h=ht(f,r,r[2],vr),g=r[3].sidebar,_=ht(g,r,r[2],yr),y=r[3].main,d=ht(y,r,r[2],br);return{c(){e=E("aside"),t=E("div"),n=E("nav"),h&&h.c(),i=A(),_&&_.c(),o=A(),s=E("button"),s.textContent="→",l=A(),u=E("main"),d&&d.c(),O(n,"class","svelte-1u7vg8a"),O(t,"class","sidebar-content content-container svelte-1u7vg8a"),O(s,"type","button"),O(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),O(e,"class",a=pr(r[0]?"":"collapsed")+" svelte-1u7vg8a"),O(u,"class","svelte-1u7vg8a")},m(b,v){k(b,e,v),w(e,t),w(t,n),h&&h.m(n,null),w(t,i),_&&_.m(t,null),w(e,o),w(e,s),k(b,l,v),k(b,u,v),d&&d.m(u,null),p=!0,m||(c=B(s,"click",r[1]),m=!0)},p(b,[v]){h&&h.p&&(!p||v&4)&&mt(h,f,b,b[2],p?gt(f,b[2],v,Wo):_t(b[2]),vr),_&&_.p&&(!p||v&4)&&mt(_,g,b,b[2],p?gt(g,b[2],v,Xo):_t(b[2]),yr),(!p||v&1&&a!==(a=pr(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&O(e,"class",a),d&&d.p&&(!p||v&4)&&mt(d,y,b,b[2],p?gt(y,b[2],v,Jo):_t(b[2]),br)},i(b){p||(C(h,b),C(_,b),C(d,b),p=!0)},o(b){T(h,b),T(_,b),T(d,b),p=!1},d(b){b&&S(e),h&&h.d(b),_&&_.d(b),b&&S(l),b&&S(u),d&&d.d(b),m=!1,c()}}}function Ko(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class Zo extends Q{constructor(e){super(),ee(this,e,Ko,Vo,Z,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Qo(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var nt=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function es(r,e){return r>e?1:r<e?-1:0}function Ve(r,e,t){for(var n=new nt(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Rn(r,e,t,n){var i=new nt(r,e);if(t===null)return i.left=i.right=null,i;t=Ve(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function wr(r,e,t){var n=null,i=null;if(e){e=Ve(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function ts(r,e,t){return e===null?r:(r===null||(e=Ve(r.key,e,t),e.left=r),e)}function qn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&qn(r.left,o,!1,n,i),r.right&&qn(r.right,o,!0,n,i)}}var or=function(){function r(e){e===void 0&&(e=es),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Rn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new nt(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ve(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ve(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ve(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ve(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ve(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return rs(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&zn(e,t,0,i-1,o),this._root===null)this._root=Un(e,t,0,i),this._size=i;else{var s=is(this.toList(),ns(e,t),o);i=this._size+i,this._root=Gn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return qn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=wr(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=Rn(t,n,a,i):s=Rn(t,n,s,i),this._root=ts(s,a,i)},r.prototype.split=function(e){return wr(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Qo(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Un(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new nt(s,a);return l.left=Un(r,e,t,o),l.right=Un(r,e,o+1,n),l}return null}function ns(r,e){for(var t=new nt(null,null),n=t,i=0;i<r.length;i++)n=n.next=new nt(r[i],e[i]);return n.next=null,t.next}function rs(r){for(var e=r,t=[],n=!1,i=new nt(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Gn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Gn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Gn(r,i+1,t),s}return null}function is(r,e,t){for(var n=new nt(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function zn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}zn(r,e,t,a,i),zn(r,e,a+1,n,i)}}function Ie(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function kr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Le(r,e,t){return e&&kr(r.prototype,e),t&&kr(r,t),r}var Ot=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Hn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Ze=Number.EPSILON;Ze===void 0&&(Ze=Math.pow(2,-52));var os=Ze*Ze,Yn=function(e,t){if(-Ze<e&&e<Ze&&-Ze<t&&t<Ze)return 0;var n=e-t;return n*n<os*e*t?0:e<t?-1:1},ss=function(){function r(){Ie(this,r),this.reset()}return Le(r,[{key:"reset",value:function(){this.xRounder=new Sr,this.yRounder=new Sr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Sr=function(){function r(){Ie(this,r),this.tree=new or,this.round(0)}return Le(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Yn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Yn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Ut=new ss,It=function(e,t){return e.x*t.y-e.y*t.x},vi=function(e,t){return e.x*t.x+e.y*t.y},Er=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=It(i,o);return Yn(s,0)},dn=function(e){return Math.sqrt(vi(e,e))},ls=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return It(o,i)/dn(o)/dn(i)},as=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return vi(o,i)/dn(o)/dn(i)},Mr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Or=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},us=function(e,t,n,i){if(t.x===0)return Or(n,i,e.x);if(i.x===0)return Or(e,t,n.x);if(t.y===0)return Mr(n,i,e.y);if(i.y===0)return Mr(e,t,n.y);var o=It(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=It(s,t)/o,l=It(s,i)/o,u=e.x+l*t.x,p=n.x+a*i.x,m=e.y+l*t.y,c=n.y+a*i.y,f=(u+p)/2,h=(m+c)/2;return{x:f,y:h}},qe=function(){Le(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:hn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Ie(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Le(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:ls(n.point,t.point,l.point),cosine:as(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,p=l.cosine,m=i.get(a),c=m.sine,f=m.cosine;return u>=0&&c>=0?p<f?1:p>f?-1:0:u<0&&c<0?p<f?-1:p>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),fs=0,hn=function(){Le(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,m=n.rightSE.point.y;if(i<o){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<m)return-1;if(l>u&&l>m)return 1;var h=n.comparePoint(t.leftSE.point);if(h!==0)return h;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>a){var y=t.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(s!==a){var d=p-l,b=s-i,v=m-u,M=a-o;if(d>b&&v<M)return 1;if(d<b&&v>M)return-1}return s>a?1:s<a||p<m?-1:p>m?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Ie(this,r),this.id=++fs,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Le(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Hn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=Ot(n,l)&&this.comparePoint(l)===0,m=Ot(i,s)&&t.comparePoint(s)===0,c=Ot(n,u)&&this.comparePoint(u)===0,f=Ot(i,a)&&t.comparePoint(a)===0;if(m&&p)return f&&!c?a:!f&&c?u:null;if(m)return c&&s.x===u.x&&s.y===u.y?null:s;if(p)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var h=us(s,this.vector(),l,t.vector());return h===null||!Ot(o,h)?null:Ut.round(h.x,h.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new qe(t,!0),s=new qe(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return qe.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),qe.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var p=i.rings[l],m=i.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(m)):n.windings[c]+=m}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),i.push(u)):i[p]+=u}for(var m=[],c=[],f=0,h=n.length;f<h;f++)if(i[f]!==0){var g=n[f],_=g.poly;if(c.indexOf(_)===-1)if(g.isExterior)m.push(_);else{c.indexOf(_)===-1&&c.push(_);var y=m.indexOf(g.poly);y!==-1&&m.splice(y,1)}}for(var d=0,b=m.length;d<b;d++){var v=m[d].multiPoly;o.indexOf(v)===-1&&o.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(De.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===De.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(m){return m.length===1&&m[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(De.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=qe.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new qe(o,!0),p=new qe(s,!1);return new r(u,p,[i],[a])}}]),r}(),$r=function(){function r(e,t,n){if(Ie(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Ut.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Ut.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(hn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(hn.fromRing(o,i,this))}return Le(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),cs=function(){function r(e,t){if(Ie(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new $r(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new $r(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Le(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Lr=function(){function r(e,t){if(Ie(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new cs(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Le(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),ps=function(){Le(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],m=l.point,c=[];a=l,l=u,p.push(l),l.point!==m;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var h=p[0].point,g=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var _=null,y=0,d=c.length;y<d;y++)if(c[y].point===l.point){_=y;break}if(_!==null){var b=c.splice(_)[0],v=p.splice(b.index);v.unshift(v[0].otherSE),n.push(new r(v.reverse()));continue}c.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Ie(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Le(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Er(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Er(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],h=m;h!=c;h+=p)f.push([n[h].x,n[h].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];qe.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Cr=function(){function r(e){Ie(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Le(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),ds=function(){function r(e){Ie(this,r),this.rings=e,this.polys=this._composePolys(e)}return Le(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Cr(s));else{var a=s.enclosingRing();a.poly||n.push(new Cr(a)),a.poly.addInterior(s)}}return n}}]),r}(),hs=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hn.compare;Ie(this,r),this.queue=e,this.tree=new or(t),this.segments=[]}return Le(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var m=l.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(p=m),!l.isAnEndpoint(m)))for(var c=this._splitSafely(l,m),f=0,h=c.length;f<h;f++)i.push(c[f])}var g=null;if(u){var _=u.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(g=_),!u.isAnEndpoint(_)))for(var y=this._splitSafely(u,_),d=0,b=y.length;d<b;d++)i.push(y[d])}if(p!==null||g!==null){var v=null;if(p===null)v=g;else if(g===null)v=p;else{var M=qe.comparePoints(p,g);v=M<=0?p:g}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var $=n.split(v),R=0,L=$.length;R<L;R++)i.push($[R])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var P=l.getIntersection(u);if(P!==null){if(!l.isAnEndpoint(P))for(var F=this._splitSafely(l,P),N=0,W=F.length;N<W;N++)i.push(F[N]);if(!u.isAnEndpoint(P))for(var x=this._splitSafely(u,P),D=0,le=x.length;D<le;D++)i.push(x[D])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Ar=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ms=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,_s=function(){function r(){Ie(this,r)}return Le(r,[{key:"run",value:function(t,n,i){De.type=t,Ut.reset();for(var o=[new Lr(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Lr(i[s],!1));if(De.numMultiPolys=o.length,De.type==="difference")for(var l=o[0],u=1;u<o.length;)Hn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(De.type==="intersection"){for(var p=0,m=o.length;p<m;p++)for(var c=o[p],f=p+1,h=o.length;f<h;f++)if(Hn(c.bbox,o[f].bbox)===null)return[]}for(var g=new or(qe.compare),_=0,y=o.length;_<y;_++)for(var d=o[_].getSweepEvents(),b=0,v=d.length;b<v;b++)if(g.insert(d[b]),g.size>Ar)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new hs(g),$=g.size,R=g.pop();R;){var L=R.key;if(g.size===$){var P=L.segment;throw new Error("Unable to pop() ".concat(L.isLeft?"left":"right"," SweepEvent ")+"[".concat(L.point.x,", ").concat(L.point.y,"] from segment #").concat(P.id," ")+"[".concat(P.leftSE.point.x,", ").concat(P.leftSE.point.y,"] -> ")+"[".concat(P.rightSE.point.x,", ").concat(P.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Ar)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>ms)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var F=M.process(L),N=0,W=F.length;N<W;N++){var x=F[N];x.consumedBy===void 0&&g.insert(x)}$=g.size,R=g.pop()}Ut.reset();var D=ps.factory(M.segments),le=new ds(D);return le.getGeom()}}]),r}(),De=new _s,gs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return De.run("union",e,n)},bs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return De.run("intersection",e,n)},ys=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return De.run("xor",e,n)},vs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return De.run("difference",e,n)},en={union:gs,intersection:bs,xor:ys,difference:vs};function ws(r,e){var t=Ss(e),n=null;return r.type==="FeatureCollection"?n=ks(r):n=wi(en.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function ks(r){var e=r.features.length===2?en.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):en.union.apply(en,r.features.map(function(t){return t.geometry.coordinates}));return wi(e)}function wi(r){return Qi(r)}function Ss(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return eo(t)}function Es(r,e,t){let n;oe(r,Ye,s=>t(1,n=s));let{boundaryGeojson:i}=e;return to("setCamera")&&n.fitBounds(tr(i),{padding:20,animate:!1}),ot(n,"boundary",{type:"geojson",data:ws(i)}),Se(n,{id:"boundary",source:"boundary",...vn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class Ms extends Q{constructor(e){super(),ee(this,e,Es,null,Z,{boundaryGeojson:0})}}function Rr(r){let e,t=Tr(r[3])+"",n,i,o,s,a,l;return{c(){e=Y("Length: "),n=Y(t),i=A(),o=E("br"),s=E("button"),s.textContent="Auto-fill details",O(s,"type","button")},m(u,p){k(u,e,p),k(u,n,p),k(u,i,p),k(u,o,p),k(u,s,p),a||(l=B(s,"click",r[14]),a=!0)},p(u,p){p&8&&t!==(t=Tr(u[3])+"")&&He(n,t)},d(u){u&&S(e),u&&S(n),u&&S(i),u&&S(o),u&&S(s),a=!1,l()}}}function Os(r){let e,t,n,i,o,s,a,l,u,p,m,c,f,h,g,_,y,d,b,v,M,$,R,L,P,F,N,W,x,D,le,pe,G,ae,Ce,Fe,me,de,Ne,se=r[3]&&Rr(r);return{c(){e=E("label"),t=Y("Name:"),n=E("br"),i=A(),o=E("input"),s=A(),a=E("br"),l=A(),u=E("br"),p=A(),m=E("label"),c=E("input"),f=Y(`
  Area`),h=A(),g=E("label"),_=E("input"),y=Y(`
  Route`),d=A(),b=E("label"),v=E("input"),M=Y(`
  Crossing`),$=A(),R=E("label"),L=E("input"),P=Y(`
  Other`),F=A(),N=E("br"),W=A(),x=E("br"),D=A(),le=E("label"),pe=Y("Description:"),G=E("br"),ae=A(),Ce=E("textarea"),Fe=A(),se&&se.c(),me=he(),O(o,"type","text"),fe(o,"width","100%"),O(c,"type","radio"),c.__value="area",c.value=c.__value,r[9][0].push(c),O(_,"type","radio"),_.__value="route",_.value=_.__value,r[9][0].push(_),O(v,"type","radio"),v.__value="crossing",v.value=v.__value,r[9][0].push(v),O(L,"type","radio"),L.__value="other",L.value=L.__value,r[9][0].push(L),fe(Ce,"width","100%"),O(Ce,"rows","5"),O(Ce,"class","svelte-15lna0i")},m(I,K){k(I,e,K),w(e,t),w(e,n),w(e,i),w(e,o),Pe(o,r[0]),k(I,s,K),k(I,a,K),k(I,l,K),k(I,u,K),k(I,p,K),k(I,m,K),w(m,c),c.checked=c.__value===r[1],w(m,f),k(I,h,K),k(I,g,K),w(g,_),_.checked=_.__value===r[1],w(g,y),k(I,d,K),k(I,b,K),w(b,v),v.checked=v.__value===r[1],w(b,M),k(I,$,K),k(I,R,K),w(R,L),L.checked=L.__value===r[1],w(R,P),k(I,F,K),k(I,N,K),k(I,W,K),k(I,x,K),k(I,D,K),k(I,le,K),w(le,pe),w(le,G),w(le,ae),w(le,Ce),Pe(Ce,r[2]),k(I,Fe,K),se&&se.m(I,K),k(I,me,K),de||(Ne=[B(o,"input",r[7]),B(c,"change",r[8]),B(_,"change",r[10]),B(v,"change",r[11]),B(L,"change",r[12]),B(Ce,"input",r[13])],de=!0)},p(I,[K]){K&1&&o.value!==I[0]&&Pe(o,I[0]),K&2&&(c.checked=c.__value===I[1]),K&2&&(_.checked=_.__value===I[1]),K&2&&(v.checked=v.__value===I[1]),K&2&&(L.checked=L.__value===I[1]),K&4&&Pe(Ce,I[2]),I[3]?se?se.p(I,K):(se=Rr(I),se.c(),se.m(me.parentNode,me)):se&&(se.d(1),se=null)},i:z,o:z,d(I){I&&S(e),I&&S(s),I&&S(a),I&&S(l),I&&S(u),I&&S(p),I&&S(m),r[9][0].splice(r[9][0].indexOf(c),1),I&&S(h),I&&S(g),r[9][0].splice(r[9][0].indexOf(_),1),I&&S(d),I&&S(b),r[9][0].splice(r[9][0].indexOf(v),1),I&&S($),I&&S(R),r[9][0].splice(r[9][0].indexOf(L),1),I&&S(F),I&&S(N),I&&S(W),I&&S(x),I&&S(D),I&&S(le),I&&S(Fe),se&&se.d(I),I&&S(me),de=!1,xe(Ne)}}}function Tr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function $s(r,e,t){let n;oe(r,te,b=>t(15,n=b));let{routeInfo:i}=e,{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function p(){let b=n.features.find(v=>v.id==o);try{t(0,s=await i.nameForRoute(b))}catch(v){window.alert(`Couldn't auto-name route: ${v}`)}}const m=[[]];function c(){s=this.value,t(0,s)}function f(){a=this.__value,t(1,a)}function h(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function _(){a=this.__value,t(1,a)}function y(){l=this.value,t(2,l)}const d=()=>p();return r.$$set=b=>{"routeInfo"in b&&t(5,i=b.routeInfo),"id"in b&&t(6,o=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(3,u=b.length_meters)},[s,a,l,u,p,i,o,c,f,m,h,g,_,y,d]}class Ls extends Q{constructor(e){super(),ee(this,e,$s,Os,Z,{routeInfo:5,id:6,name:0,intervention_type:1,description:2,length_meters:3})}}const Cs="Intervention",As=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],Rs={name:Cs,oneOf:As};function Ts(r){const e=r-1;return e*e*e+1}function wt(r,{delay:e=0,duration:t=400,easing:n=Ts}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),p=parseFloat(i.marginBottom),m=parseFloat(i.borderTopWidth),c=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*p}px;border-top-width: ${f*m}px;border-bottom-width: ${f*c}px;`}}function ki(r){return"members"in r}function Si(r){return"oneOf"in r}function Ei(r){return typeof r=="string"}function Mi(r){return typeof r=="object"&&"value"in r}function xs(r){return"type"in r&&r.type=="number"}function Oi(r){return"type"in r&&r.type=="one-liner"}function $i(r){return"type"in r&&r.type=="textbox"}function Li(r){return"type"in r&&r.type=="checkbox"}function xr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Pr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Ir(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=Y(t),O(e,"class","svelte-1b72l00")},m(i,o){k(i,e,o),w(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&He(n,t)},d(i){i&&S(e)}}}function Ps(r){let e,t,n;return{c(){e=E("input"),O(e,"type","checkbox")},m(i,o){k(i,e,o),e.checked=r[0],t||(n=B(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:z,o:z,d(i){i&&S(e),t=!1,n()}}}function Is(r){let e,t,n;return{c(){e=E("textarea"),fe(e,"width","100%"),O(e,"rows","5"),O(e,"class","svelte-1b72l00")},m(i,o){k(i,e,o),Pe(e,r[0]),t||(n=B(e,"input",r[13]),t=!0)},p(i,o){o&1&&Pe(e,i[0])},i:z,o:z,d(i){i&&S(e),t=!1,n()}}}function Fs(r){let e,t,n;return{c(){e=E("input"),O(e,"type","text"),fe(e,"width","100%")},m(i,o){k(i,e,o),Pe(e,r[0]),t||(n=B(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Pe(e,i[0])},i:z,o:z,d(i){i&&S(e),t=!1,n()}}}function Ns(r){let e,t,n;return{c(){e=E("input"),O(e,"type","number")},m(i,o){k(i,e,o),Pe(e,r[0]),t||(n=B(e,"input",r[11]),t=!0)},p(i,o){o&1&&ai(e.value)!==i[0]&&Pe(e,i[0])},i:z,o:z,d(i){i&&S(e),t=!1,n()}}}function Bs(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=Nr(xr(r,n,s));const o=s=>T(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=he()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);k(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=xr(s,n,l);i[l]?(i[l].p(u,a),C(i[l],1)):(i[l]=Nr(u),i[l].c(),C(i[l],1),i[l].m(e.parentNode,e))}for(we(),l=n.length;l<i.length;l+=1)o(l);ke()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)C(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)T(i[a]);t=!1},d(s){ui(i,s),s&&S(e)}}}function Ds(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=Br(Pr(r,n,s));const o=s=>T(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=he()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);k(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Pr(s,n,l);i[l]?(i[l].p(u,a),C(i[l],1)):(i[l]=Br(u),i[l].c(),C(i[l],1),i[l].m(e.parentNode,e))}for(we(),l=n.length;l<i.length;l+=1)o(l);ke()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)C(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)T(i[a]);t=!1},d(s){ui(i,s),s&&S(e)}}}function js(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,p,m,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&Fr(r);return{c(){e=E("label"),t=E("input"),i=A(),s=Y(o),a=E("br"),l=A(),f&&f.c(),u=he(),O(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(h,g){k(h,e,g),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),k(h,l,g),f&&f.m(h,g),k(h,u,g),p=!0,m||(c=[B(t,"change",r[9]),B(t,"change",r[4])],m=!0)},p(h,g){(!p||g&2&&n!==(n=h[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),(!p||g&2)&&o!==(o=h[15].name+"")&&He(s,o),h[2]==h[15].name&&typeof h[0]=="object"?f?(f.p(h,g),g&7&&C(f,1)):(f=Fr(h),f.c(),C(f,1),f.m(u.parentNode,u)):f&&(we(),T(f,1,1,()=>{f=null}),ke())},i(h){p||(C(f),p=!0)},o(h){T(f),p=!1},d(h){h&&S(e),r[7][0].splice(r[7][0].indexOf(t),1),h&&S(l),f&&f.d(h),h&&S(u),m=!1,xe(c)}}}function qs(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,p;function m(h,g){return h[15].description?zs:Gs}let c=m(r),f=c(r);return{c(){e=E("label"),t=E("input"),i=A(),s=Y(o),a=A(),f.c(),l=A(),O(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(h,g){k(h,e,g),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),f.m(e,null),w(e,l),u||(p=[B(t,"change",r[8]),B(t,"change",r[3])],u=!0)},p(h,g){g&2&&n!==(n=h[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),g&2&&o!==(o=h[15].value+"")&&He(s,o),c===(c=m(h))&&f?f.p(h,g):(f.d(1),f=c(h),f&&(f.c(),f.m(e,l)))},i:z,o:z,d(h){h&&S(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,xe(p)}}}function Us(r){let e,t,n,i,o=r[15]+"",s,a,l,u,p,m;return{c(){e=E("label"),t=E("input"),i=A(),s=Y(o),a=A(),l=E("br"),u=A(),O(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){k(c,e,f),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),w(e,l),w(e,u),p||(m=[B(t,"change",r[6]),B(t,"change",r[3])],p=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&o!==(o=c[15]+"")&&He(s,o)},i:z,o:z,d(c){c&&S(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,xe(m)}}}function Fr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Jt({props:l}),ie.push(()=>Oe(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),j(t.$$.fragment),i=A(),O(e,"class","svelte-1b72l00")},m(u,p){k(u,e,p),q(t,e,null),w(e,i),s=!0},p(u,p){r=u;const m={};p&2&&(m.spec=r[15]),!n&&p&3&&(n=!0,m.value=r[0][r[15].name],$e(()=>n=!1)),t.$set(m)},i(u){s||(C(t.$$.fragment,u),Ht(()=>{o||(o=yt(e,wt,{duration:500},!0)),o.run(1)}),s=!0)},o(u){T(t.$$.fragment,u),o||(o=yt(e,wt,{duration:500},!1)),o.run(0),s=!1},d(u){u&&S(e),U(t),u&&o&&o.end()}}}function Gs(r){let e;return{c(){e=E("br")},m(t,n){k(t,e,n)},p:z,d(t){t&&S(e)}}}function zs(r){let e,t,n=r[15].description+"",i,o;return{c(){e=E("p"),t=Y("("),i=Y(n),o=Y(")"),O(e,"class","svelte-1b72l00")},m(s,a){k(s,e,a),w(e,t),w(e,i),w(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&He(i,n)},d(s){s&&S(e)}}}function Nr(r){let e,t,n,i,o,s;const a=[Us,qs,js],l=[];function u(p,m){return m&2&&(e=null),m&2&&(t=null),e==null&&(e=!!Ei(p[15])),e?0:(t==null&&(t=!!Mi(p[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=he()},m(p,m){l[n].m(p,m),k(p,o,m),s=!0},p(p,m){let c=n;n=u(p,m),n===c?l[n].p(p,m):(we(),T(l[c],1,1,()=>{l[c]=null}),ke(),i=l[n],i?i.p(p,m):(i=l[n]=a[n](p),i.c()),C(i,1),i.m(o.parentNode,o))},i(p){s||(C(i),s=!0)},o(p){T(i),s=!1},d(p){l[n].d(p),p&&S(o)}}}function Br(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function p(c){r[5](c,r[15])}let m={spec:r[15]};return r[0][r[15].name]!==void 0&&(m.value=r[0][r[15].name]),s=new Jt({props:m}),ie.push(()=>Oe(s,"value",p,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),i=Y(n),o=A(),j(s.$$.fragment),l=A(),O(e,"class","svelte-1b72l00")},m(c,f){k(c,e,f),w(e,t),w(t,i),w(e,o),q(s,e,null),w(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&He(i,n);const h={};f&2&&(h.spec=r[15]),!a&&f&3&&(a=!0,h.value=r[0][r[15].name],$e(()=>a=!1)),s.$set(h)},i(c){u||(C(s.$$.fragment,c),u=!0)},o(c){T(s.$$.fragment,c),u=!1},d(c){c&&S(e),U(s)}}}function Hs(r){let e,t,n,i,o,s,a,l,u,p,m,c=r[1].description&&Ir(r);const f=[Ds,Bs,Ns,Fs,Is,Ps],h=[];function g(_,y){return y&2&&(t=null),y&2&&(n=null),y&2&&(i=null),y&2&&(o=null),y&2&&(s=null),y&2&&(a=null),t==null&&(t=!!ki(_[1])),t?0:(n==null&&(n=!!Si(_[1])),n?1:(i==null&&(i=!!xs(_[1])),i?2:(o==null&&(o=!!Oi(_[1])),o?3:(s==null&&(s=!!$i(_[1])),s?4:(a==null&&(a=!!Li(_[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=h[l]=f[l](r)),{c(){c&&c.c(),e=A(),u&&u.c(),p=he()},m(_,y){c&&c.m(_,y),k(_,e,y),~l&&h[l].m(_,y),k(_,p,y),m=!0},p(_,[y]){_[1].description?c?c.p(_,y):(c=Ir(_),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let d=l;l=g(_,y),l===d?~l&&h[l].p(_,y):(u&&(we(),T(h[d],1,1,()=>{h[d]=null}),ke()),~l?(u=h[l],u?u.p(_,y):(u=h[l]=f[l](_),u.c()),C(u,1),u.m(p.parentNode,p)):u=null)},i(_){m||(C(u),m=!0)},o(_){T(u),m=!1},d(_){c&&c.d(_),_&&S(e),~l&&h[l].d(_),_&&S(p)}}}function Ys(r,e,t){var d,b,v;let{spec:n}=e,{value:i}=e,o="";if(ki(n)){i||(i={});for(let M of n.members)Oi(M)||$i(M)?i[d=M.name]||(i[d]=""):Li(M)?i[b=M.name]||(i[b]=!1):i[v=M.name]||(i[v]={})}else Si(n)&&(i||(i={}),Ei(i)?o=i:Mi(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,$){r.$$.not_equal(i[$.name],M)&&(i[$.name]=M,t(0,i))}function p(){o=this.__value,t(2,o)}function m(){o=this.__value,t(2,o)}function c(){o=this.__value,t(2,o)}function f(M,$){r.$$.not_equal(i[$.name],M)&&(i[$.name]=M,t(0,i))}function h(){i=ai(this.value),t(0,i)}function g(){i=this.value,t(0,i)}function _(){i=this.value,t(0,i)}function y(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,p,l,m,c,f,h,g,_,y]}class Jt extends Q{constructor(e){super(),ee(this,e,Ys,Hs,Z,{spec:1,value:0})}}function Js(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Jt({props:o}),ie.push(()=>Oe(e,"value",i,r[0].v2)),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,$e(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Xs(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=Rs;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Ws extends Q{constructor(e){super(),ee(this,e,Xs,Js,Z,{props:0})}}const Vs="Planning",Ks=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],Zs={name:Vs,members:Ks};function Qs(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Jt({props:o}),ie.push(()=>Oe(e,"value",i,r[0].planning)),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,$e(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function el(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=Zs;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class tl extends Q{constructor(e){super(),ee(this,e,el,Qs,Z,{props:0})}}const nl="CriticalIssue",rl=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],il={name:nl,members:rl};function ol(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Jt({props:o}),ie.push(()=>Oe(e,"value",i,r[0].criticals)),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,$e(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function sl(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=il;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class ll extends Q{constructor(e){super(),ee(this,e,sl,ol,Z,{props:0})}}function Dr(r){let e,t,n,i,o;const s=r[10].default,a=ht(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),fe(e,"border","solid 1px black"),fe(e,"padding","10px")},m(l,u){k(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=B(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&mt(a,s,l,l[9],n?gt(s,l[9],u,null):_t(l[9]),null)},i(l){n||(C(a,l),Ht(()=>{t||(t=yt(e,wt,{duration:100},!0)),t.run(1)}),n=!0)},o(l){T(a,l),t||(t=yt(e,wt,{duration:100},!1)),t.run(0),n=!1},d(l){l&&S(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function al(r){let e,t,n,i,o,s,a,l,u,p,m=r[4]&&Dr(r);return{c(){e=E("button"),t=ln("svg"),n=ln("path"),i=A(),o=Y(r[1]),s=A(),m&&m.c(),a=he(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-t7fpgu"),O(e,"aria-expanded",r[4]),O(e,"class","svelte-t7fpgu"),dr(e,"underlined",r[3])},m(c,f){k(c,e,f),w(e,t),w(t,n),w(e,i),w(e,o),k(c,s,f),m&&m.m(c,f),k(c,a,f),l=!0,u||(p=[B(e,"click",r[5]),B(e,"mouseenter",r[11]),B(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&He(o,c[1]),(!l||f&16)&&O(e,"aria-expanded",c[4]),(!l||f&8)&&dr(e,"underlined",c[3]),c[4]?m?(m.p(c,f),f&16&&C(m,1)):(m=Dr(c),m.c(),C(m,1),m.m(a.parentNode,a)):m&&(we(),T(m,1,1,()=>{m=null}),ke())},i(c){l||(C(m),l=!0)},o(c){T(m),l=!1},d(c){c&&S(e),c&&S(s),m&&m.d(c),c&&S(a),u=!1,xe(p)}}}function ul(r,e,t){let n,i,o,s;oe(r,Ue,d=>t(7,o=d)),oe(r,Me,d=>t(8,s=d));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const m=()=>{Me.update(d=>d==u?null:u),s==u&&(qt.set(null),qt.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const h=()=>jt.set(u),g=()=>jt.set(null);function _(d){ie[d?"unshift":"push"](()=>{c=d,t(2,c)})}const y=()=>f();return r.$$set=d=>{"id"in d&&t(0,u=d.id),"label"in d&&t(1,p=d.label),"$$scope"in d&&t(9,l=d.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,p,c,i,n,m,f,o,s,l,a,h,g,_,y]}class fl extends Q{constructor(e){super(),ee(this,e,ul,al,Z,{id:0,label:1})}}function jr(r,e,t){const n=r.slice();return n[14]=e[t],n[15]=e,n[16]=t,n}function cl(r){let e,t,n;function i(s){r[10](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new ll({props:o}),ie.push(()=>Oe(e,"props",i,r[14].properties)),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,$e(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function pl(r){let e,t,n;function i(s){r[9](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new tl({props:o}),ie.push(()=>Oe(e,"props",i,r[14].properties)),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,$e(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function dl(r){let e,t,n;function i(s){r[8](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new Ws({props:o}),ie.push(()=>Oe(e,"props",i,r[14].properties)),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,$e(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function hl(r){let e,t,n,i,o;function s(p){r[5](p,r[14])}function a(p){r[6](p,r[14])}function l(p){r[7](p,r[14])}let u={routeInfo:r[1],id:r[14].id,length_meters:r[14].properties.length_meters};return r[14].properties.name!==void 0&&(u.name=r[14].properties.name),r[14].properties.intervention_type!==void 0&&(u.intervention_type=r[14].properties.intervention_type),r[14].properties.description!==void 0&&(u.description=r[14].properties.description),e=new Ls({props:u}),ie.push(()=>Oe(e,"name",s,r[14].properties.name)),ie.push(()=>Oe(e,"intervention_type",a,r[14].properties.intervention_type)),ie.push(()=>Oe(e,"description",l,r[14].properties.description)),{c(){j(e.$$.fragment)},m(p,m){q(e,p,m),o=!0},p(p,m){r=p;const c={};m&2&&(c.routeInfo=r[1]),m&4&&(c.id=r[14].id),m&4&&(c.length_meters=r[14].properties.length_meters),!t&&m&4&&(t=!0,c.name=r[14].properties.name,$e(()=>t=!1)),!n&&m&4&&(n=!0,c.intervention_type=r[14].properties.intervention_type,$e(()=>n=!1)),!i&&m&4&&(i=!0,c.description=r[14].properties.description,$e(()=>i=!1)),e.$set(c)},i(p){o||(C(e.$$.fragment,p),o=!0)},o(p){T(e.$$.fragment,p),o=!1},d(p){U(e,p)}}}function ml(r){let e,t,n,i,o,s,a,l,u,p,m,c,f,h,g;const _=[hl,dl,pl,cl],y=[];function d(v,M){return v[0]=="v1"?0:v[0]=="v2"?1:v[0]=="planning"?2:v[0]=="criticals"?3:-1}~(e=d(r))&&(t=y[e]=_[e](r));function b(){return r[11](r[14])}return{c(){t&&t.c(),n=A(),i=E("br"),o=A(),s=E("br"),a=A(),l=E("div"),u=E("button"),u.textContent="Delete",p=A(),m=E("button"),m.textContent="Save",c=A(),O(u,"type","button"),O(m,"type","button"),fe(l,"display","flex"),fe(l,"justify-content","space-between")},m(v,M){~e&&y[e].m(v,M),k(v,n,M),k(v,i,M),k(v,o,M),k(v,s,M),k(v,a,M),k(v,l,M),w(l,u),w(l,p),w(l,m),k(v,c,M),f=!0,h||(g=[B(u,"click",b),B(m,"click",r[12])],h=!0)},p(v,M){r=v;let $=e;e=d(r),e===$?~e&&y[e].p(r,M):(t&&(we(),T(y[$],1,1,()=>{y[$]=null}),ke()),~e?(t=y[e],t?t.p(r,M):(t=y[e]=_[e](r),t.c()),C(t,1),t.m(n.parentNode,n)):t=null)},i(v){f||(C(t),f=!0)},o(v){T(t),f=!1},d(v){~e&&y[e].d(v),v&&S(n),v&&S(i),v&&S(o),v&&S(s),v&&S(a),v&&S(l),v&&S(c),h=!1,xe(g)}}}function qr(r,e){let t,n,i;return n=new fl({props:{id:e[14].id,label:e[16]+1+") "+e[3](e[14]),$$slots:{default:[ml]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=he(),j(n.$$.fragment),this.first=t},m(o,s){k(o,t,s),q(n,o,s),i=!0},p(o,s){e=o;const a={};s&4&&(a.id=e[14].id),s&4&&(a.label=e[16]+1+") "+e[3](e[14])),s&131079&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||(C(n.$$.fragment,o),i=!0)},o(o){T(n.$$.fragment,o),i=!1},d(o){o&&S(t),U(n,o)}}}function _l(r){let e=[],t=new Map,n,i,o,s,a=r[2].features;const l=u=>u[14].id;for(let u=0;u<a.length;u+=1){let p=jr(r,a,u),m=l(p);t.set(m,e[u]=qr(m,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=he()},m(u,p){for(let m=0;m<e.length;m+=1)e[m].m(u,p);k(u,n,p),i=!0,o||(s=B(window,"keydown",r[4]),o=!0)},p(u,[p]){p&15&&(a=u[2].features,we(),e=no(e,p,l,1,u,a,t,n.parentNode,ro,qr,n,jr),ke())},i(u){if(!i){for(let p=0;p<a.length;p+=1)C(e[p]);i=!0}},o(u){for(let p=0;p<e.length;p+=1)T(e[p]);i=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&S(n),o=!1,s()}}}function gl(r,e,t){let n,i;oe(r,Me,y=>t(13,n=y)),oe(r,te,y=>t(2,i=y));let{schema:o}=e,{routeInfo:s}=e;function a(y){var b,v,M,$,R;if(o=="planning")return((b=y.properties.planning)==null?void 0:b.name)||"Untitled polygon";if(o=="v2")return((M=(v=y.properties.v2)==null?void 0:v.Route)==null?void 0:M.name)||((R=($=y.properties.v2)==null?void 0:$.Crossing)==null?void 0:R.name)||"Untitled intervention";if(y.properties.name)return y.properties.name;var d=y.properties.intervention_type;return d=="other"&&(y.geometry.type=="Point"?d="point":y.geometry.type=="LineString"?d="line":d="polygon"),`Untitled ${d}`}function l(y){if(y.key=="Delete"){const d=y.target.tagName;if(d=="INPUT"||d=="TEXTAREA")return;y.preventDefault();const b=n;b&&_r(b)}}function u(y,d){r.$$.not_equal(d.properties.name,y)&&(d.properties.name=y,te.set(i))}function p(y,d){r.$$.not_equal(d.properties.intervention_type,y)&&(d.properties.intervention_type=y,te.set(i))}function m(y,d){r.$$.not_equal(d.properties.description,y)&&(d.properties.description=y,te.set(i))}function c(y,d){r.$$.not_equal(d.properties,y)&&(d.properties=y,te.set(i))}function f(y,d){r.$$.not_equal(d.properties,y)&&(d.properties=y,te.set(i))}function h(y,d){r.$$.not_equal(d.properties,y)&&(d.properties=y,te.set(i))}const g=y=>_r(y.id),_=()=>Me.set(null);return r.$$set=y=>{"schema"in y&&t(0,o=y.schema),"routeInfo"in y&&t(1,s=y.routeInfo)},[o,s,i,a,l,u,p,m,c,f,h,g,_]}class bl extends Q{constructor(e){super(),ee(this,e,gl,_l,Z,{schema:0,routeInfo:1})}}function tt(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ge(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Jn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ke(r,e,t){t===void 0&&(t={});var n=tt(r),i=tt(e),o=Be(i[1]-n[1]),s=Be(i[0]-n[0]),a=Be(n[1]),l=Be(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return io(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function tn(r,e){return e===void 0&&(e={}),oo(r,function(t,n){var i=n.geometry.coordinates;return t+Ke(i[0],i[1],e)},0)}function yl(r){let e,t,n,i,o,s,a,l,u,p,m,c,f,h,g,_,y,d,b,v=r[0].features.length+"",M,$,R,L,P,F,N,W;return{c(){e=E("div"),t=E("label"),n=Y(`Scheme name:
    `),i=E("input"),o=A(),s=E("br"),a=A(),l=E("div"),u=E("label"),p=E("input"),m=A(),c=E("button"),c.textContent="Load from GeoJSON",f=A(),h=E("button"),h.textContent="Export to GeoJSON",g=A(),_=E("br"),y=A(),d=E("div"),b=E("span"),M=Y(v),$=Y(" interventions"),R=A(),L=E("button"),P=Y("Clear all"),O(i,"type","text"),O(p,"type","file"),O(p,"id","load_geojson"),O(p,"class","svelte-lhyd1e"),O(c,"type","button"),O(h,"type","button"),O(h,"class","align-right svelte-lhyd1e"),O(L,"type","button"),O(L,"class","align-right svelte-lhyd1e"),L.disabled=F=r[0].features.length==0},m(x,D){k(x,e,D),w(e,t),w(t,n),w(t,i),Pe(i,r[0].scheme_name),k(x,o,D),k(x,s,D),k(x,a,D),k(x,l,D),w(l,u),w(u,p),w(u,m),w(u,c),w(l,f),w(l,h),k(x,g,D),k(x,_,D),k(x,y,D),k(x,d,D),w(d,b),w(b,M),w(b,$),w(d,R),w(d,L),w(L,P),N||(W=[B(i,"input",r[7]),B(p,"change",r[3]),B(c,"click",wl),B(h,"click",r[2]),B(L,"click",r[1])],N=!0)},p(x,[D]){D&1&&i.value!==x[0].scheme_name&&Pe(i,x[0].scheme_name),D&1&&v!==(v=x[0].features.length+"")&&He(M,v),D&1&&F!==(F=x[0].features.length==0)&&(L.disabled=F)},i:z,o:z,d(x){x&&S(e),x&&S(o),x&&S(s),x&&S(a),x&&S(l),x&&S(g),x&&S(_),x&&S(y),x&&S(d),N=!1,xe(W)}}}function vl(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function wl(){document.getElementById("load_geojson").click()}function kl(r,e,t){let n;oe(r,te,h=>t(0,n=h));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=window.localStorage.getItem(s);if(a)try{te.set(c(JSON.parse(a)))}catch(h){console.log(`Failed to load from local storage: ${h}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(te.update(h=>(delete h.scheme_name,h.features=[],h)),Me.set(null),Ue.set(null),jt.set(null),qt.set(null))}function u(){const h=JSON.parse(JSON.stringify(n));for(let g of h.features)delete g.properties.hide_while_editing;return h}function p(){let h=u();var g=s;h.authority=i,h.origin="atip-v1",h.scheme_name&&(g+="_"+h.scheme_name),g+=".txt",vl(g,JSON.stringify(h,null,"  "))}function m(h){const g=new FileReader;g.onload=y=>{try{te.set(c(JSON.parse(y.target.result)))}catch(d){window.alert(`Couldn't load scheme from a file: ${d}`)}};let _=h.target.files;g.readAsText(_[0])}function c(h){let g=1;for(let _ of h.features)_.properties||(_.properties={name:"",description:"",intervention_type:"other"}),_.geometry.type=="LineString"&&!_.properties.length_meters&&(_.properties.length_meters=tn(_,{units:"kilometers"})*1e3),_.id=g++;return h}function f(){n.scheme_name=this.value,te.set(n)}return r.$$set=h=>{"authorityName"in h&&t(4,i=h.authorityName),"schema"in h&&t(5,o=h.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,p,m,i,o,s,f]}class Sl extends Q{constructor(e){super(),ee(this,e,kl,yl,Z,{authorityName:4,schema:5})}}const El="/atip/per_schema_legend/assets/zoom_out_map-b2e1091a.svg";function Ml(r){let e,t,n,i,o;return{c(){e=E("button"),t=E("img"),so(t.src,n=El)||O(t,"src",n),O(t,"alt","Zoom to show entire boundary"),O(e,"type","button"),O(e,"title","Zoom to show entire boundary"),O(e,"class","svelte-qzjsqo")},m(s,a){k(s,e,a),w(e,t),i||(o=B(e,"click",r[0]),i=!0)},p:z,i:z,o:z,d(s){s&&S(e),i=!1,o()}}}function Ol(r,e,t){let n;oe(r,Ye,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(tr(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class $l extends Q{constructor(e){super(),ee(this,e,Ol,Ml,Z,{boundaryGeojson:1})}}function Ll(r){let e,t,n,i,o,s,a;return{c(){e=E("div"),t=Y(`Basemap:
  `),n=E("select"),i=E("option"),i.textContent="Streets",o=E("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&Ht(()=>r[2].call(n)),O(e,"class","svelte-1tbnm6i")},m(l,u){k(l,e,u),w(e,t),w(e,n),w(n,i),w(n,o),an(n,r[0]),s||(a=[B(n,"change",r[2]),B(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&an(n,l[0])},i:z,o:z,d(l){l&&S(e),s=!1,xe(a)}}}function Cl(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=fi(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Al extends Q{constructor(e){super(),ee(this,e,Cl,Ll,Z,{style:0})}}const ue={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},En=10,mn=10;function Ur(r){let e,t,n;const i=r[3].default,o=ht(i,r,r[2],null);return{c(){e=E("div"),o&&o.c()},m(s,a){k(s,e,a),o&&o.m(e,null),n=!0},p(s,a){o&&o.p&&(!n||a&4)&&mt(o,i,s,s[2],n?gt(i,s[2],a,null):_t(s[2]),null)},i(s){n||(C(o,s),Ht(()=>{t||(t=yt(e,wt,{duration:100},!0)),t.run(1)}),n=!0)},o(s){T(o,s),t||(t=yt(e,wt,{duration:100},!1)),t.run(0),n=!1},d(s){s&&S(e),o&&o.d(s),s&&t&&t.end()}}}function Rl(r){let e,t,n,i,o,s,a,l,u,p,m=r[0]&&Ur(r);return{c(){e=E("button"),t=ln("svg"),n=ln("path"),i=A(),o=Y(r[1]),s=A(),m&&m.c(),a=he(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-una9lq"),O(e,"aria-expanded",r[0]),O(e,"class","svelte-una9lq")},m(c,f){k(c,e,f),w(e,t),w(t,n),w(e,i),w(e,o),k(c,s,f),m&&m.m(c,f),k(c,a,f),l=!0,u||(p=B(e,"click",r[4]),u=!0)},p(c,[f]){(!l||f&2)&&He(o,c[1]),(!l||f&1)&&O(e,"aria-expanded",c[0]),c[0]?m?(m.p(c,f),f&1&&C(m,1)):(m=Ur(c),m.c(),C(m,1),m.m(a.parentNode,a)):m&&(we(),T(m,1,1,()=>{m=null}),ke())},i(c){l||(C(m),l=!0)},o(c){T(m),l=!1},d(c){c&&S(e),c&&S(s),m&&m.d(c),c&&S(a),u=!1,p()}}}function Tl(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,o=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,i=l.$$scope)},[s,o,i,n,a]}class Mn extends Q{constructor(e){super(),ee(this,e,Tl,Rl,Z,{label:1,open:0})}}function xl(r){let e,t,n,i,o,s,a,l,u,p,m,c,f,h,g;return{c(){e=E("li"),t=E("span"),n=Y("Areas"),i=A(),o=E("li"),s=E("span"),a=Y("Routes"),l=A(),u=E("li"),p=E("span"),m=Y("Crossings"),c=A(),f=E("li"),h=E("span"),g=Y("Other"),O(t,"class","svelte-l42ea0"),fe(t,"background",ue.area),O(s,"class","svelte-l42ea0"),fe(s,"background",ue.route),O(p,"class","svelte-l42ea0"),fe(p,"background",ue.crossing),O(h,"class","svelte-l42ea0"),fe(h,"background",ue.other)},m(_,y){k(_,e,y),w(e,t),w(e,n),k(_,i,y),k(_,o,y),w(o,s),w(o,a),k(_,l,y),k(_,u,y),w(u,p),w(u,m),k(_,c,y),k(_,f,y),w(f,h),w(f,g)},p:z,d(_){_&&S(e),_&&S(i),_&&S(o),_&&S(l),_&&S(u),_&&S(c),_&&S(f)}}}function Pl(r){let e,t,n,i,o,s,a,l,u,p,m,c,f,h,g;return{c(){e=E("li"),t=E("span"),n=Y("Preapp"),i=A(),o=E("li"),s=E("span"),a=Y("Outline"),l=A(),u=E("li"),p=E("span"),m=Y("Reserved matters"),c=A(),f=E("li"),h=E("span"),g=Y("Local plan"),O(t,"class","svelte-l42ea0"),fe(t,"background",ue.preapp),O(s,"class","svelte-l42ea0"),fe(s,"background",ue.outline),O(p,"class","svelte-l42ea0"),fe(p,"background",ue["reserved matters"]),O(h,"class","svelte-l42ea0"),fe(h,"background",ue["local plan"])},m(_,y){k(_,e,y),w(e,t),w(e,n),k(_,i,y),k(_,o,y),w(o,s),w(o,a),k(_,l,y),k(_,u,y),w(u,p),w(u,m),k(_,c,y),k(_,f,y),w(f,h),w(f,g)},p:z,d(_){_&&S(e),_&&S(i),_&&S(o),_&&S(l),_&&S(u),_&&S(c),_&&S(f)}}}function Il(r){let e;function t(o,s){return o[0]=="planning"?Pl:xl}let n=t(r),i=n(r);return{c(){e=E("ul"),i.c()},m(o,s){k(o,e,s),i.m(e,null)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&S(e),i.d()}}}function Fl(r){let e,t,n;return t=new Mn({props:{label:"Interventions",open:!0,$$slots:{default:[Il]},$$scope:{ctx:r}}}),{c(){e=E("div"),j(t.$$.fragment),O(e,"class","svelte-l42ea0")},m(i,o){k(i,e,o),q(t,e,null),n=!0},p(i,[o]){const s={};o&3&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(C(t.$$.fragment,i),n=!0)},o(i){T(t.$$.fragment,i),n=!1},d(i){i&&S(e),U(t)}}}function Nl(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class Bl extends Q{constructor(e){super(),ee(this,e,Nl,Fl,Z,{schema:0})}}let lt="interventions";function Dl(r,e,t){let n,i;oe(r,Ye,p=>t(1,n=p)),oe(r,te,p=>t(2,i=p));let{schema:o}=e;ot(n,lt,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",ue.area,"route",ue.route,"crossing",ue.crossing,"other",ue.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",ue.preapp,"outline",ue.outline,"reserved matters",ue["reserved matters"],"local plan",ue["local plan"],"white"],l=["!=","hide_while_editing",!0];return Se(n,{id:"interventions-points",source:lt,filter:["all",wn,l,["!=","endpoint",!0]],...St(s,En)}),Se(n,{id:"interventions-lines",source:lt,filter:["all",kn,l],...Dt(s,mn)},"route-lines"),Se(n,{id:"interventions-lines-endpoints",source:lt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*mn,"circle-opacity":0,"circle-stroke-color":ue.lineEndpointColor,"circle-stroke-width":2}}),Se(n,{id:"interventions-polygons",source:lt,filter:["all",Sn,l],...vn(o=="planning"?a:s,.5)},"hover-polygons"),r.$$set=p=>{"schema"in p&&t(0,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(i)),m=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])m.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(m),n.getSource(lt).setData(p)}},[o,n,i]}class jl extends Q{constructor(e){super(),ee(this,e,Dl,null,Z,{schema:0})}}let at="hover";function ql(r,e,t){let n,i,o,s,a;return oe(r,Ye,l=>t(0,n=l)),oe(r,te,l=>t(1,i=l)),oe(r,jt,l=>t(2,o=l)),oe(r,Ue,l=>t(3,s=l)),oe(r,Me,l=>t(4,a=l)),ot(n,at,{type:"geojson",data:ze()}),Se(n,{id:"hover-polygons",source:at,filter:Sn,...Dt(ue.hovering,.5*mn,1)}),Se(n,{id:"hover-lines",source:at,filter:kn,...Dt(ue.hovering,1.5*mn,1)},"interventions-lines"),Se(n,{id:"hover-points",source:at,filter:wn,...St(ue.hovering,1.5*En,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(at).setData(i.features.find(u=>u.id==l)):n.getSource(at).setData(ze())}},[n,i,o,s,a]}class Ul extends Q{constructor(e){super(),ee(this,e,ql,null,Z,{})}}class sr{constructor(e,t){ne(this,"owner");ne(this,"map");ne(this,"mapHandlers",{});ne(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Vt="edit-point-mode";class Gl{constructor(e){ne(this,"map");ne(this,"active");ne(this,"eventListenersSuccess");ne(this,"eventListenersFailure");ne(this,"cursor");ne(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new sr(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),ot(e,Vt,{type:"geojson",data:ze()}),Se(e,{id:"edit-point-mode",source:Vt,...St(ue.hovering,En,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=zl(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Vt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=ze();this.cursor&&e.features.push(this.cursor),this.map.getSource(Vt).setData(e)}}function zl(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Ci(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Hl(r,e);var n=tt(r),i=tt(e),o=Be(n[0]),s=Be(i[0]),a=Be(n[1]),l=Be(i[1]),u=Math.sin(s-o)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return Fn(Math.atan2(u,p))}function Hl(r,e){var t=Ci(e,r);return t=(t+180)%360,t}function Gr(r,e,t,n){n===void 0&&(n={});var i=tt(r),o=Be(i[0]),s=Be(i[1]),a=Be(t),l=lo(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),m=Fn(p),c=Fn(u);return bt([m,c],n.properties)}function Xn(r){if(!r)throw new Error("geojson is required");var e=[];return nr(r,function(t){Yl(t,e)}),et(e)}function Yl(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ge(n);break;case"LineString":t=[Ge(n)]}t.forEach(function(i){var o=Jl(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Jl(r,e){var t=[];return r.reduce(function(n,i){var o=vt([n,i],e);return o.bbox=Xl(n,i),t.push(o),i}),t}function Xl(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var kt={},Wl={get exports(){return kt},set exports(r){kt=r}},Wn={},Vl={get exports(){return Wn},set exports(r){Wn=r}};(function(r,e){(function(t,n){r.exports=n()})(ao,function(){function t(d,b,v,M,$){(function R(L,P,F,N,W){for(;N>F;){if(N-F>600){var x=N-F+1,D=P-F+1,le=Math.log(x),pe=.5*Math.exp(2*le/3),G=.5*Math.sqrt(le*pe*(x-pe)/x)*(D-x/2<0?-1:1),ae=Math.max(F,Math.floor(P-D*pe/x+G)),Ce=Math.min(N,Math.floor(P+(x-D)*pe/x+G));R(L,P,ae,Ce,W)}var Fe=L[P],me=F,de=N;for(n(L,F,P),W(L[N],Fe)>0&&n(L,F,N);me<de;){for(n(L,me,de),me++,de--;W(L[me],Fe)<0;)me++;for(;W(L[de],Fe)>0;)de--}W(L[F],Fe)===0?n(L,F,de):n(L,++de,N),de<=P&&(F=de+1),P<=de&&(N=de-1)}})(d,b,v||0,M||d.length-1,$||i)}function n(d,b,v){var M=d[b];d[b]=d[v],d[v]=M}function i(d,b){return d<b?-1:d>b?1:0}var o=function(d){d===void 0&&(d=9),this._maxEntries=Math.max(4,d),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(d,b,v){if(!v)return b.indexOf(d);for(var M=0;M<b.length;M++)if(v(d,b[M]))return M;return-1}function a(d,b){l(d,0,d.children.length,b,d)}function l(d,b,v,M,$){$||($=_(null)),$.minX=1/0,$.minY=1/0,$.maxX=-1/0,$.maxY=-1/0;for(var R=b;R<v;R++){var L=d.children[R];u($,d.leaf?M(L):L)}return $}function u(d,b){return d.minX=Math.min(d.minX,b.minX),d.minY=Math.min(d.minY,b.minY),d.maxX=Math.max(d.maxX,b.maxX),d.maxY=Math.max(d.maxY,b.maxY),d}function p(d,b){return d.minX-b.minX}function m(d,b){return d.minY-b.minY}function c(d){return(d.maxX-d.minX)*(d.maxY-d.minY)}function f(d){return d.maxX-d.minX+(d.maxY-d.minY)}function h(d,b){return d.minX<=b.minX&&d.minY<=b.minY&&b.maxX<=d.maxX&&b.maxY<=d.maxY}function g(d,b){return b.minX<=d.maxX&&b.minY<=d.maxY&&b.maxX>=d.minX&&b.maxY>=d.minY}function _(d){return{children:d,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(d,b,v,M,$){for(var R=[b,v];R.length;)if(!((v=R.pop())-(b=R.pop())<=M)){var L=b+Math.ceil((v-b)/M/2)*M;t(d,L,b,v,$),R.push(b,L,L,v)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(d){var b=this.data,v=[];if(!g(d,b))return v;for(var M=this.toBBox,$=[];b;){for(var R=0;R<b.children.length;R++){var L=b.children[R],P=b.leaf?M(L):L;g(d,P)&&(b.leaf?v.push(L):h(d,P)?this._all(L,v):$.push(L))}b=$.pop()}return v},o.prototype.collides=function(d){var b=this.data;if(!g(d,b))return!1;for(var v=[];b;){for(var M=0;M<b.children.length;M++){var $=b.children[M],R=b.leaf?this.toBBox($):$;if(g(d,R)){if(b.leaf||h(d,R))return!0;v.push($)}}b=v.pop()}return!1},o.prototype.load=function(d){if(!d||!d.length)return this;if(d.length<this._minEntries){for(var b=0;b<d.length;b++)this.insert(d[b]);return this}var v=this._build(d.slice(),0,d.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var M=this.data;this.data=v,v=M}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},o.prototype.insert=function(d){return d&&this._insert(d,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(d,b){if(!d)return this;for(var v,M,$,R=this.data,L=this.toBBox(d),P=[],F=[];R||P.length;){if(R||(R=P.pop(),M=P[P.length-1],v=F.pop(),$=!0),R.leaf){var N=s(d,R.children,b);if(N!==-1)return R.children.splice(N,1),P.push(R),this._condense(P),this}$||R.leaf||!h(R,L)?M?(v++,R=M.children[v],$=!1):R=null:(P.push(R),F.push(v),v=0,M=R,R=R.children[0])}return this},o.prototype.toBBox=function(d){return d},o.prototype.compareMinX=function(d,b){return d.minX-b.minX},o.prototype.compareMinY=function(d,b){return d.minY-b.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(d){return this.data=d,this},o.prototype._all=function(d,b){for(var v=[];d;)d.leaf?b.push.apply(b,d.children):v.push.apply(v,d.children),d=v.pop();return b},o.prototype._build=function(d,b,v,M){var $,R=v-b+1,L=this._maxEntries;if(R<=L)return a($=_(d.slice(b,v+1)),this.toBBox),$;M||(M=Math.ceil(Math.log(R)/Math.log(L)),L=Math.ceil(R/Math.pow(L,M-1))),($=_([])).leaf=!1,$.height=M;var P=Math.ceil(R/L),F=P*Math.ceil(Math.sqrt(L));y(d,b,v,F,this.compareMinX);for(var N=b;N<=v;N+=F){var W=Math.min(N+F-1,v);y(d,N,W,P,this.compareMinY);for(var x=N;x<=W;x+=P){var D=Math.min(x+P-1,W);$.children.push(this._build(d,x,D,M-1))}}return a($,this.toBBox),$},o.prototype._chooseSubtree=function(d,b,v,M){for(;M.push(b),!b.leaf&&M.length-1!==v;){for(var $=1/0,R=1/0,L=void 0,P=0;P<b.children.length;P++){var F=b.children[P],N=c(F),W=(x=d,D=F,(Math.max(D.maxX,x.maxX)-Math.min(D.minX,x.minX))*(Math.max(D.maxY,x.maxY)-Math.min(D.minY,x.minY))-N);W<R?(R=W,$=N<$?N:$,L=F):W===R&&N<$&&($=N,L=F)}b=L||b.children[0]}var x,D;return b},o.prototype._insert=function(d,b,v){var M=v?d:this.toBBox(d),$=[],R=this._chooseSubtree(M,this.data,b,$);for(R.children.push(d),u(R,M);b>=0&&$[b].children.length>this._maxEntries;)this._split($,b),b--;this._adjustParentBBoxes(M,$,b)},o.prototype._split=function(d,b){var v=d[b],M=v.children.length,$=this._minEntries;this._chooseSplitAxis(v,$,M);var R=this._chooseSplitIndex(v,$,M),L=_(v.children.splice(R,v.children.length-R));L.height=v.height,L.leaf=v.leaf,a(v,this.toBBox),a(L,this.toBBox),b?d[b-1].children.push(L):this._splitRoot(v,L)},o.prototype._splitRoot=function(d,b){this.data=_([d,b]),this.data.height=d.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(d,b,v){for(var M,$,R,L,P,F,N,W=1/0,x=1/0,D=b;D<=v-b;D++){var le=l(d,0,D,this.toBBox),pe=l(d,D,v,this.toBBox),G=($=le,R=pe,L=void 0,P=void 0,F=void 0,N=void 0,L=Math.max($.minX,R.minX),P=Math.max($.minY,R.minY),F=Math.min($.maxX,R.maxX),N=Math.min($.maxY,R.maxY),Math.max(0,F-L)*Math.max(0,N-P)),ae=c(le)+c(pe);G<W?(W=G,M=D,x=ae<x?ae:x):G===W&&ae<x&&(x=ae,M=D)}return M||v-b},o.prototype._chooseSplitAxis=function(d,b,v){var M=d.leaf?this.compareMinX:p,$=d.leaf?this.compareMinY:m;this._allDistMargin(d,b,v,M)<this._allDistMargin(d,b,v,$)&&d.children.sort(M)},o.prototype._allDistMargin=function(d,b,v,M){d.children.sort(M);for(var $=this.toBBox,R=l(d,0,b,$),L=l(d,v-b,v,$),P=f(R)+f(L),F=b;F<v-b;F++){var N=d.children[F];u(R,d.leaf?$(N):N),P+=f(R)}for(var W=v-b-1;W>=b;W--){var x=d.children[W];u(L,d.leaf?$(x):x),P+=f(L)}return P},o.prototype._adjustParentBBoxes=function(d,b,v){for(var M=v;M>=0;M--)u(b[M],d)},o.prototype._condense=function(d){for(var b=d.length-1,v=void 0;b>=0;b--)d[b].children.length===0?b>0?(v=d[b-1].children).splice(v.indexOf(d[b]),1):this.clear():a(d[b],this.toBBox)},o})})(Vl);const Kl=rr(uo),Zl=rr(fo),Ql=rr(co);var je=Wn,Ai=Kl,Ri=Zl,ut=Ql.default,ea=Ri.featureEach;Ri.coordEach;Ai.polygon;var zr=Ai.featureCollection;function Ti(r){var e=new je(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ut(t),je.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ut(i),n.push(i)}):ea(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ut(i),n.push(i)}),je.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ut(t),je.prototype.remove.call(this,t,n)},e.clear=function(){return je.prototype.clear.call(this)},e.search=function(t){var n=je.prototype.search.call(this,this.toBBox(t));return zr(n)},e.collides=function(t){return je.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=je.prototype.all.call(this);return zr(t)},e.toJSON=function(){return je.prototype.toJSON.call(this)},e.fromJSON=function(t){return je.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ut(t);else if(t.type==="FeatureCollection")n=ut(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Wl.exports=Ti;kt.default=Ti;function xi(r,e){var t={},n=[];if(r.type==="LineString"&&(r=hr(r)),e.type==="LineString"&&(e=hr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Hr(r,e);return i&&n.push(i),et(n)}var o=kt();return o.load(Xn(e)),un(Xn(r),function(s){un(o.search(s),function(a){var l=Hr(s,a);if(l){var u=Ge(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),et(n)}function Hr(r,e){var t=Ge(r),n=Ge(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],m=n[1][1],c=(m-u)*(s-i)-(p-l)*(a-o),f=(p-l)*(o-u)-(m-u)*(i-l),h=(s-i)*(o-u)-(a-o)*(i-l);if(c===0)return f===0&&h===0,null;var g=f/c,_=h/c;if(g>=0&&g<=1&&_>=0&&_<=1){var y=i+g*(s-i),d=o+g*(a-o);return bt([y,d])}return null}function Gt(r,e,t){t===void 0&&(t={});var n=bt([1/0,1/0],{dist:1/0}),i=0;return nr(r,function(o){for(var s=Ge(o),a=0;a<s.length-1;a++){var l=bt(s[a]);l.properties.dist=Ke(e,l,t);var u=bt(s[a+1]);u.properties.dist=Ke(e,u,t);var p=Ke(l,u,t),m=Math.max(l.properties.dist,u.properties.dist),c=Ci(l,u),f=Gr(e,m,c+90,t),h=Gr(e,m,c-90,t),g=xi(vt([f.geometry.coordinates,h.geometry.coordinates]),vt([l.geometry.coordinates,u.geometry.coordinates])),_=null;g.features.length>0&&(_=g.features[0],_.properties.dist=Ke(e,_,t),_.properties.location=i+Ke(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+p),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a),i+=p}}),n}const ft="edit-polygon-mode";class ta{constructor(e){ne(this,"map");ne(this,"active");ne(this,"eventListenersSuccess");ne(this,"eventListenersFailure");ne(this,"points");ne(this,"cursor");ne(this,"hover");ne(this,"dragFrom");ne(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new sr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),ot(e,ft,{type:"geojson",data:ze()}),Se(e,{id:"edit-polygon-fill",source:ft,filter:Sn,...vn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Se(e,{id:"edit-polygon-lines",source:ft,filter:kn,...Dt("black",8,.5)}),Se(e,{id:"edit-polygon-vertices",source:ft,filter:wn,...St(ue.hovering,En,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Jr(this.points).forEach((n,i)=>{t.push([i+1,Gt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(ft),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=ze();this.points.forEach((n,i)=>{let o=Yr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Jr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(ft).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Yr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Yr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Jr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let X;const We=new Array(32).fill(void 0);We.push(void 0,null,!0,!1);function J(r){return We[r]}let Ft=We.length;function na(r){r<36||(We[r]=Ft,Ft=r)}function Vn(r){const e=J(r);return na(r),e}const Pi=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Pi.decode();let nn=new Uint8Array;function Nt(){return nn.byteLength===0&&(nn=new Uint8Array(X.memory.buffer)),nn}function pt(r,e){return Pi.decode(Nt().subarray(r,r+e))}function ye(r){Ft===We.length&&We.push(We.length+1);const e=Ft;return Ft=We[e],We[e]=r,e}function Tn(r){return r==null}let rn=new Float64Array;function ra(){return rn.byteLength===0&&(rn=new Float64Array(X.memory.buffer)),rn}let on=new Int32Array;function ve(){return on.byteLength===0&&(on=new Int32Array(X.memory.buffer)),on}let Qe=0;const sn=new TextEncoder("utf-8"),ia=typeof sn.encodeInto=="function"?function(r,e){return sn.encodeInto(r,e)}:function(r,e){const t=sn.encode(r);return e.set(t),{read:r.length,written:t.length}};function Kt(r,e,t){if(t===void 0){const a=sn.encode(r),l=e(a.length);return Nt().subarray(l,l+a.length).set(a),Qe=a.length,l}let n=r.length,i=e(n);const o=Nt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=Nt().subarray(i+s,i+n),l=ia(r,a);s+=l.written}return Qe=s,i}function Kn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Kn(r[0]));for(let s=1;s<i;s++)o+=", "+Kn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function oa(r,e){const t=e(r.length*1);return Nt().set(r,t/1),Qe=r.length,t}function xn(r,e){try{return r.apply(this,e)}catch(t){X.__wbindgen_exn_store(ye(t))}}class _n{static __wrap(e){const t=Object.create(_n.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();X.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=X.__wbindgen_add_to_stack_pointer(-16),s=oa(e,X.__wbindgen_malloc),a=Qe;X.jsroutesnapper_new(o,s,a);var t=ve()[o/4+0],n=ve()[o/4+1],i=ve()[o/4+2];if(i)throw Vn(n);return _n.__wrap(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){X.jsroutesnapper_setConfig(this.ptr,ye(e))}toFinalFeature(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ve()[n/4+0],t=ve()[n/4+1];let i;return e!==0&&(i=pt(e,t).slice(),X.__wbindgen_free(e,t*1)),i}finally{X.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_renderGeojson(n,this.ptr);var e=ve()[n/4+0],t=ve()[n/4+1];return pt(e,t)}finally{X.__wbindgen_add_to_stack_pointer(16),X.__wbindgen_free(e,t)}}setSnapMode(e){X.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return X.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){X.jsroutesnapper_onClick(this.ptr)}onDragStart(){return X.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return X.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){X.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_editExisting(i,this.ptr,ye(e));var t=ve()[i/4+0],n=ve()[i/4+1];if(n)throw Vn(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}}async function sa(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function la(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Vn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(pt(e,t));return ye(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=pt(e,t);return ye(n)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;ra()[e/8+1]=Tn(i)?0:i,ve()[e/4+0]=!Tn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=Tn(i)?0:Kt(i,X.__wbindgen_malloc,X.__wbindgen_realloc),s=Qe;ve()[e/4+1]=s,ve()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(J(t)),i=Kt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=Qe;ve()[e/4+1]=o,ve()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return ye(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=J(e)[J(t)];return ye(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(J(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(J(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(J(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(J(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(J(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=J(e)[t>>>0];return ye(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=J(e).next;return ye(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return xn(function(e){const t=J(e).next();return ye(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return J(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=J(e).value;return ye(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ye(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return xn(function(e,t){const n=Reflect.get(J(e),J(t));return ye(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return xn(function(e,t){const n=J(e).call(J(t));return ye(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=J(e).buffer;return ye(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(J(e));return ye(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ye(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=Kt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=Qe;ve()[e/4+1]=o,ve()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(pt(e,t))}finally{X.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=Kn(J(t)),i=Kt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=Qe;ve()[e/4+1]=o,ve()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(pt(e,t))},r.wbg.__wbindgen_memory=function(){const e=X.memory;return ye(e)},r}function aa(r,e){return X=r.exports,Ii.__wbindgen_wasm_module=e,rn=new Float64Array,on=new Int32Array,nn=new Uint8Array,X}async function Ii(r){typeof r>"u"&&(r="/atip/per_schema_legend/assets/route_snapper_bg.wasm");const e=la();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await sa(await r,e);return aa(t,n)}const $t="route-snapper",Xr=10,ua=30;class fa{constructor(e,t){ne(this,"map");ne(this,"inner");ne(this,"active");ne(this,"eventListenersSuccessRoute");ne(this,"eventListenersSuccessArea");ne(this,"eventListenersFailure");ne(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new _n(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],ot(e,$t,{type:"geojson",data:ze()}),Se(e,{id:"route-points",source:$t,filter:wn,...St(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Xr/2,Xr])}),Se(e,{id:"route-lines",source:$t,filter:kn,...Dt("black",2.5)}),Se(e,{id:"route-polygons",source:$t,filter:Sn,...vn("black",.5)}),this.events=new sr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-ua,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource($t).setData(JSON.parse(this.inner.renderGeojson()))}}function Wr(r){let e;function t(o,s){return o[1]?pa:ca}let n=t(r),i=n(r);return{c(){i.c(),e=he()},m(o,s){i.m(o,s),k(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&S(e)}}}function ca(r){let e;return{c(){e=E("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function pa(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function da(r){let e,t=r[0]==dt&&Wr(r);return{c(){t&&t.c(),e=he()},m(n,i){t&&t.m(n,i),k(n,e,i)},p(n,[i]){n[0]==dt?t?t.p(n,i):(t=Wr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:z,o:z,d(n){t&&t.d(n),n&&S(e)}}}const dt="edit-attribute";function Fi(){}function ha(r,e,t){let n,i,o,s;oe(r,Ye,f=>t(5,n=f)),oe(r,te,f=>t(6,i=f)),oe(r,qt,f=>t(7,o=f)),oe(r,Me,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){Me.set(null)}n.on("mousemove",p),n.on("mouseout",m),n.on("click",c),zt(()=>{n.off("mousemove",p),n.off("mouseout",m),n.off("click",c)});function p(f){var h;if(a==dt){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ue.set(((h=g[0])==null?void 0:h.id)||null)}}function m(){a==dt&&Ue.set(null)}function c(f){if(a==dt){let h=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});h.length>0?Me.set(h[0].id):Me.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let h=i.features.find(g=>g.id==f);h.geometry.type=="Point"?n.flyTo({center:h.geometry.coordinates,duration:500}):n.fitBounds(tr(h),{padding:200,duration:500}),l(dt)}}},[a,s,l,Fi,u,n,i,o]}class ma extends Q{constructor(e){super(),ee(this,e,ha,da,Z,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Fi}get stop(){return this.$$.ctx[4]}}function _a(r){let e,t;return{c:z,m(n,i){e||(t=B(window,"keydown",r[0]),e=!0)},p:z,i:z,o:z,d(n){e=!1,t()}}}function ga(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class On extends Q{constructor(e){super(),ee(this,e,ga,_a,Z,{tool:1})}}function ba(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function ya(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function va(r){let e,t,n,i,o,s,a,l,u,p;function m(h,g){return h[1]?ya:ba}let c=m(r),f=c(r);return a=new On({props:{tool:r[0]}}),{c(){e=E("ul"),f.c(),t=A(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=A(),o=E("button"),o.textContent="Cancel",s=A(),j(a.$$.fragment),O(o,"type","button")},m(h,g){k(h,e,g),f.m(e,null),w(e,t),w(e,n),k(h,i,g),k(h,o,g),k(h,s,g),q(a,h,g),l=!0,u||(p=B(o,"click",r[2]),u=!0)},p(h,[g]){c!==(c=m(h))&&(f.d(1),f=c(h),f&&(f.c(),f.m(e,t)));const _={};g&1&&(_.tool=h[0]),a.$set(_)},i(h){l||(C(a.$$.fragment,h),l=!0)},o(h){T(a.$$.fragment,h),l=!1},d(h){h&&S(e),f.d(),h&&S(i),h&&S(o),h&&S(s),U(a,h),u=!1,p()}}}function wa(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Ni extends Q{constructor(e){super(),ee(this,e,wa,va,Z,{pointTool:0,editingExisting:1})}}function ka(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},p:z,d(t){t&&S(e)}}}function Sa(r){let e,t,n,i,o,s,a,l,u,p,m;return e=new Mn({props:{label:"Help",$$slots:{default:[ka]},$$scope:{ctx:r}}}),l=new On({props:{tool:r[0]}}),{c(){j(e.$$.fragment),t=A(),n=E("div"),i=E("button"),i.textContent="Finish",o=A(),s=E("button"),s.textContent="Cancel",a=A(),j(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),fe(n,"display","flex"),fe(n,"justify-content","space-between")},m(c,f){q(e,c,f),k(c,t,f),k(c,n,f),w(n,i),w(n,o),w(n,s),k(c,a,f),q(l,c,f),u=!0,p||(m=[B(i,"click",r[1]),B(s,"click",r[2])],p=!0)},p(c,[f]){const h={};f&8&&(h.$$scope={dirty:f,ctx:c}),e.$set(h);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||(C(e.$$.fragment,c),C(l.$$.fragment,c),u=!0)},o(c){T(e.$$.fragment,c),T(l.$$.fragment,c),u=!1},d(c){U(e,c),c&&S(t),c&&S(n),c&&S(a),U(l,c),p=!1,xe(m)}}}function Ea(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Bi extends Q{constructor(e){super(),ee(this,e,Ea,Sa,Z,{polygonTool:0})}}function Ma(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},p:z,d(t){t&&S(e)}}}function Oa(r){let e,t,n,i,o,s,a,l,u,p,m;return e=new Mn({props:{label:"Help",$$slots:{default:[Ma]},$$scope:{ctx:r}}}),l=new On({props:{tool:r[0]}}),{c(){j(e.$$.fragment),t=A(),n=E("div"),i=E("button"),i.textContent="Finish",o=A(),s=E("button"),s.textContent="Cancel",a=A(),j(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),fe(n,"display","flex"),fe(n,"justify-content","space-between")},m(c,f){q(e,c,f),k(c,t,f),k(c,n,f),w(n,i),w(n,o),w(n,s),k(c,a,f),q(l,c,f),u=!0,p||(m=[B(i,"click",r[1]),B(s,"click",r[2])],p=!0)},p(c,[f]){const h={};f&8&&(h.$$scope={dirty:f,ctx:c}),e.$set(h);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||(C(e.$$.fragment,c),C(l.$$.fragment,c),u=!0)},o(c){T(e.$$.fragment,c),T(l.$$.fragment,c),u=!1},d(c){U(e,c),c&&S(t),c&&S(n),c&&S(a),U(l,c),p=!1,xe(m)}}}function $a(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Di extends Q{constructor(e){super(),ee(this,e,$a,Oa,Z,{routeTool:0})}}function La(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},p:z,d(t){t&&S(e)}}}function Ca(r){let e,t,n,i,o,s,a,l,u,p,m,c,f,h,g;return e=new Mn({props:{label:"Help",$$slots:{default:[La]},$$scope:{ctx:r}}}),c=new On({props:{tool:r[0]}}),{c(){j(e.$$.fragment),t=A(),n=E("label"),i=E("input"),o=Y(`
  Avoid doubling back`),s=A(),a=E("div"),l=E("button"),l.textContent="Finish",u=A(),p=E("button"),p.textContent="Cancel",m=A(),j(c.$$.fragment),O(i,"type","checkbox"),O(l,"type","button"),O(p,"type","button"),fe(a,"display","flex"),fe(a,"justify-content","space-between")},m(_,y){q(e,_,y),k(_,t,y),k(_,n,y),w(n,i),i.checked=r[1],w(n,o),k(_,s,y),k(_,a,y),w(a,l),w(a,u),w(a,p),k(_,m,y),q(c,_,y),f=!0,h||(g=[B(i,"change",r[2]),B(l,"click",r[3]),B(p,"click",r[4])],h=!0)},p(_,[y]){const d={};y&32&&(d.$$scope={dirty:y,ctx:_}),e.$set(d),y&2&&(i.checked=_[1]);const b={};y&1&&(b.tool=_[0]),c.$set(b)},i(_){f||(C(e.$$.fragment,_),C(c.$$.fragment,_),f=!0)},o(_){T(e.$$.fragment,_),T(c.$$.fragment,_),f=!1},d(_){U(e,_),_&&S(t),_&&S(n),_&&S(s),_&&S(a),_&&S(m),U(c,_),h=!1,xe(g)}}}function Aa(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class ji extends Q{constructor(e){super(),ee(this,e,Aa,Ca,Z,{routeTool:0})}}function Vr(r){let e,t,n,i;const o=[Ia,Pa,xa,Ta,Ra],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=he()},m(l,u){s[e].m(l,u),k(l,n,u),i=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(we(),T(s[p],1,1,()=>{s[p]=null}),ke(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),C(t,1),t.m(n.parentNode,n))},i(l){i||(C(t),i=!0)},o(l){T(t),i=!1},d(l){s[e].d(l),l&&S(n)}}}function Ra(r){let e;return{c(){e=E("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){k(t,e,n)},p:z,i:z,o:z,d(t){t&&S(e)}}}function Ta(r){let e,t;return e=new ji({props:{routeTool:r[3]}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function xa(r){let e,t;return e=new Di({props:{routeTool:r[3]}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Pa(r){let e,t;return e=new Bi({props:{polygonTool:r[2]}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Ia(r){let e,t;return e=new Ni({props:{pointTool:r[1],editingExisting:!0}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Fa(r){let e,t,n=r[0]==Je&&Vr(r);return{c(){n&&n.c(),e=he()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==Je?n?(n.p(i,o),o&1&&C(n,1)):(n=Vr(i),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(we(),T(n,1,1,()=>{n=null}),ke())},i(i){t||(C(n),t=!0)},o(i){T(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const Je="edit-geometry";function qi(){}function Na(r,e,t){let n;oe(r,Ye,g=>t(8,n=g));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(o.stop(),s.stop(),a.stop(),te.update(g=>{let _=g.features.find(y=>y.id==l);return delete _.properties.hide_while_editing,g})),l=null,t(4,u=null),Ue.set(null)}n.on("mousemove",m),n.on("mouseout",c),n.on("click",f),zt(()=>{n.off("mousemove",m),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(g=>{i==Je&&(te.update(_=>{let y=_.features.find(d=>d.id==l);return y.properties.length_meters=g.properties.length_meters,y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,_}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{i==Je&&(te.update(_=>{let y=_.features.find(d=>d.id==l);return y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,_}),l=null,t(4,u=null))});for(let g of[o,s])g.addEventListenerSuccess(_=>{i==Je&&(te.update(y=>{let d=y.features.find(b=>b.id==l);return d.geometry=_.geometry,delete d.properties.hide_while_editing,y}),l=null,t(4,u=null))});for(let g of[o,s,a])g.addEventListenerFailure(()=>{i==Je&&(te.update(_=>{let y=_.features.find(d=>d.id==l);return delete y.properties.hide_while_editing,_}),l=null,t(4,u=null))});function m(g){var _;if(i==Je&&l==null){let y=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ue.set(((_=y[0])==null?void 0:_.id)||null)}}function c(){i==Je&&l==null&&Ue.set(null)}function f(g){if(i==Je&&l==null){let _=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&h(_[0].id)}}function h(g){Ue.set(null);let _=null;te.update(d=>(_=d.features.find(b=>b.id==g),_.properties.hide_while_editing=!0,d));let y=_;l=g,y.geometry.type=="LineString"?(a.editExistingRoute(y),t(4,u="route")):y.geometry.type=="Polygon"?y.properties.waypoints?(a.editExistingArea(y),t(4,u="snap-polygon")):(s.editExisting(y),t(4,u="free-polygon")):y.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"pointTool"in g&&t(1,o=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[i,o,s,a,u,qi,p]}class Ba extends Q{constructor(e){super(),ee(this,e,Na,Fa,Z,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return qi}get stop(){return this.$$.ctx[6]}}async function Da(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),o+=p.length;const m=100*o/i;e.style=`background: linear-gradient(to right, red ${m}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function ja(r){let e,t;return e=new ji({props:{routeTool:r[0]}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function qa(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){k(t,e,n),r[7](e)},p:z,i:z,o:z,d(t){t&&S(e),r[7](null)}}}function Ua(r){let e,t,n,i;const o=[qa,ja],s=[];function a(l,u){return l[0]?l[1]==Zn?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=he()},m(l,u){~e&&s[e].m(l,u),k(l,n,u),i=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(we(),T(s[p],1,1,()=>{s[p]=null}),ke()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),C(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(C(t),i=!0)},o(l){T(t),i=!1},d(l){~e&&s[e].d(l),l&&S(n)}}}const Zn="route";function Ga(r,e,t){let n;oe(r,Ye,c=>t(8,n=c));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}er(async()=>{await Ii(),console.log(`Grabbing ${s}`);try{const c=await Da(s,a);t(0,l=new fa(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==Zn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{i==Zn&&(te.update(f=>(c.id=Yt(f),c.properties.intervention_type="route",f.features.push(c),f)),o("edit-attribute"),Me.set(c.id))})});function m(c){ie[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,i=c.mode),"changeMode"in c&&t(3,o=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,i,a,o,s,u,p,m]}class za extends Q{constructor(e){super(),ee(this,e,Ga,Ua,Z,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Kr(r){let e,t;return e=new Ni({props:{pointTool:r[1],editingExisting:!1}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Ha(r){let e,t,n=r[0]==gn&&Kr(r);return{c(){n&&n.c(),e=he()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==gn?n?(n.p(i,o),o&1&&C(n,1)):(n=Kr(i),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(we(),T(n,1,1,()=>{n=null}),ke())},i(i){t||(C(n),t=!0)},o(i){T(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const gn="point";function Ya(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==gn&&(te.update(u=>(l.id=Yt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),Me.set(l.id))}),o.addEventListenerFailure(()=>{n==gn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class Ja extends Q{constructor(e){super(),ee(this,e,Ya,Ha,Z,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Zr(r){let e,t;return e=new Bi({props:{polygonTool:r[1]}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Xa(r){let e,t,n=r[0]==bn&&Zr(r);return{c(){n&&n.c(),e=he()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==bn?n?(n.p(i,o),o&1&&C(n,1)):(n=Zr(i),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(we(),T(n,1,1,()=>{n=null}),ke())},i(i){t||(C(n),t=!0)},o(i){T(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const bn="free-polygon";function Wa(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==bn&&(te.update(u=>(l.id=Yt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Me.set(l.id))}),o.addEventListenerFailure(()=>{n==bn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Va extends Q{constructor(e){super(),ee(this,e,Wa,Xa,Z,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Qr(r){let e,t;return e=new Di({props:{routeTool:r[1]}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){T(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Ka(r){let e,t,n=r[0]==yn&&Qr(r);return{c(){n&&n.c(),e=he()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==yn?n?(n.p(i,o),o&1&&C(n,1)):(n=Qr(i),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(we(),T(n,1,1,()=>{n=null}),ke())},i(i){t||(C(n),t=!0)},o(i){T(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const yn="snap-polygon";function Za(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==yn&&(te.update(u=>(l.id=Yt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Me.set(l.id))}),o.addEventListenerFailure(()=>{n==yn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class Qa extends Q{constructor(e){super(),ee(this,e,Za,Ka,Z,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function eu(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Ke(r.slice(0,2),[n,t]),s=Ke(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function tu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return po(r,function(s){nu(s,o,n)}),r}function nu(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function ru(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Jn(r),n=Jn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=tu(e,{precision:7});switch(n){case"Point":return Qn(r,i);case"MultiPoint":return ei(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return ei(r,xi(r,i))}}function ei(r,e){var t=[],n=kt();return nr(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=Qn(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=eu(ho(a)))}),n.load(et(t));else{var o=n.search(i);if(o.features.length){var s=Ui(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),un(Qn(s,i),function(a){t.push(a),n.insert(a)})}}}),et(t)}function Qn(r,e){var t=[],n=Ge(r)[0],i=Ge(r)[r.geometry.coordinates.length-1];if(Pn(n,tt(e))||Pn(i,tt(e)))return et([r]);var o=kt(),s=Xn(r);o.load(s);var a=o.search(e);if(!a.features.length)return et([r]);var l=Ui(e,a),u=[n],p=mo(s,function(m,c,f){var h=Ge(c)[1],g=tt(e);return f===l.id?(m.push(g),t.push(vt(m)),Pn(g,h)?[g]:[g,h]):(m.push(h),m)},u);return p.length>1&&t.push(vt(p)),et(t)}function Ui(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return un(e,function(i){var o=Gt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function Pn(r,e){return r[0]===e[0]&&r[1]===e[1]}function iu(r,e,t){var n=Ge(t);if(Jn(t)!=="LineString")throw new Error("line must be a LineString");var i=Gt(t,r),o=Gt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),vt(a,t.properties)}function ti(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function ou(r){let e,t,n,i=r[0]==Bt&&ti();return{c(){i&&i.c(),e=he()},m(o,s){i&&i.m(o,s),k(o,e,s),t||(n=B(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Bt?i||(i=ti(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:z,o:z,d(o){i&&i.d(o),o&&S(e),t=!1,n()}}}const Bt="split-route",su=10,lu=30;let In="split-route";function Gi(){}function ni(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function au(r,e,t){let n,i;oe(r,te,g=>t(8,n=g)),oe(r,Ye,g=>t(6,i=g));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",p),i.on("click",m),zt(()=>{i.off("mousemove",p),i.off("click",m)}),ot(i,In,{type:"geojson",data:ze()}),Se(i,{id:"draw-split-route",source:In,...St("black",su,["case",["==",["get","snapped"],!0],1,.5])});function p(g){if(o!=Bt)return;t(5,l=ni(g.lngLat.toArray(),!1)),u=null;const _=[g.point.x-lu,g.point.y],y=i.unproject(g.point).distanceTo(i.unproject(_))/1e3;let d=[];for(let[b,v]of n.features.entries())if(v.geometry.type=="LineString"){let M=Gt(v.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=y&&d.push([b,M.geometry.coordinates,M.properties.dist])}d.sort((b,v)=>b[2]-v[2]),d.length>0&&(t(5,l=ni(d[0][1],!0)),u=d[0][0])}function m(){if(o==Bt)if(u==null)s("edit-attribute");else{let g=ru(n.features[u],l);if(g.features.length==2){let _=g.features[0],y=g.features[1];te.update(d=>(_.id=d.features[u].id,y.id=Yt(d),_.properties=JSON.parse(JSON.stringify(d.features[u].properties)),y.properties=JSON.parse(JSON.stringify(_.properties)),c(d.features[u],_,y,l),d.features.splice(u,1,_,y),d))}a()}}function c(g,_,y,d){_.properties.length_meters=tn(_,{units:"kilometers"})*1e3,y.properties.length_meters=tn(y,{units:"kilometers"})*1e3,_.properties.waypoints=[],y.properties.waypoints=[];let b=f(g,d),v=!0,M=0;for(let $ of g.properties.waypoints){let R=f(g,bt([$.lon,$.lat]));if(v)if(R<b)_.properties.waypoints.push($);else{let L=$.snapped&&g.properties.waypoints[M-1].snapped;_.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:L}),v=!1,y.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:L}),y.properties.waypoints.push($)}else y.properties.waypoints.push($);M++}}function f(g,_){let y=g.geometry.coordinates[0],d=iu(y,_,g);return tn(d,{units:"kilometers"})*1e3}function h(g){o==Bt&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=ze();l&&g.features.push(l),i.getSource(In).setData(g)}},[o,h,s,Gi,a,l,i]}class uu extends Q{constructor(e){super(),ee(this,e,au,ou,Z,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Gi}get stop(){return this.$$.ctx[4]}}function ri(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new Ba({props:n}),r[17](e),{c(){j(e.$$.fragment)},m(i,o){q(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){T(e.$$.fragment,i),t=!1},d(i){r[17](null),U(e,i)}}}function ii(r){let e,t,n,i,o;return{c(){e=E("button"),t=Y("New point"),O(e,"type","button"),e.disabled=n=r[3]=="point",O(e,"class","svelte-1yde1zx")},m(s,a){k(s,e,a),w(e,t),i||(o=B(e,"click",r[18]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&S(e),i=!1,o()}}}function oi(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Qa({props:n}),r[23](e),{c(){j(e.$$.fragment)},m(i,o){q(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){T(e.$$.fragment,i),t=!1},d(i){r[23](null),U(e,i)}}}function si(r){let e,t,n,i,o;return{c(){e=E("button"),t=Y("New route"),O(e,"type","button"),e.disabled=n=r[3]=="route",O(e,"class","svelte-1yde1zx")},m(s,a){k(s,e,a),w(e,t),i||(o=B(e,"click",r[24]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&S(e),i=!1,o()}}}function li(r){let e,t,n,i,o;return{c(){e=E("button"),t=Y("Split route"),O(e,"type","button"),e.disabled=n=r[3]=="split-route",O(e,"class","svelte-1yde1zx")},m(s,a){k(s,e,a),w(e,t),i||(o=B(e,"click",r[27]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&S(e),i=!1,o()}}}function fu(r){let e,t,n,i,o,s,a,l,u,p,m,c,f,h,g,_,y,d,b,v,M,$,R,L,P,F,N,W,x,D,le,pe,G,ae,Ce,Fe,me,de,Ne,se,I,K,zi={mode:r[3],changeMode:r[13]};a=new ma({props:zi}),r[15](a);let _e=r[2]&&ri(r),Ae=r[1]!="planning"&&ii(r),Hi={mode:r[3],changeMode:r[13],pointTool:r[11]};y=new Ja({props:Hi}),r[19](y);let Yi={mode:r[3],changeMode:r[13],polygonTool:r[12]};L=new Va({props:Yi}),r[21](L);let ge=r[2]&&oi(r),Re=r[1]!="planning"&&si(r);function Ji(H){r[26](H)}let lr={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(lr.routeTool=r[2]),ae=new za({props:lr}),r[25](ae),ie.push(()=>Oe(ae,"routeTool",Ji,r[2]));let Te=r[1]!="planning"&&li(r),Xi={mode:r[3],changeMode:r[13]};return Ne=new uu({props:Xi}),r[28](Ne),{c(){e=E("div"),t=E("div"),n=E("button"),i=Y("Edit attributes"),s=A(),j(a.$$.fragment),l=A(),u=E("div"),p=E("button"),m=Y("Edit geometry"),f=A(),_e&&_e.c(),h=A(),g=E("div"),Ae&&Ae.c(),_=A(),j(y.$$.fragment),d=A(),b=E("div"),v=E("button"),M=Y("New polygon (freehand)"),R=A(),j(L.$$.fragment),P=A(),F=E("div"),N=E("button"),W=Y("New polygon (snapped)"),D=A(),ge&&ge.c(),le=A(),pe=E("div"),Re&&Re.c(),G=A(),j(ae.$$.fragment),Fe=A(),me=E("div"),Te&&Te.c(),de=A(),j(Ne.$$.fragment),O(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",O(n,"class","svelte-1yde1zx"),O(p,"type","button"),p.disabled=c=r[3]=="edit-geometry",O(p,"class","svelte-1yde1zx"),O(v,"type","button"),v.disabled=$=r[3]=="free-polygon",O(v,"class","svelte-1yde1zx"),O(N,"type","button"),N.disabled=x=r[3]=="snap-polygon",O(N,"class","svelte-1yde1zx"),O(e,"class","toolbox svelte-1yde1zx")},m(H,ce){k(H,e,ce),w(e,t),w(t,n),w(n,i),w(t,s),q(a,t,null),w(e,l),w(e,u),w(u,p),w(p,m),w(u,f),_e&&_e.m(u,null),w(e,h),w(e,g),Ae&&Ae.m(g,null),w(g,_),q(y,g,null),w(e,d),w(e,b),w(b,v),w(v,M),w(b,R),q(L,b,null),w(e,P),w(e,F),w(F,N),w(N,W),w(F,D),ge&&ge.m(F,null),w(e,le),w(e,pe),Re&&Re.m(pe,null),w(pe,G),q(ae,pe,null),w(e,Fe),w(e,me),Te&&Te.m(me,null),w(me,de),q(Ne,me,null),se=!0,I||(K=[B(n,"click",r[14]),B(p,"click",r[16]),B(v,"click",r[20]),B(N,"click",r[22])],I=!0)},p(H,[ce]){(!se||ce&8&&o!==(o=H[3]=="edit-attribute"))&&(n.disabled=o);const ar={};ce&8&&(ar.mode=H[3]),a.$set(ar),(!se||ce&8&&c!==(c=H[3]=="edit-geometry"))&&(p.disabled=c),H[2]?_e?(_e.p(H,ce),ce&4&&C(_e,1)):(_e=ri(H),_e.c(),C(_e,1),_e.m(u,null)):_e&&(we(),T(_e,1,1,()=>{_e=null}),ke()),H[1]!="planning"?Ae?Ae.p(H,ce):(Ae=ii(H),Ae.c(),Ae.m(g,_)):Ae&&(Ae.d(1),Ae=null);const ur={};ce&8&&(ur.mode=H[3]),y.$set(ur),(!se||ce&8&&$!==($=H[3]=="free-polygon"))&&(v.disabled=$);const fr={};ce&8&&(fr.mode=H[3]),L.$set(fr),(!se||ce&8&&x!==(x=H[3]=="snap-polygon"))&&(N.disabled=x),H[2]?ge?(ge.p(H,ce),ce&4&&C(ge,1)):(ge=oi(H),ge.c(),C(ge,1),ge.m(F,null)):ge&&(we(),T(ge,1,1,()=>{ge=null}),ke()),H[1]!="planning"?Re?Re.p(H,ce):(Re=si(H),Re.c(),Re.m(pe,G)):Re&&(Re.d(1),Re=null);const Xt={};ce&8&&(Xt.mode=H[3]),ce&1&&(Xt.url=H[0]),!Ce&&ce&4&&(Ce=!0,Xt.routeTool=H[2],$e(()=>Ce=!1)),ae.$set(Xt),H[1]!="planning"?Te?Te.p(H,ce):(Te=li(H),Te.c(),Te.m(me,de)):Te&&(Te.d(1),Te=null);const cr={};ce&8&&(cr.mode=H[3]),Ne.$set(cr)},i(H){se||(C(a.$$.fragment,H),C(_e),C(y.$$.fragment,H),C(L.$$.fragment,H),C(ge),C(ae.$$.fragment,H),C(Ne.$$.fragment,H),se=!0)},o(H){T(a.$$.fragment,H),T(_e),T(y.$$.fragment,H),T(L.$$.fragment,H),T(ge),T(ae.$$.fragment,H),T(Ne.$$.fragment,H),se=!1},d(H){H&&S(e),r[15](null),U(a),_e&&_e.d(),Ae&&Ae.d(),r[19](null),U(y),r[21](null),U(L),ge&&ge.d(),Re&&Re.d(),r[25](null),U(ae),Te&&Te.d(),r[28](null),U(Ne),I=!1,xe(K)}}}function cu(r,e,t){let n;oe(r,Ye,G=>t(29,n=G));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new Gl(n),l=new ta(n),u="edit-attribute",p,m,c,f,h,g,_;function y(G){let ae={"edit-attribute":p,"edit-geometry":m,route:c,point:f,"free-polygon":h,"snap-polygon":g,"split-route":_};if(u==G){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),ae[u].stop(),t(3,u=G),console.log(`Starting new mode ${u}`),ae[u].start()}zt(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const d=()=>y("edit-attribute");function b(G){ie[G?"unshift":"push"](()=>{p=G,t(4,p)})}const v=()=>y("edit-geometry");function M(G){ie[G?"unshift":"push"](()=>{m=G,t(5,m)})}const $=()=>y("point");function R(G){ie[G?"unshift":"push"](()=>{f=G,t(7,f)})}const L=()=>y("free-polygon");function P(G){ie[G?"unshift":"push"](()=>{h=G,t(8,h)})}const F=()=>y("snap-polygon");function N(G){ie[G?"unshift":"push"](()=>{g=G,t(9,g)})}const W=()=>y("route");function x(G){ie[G?"unshift":"push"](()=>{c=G,t(6,c)})}function D(G){s=G,t(2,s)}const le=()=>y("split-route");function pe(G){ie[G?"unshift":"push"](()=>{_=G,t(10,_)})}return r.$$set=G=>{"routeSnapperUrl"in G&&t(0,i=G.routeSnapperUrl),"schema"in G&&t(1,o=G.schema)},[i,o,s,u,p,m,c,f,h,g,_,a,l,y,d,b,v,M,$,R,L,P,F,N,W,x,D,le,pe]}class pu extends Q{constructor(e){super(),ee(this,e,cu,fu,Z,{routeSnapperUrl:0,schema:1})}}function du(r){let e,t,n,i,o,s,a,l,u,p,m,c,f,h,g,_,y,d,b;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",i=A(),o=E("button"),o.textContent="About",s=A(),a=E("button"),a.textContent="Instructions",l=A(),u=E("br"),p=A(),m=E("label"),c=Y(`ATIP schema:
      `),f=E("select"),h=E("option"),h.textContent="v1",g=E("option"),g.textContent="v2",_=E("option"),_.textContent="Housing developments",y=E("option"),y.textContent="Critical issues",O(n,"type","button"),O(o,"type","button"),O(a,"type","button"),h.__value="v1",h.value=h.__value,g.__value="v2",g.value=g.__value,_.__value="planning",_.value=_.__value,y.__value="criticals",y.value=y.__value,r[2]===void 0&&Ht(()=>r[12].call(f)),O(e,"slot","nav")},m(v,M){k(v,e,M),w(e,t),w(t,n),w(t,i),w(t,o),w(t,s),w(t,a),w(e,l),w(e,u),w(e,p),w(e,m),w(m,c),w(m,f),w(f,h),w(f,g),w(f,_),w(f,y),an(f,r[2]),d||(b=[B(n,"click",r[11]),B(o,"click",r[8]),B(a,"click",r[9]),B(f,"change",r[12]),B(f,"change",r[10])],d=!0)},p(v,M){M&4&&an(f,v[2])},d(v){v&&S(e),d=!1,xe(b)}}}function hu(r){let e,t,n,i,o,s,a,l,u,p,m,c;return o=new $l({props:{boundaryGeojson:r[5]}}),a=new Sl({props:{authorityName:r[6],schema:r[2]}}),m=new bl({props:{schema:r[2],routeInfo:r[4]}}),{c(){e=E("div"),t=E("h1"),n=Y(r[6]),i=A(),j(o.$$.fragment),s=A(),j(a.$$.fragment),l=A(),u=E("br"),p=A(),j(m.$$.fragment),O(e,"slot","sidebar")},m(f,h){k(f,e,h),w(e,t),w(t,n),w(t,i),q(o,t,null),w(e,s),q(a,e,null),w(e,l),w(e,u),w(e,p),q(m,e,null),c=!0},p(f,h){const g={};h&32&&(g.boundaryGeojson=f[5]),o.$set(g);const _={};h&4&&(_.schema=f[2]),a.$set(_);const y={};h&4&&(y.schema=f[2]),h&16&&(y.routeInfo=f[4]),m.$set(y)},i(f){c||(C(o.$$.fragment,f),C(a.$$.fragment,f),C(m.$$.fragment,f),c=!0)},o(f){T(o.$$.fragment,f),T(a.$$.fragment,f),T(m.$$.fragment,f),c=!1},d(f){f&&S(e),U(o),U(a),U(m)}}}function mu(r){let e,t,n,i,o,s,a,l,u,p,m,c;return e=new Ms({props:{boundaryGeojson:r[5]}}),n=new jl({props:{schema:r[2]}}),o=new Ul({}),a=new pu({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new Al({props:{style:r[7]}}),m=new Bl({props:{schema:r[2]}}),{c(){j(e.$$.fragment),t=A(),j(n.$$.fragment),i=A(),j(o.$$.fragment),s=A(),j(a.$$.fragment),l=A(),j(u.$$.fragment),p=A(),j(m.$$.fragment)},m(f,h){q(e,f,h),k(f,t,h),q(n,f,h),k(f,i,h),q(o,f,h),k(f,s,h),q(a,f,h),k(f,l,h),q(u,f,h),k(f,p,h),q(m,f,h),c=!0},p(f,h){const g={};h&32&&(g.boundaryGeojson=f[5]),e.$set(g);const _={};h&4&&(_.schema=f[2]),n.$set(_);const y={};h&8&&(y.routeSnapperUrl=f[3]),h&4&&(y.schema=f[2]),a.$set(y);const d={};h&4&&(d.schema=f[2]),m.$set(d)},i(f){c||(C(e.$$.fragment,f),C(n.$$.fragment,f),C(o.$$.fragment,f),C(a.$$.fragment,f),C(u.$$.fragment,f),C(m.$$.fragment,f),c=!0)},o(f){T(e.$$.fragment,f),T(n.$$.fragment,f),T(o.$$.fragment,f),T(a.$$.fragment,f),T(u.$$.fragment,f),T(m.$$.fragment,f),c=!1},d(f){U(e,f),f&&S(t),U(n,f),f&&S(i),U(o,f),f&&S(s),U(a,f),f&&S(l),U(u,f),f&&S(p),U(m,f)}}}function _u(r){let e,t,n;return t=new Yo({props:{style:r[7],$$slots:{default:[mu]},$$scope:{ctx:r}}}),{c(){e=E("div"),j(t.$$.fragment),O(e,"slot","main")},m(i,o){k(i,e,o),q(t,e,null),n=!0},p(i,o){const s={};o&524332&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(C(t.$$.fragment,i),n=!0)},o(i){T(t.$$.fragment,i),n=!1},d(i){i&&S(e),U(t)}}}function gu(r){let e,t,n,i,o,s,a,l;e=new Zo({props:{$$slots:{main:[_u],sidebar:[hu],nav:[du]},$$scope:{ctx:r}}});function u(f){r[13](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new _o({props:p}),ie.push(()=>Oe(n,"open",u,r[0]));function m(f){r[14](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Go({props:c}),ie.push(()=>Oe(s,"open",m,r[1])),{c(){j(e.$$.fragment),t=A(),j(n.$$.fragment),o=A(),j(s.$$.fragment)},m(f,h){q(e,f,h),k(f,t,h),q(n,f,h),k(f,o,h),q(s,f,h),l=!0},p(f,[h]){const g={};h&524348&&(g.$$scope={dirty:h,ctx:f}),e.$set(g);const _={};!i&&h&1&&(i=!0,_.open=f[0],$e(()=>i=!1)),n.$set(_);const y={};!a&&h&2&&(a=!0,y.open=f[1],$e(()=>a=!1)),s.$set(y)},i(f){l||(C(e.$$.fragment,f),C(n.$$.fragment,f),C(s.$$.fragment,f),l=!0)},o(f){T(e.$$.fragment,f),T(n.$$.fragment,f),T(s.$$.fragment,f),l=!1},d(f){U(e,f),f&&S(t),U(n,f),f&&S(o),U(s,f)}}}function bu(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${a}.bin`,m=`https://atip.uk/route-info/${a}.bin`;o||(p=`https://atip.uk/route-snappers-dev/${a}.bin`,m=`https://atip.uk/route-info-dev/${a}.bin`);let c;function f(){t(0,n=!n),t(1,i=!1)}function h(){t(1,i=!i),t(0,n=!1)}let g;er(async()=>{t(5,g=await _());const $=mi(new Ao);t(4,c=await new $),await c.loadFile(m)});async function _(){const R=await(await fetch(go)).text(),L=JSON.parse(R);return L.features=L.features.filter(P=>{var F;return((F=P.properties)==null?void 0:F.name)==a}),L}function y(){let $=new URLSearchParams(window.location.search);$.set("schema",u);let R=`${window.location.pathname}?${$.toString()}${window.location.hash}`;window.location.href=R}const d=()=>window.open("index.html");function b(){u=fi(this),t(2,u)}function v($){n=$,t(0,n)}function M($){i=$,t(1,i)}return[n,i,u,p,c,g,a,l,f,h,y,d,b,v,M]}class yu extends Q{constructor(e){super(),ee(this,e,bu,gu,Z,{})}}new yu({target:document.getElementById("app")});
