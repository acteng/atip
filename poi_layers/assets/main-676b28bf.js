import{S as ie,i as ue,s as fe,a as pe,F as de,b as z,c as te,d as ce,e as A,f as _,g as I,h as S,j as F,k as f,m as M,t as w,l as k,n as me,o as ne,p as T,q as j,r as he,u as H,E as ge,v as ae,w as $e,x as _e,y as be,z as ve,A as we,B as ye}from"./stores-15f891d8.js";import{a as ke,D as Ae,R as Se,A as Ee}from"./About-096b9678.js";async function Be(){const t=await(await fetch(ke)).text();return JSON.parse(t)}function Fe(n){let t;return{c(){t=H("About")},m(e,o){F(e,t,o)},d(e){e&&T(t)}}}function oe(n){let t,e;return t=new ge({props:{errorMessage:n[2]}}),{c(){I(t.$$.fragment)},m(o,r){M(t,o,r),e=!0},p(o,r){const d={};r&4&&(d.errorMessage=o[2]),t.$set(d)},i(o){e||(w(t.$$.fragment,o),e=!0)},o(o){k(t.$$.fragment,o),e=!1},d(o){j(t,o)}}}function Te(n){let t,e,o,r,d;return{c(){t=A("input"),e=_(),o=A("datalist"),S(t,"class","govuk-input govuk-input--width-20"),S(t,"id","inputValue"),S(t,"data-testid","transport-authority"),S(t,"list","authorities-list"),S(o,"id","authorities-list")},m(m,c){F(m,t,c),ae(t,n[0]),F(m,e,c),F(m,o,c),n[12](o),r||(d=$e(t,"input",n[11]),r=!0)},p(m,c){c&1&&t.value!==m[0]&&ae(t,m[0])},d(m){m&&(T(t),T(e),T(o)),n[12](null),r=!1,d()}}}function Ie(n){let t;return{c(){t=H("Start")},m(e,o){F(e,t,o)},d(e){e&&T(t)}}}function se(n){let t,e;return{c(){t=A("i"),e=H(n[5])},m(o,r){F(o,t,r),f(t,e)},p(o,r){r&32&&_e(e,o[5])},d(o){o&&T(t)}}}function Me(n){let t,e,o,r,d,m,c,b,L,g,E,O,N,v,C,P,D,R,q,G,l,s,$,y,u,B,U;d=new pe({props:{$$slots:{default:[Fe]},$$scope:{ctx:n}}}),d.$on("click",n[10]);let i=n[2]&&oe(n);b=new de({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[Te]},$$scope:{ctx:n}}}),g=new Ae({props:{disabled:!n[6],$$slots:{default:[Ie]},$$scope:{ctx:n}}}),g.$on("click",n[9]);function re(a){n[13](a)}let Z={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]],inlineSmall:!0};n[4]!==void 0&&(Z.value=n[4]),v=new Se({props:Z}),z.push(()=>te(v,"value",re)),v.$on("change",n[7]);let h=n[5]&&se(n),K=je;l=new ce({props:{label:"Or upload an ATIP GeoJSON file",loadFile:n[8],id:"load-geojson"}});function le(a){n[14](a)}let Q={};return n[1]!==void 0&&(Q.open=n[1]),u=new Ee({props:Q}),z.push(()=>te(u,"open",le)),{c(){t=A("div"),e=A("div"),o=A("h1"),o.textContent="Welcome to ATIP v2",r=_(),I(d.$$.fragment),m=_(),i&&i.c(),c=_(),I(b.$$.fragment),L=_(),I(g.$$.fragment),E=_(),O=A("hr"),N=_(),I(v.$$.fragment),P=_(),h&&h.c(),D=_(),R=A("hr"),q=_(),G=_(),I(l.$$.fragment),s=_(),$=A("div"),$.innerHTML='<div id="map" class="svelte-lyn11h"></div>',y=_(),I(u.$$.fragment),S(o,"class","govuk-heading-l"),S(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),S($,"class","govuk-grid-column-one-half"),S(t,"class","govuk-grid-row")},m(a,p){F(a,t,p),f(t,e),f(e,o),f(e,r),M(d,e,null),f(e,m),i&&i.m(e,null),f(e,c),M(b,e,null),f(e,L),M(g,e,null),f(e,E),f(e,O),f(e,N),M(v,e,null),f(e,P),h&&h.m(e,null),f(e,D),f(e,R),f(e,q),f(e,G),M(l,e,null),f(t,s),f(t,$),F(a,y,p),M(u,a,p),U=!0},p(a,[p]){const X={};p&262144&&(X.$$scope={dirty:p,ctx:a}),d.$set(X),a[2]?i?(i.p(a,p),p&4&&w(i,1)):(i=oe(a),i.c(),w(i,1),i.m(e,c)):i&&(be(),k(i,1,1,()=>{i=null}),me());const Y={};p&262153&&(Y.$$scope={dirty:p,ctx:a}),b.$set(Y);const W={};p&64&&(W.disabled=!a[6]),p&262144&&(W.$$scope={dirty:p,ctx:a}),g.$set(W);const x={};!C&&p&16&&(C=!0,x.value=a[4],ne(()=>C=!1)),v.$set(x),a[5]?h?h.p(a,p):(h=se(a),h.c(),h.m(e,D)):h&&(h.d(1),h=null);const ee={};!B&&p&2&&(B=!0,ee.open=a[1],ne(()=>B=!1)),u.$set(ee)},i(a){U||(w(d.$$.fragment,a),w(i),w(b.$$.fragment,a),w(g.$$.fragment,a),w(v.$$.fragment,a),w(K),w(l.$$.fragment,a),w(u.$$.fragment,a),U=!0)},o(a){k(d.$$.fragment,a),k(i),k(b.$$.fragment,a),k(g.$$.fragment,a),k(v.$$.fragment,a),k(K),k(l.$$.fragment,a),k(u.$$.fragment,a),U=!1},d(a){a&&(T(t),T(y)),j(d),i&&i.d(),j(b),j(g),j(v),h&&h.d(),j(l),j(u,a)}}}let je="",V="boundary",J="boundary-layer";function Le(n){if(n.features.length>0){let t=n.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function Ne(n,t,e){let o,r=!1,m=new URLSearchParams(window.location.search).get("error")||"",c,b,L=new Set,g=null,E="TA";function O(){g==null||g.setFilter(J,["==",["get","level"],E])}let N=null;he(async()=>{ve();const l=await Be();for(let u of l.features){let B=document.createElement("option");B.value=u.properties.name,b.appendChild(B),L.add(u.properties.name)}let s=new we.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});g=s;let $=null;function y(){$!==null&&s.setFeatureState({source:V,id:$},{hover:!1})}s.on("load",function(){s.fitBounds(ye(l),{padding:20,animate:!1}),s.addSource(V,{type:"geojson",data:l,generateId:!0}),s.addLayer({id:J,source:V,filter:["==",["get","level"],E],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),s.on("mousemove",J,u=>{u.features.length>0&&(y(),$=u.features[0].id,e(5,N=u.features[0].properties.name),s.setFeatureState({source:V,id:$},{hover:!0}))}),s.on("mouseleave",J,()=>{y(),$=null,e(5,N=null)}),s.on("click",J,function(u){let B=u.features[0].properties.name;window.location.href=`scheme.html?authority=${B}`})})});function v(l){try{let s=JSON.parse(l);if(!s.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!L.has(s.authority))throw new Error(`Unknown authority ${s.authority}`);let $=s.authority,y=Le(s);y!="v1"&&($+=`_${y}`),window.localStorage.setItem($,JSON.stringify(s)),window.location.href=`scheme.html?authority=${s.authority}&schema=${y}`}catch(s){e(2,m=`Couldn't load scheme from a file: ${s}`)}}function C(){window.location.href=`scheme.html?authority=${c}`}const P=()=>e(1,r=!r);function D(){c=this.value,e(0,c)}function R(l){z[l?"unshift":"push"](()=>{b=l,e(3,b)})}function q(l){E=l,e(4,E)}function G(l){r=l,e(1,r)}return n.$$.update=()=>{n.$$.dirty&1&&e(6,o=L.has(c))},[c,r,m,b,E,N,o,O,v,C,P,D,R,q,G]}class Ce extends ie{constructor(t){super(),ue(this,t,Ne,Me,fe,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Ce({target:document.getElementById("app")});
