import{S as oe,i as ie,s as ae,g as B,f as O,e as K,u as k,m as C,j as M,k as U,x as R,t as b,l as S,p as E,q as z,W as ee,$ as Y,r as De,b as we,c as be,F as yt,o as Se,a as me,h as x,v as Ie,w as wt,X as Le,B as Qe,I as Xe,aV as bt,_ as St,aW as Ve,ad as Ye,d as Tt,P as je,R as Ze,y as ue,n as he,Q as Ut,z as Dt,a6 as Lt,aN as Mt,E as Et,aa as Bt}from"./stores-15f891d8.js";import{C as et,S as He,M as tt,L as Ct,Z as zt,b as kt,I as At,B as Ot,d as Pt}from"./ZoomOutMap-f35cbf6d.js";function It(t){let e=new Map;for(let[r,n]of Object.entries(t.schemes))e.set(r,{scheme_reference:r,num_features:0,authority_or_region:n.authority_or_region,capital_scheme_id:n.capital_scheme_id,funding_programme:n.funding_programme});for(let r of t.features)e.get(r.properties.scheme_reference).num_features++,delete r.properties.id,delete r.properties.authority_or_region,delete r.properties.capital_scheme_id,delete r.properties.funding_programme,delete r.properties.valid,delete r.properties.centroid_lon,delete r.properties.centroid_lat;return e}function Vt(t){let e;return{c(){e=k("Clear")},m(r,n){M(r,e,n)},d(r){r&&E(e)}}}function jt(t){let e,r,n,s,o,i;return n=new me({props:{$$slots:{default:[Vt]},$$scope:{ctx:t}}}),n.$on("click",t[11]),{c(){e=K("input"),r=O(),B(n.$$.fragment),x(e,"type","text"),x(e,"class","govuk-input govuk-input--width-10"),x(e,"id","filterText")},m(a,f){M(a,e,f),Ie(e,t[1]),M(a,r,f),C(n,a,f),s=!0,o||(i=wt(e,"input",t[10]),o=!0)},p(a,f){f&2&&e.value!==a[1]&&Ie(e,a[1]);const u={};f&16384&&(u.$$scope={dirty:f,ctx:a}),n.$set(u)},i(a){s||(b(n.$$.fragment,a),s=!0)},o(a){S(n.$$.fragment,a),s=!1},d(a){a&&(E(e),E(r)),z(n,a),o=!1,i()}}}function Zt(t){let e,r,n,s,o,i,a,f;function u(m){t[8](m)}let c={label:"Authority or region",id:"filterAuthority",choices:t[4],emptyOption:!0};t[2]!==void 0&&(c.value=t[2]),e=new He({props:c}),we.push(()=>be(e,"value",u));function l(m){t[9](m)}let v={label:"Funding programme",id:"filterFundingProgramme",choices:t[5],emptyOption:!0};return t[3]!==void 0&&(v.value=t[3]),s=new He({props:v}),we.push(()=>be(s,"value",l)),a=new yt({props:{label:"Any field",id:"filterText",$$slots:{default:[jt]},$$scope:{ctx:t}}}),{c(){B(e.$$.fragment),n=O(),B(s.$$.fragment),i=O(),B(a.$$.fragment)},m(m,p){C(e,m,p),M(m,n,p),C(s,m,p),M(m,i,p),C(a,m,p),f=!0},p(m,p){const d={};p&16&&(d.choices=m[4]),!r&&p&4&&(r=!0,d.value=m[2],Se(()=>r=!1)),e.$set(d);const w={};p&32&&(w.choices=m[5]),!o&&p&8&&(o=!0,w.value=m[3],Se(()=>o=!1)),s.$set(w);const y={};p&16386&&(y.$$scope={dirty:p,ctx:m}),a.$set(y)},i(m){f||(b(e.$$.fragment,m),b(s.$$.fragment,m),b(a.$$.fragment,m),f=!0)},o(m){S(e.$$.fragment,m),S(s.$$.fragment,m),S(a.$$.fragment,m),f=!1},d(m){m&&(E(n),E(i)),z(e,m),z(s,m),z(a,m)}}}function Ht(t){let e,r,n,s,o=t[0].size+"",i,a,f=t[6].route+"",u,c,l=t[6].area+"",v,m,p=t[6].crossing+"",d,w,y=t[6].other+"",_,D,g;return e=new et({props:{label:"Filters",$$slots:{default:[Zt]},$$scope:{ctx:t}}}),{c(){B(e.$$.fragment),r=O(),n=K("p"),s=k("Showing "),i=k(o),a=k(" schemes ("),u=k(f),c=k(" routes, "),v=k(l),m=k(` areas,
  `),d=k(p),w=k(" crossings, "),_=k(y),D=k(" other)")},m(h,$){C(e,h,$),M(h,r,$),M(h,n,$),U(n,s),U(n,i),U(n,a),U(n,u),U(n,c),U(n,v),U(n,m),U(n,d),U(n,w),U(n,_),U(n,D),g=!0},p(h,[$]){const A={};$&16446&&(A.$$scope={dirty:$,ctx:h}),e.$set(A),(!g||$&1)&&o!==(o=h[0].size+"")&&R(i,o),(!g||$&64)&&f!==(f=h[6].route+"")&&R(u,f),(!g||$&64)&&l!==(l=h[6].area+"")&&R(v,l),(!g||$&64)&&p!==(p=h[6].crossing+"")&&R(d,p),(!g||$&64)&&y!==(y=h[6].other+"")&&R(_,y)},i(h){g||(b(e.$$.fragment,h),g=!0)},o(h){S(e.$$.fragment,h),g=!1},d(h){h&&(E(r),E(n)),z(e,h)}}}function Ft(t,e,r){let n;ee(t,Y,y=>r(12,n=y));let{schemes:s}=e,{schemesToBeShown:o=new Set}=e,i="",a=[],f="",u=[],c="",l={area:0,route:0,crossing:0,other:0};De(()=>{let y=new Set,_=new Set;for(let D of s.values())D.authority_or_region&&y.add(D.authority_or_region),D.funding_programme&&_.add(D.funding_programme);r(4,a=Array.from(y.entries())),a.sort(),r(5,u=Array.from(_.entries())),u.sort()});function v(y,_,D){let g=y.toLowerCase(),h=$=>{if(g&&!JSON.stringify($.properties).toLowerCase().includes(g))return!1;if(_||D){let A=s.get($.properties.scheme_reference);if(_&&A.authority_or_region!=_||D&&A.funding_programme!=D)return!1}return!0};r(0,o=new Set(n.features.filter(h).map($=>$.properties.scheme_reference))),r(6,l={area:0,route:0,crossing:0,other:0}),Y.update($=>{for(let A of $.features)o.has(A.properties.scheme_reference)?(delete A.properties.hide_while_editing,r(6,l[A.properties.intervention_type]++,l)):A.properties.hide_while_editing=!0;return $}),r(6,l)}function m(y){f=y,r(2,f)}function p(y){c=y,r(3,c)}function d(){i=this.value,r(1,i)}const w=()=>r(1,i="");return t.$$set=y=>{"schemes"in y&&r(7,s=y.schemes),"schemesToBeShown"in y&&r(0,o=y.schemesToBeShown)},t.$$.update=()=>{t.$$.dirty&14&&v(i,f,c)},[o,i,f,c,a,u,l,s,m,p,d,w]}class Kt extends oe{constructor(e){super(),ie(this,e,Ft,Ht,ae,{schemes:7,schemesToBeShown:0})}}function Nt(t){let e;return{c(){e=k("Show on map")},m(r,n){M(r,e,n)},d(r){r&&E(e)}}}function Rt(t){let e;return{c(){e=k("Edit scheme")},m(r,n){M(r,e,n)},d(r){r&&E(e)}}}function xt(t){let e,r,n=t[0].authority_or_region+"",s,o,i,a,f=t[0].capital_scheme_id+"",u,c,l,v,m=t[0].funding_programme+"",p,d,w,y,_,D,g;return y=new me({props:{$$slots:{default:[Nt]},$$scope:{ctx:t}}}),y.$on("click",t[1]),D=new me({props:{$$slots:{default:[Rt]},$$scope:{ctx:t}}}),D.$on("click",t[2]),{c(){e=K("p"),r=k("Authority or region: "),s=k(n),o=O(),i=K("p"),a=k("Capital scheme ID: "),u=k(f),c=O(),l=K("p"),v=k("Funding programme: "),p=k(m),d=O(),w=K("div"),B(y.$$.fragment),_=O(),B(D.$$.fragment),x(w,"class","govuk-button-group")},m(h,$){M(h,e,$),U(e,r),U(e,s),M(h,o,$),M(h,i,$),U(i,a),U(i,u),M(h,c,$),M(h,l,$),U(l,v),U(l,p),M(h,d,$),M(h,w,$),C(y,w,null),U(w,_),C(D,w,null),g=!0},p(h,$){(!g||$&1)&&n!==(n=h[0].authority_or_region+"")&&R(s,n),(!g||$&1)&&f!==(f=h[0].capital_scheme_id+"")&&R(u,f),(!g||$&1)&&m!==(m=h[0].funding_programme+"")&&R(p,m);const A={};$&32&&(A.$$scope={dirty:$,ctx:h}),y.$set(A);const L={};$&32&&(L.$$scope={dirty:$,ctx:h}),D.$set(L)},i(h){g||(b(y.$$.fragment,h),b(D.$$.fragment,h),g=!0)},o(h){S(y.$$.fragment,h),S(D.$$.fragment,h),g=!1},d(h){h&&(E(e),E(o),E(i),E(c),E(l),E(d),E(w)),z(y),z(D)}}}function qt(t){let e,r;return e=new et({props:{label:`${t[0].scheme_reference}: ${t[0].num_features} features`,$$slots:{default:[xt]},$$scope:{ctx:t}}}),{c(){B(e.$$.fragment)},m(n,s){C(e,n,s),r=!0},p(n,[s]){const o={};s&1&&(o.label=`${n[0].scheme_reference}: ${n[0].num_features} features`),s&33&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){z(e,n)}}}function Jt(t,e,r){let n,s;ee(t,Y,f=>r(3,n=f)),ee(t,Le,f=>r(4,s=f));let{scheme:o}=e;function i(){let f={type:"FeatureCollection",features:n.features.filter(u=>u.properties.scheme_reference==o.scheme_reference)};s==null||s.fitBounds(Qe(f),{padding:20,animate:!1})}function a(){let f={type:"FeatureCollection",features:n.features.filter(c=>c.properties.scheme_reference==o.scheme_reference)},u=o.authority_or_region;window.localStorage.setItem(u,JSON.stringify(f)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return t.$$set=f=>{"scheme"in f&&r(0,o=f.scheme)},[o,i,a]}class Gt extends oe{constructor(e){super(),ie(this,e,Jt,qt,ae,{scheme:0})}}function Wt(t){let e,r;return e=new tt({props:{layers:["schools"],contents:Qt}}),{c(){B(e.$$.fragment)},m(n,s){C(e,n,s),r=!0},p:Xe,i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){z(e,n)}}}let ce="schools";function Qt(t){return t.name??"Unnamed school"}function Xt(t,e,r){let n;return ee(t,Le,s=>r(0,n=s)),bt(n,ce,"https://atip.uk/layers/v1/schools.pmtiles"),St(n,{id:ce,source:ce,sourceLayer:ce,color:"red",opacity:.8}),[]}class Yt extends oe{constructor(e){super(),ie(this,e,Xt,Wt,ae,{})}}var P=(t,e,r)=>new Promise((n,s)=>{var o=f=>{try{a(r.next(f))}catch(u){s(u)}},i=f=>{try{a(r.throw(f))}catch(u){s(u)}},a=f=>f.done?n(f.value):Promise.resolve(f.value).then(o,i);a((r=r.apply(t,e)).next())}),V=Uint8Array,Q=Uint16Array,er=Int32Array,rt=new V([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),nt=new V([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),tr=new V([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),st=function(t,e){for(var r=new Q(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new er(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)s[o]=o-r[n]<<5|n;return{b:r,r:s}},ot=st(rt,2),it=ot.b,rr=ot.r;it[28]=258,rr[258]=28;var nr=st(nt,0),sr=nr.b,Te=new Q(32768);for(T=0;T<32768;++T)N=(T&43690)>>1|(T&21845)<<1,N=(N&52428)>>2|(N&13107)<<2,N=(N&61680)>>4|(N&3855)<<4,Te[T]=((N&65280)>>8|(N&255)<<8)>>1;var N,T,se=function(t,e,r){for(var n=t.length,s=0,o=new Q(e);s<n;++s)t[s]&&++o[t[s]-1];var i=new Q(e);for(s=1;s<e;++s)i[s]=i[s-1]+o[s-1]<<1;var a;if(r){a=new Q(1<<e);var f=15-e;for(s=0;s<n;++s)if(t[s])for(var u=s<<4|t[s],c=e-t[s],l=i[t[s]-1]++<<c,v=l|(1<<c)-1;l<=v;++l)a[Te[l]>>f]=u}else for(a=new Q(n),s=0;s<n;++s)t[s]&&(a[s]=Te[i[t[s]-1]++]>>15-t[s]);return a},le=new V(288);for(T=0;T<144;++T)le[T]=8;var T;for(T=144;T<256;++T)le[T]=9;var T;for(T=256;T<280;++T)le[T]=7;var T;for(T=280;T<288;++T)le[T]=8;var T,at=new V(32);for(T=0;T<32;++T)at[T]=5;var T,or=se(le,9,1),ir=se(at,5,1),$e=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},H=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},ye=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},ar=function(t){return(t+7)/8|0},lr=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var n=new V(r-e);return n.set(t.subarray(e,r)),n},fr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],I=function(t,e,r){var n=new Error(e||fr[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,I),!r)throw n;return n},Me=function(t,e,r,n){var s=t.length,o=n?n.length:0;if(!s||e.f&&!e.l)return r||new V(0);var i=!r||e.i!=2,a=e.i;r||(r=new V(s*3));var f=function(Ae){var Oe=r.length;if(Ae>Oe){var Pe=new V(Math.max(Oe*2,Ae));Pe.set(r),r=Pe}},u=e.f||0,c=e.p||0,l=e.b||0,v=e.l,m=e.d,p=e.m,d=e.n,w=s*8;do{if(!v){u=H(t,c,1);var y=H(t,c+1,3);if(c+=3,y)if(y==1)v=or,m=ir,p=9,d=5;else if(y==2){var h=H(t,c,31)+257,$=H(t,c+10,15)+4,A=h+H(t,c+5,31)+1;c+=14;for(var L=new V(A),q=new V(19),j=0;j<$;++j)q[tr[j]]=H(t,c+j*3,7);c+=$*3;for(var Ee=$e(q),pt=(1<<Ee)-1,dt=se(q,Ee,1),j=0;j<A;){var Be=dt[H(t,c,pt)];c+=Be&15;var _=Be>>4;if(_<16)L[j++]=_;else{var J=0,fe=0;for(_==16?(fe=3+H(t,c,3),c+=2,J=L[j-1]):_==17?(fe=3+H(t,c,7),c+=3):_==18&&(fe=11+H(t,c,127),c+=7);fe--;)L[j++]=J}}var Ce=L.subarray(0,h),Z=L.subarray(h);p=$e(Ce),d=$e(Z),v=se(Ce,p,1),m=se(Z,d,1)}else I(1);else{var _=ar(c)+4,D=t[_-4]|t[_-3]<<8,g=_+D;if(g>s){a&&I(0);break}i&&f(l+D),r.set(t.subarray(_,g),l),e.b=l+=D,e.p=c=g*8,e.f=u;continue}if(c>w){a&&I(0);break}}i&&f(l+131072);for(var _t=(1<<p)-1,vt=(1<<d)-1,pe=c;;pe=c){var J=v[ye(t,c)&_t],G=J>>4;if(c+=J&15,c>w){a&&I(0);break}if(J||I(2),G<256)r[l++]=G;else if(G==256){pe=c,v=null;break}else{var ze=G-254;if(G>264){var j=G-257,te=rt[j];ze=H(t,c,(1<<te)-1)+it[j],c+=te}var de=m[ye(t,c)&vt],_e=de>>4;de||I(3),c+=de&15;var Z=sr[_e];if(_e>3){var te=nt[_e];Z+=ye(t,c)&(1<<te)-1,c+=te}if(c>w){a&&I(0);break}i&&f(l+131072);var ve=l+ze;if(l<Z){var ke=o-Z,$t=Math.min(Z,ve);for(ke+l<0&&I(3);l<$t;++l)r[l]=n[ke+l]}for(;l<ve;l+=4)r[l]=r[l-Z],r[l+1]=r[l+1-Z],r[l+2]=r[l+2-Z],r[l+3]=r[l+3-Z];l=ve}}e.l=v,e.p=pe,e.b=l,e.f=u,v&&(u=1,e.m=p,e.d=m,e.n=d)}while(!u);return l==r.length?r:lr(r,0,l)},cr=new V(0),ur=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&I(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=(t[10]|t[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[r++]);return r+(e&2)},hr=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},mr=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&I(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&I(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function gr(t,e){return Me(t,{i:2},e&&e.out,e&&e.dictionary)}function pr(t,e){var r=ur(t);return r+8>t.length&&I(6,"invalid gzip data"),Me(t.subarray(r,-8),{i:2},e&&e.out||new V(hr(t)),e&&e.dictionary)}function dr(t,e){return Me(t.subarray(mr(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Ue(t,e){return t[0]==31&&t[1]==139&&t[2]==8?pr(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?gr(t,e):dr(t,e)}var _r=typeof TextDecoder<"u"&&new TextDecoder,vr=0;try{_r.decode(cr,{stream:!0}),vr=1}catch{}var lt=(t,e)=>t*Math.pow(2,e),re=(t,e)=>Math.floor(t/Math.pow(2,e)),ge=(t,e)=>lt(t.getUint16(e+1,!0),8)+t.getUint8(e),ft=(t,e)=>lt(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),$r=(t,e,r,n,s)=>{if(t!=n.getUint8(s))return t-n.getUint8(s);const o=ge(n,s+1);if(e!=o)return e-o;const i=ge(n,s+4);return r!=i?r-i:0},yr=(t,e,r,n)=>{const s=ct(t,e|128,r,n);return s?{z:e,x:r,y:n,offset:s[0],length:s[1],is_dir:!0}:null},Fe=(t,e,r,n)=>{const s=ct(t,e,r,n);return s?{z:e,x:r,y:n,offset:s[0],length:s[1],is_dir:!1}:null},ct=(t,e,r,n)=>{let s=0,o=t.byteLength/17-1;for(;s<=o;){const i=o+s>>1,a=$r(e,r,n,t,i*17);if(a>0)s=i+1;else if(a<0)o=i-1;else return[ft(t,i*17+7),t.getUint32(i*17+13,!0)]}return null},wr=(t,e)=>t.is_dir&&!e.is_dir?1:!t.is_dir&&e.is_dir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,ut=(t,e)=>{const r=t.getUint8(e*17);return{z:r&127,x:ge(t,e*17+1),y:ge(t,e*17+4),offset:ft(t,e*17+7),length:t.getUint32(e*17+13,!0),is_dir:r>>7===1}},Ke=t=>{const e=[],r=new DataView(t);for(let n=0;n<r.byteLength/17;n++)e.push(ut(r,n));return br(e)},br=t=>{t.sort(wr);const e=new ArrayBuffer(17*t.length),r=new Uint8Array(e);for(let n=0;n<t.length;n++){const s=t[n];let o=s.z;s.is_dir&&(o=o|128),r[n*17]=o,r[n*17+1]=s.x&255,r[n*17+2]=s.x>>8&255,r[n*17+3]=s.x>>16&255,r[n*17+4]=s.y&255,r[n*17+5]=s.y>>8&255,r[n*17+6]=s.y>>16&255,r[n*17+7]=s.offset&255,r[n*17+8]=re(s.offset,8)&255,r[n*17+9]=re(s.offset,16)&255,r[n*17+10]=re(s.offset,24)&255,r[n*17+11]=re(s.offset,32)&255,r[n*17+12]=re(s.offset,48)&255,r[n*17+13]=s.length&255,r[n*17+14]=s.length>>8&255,r[n*17+15]=s.length>>16&255,r[n*17+16]=s.length>>24&255}return e},Sr=(t,e)=>{if(t.byteLength<17)return null;const r=t.byteLength/17,n=ut(t,r-1);if(n.is_dir){const s=n.z,o=e.z-s,i=Math.trunc(e.x/(1<<o)),a=Math.trunc(e.y/(1<<o));return{z:s,x:i,y:a}}return null};function Tr(t){return P(this,null,function*(){const e=yield t.getBytes(0,512e3),r=new DataView(e.data),n=r.getUint32(4,!0),s=r.getUint16(8,!0),o=new TextDecoder("utf-8"),i=JSON.parse(o.decode(new DataView(e.data,10,n)));let a=0;i.compression==="gzip"&&(a=2);let f=0;"minzoom"in i&&(f=+i.minzoom);let u=0;"maxzoom"in i&&(u=+i.maxzoom);let c=0,l=0,v=0,m=-180,p=-85,d=180,w=85;if(i.bounds){const _=i.bounds.split(",");m=+_[0],p=+_[1],d=+_[2],w=+_[3]}if(i.center){const _=i.center.split(",");c=+_[0],l=+_[1],v=+_[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:f,maxZoom:u,minLon:m,minLat:p,maxLon:d,maxLat:w,centerZoom:v,centerLon:c,centerLat:l,etag:e.etag}})}function Ur(t,e,r,n,s,o,i){return P(this,null,function*(){let a=yield r.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(a=Ke(a));const f=Fe(new DataView(a),n,s,o);if(f){let l=(yield e.getBytes(f.offset,f.length,i)).data;const v=new DataView(l);return v.getUint8(0)==31&&v.getUint8(1)==139&&(l=Ue(new Uint8Array(l))),{data:l}}const u=Sr(new DataView(a),{z:n,x:s,y:o});if(u){const c=yr(new DataView(a),u.z,u.x,u.y);if(c){let l=yield r.getArrayBuffer(e,c.offset,c.length,t);t.specVersion===1&&(l=Ke(l));const v=Fe(new DataView(l),n,s,o);if(v){let p=(yield e.getBytes(v.offset,v.length,i)).data;const d=new DataView(p);return d.getUint8(0)==31&&d.getUint8(1)==139&&(p=Ue(new Uint8Array(p))),{data:p}}}}})}var ht={getHeader:Tr,getZxy:Ur},Dr=class{constructor(){this.tile=(t,e)=>{if(t.type=="json"){const r=t.url.substr(10);let n=this.tiles.get(r);return n||(n=new Ne(r),this.tiles.set(r,n)),n.getHeader().then(s=>{const o={tiles:[t.url+"/{z}/{x}/{y}"],minzoom:s.minZoom,maxzoom:s.maxZoom,bounds:[s.minLon,s.minLat,s.maxLon,s.maxLat]};e(null,o,null,null)}).catch(s=>{e(s,null,null,null)}),{cancel:()=>{}}}else{const r=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=t.url.match(r);if(!n)throw new Error("Invalid PMTiles protocol URL");const s=n[1];let o=this.tiles.get(s);o||(o=new Ne(s),this.tiles.set(s,o));const i=n[2],a=n[3],f=n[4],u=new AbortController,c=u.signal;let l=()=>{u.abort()};return o.getHeader().then(v=>{o.getZxy(+i,+a,+f,c).then(m=>{m?e(null,new Uint8Array(m.data),m.cacheControl,m.expires):v.tileType==1?e(null,new Uint8Array,null,null):e(null,null,null,null)}).catch(m=>{m.name!=="AbortError"&&e(m,null,null,null)})}),{cancel:l}}},this.tiles=new Map}add(t){this.tiles.set(t.source.getKey(),t)}get(t){return this.tiles.get(t)}};function W(t,e){return(e>>>0)*4294967296+(t>>>0)}function Lr(t,e){const r=e.buf;let n,s;if(s=r[e.pos++],n=(s&112)>>4,s<128||(s=r[e.pos++],n|=(s&127)<<3,s<128)||(s=r[e.pos++],n|=(s&127)<<10,s<128)||(s=r[e.pos++],n|=(s&127)<<17,s<128)||(s=r[e.pos++],n|=(s&127)<<24,s<128)||(s=r[e.pos++],n|=(s&1)<<31,s<128))return W(t,n);throw new Error("Expected varint not more than 10 bytes")}function ne(t){const e=t.buf;let r,n;return n=e[t.pos++],r=n&127,n<128||(n=e[t.pos++],r|=(n&127)<<7,n<128)||(n=e[t.pos++],r|=(n&127)<<14,n<128)||(n=e[t.pos++],r|=(n&127)<<21,n<128)?r:(n=e[t.pos],r|=(n&15)<<28,Lr(r,t))}function Mr(t,e,r,n){if(n==0){r==1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}var Er=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Br(t,e,r){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,t)-1||r>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");const n=Er[t],s=Math.pow(2,t);let o=0,i=0,a=0;const f=[e,r];let u=s/2;for(;u>0;)o=(f[0]&u)>0?1:0,i=(f[1]&u)>0?1:0,a+=u*u*(3*o^i),Mr(u,f,o,i),u=u/2;return n+a}function mt(t,e){return P(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Ue(new Uint8Array(t));{let n=new Response(t).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}}else throw Error("Compression method not supported")})}var Cr=127;function zr(t,e){let r=0,n=t.length-1;for(;r<=n;){const s=n+r>>1,o=e-t[s].tileId;if(o>0)r=s+1;else if(o<0)n=s-1;else return t[s]}return n>=0&&(t[n].runLength===0||e-t[n].tileId<t[n].runLength)?t[n]:null}var kr=class{constructor(t){this.url=t}getKey(){return this.url}getBytes(t,e,r){return P(this,null,function*(){let n;r||(n=new AbortController,r=n.signal);let s=yield fetch(this.url,{signal:r,headers:{Range:"bytes="+t+"-"+(t+e-1)}});if(s.status===416&&t===0){const a=s.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const f=+a.substr(8);s=yield fetch(this.url,{signal:r,headers:{Range:"bytes=0-"+(f-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function F(t,e){const r=t.getUint32(e+4,!0),n=t.getUint32(e+0,!0);return r*Math.pow(2,32)+n}function Ar(t,e){const r=new DataView(t),n=r.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:F(r,8),rootDirectoryLength:F(r,16),jsonMetadataOffset:F(r,24),jsonMetadataLength:F(r,32),leafDirectoryOffset:F(r,40),leafDirectoryLength:F(r,48),tileDataOffset:F(r,56),tileDataLength:F(r,64),numAddressedTiles:F(r,72),numTileEntries:F(r,80),numTileContents:F(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:e}}function gt(t){const e={buf:new Uint8Array(t),pos:0},r=ne(e),n=[];let s=0;for(let o=0;o<r;o++){const i=ne(e);n.push({tileId:s+i,offset:0,length:0,runLength:1}),s+=i}for(let o=0;o<r;o++)n[o].runLength=ne(e);for(let o=0;o<r;o++)n[o].length=ne(e);for(let o=0;o<r;o++){const i=ne(e);i===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=i-1}return n}function Or(t){const e=new DataView(t);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var X=class extends Error{};function Pr(t,e,r,n){return P(this,null,function*(){const s=yield t.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Or(s.data)<3)return[yield ht.getHeader(t)];const i=s.data.slice(0,Cr);let a=s.etag;n&&s.etag!=n&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),a=void 0);const f=Ar(i,a);if(r){const u=s.data.slice(f.rootDirectoryOffset,f.rootDirectoryOffset+f.rootDirectoryLength),c=t.getKey()+"|"+(f.etag||"")+"|"+f.rootDirectoryOffset+"|"+f.rootDirectoryLength,l=gt(yield e(u,f.internalCompression));return[f,[c,l.length,l]]}return[f,void 0]})}function Ir(t,e,r,n,s){return P(this,null,function*(){const o=yield t.getBytes(r,n);if(s.etag&&s.etag!==o.etag)throw new X(o.etag);const i=yield e(o.data,s.internalCompression),a=gt(i);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var Vr=class{constructor(t=100,e=!0,r=mt){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.prefetch=e,this.decompress=r}getHeader(t,e){return P(this,null,function*(){const r=t.getKey();if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const n=new Promise((s,o)=>{Pr(t,this.decompress,this.prefetch,e).then(i=>{i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:Promise.resolve(i[1][2])}),s(i[0]),this.prune()}).catch(i=>{o(i)})});return this.cache.set(r,{lastUsed:this.counter++,data:n}),n})}getDirectory(t,e,r,n){return P(this,null,function*(){const s=t.getKey()+"|"+(n.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((i,a)=>{Ir(t,this.decompress,e,r,n).then(f=>{i(f),this.prune()}).catch(f=>{a(f)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}getArrayBuffer(t,e,r,n){return P(this,null,function*(){const s=t.getKey()+"|"+(n.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((i,a)=>{t.getBytes(e,r).then(f=>{if(n.etag&&n.etag!==f.etag)throw new X(f.etag);i(f.data),this.cache.has(s),this.prune()}).catch(f=>{a(f)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((r,n)=>{r.lastUsed<t&&(t=r.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(t,e){return P(this,null,function*(){this.cache.delete(t.getKey()),yield this.getHeader(t,e)})}},Ne=class{constructor(t,e,r){typeof t=="string"?this.source=new kr(t):this.source=t,r?this.decompress=r:this.decompress=mt,e?this.cache=e:this.cache=new Vr}getHeader(){return P(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,r,n){return P(this,null,function*(){const s=Br(t,e,r),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return ht.getZxy(o,this.source,this.cache,t,e,r,n);if(t<o.minZoom||t>o.maxZoom)return;let i=o.rootDirectoryOffset,a=o.rootDirectoryLength;for(let f=0;f<=3;f++){const u=yield this.cache.getDirectory(this.source,i,a,o),c=zr(u,s);if(c)if(c.runLength>0){const l=yield this.source.getBytes(o.tileDataOffset+c.offset,c.length,n);if(o.etag&&o.etag!==l.etag)throw new X(l.etag);return{data:yield this.decompress(l.data,o.tileCompression),cacheControl:l.cacheControl,expires:l.expires}}else i=o.leafDirectoryOffset+c.offset,a=c.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,r,n){return P(this,null,function*(){try{return yield this.getZxyAttempt(t,e,r,n)}catch(s){if(s instanceof X)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(t,e,r,n);throw s}})}getMetadataAttempt(){return P(this,null,function*(){const t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength);if(t.etag&&t.etag!==e.etag)throw new X(e.etag);const r=yield this.decompress(e.data,t.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(r))})}getMetadata(){return P(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof X)return this.cache.invalidate(this.source,t.message),yield this.getMetadataAttempt();throw t}})}};function jr(t){return De(()=>{let e=new Dr;Ve.addProtocol("pmtiles",e.tile)}),Ye(()=>{Ve.removeProtocol("pmtiles")}),[]}class Zr extends oe{constructor(e){super(),ie(this,e,jr,null,ae,{})}}function Re(t,e,r){const n=t.slice();return n[11]=e[r],n}function Hr(t){let e;return{c(){e=k("Home")},m(r,n){M(r,e,n)},d(r){r&&E(e)}}}function xe(t){let e,r;return e=new Et({props:{errorMessage:t[0]}}),{c(){B(e.$$.fragment)},m(n,s){C(e,n,s),r=!0},p(n,s){const o={};s&1&&(o.errorMessage=n[0]),e.$set(o)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){z(e,n)}}}function qe(t){let e,r,n;function s(i){t[8](i)}let o={schemes:t[1]};return t[2]!==void 0&&(o.schemesToBeShown=t[2]),e=new Kt({props:o}),we.push(()=>be(e,"schemesToBeShown",s)),{c(){B(e.$$.fragment)},m(i,a){C(e,i,a),n=!0},p(i,a){const f={};a&2&&(f.schemes=i[1]),!r&&a&4&&(r=!0,f.schemesToBeShown=i[2],Se(()=>r=!1)),e.$set(f)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){z(e,i)}}}function Je(t){let e,r;return e=new Gt({props:{scheme:t[11]}}),{c(){B(e.$$.fragment)},m(n,s){C(e,n,s),r=!0},p(n,s){const o={};s&2&&(o.scheme=n[11]),e.$set(o)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){z(e,n)}}}function Ge(t){let e=t[2].has(t[11].scheme_reference),r,n,s=e&&Je(t);return{c(){s&&s.c(),r=Bt()},m(o,i){s&&s.m(o,i),M(o,r,i),n=!0},p(o,i){i&6&&(e=o[2].has(o[11].scheme_reference)),e?s?(s.p(o,i),i&6&&b(s,1)):(s=Je(o),s.c(),b(s,1),s.m(r.parentNode,r)):s&&(ue(),S(s,1,1,()=>{s=null}),he())},i(o){n||(b(s),n=!0)},o(o){S(s),n=!1},d(o){o&&E(r),s&&s.d(o)}}}function Fr(t){let e,r,n,s,o,i,a,f,u,c,l,v,m,p;r=new me({props:{$$slots:{default:[Hr]},$$scope:{ctx:t}}}),r.$on("click",t[7]),a=new zt({props:{boundaryGeojson:t[3]}});let d=t[0]&&xe(t);c=new Tt({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:t[5]}});let w=t[1].size>0&&qe(t),y=je(t[1].values()),_=[];for(let g=0;g<y.length;g+=1)_[g]=Ge(Re(t,y,g));const D=g=>S(_[g],1,1,()=>{_[g]=null});return{c(){e=K("div"),B(r.$$.fragment),n=O(),s=K("div"),o=K("h1"),o.textContent="Browse schemes",i=O(),B(a.$$.fragment),f=O(),d&&d.c(),u=O(),B(c.$$.fragment),l=O(),w&&w.c(),v=O(),m=K("ul");for(let g=0;g<_.length;g+=1)_[g].c();Ze(s,"display","flex"),Ze(s,"justify-content","space-between"),x(e,"slot","sidebar"),x(e,"class","govuk-prose")},m(g,h){M(g,e,h),C(r,e,null),U(e,n),U(e,s),U(s,o),U(s,i),C(a,s,null),U(e,f),d&&d.m(e,null),U(e,u),C(c,e,null),U(e,l),w&&w.m(e,null),U(e,v),U(e,m);for(let $=0;$<_.length;$+=1)_[$]&&_[$].m(m,null);p=!0},p(g,h){const $={};h&16384&&($.$$scope={dirty:h,ctx:g}),r.$set($);const A={};if(h&8&&(A.boundaryGeojson=g[3]),a.$set(A),g[0]?d?(d.p(g,h),h&1&&b(d,1)):(d=xe(g),d.c(),b(d,1),d.m(e,u)):d&&(ue(),S(d,1,1,()=>{d=null}),he()),g[1].size>0?w?(w.p(g,h),h&2&&b(w,1)):(w=qe(g),w.c(),b(w,1),w.m(e,v)):w&&(ue(),S(w,1,1,()=>{w=null}),he()),h&6){y=je(g[1].values());let L;for(L=0;L<y.length;L+=1){const q=Re(g,y,L);_[L]?(_[L].p(q,h),b(_[L],1)):(_[L]=Ge(q),_[L].c(),b(_[L],1),_[L].m(m,null))}for(ue(),L=y.length;L<_.length;L+=1)D(L);he()}},i(g){if(!p){b(r.$$.fragment,g),b(a.$$.fragment,g),b(d),b(c.$$.fragment,g),b(w);for(let h=0;h<y.length;h+=1)b(_[h]);p=!0}},o(g){S(r.$$.fragment,g),S(a.$$.fragment,g),S(d),S(c.$$.fragment,g),S(w),_=_.filter(Boolean);for(let h=0;h<_.length;h+=1)S(_[h]);p=!1},d(g){g&&E(e),z(r),z(a),d&&d.d(),z(c),w&&w.d(),Ut(_,g)}}}function Kr(t){let e,r,n,s,o,i,a,f,u,c;return e=new At({props:{schema:We}}),n=new Ot({props:{style:t[4]}}),o=new Pt({props:{schema:We}}),a=new tt({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:t[6]}}),u=new Yt({}),{c(){B(e.$$.fragment),r=O(),B(n.$$.fragment),s=O(),B(o.$$.fragment),i=O(),B(a.$$.fragment),f=O(),B(u.$$.fragment)},m(l,v){C(e,l,v),M(l,r,v),C(n,l,v),M(l,s,v),C(o,l,v),M(l,i,v),C(a,l,v),M(l,f,v),C(u,l,v),c=!0},p:Xe,i(l){c||(b(e.$$.fragment,l),b(n.$$.fragment,l),b(o.$$.fragment,l),b(a.$$.fragment,l),b(u.$$.fragment,l),c=!0)},o(l){S(e.$$.fragment,l),S(n.$$.fragment,l),S(o.$$.fragment,l),S(a.$$.fragment,l),S(u.$$.fragment,l),c=!1},d(l){l&&(E(r),E(s),E(i),E(f)),z(e,l),z(n,l),z(o,l),z(a,l),z(u,l)}}}function Nr(t){let e,r,n,s,o;return r=new Zr({}),s=new kt({props:{style:t[4],$$slots:{default:[Kr]},$$scope:{ctx:t}}}),{c(){e=K("div"),B(r.$$.fragment),n=O(),B(s.$$.fragment),x(e,"slot","main")},m(i,a){M(i,e,a),C(r,e,null),U(e,n),C(s,e,null),o=!0},p(i,a){const f={};a&16384&&(f.$$scope={dirty:a,ctx:i}),s.$set(f)},i(i){o||(b(r.$$.fragment,i),b(s.$$.fragment,i),o=!0)},o(i){S(r.$$.fragment,i),S(s.$$.fragment,i),o=!1},d(i){i&&E(e),z(r),z(s)}}}function Rr(t){let e,r;return e=new Ct({props:{$$slots:{main:[Nr],sidebar:[Fr]},$$scope:{ctx:t}}}),{c(){B(e.$$.fragment)},m(n,s){C(e,n,s),r=!0},p(n,[s]){const o={};s&16399&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){z(e,n)}}}const We="v1";function xr(t,e,r){let n,s;ee(t,Le,p=>r(9,n=p)),ee(t,Y,p=>r(3,s=p)),De(()=>{Dt()});let i=new URLSearchParams(window.location.search).get("style")||"streets",a="",f=new Map,u=new Set;Ye(()=>{Y.set(Lt())});function c(p){try{let d=JSON.parse(p);r(1,f=It(d)),Y.set(d),r(0,a=""),n==null||n.fitBounds(Qe(d),{padding:20,animate:!1})}catch(d){r(0,a=`Couldn't load schemes from a file: ${d}`)}}function l(p){var d='<div class="govuk-prose" style="max-width: 30vw;">';return d+=`<h2>${p.name} (${p.intervention_type})</h2>`,d+=`<p>Scheme reference: ${p.scheme_reference}</p>`,p.length_meters&&(d+=`<p>Length: ${Mt(p.length_meters)}</p>`),p.description&&(d+=`<p>${p.description}</p>`),d}const v=()=>window.open("index.html");function m(p){u=p,r(2,u)}return[a,f,u,s,i,c,l,v,m]}class qr extends oe{constructor(e){super(),ie(this,e,xr,Rr,ae,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new qr({target:document.getElementById("app")});
