import{S as te,i as re,s as ne,g as E,f as A,e as K,u as k,m as B,j as L,k as U,x as R,t as b,l as S,p as M,q as C,W as q,$ as ee,r as Me,b as Se,c as Te,F as St,o as Ue,a as ge,h as x,v as Ze,w as Tt,X as de,B as et,I as Ee,aV as tt,_ as rt,aW as He,ad as nt,d as Ut,P as Fe,R as Ke,y as he,n as me,Q as Dt,z as Lt,a6 as Mt,aN as Et,E as Bt,aa as Ct}from"./stores-a9d339b6.js";import{C as st,S as Ne,M as Be,L as zt,Z as kt,b as At,I as Ot,B as Pt,d as It}from"./ZoomOutMap-ade9479b.js";function Vt(t){let e=new Map;for(let[r,n]of Object.entries(t.schemes))e.set(r,{scheme_reference:r,num_features:0,authority_or_region:n.authority_or_region,capital_scheme_id:n.capital_scheme_id,funding_programme:n.funding_programme});for(let r of t.features)e.get(r.properties.scheme_reference).num_features++,delete r.properties.id,delete r.properties.authority_or_region,delete r.properties.capital_scheme_id,delete r.properties.funding_programme,delete r.properties.valid,delete r.properties.centroid_lon,delete r.properties.centroid_lat;return e}function jt(t){let e;return{c(){e=k("Clear")},m(r,n){L(r,e,n)},d(r){r&&M(e)}}}function Zt(t){let e,r,n,s,o,i;return n=new ge({props:{$$slots:{default:[jt]},$$scope:{ctx:t}}}),n.$on("click",t[11]),{c(){e=K("input"),r=A(),E(n.$$.fragment),x(e,"type","text"),x(e,"class","govuk-input govuk-input--width-10"),x(e,"id","filterText")},m(a,l){L(a,e,l),Ze(e,t[1]),L(a,r,l),B(n,a,l),s=!0,o||(i=Tt(e,"input",t[10]),o=!0)},p(a,l){l&2&&e.value!==a[1]&&Ze(e,a[1]);const h={};l&16384&&(h.$$scope={dirty:l,ctx:a}),n.$set(h)},i(a){s||(b(n.$$.fragment,a),s=!0)},o(a){S(n.$$.fragment,a),s=!1},d(a){a&&(M(e),M(r)),C(n,a),o=!1,i()}}}function Ht(t){let e,r,n,s,o,i,a,l;function h(f){t[8](f)}let u={label:"Authority or region",id:"filterAuthority",choices:t[4],emptyOption:!0};t[2]!==void 0&&(u.value=t[2]),e=new Ne({props:u}),Se.push(()=>Te(e,"value",h));function c(f){t[9](f)}let y={label:"Funding programme",id:"filterFundingProgramme",choices:t[5],emptyOption:!0};return t[3]!==void 0&&(y.value=t[3]),s=new Ne({props:y}),Se.push(()=>Te(s,"value",c)),a=new St({props:{label:"Any field",id:"filterText",$$slots:{default:[Zt]},$$scope:{ctx:t}}}),{c(){E(e.$$.fragment),n=A(),E(s.$$.fragment),i=A(),E(a.$$.fragment)},m(f,m){B(e,f,m),L(f,n,m),B(s,f,m),L(f,i,m),B(a,f,m),l=!0},p(f,m){const d={};m&16&&(d.choices=f[4]),!r&&m&4&&(r=!0,d.value=f[2],Ue(()=>r=!1)),e.$set(d);const w={};m&32&&(w.choices=f[5]),!o&&m&8&&(o=!0,w.value=f[3],Ue(()=>o=!1)),s.$set(w);const v={};m&16386&&(v.$$scope={dirty:m,ctx:f}),a.$set(v)},i(f){l||(b(e.$$.fragment,f),b(s.$$.fragment,f),b(a.$$.fragment,f),l=!0)},o(f){S(e.$$.fragment,f),S(s.$$.fragment,f),S(a.$$.fragment,f),l=!1},d(f){f&&(M(n),M(i)),C(e,f),C(s,f),C(a,f)}}}function Ft(t){let e,r,n,s,o=t[0].size+"",i,a,l=t[6].route+"",h,u,c=t[6].area+"",y,f,m=t[6].crossing+"",d,w,v=t[6].other+"",_,D,p;return e=new st({props:{label:"Filters",$$slots:{default:[Ht]},$$scope:{ctx:t}}}),{c(){E(e.$$.fragment),r=A(),n=K("p"),s=k("Showing "),i=k(o),a=k(" schemes ("),h=k(l),u=k(" routes, "),y=k(c),f=k(` areas,
  `),d=k(m),w=k(" crossings, "),_=k(v),D=k(" other)")},m(g,$){B(e,g,$),L(g,r,$),L(g,n,$),U(n,s),U(n,i),U(n,a),U(n,h),U(n,u),U(n,y),U(n,f),U(n,d),U(n,w),U(n,_),U(n,D),p=!0},p(g,[$]){const O={};$&16446&&(O.$$scope={dirty:$,ctx:g}),e.$set(O),(!p||$&1)&&o!==(o=g[0].size+"")&&R(i,o),(!p||$&64)&&l!==(l=g[6].route+"")&&R(h,l),(!p||$&64)&&c!==(c=g[6].area+"")&&R(y,c),(!p||$&64)&&m!==(m=g[6].crossing+"")&&R(d,m),(!p||$&64)&&v!==(v=g[6].other+"")&&R(_,v)},i(g){p||(b(e.$$.fragment,g),p=!0)},o(g){S(e.$$.fragment,g),p=!1},d(g){g&&(M(r),M(n)),C(e,g)}}}function Kt(t,e,r){let n;q(t,ee,v=>r(12,n=v));let{schemes:s}=e,{schemesToBeShown:o=new Set}=e,i="",a=[],l="",h=[],u="",c={area:0,route:0,crossing:0,other:0};Me(()=>{let v=new Set,_=new Set;for(let D of s.values())D.authority_or_region&&v.add(D.authority_or_region),D.funding_programme&&_.add(D.funding_programme);r(4,a=Array.from(v.entries())),a.sort(),r(5,h=Array.from(_.entries())),h.sort()});function y(v,_,D){let p=v.toLowerCase(),g=$=>{if(p&&!JSON.stringify($.properties).toLowerCase().includes(p))return!1;if(_||D){let O=s.get($.properties.scheme_reference);if(_&&O.authority_or_region!=_||D&&O.funding_programme!=D)return!1}return!0};r(0,o=new Set(n.features.filter(g).map($=>$.properties.scheme_reference))),r(6,c={area:0,route:0,crossing:0,other:0}),ee.update($=>{for(let O of $.features)o.has(O.properties.scheme_reference)?(delete O.properties.hide_while_editing,r(6,c[O.properties.intervention_type]++,c)):O.properties.hide_while_editing=!0;return $}),r(6,c)}function f(v){l=v,r(2,l)}function m(v){u=v,r(3,u)}function d(){i=this.value,r(1,i)}const w=()=>r(1,i="");return t.$$set=v=>{"schemes"in v&&r(7,s=v.schemes),"schemesToBeShown"in v&&r(0,o=v.schemesToBeShown)},t.$$.update=()=>{t.$$.dirty&14&&y(i,l,u)},[o,i,l,u,a,h,c,s,f,m,d,w]}class Nt extends te{constructor(e){super(),re(this,e,Kt,Ft,ne,{schemes:7,schemesToBeShown:0})}}function Rt(t){let e;return{c(){e=k("Show on map")},m(r,n){L(r,e,n)},d(r){r&&M(e)}}}function xt(t){let e;return{c(){e=k("Edit scheme")},m(r,n){L(r,e,n)},d(r){r&&M(e)}}}function qt(t){let e,r,n=t[0].authority_or_region+"",s,o,i,a,l=t[0].capital_scheme_id+"",h,u,c,y,f=t[0].funding_programme+"",m,d,w,v,_,D,p;return v=new ge({props:{$$slots:{default:[Rt]},$$scope:{ctx:t}}}),v.$on("click",t[1]),D=new ge({props:{$$slots:{default:[xt]},$$scope:{ctx:t}}}),D.$on("click",t[2]),{c(){e=K("p"),r=k("Authority or region: "),s=k(n),o=A(),i=K("p"),a=k("Capital scheme ID: "),h=k(l),u=A(),c=K("p"),y=k("Funding programme: "),m=k(f),d=A(),w=K("div"),E(v.$$.fragment),_=A(),E(D.$$.fragment),x(w,"class","govuk-button-group")},m(g,$){L(g,e,$),U(e,r),U(e,s),L(g,o,$),L(g,i,$),U(i,a),U(i,h),L(g,u,$),L(g,c,$),U(c,y),U(c,m),L(g,d,$),L(g,w,$),B(v,w,null),U(w,_),B(D,w,null),p=!0},p(g,$){(!p||$&1)&&n!==(n=g[0].authority_or_region+"")&&R(s,n),(!p||$&1)&&l!==(l=g[0].capital_scheme_id+"")&&R(h,l),(!p||$&1)&&f!==(f=g[0].funding_programme+"")&&R(m,f);const O={};$&32&&(O.$$scope={dirty:$,ctx:g}),v.$set(O);const z={};$&32&&(z.$$scope={dirty:$,ctx:g}),D.$set(z)},i(g){p||(b(v.$$.fragment,g),b(D.$$.fragment,g),p=!0)},o(g){S(v.$$.fragment,g),S(D.$$.fragment,g),p=!1},d(g){g&&(M(e),M(o),M(i),M(u),M(c),M(d),M(w)),C(v),C(D)}}}function Jt(t){let e,r;return e=new st({props:{label:`${t[0].scheme_reference}: ${t[0].num_features} features`,$$slots:{default:[qt]},$$scope:{ctx:t}}}),{c(){E(e.$$.fragment)},m(n,s){B(e,n,s),r=!0},p(n,[s]){const o={};s&1&&(o.label=`${n[0].scheme_reference}: ${n[0].num_features} features`),s&33&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){C(e,n)}}}function Gt(t,e,r){let n,s;q(t,ee,l=>r(3,n=l)),q(t,de,l=>r(4,s=l));let{scheme:o}=e;function i(){let l={type:"FeatureCollection",features:n.features.filter(h=>h.properties.scheme_reference==o.scheme_reference)};s==null||s.fitBounds(et(l),{padding:20,animate:!1})}function a(){let l={type:"FeatureCollection",features:n.features.filter(u=>u.properties.scheme_reference==o.scheme_reference)},h=o.authority_or_region;window.localStorage.setItem(h,JSON.stringify(l)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return t.$$set=l=>{"scheme"in l&&r(0,o=l.scheme)},[o,i,a]}class Wt extends te{constructor(e){super(),re(this,e,Gt,Jt,ne,{scheme:0})}}function Qt(t){let e,r;return e=new Be({props:{layers:["schools"],contents:Xt}}),{c(){E(e.$$.fragment)},m(n,s){B(e,n,s),r=!0},p:Ee,i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){C(e,n)}}}let ce="schools";function Xt(t){return t.name??"Unnamed school"}function Yt(t,e,r){let n;return q(t,de,s=>r(0,n=s)),tt(n,ce,"https://atip.uk/layers/v1/schools.pmtiles"),rt(n,{id:ce,source:ce,sourceLayer:ce,color:"red",opacity:.8}),[]}class er extends te{constructor(e){super(),re(this,e,Yt,Qt,ne,{})}}function tr(t){let e,r;return e=new Be({props:{layers:["hospitals"],contents:rr}}),{c(){E(e.$$.fragment)},m(n,s){B(e,n,s),r=!0},p:Ee,i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){C(e,n)}}}let ue="hospitals";function rr(t){return t.name??"Unnamed hospital"}function nr(t,e,r){let n;return q(t,de,s=>r(0,n=s)),tt(n,ue,"https://atip.uk/layers/v1/hospitals.pmtiles"),rt(n,{id:ue,source:ue,sourceLayer:ue,color:"blue",opacity:.8}),[]}class sr extends te{constructor(e){super(),re(this,e,nr,tr,ne,{})}}var P=(t,e,r)=>new Promise((n,s)=>{var o=l=>{try{a(r.next(l))}catch(h){s(h)}},i=l=>{try{a(r.throw(l))}catch(h){s(h)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,i);a((r=r.apply(t,e)).next())}),V=Uint8Array,X=Uint16Array,or=Int32Array,ot=new V([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),it=new V([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ir=new V([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),at=function(t,e){for(var r=new X(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new or(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)s[o]=o-r[n]<<5|n;return{b:r,r:s}},lt=at(ot,2),ft=lt.b,ar=lt.r;ft[28]=258,ar[258]=28;var lr=at(it,0),fr=lr.b,De=new X(32768);for(T=0;T<32768;++T)N=(T&43690)>>1|(T&21845)<<1,N=(N&52428)>>2|(N&13107)<<2,N=(N&61680)>>4|(N&3855)<<4,De[T]=((N&65280)>>8|(N&255)<<8)>>1;var N,T,ae=function(t,e,r){for(var n=t.length,s=0,o=new X(e);s<n;++s)t[s]&&++o[t[s]-1];var i=new X(e);for(s=1;s<e;++s)i[s]=i[s-1]+o[s-1]<<1;var a;if(r){a=new X(1<<e);var l=15-e;for(s=0;s<n;++s)if(t[s])for(var h=s<<4|t[s],u=e-t[s],c=i[t[s]-1]++<<u,y=c|(1<<u)-1;c<=y;++c)a[De[c]>>l]=h}else for(a=new X(n),s=0;s<n;++s)t[s]&&(a[s]=De[i[t[s]-1]++]>>15-t[s]);return a},le=new V(288);for(T=0;T<144;++T)le[T]=8;var T;for(T=144;T<256;++T)le[T]=9;var T;for(T=256;T<280;++T)le[T]=7;var T;for(T=280;T<288;++T)le[T]=8;var T,ct=new V(32);for(T=0;T<32;++T)ct[T]=5;var T,cr=ae(le,9,1),ur=ae(ct,5,1),we=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},H=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},be=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},hr=function(t){return(t+7)/8|0},mr=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var n=new V(r-e);return n.set(t.subarray(e,r)),n},gr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],I=function(t,e,r){var n=new Error(e||gr[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,I),!r)throw n;return n},Ce=function(t,e,r,n){var s=t.length,o=n?n.length:0;if(!s||e.f&&!e.l)return r||new V(0);var i=!r||e.i!=2,a=e.i;r||(r=new V(s*3));var l=function(Ie){var Ve=r.length;if(Ie>Ve){var je=new V(Math.max(Ve*2,Ie));je.set(r),r=je}},h=e.f||0,u=e.p||0,c=e.b||0,y=e.l,f=e.d,m=e.m,d=e.n,w=s*8;do{if(!y){h=H(t,u,1);var v=H(t,u+1,3);if(u+=3,v)if(v==1)y=cr,f=ur,m=9,d=5;else if(v==2){var g=H(t,u,31)+257,$=H(t,u+10,15)+4,O=g+H(t,u+5,31)+1;u+=14;for(var z=new V(O),J=new V(19),j=0;j<$;++j)J[ir[j]]=H(t,u+j*3,7);u+=$*3;for(var ze=we(J),$t=(1<<ze)-1,vt=ae(J,ze,1),j=0;j<O;){var ke=vt[H(t,u,$t)];u+=ke&15;var _=ke>>4;if(_<16)z[j++]=_;else{var G=0,fe=0;for(_==16?(fe=3+H(t,u,3),u+=2,G=z[j-1]):_==17?(fe=3+H(t,u,7),u+=3):_==18&&(fe=11+H(t,u,127),u+=7);fe--;)z[j++]=G}}var Ae=z.subarray(0,g),Z=z.subarray(g);m=we(Ae),d=we(Z),y=ae(Ae,m,1),f=ae(Z,d,1)}else I(1);else{var _=hr(u)+4,D=t[_-4]|t[_-3]<<8,p=_+D;if(p>s){a&&I(0);break}i&&l(c+D),r.set(t.subarray(_,p),c),e.b=c+=D,e.p=u=p*8,e.f=h;continue}if(u>w){a&&I(0);break}}i&&l(c+131072);for(var yt=(1<<m)-1,wt=(1<<d)-1,_e=u;;_e=u){var G=y[be(t,u)&yt],W=G>>4;if(u+=G&15,u>w){a&&I(0);break}if(G||I(2),W<256)r[c++]=W;else if(W==256){_e=u,y=null;break}else{var Oe=W-254;if(W>264){var j=W-257,se=ot[j];Oe=H(t,u,(1<<se)-1)+ft[j],u+=se}var $e=f[be(t,u)&wt],ve=$e>>4;$e||I(3),u+=$e&15;var Z=fr[ve];if(ve>3){var se=it[ve];Z+=be(t,u)&(1<<se)-1,u+=se}if(u>w){a&&I(0);break}i&&l(c+131072);var ye=c+Oe;if(c<Z){var Pe=o-Z,bt=Math.min(Z,ye);for(Pe+c<0&&I(3);c<bt;++c)r[c]=n[Pe+c]}for(;c<ye;c+=4)r[c]=r[c-Z],r[c+1]=r[c+1-Z],r[c+2]=r[c+2-Z],r[c+3]=r[c+3-Z];c=ye}}e.l=y,e.p=_e,e.b=c,e.f=h,y&&(h=1,e.m=m,e.d=f,e.n=d)}while(!h);return c==r.length?r:mr(r,0,c)},pr=new V(0),dr=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&I(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=(t[10]|t[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[r++]);return r+(e&2)},_r=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},$r=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&I(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&I(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function vr(t,e){return Ce(t,{i:2},e&&e.out,e&&e.dictionary)}function yr(t,e){var r=dr(t);return r+8>t.length&&I(6,"invalid gzip data"),Ce(t.subarray(r,-8),{i:2},e&&e.out||new V(_r(t)),e&&e.dictionary)}function wr(t,e){return Ce(t.subarray($r(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Le(t,e){return t[0]==31&&t[1]==139&&t[2]==8?yr(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?vr(t,e):wr(t,e)}var br=typeof TextDecoder<"u"&&new TextDecoder,Sr=0;try{br.decode(pr,{stream:!0}),Sr=1}catch{}var ut=(t,e)=>t*Math.pow(2,e),oe=(t,e)=>Math.floor(t/Math.pow(2,e)),pe=(t,e)=>ut(t.getUint16(e+1,!0),8)+t.getUint8(e),ht=(t,e)=>ut(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),Tr=(t,e,r,n,s)=>{if(t!=n.getUint8(s))return t-n.getUint8(s);const o=pe(n,s+1);if(e!=o)return e-o;const i=pe(n,s+4);return r!=i?r-i:0},Ur=(t,e,r,n)=>{const s=mt(t,e|128,r,n);return s?{z:e,x:r,y:n,offset:s[0],length:s[1],is_dir:!0}:null},Re=(t,e,r,n)=>{const s=mt(t,e,r,n);return s?{z:e,x:r,y:n,offset:s[0],length:s[1],is_dir:!1}:null},mt=(t,e,r,n)=>{let s=0,o=t.byteLength/17-1;for(;s<=o;){const i=o+s>>1,a=Tr(e,r,n,t,i*17);if(a>0)s=i+1;else if(a<0)o=i-1;else return[ht(t,i*17+7),t.getUint32(i*17+13,!0)]}return null},Dr=(t,e)=>t.is_dir&&!e.is_dir?1:!t.is_dir&&e.is_dir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,gt=(t,e)=>{const r=t.getUint8(e*17);return{z:r&127,x:pe(t,e*17+1),y:pe(t,e*17+4),offset:ht(t,e*17+7),length:t.getUint32(e*17+13,!0),is_dir:r>>7===1}},xe=t=>{const e=[],r=new DataView(t);for(let n=0;n<r.byteLength/17;n++)e.push(gt(r,n));return Lr(e)},Lr=t=>{t.sort(Dr);const e=new ArrayBuffer(17*t.length),r=new Uint8Array(e);for(let n=0;n<t.length;n++){const s=t[n];let o=s.z;s.is_dir&&(o=o|128),r[n*17]=o,r[n*17+1]=s.x&255,r[n*17+2]=s.x>>8&255,r[n*17+3]=s.x>>16&255,r[n*17+4]=s.y&255,r[n*17+5]=s.y>>8&255,r[n*17+6]=s.y>>16&255,r[n*17+7]=s.offset&255,r[n*17+8]=oe(s.offset,8)&255,r[n*17+9]=oe(s.offset,16)&255,r[n*17+10]=oe(s.offset,24)&255,r[n*17+11]=oe(s.offset,32)&255,r[n*17+12]=oe(s.offset,48)&255,r[n*17+13]=s.length&255,r[n*17+14]=s.length>>8&255,r[n*17+15]=s.length>>16&255,r[n*17+16]=s.length>>24&255}return e},Mr=(t,e)=>{if(t.byteLength<17)return null;const r=t.byteLength/17,n=gt(t,r-1);if(n.is_dir){const s=n.z,o=e.z-s,i=Math.trunc(e.x/(1<<o)),a=Math.trunc(e.y/(1<<o));return{z:s,x:i,y:a}}return null};function Er(t){return P(this,null,function*(){const e=yield t.getBytes(0,512e3),r=new DataView(e.data),n=r.getUint32(4,!0),s=r.getUint16(8,!0),o=new TextDecoder("utf-8"),i=JSON.parse(o.decode(new DataView(e.data,10,n)));let a=0;i.compression==="gzip"&&(a=2);let l=0;"minzoom"in i&&(l=+i.minzoom);let h=0;"maxzoom"in i&&(h=+i.maxzoom);let u=0,c=0,y=0,f=-180,m=-85,d=180,w=85;if(i.bounds){const _=i.bounds.split(",");f=+_[0],m=+_[1],d=+_[2],w=+_[3]}if(i.center){const _=i.center.split(",");u=+_[0],c=+_[1],y=+_[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:h,minLon:f,minLat:m,maxLon:d,maxLat:w,centerZoom:y,centerLon:u,centerLat:c,etag:e.etag}})}function Br(t,e,r,n,s,o,i){return P(this,null,function*(){let a=yield r.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(a=xe(a));const l=Re(new DataView(a),n,s,o);if(l){let c=(yield e.getBytes(l.offset,l.length,i)).data;const y=new DataView(c);return y.getUint8(0)==31&&y.getUint8(1)==139&&(c=Le(new Uint8Array(c))),{data:c}}const h=Mr(new DataView(a),{z:n,x:s,y:o});if(h){const u=Ur(new DataView(a),h.z,h.x,h.y);if(u){let c=yield r.getArrayBuffer(e,u.offset,u.length,t);t.specVersion===1&&(c=xe(c));const y=Re(new DataView(c),n,s,o);if(y){let m=(yield e.getBytes(y.offset,y.length,i)).data;const d=new DataView(m);return d.getUint8(0)==31&&d.getUint8(1)==139&&(m=Le(new Uint8Array(m))),{data:m}}}}})}var pt={getHeader:Er,getZxy:Br},Cr=class{constructor(){this.tile=(t,e)=>{if(t.type=="json"){const r=t.url.substr(10);let n=this.tiles.get(r);return n||(n=new qe(r),this.tiles.set(r,n)),n.getHeader().then(s=>{const o={tiles:[t.url+"/{z}/{x}/{y}"],minzoom:s.minZoom,maxzoom:s.maxZoom,bounds:[s.minLon,s.minLat,s.maxLon,s.maxLat]};e(null,o,null,null)}).catch(s=>{e(s,null,null,null)}),{cancel:()=>{}}}else{const r=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=t.url.match(r);if(!n)throw new Error("Invalid PMTiles protocol URL");const s=n[1];let o=this.tiles.get(s);o||(o=new qe(s),this.tiles.set(s,o));const i=n[2],a=n[3],l=n[4],h=new AbortController,u=h.signal;let c=()=>{h.abort()};return o.getHeader().then(y=>{o.getZxy(+i,+a,+l,u).then(f=>{f?e(null,new Uint8Array(f.data),f.cacheControl,f.expires):y.tileType==1?e(null,new Uint8Array,null,null):e(null,null,null,null)}).catch(f=>{f.name!=="AbortError"&&e(f,null,null,null)})}),{cancel:c}}},this.tiles=new Map}add(t){this.tiles.set(t.source.getKey(),t)}get(t){return this.tiles.get(t)}};function Q(t,e){return(e>>>0)*4294967296+(t>>>0)}function zr(t,e){const r=e.buf;let n,s;if(s=r[e.pos++],n=(s&112)>>4,s<128||(s=r[e.pos++],n|=(s&127)<<3,s<128)||(s=r[e.pos++],n|=(s&127)<<10,s<128)||(s=r[e.pos++],n|=(s&127)<<17,s<128)||(s=r[e.pos++],n|=(s&127)<<24,s<128)||(s=r[e.pos++],n|=(s&1)<<31,s<128))return Q(t,n);throw new Error("Expected varint not more than 10 bytes")}function ie(t){const e=t.buf;let r,n;return n=e[t.pos++],r=n&127,n<128||(n=e[t.pos++],r|=(n&127)<<7,n<128)||(n=e[t.pos++],r|=(n&127)<<14,n<128)||(n=e[t.pos++],r|=(n&127)<<21,n<128)?r:(n=e[t.pos],r|=(n&15)<<28,zr(r,t))}function kr(t,e,r,n){if(n==0){r==1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}var Ar=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Or(t,e,r){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,t)-1||r>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");const n=Ar[t],s=Math.pow(2,t);let o=0,i=0,a=0;const l=[e,r];let h=s/2;for(;h>0;)o=(l[0]&h)>0?1:0,i=(l[1]&h)>0?1:0,a+=h*h*(3*o^i),kr(h,l,o,i),h=h/2;return n+a}function dt(t,e){return P(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Le(new Uint8Array(t));{let n=new Response(t).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}}else throw Error("Compression method not supported")})}var Pr=127;function Ir(t,e){let r=0,n=t.length-1;for(;r<=n;){const s=n+r>>1,o=e-t[s].tileId;if(o>0)r=s+1;else if(o<0)n=s-1;else return t[s]}return n>=0&&(t[n].runLength===0||e-t[n].tileId<t[n].runLength)?t[n]:null}var Vr=class{constructor(t){this.url=t}getKey(){return this.url}getBytes(t,e,r){return P(this,null,function*(){let n;r||(n=new AbortController,r=n.signal);let s=yield fetch(this.url,{signal:r,headers:{Range:"bytes="+t+"-"+(t+e-1)}});if(s.status===416&&t===0){const a=s.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const l=+a.substr(8);s=yield fetch(this.url,{signal:r,headers:{Range:"bytes=0-"+(l-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function F(t,e){const r=t.getUint32(e+4,!0),n=t.getUint32(e+0,!0);return r*Math.pow(2,32)+n}function jr(t,e){const r=new DataView(t),n=r.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:F(r,8),rootDirectoryLength:F(r,16),jsonMetadataOffset:F(r,24),jsonMetadataLength:F(r,32),leafDirectoryOffset:F(r,40),leafDirectoryLength:F(r,48),tileDataOffset:F(r,56),tileDataLength:F(r,64),numAddressedTiles:F(r,72),numTileEntries:F(r,80),numTileContents:F(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:e}}function _t(t){const e={buf:new Uint8Array(t),pos:0},r=ie(e),n=[];let s=0;for(let o=0;o<r;o++){const i=ie(e);n.push({tileId:s+i,offset:0,length:0,runLength:1}),s+=i}for(let o=0;o<r;o++)n[o].runLength=ie(e);for(let o=0;o<r;o++)n[o].length=ie(e);for(let o=0;o<r;o++){const i=ie(e);i===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=i-1}return n}function Zr(t){const e=new DataView(t);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Y=class extends Error{};function Hr(t,e,r,n){return P(this,null,function*(){const s=yield t.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Zr(s.data)<3)return[yield pt.getHeader(t)];const i=s.data.slice(0,Pr);let a=s.etag;n&&s.etag!=n&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),a=void 0);const l=jr(i,a);if(r){const h=s.data.slice(l.rootDirectoryOffset,l.rootDirectoryOffset+l.rootDirectoryLength),u=t.getKey()+"|"+(l.etag||"")+"|"+l.rootDirectoryOffset+"|"+l.rootDirectoryLength,c=_t(yield e(h,l.internalCompression));return[l,[u,c.length,c]]}return[l,void 0]})}function Fr(t,e,r,n,s){return P(this,null,function*(){const o=yield t.getBytes(r,n);if(s.etag&&s.etag!==o.etag)throw new Y(o.etag);const i=yield e(o.data,s.internalCompression),a=_t(i);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var Kr=class{constructor(t=100,e=!0,r=dt){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.prefetch=e,this.decompress=r}getHeader(t,e){return P(this,null,function*(){const r=t.getKey();if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const n=new Promise((s,o)=>{Hr(t,this.decompress,this.prefetch,e).then(i=>{i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:Promise.resolve(i[1][2])}),s(i[0]),this.prune()}).catch(i=>{o(i)})});return this.cache.set(r,{lastUsed:this.counter++,data:n}),n})}getDirectory(t,e,r,n){return P(this,null,function*(){const s=t.getKey()+"|"+(n.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((i,a)=>{Fr(t,this.decompress,e,r,n).then(l=>{i(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}getArrayBuffer(t,e,r,n){return P(this,null,function*(){const s=t.getKey()+"|"+(n.etag||"")+"|"+e+"|"+r;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((i,a)=>{t.getBytes(e,r).then(l=>{if(n.etag&&n.etag!==l.etag)throw new Y(l.etag);i(l.data),this.cache.has(s),this.prune()}).catch(l=>{a(l)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((r,n)=>{r.lastUsed<t&&(t=r.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(t,e){return P(this,null,function*(){this.cache.delete(t.getKey()),yield this.getHeader(t,e)})}},qe=class{constructor(t,e,r){typeof t=="string"?this.source=new Vr(t):this.source=t,r?this.decompress=r:this.decompress=dt,e?this.cache=e:this.cache=new Kr}getHeader(){return P(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,r,n){return P(this,null,function*(){const s=Or(t,e,r),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return pt.getZxy(o,this.source,this.cache,t,e,r,n);if(t<o.minZoom||t>o.maxZoom)return;let i=o.rootDirectoryOffset,a=o.rootDirectoryLength;for(let l=0;l<=3;l++){const h=yield this.cache.getDirectory(this.source,i,a,o),u=Ir(h,s);if(u)if(u.runLength>0){const c=yield this.source.getBytes(o.tileDataOffset+u.offset,u.length,n);if(o.etag&&o.etag!==c.etag)throw new Y(c.etag);return{data:yield this.decompress(c.data,o.tileCompression),cacheControl:c.cacheControl,expires:c.expires}}else i=o.leafDirectoryOffset+u.offset,a=u.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,r,n){return P(this,null,function*(){try{return yield this.getZxyAttempt(t,e,r,n)}catch(s){if(s instanceof Y)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(t,e,r,n);throw s}})}getMetadataAttempt(){return P(this,null,function*(){const t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength);if(t.etag&&t.etag!==e.etag)throw new Y(e.etag);const r=yield this.decompress(e.data,t.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(r))})}getMetadata(){return P(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof Y)return this.cache.invalidate(this.source,t.message),yield this.getMetadataAttempt();throw t}})}};function Nr(t){return Me(()=>{let e=new Cr;He.addProtocol("pmtiles",e.tile)}),nt(()=>{He.removeProtocol("pmtiles")}),[]}class Rr extends te{constructor(e){super(),re(this,e,Nr,null,ne,{})}}function Je(t,e,r){const n=t.slice();return n[11]=e[r],n}function xr(t){let e;return{c(){e=k("Home")},m(r,n){L(r,e,n)},d(r){r&&M(e)}}}function Ge(t){let e,r;return e=new Bt({props:{errorMessage:t[0]}}),{c(){E(e.$$.fragment)},m(n,s){B(e,n,s),r=!0},p(n,s){const o={};s&1&&(o.errorMessage=n[0]),e.$set(o)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){C(e,n)}}}function We(t){let e,r,n;function s(i){t[8](i)}let o={schemes:t[1]};return t[2]!==void 0&&(o.schemesToBeShown=t[2]),e=new Nt({props:o}),Se.push(()=>Te(e,"schemesToBeShown",s)),{c(){E(e.$$.fragment)},m(i,a){B(e,i,a),n=!0},p(i,a){const l={};a&2&&(l.schemes=i[1]),!r&&a&4&&(r=!0,l.schemesToBeShown=i[2],Ue(()=>r=!1)),e.$set(l)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){C(e,i)}}}function Qe(t){let e,r;return e=new Wt({props:{scheme:t[11]}}),{c(){E(e.$$.fragment)},m(n,s){B(e,n,s),r=!0},p(n,s){const o={};s&2&&(o.scheme=n[11]),e.$set(o)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){C(e,n)}}}function Xe(t){let e=t[2].has(t[11].scheme_reference),r,n,s=e&&Qe(t);return{c(){s&&s.c(),r=Ct()},m(o,i){s&&s.m(o,i),L(o,r,i),n=!0},p(o,i){i&6&&(e=o[2].has(o[11].scheme_reference)),e?s?(s.p(o,i),i&6&&b(s,1)):(s=Qe(o),s.c(),b(s,1),s.m(r.parentNode,r)):s&&(he(),S(s,1,1,()=>{s=null}),me())},i(o){n||(b(s),n=!0)},o(o){S(s),n=!1},d(o){o&&M(r),s&&s.d(o)}}}function qr(t){let e,r,n,s,o,i,a,l,h,u,c,y,f,m;r=new ge({props:{$$slots:{default:[xr]},$$scope:{ctx:t}}}),r.$on("click",t[7]),a=new kt({props:{boundaryGeojson:t[3]}});let d=t[0]&&Ge(t);u=new Ut({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:t[5]}});let w=t[1].size>0&&We(t),v=Fe(t[1].values()),_=[];for(let p=0;p<v.length;p+=1)_[p]=Xe(Je(t,v,p));const D=p=>S(_[p],1,1,()=>{_[p]=null});return{c(){e=K("div"),E(r.$$.fragment),n=A(),s=K("div"),o=K("h1"),o.textContent="Browse schemes",i=A(),E(a.$$.fragment),l=A(),d&&d.c(),h=A(),E(u.$$.fragment),c=A(),w&&w.c(),y=A(),f=K("ul");for(let p=0;p<_.length;p+=1)_[p].c();Ke(s,"display","flex"),Ke(s,"justify-content","space-between"),x(e,"slot","sidebar"),x(e,"class","govuk-prose")},m(p,g){L(p,e,g),B(r,e,null),U(e,n),U(e,s),U(s,o),U(s,i),B(a,s,null),U(e,l),d&&d.m(e,null),U(e,h),B(u,e,null),U(e,c),w&&w.m(e,null),U(e,y),U(e,f);for(let $=0;$<_.length;$+=1)_[$]&&_[$].m(f,null);m=!0},p(p,g){const $={};g&16384&&($.$$scope={dirty:g,ctx:p}),r.$set($);const O={};if(g&8&&(O.boundaryGeojson=p[3]),a.$set(O),p[0]?d?(d.p(p,g),g&1&&b(d,1)):(d=Ge(p),d.c(),b(d,1),d.m(e,h)):d&&(he(),S(d,1,1,()=>{d=null}),me()),p[1].size>0?w?(w.p(p,g),g&2&&b(w,1)):(w=We(p),w.c(),b(w,1),w.m(e,y)):w&&(he(),S(w,1,1,()=>{w=null}),me()),g&6){v=Fe(p[1].values());let z;for(z=0;z<v.length;z+=1){const J=Je(p,v,z);_[z]?(_[z].p(J,g),b(_[z],1)):(_[z]=Xe(J),_[z].c(),b(_[z],1),_[z].m(f,null))}for(he(),z=v.length;z<_.length;z+=1)D(z);me()}},i(p){if(!m){b(r.$$.fragment,p),b(a.$$.fragment,p),b(d),b(u.$$.fragment,p),b(w);for(let g=0;g<v.length;g+=1)b(_[g]);m=!0}},o(p){S(r.$$.fragment,p),S(a.$$.fragment,p),S(d),S(u.$$.fragment,p),S(w),_=_.filter(Boolean);for(let g=0;g<_.length;g+=1)S(_[g]);m=!1},d(p){p&&M(e),C(r),C(a),d&&d.d(),C(u),w&&w.d(),Dt(_,p)}}}function Jr(t){let e,r,n,s,o,i,a,l,h,u,c,y;return e=new Ot({props:{schema:Ye}}),n=new Pt({props:{style:t[4]}}),o=new It({props:{schema:Ye}}),a=new Be({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:t[6]}}),h=new er({}),c=new sr({}),{c(){E(e.$$.fragment),r=A(),E(n.$$.fragment),s=A(),E(o.$$.fragment),i=A(),E(a.$$.fragment),l=A(),E(h.$$.fragment),u=A(),E(c.$$.fragment)},m(f,m){B(e,f,m),L(f,r,m),B(n,f,m),L(f,s,m),B(o,f,m),L(f,i,m),B(a,f,m),L(f,l,m),B(h,f,m),L(f,u,m),B(c,f,m),y=!0},p:Ee,i(f){y||(b(e.$$.fragment,f),b(n.$$.fragment,f),b(o.$$.fragment,f),b(a.$$.fragment,f),b(h.$$.fragment,f),b(c.$$.fragment,f),y=!0)},o(f){S(e.$$.fragment,f),S(n.$$.fragment,f),S(o.$$.fragment,f),S(a.$$.fragment,f),S(h.$$.fragment,f),S(c.$$.fragment,f),y=!1},d(f){f&&(M(r),M(s),M(i),M(l),M(u)),C(e,f),C(n,f),C(o,f),C(a,f),C(h,f),C(c,f)}}}function Gr(t){let e,r,n,s,o;return r=new Rr({}),s=new At({props:{style:t[4],$$slots:{default:[Jr]},$$scope:{ctx:t}}}),{c(){e=K("div"),E(r.$$.fragment),n=A(),E(s.$$.fragment),x(e,"slot","main")},m(i,a){L(i,e,a),B(r,e,null),U(e,n),B(s,e,null),o=!0},p(i,a){const l={};a&16384&&(l.$$scope={dirty:a,ctx:i}),s.$set(l)},i(i){o||(b(r.$$.fragment,i),b(s.$$.fragment,i),o=!0)},o(i){S(r.$$.fragment,i),S(s.$$.fragment,i),o=!1},d(i){i&&M(e),C(r),C(s)}}}function Wr(t){let e,r;return e=new zt({props:{$$slots:{main:[Gr],sidebar:[qr]},$$scope:{ctx:t}}}),{c(){E(e.$$.fragment)},m(n,s){B(e,n,s),r=!0},p(n,[s]){const o={};s&16399&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){C(e,n)}}}const Ye="v1";function Qr(t,e,r){let n,s;q(t,de,m=>r(9,n=m)),q(t,ee,m=>r(3,s=m)),Me(()=>{Lt()});let i=new URLSearchParams(window.location.search).get("style")||"streets",a="",l=new Map,h=new Set;nt(()=>{ee.set(Mt())});function u(m){try{let d=JSON.parse(m);r(1,l=Vt(d)),ee.set(d),r(0,a=""),n==null||n.fitBounds(et(d),{padding:20,animate:!1})}catch(d){r(0,a=`Couldn't load schemes from a file: ${d}`)}}function c(m){var d='<div class="govuk-prose" style="max-width: 30vw;">';return d+=`<h2>${m.name} (${m.intervention_type})</h2>`,d+=`<p>Scheme reference: ${m.scheme_reference}</p>`,m.length_meters&&(d+=`<p>Length: ${Et(m.length_meters)}</p>`),m.description&&(d+=`<p>${m.description}</p>`),d}const y=()=>window.open("index.html");function f(m){h=m,r(2,h)}return[a,l,h,s,i,u,c,y,f]}class Xr extends te{constructor(e){super(),re(this,e,Qr,Wr,ne,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Xr({target:document.getElementById("app")});
