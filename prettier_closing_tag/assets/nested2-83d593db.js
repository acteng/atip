import{S as ke,i as Se,s as Ce,g as N,m as A,t as d,l as b,q as L,G as ae,r as Fe,T as je,a as te,d as Be,al as fe,e as P,f as M,u as C,aa as ue,h as Y,j as k,k as $,y as re,n as ne,x as U,p as S,am as Me,z as Ne,B as ie,E as Ae,b as ce,c as me,F as Le,o as pe,Q as Oe,R as ze,v as _e,w as Ie}from"./maplibre_helpers-65afd94a.js";import{L as Te,Z as Ee,C as ve,p as Ge,g as ee,S as $e,I as Je,B as Pe,q as qe,M as De,m as Re}from"./ZoomOutMap-e23c04ee.js";function ge(s,e,t){const r=s.slice();return r[24]=e[t],r}function Ze(s){let e;return{c(){e=C("Home")},m(t,r){k(t,e,r)},d(t){t&&S(e)}}}function de(s){let e,t;return e=new Ae({props:{errorMessage:s[7]}}),{c(){N(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){const o={};n&128&&(o.errorMessage=r[7]),e.$set(o)},i(r){t||(d(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){L(e,r)}}}function He(s){let e;return{c(){e=C("Clear")},m(t,r){k(t,e,r)},d(t){t&&S(e)}}}function Qe(s){let e,t,r,n,o,m;return r=new te({props:{$$slots:{default:[He]},$$scope:{ctx:s}}}),r.$on("click",s[18]),{c(){e=P("input"),t=M(),N(r.$$.fragment),Y(e,"type","text"),Y(e,"class","govuk-input govuk-input--width-10"),Y(e,"id","filterText")},m(l,p){k(l,e,p),_e(e,s[1]),k(l,t,p),A(r,l,p),n=!0,o||(m=Ie(e,"input",s[17]),o=!0)},p(l,p){p&2&&e.value!==l[1]&&_e(e,l[1]);const a={};p&134217728&&(a.$$scope={dirty:p,ctx:l}),r.$set(a)},i(l){n||(d(r.$$.fragment,l),n=!0)},o(l){b(r.$$.fragment,l),n=!1},d(l){l&&(S(e),S(t)),L(r,l),o=!1,m()}}}function Ue(s){let e,t,r,n,o,m,l,p;function a(f){s[15](f)}let _={label:"Authority or region",id:"filterAuthority",choices:s[8]};s[4]!==void 0&&(_.value=s[4]),e=new $e({props:_}),ce.push(()=>me(e,"value",a));function I(f){s[16](f)}let O={label:"Funding programme",id:"filterFundingProgramme",choices:s[9]};return s[5]!==void 0&&(O.value=s[5]),n=new $e({props:O}),ce.push(()=>me(n,"value",I)),l=new Le({props:{label:"Any field",id:"filterText",$$slots:{default:[Qe]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment),r=M(),N(n.$$.fragment),m=M(),N(l.$$.fragment)},m(f,c){A(e,f,c),k(f,r,c),A(n,f,c),k(f,m,c),A(l,f,c),p=!0},p(f,c){const F={};c&256&&(F.choices=f[8]),!t&&c&16&&(t=!0,F.value=f[4],pe(()=>t=!1)),e.$set(F);const j={};c&512&&(j.choices=f[9]),!o&&c&32&&(o=!0,j.value=f[5],pe(()=>o=!1)),n.$set(j);const z={};c&134217730&&(z.$$scope={dirty:c,ctx:f}),l.$set(z)},i(f){p||(d(e.$$.fragment,f),d(n.$$.fragment,f),d(l.$$.fragment,f),p=!0)},o(f){b(e.$$.fragment,f),b(n.$$.fragment,f),b(l.$$.fragment,f),p=!1},d(f){f&&(S(r),S(m)),L(e,f),L(n,f),L(l,f)}}}function he(s){let e,t;return e=new ve({props:{label:`${s[24].scheme_reference}: ${s[24].num_features} features`,$$slots:{default:[We]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,n){const o={};n&1&&(o.label=`${r[24].scheme_reference}: ${r[24].num_features} features`),n&134217729&&(o.$$scope={dirty:n,ctx:r}),e.$set(o)},i(r){t||(d(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){L(e,r)}}}function Ke(s){let e;return{c(){e=C("Show on map")},m(t,r){k(t,e,r)},d(t){t&&S(e)}}}function Ve(s){let e;return{c(){e=C("Edit scheme")},m(t,r){k(t,e,r)},d(t){t&&S(e)}}}function We(s){let e,t,r=s[24].authority_or_region+"",n,o,m,l,p=s[24].capital_scheme_id+"",a,_,I,O,f=s[24].funding_programme+"",c,F,j,z,Z,T,D,G;function H(){return s[19](s[24])}z=new te({props:{$$slots:{default:[Ke]},$$scope:{ctx:s}}}),z.$on("click",H);function K(){return s[20](s[24])}return T=new te({props:{$$slots:{default:[Ve]},$$scope:{ctx:s}}}),T.$on("click",K),{c(){e=P("p"),t=C("Authority or region: "),n=C(r),o=M(),m=P("p"),l=C("Capital scheme ID: "),a=C(p),_=M(),I=P("p"),O=C("Funding programme: "),c=C(f),F=M(),j=P("div"),N(z.$$.fragment),Z=M(),N(T.$$.fragment),D=M(),Y(j,"class","govuk-button-group")},m(w,v){k(w,e,v),$(e,t),$(e,n),k(w,o,v),k(w,m,v),$(m,l),$(m,a),k(w,_,v),k(w,I,v),$(I,O),$(I,c),k(w,F,v),k(w,j,v),A(z,j,null),$(j,Z),A(T,j,null),k(w,D,v),G=!0},p(w,v){s=w,(!G||v&1)&&r!==(r=s[24].authority_or_region+"")&&U(n,r),(!G||v&1)&&p!==(p=s[24].capital_scheme_id+"")&&U(a,p),(!G||v&1)&&f!==(f=s[24].funding_programme+"")&&U(c,f);const Q={};v&134217728&&(Q.$$scope={dirty:v,ctx:s}),z.$set(Q);const i={};v&134217728&&(i.$$scope={dirty:v,ctx:s}),T.$set(i)},i(w){G||(d(z.$$.fragment,w),d(T.$$.fragment,w),G=!0)},o(w){b(z.$$.fragment,w),b(T.$$.fragment,w),G=!1},d(w){w&&(S(e),S(o),S(m),S(_),S(I),S(F),S(j),S(D)),L(z),L(T)}}}function be(s){let e=s[2].has(s[24].scheme_reference),t,r,n=e&&he(s);return{c(){n&&n.c(),t=Oe()},m(o,m){n&&n.m(o,m),k(o,t,m),r=!0},p(o,m){m&5&&(e=o[2].has(o[24].scheme_reference)),e?n?(n.p(o,m),m&5&&d(n,1)):(n=he(o),n.c(),d(n,1),n.m(t.parentNode,t)):n&&(re(),b(n,1,1,()=>{n=null}),ne())},i(o){r||(d(n),r=!0)},o(o){b(n),r=!1},d(o){o&&S(t),n&&n.d(o)}}}function Xe(s){let e,t,r,n,o,m,l,p,a,_,I,O,f,c,F,j=s[2].size+"",z,Z,T=s[3].route+"",D,G,H=s[3].area+"",K,w,v=s[3].crossing+"",Q,i,g=s[3].other+"",q,V,J,x,R;t=new te({props:{$$slots:{default:[Ze]},$$scope:{ctx:s}}}),t.$on("click",s[14]),l=new Ee({props:{boundaryGeojson:s[6]}});let B=s[7]&&de(s);_=new Be({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:s[11]}}),O=new ve({props:{label:"Filters",$$slots:{default:[Ue]},$$scope:{ctx:s}}});let W=fe(s[0]),y=[];for(let u=0;u<W.length;u+=1)y[u]=be(ge(s,W,u));const ye=u=>b(y[u],1,1,()=>{y[u]=null});return{c(){e=P("div"),N(t.$$.fragment),r=M(),n=P("div"),o=P("h1"),o.textContent="Browse schemes",m=M(),N(l.$$.fragment),p=M(),B&&B.c(),a=M(),N(_.$$.fragment),I=M(),N(O.$$.fragment),f=M(),c=P("p"),F=C("Showing "),z=C(j),Z=C(" schemes ("),D=C(T),G=C(" routes, "),K=C(H),w=C(` areas,
      `),Q=C(v),i=C(" crossings, "),q=C(g),V=C(" other)"),J=M(),x=P("ul");for(let u=0;u<y.length;u+=1)y[u].c();ue(n,"display","flex"),ue(n,"justify-content","space-between"),Y(e,"slot","sidebar"),Y(e,"class","govuk-prose")},m(u,h){k(u,e,h),A(t,e,null),$(e,r),$(e,n),$(n,o),$(n,m),A(l,n,null),$(e,p),B&&B.m(e,null),$(e,a),A(_,e,null),$(e,I),A(O,e,null),$(e,f),$(e,c),$(c,F),$(c,z),$(c,Z),$(c,D),$(c,G),$(c,K),$(c,w),$(c,Q),$(c,i),$(c,q),$(c,V),$(e,J),$(e,x);for(let X=0;X<y.length;X+=1)y[X]&&y[X].m(x,null);R=!0},p(u,h){const X={};h&134217728&&(X.$$scope={dirty:h,ctx:u}),t.$set(X);const se={};h&64&&(se.boundaryGeojson=u[6]),l.$set(se),u[7]?B?(B.p(u,h),h&128&&d(B,1)):(B=de(u),B.c(),d(B,1),B.m(e,a)):B&&(re(),b(B,1,1,()=>{B=null}),ne());const oe={};if(h&134218546&&(oe.$$scope={dirty:h,ctx:u}),O.$set(oe),(!R||h&4)&&j!==(j=u[2].size+"")&&U(z,j),(!R||h&8)&&T!==(T=u[3].route+"")&&U(D,T),(!R||h&8)&&H!==(H=u[3].area+"")&&U(K,H),(!R||h&8)&&v!==(v=u[3].crossing+"")&&U(Q,v),(!R||h&8)&&g!==(g=u[3].other+"")&&U(q,g),h&12293){W=fe(u[0]);let E;for(E=0;E<W.length;E+=1){const le=ge(u,W,E);y[E]?(y[E].p(le,h),d(y[E],1)):(y[E]=be(le),y[E].c(),d(y[E],1),y[E].m(x,null))}for(re(),E=W.length;E<y.length;E+=1)ye(E);ne()}},i(u){if(!R){d(t.$$.fragment,u),d(l.$$.fragment,u),d(B),d(_.$$.fragment,u),d(O.$$.fragment,u);for(let h=0;h<W.length;h+=1)d(y[h]);R=!0}},o(u){b(t.$$.fragment,u),b(l.$$.fragment,u),b(B),b(_.$$.fragment,u),b(O.$$.fragment,u),y=y.filter(Boolean);for(let h=0;h<y.length;h+=1)b(y[h]);R=!1},d(u){u&&S(e),L(t),L(l),B&&B.d(),L(_),L(O),Me(y,u)}}}function Ye(s){let e,t,r,n,o,m,l,p;return e=new Je({props:{schema:we}}),r=new Pe({props:{style:s[10]}}),o=new qe({props:{schema:we}}),l=new De({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:tt}}),{c(){N(e.$$.fragment),t=M(),N(r.$$.fragment),n=M(),N(o.$$.fragment),m=M(),N(l.$$.fragment)},m(a,_){A(e,a,_),k(a,t,_),A(r,a,_),k(a,n,_),A(o,a,_),k(a,m,_),A(l,a,_),p=!0},p:ze,i(a){p||(d(e.$$.fragment,a),d(r.$$.fragment,a),d(o.$$.fragment,a),d(l.$$.fragment,a),p=!0)},o(a){b(e.$$.fragment,a),b(r.$$.fragment,a),b(o.$$.fragment,a),b(l.$$.fragment,a),p=!1},d(a){a&&(S(t),S(n),S(m)),L(e,a),L(r,a),L(o,a),L(l,a)}}}function xe(s){let e,t,r;return t=new Ge({props:{style:s[10],$$slots:{default:[Ye]},$$scope:{ctx:s}}}),{c(){e=P("div"),N(t.$$.fragment),Y(e,"slot","main")},m(n,o){k(n,e,o),A(t,e,null),r=!0},p(n,o){const m={};o&134217728&&(m.$$scope={dirty:o,ctx:n}),t.$set(m)},i(n){r||(d(t.$$.fragment,n),r=!0)},o(n){b(t.$$.fragment,n),r=!1},d(n){n&&S(e),L(t)}}}function et(s){let e,t;return e=new Te({props:{$$slots:{main:[xe],sidebar:[Xe]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},m(r,n){A(e,r,n),t=!0},p(r,[n]){const o={};n&134218751&&(o.$$scope={dirty:n,ctx:r}),e.$set(o)},i(r){t||(d(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){L(e,r)}}}const we="v1";function tt(s){var e="<table>";for(let[t,r]of Object.entries(s))e+=`<tr><td>${t}</td><td>${r}</td></tr>`;return e+="</table>",e}function rt(s,e,t){let r,n;ae(s,ee,i=>t(6,r=i)),ae(s,Re,i=>t(21,n=i)),Fe(()=>{Ne()});let m=new URLSearchParams(window.location.search).get("style")||"streets",l="",p=[],a="",_=new Set,I={area:0,route:0,crossing:0,other:0},O=[],f="",c=[],F="";je(()=>{ee.set(null)});function j(i){try{let g=JSON.parse(i);ee.set(g),z(g),t(7,l=""),n==null||n.fitBounds(ie(g),{padding:20,animate:!1})}catch(g){t(7,l=`Couldn't load schemes from a file: ${g}`)}}function z(i){let g={};for(let[J,x]of Object.entries(i.schemes))g[J]={scheme_reference:J,num_features:0,...x};for(let J of i.features)g[J.properties.scheme_reference].num_features++;t(0,p=Object.values(g));let q=new Set,V=new Set;for(let J of p)J.authority_or_region&&q.add(J.authority_or_region),J.funding_programme&&V.add(J.funding_programme);t(8,O=Array.from(q.entries())),O.sort(),t(9,c=Array.from(V.entries())),c.sort()}function Z(i){let g={type:"FeatureCollection",features:r.features.filter(q=>q.properties.scheme_reference==i.scheme_reference)};n==null||n.fitBounds(ie(g),{padding:20,animate:!1})}function T(i){let g={type:"FeatureCollection",features:r.features.filter(V=>V.properties.scheme_reference==i.scheme_reference)},q=i.authority_or_region;window.localStorage.setItem(q,JSON.stringify(g)),window.open(`scheme.html?authority=${i.authority_or_region}`,"_blank")}const D=()=>window.open("index.html");function G(i){f=i,t(4,f)}function H(i){F=i,t(5,F)}function K(){a=this.value,t(1,a)}const w=()=>t(1,a=""),v=i=>Z(i),Q=i=>T(i);return s.$$.update=()=>{if(s.$$.dirty&127&&r){if(_.clear(),a||f||F){let i=a.toLowerCase();for(let g of r.features)JSON.stringify(g.properties).toLowerCase().includes(i)&&(f&&g.properties.authority_or_region!=f||F&&g.properties.funding_programme!=F||_.add(g.properties.scheme_reference))}else for(let i of p)_.add(i.scheme_reference);ee.update(i=>{if(!i)return null;for(let g of i.features)_.has(g.properties.scheme_reference)?delete g.properties.hide_while_editing:g.properties.hide_while_editing=!0;return i}),t(3,I={area:0,route:0,crossing:0,other:0});for(let i of r==null?void 0:r.features)_.has(i.properties.scheme_reference)&&t(3,I[i.properties.intervention_type]++,I);t(2,_),t(6,r),t(1,a),t(4,f),t(5,F),t(0,p),t(3,I)}},[p,a,_,I,f,F,r,l,O,c,m,j,Z,T,D,G,H,K,w,v,Q]}class nt extends ke{constructor(e){super(),Se(this,e,rt,et,Ce,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new nt({target:document.getElementById("app")});
