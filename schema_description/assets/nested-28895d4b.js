var si=Object.defineProperty;var li=(r,e,t)=>e in r?si(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ee=(r,e,t)=>(li(r,typeof e!="symbol"?e+"":e,t),t);import{S as Z,i as Q,s as K,M as ai,b as re,a as Le,d as Y,m as H,k as xe,n as T,o as A,q as U,e as k,c as C,g as S,x as G,p as E,y as De,f as x,z as ve,B as ye,C as ui,D as Sn,E as tn,F as Et,G as ht,H as dt,I as mt,J as _t,K as Fn,h as w,l as B,L as fi,N as ci,O as ie,P as pi,w as En,Q as Ze,R as be,T as Xt,t as z,U as ge,V as ae,j as Te,r as Ce,W as Ke,X as xr,Y as Cr,Z as zt,_ as Nt,$ as Nn,a0 as $n,a1 as hi,a2 as di,a3 as Fe,a4 as mi,a5 as _i,a6 as gi,a7 as $t,a8 as Tr,a9 as Wt,aa as ut,ab as Vt,ac as wt,ad as Kt,ae as an,af as vi,ag as st,ah as Mn,ai as ze,aj as lt,ak as yi,al as On,am as bi,an as wi,ao as ki,ap as In,aq as It,ar as Si,as as Ei,at as Mi,A as Oi,u as Li}from"./authorities-af3bfe53.js";function xi(r){let e,t,n,i,o,s,a,l,u,c,g,p,f;return{c(){e=k("p"),e.textContent="For each intervention:",t=C(),n=k("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=C(),o=k("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=C(),a=k("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=C(),u=k("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,c=C(),g=k("p"),g.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,p=C(),f=k("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(h,d){S(h,e,d),S(h,t,d),S(h,n,d),S(h,i,d),S(h,o,d),S(h,s,d),S(h,a,d),S(h,l,d),S(h,u,d),S(h,c,d),S(h,g,d),S(h,p,d),S(h,f,d)},p:G,d(h){h&&E(e),h&&E(t),h&&E(n),h&&E(i),h&&E(o),h&&E(s),h&&E(a),h&&E(l),h&&E(u),h&&E(c),h&&E(g),h&&E(p),h&&E(f)}}}function Ci(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[xi]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new ai({props:o}),re.push(()=>Le(e,"open",i,r[0])),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],xe(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Ti(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Ri extends Z{constructor(e){super(),Q(this,e,Ti,Ci,K,{open:0})}}const Qe=[];function ft(r,e=G){let t;const n=new Set;function i(a){if(K(r,a)&&(r=a,t)){const l=!Qe.length;for(const u of n)u[1](),Qe.push(u,r);if(l){for(let u=0;u<Qe.length;u+=2)Qe[u][0](Qe[u+1]);Qe.length=0}}}function o(a){i(a(r))}function s(a,l=G){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||G),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const qe=ft(null),te=ft(De()),Oe=ft(null),Ye=ft(null),Bt=ft(null),un=ft(null);function Mt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Bn(r){te.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Oe.set(null),Ye.set(null),Bt.set(null)}function Dn(r){let e;const t=r[4].default,n=ht(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&dt(n,t,i,i[3],e?_t(t,i[3],o,null):mt(i[3]),null)},i(i){e||(T(n,i),e=!0)},o(i){A(n,i),e=!1},d(i){n&&n.d(i)}}}function Ai(r){let e,t,n=r[1]&&Dn(r);return{c(){e=k("div"),n&&n.c(),x(e,"class","map svelte-12dpf1u")},m(i,o){S(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&T(n,1)):(n=Dn(i),n.c(),T(n,1),n.m(e,null)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(T(n),t=!0)},o(i){A(n),t=!1},d(i){i&&E(e),n&&n.d(),r[5](null)}}}function Pi(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;ui("setCamera",!window.location.hash),Sn(()=>{s=new tn.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new tn.ScaleControl({})),s.addControl(new tn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),qe.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),Et(()=>{s.remove()});function u(c){re[c?"unshift":"push"](()=>{a=c,t(0,a)})}return r.$$set=c=>{"style"in c&&t(2,o=c.style),"$$scope"in c&&t(3,i=c.$$scope)},[a,l,o,i,n,u]}class Fi extends Z{constructor(e){super(),Q(this,e,Pi,Ai,K,{style:2})}}const Ni=r=>({}),qn=r=>({}),$i=r=>({}),Gn=r=>({}),Ii=r=>({}),jn=r=>({});function Bi(r){let e,t,n,i,o,s,a,l,u,c,g,p;const f=r[3].nav,h=ht(f,r,r[2],jn),d=r[3].sidebar,_=ht(d,r,r[2],Gn),b=r[3].main,m=ht(b,r,r[2],qn);return{c(){e=k("aside"),t=k("div"),n=k("nav"),h&&h.c(),i=C(),_&&_.c(),o=C(),s=k("button"),s.textContent="→",l=C(),u=k("main"),m&&m.c(),x(n,"class","svelte-1u7vg8a"),x(t,"class","sidebar-content content-container svelte-1u7vg8a"),x(s,"type","button"),x(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),x(e,"class",a=Fn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),x(u,"class","svelte-1u7vg8a")},m(v,y){S(v,e,y),w(e,t),w(t,n),h&&h.m(n,null),w(t,i),_&&_.m(t,null),w(e,o),w(e,s),S(v,l,y),S(v,u,y),m&&m.m(u,null),c=!0,g||(p=B(s,"click",r[1]),g=!0)},p(v,[y]){h&&h.p&&(!c||y&4)&&dt(h,f,v,v[2],c?_t(f,v[2],y,Ii):mt(v[2]),jn),_&&_.p&&(!c||y&4)&&dt(_,d,v,v[2],c?_t(d,v[2],y,$i):mt(v[2]),Gn),(!c||y&1&&a!==(a=Fn(v[0]?"":"collapsed")+" svelte-1u7vg8a"))&&x(e,"class",a),m&&m.p&&(!c||y&4)&&dt(m,b,v,v[2],c?_t(b,v[2],y,Ni):mt(v[2]),qn)},i(v){c||(T(h,v),T(_,v),T(m,v),c=!0)},o(v){A(h,v),A(_,v),A(m,v),c=!1},d(v){v&&E(e),h&&h.d(v),_&&_.d(v),v&&E(l),v&&E(u),m&&m.d(v),g=!1,p()}}}function Di(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class qi extends Z{constructor(e){super(),Q(this,e,Di,Bi,K,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Gi(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(c){u=[6,c],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ve=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function ji(r,e){return r>e?1:r<e?-1:0}function He(r,e,t){for(var n=new Ve(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function nn(r,e,t,n){var i=new Ve(r,e);if(t===null)return i.left=i.right=null,i;t=He(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Yn(r,e,t){var n=null,i=null;if(e){e=He(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Yi(r,e,t){return e===null?r:(r===null||(e=He(r.key,e,t),e.left=r),e)}function fn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&fn(r.left,o,!1,n,i),r.right&&fn(r.right,o,!0,n,i)}}var Ln=function(){function r(e){e===void 0&&(e=ji),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=nn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ve(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=He(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=He(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=He(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=He(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=He(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Ui(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&hn(e,t,0,i-1,o),this._root===null)this._root=cn(e,t,0,i),this._size=i;else{var s=Ji(this.toList(),Hi(e,t),o);i=this._size+i,this._root=pn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return fn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Yn(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=nn(t,n,a,i):s=nn(t,n,s,i),this._root=Yi(s,a,i)},r.prototype.split=function(e){return Yn(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Gi(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function cn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ve(s,a);return l.left=cn(r,e,t,o),l.right=cn(r,e,o+1,n),l}return null}function Hi(r,e){for(var t=new Ve(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ve(r[i],e[i]);return n.next=null,t.next}function Ui(r){for(var e=r,t=[],n=!1,i=new Ve(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function pn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=pn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=pn(r,i+1,t),s}return null}function Ji(r,e,t){for(var n=new Ve(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function hn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}hn(r,e,t,a,i),hn(r,e,a+1,n,i)}}function Re(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Hn(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function we(r,e,t){return e&&Hn(r.prototype,e),t&&Hn(r,t),r}var ct=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},dn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Je=Number.EPSILON;Je===void 0&&(Je=Math.pow(2,-52));var Xi=Je*Je,mn=function(e,t){if(-Je<e&&e<Je&&-Je<t&&t<Je)return 0;var n=e-t;return n*n<Xi*e*t?0:e<t?-1:1},zi=function(){function r(){Re(this,r),this.reset()}return we(r,[{key:"reset",value:function(){this.xRounder=new Un,this.yRounder=new Un}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Un=function(){function r(){Re(this,r),this.tree=new Ln,this.round(0)}return we(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&mn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&mn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),kt=new zi,gt=function(e,t){return e.x*t.y-e.y*t.x},Rr=function(e,t){return e.x*t.x+e.y*t.y},Jn=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=gt(i,o);return mn(s,0)},Dt=function(e){return Math.sqrt(Rr(e,e))},Wi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return gt(o,i)/Dt(o)/Dt(i)},Vi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Rr(o,i)/Dt(o)/Dt(i)},Xn=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},zn=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},Ki=function(e,t,n,i){if(t.x===0)return zn(n,i,e.x);if(i.x===0)return zn(e,t,n.x);if(t.y===0)return Xn(n,i,e.y);if(i.y===0)return Xn(e,t,n.y);var o=gt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=gt(s,t)/o,l=gt(s,i)/o,u=e.x+l*t.x,c=n.x+a*i.x,g=e.y+l*t.y,p=n.y+a*i.y,f=(u+c)/2,h=(g+p)/2;return{x:f,y:h}},Ie=function(){we(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:qt.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Re(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return we(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:Wi(n.point,t.point,l.point),cosine:Vi(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,c=l.cosine,g=i.get(a),p=g.sine,f=g.cosine;return u>=0&&p>=0?c<f?1:c>f?-1:0:u<0&&p<0?c<f?-1:c>f?1:0:p<u?-1:p>u?1:0}}}]),r}(),Zi=0,qt=function(){we(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,c=t.rightSE.point.y,g=n.rightSE.point.y;if(i<o){if(u<l&&u<c)return 1;if(u>l&&u>c)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<g)return-1;if(l>u&&l>g)return 1;var h=n.comparePoint(t.leftSE.point);if(h!==0)return h;var d=t.comparePoint(n.rightSE.point);return d<0?1:d>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>a){var b=t.comparePoint(n.rightSE.point);if(b<0)return 1;if(b>0)return-1}if(s!==a){var m=c-l,v=s-i,y=g-u,M=a-o;if(m>v&&y<M)return 1;if(m<v&&y>M)return-1}return s>a?1:s<a||c<g?-1:c>g?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Re(this,r),this.id=++Zi,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return we(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=dn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,c=ct(n,l)&&this.comparePoint(l)===0,g=ct(i,s)&&t.comparePoint(s)===0,p=ct(n,u)&&this.comparePoint(u)===0,f=ct(i,a)&&t.comparePoint(a)===0;if(g&&c)return f&&!p?a:!f&&p?u:null;if(g)return p&&s.x===u.x&&s.y===u.y?null:s;if(c)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&p)return null;if(f)return a;if(p)return u;var h=Ki(s,this.vector(),l,t.vector());return h===null||!ct(o,h)?null:kt.round(h.x,h.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Ie(t,!0),s=new Ie(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Ie.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ie.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var c=i.rings[l],g=i.windings[l],p=n.rings.indexOf(c);p===-1?(n.rings.push(c),n.windings.push(g)):n.windings[p]+=g}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],c=n.indexOf(l);c===-1?(n.push(l),i.push(u)):i[c]+=u}for(var g=[],p=[],f=0,h=n.length;f<h;f++)if(i[f]!==0){var d=n[f],_=d.poly;if(p.indexOf(_)===-1)if(d.isExterior)g.push(_);else{p.indexOf(_)===-1&&p.push(_);var b=g.indexOf(d.poly);b!==-1&&g.splice(b,1)}}for(var m=0,v=g.length;m<v;m++){var y=g[m].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ne.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Ne.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(g){return g.length===1&&g[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ne.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Ie.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Ie(o,!0),c=new Ie(s,!1);return new r(u,c,[i],[a])}}]),r}(),Wn=function(){function r(e,t,n){if(Re(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=kt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=kt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(qt.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(qt.fromRing(o,i,this))}return we(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),Qi=function(){function r(e,t){if(Re(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Wn(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Wn(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return we(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Vn=function(){function r(e,t){if(Re(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new Qi(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return we(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),eo=function(){we(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,c=[l],g=l.point,p=[];a=l,l=u,c.push(l),l.point!==g;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var h=c[0].point,d=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var _=null,b=0,m=p.length;b<m;b++)if(p[b].point===l.point){_=b;break}if(_!==null){var v=p.splice(_)[0],y=c.splice(v.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}p.push({index:c.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(c))}}return n}}]);function r(e){Re(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return we(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Jn(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Jn(l,t,u)===0&&n.shift(),n.push(n[0]);for(var c=this.isExteriorRing()?1:-1,g=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,f=[],h=g;h!=p;h+=c)f.push([n[h].x,n[h].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Ie.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Kn=function(){function r(e){Re(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return we(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),to=function(){function r(e){Re(this,r),this.rings=e,this.polys=this._composePolys(e)}return we(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Kn(s));else{var a=s.enclosingRing();a.poly||n.push(new Kn(a)),a.poly.addInterior(s)}}return n}}]),r}(),no=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qt.compare;Re(this,r),this.queue=e,this.tree=new Ln(t),this.segments=[]}return we(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var c=null;if(l){var g=l.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(c=g),!l.isAnEndpoint(g)))for(var p=this._splitSafely(l,g),f=0,h=p.length;f<h;f++)i.push(p[f])}var d=null;if(u){var _=u.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(d=_),!u.isAnEndpoint(_)))for(var b=this._splitSafely(u,_),m=0,v=b.length;m<v;m++)i.push(b[m])}if(c!==null||d!==null){var y=null;if(c===null)y=d;else if(d===null)y=c;else{var M=Ie.comparePoints(c,d);y=M<=0?c:d}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var O=n.split(y),R=0,L=O.length;R<L;R++)i.push(O[R])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var N=l.getIntersection(u);if(N!==null){if(!l.isAnEndpoint(N))for(var I=this._splitSafely(l,N),$=0,W=I.length;$<W;$++)i.push(I[$]);if(!u.isAnEndpoint(N))for(var P=this._splitSafely(u,N),D=0,oe=P.length;D<oe;D++)i.push(P[D])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Zn=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ro=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,io=function(){function r(){Re(this,r)}return we(r,[{key:"run",value:function(t,n,i){Ne.type=t,kt.reset();for(var o=[new Vn(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Vn(i[s],!1));if(Ne.numMultiPolys=o.length,Ne.type==="difference")for(var l=o[0],u=1;u<o.length;)dn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Ne.type==="intersection"){for(var c=0,g=o.length;c<g;c++)for(var p=o[c],f=c+1,h=o.length;f<h;f++)if(dn(p.bbox,o[f].bbox)===null)return[]}for(var d=new Ln(Ie.compare),_=0,b=o.length;_<b;_++)for(var m=o[_].getSweepEvents(),v=0,y=m.length;v<y;v++)if(d.insert(m[v]),d.size>Zn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new no(d),O=d.size,R=d.pop();R;){var L=R.key;if(d.size===O){var N=L.segment;throw new Error("Unable to pop() ".concat(L.isLeft?"left":"right"," SweepEvent ")+"[".concat(L.point.x,", ").concat(L.point.y,"] from segment #").concat(N.id," ")+"[".concat(N.leftSE.point.x,", ").concat(N.leftSE.point.y,"] -> ")+"[".concat(N.rightSE.point.x,", ").concat(N.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(d.size>Zn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>ro)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var I=M.process(L),$=0,W=I.length;$<W;$++){var P=I[$];P.consumedBy===void 0&&d.insert(P)}O=d.size,R=d.pop()}kt.reset();var D=eo.factory(M.segments),oe=new to(D);return oe.getGeom()}}]),r}(),Ne=new io,oo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ne.run("union",e,n)},so=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ne.run("intersection",e,n)},lo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ne.run("xor",e,n)},ao=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ne.run("difference",e,n)},Ct={union:oo,intersection:so,xor:lo,difference:ao};function uo(r,e){var t=co(e),n=null;return r.type==="FeatureCollection"?n=fo(r):n=Ar(Ct.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function fo(r){var e=r.features.length===2?Ct.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Ct.union.apply(Ct,r.features.map(function(t){return t.geometry.coordinates}));return Ar(e)}function Ar(r){return fi(r)}function co(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return ci(t)}function po(r,e,t){let n;ie(r,qe,s=>t(1,n=s));let{boundaryGeojson:i}=e;return pi("setCamera")&&n.fitBounds(En(i),{padding:20,animate:!1}),Ze(n,"boundary",{type:"geojson",data:uo(i)}),be(n,{id:"boundary",source:"boundary",...Xt("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class ho extends Z{constructor(e){super(),Q(this,e,po,null,K,{boundaryGeojson:0})}}function Qn(r){let e,t=er(r[3])+"",n;return{c(){e=z("Length: "),n=z(t)},m(i,o){S(i,e,o),S(i,n,o)},p(i,o){o&8&&t!==(t=er(i[3])+"")&&Ke(n,t)},d(i){i&&E(e),i&&E(n)}}}function mo(r){let e,t,n,i,o,s,a,l,u,c,g,p,f,h,d,_,b,m,v,y,M,O,R,L,N,I,$,W,P,D,oe,fe,q,se,ke,Ae,pe,ce,Pe,ne=r[3]&&Qn(r);return{c(){e=k("label"),t=z("Name:"),n=k("br"),i=C(),o=k("input"),s=C(),a=k("br"),l=C(),u=k("br"),c=C(),g=k("label"),p=k("input"),f=z(`
  Area`),h=C(),d=k("label"),_=k("input"),b=z(`
  Route`),m=C(),v=k("label"),y=k("input"),M=z(`
  Crossing`),O=C(),R=k("label"),L=k("input"),N=z(`
  Other`),I=C(),$=k("br"),W=C(),P=k("br"),D=C(),oe=k("label"),fe=z("Description:"),q=k("br"),se=C(),ke=k("textarea"),Ae=C(),ne&&ne.c(),pe=ge(),x(o,"type","text"),ae(o,"width","100%"),x(p,"type","radio"),p.__value="area",p.value=p.__value,r[6][0].push(p),x(_,"type","radio"),_.__value="route",_.value=_.__value,r[6][0].push(_),x(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[6][0].push(y),x(L,"type","radio"),L.__value="other",L.value=L.__value,r[6][0].push(L),ae(ke,"width","100%"),x(ke,"rows","5"),x(ke,"class","svelte-15lna0i")},m(F,V){S(F,e,V),w(e,t),w(e,n),w(e,i),w(e,o),Te(o,r[0]),S(F,s,V),S(F,a,V),S(F,l,V),S(F,u,V),S(F,c,V),S(F,g,V),w(g,p),p.checked=p.__value===r[1],w(g,f),S(F,h,V),S(F,d,V),w(d,_),_.checked=_.__value===r[1],w(d,b),S(F,m,V),S(F,v,V),w(v,y),y.checked=y.__value===r[1],w(v,M),S(F,O,V),S(F,R,V),w(R,L),L.checked=L.__value===r[1],w(R,N),S(F,I,V),S(F,$,V),S(F,W,V),S(F,P,V),S(F,D,V),S(F,oe,V),w(oe,fe),w(oe,q),w(oe,se),w(oe,ke),Te(ke,r[2]),S(F,Ae,V),ne&&ne.m(F,V),S(F,pe,V),ce||(Pe=[B(o,"input",r[4]),B(p,"change",r[5]),B(_,"change",r[7]),B(y,"change",r[8]),B(L,"change",r[9]),B(ke,"input",r[10])],ce=!0)},p(F,[V]){V&1&&o.value!==F[0]&&Te(o,F[0]),V&2&&(p.checked=p.__value===F[1]),V&2&&(_.checked=_.__value===F[1]),V&2&&(y.checked=y.__value===F[1]),V&2&&(L.checked=L.__value===F[1]),V&4&&Te(ke,F[2]),F[3]?ne?ne.p(F,V):(ne=Qn(F),ne.c(),ne.m(pe.parentNode,pe)):ne&&(ne.d(1),ne=null)},i:G,o:G,d(F){F&&E(e),F&&E(s),F&&E(a),F&&E(l),F&&E(u),F&&E(c),F&&E(g),r[6][0].splice(r[6][0].indexOf(p),1),F&&E(h),F&&E(d),r[6][0].splice(r[6][0].indexOf(_),1),F&&E(m),F&&E(v),r[6][0].splice(r[6][0].indexOf(y),1),F&&E(O),F&&E(R),r[6][0].splice(r[6][0].indexOf(L),1),F&&E(I),F&&E($),F&&E(W),F&&E(P),F&&E(D),F&&E(oe),F&&E(Ae),ne&&ne.d(F),F&&E(pe),ce=!1,Ce(Pe)}}}function er(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function _o(r,e,t){let{name:n}=e,{intervention_type:i}=e,{description:o}=e,{length_meters:s}=e;const a=[[]];function l(){n=this.value,t(0,n)}function u(){i=this.__value,t(1,i)}function c(){i=this.__value,t(1,i)}function g(){i=this.__value,t(1,i)}function p(){i=this.__value,t(1,i)}function f(){o=this.value,t(2,o)}return r.$$set=h=>{"name"in h&&t(0,n=h.name),"intervention_type"in h&&t(1,i=h.intervention_type),"description"in h&&t(2,o=h.description),"length_meters"in h&&t(3,s=h.length_meters)},[n,i,o,s,l,u,a,c,g,p,f]}class go extends Z{constructor(e){super(),Q(this,e,_o,mo,K,{name:0,intervention_type:1,description:2,length_meters:3})}}const vo="Intervention",yo=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],bo={name:vo,oneOf:yo};function wo(r){const e=r-1;return e*e*e+1}function Gt(r,{delay:e=0,duration:t=400,easing:n=wo}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),c=parseFloat(i.marginBottom),g=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*c}px;border-top-width: ${f*g}px;border-bottom-width: ${f*p}px;`}}function Pr(r){return"members"in r}function Fr(r){return"oneOf"in r}function Nr(r){return typeof r=="string"}function $r(r){return typeof r=="object"&&"value"in r}function ko(r){return"type"in r&&r.type=="number"}function Ir(r){return"type"in r&&r.type=="one-liner"}function Br(r){return"type"in r&&r.type=="textbox"}function Dr(r){return"type"in r&&r.type=="checkbox"}function tr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function nr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function So(r){let e,t,n;return{c(){e=k("input"),x(e,"type","checkbox")},m(i,o){S(i,e,o),e.checked=r[0],t||(n=B(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:G,o:G,d(i){i&&E(e),t=!1,n()}}}function Eo(r){let e,t,n;return{c(){e=k("textarea"),ae(e,"width","100%"),x(e,"rows","5"),x(e,"class","svelte-9loriq")},m(i,o){S(i,e,o),Te(e,r[0]),t||(n=B(e,"input",r[13]),t=!0)},p(i,o){o&1&&Te(e,i[0])},i:G,o:G,d(i){i&&E(e),t=!1,n()}}}function Mo(r){let e,t,n;return{c(){e=k("input"),x(e,"type","text"),ae(e,"width","100%")},m(i,o){S(i,e,o),Te(e,r[0]),t||(n=B(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Te(e,i[0])},i:G,o:G,d(i){i&&E(e),t=!1,n()}}}function Oo(r){let e,t,n;return{c(){e=k("input"),x(e,"type","number")},m(i,o){S(i,e,o),Te(e,r[0]),t||(n=B(e,"input",r[11]),t=!0)},p(i,o){o&1&&xr(e.value)!==i[0]&&Te(e,i[0])},i:G,o:G,d(i){i&&E(e),t=!1,n()}}}function Lo(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=ir(tr(r,n,s));const o=s=>A(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);S(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=tr(s,n,l);i[l]?(i[l].p(u,a),T(i[l],1)):(i[l]=ir(u),i[l].c(),T(i[l],1),i[l].m(e.parentNode,e))}for(ve(),l=n.length;l<i.length;l+=1)o(l);ye()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)T(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)A(i[a]);t=!1},d(s){Cr(i,s),s&&E(e)}}}function xo(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=or(nr(r,n,s));const o=s=>A(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);S(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=nr(s,n,l);i[l]?(i[l].p(u,a),T(i[l],1)):(i[l]=or(u),i[l].c(),T(i[l],1),i[l].m(e.parentNode,e))}for(ve(),l=n.length;l<i.length;l+=1)o(l);ye()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)T(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)A(i[a]);t=!1},d(s){Cr(i,s),s&&E(e)}}}function Co(r){let e,t,n;return{c(){e=k("h1"),t=z("Error: Field component instantiated for plain string, why? "),n=z(r[1])},m(i,o){S(i,e,o),w(e,t),w(e,n)},p(i,o){o&2&&Ke(n,i[1])},i:G,o:G,d(i){i&&E(e)}}}function To(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,c,g,p,f=r[2]==r[15].name&&typeof r[0]=="object"&&rr(r);return{c(){e=k("label"),t=k("input"),i=C(),s=z(o),a=k("br"),l=C(),f&&f.c(),u=ge(),x(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(h,d){S(h,e,d),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),S(h,l,d),f&&f.m(h,d),S(h,u,d),c=!0,g||(p=[B(t,"change",r[9]),B(t,"change",r[4])],g=!0)},p(h,d){(!c||d&2&&n!==(n=h[15].name))&&(t.__value=n,t.value=t.__value),d&4&&(t.checked=t.__value===h[2]),(!c||d&2)&&o!==(o=h[15].name+"")&&Ke(s,o),h[2]==h[15].name&&typeof h[0]=="object"?f?(f.p(h,d),d&7&&T(f,1)):(f=rr(h),f.c(),T(f,1),f.m(u.parentNode,u)):f&&(ve(),A(f,1,1,()=>{f=null}),ye())},i(h){c||(T(f),c=!0)},o(h){A(f),c=!1},d(h){h&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),h&&E(l),f&&f.d(h),h&&E(u),g=!1,Ce(p)}}}function Ro(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,c;return{c(){e=k("label"),t=k("input"),i=C(),s=z(o),a=k("br"),l=C(),x(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(g,p){S(g,e,p),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),w(e,l),u||(c=[B(t,"change",r[8]),B(t,"change",r[3])],u=!0)},p(g,p){p&2&&n!==(n=g[15].value)&&(t.__value=n,t.value=t.__value),p&4&&(t.checked=t.__value===g[2]),p&2&&o!==(o=g[15].value+"")&&Ke(s,o)},i:G,o:G,d(g){g&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),u=!1,Ce(c)}}}function Ao(r){let e,t,n,i,o=r[15]+"",s,a,l,u,c;return{c(){e=k("label"),t=k("input"),i=C(),s=z(o),a=k("br"),l=C(),x(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(g,p){S(g,e,p),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),w(e,l),u||(c=[B(t,"change",r[6]),B(t,"change",r[3])],u=!0)},p(g,p){p&2&&n!==(n=g[15])&&(t.__value=n,t.value=t.__value),p&4&&(t.checked=t.__value===g[2]),p&2&&o!==(o=g[15]+"")&&Ke(s,o)},i:G,o:G,d(g){g&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),u=!1,Ce(c)}}}function rr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Zt({props:l}),re.push(()=>Le(t,"value",a,r[0][r[15].name])),{c(){e=k("div"),Y(t.$$.fragment),i=C(),x(e,"class","svelte-9loriq")},m(u,c){S(u,e,c),H(t,e,null),w(e,i),s=!0},p(u,c){r=u;const g={};c&2&&(g.spec=r[15]),!n&&c&3&&(n=!0,g.value=r[0][r[15].name],xe(()=>n=!1)),t.$set(g)},i(u){s||(T(t.$$.fragment,u),zt(()=>{o||(o=Nt(e,Gt,{duration:500},!0)),o.run(1)}),s=!0)},o(u){A(t.$$.fragment,u),o||(o=Nt(e,Gt,{duration:500},!1)),o.run(0),s=!1},d(u){u&&E(e),U(t),u&&o&&o.end()}}}function ir(r){let e,t,n,i,o,s;const a=[Ao,Ro,To],l=[];function u(c,g){return g&2&&(e=null),g&2&&(t=null),e==null&&(e=!!Nr(c[15])),e?0:(t==null&&(t=!!$r(c[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=ge()},m(c,g){l[n].m(c,g),S(c,o,g),s=!0},p(c,g){let p=n;n=u(c,g),n===p?l[n].p(c,g):(ve(),A(l[p],1,1,()=>{l[p]=null}),ye(),i=l[n],i?i.p(c,g):(i=l[n]=a[n](c),i.c()),T(i,1),i.m(o.parentNode,o))},i(c){s||(T(i),s=!0)},o(c){A(i),s=!1},d(c){l[n].d(c),c&&E(o)}}}function or(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function c(p){r[5](p,r[15])}let g={spec:r[15]};return r[0][r[15].name]!==void 0&&(g.value=r[0][r[15].name]),s=new Zt({props:g}),re.push(()=>Le(s,"value",c,r[0][r[15].name])),{c(){e=k("div"),t=k("h3"),i=z(n),o=C(),Y(s.$$.fragment),l=C(),x(e,"class","svelte-9loriq")},m(p,f){S(p,e,f),w(e,t),w(t,i),w(e,o),H(s,e,null),w(e,l),u=!0},p(p,f){r=p,(!u||f&2)&&n!==(n=r[15].name+"")&&Ke(i,n);const h={};f&2&&(h.spec=r[15]),!a&&f&3&&(a=!0,h.value=r[0][r[15].name],xe(()=>a=!1)),s.$set(h)},i(p){u||(T(s.$$.fragment,p),u=!0)},o(p){A(s.$$.fragment,p),u=!1},d(p){p&&E(e),U(s)}}}function Po(r){let e,t,n,i,o,s,a,l,u,c;const g=[Co,xo,Lo,Oo,Mo,Eo,So],p=[];function f(h,d){return d&2&&(e=null),d&2&&(t=null),d&2&&(n=null),d&2&&(i=null),d&2&&(o=null),d&2&&(s=null),typeof h[1]=="string"?0:(e==null&&(e=!!Pr(h[1])),e?1:(t==null&&(t=!!Fr(h[1])),t?2:(n==null&&(n=!!ko(h[1])),n?3:(i==null&&(i=!!Ir(h[1])),i?4:(o==null&&(o=!!Br(h[1])),o?5:(s==null&&(s=!!Dr(h[1])),s?6:-1))))))}return~(a=f(r,-1))&&(l=p[a]=g[a](r)),{c(){l&&l.c(),u=ge()},m(h,d){~a&&p[a].m(h,d),S(h,u,d),c=!0},p(h,[d]){let _=a;a=f(h,d),a===_?~a&&p[a].p(h,d):(l&&(ve(),A(p[_],1,1,()=>{p[_]=null}),ye()),~a?(l=p[a],l?l.p(h,d):(l=p[a]=g[a](h),l.c()),T(l,1),l.m(u.parentNode,u)):l=null)},i(h){c||(T(l),c=!0)},o(h){A(l),c=!1},d(h){~a&&p[a].d(h),h&&E(u)}}}function Fo(r,e,t){var m,v,y;let{spec:n}=e,{value:i}=e,o="";if(Pr(n)){i||(i={});for(let M of n.members)Ir(M)||Br(M)?i[m=M.name]||(i[m]=""):Dr(M)?i[v=M.name]||(i[v]=!1):i[y=M.name]||(i[y]={})}else Fr(n)&&(i||(i={}),Nr(i)?o=i:$r(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,O){r.$$.not_equal(i[O.name],M)&&(i[O.name]=M,t(0,i))}function c(){o=this.__value,t(2,o)}function g(){o=this.__value,t(2,o)}function p(){o=this.__value,t(2,o)}function f(M,O){r.$$.not_equal(i[O.name],M)&&(i[O.name]=M,t(0,i))}function h(){i=xr(this.value),t(0,i)}function d(){i=this.value,t(0,i)}function _(){i=this.value,t(0,i)}function b(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,c,l,g,p,f,h,d,_,b]}class Zt extends Z{constructor(e){super(),Q(this,e,Fo,Po,K,{spec:1,value:0})}}function No(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Zt({props:o}),re.push(()=>Le(e,"value",i,r[0].v2)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,xe(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function $o(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=bo;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Io extends Z{constructor(e){super(),Q(this,e,$o,No,K,{props:0})}}const Bo="Planning",Do=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],qo={name:Bo,members:Do};function Go(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Zt({props:o}),re.push(()=>Le(e,"value",i,r[0].planning)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,xe(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function jo(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=qo;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Yo extends Z{constructor(e){super(),Q(this,e,jo,Go,K,{props:0})}}function sr(r){let e,t,n,i,o;const s=r[10].default,a=ht(s,r,r[9],null);return{c(){e=k("div"),a&&a.c(),ae(e,"border","solid 1px black"),ae(e,"padding","10px")},m(l,u){S(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=B(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&dt(a,s,l,l[9],n?_t(s,l[9],u,null):mt(l[9]),null)},i(l){n||(T(a,l),zt(()=>{t||(t=Nt(e,Gt,{duration:100},!0)),t.run(1)}),n=!0)},o(l){A(a,l),t||(t=Nt(e,Gt,{duration:100},!1)),t.run(0),n=!1},d(l){l&&E(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Ho(r){let e,t,n,i,o,s,a,l,u,c,g=r[4]&&sr(r);return{c(){e=k("button"),t=Nn("svg"),n=Nn("path"),i=C(),o=z(r[1]),s=C(),g&&g.c(),a=ge(),x(n,"d","M9 5l7 7-7 7"),x(t,"style","tran"),x(t,"width","20"),x(t,"height","20"),x(t,"fill","none"),x(t,"stroke-linecap","round"),x(t,"stroke-linejoin","round"),x(t,"stroke-width","2"),x(t,"viewBox","0 0 24 24"),x(t,"stroke","currentColor"),x(t,"class","svelte-t7fpgu"),x(e,"aria-expanded",r[4]),x(e,"class","svelte-t7fpgu"),$n(e,"underlined",r[3])},m(p,f){S(p,e,f),w(e,t),w(t,n),w(e,i),w(e,o),S(p,s,f),g&&g.m(p,f),S(p,a,f),l=!0,u||(c=[B(e,"click",r[5]),B(e,"mouseenter",r[11]),B(e,"mouseleave",r[12])],u=!0)},p(p,[f]){(!l||f&2)&&Ke(o,p[1]),(!l||f&16)&&x(e,"aria-expanded",p[4]),(!l||f&8)&&$n(e,"underlined",p[3]),p[4]?g?(g.p(p,f),f&16&&T(g,1)):(g=sr(p),g.c(),T(g,1),g.m(a.parentNode,a)):g&&(ve(),A(g,1,1,()=>{g=null}),ye())},i(p){l||(T(g),l=!0)},o(p){A(g),l=!1},d(p){p&&E(e),p&&E(s),g&&g.d(p),p&&E(a),u=!1,Ce(c)}}}function Uo(r,e,t){let n,i,o,s;ie(r,Ye,m=>t(7,o=m)),ie(r,Oe,m=>t(8,s=m));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:c}=e;const g=()=>{Oe.update(m=>m==u?null:u),s==u&&(un.set(null),un.set(u))};let p;function f(){p==null||p.scrollIntoView({behavior:"smooth"})}const h=()=>Bt.set(u),d=()=>Bt.set(null);function _(m){re[m?"unshift":"push"](()=>{p=m,t(2,p)})}const b=()=>f();return r.$$set=m=>{"id"in m&&t(0,u=m.id),"label"in m&&t(1,c=m.label),"$$scope"in m&&t(9,l=m.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,c,p,i,n,g,f,o,s,l,a,h,d,_,b]}class Jo extends Z{constructor(e){super(),Q(this,e,Uo,Ho,K,{id:0,label:1})}}function lr(r,e,t){const n=r.slice();return n[12]=e[t],n[13]=e,n[14]=t,n}function Xo(r){let e,t,n;function i(s){r[8](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new Yo({props:o}),re.push(()=>Le(e,"props",i,r[12].properties)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[12].properties,xe(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function zo(r){let e,t,n;function i(s){r[7](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new Io({props:o}),re.push(()=>Le(e,"props",i,r[12].properties)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[12].properties,xe(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Wo(r){let e,t,n,i,o;function s(c){r[4](c,r[12])}function a(c){r[5](c,r[12])}function l(c){r[6](c,r[12])}let u={length_meters:r[12].properties.length_meters};return r[12].properties.name!==void 0&&(u.name=r[12].properties.name),r[12].properties.intervention_type!==void 0&&(u.intervention_type=r[12].properties.intervention_type),r[12].properties.description!==void 0&&(u.description=r[12].properties.description),e=new go({props:u}),re.push(()=>Le(e,"name",s,r[12].properties.name)),re.push(()=>Le(e,"intervention_type",a,r[12].properties.intervention_type)),re.push(()=>Le(e,"description",l,r[12].properties.description)),{c(){Y(e.$$.fragment)},m(c,g){H(e,c,g),o=!0},p(c,g){r=c;const p={};g&2&&(p.length_meters=r[12].properties.length_meters),!t&&g&2&&(t=!0,p.name=r[12].properties.name,xe(()=>t=!1)),!n&&g&2&&(n=!0,p.intervention_type=r[12].properties.intervention_type,xe(()=>n=!1)),!i&&g&2&&(i=!0,p.description=r[12].properties.description,xe(()=>i=!1)),e.$set(p)},i(c){o||(T(e.$$.fragment,c),o=!0)},o(c){A(e.$$.fragment,c),o=!1},d(c){U(e,c)}}}function Vo(r){let e,t,n,i,o,s,a,l,u,c,g,p,f,h,d;const _=[Wo,zo,Xo],b=[];function m(y,M){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:-1}~(e=m(r))&&(t=b[e]=_[e](r));function v(){return r[9](r[12])}return{c(){t&&t.c(),n=C(),i=k("br"),o=C(),s=k("br"),a=C(),l=k("div"),u=k("button"),u.textContent="Delete",c=C(),g=k("button"),g.textContent="Save",p=C(),x(u,"type","button"),x(g,"type","button"),ae(l,"display","flex"),ae(l,"justify-content","space-between")},m(y,M){~e&&b[e].m(y,M),S(y,n,M),S(y,i,M),S(y,o,M),S(y,s,M),S(y,a,M),S(y,l,M),w(l,u),w(l,c),w(l,g),S(y,p,M),f=!0,h||(d=[B(u,"click",v),B(g,"click",r[10])],h=!0)},p(y,M){r=y;let O=e;e=m(r),e===O?~e&&b[e].p(r,M):(t&&(ve(),A(b[O],1,1,()=>{b[O]=null}),ye()),~e?(t=b[e],t?t.p(r,M):(t=b[e]=_[e](r),t.c()),T(t,1),t.m(n.parentNode,n)):t=null)},i(y){f||(T(t),f=!0)},o(y){A(t),f=!1},d(y){~e&&b[e].d(y),y&&E(n),y&&E(i),y&&E(o),y&&E(s),y&&E(a),y&&E(l),y&&E(p),h=!1,Ce(d)}}}function ar(r,e){let t,n,i;return n=new Jo({props:{id:e[12].id,label:e[14]+1+") "+e[2](e[12]),$$slots:{default:[Vo]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=ge(),Y(n.$$.fragment),this.first=t},m(o,s){S(o,t,s),H(n,o,s),i=!0},p(o,s){e=o;const a={};s&2&&(a.id=e[12].id),s&2&&(a.label=e[14]+1+") "+e[2](e[12])),s&32771&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||(T(n.$$.fragment,o),i=!0)},o(o){A(n.$$.fragment,o),i=!1},d(o){o&&E(t),U(n,o)}}}function Ko(r){let e=[],t=new Map,n,i,o,s,a=r[1].features;const l=u=>u[12].id;for(let u=0;u<a.length;u+=1){let c=lr(r,a,u),g=l(c);t.set(g,e[u]=ar(g,c))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=ge()},m(u,c){for(let g=0;g<e.length;g+=1)e[g].m(u,c);S(u,n,c),i=!0,o||(s=B(window,"keydown",r[3]),o=!0)},p(u,[c]){c&7&&(a=u[1].features,ve(),e=hi(e,c,l,1,u,a,t,n.parentNode,di,ar,n,lr),ye())},i(u){if(!i){for(let c=0;c<a.length;c+=1)T(e[c]);i=!0}},o(u){for(let c=0;c<e.length;c+=1)A(e[c]);i=!1},d(u){for(let c=0;c<e.length;c+=1)e[c].d(u);u&&E(n),o=!1,s()}}}function Zo(r,e,t){let n,i;ie(r,Oe,d=>t(11,n=d)),ie(r,te,d=>t(1,i=d));let{schema:o}=e;function s(d){var b,m,v,y,M;if(o=="planning")return((b=d.properties.planning)==null?void 0:b.name)||"Untitled polygon";if(o=="v2")return((v=(m=d.properties.v2)==null?void 0:m.Route)==null?void 0:v.name)||((M=(y=d.properties.v2)==null?void 0:y.Crossing)==null?void 0:M.name)||"Untitled intervention";if(d.properties.name)return d.properties.name;var _=d.properties.intervention_type;return _=="other"&&(d.geometry.type=="Point"?_="point":d.geometry.type=="LineString"?_="line":_="polygon"),`Untitled ${_}`}function a(d){if(d.key=="Delete"){const _=d.target.tagName;if(_=="INPUT"||_=="TEXTAREA")return;d.preventDefault();const b=n;b&&Bn(b)}}function l(d,_){r.$$.not_equal(_.properties.name,d)&&(_.properties.name=d,te.set(i))}function u(d,_){r.$$.not_equal(_.properties.intervention_type,d)&&(_.properties.intervention_type=d,te.set(i))}function c(d,_){r.$$.not_equal(_.properties.description,d)&&(_.properties.description=d,te.set(i))}function g(d,_){r.$$.not_equal(_.properties,d)&&(_.properties=d,te.set(i))}function p(d,_){r.$$.not_equal(_.properties,d)&&(_.properties=d,te.set(i))}const f=d=>Bn(d.id),h=()=>Oe.set(null);return r.$$set=d=>{"schema"in d&&t(0,o=d.schema)},[o,i,s,a,l,u,c,g,p,f,h]}class Qo extends Z{constructor(e){super(),Q(this,e,Zo,Ko,K,{schema:0})}}function We(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Be(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function _n(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ue(r,e,t){t===void 0&&(t={});var n=We(r),i=We(e),o=Fe(i[1]-n[1]),s=Fe(i[0]-n[0]),a=Fe(n[1]),l=Fe(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return mi(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Tt(r,e){return e===void 0&&(e={}),_i(r,function(t,n){var i=n.geometry.coordinates;return t+Ue(i[0],i[1],e)},0)}function es(r){let e,t,n,i,o,s,a,l,u,c,g,p,f,h,d,_,b,m,v,y=r[0].features.length+"",M,O,R,L,N,I,$,W;return{c(){e=k("div"),t=k("label"),n=z(`Scheme name:
    `),i=k("input"),o=C(),s=k("br"),a=C(),l=k("div"),u=k("label"),c=k("input"),g=C(),p=k("button"),p.textContent="Load from GeoJSON",f=C(),h=k("button"),h.textContent="Export to GeoJSON",d=C(),_=k("br"),b=C(),m=k("div"),v=k("span"),M=z(y),O=z(" interventions"),R=C(),L=k("button"),N=z("Clear all"),x(i,"type","text"),x(c,"type","file"),x(c,"id","load_geojson"),x(c,"class","svelte-lhyd1e"),x(p,"type","button"),x(h,"type","button"),x(h,"class","align-right svelte-lhyd1e"),x(L,"type","button"),x(L,"class","align-right svelte-lhyd1e"),L.disabled=I=r[0].features.length==0},m(P,D){S(P,e,D),w(e,t),w(t,n),w(t,i),Te(i,r[0].scheme_name),S(P,o,D),S(P,s,D),S(P,a,D),S(P,l,D),w(l,u),w(u,c),w(u,g),w(u,p),w(l,f),w(l,h),S(P,d,D),S(P,_,D),S(P,b,D),S(P,m,D),w(m,v),w(v,M),w(v,O),w(m,R),w(m,L),w(L,N),$||(W=[B(i,"input",r[7]),B(c,"change",r[3]),B(p,"click",ns),B(h,"click",r[2]),B(L,"click",r[1])],$=!0)},p(P,[D]){D&1&&i.value!==P[0].scheme_name&&Te(i,P[0].scheme_name),D&1&&y!==(y=P[0].features.length+"")&&Ke(M,y),D&1&&I!==(I=P[0].features.length==0)&&(L.disabled=I)},i:G,o:G,d(P){P&&E(e),P&&E(o),P&&E(s),P&&E(a),P&&E(l),P&&E(d),P&&E(_),P&&E(b),P&&E(m),$=!1,Ce(W)}}}function ts(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function ns(){document.getElementById("load_geojson").click()}function rs(r,e,t){let n;ie(r,te,h=>t(0,n=h));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=window.localStorage.getItem(s);if(a)try{te.set(p(JSON.parse(a)))}catch(h){console.log(`Failed to load from local storage: ${h}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&te.update(h=>(delete h.scheme_name,h.features=[],h))}function u(){const h=JSON.parse(JSON.stringify(n));for(let d of h.features)delete d.properties.hide_while_editing;return h}function c(){let h=u();var d=s;h.authority=i,h.origin="atip-v1",h.scheme_name&&(d+="_"+h.scheme_name),d+=".txt",ts(d,JSON.stringify(h,null,"  "))}function g(h){const d=new FileReader;d.onload=b=>{try{te.set(p(JSON.parse(b.target.result)))}catch(m){window.alert(`Couldn't load scheme from a file: ${m}`)}};let _=h.target.files;d.readAsText(_[0])}function p(h){let d=1;for(let _ of h.features)_.properties||(_.properties={name:"",description:"",intervention_type:"other"}),_.geometry.type=="LineString"&&!_.properties.length_meters&&(_.properties.length_meters=Tt(_,{units:"kilometers"})*1e3),_.id=d++;return h}function f(){n.scheme_name=this.value,te.set(n)}return r.$$set=h=>{"authorityName"in h&&t(4,i=h.authorityName),"schema"in h&&t(5,o=h.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,c,g,i,o,s,f]}class is extends Z{constructor(e){super(),Q(this,e,rs,es,K,{authorityName:4,schema:5})}}const os="/atip/schema_description/assets/zoom_out_map-b2e1091a.svg";function ss(r){let e,t,n,i,o;return{c(){e=k("button"),t=k("img"),gi(t.src,n=os)||x(t,"src",n),x(t,"alt","Zoom to show entire boundary"),x(e,"type","button"),x(e,"title","Zoom to show entire boundary"),x(e,"class","svelte-qzjsqo")},m(s,a){S(s,e,a),w(e,t),i||(o=B(e,"click",r[0]),i=!0)},p:G,i:G,o:G,d(s){s&&E(e),i=!1,o()}}}function ls(r,e,t){let n;ie(r,qe,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(En(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class as extends Z{constructor(e){super(),Q(this,e,ls,ss,K,{boundaryGeojson:1})}}function us(r){let e,t,n,i,o,s,a;return{c(){e=k("div"),t=z(`Basemap:
  `),n=k("select"),i=k("option"),i.textContent="Streets",o=k("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&zt(()=>r[2].call(n)),x(e,"class","svelte-1tbnm6i")},m(l,u){S(l,e,u),w(e,t),w(e,n),w(n,i),w(n,o),$t(n,r[0]),s||(a=[B(n,"change",r[2]),B(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&$t(n,l[0])},i:G,o:G,d(l){l&&E(e),s=!1,Ce(a)}}}function fs(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=Tr(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class cs extends Z{constructor(e){super(),Q(this,e,fs,us,K,{style:0})}}const le={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Qt=10,jt=10;function ps(r){let e,t,n,i,o,s,a,l,u,c,g,p,f,h,d;return{c(){e=k("li"),t=k("span"),n=z("Areas"),i=C(),o=k("li"),s=k("span"),a=z("Routes"),l=C(),u=k("li"),c=k("span"),g=z("Crossings"),p=C(),f=k("li"),h=k("span"),d=z("Other"),x(t,"class","svelte-p551i1"),ae(t,"background",le.area),x(s,"class","svelte-p551i1"),ae(s,"background",le.route),x(c,"class","svelte-p551i1"),ae(c,"background",le.crossing),x(h,"class","svelte-p551i1"),ae(h,"background",le.other)},m(_,b){S(_,e,b),w(e,t),w(e,n),S(_,i,b),S(_,o,b),w(o,s),w(o,a),S(_,l,b),S(_,u,b),w(u,c),w(u,g),S(_,p,b),S(_,f,b),w(f,h),w(f,d)},p:G,d(_){_&&E(e),_&&E(i),_&&E(o),_&&E(l),_&&E(u),_&&E(p),_&&E(f)}}}function hs(r){let e,t,n,i,o,s,a,l,u,c,g,p,f,h,d;return{c(){e=k("li"),t=k("span"),n=z("Preapp"),i=C(),o=k("li"),s=k("span"),a=z("Outline"),l=C(),u=k("li"),c=k("span"),g=z("Reserved matters"),p=C(),f=k("li"),h=k("span"),d=z("Local plan"),x(t,"class","svelte-p551i1"),ae(t,"background",le.preapp),x(s,"class","svelte-p551i1"),ae(s,"background",le.outline),x(c,"class","svelte-p551i1"),ae(c,"background",le["reserved matters"]),x(h,"class","svelte-p551i1"),ae(h,"background",le["local plan"])},m(_,b){S(_,e,b),w(e,t),w(e,n),S(_,i,b),S(_,o,b),w(o,s),w(o,a),S(_,l,b),S(_,u,b),w(u,c),w(u,g),S(_,p,b),S(_,f,b),w(f,h),w(f,d)},p:G,d(_){_&&E(e),_&&E(i),_&&E(o),_&&E(l),_&&E(u),_&&E(p),_&&E(f)}}}function ds(r){let e,t,n,i;function o(l,u){return l[0]=="planning"?hs:ps}let s=o(r),a=s(r);return{c(){e=k("div"),t=k("h1"),t.textContent="Interventions",n=C(),i=k("ul"),a.c(),x(t,"class","svelte-p551i1"),x(e,"class","svelte-p551i1")},m(l,u){S(l,e,u),w(e,t),w(e,n),w(e,i),a.m(i,null)},p(l,[u]){s===(s=o(l))&&a?a.p(l,u):(a.d(1),a=s(l),a&&(a.c(),a.m(i,null)))},i:G,o:G,d(l){l&&E(e),a.d()}}}function ms(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class _s extends Z{constructor(e){super(),Q(this,e,ms,ds,K,{schema:0})}}let et="interventions";function gs(r,e,t){let n,i;ie(r,qe,c=>t(1,n=c)),ie(r,te,c=>t(2,i=c));let{schema:o}=e;Ze(n,et,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",le.area,"route",le.route,"crossing",le.crossing,"other",le.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",le.preapp,"outline",le.outline,"reserved matters",le["reserved matters"],"local plan",le["local plan"],"white"],l=["!=","hide_while_editing",!0];return be(n,{id:"interventions-points",source:et,filter:["all",Wt,l,["!=","endpoint",!0]],...ut(s,Qt)}),be(n,{id:"interventions-lines",source:et,filter:["all",Vt,l],...wt(s,jt)},"route-lines"),be(n,{id:"interventions-lines-endpoints",source:et,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*jt,"circle-opacity":0,"circle-stroke-color":le.lineEndpointColor,"circle-stroke-width":2}}),be(n,{id:"interventions-polygons",source:et,filter:["all",Kt,l],...Xt(o=="planning"?a:s,.5)},"hover-polygons"),r.$$set=c=>{"schema"in c&&t(0,o=c.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let c=JSON.parse(JSON.stringify(i)),g=[];for(let p of c.features)if(p.geometry.type=="LineString")for(let f of[p.geometry.coordinates[0],p.geometry.coordinates[p.geometry.coordinates.length-1]])g.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});c.features=c.features.concat(g),n.getSource(et).setData(c)}},[o,n,i]}class vs extends Z{constructor(e){super(),Q(this,e,gs,null,K,{schema:0})}}let tt="hover";function ys(r,e,t){let n,i,o,s,a;return ie(r,qe,l=>t(0,n=l)),ie(r,te,l=>t(1,i=l)),ie(r,Bt,l=>t(2,o=l)),ie(r,Ye,l=>t(3,s=l)),ie(r,Oe,l=>t(4,a=l)),Ze(n,tt,{type:"geojson",data:De()}),be(n,{id:"hover-polygons",source:tt,filter:Kt,...wt(le.hovering,.5*jt,1)}),be(n,{id:"hover-lines",source:tt,filter:Vt,...wt(le.hovering,1.5*jt,1)},"interventions-lines"),be(n,{id:"hover-points",source:tt,filter:Wt,...ut(le.hovering,1.5*Qt,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(tt).setData(i.features.find(u=>u.id==l)):n.getSource(tt).setData(De())}},[n,i,o,s,a]}class bs extends Z{constructor(e){super(),Q(this,e,ys,null,K,{})}}class xn{constructor(e,t){ee(this,"owner");ee(this,"map");ee(this,"mapHandlers",{});ee(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Lt="edit-point-mode";class ws{constructor(e){ee(this,"map");ee(this,"active");ee(this,"eventListenersSuccess");ee(this,"eventListenersFailure");ee(this,"cursor");ee(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new xn(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Ze(e,Lt,{type:"geojson",data:De()}),be(e,{id:"edit-point-mode",source:Lt,...ut(le.hovering,Qt,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=ks(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Lt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=De();this.cursor&&e.features.push(this.cursor),this.map.getSource(Lt).setData(e)}}function ks(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function qr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Ss(r,e);var n=We(r),i=We(e),o=Fe(n[0]),s=Fe(i[0]),a=Fe(n[1]),l=Fe(i[1]),u=Math.sin(s-o)*Math.cos(l),c=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return an(Math.atan2(u,c))}function Ss(r,e){var t=qr(e,r);return t=(t+180)%360,t}function ur(r,e,t,n){n===void 0&&(n={});var i=We(r),o=Fe(i[0]),s=Fe(i[1]),a=Fe(t),l=vi(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),g=an(c),p=an(u);return st([g,p],n.properties)}function gn(r){if(!r)throw new Error("geojson is required");var e=[];return Mn(r,function(t){Es(t,e)}),ze(e)}function Es(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Be(n);break;case"LineString":t=[Be(n)]}t.forEach(function(i){var o=Ms(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Ms(r,e){var t=[];return r.reduce(function(n,i){var o=lt([n,i],e);return o.bbox=Os(n,i),t.push(o),i}),t}function Os(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var at={},Ls={get exports(){return at},set exports(r){at=r}},vn={},xs={get exports(){return vn},set exports(r){vn=r}};(function(r,e){(function(t,n){r.exports=n()})(yi,function(){function t(m,v,y,M,O){(function R(L,N,I,$,W){for(;$>I;){if($-I>600){var P=$-I+1,D=N-I+1,oe=Math.log(P),fe=.5*Math.exp(2*oe/3),q=.5*Math.sqrt(oe*fe*(P-fe)/P)*(D-P/2<0?-1:1),se=Math.max(I,Math.floor(N-D*fe/P+q)),ke=Math.min($,Math.floor(N+(P-D)*fe/P+q));R(L,N,se,ke,W)}var Ae=L[N],pe=I,ce=$;for(n(L,I,N),W(L[$],Ae)>0&&n(L,I,$);pe<ce;){for(n(L,pe,ce),pe++,ce--;W(L[pe],Ae)<0;)pe++;for(;W(L[ce],Ae)>0;)ce--}W(L[I],Ae)===0?n(L,I,ce):n(L,++ce,$),ce<=N&&(I=ce+1),N<=ce&&($=ce-1)}})(m,v,y||0,M||m.length-1,O||i)}function n(m,v,y){var M=m[v];m[v]=m[y],m[y]=M}function i(m,v){return m<v?-1:m>v?1:0}var o=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(m,v,y){if(!y)return v.indexOf(m);for(var M=0;M<v.length;M++)if(y(m,v[M]))return M;return-1}function a(m,v){l(m,0,m.children.length,v,m)}function l(m,v,y,M,O){O||(O=_(null)),O.minX=1/0,O.minY=1/0,O.maxX=-1/0,O.maxY=-1/0;for(var R=v;R<y;R++){var L=m.children[R];u(O,m.leaf?M(L):L)}return O}function u(m,v){return m.minX=Math.min(m.minX,v.minX),m.minY=Math.min(m.minY,v.minY),m.maxX=Math.max(m.maxX,v.maxX),m.maxY=Math.max(m.maxY,v.maxY),m}function c(m,v){return m.minX-v.minX}function g(m,v){return m.minY-v.minY}function p(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function f(m){return m.maxX-m.minX+(m.maxY-m.minY)}function h(m,v){return m.minX<=v.minX&&m.minY<=v.minY&&v.maxX<=m.maxX&&v.maxY<=m.maxY}function d(m,v){return v.minX<=m.maxX&&v.minY<=m.maxY&&v.maxX>=m.minX&&v.maxY>=m.minY}function _(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function b(m,v,y,M,O){for(var R=[v,y];R.length;)if(!((y=R.pop())-(v=R.pop())<=M)){var L=v+Math.ceil((y-v)/M/2)*M;t(m,L,v,y,O),R.push(v,L,L,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(m){var v=this.data,y=[];if(!d(m,v))return y;for(var M=this.toBBox,O=[];v;){for(var R=0;R<v.children.length;R++){var L=v.children[R],N=v.leaf?M(L):L;d(m,N)&&(v.leaf?y.push(L):h(m,N)?this._all(L,y):O.push(L))}v=O.pop()}return y},o.prototype.collides=function(m){var v=this.data;if(!d(m,v))return!1;for(var y=[];v;){for(var M=0;M<v.children.length;M++){var O=v.children[M],R=v.leaf?this.toBBox(O):O;if(d(m,R)){if(v.leaf||h(m,R))return!0;y.push(O)}}v=y.pop()}return!1},o.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var v=0;v<m.length;v++)this.insert(m[v]);return this}var y=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(m,v){if(!m)return this;for(var y,M,O,R=this.data,L=this.toBBox(m),N=[],I=[];R||N.length;){if(R||(R=N.pop(),M=N[N.length-1],y=I.pop(),O=!0),R.leaf){var $=s(m,R.children,v);if($!==-1)return R.children.splice($,1),N.push(R),this._condense(N),this}O||R.leaf||!h(R,L)?M?(y++,R=M.children[y],O=!1):R=null:(N.push(R),I.push(y),y=0,M=R,R=R.children[0])}return this},o.prototype.toBBox=function(m){return m},o.prototype.compareMinX=function(m,v){return m.minX-v.minX},o.prototype.compareMinY=function(m,v){return m.minY-v.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(m){return this.data=m,this},o.prototype._all=function(m,v){for(var y=[];m;)m.leaf?v.push.apply(v,m.children):y.push.apply(y,m.children),m=y.pop();return v},o.prototype._build=function(m,v,y,M){var O,R=y-v+1,L=this._maxEntries;if(R<=L)return a(O=_(m.slice(v,y+1)),this.toBBox),O;M||(M=Math.ceil(Math.log(R)/Math.log(L)),L=Math.ceil(R/Math.pow(L,M-1))),(O=_([])).leaf=!1,O.height=M;var N=Math.ceil(R/L),I=N*Math.ceil(Math.sqrt(L));b(m,v,y,I,this.compareMinX);for(var $=v;$<=y;$+=I){var W=Math.min($+I-1,y);b(m,$,W,N,this.compareMinY);for(var P=$;P<=W;P+=N){var D=Math.min(P+N-1,W);O.children.push(this._build(m,P,D,M-1))}}return a(O,this.toBBox),O},o.prototype._chooseSubtree=function(m,v,y,M){for(;M.push(v),!v.leaf&&M.length-1!==y;){for(var O=1/0,R=1/0,L=void 0,N=0;N<v.children.length;N++){var I=v.children[N],$=p(I),W=(P=m,D=I,(Math.max(D.maxX,P.maxX)-Math.min(D.minX,P.minX))*(Math.max(D.maxY,P.maxY)-Math.min(D.minY,P.minY))-$);W<R?(R=W,O=$<O?$:O,L=I):W===R&&$<O&&(O=$,L=I)}v=L||v.children[0]}var P,D;return v},o.prototype._insert=function(m,v,y){var M=y?m:this.toBBox(m),O=[],R=this._chooseSubtree(M,this.data,v,O);for(R.children.push(m),u(R,M);v>=0&&O[v].children.length>this._maxEntries;)this._split(O,v),v--;this._adjustParentBBoxes(M,O,v)},o.prototype._split=function(m,v){var y=m[v],M=y.children.length,O=this._minEntries;this._chooseSplitAxis(y,O,M);var R=this._chooseSplitIndex(y,O,M),L=_(y.children.splice(R,y.children.length-R));L.height=y.height,L.leaf=y.leaf,a(y,this.toBBox),a(L,this.toBBox),v?m[v-1].children.push(L):this._splitRoot(y,L)},o.prototype._splitRoot=function(m,v){this.data=_([m,v]),this.data.height=m.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(m,v,y){for(var M,O,R,L,N,I,$,W=1/0,P=1/0,D=v;D<=y-v;D++){var oe=l(m,0,D,this.toBBox),fe=l(m,D,y,this.toBBox),q=(O=oe,R=fe,L=void 0,N=void 0,I=void 0,$=void 0,L=Math.max(O.minX,R.minX),N=Math.max(O.minY,R.minY),I=Math.min(O.maxX,R.maxX),$=Math.min(O.maxY,R.maxY),Math.max(0,I-L)*Math.max(0,$-N)),se=p(oe)+p(fe);q<W?(W=q,M=D,P=se<P?se:P):q===W&&se<P&&(P=se,M=D)}return M||y-v},o.prototype._chooseSplitAxis=function(m,v,y){var M=m.leaf?this.compareMinX:c,O=m.leaf?this.compareMinY:g;this._allDistMargin(m,v,y,M)<this._allDistMargin(m,v,y,O)&&m.children.sort(M)},o.prototype._allDistMargin=function(m,v,y,M){m.children.sort(M);for(var O=this.toBBox,R=l(m,0,v,O),L=l(m,y-v,y,O),N=f(R)+f(L),I=v;I<y-v;I++){var $=m.children[I];u(R,m.leaf?O($):$),N+=f(R)}for(var W=y-v-1;W>=v;W--){var P=m.children[W];u(L,m.leaf?O(P):P),N+=f(L)}return N},o.prototype._adjustParentBBoxes=function(m,v,y){for(var M=y;M>=0;M--)u(v[M],m)},o.prototype._condense=function(m){for(var v=m.length-1,y=void 0;v>=0;v--)m[v].children.length===0?v>0?(y=m[v-1].children).splice(y.indexOf(m[v]),1):this.clear():a(m[v],this.toBBox)},o})})(xs);const Cs=On(bi),Ts=On(wi),Rs=On(ki);var $e=vn,Gr=Cs,jr=Ts,nt=Rs.default,As=jr.featureEach;jr.coordEach;Gr.polygon;var fr=Gr.featureCollection;function Yr(r){var e=new $e(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:nt(t),$e.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:nt(i),n.push(i)}):As(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:nt(i),n.push(i)}),$e.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:nt(t),$e.prototype.remove.call(this,t,n)},e.clear=function(){return $e.prototype.clear.call(this)},e.search=function(t){var n=$e.prototype.search.call(this,this.toBBox(t));return fr(n)},e.collides=function(t){return $e.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=$e.prototype.all.call(this);return fr(t)},e.toJSON=function(){return $e.prototype.toJSON.call(this)},e.fromJSON=function(t){return $e.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=nt(t);else if(t.type==="FeatureCollection")n=nt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ls.exports=Yr;at.default=Yr;function Hr(r,e){var t={},n=[];if(r.type==="LineString"&&(r=In(r)),e.type==="LineString"&&(e=In(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=cr(r,e);return i&&n.push(i),ze(n)}var o=at();return o.load(gn(e)),It(gn(r),function(s){It(o.search(s),function(a){var l=cr(s,a);if(l){var u=Be(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),ze(n)}function cr(r,e){var t=Be(r),n=Be(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],c=n[1][0],g=n[1][1],p=(g-u)*(s-i)-(c-l)*(a-o),f=(c-l)*(o-u)-(g-u)*(i-l),h=(s-i)*(o-u)-(a-o)*(i-l);if(p===0)return f===0&&h===0,null;var d=f/p,_=h/p;if(d>=0&&d<=1&&_>=0&&_<=1){var b=i+d*(s-i),m=o+d*(a-o);return st([b,m])}return null}function St(r,e,t){t===void 0&&(t={});var n=st([1/0,1/0],{dist:1/0}),i=0;return Mn(r,function(o){for(var s=Be(o),a=0;a<s.length-1;a++){var l=st(s[a]);l.properties.dist=Ue(e,l,t);var u=st(s[a+1]);u.properties.dist=Ue(e,u,t);var c=Ue(l,u,t),g=Math.max(l.properties.dist,u.properties.dist),p=qr(l,u),f=ur(e,g,p+90,t),h=ur(e,g,p-90,t),d=Hr(lt([f.geometry.coordinates,h.geometry.coordinates]),lt([l.geometry.coordinates,u.geometry.coordinates])),_=null;d.features.length>0&&(_=d.features[0],_.properties.dist=Ue(e,_,t),_.properties.location=i+Ue(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+c),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a),i+=c}}),n}const rt="edit-polygon-mode";class Ps{constructor(e){ee(this,"map");ee(this,"active");ee(this,"eventListenersSuccess");ee(this,"eventListenersFailure");ee(this,"points");ee(this,"cursor");ee(this,"hover");ee(this,"dragFrom");ee(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new xn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Ze(e,rt,{type:"geojson",data:De()}),be(e,{id:"edit-polygon-fill",source:rt,filter:Kt,...Xt("red",["case",["boolean",["get","hover"],"false"],1,.5])}),be(e,{id:"edit-polygon-lines",source:rt,filter:Vt,...wt("black",8,.5)}),be(e,{id:"edit-polygon-vertices",source:rt,filter:Wt,...ut(le.hovering,Qt,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(hr(this.points).forEach((n,i)=>{t.push([i+1,St(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(rt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=De();this.points.forEach((n,i)=>{let o=pr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(hr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(rt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=pr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function pr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function hr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let X;const je=new Array(32).fill(void 0);je.push(void 0,null,!0,!1);function J(r){return je[r]}let vt=je.length;function Fs(r){r<36||(je[r]=vt,vt=r)}function yn(r){const e=J(r);return Fs(r),e}const Ur=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Ur.decode();let Rt=new Uint8Array;function yt(){return Rt.byteLength===0&&(Rt=new Uint8Array(X.memory.buffer)),Rt}function it(r,e){return Ur.decode(yt().subarray(r,r+e))}function me(r){vt===je.length&&je.push(je.length+1);const e=vt;return vt=je[e],je[e]=r,e}function rn(r){return r==null}let At=new Float64Array;function Ns(){return At.byteLength===0&&(At=new Float64Array(X.memory.buffer)),At}let Pt=new Int32Array;function _e(){return Pt.byteLength===0&&(Pt=new Int32Array(X.memory.buffer)),Pt}let Xe=0;const Ft=new TextEncoder("utf-8"),$s=typeof Ft.encodeInto=="function"?function(r,e){return Ft.encodeInto(r,e)}:function(r,e){const t=Ft.encode(r);return e.set(t),{read:r.length,written:t.length}};function xt(r,e,t){if(t===void 0){const a=Ft.encode(r),l=e(a.length);return yt().subarray(l,l+a.length).set(a),Xe=a.length,l}let n=r.length,i=e(n);const o=yt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=yt().subarray(i+s,i+n),l=$s(r,a);s+=l.written}return Xe=s,i}function bn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=bn(r[0]));for(let s=1;s<i;s++)o+=", "+bn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Is(r,e){const t=e(r.length*1);return yt().set(r,t/1),Xe=r.length,t}function on(r,e){try{return r.apply(this,e)}catch(t){X.__wbindgen_exn_store(me(t))}}class Yt{static __wrap(e){const t=Object.create(Yt.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();X.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=X.__wbindgen_add_to_stack_pointer(-16),s=Is(e,X.__wbindgen_malloc),a=Xe;X.jsroutesnapper_new(o,s,a);var t=_e()[o/4+0],n=_e()[o/4+1],i=_e()[o/4+2];if(i)throw yn(n);return Yt.__wrap(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){X.jsroutesnapper_setConfig(this.ptr,me(e))}toFinalFeature(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_toFinalFeature(n,this.ptr);var e=_e()[n/4+0],t=_e()[n/4+1];let i;return e!==0&&(i=it(e,t).slice(),X.__wbindgen_free(e,t*1)),i}finally{X.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_renderGeojson(n,this.ptr);var e=_e()[n/4+0],t=_e()[n/4+1];return it(e,t)}finally{X.__wbindgen_add_to_stack_pointer(16),X.__wbindgen_free(e,t)}}setSnapMode(e){X.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return X.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){X.jsroutesnapper_onClick(this.ptr)}onDragStart(){return X.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return X.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){X.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_editExisting(i,this.ptr,me(e));var t=_e()[i/4+0],n=_e()[i/4+1];if(n)throw yn(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}}async function Bs(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ds(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){yn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(it(e,t));return me(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=it(e,t);return me(n)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;Ns()[e/8+1]=rn(i)?0:i,_e()[e/4+0]=!rn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=rn(i)?0:xt(i,X.__wbindgen_malloc,X.__wbindgen_realloc),s=Xe;_e()[e/4+1]=s,_e()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(J(t)),i=xt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=Xe;_e()[e/4+1]=o,_e()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return me(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=J(e)[J(t)];return me(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(J(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(J(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(J(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(J(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(J(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=J(e)[t>>>0];return me(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=J(e).next;return me(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return on(function(e){const t=J(e).next();return me(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return J(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=J(e).value;return me(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return me(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return on(function(e,t){const n=Reflect.get(J(e),J(t));return me(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return on(function(e,t){const n=J(e).call(J(t));return me(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=J(e).buffer;return me(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(J(e));return me(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return me(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=xt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=Xe;_e()[e/4+1]=o,_e()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(it(e,t))}finally{X.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=bn(J(t)),i=xt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=Xe;_e()[e/4+1]=o,_e()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(it(e,t))},r.wbg.__wbindgen_memory=function(){const e=X.memory;return me(e)},r}function qs(r,e){return X=r.exports,Jr.__wbindgen_wasm_module=e,At=new Float64Array,Pt=new Int32Array,Rt=new Uint8Array,X}async function Jr(r){typeof r>"u"&&(r="/atip/schema_description/assets/route_snapper_bg.wasm");const e=Ds();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Bs(await r,e);return qs(t,n)}const pt="route-snapper",dr=10,Gs=30;class js{constructor(e,t){ee(this,"map");ee(this,"inner");ee(this,"active");ee(this,"eventListenersSuccessRoute");ee(this,"eventListenersSuccessArea");ee(this,"eventListenersFailure");ee(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Yt(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Ze(e,pt,{type:"geojson",data:De()}),be(e,{id:"route-points",source:pt,filter:Wt,...ut(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",dr/2,dr])}),be(e,{id:"route-lines",source:pt,filter:Vt,...wt("black",2.5)}),be(e,{id:"route-polygons",source:pt,filter:Kt,...Xt("black",.5)}),this.events=new xn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Gs,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(pt).setData(JSON.parse(this.inner.renderGeojson()))}}function mr(r){let e;function t(o,s){return o[1]?Hs:Ys}let n=t(r),i=n(r);return{c(){i.c(),e=ge()},m(o,s){i.m(o,s),S(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&E(e)}}}function Ys(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Hs(r){let e;return{c(){e=k("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Us(r){let e,t=r[0]==ot&&mr(r);return{c(){t&&t.c(),e=ge()},m(n,i){t&&t.m(n,i),S(n,e,i)},p(n,[i]){n[0]==ot?t?t.p(n,i):(t=mr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&E(e)}}}const ot="edit-attribute";function Xr(){}function Js(r,e,t){let n,i,o,s;ie(r,qe,f=>t(5,n=f)),ie(r,te,f=>t(6,i=f)),ie(r,un,f=>t(7,o=f)),ie(r,Oe,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){Oe.set(null)}n.on("mousemove",c),n.on("mouseout",g),n.on("click",p),Et(()=>{n.off("mousemove",c),n.off("mouseout",g),n.off("click",p)});function c(f){var h;if(a==ot){let d=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ye.set(((h=d[0])==null?void 0:h.id)||null)}}function g(){a==ot&&Ye.set(null)}function p(f){if(a==ot){let h=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});h.length>0?Oe.set(h[0].id):Oe.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let h=i.features.find(d=>d.id==f);h.geometry.type=="Point"?n.flyTo({center:h.geometry.coordinates,duration:500}):n.fitBounds(En(h),{padding:200,duration:500}),l(ot)}}},[a,s,l,Xr,u,n,i,o]}class Xs extends Z{constructor(e){super(),Q(this,e,Js,Us,K,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Xr}get stop(){return this.$$.ctx[4]}}function zs(r){let e,t;return{c:G,m(n,i){e||(t=B(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function Ws(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class en extends Z{constructor(e){super(),Q(this,e,Ws,zs,K,{tool:1})}}function Vs(r){let e;return{c(){e=k("p"),e.textContent="Click to add a new point"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Ks(r){let e;return{c(){e=k("p"),e.textContent="Click to move the point here"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Zs(r){let e,t,n,i,o,s,a,l,u;function c(f,h){return f[1]?Ks:Vs}let g=c(r),p=g(r);return s=new en({props:{tool:r[0]}}),{c(){p.c(),e=C(),t=k("p"),t.innerHTML="Press <b>Escape</b> to cancel",n=C(),i=k("button"),i.textContent="Cancel",o=C(),Y(s.$$.fragment),x(i,"type","button")},m(f,h){p.m(f,h),S(f,e,h),S(f,t,h),S(f,n,h),S(f,i,h),S(f,o,h),H(s,f,h),a=!0,l||(u=B(i,"click",r[2]),l=!0)},p(f,[h]){g!==(g=c(f))&&(p.d(1),p=g(f),p&&(p.c(),p.m(e.parentNode,e)));const d={};h&1&&(d.tool=f[0]),s.$set(d)},i(f){a||(T(s.$$.fragment,f),a=!0)},o(f){A(s.$$.fragment,f),a=!1},d(f){p.d(f),f&&E(e),f&&E(t),f&&E(n),f&&E(i),f&&E(o),U(s,f),l=!1,u()}}}function Qs(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class zr extends Z{constructor(e){super(),Q(this,e,Qs,Zs,K,{pointTool:0,editingExisting:1})}}function el(r){let e,t,n,i,o,s,a,l,u,c,g;return l=new en({props:{tool:r[0]}}),{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=C(),n=k("div"),i=k("button"),i.textContent="Finish",o=C(),s=k("button"),s.textContent="Cancel",a=C(),Y(l.$$.fragment),x(i,"type","button"),x(s,"type","button"),ae(n,"display","flex"),ae(n,"justify-content","space-between")},m(p,f){S(p,e,f),S(p,t,f),S(p,n,f),w(n,i),w(n,o),w(n,s),S(p,a,f),H(l,p,f),u=!0,c||(g=[B(i,"click",r[1]),B(s,"click",r[2])],c=!0)},p(p,[f]){const h={};f&1&&(h.tool=p[0]),l.$set(h)},i(p){u||(T(l.$$.fragment,p),u=!0)},o(p){A(l.$$.fragment,p),u=!1},d(p){p&&E(e),p&&E(t),p&&E(n),p&&E(a),U(l,p),c=!1,Ce(g)}}}function tl(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Wr extends Z{constructor(e){super(),Q(this,e,tl,el,K,{polygonTool:0})}}function nl(r){let e,t,n,i,o,s,a,l,u,c,g;return l=new en({props:{tool:r[0]}}),{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish area</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=C(),n=k("div"),i=k("button"),i.textContent="Finish",o=C(),s=k("button"),s.textContent="Cancel",a=C(),Y(l.$$.fragment),x(i,"type","button"),x(s,"type","button"),ae(n,"display","flex"),ae(n,"justify-content","space-between")},m(p,f){S(p,e,f),S(p,t,f),S(p,n,f),w(n,i),w(n,o),w(n,s),S(p,a,f),H(l,p,f),u=!0,c||(g=[B(i,"click",r[1]),B(s,"click",r[2])],c=!0)},p(p,[f]){const h={};f&1&&(h.tool=p[0]),l.$set(h)},i(p){u||(T(l.$$.fragment,p),u=!0)},o(p){A(l.$$.fragment,p),u=!1},d(p){p&&E(e),p&&E(t),p&&E(n),p&&E(a),U(l,p),c=!1,Ce(g)}}}function rl(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Vr extends Z{constructor(e){super(),Q(this,e,rl,nl,K,{routeTool:0})}}function il(r){let e,t,n,i,o,s,a,l,u,c,g,p,f,h,d;return p=new en({props:{tool:r[0]}}),{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=C(),n=k("label"),i=k("input"),o=z(`
  Avoid doubling back`),s=C(),a=k("div"),l=k("button"),l.textContent="Finish",u=C(),c=k("button"),c.textContent="Cancel",g=C(),Y(p.$$.fragment),x(i,"type","checkbox"),x(l,"type","button"),x(c,"type","button"),ae(a,"display","flex"),ae(a,"justify-content","space-between")},m(_,b){S(_,e,b),S(_,t,b),S(_,n,b),w(n,i),i.checked=r[1],w(n,o),S(_,s,b),S(_,a,b),w(a,l),w(a,u),w(a,c),S(_,g,b),H(p,_,b),f=!0,h||(d=[B(i,"change",r[2]),B(l,"click",r[3]),B(c,"click",r[4])],h=!0)},p(_,[b]){b&2&&(i.checked=_[1]);const m={};b&1&&(m.tool=_[0]),p.$set(m)},i(_){f||(T(p.$$.fragment,_),f=!0)},o(_){A(p.$$.fragment,_),f=!1},d(_){_&&E(e),_&&E(t),_&&E(n),_&&E(s),_&&E(a),_&&E(g),U(p,_),h=!1,Ce(d)}}}function ol(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class Kr extends Z{constructor(e){super(),Q(this,e,ol,il,K,{routeTool:0})}}function _r(r){let e,t,n,i;const o=[fl,ul,al,ll,sl],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=ge()},m(l,u){s[e].m(l,u),S(l,n,u),i=!0},p(l,u){let c=e;e=a(l),e===c?s[e].p(l,u):(ve(),A(s[c],1,1,()=>{s[c]=null}),ye(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){i||(T(t),i=!0)},o(l){A(t),i=!1},d(l){s[e].d(l),l&&E(n)}}}function sl(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){S(t,e,n)},p:G,i:G,o:G,d(t){t&&E(e)}}}function ll(r){let e,t;return e=new Kr({props:{routeTool:r[3]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function al(r){let e,t;return e=new Vr({props:{routeTool:r[3]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function ul(r){let e,t;return e=new Wr({props:{polygonTool:r[2]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function fl(r){let e,t;return e=new zr({props:{pointTool:r[1],editingExisting:!0}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function cl(r){let e,t,n=r[0]==Ge&&_r(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Ge?n?(n.p(i,o),o&1&&T(n,1)):(n=_r(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(T(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const Ge="edit-geometry";function Zr(){}function pl(r,e,t){let n;ie(r,qe,d=>t(8,n=d));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function c(){l&&(o.stop(),s.stop(),a.stop(),te.update(d=>{let _=d.features.find(b=>b.id==l);return delete _.properties.hide_while_editing,d})),l=null,t(4,u=null),Ye.set(null)}n.on("mousemove",g),n.on("mouseout",p),n.on("click",f),Et(()=>{n.off("mousemove",g),n.off("mouseout",p),n.off("click",f)}),a.addEventListenerSuccessRoute(d=>{i==Ge&&(te.update(_=>{let b=_.features.find(m=>m.id==l);return b.properties.length_meters=d.properties.length_meters,b.properties.waypoints=d.properties.waypoints,delete b.properties.hide_while_editing,b.geometry=d.geometry,_}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(d=>{i==Ge&&(te.update(_=>{let b=_.features.find(m=>m.id==l);return b.properties.waypoints=d.properties.waypoints,delete b.properties.hide_while_editing,b.geometry=d.geometry,_}),l=null,t(4,u=null))});for(let d of[o,s])d.addEventListenerSuccess(_=>{i==Ge&&(te.update(b=>{let m=b.features.find(v=>v.id==l);return m.geometry=_.geometry,delete m.properties.hide_while_editing,b}),l=null,t(4,u=null))});for(let d of[o,s,a])d.addEventListenerFailure(()=>{i==Ge&&(te.update(_=>{let b=_.features.find(m=>m.id==l);return delete b.properties.hide_while_editing,_}),l=null,t(4,u=null))});function g(d){var _;if(i==Ge&&l==null){let b=n.queryRenderedFeatures(d.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ye.set(((_=b[0])==null?void 0:_.id)||null)}}function p(){i==Ge&&l==null&&Ye.set(null)}function f(d){if(i==Ge&&l==null){let _=n.queryRenderedFeatures(d.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&h(_[0].id)}}function h(d){Ye.set(null);let _=null;te.update(m=>(_=m.features.find(v=>v.id==d),_.properties.hide_while_editing=!0,m));let b=_;l=d,b.geometry.type=="LineString"?(a.editExistingRoute(b),t(4,u="route")):b.geometry.type=="Polygon"?b.properties.waypoints?(a.editExistingArea(b),t(4,u="snap-polygon")):(s.editExisting(b),t(4,u="free-polygon")):b.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=d=>{"mode"in d&&t(0,i=d.mode),"pointTool"in d&&t(1,o=d.pointTool),"polygonTool"in d&&t(2,s=d.polygonTool),"routeTool"in d&&t(3,a=d.routeTool)},[i,o,s,a,u,Zr,c]}class hl extends Z{constructor(e){super(),Q(this,e,pl,cl,K,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Zr}get stop(){return this.$$.ctx[6]}}async function dl(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:c}=await n.read();if(u)break;s.push(c),o+=c.length;const g=100*o/i;e.style=`background: linear-gradient(to right, red ${g}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function ml(r){let e,t;return e=new Kr({props:{routeTool:r[0]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function _l(r){let e;return{c(){e=k("div"),e.textContent="Route tool loading..."},m(t,n){S(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&E(e),r[7](null)}}}function gl(r){let e,t,n,i;const o=[_l,ml],s=[];function a(l,u){return l[0]?l[1]==wn?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=ge()},m(l,u){~e&&s[e].m(l,u),S(l,n,u),i=!0},p(l,[u]){let c=e;e=a(l),e===c?~e&&s[e].p(l,u):(t&&(ve(),A(s[c],1,1,()=>{s[c]=null}),ye()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),T(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(T(t),i=!0)},o(l){A(t),i=!1},d(l){~e&&s[e].d(l),l&&E(n)}}}const wn="route";function vl(r,e,t){let n;ie(r,qe,p=>t(8,n=p));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function c(){l==null||l.stop()}Sn(async()=>{await Jr(),console.log(`Grabbing ${s}`);try{const p=await dl(s,a);t(0,l=new js(n,p))}catch(p){console.log(`Route tool broke: ${p}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==wn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(p=>{i==wn&&(te.update(f=>(p.id=Mt(f),p.properties.intervention_type="route",f.features.push(p),f)),o("edit-attribute"),Oe.set(p.id))})});function g(p){re[p?"unshift":"push"](()=>{a=p,t(2,a)})}return r.$$set=p=>{"mode"in p&&t(1,i=p.mode),"changeMode"in p&&t(3,o=p.changeMode),"url"in p&&t(4,s=p.url),"routeTool"in p&&t(0,l=p.routeTool)},[l,i,a,o,s,u,c,g]}class yl extends Z{constructor(e){super(),Q(this,e,vl,gl,K,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function gr(r){let e,t;return e=new zr({props:{pointTool:r[1],editingExisting:!1}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function bl(r){let e,t,n=r[0]==Ht&&gr(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Ht?n?(n.p(i,o),o&1&&T(n,1)):(n=gr(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(T(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const Ht="point";function wl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Ht&&(te.update(u=>(l.id=Mt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),Oe.set(l.id))}),o.addEventListenerFailure(()=>{n==Ht&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class kl extends Z{constructor(e){super(),Q(this,e,wl,bl,K,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function vr(r){let e,t;return e=new Wr({props:{polygonTool:r[1]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Sl(r){let e,t,n=r[0]==Ut&&vr(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Ut?n?(n.p(i,o),o&1&&T(n,1)):(n=vr(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(T(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const Ut="free-polygon";function El(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Ut&&(te.update(u=>(l.id=Mt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Oe.set(l.id))}),o.addEventListenerFailure(()=>{n==Ut&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Ml extends Z{constructor(e){super(),Q(this,e,El,Sl,K,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function yr(r){let e,t;return e=new Vr({props:{routeTool:r[1]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Ol(r){let e,t,n=r[0]==Jt&&yr(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Jt?n?(n.p(i,o),o&1&&T(n,1)):(n=yr(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(T(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const Jt="snap-polygon";function Ll(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==Jt&&(te.update(u=>(l.id=Mt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Oe.set(l.id))}),o.addEventListenerFailure(()=>{n==Jt&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class xl extends Z{constructor(e){super(),Q(this,e,Ll,Ol,K,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Cl(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Ue(r.slice(0,2),[n,t]),s=Ue(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Tl(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return Si(r,function(s){Rl(s,o,n)}),r}function Rl(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Al(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=_n(r),n=_n(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Tl(e,{precision:7});switch(n){case"Point":return kn(r,i);case"MultiPoint":return br(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return br(r,Hr(r,i))}}function br(r,e){var t=[],n=at();return Mn(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=kn(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=Cl(Ei(a)))}),n.load(ze(t));else{var o=n.search(i);if(o.features.length){var s=Qr(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),It(kn(s,i),function(a){t.push(a),n.insert(a)})}}}),ze(t)}function kn(r,e){var t=[],n=Be(r)[0],i=Be(r)[r.geometry.coordinates.length-1];if(sn(n,We(e))||sn(i,We(e)))return ze([r]);var o=at(),s=gn(r);o.load(s);var a=o.search(e);if(!a.features.length)return ze([r]);var l=Qr(e,a),u=[n],c=Mi(s,function(g,p,f){var h=Be(p)[1],d=We(e);return f===l.id?(g.push(d),t.push(lt(g)),sn(d,h)?[d]:[d,h]):(g.push(h),g)},u);return c.length>1&&t.push(lt(c)),ze(t)}function Qr(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return It(e,function(i){var o=St(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function sn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Pl(r,e,t){var n=Be(t);if(_n(t)!=="LineString")throw new Error("line must be a LineString");var i=St(t,r),o=St(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),lt(a,t.properties)}function wr(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function Fl(r){let e,t,n,i=r[0]==bt&&wr();return{c(){i&&i.c(),e=ge()},m(o,s){i&&i.m(o,s),S(o,e,s),t||(n=B(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==bt?i||(i=wr(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:G,o:G,d(o){i&&i.d(o),o&&E(e),t=!1,n()}}}const bt="split-route",Nl=10,$l=30;let ln="split-route";function ei(){}function kr(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Il(r,e,t){let n,i;ie(r,te,d=>t(8,n=d)),ie(r,qe,d=>t(6,i=d));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",c),i.on("click",g),Et(()=>{i.off("mousemove",c),i.off("click",g)}),Ze(i,ln,{type:"geojson",data:De()}),be(i,{id:"draw-split-route",source:ln,...ut("black",Nl,["case",["==",["get","snapped"],!0],1,.5])});function c(d){if(o!=bt)return;t(5,l=kr(d.lngLat.toArray(),!1)),u=null;const _=[d.point.x-$l,d.point.y],b=i.unproject(d.point).distanceTo(i.unproject(_))/1e3;let m=[];for(let[v,y]of n.features.entries())if(y.geometry.type=="LineString"){let M=St(y.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=b&&m.push([v,M.geometry.coordinates,M.properties.dist])}m.sort((v,y)=>v[2]-y[2]),m.length>0&&(t(5,l=kr(m[0][1],!0)),u=m[0][0])}function g(){if(o==bt)if(u==null)s("edit-attribute");else{let d=Al(n.features[u],l);if(d.features.length==2){let _=d.features[0],b=d.features[1];te.update(m=>(_.id=m.features[u].id,b.id=Mt(m),_.properties=JSON.parse(JSON.stringify(m.features[u].properties)),b.properties=JSON.parse(JSON.stringify(_.properties)),p(m.features[u],_,b,l),m.features.splice(u,1,_,b),m))}a()}}function p(d,_,b,m){_.properties.length_meters=Tt(_,{units:"kilometers"})*1e3,b.properties.length_meters=Tt(b,{units:"kilometers"})*1e3,_.properties.waypoints=[],b.properties.waypoints=[];let v=f(d,m),y=!0,M=0;for(let O of d.properties.waypoints){let R=f(d,st([O.lon,O.lat]));if(y)if(R<v)_.properties.waypoints.push(O);else{let L=O.snapped&&d.properties.waypoints[M-1].snapped;_.properties.waypoints.push({lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1],snapped:L}),y=!1,b.properties.waypoints.push({lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1],snapped:L}),b.properties.waypoints.push(O)}else b.properties.waypoints.push(O);M++}}function f(d,_){let b=d.geometry.coordinates[0],m=Pl(b,_,d);return Tt(m,{units:"kilometers"})*1e3}function h(d){o==bt&&d.key=="Escape"&&(s("edit-attribute"),d.preventDefault())}return r.$$set=d=>{"mode"in d&&t(0,o=d.mode),"changeMode"in d&&t(2,s=d.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let d=De();l&&d.features.push(l),i.getSource(ln).setData(d)}},[o,h,s,ei,a,l,i]}class Bl extends Z{constructor(e){super(),Q(this,e,Il,Fl,K,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ei}get stop(){return this.$$.ctx[4]}}function Sr(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new hl({props:n}),r[17](e),{c(){Y(e.$$.fragment)},m(i,o){H(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){r[17](null),U(e,i)}}}function Er(r){let e,t,n,i,o;return{c(){e=k("button"),t=z("New point"),x(e,"type","button"),e.disabled=n=r[3]=="point",x(e,"class","svelte-cej5os")},m(s,a){S(s,e,a),w(e,t),i||(o=B(e,"click",r[18]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function Mr(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new xl({props:n}),r[23](e),{c(){Y(e.$$.fragment)},m(i,o){H(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){r[23](null),U(e,i)}}}function Or(r){let e,t,n,i,o;return{c(){e=k("button"),t=z("New route"),x(e,"type","button"),e.disabled=n=r[3]=="route",x(e,"class","svelte-cej5os")},m(s,a){S(s,e,a),w(e,t),i||(o=B(e,"click",r[24]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function Lr(r){let e,t,n,i,o;return{c(){e=k("button"),t=z("Split route"),x(e,"type","button"),e.disabled=n=r[3]=="split-route",x(e,"class","svelte-cej5os")},m(s,a){S(s,e,a),w(e,t),i||(o=B(e,"click",r[27]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function Dl(r){let e,t,n,i,o,s,a,l,u,c,g,p,f,h,d,_,b,m,v,y,M,O,R,L,N,I,$,W,P,D,oe,fe,q,se,ke,Ae,pe,ce,Pe,ne,F,V,ti={mode:r[3],changeMode:r[13]};a=new Xs({props:ti}),r[15](a);let he=r[2]&&Sr(r),Se=r[1]!="planning"&&Er(r),ni={mode:r[3],changeMode:r[13],pointTool:r[11]};b=new kl({props:ni}),r[19](b);let ri={mode:r[3],changeMode:r[13],polygonTool:r[12]};L=new Ml({props:ri}),r[21](L);let de=r[2]&&Mr(r),Ee=r[1]!="planning"&&Or(r);function ii(j){r[26](j)}let Cn={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(Cn.routeTool=r[2]),se=new yl({props:Cn}),r[25](se),re.push(()=>Le(se,"routeTool",ii,r[2]));let Me=r[1]!="planning"&&Lr(r),oi={mode:r[3],changeMode:r[13]};return Pe=new Bl({props:oi}),r[28](Pe),{c(){e=k("div"),t=k("div"),n=k("button"),i=z("Edit attributes"),s=C(),Y(a.$$.fragment),l=C(),u=k("div"),c=k("button"),g=z("Edit geometry"),f=C(),he&&he.c(),h=C(),d=k("div"),Se&&Se.c(),_=C(),Y(b.$$.fragment),m=C(),v=k("div"),y=k("button"),M=z("New polygon (freehand)"),R=C(),Y(L.$$.fragment),N=C(),I=k("div"),$=k("button"),W=z("New polygon (snapped)"),D=C(),de&&de.c(),oe=C(),fe=k("div"),Ee&&Ee.c(),q=C(),Y(se.$$.fragment),Ae=C(),pe=k("div"),Me&&Me.c(),ce=C(),Y(Pe.$$.fragment),x(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",x(n,"class","svelte-cej5os"),x(c,"type","button"),c.disabled=p=r[3]=="edit-geometry",x(c,"class","svelte-cej5os"),x(y,"type","button"),y.disabled=O=r[3]=="free-polygon",x(y,"class","svelte-cej5os"),x($,"type","button"),$.disabled=P=r[3]=="snap-polygon",x($,"class","svelte-cej5os"),x(e,"class","toolbox svelte-cej5os")},m(j,ue){S(j,e,ue),w(e,t),w(t,n),w(n,i),w(t,s),H(a,t,null),w(e,l),w(e,u),w(u,c),w(c,g),w(u,f),he&&he.m(u,null),w(e,h),w(e,d),Se&&Se.m(d,null),w(d,_),H(b,d,null),w(e,m),w(e,v),w(v,y),w(y,M),w(v,R),H(L,v,null),w(e,N),w(e,I),w(I,$),w($,W),w(I,D),de&&de.m(I,null),w(e,oe),w(e,fe),Ee&&Ee.m(fe,null),w(fe,q),H(se,fe,null),w(e,Ae),w(e,pe),Me&&Me.m(pe,null),w(pe,ce),H(Pe,pe,null),ne=!0,F||(V=[B(n,"click",r[14]),B(c,"click",r[16]),B(y,"click",r[20]),B($,"click",r[22])],F=!0)},p(j,[ue]){(!ne||ue&8&&o!==(o=j[3]=="edit-attribute"))&&(n.disabled=o);const Tn={};ue&8&&(Tn.mode=j[3]),a.$set(Tn),(!ne||ue&8&&p!==(p=j[3]=="edit-geometry"))&&(c.disabled=p),j[2]?he?(he.p(j,ue),ue&4&&T(he,1)):(he=Sr(j),he.c(),T(he,1),he.m(u,null)):he&&(ve(),A(he,1,1,()=>{he=null}),ye()),j[1]!="planning"?Se?Se.p(j,ue):(Se=Er(j),Se.c(),Se.m(d,_)):Se&&(Se.d(1),Se=null);const Rn={};ue&8&&(Rn.mode=j[3]),b.$set(Rn),(!ne||ue&8&&O!==(O=j[3]=="free-polygon"))&&(y.disabled=O);const An={};ue&8&&(An.mode=j[3]),L.$set(An),(!ne||ue&8&&P!==(P=j[3]=="snap-polygon"))&&($.disabled=P),j[2]?de?(de.p(j,ue),ue&4&&T(de,1)):(de=Mr(j),de.c(),T(de,1),de.m(I,null)):de&&(ve(),A(de,1,1,()=>{de=null}),ye()),j[1]!="planning"?Ee?Ee.p(j,ue):(Ee=Or(j),Ee.c(),Ee.m(fe,q)):Ee&&(Ee.d(1),Ee=null);const Ot={};ue&8&&(Ot.mode=j[3]),ue&1&&(Ot.url=j[0]),!ke&&ue&4&&(ke=!0,Ot.routeTool=j[2],xe(()=>ke=!1)),se.$set(Ot),j[1]!="planning"?Me?Me.p(j,ue):(Me=Lr(j),Me.c(),Me.m(pe,ce)):Me&&(Me.d(1),Me=null);const Pn={};ue&8&&(Pn.mode=j[3]),Pe.$set(Pn)},i(j){ne||(T(a.$$.fragment,j),T(he),T(b.$$.fragment,j),T(L.$$.fragment,j),T(de),T(se.$$.fragment,j),T(Pe.$$.fragment,j),ne=!0)},o(j){A(a.$$.fragment,j),A(he),A(b.$$.fragment,j),A(L.$$.fragment,j),A(de),A(se.$$.fragment,j),A(Pe.$$.fragment,j),ne=!1},d(j){j&&E(e),r[15](null),U(a),he&&he.d(),Se&&Se.d(),r[19](null),U(b),r[21](null),U(L),de&&de.d(),Ee&&Ee.d(),r[25](null),U(se),Me&&Me.d(),r[28](null),U(Pe),F=!1,Ce(V)}}}function ql(r,e,t){let n;ie(r,qe,q=>t(29,n=q));let{routeUrl:i}=e,{schema:o}=e,s,a=new ws(n),l=new Ps(n),u="edit-attribute",c,g,p,f,h,d,_;function b(q){let se={"edit-attribute":c,"edit-geometry":g,route:p,point:f,"free-polygon":h,"snap-polygon":d,"split-route":_};if(u==q){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),se[u].stop(),t(3,u=q),console.log(`Starting new mode ${u}`),se[u].start()}Et(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const m=()=>b("edit-attribute");function v(q){re[q?"unshift":"push"](()=>{c=q,t(4,c)})}const y=()=>b("edit-geometry");function M(q){re[q?"unshift":"push"](()=>{g=q,t(5,g)})}const O=()=>b("point");function R(q){re[q?"unshift":"push"](()=>{f=q,t(7,f)})}const L=()=>b("free-polygon");function N(q){re[q?"unshift":"push"](()=>{h=q,t(8,h)})}const I=()=>b("snap-polygon");function $(q){re[q?"unshift":"push"](()=>{d=q,t(9,d)})}const W=()=>b("route");function P(q){re[q?"unshift":"push"](()=>{p=q,t(6,p)})}function D(q){s=q,t(2,s)}const oe=()=>b("split-route");function fe(q){re[q?"unshift":"push"](()=>{_=q,t(10,_)})}return r.$$set=q=>{"routeUrl"in q&&t(0,i=q.routeUrl),"schema"in q&&t(1,o=q.schema)},[i,o,s,u,c,g,p,f,h,d,_,a,l,b,m,v,y,M,O,R,L,N,I,$,W,P,D,oe,fe]}class Gl extends Z{constructor(e){super(),Q(this,e,ql,Dl,K,{routeUrl:0,schema:1})}}function jl(r){let e,t,n,i,o,s,a,l,u,c,g,p,f,h,d,_,b,m;return{c(){e=k("div"),t=k("div"),n=k("button"),n.textContent="Home",i=C(),o=k("button"),o.textContent="About",s=C(),a=k("button"),a.textContent="Instructions",l=C(),u=k("br"),c=C(),g=k("label"),p=z(`ATIP schema:
      `),f=k("select"),h=k("option"),h.textContent="v1",d=k("option"),d.textContent="v2",_=k("option"),_.textContent="Housing developments",x(n,"type","button"),x(o,"type","button"),x(a,"type","button"),h.__value="v1",h.value=h.__value,d.__value="v2",d.value=d.__value,_.__value="planning",_.value=_.__value,r[2]===void 0&&zt(()=>r[11].call(f)),x(e,"slot","nav")},m(v,y){S(v,e,y),w(e,t),w(t,n),w(t,i),w(t,o),w(t,s),w(t,a),w(e,l),w(e,u),w(e,c),w(e,g),w(g,p),w(g,f),w(f,h),w(f,d),w(f,_),$t(f,r[2]),b||(m=[B(n,"click",r[10]),B(o,"click",r[7]),B(a,"click",r[8]),B(f,"change",r[11]),B(f,"change",r[9])],b=!0)},p(v,y){y&4&&$t(f,v[2])},d(v){v&&E(e),b=!1,Ce(m)}}}function Yl(r){let e,t,n,i,o,s,a,l,u,c,g,p;return o=new as({props:{boundaryGeojson:r[4]}}),a=new is({props:{authorityName:r[5],schema:r[2]}}),g=new Qo({props:{schema:r[2]}}),{c(){e=k("div"),t=k("h1"),n=z(r[5]),i=C(),Y(o.$$.fragment),s=C(),Y(a.$$.fragment),l=C(),u=k("br"),c=C(),Y(g.$$.fragment),x(e,"slot","sidebar")},m(f,h){S(f,e,h),w(e,t),w(t,n),w(t,i),H(o,t,null),w(e,s),H(a,e,null),w(e,l),w(e,u),w(e,c),H(g,e,null),p=!0},p(f,h){const d={};h&16&&(d.boundaryGeojson=f[4]),o.$set(d);const _={};h&4&&(_.schema=f[2]),a.$set(_);const b={};h&4&&(b.schema=f[2]),g.$set(b)},i(f){p||(T(o.$$.fragment,f),T(a.$$.fragment,f),T(g.$$.fragment,f),p=!0)},o(f){A(o.$$.fragment,f),A(a.$$.fragment,f),A(g.$$.fragment,f),p=!1},d(f){f&&E(e),U(o),U(a),U(g)}}}function Hl(r){let e,t,n,i,o,s,a,l,u,c,g,p;return e=new ho({props:{boundaryGeojson:r[4]}}),n=new vs({props:{schema:r[2]}}),o=new bs({}),a=new Gl({props:{routeUrl:r[3],schema:r[2]}}),u=new cs({props:{style:r[6]}}),g=new _s({props:{schema:r[2]}}),{c(){Y(e.$$.fragment),t=C(),Y(n.$$.fragment),i=C(),Y(o.$$.fragment),s=C(),Y(a.$$.fragment),l=C(),Y(u.$$.fragment),c=C(),Y(g.$$.fragment)},m(f,h){H(e,f,h),S(f,t,h),H(n,f,h),S(f,i,h),H(o,f,h),S(f,s,h),H(a,f,h),S(f,l,h),H(u,f,h),S(f,c,h),H(g,f,h),p=!0},p(f,h){const d={};h&16&&(d.boundaryGeojson=f[4]),e.$set(d);const _={};h&4&&(_.schema=f[2]),n.$set(_);const b={};h&8&&(b.routeUrl=f[3]),h&4&&(b.schema=f[2]),a.$set(b);const m={};h&4&&(m.schema=f[2]),g.$set(m)},i(f){p||(T(e.$$.fragment,f),T(n.$$.fragment,f),T(o.$$.fragment,f),T(a.$$.fragment,f),T(u.$$.fragment,f),T(g.$$.fragment,f),p=!0)},o(f){A(e.$$.fragment,f),A(n.$$.fragment,f),A(o.$$.fragment,f),A(a.$$.fragment,f),A(u.$$.fragment,f),A(g.$$.fragment,f),p=!1},d(f){U(e,f),f&&E(t),U(n,f),f&&E(i),U(o,f),f&&E(s),U(a,f),f&&E(l),U(u,f),f&&E(c),U(g,f)}}}function Ul(r){let e,t,n;return t=new Fi({props:{style:r[6],$$slots:{default:[Hl]},$$scope:{ctx:r}}}),{c(){e=k("div"),Y(t.$$.fragment),x(e,"slot","main")},m(i,o){S(i,e,o),H(t,e,null),n=!0},p(i,o){const s={};o&131100&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(T(t.$$.fragment,i),n=!0)},o(i){A(t.$$.fragment,i),n=!1},d(i){i&&E(e),U(t)}}}function Jl(r){let e,t,n,i,o,s,a,l;e=new qi({props:{$$slots:{main:[Ul],sidebar:[Yl],nav:[jl]},$$scope:{ctx:r}}});function u(f){r[12](f)}let c={};r[0]!==void 0&&(c.open=r[0]),n=new Oi({props:c}),re.push(()=>Le(n,"open",u,r[0]));function g(f){r[13](f)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new Ri({props:p}),re.push(()=>Le(s,"open",g,r[1])),{c(){Y(e.$$.fragment),t=C(),Y(n.$$.fragment),o=C(),Y(s.$$.fragment)},m(f,h){H(e,f,h),S(f,t,h),H(n,f,h),S(f,o,h),H(s,f,h),l=!0},p(f,[h]){const d={};h&131100&&(d.$$scope={dirty:h,ctx:f}),e.$set(d);const _={};!i&&h&1&&(i=!0,_.open=f[0],xe(()=>i=!1)),n.$set(_);const b={};!a&&h&2&&(a=!0,b.open=f[1],xe(()=>a=!1)),s.$set(b)},i(f){l||(T(e.$$.fragment,f),T(n.$$.fragment,f),T(s.$$.fragment,f),l=!0)},o(f){A(e.$$.fragment,f),A(n.$$.fragment,f),A(s.$$.fragment,f),l=!1},d(f){U(e,f),f&&E(t),U(n,f),f&&E(o),U(s,f)}}}function Xl(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var c=`https://atip.uk/route-snappers/${a}.bin`;o||(c=`https://atip.uk/route-snappers-dev/${a}.bin`);function g(){t(0,n=!n),t(1,i=!1)}function p(){t(1,i=!i),t(0,n=!1)}let f;Sn(async()=>{t(4,f=await h())});async function h(){const M=await(await fetch(Li)).text(),O=JSON.parse(M);return O.features=O.features.filter(R=>{var L;return((L=R.properties)==null?void 0:L.name)==a}),O}function d(){let y=new URLSearchParams(window.location.search);y.set("schema",u);let M=`${window.location.pathname}?${y.toString()}${window.location.hash}`;window.location.href=M}const _=()=>window.open("index.html");function b(){u=Tr(this),t(2,u)}function m(y){n=y,t(0,n)}function v(y){i=y,t(1,i)}return[n,i,u,c,f,a,l,g,p,d,_,b,m,v]}class zl extends Z{constructor(e){super(),Q(this,e,Xl,Jl,K,{})}}new zl({target:document.getElementById("app")});
