var li=Object.defineProperty;var ai=(r,e,t)=>e in r?li(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ee=(r,e,t)=>(ai(r,typeof e!="symbol"?e+"":e,t),t);import{S as Z,i as Q,s as K,M as ui,b as re,a as Le,d as Y,m as H,k as xe,n as T,o as A,q as U,e as E,c as C,g as k,x as j,p as S,y as De,f as x,z as ve,B as ye,C as fi,D as Sn,E as tn,F as Et,G as ht,H as dt,I as mt,J as _t,K as Fn,h as w,l as B,L as ci,N as pi,O as ie,P as hi,w as En,Q as Ze,R as be,T as Xt,t as X,U as ge,V as ae,j as Te,r as Ce,W as He,X as Cr,Y as Tr,Z as zt,_ as Nt,$ as Nn,a0 as $n,a1 as di,a2 as mi,a3 as Fe,a4 as _i,a5 as gi,a6 as vi,a7 as $t,a8 as Rr,a9 as Wt,aa as ut,ab as Vt,ac as wt,ad as Kt,ae as an,af as yi,ag as st,ah as Mn,ai as We,aj as lt,ak as bi,al as On,am as wi,an as ki,ao as Si,ap as In,aq as It,ar as Ei,as as Mi,at as Oi,A as Li,u as xi}from"./authorities-af3bfe53.js";function Ci(r){let e,t,n,i,o,s,a,l,u,p,g,c,f;return{c(){e=E("p"),e.textContent="For each intervention:",t=C(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=C(),o=E("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=C(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=C(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=C(),g=E("p"),g.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=C(),f=E("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(h,m){k(h,e,m),k(h,t,m),k(h,n,m),k(h,i,m),k(h,o,m),k(h,s,m),k(h,a,m),k(h,l,m),k(h,u,m),k(h,p,m),k(h,g,m),k(h,c,m),k(h,f,m)},p:j,d(h){h&&S(e),h&&S(t),h&&S(n),h&&S(i),h&&S(o),h&&S(s),h&&S(a),h&&S(l),h&&S(u),h&&S(p),h&&S(g),h&&S(c),h&&S(f)}}}function Ti(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Ci]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new ui({props:o}),re.push(()=>Le(e,"open",i,r[0])),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],xe(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Ri(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Ai extends Z{constructor(e){super(),Q(this,e,Ri,Ti,K,{open:0})}}const Qe=[];function ft(r,e=j){let t;const n=new Set;function i(a){if(K(r,a)&&(r=a,t)){const l=!Qe.length;for(const u of n)u[1](),Qe.push(u,r);if(l){for(let u=0;u<Qe.length;u+=2)Qe[u][0](Qe[u+1]);Qe.length=0}}}function o(a){i(a(r))}function s(a,l=j){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||j),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ge=ft(null),te=ft(De()),Oe=ft(null),Ye=ft(null),Bt=ft(null),un=ft(null);function Mt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Bn(r){te.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Oe.set(null),Ye.set(null),Bt.set(null)}function Dn(r){let e;const t=r[4].default,n=ht(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&dt(n,t,i,i[3],e?_t(t,i[3],o,null):mt(i[3]),null)},i(i){e||(T(n,i),e=!0)},o(i){A(n,i),e=!1},d(i){n&&n.d(i)}}}function Pi(r){let e,t,n=r[1]&&Dn(r);return{c(){e=E("div"),n&&n.c(),x(e,"class","map svelte-12dpf1u")},m(i,o){k(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&T(n,1)):(n=Dn(i),n.c(),T(n,1),n.m(e,null)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(T(n),t=!0)},o(i){A(n),t=!1},d(i){i&&S(e),n&&n.d(),r[5](null)}}}function Fi(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;fi("setCamera",!window.location.hash),Sn(()=>{s=new tn.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new tn.ScaleControl({})),s.addControl(new tn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ge.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),Et(()=>{s.remove()});function u(p){re[p?"unshift":"push"](()=>{a=p,t(0,a)})}return r.$$set=p=>{"style"in p&&t(2,o=p.style),"$$scope"in p&&t(3,i=p.$$scope)},[a,l,o,i,n,u]}class Ni extends Z{constructor(e){super(),Q(this,e,Fi,Pi,K,{style:2})}}const $i=r=>({}),Gn=r=>({}),Ii=r=>({}),qn=r=>({}),Bi=r=>({}),jn=r=>({});function Di(r){let e,t,n,i,o,s,a,l,u,p,g,c;const f=r[3].nav,h=ht(f,r,r[2],jn),m=r[3].sidebar,_=ht(m,r,r[2],qn),b=r[3].main,d=ht(b,r,r[2],Gn);return{c(){e=E("aside"),t=E("div"),n=E("nav"),h&&h.c(),i=C(),_&&_.c(),o=C(),s=E("button"),s.textContent="â†’",l=C(),u=E("main"),d&&d.c(),x(n,"class","svelte-1u7vg8a"),x(t,"class","sidebar-content content-container svelte-1u7vg8a"),x(s,"type","button"),x(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),x(e,"class",a=Fn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),x(u,"class","svelte-1u7vg8a")},m(v,y){k(v,e,y),w(e,t),w(t,n),h&&h.m(n,null),w(t,i),_&&_.m(t,null),w(e,o),w(e,s),k(v,l,y),k(v,u,y),d&&d.m(u,null),p=!0,g||(c=B(s,"click",r[1]),g=!0)},p(v,[y]){h&&h.p&&(!p||y&4)&&dt(h,f,v,v[2],p?_t(f,v[2],y,Bi):mt(v[2]),jn),_&&_.p&&(!p||y&4)&&dt(_,m,v,v[2],p?_t(m,v[2],y,Ii):mt(v[2]),qn),(!p||y&1&&a!==(a=Fn(v[0]?"":"collapsed")+" svelte-1u7vg8a"))&&x(e,"class",a),d&&d.p&&(!p||y&4)&&dt(d,b,v,v[2],p?_t(b,v[2],y,$i):mt(v[2]),Gn)},i(v){p||(T(h,v),T(_,v),T(d,v),p=!0)},o(v){A(h,v),A(_,v),A(d,v),p=!1},d(v){v&&S(e),h&&h.d(v),_&&_.d(v),v&&S(l),v&&S(u),d&&d.d(v),g=!1,c()}}}function Gi(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class qi extends Z{constructor(e){super(),Q(this,e,Gi,Di,K,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function ji(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ke=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Yi(r,e){return r>e?1:r<e?-1:0}function Ue(r,e,t){for(var n=new Ke(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function nn(r,e,t,n){var i=new Ke(r,e);if(t===null)return i.left=i.right=null,i;t=Ue(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Yn(r,e,t){var n=null,i=null;if(e){e=Ue(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Hi(r,e,t){return e===null?r:(r===null||(e=Ue(r.key,e,t),e.left=r),e)}function fn(r,e,t,n,i){if(r){n(""+e+(t?"â””â”€â”€ ":"â”œâ”€â”€ ")+i(r)+`
`);var o=e+(t?"    ":"â”‚   ");r.left&&fn(r.left,o,!1,n,i),r.right&&fn(r.right,o,!0,n,i)}}var Ln=function(){function r(e){e===void 0&&(e=Yi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=nn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ke(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ue(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ue(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ue(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ue(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ue(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Ji(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&hn(e,t,0,i-1,o),this._root===null)this._root=cn(e,t,0,i),this._size=i;else{var s=Xi(this.toList(),Ui(e,t),o);i=this._size+i,this._root=pn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return fn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Yn(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=nn(t,n,a,i):s=nn(t,n,s,i),this._root=Hi(s,a,i)},r.prototype.split=function(e){return Yn(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return ji(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function cn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ke(s,a);return l.left=cn(r,e,t,o),l.right=cn(r,e,o+1,n),l}return null}function Ui(r,e){for(var t=new Ke(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ke(r[i],e[i]);return n.next=null,t.next}function Ji(r){for(var e=r,t=[],n=!1,i=new Ke(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function pn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=pn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=pn(r,i+1,t),s}return null}function Xi(r,e,t){for(var n=new Ke(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function hn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}hn(r,e,t,a,i),hn(r,e,a+1,n,i)}}function Re(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Hn(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function we(r,e,t){return e&&Hn(r.prototype,e),t&&Hn(r,t),r}var ct=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},dn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Xe=Number.EPSILON;Xe===void 0&&(Xe=Math.pow(2,-52));var zi=Xe*Xe,mn=function(e,t){if(-Xe<e&&e<Xe&&-Xe<t&&t<Xe)return 0;var n=e-t;return n*n<zi*e*t?0:e<t?-1:1},Wi=function(){function r(){Re(this,r),this.reset()}return we(r,[{key:"reset",value:function(){this.xRounder=new Un,this.yRounder=new Un}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Un=function(){function r(){Re(this,r),this.tree=new Ln,this.round(0)}return we(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&mn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&mn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),kt=new Wi,gt=function(e,t){return e.x*t.y-e.y*t.x},Ar=function(e,t){return e.x*t.x+e.y*t.y},Jn=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=gt(i,o);return mn(s,0)},Dt=function(e){return Math.sqrt(Ar(e,e))},Vi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return gt(o,i)/Dt(o)/Dt(i)},Ki=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Ar(o,i)/Dt(o)/Dt(i)},Xn=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},zn=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},Zi=function(e,t,n,i){if(t.x===0)return zn(n,i,e.x);if(i.x===0)return zn(e,t,n.x);if(t.y===0)return Xn(n,i,e.y);if(i.y===0)return Xn(e,t,n.y);var o=gt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=gt(s,t)/o,l=gt(s,i)/o,u=e.x+l*t.x,p=n.x+a*i.x,g=e.y+l*t.y,c=n.y+a*i.y,f=(u+p)/2,h=(g+c)/2;return{x:f,y:h}},Ie=function(){we(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Gt.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Re(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return we(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:Vi(n.point,t.point,l.point),cosine:Ki(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,p=l.cosine,g=i.get(a),c=g.sine,f=g.cosine;return u>=0&&c>=0?p<f?1:p>f?-1:0:u<0&&c<0?p<f?-1:p>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),Qi=0,Gt=function(){we(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,g=n.rightSE.point.y;if(i<o){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<g)return-1;if(l>u&&l>g)return 1;var h=n.comparePoint(t.leftSE.point);if(h!==0)return h;var m=t.comparePoint(n.rightSE.point);return m<0?1:m>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>a){var b=t.comparePoint(n.rightSE.point);if(b<0)return 1;if(b>0)return-1}if(s!==a){var d=p-l,v=s-i,y=g-u,M=a-o;if(d>v&&y<M)return 1;if(d<v&&y>M)return-1}return s>a?1:s<a||p<g?-1:p>g?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Re(this,r),this.id=++Qi,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return we(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=dn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=ct(n,l)&&this.comparePoint(l)===0,g=ct(i,s)&&t.comparePoint(s)===0,c=ct(n,u)&&this.comparePoint(u)===0,f=ct(i,a)&&t.comparePoint(a)===0;if(g&&p)return f&&!c?a:!f&&c?u:null;if(g)return c&&s.x===u.x&&s.y===u.y?null:s;if(p)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var h=Zi(s,this.vector(),l,t.vector());return h===null||!ct(o,h)?null:kt.round(h.x,h.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Ie(t,!0),s=new Ie(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Ie.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ie.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var p=i.rings[l],g=i.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(g)):n.windings[c]+=g}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),i.push(u)):i[p]+=u}for(var g=[],c=[],f=0,h=n.length;f<h;f++)if(i[f]!==0){var m=n[f],_=m.poly;if(c.indexOf(_)===-1)if(m.isExterior)g.push(_);else{c.indexOf(_)===-1&&c.push(_);var b=g.indexOf(m.poly);b!==-1&&g.splice(b,1)}}for(var d=0,v=g.length;d<v;d++){var y=g[d].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ne.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Ne.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(g){return g.length===1&&g[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ne.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Ie.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Ie(o,!0),p=new Ie(s,!1);return new r(u,p,[i],[a])}}]),r}(),Wn=function(){function r(e,t,n){if(Re(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=kt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=kt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(Gt.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Gt.fromRing(o,i,this))}return we(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),eo=function(){function r(e,t){if(Re(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Wn(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Wn(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return we(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Vn=function(){function r(e,t){if(Re(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new eo(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return we(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),to=function(){we(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],g=l.point,c=[];a=l,l=u,p.push(l),l.point!==g;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var h=p[0].point,m=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(m.x,", ").concat(m.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var _=null,b=0,d=c.length;b<d;b++)if(c[b].point===l.point){_=b;break}if(_!==null){var v=c.splice(_)[0],y=p.splice(v.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}c.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Re(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return we(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Jn(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Jn(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,g=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],h=g;h!=c;h+=p)f.push([n[h].x,n[h].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Ie.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Kn=function(){function r(e){Re(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return we(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),no=function(){function r(e){Re(this,r),this.rings=e,this.polys=this._composePolys(e)}return we(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Kn(s));else{var a=s.enclosingRing();a.poly||n.push(new Kn(a)),a.poly.addInterior(s)}}return n}}]),r}(),ro=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gt.compare;Re(this,r),this.queue=e,this.tree=new Ln(t),this.segments=[]}return we(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var g=l.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(p=g),!l.isAnEndpoint(g)))for(var c=this._splitSafely(l,g),f=0,h=c.length;f<h;f++)i.push(c[f])}var m=null;if(u){var _=u.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(m=_),!u.isAnEndpoint(_)))for(var b=this._splitSafely(u,_),d=0,v=b.length;d<v;d++)i.push(b[d])}if(p!==null||m!==null){var y=null;if(p===null)y=m;else if(m===null)y=p;else{var M=Ie.comparePoints(p,m);y=M<=0?p:m}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var O=n.split(y),R=0,L=O.length;R<L;R++)i.push(O[R])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var N=l.getIntersection(u);if(N!==null){if(!l.isAnEndpoint(N))for(var I=this._splitSafely(l,N),$=0,W=I.length;$<W;$++)i.push(I[$]);if(!u.isAnEndpoint(N))for(var P=this._splitSafely(u,N),D=0,oe=P.length;D<oe;D++)i.push(P[D])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Zn=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,io=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,oo=function(){function r(){Re(this,r)}return we(r,[{key:"run",value:function(t,n,i){Ne.type=t,kt.reset();for(var o=[new Vn(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Vn(i[s],!1));if(Ne.numMultiPolys=o.length,Ne.type==="difference")for(var l=o[0],u=1;u<o.length;)dn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Ne.type==="intersection"){for(var p=0,g=o.length;p<g;p++)for(var c=o[p],f=p+1,h=o.length;f<h;f++)if(dn(c.bbox,o[f].bbox)===null)return[]}for(var m=new Ln(Ie.compare),_=0,b=o.length;_<b;_++)for(var d=o[_].getSweepEvents(),v=0,y=d.length;v<y;v++)if(m.insert(d[v]),m.size>Zn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new ro(m),O=m.size,R=m.pop();R;){var L=R.key;if(m.size===O){var N=L.segment;throw new Error("Unable to pop() ".concat(L.isLeft?"left":"right"," SweepEvent ")+"[".concat(L.point.x,", ").concat(L.point.y,"] from segment #").concat(N.id," ")+"[".concat(N.leftSE.point.x,", ").concat(N.leftSE.point.y,"] -> ")+"[".concat(N.rightSE.point.x,", ").concat(N.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(m.size>Zn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>io)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var I=M.process(L),$=0,W=I.length;$<W;$++){var P=I[$];P.consumedBy===void 0&&m.insert(P)}O=m.size,R=m.pop()}kt.reset();var D=to.factory(M.segments),oe=new no(D);return oe.getGeom()}}]),r}(),Ne=new oo,so=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ne.run("union",e,n)},lo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ne.run("intersection",e,n)},ao=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ne.run("xor",e,n)},uo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ne.run("difference",e,n)},Ct={union:so,intersection:lo,xor:ao,difference:uo};function fo(r,e){var t=po(e),n=null;return r.type==="FeatureCollection"?n=co(r):n=Pr(Ct.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function co(r){var e=r.features.length===2?Ct.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Ct.union.apply(Ct,r.features.map(function(t){return t.geometry.coordinates}));return Pr(e)}function Pr(r){return ci(r)}function po(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return pi(t)}function ho(r,e,t){let n;ie(r,Ge,s=>t(1,n=s));let{boundaryGeojson:i}=e;return hi("setCamera")&&n.fitBounds(En(i),{padding:20,animate:!1}),Ze(n,"boundary",{type:"geojson",data:fo(i)}),be(n,{id:"boundary",source:"boundary",...Xt("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class mo extends Z{constructor(e){super(),Q(this,e,ho,null,K,{boundaryGeojson:0})}}function Qn(r){let e,t=er(r[3])+"",n;return{c(){e=X("Length: "),n=X(t)},m(i,o){k(i,e,o),k(i,n,o)},p(i,o){o&8&&t!==(t=er(i[3])+"")&&He(n,t)},d(i){i&&S(e),i&&S(n)}}}function _o(r){let e,t,n,i,o,s,a,l,u,p,g,c,f,h,m,_,b,d,v,y,M,O,R,L,N,I,$,W,P,D,oe,fe,G,se,ke,Ae,pe,ce,Pe,ne=r[3]&&Qn(r);return{c(){e=E("label"),t=X("Name:"),n=E("br"),i=C(),o=E("input"),s=C(),a=E("br"),l=C(),u=E("br"),p=C(),g=E("label"),c=E("input"),f=X(`
  Area`),h=C(),m=E("label"),_=E("input"),b=X(`
  Route`),d=C(),v=E("label"),y=E("input"),M=X(`
  Crossing`),O=C(),R=E("label"),L=E("input"),N=X(`
  Other`),I=C(),$=E("br"),W=C(),P=E("br"),D=C(),oe=E("label"),fe=X("Description:"),G=E("br"),se=C(),ke=E("textarea"),Ae=C(),ne&&ne.c(),pe=ge(),x(o,"type","text"),ae(o,"width","100%"),x(c,"type","radio"),c.__value="area",c.value=c.__value,r[6][0].push(c),x(_,"type","radio"),_.__value="route",_.value=_.__value,r[6][0].push(_),x(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[6][0].push(y),x(L,"type","radio"),L.__value="other",L.value=L.__value,r[6][0].push(L),ae(ke,"width","100%"),x(ke,"rows","5"),x(ke,"class","svelte-15lna0i")},m(F,V){k(F,e,V),w(e,t),w(e,n),w(e,i),w(e,o),Te(o,r[0]),k(F,s,V),k(F,a,V),k(F,l,V),k(F,u,V),k(F,p,V),k(F,g,V),w(g,c),c.checked=c.__value===r[1],w(g,f),k(F,h,V),k(F,m,V),w(m,_),_.checked=_.__value===r[1],w(m,b),k(F,d,V),k(F,v,V),w(v,y),y.checked=y.__value===r[1],w(v,M),k(F,O,V),k(F,R,V),w(R,L),L.checked=L.__value===r[1],w(R,N),k(F,I,V),k(F,$,V),k(F,W,V),k(F,P,V),k(F,D,V),k(F,oe,V),w(oe,fe),w(oe,G),w(oe,se),w(oe,ke),Te(ke,r[2]),k(F,Ae,V),ne&&ne.m(F,V),k(F,pe,V),ce||(Pe=[B(o,"input",r[4]),B(c,"change",r[5]),B(_,"change",r[7]),B(y,"change",r[8]),B(L,"change",r[9]),B(ke,"input",r[10])],ce=!0)},p(F,[V]){V&1&&o.value!==F[0]&&Te(o,F[0]),V&2&&(c.checked=c.__value===F[1]),V&2&&(_.checked=_.__value===F[1]),V&2&&(y.checked=y.__value===F[1]),V&2&&(L.checked=L.__value===F[1]),V&4&&Te(ke,F[2]),F[3]?ne?ne.p(F,V):(ne=Qn(F),ne.c(),ne.m(pe.parentNode,pe)):ne&&(ne.d(1),ne=null)},i:j,o:j,d(F){F&&S(e),F&&S(s),F&&S(a),F&&S(l),F&&S(u),F&&S(p),F&&S(g),r[6][0].splice(r[6][0].indexOf(c),1),F&&S(h),F&&S(m),r[6][0].splice(r[6][0].indexOf(_),1),F&&S(d),F&&S(v),r[6][0].splice(r[6][0].indexOf(y),1),F&&S(O),F&&S(R),r[6][0].splice(r[6][0].indexOf(L),1),F&&S(I),F&&S($),F&&S(W),F&&S(P),F&&S(D),F&&S(oe),F&&S(Ae),ne&&ne.d(F),F&&S(pe),ce=!1,Ce(Pe)}}}function er(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function go(r,e,t){let{name:n}=e,{intervention_type:i}=e,{description:o}=e,{length_meters:s}=e;const a=[[]];function l(){n=this.value,t(0,n)}function u(){i=this.__value,t(1,i)}function p(){i=this.__value,t(1,i)}function g(){i=this.__value,t(1,i)}function c(){i=this.__value,t(1,i)}function f(){o=this.value,t(2,o)}return r.$$set=h=>{"name"in h&&t(0,n=h.name),"intervention_type"in h&&t(1,i=h.intervention_type),"description"in h&&t(2,o=h.description),"length_meters"in h&&t(3,s=h.length_meters)},[n,i,o,s,l,u,a,p,g,c,f]}class vo extends Z{constructor(e){super(),Q(this,e,go,_o,K,{name:0,intervention_type:1,description:2,length_meters:3})}}const yo="Intervention",bo=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],wo={name:yo,oneOf:bo};function ko(r){const e=r-1;return e*e*e+1}function qt(r,{delay:e=0,duration:t=400,easing:n=ko}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),p=parseFloat(i.marginBottom),g=parseFloat(i.borderTopWidth),c=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*p}px;border-top-width: ${f*g}px;border-bottom-width: ${f*c}px;`}}function Fr(r){return"members"in r}function Nr(r){return"oneOf"in r}function $r(r){return typeof r=="string"}function Ir(r){return typeof r=="object"&&"value"in r}function So(r){return"type"in r&&r.type=="number"}function Br(r){return"type"in r&&r.type=="one-liner"}function Dr(r){return"type"in r&&r.type=="textbox"}function Gr(r){return"type"in r&&r.type=="checkbox"}function tr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function nr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function rr(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=X(t),x(e,"class","svelte-1b72l00")},m(i,o){k(i,e,o),w(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&He(n,t)},d(i){i&&S(e)}}}function Eo(r){let e,t,n;return{c(){e=E("input"),x(e,"type","checkbox")},m(i,o){k(i,e,o),e.checked=r[0],t||(n=B(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:j,o:j,d(i){i&&S(e),t=!1,n()}}}function Mo(r){let e,t,n;return{c(){e=E("textarea"),ae(e,"width","100%"),x(e,"rows","5"),x(e,"class","svelte-1b72l00")},m(i,o){k(i,e,o),Te(e,r[0]),t||(n=B(e,"input",r[13]),t=!0)},p(i,o){o&1&&Te(e,i[0])},i:j,o:j,d(i){i&&S(e),t=!1,n()}}}function Oo(r){let e,t,n;return{c(){e=E("input"),x(e,"type","text"),ae(e,"width","100%")},m(i,o){k(i,e,o),Te(e,r[0]),t||(n=B(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Te(e,i[0])},i:j,o:j,d(i){i&&S(e),t=!1,n()}}}function Lo(r){let e,t,n;return{c(){e=E("input"),x(e,"type","number")},m(i,o){k(i,e,o),Te(e,r[0]),t||(n=B(e,"input",r[11]),t=!0)},p(i,o){o&1&&Cr(e.value)!==i[0]&&Te(e,i[0])},i:j,o:j,d(i){i&&S(e),t=!1,n()}}}function xo(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=or(tr(r,n,s));const o=s=>A(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);k(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=tr(s,n,l);i[l]?(i[l].p(u,a),T(i[l],1)):(i[l]=or(u),i[l].c(),T(i[l],1),i[l].m(e.parentNode,e))}for(ve(),l=n.length;l<i.length;l+=1)o(l);ye()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)T(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)A(i[a]);t=!1},d(s){Tr(i,s),s&&S(e)}}}function Co(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=sr(nr(r,n,s));const o=s=>A(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ge()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);k(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=nr(s,n,l);i[l]?(i[l].p(u,a),T(i[l],1)):(i[l]=sr(u),i[l].c(),T(i[l],1),i[l].m(e.parentNode,e))}for(ve(),l=n.length;l<i.length;l+=1)o(l);ye()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)T(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)A(i[a]);t=!1},d(s){Tr(i,s),s&&S(e)}}}function To(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,p,g,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&ir(r);return{c(){e=E("label"),t=E("input"),i=C(),s=X(o),a=E("br"),l=C(),f&&f.c(),u=ge(),x(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(h,m){k(h,e,m),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),k(h,l,m),f&&f.m(h,m),k(h,u,m),p=!0,g||(c=[B(t,"change",r[9]),B(t,"change",r[4])],g=!0)},p(h,m){(!p||m&2&&n!==(n=h[15].name))&&(t.__value=n,t.value=t.__value),m&4&&(t.checked=t.__value===h[2]),(!p||m&2)&&o!==(o=h[15].name+"")&&He(s,o),h[2]==h[15].name&&typeof h[0]=="object"?f?(f.p(h,m),m&7&&T(f,1)):(f=ir(h),f.c(),T(f,1),f.m(u.parentNode,u)):f&&(ve(),A(f,1,1,()=>{f=null}),ye())},i(h){p||(T(f),p=!0)},o(h){A(f),p=!1},d(h){h&&S(e),r[7][0].splice(r[7][0].indexOf(t),1),h&&S(l),f&&f.d(h),h&&S(u),g=!1,Ce(c)}}}function Ro(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,p;function g(h,m){return h[15].description?Fo:Po}let c=g(r),f=c(r);return{c(){e=E("label"),t=E("input"),i=C(),s=X(o),a=C(),f.c(),l=C(),x(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(h,m){k(h,e,m),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),f.m(e,null),w(e,l),u||(p=[B(t,"change",r[8]),B(t,"change",r[3])],u=!0)},p(h,m){m&2&&n!==(n=h[15].value)&&(t.__value=n,t.value=t.__value),m&4&&(t.checked=t.__value===h[2]),m&2&&o!==(o=h[15].value+"")&&He(s,o),c===(c=g(h))&&f?f.p(h,m):(f.d(1),f=c(h),f&&(f.c(),f.m(e,l)))},i:j,o:j,d(h){h&&S(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Ce(p)}}}function Ao(r){let e,t,n,i,o=r[15]+"",s,a,l,u,p,g;return{c(){e=E("label"),t=E("input"),i=C(),s=X(o),a=C(),l=E("br"),u=C(),x(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){k(c,e,f),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),w(e,l),w(e,u),p||(g=[B(t,"change",r[6]),B(t,"change",r[3])],p=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&o!==(o=c[15]+"")&&He(s,o)},i:j,o:j,d(c){c&&S(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,Ce(g)}}}function ir(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Zt({props:l}),re.push(()=>Le(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),Y(t.$$.fragment),i=C(),x(e,"class","svelte-1b72l00")},m(u,p){k(u,e,p),H(t,e,null),w(e,i),s=!0},p(u,p){r=u;const g={};p&2&&(g.spec=r[15]),!n&&p&3&&(n=!0,g.value=r[0][r[15].name],xe(()=>n=!1)),t.$set(g)},i(u){s||(T(t.$$.fragment,u),zt(()=>{o||(o=Nt(e,qt,{duration:500},!0)),o.run(1)}),s=!0)},o(u){A(t.$$.fragment,u),o||(o=Nt(e,qt,{duration:500},!1)),o.run(0),s=!1},d(u){u&&S(e),U(t),u&&o&&o.end()}}}function Po(r){let e;return{c(){e=E("br")},m(t,n){k(t,e,n)},p:j,d(t){t&&S(e)}}}function Fo(r){let e,t,n=r[15].description+"",i,o;return{c(){e=E("p"),t=X("("),i=X(n),o=X(")"),x(e,"class","svelte-1b72l00")},m(s,a){k(s,e,a),w(e,t),w(e,i),w(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&He(i,n)},d(s){s&&S(e)}}}function or(r){let e,t,n,i,o,s;const a=[Ao,Ro,To],l=[];function u(p,g){return g&2&&(e=null),g&2&&(t=null),e==null&&(e=!!$r(p[15])),e?0:(t==null&&(t=!!Ir(p[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=ge()},m(p,g){l[n].m(p,g),k(p,o,g),s=!0},p(p,g){let c=n;n=u(p,g),n===c?l[n].p(p,g):(ve(),A(l[c],1,1,()=>{l[c]=null}),ye(),i=l[n],i?i.p(p,g):(i=l[n]=a[n](p),i.c()),T(i,1),i.m(o.parentNode,o))},i(p){s||(T(i),s=!0)},o(p){A(i),s=!1},d(p){l[n].d(p),p&&S(o)}}}function sr(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function p(c){r[5](c,r[15])}let g={spec:r[15]};return r[0][r[15].name]!==void 0&&(g.value=r[0][r[15].name]),s=new Zt({props:g}),re.push(()=>Le(s,"value",p,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),i=X(n),o=C(),Y(s.$$.fragment),l=C(),x(e,"class","svelte-1b72l00")},m(c,f){k(c,e,f),w(e,t),w(t,i),w(e,o),H(s,e,null),w(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&He(i,n);const h={};f&2&&(h.spec=r[15]),!a&&f&3&&(a=!0,h.value=r[0][r[15].name],xe(()=>a=!1)),s.$set(h)},i(c){u||(T(s.$$.fragment,c),u=!0)},o(c){A(s.$$.fragment,c),u=!1},d(c){c&&S(e),U(s)}}}function No(r){let e,t,n,i,o,s,a,l,u,p,g,c=r[1].description&&rr(r);const f=[Co,xo,Lo,Oo,Mo,Eo],h=[];function m(_,b){return b&2&&(t=null),b&2&&(n=null),b&2&&(i=null),b&2&&(o=null),b&2&&(s=null),b&2&&(a=null),t==null&&(t=!!Fr(_[1])),t?0:(n==null&&(n=!!Nr(_[1])),n?1:(i==null&&(i=!!So(_[1])),i?2:(o==null&&(o=!!Br(_[1])),o?3:(s==null&&(s=!!Dr(_[1])),s?4:(a==null&&(a=!!Gr(_[1])),a?5:-1)))))}return~(l=m(r,-1))&&(u=h[l]=f[l](r)),{c(){c&&c.c(),e=C(),u&&u.c(),p=ge()},m(_,b){c&&c.m(_,b),k(_,e,b),~l&&h[l].m(_,b),k(_,p,b),g=!0},p(_,[b]){_[1].description?c?c.p(_,b):(c=rr(_),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let d=l;l=m(_,b),l===d?~l&&h[l].p(_,b):(u&&(ve(),A(h[d],1,1,()=>{h[d]=null}),ye()),~l?(u=h[l],u?u.p(_,b):(u=h[l]=f[l](_),u.c()),T(u,1),u.m(p.parentNode,p)):u=null)},i(_){g||(T(u),g=!0)},o(_){A(u),g=!1},d(_){c&&c.d(_),_&&S(e),~l&&h[l].d(_),_&&S(p)}}}function $o(r,e,t){var d,v,y;let{spec:n}=e,{value:i}=e,o="";if(Fr(n)){i||(i={});for(let M of n.members)Br(M)||Dr(M)?i[d=M.name]||(i[d]=""):Gr(M)?i[v=M.name]||(i[v]=!1):i[y=M.name]||(i[y]={})}else Nr(n)&&(i||(i={}),$r(i)?o=i:Ir(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,O){r.$$.not_equal(i[O.name],M)&&(i[O.name]=M,t(0,i))}function p(){o=this.__value,t(2,o)}function g(){o=this.__value,t(2,o)}function c(){o=this.__value,t(2,o)}function f(M,O){r.$$.not_equal(i[O.name],M)&&(i[O.name]=M,t(0,i))}function h(){i=Cr(this.value),t(0,i)}function m(){i=this.value,t(0,i)}function _(){i=this.value,t(0,i)}function b(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,p,l,g,c,f,h,m,_,b]}class Zt extends Z{constructor(e){super(),Q(this,e,$o,No,K,{spec:1,value:0})}}function Io(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Zt({props:o}),re.push(()=>Le(e,"value",i,r[0].v2)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,xe(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Bo(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=wo;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Do extends Z{constructor(e){super(),Q(this,e,Bo,Io,K,{props:0})}}const Go="Planning",qo=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],jo={name:Go,members:qo};function Yo(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Zt({props:o}),re.push(()=>Le(e,"value",i,r[0].planning)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,xe(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Ho(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=jo;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Uo extends Z{constructor(e){super(),Q(this,e,Ho,Yo,K,{props:0})}}function lr(r){let e,t,n,i,o;const s=r[10].default,a=ht(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),ae(e,"border","solid 1px black"),ae(e,"padding","10px")},m(l,u){k(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=B(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&dt(a,s,l,l[9],n?_t(s,l[9],u,null):mt(l[9]),null)},i(l){n||(T(a,l),zt(()=>{t||(t=Nt(e,qt,{duration:100},!0)),t.run(1)}),n=!0)},o(l){A(a,l),t||(t=Nt(e,qt,{duration:100},!1)),t.run(0),n=!1},d(l){l&&S(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Jo(r){let e,t,n,i,o,s,a,l,u,p,g=r[4]&&lr(r);return{c(){e=E("button"),t=Nn("svg"),n=Nn("path"),i=C(),o=X(r[1]),s=C(),g&&g.c(),a=ge(),x(n,"d","M9 5l7 7-7 7"),x(t,"style","tran"),x(t,"width","20"),x(t,"height","20"),x(t,"fill","none"),x(t,"stroke-linecap","round"),x(t,"stroke-linejoin","round"),x(t,"stroke-width","2"),x(t,"viewBox","0 0 24 24"),x(t,"stroke","currentColor"),x(t,"class","svelte-t7fpgu"),x(e,"aria-expanded",r[4]),x(e,"class","svelte-t7fpgu"),$n(e,"underlined",r[3])},m(c,f){k(c,e,f),w(e,t),w(t,n),w(e,i),w(e,o),k(c,s,f),g&&g.m(c,f),k(c,a,f),l=!0,u||(p=[B(e,"click",r[5]),B(e,"mouseenter",r[11]),B(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&He(o,c[1]),(!l||f&16)&&x(e,"aria-expanded",c[4]),(!l||f&8)&&$n(e,"underlined",c[3]),c[4]?g?(g.p(c,f),f&16&&T(g,1)):(g=lr(c),g.c(),T(g,1),g.m(a.parentNode,a)):g&&(ve(),A(g,1,1,()=>{g=null}),ye())},i(c){l||(T(g),l=!0)},o(c){A(g),l=!1},d(c){c&&S(e),c&&S(s),g&&g.d(c),c&&S(a),u=!1,Ce(p)}}}function Xo(r,e,t){let n,i,o,s;ie(r,Ye,d=>t(7,o=d)),ie(r,Oe,d=>t(8,s=d));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const g=()=>{Oe.update(d=>d==u?null:u),s==u&&(un.set(null),un.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const h=()=>Bt.set(u),m=()=>Bt.set(null);function _(d){re[d?"unshift":"push"](()=>{c=d,t(2,c)})}const b=()=>f();return r.$$set=d=>{"id"in d&&t(0,u=d.id),"label"in d&&t(1,p=d.label),"$$scope"in d&&t(9,l=d.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,p,c,i,n,g,f,o,s,l,a,h,m,_,b]}class zo extends Z{constructor(e){super(),Q(this,e,Xo,Jo,K,{id:0,label:1})}}function ar(r,e,t){const n=r.slice();return n[12]=e[t],n[13]=e,n[14]=t,n}function Wo(r){let e,t,n;function i(s){r[8](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new Uo({props:o}),re.push(()=>Le(e,"props",i,r[12].properties)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[12].properties,xe(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Vo(r){let e,t,n;function i(s){r[7](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new Do({props:o}),re.push(()=>Le(e,"props",i,r[12].properties)),{c(){Y(e.$$.fragment)},m(s,a){H(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[12].properties,xe(()=>t=!1)),e.$set(l)},i(s){n||(T(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Ko(r){let e,t,n,i,o;function s(p){r[4](p,r[12])}function a(p){r[5](p,r[12])}function l(p){r[6](p,r[12])}let u={length_meters:r[12].properties.length_meters};return r[12].properties.name!==void 0&&(u.name=r[12].properties.name),r[12].properties.intervention_type!==void 0&&(u.intervention_type=r[12].properties.intervention_type),r[12].properties.description!==void 0&&(u.description=r[12].properties.description),e=new vo({props:u}),re.push(()=>Le(e,"name",s,r[12].properties.name)),re.push(()=>Le(e,"intervention_type",a,r[12].properties.intervention_type)),re.push(()=>Le(e,"description",l,r[12].properties.description)),{c(){Y(e.$$.fragment)},m(p,g){H(e,p,g),o=!0},p(p,g){r=p;const c={};g&2&&(c.length_meters=r[12].properties.length_meters),!t&&g&2&&(t=!0,c.name=r[12].properties.name,xe(()=>t=!1)),!n&&g&2&&(n=!0,c.intervention_type=r[12].properties.intervention_type,xe(()=>n=!1)),!i&&g&2&&(i=!0,c.description=r[12].properties.description,xe(()=>i=!1)),e.$set(c)},i(p){o||(T(e.$$.fragment,p),o=!0)},o(p){A(e.$$.fragment,p),o=!1},d(p){U(e,p)}}}function Zo(r){let e,t,n,i,o,s,a,l,u,p,g,c,f,h,m;const _=[Ko,Vo,Wo],b=[];function d(y,M){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:-1}~(e=d(r))&&(t=b[e]=_[e](r));function v(){return r[9](r[12])}return{c(){t&&t.c(),n=C(),i=E("br"),o=C(),s=E("br"),a=C(),l=E("div"),u=E("button"),u.textContent="Delete",p=C(),g=E("button"),g.textContent="Save",c=C(),x(u,"type","button"),x(g,"type","button"),ae(l,"display","flex"),ae(l,"justify-content","space-between")},m(y,M){~e&&b[e].m(y,M),k(y,n,M),k(y,i,M),k(y,o,M),k(y,s,M),k(y,a,M),k(y,l,M),w(l,u),w(l,p),w(l,g),k(y,c,M),f=!0,h||(m=[B(u,"click",v),B(g,"click",r[10])],h=!0)},p(y,M){r=y;let O=e;e=d(r),e===O?~e&&b[e].p(r,M):(t&&(ve(),A(b[O],1,1,()=>{b[O]=null}),ye()),~e?(t=b[e],t?t.p(r,M):(t=b[e]=_[e](r),t.c()),T(t,1),t.m(n.parentNode,n)):t=null)},i(y){f||(T(t),f=!0)},o(y){A(t),f=!1},d(y){~e&&b[e].d(y),y&&S(n),y&&S(i),y&&S(o),y&&S(s),y&&S(a),y&&S(l),y&&S(c),h=!1,Ce(m)}}}function ur(r,e){let t,n,i;return n=new zo({props:{id:e[12].id,label:e[14]+1+") "+e[2](e[12]),$$slots:{default:[Zo]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=ge(),Y(n.$$.fragment),this.first=t},m(o,s){k(o,t,s),H(n,o,s),i=!0},p(o,s){e=o;const a={};s&2&&(a.id=e[12].id),s&2&&(a.label=e[14]+1+") "+e[2](e[12])),s&32771&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||(T(n.$$.fragment,o),i=!0)},o(o){A(n.$$.fragment,o),i=!1},d(o){o&&S(t),U(n,o)}}}function Qo(r){let e=[],t=new Map,n,i,o,s,a=r[1].features;const l=u=>u[12].id;for(let u=0;u<a.length;u+=1){let p=ar(r,a,u),g=l(p);t.set(g,e[u]=ur(g,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=ge()},m(u,p){for(let g=0;g<e.length;g+=1)e[g].m(u,p);k(u,n,p),i=!0,o||(s=B(window,"keydown",r[3]),o=!0)},p(u,[p]){p&7&&(a=u[1].features,ve(),e=di(e,p,l,1,u,a,t,n.parentNode,mi,ur,n,ar),ye())},i(u){if(!i){for(let p=0;p<a.length;p+=1)T(e[p]);i=!0}},o(u){for(let p=0;p<e.length;p+=1)A(e[p]);i=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&S(n),o=!1,s()}}}function es(r,e,t){let n,i;ie(r,Oe,m=>t(11,n=m)),ie(r,te,m=>t(1,i=m));let{schema:o}=e;function s(m){var b,d,v,y,M;if(o=="planning")return((b=m.properties.planning)==null?void 0:b.name)||"Untitled polygon";if(o=="v2")return((v=(d=m.properties.v2)==null?void 0:d.Route)==null?void 0:v.name)||((M=(y=m.properties.v2)==null?void 0:y.Crossing)==null?void 0:M.name)||"Untitled intervention";if(m.properties.name)return m.properties.name;var _=m.properties.intervention_type;return _=="other"&&(m.geometry.type=="Point"?_="point":m.geometry.type=="LineString"?_="line":_="polygon"),`Untitled ${_}`}function a(m){if(m.key=="Delete"){const _=m.target.tagName;if(_=="INPUT"||_=="TEXTAREA")return;m.preventDefault();const b=n;b&&Bn(b)}}function l(m,_){r.$$.not_equal(_.properties.name,m)&&(_.properties.name=m,te.set(i))}function u(m,_){r.$$.not_equal(_.properties.intervention_type,m)&&(_.properties.intervention_type=m,te.set(i))}function p(m,_){r.$$.not_equal(_.properties.description,m)&&(_.properties.description=m,te.set(i))}function g(m,_){r.$$.not_equal(_.properties,m)&&(_.properties=m,te.set(i))}function c(m,_){r.$$.not_equal(_.properties,m)&&(_.properties=m,te.set(i))}const f=m=>Bn(m.id),h=()=>Oe.set(null);return r.$$set=m=>{"schema"in m&&t(0,o=m.schema)},[o,i,s,a,l,u,p,g,c,f,h]}class ts extends Z{constructor(e){super(),Q(this,e,es,Qo,K,{schema:0})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Be(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function _n(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Je(r,e,t){t===void 0&&(t={});var n=Ve(r),i=Ve(e),o=Fe(i[1]-n[1]),s=Fe(i[0]-n[0]),a=Fe(n[1]),l=Fe(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return _i(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Tt(r,e){return e===void 0&&(e={}),gi(r,function(t,n){var i=n.geometry.coordinates;return t+Je(i[0],i[1],e)},0)}function ns(r){let e,t,n,i,o,s,a,l,u,p,g,c,f,h,m,_,b,d,v,y=r[0].features.length+"",M,O,R,L,N,I,$,W;return{c(){e=E("div"),t=E("label"),n=X(`Scheme name:
    `),i=E("input"),o=C(),s=E("br"),a=C(),l=E("div"),u=E("label"),p=E("input"),g=C(),c=E("button"),c.textContent="Load from GeoJSON",f=C(),h=E("button"),h.textContent="Export to GeoJSON",m=C(),_=E("br"),b=C(),d=E("div"),v=E("span"),M=X(y),O=X(" interventions"),R=C(),L=E("button"),N=X("Clear all"),x(i,"type","text"),x(p,"type","file"),x(p,"id","load_geojson"),x(p,"class","svelte-lhyd1e"),x(c,"type","button"),x(h,"type","button"),x(h,"class","align-right svelte-lhyd1e"),x(L,"type","button"),x(L,"class","align-right svelte-lhyd1e"),L.disabled=I=r[0].features.length==0},m(P,D){k(P,e,D),w(e,t),w(t,n),w(t,i),Te(i,r[0].scheme_name),k(P,o,D),k(P,s,D),k(P,a,D),k(P,l,D),w(l,u),w(u,p),w(u,g),w(u,c),w(l,f),w(l,h),k(P,m,D),k(P,_,D),k(P,b,D),k(P,d,D),w(d,v),w(v,M),w(v,O),w(d,R),w(d,L),w(L,N),$||(W=[B(i,"input",r[7]),B(p,"change",r[3]),B(c,"click",is),B(h,"click",r[2]),B(L,"click",r[1])],$=!0)},p(P,[D]){D&1&&i.value!==P[0].scheme_name&&Te(i,P[0].scheme_name),D&1&&y!==(y=P[0].features.length+"")&&He(M,y),D&1&&I!==(I=P[0].features.length==0)&&(L.disabled=I)},i:j,o:j,d(P){P&&S(e),P&&S(o),P&&S(s),P&&S(a),P&&S(l),P&&S(m),P&&S(_),P&&S(b),P&&S(d),$=!1,Ce(W)}}}function rs(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function is(){document.getElementById("load_geojson").click()}function os(r,e,t){let n;ie(r,te,h=>t(0,n=h));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=window.localStorage.getItem(s);if(a)try{te.set(c(JSON.parse(a)))}catch(h){console.log(`Failed to load from local storage: ${h}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&te.update(h=>(delete h.scheme_name,h.features=[],h))}function u(){const h=JSON.parse(JSON.stringify(n));for(let m of h.features)delete m.properties.hide_while_editing;return h}function p(){let h=u();var m=s;h.authority=i,h.origin="atip-v1",h.scheme_name&&(m+="_"+h.scheme_name),m+=".txt",rs(m,JSON.stringify(h,null,"  "))}function g(h){const m=new FileReader;m.onload=b=>{try{te.set(c(JSON.parse(b.target.result)))}catch(d){window.alert(`Couldn't load scheme from a file: ${d}`)}};let _=h.target.files;m.readAsText(_[0])}function c(h){let m=1;for(let _ of h.features)_.properties||(_.properties={name:"",description:"",intervention_type:"other"}),_.geometry.type=="LineString"&&!_.properties.length_meters&&(_.properties.length_meters=Tt(_,{units:"kilometers"})*1e3),_.id=m++;return h}function f(){n.scheme_name=this.value,te.set(n)}return r.$$set=h=>{"authorityName"in h&&t(4,i=h.authorityName),"schema"in h&&t(5,o=h.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,p,g,i,o,s,f]}class ss extends Z{constructor(e){super(),Q(this,e,os,ns,K,{authorityName:4,schema:5})}}const ls="/atip/schema_description/assets/zoom_out_map-b2e1091a.svg";function as(r){let e,t,n,i,o;return{c(){e=E("button"),t=E("img"),vi(t.src,n=ls)||x(t,"src",n),x(t,"alt","Zoom to show entire boundary"),x(e,"type","button"),x(e,"title","Zoom to show entire boundary"),x(e,"class","svelte-qzjsqo")},m(s,a){k(s,e,a),w(e,t),i||(o=B(e,"click",r[0]),i=!0)},p:j,i:j,o:j,d(s){s&&S(e),i=!1,o()}}}function us(r,e,t){let n;ie(r,Ge,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(En(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class fs extends Z{constructor(e){super(),Q(this,e,us,as,K,{boundaryGeojson:1})}}function cs(r){let e,t,n,i,o,s,a;return{c(){e=E("div"),t=X(`Basemap:
  `),n=E("select"),i=E("option"),i.textContent="Streets",o=E("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&zt(()=>r[2].call(n)),x(e,"class","svelte-1tbnm6i")},m(l,u){k(l,e,u),w(e,t),w(e,n),w(n,i),w(n,o),$t(n,r[0]),s||(a=[B(n,"change",r[2]),B(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&$t(n,l[0])},i:j,o:j,d(l){l&&S(e),s=!1,Ce(a)}}}function ps(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=Rr(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class hs extends Z{constructor(e){super(),Q(this,e,ps,cs,K,{style:0})}}const le={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Qt=10,jt=10;function ds(r){let e,t,n,i,o,s,a,l,u,p,g,c,f,h,m;return{c(){e=E("li"),t=E("span"),n=X("Areas"),i=C(),o=E("li"),s=E("span"),a=X("Routes"),l=C(),u=E("li"),p=E("span"),g=X("Crossings"),c=C(),f=E("li"),h=E("span"),m=X("Other"),x(t,"class","svelte-p551i1"),ae(t,"background",le.area),x(s,"class","svelte-p551i1"),ae(s,"background",le.route),x(p,"class","svelte-p551i1"),ae(p,"background",le.crossing),x(h,"class","svelte-p551i1"),ae(h,"background",le.other)},m(_,b){k(_,e,b),w(e,t),w(e,n),k(_,i,b),k(_,o,b),w(o,s),w(o,a),k(_,l,b),k(_,u,b),w(u,p),w(u,g),k(_,c,b),k(_,f,b),w(f,h),w(f,m)},p:j,d(_){_&&S(e),_&&S(i),_&&S(o),_&&S(l),_&&S(u),_&&S(c),_&&S(f)}}}function ms(r){let e,t,n,i,o,s,a,l,u,p,g,c,f,h,m;return{c(){e=E("li"),t=E("span"),n=X("Preapp"),i=C(),o=E("li"),s=E("span"),a=X("Outline"),l=C(),u=E("li"),p=E("span"),g=X("Reserved matters"),c=C(),f=E("li"),h=E("span"),m=X("Local plan"),x(t,"class","svelte-p551i1"),ae(t,"background",le.preapp),x(s,"class","svelte-p551i1"),ae(s,"background",le.outline),x(p,"class","svelte-p551i1"),ae(p,"background",le["reserved matters"]),x(h,"class","svelte-p551i1"),ae(h,"background",le["local plan"])},m(_,b){k(_,e,b),w(e,t),w(e,n),k(_,i,b),k(_,o,b),w(o,s),w(o,a),k(_,l,b),k(_,u,b),w(u,p),w(u,g),k(_,c,b),k(_,f,b),w(f,h),w(f,m)},p:j,d(_){_&&S(e),_&&S(i),_&&S(o),_&&S(l),_&&S(u),_&&S(c),_&&S(f)}}}function _s(r){let e,t,n,i;function o(l,u){return l[0]=="planning"?ms:ds}let s=o(r),a=s(r);return{c(){e=E("div"),t=E("h1"),t.textContent="Interventions",n=C(),i=E("ul"),a.c(),x(t,"class","svelte-p551i1"),x(e,"class","svelte-p551i1")},m(l,u){k(l,e,u),w(e,t),w(e,n),w(e,i),a.m(i,null)},p(l,[u]){s===(s=o(l))&&a?a.p(l,u):(a.d(1),a=s(l),a&&(a.c(),a.m(i,null)))},i:j,o:j,d(l){l&&S(e),a.d()}}}function gs(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class vs extends Z{constructor(e){super(),Q(this,e,gs,_s,K,{schema:0})}}let et="interventions";function ys(r,e,t){let n,i;ie(r,Ge,p=>t(1,n=p)),ie(r,te,p=>t(2,i=p));let{schema:o}=e;Ze(n,et,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",le.area,"route",le.route,"crossing",le.crossing,"other",le.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",le.preapp,"outline",le.outline,"reserved matters",le["reserved matters"],"local plan",le["local plan"],"white"],l=["!=","hide_while_editing",!0];return be(n,{id:"interventions-points",source:et,filter:["all",Wt,l,["!=","endpoint",!0]],...ut(s,Qt)}),be(n,{id:"interventions-lines",source:et,filter:["all",Vt,l],...wt(s,jt)},"route-lines"),be(n,{id:"interventions-lines-endpoints",source:et,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*jt,"circle-opacity":0,"circle-stroke-color":le.lineEndpointColor,"circle-stroke-width":2}}),be(n,{id:"interventions-polygons",source:et,filter:["all",Kt,l],...Xt(o=="planning"?a:s,.5)},"hover-polygons"),r.$$set=p=>{"schema"in p&&t(0,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(i)),g=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])g.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(g),n.getSource(et).setData(p)}},[o,n,i]}class bs extends Z{constructor(e){super(),Q(this,e,ys,null,K,{schema:0})}}let tt="hover";function ws(r,e,t){let n,i,o,s,a;return ie(r,Ge,l=>t(0,n=l)),ie(r,te,l=>t(1,i=l)),ie(r,Bt,l=>t(2,o=l)),ie(r,Ye,l=>t(3,s=l)),ie(r,Oe,l=>t(4,a=l)),Ze(n,tt,{type:"geojson",data:De()}),be(n,{id:"hover-polygons",source:tt,filter:Kt,...wt(le.hovering,.5*jt,1)}),be(n,{id:"hover-lines",source:tt,filter:Vt,...wt(le.hovering,1.5*jt,1)},"interventions-lines"),be(n,{id:"hover-points",source:tt,filter:Wt,...ut(le.hovering,1.5*Qt,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(tt).setData(i.features.find(u=>u.id==l)):n.getSource(tt).setData(De())}},[n,i,o,s,a]}class ks extends Z{constructor(e){super(),Q(this,e,ws,null,K,{})}}class xn{constructor(e,t){ee(this,"owner");ee(this,"map");ee(this,"mapHandlers",{});ee(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Lt="edit-point-mode";class Ss{constructor(e){ee(this,"map");ee(this,"active");ee(this,"eventListenersSuccess");ee(this,"eventListenersFailure");ee(this,"cursor");ee(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new xn(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Ze(e,Lt,{type:"geojson",data:De()}),be(e,{id:"edit-point-mode",source:Lt,...ut(le.hovering,Qt,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=Es(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Lt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=De();this.cursor&&e.features.push(this.cursor),this.map.getSource(Lt).setData(e)}}function Es(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function qr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Ms(r,e);var n=Ve(r),i=Ve(e),o=Fe(n[0]),s=Fe(i[0]),a=Fe(n[1]),l=Fe(i[1]),u=Math.sin(s-o)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return an(Math.atan2(u,p))}function Ms(r,e){var t=qr(e,r);return t=(t+180)%360,t}function fr(r,e,t,n){n===void 0&&(n={});var i=Ve(r),o=Fe(i[0]),s=Fe(i[1]),a=Fe(t),l=yi(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),g=an(p),c=an(u);return st([g,c],n.properties)}function gn(r){if(!r)throw new Error("geojson is required");var e=[];return Mn(r,function(t){Os(t,e)}),We(e)}function Os(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Be(n);break;case"LineString":t=[Be(n)]}t.forEach(function(i){var o=Ls(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Ls(r,e){var t=[];return r.reduce(function(n,i){var o=lt([n,i],e);return o.bbox=xs(n,i),t.push(o),i}),t}function xs(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var at={},Cs={get exports(){return at},set exports(r){at=r}},vn={},Ts={get exports(){return vn},set exports(r){vn=r}};(function(r,e){(function(t,n){r.exports=n()})(bi,function(){function t(d,v,y,M,O){(function R(L,N,I,$,W){for(;$>I;){if($-I>600){var P=$-I+1,D=N-I+1,oe=Math.log(P),fe=.5*Math.exp(2*oe/3),G=.5*Math.sqrt(oe*fe*(P-fe)/P)*(D-P/2<0?-1:1),se=Math.max(I,Math.floor(N-D*fe/P+G)),ke=Math.min($,Math.floor(N+(P-D)*fe/P+G));R(L,N,se,ke,W)}var Ae=L[N],pe=I,ce=$;for(n(L,I,N),W(L[$],Ae)>0&&n(L,I,$);pe<ce;){for(n(L,pe,ce),pe++,ce--;W(L[pe],Ae)<0;)pe++;for(;W(L[ce],Ae)>0;)ce--}W(L[I],Ae)===0?n(L,I,ce):n(L,++ce,$),ce<=N&&(I=ce+1),N<=ce&&($=ce-1)}})(d,v,y||0,M||d.length-1,O||i)}function n(d,v,y){var M=d[v];d[v]=d[y],d[y]=M}function i(d,v){return d<v?-1:d>v?1:0}var o=function(d){d===void 0&&(d=9),this._maxEntries=Math.max(4,d),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(d,v,y){if(!y)return v.indexOf(d);for(var M=0;M<v.length;M++)if(y(d,v[M]))return M;return-1}function a(d,v){l(d,0,d.children.length,v,d)}function l(d,v,y,M,O){O||(O=_(null)),O.minX=1/0,O.minY=1/0,O.maxX=-1/0,O.maxY=-1/0;for(var R=v;R<y;R++){var L=d.children[R];u(O,d.leaf?M(L):L)}return O}function u(d,v){return d.minX=Math.min(d.minX,v.minX),d.minY=Math.min(d.minY,v.minY),d.maxX=Math.max(d.maxX,v.maxX),d.maxY=Math.max(d.maxY,v.maxY),d}function p(d,v){return d.minX-v.minX}function g(d,v){return d.minY-v.minY}function c(d){return(d.maxX-d.minX)*(d.maxY-d.minY)}function f(d){return d.maxX-d.minX+(d.maxY-d.minY)}function h(d,v){return d.minX<=v.minX&&d.minY<=v.minY&&v.maxX<=d.maxX&&v.maxY<=d.maxY}function m(d,v){return v.minX<=d.maxX&&v.minY<=d.maxY&&v.maxX>=d.minX&&v.maxY>=d.minY}function _(d){return{children:d,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function b(d,v,y,M,O){for(var R=[v,y];R.length;)if(!((y=R.pop())-(v=R.pop())<=M)){var L=v+Math.ceil((y-v)/M/2)*M;t(d,L,v,y,O),R.push(v,L,L,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(d){var v=this.data,y=[];if(!m(d,v))return y;for(var M=this.toBBox,O=[];v;){for(var R=0;R<v.children.length;R++){var L=v.children[R],N=v.leaf?M(L):L;m(d,N)&&(v.leaf?y.push(L):h(d,N)?this._all(L,y):O.push(L))}v=O.pop()}return y},o.prototype.collides=function(d){var v=this.data;if(!m(d,v))return!1;for(var y=[];v;){for(var M=0;M<v.children.length;M++){var O=v.children[M],R=v.leaf?this.toBBox(O):O;if(m(d,R)){if(v.leaf||h(d,R))return!0;y.push(O)}}v=y.pop()}return!1},o.prototype.load=function(d){if(!d||!d.length)return this;if(d.length<this._minEntries){for(var v=0;v<d.length;v++)this.insert(d[v]);return this}var y=this._build(d.slice(),0,d.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(d){return d&&this._insert(d,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(d,v){if(!d)return this;for(var y,M,O,R=this.data,L=this.toBBox(d),N=[],I=[];R||N.length;){if(R||(R=N.pop(),M=N[N.length-1],y=I.pop(),O=!0),R.leaf){var $=s(d,R.children,v);if($!==-1)return R.children.splice($,1),N.push(R),this._condense(N),this}O||R.leaf||!h(R,L)?M?(y++,R=M.children[y],O=!1):R=null:(N.push(R),I.push(y),y=0,M=R,R=R.children[0])}return this},o.prototype.toBBox=function(d){return d},o.prototype.compareMinX=function(d,v){return d.minX-v.minX},o.prototype.compareMinY=function(d,v){return d.minY-v.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(d){return this.data=d,this},o.prototype._all=function(d,v){for(var y=[];d;)d.leaf?v.push.apply(v,d.children):y.push.apply(y,d.children),d=y.pop();return v},o.prototype._build=function(d,v,y,M){var O,R=y-v+1,L=this._maxEntries;if(R<=L)return a(O=_(d.slice(v,y+1)),this.toBBox),O;M||(M=Math.ceil(Math.log(R)/Math.log(L)),L=Math.ceil(R/Math.pow(L,M-1))),(O=_([])).leaf=!1,O.height=M;var N=Math.ceil(R/L),I=N*Math.ceil(Math.sqrt(L));b(d,v,y,I,this.compareMinX);for(var $=v;$<=y;$+=I){var W=Math.min($+I-1,y);b(d,$,W,N,this.compareMinY);for(var P=$;P<=W;P+=N){var D=Math.min(P+N-1,W);O.children.push(this._build(d,P,D,M-1))}}return a(O,this.toBBox),O},o.prototype._chooseSubtree=function(d,v,y,M){for(;M.push(v),!v.leaf&&M.length-1!==y;){for(var O=1/0,R=1/0,L=void 0,N=0;N<v.children.length;N++){var I=v.children[N],$=c(I),W=(P=d,D=I,(Math.max(D.maxX,P.maxX)-Math.min(D.minX,P.minX))*(Math.max(D.maxY,P.maxY)-Math.min(D.minY,P.minY))-$);W<R?(R=W,O=$<O?$:O,L=I):W===R&&$<O&&(O=$,L=I)}v=L||v.children[0]}var P,D;return v},o.prototype._insert=function(d,v,y){var M=y?d:this.toBBox(d),O=[],R=this._chooseSubtree(M,this.data,v,O);for(R.children.push(d),u(R,M);v>=0&&O[v].children.length>this._maxEntries;)this._split(O,v),v--;this._adjustParentBBoxes(M,O,v)},o.prototype._split=function(d,v){var y=d[v],M=y.children.length,O=this._minEntries;this._chooseSplitAxis(y,O,M);var R=this._chooseSplitIndex(y,O,M),L=_(y.children.splice(R,y.children.length-R));L.height=y.height,L.leaf=y.leaf,a(y,this.toBBox),a(L,this.toBBox),v?d[v-1].children.push(L):this._splitRoot(y,L)},o.prototype._splitRoot=function(d,v){this.data=_([d,v]),this.data.height=d.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(d,v,y){for(var M,O,R,L,N,I,$,W=1/0,P=1/0,D=v;D<=y-v;D++){var oe=l(d,0,D,this.toBBox),fe=l(d,D,y,this.toBBox),G=(O=oe,R=fe,L=void 0,N=void 0,I=void 0,$=void 0,L=Math.max(O.minX,R.minX),N=Math.max(O.minY,R.minY),I=Math.min(O.maxX,R.maxX),$=Math.min(O.maxY,R.maxY),Math.max(0,I-L)*Math.max(0,$-N)),se=c(oe)+c(fe);G<W?(W=G,M=D,P=se<P?se:P):G===W&&se<P&&(P=se,M=D)}return M||y-v},o.prototype._chooseSplitAxis=function(d,v,y){var M=d.leaf?this.compareMinX:p,O=d.leaf?this.compareMinY:g;this._allDistMargin(d,v,y,M)<this._allDistMargin(d,v,y,O)&&d.children.sort(M)},o.prototype._allDistMargin=function(d,v,y,M){d.children.sort(M);for(var O=this.toBBox,R=l(d,0,v,O),L=l(d,y-v,y,O),N=f(R)+f(L),I=v;I<y-v;I++){var $=d.children[I];u(R,d.leaf?O($):$),N+=f(R)}for(var W=y-v-1;W>=v;W--){var P=d.children[W];u(L,d.leaf?O(P):P),N+=f(L)}return N},o.prototype._adjustParentBBoxes=function(d,v,y){for(var M=y;M>=0;M--)u(v[M],d)},o.prototype._condense=function(d){for(var v=d.length-1,y=void 0;v>=0;v--)d[v].children.length===0?v>0?(y=d[v-1].children).splice(y.indexOf(d[v]),1):this.clear():a(d[v],this.toBBox)},o})})(Ts);const Rs=On(wi),As=On(ki),Ps=On(Si);var $e=vn,jr=Rs,Yr=As,nt=Ps.default,Fs=Yr.featureEach;Yr.coordEach;jr.polygon;var cr=jr.featureCollection;function Hr(r){var e=new $e(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:nt(t),$e.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:nt(i),n.push(i)}):Fs(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:nt(i),n.push(i)}),$e.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:nt(t),$e.prototype.remove.call(this,t,n)},e.clear=function(){return $e.prototype.clear.call(this)},e.search=function(t){var n=$e.prototype.search.call(this,this.toBBox(t));return cr(n)},e.collides=function(t){return $e.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=$e.prototype.all.call(this);return cr(t)},e.toJSON=function(){return $e.prototype.toJSON.call(this)},e.fromJSON=function(t){return $e.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=nt(t);else if(t.type==="FeatureCollection")n=nt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Cs.exports=Hr;at.default=Hr;function Ur(r,e){var t={},n=[];if(r.type==="LineString"&&(r=In(r)),e.type==="LineString"&&(e=In(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=pr(r,e);return i&&n.push(i),We(n)}var o=at();return o.load(gn(e)),It(gn(r),function(s){It(o.search(s),function(a){var l=pr(s,a);if(l){var u=Be(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function pr(r,e){var t=Be(r),n=Be(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],g=n[1][1],c=(g-u)*(s-i)-(p-l)*(a-o),f=(p-l)*(o-u)-(g-u)*(i-l),h=(s-i)*(o-u)-(a-o)*(i-l);if(c===0)return f===0&&h===0,null;var m=f/c,_=h/c;if(m>=0&&m<=1&&_>=0&&_<=1){var b=i+m*(s-i),d=o+m*(a-o);return st([b,d])}return null}function St(r,e,t){t===void 0&&(t={});var n=st([1/0,1/0],{dist:1/0}),i=0;return Mn(r,function(o){for(var s=Be(o),a=0;a<s.length-1;a++){var l=st(s[a]);l.properties.dist=Je(e,l,t);var u=st(s[a+1]);u.properties.dist=Je(e,u,t);var p=Je(l,u,t),g=Math.max(l.properties.dist,u.properties.dist),c=qr(l,u),f=fr(e,g,c+90,t),h=fr(e,g,c-90,t),m=Ur(lt([f.geometry.coordinates,h.geometry.coordinates]),lt([l.geometry.coordinates,u.geometry.coordinates])),_=null;m.features.length>0&&(_=m.features[0],_.properties.dist=Je(e,_,t),_.properties.location=i+Je(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+p),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a),i+=p}}),n}const rt="edit-polygon-mode";class Ns{constructor(e){ee(this,"map");ee(this,"active");ee(this,"eventListenersSuccess");ee(this,"eventListenersFailure");ee(this,"points");ee(this,"cursor");ee(this,"hover");ee(this,"dragFrom");ee(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new xn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Ze(e,rt,{type:"geojson",data:De()}),be(e,{id:"edit-polygon-fill",source:rt,filter:Kt,...Xt("red",["case",["boolean",["get","hover"],"false"],1,.5])}),be(e,{id:"edit-polygon-lines",source:rt,filter:Vt,...wt("black",8,.5)}),be(e,{id:"edit-polygon-vertices",source:rt,filter:Wt,...ut(le.hovering,Qt,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(dr(this.points).forEach((n,i)=>{t.push([i+1,St(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(rt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=De();this.points.forEach((n,i)=>{let o=hr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(dr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(rt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=hr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function hr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function dr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let z;const je=new Array(32).fill(void 0);je.push(void 0,null,!0,!1);function J(r){return je[r]}let vt=je.length;function $s(r){r<36||(je[r]=vt,vt=r)}function yn(r){const e=J(r);return $s(r),e}const Jr=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Jr.decode();let Rt=new Uint8Array;function yt(){return Rt.byteLength===0&&(Rt=new Uint8Array(z.memory.buffer)),Rt}function it(r,e){return Jr.decode(yt().subarray(r,r+e))}function me(r){vt===je.length&&je.push(je.length+1);const e=vt;return vt=je[e],je[e]=r,e}function rn(r){return r==null}let At=new Float64Array;function Is(){return At.byteLength===0&&(At=new Float64Array(z.memory.buffer)),At}let Pt=new Int32Array;function _e(){return Pt.byteLength===0&&(Pt=new Int32Array(z.memory.buffer)),Pt}let ze=0;const Ft=new TextEncoder("utf-8"),Bs=typeof Ft.encodeInto=="function"?function(r,e){return Ft.encodeInto(r,e)}:function(r,e){const t=Ft.encode(r);return e.set(t),{read:r.length,written:t.length}};function xt(r,e,t){if(t===void 0){const a=Ft.encode(r),l=e(a.length);return yt().subarray(l,l+a.length).set(a),ze=a.length,l}let n=r.length,i=e(n);const o=yt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=yt().subarray(i+s,i+n),l=Bs(r,a);s+=l.written}return ze=s,i}function bn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=bn(r[0]));for(let s=1;s<i;s++)o+=", "+bn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ds(r,e){const t=e(r.length*1);return yt().set(r,t/1),ze=r.length,t}function on(r,e){try{return r.apply(this,e)}catch(t){z.__wbindgen_exn_store(me(t))}}class Yt{static __wrap(e){const t=Object.create(Yt.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();z.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=z.__wbindgen_add_to_stack_pointer(-16),s=Ds(e,z.__wbindgen_malloc),a=ze;z.jsroutesnapper_new(o,s,a);var t=_e()[o/4+0],n=_e()[o/4+1],i=_e()[o/4+2];if(i)throw yn(n);return Yt.__wrap(t)}finally{z.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){z.jsroutesnapper_setConfig(this.ptr,me(e))}toFinalFeature(){try{const n=z.__wbindgen_add_to_stack_pointer(-16);z.jsroutesnapper_toFinalFeature(n,this.ptr);var e=_e()[n/4+0],t=_e()[n/4+1];let i;return e!==0&&(i=it(e,t).slice(),z.__wbindgen_free(e,t*1)),i}finally{z.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=z.__wbindgen_add_to_stack_pointer(-16);z.jsroutesnapper_renderGeojson(n,this.ptr);var e=_e()[n/4+0],t=_e()[n/4+1];return it(e,t)}finally{z.__wbindgen_add_to_stack_pointer(16),z.__wbindgen_free(e,t)}}setSnapMode(e){z.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return z.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){z.jsroutesnapper_onClick(this.ptr)}onDragStart(){return z.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return z.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){z.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=z.__wbindgen_add_to_stack_pointer(-16);z.jsroutesnapper_editExisting(i,this.ptr,me(e));var t=_e()[i/4+0],n=_e()[i/4+1];if(n)throw yn(t)}finally{z.__wbindgen_add_to_stack_pointer(16)}}}async function Gs(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function qs(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){yn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(it(e,t));return me(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=it(e,t);return me(n)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;Is()[e/8+1]=rn(i)?0:i,_e()[e/4+0]=!rn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=rn(i)?0:xt(i,z.__wbindgen_malloc,z.__wbindgen_realloc),s=ze;_e()[e/4+1]=s,_e()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(J(t)),i=xt(n,z.__wbindgen_malloc,z.__wbindgen_realloc),o=ze;_e()[e/4+1]=o,_e()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return me(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=J(e)[J(t)];return me(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(J(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(J(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(J(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(J(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(J(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=J(e)[t>>>0];return me(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=J(e).next;return me(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return on(function(e){const t=J(e).next();return me(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return J(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=J(e).value;return me(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return me(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return on(function(e,t){const n=Reflect.get(J(e),J(t));return me(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return on(function(e,t){const n=J(e).call(J(t));return me(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=J(e).buffer;return me(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(J(e));return me(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return me(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=xt(n,z.__wbindgen_malloc,z.__wbindgen_realloc),o=ze;_e()[e/4+1]=o,_e()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(it(e,t))}finally{z.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=bn(J(t)),i=xt(n,z.__wbindgen_malloc,z.__wbindgen_realloc),o=ze;_e()[e/4+1]=o,_e()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(it(e,t))},r.wbg.__wbindgen_memory=function(){const e=z.memory;return me(e)},r}function js(r,e){return z=r.exports,Xr.__wbindgen_wasm_module=e,At=new Float64Array,Pt=new Int32Array,Rt=new Uint8Array,z}async function Xr(r){typeof r>"u"&&(r="/atip/schema_description/assets/route_snapper_bg.wasm");const e=qs();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Gs(await r,e);return js(t,n)}const pt="route-snapper",mr=10,Ys=30;class Hs{constructor(e,t){ee(this,"map");ee(this,"inner");ee(this,"active");ee(this,"eventListenersSuccessRoute");ee(this,"eventListenersSuccessArea");ee(this,"eventListenersFailure");ee(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Yt(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Ze(e,pt,{type:"geojson",data:De()}),be(e,{id:"route-points",source:pt,filter:Wt,...ut(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",mr/2,mr])}),be(e,{id:"route-lines",source:pt,filter:Vt,...wt("black",2.5)}),be(e,{id:"route-polygons",source:pt,filter:Kt,...Xt("black",.5)}),this.events=new xn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Ys,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(pt).setData(JSON.parse(this.inner.renderGeojson()))}}function _r(r){let e;function t(o,s){return o[1]?Js:Us}let n=t(r),i=n(r);return{c(){i.c(),e=ge()},m(o,s){i.m(o,s),k(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&S(e)}}}function Us(r){let e;return{c(){e=E("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function Js(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function Xs(r){let e,t=r[0]==ot&&_r(r);return{c(){t&&t.c(),e=ge()},m(n,i){t&&t.m(n,i),k(n,e,i)},p(n,[i]){n[0]==ot?t?t.p(n,i):(t=_r(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:j,o:j,d(n){t&&t.d(n),n&&S(e)}}}const ot="edit-attribute";function zr(){}function zs(r,e,t){let n,i,o,s;ie(r,Ge,f=>t(5,n=f)),ie(r,te,f=>t(6,i=f)),ie(r,un,f=>t(7,o=f)),ie(r,Oe,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){Oe.set(null)}n.on("mousemove",p),n.on("mouseout",g),n.on("click",c),Et(()=>{n.off("mousemove",p),n.off("mouseout",g),n.off("click",c)});function p(f){var h;if(a==ot){let m=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ye.set(((h=m[0])==null?void 0:h.id)||null)}}function g(){a==ot&&Ye.set(null)}function c(f){if(a==ot){let h=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});h.length>0?Oe.set(h[0].id):Oe.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let h=i.features.find(m=>m.id==f);h.geometry.type=="Point"?n.flyTo({center:h.geometry.coordinates,duration:500}):n.fitBounds(En(h),{padding:200,duration:500}),l(ot)}}},[a,s,l,zr,u,n,i,o]}class Ws extends Z{constructor(e){super(),Q(this,e,zs,Xs,K,{mode:0,changeMode:2,start:3,stop:4})}get start(){return zr}get stop(){return this.$$.ctx[4]}}function Vs(r){let e,t;return{c:j,m(n,i){e||(t=B(window,"keydown",r[0]),e=!0)},p:j,i:j,o:j,d(n){e=!1,t()}}}function Ks(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class en extends Z{constructor(e){super(),Q(this,e,Ks,Vs,K,{tool:1})}}function Zs(r){let e;return{c(){e=E("p"),e.textContent="Click to add a new point"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function Qs(r){let e;return{c(){e=E("p"),e.textContent="Click to move the point here"},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function el(r){let e,t,n,i,o,s,a,l,u;function p(f,h){return f[1]?Qs:Zs}let g=p(r),c=g(r);return s=new en({props:{tool:r[0]}}),{c(){c.c(),e=C(),t=E("p"),t.innerHTML="Press <b>Escape</b> to cancel",n=C(),i=E("button"),i.textContent="Cancel",o=C(),Y(s.$$.fragment),x(i,"type","button")},m(f,h){c.m(f,h),k(f,e,h),k(f,t,h),k(f,n,h),k(f,i,h),k(f,o,h),H(s,f,h),a=!0,l||(u=B(i,"click",r[2]),l=!0)},p(f,[h]){g!==(g=p(f))&&(c.d(1),c=g(f),c&&(c.c(),c.m(e.parentNode,e)));const m={};h&1&&(m.tool=f[0]),s.$set(m)},i(f){a||(T(s.$$.fragment,f),a=!0)},o(f){A(s.$$.fragment,f),a=!1},d(f){c.d(f),f&&S(e),f&&S(t),f&&S(n),f&&S(i),f&&S(o),U(s,f),l=!1,u()}}}function tl(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Wr extends Z{constructor(e){super(),Q(this,e,tl,el,K,{pointTool:0,editingExisting:1})}}function nl(r){let e,t,n,i,o,s,a,l,u,p,g;return l=new en({props:{tool:r[0]}}),{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=C(),n=E("div"),i=E("button"),i.textContent="Finish",o=C(),s=E("button"),s.textContent="Cancel",a=C(),Y(l.$$.fragment),x(i,"type","button"),x(s,"type","button"),ae(n,"display","flex"),ae(n,"justify-content","space-between")},m(c,f){k(c,e,f),k(c,t,f),k(c,n,f),w(n,i),w(n,o),w(n,s),k(c,a,f),H(l,c,f),u=!0,p||(g=[B(i,"click",r[1]),B(s,"click",r[2])],p=!0)},p(c,[f]){const h={};f&1&&(h.tool=c[0]),l.$set(h)},i(c){u||(T(l.$$.fragment,c),u=!0)},o(c){A(l.$$.fragment,c),u=!1},d(c){c&&S(e),c&&S(t),c&&S(n),c&&S(a),U(l,c),p=!1,Ce(g)}}}function rl(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Vr extends Z{constructor(e){super(),Q(this,e,rl,nl,K,{polygonTool:0})}}function il(r){let e,t,n,i,o,s,a,l,u,p,g;return l=new en({props:{tool:r[0]}}),{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish area</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=C(),n=E("div"),i=E("button"),i.textContent="Finish",o=C(),s=E("button"),s.textContent="Cancel",a=C(),Y(l.$$.fragment),x(i,"type","button"),x(s,"type","button"),ae(n,"display","flex"),ae(n,"justify-content","space-between")},m(c,f){k(c,e,f),k(c,t,f),k(c,n,f),w(n,i),w(n,o),w(n,s),k(c,a,f),H(l,c,f),u=!0,p||(g=[B(i,"click",r[1]),B(s,"click",r[2])],p=!0)},p(c,[f]){const h={};f&1&&(h.tool=c[0]),l.$set(h)},i(c){u||(T(l.$$.fragment,c),u=!0)},o(c){A(l.$$.fragment,c),u=!1},d(c){c&&S(e),c&&S(t),c&&S(n),c&&S(a),U(l,c),p=!1,Ce(g)}}}function ol(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Kr extends Z{constructor(e){super(),Q(this,e,ol,il,K,{routeTool:0})}}function sl(r){let e,t,n,i,o,s,a,l,u,p,g,c,f,h,m;return c=new en({props:{tool:r[0]}}),{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=C(),n=E("label"),i=E("input"),o=X(`
  Avoid doubling back`),s=C(),a=E("div"),l=E("button"),l.textContent="Finish",u=C(),p=E("button"),p.textContent="Cancel",g=C(),Y(c.$$.fragment),x(i,"type","checkbox"),x(l,"type","button"),x(p,"type","button"),ae(a,"display","flex"),ae(a,"justify-content","space-between")},m(_,b){k(_,e,b),k(_,t,b),k(_,n,b),w(n,i),i.checked=r[1],w(n,o),k(_,s,b),k(_,a,b),w(a,l),w(a,u),w(a,p),k(_,g,b),H(c,_,b),f=!0,h||(m=[B(i,"change",r[2]),B(l,"click",r[3]),B(p,"click",r[4])],h=!0)},p(_,[b]){b&2&&(i.checked=_[1]);const d={};b&1&&(d.tool=_[0]),c.$set(d)},i(_){f||(T(c.$$.fragment,_),f=!0)},o(_){A(c.$$.fragment,_),f=!1},d(_){_&&S(e),_&&S(t),_&&S(n),_&&S(s),_&&S(a),_&&S(g),U(c,_),h=!1,Ce(m)}}}function ll(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class Zr extends Z{constructor(e){super(),Q(this,e,ll,sl,K,{routeTool:0})}}function gr(r){let e,t,n,i;const o=[pl,cl,fl,ul,al],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=ge()},m(l,u){s[e].m(l,u),k(l,n,u),i=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(ve(),A(s[p],1,1,()=>{s[p]=null}),ye(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){i||(T(t),i=!0)},o(l){A(t),i=!1},d(l){s[e].d(l),l&&S(n)}}}function al(r){let e;return{c(){e=E("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){k(t,e,n)},p:j,i:j,o:j,d(t){t&&S(e)}}}function ul(r){let e,t;return e=new Zr({props:{routeTool:r[3]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function fl(r){let e,t;return e=new Kr({props:{routeTool:r[3]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function cl(r){let e,t;return e=new Vr({props:{polygonTool:r[2]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function pl(r){let e,t;return e=new Wr({props:{pointTool:r[1],editingExisting:!0}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function hl(r){let e,t,n=r[0]==qe&&gr(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==qe?n?(n.p(i,o),o&1&&T(n,1)):(n=gr(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(T(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const qe="edit-geometry";function Qr(){}function dl(r,e,t){let n;ie(r,Ge,m=>t(8,n=m));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(o.stop(),s.stop(),a.stop(),te.update(m=>{let _=m.features.find(b=>b.id==l);return delete _.properties.hide_while_editing,m})),l=null,t(4,u=null),Ye.set(null)}n.on("mousemove",g),n.on("mouseout",c),n.on("click",f),Et(()=>{n.off("mousemove",g),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(m=>{i==qe&&(te.update(_=>{let b=_.features.find(d=>d.id==l);return b.properties.length_meters=m.properties.length_meters,b.properties.waypoints=m.properties.waypoints,delete b.properties.hide_while_editing,b.geometry=m.geometry,_}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(m=>{i==qe&&(te.update(_=>{let b=_.features.find(d=>d.id==l);return b.properties.waypoints=m.properties.waypoints,delete b.properties.hide_while_editing,b.geometry=m.geometry,_}),l=null,t(4,u=null))});for(let m of[o,s])m.addEventListenerSuccess(_=>{i==qe&&(te.update(b=>{let d=b.features.find(v=>v.id==l);return d.geometry=_.geometry,delete d.properties.hide_while_editing,b}),l=null,t(4,u=null))});for(let m of[o,s,a])m.addEventListenerFailure(()=>{i==qe&&(te.update(_=>{let b=_.features.find(d=>d.id==l);return delete b.properties.hide_while_editing,_}),l=null,t(4,u=null))});function g(m){var _;if(i==qe&&l==null){let b=n.queryRenderedFeatures(m.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ye.set(((_=b[0])==null?void 0:_.id)||null)}}function c(){i==qe&&l==null&&Ye.set(null)}function f(m){if(i==qe&&l==null){let _=n.queryRenderedFeatures(m.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&h(_[0].id)}}function h(m){Ye.set(null);let _=null;te.update(d=>(_=d.features.find(v=>v.id==m),_.properties.hide_while_editing=!0,d));let b=_;l=m,b.geometry.type=="LineString"?(a.editExistingRoute(b),t(4,u="route")):b.geometry.type=="Polygon"?b.properties.waypoints?(a.editExistingArea(b),t(4,u="snap-polygon")):(s.editExisting(b),t(4,u="free-polygon")):b.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=m=>{"mode"in m&&t(0,i=m.mode),"pointTool"in m&&t(1,o=m.pointTool),"polygonTool"in m&&t(2,s=m.polygonTool),"routeTool"in m&&t(3,a=m.routeTool)},[i,o,s,a,u,Qr,p]}class ml extends Z{constructor(e){super(),Q(this,e,dl,hl,K,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Qr}get stop(){return this.$$.ctx[6]}}async function _l(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),o+=p.length;const g=100*o/i;e.style=`background: linear-gradient(to right, red ${g}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function gl(r){let e,t;return e=new Zr({props:{routeTool:r[0]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function vl(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){k(t,e,n),r[7](e)},p:j,i:j,o:j,d(t){t&&S(e),r[7](null)}}}function yl(r){let e,t,n,i;const o=[vl,gl],s=[];function a(l,u){return l[0]?l[1]==wn?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=ge()},m(l,u){~e&&s[e].m(l,u),k(l,n,u),i=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(ve(),A(s[p],1,1,()=>{s[p]=null}),ye()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),T(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(T(t),i=!0)},o(l){A(t),i=!1},d(l){~e&&s[e].d(l),l&&S(n)}}}const wn="route";function bl(r,e,t){let n;ie(r,Ge,c=>t(8,n=c));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}Sn(async()=>{await Xr(),console.log(`Grabbing ${s}`);try{const c=await _l(s,a);t(0,l=new Hs(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==wn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{i==wn&&(te.update(f=>(c.id=Mt(f),c.properties.intervention_type="route",f.features.push(c),f)),o("edit-attribute"),Oe.set(c.id))})});function g(c){re[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,i=c.mode),"changeMode"in c&&t(3,o=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,i,a,o,s,u,p,g]}class wl extends Z{constructor(e){super(),Q(this,e,bl,yl,K,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function vr(r){let e,t;return e=new Wr({props:{pointTool:r[1],editingExisting:!1}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function kl(r){let e,t,n=r[0]==Ht&&vr(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==Ht?n?(n.p(i,o),o&1&&T(n,1)):(n=vr(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(T(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const Ht="point";function Sl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Ht&&(te.update(u=>(l.id=Mt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),Oe.set(l.id))}),o.addEventListenerFailure(()=>{n==Ht&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class El extends Z{constructor(e){super(),Q(this,e,Sl,kl,K,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function yr(r){let e,t;return e=new Vr({props:{polygonTool:r[1]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Ml(r){let e,t,n=r[0]==Ut&&yr(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==Ut?n?(n.p(i,o),o&1&&T(n,1)):(n=yr(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(T(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const Ut="free-polygon";function Ol(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Ut&&(te.update(u=>(l.id=Mt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Oe.set(l.id))}),o.addEventListenerFailure(()=>{n==Ut&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Ll extends Z{constructor(e){super(),Q(this,e,Ol,Ml,K,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function br(r){let e,t;return e=new Kr({props:{routeTool:r[1]}}),{c(){Y(e.$$.fragment)},m(n,i){H(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){A(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function xl(r){let e,t,n=r[0]==Jt&&br(r);return{c(){n&&n.c(),e=ge()},m(i,o){n&&n.m(i,o),k(i,e,o),t=!0},p(i,[o]){i[0]==Jt?n?(n.p(i,o),o&1&&T(n,1)):(n=br(i),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(ve(),A(n,1,1,()=>{n=null}),ye())},i(i){t||(T(n),t=!0)},o(i){A(n),t=!1},d(i){n&&n.d(i),i&&S(e)}}}const Jt="snap-polygon";function Cl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==Jt&&(te.update(u=>(l.id=Mt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Oe.set(l.id))}),o.addEventListenerFailure(()=>{n==Jt&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class Tl extends Z{constructor(e){super(),Q(this,e,Cl,xl,K,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Rl(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Je(r.slice(0,2),[n,t]),s=Je(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Al(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return Ei(r,function(s){Pl(s,o,n)}),r}function Pl(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Fl(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=_n(r),n=_n(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Al(e,{precision:7});switch(n){case"Point":return kn(r,i);case"MultiPoint":return wr(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return wr(r,Ur(r,i))}}function wr(r,e){var t=[],n=at();return Mn(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=kn(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=Rl(Mi(a)))}),n.load(We(t));else{var o=n.search(i);if(o.features.length){var s=ei(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),It(kn(s,i),function(a){t.push(a),n.insert(a)})}}}),We(t)}function kn(r,e){var t=[],n=Be(r)[0],i=Be(r)[r.geometry.coordinates.length-1];if(sn(n,Ve(e))||sn(i,Ve(e)))return We([r]);var o=at(),s=gn(r);o.load(s);var a=o.search(e);if(!a.features.length)return We([r]);var l=ei(e,a),u=[n],p=Oi(s,function(g,c,f){var h=Be(c)[1],m=Ve(e);return f===l.id?(g.push(m),t.push(lt(g)),sn(m,h)?[m]:[m,h]):(g.push(h),g)},u);return p.length>1&&t.push(lt(p)),We(t)}function ei(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return It(e,function(i){var o=St(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function sn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Nl(r,e,t){var n=Be(t);if(_n(t)!=="LineString")throw new Error("line must be a LineString");var i=St(t,r),o=St(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),lt(a,t.properties)}function kr(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){k(t,e,n)},d(t){t&&S(e)}}}function $l(r){let e,t,n,i=r[0]==bt&&kr();return{c(){i&&i.c(),e=ge()},m(o,s){i&&i.m(o,s),k(o,e,s),t||(n=B(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==bt?i||(i=kr(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:j,o:j,d(o){i&&i.d(o),o&&S(e),t=!1,n()}}}const bt="split-route",Il=10,Bl=30;let ln="split-route";function ti(){}function Sr(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Dl(r,e,t){let n,i;ie(r,te,m=>t(8,n=m)),ie(r,Ge,m=>t(6,i=m));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",p),i.on("click",g),Et(()=>{i.off("mousemove",p),i.off("click",g)}),Ze(i,ln,{type:"geojson",data:De()}),be(i,{id:"draw-split-route",source:ln,...ut("black",Il,["case",["==",["get","snapped"],!0],1,.5])});function p(m){if(o!=bt)return;t(5,l=Sr(m.lngLat.toArray(),!1)),u=null;const _=[m.point.x-Bl,m.point.y],b=i.unproject(m.point).distanceTo(i.unproject(_))/1e3;let d=[];for(let[v,y]of n.features.entries())if(y.geometry.type=="LineString"){let M=St(y.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=b&&d.push([v,M.geometry.coordinates,M.properties.dist])}d.sort((v,y)=>v[2]-y[2]),d.length>0&&(t(5,l=Sr(d[0][1],!0)),u=d[0][0])}function g(){if(o==bt)if(u==null)s("edit-attribute");else{let m=Fl(n.features[u],l);if(m.features.length==2){let _=m.features[0],b=m.features[1];te.update(d=>(_.id=d.features[u].id,b.id=Mt(d),_.properties=JSON.parse(JSON.stringify(d.features[u].properties)),b.properties=JSON.parse(JSON.stringify(_.properties)),c(d.features[u],_,b,l),d.features.splice(u,1,_,b),d))}a()}}function c(m,_,b,d){_.properties.length_meters=Tt(_,{units:"kilometers"})*1e3,b.properties.length_meters=Tt(b,{units:"kilometers"})*1e3,_.properties.waypoints=[],b.properties.waypoints=[];let v=f(m,d),y=!0,M=0;for(let O of m.properties.waypoints){let R=f(m,st([O.lon,O.lat]));if(y)if(R<v)_.properties.waypoints.push(O);else{let L=O.snapped&&m.properties.waypoints[M-1].snapped;_.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:L}),y=!1,b.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:L}),b.properties.waypoints.push(O)}else b.properties.waypoints.push(O);M++}}function f(m,_){let b=m.geometry.coordinates[0],d=Nl(b,_,m);return Tt(d,{units:"kilometers"})*1e3}function h(m){o==bt&&m.key=="Escape"&&(s("edit-attribute"),m.preventDefault())}return r.$$set=m=>{"mode"in m&&t(0,o=m.mode),"changeMode"in m&&t(2,s=m.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let m=De();l&&m.features.push(l),i.getSource(ln).setData(m)}},[o,h,s,ti,a,l,i]}class Gl extends Z{constructor(e){super(),Q(this,e,Dl,$l,K,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ti}get stop(){return this.$$.ctx[4]}}function Er(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new ml({props:n}),r[17](e),{c(){Y(e.$$.fragment)},m(i,o){H(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){r[17](null),U(e,i)}}}function Mr(r){let e,t,n,i,o;return{c(){e=E("button"),t=X("New point"),x(e,"type","button"),e.disabled=n=r[3]=="point",x(e,"class","svelte-cej5os")},m(s,a){k(s,e,a),w(e,t),i||(o=B(e,"click",r[18]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&S(e),i=!1,o()}}}function Or(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Tl({props:n}),r[23](e),{c(){Y(e.$$.fragment)},m(i,o){H(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){r[23](null),U(e,i)}}}function Lr(r){let e,t,n,i,o;return{c(){e=E("button"),t=X("New route"),x(e,"type","button"),e.disabled=n=r[3]=="route",x(e,"class","svelte-cej5os")},m(s,a){k(s,e,a),w(e,t),i||(o=B(e,"click",r[24]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&S(e),i=!1,o()}}}function xr(r){let e,t,n,i,o;return{c(){e=E("button"),t=X("Split route"),x(e,"type","button"),e.disabled=n=r[3]=="split-route",x(e,"class","svelte-cej5os")},m(s,a){k(s,e,a),w(e,t),i||(o=B(e,"click",r[27]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&S(e),i=!1,o()}}}function ql(r){let e,t,n,i,o,s,a,l,u,p,g,c,f,h,m,_,b,d,v,y,M,O,R,L,N,I,$,W,P,D,oe,fe,G,se,ke,Ae,pe,ce,Pe,ne,F,V,ni={mode:r[3],changeMode:r[13]};a=new Ws({props:ni}),r[15](a);let he=r[2]&&Er(r),Se=r[1]!="planning"&&Mr(r),ri={mode:r[3],changeMode:r[13],pointTool:r[11]};b=new El({props:ri}),r[19](b);let ii={mode:r[3],changeMode:r[13],polygonTool:r[12]};L=new Ll({props:ii}),r[21](L);let de=r[2]&&Or(r),Ee=r[1]!="planning"&&Lr(r);function oi(q){r[26](q)}let Cn={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(Cn.routeTool=r[2]),se=new wl({props:Cn}),r[25](se),re.push(()=>Le(se,"routeTool",oi,r[2]));let Me=r[1]!="planning"&&xr(r),si={mode:r[3],changeMode:r[13]};return Pe=new Gl({props:si}),r[28](Pe),{c(){e=E("div"),t=E("div"),n=E("button"),i=X("Edit attributes"),s=C(),Y(a.$$.fragment),l=C(),u=E("div"),p=E("button"),g=X("Edit geometry"),f=C(),he&&he.c(),h=C(),m=E("div"),Se&&Se.c(),_=C(),Y(b.$$.fragment),d=C(),v=E("div"),y=E("button"),M=X("New polygon (freehand)"),R=C(),Y(L.$$.fragment),N=C(),I=E("div"),$=E("button"),W=X("New polygon (snapped)"),D=C(),de&&de.c(),oe=C(),fe=E("div"),Ee&&Ee.c(),G=C(),Y(se.$$.fragment),Ae=C(),pe=E("div"),Me&&Me.c(),ce=C(),Y(Pe.$$.fragment),x(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",x(n,"class","svelte-cej5os"),x(p,"type","button"),p.disabled=c=r[3]=="edit-geometry",x(p,"class","svelte-cej5os"),x(y,"type","button"),y.disabled=O=r[3]=="free-polygon",x(y,"class","svelte-cej5os"),x($,"type","button"),$.disabled=P=r[3]=="snap-polygon",x($,"class","svelte-cej5os"),x(e,"class","toolbox svelte-cej5os")},m(q,ue){k(q,e,ue),w(e,t),w(t,n),w(n,i),w(t,s),H(a,t,null),w(e,l),w(e,u),w(u,p),w(p,g),w(u,f),he&&he.m(u,null),w(e,h),w(e,m),Se&&Se.m(m,null),w(m,_),H(b,m,null),w(e,d),w(e,v),w(v,y),w(y,M),w(v,R),H(L,v,null),w(e,N),w(e,I),w(I,$),w($,W),w(I,D),de&&de.m(I,null),w(e,oe),w(e,fe),Ee&&Ee.m(fe,null),w(fe,G),H(se,fe,null),w(e,Ae),w(e,pe),Me&&Me.m(pe,null),w(pe,ce),H(Pe,pe,null),ne=!0,F||(V=[B(n,"click",r[14]),B(p,"click",r[16]),B(y,"click",r[20]),B($,"click",r[22])],F=!0)},p(q,[ue]){(!ne||ue&8&&o!==(o=q[3]=="edit-attribute"))&&(n.disabled=o);const Tn={};ue&8&&(Tn.mode=q[3]),a.$set(Tn),(!ne||ue&8&&c!==(c=q[3]=="edit-geometry"))&&(p.disabled=c),q[2]?he?(he.p(q,ue),ue&4&&T(he,1)):(he=Er(q),he.c(),T(he,1),he.m(u,null)):he&&(ve(),A(he,1,1,()=>{he=null}),ye()),q[1]!="planning"?Se?Se.p(q,ue):(Se=Mr(q),Se.c(),Se.m(m,_)):Se&&(Se.d(1),Se=null);const Rn={};ue&8&&(Rn.mode=q[3]),b.$set(Rn),(!ne||ue&8&&O!==(O=q[3]=="free-polygon"))&&(y.disabled=O);const An={};ue&8&&(An.mode=q[3]),L.$set(An),(!ne||ue&8&&P!==(P=q[3]=="snap-polygon"))&&($.disabled=P),q[2]?de?(de.p(q,ue),ue&4&&T(de,1)):(de=Or(q),de.c(),T(de,1),de.m(I,null)):de&&(ve(),A(de,1,1,()=>{de=null}),ye()),q[1]!="planning"?Ee?Ee.p(q,ue):(Ee=Lr(q),Ee.c(),Ee.m(fe,G)):Ee&&(Ee.d(1),Ee=null);const Ot={};ue&8&&(Ot.mode=q[3]),ue&1&&(Ot.url=q[0]),!ke&&ue&4&&(ke=!0,Ot.routeTool=q[2],xe(()=>ke=!1)),se.$set(Ot),q[1]!="planning"?Me?Me.p(q,ue):(Me=xr(q),Me.c(),Me.m(pe,ce)):Me&&(Me.d(1),Me=null);const Pn={};ue&8&&(Pn.mode=q[3]),Pe.$set(Pn)},i(q){ne||(T(a.$$.fragment,q),T(he),T(b.$$.fragment,q),T(L.$$.fragment,q),T(de),T(se.$$.fragment,q),T(Pe.$$.fragment,q),ne=!0)},o(q){A(a.$$.fragment,q),A(he),A(b.$$.fragment,q),A(L.$$.fragment,q),A(de),A(se.$$.fragment,q),A(Pe.$$.fragment,q),ne=!1},d(q){q&&S(e),r[15](null),U(a),he&&he.d(),Se&&Se.d(),r[19](null),U(b),r[21](null),U(L),de&&de.d(),Ee&&Ee.d(),r[25](null),U(se),Me&&Me.d(),r[28](null),U(Pe),F=!1,Ce(V)}}}function jl(r,e,t){let n;ie(r,Ge,G=>t(29,n=G));let{routeUrl:i}=e,{schema:o}=e,s,a=new Ss(n),l=new Ns(n),u="edit-attribute",p,g,c,f,h,m,_;function b(G){let se={"edit-attribute":p,"edit-geometry":g,route:c,point:f,"free-polygon":h,"snap-polygon":m,"split-route":_};if(u==G){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),se[u].stop(),t(3,u=G),console.log(`Starting new mode ${u}`),se[u].start()}Et(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const d=()=>b("edit-attribute");function v(G){re[G?"unshift":"push"](()=>{p=G,t(4,p)})}const y=()=>b("edit-geometry");function M(G){re[G?"unshift":"push"](()=>{g=G,t(5,g)})}const O=()=>b("point");function R(G){re[G?"unshift":"push"](()=>{f=G,t(7,f)})}const L=()=>b("free-polygon");function N(G){re[G?"unshift":"push"](()=>{h=G,t(8,h)})}const I=()=>b("snap-polygon");function $(G){re[G?"unshift":"push"](()=>{m=G,t(9,m)})}const W=()=>b("route");function P(G){re[G?"unshift":"push"](()=>{c=G,t(6,c)})}function D(G){s=G,t(2,s)}const oe=()=>b("split-route");function fe(G){re[G?"unshift":"push"](()=>{_=G,t(10,_)})}return r.$$set=G=>{"routeUrl"in G&&t(0,i=G.routeUrl),"schema"in G&&t(1,o=G.schema)},[i,o,s,u,p,g,c,f,h,m,_,a,l,b,d,v,y,M,O,R,L,N,I,$,W,P,D,oe,fe]}class Yl extends Z{constructor(e){super(),Q(this,e,jl,ql,K,{routeUrl:0,schema:1})}}function Hl(r){let e,t,n,i,o,s,a,l,u,p,g,c,f,h,m,_,b,d;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",i=C(),o=E("button"),o.textContent="About",s=C(),a=E("button"),a.textContent="Instructions",l=C(),u=E("br"),p=C(),g=E("label"),c=X(`ATIP schema:
      `),f=E("select"),h=E("option"),h.textContent="v1",m=E("option"),m.textContent="v2",_=E("option"),_.textContent="Housing developments",x(n,"type","button"),x(o,"type","button"),x(a,"type","button"),h.__value="v1",h.value=h.__value,m.__value="v2",m.value=m.__value,_.__value="planning",_.value=_.__value,r[2]===void 0&&zt(()=>r[11].call(f)),x(e,"slot","nav")},m(v,y){k(v,e,y),w(e,t),w(t,n),w(t,i),w(t,o),w(t,s),w(t,a),w(e,l),w(e,u),w(e,p),w(e,g),w(g,c),w(g,f),w(f,h),w(f,m),w(f,_),$t(f,r[2]),b||(d=[B(n,"click",r[10]),B(o,"click",r[7]),B(a,"click",r[8]),B(f,"change",r[11]),B(f,"change",r[9])],b=!0)},p(v,y){y&4&&$t(f,v[2])},d(v){v&&S(e),b=!1,Ce(d)}}}function Ul(r){let e,t,n,i,o,s,a,l,u,p,g,c;return o=new fs({props:{boundaryGeojson:r[4]}}),a=new ss({props:{authorityName:r[5],schema:r[2]}}),g=new ts({props:{schema:r[2]}}),{c(){e=E("div"),t=E("h1"),n=X(r[5]),i=C(),Y(o.$$.fragment),s=C(),Y(a.$$.fragment),l=C(),u=E("br"),p=C(),Y(g.$$.fragment),x(e,"slot","sidebar")},m(f,h){k(f,e,h),w(e,t),w(t,n),w(t,i),H(o,t,null),w(e,s),H(a,e,null),w(e,l),w(e,u),w(e,p),H(g,e,null),c=!0},p(f,h){const m={};h&16&&(m.boundaryGeojson=f[4]),o.$set(m);const _={};h&4&&(_.schema=f[2]),a.$set(_);const b={};h&4&&(b.schema=f[2]),g.$set(b)},i(f){c||(T(o.$$.fragment,f),T(a.$$.fragment,f),T(g.$$.fragment,f),c=!0)},o(f){A(o.$$.fragment,f),A(a.$$.fragment,f),A(g.$$.fragment,f),c=!1},d(f){f&&S(e),U(o),U(a),U(g)}}}function Jl(r){let e,t,n,i,o,s,a,l,u,p,g,c;return e=new mo({props:{boundaryGeojson:r[4]}}),n=new bs({props:{schema:r[2]}}),o=new ks({}),a=new Yl({props:{routeUrl:r[3],schema:r[2]}}),u=new hs({props:{style:r[6]}}),g=new vs({props:{schema:r[2]}}),{c(){Y(e.$$.fragment),t=C(),Y(n.$$.fragment),i=C(),Y(o.$$.fragment),s=C(),Y(a.$$.fragment),l=C(),Y(u.$$.fragment),p=C(),Y(g.$$.fragment)},m(f,h){H(e,f,h),k(f,t,h),H(n,f,h),k(f,i,h),H(o,f,h),k(f,s,h),H(a,f,h),k(f,l,h),H(u,f,h),k(f,p,h),H(g,f,h),c=!0},p(f,h){const m={};h&16&&(m.boundaryGeojson=f[4]),e.$set(m);const _={};h&4&&(_.schema=f[2]),n.$set(_);const b={};h&8&&(b.routeUrl=f[3]),h&4&&(b.schema=f[2]),a.$set(b);const d={};h&4&&(d.schema=f[2]),g.$set(d)},i(f){c||(T(e.$$.fragment,f),T(n.$$.fragment,f),T(o.$$.fragment,f),T(a.$$.fragment,f),T(u.$$.fragment,f),T(g.$$.fragment,f),c=!0)},o(f){A(e.$$.fragment,f),A(n.$$.fragment,f),A(o.$$.fragment,f),A(a.$$.fragment,f),A(u.$$.fragment,f),A(g.$$.fragment,f),c=!1},d(f){U(e,f),f&&S(t),U(n,f),f&&S(i),U(o,f),f&&S(s),U(a,f),f&&S(l),U(u,f),f&&S(p),U(g,f)}}}function Xl(r){let e,t,n;return t=new Ni({props:{style:r[6],$$slots:{default:[Jl]},$$scope:{ctx:r}}}),{c(){e=E("div"),Y(t.$$.fragment),x(e,"slot","main")},m(i,o){k(i,e,o),H(t,e,null),n=!0},p(i,o){const s={};o&131100&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(T(t.$$.fragment,i),n=!0)},o(i){A(t.$$.fragment,i),n=!1},d(i){i&&S(e),U(t)}}}function zl(r){let e,t,n,i,o,s,a,l;e=new qi({props:{$$slots:{main:[Xl],sidebar:[Ul],nav:[Hl]},$$scope:{ctx:r}}});function u(f){r[12](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new Li({props:p}),re.push(()=>Le(n,"open",u,r[0]));function g(f){r[13](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Ai({props:c}),re.push(()=>Le(s,"open",g,r[1])),{c(){Y(e.$$.fragment),t=C(),Y(n.$$.fragment),o=C(),Y(s.$$.fragment)},m(f,h){H(e,f,h),k(f,t,h),H(n,f,h),k(f,o,h),H(s,f,h),l=!0},p(f,[h]){const m={};h&131100&&(m.$$scope={dirty:h,ctx:f}),e.$set(m);const _={};!i&&h&1&&(i=!0,_.open=f[0],xe(()=>i=!1)),n.$set(_);const b={};!a&&h&2&&(a=!0,b.open=f[1],xe(()=>a=!1)),s.$set(b)},i(f){l||(T(e.$$.fragment,f),T(n.$$.fragment,f),T(s.$$.fragment,f),l=!0)},o(f){A(e.$$.fragment,f),A(n.$$.fragment,f),A(s.$$.fragment,f),l=!1},d(f){U(e,f),f&&S(t),U(n,f),f&&S(o),U(s,f)}}}function Wl(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${a}.bin`;o||(p=`https://atip.uk/route-snappers-dev/${a}.bin`);function g(){t(0,n=!n),t(1,i=!1)}function c(){t(1,i=!i),t(0,n=!1)}let f;Sn(async()=>{t(4,f=await h())});async function h(){const M=await(await fetch(xi)).text(),O=JSON.parse(M);return O.features=O.features.filter(R=>{var L;return((L=R.properties)==null?void 0:L.name)==a}),O}function m(){let y=new URLSearchParams(window.location.search);y.set("schema",u);let M=`${window.location.pathname}?${y.toString()}${window.location.hash}`;window.location.href=M}const _=()=>window.open("index.html");function b(){u=Rr(this),t(2,u)}function d(y){n=y,t(0,n)}function v(y){i=y,t(1,i)}return[n,i,u,p,f,a,l,g,c,m,_,b,d,v]}class Vl extends Z{constructor(e){super(),Q(this,e,Wl,zl,K,{})}}new Vl({target:document.getElementById("app")});
