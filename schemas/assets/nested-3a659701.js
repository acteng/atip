var fi=Object.defineProperty;var ci=(r,e,t)=>e in r?fi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var oe=(r,e,t)=>(ci(r,typeof e!="symbol"?e+"":e,t),t);import{S as re,i as ie,s as ne,M as pi,b as _e,a as $e,d as W,m as V,k as Be,n as x,o as P,q as K,e as S,c as O,g as y,x as U,p as w,y as Je,f as T,z as Ce,B as Re,C as hi,D as In,E as mn,F as jt,G as At,H as xt,I as Pt,J as Ft,K as zn,h as k,l as G,L as di,N as mi,O as ce,P as _i,w as $n,Q as ft,R as Ae,T as un,t as z,U as Me,V as ge,j as Fe,r as ze,W as Xe,X as an,Y as _t,Z as at,_ as Ie,$ as gt,a0 as Yn,a1 as Hn,a2 as Un,a3 as gi,a4 as vi,a5 as Ge,a6 as bi,a7 as yi,a8 as wi,a9 as fn,aa as St,ab as cn,ac as Dt,ad as pn,ae as wn,af as ki,ag as yt,ah as Bn,ai as ot,aj as wt,ak as Si,al as Dn,am as Ei,an as Mi,ao as Oi,ap as Jn,aq as Zt,ar as Li,as as Ci,at as Ri,A as Ti,u as Ai}from"./authorities-5654dece.js";function xi(r){let e,t,n,i,o,s,u,l,a,f,m,p,c;return{c(){e=S("p"),e.textContent="For each intervention:",t=O(),n=S("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=O(),o=S("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=O(),u=S("p"),u.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=O(),a=S("p"),a.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,f=O(),m=S("p"),m.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,p=O(),c=S("p"),c.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(d,_){y(d,e,_),y(d,t,_),y(d,n,_),y(d,i,_),y(d,o,_),y(d,s,_),y(d,u,_),y(d,l,_),y(d,a,_),y(d,f,_),y(d,m,_),y(d,p,_),y(d,c,_)},p:U,d(d){d&&w(e),d&&w(t),d&&w(n),d&&w(i),d&&w(o),d&&w(s),d&&w(u),d&&w(l),d&&w(a),d&&w(f),d&&w(m),d&&w(p),d&&w(c)}}}function Pi(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[xi]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new pi({props:o}),_e.push(()=>$e(e,"open",i,r[0])),{c(){W(e.$$.fragment)},m(s,u){V(e,s,u),n=!0},p(s,[u]){const l={};u&4&&(l.$$scope={dirty:u,ctx:s}),!t&&u&1&&(t=!0,l.open=s[0],Be(()=>t=!1)),e.$set(l)},i(s){n||(x(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function Fi(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Ni extends re{constructor(e){super(),ie(this,e,Fi,Pi,ne,{open:0})}}const ct=[];function Et(r,e=U){let t;const n=new Set;function i(u){if(ne(r,u)&&(r=u,t)){const l=!ct.length;for(const a of n)a[1](),ct.push(a,r);if(l){for(let a=0;a<ct.length;a+=2)ct[a][0](ct[a+1]);ct.length=0}}}function o(u){i(u(r))}function s(u,l=U){const a=[u,l];return n.add(a),n.size===1&&(t=e(i)||U),u(r),()=>{n.delete(a),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const We=Et(null),se=Et(Je()),Ne=Et(null),et=Et(null),Qt=Et(null),kn=Et(null);function zt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Xn(r){se.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Ne.set(null),et.set(null),Qt.set(null)}function Wn(r){let e;const t=r[4].default,n=At(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&xt(n,t,i,i[3],e?Ft(t,i[3],o,null):Pt(i[3]),null)},i(i){e||(x(n,i),e=!0)},o(i){P(n,i),e=!1},d(i){n&&n.d(i)}}}function Ii(r){let e,t,n=r[1]&&Wn(r);return{c(){e=S("div"),n&&n.c(),T(e,"class","map svelte-12dpf1u")},m(i,o){y(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&x(n,1)):(n=Wn(i),n.c(),x(n,1),n.m(e,null)):n&&(Ce(),P(n,1,1,()=>{n=null}),Re())},i(i){t||(x(n),t=!0)},o(i){P(n),t=!1},d(i){i&&w(e),n&&n.d(),r[5](null)}}}function $i(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,u,l=!1;hi("setCamera",!window.location.hash),In(()=>{s=new mn.Map({container:u,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new mn.ScaleControl({})),s.addControl(new mn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),We.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(u)}),jt(()=>{s.remove()});function a(f){_e[f?"unshift":"push"](()=>{u=f,t(0,u)})}return r.$$set=f=>{"style"in f&&t(2,o=f.style),"$$scope"in f&&t(3,i=f.$$scope)},[u,l,o,i,n,a]}class Bi extends re{constructor(e){super(),ie(this,e,$i,Ii,ne,{style:2})}}const Di=r=>({}),Vn=r=>({}),qi=r=>({}),Kn=r=>({}),Gi=r=>({}),Zn=r=>({});function ji(r){let e,t,n,i,o,s,u,l,a,f,m,p;const c=r[3].nav,d=At(c,r,r[2],Zn),_=r[3].sidebar,g=At(_,r,r[2],Kn),E=r[3].main,h=At(E,r,r[2],Vn);return{c(){e=S("aside"),t=S("div"),n=S("nav"),d&&d.c(),i=O(),g&&g.c(),o=O(),s=S("button"),s.textContent="â†’",l=O(),a=S("main"),h&&h.c(),T(n,"class","svelte-1u7vg8a"),T(t,"class","sidebar-content content-container svelte-1u7vg8a"),T(s,"type","button"),T(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),T(e,"class",u=zn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),T(a,"class","svelte-1u7vg8a")},m(v,b){y(v,e,b),k(e,t),k(t,n),d&&d.m(n,null),k(t,i),g&&g.m(t,null),k(e,o),k(e,s),y(v,l,b),y(v,a,b),h&&h.m(a,null),f=!0,m||(p=G(s,"click",r[1]),m=!0)},p(v,[b]){d&&d.p&&(!f||b&4)&&xt(d,c,v,v[2],f?Ft(c,v[2],b,Gi):Pt(v[2]),Zn),g&&g.p&&(!f||b&4)&&xt(g,_,v,v[2],f?Ft(_,v[2],b,qi):Pt(v[2]),Kn),(!f||b&1&&u!==(u=zn(v[0]?"":"collapsed")+" svelte-1u7vg8a"))&&T(e,"class",u),h&&h.p&&(!f||b&4)&&xt(h,E,v,v[2],f?Ft(E,v[2],b,Di):Pt(v[2]),Vn)},i(v){f||(x(d,v),x(g,v),x(h,v),f=!0)},o(v){P(d,v),P(g,v),P(h,v),f=!1},d(v){v&&w(e),d&&d.d(v),g&&g.d(v),v&&w(l),v&&w(a),h&&h.d(v),m=!1,p()}}}function zi(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=u=>{"$$scope"in u&&t(2,i=u.$$scope)},[o,s,i,n]}class Yi extends re{constructor(e){super(),ie(this,e,zi,ji,ne,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Hi(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(f){return l([a,f])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(f){a=[6,f],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var lt=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Ui(r,e){return r>e?1:r<e?-1:0}function tt(r,e,t){for(var n=new lt(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function _n(r,e,t,n){var i=new lt(r,e);if(t===null)return i.left=i.right=null,i;t=tt(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Qn(r,e,t){var n=null,i=null;if(e){e=tt(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Ji(r,e,t){return e===null?r:(r===null||(e=tt(r.key,e,t),e.left=r),e)}function Sn(r,e,t,n,i){if(r){n(""+e+(t?"â””â”€â”€ ":"â”œâ”€â”€ ")+i(r)+`
`);var o=e+(t?"    ":"â”‚   ");r.left&&Sn(r.left,o,!1,n,i),r.right&&Sn(r.right,o,!0,n,i)}}var qn=function(){function r(e){e===void 0&&(e=Ui),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=_n(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new lt(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=tt(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=tt(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=tt(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=tt(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=tt(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,u=this._root,l;o.length!==0||u;)if(u)o.push(u),u=u.left;else{if(u=o.pop(),l=s(u.key,t),l>0)break;if(s(u.key,e)>=0&&n.call(i,u))return this;u=u.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Wi(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&On(e,t,0,i-1,o),this._root===null)this._root=En(e,t,0,i),this._size=i;else{var s=Vi(this.toList(),Xi(e,t),o);i=this._size+i,this._root=Mn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Sn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Qn(e,this._root,i),s=o.left,u=o.right;i(e,t)<0?u=_n(t,n,u,i):s=_n(t,n,s,i),this._root=Ji(s,u,i)},r.prototype.split=function(e){return Qn(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Hi(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function En(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],u=e[o],l=new lt(s,u);return l.left=En(r,e,t,o),l.right=En(r,e,o+1,n),l}return null}function Xi(r,e){for(var t=new lt(null,null),n=t,i=0;i<r.length;i++)n=n.next=new lt(r[i],e[i]);return n.next=null,t.next}function Wi(r){for(var e=r,t=[],n=!1,i=new lt(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Mn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Mn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Mn(r,i+1,t),s}return null}function Vi(r,e,t){for(var n=new lt(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function On(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,u=n+1;;){do s++;while(i(r[s],o)<0);do u--;while(i(r[u],o)>0);if(s>=u)break;var l=r[s];r[s]=r[u],r[u]=l,l=e[s],e[s]=e[u],e[u]=l}On(r,e,t,u,i),On(r,e,u+1,n,i)}}function De(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function er(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Pe(r,e,t){return e&&er(r.prototype,e),t&&er(r,t),r}var Rt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Ln=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},rt=Number.EPSILON;rt===void 0&&(rt=Math.pow(2,-52));var Ki=rt*rt,Cn=function(e,t){if(-rt<e&&e<rt&&-rt<t&&t<rt)return 0;var n=e-t;return n*n<Ki*e*t?0:e<t?-1:1},Zi=function(){function r(){De(this,r),this.reset()}return Pe(r,[{key:"reset",value:function(){this.xRounder=new tr,this.yRounder=new tr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),tr=function(){function r(){De(this,r),this.tree=new qn,this.round(0)}return Pe(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Cn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Cn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),qt=new Zi,Nt=function(e,t){return e.x*t.y-e.y*t.x},Jr=function(e,t){return e.x*t.x+e.y*t.y},nr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Nt(i,o);return Cn(s,0)},en=function(e){return Math.sqrt(Jr(e,e))},Qi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Nt(o,i)/en(o)/en(i)},eo=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Jr(o,i)/en(o)/en(i)},rr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},ir=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},to=function(e,t,n,i){if(t.x===0)return ir(n,i,e.x);if(i.x===0)return ir(e,t,n.x);if(t.y===0)return rr(n,i,e.y);if(i.y===0)return rr(e,t,n.y);var o=Nt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},u=Nt(s,t)/o,l=Nt(s,i)/o,a=e.x+l*t.x,f=n.x+u*i.x,m=e.y+l*t.y,p=n.y+u*i.y,c=(a+f)/2,d=(m+p)/2;return{x:c,y:d}},He=function(){Pe(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:tn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){De(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Pe(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(u){var l=u.otherSE;i.set(u,{sine:Qi(n.point,t.point,l.point),cosine:eo(n.point,t.point,l.point)})};return function(s,u){i.has(s)||o(s),i.has(u)||o(u);var l=i.get(s),a=l.sine,f=l.cosine,m=i.get(u),p=m.sine,c=m.cosine;return a>=0&&p>=0?f<c?1:f>c?-1:0:a<0&&p<0?f<c?-1:f>c?1:0:p<a?-1:p>a?1:0}}}]),r}(),no=0,tn=function(){Pe(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,u=n.rightSE.point.x;if(u<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,a=n.leftSE.point.y,f=t.rightSE.point.y,m=n.rightSE.point.y;if(i<o){if(a<l&&a<f)return 1;if(a>l&&a>f)return-1;var p=t.comparePoint(n.leftSE.point);if(p<0)return 1;if(p>0)return-1;var c=n.comparePoint(t.rightSE.point);return c!==0?c:-1}if(i>o){if(l<a&&l<m)return-1;if(l>a&&l>m)return 1;var d=n.comparePoint(t.leftSE.point);if(d!==0)return d;var _=t.comparePoint(n.rightSE.point);return _<0?1:_>0?-1:1}if(l<a)return-1;if(l>a)return 1;if(s<u){var g=n.comparePoint(t.rightSE.point);if(g!==0)return g}if(s>u){var E=t.comparePoint(n.rightSE.point);if(E<0)return 1;if(E>0)return-1}if(s!==u){var h=f-l,v=s-i,b=m-a,L=u-o;if(h>v&&b<L)return 1;if(h<v&&b>L)return-1}return s>u?1:s<u||f<m?-1:f>m?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){De(this,r),this.id=++no,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Pe(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,u=n.x+s*o.x;if(t.x===u)return 0;var l=(t.x-n.x)/o.x,a=n.y+l*o.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Ln(n,i);if(o===null)return null;var s=this.leftSE.point,u=this.rightSE.point,l=t.leftSE.point,a=t.rightSE.point,f=Rt(n,l)&&this.comparePoint(l)===0,m=Rt(i,s)&&t.comparePoint(s)===0,p=Rt(n,a)&&this.comparePoint(a)===0,c=Rt(i,u)&&t.comparePoint(u)===0;if(m&&f)return c&&!p?u:!c&&p?a:null;if(m)return p&&s.x===a.x&&s.y===a.y?null:s;if(f)return c&&u.x===l.x&&u.y===l.y?null:l;if(c&&p)return null;if(c)return u;if(p)return a;var d=to(s,this.vector(),l,t.vector());return d===null||!Rt(o,d)?null:qt.round(d.x,d.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new He(t,!0),s=new He(t,!1),u=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,u,this.rings.slice(),this.windings.slice());return He.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),He.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var u=n;n=i,i=u}for(var l=0,a=i.rings.length;l<a;l++){var f=i.rings[l],m=i.windings[l],p=n.rings.indexOf(f);p===-1?(n.rings.push(f),n.windings.push(m)):n.windings[p]+=m}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,u=this.rings.length;s<u;s++){var l=this.rings[s],a=this.windings[s],f=n.indexOf(l);f===-1?(n.push(l),i.push(a)):i[f]+=a}for(var m=[],p=[],c=0,d=n.length;c<d;c++)if(i[c]!==0){var _=n[c],g=_.poly;if(p.indexOf(g)===-1)if(_.isExterior)m.push(g);else{p.indexOf(g)===-1&&p.push(g);var E=m.indexOf(_.poly);E!==-1&&m.splice(E,1)}}for(var h=0,v=m.length;h<v;h++){var b=m[h].multiPoly;o.indexOf(b)===-1&&o.push(b)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(je.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,u;t.length<n.length?(s=t.length,u=n.length):(s=n.length,u=t.length),this._isInResult=u===je.numMultiPolys&&s<u;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var a=function(m){return m.length===1&&m[0].isSubject};this._isInResult=a(t)!==a(n);break}default:throw new Error("Unrecognized operation type found ".concat(je.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,u,l=He.comparePoints(t,n);if(l<0)o=t,s=n,u=1;else if(l>0)o=n,s=t,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var a=new He(o,!0),f=new He(s,!1);return new r(a,f,[i],[u])}}]),r}(),or=function(){function r(e,t,n){if(De(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=qt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,u=e.length;s<u;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=qt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(tn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(tn.fromRing(o,i,this))}return Pe(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),ro=function(){function r(e,t){if(De(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new or(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new or(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Pe(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),sr=function(){function r(e,t){if(De(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new ro(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Pe(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),io=function(){Pe(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var u=null,l=s.leftSE,a=s.rightSE,f=[l],m=l.point,p=[];u=l,l=a,f.push(l),l.point!==m;)for(;;){var c=l.getAvailableLinkedEvents();if(c.length===0){var d=f[0].point,_=f[f.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(_.x,", ").concat(_.y,"]."))}if(c.length===1){a=c[0].otherSE;break}for(var g=null,E=0,h=p.length;E<h;E++)if(p[E].point===l.point){g=E;break}if(g!==null){var v=p.splice(g)[0],b=f.splice(v.index);b.unshift(b[0].otherSE),n.push(new r(b.reverse()));continue}p.push({index:f.length,point:l.point});var L=l.getLeftmostComparator(u);a=c.sort(L)[0].otherSE;break}n.push(new r(f))}}return n}}]);function r(e){De(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Pe(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,u=this.events[i+1].point;nr(s,t,u)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],a=n[1];nr(l,t,a)===0&&n.shift(),n.push(n[0]);for(var f=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:n.length-1,p=this.isExteriorRing()?n.length:-1,c=[],d=m;d!=p;d+=f)c.push([n[d].x,n[d].y]);return c}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];He.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),u=s?s.prevInResult():null;;){if(!s)return null;if(!u)return s.ringOut;if(u.ringOut!==s.ringOut)return u.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=u.prevInResult(),u=s?s.prevInResult():null}}}]),r}(),lr=function(){function r(e){De(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Pe(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),oo=function(){function r(e){De(this,r),this.rings=e,this.polys=this._composePolys(e)}return Pe(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new lr(s));else{var u=s.enclosingRing();u.poly||n.push(new lr(u)),u.poly.addInterior(s)}}return n}}]),r}(),so=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:tn.compare;De(this,r),this.queue=e,this.tree=new qn(t),this.segments=[]}return Pe(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,u=o,l=void 0,a=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;a===void 0;)u=this.tree.next(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);if(t.isLeft){var f=null;if(l){var m=l.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(f=m),!l.isAnEndpoint(m)))for(var p=this._splitSafely(l,m),c=0,d=p.length;c<d;c++)i.push(p[c])}var _=null;if(a){var g=a.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(_=g),!a.isAnEndpoint(g)))for(var E=this._splitSafely(a,g),h=0,v=E.length;h<v;h++)i.push(E[h])}if(f!==null||_!==null){var b=null;if(f===null)b=_;else if(_===null)b=f;else{var L=He.comparePoints(f,_);b=L<=0?f:_}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var R=n.split(b),A=0,C=R.length;A<C;A++)i.push(R[A])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&a){var $=l.getIntersection(a);if($!==null){if(!l.isAnEndpoint($))for(var D=this._splitSafely(l,$),B=0,J=D.length;B<J;B++)i.push(D[B]);if(!a.isAnEndpoint($))for(var F=this._splitSafely(a,$),Y=0,te=F.length;Y<te;Y++)i.push(F[Y])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),ur=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,lo=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,uo=function(){function r(){De(this,r)}return Pe(r,[{key:"run",value:function(t,n,i){je.type=t,qt.reset();for(var o=[new sr(n,!0)],s=0,u=i.length;s<u;s++)o.push(new sr(i[s],!1));if(je.numMultiPolys=o.length,je.type==="difference")for(var l=o[0],a=1;a<o.length;)Ln(o[a].bbox,l.bbox)!==null?a++:o.splice(a,1);if(je.type==="intersection"){for(var f=0,m=o.length;f<m;f++)for(var p=o[f],c=f+1,d=o.length;c<d;c++)if(Ln(p.bbox,o[c].bbox)===null)return[]}for(var _=new qn(He.compare),g=0,E=o.length;g<E;g++)for(var h=o[g].getSweepEvents(),v=0,b=h.length;v<b;v++)if(_.insert(h[v]),_.size>ur)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var L=new so(_),R=_.size,A=_.pop();A;){var C=A.key;if(_.size===R){var $=C.segment;throw new Error("Unable to pop() ".concat(C.isLeft?"left":"right"," SweepEvent ")+"[".concat(C.point.x,", ").concat(C.point.y,"] from segment #").concat($.id," ")+"[".concat($.leftSE.point.x,", ").concat($.leftSE.point.y,"] -> ")+"[".concat($.rightSE.point.x,", ").concat($.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(_.size>ur)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(L.segments.length>lo)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var D=L.process(C),B=0,J=D.length;B<J;B++){var F=D[B];F.consumedBy===void 0&&_.insert(F)}R=_.size,A=_.pop()}qt.reset();var Y=io.factory(L.segments),te=new oo(Y);return te.getGeom()}}]),r}(),je=new uo,ao=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return je.run("union",e,n)},fo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return je.run("intersection",e,n)},co=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return je.run("xor",e,n)},po=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return je.run("difference",e,n)},Ut={union:ao,intersection:fo,xor:co,difference:po};function ho(r,e){var t=_o(e),n=null;return r.type==="FeatureCollection"?n=mo(r):n=Xr(Ut.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function mo(r){var e=r.features.length===2?Ut.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Ut.union.apply(Ut,r.features.map(function(t){return t.geometry.coordinates}));return Xr(e)}function Xr(r){return di(r)}function _o(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return mi(t)}function go(r,e,t){let n;ce(r,We,s=>t(1,n=s));let{boundaryGeojson:i}=e;return _i("setCamera")&&n.fitBounds($n(i),{padding:20,animate:!1}),ft(n,"boundary",{type:"geojson",data:ho(i)}),Ae(n,{id:"boundary",source:"boundary",...un("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class vo extends re{constructor(e){super(),ie(this,e,go,null,ne,{boundaryGeojson:0})}}function ar(r){let e,t=fr(r[3])+"",n;return{c(){e=z("Length: "),n=z(t)},m(i,o){y(i,e,o),y(i,n,o)},p(i,o){o&8&&t!==(t=fr(i[3])+"")&&Xe(n,t)},d(i){i&&w(e),i&&w(n)}}}function bo(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,d,_,g,E,h,v,b,L,R,A,C,$,D,B,J,F,Y,te,pe,q,le,we,xe,he,ae,Oe,ue=r[3]&&ar(r);return{c(){e=S("label"),t=z("Name:"),n=S("br"),i=O(),o=S("input"),s=O(),u=S("br"),l=O(),a=S("br"),f=O(),m=S("label"),p=S("input"),c=z(`
  Area`),d=O(),_=S("label"),g=S("input"),E=z(`
  Route`),h=O(),v=S("label"),b=S("input"),L=z(`
  Crossing`),R=O(),A=S("label"),C=S("input"),$=z(`
  Other`),D=O(),B=S("br"),J=O(),F=S("br"),Y=O(),te=S("label"),pe=z("Description:"),q=S("br"),le=O(),we=S("textarea"),xe=O(),ue&&ue.c(),he=Me(),T(o,"type","text"),ge(o,"width","100%"),T(p,"type","radio"),p.__value="area",p.value=p.__value,r[6][0].push(p),T(g,"type","radio"),g.__value="route",g.value=g.__value,r[6][0].push(g),T(b,"type","radio"),b.__value="crossing",b.value=b.__value,r[6][0].push(b),T(C,"type","radio"),C.__value="other",C.value=C.__value,r[6][0].push(C),ge(we,"width","100%"),T(we,"rows","5"),T(we,"class","svelte-15lna0i")},m(N,Q){y(N,e,Q),k(e,t),k(e,n),k(e,i),k(e,o),Fe(o,r[0]),y(N,s,Q),y(N,u,Q),y(N,l,Q),y(N,a,Q),y(N,f,Q),y(N,m,Q),k(m,p),p.checked=p.__value===r[1],k(m,c),y(N,d,Q),y(N,_,Q),k(_,g),g.checked=g.__value===r[1],k(_,E),y(N,h,Q),y(N,v,Q),k(v,b),b.checked=b.__value===r[1],k(v,L),y(N,R,Q),y(N,A,Q),k(A,C),C.checked=C.__value===r[1],k(A,$),y(N,D,Q),y(N,B,Q),y(N,J,Q),y(N,F,Q),y(N,Y,Q),y(N,te,Q),k(te,pe),k(te,q),k(te,le),k(te,we),Fe(we,r[2]),y(N,xe,Q),ue&&ue.m(N,Q),y(N,he,Q),ae||(Oe=[G(o,"input",r[4]),G(p,"change",r[5]),G(g,"change",r[7]),G(b,"change",r[8]),G(C,"change",r[9]),G(we,"input",r[10])],ae=!0)},p(N,[Q]){Q&1&&o.value!==N[0]&&Fe(o,N[0]),Q&2&&(p.checked=p.__value===N[1]),Q&2&&(g.checked=g.__value===N[1]),Q&2&&(b.checked=b.__value===N[1]),Q&2&&(C.checked=C.__value===N[1]),Q&4&&Fe(we,N[2]),N[3]?ue?ue.p(N,Q):(ue=ar(N),ue.c(),ue.m(he.parentNode,he)):ue&&(ue.d(1),ue=null)},i:U,o:U,d(N){N&&w(e),N&&w(s),N&&w(u),N&&w(l),N&&w(a),N&&w(f),N&&w(m),r[6][0].splice(r[6][0].indexOf(p),1),N&&w(d),N&&w(_),r[6][0].splice(r[6][0].indexOf(g),1),N&&w(h),N&&w(v),r[6][0].splice(r[6][0].indexOf(b),1),N&&w(R),N&&w(A),r[6][0].splice(r[6][0].indexOf(C),1),N&&w(D),N&&w(B),N&&w(J),N&&w(F),N&&w(Y),N&&w(te),N&&w(xe),ue&&ue.d(N),N&&w(he),ae=!1,ze(Oe)}}}function fr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function yo(r,e,t){let{name:n}=e,{intervention_type:i}=e,{description:o}=e,{length_meters:s}=e;const u=[[]];function l(){n=this.value,t(0,n)}function a(){i=this.__value,t(1,i)}function f(){i=this.__value,t(1,i)}function m(){i=this.__value,t(1,i)}function p(){i=this.__value,t(1,i)}function c(){o=this.value,t(2,o)}return r.$$set=d=>{"name"in d&&t(0,n=d.name),"intervention_type"in d&&t(1,i=d.intervention_type),"description"in d&&t(2,o=d.description),"length_meters"in d&&t(3,s=d.length_meters)},[n,i,o,s,l,a,u,f,m,p,c]}class wo extends re{constructor(e){super(),ie(this,e,yo,bo,ne,{name:0,intervention_type:1,description:2,length_meters:3})}}const ko="Route",So=[{name:"RouteType",oneOf:[{name:"OnRoad",members:[{name:"Type",oneOf:["FullSeparation","Stepped","PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}],Eo={name:ko,members:So};function cr(r,e,t){const n=r.slice();return n[8]=e[t],n}function pr(r,e,t){const n=r.slice();return n[8]=e[t],n[9]=e,n[10]=t,n}function Mo(r){let e,t=r[1].name+"",n,i,o,s,u;return{c(){e=S("label"),n=z(t),i=z(`:
    `),o=S("input"),T(o,"type","number")},m(l,a){y(l,e,a),k(e,n),k(e,i),k(e,o),Fe(o,r[0]),s||(u=G(o,"input",r[7]),s=!0)},p(l,a){a&2&&t!==(t=l[1].name+"")&&Xe(n,t),a&1&&an(o.value)!==l[0]&&Fe(o,l[0])},i:U,o:U,d(l){l&&w(e),s=!1,u()}}}function Oo(r){let e,t=r[1].name+"",n,i,o,s,u=r[1].oneOf,l=[];for(let f=0;f<u.length;f+=1)l[f]=dr(cr(r,u,f));const a=f=>P(l[f],1,1,()=>{l[f]=null});return{c(){e=S("h1"),n=z(t),i=O();for(let f=0;f<l.length;f+=1)l[f].c();o=Me()},m(f,m){y(f,e,m),k(e,n),y(f,i,m);for(let p=0;p<l.length;p+=1)l[p].m(f,m);y(f,o,m),s=!0},p(f,m){if((!s||m&2)&&t!==(t=f[1].name+"")&&Xe(n,t),m&3){u=f[1].oneOf;let p;for(p=0;p<u.length;p+=1){const c=cr(f,u,p);l[p]?(l[p].p(c,m),x(l[p],1)):(l[p]=dr(c),l[p].c(),x(l[p],1),l[p].m(o.parentNode,o))}for(Ce(),p=u.length;p<l.length;p+=1)a(p);Re()}},i(f){if(!s){for(let m=0;m<u.length;m+=1)x(l[m]);s=!0}},o(f){l=l.filter(Boolean);for(let m=0;m<l.length;m+=1)P(l[m]);s=!1},d(f){f&&w(e),f&&w(i),_t(l,f),f&&w(o)}}}function Lo(r){let e,t=r[1].name+"",n,i,o,s,u=r[1].members,l=[];for(let f=0;f<u.length;f+=1)l[f]=mr(pr(r,u,f));const a=f=>P(l[f],1,1,()=>{l[f]=null});return{c(){e=S("h1"),n=z(t),i=O();for(let f=0;f<l.length;f+=1)l[f].c();o=Me()},m(f,m){y(f,e,m),k(e,n),y(f,i,m);for(let p=0;p<l.length;p+=1)l[p].m(f,m);y(f,o,m),s=!0},p(f,m){if((!s||m&2)&&t!==(t=f[1].name+"")&&Xe(n,t),m&3){u=f[1].members;let p;for(p=0;p<u.length;p+=1){const c=pr(f,u,p);l[p]?(l[p].p(c,m),x(l[p],1)):(l[p]=mr(c),l[p].c(),x(l[p],1),l[p].m(o.parentNode,o))}for(Ce(),p=u.length;p<l.length;p+=1)a(p);Re()}},i(f){if(!s){for(let m=0;m<u.length;m+=1)x(l[m]);s=!0}},o(f){l=l.filter(Boolean);for(let m=0;m<l.length;m+=1)P(l[m]);s=!1},d(f){f&&w(e),f&&w(i),_t(l,f),f&&w(o)}}}function Co(r){let e,t,n;return{c(){e=S("h1"),t=z("Error: Field component instantiated for plain string, why? "),n=z(r[1])},m(i,o){y(i,e,o),k(e,t),k(e,n)},p(i,o){o&2&&Xe(n,i[1])},i:U,o:U,d(i){i&&w(e)}}}function Ro(r){let e,t,n,i,o=r[8].name+"",s,u,l,a,f,m,p,c=r[0].oneOfCase==r[8].name&&hr(r);return{c(){e=S("label"),t=S("input"),i=O(),s=z(o),u=S("br"),l=O(),c&&c.c(),a=Me(),T(t,"type","radio"),t.__value=n=r[8].name,t.value=t.__value,r[4][0].push(t)},m(d,_){y(d,e,_),k(e,t),t.checked=t.__value===r[0].oneOfCase,k(e,i),k(e,s),k(e,u),y(d,l,_),c&&c.m(d,_),y(d,a,_),f=!0,m||(p=G(t,"change",r[5]),m=!0)},p(d,_){(!f||_&2&&n!==(n=d[8].name))&&(t.__value=n,t.value=t.__value),_&1&&(t.checked=t.__value===d[0].oneOfCase),(!f||_&2)&&o!==(o=d[8].name+"")&&Xe(s,o),d[0].oneOfCase==d[8].name?c?(c.p(d,_),_&3&&x(c,1)):(c=hr(d),c.c(),x(c,1),c.m(a.parentNode,a)):c&&(Ce(),P(c,1,1,()=>{c=null}),Re())},i(d){f||(x(c),f=!0)},o(d){P(c),f=!1},d(d){d&&w(e),r[4][0].splice(r[4][0].indexOf(t),1),d&&w(l),c&&c.d(d),d&&w(a),m=!1,p()}}}function To(r){let e,t,n,i,o=r[8]+"",s,u,l,a,f;return{c(){e=S("label"),t=S("input"),i=O(),s=z(o),u=S("br"),l=O(),T(t,"type","radio"),t.__value=n=r[8],t.value=t.__value,r[4][0].push(t)},m(m,p){y(m,e,p),k(e,t),t.checked=t.__value===r[0].oneOfCase,k(e,i),k(e,s),k(e,u),k(e,l),a||(f=G(t,"change",r[3]),a=!0)},p(m,p){p&2&&n!==(n=m[8])&&(t.__value=n,t.value=t.__value),p&1&&(t.checked=t.__value===m[0].oneOfCase),p&2&&o!==(o=m[8]+"")&&Xe(s,o)},i:U,o:U,d(m){m&&w(e),r[4][0].splice(r[4][0].indexOf(t),1),a=!1,f()}}}function hr(r){let e,t,n;function i(s){r[6](s)}let o={spec:r[8]};return r[0].oneOfValue!==void 0&&(o.value=r[0].oneOfValue),e=new Gn({props:o}),_e.push(()=>$e(e,"value",i,r[0].oneOfValue)),{c(){W(e.$$.fragment)},m(s,u){V(e,s,u),n=!0},p(s,u){const l={};u&2&&(l.spec=s[8]),!t&&u&1&&(t=!0,l.value=s[0].oneOfValue,Be(()=>t=!1)),e.$set(l)},i(s){n||(x(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function dr(r){let e,t,n,i;const o=[To,Ro],s=[];function u(l,a){return typeof l[8]=="string"?0:1}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=Me()},m(l,a){s[e].m(l,a),y(l,n,a),i=!0},p(l,a){let f=e;e=u(l),e===f?s[e].p(l,a):(Ce(),P(s[f],1,1,()=>{s[f]=null}),Re(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),x(t,1),t.m(n.parentNode,n))},i(l){i||(x(t),i=!0)},o(l){P(t),i=!1},d(l){s[e].d(l),l&&w(n)}}}function mr(r){let e,t,n;function i(s){r[2](s,r[8])}let o={spec:r[8]};return r[0][r[8].name]!==void 0&&(o.value=r[0][r[8].name]),e=new Gn({props:o}),_e.push(()=>$e(e,"value",i,r[0][r[8].name])),{c(){W(e.$$.fragment)},m(s,u){V(e,s,u),n=!0},p(s,u){r=s;const l={};u&2&&(l.spec=r[8]),!t&&u&3&&(t=!0,l.value=r[0][r[8].name],Be(()=>t=!1)),e.$set(l)},i(s){n||(x(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function Ao(r){let e,t,n,i;const o=[Co,Lo,Oo,Mo],s=[];function u(l,a){return typeof l[1]=="string"?0:"members"in l[1]?1:"oneOf"in l[1]?2:l[1].type=="number"?3:-1}return~(e=u(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=Me()},m(l,a){~e&&s[e].m(l,a),y(l,n,a),i=!0},p(l,[a]){let f=e;e=u(l),e===f?~e&&s[e].p(l,a):(t&&(Ce(),P(s[f],1,1,()=>{s[f]=null}),Re()),~e?(t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),x(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(x(t),i=!0)},o(l){P(t),i=!1},d(l){~e&&s[e].d(l),l&&w(n)}}}function xo(r,e,t){var m;let{spec:n}=e,{value:i}=e;if(typeof n!="string")if("members"in n){i||(i={});for(let p of n.members)i[m=p.name]||(i[m]={})}else"oneOf"in n&&(i||(i={oneOfCase:null}));const o=[[]];function s(p,c){r.$$.not_equal(i[c.name],p)&&(i[c.name]=p,t(0,i))}function u(){i.oneOfCase=this.__value,t(0,i)}function l(){i.oneOfCase=this.__value,t(0,i)}function a(p){r.$$.not_equal(i.oneOfValue,p)&&(i.oneOfValue=p,t(0,i))}function f(){i=an(this.value),t(0,i)}return r.$$set=p=>{"spec"in p&&t(1,n=p.spec),"value"in p&&t(0,i=p.value)},[i,n,s,u,o,l,a,f]}class Gn extends re{constructor(e){super(),ie(this,e,xo,Ao,ne,{spec:1,value:0})}}function Po(r){let e,t,n,i,o=JSON.stringify(r[0],null,"  ")+"",s,u;function l(f){r[3](f)}let a={spec:r[1]};return r[0]!==void 0&&(a.value=r[0]),e=new Gn({props:a}),_e.push(()=>$e(e,"value",l,r[0])),{c(){W(e.$$.fragment),n=O(),i=S("pre"),s=z(o)},m(f,m){V(e,f,m),y(f,n,m),y(f,i,m),k(i,s),u=!0},p(f,[m]){const p={};!t&&m&1&&(t=!0,p.value=f[0],Be(()=>t=!1)),e.$set(p),(!u||m&1)&&o!==(o=JSON.stringify(f[0],null,"  ")+"")&&Xe(s,o)},i(f){u||(x(e.$$.fragment,f),u=!0)},o(f){P(e.$$.fragment,f),u=!1},d(f){K(e,f),f&&w(n),f&&w(i)}}}function Fo(r,e,t){let{props:n}=e;n.v2||(n.v2={name:""});let i=Eo,o={};function s(u){o=u,t(0,o)}return r.$$set=u=>{"props"in u&&t(2,n=u.props)},[o,i,n,s]}class No extends re{constructor(e){super(),ie(this,e,Fo,Po,ne,{props:2})}}function _r(r,e,t){const n=r.slice();return n[12]=e[t],n}function gr(r,e,t){const n=r.slice();return n[12]=e[t],n}function vr(r,e,t){const n=r.slice();return n[12]=e[t],n}function br(r,e,t){const n=r.slice();return n[12]=e[t],n}function yr(r){let e,t=r[12]+"",n;return{c(){e=S("option"),n=z(t),e.__value=r[12],e.value=e.__value},m(i,o){y(i,e,o),k(e,n)},p:U,d(i){i&&w(e)}}}function wr(r){let e,t=r[12]+"",n;return{c(){e=S("option"),n=z(t),e.__value=r[12],e.value=e.__value},m(i,o){y(i,e,o),k(e,n)},p:U,d(i){i&&w(e)}}}function kr(r){let e,t=r[12]+"",n;return{c(){e=S("option"),n=z(t),e.__value=r[12],e.value=e.__value},m(i,o){y(i,e,o),k(e,n)},p:U,d(i){i&&w(e)}}}function Sr(r){let e,t=r[12]+"",n;return{c(){e=S("option"),n=z(t),e.__value=r[12],e.value=e.__value},m(i,o){y(i,e,o),k(e,n)},p:U,d(i){i&&w(e)}}}function Io(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,d,_,g,E,h,v,b,L,R,A,C,$,D,B,J,F,Y,te,pe,q,le,we,xe,he,ae,Oe,ue,N,Q,Mt,de,ke,Ot,ut,ve,fe,Lt,Ct,be=r[1],Te=[];for(let M=0;M<be.length;M+=1)Te[M]=yr(br(r,be,M));let j=r[2],ee=[];for(let M=0;M<j.length;M+=1)ee[M]=wr(vr(r,j,M));let Ve=r[3],Le=[];for(let M=0;M<Ve.length;M+=1)Le[M]=kr(gr(r,Ve,M));let Ke=r[4],ye=[];for(let M=0;M<Ke.length;M+=1)ye[M]=Sr(_r(r,Ke,M));return{c(){e=S("label"),t=z("Name:"),n=S("br"),i=O(),o=S("input"),s=O(),u=S("br"),l=O(),a=S("br"),f=O(),m=S("label"),p=z(`Reference type:
  `),c=S("select");for(let M=0;M<Te.length;M+=1)Te[M].c();d=O(),_=S("br"),g=O(),E=S("br"),h=O(),v=S("label"),b=z("Notes:"),L=S("br"),R=O(),A=S("textarea"),C=O(),$=S("br"),D=O(),B=S("br"),J=O(),F=S("label"),Y=z(`Size:
  `),te=S("input"),pe=O(),q=S("select");for(let M=0;M<ee.length;M+=1)ee[M].c();le=O(),we=S("br"),xe=O(),he=S("br"),ae=O(),Oe=S("label"),ue=z(`ATE Triage:
  `),N=S("select");for(let M=0;M<Le.length;M+=1)Le[M].c();Q=O(),Mt=S("br"),de=O(),ke=S("br"),Ot=O(),ut=S("label"),ve=z(`ATE Recommendation:
  `),fe=S("select");for(let M=0;M<ye.length;M+=1)ye[M].c();T(o,"type","text"),ge(o,"width","100%"),r[0].planning.reference_type===void 0&&at(()=>r[6].call(c)),ge(A,"width","100%"),T(A,"rows","5"),T(A,"class","svelte-15lna0i"),T(te,"type","number"),T(te,"min","0"),T(te,"max","1000"),r[0].planning.size_units===void 0&&at(()=>r[9].call(q)),r[0].planning.triage===void 0&&at(()=>r[10].call(N)),r[0].planning.recommendation===void 0&&at(()=>r[11].call(fe))},m(M,H){y(M,e,H),k(e,t),k(e,n),k(e,i),k(e,o),Fe(o,r[0].planning.name),y(M,s,H),y(M,u,H),y(M,l,H),y(M,a,H),y(M,f,H),y(M,m,H),k(m,p),k(m,c);for(let I=0;I<Te.length;I+=1)Te[I].m(c,null);Ie(c,r[0].planning.reference_type),y(M,d,H),y(M,_,H),y(M,g,H),y(M,E,H),y(M,h,H),y(M,v,H),k(v,b),k(v,L),k(v,R),k(v,A),Fe(A,r[0].planning.notes),y(M,C,H),y(M,$,H),y(M,D,H),y(M,B,H),y(M,J,H),y(M,F,H),k(F,Y),k(F,te),Fe(te,r[0].planning.size),k(F,pe),k(F,q);for(let I=0;I<ee.length;I+=1)ee[I].m(q,null);Ie(q,r[0].planning.size_units),y(M,le,H),y(M,we,H),y(M,xe,H),y(M,he,H),y(M,ae,H),y(M,Oe,H),k(Oe,ue),k(Oe,N);for(let I=0;I<Le.length;I+=1)Le[I].m(N,null);Ie(N,r[0].planning.triage),y(M,Q,H),y(M,Mt,H),y(M,de,H),y(M,ke,H),y(M,Ot,H),y(M,ut,H),k(ut,ve),k(ut,fe);for(let I=0;I<ye.length;I+=1)ye[I].m(fe,null);Ie(fe,r[0].planning.recommendation),Lt||(Ct=[G(o,"input",r[5]),G(c,"change",r[6]),G(A,"input",r[7]),G(te,"input",r[8]),G(q,"change",r[9]),G(N,"change",r[10]),G(fe,"change",r[11])],Lt=!0)},p(M,[H]){if(H&3&&o.value!==M[0].planning.name&&Fe(o,M[0].planning.name),H&2){be=M[1];let I;for(I=0;I<be.length;I+=1){const qe=br(M,be,I);Te[I]?Te[I].p(qe,H):(Te[I]=yr(qe),Te[I].c(),Te[I].m(c,null))}for(;I<Te.length;I+=1)Te[I].d(1);Te.length=be.length}if(H&3&&Ie(c,M[0].planning.reference_type),H&3&&Fe(A,M[0].planning.notes),H&3&&an(te.value)!==M[0].planning.size&&Fe(te,M[0].planning.size),H&4){j=M[2];let I;for(I=0;I<j.length;I+=1){const qe=vr(M,j,I);ee[I]?ee[I].p(qe,H):(ee[I]=wr(qe),ee[I].c(),ee[I].m(q,null))}for(;I<ee.length;I+=1)ee[I].d(1);ee.length=j.length}if(H&3&&Ie(q,M[0].planning.size_units),H&8){Ve=M[3];let I;for(I=0;I<Ve.length;I+=1){const qe=gr(M,Ve,I);Le[I]?Le[I].p(qe,H):(Le[I]=kr(qe),Le[I].c(),Le[I].m(N,null))}for(;I<Le.length;I+=1)Le[I].d(1);Le.length=Ve.length}if(H&3&&Ie(N,M[0].planning.triage),H&16){Ke=M[4];let I;for(I=0;I<Ke.length;I+=1){const qe=_r(M,Ke,I);ye[I]?ye[I].p(qe,H):(ye[I]=Sr(qe),ye[I].c(),ye[I].m(fe,null))}for(;I<ye.length;I+=1)ye[I].d(1);ye.length=Ke.length}H&3&&Ie(fe,M[0].planning.recommendation)},i:U,o:U,d(M){M&&w(e),M&&w(s),M&&w(u),M&&w(l),M&&w(a),M&&w(f),M&&w(m),_t(Te,M),M&&w(d),M&&w(_),M&&w(g),M&&w(E),M&&w(h),M&&w(v),M&&w(C),M&&w($),M&&w(D),M&&w(B),M&&w(J),M&&w(F),_t(ee,M),M&&w(le),M&&w(we),M&&w(xe),M&&w(he),M&&w(ae),M&&w(Oe),_t(Le,M),M&&w(Q),M&&w(Mt),M&&w(de),M&&w(ke),M&&w(Ot),M&&w(ut),_t(ye,M),Lt=!1,ze(Ct)}}}function $o(r,e,t){let{props:n}=e;n.planning||(n.planning={name:"",notes:"",reference_type:"preapp",size:0,size_units:"number of units",triage:"No Comment",recommendation:"No Comment"});const i=["preapp","outline","reserved matters","local plan"],o=["number of units","floorspace (Gross Floor Area)","area (Hectare)"],s=["No Comment","Standing Advice","Toolkit Assessment"],u=["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"];function l(){n.planning.name=this.value,t(0,n),t(1,i)}function a(){n.planning.reference_type=gt(this),t(0,n),t(1,i)}function f(){n.planning.notes=this.value,t(0,n),t(1,i)}function m(){n.planning.size=an(this.value),t(0,n),t(1,i)}function p(){n.planning.size_units=gt(this),t(0,n),t(1,i)}function c(){n.planning.triage=gt(this),t(0,n),t(1,i)}function d(){n.planning.recommendation=gt(this),t(0,n),t(1,i)}return r.$$set=_=>{"props"in _&&t(0,n=_.props)},[n,i,o,s,u,l,a,f,m,p,c,d]}class Bo extends re{constructor(e){super(),ie(this,e,$o,Io,ne,{props:0})}}function Do(r){const e=r-1;return e*e*e+1}function Er(r,{delay:e=0,duration:t=400,easing:n=Do}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),u=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),a=parseFloat(i.marginTop),f=parseFloat(i.marginBottom),m=parseFloat(i.borderTopWidth),p=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:c=>`overflow: hidden;opacity: ${Math.min(c*20,1)*o};height: ${c*s}px;padding-top: ${c*u}px;padding-bottom: ${c*l}px;margin-top: ${c*a}px;margin-bottom: ${c*f}px;border-top-width: ${c*m}px;border-bottom-width: ${c*p}px;`}}function Mr(r){let e,t,n,i,o;const s=r[10].default,u=At(s,r,r[9],null);return{c(){e=S("div"),u&&u.c(),ge(e,"border","solid 1px black"),ge(e,"padding","10px")},m(l,a){y(l,e,a),u&&u.m(e,null),r[13](e),n=!0,i||(o=G(e,"introend",r[14]),i=!0)},p(l,a){u&&u.p&&(!n||a&512)&&xt(u,s,l,l[9],n?Ft(s,l[9],a,null):Pt(l[9]),null)},i(l){n||(x(u,l),at(()=>{t||(t=Un(e,Er,{duration:100},!0)),t.run(1)}),n=!0)},o(l){P(u,l),t||(t=Un(e,Er,{duration:100},!1)),t.run(0),n=!1},d(l){l&&w(e),u&&u.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function qo(r){let e,t,n,i,o,s,u,l,a,f,m=r[4]&&Mr(r);return{c(){e=S("button"),t=Yn("svg"),n=Yn("path"),i=O(),o=z(r[1]),s=O(),m&&m.c(),u=Me(),T(n,"d","M9 5l7 7-7 7"),T(t,"style","tran"),T(t,"width","20"),T(t,"height","20"),T(t,"fill","none"),T(t,"stroke-linecap","round"),T(t,"stroke-linejoin","round"),T(t,"stroke-width","2"),T(t,"viewBox","0 0 24 24"),T(t,"stroke","currentColor"),T(t,"class","svelte-t7fpgu"),T(e,"aria-expanded",r[4]),T(e,"class","svelte-t7fpgu"),Hn(e,"underlined",r[3])},m(p,c){y(p,e,c),k(e,t),k(t,n),k(e,i),k(e,o),y(p,s,c),m&&m.m(p,c),y(p,u,c),l=!0,a||(f=[G(e,"click",r[5]),G(e,"mouseenter",r[11]),G(e,"mouseleave",r[12])],a=!0)},p(p,[c]){(!l||c&2)&&Xe(o,p[1]),(!l||c&16)&&T(e,"aria-expanded",p[4]),(!l||c&8)&&Hn(e,"underlined",p[3]),p[4]?m?(m.p(p,c),c&16&&x(m,1)):(m=Mr(p),m.c(),x(m,1),m.m(u.parentNode,u)):m&&(Ce(),P(m,1,1,()=>{m=null}),Re())},i(p){l||(x(m),l=!0)},o(p){P(m),l=!1},d(p){p&&w(e),p&&w(s),m&&m.d(p),p&&w(u),a=!1,ze(f)}}}function Go(r,e,t){let n,i,o,s;ce(r,et,h=>t(7,o=h)),ce(r,Ne,h=>t(8,s=h));let{$$slots:u={},$$scope:l}=e,{id:a}=e,{label:f}=e;const m=()=>{Ne.update(h=>h==a?null:a),s==a&&(kn.set(null),kn.set(a))};let p;function c(){p==null||p.scrollIntoView({behavior:"smooth"})}const d=()=>Qt.set(a),_=()=>Qt.set(null);function g(h){_e[h?"unshift":"push"](()=>{p=h,t(2,p)})}const E=()=>c();return r.$$set=h=>{"id"in h&&t(0,a=h.id),"label"in h&&t(1,f=h.label),"$$scope"in h&&t(9,l=h.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==a),r.$$.dirty&129&&t(3,i=o==a)},[a,f,p,i,n,m,c,o,s,l,u,d,_,g,E]}class jo extends re{constructor(e){super(),ie(this,e,Go,qo,ne,{id:0,label:1})}}function Or(r,e,t){const n=r.slice();return n[12]=e[t],n[13]=e,n[14]=t,n}function zo(r){let e,t,n;function i(s){r[8](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new Bo({props:o}),_e.push(()=>$e(e,"props",i,r[12].properties)),{c(){W(e.$$.fragment)},m(s,u){V(e,s,u),n=!0},p(s,u){r=s;const l={};!t&&u&2&&(t=!0,l.props=r[12].properties,Be(()=>t=!1)),e.$set(l)},i(s){n||(x(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function Yo(r){let e,t,n;function i(s){r[7](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new No({props:o}),_e.push(()=>$e(e,"props",i,r[12].properties)),{c(){W(e.$$.fragment)},m(s,u){V(e,s,u),n=!0},p(s,u){r=s;const l={};!t&&u&2&&(t=!0,l.props=r[12].properties,Be(()=>t=!1)),e.$set(l)},i(s){n||(x(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){K(e,s)}}}function Ho(r){let e,t,n,i,o;function s(f){r[4](f,r[12])}function u(f){r[5](f,r[12])}function l(f){r[6](f,r[12])}let a={length_meters:r[12].properties.length_meters};return r[12].properties.name!==void 0&&(a.name=r[12].properties.name),r[12].properties.intervention_type!==void 0&&(a.intervention_type=r[12].properties.intervention_type),r[12].properties.description!==void 0&&(a.description=r[12].properties.description),e=new wo({props:a}),_e.push(()=>$e(e,"name",s,r[12].properties.name)),_e.push(()=>$e(e,"intervention_type",u,r[12].properties.intervention_type)),_e.push(()=>$e(e,"description",l,r[12].properties.description)),{c(){W(e.$$.fragment)},m(f,m){V(e,f,m),o=!0},p(f,m){r=f;const p={};m&2&&(p.length_meters=r[12].properties.length_meters),!t&&m&2&&(t=!0,p.name=r[12].properties.name,Be(()=>t=!1)),!n&&m&2&&(n=!0,p.intervention_type=r[12].properties.intervention_type,Be(()=>n=!1)),!i&&m&2&&(i=!0,p.description=r[12].properties.description,Be(()=>i=!1)),e.$set(p)},i(f){o||(x(e.$$.fragment,f),o=!0)},o(f){P(e.$$.fragment,f),o=!1},d(f){K(e,f)}}}function Uo(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,d,_;const g=[Ho,Yo,zo],E=[];function h(b,L){return b[0]=="v1"?0:b[0]=="v2"?1:b[0]=="planning"?2:-1}~(e=h(r))&&(t=E[e]=g[e](r));function v(){return r[9](r[12])}return{c(){t&&t.c(),n=O(),i=S("br"),o=O(),s=S("br"),u=O(),l=S("div"),a=S("button"),a.textContent="Delete",f=O(),m=S("button"),m.textContent="Save",p=O(),T(a,"type","button"),T(m,"type","button"),ge(l,"display","flex"),ge(l,"justify-content","space-between")},m(b,L){~e&&E[e].m(b,L),y(b,n,L),y(b,i,L),y(b,o,L),y(b,s,L),y(b,u,L),y(b,l,L),k(l,a),k(l,f),k(l,m),y(b,p,L),c=!0,d||(_=[G(a,"click",v),G(m,"click",r[10])],d=!0)},p(b,L){r=b;let R=e;e=h(r),e===R?~e&&E[e].p(r,L):(t&&(Ce(),P(E[R],1,1,()=>{E[R]=null}),Re()),~e?(t=E[e],t?t.p(r,L):(t=E[e]=g[e](r),t.c()),x(t,1),t.m(n.parentNode,n)):t=null)},i(b){c||(x(t),c=!0)},o(b){P(t),c=!1},d(b){~e&&E[e].d(b),b&&w(n),b&&w(i),b&&w(o),b&&w(s),b&&w(u),b&&w(l),b&&w(p),d=!1,ze(_)}}}function Lr(r,e){let t,n,i;return n=new jo({props:{id:e[12].id,label:e[14]+1+") "+e[2](e[12]),$$slots:{default:[Uo]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=Me(),W(n.$$.fragment),this.first=t},m(o,s){y(o,t,s),V(n,o,s),i=!0},p(o,s){e=o;const u={};s&2&&(u.id=e[12].id),s&2&&(u.label=e[14]+1+") "+e[2](e[12])),s&32771&&(u.$$scope={dirty:s,ctx:e}),n.$set(u)},i(o){i||(x(n.$$.fragment,o),i=!0)},o(o){P(n.$$.fragment,o),i=!1},d(o){o&&w(t),K(n,o)}}}function Jo(r){let e=[],t=new Map,n,i,o,s,u=r[1].features;const l=a=>a[12].id;for(let a=0;a<u.length;a+=1){let f=Or(r,u,a),m=l(f);t.set(m,e[a]=Lr(m,f))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=Me()},m(a,f){for(let m=0;m<e.length;m+=1)e[m].m(a,f);y(a,n,f),i=!0,o||(s=G(window,"keydown",r[3]),o=!0)},p(a,[f]){f&7&&(u=a[1].features,Ce(),e=gi(e,f,l,1,a,u,t,n.parentNode,vi,Lr,n,Or),Re())},i(a){if(!i){for(let f=0;f<u.length;f+=1)x(e[f]);i=!0}},o(a){for(let f=0;f<e.length;f+=1)P(e[f]);i=!1},d(a){for(let f=0;f<e.length;f+=1)e[f].d(a);a&&w(n),o=!1,s()}}}function Xo(r,e,t){let n,i;ce(r,Ne,_=>t(11,n=_)),ce(r,se,_=>t(1,i=_));let{schema:o}=e;function s(_){var E;if(o=="planning")return((E=_.properties.planning)==null?void 0:E.name)||"Untitled polygon";if(_.properties.name)return _.properties.name;var g=_.properties.intervention_type;return g=="other"&&(_.geometry.type=="Point"?g="point":_.geometry.type=="LineString"?g="line":g="polygon"),`Untitled ${g}`}function u(_){if(_.key=="Delete"){const g=_.target.tagName;if(g=="INPUT"||g=="TEXTAREA")return;_.preventDefault();const E=n;E&&Xn(E)}}function l(_,g){r.$$.not_equal(g.properties.name,_)&&(g.properties.name=_,se.set(i))}function a(_,g){r.$$.not_equal(g.properties.intervention_type,_)&&(g.properties.intervention_type=_,se.set(i))}function f(_,g){r.$$.not_equal(g.properties.description,_)&&(g.properties.description=_,se.set(i))}function m(_,g){r.$$.not_equal(g.properties,_)&&(g.properties=_,se.set(i))}function p(_,g){r.$$.not_equal(g.properties,_)&&(g.properties=_,se.set(i))}const c=_=>Xn(_.id),d=()=>Ne.set(null);return r.$$set=_=>{"schema"in _&&t(0,o=_.schema)},[o,i,s,u,l,a,f,m,p,c,d]}class Wo extends re{constructor(e){super(),ie(this,e,Xo,Jo,ne,{schema:0})}}function st(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ue(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Rn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function nt(r,e,t){t===void 0&&(t={});var n=st(r),i=st(e),o=Ge(i[1]-n[1]),s=Ge(i[0]-n[0]),u=Ge(n[1]),l=Ge(i[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return bi(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),t.units)}function Jt(r,e){return e===void 0&&(e={}),yi(r,function(t,n){var i=n.geometry.coordinates;return t+nt(i[0],i[1],e)},0)}function Vo(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,d,_,g,E,h,v,b=r[0].features.length+"",L,R,A,C,$,D,B,J;return{c(){e=S("div"),t=S("label"),n=z(`Scheme name:
    `),i=S("input"),o=O(),s=S("br"),u=O(),l=S("div"),a=S("label"),f=S("input"),m=O(),p=S("button"),p.textContent="Load from GeoJSON",c=O(),d=S("button"),d.textContent="Export to GeoJSON",_=O(),g=S("br"),E=O(),h=S("div"),v=S("span"),L=z(b),R=z(" interventions"),A=O(),C=S("button"),$=z("Clear all"),T(i,"type","text"),T(f,"type","file"),T(f,"id","load_geojson"),T(f,"class","svelte-lhyd1e"),T(p,"type","button"),T(d,"type","button"),T(d,"class","align-right svelte-lhyd1e"),T(C,"type","button"),T(C,"class","align-right svelte-lhyd1e"),C.disabled=D=r[0].features.length==0},m(F,Y){y(F,e,Y),k(e,t),k(t,n),k(t,i),Fe(i,r[0].scheme_name),y(F,o,Y),y(F,s,Y),y(F,u,Y),y(F,l,Y),k(l,a),k(a,f),k(a,m),k(a,p),k(l,c),k(l,d),y(F,_,Y),y(F,g,Y),y(F,E,Y),y(F,h,Y),k(h,v),k(v,L),k(v,R),k(h,A),k(h,C),k(C,$),B||(J=[G(i,"input",r[7]),G(f,"change",r[3]),G(p,"click",Zo),G(d,"click",r[2]),G(C,"click",r[1])],B=!0)},p(F,[Y]){Y&1&&i.value!==F[0].scheme_name&&Fe(i,F[0].scheme_name),Y&1&&b!==(b=F[0].features.length+"")&&Xe(L,b),Y&1&&D!==(D=F[0].features.length==0)&&(C.disabled=D)},i:U,o:U,d(F){F&&w(e),F&&w(o),F&&w(s),F&&w(u),F&&w(l),F&&w(_),F&&w(g),F&&w(E),F&&w(h),B=!1,ze(J)}}}function Ko(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Zo(){document.getElementById("load_geojson").click()}function Qo(r,e,t){let n;ce(r,se,d=>t(0,n=d));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let u=window.localStorage.getItem(s);if(u)try{se.set(p(JSON.parse(u)))}catch(d){console.log(`Failed to load from local storage: ${d}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&se.update(d=>(delete d.scheme_name,d.features=[],d))}function a(){const d=JSON.parse(JSON.stringify(n));for(let _ of d.features)delete _.properties.hide_while_editing;return d}function f(){let d=a();var _=s;d.authority=i,d.origin="atip-v1",d.scheme_name&&(_+="_"+d.scheme_name),_+=".txt",Ko(_,JSON.stringify(d,null,"  "))}function m(d){const _=new FileReader;_.onload=E=>{try{se.set(p(JSON.parse(E.target.result)))}catch(h){window.alert(`Couldn't load scheme from a file: ${h}`)}};let g=d.target.files;_.readAsText(g[0])}function p(d){let _=1;for(let g of d.features)g.properties||(g.properties={name:"",description:"",intervention_type:"other"}),g.geometry.type=="LineString"&&!g.properties.length_meters&&(g.properties.length_meters=Jt(g,{units:"kilometers"})*1e3),g.id=_++;return d}function c(){n.scheme_name=this.value,se.set(n)}return r.$$set=d=>{"authorityName"in d&&t(4,i=d.authorityName),"schema"in d&&t(5,o=d.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(a())))},[n,l,f,m,i,o,s,c]}class es extends re{constructor(e){super(),ie(this,e,Qo,Vo,ne,{authorityName:4,schema:5})}}const ts="/atip/schemas/assets/zoom_out_map-b2e1091a.svg";function ns(r){let e,t,n,i,o;return{c(){e=S("button"),t=S("img"),wi(t.src,n=ts)||T(t,"src",n),T(t,"alt","Zoom to show entire boundary"),T(e,"type","button"),T(e,"title","Zoom to show entire boundary"),T(e,"class","svelte-qzjsqo")},m(s,u){y(s,e,u),k(e,t),i||(o=G(e,"click",r[0]),i=!0)},p:U,i:U,o:U,d(s){s&&w(e),i=!1,o()}}}function rs(r,e,t){let n;ce(r,We,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds($n(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class is extends re{constructor(e){super(),ie(this,e,rs,ns,ne,{boundaryGeojson:1})}}function os(r){let e,t,n,i,o,s,u;return{c(){e=S("div"),t=z(`Basemap:
  `),n=S("select"),i=S("option"),i.textContent="Streets",o=S("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&at(()=>r[2].call(n)),T(e,"class","svelte-1tbnm6i")},m(l,a){y(l,e,a),k(e,t),k(e,n),k(n,i),k(n,o),Ie(n,r[0]),s||(u=[G(n,"change",r[2]),G(n,"change",r[1])],s=!0)},p(l,[a]){a&1&&Ie(n,l[0])},i:U,o:U,d(l){l&&w(e),s=!1,ze(u)}}}function ss(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let u=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=u}function o(){n=gt(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class ls extends re{constructor(e){super(),ie(this,e,ss,os,ne,{style:0})}}const me={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},hn=10,nn=10;function us(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,d,_;return{c(){e=S("li"),t=S("span"),n=z("Areas"),i=O(),o=S("li"),s=S("span"),u=z("Routes"),l=O(),a=S("li"),f=S("span"),m=z("Crossings"),p=O(),c=S("li"),d=S("span"),_=z("Other"),T(t,"class","svelte-p551i1"),ge(t,"background",me.area),T(s,"class","svelte-p551i1"),ge(s,"background",me.route),T(f,"class","svelte-p551i1"),ge(f,"background",me.crossing),T(d,"class","svelte-p551i1"),ge(d,"background",me.other)},m(g,E){y(g,e,E),k(e,t),k(e,n),y(g,i,E),y(g,o,E),k(o,s),k(o,u),y(g,l,E),y(g,a,E),k(a,f),k(a,m),y(g,p,E),y(g,c,E),k(c,d),k(c,_)},p:U,d(g){g&&w(e),g&&w(i),g&&w(o),g&&w(l),g&&w(a),g&&w(p),g&&w(c)}}}function as(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,d,_;return{c(){e=S("li"),t=S("span"),n=z("Preapp"),i=O(),o=S("li"),s=S("span"),u=z("Outline"),l=O(),a=S("li"),f=S("span"),m=z("Reserved matters"),p=O(),c=S("li"),d=S("span"),_=z("Local plan"),T(t,"class","svelte-p551i1"),ge(t,"background",me.preapp),T(s,"class","svelte-p551i1"),ge(s,"background",me.outline),T(f,"class","svelte-p551i1"),ge(f,"background",me["reserved matters"]),T(d,"class","svelte-p551i1"),ge(d,"background",me["local plan"])},m(g,E){y(g,e,E),k(e,t),k(e,n),y(g,i,E),y(g,o,E),k(o,s),k(o,u),y(g,l,E),y(g,a,E),k(a,f),k(a,m),y(g,p,E),y(g,c,E),k(c,d),k(c,_)},p:U,d(g){g&&w(e),g&&w(i),g&&w(o),g&&w(l),g&&w(a),g&&w(p),g&&w(c)}}}function fs(r){let e,t,n,i;function o(l,a){return l[0]=="planning"?as:us}let s=o(r),u=s(r);return{c(){e=S("div"),t=S("h1"),t.textContent="Interventions",n=O(),i=S("ul"),u.c(),T(t,"class","svelte-p551i1"),T(e,"class","svelte-p551i1")},m(l,a){y(l,e,a),k(e,t),k(e,n),k(e,i),u.m(i,null)},p(l,[a]){s===(s=o(l))&&u?u.p(l,a):(u.d(1),u=s(l),u&&(u.c(),u.m(i,null)))},i:U,o:U,d(l){l&&w(e),u.d()}}}function cs(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class ps extends re{constructor(e){super(),ie(this,e,cs,fs,ne,{schema:0})}}let pt="interventions";function hs(r,e,t){let n,i;ce(r,We,f=>t(1,n=f)),ce(r,se,f=>t(2,i=f));let{schema:o}=e;ft(n,pt,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",me.area,"route",me.route,"crossing",me.crossing,"other",me.other,"white"],u=["match",["get","reference_type",["get","planning"]],"preapp",me.preapp,"outline",me.outline,"reserved matters",me["reserved matters"],"local plan",me["local plan"],"white"],l=["!=","hide_while_editing",!0];return Ae(n,{id:"interventions-points",source:pt,filter:["all",fn,l,["!=","endpoint",!0]],...St(s,hn)}),Ae(n,{id:"interventions-lines",source:pt,filter:["all",cn,l],...Dt(s,nn)},"route-lines"),Ae(n,{id:"interventions-lines-endpoints",source:pt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*nn,"circle-opacity":0,"circle-stroke-color":me.lineEndpointColor,"circle-stroke-width":2}}),Ae(n,{id:"interventions-polygons",source:pt,filter:["all",pn,l],...un(o=="planning"?u:s,.5)},"hover-polygons"),r.$$set=f=>{"schema"in f&&t(0,o=f.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let f=JSON.parse(JSON.stringify(i)),m=[];for(let p of f.features)if(p.geometry.type=="LineString")for(let c of[p.geometry.coordinates[0],p.geometry.coordinates[p.geometry.coordinates.length-1]])m.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:c}});f.features=f.features.concat(m),n.getSource(pt).setData(f)}},[o,n,i]}class ds extends re{constructor(e){super(),ie(this,e,hs,null,ne,{schema:0})}}let ht="hover";function ms(r,e,t){let n,i,o,s,u;return ce(r,We,l=>t(0,n=l)),ce(r,se,l=>t(1,i=l)),ce(r,Qt,l=>t(2,o=l)),ce(r,et,l=>t(3,s=l)),ce(r,Ne,l=>t(4,u=l)),ft(n,ht,{type:"geojson",data:Je()}),Ae(n,{id:"hover-polygons",source:ht,filter:pn,...Dt(me.hovering,.5*nn,1)}),Ae(n,{id:"hover-lines",source:ht,filter:cn,...Dt(me.hovering,1.5*nn,1)},"interventions-lines"),Ae(n,{id:"hover-points",source:ht,filter:fn,...St(me.hovering,1.5*hn,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=u||s||o;l!=null?n.getSource(ht).setData(i.features.find(a=>a.id==l)):n.getSource(ht).setData(Je())}},[n,i,o,s,u]}class _s extends re{constructor(e){super(),ie(this,e,ms,null,ne,{})}}class jn{constructor(e,t){oe(this,"owner");oe(this,"map");oe(this,"mapHandlers",{});oe(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Yt="edit-point-mode";class gs{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"cursor");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new jn(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),ft(e,Yt,{type:"geojson",data:Je()}),Ae(e,{id:"edit-point-mode",source:Yt,...St(me.hovering,hn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=vs(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Yt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Je();this.cursor&&e.features.push(this.cursor),this.map.getSource(Yt).setData(e)}}function vs(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Wr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return bs(r,e);var n=st(r),i=st(e),o=Ge(n[0]),s=Ge(i[0]),u=Ge(n[1]),l=Ge(i[1]),a=Math.sin(s-o)*Math.cos(l),f=Math.cos(u)*Math.sin(l)-Math.sin(u)*Math.cos(l)*Math.cos(s-o);return wn(Math.atan2(a,f))}function bs(r,e){var t=Wr(e,r);return t=(t+180)%360,t}function Cr(r,e,t,n){n===void 0&&(n={});var i=st(r),o=Ge(i[0]),s=Ge(i[1]),u=Ge(t),l=ki(e,n.units),a=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(u)),f=o+Math.atan2(Math.sin(u)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(a)),m=wn(f),p=wn(a);return yt([m,p],n.properties)}function Tn(r){if(!r)throw new Error("geojson is required");var e=[];return Bn(r,function(t){ys(t,e)}),ot(e)}function ys(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ue(n);break;case"LineString":t=[Ue(n)]}t.forEach(function(i){var o=ws(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function ws(r,e){var t=[];return r.reduce(function(n,i){var o=wt([n,i],e);return o.bbox=ks(n,i),t.push(o),i}),t}function ks(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,u=n<o?n:o,l=t>i?t:i,a=n>o?n:o;return[s,u,l,a]}var kt={},Ss={get exports(){return kt},set exports(r){kt=r}},An={},Es={get exports(){return An},set exports(r){An=r}};(function(r,e){(function(t,n){r.exports=n()})(Si,function(){function t(h,v,b,L,R){(function A(C,$,D,B,J){for(;B>D;){if(B-D>600){var F=B-D+1,Y=$-D+1,te=Math.log(F),pe=.5*Math.exp(2*te/3),q=.5*Math.sqrt(te*pe*(F-pe)/F)*(Y-F/2<0?-1:1),le=Math.max(D,Math.floor($-Y*pe/F+q)),we=Math.min(B,Math.floor($+(F-Y)*pe/F+q));A(C,$,le,we,J)}var xe=C[$],he=D,ae=B;for(n(C,D,$),J(C[B],xe)>0&&n(C,D,B);he<ae;){for(n(C,he,ae),he++,ae--;J(C[he],xe)<0;)he++;for(;J(C[ae],xe)>0;)ae--}J(C[D],xe)===0?n(C,D,ae):n(C,++ae,B),ae<=$&&(D=ae+1),$<=ae&&(B=ae-1)}})(h,v,b||0,L||h.length-1,R||i)}function n(h,v,b){var L=h[v];h[v]=h[b],h[b]=L}function i(h,v){return h<v?-1:h>v?1:0}var o=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(h,v,b){if(!b)return v.indexOf(h);for(var L=0;L<v.length;L++)if(b(h,v[L]))return L;return-1}function u(h,v){l(h,0,h.children.length,v,h)}function l(h,v,b,L,R){R||(R=g(null)),R.minX=1/0,R.minY=1/0,R.maxX=-1/0,R.maxY=-1/0;for(var A=v;A<b;A++){var C=h.children[A];a(R,h.leaf?L(C):C)}return R}function a(h,v){return h.minX=Math.min(h.minX,v.minX),h.minY=Math.min(h.minY,v.minY),h.maxX=Math.max(h.maxX,v.maxX),h.maxY=Math.max(h.maxY,v.maxY),h}function f(h,v){return h.minX-v.minX}function m(h,v){return h.minY-v.minY}function p(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function c(h){return h.maxX-h.minX+(h.maxY-h.minY)}function d(h,v){return h.minX<=v.minX&&h.minY<=v.minY&&v.maxX<=h.maxX&&v.maxY<=h.maxY}function _(h,v){return v.minX<=h.maxX&&v.minY<=h.maxY&&v.maxX>=h.minX&&v.maxY>=h.minY}function g(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(h,v,b,L,R){for(var A=[v,b];A.length;)if(!((b=A.pop())-(v=A.pop())<=L)){var C=v+Math.ceil((b-v)/L/2)*L;t(h,C,v,b,R),A.push(v,C,C,b)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(h){var v=this.data,b=[];if(!_(h,v))return b;for(var L=this.toBBox,R=[];v;){for(var A=0;A<v.children.length;A++){var C=v.children[A],$=v.leaf?L(C):C;_(h,$)&&(v.leaf?b.push(C):d(h,$)?this._all(C,b):R.push(C))}v=R.pop()}return b},o.prototype.collides=function(h){var v=this.data;if(!_(h,v))return!1;for(var b=[];v;){for(var L=0;L<v.children.length;L++){var R=v.children[L],A=v.leaf?this.toBBox(R):R;if(_(h,A)){if(v.leaf||d(h,A))return!0;b.push(R)}}v=b.pop()}return!1},o.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var v=0;v<h.length;v++)this.insert(h[v]);return this}var b=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===b.height)this._splitRoot(this.data,b);else{if(this.data.height<b.height){var L=this.data;this.data=b,b=L}this._insert(b,this.data.height-b.height-1,!0)}else this.data=b;return this},o.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},o.prototype.clear=function(){return this.data=g([]),this},o.prototype.remove=function(h,v){if(!h)return this;for(var b,L,R,A=this.data,C=this.toBBox(h),$=[],D=[];A||$.length;){if(A||(A=$.pop(),L=$[$.length-1],b=D.pop(),R=!0),A.leaf){var B=s(h,A.children,v);if(B!==-1)return A.children.splice(B,1),$.push(A),this._condense($),this}R||A.leaf||!d(A,C)?L?(b++,A=L.children[b],R=!1):A=null:($.push(A),D.push(b),b=0,L=A,A=A.children[0])}return this},o.prototype.toBBox=function(h){return h},o.prototype.compareMinX=function(h,v){return h.minX-v.minX},o.prototype.compareMinY=function(h,v){return h.minY-v.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(h){return this.data=h,this},o.prototype._all=function(h,v){for(var b=[];h;)h.leaf?v.push.apply(v,h.children):b.push.apply(b,h.children),h=b.pop();return v},o.prototype._build=function(h,v,b,L){var R,A=b-v+1,C=this._maxEntries;if(A<=C)return u(R=g(h.slice(v,b+1)),this.toBBox),R;L||(L=Math.ceil(Math.log(A)/Math.log(C)),C=Math.ceil(A/Math.pow(C,L-1))),(R=g([])).leaf=!1,R.height=L;var $=Math.ceil(A/C),D=$*Math.ceil(Math.sqrt(C));E(h,v,b,D,this.compareMinX);for(var B=v;B<=b;B+=D){var J=Math.min(B+D-1,b);E(h,B,J,$,this.compareMinY);for(var F=B;F<=J;F+=$){var Y=Math.min(F+$-1,J);R.children.push(this._build(h,F,Y,L-1))}}return u(R,this.toBBox),R},o.prototype._chooseSubtree=function(h,v,b,L){for(;L.push(v),!v.leaf&&L.length-1!==b;){for(var R=1/0,A=1/0,C=void 0,$=0;$<v.children.length;$++){var D=v.children[$],B=p(D),J=(F=h,Y=D,(Math.max(Y.maxX,F.maxX)-Math.min(Y.minX,F.minX))*(Math.max(Y.maxY,F.maxY)-Math.min(Y.minY,F.minY))-B);J<A?(A=J,R=B<R?B:R,C=D):J===A&&B<R&&(R=B,C=D)}v=C||v.children[0]}var F,Y;return v},o.prototype._insert=function(h,v,b){var L=b?h:this.toBBox(h),R=[],A=this._chooseSubtree(L,this.data,v,R);for(A.children.push(h),a(A,L);v>=0&&R[v].children.length>this._maxEntries;)this._split(R,v),v--;this._adjustParentBBoxes(L,R,v)},o.prototype._split=function(h,v){var b=h[v],L=b.children.length,R=this._minEntries;this._chooseSplitAxis(b,R,L);var A=this._chooseSplitIndex(b,R,L),C=g(b.children.splice(A,b.children.length-A));C.height=b.height,C.leaf=b.leaf,u(b,this.toBBox),u(C,this.toBBox),v?h[v-1].children.push(C):this._splitRoot(b,C)},o.prototype._splitRoot=function(h,v){this.data=g([h,v]),this.data.height=h.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(h,v,b){for(var L,R,A,C,$,D,B,J=1/0,F=1/0,Y=v;Y<=b-v;Y++){var te=l(h,0,Y,this.toBBox),pe=l(h,Y,b,this.toBBox),q=(R=te,A=pe,C=void 0,$=void 0,D=void 0,B=void 0,C=Math.max(R.minX,A.minX),$=Math.max(R.minY,A.minY),D=Math.min(R.maxX,A.maxX),B=Math.min(R.maxY,A.maxY),Math.max(0,D-C)*Math.max(0,B-$)),le=p(te)+p(pe);q<J?(J=q,L=Y,F=le<F?le:F):q===J&&le<F&&(F=le,L=Y)}return L||b-v},o.prototype._chooseSplitAxis=function(h,v,b){var L=h.leaf?this.compareMinX:f,R=h.leaf?this.compareMinY:m;this._allDistMargin(h,v,b,L)<this._allDistMargin(h,v,b,R)&&h.children.sort(L)},o.prototype._allDistMargin=function(h,v,b,L){h.children.sort(L);for(var R=this.toBBox,A=l(h,0,v,R),C=l(h,b-v,b,R),$=c(A)+c(C),D=v;D<b-v;D++){var B=h.children[D];a(A,h.leaf?R(B):B),$+=c(A)}for(var J=b-v-1;J>=v;J--){var F=h.children[J];a(C,h.leaf?R(F):F),$+=c(C)}return $},o.prototype._adjustParentBBoxes=function(h,v,b){for(var L=b;L>=0;L--)a(v[L],h)},o.prototype._condense=function(h){for(var v=h.length-1,b=void 0;v>=0;v--)h[v].children.length===0?v>0?(b=h[v-1].children).splice(b.indexOf(h[v]),1):this.clear():u(h[v],this.toBBox)},o})})(Es);const Ms=Dn(Ei),Os=Dn(Mi),Ls=Dn(Oi);var Ye=An,Vr=Ms,Kr=Os,dt=Ls.default,Cs=Kr.featureEach;Kr.coordEach;Vr.polygon;var Rr=Vr.featureCollection;function Zr(r){var e=new Ye(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:dt(t),Ye.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:dt(i),n.push(i)}):Cs(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:dt(i),n.push(i)}),Ye.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:dt(t),Ye.prototype.remove.call(this,t,n)},e.clear=function(){return Ye.prototype.clear.call(this)},e.search=function(t){var n=Ye.prototype.search.call(this,this.toBBox(t));return Rr(n)},e.collides=function(t){return Ye.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ye.prototype.all.call(this);return Rr(t)},e.toJSON=function(){return Ye.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ye.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=dt(t);else if(t.type==="FeatureCollection")n=dt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ss.exports=Zr;kt.default=Zr;function Qr(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Jn(r)),e.type==="LineString"&&(e=Jn(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Tr(r,e);return i&&n.push(i),ot(n)}var o=kt();return o.load(Tn(e)),Zt(Tn(r),function(s){Zt(o.search(s),function(u){var l=Tr(s,u);if(l){var a=Ue(l).join(",");t[a]||(t[a]=!0,n.push(l))}})}),ot(n)}function Tr(r,e){var t=Ue(r),n=Ue(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],u=t[1][1],l=n[0][0],a=n[0][1],f=n[1][0],m=n[1][1],p=(m-a)*(s-i)-(f-l)*(u-o),c=(f-l)*(o-a)-(m-a)*(i-l),d=(s-i)*(o-a)-(u-o)*(i-l);if(p===0)return c===0&&d===0,null;var _=c/p,g=d/p;if(_>=0&&_<=1&&g>=0&&g<=1){var E=i+_*(s-i),h=o+_*(u-o);return yt([E,h])}return null}function Gt(r,e,t){t===void 0&&(t={});var n=yt([1/0,1/0],{dist:1/0}),i=0;return Bn(r,function(o){for(var s=Ue(o),u=0;u<s.length-1;u++){var l=yt(s[u]);l.properties.dist=nt(e,l,t);var a=yt(s[u+1]);a.properties.dist=nt(e,a,t);var f=nt(l,a,t),m=Math.max(l.properties.dist,a.properties.dist),p=Wr(l,a),c=Cr(e,m,p+90,t),d=Cr(e,m,p-90,t),_=Qr(wt([c.geometry.coordinates,d.geometry.coordinates]),wt([l.geometry.coordinates,a.geometry.coordinates])),g=null;_.features.length>0&&(g=_.features[0],g.properties.dist=nt(e,g,t),g.properties.location=i+nt(l,g,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=u,n.properties.location=i),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=u+1,n.properties.location=i+f),g&&g.properties.dist<n.properties.dist&&(n=g,n.properties.index=u),i+=f}}),n}const mt="edit-polygon-mode";class Rs{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"points");oe(this,"cursor");oe(this,"hover");oe(this,"dragFrom");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new jn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),ft(e,mt,{type:"geojson",data:Je()}),Ae(e,{id:"edit-polygon-fill",source:mt,filter:pn,...un("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Ae(e,{id:"edit-polygon-lines",source:mt,filter:cn,...Dt("black",8,.5)}),Ae(e,{id:"edit-polygon-vertices",source:mt,filter:fn,...St(me.hovering,hn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(xr(this.points).forEach((n,i)=>{t.push([i+1,Gt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(mt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Je();this.points.forEach((n,i)=>{let o=Ar(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(xr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(mt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Ar(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Ar(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function xr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let Z;const Qe=new Array(32).fill(void 0);Qe.push(void 0,null,!0,!1);function X(r){return Qe[r]}let It=Qe.length;function Ts(r){r<36||(Qe[r]=It,It=r)}function xn(r){const e=X(r);return Ts(r),e}const ei=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});ei.decode();let Xt=new Uint8Array;function $t(){return Xt.byteLength===0&&(Xt=new Uint8Array(Z.memory.buffer)),Xt}function vt(r,e){return ei.decode($t().subarray(r,r+e))}function Se(r){It===Qe.length&&Qe.push(Qe.length+1);const e=It;return It=Qe[e],Qe[e]=r,e}function gn(r){return r==null}let Wt=new Float64Array;function As(){return Wt.byteLength===0&&(Wt=new Float64Array(Z.memory.buffer)),Wt}let Vt=new Int32Array;function Ee(){return Vt.byteLength===0&&(Vt=new Int32Array(Z.memory.buffer)),Vt}let it=0;const Kt=new TextEncoder("utf-8"),xs=typeof Kt.encodeInto=="function"?function(r,e){return Kt.encodeInto(r,e)}:function(r,e){const t=Kt.encode(r);return e.set(t),{read:r.length,written:t.length}};function Ht(r,e,t){if(t===void 0){const u=Kt.encode(r),l=e(u.length);return $t().subarray(l,l+u.length).set(u),it=u.length,l}let n=r.length,i=e(n);const o=$t();let s=0;for(;s<n;s++){const u=r.charCodeAt(s);if(u>127)break;o[i+s]=u}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const u=$t().subarray(i+s,i+n),l=xs(r,u);s+=l.written}return it=s,i}function Pn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Pn(r[0]));for(let s=1;s<i;s++)o+=", "+Pn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ps(r,e){const t=e(r.length*1);return $t().set(r,t/1),it=r.length,t}function vn(r,e){try{return r.apply(this,e)}catch(t){Z.__wbindgen_exn_store(Se(t))}}class rn{static __wrap(e){const t=Object.create(rn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Z.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=Z.__wbindgen_add_to_stack_pointer(-16),s=Ps(e,Z.__wbindgen_malloc),u=it;Z.jsroutesnapper_new(o,s,u);var t=Ee()[o/4+0],n=Ee()[o/4+1],i=Ee()[o/4+2];if(i)throw xn(n);return rn.__wrap(t)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){Z.jsroutesnapper_setConfig(this.ptr,Se(e))}toFinalFeature(){try{const n=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_toFinalFeature(n,this.ptr);var e=Ee()[n/4+0],t=Ee()[n/4+1];let i;return e!==0&&(i=vt(e,t).slice(),Z.__wbindgen_free(e,t*1)),i}finally{Z.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_renderGeojson(n,this.ptr);var e=Ee()[n/4+0],t=Ee()[n/4+1];return vt(e,t)}finally{Z.__wbindgen_add_to_stack_pointer(16),Z.__wbindgen_free(e,t)}}setSnapMode(e){Z.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return Z.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){Z.jsroutesnapper_onClick(this.ptr)}onDragStart(){return Z.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return Z.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){Z.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=Z.__wbindgen_add_to_stack_pointer(-16);Z.jsroutesnapper_editExisting(i,this.ptr,Se(e));var t=Ee()[i/4+0],n=Ee()[i/4+1];if(n)throw xn(t)}finally{Z.__wbindgen_add_to_stack_pointer(16)}}}async function Fs(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ns(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){xn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=X(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(vt(e,t));return Se(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=vt(e,t);return Se(n)},r.wbg.__wbindgen_is_object=function(e){const t=X(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return X(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return X(e)in X(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=X(t),i=typeof n=="number"?n:void 0;As()[e/8+1]=gn(i)?0:i,Ee()[e/4+0]=!gn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return X(e)==X(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=X(t),i=typeof n=="string"?n:void 0;var o=gn(i)?0:Ht(i,Z.__wbindgen_malloc,Z.__wbindgen_realloc),s=it;Ee()[e/4+1]=s,Ee()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(X(t)),i=Ht(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=X(e);return Se(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=X(e)[X(t)];return Se(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(X(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(X(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(X(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(X(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(X(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=X(e)[t>>>0];return Se(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return X(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof X(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=X(e).next;return Se(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return vn(function(e){const t=X(e).next();return Se(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return X(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=X(e).value;return Se(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return Se(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return vn(function(e,t){const n=Reflect.get(X(e),X(t));return Se(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return vn(function(e,t){const n=X(e).call(X(t));return Se(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(X(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=X(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=X(e).buffer;return Se(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(X(e));return Se(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){X(e).set(X(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return X(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=X(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Se(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=X(t).stack,i=Ht(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(vt(e,t))}finally{Z.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=Pn(X(t)),i=Ht(n,Z.__wbindgen_malloc,Z.__wbindgen_realloc),o=it;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(vt(e,t))},r.wbg.__wbindgen_memory=function(){const e=Z.memory;return Se(e)},r}function Is(r,e){return Z=r.exports,ti.__wbindgen_wasm_module=e,Wt=new Float64Array,Vt=new Int32Array,Xt=new Uint8Array,Z}async function ti(r){typeof r>"u"&&(r="/atip/schemas/assets/route_snapper_bg.wasm");const e=Ns();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Fs(await r,e);return Is(t,n)}const Tt="route-snapper",Pr=10,$s=30;class Bs{constructor(e,t){oe(this,"map");oe(this,"inner");oe(this,"active");oe(this,"eventListenersSuccessRoute");oe(this,"eventListenersSuccessArea");oe(this,"eventListenersFailure");oe(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new rn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],ft(e,Tt,{type:"geojson",data:Je()}),Ae(e,{id:"route-points",source:Tt,filter:fn,...St(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Pr/2,Pr])}),Ae(e,{id:"route-lines",source:Tt,filter:cn,...Dt("black",2.5)}),Ae(e,{id:"route-polygons",source:Tt,filter:pn,...un("black",.5)}),this.events=new jn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-$s,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Tt).setData(JSON.parse(this.inner.renderGeojson()))}}function Fr(r){let e;function t(o,s){return o[1]?qs:Ds}let n=t(r),i=n(r);return{c(){i.c(),e=Me()},m(o,s){i.m(o,s),y(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&w(e)}}}function Ds(r){let e;return{c(){e=S("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function qs(r){let e;return{c(){e=S("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function Gs(r){let e,t=r[0]==bt&&Fr(r);return{c(){t&&t.c(),e=Me()},m(n,i){t&&t.m(n,i),y(n,e,i)},p(n,[i]){n[0]==bt?t?t.p(n,i):(t=Fr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){t&&t.d(n),n&&w(e)}}}const bt="edit-attribute";function ni(){}function js(r,e,t){let n,i,o,s;ce(r,We,c=>t(5,n=c)),ce(r,se,c=>t(6,i=c)),ce(r,kn,c=>t(7,o=c)),ce(r,Ne,c=>t(1,s=c));let{mode:u}=e,{changeMode:l}=e;function a(){Ne.set(null)}n.on("mousemove",f),n.on("mouseout",m),n.on("click",p),jt(()=>{n.off("mousemove",f),n.off("mouseout",m),n.off("click",p)});function f(c){var d;if(u==bt){let _=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});et.set(((d=_[0])==null?void 0:d.id)||null)}}function m(){u==bt&&et.set(null)}function p(c){if(u==bt){let d=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});d.length>0?Ne.set(d[0].id):Ne.set(null)}}return r.$$set=c=>{"mode"in c&&t(0,u=c.mode),"changeMode"in c&&t(2,l=c.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let c=o;if(c){let d=i.features.find(_=>_.id==c);d.geometry.type=="Point"?n.flyTo({center:d.geometry.coordinates,duration:500}):n.fitBounds($n(d),{padding:200,duration:500}),l(bt)}}},[u,s,l,ni,a,n,i,o]}class zs extends re{constructor(e){super(),ie(this,e,js,Gs,ne,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ni}get stop(){return this.$$.ctx[4]}}function Ys(r){let e,t;return{c:U,m(n,i){e||(t=G(window,"keydown",r[0]),e=!0)},p:U,i:U,o:U,d(n){e=!1,t()}}}function Hs(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class dn extends re{constructor(e){super(),ie(this,e,Hs,Ys,ne,{tool:1})}}function Us(r){let e;return{c(){e=S("p"),e.textContent="Click to add a new point"},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function Js(r){let e;return{c(){e=S("p"),e.textContent="Click to move the point here"},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function Xs(r){let e,t,n,i,o,s,u,l,a;function f(c,d){return c[1]?Js:Us}let m=f(r),p=m(r);return s=new dn({props:{tool:r[0]}}),{c(){p.c(),e=O(),t=S("p"),t.innerHTML="Press <b>Escape</b> to cancel",n=O(),i=S("button"),i.textContent="Cancel",o=O(),W(s.$$.fragment),T(i,"type","button")},m(c,d){p.m(c,d),y(c,e,d),y(c,t,d),y(c,n,d),y(c,i,d),y(c,o,d),V(s,c,d),u=!0,l||(a=G(i,"click",r[2]),l=!0)},p(c,[d]){m!==(m=f(c))&&(p.d(1),p=m(c),p&&(p.c(),p.m(e.parentNode,e)));const _={};d&1&&(_.tool=c[0]),s.$set(_)},i(c){u||(x(s.$$.fragment,c),u=!0)},o(c){P(s.$$.fragment,c),u=!1},d(c){p.d(c),c&&w(e),c&&w(t),c&&w(n),c&&w(i),c&&w(o),K(s,c),l=!1,a()}}}function Ws(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class ri extends re{constructor(e){super(),ie(this,e,Ws,Xs,ne,{pointTool:0,editingExisting:1})}}function Vs(r){let e,t,n,i,o,s,u,l,a,f,m;return l=new dn({props:{tool:r[0]}}),{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=O(),n=S("div"),i=S("button"),i.textContent="Finish",o=O(),s=S("button"),s.textContent="Cancel",u=O(),W(l.$$.fragment),T(i,"type","button"),T(s,"type","button"),ge(n,"display","flex"),ge(n,"justify-content","space-between")},m(p,c){y(p,e,c),y(p,t,c),y(p,n,c),k(n,i),k(n,o),k(n,s),y(p,u,c),V(l,p,c),a=!0,f||(m=[G(i,"click",r[1]),G(s,"click",r[2])],f=!0)},p(p,[c]){const d={};c&1&&(d.tool=p[0]),l.$set(d)},i(p){a||(x(l.$$.fragment,p),a=!0)},o(p){P(l.$$.fragment,p),a=!1},d(p){p&&w(e),p&&w(t),p&&w(n),p&&w(u),K(l,p),f=!1,ze(m)}}}function Ks(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class ii extends re{constructor(e){super(),ie(this,e,Ks,Vs,ne,{polygonTool:0})}}function Zs(r){let e,t,n,i,o,s,u,l,a,f,m;return l=new dn({props:{tool:r[0]}}),{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish area</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=O(),n=S("div"),i=S("button"),i.textContent="Finish",o=O(),s=S("button"),s.textContent="Cancel",u=O(),W(l.$$.fragment),T(i,"type","button"),T(s,"type","button"),ge(n,"display","flex"),ge(n,"justify-content","space-between")},m(p,c){y(p,e,c),y(p,t,c),y(p,n,c),k(n,i),k(n,o),k(n,s),y(p,u,c),V(l,p,c),a=!0,f||(m=[G(i,"click",r[1]),G(s,"click",r[2])],f=!0)},p(p,[c]){const d={};c&1&&(d.tool=p[0]),l.$set(d)},i(p){a||(x(l.$$.fragment,p),a=!0)},o(p){P(l.$$.fragment,p),a=!1},d(p){p&&w(e),p&&w(t),p&&w(n),p&&w(u),K(l,p),f=!1,ze(m)}}}function Qs(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class oi extends re{constructor(e){super(),ie(this,e,Qs,Zs,ne,{routeTool:0})}}function el(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,d,_;return p=new dn({props:{tool:r[0]}}),{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=O(),n=S("label"),i=S("input"),o=z(`
  Avoid doubling back`),s=O(),u=S("div"),l=S("button"),l.textContent="Finish",a=O(),f=S("button"),f.textContent="Cancel",m=O(),W(p.$$.fragment),T(i,"type","checkbox"),T(l,"type","button"),T(f,"type","button"),ge(u,"display","flex"),ge(u,"justify-content","space-between")},m(g,E){y(g,e,E),y(g,t,E),y(g,n,E),k(n,i),i.checked=r[1],k(n,o),y(g,s,E),y(g,u,E),k(u,l),k(u,a),k(u,f),y(g,m,E),V(p,g,E),c=!0,d||(_=[G(i,"change",r[2]),G(l,"click",r[3]),G(f,"click",r[4])],d=!0)},p(g,[E]){E&2&&(i.checked=g[1]);const h={};E&1&&(h.tool=g[0]),p.$set(h)},i(g){c||(x(p.$$.fragment,g),c=!0)},o(g){P(p.$$.fragment,g),c=!1},d(g){g&&w(e),g&&w(t),g&&w(n),g&&w(s),g&&w(u),g&&w(m),K(p,g),d=!1,ze(_)}}}function tl(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),u=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,u]}class si extends re{constructor(e){super(),ie(this,e,tl,el,ne,{routeTool:0})}}function Nr(r){let e,t,n,i;const o=[sl,ol,il,rl,nl],s=[];function u(l,a){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=Me()},m(l,a){s[e].m(l,a),y(l,n,a),i=!0},p(l,a){let f=e;e=u(l),e===f?s[e].p(l,a):(Ce(),P(s[f],1,1,()=>{s[f]=null}),Re(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),x(t,1),t.m(n.parentNode,n))},i(l){i||(x(t),i=!0)},o(l){P(t),i=!1},d(l){s[e].d(l),l&&w(n)}}}function nl(r){let e;return{c(){e=S("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){y(t,e,n)},p:U,i:U,o:U,d(t){t&&w(e)}}}function rl(r){let e,t;return e=new si({props:{routeTool:r[3]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function il(r){let e,t;return e=new oi({props:{routeTool:r[3]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function ol(r){let e,t;return e=new ii({props:{polygonTool:r[2]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function sl(r){let e,t;return e=new ri({props:{pointTool:r[1],editingExisting:!0}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function ll(r){let e,t,n=r[0]==Ze&&Nr(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==Ze?n?(n.p(i,o),o&1&&x(n,1)):(n=Nr(i),n.c(),x(n,1),n.m(e.parentNode,e)):n&&(Ce(),P(n,1,1,()=>{n=null}),Re())},i(i){t||(x(n),t=!0)},o(i){P(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const Ze="edit-geometry";function li(){}function ul(r,e,t){let n;ce(r,We,_=>t(8,n=_));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:u}=e,l=null,a=null;function f(){l&&(o.stop(),s.stop(),u.stop(),se.update(_=>{let g=_.features.find(E=>E.id==l);return delete g.properties.hide_while_editing,_})),l=null,t(4,a=null),et.set(null)}n.on("mousemove",m),n.on("mouseout",p),n.on("click",c),jt(()=>{n.off("mousemove",m),n.off("mouseout",p),n.off("click",c)}),u.addEventListenerSuccessRoute(_=>{i==Ze&&(se.update(g=>{let E=g.features.find(h=>h.id==l);return E.properties.length_meters=_.properties.length_meters,E.properties.waypoints=_.properties.waypoints,delete E.properties.hide_while_editing,E.geometry=_.geometry,g}),l=null,t(4,a=null))}),u.addEventListenerSuccessArea(_=>{i==Ze&&(se.update(g=>{let E=g.features.find(h=>h.id==l);return E.properties.waypoints=_.properties.waypoints,delete E.properties.hide_while_editing,E.geometry=_.geometry,g}),l=null,t(4,a=null))});for(let _ of[o,s])_.addEventListenerSuccess(g=>{i==Ze&&(se.update(E=>{let h=E.features.find(v=>v.id==l);return h.geometry=g.geometry,delete h.properties.hide_while_editing,E}),l=null,t(4,a=null))});for(let _ of[o,s,u])_.addEventListenerFailure(()=>{i==Ze&&(se.update(g=>{let E=g.features.find(h=>h.id==l);return delete E.properties.hide_while_editing,g}),l=null,t(4,a=null))});function m(_){var g;if(i==Ze&&l==null){let E=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});et.set(((g=E[0])==null?void 0:g.id)||null)}}function p(){i==Ze&&l==null&&et.set(null)}function c(_){if(i==Ze&&l==null){let g=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0&&d(g[0].id)}}function d(_){et.set(null);let g=null;se.update(h=>(g=h.features.find(v=>v.id==_),g.properties.hide_while_editing=!0,h));let E=g;l=_,E.geometry.type=="LineString"?(u.editExistingRoute(E),t(4,a="route")):E.geometry.type=="Polygon"?E.properties.waypoints?(u.editExistingArea(E),t(4,a="snap-polygon")):(s.editExisting(E),t(4,a="free-polygon")):E.geometry.type=="Point"&&(o.start(),t(4,a="point"))}return r.$$set=_=>{"mode"in _&&t(0,i=_.mode),"pointTool"in _&&t(1,o=_.pointTool),"polygonTool"in _&&t(2,s=_.polygonTool),"routeTool"in _&&t(3,u=_.routeTool)},[i,o,s,u,a,li,f]}class al extends re{constructor(e){super(),ie(this,e,ul,ll,ne,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return li}get stop(){return this.$$.ctx[6]}}async function fl(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:a,value:f}=await n.read();if(a)break;s.push(f),o+=f.length;const m=100*o/i;e.style=`background: linear-gradient(to right, red ${m}%, transparent 0);`}let u=new Uint8Array(o),l=0;for(let a of s)u.set(a,l),l+=a.length;return u}function cl(r){let e,t;return e=new si({props:{routeTool:r[0]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function pl(r){let e;return{c(){e=S("div"),e.textContent="Route tool loading..."},m(t,n){y(t,e,n),r[7](e)},p:U,i:U,o:U,d(t){t&&w(e),r[7](null)}}}function hl(r){let e,t,n,i;const o=[pl,cl],s=[];function u(l,a){return l[0]?l[1]==Fn?1:-1:0}return~(e=u(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=Me()},m(l,a){~e&&s[e].m(l,a),y(l,n,a),i=!0},p(l,[a]){let f=e;e=u(l),e===f?~e&&s[e].p(l,a):(t&&(Ce(),P(s[f],1,1,()=>{s[f]=null}),Re()),~e?(t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),x(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(x(t),i=!0)},o(l){P(t),i=!1},d(l){~e&&s[e].d(l),l&&w(n)}}}const Fn="route";function dl(r,e,t){let n;ce(r,We,p=>t(8,n=p));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,u,{routeTool:l}=e;function a(){l.isActive()||l.startRoute()}function f(){l==null||l.stop()}In(async()=>{await ti(),console.log(`Grabbing ${s}`);try{const p=await fl(s,u);t(0,l=new Bs(n,p))}catch(p){console.log(`Route tool broke: ${p}`),t(2,u.innerHTML="Failed to load",u);return}l.addEventListenerFailure(()=>{i==Fn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(p=>{i==Fn&&(se.update(c=>(p.id=zt(c),p.properties.intervention_type="route",c.features.push(p),c)),o("edit-attribute"),Ne.set(p.id))})});function m(p){_e[p?"unshift":"push"](()=>{u=p,t(2,u)})}return r.$$set=p=>{"mode"in p&&t(1,i=p.mode),"changeMode"in p&&t(3,o=p.changeMode),"url"in p&&t(4,s=p.url),"routeTool"in p&&t(0,l=p.routeTool)},[l,i,u,o,s,a,f,m]}class ml extends re{constructor(e){super(),ie(this,e,dl,hl,ne,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Ir(r){let e,t;return e=new ri({props:{pointTool:r[1],editingExisting:!1}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function _l(r){let e,t,n=r[0]==on&&Ir(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==on?n?(n.p(i,o),o&1&&x(n,1)):(n=Ir(i),n.c(),x(n,1),n.m(e.parentNode,e)):n&&(Ce(),P(n,1,1,()=>{n=null}),Re())},i(i){t||(x(n),t=!0)},o(i){P(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const on="point";function gl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==on&&(se.update(a=>(l.id=zt(a),l.properties.intervention_type="other",a.features.push(l),a)),i("edit-attribute"),Ne.set(l.id))}),o.addEventListenerFailure(()=>{n==on&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,u]}class vl extends re{constructor(e){super(),ie(this,e,gl,_l,ne,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function $r(r){let e,t;return e=new ii({props:{polygonTool:r[1]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function bl(r){let e,t,n=r[0]==sn&&$r(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==sn?n?(n.p(i,o),o&1&&x(n,1)):(n=$r(i),n.c(),x(n,1),n.m(e.parentNode,e)):n&&(Ce(),P(n,1,1,()=>{n=null}),Re())},i(i){t||(x(n),t=!0)},o(i){P(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const sn="free-polygon";function yl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==sn&&(se.update(a=>(l.id=zt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),Ne.set(l.id))}),o.addEventListenerFailure(()=>{n==sn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,u]}class wl extends re{constructor(e){super(),ie(this,e,yl,bl,ne,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Br(r){let e,t;return e=new oi({props:{routeTool:r[1]}}),{c(){W(e.$$.fragment)},m(n,i){V(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){K(e,n)}}}function kl(r){let e,t,n=r[0]==ln&&Br(r);return{c(){n&&n.c(),e=Me()},m(i,o){n&&n.m(i,o),y(i,e,o),t=!0},p(i,[o]){i[0]==ln?n?(n.p(i,o),o&1&&x(n,1)):(n=Br(i),n.c(),x(n,1),n.m(e.parentNode,e)):n&&(Ce(),P(n,1,1,()=>{n=null}),Re())},i(i){t||(x(n),t=!0)},o(i){P(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const ln="snap-polygon";function Sl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function u(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==ln&&(se.update(a=>(l.id=zt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),Ne.set(l.id))}),o.addEventListenerFailure(()=>{n==ln&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,u]}class El extends re{constructor(e){super(),ie(this,e,Sl,kl,ne,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Ml(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=nt(r.slice(0,2),[n,t]),s=nt(r.slice(0,2),[e,i]);if(o>=s){var u=(t+i)/2;return[e,u-(n-e)/2,n,u+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Ol(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return Li(r,function(s){Ll(s,o,n)}),r}function Ll(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Cl(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Rn(r),n=Rn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Ol(e,{precision:7});switch(n){case"Point":return Nn(r,i);case"MultiPoint":return Dr(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Dr(r,Qr(r,i))}}function Dr(r,e){var t=[],n=kt();return Bn(e,function(i){if(t.forEach(function(u,l){u.id=l}),!t.length)t=Nn(r,i).features,t.forEach(function(u){u.bbox||(u.bbox=Ml(Ci(u)))}),n.load(ot(t));else{var o=n.search(i);if(o.features.length){var s=ui(i,o);t=t.filter(function(u){return u.id!==s.id}),n.remove(s),Zt(Nn(s,i),function(u){t.push(u),n.insert(u)})}}}),ot(t)}function Nn(r,e){var t=[],n=Ue(r)[0],i=Ue(r)[r.geometry.coordinates.length-1];if(bn(n,st(e))||bn(i,st(e)))return ot([r]);var o=kt(),s=Tn(r);o.load(s);var u=o.search(e);if(!u.features.length)return ot([r]);var l=ui(e,u),a=[n],f=Ri(s,function(m,p,c){var d=Ue(p)[1],_=st(e);return c===l.id?(m.push(_),t.push(wt(m)),bn(_,d)?[_]:[_,d]):(m.push(d),m)},a);return f.length>1&&t.push(wt(f)),ot(t)}function ui(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return Zt(e,function(i){var o=Gt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function bn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Rl(r,e,t){var n=Ue(t);if(Rn(t)!=="LineString")throw new Error("line must be a LineString");var i=Gt(t,r),o=Gt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var u=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)u.push(n[l]);return u.push(s[1].geometry.coordinates),wt(u,t.properties)}function qr(r){let e;return{c(){e=S("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){y(t,e,n)},d(t){t&&w(e)}}}function Tl(r){let e,t,n,i=r[0]==Bt&&qr();return{c(){i&&i.c(),e=Me()},m(o,s){i&&i.m(o,s),y(o,e,s),t||(n=G(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Bt?i||(i=qr(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:U,o:U,d(o){i&&i.d(o),o&&w(e),t=!1,n()}}}const Bt="split-route",Al=10,xl=30;let yn="split-route";function ai(){}function Gr(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Pl(r,e,t){let n,i;ce(r,se,_=>t(8,n=_)),ce(r,We,_=>t(6,i=_));let{mode:o}=e,{changeMode:s}=e;function u(){t(5,l=null),a=null}let l=null,a=null;i.on("mousemove",f),i.on("click",m),jt(()=>{i.off("mousemove",f),i.off("click",m)}),ft(i,yn,{type:"geojson",data:Je()}),Ae(i,{id:"draw-split-route",source:yn,...St("black",Al,["case",["==",["get","snapped"],!0],1,.5])});function f(_){if(o!=Bt)return;t(5,l=Gr(_.lngLat.toArray(),!1)),a=null;const g=[_.point.x-xl,_.point.y],E=i.unproject(_.point).distanceTo(i.unproject(g))/1e3;let h=[];for(let[v,b]of n.features.entries())if(b.geometry.type=="LineString"){let L=Gt(b.geometry,l,{units:"kilometers"});L.properties.dist!=null&&L.properties.dist<=E&&h.push([v,L.geometry.coordinates,L.properties.dist])}h.sort((v,b)=>v[2]-b[2]),h.length>0&&(t(5,l=Gr(h[0][1],!0)),a=h[0][0])}function m(){if(o==Bt)if(a==null)s("edit-attribute");else{let _=Cl(n.features[a],l);if(_.features.length==2){let g=_.features[0],E=_.features[1];se.update(h=>(g.id=h.features[a].id,E.id=zt(h),g.properties=JSON.parse(JSON.stringify(h.features[a].properties)),E.properties=JSON.parse(JSON.stringify(g.properties)),p(h.features[a],g,E,l),h.features.splice(a,1,g,E),h))}u()}}function p(_,g,E,h){g.properties.length_meters=Jt(g,{units:"kilometers"})*1e3,E.properties.length_meters=Jt(E,{units:"kilometers"})*1e3,g.properties.waypoints=[],E.properties.waypoints=[];let v=c(_,h),b=!0,L=0;for(let R of _.properties.waypoints){let A=c(_,yt([R.lon,R.lat]));if(b)if(A<v)g.properties.waypoints.push(R);else{let C=R.snapped&&_.properties.waypoints[L-1].snapped;g.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:C}),b=!1,E.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:C}),E.properties.waypoints.push(R)}else E.properties.waypoints.push(R);L++}}function c(_,g){let E=_.geometry.coordinates[0],h=Rl(E,g,_);return Jt(h,{units:"kilometers"})*1e3}function d(_){o==Bt&&_.key=="Escape"&&(s("edit-attribute"),_.preventDefault())}return r.$$set=_=>{"mode"in _&&t(0,o=_.mode),"changeMode"in _&&t(2,s=_.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let _=Je();l&&_.features.push(l),i.getSource(yn).setData(_)}},[o,d,s,ai,u,l,i]}class Fl extends re{constructor(e){super(),ie(this,e,Pl,Tl,ne,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ai}get stop(){return this.$$.ctx[4]}}function jr(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new al({props:n}),r[17](e),{c(){W(e.$$.fragment)},m(i,o){V(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(x(e.$$.fragment,i),t=!0)},o(i){P(e.$$.fragment,i),t=!1},d(i){r[17](null),K(e,i)}}}function zr(r){let e,t,n,i,o;return{c(){e=S("button"),t=z("New point"),T(e,"type","button"),e.disabled=n=r[3]=="point",T(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),k(e,t),i||(o=G(e,"click",r[18]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function Yr(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new El({props:n}),r[23](e),{c(){W(e.$$.fragment)},m(i,o){V(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(x(e.$$.fragment,i),t=!0)},o(i){P(e.$$.fragment,i),t=!1},d(i){r[23](null),K(e,i)}}}function Hr(r){let e,t,n,i,o;return{c(){e=S("button"),t=z("New route"),T(e,"type","button"),e.disabled=n=r[3]=="route",T(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),k(e,t),i||(o=G(e,"click",r[24]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function Ur(r){let e,t,n,i,o;return{c(){e=S("button"),t=z("Split route"),T(e,"type","button"),e.disabled=n=r[3]=="split-route",T(e,"class","svelte-cej5os")},m(s,u){y(s,e,u),k(e,t),i||(o=G(e,"click",r[27]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function Nl(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,d,_,g,E,h,v,b,L,R,A,C,$,D,B,J,F,Y,te,pe,q,le,we,xe,he,ae,Oe,ue,N,Q,Mt={mode:r[3],changeMode:r[13]};u=new zs({props:Mt}),r[15](u);let de=r[2]&&jr(r),ke=r[1]!="planning"&&zr(r),Ot={mode:r[3],changeMode:r[13],pointTool:r[11]};E=new vl({props:Ot}),r[19](E);let ut={mode:r[3],changeMode:r[13],polygonTool:r[12]};C=new wl({props:ut}),r[21](C);let ve=r[2]&&Yr(r),fe=r[1]!="planning"&&Hr(r);function Lt(j){r[26](j)}let Ct={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(Ct.routeTool=r[2]),le=new ml({props:Ct}),r[25](le),_e.push(()=>$e(le,"routeTool",Lt,r[2]));let be=r[1]!="planning"&&Ur(r),Te={mode:r[3],changeMode:r[13]};return Oe=new Fl({props:Te}),r[28](Oe),{c(){e=S("div"),t=S("div"),n=S("button"),i=z("Edit attributes"),s=O(),W(u.$$.fragment),l=O(),a=S("div"),f=S("button"),m=z("Edit geometry"),c=O(),de&&de.c(),d=O(),_=S("div"),ke&&ke.c(),g=O(),W(E.$$.fragment),h=O(),v=S("div"),b=S("button"),L=z("New polygon (freehand)"),A=O(),W(C.$$.fragment),$=O(),D=S("div"),B=S("button"),J=z("New polygon (snapped)"),Y=O(),ve&&ve.c(),te=O(),pe=S("div"),fe&&fe.c(),q=O(),W(le.$$.fragment),xe=O(),he=S("div"),be&&be.c(),ae=O(),W(Oe.$$.fragment),T(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",T(n,"class","svelte-cej5os"),T(f,"type","button"),f.disabled=p=r[3]=="edit-geometry",T(f,"class","svelte-cej5os"),T(b,"type","button"),b.disabled=R=r[3]=="free-polygon",T(b,"class","svelte-cej5os"),T(B,"type","button"),B.disabled=F=r[3]=="snap-polygon",T(B,"class","svelte-cej5os"),T(e,"class","toolbox svelte-cej5os")},m(j,ee){y(j,e,ee),k(e,t),k(t,n),k(n,i),k(t,s),V(u,t,null),k(e,l),k(e,a),k(a,f),k(f,m),k(a,c),de&&de.m(a,null),k(e,d),k(e,_),ke&&ke.m(_,null),k(_,g),V(E,_,null),k(e,h),k(e,v),k(v,b),k(b,L),k(v,A),V(C,v,null),k(e,$),k(e,D),k(D,B),k(B,J),k(D,Y),ve&&ve.m(D,null),k(e,te),k(e,pe),fe&&fe.m(pe,null),k(pe,q),V(le,pe,null),k(e,xe),k(e,he),be&&be.m(he,null),k(he,ae),V(Oe,he,null),ue=!0,N||(Q=[G(n,"click",r[14]),G(f,"click",r[16]),G(b,"click",r[20]),G(B,"click",r[22])],N=!0)},p(j,[ee]){(!ue||ee&8&&o!==(o=j[3]=="edit-attribute"))&&(n.disabled=o);const Ve={};ee&8&&(Ve.mode=j[3]),u.$set(Ve),(!ue||ee&8&&p!==(p=j[3]=="edit-geometry"))&&(f.disabled=p),j[2]?de?(de.p(j,ee),ee&4&&x(de,1)):(de=jr(j),de.c(),x(de,1),de.m(a,null)):de&&(Ce(),P(de,1,1,()=>{de=null}),Re()),j[1]!="planning"?ke?ke.p(j,ee):(ke=zr(j),ke.c(),ke.m(_,g)):ke&&(ke.d(1),ke=null);const Le={};ee&8&&(Le.mode=j[3]),E.$set(Le),(!ue||ee&8&&R!==(R=j[3]=="free-polygon"))&&(b.disabled=R);const Ke={};ee&8&&(Ke.mode=j[3]),C.$set(Ke),(!ue||ee&8&&F!==(F=j[3]=="snap-polygon"))&&(B.disabled=F),j[2]?ve?(ve.p(j,ee),ee&4&&x(ve,1)):(ve=Yr(j),ve.c(),x(ve,1),ve.m(D,null)):ve&&(Ce(),P(ve,1,1,()=>{ve=null}),Re()),j[1]!="planning"?fe?fe.p(j,ee):(fe=Hr(j),fe.c(),fe.m(pe,q)):fe&&(fe.d(1),fe=null);const ye={};ee&8&&(ye.mode=j[3]),ee&1&&(ye.url=j[0]),!we&&ee&4&&(we=!0,ye.routeTool=j[2],Be(()=>we=!1)),le.$set(ye),j[1]!="planning"?be?be.p(j,ee):(be=Ur(j),be.c(),be.m(he,ae)):be&&(be.d(1),be=null);const M={};ee&8&&(M.mode=j[3]),Oe.$set(M)},i(j){ue||(x(u.$$.fragment,j),x(de),x(E.$$.fragment,j),x(C.$$.fragment,j),x(ve),x(le.$$.fragment,j),x(Oe.$$.fragment,j),ue=!0)},o(j){P(u.$$.fragment,j),P(de),P(E.$$.fragment,j),P(C.$$.fragment,j),P(ve),P(le.$$.fragment,j),P(Oe.$$.fragment,j),ue=!1},d(j){j&&w(e),r[15](null),K(u),de&&de.d(),ke&&ke.d(),r[19](null),K(E),r[21](null),K(C),ve&&ve.d(),fe&&fe.d(),r[25](null),K(le),be&&be.d(),r[28](null),K(Oe),N=!1,ze(Q)}}}function Il(r,e,t){let n;ce(r,We,q=>t(29,n=q));let{routeUrl:i}=e,{schema:o}=e,s,u=new gs(n),l=new Rs(n),a="edit-attribute",f,m,p,c,d,_,g;function E(q){let le={"edit-attribute":f,"edit-geometry":m,route:p,point:c,"free-polygon":d,"snap-polygon":_,"split-route":g};if(a==q){console.log(`Mode is already ${a}, not changing`);return}console.log(`Stopping old mode ${a}`),le[a].stop(),t(3,a=q),console.log(`Starting new mode ${a}`),le[a].start()}jt(()=>{u==null||u.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const h=()=>E("edit-attribute");function v(q){_e[q?"unshift":"push"](()=>{f=q,t(4,f)})}const b=()=>E("edit-geometry");function L(q){_e[q?"unshift":"push"](()=>{m=q,t(5,m)})}const R=()=>E("point");function A(q){_e[q?"unshift":"push"](()=>{c=q,t(7,c)})}const C=()=>E("free-polygon");function $(q){_e[q?"unshift":"push"](()=>{d=q,t(8,d)})}const D=()=>E("snap-polygon");function B(q){_e[q?"unshift":"push"](()=>{_=q,t(9,_)})}const J=()=>E("route");function F(q){_e[q?"unshift":"push"](()=>{p=q,t(6,p)})}function Y(q){s=q,t(2,s)}const te=()=>E("split-route");function pe(q){_e[q?"unshift":"push"](()=>{g=q,t(10,g)})}return r.$$set=q=>{"routeUrl"in q&&t(0,i=q.routeUrl),"schema"in q&&t(1,o=q.schema)},[i,o,s,a,f,m,p,c,d,_,g,u,l,E,h,v,b,L,R,A,C,$,D,B,J,F,Y,te,pe]}class $l extends re{constructor(e){super(),ie(this,e,Il,Nl,ne,{routeUrl:0,schema:1})}}function Bl(r){let e,t,n,i,o,s,u,l,a,f,m,p,c,d,_,g,E,h;return{c(){e=S("div"),t=S("div"),n=S("button"),n.textContent="Home",i=O(),o=S("button"),o.textContent="About",s=O(),u=S("button"),u.textContent="Instructions",l=O(),a=S("br"),f=O(),m=S("label"),p=z(`ATIP schema:
      `),c=S("select"),d=S("option"),d.textContent="Design (v1)",_=S("option"),_.textContent="Design (v2)",g=S("option"),g.textContent="Planning",T(n,"type","button"),T(o,"type","button"),T(u,"type","button"),d.__value="v1",d.value=d.__value,_.__value="v2",_.value=_.__value,g.__value="planning",g.value=g.__value,r[2]===void 0&&at(()=>r[11].call(c)),T(e,"slot","nav")},m(v,b){y(v,e,b),k(e,t),k(t,n),k(t,i),k(t,o),k(t,s),k(t,u),k(e,l),k(e,a),k(e,f),k(e,m),k(m,p),k(m,c),k(c,d),k(c,_),k(c,g),Ie(c,r[2]),E||(h=[G(n,"click",r[10]),G(o,"click",r[7]),G(u,"click",r[8]),G(c,"change",r[11]),G(c,"change",r[9])],E=!0)},p(v,b){b&4&&Ie(c,v[2])},d(v){v&&w(e),E=!1,ze(h)}}}function Dl(r){let e,t,n,i,o,s,u,l,a,f,m,p;return o=new is({props:{boundaryGeojson:r[4]}}),u=new es({props:{authorityName:r[5],schema:r[2]}}),m=new Wo({props:{schema:r[2]}}),{c(){e=S("div"),t=S("h1"),n=z(r[5]),i=O(),W(o.$$.fragment),s=O(),W(u.$$.fragment),l=O(),a=S("br"),f=O(),W(m.$$.fragment),T(e,"slot","sidebar")},m(c,d){y(c,e,d),k(e,t),k(t,n),k(t,i),V(o,t,null),k(e,s),V(u,e,null),k(e,l),k(e,a),k(e,f),V(m,e,null),p=!0},p(c,d){const _={};d&16&&(_.boundaryGeojson=c[4]),o.$set(_);const g={};d&4&&(g.schema=c[2]),u.$set(g);const E={};d&4&&(E.schema=c[2]),m.$set(E)},i(c){p||(x(o.$$.fragment,c),x(u.$$.fragment,c),x(m.$$.fragment,c),p=!0)},o(c){P(o.$$.fragment,c),P(u.$$.fragment,c),P(m.$$.fragment,c),p=!1},d(c){c&&w(e),K(o),K(u),K(m)}}}function ql(r){let e,t,n,i,o,s,u,l,a,f,m,p;return e=new vo({props:{boundaryGeojson:r[4]}}),n=new ds({props:{schema:r[2]}}),o=new _s({}),u=new $l({props:{routeUrl:r[3],schema:r[2]}}),a=new ls({props:{style:r[6]}}),m=new ps({props:{schema:r[2]}}),{c(){W(e.$$.fragment),t=O(),W(n.$$.fragment),i=O(),W(o.$$.fragment),s=O(),W(u.$$.fragment),l=O(),W(a.$$.fragment),f=O(),W(m.$$.fragment)},m(c,d){V(e,c,d),y(c,t,d),V(n,c,d),y(c,i,d),V(o,c,d),y(c,s,d),V(u,c,d),y(c,l,d),V(a,c,d),y(c,f,d),V(m,c,d),p=!0},p(c,d){const _={};d&16&&(_.boundaryGeojson=c[4]),e.$set(_);const g={};d&4&&(g.schema=c[2]),n.$set(g);const E={};d&8&&(E.routeUrl=c[3]),d&4&&(E.schema=c[2]),u.$set(E);const h={};d&4&&(h.schema=c[2]),m.$set(h)},i(c){p||(x(e.$$.fragment,c),x(n.$$.fragment,c),x(o.$$.fragment,c),x(u.$$.fragment,c),x(a.$$.fragment,c),x(m.$$.fragment,c),p=!0)},o(c){P(e.$$.fragment,c),P(n.$$.fragment,c),P(o.$$.fragment,c),P(u.$$.fragment,c),P(a.$$.fragment,c),P(m.$$.fragment,c),p=!1},d(c){K(e,c),c&&w(t),K(n,c),c&&w(i),K(o,c),c&&w(s),K(u,c),c&&w(l),K(a,c),c&&w(f),K(m,c)}}}function Gl(r){let e,t,n;return t=new Bi({props:{style:r[6],$$slots:{default:[ql]},$$scope:{ctx:r}}}),{c(){e=S("div"),W(t.$$.fragment),T(e,"slot","main")},m(i,o){y(i,e,o),V(t,e,null),n=!0},p(i,o){const s={};o&131100&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(x(t.$$.fragment,i),n=!0)},o(i){P(t.$$.fragment,i),n=!1},d(i){i&&w(e),K(t)}}}function jl(r){let e,t,n,i,o,s,u,l;e=new Yi({props:{$$slots:{main:[Gl],sidebar:[Dl],nav:[Bl]},$$scope:{ctx:r}}});function a(c){r[12](c)}let f={};r[0]!==void 0&&(f.open=r[0]),n=new Ti({props:f}),_e.push(()=>$e(n,"open",a,r[0]));function m(c){r[13](c)}let p={};return r[1]!==void 0&&(p.open=r[1]),s=new Ni({props:p}),_e.push(()=>$e(s,"open",m,r[1])),{c(){W(e.$$.fragment),t=O(),W(n.$$.fragment),o=O(),W(s.$$.fragment)},m(c,d){V(e,c,d),y(c,t,d),V(n,c,d),y(c,o,d),V(s,c,d),l=!0},p(c,[d]){const _={};d&131100&&(_.$$scope={dirty:d,ctx:c}),e.$set(_);const g={};!i&&d&1&&(i=!0,g.open=c[0],Be(()=>i=!1)),n.$set(g);const E={};!u&&d&2&&(u=!0,E.open=c[1],Be(()=>u=!1)),s.$set(E)},i(c){l||(x(e.$$.fragment,c),x(n.$$.fragment,c),x(s.$$.fragment,c),l=!0)},o(c){P(e.$$.fragment,c),P(n.$$.fragment,c),P(s.$$.fragment,c),l=!1},d(c){K(e,c),c&&w(t),K(n,c),c&&w(o),K(s,c)}}}function zl(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let u=s.get("authority"),l=s.get("style")||"streets",a=s.get("schema")||"v1";var f=`https://atip.uk/route-snappers/${u}.bin`;o||(f=`https://atip.uk/route-snappers-dev/${u}.bin`);function m(){t(0,n=!n),t(1,i=!1)}function p(){t(1,i=!i),t(0,n=!1)}let c;In(async()=>{t(4,c=await d())});async function d(){const L=await(await fetch(Ai)).text(),R=JSON.parse(L);return R.features=R.features.filter(A=>{var C;return((C=A.properties)==null?void 0:C.name)==u}),R}function _(){let b=new URLSearchParams(window.location.search);b.set("schema",a);let L=`${window.location.pathname}?${b.toString()}${window.location.hash}`;window.location.href=L}const g=()=>window.open("index.html");function E(){a=gt(this),t(2,a)}function h(b){n=b,t(0,n)}function v(b){i=b,t(1,i)}return[n,i,a,f,c,u,l,m,p,_,g,E,h,v]}class Yl extends re{constructor(e){super(),ie(this,e,zl,jl,ne,{})}}new Yl({target:document.getElementById("app")});
