var ii=Object.defineProperty;var oi=(r,e,t)=>e in r?ii(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var oe=(r,e,t)=>(oi(r,typeof e!="symbol"?e+"":e,t),t);import{S as re,i as ie,s as ne,M as si,b as be,a as Ze,d as K,m as Z,k as Qe,n as P,o as I,q as Q,e as k,c as R,g as b,x as J,p as w,y as He,f as O,z as Ne,B as Ie,C as li,D as Fn,E as hn,F as Gt,G as Tt,H as Ct,I as Ot,J as At,K as jn,h as E,l as q,L as ui,N as ai,O as ce,P as fi,w as Nn,Q as at,R as Re,T as ln,t as H,U as Ae,V as ge,j as Fe,r as je,W as In,X as ut,Y as Pe,Z as Gr,_ as qt,$ as mt,a0 as qn,a1 as zn,a2 as Yn,a3 as ci,a4 as pi,a5 as De,a6 as hi,a7 as di,a8 as mi,a9 as un,aa as wt,ab as an,ac as $t,ad as fn,ae as yn,af as gi,ag as vt,ah as $n,ai as it,aj as yt,ak as _i,al as Bn,am as vi,an as yi,ao as bi,ap as Hn,aq as Kt,ar as wi,as as ki,at as Si,A as Ei,u as Mi}from"./authorities-53686526.js";function xi(r){let e,t,n,i,o,s,u,l,a,p,v,h,f;return{c(){e=k("p"),e.textContent="For each intervention:",t=R(),n=k("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=R(),o=k("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=R(),u=k("p"),u.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=R(),a=k("p"),a.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=R(),v=k("p"),v.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,h=R(),f=k("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(g,d){b(g,e,d),b(g,t,d),b(g,n,d),b(g,i,d),b(g,o,d),b(g,s,d),b(g,u,d),b(g,l,d),b(g,a,d),b(g,p,d),b(g,v,d),b(g,h,d),b(g,f,d)},p:J,d(g){g&&w(e),g&&w(t),g&&w(n),g&&w(i),g&&w(o),g&&w(s),g&&w(u),g&&w(l),g&&w(a),g&&w(p),g&&w(v),g&&w(h),g&&w(f)}}}function Li(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[xi]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new si({props:o}),be.push(()=>Ze(e,"open",i,r[0])),{c(){K(e.$$.fragment)},m(s,u){Z(e,s,u),n=!0},p(s,[u]){const l={};u&4&&(l.$$scope={dirty:u,ctx:s}),!t&&u&1&&(t=!0,l.open=s[0],Qe(()=>t=!1)),e.$set(l)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){I(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function Ri(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Ti extends re{constructor(e){super(),ie(this,e,Ri,Li,ne,{open:0})}}const ft=[];function kt(r,e=J){let t;const n=new Set;function i(u){if(ne(r,u)&&(r=u,t)){const l=!ft.length;for(const a of n)a[1](),ft.push(a,r);if(l){for(let a=0;a<ft.length;a+=2)ft[a][0](ft[a+1]);ft.length=0}}}function o(u){i(u(r))}function s(u,l=J){const a=[u,l];return n.add(a),n.size===1&&(t=e(i)||J),u(r),()=>{n.delete(a),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ue=kt(null),se=kt(He()),Oe=kt(null),Ke=kt(null),Zt=kt(null),bn=kt(null);function jt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Un(r){se.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Oe.set(null),Ke.set(null),Zt.set(null)}function Xn(r){let e;const t=r[4].default,n=Tt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Ct(n,t,i,i[3],e?At(t,i[3],o,null):Ot(i[3]),null)},i(i){e||(P(n,i),e=!0)},o(i){I(n,i),e=!1},d(i){n&&n.d(i)}}}function Ci(r){let e,t,n=r[1]&&Xn(r);return{c(){e=k("div"),n&&n.c(),O(e,"class","map svelte-12dpf1u")},m(i,o){b(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&P(n,1)):(n=Xn(i),n.c(),P(n,1),n.m(e,null)):n&&(Ne(),I(n,1,1,()=>{n=null}),Ie())},i(i){t||(P(n),t=!0)},o(i){I(n),t=!1},d(i){i&&w(e),n&&n.d(),r[5](null)}}}function Oi(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,u,l=!1;li("setCamera",!window.location.hash),Fn(()=>{s=new hn.Map({container:u,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new hn.ScaleControl({})),s.addControl(new hn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ue.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(u)}),Gt(()=>{s.remove()});function a(p){be[p?"unshift":"push"](()=>{u=p,t(0,u)})}return r.$$set=p=>{"style"in p&&t(2,o=p.style),"$$scope"in p&&t(3,i=p.$$scope)},[u,l,o,i,n,a]}class Ai extends re{constructor(e){super(),ie(this,e,Oi,Ci,ne,{style:2})}}const Pi=r=>({}),Jn=r=>({}),Fi=r=>({}),Wn=r=>({}),Ni=r=>({}),Vn=r=>({});function Ii(r){let e,t,n,i,o,s,u,l,a,p,v,h;const f=r[3].nav,g=Tt(f,r,r[2],Vn),d=r[3].sidebar,m=Tt(d,r,r[2],Wn),S=r[3].main,c=Tt(S,r,r[2],Jn);return{c(){e=k("aside"),t=k("div"),n=k("nav"),g&&g.c(),i=R(),m&&m.c(),o=R(),s=k("button"),s.textContent="→",l=R(),a=k("main"),c&&c.c(),O(n,"class","svelte-1u7vg8a"),O(t,"class","sidebar-content content-container svelte-1u7vg8a"),O(s,"type","button"),O(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),O(e,"class",u=jn(r[0]?"":"collapsed")+" svelte-1u7vg8a"),O(a,"class","svelte-1u7vg8a")},m(_,y){b(_,e,y),E(e,t),E(t,n),g&&g.m(n,null),E(t,i),m&&m.m(t,null),E(e,o),E(e,s),b(_,l,y),b(_,a,y),c&&c.m(a,null),p=!0,v||(h=q(s,"click",r[1]),v=!0)},p(_,[y]){g&&g.p&&(!p||y&4)&&Ct(g,f,_,_[2],p?At(f,_[2],y,Ni):Ot(_[2]),Vn),m&&m.p&&(!p||y&4)&&Ct(m,d,_,_[2],p?At(d,_[2],y,Fi):Ot(_[2]),Wn),(!p||y&1&&u!==(u=jn(_[0]?"":"collapsed")+" svelte-1u7vg8a"))&&O(e,"class",u),c&&c.p&&(!p||y&4)&&Ct(c,S,_,_[2],p?At(S,_[2],y,Pi):Ot(_[2]),Jn)},i(_){p||(P(g,_),P(m,_),P(c,_),p=!0)},o(_){I(g,_),I(m,_),I(c,_),p=!1},d(_){_&&w(e),g&&g.d(_),m&&m.d(_),_&&w(l),_&&w(a),c&&c.d(_),v=!1,h()}}}function $i(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=u=>{"$$scope"in u&&t(2,i=u.$$scope)},[o,s,i,n]}class Bi extends re{constructor(e){super(),ie(this,e,$i,Ii,ne,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Di(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(a){return function(p){return l([a,p])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(p){a=[6,p],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var st=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Gi(r,e){return r>e?1:r<e?-1:0}function et(r,e,t){for(var n=new st(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function dn(r,e,t,n){var i=new st(r,e);if(t===null)return i.left=i.right=null,i;t=et(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Kn(r,e,t){var n=null,i=null;if(e){e=et(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function ji(r,e,t){return e===null?r:(r===null||(e=et(r.key,e,t),e.left=r),e)}function wn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&wn(r.left,o,!1,n,i),r.right&&wn(r.right,o,!0,n,i)}}var Dn=function(){function r(e){e===void 0&&(e=Gi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=dn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new st(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=et(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=et(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=et(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=et(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=et(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,u=this._root,l;o.length!==0||u;)if(u)o.push(u),u=u.left;else{if(u=o.pop(),l=s(u.key,t),l>0)break;if(s(u.key,e)>=0&&n.call(i,u))return this;u=u.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return zi(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&En(e,t,0,i-1,o),this._root===null)this._root=kn(e,t,0,i),this._size=i;else{var s=Yi(this.toList(),qi(e,t),o);i=this._size+i,this._root=Sn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return wn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Kn(e,this._root,i),s=o.left,u=o.right;i(e,t)<0?u=dn(t,n,u,i):s=dn(t,n,s,i),this._root=ji(s,u,i)},r.prototype.split=function(e){return Kn(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Di(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function kn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],u=e[o],l=new st(s,u);return l.left=kn(r,e,t,o),l.right=kn(r,e,o+1,n),l}return null}function qi(r,e){for(var t=new st(null,null),n=t,i=0;i<r.length;i++)n=n.next=new st(r[i],e[i]);return n.next=null,t.next}function zi(r){for(var e=r,t=[],n=!1,i=new st(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Sn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Sn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Sn(r,i+1,t),s}return null}function Yi(r,e,t){for(var n=new st(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function En(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,u=n+1;;){do s++;while(i(r[s],o)<0);do u--;while(i(r[u],o)>0);if(s>=u)break;var l=r[s];r[s]=r[u],r[u]=l,l=e[s],e[s]=e[u],e[u]=l}En(r,e,t,u,i),En(r,e,u+1,n,i)}}function $e(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Zn(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Ce(r,e,t){return e&&Zn(r.prototype,e),t&&Zn(r,t),r}var Lt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Mn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},nt=Number.EPSILON;nt===void 0&&(nt=Math.pow(2,-52));var Hi=nt*nt,xn=function(e,t){if(-nt<e&&e<nt&&-nt<t&&t<nt)return 0;var n=e-t;return n*n<Hi*e*t?0:e<t?-1:1},Ui=function(){function r(){$e(this,r),this.reset()}return Ce(r,[{key:"reset",value:function(){this.xRounder=new Qn,this.yRounder=new Qn}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Qn=function(){function r(){$e(this,r),this.tree=new Dn,this.round(0)}return Ce(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&xn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&xn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Bt=new Ui,Pt=function(e,t){return e.x*t.y-e.y*t.x},jr=function(e,t){return e.x*t.x+e.y*t.y},er=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Pt(i,o);return xn(s,0)},Qt=function(e){return Math.sqrt(jr(e,e))},Xi=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Pt(o,i)/Qt(o)/Qt(i)},Ji=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return jr(o,i)/Qt(o)/Qt(i)},tr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},nr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},Wi=function(e,t,n,i){if(t.x===0)return nr(n,i,e.x);if(i.x===0)return nr(e,t,n.x);if(t.y===0)return tr(n,i,e.y);if(i.y===0)return tr(e,t,n.y);var o=Pt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},u=Pt(s,t)/o,l=Pt(s,i)/o,a=e.x+l*t.x,p=n.x+u*i.x,v=e.y+l*t.y,h=n.y+u*i.y,f=(a+p)/2,g=(v+h)/2;return{x:f,y:g}},ze=function(){Ce(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:en.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){$e(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Ce(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(u){var l=u.otherSE;i.set(u,{sine:Xi(n.point,t.point,l.point),cosine:Ji(n.point,t.point,l.point)})};return function(s,u){i.has(s)||o(s),i.has(u)||o(u);var l=i.get(s),a=l.sine,p=l.cosine,v=i.get(u),h=v.sine,f=v.cosine;return a>=0&&h>=0?p<f?1:p>f?-1:0:a<0&&h<0?p<f?-1:p>f?1:0:h<a?-1:h>a?1:0}}}]),r}(),Vi=0,en=function(){Ce(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,u=n.rightSE.point.x;if(u<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,a=n.leftSE.point.y,p=t.rightSE.point.y,v=n.rightSE.point.y;if(i<o){if(a<l&&a<p)return 1;if(a>l&&a>p)return-1;var h=t.comparePoint(n.leftSE.point);if(h<0)return 1;if(h>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<a&&l<v)return-1;if(l>a&&l>v)return 1;var g=n.comparePoint(t.leftSE.point);if(g!==0)return g;var d=t.comparePoint(n.rightSE.point);return d<0?1:d>0?-1:1}if(l<a)return-1;if(l>a)return 1;if(s<u){var m=n.comparePoint(t.rightSE.point);if(m!==0)return m}if(s>u){var S=t.comparePoint(n.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(s!==u){var c=p-l,_=s-i,y=v-a,x=u-o;if(c>_&&y<x)return 1;if(c<_&&y>x)return-1}return s>u?1:s<u||p<v?-1:p>v?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){$e(this,r),this.id=++Vi,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Ce(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,u=n.x+s*o.x;if(t.x===u)return 0;var l=(t.x-n.x)/o.x,a=n.y+l*o.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Mn(n,i);if(o===null)return null;var s=this.leftSE.point,u=this.rightSE.point,l=t.leftSE.point,a=t.rightSE.point,p=Lt(n,l)&&this.comparePoint(l)===0,v=Lt(i,s)&&t.comparePoint(s)===0,h=Lt(n,a)&&this.comparePoint(a)===0,f=Lt(i,u)&&t.comparePoint(u)===0;if(v&&p)return f&&!h?u:!f&&h?a:null;if(v)return h&&s.x===a.x&&s.y===a.y?null:s;if(p)return f&&u.x===l.x&&u.y===l.y?null:l;if(f&&h)return null;if(f)return u;if(h)return a;var g=Wi(s,this.vector(),l,t.vector());return g===null||!Lt(o,g)?null:Bt.round(g.x,g.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new ze(t,!0),s=new ze(t,!1),u=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,u,this.rings.slice(),this.windings.slice());return ze.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),ze.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var u=n;n=i,i=u}for(var l=0,a=i.rings.length;l<a;l++){var p=i.rings[l],v=i.windings[l],h=n.rings.indexOf(p);h===-1?(n.rings.push(p),n.windings.push(v)):n.windings[h]+=v}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,u=this.rings.length;s<u;s++){var l=this.rings[s],a=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),i.push(a)):i[p]+=a}for(var v=[],h=[],f=0,g=n.length;f<g;f++)if(i[f]!==0){var d=n[f],m=d.poly;if(h.indexOf(m)===-1)if(d.isExterior)v.push(m);else{h.indexOf(m)===-1&&h.push(m);var S=v.indexOf(d.poly);S!==-1&&v.splice(S,1)}}for(var c=0,_=v.length;c<_;c++){var y=v[c].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ge.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,u;t.length<n.length?(s=t.length,u=n.length):(s=n.length,u=t.length),this._isInResult=u===Ge.numMultiPolys&&s<u;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var a=function(v){return v.length===1&&v[0].isSubject};this._isInResult=a(t)!==a(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ge.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,u,l=ze.comparePoints(t,n);if(l<0)o=t,s=n,u=1;else if(l>0)o=n,s=t,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var a=new ze(o,!0),p=new ze(s,!1);return new r(a,p,[i],[u])}}]),r}(),rr=function(){function r(e,t,n){if($e(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Bt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,u=e.length;s<u;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Bt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(en.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(en.fromRing(o,i,this))}return Ce(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),Ki=function(){function r(e,t){if($e(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new rr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new rr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Ce(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),ir=function(){function r(e,t){if($e(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new Ki(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Ce(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,u=o.length;s<u;s++)t.push(o[s]);return t}}]),r}(),Zi=function(){Ce(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var u=null,l=s.leftSE,a=s.rightSE,p=[l],v=l.point,h=[];u=l,l=a,p.push(l),l.point!==v;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var g=p[0].point,d=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(g.x,",")+" ".concat(g.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(f.length===1){a=f[0].otherSE;break}for(var m=null,S=0,c=h.length;S<c;S++)if(h[S].point===l.point){m=S;break}if(m!==null){var _=h.splice(m)[0],y=p.splice(_.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}h.push({index:p.length,point:l.point});var x=l.getLeftmostComparator(u);a=f.sort(x)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){$e(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Ce(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,u=this.events[i+1].point;er(s,t,u)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],a=n[1];er(l,t,a)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,v=this.isExteriorRing()?0:n.length-1,h=this.isExteriorRing()?n.length:-1,f=[],g=v;g!=h;g+=p)f.push([n[g].x,n[g].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];ze.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),u=s?s.prevInResult():null;;){if(!s)return null;if(!u)return s.ringOut;if(u.ringOut!==s.ringOut)return u.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=u.prevInResult(),u=s?s.prevInResult():null}}}]),r}(),or=function(){function r(e){$e(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Ce(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),Qi=function(){function r(e){$e(this,r),this.rings=e,this.polys=this._composePolys(e)}return Ce(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new or(s));else{var u=s.enclosingRing();u.poly||n.push(new or(u)),u.poly.addInterior(s)}}return n}}]),r}(),eo=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:en.compare;$e(this,r),this.queue=e,this.tree=new Dn(t),this.segments=[]}return Ce(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,u=o,l=void 0,a=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;a===void 0;)u=this.tree.next(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);if(t.isLeft){var p=null;if(l){var v=l.getIntersection(n);if(v!==null&&(n.isAnEndpoint(v)||(p=v),!l.isAnEndpoint(v)))for(var h=this._splitSafely(l,v),f=0,g=h.length;f<g;f++)i.push(h[f])}var d=null;if(a){var m=a.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(d=m),!a.isAnEndpoint(m)))for(var S=this._splitSafely(a,m),c=0,_=S.length;c<_;c++)i.push(S[c])}if(p!==null||d!==null){var y=null;if(p===null)y=d;else if(d===null)y=p;else{var x=ze.comparePoints(p,d);y=x<=0?p:d}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var T=n.split(y),C=0,L=T.length;C<L;C++)i.push(T[C])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&a){var $=l.getIntersection(a);if($!==null){if(!l.isAnEndpoint($))for(var D=this._splitSafely(l,$),B=0,U=D.length;B<U;B++)i.push(D[B]);if(!a.isAnEndpoint($))for(var A=this._splitSafely(a,$),z=0,te=A.length;z<te;z++)i.push(A[z])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),sr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,to=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,no=function(){function r(){$e(this,r)}return Ce(r,[{key:"run",value:function(t,n,i){Ge.type=t,Bt.reset();for(var o=[new ir(n,!0)],s=0,u=i.length;s<u;s++)o.push(new ir(i[s],!1));if(Ge.numMultiPolys=o.length,Ge.type==="difference")for(var l=o[0],a=1;a<o.length;)Mn(o[a].bbox,l.bbox)!==null?a++:o.splice(a,1);if(Ge.type==="intersection"){for(var p=0,v=o.length;p<v;p++)for(var h=o[p],f=p+1,g=o.length;f<g;f++)if(Mn(h.bbox,o[f].bbox)===null)return[]}for(var d=new Dn(ze.compare),m=0,S=o.length;m<S;m++)for(var c=o[m].getSweepEvents(),_=0,y=c.length;_<y;_++)if(d.insert(c[_]),d.size>sr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var x=new eo(d),T=d.size,C=d.pop();C;){var L=C.key;if(d.size===T){var $=L.segment;throw new Error("Unable to pop() ".concat(L.isLeft?"left":"right"," SweepEvent ")+"[".concat(L.point.x,", ").concat(L.point.y,"] from segment #").concat($.id," ")+"[".concat($.leftSE.point.x,", ").concat($.leftSE.point.y,"] -> ")+"[".concat($.rightSE.point.x,", ").concat($.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(d.size>sr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(x.segments.length>to)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var D=x.process(L),B=0,U=D.length;B<U;B++){var A=D[B];A.consumedBy===void 0&&d.insert(A)}T=d.size,C=d.pop()}Bt.reset();var z=Zi.factory(x.segments),te=new Qi(z);return te.getGeom()}}]),r}(),Ge=new no,ro=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ge.run("union",e,n)},io=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ge.run("intersection",e,n)},oo=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ge.run("xor",e,n)},so=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ge.run("difference",e,n)},Ht={union:ro,intersection:io,xor:oo,difference:so};function lo(r,e){var t=ao(e),n=null;return r.type==="FeatureCollection"?n=uo(r):n=qr(Ht.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function uo(r){var e=r.features.length===2?Ht.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Ht.union.apply(Ht,r.features.map(function(t){return t.geometry.coordinates}));return qr(e)}function qr(r){return ui(r)}function ao(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return ai(t)}function fo(r,e,t){let n;ce(r,Ue,s=>t(1,n=s));let{boundaryGeojson:i}=e;return fi("setCamera")&&n.fitBounds(Nn(i),{padding:20,animate:!1}),at(n,"boundary",{type:"geojson",data:lo(i)}),Re(n,{id:"boundary",source:"boundary",...ln("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class co extends re{constructor(e){super(),ie(this,e,fo,null,ne,{boundaryGeojson:0})}}function lr(r){let e,t=ur(r[3])+"",n;return{c(){e=H("Length: "),n=H(t)},m(i,o){b(i,e,o),b(i,n,o)},p(i,o){o&8&&t!==(t=ur(i[3])+"")&&In(n,t)},d(i){i&&w(e),i&&w(n)}}}function po(r){let e,t,n,i,o,s,u,l,a,p,v,h,f,g,d,m,S,c,_,y,x,T,C,L,$,D,B,U,A,z,te,pe,G,le,we,Te,he,ae,Me,ue=r[3]&&lr(r);return{c(){e=k("label"),t=H("Name:"),n=k("br"),i=R(),o=k("input"),s=R(),u=k("br"),l=R(),a=k("br"),p=R(),v=k("label"),h=k("input"),f=H(`
  Area`),g=R(),d=k("label"),m=k("input"),S=H(`
  Route`),c=R(),_=k("label"),y=k("input"),x=H(`
  Crossing`),T=R(),C=k("label"),L=k("input"),$=H(`
  Other`),D=R(),B=k("br"),U=R(),A=k("br"),z=R(),te=k("label"),pe=H("Description:"),G=k("br"),le=R(),we=k("textarea"),Te=R(),ue&&ue.c(),he=Ae(),O(o,"type","text"),ge(o,"width","100%"),O(h,"type","radio"),h.__value="area",h.value=h.__value,r[6][0].push(h),O(m,"type","radio"),m.__value="route",m.value=m.__value,r[6][0].push(m),O(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[6][0].push(y),O(L,"type","radio"),L.__value="other",L.value=L.__value,r[6][0].push(L),ge(we,"width","100%"),O(we,"rows","5"),O(we,"class","svelte-15lna0i")},m(F,V){b(F,e,V),E(e,t),E(e,n),E(e,i),E(e,o),Fe(o,r[0]),b(F,s,V),b(F,u,V),b(F,l,V),b(F,a,V),b(F,p,V),b(F,v,V),E(v,h),h.checked=h.__value===r[1],E(v,f),b(F,g,V),b(F,d,V),E(d,m),m.checked=m.__value===r[1],E(d,S),b(F,c,V),b(F,_,V),E(_,y),y.checked=y.__value===r[1],E(_,x),b(F,T,V),b(F,C,V),E(C,L),L.checked=L.__value===r[1],E(C,$),b(F,D,V),b(F,B,V),b(F,U,V),b(F,A,V),b(F,z,V),b(F,te,V),E(te,pe),E(te,G),E(te,le),E(te,we),Fe(we,r[2]),b(F,Te,V),ue&&ue.m(F,V),b(F,he,V),ae||(Me=[q(o,"input",r[4]),q(h,"change",r[5]),q(m,"change",r[7]),q(y,"change",r[8]),q(L,"change",r[9]),q(we,"input",r[10])],ae=!0)},p(F,[V]){V&1&&o.value!==F[0]&&Fe(o,F[0]),V&2&&(h.checked=h.__value===F[1]),V&2&&(m.checked=m.__value===F[1]),V&2&&(y.checked=y.__value===F[1]),V&2&&(L.checked=L.__value===F[1]),V&4&&Fe(we,F[2]),F[3]?ue?ue.p(F,V):(ue=lr(F),ue.c(),ue.m(he.parentNode,he)):ue&&(ue.d(1),ue=null)},i:J,o:J,d(F){F&&w(e),F&&w(s),F&&w(u),F&&w(l),F&&w(a),F&&w(p),F&&w(v),r[6][0].splice(r[6][0].indexOf(h),1),F&&w(g),F&&w(d),r[6][0].splice(r[6][0].indexOf(m),1),F&&w(c),F&&w(_),r[6][0].splice(r[6][0].indexOf(y),1),F&&w(T),F&&w(C),r[6][0].splice(r[6][0].indexOf(L),1),F&&w(D),F&&w(B),F&&w(U),F&&w(A),F&&w(z),F&&w(te),F&&w(Te),ue&&ue.d(F),F&&w(he),ae=!1,je(Me)}}}function ur(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function ho(r,e,t){let{name:n}=e,{intervention_type:i}=e,{description:o}=e,{length_meters:s}=e;const u=[[]];function l(){n=this.value,t(0,n)}function a(){i=this.__value,t(1,i)}function p(){i=this.__value,t(1,i)}function v(){i=this.__value,t(1,i)}function h(){i=this.__value,t(1,i)}function f(){o=this.value,t(2,o)}return r.$$set=g=>{"name"in g&&t(0,n=g.name),"intervention_type"in g&&t(1,i=g.intervention_type),"description"in g&&t(2,o=g.description),"length_meters"in g&&t(3,s=g.length_meters)},[n,i,o,s,l,a,u,p,v,h,f]}class mo extends re{constructor(e){super(),ie(this,e,ho,po,ne,{name:0,intervention_type:1,description:2,length_meters:3})}}const go="Route",_o=[{name:"RouteType",oneOf:[{name:"OnRoad",members:[{name:"Type",oneOf:["FullSeparation","Stepped","PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}],vo={name:go,members:_o};function yo(r){let e;return{c(){e=k("pre"),e.textContent=`${JSON.stringify(vo)}`},m(t,n){b(t,e,n)},p:J,i:J,o:J,d(t){t&&w(e)}}}function bo(r,e,t){let{props:n}=e;return n.v2||(n.v2={name:""}),r.$$set=i=>{"props"in i&&t(0,n=i.props)},[n]}class wo extends re{constructor(e){super(),ie(this,e,bo,yo,ne,{props:0})}}function ar(r,e,t){const n=r.slice();return n[12]=e[t],n}function fr(r,e,t){const n=r.slice();return n[12]=e[t],n}function cr(r,e,t){const n=r.slice();return n[12]=e[t],n}function pr(r,e,t){const n=r.slice();return n[12]=e[t],n}function hr(r){let e,t=r[12]+"",n;return{c(){e=k("option"),n=H(t),e.__value=r[12],e.value=e.__value},m(i,o){b(i,e,o),E(e,n)},p:J,d(i){i&&w(e)}}}function dr(r){let e,t=r[12]+"",n;return{c(){e=k("option"),n=H(t),e.__value=r[12],e.value=e.__value},m(i,o){b(i,e,o),E(e,n)},p:J,d(i){i&&w(e)}}}function mr(r){let e,t=r[12]+"",n;return{c(){e=k("option"),n=H(t),e.__value=r[12],e.value=e.__value},m(i,o){b(i,e,o),E(e,n)},p:J,d(i){i&&w(e)}}}function gr(r){let e,t=r[12]+"",n;return{c(){e=k("option"),n=H(t),e.__value=r[12],e.value=e.__value},m(i,o){b(i,e,o),E(e,n)},p:J,d(i){i&&w(e)}}}function ko(r){let e,t,n,i,o,s,u,l,a,p,v,h,f,g,d,m,S,c,_,y,x,T,C,L,$,D,B,U,A,z,te,pe,G,le,we,Te,he,ae,Me,ue,F,V,St,de,ke,Et,lt,_e,fe,Mt,xt,ve=r[1],Le=[];for(let M=0;M<ve.length;M+=1)Le[M]=hr(pr(r,ve,M));let j=r[2],ee=[];for(let M=0;M<j.length;M+=1)ee[M]=dr(cr(r,j,M));let Xe=r[3],xe=[];for(let M=0;M<Xe.length;M+=1)xe[M]=mr(fr(r,Xe,M));let Je=r[4],ye=[];for(let M=0;M<Je.length;M+=1)ye[M]=gr(ar(r,Je,M));return{c(){e=k("label"),t=H("Name:"),n=k("br"),i=R(),o=k("input"),s=R(),u=k("br"),l=R(),a=k("br"),p=R(),v=k("label"),h=H(`Reference type:
  `),f=k("select");for(let M=0;M<Le.length;M+=1)Le[M].c();g=R(),d=k("br"),m=R(),S=k("br"),c=R(),_=k("label"),y=H("Notes:"),x=k("br"),T=R(),C=k("textarea"),L=R(),$=k("br"),D=R(),B=k("br"),U=R(),A=k("label"),z=H(`Size:
  `),te=k("input"),pe=R(),G=k("select");for(let M=0;M<ee.length;M+=1)ee[M].c();le=R(),we=k("br"),Te=R(),he=k("br"),ae=R(),Me=k("label"),ue=H(`ATE Triage:
  `),F=k("select");for(let M=0;M<xe.length;M+=1)xe[M].c();V=R(),St=k("br"),de=R(),ke=k("br"),Et=R(),lt=k("label"),_e=H(`ATE Recommendation:
  `),fe=k("select");for(let M=0;M<ye.length;M+=1)ye[M].c();O(o,"type","text"),ge(o,"width","100%"),r[0].planning.reference_type===void 0&&ut(()=>r[6].call(f)),ge(C,"width","100%"),O(C,"rows","5"),O(C,"class","svelte-15lna0i"),O(te,"type","number"),O(te,"min","0"),O(te,"max","1000"),r[0].planning.size_units===void 0&&ut(()=>r[9].call(G)),r[0].planning.triage===void 0&&ut(()=>r[10].call(F)),r[0].planning.recommendation===void 0&&ut(()=>r[11].call(fe))},m(M,Y){b(M,e,Y),E(e,t),E(e,n),E(e,i),E(e,o),Fe(o,r[0].planning.name),b(M,s,Y),b(M,u,Y),b(M,l,Y),b(M,a,Y),b(M,p,Y),b(M,v,Y),E(v,h),E(v,f);for(let N=0;N<Le.length;N+=1)Le[N].m(f,null);Pe(f,r[0].planning.reference_type),b(M,g,Y),b(M,d,Y),b(M,m,Y),b(M,S,Y),b(M,c,Y),b(M,_,Y),E(_,y),E(_,x),E(_,T),E(_,C),Fe(C,r[0].planning.notes),b(M,L,Y),b(M,$,Y),b(M,D,Y),b(M,B,Y),b(M,U,Y),b(M,A,Y),E(A,z),E(A,te),Fe(te,r[0].planning.size),E(A,pe),E(A,G);for(let N=0;N<ee.length;N+=1)ee[N].m(G,null);Pe(G,r[0].planning.size_units),b(M,le,Y),b(M,we,Y),b(M,Te,Y),b(M,he,Y),b(M,ae,Y),b(M,Me,Y),E(Me,ue),E(Me,F);for(let N=0;N<xe.length;N+=1)xe[N].m(F,null);Pe(F,r[0].planning.triage),b(M,V,Y),b(M,St,Y),b(M,de,Y),b(M,ke,Y),b(M,Et,Y),b(M,lt,Y),E(lt,_e),E(lt,fe);for(let N=0;N<ye.length;N+=1)ye[N].m(fe,null);Pe(fe,r[0].planning.recommendation),Mt||(xt=[q(o,"input",r[5]),q(f,"change",r[6]),q(C,"input",r[7]),q(te,"input",r[8]),q(G,"change",r[9]),q(F,"change",r[10]),q(fe,"change",r[11])],Mt=!0)},p(M,[Y]){if(Y&3&&o.value!==M[0].planning.name&&Fe(o,M[0].planning.name),Y&2){ve=M[1];let N;for(N=0;N<ve.length;N+=1){const Be=pr(M,ve,N);Le[N]?Le[N].p(Be,Y):(Le[N]=hr(Be),Le[N].c(),Le[N].m(f,null))}for(;N<Le.length;N+=1)Le[N].d(1);Le.length=ve.length}if(Y&3&&Pe(f,M[0].planning.reference_type),Y&3&&Fe(C,M[0].planning.notes),Y&3&&Gr(te.value)!==M[0].planning.size&&Fe(te,M[0].planning.size),Y&4){j=M[2];let N;for(N=0;N<j.length;N+=1){const Be=cr(M,j,N);ee[N]?ee[N].p(Be,Y):(ee[N]=dr(Be),ee[N].c(),ee[N].m(G,null))}for(;N<ee.length;N+=1)ee[N].d(1);ee.length=j.length}if(Y&3&&Pe(G,M[0].planning.size_units),Y&8){Xe=M[3];let N;for(N=0;N<Xe.length;N+=1){const Be=fr(M,Xe,N);xe[N]?xe[N].p(Be,Y):(xe[N]=mr(Be),xe[N].c(),xe[N].m(F,null))}for(;N<xe.length;N+=1)xe[N].d(1);xe.length=Xe.length}if(Y&3&&Pe(F,M[0].planning.triage),Y&16){Je=M[4];let N;for(N=0;N<Je.length;N+=1){const Be=ar(M,Je,N);ye[N]?ye[N].p(Be,Y):(ye[N]=gr(Be),ye[N].c(),ye[N].m(fe,null))}for(;N<ye.length;N+=1)ye[N].d(1);ye.length=Je.length}Y&3&&Pe(fe,M[0].planning.recommendation)},i:J,o:J,d(M){M&&w(e),M&&w(s),M&&w(u),M&&w(l),M&&w(a),M&&w(p),M&&w(v),qt(Le,M),M&&w(g),M&&w(d),M&&w(m),M&&w(S),M&&w(c),M&&w(_),M&&w(L),M&&w($),M&&w(D),M&&w(B),M&&w(U),M&&w(A),qt(ee,M),M&&w(le),M&&w(we),M&&w(Te),M&&w(he),M&&w(ae),M&&w(Me),qt(xe,M),M&&w(V),M&&w(St),M&&w(de),M&&w(ke),M&&w(Et),M&&w(lt),qt(ye,M),Mt=!1,je(xt)}}}function So(r,e,t){let{props:n}=e;n.planning||(n.planning={name:"",notes:"",reference_type:"preapp",size:0,size_units:"number of units",triage:"No Comment",recommendation:"No Comment"});const i=["preapp","outline","reserved matters","local plan"],o=["number of units","floorspace (Gross Floor Area)","area (Hectare)"],s=["No Comment","Standing Advice","Toolkit Assessment"],u=["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"];function l(){n.planning.name=this.value,t(0,n),t(1,i)}function a(){n.planning.reference_type=mt(this),t(0,n),t(1,i)}function p(){n.planning.notes=this.value,t(0,n),t(1,i)}function v(){n.planning.size=Gr(this.value),t(0,n),t(1,i)}function h(){n.planning.size_units=mt(this),t(0,n),t(1,i)}function f(){n.planning.triage=mt(this),t(0,n),t(1,i)}function g(){n.planning.recommendation=mt(this),t(0,n),t(1,i)}return r.$$set=d=>{"props"in d&&t(0,n=d.props)},[n,i,o,s,u,l,a,p,v,h,f,g]}class Eo extends re{constructor(e){super(),ie(this,e,So,ko,ne,{props:0})}}function Mo(r){const e=r-1;return e*e*e+1}function _r(r,{delay:e=0,duration:t=400,easing:n=Mo}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),u=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),a=parseFloat(i.marginTop),p=parseFloat(i.marginBottom),v=parseFloat(i.borderTopWidth),h=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*u}px;padding-bottom: ${f*l}px;margin-top: ${f*a}px;margin-bottom: ${f*p}px;border-top-width: ${f*v}px;border-bottom-width: ${f*h}px;`}}function vr(r){let e,t,n,i,o;const s=r[10].default,u=Tt(s,r,r[9],null);return{c(){e=k("div"),u&&u.c(),ge(e,"border","solid 1px black"),ge(e,"padding","10px")},m(l,a){b(l,e,a),u&&u.m(e,null),r[13](e),n=!0,i||(o=q(e,"introend",r[14]),i=!0)},p(l,a){u&&u.p&&(!n||a&512)&&Ct(u,s,l,l[9],n?At(s,l[9],a,null):Ot(l[9]),null)},i(l){n||(P(u,l),ut(()=>{t||(t=Yn(e,_r,{duration:100},!0)),t.run(1)}),n=!0)},o(l){I(u,l),t||(t=Yn(e,_r,{duration:100},!1)),t.run(0),n=!1},d(l){l&&w(e),u&&u.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function xo(r){let e,t,n,i,o,s,u,l,a,p,v=r[4]&&vr(r);return{c(){e=k("button"),t=qn("svg"),n=qn("path"),i=R(),o=H(r[1]),s=R(),v&&v.c(),u=Ae(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-t7fpgu"),O(e,"aria-expanded",r[4]),O(e,"class","svelte-t7fpgu"),zn(e,"underlined",r[3])},m(h,f){b(h,e,f),E(e,t),E(t,n),E(e,i),E(e,o),b(h,s,f),v&&v.m(h,f),b(h,u,f),l=!0,a||(p=[q(e,"click",r[5]),q(e,"mouseenter",r[11]),q(e,"mouseleave",r[12])],a=!0)},p(h,[f]){(!l||f&2)&&In(o,h[1]),(!l||f&16)&&O(e,"aria-expanded",h[4]),(!l||f&8)&&zn(e,"underlined",h[3]),h[4]?v?(v.p(h,f),f&16&&P(v,1)):(v=vr(h),v.c(),P(v,1),v.m(u.parentNode,u)):v&&(Ne(),I(v,1,1,()=>{v=null}),Ie())},i(h){l||(P(v),l=!0)},o(h){I(v),l=!1},d(h){h&&w(e),h&&w(s),v&&v.d(h),h&&w(u),a=!1,je(p)}}}function Lo(r,e,t){let n,i,o,s;ce(r,Ke,c=>t(7,o=c)),ce(r,Oe,c=>t(8,s=c));let{$$slots:u={},$$scope:l}=e,{id:a}=e,{label:p}=e;const v=()=>{Oe.update(c=>c==a?null:a),s==a&&(bn.set(null),bn.set(a))};let h;function f(){h==null||h.scrollIntoView({behavior:"smooth"})}const g=()=>Zt.set(a),d=()=>Zt.set(null);function m(c){be[c?"unshift":"push"](()=>{h=c,t(2,h)})}const S=()=>f();return r.$$set=c=>{"id"in c&&t(0,a=c.id),"label"in c&&t(1,p=c.label),"$$scope"in c&&t(9,l=c.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==a),r.$$.dirty&129&&t(3,i=o==a)},[a,p,h,i,n,v,f,o,s,l,u,g,d,m,S]}class Ro extends re{constructor(e){super(),ie(this,e,Lo,xo,ne,{id:0,label:1})}}function yr(r,e,t){const n=r.slice();return n[12]=e[t],n[13]=e,n[14]=t,n}function To(r){let e,t,n;function i(s){r[8](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new Eo({props:o}),be.push(()=>Ze(e,"props",i,r[12].properties)),{c(){K(e.$$.fragment)},m(s,u){Z(e,s,u),n=!0},p(s,u){r=s;const l={};!t&&u&2&&(t=!0,l.props=r[12].properties,Qe(()=>t=!1)),e.$set(l)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){I(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function Co(r){let e,t,n;function i(s){r[7](s,r[12])}let o={};return r[12].properties!==void 0&&(o.props=r[12].properties),e=new wo({props:o}),be.push(()=>Ze(e,"props",i,r[12].properties)),{c(){K(e.$$.fragment)},m(s,u){Z(e,s,u),n=!0},p(s,u){r=s;const l={};!t&&u&2&&(t=!0,l.props=r[12].properties,Qe(()=>t=!1)),e.$set(l)},i(s){n||(P(e.$$.fragment,s),n=!0)},o(s){I(e.$$.fragment,s),n=!1},d(s){Q(e,s)}}}function Oo(r){let e,t,n,i,o;function s(p){r[4](p,r[12])}function u(p){r[5](p,r[12])}function l(p){r[6](p,r[12])}let a={length_meters:r[12].properties.length_meters};return r[12].properties.name!==void 0&&(a.name=r[12].properties.name),r[12].properties.intervention_type!==void 0&&(a.intervention_type=r[12].properties.intervention_type),r[12].properties.description!==void 0&&(a.description=r[12].properties.description),e=new mo({props:a}),be.push(()=>Ze(e,"name",s,r[12].properties.name)),be.push(()=>Ze(e,"intervention_type",u,r[12].properties.intervention_type)),be.push(()=>Ze(e,"description",l,r[12].properties.description)),{c(){K(e.$$.fragment)},m(p,v){Z(e,p,v),o=!0},p(p,v){r=p;const h={};v&2&&(h.length_meters=r[12].properties.length_meters),!t&&v&2&&(t=!0,h.name=r[12].properties.name,Qe(()=>t=!1)),!n&&v&2&&(n=!0,h.intervention_type=r[12].properties.intervention_type,Qe(()=>n=!1)),!i&&v&2&&(i=!0,h.description=r[12].properties.description,Qe(()=>i=!1)),e.$set(h)},i(p){o||(P(e.$$.fragment,p),o=!0)},o(p){I(e.$$.fragment,p),o=!1},d(p){Q(e,p)}}}function Ao(r){let e,t,n,i,o,s,u,l,a,p,v,h,f,g,d;const m=[Oo,Co,To],S=[];function c(y,x){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:-1}~(e=c(r))&&(t=S[e]=m[e](r));function _(){return r[9](r[12])}return{c(){t&&t.c(),n=R(),i=k("br"),o=R(),s=k("br"),u=R(),l=k("div"),a=k("button"),a.textContent="Delete",p=R(),v=k("button"),v.textContent="Save",h=R(),O(a,"type","button"),O(v,"type","button"),ge(l,"display","flex"),ge(l,"justify-content","space-between")},m(y,x){~e&&S[e].m(y,x),b(y,n,x),b(y,i,x),b(y,o,x),b(y,s,x),b(y,u,x),b(y,l,x),E(l,a),E(l,p),E(l,v),b(y,h,x),f=!0,g||(d=[q(a,"click",_),q(v,"click",r[10])],g=!0)},p(y,x){r=y;let T=e;e=c(r),e===T?~e&&S[e].p(r,x):(t&&(Ne(),I(S[T],1,1,()=>{S[T]=null}),Ie()),~e?(t=S[e],t?t.p(r,x):(t=S[e]=m[e](r),t.c()),P(t,1),t.m(n.parentNode,n)):t=null)},i(y){f||(P(t),f=!0)},o(y){I(t),f=!1},d(y){~e&&S[e].d(y),y&&w(n),y&&w(i),y&&w(o),y&&w(s),y&&w(u),y&&w(l),y&&w(h),g=!1,je(d)}}}function br(r,e){let t,n,i;return n=new Ro({props:{id:e[12].id,label:e[14]+1+") "+e[2](e[12]),$$slots:{default:[Ao]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=Ae(),K(n.$$.fragment),this.first=t},m(o,s){b(o,t,s),Z(n,o,s),i=!0},p(o,s){e=o;const u={};s&2&&(u.id=e[12].id),s&2&&(u.label=e[14]+1+") "+e[2](e[12])),s&32771&&(u.$$scope={dirty:s,ctx:e}),n.$set(u)},i(o){i||(P(n.$$.fragment,o),i=!0)},o(o){I(n.$$.fragment,o),i=!1},d(o){o&&w(t),Q(n,o)}}}function Po(r){let e=[],t=new Map,n,i,o,s,u=r[1].features;const l=a=>a[12].id;for(let a=0;a<u.length;a+=1){let p=yr(r,u,a),v=l(p);t.set(v,e[a]=br(v,p))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();n=Ae()},m(a,p){for(let v=0;v<e.length;v+=1)e[v].m(a,p);b(a,n,p),i=!0,o||(s=q(window,"keydown",r[3]),o=!0)},p(a,[p]){p&7&&(u=a[1].features,Ne(),e=ci(e,p,l,1,a,u,t,n.parentNode,pi,br,n,yr),Ie())},i(a){if(!i){for(let p=0;p<u.length;p+=1)P(e[p]);i=!0}},o(a){for(let p=0;p<e.length;p+=1)I(e[p]);i=!1},d(a){for(let p=0;p<e.length;p+=1)e[p].d(a);a&&w(n),o=!1,s()}}}function Fo(r,e,t){let n,i;ce(r,Oe,d=>t(11,n=d)),ce(r,se,d=>t(1,i=d));let{schema:o}=e;function s(d){var S;if(o=="planning")return((S=d.properties.planning)==null?void 0:S.name)||"Untitled polygon";if(d.properties.name)return d.properties.name;var m=d.properties.intervention_type;return m=="other"&&(d.geometry.type=="Point"?m="point":d.geometry.type=="LineString"?m="line":m="polygon"),`Untitled ${m}`}function u(d){if(d.key=="Delete"){const m=d.target.tagName;if(m=="INPUT"||m=="TEXTAREA")return;d.preventDefault();const S=n;S&&Un(S)}}function l(d,m){r.$$.not_equal(m.properties.name,d)&&(m.properties.name=d,se.set(i))}function a(d,m){r.$$.not_equal(m.properties.intervention_type,d)&&(m.properties.intervention_type=d,se.set(i))}function p(d,m){r.$$.not_equal(m.properties.description,d)&&(m.properties.description=d,se.set(i))}function v(d,m){r.$$.not_equal(m.properties,d)&&(m.properties=d,se.set(i))}function h(d,m){r.$$.not_equal(m.properties,d)&&(m.properties=d,se.set(i))}const f=d=>Un(d.id),g=()=>Oe.set(null);return r.$$set=d=>{"schema"in d&&t(0,o=d.schema)},[o,i,s,u,l,a,p,v,h,f,g]}class No extends re{constructor(e){super(),ie(this,e,Fo,Po,ne,{schema:0})}}function ot(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ye(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ln(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function tt(r,e,t){t===void 0&&(t={});var n=ot(r),i=ot(e),o=De(i[1]-n[1]),s=De(i[0]-n[0]),u=De(n[1]),l=De(i[1]),a=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return hi(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),t.units)}function Ut(r,e){return e===void 0&&(e={}),di(r,function(t,n){var i=n.geometry.coordinates;return t+tt(i[0],i[1],e)},0)}function Io(r){let e,t,n,i,o,s,u,l,a,p,v,h,f,g,d,m,S,c,_,y=r[0].features.length+"",x,T,C,L,$,D,B,U;return{c(){e=k("div"),t=k("label"),n=H(`Scheme name:
    `),i=k("input"),o=R(),s=k("br"),u=R(),l=k("div"),a=k("label"),p=k("input"),v=R(),h=k("button"),h.textContent="Load from GeoJSON",f=R(),g=k("button"),g.textContent="Export to GeoJSON",d=R(),m=k("br"),S=R(),c=k("div"),_=k("span"),x=H(y),T=H(" interventions"),C=R(),L=k("button"),$=H("Clear all"),O(i,"type","text"),O(p,"type","file"),O(p,"id","load_geojson"),O(p,"class","svelte-lhyd1e"),O(h,"type","button"),O(g,"type","button"),O(g,"class","align-right svelte-lhyd1e"),O(L,"type","button"),O(L,"class","align-right svelte-lhyd1e"),L.disabled=D=r[0].features.length==0},m(A,z){b(A,e,z),E(e,t),E(t,n),E(t,i),Fe(i,r[0].scheme_name),b(A,o,z),b(A,s,z),b(A,u,z),b(A,l,z),E(l,a),E(a,p),E(a,v),E(a,h),E(l,f),E(l,g),b(A,d,z),b(A,m,z),b(A,S,z),b(A,c,z),E(c,_),E(_,x),E(_,T),E(c,C),E(c,L),E(L,$),B||(U=[q(i,"input",r[7]),q(p,"change",r[3]),q(h,"click",Bo),q(g,"click",r[2]),q(L,"click",r[1])],B=!0)},p(A,[z]){z&1&&i.value!==A[0].scheme_name&&Fe(i,A[0].scheme_name),z&1&&y!==(y=A[0].features.length+"")&&In(x,y),z&1&&D!==(D=A[0].features.length==0)&&(L.disabled=D)},i:J,o:J,d(A){A&&w(e),A&&w(o),A&&w(s),A&&w(u),A&&w(l),A&&w(d),A&&w(m),A&&w(S),A&&w(c),B=!1,je(U)}}}function $o(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Bo(){document.getElementById("load_geojson").click()}function Do(r,e,t){let n;ce(r,se,g=>t(0,n=g));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let u=window.localStorage.getItem(s);if(u)try{se.set(h(JSON.parse(u)))}catch(g){console.log(`Failed to load from local storage: ${g}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&se.update(g=>(delete g.scheme_name,g.features=[],g))}function a(){const g=JSON.parse(JSON.stringify(n));for(let d of g.features)delete d.properties.hide_while_editing;return g}function p(){let g=a();var d=s;g.authority=i,g.origin="atip-v1",g.scheme_name&&(d+="_"+g.scheme_name),d+=".txt",$o(d,JSON.stringify(g,null,"  "))}function v(g){const d=new FileReader;d.onload=S=>{try{se.set(h(JSON.parse(S.target.result)))}catch(c){window.alert(`Couldn't load scheme from a file: ${c}`)}};let m=g.target.files;d.readAsText(m[0])}function h(g){let d=1;for(let m of g.features)m.properties||(m.properties={name:"",description:"",intervention_type:"other"}),m.geometry.type=="LineString"&&!m.properties.length_meters&&(m.properties.length_meters=Ut(m,{units:"kilometers"})*1e3),m.id=d++;return g}function f(){n.scheme_name=this.value,se.set(n)}return r.$$set=g=>{"authorityName"in g&&t(4,i=g.authorityName),"schema"in g&&t(5,o=g.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(a())))},[n,l,p,v,i,o,s,f]}class Go extends re{constructor(e){super(),ie(this,e,Do,Io,ne,{authorityName:4,schema:5})}}const jo="/atip/schemas/assets/zoom_out_map-b2e1091a.svg";function qo(r){let e,t,n,i,o;return{c(){e=k("button"),t=k("img"),mi(t.src,n=jo)||O(t,"src",n),O(t,"alt","Zoom to show entire boundary"),O(e,"type","button"),O(e,"title","Zoom to show entire boundary"),O(e,"class","svelte-qzjsqo")},m(s,u){b(s,e,u),E(e,t),i||(o=q(e,"click",r[0]),i=!0)},p:J,i:J,o:J,d(s){s&&w(e),i=!1,o()}}}function zo(r,e,t){let n;ce(r,Ue,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(Nn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class Yo extends re{constructor(e){super(),ie(this,e,zo,qo,ne,{boundaryGeojson:1})}}function Ho(r){let e,t,n,i,o,s,u;return{c(){e=k("div"),t=H(`Basemap:
  `),n=k("select"),i=k("option"),i.textContent="Streets",o=k("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&ut(()=>r[2].call(n)),O(e,"class","svelte-1tbnm6i")},m(l,a){b(l,e,a),E(e,t),E(e,n),E(n,i),E(n,o),Pe(n,r[0]),s||(u=[q(n,"change",r[2]),q(n,"change",r[1])],s=!0)},p(l,[a]){a&1&&Pe(n,l[0])},i:J,o:J,d(l){l&&w(e),s=!1,je(u)}}}function Uo(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let u=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=u}function o(){n=mt(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Xo extends re{constructor(e){super(),ie(this,e,Uo,Ho,ne,{style:0})}}const me={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},cn=10,tn=10;function Jo(r){let e,t,n,i,o,s,u,l,a,p,v,h,f,g,d;return{c(){e=k("li"),t=k("span"),n=H("Areas"),i=R(),o=k("li"),s=k("span"),u=H("Routes"),l=R(),a=k("li"),p=k("span"),v=H("Crossings"),h=R(),f=k("li"),g=k("span"),d=H("Other"),O(t,"class","svelte-p551i1"),ge(t,"background",me.area),O(s,"class","svelte-p551i1"),ge(s,"background",me.route),O(p,"class","svelte-p551i1"),ge(p,"background",me.crossing),O(g,"class","svelte-p551i1"),ge(g,"background",me.other)},m(m,S){b(m,e,S),E(e,t),E(e,n),b(m,i,S),b(m,o,S),E(o,s),E(o,u),b(m,l,S),b(m,a,S),E(a,p),E(a,v),b(m,h,S),b(m,f,S),E(f,g),E(f,d)},p:J,d(m){m&&w(e),m&&w(i),m&&w(o),m&&w(l),m&&w(a),m&&w(h),m&&w(f)}}}function Wo(r){let e,t,n,i,o,s,u,l,a,p,v,h,f,g,d;return{c(){e=k("li"),t=k("span"),n=H("Preapp"),i=R(),o=k("li"),s=k("span"),u=H("Outline"),l=R(),a=k("li"),p=k("span"),v=H("Reserved matters"),h=R(),f=k("li"),g=k("span"),d=H("Local plan"),O(t,"class","svelte-p551i1"),ge(t,"background",me.preapp),O(s,"class","svelte-p551i1"),ge(s,"background",me.outline),O(p,"class","svelte-p551i1"),ge(p,"background",me["reserved matters"]),O(g,"class","svelte-p551i1"),ge(g,"background",me["local plan"])},m(m,S){b(m,e,S),E(e,t),E(e,n),b(m,i,S),b(m,o,S),E(o,s),E(o,u),b(m,l,S),b(m,a,S),E(a,p),E(a,v),b(m,h,S),b(m,f,S),E(f,g),E(f,d)},p:J,d(m){m&&w(e),m&&w(i),m&&w(o),m&&w(l),m&&w(a),m&&w(h),m&&w(f)}}}function Vo(r){let e,t,n,i;function o(l,a){return l[0]=="planning"?Wo:Jo}let s=o(r),u=s(r);return{c(){e=k("div"),t=k("h1"),t.textContent="Interventions",n=R(),i=k("ul"),u.c(),O(t,"class","svelte-p551i1"),O(e,"class","svelte-p551i1")},m(l,a){b(l,e,a),E(e,t),E(e,n),E(e,i),u.m(i,null)},p(l,[a]){s===(s=o(l))&&u?u.p(l,a):(u.d(1),u=s(l),u&&(u.c(),u.m(i,null)))},i:J,o:J,d(l){l&&w(e),u.d()}}}function Ko(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class Zo extends re{constructor(e){super(),ie(this,e,Ko,Vo,ne,{schema:0})}}let ct="interventions";function Qo(r,e,t){let n,i;ce(r,Ue,p=>t(1,n=p)),ce(r,se,p=>t(2,i=p));let{schema:o}=e;at(n,ct,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",me.area,"route",me.route,"crossing",me.crossing,"other",me.other,"white"],u=["match",["get","reference_type",["get","planning"]],"preapp",me.preapp,"outline",me.outline,"reserved matters",me["reserved matters"],"local plan",me["local plan"],"white"],l=["!=","hide_while_editing",!0];return Re(n,{id:"interventions-points",source:ct,filter:["all",un,l,["!=","endpoint",!0]],...wt(s,cn)}),Re(n,{id:"interventions-lines",source:ct,filter:["all",an,l],...$t(s,tn)},"route-lines"),Re(n,{id:"interventions-lines-endpoints",source:ct,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*tn,"circle-opacity":0,"circle-stroke-color":me.lineEndpointColor,"circle-stroke-width":2}}),Re(n,{id:"interventions-polygons",source:ct,filter:["all",fn,l],...ln(o=="planning"?u:s,.5)},"hover-polygons"),r.$$set=p=>{"schema"in p&&t(0,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(i)),v=[];for(let h of p.features)if(h.geometry.type=="LineString")for(let f of[h.geometry.coordinates[0],h.geometry.coordinates[h.geometry.coordinates.length-1]])v.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(v),n.getSource(ct).setData(p)}},[o,n,i]}class es extends re{constructor(e){super(),ie(this,e,Qo,null,ne,{schema:0})}}let pt="hover";function ts(r,e,t){let n,i,o,s,u;return ce(r,Ue,l=>t(0,n=l)),ce(r,se,l=>t(1,i=l)),ce(r,Zt,l=>t(2,o=l)),ce(r,Ke,l=>t(3,s=l)),ce(r,Oe,l=>t(4,u=l)),at(n,pt,{type:"geojson",data:He()}),Re(n,{id:"hover-polygons",source:pt,filter:fn,...$t(me.hovering,.5*tn,1)}),Re(n,{id:"hover-lines",source:pt,filter:an,...$t(me.hovering,1.5*tn,1)},"interventions-lines"),Re(n,{id:"hover-points",source:pt,filter:un,...wt(me.hovering,1.5*cn,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=u||s||o;l!=null?n.getSource(pt).setData(i.features.find(a=>a.id==l)):n.getSource(pt).setData(He())}},[n,i,o,s,u]}class ns extends re{constructor(e){super(),ie(this,e,ts,null,ne,{})}}class Gn{constructor(e,t){oe(this,"owner");oe(this,"map");oe(this,"mapHandlers",{});oe(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const zt="edit-point-mode";class rs{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"cursor");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new Gn(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),at(e,zt,{type:"geojson",data:He()}),Re(e,{id:"edit-point-mode",source:zt,...wt(me.hovering,cn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=is(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(zt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=He();this.cursor&&e.features.push(this.cursor),this.map.getSource(zt).setData(e)}}function is(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function zr(r,e,t){if(t===void 0&&(t={}),t.final===!0)return os(r,e);var n=ot(r),i=ot(e),o=De(n[0]),s=De(i[0]),u=De(n[1]),l=De(i[1]),a=Math.sin(s-o)*Math.cos(l),p=Math.cos(u)*Math.sin(l)-Math.sin(u)*Math.cos(l)*Math.cos(s-o);return yn(Math.atan2(a,p))}function os(r,e){var t=zr(e,r);return t=(t+180)%360,t}function wr(r,e,t,n){n===void 0&&(n={});var i=ot(r),o=De(i[0]),s=De(i[1]),u=De(t),l=gi(e,n.units),a=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(u)),p=o+Math.atan2(Math.sin(u)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(a)),v=yn(p),h=yn(a);return vt([v,h],n.properties)}function Rn(r){if(!r)throw new Error("geojson is required");var e=[];return $n(r,function(t){ss(t,e)}),it(e)}function ss(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ye(n);break;case"LineString":t=[Ye(n)]}t.forEach(function(i){var o=ls(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function ls(r,e){var t=[];return r.reduce(function(n,i){var o=yt([n,i],e);return o.bbox=us(n,i),t.push(o),i}),t}function us(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,u=n<o?n:o,l=t>i?t:i,a=n>o?n:o;return[s,u,l,a]}var bt={},as={get exports(){return bt},set exports(r){bt=r}},Tn={},fs={get exports(){return Tn},set exports(r){Tn=r}};(function(r,e){(function(t,n){r.exports=n()})(_i,function(){function t(c,_,y,x,T){(function C(L,$,D,B,U){for(;B>D;){if(B-D>600){var A=B-D+1,z=$-D+1,te=Math.log(A),pe=.5*Math.exp(2*te/3),G=.5*Math.sqrt(te*pe*(A-pe)/A)*(z-A/2<0?-1:1),le=Math.max(D,Math.floor($-z*pe/A+G)),we=Math.min(B,Math.floor($+(A-z)*pe/A+G));C(L,$,le,we,U)}var Te=L[$],he=D,ae=B;for(n(L,D,$),U(L[B],Te)>0&&n(L,D,B);he<ae;){for(n(L,he,ae),he++,ae--;U(L[he],Te)<0;)he++;for(;U(L[ae],Te)>0;)ae--}U(L[D],Te)===0?n(L,D,ae):n(L,++ae,B),ae<=$&&(D=ae+1),$<=ae&&(B=ae-1)}})(c,_,y||0,x||c.length-1,T||i)}function n(c,_,y){var x=c[_];c[_]=c[y],c[y]=x}function i(c,_){return c<_?-1:c>_?1:0}var o=function(c){c===void 0&&(c=9),this._maxEntries=Math.max(4,c),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(c,_,y){if(!y)return _.indexOf(c);for(var x=0;x<_.length;x++)if(y(c,_[x]))return x;return-1}function u(c,_){l(c,0,c.children.length,_,c)}function l(c,_,y,x,T){T||(T=m(null)),T.minX=1/0,T.minY=1/0,T.maxX=-1/0,T.maxY=-1/0;for(var C=_;C<y;C++){var L=c.children[C];a(T,c.leaf?x(L):L)}return T}function a(c,_){return c.minX=Math.min(c.minX,_.minX),c.minY=Math.min(c.minY,_.minY),c.maxX=Math.max(c.maxX,_.maxX),c.maxY=Math.max(c.maxY,_.maxY),c}function p(c,_){return c.minX-_.minX}function v(c,_){return c.minY-_.minY}function h(c){return(c.maxX-c.minX)*(c.maxY-c.minY)}function f(c){return c.maxX-c.minX+(c.maxY-c.minY)}function g(c,_){return c.minX<=_.minX&&c.minY<=_.minY&&_.maxX<=c.maxX&&_.maxY<=c.maxY}function d(c,_){return _.minX<=c.maxX&&_.minY<=c.maxY&&_.maxX>=c.minX&&_.maxY>=c.minY}function m(c){return{children:c,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function S(c,_,y,x,T){for(var C=[_,y];C.length;)if(!((y=C.pop())-(_=C.pop())<=x)){var L=_+Math.ceil((y-_)/x/2)*x;t(c,L,_,y,T),C.push(_,L,L,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(c){var _=this.data,y=[];if(!d(c,_))return y;for(var x=this.toBBox,T=[];_;){for(var C=0;C<_.children.length;C++){var L=_.children[C],$=_.leaf?x(L):L;d(c,$)&&(_.leaf?y.push(L):g(c,$)?this._all(L,y):T.push(L))}_=T.pop()}return y},o.prototype.collides=function(c){var _=this.data;if(!d(c,_))return!1;for(var y=[];_;){for(var x=0;x<_.children.length;x++){var T=_.children[x],C=_.leaf?this.toBBox(T):T;if(d(c,C)){if(_.leaf||g(c,C))return!0;y.push(T)}}_=y.pop()}return!1},o.prototype.load=function(c){if(!c||!c.length)return this;if(c.length<this._minEntries){for(var _=0;_<c.length;_++)this.insert(c[_]);return this}var y=this._build(c.slice(),0,c.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var x=this.data;this.data=y,y=x}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(c){return c&&this._insert(c,this.data.height-1),this},o.prototype.clear=function(){return this.data=m([]),this},o.prototype.remove=function(c,_){if(!c)return this;for(var y,x,T,C=this.data,L=this.toBBox(c),$=[],D=[];C||$.length;){if(C||(C=$.pop(),x=$[$.length-1],y=D.pop(),T=!0),C.leaf){var B=s(c,C.children,_);if(B!==-1)return C.children.splice(B,1),$.push(C),this._condense($),this}T||C.leaf||!g(C,L)?x?(y++,C=x.children[y],T=!1):C=null:($.push(C),D.push(y),y=0,x=C,C=C.children[0])}return this},o.prototype.toBBox=function(c){return c},o.prototype.compareMinX=function(c,_){return c.minX-_.minX},o.prototype.compareMinY=function(c,_){return c.minY-_.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(c){return this.data=c,this},o.prototype._all=function(c,_){for(var y=[];c;)c.leaf?_.push.apply(_,c.children):y.push.apply(y,c.children),c=y.pop();return _},o.prototype._build=function(c,_,y,x){var T,C=y-_+1,L=this._maxEntries;if(C<=L)return u(T=m(c.slice(_,y+1)),this.toBBox),T;x||(x=Math.ceil(Math.log(C)/Math.log(L)),L=Math.ceil(C/Math.pow(L,x-1))),(T=m([])).leaf=!1,T.height=x;var $=Math.ceil(C/L),D=$*Math.ceil(Math.sqrt(L));S(c,_,y,D,this.compareMinX);for(var B=_;B<=y;B+=D){var U=Math.min(B+D-1,y);S(c,B,U,$,this.compareMinY);for(var A=B;A<=U;A+=$){var z=Math.min(A+$-1,U);T.children.push(this._build(c,A,z,x-1))}}return u(T,this.toBBox),T},o.prototype._chooseSubtree=function(c,_,y,x){for(;x.push(_),!_.leaf&&x.length-1!==y;){for(var T=1/0,C=1/0,L=void 0,$=0;$<_.children.length;$++){var D=_.children[$],B=h(D),U=(A=c,z=D,(Math.max(z.maxX,A.maxX)-Math.min(z.minX,A.minX))*(Math.max(z.maxY,A.maxY)-Math.min(z.minY,A.minY))-B);U<C?(C=U,T=B<T?B:T,L=D):U===C&&B<T&&(T=B,L=D)}_=L||_.children[0]}var A,z;return _},o.prototype._insert=function(c,_,y){var x=y?c:this.toBBox(c),T=[],C=this._chooseSubtree(x,this.data,_,T);for(C.children.push(c),a(C,x);_>=0&&T[_].children.length>this._maxEntries;)this._split(T,_),_--;this._adjustParentBBoxes(x,T,_)},o.prototype._split=function(c,_){var y=c[_],x=y.children.length,T=this._minEntries;this._chooseSplitAxis(y,T,x);var C=this._chooseSplitIndex(y,T,x),L=m(y.children.splice(C,y.children.length-C));L.height=y.height,L.leaf=y.leaf,u(y,this.toBBox),u(L,this.toBBox),_?c[_-1].children.push(L):this._splitRoot(y,L)},o.prototype._splitRoot=function(c,_){this.data=m([c,_]),this.data.height=c.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(c,_,y){for(var x,T,C,L,$,D,B,U=1/0,A=1/0,z=_;z<=y-_;z++){var te=l(c,0,z,this.toBBox),pe=l(c,z,y,this.toBBox),G=(T=te,C=pe,L=void 0,$=void 0,D=void 0,B=void 0,L=Math.max(T.minX,C.minX),$=Math.max(T.minY,C.minY),D=Math.min(T.maxX,C.maxX),B=Math.min(T.maxY,C.maxY),Math.max(0,D-L)*Math.max(0,B-$)),le=h(te)+h(pe);G<U?(U=G,x=z,A=le<A?le:A):G===U&&le<A&&(A=le,x=z)}return x||y-_},o.prototype._chooseSplitAxis=function(c,_,y){var x=c.leaf?this.compareMinX:p,T=c.leaf?this.compareMinY:v;this._allDistMargin(c,_,y,x)<this._allDistMargin(c,_,y,T)&&c.children.sort(x)},o.prototype._allDistMargin=function(c,_,y,x){c.children.sort(x);for(var T=this.toBBox,C=l(c,0,_,T),L=l(c,y-_,y,T),$=f(C)+f(L),D=_;D<y-_;D++){var B=c.children[D];a(C,c.leaf?T(B):B),$+=f(C)}for(var U=y-_-1;U>=_;U--){var A=c.children[U];a(L,c.leaf?T(A):A),$+=f(L)}return $},o.prototype._adjustParentBBoxes=function(c,_,y){for(var x=y;x>=0;x--)a(_[x],c)},o.prototype._condense=function(c){for(var _=c.length-1,y=void 0;_>=0;_--)c[_].children.length===0?_>0?(y=c[_-1].children).splice(y.indexOf(c[_]),1):this.clear():u(c[_],this.toBBox)},o})})(fs);const cs=Bn(vi),ps=Bn(yi),hs=Bn(bi);var qe=Tn,Yr=cs,Hr=ps,ht=hs.default,ds=Hr.featureEach;Hr.coordEach;Yr.polygon;var kr=Yr.featureCollection;function Ur(r){var e=new qe(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ht(t),qe.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ht(i),n.push(i)}):ds(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ht(i),n.push(i)}),qe.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ht(t),qe.prototype.remove.call(this,t,n)},e.clear=function(){return qe.prototype.clear.call(this)},e.search=function(t){var n=qe.prototype.search.call(this,this.toBBox(t));return kr(n)},e.collides=function(t){return qe.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=qe.prototype.all.call(this);return kr(t)},e.toJSON=function(){return qe.prototype.toJSON.call(this)},e.fromJSON=function(t){return qe.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ht(t);else if(t.type==="FeatureCollection")n=ht(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}as.exports=Ur;bt.default=Ur;function Xr(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Hn(r)),e.type==="LineString"&&(e=Hn(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Sr(r,e);return i&&n.push(i),it(n)}var o=bt();return o.load(Rn(e)),Kt(Rn(r),function(s){Kt(o.search(s),function(u){var l=Sr(s,u);if(l){var a=Ye(l).join(",");t[a]||(t[a]=!0,n.push(l))}})}),it(n)}function Sr(r,e){var t=Ye(r),n=Ye(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],u=t[1][1],l=n[0][0],a=n[0][1],p=n[1][0],v=n[1][1],h=(v-a)*(s-i)-(p-l)*(u-o),f=(p-l)*(o-a)-(v-a)*(i-l),g=(s-i)*(o-a)-(u-o)*(i-l);if(h===0)return f===0&&g===0,null;var d=f/h,m=g/h;if(d>=0&&d<=1&&m>=0&&m<=1){var S=i+d*(s-i),c=o+d*(u-o);return vt([S,c])}return null}function Dt(r,e,t){t===void 0&&(t={});var n=vt([1/0,1/0],{dist:1/0}),i=0;return $n(r,function(o){for(var s=Ye(o),u=0;u<s.length-1;u++){var l=vt(s[u]);l.properties.dist=tt(e,l,t);var a=vt(s[u+1]);a.properties.dist=tt(e,a,t);var p=tt(l,a,t),v=Math.max(l.properties.dist,a.properties.dist),h=zr(l,a),f=wr(e,v,h+90,t),g=wr(e,v,h-90,t),d=Xr(yt([f.geometry.coordinates,g.geometry.coordinates]),yt([l.geometry.coordinates,a.geometry.coordinates])),m=null;d.features.length>0&&(m=d.features[0],m.properties.dist=tt(e,m,t),m.properties.location=i+tt(l,m,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=u,n.properties.location=i),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=u+1,n.properties.location=i+p),m&&m.properties.dist<n.properties.dist&&(n=m,n.properties.index=u),i+=p}}),n}const dt="edit-polygon-mode";class ms{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"points");oe(this,"cursor");oe(this,"hover");oe(this,"dragFrom");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new Gn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),at(e,dt,{type:"geojson",data:He()}),Re(e,{id:"edit-polygon-fill",source:dt,filter:fn,...ln("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Re(e,{id:"edit-polygon-lines",source:dt,filter:an,...$t("black",8,.5)}),Re(e,{id:"edit-polygon-vertices",source:dt,filter:un,...wt(me.hovering,cn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Mr(this.points).forEach((n,i)=>{t.push([i+1,Dt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(dt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=He();this.points.forEach((n,i)=>{let o=Er(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Mr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(dt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Er(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Er(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Mr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let W;const Ve=new Array(32).fill(void 0);Ve.push(void 0,null,!0,!1);function X(r){return Ve[r]}let Ft=Ve.length;function gs(r){r<36||(Ve[r]=Ft,Ft=r)}function Cn(r){const e=X(r);return gs(r),e}const Jr=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Jr.decode();let Xt=new Uint8Array;function Nt(){return Xt.byteLength===0&&(Xt=new Uint8Array(W.memory.buffer)),Xt}function gt(r,e){return Jr.decode(Nt().subarray(r,r+e))}function Se(r){Ft===Ve.length&&Ve.push(Ve.length+1);const e=Ft;return Ft=Ve[e],Ve[e]=r,e}function mn(r){return r==null}let Jt=new Float64Array;function _s(){return Jt.byteLength===0&&(Jt=new Float64Array(W.memory.buffer)),Jt}let Wt=new Int32Array;function Ee(){return Wt.byteLength===0&&(Wt=new Int32Array(W.memory.buffer)),Wt}let rt=0;const Vt=new TextEncoder("utf-8"),vs=typeof Vt.encodeInto=="function"?function(r,e){return Vt.encodeInto(r,e)}:function(r,e){const t=Vt.encode(r);return e.set(t),{read:r.length,written:t.length}};function Yt(r,e,t){if(t===void 0){const u=Vt.encode(r),l=e(u.length);return Nt().subarray(l,l+u.length).set(u),rt=u.length,l}let n=r.length,i=e(n);const o=Nt();let s=0;for(;s<n;s++){const u=r.charCodeAt(s);if(u>127)break;o[i+s]=u}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const u=Nt().subarray(i+s,i+n),l=vs(r,u);s+=l.written}return rt=s,i}function On(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=On(r[0]));for(let s=1;s<i;s++)o+=", "+On(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function ys(r,e){const t=e(r.length*1);return Nt().set(r,t/1),rt=r.length,t}function gn(r,e){try{return r.apply(this,e)}catch(t){W.__wbindgen_exn_store(Se(t))}}class nn{static __wrap(e){const t=Object.create(nn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();W.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=W.__wbindgen_add_to_stack_pointer(-16),s=ys(e,W.__wbindgen_malloc),u=rt;W.jsroutesnapper_new(o,s,u);var t=Ee()[o/4+0],n=Ee()[o/4+1],i=Ee()[o/4+2];if(i)throw Cn(n);return nn.__wrap(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){W.jsroutesnapper_setConfig(this.ptr,Se(e))}toFinalFeature(){try{const n=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_toFinalFeature(n,this.ptr);var e=Ee()[n/4+0],t=Ee()[n/4+1];let i;return e!==0&&(i=gt(e,t).slice(),W.__wbindgen_free(e,t*1)),i}finally{W.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_renderGeojson(n,this.ptr);var e=Ee()[n/4+0],t=Ee()[n/4+1];return gt(e,t)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,t)}}setSnapMode(e){W.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return W.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){W.jsroutesnapper_onClick(this.ptr)}onDragStart(){return W.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return W.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){W.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_editExisting(i,this.ptr,Se(e));var t=Ee()[i/4+0],n=Ee()[i/4+1];if(n)throw Cn(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}}async function bs(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function ws(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Cn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=X(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(gt(e,t));return Se(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=gt(e,t);return Se(n)},r.wbg.__wbindgen_is_object=function(e){const t=X(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return X(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return X(e)in X(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=X(t),i=typeof n=="number"?n:void 0;_s()[e/8+1]=mn(i)?0:i,Ee()[e/4+0]=!mn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return X(e)==X(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=X(t),i=typeof n=="string"?n:void 0;var o=mn(i)?0:Yt(i,W.__wbindgen_malloc,W.__wbindgen_realloc),s=rt;Ee()[e/4+1]=s,Ee()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(X(t)),i=Yt(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=rt;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=X(e);return Se(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=X(e)[X(t)];return Se(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(X(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(X(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(X(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(X(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(X(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=X(e)[t>>>0];return Se(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return X(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof X(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=X(e).next;return Se(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return gn(function(e){const t=X(e).next();return Se(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return X(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=X(e).value;return Se(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return Se(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return gn(function(e,t){const n=Reflect.get(X(e),X(t));return Se(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return gn(function(e,t){const n=X(e).call(X(t));return Se(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(X(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=X(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=X(e).buffer;return Se(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(X(e));return Se(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){X(e).set(X(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return X(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=X(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Se(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=X(t).stack,i=Yt(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=rt;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(gt(e,t))}finally{W.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=On(X(t)),i=Yt(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=rt;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(gt(e,t))},r.wbg.__wbindgen_memory=function(){const e=W.memory;return Se(e)},r}function ks(r,e){return W=r.exports,Wr.__wbindgen_wasm_module=e,Jt=new Float64Array,Wt=new Int32Array,Xt=new Uint8Array,W}async function Wr(r){typeof r>"u"&&(r="/atip/schemas/assets/route_snapper_bg.wasm");const e=ws();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await bs(await r,e);return ks(t,n)}const Rt="route-snapper",xr=10,Ss=30;class Es{constructor(e,t){oe(this,"map");oe(this,"inner");oe(this,"active");oe(this,"eventListenersSuccessRoute");oe(this,"eventListenersSuccessArea");oe(this,"eventListenersFailure");oe(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new nn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],at(e,Rt,{type:"geojson",data:He()}),Re(e,{id:"route-points",source:Rt,filter:un,...wt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",xr/2,xr])}),Re(e,{id:"route-lines",source:Rt,filter:an,...$t("black",2.5)}),Re(e,{id:"route-polygons",source:Rt,filter:fn,...ln("black",.5)}),this.events=new Gn(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Ss,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Rt).setData(JSON.parse(this.inner.renderGeojson()))}}function Lr(r){let e;function t(o,s){return o[1]?xs:Ms}let n=t(r),i=n(r);return{c(){i.c(),e=Ae()},m(o,s){i.m(o,s),b(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&w(e)}}}function Ms(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function xs(r){let e;return{c(){e=k("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function Ls(r){let e,t=r[0]==_t&&Lr(r);return{c(){t&&t.c(),e=Ae()},m(n,i){t&&t.m(n,i),b(n,e,i)},p(n,[i]){n[0]==_t?t?t.p(n,i):(t=Lr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:J,o:J,d(n){t&&t.d(n),n&&w(e)}}}const _t="edit-attribute";function Vr(){}function Rs(r,e,t){let n,i,o,s;ce(r,Ue,f=>t(5,n=f)),ce(r,se,f=>t(6,i=f)),ce(r,bn,f=>t(7,o=f)),ce(r,Oe,f=>t(1,s=f));let{mode:u}=e,{changeMode:l}=e;function a(){Oe.set(null)}n.on("mousemove",p),n.on("mouseout",v),n.on("click",h),Gt(()=>{n.off("mousemove",p),n.off("mouseout",v),n.off("click",h)});function p(f){var g;if(u==_t){let d=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ke.set(((g=d[0])==null?void 0:g.id)||null)}}function v(){u==_t&&Ke.set(null)}function h(f){if(u==_t){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0?Oe.set(g[0].id):Oe.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,u=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let g=i.features.find(d=>d.id==f);g.geometry.type=="Point"?n.flyTo({center:g.geometry.coordinates,duration:500}):n.fitBounds(Nn(g),{padding:200,duration:500}),l(_t)}}},[u,s,l,Vr,a,n,i,o]}class Ts extends re{constructor(e){super(),ie(this,e,Rs,Ls,ne,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Vr}get stop(){return this.$$.ctx[4]}}function Cs(r){let e,t;return{c:J,m(n,i){e||(t=q(window,"keydown",r[0]),e=!0)},p:J,i:J,o:J,d(n){e=!1,t()}}}function Os(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class pn extends re{constructor(e){super(),ie(this,e,Os,Cs,ne,{tool:1})}}function As(r){let e;return{c(){e=k("p"),e.textContent="Click to add a new point"},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function Ps(r){let e;return{c(){e=k("p"),e.textContent="Click to move the point here"},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function Fs(r){let e,t,n,i,o,s,u,l,a;function p(f,g){return f[1]?Ps:As}let v=p(r),h=v(r);return s=new pn({props:{tool:r[0]}}),{c(){h.c(),e=R(),t=k("p"),t.innerHTML="Press <b>Escape</b> to cancel",n=R(),i=k("button"),i.textContent="Cancel",o=R(),K(s.$$.fragment),O(i,"type","button")},m(f,g){h.m(f,g),b(f,e,g),b(f,t,g),b(f,n,g),b(f,i,g),b(f,o,g),Z(s,f,g),u=!0,l||(a=q(i,"click",r[2]),l=!0)},p(f,[g]){v!==(v=p(f))&&(h.d(1),h=v(f),h&&(h.c(),h.m(e.parentNode,e)));const d={};g&1&&(d.tool=f[0]),s.$set(d)},i(f){u||(P(s.$$.fragment,f),u=!0)},o(f){I(s.$$.fragment,f),u=!1},d(f){h.d(f),f&&w(e),f&&w(t),f&&w(n),f&&w(i),f&&w(o),Q(s,f),l=!1,a()}}}function Ns(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Kr extends re{constructor(e){super(),ie(this,e,Ns,Fs,ne,{pointTool:0,editingExisting:1})}}function Is(r){let e,t,n,i,o,s,u,l,a,p,v;return l=new pn({props:{tool:r[0]}}),{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
  <li><b>Click</b> a vertex to delete it</li> 
  <li><b>Drag</b> a vertex or the polygon to move it</li> 
  <li>Press <b>Enter</b> to finish</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=R(),n=k("div"),i=k("button"),i.textContent="Finish",o=R(),s=k("button"),s.textContent="Cancel",u=R(),K(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),ge(n,"display","flex"),ge(n,"justify-content","space-between")},m(h,f){b(h,e,f),b(h,t,f),b(h,n,f),E(n,i),E(n,o),E(n,s),b(h,u,f),Z(l,h,f),a=!0,p||(v=[q(i,"click",r[1]),q(s,"click",r[2])],p=!0)},p(h,[f]){const g={};f&1&&(g.tool=h[0]),l.$set(g)},i(h){a||(P(l.$$.fragment,h),a=!0)},o(h){I(l.$$.fragment,h),a=!1},d(h){h&&w(e),h&&w(t),h&&w(n),h&&w(u),Q(l,h),p=!1,je(v)}}}function $s(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Zr extends re{constructor(e){super(),ie(this,e,$s,Is,ne,{polygonTool:0})}}function Bs(r){let e,t,n,i,o,s,u,l,a,p,v;return l=new pn({props:{tool:r[0]}}),{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish area</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=R(),n=k("div"),i=k("button"),i.textContent="Finish",o=R(),s=k("button"),s.textContent="Cancel",u=R(),K(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),ge(n,"display","flex"),ge(n,"justify-content","space-between")},m(h,f){b(h,e,f),b(h,t,f),b(h,n,f),E(n,i),E(n,o),E(n,s),b(h,u,f),Z(l,h,f),a=!0,p||(v=[q(i,"click",r[1]),q(s,"click",r[2])],p=!0)},p(h,[f]){const g={};f&1&&(g.tool=h[0]),l.$set(g)},i(h){a||(P(l.$$.fragment,h),a=!0)},o(h){I(l.$$.fragment,h),a=!1},d(h){h&&w(e),h&&w(t),h&&w(n),h&&w(u),Q(l,h),p=!1,je(v)}}}function Ds(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Qr extends re{constructor(e){super(),ie(this,e,Ds,Bs,ne,{routeTool:0})}}function Gs(r){let e,t,n,i,o,s,u,l,a,p,v,h,f,g,d;return h=new pn({props:{tool:r[0]}}),{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
  <li>Hold <b>Shift</b> to draw a point anywhere</li> 
  <li><b>Click and drag</b> any point to move it</li> 
  <li><b>Click</b> a red waypoint to delete it</li> 
  <li>Press <b>Enter</b> to finish route</li> 
  <li>Press <b>Escape</b> to cancel</li>`,t=R(),n=k("label"),i=k("input"),o=H(`
  Avoid doubling back`),s=R(),u=k("div"),l=k("button"),l.textContent="Finish",a=R(),p=k("button"),p.textContent="Cancel",v=R(),K(h.$$.fragment),O(i,"type","checkbox"),O(l,"type","button"),O(p,"type","button"),ge(u,"display","flex"),ge(u,"justify-content","space-between")},m(m,S){b(m,e,S),b(m,t,S),b(m,n,S),E(n,i),i.checked=r[1],E(n,o),b(m,s,S),b(m,u,S),E(u,l),E(u,a),E(u,p),b(m,v,S),Z(h,m,S),f=!0,g||(d=[q(i,"change",r[2]),q(l,"click",r[3]),q(p,"click",r[4])],g=!0)},p(m,[S]){S&2&&(i.checked=m[1]);const c={};S&1&&(c.tool=m[0]),h.$set(c)},i(m){f||(P(h.$$.fragment,m),f=!0)},o(m){I(h.$$.fragment,m),f=!1},d(m){m&&w(e),m&&w(t),m&&w(n),m&&w(s),m&&w(u),m&&w(v),Q(h,m),g=!1,je(d)}}}function js(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),u=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,u]}class ei extends re{constructor(e){super(),ie(this,e,js,Gs,ne,{routeTool:0})}}function Rr(r){let e,t,n,i;const o=[Us,Hs,Ys,zs,qs],s=[];function u(l,a){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=u(r),t=s[e]=o[e](r),{c(){t.c(),n=Ae()},m(l,a){s[e].m(l,a),b(l,n,a),i=!0},p(l,a){let p=e;e=u(l),e===p?s[e].p(l,a):(Ne(),I(s[p],1,1,()=>{s[p]=null}),Ie(),t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),P(t,1),t.m(n.parentNode,n))},i(l){i||(P(t),i=!0)},o(l){I(t),i=!1},d(l){s[e].d(l),l&&w(n)}}}function qs(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){b(t,e,n)},p:J,i:J,o:J,d(t){t&&w(e)}}}function zs(r){let e,t;return e=new ei({props:{routeTool:r[3]}}),{c(){K(e.$$.fragment)},m(n,i){Z(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){I(e.$$.fragment,n),t=!1},d(n){Q(e,n)}}}function Ys(r){let e,t;return e=new Qr({props:{routeTool:r[3]}}),{c(){K(e.$$.fragment)},m(n,i){Z(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){I(e.$$.fragment,n),t=!1},d(n){Q(e,n)}}}function Hs(r){let e,t;return e=new Zr({props:{polygonTool:r[2]}}),{c(){K(e.$$.fragment)},m(n,i){Z(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){I(e.$$.fragment,n),t=!1},d(n){Q(e,n)}}}function Us(r){let e,t;return e=new Kr({props:{pointTool:r[1],editingExisting:!0}}),{c(){K(e.$$.fragment)},m(n,i){Z(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){I(e.$$.fragment,n),t=!1},d(n){Q(e,n)}}}function Xs(r){let e,t,n=r[0]==We&&Rr(r);return{c(){n&&n.c(),e=Ae()},m(i,o){n&&n.m(i,o),b(i,e,o),t=!0},p(i,[o]){i[0]==We?n?(n.p(i,o),o&1&&P(n,1)):(n=Rr(i),n.c(),P(n,1),n.m(e.parentNode,e)):n&&(Ne(),I(n,1,1,()=>{n=null}),Ie())},i(i){t||(P(n),t=!0)},o(i){I(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const We="edit-geometry";function ti(){}function Js(r,e,t){let n;ce(r,Ue,d=>t(8,n=d));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:u}=e,l=null,a=null;function p(){l&&(o.stop(),s.stop(),u.stop(),se.update(d=>{let m=d.features.find(S=>S.id==l);return delete m.properties.hide_while_editing,d})),l=null,t(4,a=null),Ke.set(null)}n.on("mousemove",v),n.on("mouseout",h),n.on("click",f),Gt(()=>{n.off("mousemove",v),n.off("mouseout",h),n.off("click",f)}),u.addEventListenerSuccessRoute(d=>{i==We&&(se.update(m=>{let S=m.features.find(c=>c.id==l);return S.properties.length_meters=d.properties.length_meters,S.properties.waypoints=d.properties.waypoints,delete S.properties.hide_while_editing,S.geometry=d.geometry,m}),l=null,t(4,a=null))}),u.addEventListenerSuccessArea(d=>{i==We&&(se.update(m=>{let S=m.features.find(c=>c.id==l);return S.properties.waypoints=d.properties.waypoints,delete S.properties.hide_while_editing,S.geometry=d.geometry,m}),l=null,t(4,a=null))});for(let d of[o,s])d.addEventListenerSuccess(m=>{i==We&&(se.update(S=>{let c=S.features.find(_=>_.id==l);return c.geometry=m.geometry,delete c.properties.hide_while_editing,S}),l=null,t(4,a=null))});for(let d of[o,s,u])d.addEventListenerFailure(()=>{i==We&&(se.update(m=>{let S=m.features.find(c=>c.id==l);return delete S.properties.hide_while_editing,m}),l=null,t(4,a=null))});function v(d){var m;if(i==We&&l==null){let S=n.queryRenderedFeatures(d.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ke.set(((m=S[0])==null?void 0:m.id)||null)}}function h(){i==We&&l==null&&Ke.set(null)}function f(d){if(i==We&&l==null){let m=n.queryRenderedFeatures(d.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0&&g(m[0].id)}}function g(d){Ke.set(null);let m=null;se.update(c=>(m=c.features.find(_=>_.id==d),m.properties.hide_while_editing=!0,c));let S=m;l=d,S.geometry.type=="LineString"?(u.editExistingRoute(S),t(4,a="route")):S.geometry.type=="Polygon"?S.properties.waypoints?(u.editExistingArea(S),t(4,a="snap-polygon")):(s.editExisting(S),t(4,a="free-polygon")):S.geometry.type=="Point"&&(o.start(),t(4,a="point"))}return r.$$set=d=>{"mode"in d&&t(0,i=d.mode),"pointTool"in d&&t(1,o=d.pointTool),"polygonTool"in d&&t(2,s=d.polygonTool),"routeTool"in d&&t(3,u=d.routeTool)},[i,o,s,u,a,ti,p]}class Ws extends re{constructor(e){super(),ie(this,e,Js,Xs,ne,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return ti}get stop(){return this.$$.ctx[6]}}async function Vs(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:a,value:p}=await n.read();if(a)break;s.push(p),o+=p.length;const v=100*o/i;e.style=`background: linear-gradient(to right, red ${v}%, transparent 0);`}let u=new Uint8Array(o),l=0;for(let a of s)u.set(a,l),l+=a.length;return u}function Ks(r){let e,t;return e=new ei({props:{routeTool:r[0]}}),{c(){K(e.$$.fragment)},m(n,i){Z(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){I(e.$$.fragment,n),t=!1},d(n){Q(e,n)}}}function Zs(r){let e;return{c(){e=k("div"),e.textContent="Route tool loading..."},m(t,n){b(t,e,n),r[7](e)},p:J,i:J,o:J,d(t){t&&w(e),r[7](null)}}}function Qs(r){let e,t,n,i;const o=[Zs,Ks],s=[];function u(l,a){return l[0]?l[1]==An?1:-1:0}return~(e=u(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=Ae()},m(l,a){~e&&s[e].m(l,a),b(l,n,a),i=!0},p(l,[a]){let p=e;e=u(l),e===p?~e&&s[e].p(l,a):(t&&(Ne(),I(s[p],1,1,()=>{s[p]=null}),Ie()),~e?(t=s[e],t?t.p(l,a):(t=s[e]=o[e](l),t.c()),P(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(P(t),i=!0)},o(l){I(t),i=!1},d(l){~e&&s[e].d(l),l&&w(n)}}}const An="route";function el(r,e,t){let n;ce(r,Ue,h=>t(8,n=h));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,u,{routeTool:l}=e;function a(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}Fn(async()=>{await Wr(),console.log(`Grabbing ${s}`);try{const h=await Vs(s,u);t(0,l=new Es(n,h))}catch(h){console.log(`Route tool broke: ${h}`),t(2,u.innerHTML="Failed to load",u);return}l.addEventListenerFailure(()=>{i==An&&o("edit-attribute")}),l.addEventListenerSuccessRoute(h=>{i==An&&(se.update(f=>(h.id=jt(f),h.properties.intervention_type="route",f.features.push(h),f)),o("edit-attribute"),Oe.set(h.id))})});function v(h){be[h?"unshift":"push"](()=>{u=h,t(2,u)})}return r.$$set=h=>{"mode"in h&&t(1,i=h.mode),"changeMode"in h&&t(3,o=h.changeMode),"url"in h&&t(4,s=h.url),"routeTool"in h&&t(0,l=h.routeTool)},[l,i,u,o,s,a,p,v]}class tl extends re{constructor(e){super(),ie(this,e,el,Qs,ne,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Tr(r){let e,t;return e=new Kr({props:{pointTool:r[1],editingExisting:!1}}),{c(){K(e.$$.fragment)},m(n,i){Z(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){I(e.$$.fragment,n),t=!1},d(n){Q(e,n)}}}function nl(r){let e,t,n=r[0]==rn&&Tr(r);return{c(){n&&n.c(),e=Ae()},m(i,o){n&&n.m(i,o),b(i,e,o),t=!0},p(i,[o]){i[0]==rn?n?(n.p(i,o),o&1&&P(n,1)):(n=Tr(i),n.c(),P(n,1),n.m(e.parentNode,e)):n&&(Ne(),I(n,1,1,()=>{n=null}),Ie())},i(i){t||(P(n),t=!0)},o(i){I(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const rn="point";function rl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==rn&&(se.update(a=>(l.id=jt(a),l.properties.intervention_type="other",a.features.push(l),a)),i("edit-attribute"),Oe.set(l.id))}),o.addEventListenerFailure(()=>{n==rn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,u]}class il extends re{constructor(e){super(),ie(this,e,rl,nl,ne,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Cr(r){let e,t;return e=new Zr({props:{polygonTool:r[1]}}),{c(){K(e.$$.fragment)},m(n,i){Z(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){I(e.$$.fragment,n),t=!1},d(n){Q(e,n)}}}function ol(r){let e,t,n=r[0]==on&&Cr(r);return{c(){n&&n.c(),e=Ae()},m(i,o){n&&n.m(i,o),b(i,e,o),t=!0},p(i,[o]){i[0]==on?n?(n.p(i,o),o&1&&P(n,1)):(n=Cr(i),n.c(),P(n,1),n.m(e.parentNode,e)):n&&(Ne(),I(n,1,1,()=>{n=null}),Ie())},i(i){t||(P(n),t=!0)},o(i){I(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const on="free-polygon";function sl(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function u(){o.stop()}return o.addEventListenerSuccess(l=>{n==on&&(se.update(a=>(l.id=jt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),Oe.set(l.id))}),o.addEventListenerFailure(()=>{n==on&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,u]}class ll extends re{constructor(e){super(),ie(this,e,sl,ol,ne,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Or(r){let e,t;return e=new Qr({props:{routeTool:r[1]}}),{c(){K(e.$$.fragment)},m(n,i){Z(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){I(e.$$.fragment,n),t=!1},d(n){Q(e,n)}}}function ul(r){let e,t,n=r[0]==sn&&Or(r);return{c(){n&&n.c(),e=Ae()},m(i,o){n&&n.m(i,o),b(i,e,o),t=!0},p(i,[o]){i[0]==sn?n?(n.p(i,o),o&1&&P(n,1)):(n=Or(i),n.c(),P(n,1),n.m(e.parentNode,e)):n&&(Ne(),I(n,1,1,()=>{n=null}),Ie())},i(i){t||(P(n),t=!0)},o(i){I(n),t=!1},d(i){n&&n.d(i),i&&w(e)}}}const sn="snap-polygon";function al(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function u(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==sn&&(se.update(a=>(l.id=jt(a),l.properties.intervention_type="area",a.features.push(l),a)),i("edit-attribute"),Oe.set(l.id))}),o.addEventListenerFailure(()=>{n==sn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,u]}class fl extends re{constructor(e){super(),ie(this,e,al,ul,ne,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function cl(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=tt(r.slice(0,2),[n,t]),s=tt(r.slice(0,2),[e,i]);if(o>=s){var u=(t+i)/2;return[e,u-(n-e)/2,n,u+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function pl(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return wi(r,function(s){hl(s,o,n)}),r}function hl(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function dl(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Ln(r),n=Ln(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=pl(e,{precision:7});switch(n){case"Point":return Pn(r,i);case"MultiPoint":return Ar(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Ar(r,Xr(r,i))}}function Ar(r,e){var t=[],n=bt();return $n(e,function(i){if(t.forEach(function(u,l){u.id=l}),!t.length)t=Pn(r,i).features,t.forEach(function(u){u.bbox||(u.bbox=cl(ki(u)))}),n.load(it(t));else{var o=n.search(i);if(o.features.length){var s=ni(i,o);t=t.filter(function(u){return u.id!==s.id}),n.remove(s),Kt(Pn(s,i),function(u){t.push(u),n.insert(u)})}}}),it(t)}function Pn(r,e){var t=[],n=Ye(r)[0],i=Ye(r)[r.geometry.coordinates.length-1];if(_n(n,ot(e))||_n(i,ot(e)))return it([r]);var o=bt(),s=Rn(r);o.load(s);var u=o.search(e);if(!u.features.length)return it([r]);var l=ni(e,u),a=[n],p=Si(s,function(v,h,f){var g=Ye(h)[1],d=ot(e);return f===l.id?(v.push(d),t.push(yt(v)),_n(d,g)?[d]:[d,g]):(v.push(g),v)},a);return p.length>1&&t.push(yt(p)),it(t)}function ni(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return Kt(e,function(i){var o=Dt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function _n(r,e){return r[0]===e[0]&&r[1]===e[1]}function ml(r,e,t){var n=Ye(t);if(Ln(t)!=="LineString")throw new Error("line must be a LineString");var i=Dt(t,r),o=Dt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var u=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)u.push(n[l]);return u.push(s[1].geometry.coordinates),yt(u,t.properties)}function Pr(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){b(t,e,n)},d(t){t&&w(e)}}}function gl(r){let e,t,n,i=r[0]==It&&Pr();return{c(){i&&i.c(),e=Ae()},m(o,s){i&&i.m(o,s),b(o,e,s),t||(n=q(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==It?i||(i=Pr(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:J,o:J,d(o){i&&i.d(o),o&&w(e),t=!1,n()}}}const It="split-route",_l=10,vl=30;let vn="split-route";function ri(){}function Fr(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function yl(r,e,t){let n,i;ce(r,se,d=>t(8,n=d)),ce(r,Ue,d=>t(6,i=d));let{mode:o}=e,{changeMode:s}=e;function u(){t(5,l=null),a=null}let l=null,a=null;i.on("mousemove",p),i.on("click",v),Gt(()=>{i.off("mousemove",p),i.off("click",v)}),at(i,vn,{type:"geojson",data:He()}),Re(i,{id:"draw-split-route",source:vn,...wt("black",_l,["case",["==",["get","snapped"],!0],1,.5])});function p(d){if(o!=It)return;t(5,l=Fr(d.lngLat.toArray(),!1)),a=null;const m=[d.point.x-vl,d.point.y],S=i.unproject(d.point).distanceTo(i.unproject(m))/1e3;let c=[];for(let[_,y]of n.features.entries())if(y.geometry.type=="LineString"){let x=Dt(y.geometry,l,{units:"kilometers"});x.properties.dist!=null&&x.properties.dist<=S&&c.push([_,x.geometry.coordinates,x.properties.dist])}c.sort((_,y)=>_[2]-y[2]),c.length>0&&(t(5,l=Fr(c[0][1],!0)),a=c[0][0])}function v(){if(o==It)if(a==null)s("edit-attribute");else{let d=dl(n.features[a],l);if(d.features.length==2){let m=d.features[0],S=d.features[1];se.update(c=>(m.id=c.features[a].id,S.id=jt(c),m.properties=JSON.parse(JSON.stringify(c.features[a].properties)),S.properties=JSON.parse(JSON.stringify(m.properties)),h(c.features[a],m,S,l),c.features.splice(a,1,m,S),c))}u()}}function h(d,m,S,c){m.properties.length_meters=Ut(m,{units:"kilometers"})*1e3,S.properties.length_meters=Ut(S,{units:"kilometers"})*1e3,m.properties.waypoints=[],S.properties.waypoints=[];let _=f(d,c),y=!0,x=0;for(let T of d.properties.waypoints){let C=f(d,vt([T.lon,T.lat]));if(y)if(C<_)m.properties.waypoints.push(T);else{let L=T.snapped&&d.properties.waypoints[x-1].snapped;m.properties.waypoints.push({lon:c.geometry.coordinates[0],lat:c.geometry.coordinates[1],snapped:L}),y=!1,S.properties.waypoints.push({lon:c.geometry.coordinates[0],lat:c.geometry.coordinates[1],snapped:L}),S.properties.waypoints.push(T)}else S.properties.waypoints.push(T);x++}}function f(d,m){let S=d.geometry.coordinates[0],c=ml(S,m,d);return Ut(c,{units:"kilometers"})*1e3}function g(d){o==It&&d.key=="Escape"&&(s("edit-attribute"),d.preventDefault())}return r.$$set=d=>{"mode"in d&&t(0,o=d.mode),"changeMode"in d&&t(2,s=d.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let d=He();l&&d.features.push(l),i.getSource(vn).setData(d)}},[o,g,s,ri,u,l,i]}class bl extends re{constructor(e){super(),ie(this,e,yl,gl,ne,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ri}get stop(){return this.$$.ctx[4]}}function Nr(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new Ws({props:n}),r[17](e),{c(){K(e.$$.fragment)},m(i,o){Z(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){I(e.$$.fragment,i),t=!1},d(i){r[17](null),Q(e,i)}}}function Ir(r){let e,t,n,i,o;return{c(){e=k("button"),t=H("New point"),O(e,"type","button"),e.disabled=n=r[3]=="point",O(e,"class","svelte-cej5os")},m(s,u){b(s,e,u),E(e,t),i||(o=q(e,"click",r[18]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function $r(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new fl({props:n}),r[23](e),{c(){K(e.$$.fragment)},m(i,o){Z(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){I(e.$$.fragment,i),t=!1},d(i){r[23](null),Q(e,i)}}}function Br(r){let e,t,n,i,o;return{c(){e=k("button"),t=H("New route"),O(e,"type","button"),e.disabled=n=r[3]=="route",O(e,"class","svelte-cej5os")},m(s,u){b(s,e,u),E(e,t),i||(o=q(e,"click",r[24]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function Dr(r){let e,t,n,i,o;return{c(){e=k("button"),t=H("Split route"),O(e,"type","button"),e.disabled=n=r[3]=="split-route",O(e,"class","svelte-cej5os")},m(s,u){b(s,e,u),E(e,t),i||(o=q(e,"click",r[27]),i=!0)},p(s,u){u&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&w(e),i=!1,o()}}}function wl(r){let e,t,n,i,o,s,u,l,a,p,v,h,f,g,d,m,S,c,_,y,x,T,C,L,$,D,B,U,A,z,te,pe,G,le,we,Te,he,ae,Me,ue,F,V,St={mode:r[3],changeMode:r[13]};u=new Ts({props:St}),r[15](u);let de=r[2]&&Nr(r),ke=r[1]!="planning"&&Ir(r),Et={mode:r[3],changeMode:r[13],pointTool:r[11]};S=new il({props:Et}),r[19](S);let lt={mode:r[3],changeMode:r[13],polygonTool:r[12]};L=new ll({props:lt}),r[21](L);let _e=r[2]&&$r(r),fe=r[1]!="planning"&&Br(r);function Mt(j){r[26](j)}let xt={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(xt.routeTool=r[2]),le=new tl({props:xt}),r[25](le),be.push(()=>Ze(le,"routeTool",Mt,r[2]));let ve=r[1]!="planning"&&Dr(r),Le={mode:r[3],changeMode:r[13]};return Me=new bl({props:Le}),r[28](Me),{c(){e=k("div"),t=k("div"),n=k("button"),i=H("Edit attributes"),s=R(),K(u.$$.fragment),l=R(),a=k("div"),p=k("button"),v=H("Edit geometry"),f=R(),de&&de.c(),g=R(),d=k("div"),ke&&ke.c(),m=R(),K(S.$$.fragment),c=R(),_=k("div"),y=k("button"),x=H("New polygon (freehand)"),C=R(),K(L.$$.fragment),$=R(),D=k("div"),B=k("button"),U=H("New polygon (snapped)"),z=R(),_e&&_e.c(),te=R(),pe=k("div"),fe&&fe.c(),G=R(),K(le.$$.fragment),Te=R(),he=k("div"),ve&&ve.c(),ae=R(),K(Me.$$.fragment),O(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",O(n,"class","svelte-cej5os"),O(p,"type","button"),p.disabled=h=r[3]=="edit-geometry",O(p,"class","svelte-cej5os"),O(y,"type","button"),y.disabled=T=r[3]=="free-polygon",O(y,"class","svelte-cej5os"),O(B,"type","button"),B.disabled=A=r[3]=="snap-polygon",O(B,"class","svelte-cej5os"),O(e,"class","toolbox svelte-cej5os")},m(j,ee){b(j,e,ee),E(e,t),E(t,n),E(n,i),E(t,s),Z(u,t,null),E(e,l),E(e,a),E(a,p),E(p,v),E(a,f),de&&de.m(a,null),E(e,g),E(e,d),ke&&ke.m(d,null),E(d,m),Z(S,d,null),E(e,c),E(e,_),E(_,y),E(y,x),E(_,C),Z(L,_,null),E(e,$),E(e,D),E(D,B),E(B,U),E(D,z),_e&&_e.m(D,null),E(e,te),E(e,pe),fe&&fe.m(pe,null),E(pe,G),Z(le,pe,null),E(e,Te),E(e,he),ve&&ve.m(he,null),E(he,ae),Z(Me,he,null),ue=!0,F||(V=[q(n,"click",r[14]),q(p,"click",r[16]),q(y,"click",r[20]),q(B,"click",r[22])],F=!0)},p(j,[ee]){(!ue||ee&8&&o!==(o=j[3]=="edit-attribute"))&&(n.disabled=o);const Xe={};ee&8&&(Xe.mode=j[3]),u.$set(Xe),(!ue||ee&8&&h!==(h=j[3]=="edit-geometry"))&&(p.disabled=h),j[2]?de?(de.p(j,ee),ee&4&&P(de,1)):(de=Nr(j),de.c(),P(de,1),de.m(a,null)):de&&(Ne(),I(de,1,1,()=>{de=null}),Ie()),j[1]!="planning"?ke?ke.p(j,ee):(ke=Ir(j),ke.c(),ke.m(d,m)):ke&&(ke.d(1),ke=null);const xe={};ee&8&&(xe.mode=j[3]),S.$set(xe),(!ue||ee&8&&T!==(T=j[3]=="free-polygon"))&&(y.disabled=T);const Je={};ee&8&&(Je.mode=j[3]),L.$set(Je),(!ue||ee&8&&A!==(A=j[3]=="snap-polygon"))&&(B.disabled=A),j[2]?_e?(_e.p(j,ee),ee&4&&P(_e,1)):(_e=$r(j),_e.c(),P(_e,1),_e.m(D,null)):_e&&(Ne(),I(_e,1,1,()=>{_e=null}),Ie()),j[1]!="planning"?fe?fe.p(j,ee):(fe=Br(j),fe.c(),fe.m(pe,G)):fe&&(fe.d(1),fe=null);const ye={};ee&8&&(ye.mode=j[3]),ee&1&&(ye.url=j[0]),!we&&ee&4&&(we=!0,ye.routeTool=j[2],Qe(()=>we=!1)),le.$set(ye),j[1]!="planning"?ve?ve.p(j,ee):(ve=Dr(j),ve.c(),ve.m(he,ae)):ve&&(ve.d(1),ve=null);const M={};ee&8&&(M.mode=j[3]),Me.$set(M)},i(j){ue||(P(u.$$.fragment,j),P(de),P(S.$$.fragment,j),P(L.$$.fragment,j),P(_e),P(le.$$.fragment,j),P(Me.$$.fragment,j),ue=!0)},o(j){I(u.$$.fragment,j),I(de),I(S.$$.fragment,j),I(L.$$.fragment,j),I(_e),I(le.$$.fragment,j),I(Me.$$.fragment,j),ue=!1},d(j){j&&w(e),r[15](null),Q(u),de&&de.d(),ke&&ke.d(),r[19](null),Q(S),r[21](null),Q(L),_e&&_e.d(),fe&&fe.d(),r[25](null),Q(le),ve&&ve.d(),r[28](null),Q(Me),F=!1,je(V)}}}function kl(r,e,t){let n;ce(r,Ue,G=>t(29,n=G));let{routeUrl:i}=e,{schema:o}=e,s,u=new rs(n),l=new ms(n),a="edit-attribute",p,v,h,f,g,d,m;function S(G){let le={"edit-attribute":p,"edit-geometry":v,route:h,point:f,"free-polygon":g,"snap-polygon":d,"split-route":m};if(a==G){console.log(`Mode is already ${a}, not changing`);return}console.log(`Stopping old mode ${a}`),le[a].stop(),t(3,a=G),console.log(`Starting new mode ${a}`),le[a].start()}Gt(()=>{u==null||u.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const c=()=>S("edit-attribute");function _(G){be[G?"unshift":"push"](()=>{p=G,t(4,p)})}const y=()=>S("edit-geometry");function x(G){be[G?"unshift":"push"](()=>{v=G,t(5,v)})}const T=()=>S("point");function C(G){be[G?"unshift":"push"](()=>{f=G,t(7,f)})}const L=()=>S("free-polygon");function $(G){be[G?"unshift":"push"](()=>{g=G,t(8,g)})}const D=()=>S("snap-polygon");function B(G){be[G?"unshift":"push"](()=>{d=G,t(9,d)})}const U=()=>S("route");function A(G){be[G?"unshift":"push"](()=>{h=G,t(6,h)})}function z(G){s=G,t(2,s)}const te=()=>S("split-route");function pe(G){be[G?"unshift":"push"](()=>{m=G,t(10,m)})}return r.$$set=G=>{"routeUrl"in G&&t(0,i=G.routeUrl),"schema"in G&&t(1,o=G.schema)},[i,o,s,a,p,v,h,f,g,d,m,u,l,S,c,_,y,x,T,C,L,$,D,B,U,A,z,te,pe]}class Sl extends re{constructor(e){super(),ie(this,e,kl,wl,ne,{routeUrl:0,schema:1})}}function El(r){let e,t,n,i,o,s,u,l,a,p,v,h,f,g,d,m,S,c;return{c(){e=k("div"),t=k("div"),n=k("button"),n.textContent="Home",i=R(),o=k("button"),o.textContent="About",s=R(),u=k("button"),u.textContent="Instructions",l=R(),a=k("br"),p=R(),v=k("label"),h=H(`ATIP schema:
      `),f=k("select"),g=k("option"),g.textContent="Design (v1)",d=k("option"),d.textContent="Design (v2)",m=k("option"),m.textContent="Planning",O(n,"type","button"),O(o,"type","button"),O(u,"type","button"),g.__value="v1",g.value=g.__value,d.__value="v2",d.value=d.__value,m.__value="planning",m.value=m.__value,r[2]===void 0&&ut(()=>r[11].call(f)),O(e,"slot","nav")},m(_,y){b(_,e,y),E(e,t),E(t,n),E(t,i),E(t,o),E(t,s),E(t,u),E(e,l),E(e,a),E(e,p),E(e,v),E(v,h),E(v,f),E(f,g),E(f,d),E(f,m),Pe(f,r[2]),S||(c=[q(n,"click",r[10]),q(o,"click",r[7]),q(u,"click",r[8]),q(f,"change",r[11]),q(f,"change",r[9])],S=!0)},p(_,y){y&4&&Pe(f,_[2])},d(_){_&&w(e),S=!1,je(c)}}}function Ml(r){let e,t,n,i,o,s,u,l,a,p,v,h;return o=new Yo({props:{boundaryGeojson:r[4]}}),u=new Go({props:{authorityName:r[5],schema:r[2]}}),v=new No({props:{schema:r[2]}}),{c(){e=k("div"),t=k("h1"),n=H(r[5]),i=R(),K(o.$$.fragment),s=R(),K(u.$$.fragment),l=R(),a=k("br"),p=R(),K(v.$$.fragment),O(e,"slot","sidebar")},m(f,g){b(f,e,g),E(e,t),E(t,n),E(t,i),Z(o,t,null),E(e,s),Z(u,e,null),E(e,l),E(e,a),E(e,p),Z(v,e,null),h=!0},p(f,g){const d={};g&16&&(d.boundaryGeojson=f[4]),o.$set(d);const m={};g&4&&(m.schema=f[2]),u.$set(m);const S={};g&4&&(S.schema=f[2]),v.$set(S)},i(f){h||(P(o.$$.fragment,f),P(u.$$.fragment,f),P(v.$$.fragment,f),h=!0)},o(f){I(o.$$.fragment,f),I(u.$$.fragment,f),I(v.$$.fragment,f),h=!1},d(f){f&&w(e),Q(o),Q(u),Q(v)}}}function xl(r){let e,t,n,i,o,s,u,l,a,p,v,h;return e=new co({props:{boundaryGeojson:r[4]}}),n=new es({props:{schema:r[2]}}),o=new ns({}),u=new Sl({props:{routeUrl:r[3],schema:r[2]}}),a=new Xo({props:{style:r[6]}}),v=new Zo({props:{schema:r[2]}}),{c(){K(e.$$.fragment),t=R(),K(n.$$.fragment),i=R(),K(o.$$.fragment),s=R(),K(u.$$.fragment),l=R(),K(a.$$.fragment),p=R(),K(v.$$.fragment)},m(f,g){Z(e,f,g),b(f,t,g),Z(n,f,g),b(f,i,g),Z(o,f,g),b(f,s,g),Z(u,f,g),b(f,l,g),Z(a,f,g),b(f,p,g),Z(v,f,g),h=!0},p(f,g){const d={};g&16&&(d.boundaryGeojson=f[4]),e.$set(d);const m={};g&4&&(m.schema=f[2]),n.$set(m);const S={};g&8&&(S.routeUrl=f[3]),g&4&&(S.schema=f[2]),u.$set(S);const c={};g&4&&(c.schema=f[2]),v.$set(c)},i(f){h||(P(e.$$.fragment,f),P(n.$$.fragment,f),P(o.$$.fragment,f),P(u.$$.fragment,f),P(a.$$.fragment,f),P(v.$$.fragment,f),h=!0)},o(f){I(e.$$.fragment,f),I(n.$$.fragment,f),I(o.$$.fragment,f),I(u.$$.fragment,f),I(a.$$.fragment,f),I(v.$$.fragment,f),h=!1},d(f){Q(e,f),f&&w(t),Q(n,f),f&&w(i),Q(o,f),f&&w(s),Q(u,f),f&&w(l),Q(a,f),f&&w(p),Q(v,f)}}}function Ll(r){let e,t,n;return t=new Ai({props:{style:r[6],$$slots:{default:[xl]},$$scope:{ctx:r}}}),{c(){e=k("div"),K(t.$$.fragment),O(e,"slot","main")},m(i,o){b(i,e,o),Z(t,e,null),n=!0},p(i,o){const s={};o&131100&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(P(t.$$.fragment,i),n=!0)},o(i){I(t.$$.fragment,i),n=!1},d(i){i&&w(e),Q(t)}}}function Rl(r){let e,t,n,i,o,s,u,l;e=new Bi({props:{$$slots:{main:[Ll],sidebar:[Ml],nav:[El]},$$scope:{ctx:r}}});function a(f){r[12](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new Ei({props:p}),be.push(()=>Ze(n,"open",a,r[0]));function v(f){r[13](f)}let h={};return r[1]!==void 0&&(h.open=r[1]),s=new Ti({props:h}),be.push(()=>Ze(s,"open",v,r[1])),{c(){K(e.$$.fragment),t=R(),K(n.$$.fragment),o=R(),K(s.$$.fragment)},m(f,g){Z(e,f,g),b(f,t,g),Z(n,f,g),b(f,o,g),Z(s,f,g),l=!0},p(f,[g]){const d={};g&131100&&(d.$$scope={dirty:g,ctx:f}),e.$set(d);const m={};!i&&g&1&&(i=!0,m.open=f[0],Qe(()=>i=!1)),n.$set(m);const S={};!u&&g&2&&(u=!0,S.open=f[1],Qe(()=>u=!1)),s.$set(S)},i(f){l||(P(e.$$.fragment,f),P(n.$$.fragment,f),P(s.$$.fragment,f),l=!0)},o(f){I(e.$$.fragment,f),I(n.$$.fragment,f),I(s.$$.fragment,f),l=!1},d(f){Q(e,f),f&&w(t),Q(n,f),f&&w(o),Q(s,f)}}}function Tl(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let u=s.get("authority"),l=s.get("style")||"streets",a=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${u}.bin`;o||(p=`https://atip.uk/route-snappers-dev/${u}.bin`);function v(){t(0,n=!n),t(1,i=!1)}function h(){t(1,i=!i),t(0,n=!1)}let f;Fn(async()=>{t(4,f=await g())});async function g(){const x=await(await fetch(Mi)).text(),T=JSON.parse(x);return T.features=T.features.filter(C=>{var L;return((L=C.properties)==null?void 0:L.name)==u}),T}function d(){let y=new URLSearchParams(window.location.search);y.set("schema",a);let x=`${window.location.pathname}?${y.toString()}${window.location.hash}`;window.location.href=x}const m=()=>window.open("index.html");function S(){a=mt(this),t(2,a)}function c(y){n=y,t(0,n)}function _(y){i=y,t(1,i)}return[n,i,a,p,f,u,l,v,h,d,m,S,c,_]}class Cl extends re{constructor(e){super(),ie(this,e,Tl,Rl,ne,{})}}new Cl({target:document.getElementById("app")});
