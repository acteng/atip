<!DOCTYPE html>
<html>
  <head>
    <title>ATIP Scheme Entry</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <script src="deps/maplibre-gl.js"></script>
    <script src="deps/geojson-extent.js"></script>
    <script src="deps/mapbox-gl-draw.js"></script>
    <script type="module">
      import { App } from "./app.js";

      window.app = new App();

      document.getElementById("export").onclick = () => {
        window.app.downloadGeojsonFile();
      };
      document.getElementById("load_geojson").onchange = (e) => {
        window.app.loadFromGeojson(e);
      };
    </script>
    <link href="deps/maplibre-gl.css" rel="stylesheet" />
    <link rel="stylesheet" href="deps/mapbox-gl-draw.css" type="text/css" />
    <link rel="stylesheet" href="map_with_sidebar.css" type="text/css" />
  </head>

  <body>
    <aside id="sidebar">
      <div class="sidebar-content content-container">
        <nav>
          <button type="button" onclick="window.open('/');">Home</button>
          <button
            type="button"
            onclick="document.getElementById('about').classList.toggle('hide-modal');"
          >
            About
          </button>
          <button
            type="button"
            onclick="document.getElementById('instructions').classList.toggle('hide-modal');"
          >
            Instructions
          </button>
        </nav>

        <h1 id="authority">Loading...</h1>
        <label for="scheme_name">Scheme name:</label>
        <input type="text" id="scheme_name" />
        <button type="button" id="export" style="margin-top: 6px">
          Export to GeoJSON
        </button>
        <p>Load from GeoJSON: <input type="file" id="load_geojson"/></p>
        <div id="intervention_list"></div>
      </div>

      <div
        class="sidebar-toggle rounded-rect"
        onclick="document.getElementById('sidebar').classList.toggle('collapsed'); app.map.resize();"
      >
        &rarr;
      </div>
    </aside>

    <main>
      <div id="map">
        <div id="basemaps-wrapper">
          <select id="basemaps">
            <option value="streets">Regular map</option>
            <option value="hybrid">Satellite</option>
          </select>
        </div>
      </div>
      <div id="panel" class="content-container"></div>
      <div id="snap-tool" class="overlay-topright">
        <!-- TODO the text should be fixed, and the progress bar float -->
        <div id="snap-progress">Route snapping tool loading...</div>
      </div>
    </main>

    <div id="about" class="modal-popup centered-fullscreen hide-modal">
      <button
        type="button"
        style="float: right"
        onclick="document.getElementById('about').classList.toggle('hide-modal');"
      >
        X
      </button>
      <h1>About ATIP</h1>
      <p>
        ATIP is an
        <a href="https://github.com/acteng/atip" target="_blank"
          >open source project</a
        >
        developed by:
      </p>
      <ul>
        <li>
          <a href="https://dcarlino.org" target="_blank">Dustin Carlino</a>:
          lead developer
        </li>
        <li>
          <a
            href="https://www.linkedin.com/in/madison-wang-841977bb/"
            target="_blank"
            >Madison Wang</a
          >: UX design
        </li>
        <li>
          <a href="https://github.com/BudgieInWA" target="_blank">Ben Ritter</a
          >: CSS consulting
        </li>
      </ul>
      <p>
        ATIP relies heavily on
        <a href="https://www.openstreetmap.org/about" target="_blank"
          >OpenStreetMap</a
        >
        contributors,
        <a href="https://maplibre.org/" target="_blank">MapLibre</a>,
        <a href="https://georust.org/" target="_blank">GeoRust</a>, and other
        open source projects.
      </p>
    </div>
    <div id="instructions" class="modal-popup centered-fullscreen hide-modal">
      <button
        type="button"
        style="float: right"
        onclick="document.getElementById('instructions').classList.toggle('hide-modal');"
      >
        X
      </button>
      <p>For each intervention:</p>
      <ol>
        <li>
          Click one of the draw icons to the top right of the map (the icons
          allow you to draw points, lines, polygons or routes)
        </li>
        <li>
          Draw the intervention on the map, clicking the original point or
          'Finish snapping' for the Polygon and Route tools respectively
        </li>
        <li>
          Fill in the details that appear (Intervention type, name, description)
        </li>
        <li>
          Click the "Save" button or "Delete" button to save or remove the
          intervention
        </li>
      </ol>
      <p>
        Repeat the steps above for each substantial infrastructure intervention
        in the scheme
      </p>
      <p>Click the intervention name or to re-open the edit panel</p>
      <p>
        Click the "Export to GeoJSON" button to download the interventions as a
        GeoJSON file
      </p>
    </div>
  </body>
</html>
