import{G as J,s as B,P as oe,S as F,i as O,e as v,f as m,g as M,n as h,V as Y,o as w,W as $,p as I,as as se,u as ne,at as D,R as x,x as T,C as z,D as E,E as q,b as le,c as P,au as V,h as b,l as ee,J as N,a1 as j,t as ie,X as re,B as ae,Z as ce,a0 as G,L as ue,a7 as H,Q as fe,M as de,aa as pe,a9 as me,a8 as ge}from"./FileInput-ddab9480.js";const C=[];function S(o,e=J){let s;const t=new Set;function n(r){if(B(o,r)&&(o=r,s)){const c=!C.length;for(const a of t)a[1](),C.push(a,o);if(c){for(let a=0;a<C.length;a+=2)C[a][0](C[a+1]);C.length=0}}}function l(r){n(r(o))}function i(r,c=J){const a=[r,c];return t.add(a),t.size===1&&(s=e(n)||J),r(o),()=>{t.delete(a),t.size===0&&(s(),s=null)}}return{set:n,update:l,subscribe:i}}function _e(o){return o=="google"||o=="bing"}const R=S(null),Pe=S(null),te=S(oe()),be=S(null),he=S(null),ye=S(null),ve=S(null),we=S(Se());we.subscribe(o=>window.localStorage.setItem("userSettings",JSON.stringify(o)));function We(o){let e=new Set;for(let t of o.features)e.add(t.id);let s=e.size+1;for(;e.has(s);)s++;return s}function Je(o){console.log(`Deleting intervention ${o}`),te.update(e=>(e.features=e.features.filter(s=>s.id!=o),e)),be.set(null),he.set(null),ye.set(null),ve.set(null)}function Se(){let o={streetViewImagery:"google",avoidDoublingBack:!1};try{let e=JSON.parse(window.localStorage.getItem("userSettings")||"{}");_e(e.streetViewImagery)&&(o.streetViewImagery=e.streetViewImagery),typeof e.avoidDoublingBack=="boolean"&&(o.avoidDoublingBack=e.avoidDoublingBack)}catch(e){console.log(`Couldn't parse userSettings from local storage: ${e}`)}return o}function Z(o){let e;const s=o[4].default,t=T(s,o,o[3],null);return{c(){t&&t.c()},m(n,l){t&&t.m(n,l),e=!0},p(n,l){t&&t.p&&(!e||l&8)&&z(t,s,n,n[3],e?q(s,n[3],l,null):E(n[3]),null)},i(n){e||(h(t,n),e=!0)},o(n){w(t,n),e=!1},d(n){t&&t.d(n)}}}function ke(o){let e,s,t=o[1]&&Z(o);return{c(){e=v("div"),t&&t.c(),m(e,"class","map svelte-12dpf1u")},m(n,l){M(n,e,l),t&&t.m(e,null),o[5](e),s=!0},p(n,[l]){n[1]?t?(t.p(n,l),l&2&&h(t,1)):(t=Z(n),t.c(),h(t,1),t.m(e,null)):t&&(Y(),w(t,1,1,()=>{t=null}),$())},i(n){s||(h(t),s=!0)},o(n){w(t),s=!1},d(n){n&&I(e),t&&t.d(),o[5](null)}}}function Ce(o,e,s){let{$$slots:t={},$$scope:n}=e,{style:l}=e,i,r,c=!1;se("setCamera",!window.location.hash),ne(()=>{i=new D.Map({container:r,style:`https://api.maptiler.com/maps/${l}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),i.addControl(new D.ScaleControl({})),i.addControl(new D.NavigationControl({visualizePitch:!0}),"bottom-right"),i.on("load",()=>{s(1,c=!0),R.set(i)}),new ResizeObserver(()=>{i.resize()}).observe(r)}),x(()=>{i.remove()});function a(u){le[u?"unshift":"push"](()=>{r=u,s(0,r)})}return o.$$set=u=>{"style"in u&&s(2,l=u.style),"$$scope"in u&&s(3,n=u.$$scope)},[r,c,l,n,t,a]}class Ne extends F{constructor(e){super(),O(this,e,Ce,ke,B,{style:2})}}const Le=o=>({}),Q=o=>({}),Me=o=>({}),U=o=>({});function Ie(o){let e,s,t,n,l,i,r,c,a,u,d;const p=o[3].sidebar,f=T(p,o,o[2],U),W=o[3].main,_=T(W,o,o[2],Q);return{c(){e=v("div"),s=v("aside"),t=v("div"),f&&f.c(),n=P(),l=v("button"),l.textContent="â†’",r=P(),c=v("main"),_&&_.c(),m(t,"class","sidebar-content content-container svelte-ect12w"),m(l,"type","button"),m(l,"class","sidebar-toggle rounded-rect svelte-ect12w"),m(s,"class",i=V(o[0]?"":"collapsed")+" svelte-ect12w"),m(c,"class","svelte-ect12w"),m(e,"class","overall-layout svelte-ect12w")},m(g,k){M(g,e,k),b(e,s),b(s,t),f&&f.m(t,null),b(s,n),b(s,l),b(e,r),b(e,c),_&&_.m(c,null),a=!0,u||(d=ee(l,"click",o[1]),u=!0)},p(g,[k]){f&&f.p&&(!a||k&4)&&z(f,p,g,g[2],a?q(p,g[2],k,Me):E(g[2]),U),(!a||k&1&&i!==(i=V(g[0]?"":"collapsed")+" svelte-ect12w"))&&m(s,"class",i),_&&_.p&&(!a||k&4)&&z(_,W,g,g[2],a?q(W,g[2],k,Le):E(g[2]),Q)},i(g){a||(h(f,g),h(_,g),a=!0)},o(g){w(f,g),w(_,g),a=!1},d(g){g&&I(e),f&&f.d(g),_&&_.d(g),u=!1,d()}}}function Be(o,e,s){let{$$slots:t={},$$scope:n}=e,l=!0;function i(){s(0,l=!l)}return o.$$set=r=>{"$$scope"in r&&s(2,n=r.$$scope)},[l,i,n,t]}class Re extends F{constructor(e){super(),O(this,e,Be,Ie,B,{})}}const y={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Fe=10,X=10;function Oe(o,e,s){let t;N(o,R,a=>s(2,t=a));let{layers:n}=e,{contents:l}=e,i=new D.Popup({closeButton:!1,closeOnClick:!1});t.on("mousemove",r),t.on("mouseout",c),x(()=>{t.off("mousemove",r),t.off("mouseout",c),i.remove()});function r(a){if(!n.every(d=>t.getLayer(d))){i.remove();return}let u=t.queryRenderedFeatures(a.point,{layers:n});u.length>0?i.setLngLat(a.lngLat).setHTML(l(u[0].properties)).addTo(t):i.remove()}function c(){i.remove()}return o.$$set=a=>{"layers"in a&&s(0,n=a.layers),"contents"in a&&s(1,l=a.contents)},[n,l]}class Ve extends F{constructor(e){super(),O(this,e,Oe,null,B,{layers:0,contents:1})}}function De(o){const e=o-1;return e*e*e+1}function A(o,{delay:e=0,duration:s=400,easing:t=De}={}){const n=getComputedStyle(o),l=+n.opacity,i=parseFloat(n.height),r=parseFloat(n.paddingTop),c=parseFloat(n.paddingBottom),a=parseFloat(n.marginTop),u=parseFloat(n.marginBottom),d=parseFloat(n.borderTopWidth),p=parseFloat(n.borderBottomWidth);return{delay:e,duration:s,easing:t,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*l};height: ${f*i}px;padding-top: ${f*r}px;padding-bottom: ${f*c}px;margin-top: ${f*a}px;margin-bottom: ${f*u}px;border-top-width: ${f*d}px;border-bottom-width: ${f*p}px;`}}function K(o){let e,s,t;const n=o[3].default,l=T(n,o,o[2],null);return{c(){e=v("div"),l&&l.c()},m(i,r){M(i,e,r),l&&l.m(e,null),t=!0},p(i,r){l&&l.p&&(!t||r&4)&&z(l,n,i,i[2],t?q(n,i[2],r,null):E(i[2]),null)},i(i){t||(h(l,i),ce(()=>{s||(s=G(e,A,{duration:100},!0)),s.run(1)}),t=!0)},o(i){w(l,i),s||(s=G(e,A,{duration:100},!1)),s.run(0),t=!1},d(i){i&&I(e),l&&l.d(i),i&&s&&s.end()}}}function Te(o){let e,s,t,n,l,i,r,c,a,u,d=o[0]&&K(o);return{c(){e=v("button"),s=j("svg"),t=j("path"),n=P(),l=ie(o[1]),i=P(),d&&d.c(),r=re(),m(t,"d","M9 5l7 7-7 7"),m(s,"style","tran"),m(s,"width","20"),m(s,"height","20"),m(s,"fill","none"),m(s,"stroke-linecap","round"),m(s,"stroke-linejoin","round"),m(s,"stroke-width","2"),m(s,"viewBox","0 0 24 24"),m(s,"stroke","currentColor"),m(s,"class","svelte-una9lq"),m(e,"aria-expanded",o[0]),m(e,"class","svelte-una9lq")},m(p,f){M(p,e,f),b(e,s),b(s,t),b(e,n),b(e,l),M(p,i,f),d&&d.m(p,f),M(p,r,f),c=!0,a||(u=ee(e,"click",o[4]),a=!0)},p(p,[f]){(!c||f&2)&&ae(l,p[1]),(!c||f&1)&&m(e,"aria-expanded",p[0]),p[0]?d?(d.p(p,f),f&1&&h(d,1)):(d=K(p),d.c(),h(d,1),d.m(r.parentNode,r)):d&&(Y(),w(d,1,1,()=>{d=null}),$())},i(p){c||(h(d),c=!0)},o(p){w(d),c=!1},d(p){p&&I(e),p&&I(i),d&&d.d(p),p&&I(r),a=!1,u()}}}function ze(o,e,s){let{$$slots:t={},$$scope:n}=e,{label:l}=e,{open:i=!1}=e;const r=()=>s(0,i=!i);return o.$$set=c=>{"label"in c&&s(1,l=c.label),"open"in c&&s(0,i=c.open),"$$scope"in c&&s(2,n=c.$$scope)},[i,l,n,t,r]}class je extends F{constructor(e){super(),O(this,e,ze,Te,B,{label:1,open:0})}}let L="interventions";function Ee(o,e,s){let t,n;N(o,R,u=>s(1,t=u)),N(o,te,u=>s(2,n=u));let{schema:l}=e;ue(t,L,n);const i=["match",["get","intervention_type"],"area",y.area,"route",y.route,"crossing",y.crossing,"other",y.other,"white"],r=["match",["get","reference_type",["get","planning"]],"preapp",y.preapp,"outline",y.outline,"reserved matters",y["reserved matters"],"local plan",y["local plan"],"white"],c=["!=","hide_while_editing",!0];return H(t,{id:"interventions-points",source:L,filter:["all",pe,c,["!=","endpoint",!0]],color:i,radius:Fe}),fe(t,{id:"interventions-lines",source:L,filter:["all",me,c],color:i,width:X}),H(t,{id:"interventions-lines-endpoints",source:L,filter:["==","endpoint",!0],radius:.5*X,opacity:0,strokeColor:y.lineEndpointColor,strokeWidth:2}),de(t,{id:"interventions-polygons",source:L,filter:["all",ge,c],color:l=="planning"?r:i,opacity:.5}),o.$$set=u=>{"schema"in u&&s(0,l=u.schema)},o.$$.update=()=>{if(o.$$.dirty&6){let u=JSON.parse(JSON.stringify(n)),d=[];for(let p of u.features)if(p.geometry.type=="LineString")for(let f of[p.geometry.coordinates[0],p.geometry.coordinates[p.geometry.coordinates.length-1]])d.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});u.features=u.features.concat(d),t.getSource(L).setData(u)}},[l,t,n]}class Ge extends F{constructor(e){super(),O(this,e,Ee,null,B,{schema:0})}}export{je as C,Ge as I,Re as L,Ve as M,he as a,ye as b,y as c,Je as d,Fe as e,be as f,te as g,Ne as h,X as l,R as m,We as n,ve as o,Pe as r,A as s,we as u};
