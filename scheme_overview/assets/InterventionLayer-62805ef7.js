import{E as q,s as F,N as oe,S as M,i as O,e as h,f as m,g as C,n as y,U as x,o as w,V as $,p as I,ar as le,P as ie,as as E,Q as ee,w as T,B as z,C as P,D as N,b as ae,c as D,at as H,h as g,l as W,H as V,t as te,au as re,A as ne,r as ue,a0 as j,W as ce,Y as fe,$ as G,J as de,a6 as U,O as pe,K as me,a9 as _e,a8 as ge,a7 as be}from"./maplibre_helpers-a0686a8c.js";const L=[];function k(t,e=q){let s;const n=new Set;function o(a){if(F(t,a)&&(t=a,s)){const u=!L.length;for(const r of n)r[1](),L.push(r,t);if(u){for(let r=0;r<L.length;r+=2)L[r][0](L[r+1]);L.length=0}}}function l(a){o(a(t))}function i(a,u=q){const r=[a,u];return n.add(r),n.size===1&&(s=e(o)||q),a(t),()=>{n.delete(r),n.size===0&&(s(),s=null)}}return{set:o,update:l,subscribe:i}}function he(t){return t=="google"||t=="bing"}const R=k(null),Ve=k(null),se=k(oe()),ye=k(null),ve=k(null),we=k(null),ke=k(null),Se=k(Ce());Se.subscribe(t=>window.localStorage.setItem("userSettings",JSON.stringify(t)));function Re(t){let e=new Set;for(let n of t.features)e.add(n.id);let s=e.size+1;for(;e.has(s);)s++;return s}function He(t){console.log(`Deleting intervention ${t}`),se.update(e=>(e.features=e.features.filter(s=>s.id!=t),e)),ye.set(null),ve.set(null),we.set(null),ke.set(null)}function Ce(){let t={streetViewImagery:"google",avoidDoublingBack:!1};try{let e=JSON.parse(window.localStorage.getItem("userSettings")||"{}");he(e.streetViewImagery)&&(t.streetViewImagery=e.streetViewImagery),typeof e.avoidDoublingBack=="boolean"&&(t.avoidDoublingBack=e.avoidDoublingBack)}catch(e){console.log(`Couldn't parse userSettings from local storage: ${e}`)}return t}function A(t){let e;const s=t[4].default,n=T(s,t,t[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&z(n,s,o,o[3],e?N(s,o[3],l,null):P(o[3]),null)},i(o){e||(y(n,o),e=!0)},o(o){w(n,o),e=!1},d(o){n&&n.d(o)}}}function Ie(t){let e,s,n=t[1]&&A(t);return{c(){e=h("div"),n&&n.c(),m(e,"class","map svelte-12dpf1u")},m(o,l){C(o,e,l),n&&n.m(e,null),t[5](e),s=!0},p(o,[l]){o[1]?n?(n.p(o,l),l&2&&y(n,1)):(n=A(o),n.c(),y(n,1),n.m(e,null)):n&&(x(),w(n,1,1,()=>{n=null}),$())},i(o){s||(y(n),s=!0)},o(o){w(n),s=!1},d(o){o&&I(e),n&&n.d(),t[5](null)}}}function Fe(t,e,s){let{$$slots:n={},$$scope:o}=e,{style:l}=e,i,a,u=!1;le("setCamera",!window.location.hash),ie(()=>{i=new E.Map({container:a,style:`https://api.maptiler.com/maps/${l}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),i.addControl(new E.ScaleControl({})),i.addControl(new E.NavigationControl({visualizePitch:!0}),"bottom-right"),i.on("load",()=>{s(1,u=!0),R.set(i)}),new ResizeObserver(()=>{i.resize()}).observe(a)}),ee(()=>{i.remove()});function r(c){ae[c?"unshift":"push"](()=>{a=c,s(0,a)})}return t.$$set=c=>{"style"in c&&s(2,l=c.style),"$$scope"in c&&s(3,o=c.$$scope)},[a,u,l,o,n,r]}class je extends M{constructor(e){super(),O(this,e,Fe,Ie,F,{style:2})}}const Le=t=>({}),K=t=>({}),Be=t=>({}),Q=t=>({});function Me(t){let e,s,n,o,l,i,a,u,r,c,d;const p=t[3].sidebar,f=T(p,t,t[2],Q),J=t[3].main,b=T(J,t,t[2],K);return{c(){e=h("div"),s=h("aside"),n=h("div"),f&&f.c(),o=D(),l=h("button"),l.textContent="â†’",a=D(),u=h("main"),b&&b.c(),m(n,"class","sidebar-content content-container svelte-ect12w"),m(l,"type","button"),m(l,"class","sidebar-toggle rounded-rect svelte-ect12w"),m(s,"class",i=H(t[0]?"":"collapsed")+" svelte-ect12w"),m(u,"class","svelte-ect12w"),m(e,"class","overall-layout svelte-ect12w")},m(_,S){C(_,e,S),g(e,s),g(s,n),f&&f.m(n,null),g(s,o),g(s,l),g(e,a),g(e,u),b&&b.m(u,null),r=!0,c||(d=W(l,"click",t[1]),c=!0)},p(_,[S]){f&&f.p&&(!r||S&4)&&z(f,p,_,_[2],r?N(p,_[2],S,Be):P(_[2]),Q),(!r||S&1&&i!==(i=H(_[0]?"":"collapsed")+" svelte-ect12w"))&&m(s,"class",i),b&&b.p&&(!r||S&4)&&z(b,J,_,_[2],r?N(J,_[2],S,Le):P(_[2]),K)},i(_){r||(y(f,_),y(b,_),r=!0)},o(_){w(f,_),w(b,_),r=!1},d(_){_&&I(e),f&&f.d(_),b&&b.d(_),c=!1,d()}}}function Oe(t,e,s){let{$$slots:n={},$$scope:o}=e,l=!0;function i(){s(0,l=!l)}return t.$$set=a=>{"$$scope"in a&&s(2,o=a.$$scope)},[l,i,o,n]}class Ge extends M{constructor(e){super(),O(this,e,Oe,Me,F,{})}}const v={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},qe=10,Y=10;function De(t,e,s){let n;V(t,R,r=>s(2,n=r));let{layers:o}=e,{contents:l}=e,i=new E.Popup({closeButton:!1,closeOnClick:!1});n.on("mousemove",a),n.on("mouseout",u),ee(()=>{n.off("mousemove",a),n.off("mouseout",u),i.remove()});function a(r){if(!o.every(d=>n.getLayer(d))){i.remove();return}let c=n.queryRenderedFeatures(r.point,{layers:o});c.length>0?i.setLngLat(r.lngLat).setHTML(l(c[0].properties)).addTo(n):i.remove()}function u(){i.remove()}return t.$$set=r=>{"layers"in r&&s(0,o=r.layers),"contents"in r&&s(1,l=r.contents)},[o,l]}class Ue extends M{constructor(e){super(),O(this,e,De,null,F,{layers:0,contents:1})}}function Ee(t){const e=t-1;return e*e*e+1}function Z(t,{delay:e=0,duration:s=400,easing:n=Ee}={}){const o=getComputedStyle(t),l=+o.opacity,i=parseFloat(o.height),a=parseFloat(o.paddingTop),u=parseFloat(o.paddingBottom),r=parseFloat(o.marginTop),c=parseFloat(o.marginBottom),d=parseFloat(o.borderTopWidth),p=parseFloat(o.borderBottomWidth);return{delay:e,duration:s,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*l};height: ${f*i}px;padding-top: ${f*a}px;padding-bottom: ${f*u}px;margin-top: ${f*r}px;margin-bottom: ${f*c}px;border-top-width: ${f*d}px;border-bottom-width: ${f*p}px;`}}function Te(t){let e,s,n,o,l,i,a;return{c(){e=h("label"),s=h("input"),n=D(),o=h("button"),l=te(t[0]),m(s,"type","file"),m(s,"id",t[1]),m(s,"class","svelte-a846bd"),m(o,"type","button")},m(u,r){C(u,e,r),g(e,s),g(e,n),g(e,o),g(o,l),i||(a=[W(s,"change",function(){re(t[2])&&t[2].apply(this,arguments)}),W(o,"click",t[3])],i=!0)},p(u,[r]){t=u,r&2&&m(s,"id",t[1]),r&1&&ne(l,t[0])},i:q,o:q,d(u){u&&I(e),i=!1,ue(a)}}}function ze(t,e,s){let{label:n}=e,{uniqueId:o}=e,{loadFile:l}=e;function i(){document.getElementById(o).click()}return t.$$set=a=>{"label"in a&&s(0,n=a.label),"uniqueId"in a&&s(1,o=a.uniqueId),"loadFile"in a&&s(2,l=a.loadFile)},[n,o,l,i]}class Ae extends M{constructor(e){super(),O(this,e,ze,Te,F,{label:0,uniqueId:1,loadFile:2})}}function X(t){let e,s,n;const o=t[3].default,l=T(o,t,t[2],null);return{c(){e=h("div"),l&&l.c()},m(i,a){C(i,e,a),l&&l.m(e,null),n=!0},p(i,a){l&&l.p&&(!n||a&4)&&z(l,o,i,i[2],n?N(o,i[2],a,null):P(i[2]),null)},i(i){n||(y(l,i),fe(()=>{s||(s=G(e,Z,{duration:100},!0)),s.run(1)}),n=!0)},o(i){w(l,i),s||(s=G(e,Z,{duration:100},!1)),s.run(0),n=!1},d(i){i&&I(e),l&&l.d(i),i&&s&&s.end()}}}function Pe(t){let e,s,n,o,l,i,a,u,r,c,d=t[0]&&X(t);return{c(){e=h("button"),s=j("svg"),n=j("path"),o=D(),l=te(t[1]),i=D(),d&&d.c(),a=ce(),m(n,"d","M9 5l7 7-7 7"),m(s,"style","tran"),m(s,"width","20"),m(s,"height","20"),m(s,"fill","none"),m(s,"stroke-linecap","round"),m(s,"stroke-linejoin","round"),m(s,"stroke-width","2"),m(s,"viewBox","0 0 24 24"),m(s,"stroke","currentColor"),m(s,"class","svelte-una9lq"),m(e,"aria-expanded",t[0]),m(e,"class","svelte-una9lq")},m(p,f){C(p,e,f),g(e,s),g(s,n),g(e,o),g(e,l),C(p,i,f),d&&d.m(p,f),C(p,a,f),u=!0,r||(c=W(e,"click",t[4]),r=!0)},p(p,[f]){(!u||f&2)&&ne(l,p[1]),(!u||f&1)&&m(e,"aria-expanded",p[0]),p[0]?d?(d.p(p,f),f&1&&y(d,1)):(d=X(p),d.c(),y(d,1),d.m(a.parentNode,a)):d&&(x(),w(d,1,1,()=>{d=null}),$())},i(p){u||(y(d),u=!0)},o(p){w(d),u=!1},d(p){p&&I(e),p&&I(i),d&&d.d(p),p&&I(a),r=!1,c()}}}function Ne(t,e,s){let{$$slots:n={},$$scope:o}=e,{label:l}=e,{open:i=!1}=e;const a=()=>s(0,i=!i);return t.$$set=u=>{"label"in u&&s(1,l=u.label),"open"in u&&s(0,i=u.open),"$$scope"in u&&s(2,o=u.$$scope)},[i,l,o,n,a]}class Ke extends M{constructor(e){super(),O(this,e,Ne,Pe,F,{label:1,open:0})}}let B="interventions";function We(t,e,s){let n,o;V(t,R,c=>s(1,n=c)),V(t,se,c=>s(2,o=c));let{schema:l}=e;de(n,B,o);const i=["match",["get","intervention_type"],"area",v.area,"route",v.route,"crossing",v.crossing,"other",v.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",v.preapp,"outline",v.outline,"reserved matters",v["reserved matters"],"local plan",v["local plan"],"white"],u=["!=","hide_while_editing",!0];return U(n,{id:"interventions-points",source:B,filter:["all",_e,u,["!=","endpoint",!0]],color:i,radius:qe}),pe(n,{id:"interventions-lines",source:B,filter:["all",ge,u],color:i,width:Y}),U(n,{id:"interventions-lines-endpoints",source:B,filter:["==","endpoint",!0],radius:.5*Y,opacity:0,strokeColor:v.lineEndpointColor,strokeWidth:2}),me(n,{id:"interventions-polygons",source:B,filter:["all",be,u],color:l=="planning"?a:i,opacity:.5}),t.$$set=c=>{"schema"in c&&s(0,l=c.schema)},t.$$.update=()=>{if(t.$$.dirty&6){let c=JSON.parse(JSON.stringify(o)),d=[];for(let p of c.features)if(p.geometry.type=="LineString")for(let f of[p.geometry.coordinates[0],p.geometry.coordinates[p.geometry.coordinates.length-1]])d.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});c.features=c.features.concat(d),n.getSource(B).setData(c)}},[l,n,o]}class Qe extends M{constructor(e){super(),O(this,e,We,null,F,{schema:0})}}export{Ke as C,Ae as F,Qe as I,Ge as L,Ue as M,ve as a,we as b,v as c,He as d,qe as e,ye as f,se as g,je as h,Y as l,R as m,Re as n,ke as o,Ve as r,Z as s,Se as u};
