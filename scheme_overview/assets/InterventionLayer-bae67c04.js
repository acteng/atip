import{G as $,s as I,P as ie,S as D,i as P,e as b,f as _,g as y,n as C,V as te,o as M,W as se,p as h,as as ae,u as re,at as q,R as ne,x as z,C as E,D as W,E as J,b as ce,c as B,au as G,h as g,l as N,J as V,t as L,Z as le,_ as H,r as ue,Y as fe,a1 as U,X as pe,B as de,a0 as Z,d as me,m as _e,q as be,y as O,L as ge,a7 as A,Q as ve,M as ye,aa as he,a9 as we,a8 as ke}from"./FileInput-ddab9480.js";const R=[];function F(l,e=$){let n;const t=new Set;function s(c){if(I(l,c)&&(l=c,n)){const u=!R.length;for(const a of t)a[1](),R.push(a,l);if(u){for(let a=0;a<R.length;a+=2)R[a][0](R[a+1]);R.length=0}}}function o(c){s(c(l))}function i(c,u=$){const a=[c,u];return t.add(a),t.size===1&&(n=e(s)||$),c(l),()=>{t.delete(a),t.size===0&&(n(),n=null)}}return{set:s,update:o,subscribe:i}}function Se(l){return l=="google"||l=="bing"}const j=F(null),Ye=F(null),oe=F(ie()),Ce=F(null),Le=F(null),Be=F(null),Me=F(null),Oe=F(Ie());Oe.subscribe(l=>window.localStorage.setItem("userSettings",JSON.stringify(l)));function Ke(l){let e=new Set;for(let t of l.features)e.add(t.id);let n=e.size+1;for(;e.has(n);)n++;return n}function xe(l){console.log(`Deleting intervention ${l}`),oe.update(e=>(e.features=e.features.filter(n=>n.id!=l),e)),Ce.set(null),Le.set(null),Be.set(null),Me.set(null)}function Ie(){let l={streetViewImagery:"google",avoidDoublingBack:!1};try{let e=JSON.parse(window.localStorage.getItem("userSettings")||"{}");Se(e.streetViewImagery)&&(l.streetViewImagery=e.streetViewImagery),typeof e.avoidDoublingBack=="boolean"&&(l.avoidDoublingBack=e.avoidDoublingBack)}catch(e){console.log(`Couldn't parse userSettings from local storage: ${e}`)}return l}function Q(l){let e;const n=l[4].default,t=z(n,l,l[3],null);return{c(){t&&t.c()},m(s,o){t&&t.m(s,o),e=!0},p(s,o){t&&t.p&&(!e||o&8)&&E(t,n,s,s[3],e?J(n,s[3],o,null):W(s[3]),null)},i(s){e||(C(t,s),e=!0)},o(s){M(t,s),e=!1},d(s){t&&t.d(s)}}}function Fe(l){let e,n,t=l[1]&&Q(l);return{c(){e=b("div"),t&&t.c(),_(e,"class","map svelte-12dpf1u")},m(s,o){y(s,e,o),t&&t.m(e,null),l[5](e),n=!0},p(s,[o]){s[1]?t?(t.p(s,o),o&2&&C(t,1)):(t=Q(s),t.c(),C(t,1),t.m(e,null)):t&&(te(),M(t,1,1,()=>{t=null}),se())},i(s){n||(C(t),n=!0)},o(s){M(t),n=!1},d(s){s&&h(e),t&&t.d(),l[5](null)}}}function $e(l,e,n){let{$$slots:t={},$$scope:s}=e,{style:o}=e,i,c,u=!1;ae("setCamera",!window.location.hash),re(()=>{i=new q.Map({container:c,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),i.addControl(new q.ScaleControl({})),i.addControl(new q.NavigationControl({visualizePitch:!0}),"bottom-right"),i.on("load",()=>{n(1,u=!0),j.set(i)}),new ResizeObserver(()=>{i.resize()}).observe(c)}),ne(()=>{i.remove()});function a(p){ce[p?"unshift":"push"](()=>{c=p,n(0,c)})}return l.$$set=p=>{"style"in p&&n(2,o=p.style),"$$scope"in p&&n(3,s=p.$$scope)},[c,u,o,s,t,a]}class et extends D{constructor(e){super(),P(this,e,$e,Fe,I,{style:2})}}const De=l=>({}),X=l=>({}),Pe=l=>({}),Y=l=>({});function Re(l){let e,n,t,s,o,i,c,u,a,p,m;const d=l[3].sidebar,f=z(d,l,l[2],Y),S=l[3].main,w=z(S,l,l[2],X);return{c(){e=b("div"),n=b("aside"),t=b("div"),f&&f.c(),s=B(),o=b("button"),o.textContent="â†’",c=B(),u=b("main"),w&&w.c(),_(t,"class","sidebar-content content-container svelte-ect12w"),_(o,"type","button"),_(o,"class","sidebar-toggle rounded-rect svelte-ect12w"),_(n,"class",i=G(l[0]?"":"collapsed")+" svelte-ect12w"),_(u,"class","svelte-ect12w"),_(e,"class","overall-layout svelte-ect12w")},m(r,v){y(r,e,v),g(e,n),g(n,t),f&&f.m(t,null),g(n,s),g(n,o),g(e,c),g(e,u),w&&w.m(u,null),a=!0,p||(m=N(o,"click",l[1]),p=!0)},p(r,[v]){f&&f.p&&(!a||v&4)&&E(f,d,r,r[2],a?J(d,r[2],v,Pe):W(r[2]),Y),(!a||v&1&&i!==(i=G(r[0]?"":"collapsed")+" svelte-ect12w"))&&_(n,"class",i),w&&w.p&&(!a||v&4)&&E(w,S,r,r[2],a?J(S,r[2],v,De):W(r[2]),X)},i(r){a||(C(f,r),C(w,r),a=!0)},o(r){M(f,r),M(w,r),a=!1},d(r){r&&h(e),f&&f.d(r),w&&w.d(r),p=!1,m()}}}function Te(l,e,n){let{$$slots:t={},$$scope:s}=e,o=!0;function i(){n(0,o=!o)}return l.$$set=c=>{"$$scope"in c&&n(2,s=c.$$scope)},[o,i,s,t]}class tt extends D{constructor(e){super(),P(this,e,Te,Re,I,{})}}const k={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},qe=10,K=10;function ze(l,e,n){let t;V(l,j,a=>n(2,t=a));let{layers:s}=e,{contents:o}=e,i=new q.Popup({closeButton:!1,closeOnClick:!1});t.on("mousemove",c),t.on("mouseout",u),ne(()=>{t.off("mousemove",c),t.off("mouseout",u),i.remove()});function c(a){if(!s.every(m=>t.getLayer(m))){i.remove();return}let p=t.queryRenderedFeatures(a.point,{layers:s});p.length>0?i.setLngLat(a.lngLat).setHTML(o(p[0].properties)).addTo(t):i.remove()}function u(){i.remove()}return l.$$set=a=>{"layers"in a&&n(0,s=a.layers),"contents"in a&&n(1,o=a.contents)},[s,o]}class st extends D{constructor(e){super(),P(this,e,ze,null,I,{layers:0,contents:1})}}function Ee(l){const e=l-1;return e*e*e+1}function x(l,{delay:e=0,duration:n=400,easing:t=Ee}={}){const s=getComputedStyle(l),o=+s.opacity,i=parseFloat(s.height),c=parseFloat(s.paddingTop),u=parseFloat(s.paddingBottom),a=parseFloat(s.marginTop),p=parseFloat(s.marginBottom),m=parseFloat(s.borderTopWidth),d=parseFloat(s.borderBottomWidth);return{delay:e,duration:n,easing:t,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*i}px;padding-top: ${f*c}px;padding-bottom: ${f*u}px;margin-top: ${f*a}px;margin-bottom: ${f*p}px;border-top-width: ${f*m}px;border-bottom-width: ${f*d}px;`}}function We(l){let e,n,t,s,o,i,c;return{c(){e=b("div"),n=L(`Basemap:
  `),t=b("select"),s=b("option"),s.textContent="Streets",o=b("option"),o.textContent="Satellite",s.__value="streets",s.value=s.__value,o.__value="hybrid",o.value=o.__value,l[0]===void 0&&le(()=>l[2].call(t)),_(e,"class","svelte-1tbnm6i")},m(u,a){y(u,e,a),g(e,n),g(e,t),g(t,s),g(t,o),H(t,l[0]),i||(c=[N(t,"change",l[2]),N(t,"change",l[1])],i=!0)},p(u,[a]){a&1&&H(t,u[0])},i:$,o:$,d(u){u&&h(e),i=!1,ue(c)}}}function Je(l,e,n){let{style:t}=e;function s(){let i=new URLSearchParams(window.location.search);i.set("style",t);let c=`${window.location.pathname}?${i.toString()}${window.location.hash}`;window.location.href=c}function o(){t=fe(this),n(0,t)}return l.$$set=i=>{"style"in i&&n(0,t=i.style)},[t,s,o]}class nt extends D{constructor(e){super(),P(this,e,Je,We,I,{style:0})}}function ee(l){let e,n,t;const s=l[3].default,o=z(s,l,l[2],null);return{c(){e=b("div"),o&&o.c()},m(i,c){y(i,e,c),o&&o.m(e,null),t=!0},p(i,c){o&&o.p&&(!t||c&4)&&E(o,s,i,i[2],t?J(s,i[2],c,null):W(i[2]),null)},i(i){t||(C(o,i),le(()=>{n||(n=Z(e,x,{duration:100},!0)),n.run(1)}),t=!0)},o(i){M(o,i),n||(n=Z(e,x,{duration:100},!1)),n.run(0),t=!1},d(i){i&&h(e),o&&o.d(i),i&&n&&n.end()}}}function Ne(l){let e,n,t,s,o,i,c,u,a,p,m=l[0]&&ee(l);return{c(){e=b("button"),n=U("svg"),t=U("path"),s=B(),o=L(l[1]),i=B(),m&&m.c(),c=pe(),_(t,"d","M9 5l7 7-7 7"),_(n,"style","tran"),_(n,"width","20"),_(n,"height","20"),_(n,"fill","none"),_(n,"stroke-linecap","round"),_(n,"stroke-linejoin","round"),_(n,"stroke-width","2"),_(n,"viewBox","0 0 24 24"),_(n,"stroke","currentColor"),_(n,"class","svelte-una9lq"),_(e,"aria-expanded",l[0]),_(e,"class","svelte-una9lq")},m(d,f){y(d,e,f),g(e,n),g(n,t),g(e,s),g(e,o),y(d,i,f),m&&m.m(d,f),y(d,c,f),u=!0,a||(p=N(e,"click",l[4]),a=!0)},p(d,[f]){(!u||f&2)&&de(o,d[1]),(!u||f&1)&&_(e,"aria-expanded",d[0]),d[0]?m?(m.p(d,f),f&1&&C(m,1)):(m=ee(d),m.c(),C(m,1),m.m(c.parentNode,c)):m&&(te(),M(m,1,1,()=>{m=null}),se())},i(d){u||(C(m),u=!0)},o(d){M(m),u=!1},d(d){d&&h(e),d&&h(i),m&&m.d(d),d&&h(c),a=!1,p()}}}function Ve(l,e,n){let{$$slots:t={},$$scope:s}=e,{label:o}=e,{open:i=!1}=e;const c=()=>n(0,i=!i);return l.$$set=u=>{"label"in u&&n(1,o=u.label),"open"in u&&n(0,i=u.open),"$$scope"in u&&n(2,s=u.$$scope)},[i,o,s,t,c]}class je extends D{constructor(e){super(),P(this,e,Ve,Ne,I,{label:1,open:0})}}function Ge(l){let e,n,t,s,o,i,c,u,a,p,m,d,f,S,w;return{c(){e=b("li"),n=b("span"),t=L("Areas"),s=B(),o=b("li"),i=b("span"),c=L("Routes"),u=B(),a=b("li"),p=b("span"),m=L("Crossings"),d=B(),f=b("li"),S=b("span"),w=L("Other"),_(n,"class","svelte-l42ea0"),O(n,"background",k.area),_(i,"class","svelte-l42ea0"),O(i,"background",k.route),_(p,"class","svelte-l42ea0"),O(p,"background",k.crossing),_(S,"class","svelte-l42ea0"),O(S,"background",k.other)},m(r,v){y(r,e,v),g(e,n),g(e,t),y(r,s,v),y(r,o,v),g(o,i),g(o,c),y(r,u,v),y(r,a,v),g(a,p),g(a,m),y(r,d,v),y(r,f,v),g(f,S),g(f,w)},p:$,d(r){r&&h(e),r&&h(s),r&&h(o),r&&h(u),r&&h(a),r&&h(d),r&&h(f)}}}function He(l){let e,n,t,s,o,i,c,u,a,p,m,d,f,S,w;return{c(){e=b("li"),n=b("span"),t=L("Preapp"),s=B(),o=b("li"),i=b("span"),c=L("Outline"),u=B(),a=b("li"),p=b("span"),m=L("Reserved matters"),d=B(),f=b("li"),S=b("span"),w=L("Local plan"),_(n,"class","svelte-l42ea0"),O(n,"background",k.preapp),_(i,"class","svelte-l42ea0"),O(i,"background",k.outline),_(p,"class","svelte-l42ea0"),O(p,"background",k["reserved matters"]),_(S,"class","svelte-l42ea0"),O(S,"background",k["local plan"])},m(r,v){y(r,e,v),g(e,n),g(e,t),y(r,s,v),y(r,o,v),g(o,i),g(o,c),y(r,u,v),y(r,a,v),g(a,p),g(a,m),y(r,d,v),y(r,f,v),g(f,S),g(f,w)},p:$,d(r){r&&h(e),r&&h(s),r&&h(o),r&&h(u),r&&h(a),r&&h(d),r&&h(f)}}}function Ue(l){let e;function n(o,i){return o[0]=="planning"?He:Ge}let t=n(l),s=t(l);return{c(){e=b("ul"),s.c()},m(o,i){y(o,e,i),s.m(e,null)},p(o,i){t===(t=n(o))&&s?s.p(o,i):(s.d(1),s=t(o),s&&(s.c(),s.m(e,null)))},d(o){o&&h(e),s.d()}}}function Ze(l){let e,n,t;return n=new je({props:{label:"Objects",open:!0,$$slots:{default:[Ue]},$$scope:{ctx:l}}}),{c(){e=b("div"),me(n.$$.fragment),_(e,"class","svelte-l42ea0")},m(s,o){y(s,e,o),_e(n,e,null),t=!0},p(s,[o]){const i={};o&3&&(i.$$scope={dirty:o,ctx:s}),n.$set(i)},i(s){t||(C(n.$$.fragment,s),t=!0)},o(s){M(n.$$.fragment,s),t=!1},d(s){s&&h(e),be(n)}}}function Ae(l,e,n){let{schema:t}=e;return l.$$set=s=>{"schema"in s&&n(0,t=s.schema)},[t]}class lt extends D{constructor(e){super(),P(this,e,Ae,Ze,I,{schema:0})}}let T="interventions";function Qe(l,e,n){let t,s;V(l,j,p=>n(1,t=p)),V(l,oe,p=>n(2,s=p));let{schema:o}=e;ge(t,T,s);const i=["match",["get","intervention_type"],"area",k.area,"route",k.route,"crossing",k.crossing,"other",k.other,"white"],c=["match",["get","reference_type",["get","planning"]],"preapp",k.preapp,"outline",k.outline,"reserved matters",k["reserved matters"],"local plan",k["local plan"],"white"],u=["!=","hide_while_editing",!0];return A(t,{id:"interventions-points",source:T,filter:["all",he,u,["!=","endpoint",!0]],color:i,radius:qe}),ve(t,{id:"interventions-lines",source:T,filter:["all",we,u],color:i,width:K}),A(t,{id:"interventions-lines-endpoints",source:T,filter:["==","endpoint",!0],radius:.5*K,opacity:0,strokeColor:k.lineEndpointColor,strokeWidth:2}),ye(t,{id:"interventions-polygons",source:T,filter:["all",ke,u],color:o=="planning"?c:i,opacity:.5}),l.$$set=p=>{"schema"in p&&n(0,o=p.schema)},l.$$.update=()=>{if(l.$$.dirty&6){let p=JSON.parse(JSON.stringify(s)),m=[];for(let d of p.features)if(d.geometry.type=="LineString")for(let f of[d.geometry.coordinates[0],d.geometry.coordinates[d.geometry.coordinates.length-1]])m.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(m),t.getSource(T).setData(p)}},[o,t,s]}class ot extends D{constructor(e){super(),P(this,e,Qe,null,I,{schema:0})}}export{nt as B,je as C,ot as I,tt as L,st as M,Le as a,Be as b,k as c,xe as d,qe as e,Ce as f,oe as g,et as h,lt as i,K as l,j as m,Ke as n,Me as o,Ye as r,x as s,Oe as u};
