var Gi=Object.defineProperty;var Hi=(r,e,t)=>e in r?Gi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var se=(r,e,t)=>(Hi(r,typeof e!="symbol"?e+"":e,t),t);import{S as V,i as K,s as Z,b as ue,a as Ee,d as N,m as B,k as Me,n as $,o as O,q as D,e as E,c as A,g as w,E as G,p as k,F as Yi,G as Ji,H as re,I as Xi,v as Kn,J as Qe,K as we,L as _n,f as T,h as S,M as Zt,x as ae,t as z,A as Pe,N as Qt,O as De,P as ht,Q as gn,R as Ft,T as be,U as _t,V as Ke,l as U,W as de,X as me,Y as bn,j as Oe,r as Ae,Z as ai,_ as en,$ as cr,y as pr,w as zi,B as Wi,C as Vi,D as Ki,a0 as Zi,a1 as Qi,a2 as Ce,a3 as eo,a4 as to,a5 as vn,a6 as gt,a7 as yn,a8 as wn,a9 as Pn,aa as no,ab as pt,ac as Zn,ad as We,ae as dt,af as ro,ag as Qn,ah as io,ai as oo,aj as so,ak as hr,al as tn,am as lo,an as ao,ao as uo}from"./maplibre_helpers-79179479.js";import{M as fo,A as co,a as po}from"./authorities-86248eae.js";import{m as je,M as ho,r as nn,g as ne,l as Tt,s as rn,a as He,f as Se,o as on,b as sn,d as dr,F as mo,C as kn,c as he,e as Sn,n as Nt,L as _o,h as go}from"./CollapsibleCard-f3d9ee3a.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ui=Symbol("Comlink.proxy"),bo=Symbol("Comlink.endpoint"),vo=Symbol("Comlink.releaseProxy"),Mn=Symbol("Comlink.finalizer"),Ht=Symbol("Comlink.thrown"),fi=r=>typeof r=="object"&&r!==null||typeof r=="function",yo={canHandle:r=>fi(r)&&r[ui],serialize(r){const{port1:e,port2:t}=new MessageChannel;return er(r,e),[t,[t]]},deserialize(r){return r.start(),hi(r)}},wo={canHandle:r=>fi(r)&&Ht in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},ci=new Map([["proxy",yo],["throw",wo]]);function ko(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function er(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!ko(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(et);let u;try{const p=a.slice(0,-1).reduce((c,f)=>c[f],r),h=a.reduce((c,f)=>c[f],r);switch(s){case"GET":u=h;break;case"SET":p[a.slice(-1)[0]]=et(i.data.value),u=!0;break;case"APPLY":u=h.apply(p,l);break;case"CONSTRUCT":{const c=new h(...l);u=Oo(c)}break;case"ENDPOINT":{const{port1:c,port2:f}=new MessageChannel;er(r,f),u=Lo(c,[c])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[Ht]:0}}Promise.resolve(u).catch(p=>({value:p,[Ht]:0})).then(p=>{const[h,c]=un(p);e.postMessage(Object.assign(Object.assign({},h),{id:o}),c),s==="RELEASE"&&(e.removeEventListener("message",n),pi(e),Mn in r&&typeof r[Mn]=="function"&&r[Mn]())}).catch(p=>{const[h,c]=un({value:new TypeError("Unserializable return value"),[Ht]:0});e.postMessage(Object.assign(Object.assign({},h),{id:o}),c)})}),e.start&&e.start()}function So(r){return r.constructor.name==="MessagePort"}function pi(r){So(r)&&r.close()}function hi(r,e){return In(r,[],e)}function Ut(r){if(r)throw new Error("Proxy has been released and is not useable")}function di(r){return ut(r,{type:"RELEASE"}).then(()=>{pi(r)})}const ln=new WeakMap,an="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(ln.get(r)||0)-1;ln.set(r,e),e===0&&di(r)});function Eo(r,e){const t=(ln.get(e)||0)+1;ln.set(e,t),an&&an.register(r,e,r)}function Mo(r){an&&an.unregister(r)}function In(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(Ut(n),s===vo)return()=>{Mo(i),di(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=ut(r,{type:"GET",path:e.map(l=>l.toString())}).then(et);return a.then.bind(a)}return In(r,[...e,s])},set(o,s,a){Ut(n);const[l,u]=un(a);return ut(r,{type:"SET",path:[...e,s].map(p=>p.toString()),value:l},u).then(et)},apply(o,s,a){Ut(n);const l=e[e.length-1];if(l===bo)return ut(r,{type:"ENDPOINT"}).then(et);if(l==="bind")return In(r,e.slice(0,-1));const[u,p]=mr(a);return ut(r,{type:"APPLY",path:e.map(h=>h.toString()),argumentList:u},p).then(et)},construct(o,s){Ut(n);const[a,l]=mr(s);return ut(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(et)}});return Eo(i,r),i}function $o(r){return Array.prototype.concat.apply([],r)}function mr(r){const e=r.map(un);return[e.map(t=>t[0]),$o(e.map(t=>t[1]))]}const mi=new WeakMap;function Lo(r,e){return mi.set(r,e),r}function Oo(r){return Object.assign(r,{[ui]:!0})}function un(r){for(const[e,t]of ci)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},mi.get(r)||[]]}function et(r){switch(r.type){case"HANDLER":return ci.get(r.name).deserialize(r.value);case"RAW":return r.value}}function ut(r,e,t){return new Promise(n=>{const i=Ao();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function Ao(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Ro(){return new Worker("/atip/scheme_overview/assets/worker-e60eed5b.js")}let Q;const _i=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&_i.decode();let kt=null;function Lt(){return(kt===null||kt.byteLength===0)&&(kt=new Uint8Array(Q.memory.buffer)),kt}function tt(r,e){return r=r>>>0,_i.decode(Lt().subarray(r,r+e))}const qe=new Array(128).fill(void 0);qe.push(void 0,null,!0,!1);let Ot=qe.length;function ge(r){Ot===qe.length&&qe.push(qe.length+1);const e=Ot;return Ot=qe[e],qe[e]=r,e}function H(r){return qe[r]}let rt=0;const Yt=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},xo=typeof Yt.encodeInto=="function"?function(r,e){return Yt.encodeInto(r,e)}:function(r,e){const t=Yt.encode(r);return e.set(t),{read:r.length,written:t.length}};function $n(r,e,t){if(t===void 0){const a=Yt.encode(r),l=e(a.length)>>>0;return Lt().subarray(l,l+a.length).set(a),rt=a.length,l}let n=r.length,i=e(n)>>>0;const o=Lt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3)>>>0;const a=Lt().subarray(i+s,i+n),l=xo(r,a);s+=l.written}return rt=s,i}function bt(r){return r==null}let St=null;function ce(){return(St===null||St.byteLength===0)&&(St=new Int32Array(Q.memory.buffer)),St}function Co(r){r<132||(qe[r]=Ot,Ot=r)}function Et(r){const e=H(r);return Co(r),e}let Mt=null;function To(){return(Mt===null||Mt.byteLength===0)&&(Mt=new Float64Array(Q.memory.buffer)),Mt}let $t=null;function Po(){return($t===null||$t.byteLength===0)&&($t=new BigInt64Array(Q.memory.buffer)),$t}function Fn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Fn(r[0]));for(let s=1;s<i;s++)o+=", "+Fn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Io(r,e){const t=e(r.length*1)>>>0;return Lt().set(r,t/1),rt=r.length,t}function Ln(r,e){try{return r.apply(this,e)}catch(t){Q.__wbindgen_exn_store(ge(t))}}let Nn=class{static __wrap(e){e=e>>>0;const t=Object.create(Nn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Q.__wbg_routeinfo_free(e)}constructor(e){try{const o=Q.__wbindgen_add_to_stack_pointer(-16),s=Io(e,Q.__wbindgen_malloc),a=rt;Q.routeinfo_new(o,s,a);var t=ce()[o/4+0],n=ce()[o/4+1],i=ce()[o/4+2];if(i)throw Et(n);return Nn.__wrap(t)}finally{Q.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const p=Q.__wbindgen_add_to_stack_pointer(-16);Q.routeinfo_nameForRoute(p,this.__wbg_ptr,ge(e));var i=ce()[p/4+0],o=ce()[p/4+1],s=ce()[p/4+2],a=ce()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,Et(s);return t=l,n=u,tt(l,u)}finally{Q.__wbindgen_add_to_stack_pointer(16),Q.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const p=Q.__wbindgen_add_to_stack_pointer(-16);Q.routeinfo_speedLimitForRoute(p,this.__wbg_ptr,ge(e));var i=ce()[p/4+0],o=ce()[p/4+1],s=ce()[p/4+2],a=ce()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,Et(s);return t=l,n=u,tt(l,u)}finally{Q.__wbindgen_add_to_stack_pointer(16),Q.__wbindgen_free(t,n)}}allSpeedLimits(){let e,t;try{const u=Q.__wbindgen_add_to_stack_pointer(-16);Q.routeinfo_allSpeedLimits(u,this.__wbg_ptr);var n=ce()[u/4+0],i=ce()[u/4+1],o=ce()[u/4+2],s=ce()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,Et(o);return e=a,t=l,tt(a,l)}finally{Q.__wbindgen_add_to_stack_pointer(16),Q.__wbindgen_free(e,t)}}};async function Fo(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function No(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=tt(e,t);return ge(n)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(tt(e,t));return ge(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=H(t),i=typeof n=="string"?n:void 0;var o=bt(i)?0:$n(i,Q.__wbindgen_malloc,Q.__wbindgen_realloc),s=rt;ce()[e/4+1]=s,ce()[e/4+0]=o},r.wbg.__wbindgen_object_drop_ref=function(e){Et(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=H(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof H(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return ge(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return H(e)===H(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=H(t),i=typeof n=="number"?n:void 0;To()[e/8+1]=bt(i)?0:i,ce()[e/4+0]=!bt(i)},r.wbg.__wbindgen_is_object=function(e){const t=H(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return H(e)in H(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ge(t)},r.wbg.__wbindgen_is_undefined=function(e){return H(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return H(e)==H(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=H(e);return ge(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=H(e)[H(t)];return ge(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=H(t).stack,i=$n(n,Q.__wbindgen_malloc,Q.__wbindgen_realloc),o=rt;ce()[e/4+1]=o,ce()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(tt(e,t))}finally{Q.__wbindgen_free(n,i)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(H(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(H(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(H(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(H(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(H(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=H(e)[t>>>0];return ge(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return H(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof H(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=H(e).next;return ge(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return Ln(function(e){const t=H(e).next();return ge(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return H(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=H(e).value;return ge(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return ge(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return Ln(function(e,t){const n=Reflect.get(H(e),H(t));return ge(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return Ln(function(e,t){const n=H(e).call(H(t));return ge(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(H(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=H(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(H(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(H(e));return ge(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=H(e).buffer;return ge(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(H(e));return ge(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){H(e).set(H(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return H(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=H(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=H(t),i=typeof n=="bigint"?n:void 0;Po()[e/8+1]=bt(i)?BigInt(0):i,ce()[e/4+0]=!bt(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Fn(H(t)),i=$n(n,Q.__wbindgen_malloc,Q.__wbindgen_realloc),o=rt;ce()[e/4+1]=o,ce()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(tt(e,t))},r.wbg.__wbindgen_memory=function(){const e=Q.memory;return ge(e)},r}function Bo(r,e){return Q=r.exports,gi.__wbindgen_wasm_module=e,$t=null,Mt=null,St=null,kt=null,Q}async function gi(r){if(Q!==void 0)return Q;typeof r>"u"&&(r="/atip/scheme_overview/assets/route_info_bg.wasm");const e=No();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Fo(await r,e);return Bo(t,n)}class Do{constructor(){se(this,"inner");this.inner=null}async loadFile(e){await gi(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new Nn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.speedLimitForRoute(e)}allSpeedLimits(){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.allSpeedLimits()}}er(Do);function jo(r){let e,t,n,i,o,s,a,l,u,p,h,c,f;return{c(){e=E("p"),e.textContent="For each intervention:",t=A(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=A(),o=E("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=A(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=A(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=A(),h=E("p"),h.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=A(),f=E("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(d,g){w(d,e,g),w(d,t,g),w(d,n,g),w(d,i,g),w(d,o,g),w(d,s,g),w(d,a,g),w(d,l,g),w(d,u,g),w(d,p,g),w(d,h,g),w(d,c,g),w(d,f,g)},p:G,d(d){d&&k(e),d&&k(t),d&&k(n),d&&k(i),d&&k(o),d&&k(s),d&&k(a),d&&k(l),d&&k(u),d&&k(p),d&&k(h),d&&k(c),d&&k(f)}}}function Uo(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[jo]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new fo({props:o}),ue.push(()=>Ee(e,"open",i,r[0])),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function qo(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Go extends V{constructor(e){super(),K(this,e,qo,Uo,Z,{open:0})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Ho(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ze=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Yo(r,e){return r>e?1:r<e?-1:0}function Ye(r,e,t){for(var n=new Ze(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function On(r,e,t,n){var i=new Ze(r,e);if(t===null)return i.left=i.right=null,i;t=Ye(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function _r(r,e,t){var n=null,i=null;if(e){e=Ye(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Jo(r,e,t){return e===null?r:(r===null||(e=Ye(r.key,e,t),e.left=r),e)}function Bn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Bn(r.left,o,!1,n,i),r.right&&Bn(r.right,o,!0,n,i)}}var tr=function(){function r(e){e===void 0&&(e=Yo),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=On(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ze(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ye(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ye(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ye(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ye(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ye(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return zo(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Un(e,t,0,i-1,o),this._root===null)this._root=Dn(e,t,0,i),this._size=i;else{var s=Wo(this.toList(),Xo(e,t),o);i=this._size+i,this._root=jn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Bn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=_r(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=On(t,n,a,i):s=On(t,n,s,i),this._root=Jo(s,a,i)},r.prototype.split=function(e){return _r(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Ho(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Dn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ze(s,a);return l.left=Dn(r,e,t,o),l.right=Dn(r,e,o+1,n),l}return null}function Xo(r,e){for(var t=new Ze(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ze(r[i],e[i]);return n.next=null,t.next}function zo(r){for(var e=r,t=[],n=!1,i=new Ze(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function jn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=jn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=jn(r,i+1,t),s}return null}function Wo(r,e,t){for(var n=new Ze(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Un(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Un(r,e,t,a,i),Un(r,e,a+1,n,i)}}function Re(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function gr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function $e(r,e,t){return e&&gr(r.prototype,e),t&&gr(r,t),r}var vt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},qn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Xe=Number.EPSILON;Xe===void 0&&(Xe=Math.pow(2,-52));var Vo=Xe*Xe,Gn=function(e,t){if(-Xe<e&&e<Xe&&-Xe<t&&t<Xe)return 0;var n=e-t;return n*n<Vo*e*t?0:e<t?-1:1},Ko=function(){function r(){Re(this,r),this.reset()}return $e(r,[{key:"reset",value:function(){this.xRounder=new br,this.yRounder=new br}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),br=function(){function r(){Re(this,r),this.tree=new tr,this.round(0)}return $e(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Gn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Gn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Pt=new Ko,At=function(e,t){return e.x*t.y-e.y*t.x},bi=function(e,t){return e.x*t.x+e.y*t.y},vr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=At(i,o);return Gn(s,0)},fn=function(e){return Math.sqrt(bi(e,e))},Zo=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return At(o,i)/fn(o)/fn(i)},Qo=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return bi(o,i)/fn(o)/fn(i)},yr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},wr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},es=function(e,t,n,i){if(t.x===0)return wr(n,i,e.x);if(i.x===0)return wr(e,t,n.x);if(t.y===0)return yr(n,i,e.y);if(i.y===0)return yr(e,t,n.y);var o=At(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=At(s,t)/o,l=At(s,i)/o,u=e.x+l*t.x,p=n.x+a*i.x,h=e.y+l*t.y,c=n.y+a*i.y,f=(u+p)/2,d=(h+c)/2;return{x:f,y:d}},Ne=function(){$e(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:cn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Re(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return $e(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:Zo(n.point,t.point,l.point),cosine:Qo(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,p=l.cosine,h=i.get(a),c=h.sine,f=h.cosine;return u>=0&&c>=0?p<f?1:p>f?-1:0:u<0&&c<0?p<f?-1:p>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),ts=0,cn=function(){$e(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,h=n.rightSE.point.y;if(i<o){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<h)return-1;if(l>u&&l>h)return 1;var d=n.comparePoint(t.leftSE.point);if(d!==0)return d;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var m=n.comparePoint(t.rightSE.point);if(m!==0)return m}if(s>a){var b=t.comparePoint(n.rightSE.point);if(b<0)return 1;if(b>0)return-1}if(s!==a){var _=p-l,v=s-i,y=h-u,M=a-o;if(_>v&&y<M)return 1;if(_<v&&y>M)return-1}return s>a?1:s<a||p<h?-1:p>h?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Re(this,r),this.id=++ts,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return $e(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=qn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=vt(n,l)&&this.comparePoint(l)===0,h=vt(i,s)&&t.comparePoint(s)===0,c=vt(n,u)&&this.comparePoint(u)===0,f=vt(i,a)&&t.comparePoint(a)===0;if(h&&p)return f&&!c?a:!f&&c?u:null;if(h)return c&&s.x===u.x&&s.y===u.y?null:s;if(p)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var d=es(s,this.vector(),l,t.vector());return d===null||!vt(o,d)?null:Pt.round(d.x,d.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Ne(t,!0),s=new Ne(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Ne.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ne.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var p=i.rings[l],h=i.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(h)):n.windings[c]+=h}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),i.push(u)):i[p]+=u}for(var h=[],c=[],f=0,d=n.length;f<d;f++)if(i[f]!==0){var g=n[f],m=g.poly;if(c.indexOf(m)===-1)if(g.isExterior)h.push(m);else{c.indexOf(m)===-1&&c.push(m);var b=h.indexOf(g.poly);b!==-1&&h.splice(b,1)}}for(var _=0,v=h.length;_<v;_++){var y=h[_].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Te.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Te.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(h){return h.length===1&&h[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Te.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Ne.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Ne(o,!0),p=new Ne(s,!1);return new r(u,p,[i],[a])}}]),r}(),kr=function(){function r(e,t,n){if(Re(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Pt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Pt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(cn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(cn.fromRing(o,i,this))}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),ns=function(){function r(e,t){if(Re(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new kr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new kr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Sr=function(){function r(e,t){if(Re(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new ns(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),rs=function(){$e(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],h=l.point,c=[];a=l,l=u,p.push(l),l.point!==h;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var d=p[0].point,g=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var m=null,b=0,_=c.length;b<_;b++)if(c[b].point===l.point){m=b;break}if(m!==null){var v=c.splice(m)[0],y=p.splice(v.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}c.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Re(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return $e(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;vr(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];vr(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],d=h;d!=c;d+=p)f.push([n[d].x,n[d].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Ne.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Er=function(){function r(e){Re(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return $e(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),is=function(){function r(e){Re(this,r),this.rings=e,this.polys=this._composePolys(e)}return $e(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Er(s));else{var a=s.enclosingRing();a.poly||n.push(new Er(a)),a.poly.addInterior(s)}}return n}}]),r}(),os=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:cn.compare;Re(this,r),this.queue=e,this.tree=new tr(t),this.segments=[]}return $e(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var h=l.getIntersection(n);if(h!==null&&(n.isAnEndpoint(h)||(p=h),!l.isAnEndpoint(h)))for(var c=this._splitSafely(l,h),f=0,d=c.length;f<d;f++)i.push(c[f])}var g=null;if(u){var m=u.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(g=m),!u.isAnEndpoint(m)))for(var b=this._splitSafely(u,m),_=0,v=b.length;_<v;_++)i.push(b[_])}if(p!==null||g!==null){var y=null;if(p===null)y=g;else if(g===null)y=p;else{var M=Ne.comparePoints(p,g);y=M<=0?p:g}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var L=n.split(y),C=0,R=L.length;C<R;C++)i.push(L[C])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var F=l.getIntersection(u);if(F!==null){if(!l.isAnEndpoint(F))for(var x=this._splitSafely(l,F),P=0,q=x.length;P<q;P++)i.push(x[P]);if(!u.isAnEndpoint(F))for(var Y=this._splitSafely(u,F),te=0,le=Y.length;te<le;te++)i.push(Y[te])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Mr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ss=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ls=function(){function r(){Re(this,r)}return $e(r,[{key:"run",value:function(t,n,i){Te.type=t,Pt.reset();for(var o=[new Sr(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Sr(i[s],!1));if(Te.numMultiPolys=o.length,Te.type==="difference")for(var l=o[0],u=1;u<o.length;)qn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Te.type==="intersection"){for(var p=0,h=o.length;p<h;p++)for(var c=o[p],f=p+1,d=o.length;f<d;f++)if(qn(c.bbox,o[f].bbox)===null)return[]}for(var g=new tr(Ne.compare),m=0,b=o.length;m<b;m++)for(var _=o[m].getSweepEvents(),v=0,y=_.length;v<y;v++)if(g.insert(_[v]),g.size>Mr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new os(g),L=g.size,C=g.pop();C;){var R=C.key;if(g.size===L){var F=R.segment;throw new Error("Unable to pop() ".concat(R.isLeft?"left":"right"," SweepEvent ")+"[".concat(R.point.x,", ").concat(R.point.y,"] from segment #").concat(F.id," ")+"[".concat(F.leftSE.point.x,", ").concat(F.leftSE.point.y,"] -> ")+"[".concat(F.rightSE.point.x,", ").concat(F.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Mr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>ss)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var x=M.process(R),P=0,q=x.length;P<q;P++){var Y=x[P];Y.consumedBy===void 0&&g.insert(Y)}L=g.size,C=g.pop()}Pt.reset();var te=rs.factory(M.segments),le=new is(te);return le.getGeom()}}]),r}(),Te=new ls,as=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Te.run("union",e,n)},us=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Te.run("intersection",e,n)},fs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Te.run("xor",e,n)},cs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Te.run("difference",e,n)},Jt={union:as,intersection:us,xor:fs,difference:cs};function ps(r,e){var t=ds(e),n=null;return r.type==="FeatureCollection"?n=hs(r):n=vi(Jt.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function hs(r){var e=r.features.length===2?Jt.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Jt.union.apply(Jt,r.features.map(function(t){return t.geometry.coordinates}));return vi(e)}function vi(r){return Yi(r)}function ds(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return Ji(t)}function ms(r,e,t){let n;re(r,je,s=>t(1,n=s));let{boundaryGeojson:i}=e;return Xi("setCamera")&&n.fitBounds(Kn(i),{padding:20,animate:!1}),Qe(n,"boundary",ps(i)),we(n,{id:"boundary",source:"boundary",..._n("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class _s extends V{constructor(e){super(),K(this,e,ms,null,Z,{boundaryGeojson:0})}}function $r(r,e,t){const n=r.slice();return n[3]=e[t],n}function Lr(r,e,t){const n=r.slice();return n[6]=e[t],n}function Or(r){let e;return{c(){e=E("td"),T(e,"class","svelte-11t6rxo"),ae(e,"background-color",r[6])},m(t,n){w(t,e,n)},p(t,n){n&1&&ae(e,"background-color",t[6])},d(t){t&&k(e)}}}function Ar(r){let e,t=r[3]+"",n;return{c(){e=E("td"),n=z(t),T(e,"class","svelte-11t6rxo"),ae(e,"width",r[2])},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[3]+"")&&Pe(n,t)},d(i){i&&k(e)}}}function gs(r){let e,t,n,i,o=r[0],s=[];for(let u=0;u<o.length;u+=1)s[u]=Or(Lr(r,o,u));let a=r[1],l=[];for(let u=0;u<a.length;u+=1)l[u]=Ar($r(r,a,u));return{c(){e=E("table"),t=E("tr");for(let u=0;u<s.length;u+=1)s[u].c();n=A(),i=E("tr");for(let u=0;u<l.length;u+=1)l[u].c();T(t,"class","svelte-11t6rxo"),T(i,"class","svelte-11t6rxo"),T(e,"class","svelte-11t6rxo")},m(u,p){w(u,e,p),S(e,t);for(let h=0;h<s.length;h+=1)s[h].m(t,null);S(e,n),S(e,i);for(let h=0;h<l.length;h+=1)l[h].m(i,null)},p(u,[p]){if(p&1){o=u[0];let h;for(h=0;h<o.length;h+=1){const c=Lr(u,o,h);s[h]?s[h].p(c,p):(s[h]=Or(c),s[h].c(),s[h].m(t,null))}for(;h<s.length;h+=1)s[h].d(1);s.length=o.length}if(p&6){a=u[1];let h;for(h=0;h<a.length;h+=1){const c=$r(u,a,h);l[h]?l[h].p(c,p):(l[h]=Ar(c),l[h].c(),l[h].m(i,null))}for(;h<l.length;h+=1)l[h].d(1);l.length=a.length}},i:G,o:G,d(u){u&&k(e),Zt(s,u),Zt(l,u)}}}function bs(r,e,t){let{colors:n}=e,{labels:i}=e;if(n.length!=i.length)throw new Error("colors and labels must match");let o=`${100/n.length}%`;return r.$$set=s=>{"colors"in s&&t(0,n=s.colors),"labels"in s&&t(1,i=s.labels)},[n,i,o]}class vs extends V{constructor(e){super(),K(this,e,bs,gs,Z,{colors:0,labels:1})}}const ys="/atip/scheme_overview/assets/help-d011708a.svg";function ws(r){let e,t;return{c(){e=E("img"),Qt(e.src,t=ys)||T(e,"src",t),T(e,"title",r[0]),T(e,"alt",r[0])},m(n,i){w(n,e,i)},p(n,[i]){i&1&&T(e,"title",n[0]),i&1&&T(e,"alt",n[0])},i:G,o:G,d(n){n&&k(e)}}}function ks(r,e,t){let{contents:n}=e;return r.$$set=i=>{"contents"in i&&t(0,n=i.contents)},[n]}class Ss extends V{constructor(e){super(),K(this,e,ks,ws,Z,{contents:0})}}function Es(r){let e,t,n,i,o,s,a;return t=new Ss({props:{contents:"Data comes from OpenStreetMap, and may not always be correct. Unexpected values are treated as unknown. Freehand route segments and off-road paths generally have no speed data."}}),i=new vs({props:{colors:r[0],labels:["< 20","20","30","40",">= 50"]}}),s=new ho({props:{layers:["speed-limits"],contents:$s}}),{c(){e=z(`(mph)
`),N(t.$$.fragment),n=A(),N(i.$$.fragment),o=A(),N(s.$$.fragment)},m(l,u){w(l,e,u),B(t,l,u),w(l,n,u),B(i,l,u),w(l,o,u),B(s,l,u),a=!0},p:G,i(l){a||($(t.$$.fragment,l),$(i.$$.fragment,l),$(s.$$.fragment,l),a=!0)},o(l){O(t.$$.fragment,l),O(i.$$.fragment,l),O(s.$$.fragment,l),a=!1},d(l){l&&k(e),D(t,l),l&&k(n),D(i,l),l&&k(o),D(s,l)}}}let Ms="white",it="speed-limits",An="speed-limits",yt=.8;function $s(r){return r.speed_limit?`${Math.round(r.speed_limit)} mph`:"Unknown"}function Ls(r,e,t){let n,i,o;re(r,je,p=>t(2,n=p)),re(r,nn,p=>t(3,i=p)),re(r,ne,p=>t(4,o=p));let{id:s}=e,a=["#00AB4D","#8ECA4D","#F7BB00","#BB0000","#470000"];const l=["case",["<",["get","speed_limit"],20],a[0],["==",["get","speed_limit"],20],a[1],["==",["get","speed_limit"],30],a[2],["==",["get","speed_limit"],40],a[3],[">=",["get","speed_limit"],50],a[4],Ms],u=["case",["<",["get","speed_limit"],20],yt,["==",["get","speed_limit"],20],yt,["==",["get","speed_limit"],30],yt,["==",["get","speed_limit"],40],yt,[">=",["get","speed_limit"],50],yt,0];return Qe(n,it,De()),we(n,{id:An,source:it,...ht(l,Tt,u)}),gn(async()=>{try{if(s){let p=o.features.find(c=>c.id==s),h=JSON.parse(await i.speedLimitForRoute(p.properties.waypoints));n.getSource(it).setData(h)}else{let p=JSON.parse(await i.allSpeedLimits());n.getSource(it).setData(p)}}catch(p){window.alert(`Couldn't calculate speed limits for route: ${p}`)}}),Ft(()=>{n.getLayer(An)&&n.removeLayer(An),n.getSource(it)&&n.removeSource(it)}),r.$$set=p=>{"id"in p&&t(1,s=p.id)},[a,s]}class yi extends V{constructor(e){super(),K(this,e,Ls,Es,Z,{id:1})}}function Rr(r){let e,t;return e=new yi({props:{id:r[0]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.id=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Os(r){let e,t,n,i,o,s,a,l,u,p,h=r[1]=="speed limits"&&Rr(r);return{c(){e=E("label"),t=z(`Show details:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",s=A(),h&&h.c(),a=be(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,r[1]===void 0&&_t(()=>r[2].call(n))},m(c,f){w(c,e,f),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[1]),w(c,s,f),h&&h.m(c,f),w(c,a,f),l=!0,u||(p=U(n,"change",r[2]),u=!0)},p(c,[f]){f&2&&Ke(n,c[1]),c[1]=="speed limits"?h?(h.p(c,f),f&2&&$(h,1)):(h=Rr(c),h.c(),$(h,1),h.m(a.parentNode,a)):h&&(de(),O(h,1,1,()=>{h=null}),me())},i(c){l||($(h),l=!0)},o(c){O(h),l=!1},d(c){c&&k(e),c&&k(s),h&&h.d(c),c&&k(a),u=!1,p()}}}function As(r,e,t){let{id:n}=e,i="none";function o(){i=bn(this),t(1,i)}return r.$$set=s=>{"id"in s&&t(0,n=s.id)},[n,i,o]}class Rs extends V{constructor(e){super(),K(this,e,As,Os,Z,{id:0})}}function xr(r){let e,t=Cr(r[4])+"",n,i,o,s,a,l,u,p,h,c;return u=new Rs({props:{id:r[3]}}),{c(){e=z("Length: "),n=z(t),i=A(),o=E("br"),s=E("button"),s.textContent="Auto-fill details",a=E("br"),l=A(),N(u.$$.fragment),T(s,"type","button")},m(f,d){w(f,e,d),w(f,n,d),w(f,i,d),w(f,o,d),w(f,s,d),w(f,a,d),w(f,l,d),B(u,f,d),p=!0,h||(c=U(s,"click",r[13]),h=!0)},p(f,d){(!p||d&16)&&t!==(t=Cr(f[4])+"")&&Pe(n,t);const g={};d&8&&(g.id=f[3]),u.$set(g)},i(f){p||($(u.$$.fragment,f),p=!0)},o(f){O(u.$$.fragment,f),p=!1},d(f){f&&k(e),f&&k(n),f&&k(i),f&&k(o),f&&k(s),f&&k(a),f&&k(l),D(u,f),h=!1,c()}}}function xs(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,d,g,m,b,_,v,y,M,L,C,R,F,x,P,q,Y,te,le,ke,xe,oe,ie,Ie,Le,W,pe,Dt,_e=r[4]&&xr(r);return{c(){e=E("label"),t=z("Name:"),n=E("br"),i=A(),o=E("input"),s=A(),a=E("br"),l=A(),u=E("br"),p=A(),h=E("label"),c=E("input"),f=z(`
  Area`),d=A(),g=E("label"),m=E("input"),b=z(`
  Route`),_=A(),v=E("label"),y=E("input"),M=z(`
  Crossing`),L=A(),C=E("label"),R=E("input"),F=z(`
  Other`),x=A(),P=E("br"),q=A(),Y=E("br"),te=A(),le=E("label"),ke=z("Description:"),xe=E("br"),oe=A(),ie=E("textarea"),Ie=A(),_e&&_e.c(),Le=be(),T(o,"type","text"),ae(o,"width","100%"),T(c,"type","radio"),c.__value="area",c.value=c.__value,r[8][0].push(c),T(m,"type","radio"),m.__value="route",m.value=m.__value,r[8][0].push(m),T(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[8][0].push(y),T(R,"type","radio"),R.__value="other",R.value=R.__value,r[8][0].push(R),ae(ie,"width","100%"),T(ie,"rows","5"),T(ie,"class","svelte-15lna0i")},m(I,ee){w(I,e,ee),S(e,t),S(e,n),S(e,i),S(e,o),Oe(o,r[0]),w(I,s,ee),w(I,a,ee),w(I,l,ee),w(I,u,ee),w(I,p,ee),w(I,h,ee),S(h,c),c.checked=c.__value===r[1],S(h,f),w(I,d,ee),w(I,g,ee),S(g,m),m.checked=m.__value===r[1],S(g,b),w(I,_,ee),w(I,v,ee),S(v,y),y.checked=y.__value===r[1],S(v,M),w(I,L,ee),w(I,C,ee),S(C,R),R.checked=R.__value===r[1],S(C,F),w(I,x,ee),w(I,P,ee),w(I,q,ee),w(I,Y,ee),w(I,te,ee),w(I,le,ee),S(le,ke),S(le,xe),S(le,oe),S(le,ie),Oe(ie,r[2]),w(I,Ie,ee),_e&&_e.m(I,ee),w(I,Le,ee),W=!0,pe||(Dt=[U(o,"input",r[6]),U(c,"change",r[7]),U(m,"change",r[9]),U(y,"change",r[10]),U(R,"change",r[11]),U(ie,"input",r[12])],pe=!0)},p(I,[ee]){ee&1&&o.value!==I[0]&&Oe(o,I[0]),ee&2&&(c.checked=c.__value===I[1]),ee&2&&(m.checked=m.__value===I[1]),ee&2&&(y.checked=y.__value===I[1]),ee&2&&(R.checked=R.__value===I[1]),ee&4&&Oe(ie,I[2]),I[4]?_e?(_e.p(I,ee),ee&16&&$(_e,1)):(_e=xr(I),_e.c(),$(_e,1),_e.m(Le.parentNode,Le)):_e&&(de(),O(_e,1,1,()=>{_e=null}),me())},i(I){W||($(_e),W=!0)},o(I){O(_e),W=!1},d(I){I&&k(e),I&&k(s),I&&k(a),I&&k(l),I&&k(u),I&&k(p),I&&k(h),r[8][0].splice(r[8][0].indexOf(c),1),I&&k(d),I&&k(g),r[8][0].splice(r[8][0].indexOf(m),1),I&&k(_),I&&k(v),r[8][0].splice(r[8][0].indexOf(y),1),I&&k(L),I&&k(C),r[8][0].splice(r[8][0].indexOf(R),1),I&&k(x),I&&k(P),I&&k(q),I&&k(Y),I&&k(te),I&&k(le),I&&k(Ie),_e&&_e.d(I),I&&k(Le),pe=!1,Ae(Dt)}}}function Cr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Cs(r,e,t){let n,i;re(r,nn,v=>t(14,n=v)),re(r,ne,v=>t(15,i=v));let{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function p(){let v=i.features.find(y=>y.id==o);try{t(0,s=await n.nameForRoute(v))}catch(y){window.alert(`Couldn't auto-name route: ${y}`)}}const h=[[]];function c(){s=this.value,t(0,s)}function f(){a=this.__value,t(1,a)}function d(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function m(){a=this.__value,t(1,a)}function b(){l=this.value,t(2,l)}const _=()=>p();return r.$$set=v=>{"id"in v&&t(3,o=v.id),"name"in v&&t(0,s=v.name),"intervention_type"in v&&t(1,a=v.intervention_type),"description"in v&&t(2,l=v.description),"length_meters"in v&&t(4,u=v.length_meters)},[s,a,l,o,u,p,c,f,h,d,g,m,b,_]}class Ts extends V{constructor(e){super(),K(this,e,Cs,xs,Z,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}const Ps="Intervention",Is=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],Fs={name:Ps,oneOf:Is};function wi(r){return"members"in r}function ki(r){return"oneOf"in r}function Si(r){return typeof r=="string"}function Ei(r){return typeof r=="object"&&"value"in r}function Ns(r){return"type"in r&&r.type=="number"}function Mi(r){return"type"in r&&r.type=="one-liner"}function $i(r){return"type"in r&&r.type=="textbox"}function Li(r){return"type"in r&&r.type=="checkbox"}function Tr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Pr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Ir(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=z(t),T(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&Pe(n,t)},d(i){i&&k(e)}}}function Bs(r){let e,t,n;return{c(){e=E("input"),T(e,"type","checkbox")},m(i,o){w(i,e,o),e.checked=r[0],t||(n=U(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function Ds(r){let e,t,n;return{c(){e=E("textarea"),ae(e,"width","100%"),T(e,"rows","5"),T(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),Oe(e,r[0]),t||(n=U(e,"input",r[13]),t=!0)},p(i,o){o&1&&Oe(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function js(r){let e,t,n;return{c(){e=E("input"),T(e,"type","text"),ae(e,"width","100%")},m(i,o){w(i,e,o),Oe(e,r[0]),t||(n=U(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Oe(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function Us(r){let e,t,n;return{c(){e=E("input"),T(e,"type","number")},m(i,o){w(i,e,o),Oe(e,r[0]),t||(n=U(e,"input",r[11]),t=!0)},p(i,o){o&1&&ai(e.value)!==i[0]&&Oe(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function qs(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=Nr(Tr(r,n,s));const o=s=>O(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=be()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Tr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=Nr(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(de(),l=n.length;l<i.length;l+=1)o(l);me()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)O(i[a]);t=!1},d(s){Zt(i,s),s&&k(e)}}}function Gs(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=Br(Pr(r,n,s));const o=s=>O(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=be()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Pr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=Br(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(de(),l=n.length;l<i.length;l+=1)o(l);me()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)O(i[a]);t=!1},d(s){Zt(i,s),s&&k(e)}}}function Hs(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,p,h,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&Fr(r);return{c(){e=E("label"),t=E("input"),i=A(),s=z(o),a=E("br"),l=A(),f&&f.c(),u=be(),T(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(d,g){w(d,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),w(d,l,g),f&&f.m(d,g),w(d,u,g),p=!0,h||(c=[U(t,"change",r[9]),U(t,"change",r[4])],h=!0)},p(d,g){(!p||g&2&&n!==(n=d[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===d[2]),(!p||g&2)&&o!==(o=d[15].name+"")&&Pe(s,o),d[2]==d[15].name&&typeof d[0]=="object"?f?(f.p(d,g),g&7&&$(f,1)):(f=Fr(d),f.c(),$(f,1),f.m(u.parentNode,u)):f&&(de(),O(f,1,1,()=>{f=null}),me())},i(d){p||($(f),p=!0)},o(d){O(f),p=!1},d(d){d&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),d&&k(l),f&&f.d(d),d&&k(u),h=!1,Ae(c)}}}function Ys(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,p;function h(d,g){return d[15].description?zs:Xs}let c=h(r),f=c(r);return{c(){e=E("label"),t=E("input"),i=A(),s=z(o),a=A(),f.c(),l=A(),T(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(d,g){w(d,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),f.m(e,null),S(e,l),u||(p=[U(t,"change",r[8]),U(t,"change",r[3])],u=!0)},p(d,g){g&2&&n!==(n=d[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===d[2]),g&2&&o!==(o=d[15].value+"")&&Pe(s,o),c===(c=h(d))&&f?f.p(d,g):(f.d(1),f=c(d),f&&(f.c(),f.m(e,l)))},i:G,o:G,d(d){d&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Ae(p)}}}function Js(r){let e,t,n,i,o=r[15]+"",s,a,l,u,p,h;return{c(){e=E("label"),t=E("input"),i=A(),s=z(o),a=A(),l=E("br"),u=A(),T(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){w(c,e,f),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),S(e,l),S(e,u),p||(h=[U(t,"change",r[6]),U(t,"change",r[3])],p=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&o!==(o=c[15]+"")&&Pe(s,o)},i:G,o:G,d(c){c&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,Ae(h)}}}function Fr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Bt({props:l}),ue.push(()=>Ee(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),N(t.$$.fragment),i=A(),T(e,"class","svelte-1b72l00")},m(u,p){w(u,e,p),B(t,e,null),S(e,i),s=!0},p(u,p){r=u;const h={};p&2&&(h.spec=r[15]),!n&&p&3&&(n=!0,h.value=r[0][r[15].name],Me(()=>n=!1)),t.$set(h)},i(u){s||($(t.$$.fragment,u),_t(()=>{o||(o=en(e,rn,{duration:500},!0)),o.run(1)}),s=!0)},o(u){O(t.$$.fragment,u),o||(o=en(e,rn,{duration:500},!1)),o.run(0),s=!1},d(u){u&&k(e),D(t),u&&o&&o.end()}}}function Xs(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function zs(r){let e,t,n=r[15].description+"",i,o;return{c(){e=E("p"),t=z("("),i=z(n),o=z(")"),T(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,i),S(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&Pe(i,n)},d(s){s&&k(e)}}}function Nr(r){let e,t,n,i,o,s;const a=[Js,Ys,Hs],l=[];function u(p,h){return h&2&&(e=null),h&2&&(t=null),e==null&&(e=!!Si(p[15])),e?0:(t==null&&(t=!!Ei(p[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=be()},m(p,h){l[n].m(p,h),w(p,o,h),s=!0},p(p,h){let c=n;n=u(p,h),n===c?l[n].p(p,h):(de(),O(l[c],1,1,()=>{l[c]=null}),me(),i=l[n],i?i.p(p,h):(i=l[n]=a[n](p),i.c()),$(i,1),i.m(o.parentNode,o))},i(p){s||($(i),s=!0)},o(p){O(i),s=!1},d(p){l[n].d(p),p&&k(o)}}}function Br(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function p(c){r[5](c,r[15])}let h={spec:r[15]};return r[0][r[15].name]!==void 0&&(h.value=r[0][r[15].name]),s=new Bt({props:h}),ue.push(()=>Ee(s,"value",p,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),i=z(n),o=A(),N(s.$$.fragment),l=A(),T(e,"class","svelte-1b72l00")},m(c,f){w(c,e,f),S(e,t),S(t,i),S(e,o),B(s,e,null),S(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&Pe(i,n);const d={};f&2&&(d.spec=r[15]),!a&&f&3&&(a=!0,d.value=r[0][r[15].name],Me(()=>a=!1)),s.$set(d)},i(c){u||($(s.$$.fragment,c),u=!0)},o(c){O(s.$$.fragment,c),u=!1},d(c){c&&k(e),D(s)}}}function Ws(r){let e,t,n,i,o,s,a,l,u,p,h,c=r[1].description&&Ir(r);const f=[Gs,qs,Us,js,Ds,Bs],d=[];function g(m,b){return b&2&&(t=null),b&2&&(n=null),b&2&&(i=null),b&2&&(o=null),b&2&&(s=null),b&2&&(a=null),t==null&&(t=!!wi(m[1])),t?0:(n==null&&(n=!!ki(m[1])),n?1:(i==null&&(i=!!Ns(m[1])),i?2:(o==null&&(o=!!Mi(m[1])),o?3:(s==null&&(s=!!$i(m[1])),s?4:(a==null&&(a=!!Li(m[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=d[l]=f[l](r)),{c(){c&&c.c(),e=A(),u&&u.c(),p=be()},m(m,b){c&&c.m(m,b),w(m,e,b),~l&&d[l].m(m,b),w(m,p,b),h=!0},p(m,[b]){m[1].description?c?c.p(m,b):(c=Ir(m),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let _=l;l=g(m,b),l===_?~l&&d[l].p(m,b):(u&&(de(),O(d[_],1,1,()=>{d[_]=null}),me()),~l?(u=d[l],u?u.p(m,b):(u=d[l]=f[l](m),u.c()),$(u,1),u.m(p.parentNode,p)):u=null)},i(m){h||($(u),h=!0)},o(m){O(u),h=!1},d(m){c&&c.d(m),m&&k(e),~l&&d[l].d(m),m&&k(p)}}}function Vs(r,e,t){var _,v,y;let{spec:n}=e,{value:i}=e,o="";if(wi(n)){i||(i={});for(let M of n.members)Mi(M)||$i(M)?i[_=M.name]||(i[_]=""):Li(M)?i[v=M.name]||(i[v]=!1):i[y=M.name]||(i[y]={})}else ki(n)&&(i||(i={}),Si(i)?o=i:Ei(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,L){r.$$.not_equal(i[L.name],M)&&(i[L.name]=M,t(0,i))}function p(){o=this.__value,t(2,o)}function h(){o=this.__value,t(2,o)}function c(){o=this.__value,t(2,o)}function f(M,L){r.$$.not_equal(i[L.name],M)&&(i[L.name]=M,t(0,i))}function d(){i=ai(this.value),t(0,i)}function g(){i=this.value,t(0,i)}function m(){i=this.value,t(0,i)}function b(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,p,l,h,c,f,d,g,m,b]}class Bt extends V{constructor(e){super(),K(this,e,Vs,Ws,Z,{spec:1,value:0})}}function Ks(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Bt({props:o}),ue.push(()=>Ee(e,"value",i,r[0].v2)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Zs(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=Fs;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Qs extends V{constructor(e){super(),K(this,e,Zs,Ks,Z,{props:0})}}const el="Planning",tl=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],nl={name:el,members:tl};function rl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Bt({props:o}),ue.push(()=>Ee(e,"value",i,r[0].planning)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function il(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=nl;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class ol extends V{constructor(e){super(),K(this,e,il,rl,Z,{props:0})}}const sl="CriticalIssue",ll=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],al={name:sl,members:ll};function ul(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Bt({props:o}),ue.push(()=>Ee(e,"value",i,r[0].criticals)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function fl(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=al;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class cl extends V{constructor(e){super(),K(this,e,fl,ul,Z,{props:0})}}function Dr(r){let e,t,n,i,o;const s=r[10].default,a=zi(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),ae(e,"border","solid 1px black"),ae(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=U(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&Wi(a,s,l,l[9],n?Ki(s,l[9],u,null):Vi(l[9]),null)},i(l){n||($(a,l),_t(()=>{t||(t=en(e,rn,{duration:100},!0)),t.run(1)}),n=!0)},o(l){O(a,l),t||(t=en(e,rn,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function pl(r){let e,t,n,i,o,s,a,l,u,p,h=r[4]&&Dr(r);return{c(){e=E("button"),t=cr("svg"),n=cr("path"),i=A(),o=z(r[1]),s=A(),h&&h.c(),a=be(),T(n,"d","M9 5l7 7-7 7"),T(t,"style","tran"),T(t,"width","20"),T(t,"height","20"),T(t,"fill","none"),T(t,"stroke-linecap","round"),T(t,"stroke-linejoin","round"),T(t,"stroke-width","2"),T(t,"viewBox","0 0 24 24"),T(t,"stroke","currentColor"),T(t,"class","svelte-t7fpgu"),T(e,"aria-expanded",r[4]),T(e,"class","svelte-t7fpgu"),pr(e,"underlined",r[3])},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,i),S(e,o),w(c,s,f),h&&h.m(c,f),w(c,a,f),l=!0,u||(p=[U(e,"click",r[5]),U(e,"mouseenter",r[11]),U(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&Pe(o,c[1]),(!l||f&16)&&T(e,"aria-expanded",c[4]),(!l||f&8)&&pr(e,"underlined",c[3]),c[4]?h?(h.p(c,f),f&16&&$(h,1)):(h=Dr(c),h.c(),$(h,1),h.m(a.parentNode,a)):h&&(de(),O(h,1,1,()=>{h=null}),me())},i(c){l||($(h),l=!0)},o(c){O(h),l=!1},d(c){c&&k(e),c&&k(s),h&&h.d(c),c&&k(a),u=!1,Ae(p)}}}function hl(r,e,t){let n,i,o,s;re(r,He,_=>t(7,o=_)),re(r,Se,_=>t(8,s=_));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const h=()=>{Se.update(_=>_==u?null:u),s==u&&(on.set(null),on.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const d=()=>sn.set(u),g=()=>sn.set(null);function m(_){ue[_?"unshift":"push"](()=>{c=_,t(2,c)})}const b=()=>f();return r.$$set=_=>{"id"in _&&t(0,u=_.id),"label"in _&&t(1,p=_.label),"$$scope"in _&&t(9,l=_.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,p,c,i,n,h,f,o,s,l,a,d,g,m,b]}class dl extends V{constructor(e){super(),K(this,e,hl,pl,Z,{id:0,label:1})}}function jr(r,e,t){const n=r.slice();return n[13]=e[t],n[14]=e,n[15]=t,n}function ml(r){let e,t,n;function i(s){r[9](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new cl({props:o}),ue.push(()=>Ee(e,"props",i,r[13].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function _l(r){let e,t,n;function i(s){r[8](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new ol({props:o}),ue.push(()=>Ee(e,"props",i,r[13].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function gl(r){let e,t,n;function i(s){r[7](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Qs({props:o}),ue.push(()=>Ee(e,"props",i,r[13].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function bl(r){let e,t,n,i,o;function s(p){r[4](p,r[13])}function a(p){r[5](p,r[13])}function l(p){r[6](p,r[13])}let u={id:r[13].id,length_meters:r[13].properties.length_meters};return r[13].properties.name!==void 0&&(u.name=r[13].properties.name),r[13].properties.intervention_type!==void 0&&(u.intervention_type=r[13].properties.intervention_type),r[13].properties.description!==void 0&&(u.description=r[13].properties.description),e=new Ts({props:u}),ue.push(()=>Ee(e,"name",s,r[13].properties.name)),ue.push(()=>Ee(e,"intervention_type",a,r[13].properties.intervention_type)),ue.push(()=>Ee(e,"description",l,r[13].properties.description)),{c(){N(e.$$.fragment)},m(p,h){B(e,p,h),o=!0},p(p,h){r=p;const c={};h&2&&(c.id=r[13].id),h&2&&(c.length_meters=r[13].properties.length_meters),!t&&h&2&&(t=!0,c.name=r[13].properties.name,Me(()=>t=!1)),!n&&h&2&&(n=!0,c.intervention_type=r[13].properties.intervention_type,Me(()=>n=!1)),!i&&h&2&&(i=!0,c.description=r[13].properties.description,Me(()=>i=!1)),e.$set(c)},i(p){o||($(e.$$.fragment,p),o=!0)},o(p){O(e.$$.fragment,p),o=!1},d(p){D(e,p)}}}function vl(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,d,g;const m=[bl,gl,_l,ml],b=[];function _(y,M){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:y[0]=="criticals"?3:-1}~(e=_(r))&&(t=b[e]=m[e](r));function v(){return r[10](r[13])}return{c(){t&&t.c(),n=A(),i=E("br"),o=A(),s=E("br"),a=A(),l=E("div"),u=E("button"),u.textContent="Delete",p=A(),h=E("button"),h.textContent="Save",c=A(),T(u,"type","button"),T(h,"type","button"),ae(l,"display","flex"),ae(l,"justify-content","space-between")},m(y,M){~e&&b[e].m(y,M),w(y,n,M),w(y,i,M),w(y,o,M),w(y,s,M),w(y,a,M),w(y,l,M),S(l,u),S(l,p),S(l,h),w(y,c,M),f=!0,d||(g=[U(u,"click",v),U(h,"click",r[11])],d=!0)},p(y,M){r=y;let L=e;e=_(r),e===L?~e&&b[e].p(r,M):(t&&(de(),O(b[L],1,1,()=>{b[L]=null}),me()),~e?(t=b[e],t?t.p(r,M):(t=b[e]=m[e](r),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(y){f||($(t),f=!0)},o(y){O(t),f=!1},d(y){~e&&b[e].d(y),y&&k(n),y&&k(i),y&&k(o),y&&k(s),y&&k(a),y&&k(l),y&&k(c),d=!1,Ae(g)}}}function Ur(r,e){let t,n,i;return n=new dl({props:{id:e[13].id,label:e[15]+1+") "+e[2](e[13]),$$slots:{default:[vl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=be(),N(n.$$.fragment),this.first=t},m(o,s){w(o,t,s),B(n,o,s),i=!0},p(o,s){e=o;const a={};s&2&&(a.id=e[13].id),s&2&&(a.label=e[15]+1+") "+e[2](e[13])),s&65539&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){O(n.$$.fragment,o),i=!1},d(o){o&&k(t),D(n,o)}}}function yl(r){let e=[],t=new Map,n,i,o,s,a=r[1].features;const l=u=>u[13].id;for(let u=0;u<a.length;u+=1){let p=jr(r,a,u),h=l(p);t.set(h,e[u]=Ur(h,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=be()},m(u,p){for(let h=0;h<e.length;h+=1)e[h].m(u,p);w(u,n,p),i=!0,o||(s=U(window,"keydown",r[3]),o=!0)},p(u,[p]){p&7&&(a=u[1].features,de(),e=Zi(e,p,l,1,u,a,t,n.parentNode,Qi,Ur,n,jr),me())},i(u){if(!i){for(let p=0;p<a.length;p+=1)$(e[p]);i=!0}},o(u){for(let p=0;p<e.length;p+=1)O(e[p]);i=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&k(n),o=!1,s()}}}function wl(r,e,t){let n,i;re(r,Se,m=>t(12,n=m)),re(r,ne,m=>t(1,i=m));let{schema:o}=e;function s(m){var _,v,y,M,L;if(o=="planning")return((_=m.properties.planning)==null?void 0:_.name)||"Untitled polygon";if(o=="v2")return((y=(v=m.properties.v2)==null?void 0:v.Route)==null?void 0:y.name)||((L=(M=m.properties.v2)==null?void 0:M.Crossing)==null?void 0:L.name)||"Untitled intervention";if(m.properties.name)return m.properties.name;var b=m.properties.intervention_type;return b=="other"&&(m.geometry.type=="Point"?b="point":m.geometry.type=="LineString"?b="line":b="polygon"),`Untitled ${b}`}function a(m){if(m.key=="Delete"){const b=m.target.tagName;if(b=="INPUT"||b=="TEXTAREA")return;m.preventDefault();const _=n;_&&dr(_)}}function l(m,b){r.$$.not_equal(b.properties.name,m)&&(b.properties.name=m,ne.set(i))}function u(m,b){r.$$.not_equal(b.properties.intervention_type,m)&&(b.properties.intervention_type=m,ne.set(i))}function p(m,b){r.$$.not_equal(b.properties.description,m)&&(b.properties.description=m,ne.set(i))}function h(m,b){r.$$.not_equal(b.properties,m)&&(b.properties=m,ne.set(i))}function c(m,b){r.$$.not_equal(b.properties,m)&&(b.properties=m,ne.set(i))}function f(m,b){r.$$.not_equal(b.properties,m)&&(b.properties=m,ne.set(i))}const d=m=>dr(m.id),g=()=>Se.set(null);return r.$$set=m=>{"schema"in m&&t(0,o=m.schema)},[o,i,s,a,l,u,p,h,c,f,d,g]}class kl extends V{constructor(e){super(),K(this,e,wl,yl,Z,{schema:0})}}function qr(r){let e,t;return e=new yi({props:{id:void 0}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p:G,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Sl(r){let e,t,n,i,o,s,a,l,u,p,h,c=r[1]=="speed limits"&&qr();return{c(){e=E("label"),t=z(`Show layer:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",a=A(),c&&c.c(),l=be(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,n.disabled=s=r[0]!=null,r[1]===void 0&&_t(()=>r[2].call(n))},m(f,d){w(f,e,d),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[1]),w(f,a,d),c&&c.m(f,d),w(f,l,d),u=!0,p||(h=U(n,"change",r[2]),p=!0)},p(f,[d]){(!u||d&1&&s!==(s=f[0]!=null))&&(n.disabled=s),d&2&&Ke(n,f[1]),f[1]=="speed limits"?c?(c.p(f,d),d&2&&$(c,1)):(c=qr(),c.c(),$(c,1),c.m(l.parentNode,l)):c&&(de(),O(c,1,1,()=>{c=null}),me())},i(f){u||($(c),u=!0)},o(f){O(c),u=!1},d(f){f&&k(e),f&&k(a),c&&c.d(f),f&&k(l),p=!1,h()}}}function El(r,e,t){let n;re(r,Se,s=>t(0,n=s));let i="none";function o(){i=bn(this),t(1,i),t(0,n)}return r.$$.update=()=>{r.$$.dirty&1&&n&&t(1,i="none")},[n,i,o]}class Ml extends V{constructor(e){super(),K(this,e,El,Sl,Z,{})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Be(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Hn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Je(r,e,t){t===void 0&&(t={});var n=Ve(r),i=Ve(e),o=Ce(i[1]-n[1]),s=Ce(i[0]-n[0]),a=Ce(n[1]),l=Ce(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return eo(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Xt(r,e){return e===void 0&&(e={}),to(r,function(t,n){var i=n.geometry.coordinates;return t+Je(i[0],i[1],e)},0)}function $l(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,d,g,m,b=r[0].features.length+"",_,v,y,M,L,C,R,F,x;return u=new mo({props:{label:"Load from GeoJSON",uniqueId:"load_geojson",loadFile:r[3]}}),{c(){e=E("div"),t=E("label"),n=z(`Scheme name:
    `),i=E("input"),o=A(),s=E("br"),a=A(),l=E("div"),N(u.$$.fragment),p=A(),h=E("button"),h.textContent="Export to GeoJSON",c=A(),f=E("br"),d=A(),g=E("div"),m=E("span"),_=z(b),v=z(" objects"),y=A(),M=E("button"),L=z("Clear all"),T(i,"type","text"),T(h,"type","button"),ae(h,"float","right"),T(M,"type","button"),T(M,"class","align-right"),M.disabled=C=r[0].features.length==0},m(P,q){w(P,e,q),S(e,t),S(t,n),S(t,i),Oe(i,r[0].scheme_name),w(P,o,q),w(P,s,q),w(P,a,q),w(P,l,q),B(u,l,null),S(l,p),S(l,h),w(P,c,q),w(P,f,q),w(P,d,q),w(P,g,q),S(g,m),S(m,_),S(m,v),S(g,y),S(g,M),S(M,L),R=!0,F||(x=[U(i,"input",r[8]),U(h,"click",r[2]),U(M,"click",r[1])],F=!0)},p(P,[q]){q&1&&i.value!==P[0].scheme_name&&Oe(i,P[0].scheme_name),(!R||q&1)&&b!==(b=P[0].features.length+"")&&Pe(_,b),(!R||q&1&&C!==(C=P[0].features.length==0))&&(M.disabled=C)},i(P){R||($(u.$$.fragment,P),R=!0)},o(P){O(u.$$.fragment,P),R=!1},d(P){P&&k(e),P&&k(o),P&&k(s),P&&k(a),P&&k(l),D(u),P&&k(c),P&&k(f),P&&k(d),P&&k(g),F=!1,Ae(x)}}}function Ll(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Ol(r,e,t){let n;re(r,ne,d=>t(0,n=d));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=!1;gn(async()=>{let g=new URLSearchParams(window.location.search).get("geojsonUrl"),m=window.localStorage.getItem(s);if(g){console.log(`Loading GeoJSON from ${g}`);try{let _=await(await fetch(g)).text();ne.set(c(JSON.parse(_)))}catch(b){console.log(`Failed to load from URL: ${b}`)}}else if(m)try{ne.set(c(JSON.parse(m)))}catch(b){console.log(`Failed to load from local storage: ${b}`)}t(7,a=!0)});function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(ne.update(d=>(delete d.scheme_name,d.features=[],d)),Se.set(null),He.set(null),sn.set(null),on.set(null))}function u(){const d=JSON.parse(JSON.stringify(n));for(let g of d.features)delete g.properties.hide_while_editing;return d}function p(){let d=u();var g=s;d.authority=i,d.origin="atip-v1",d.scheme_name&&(g+="_"+d.scheme_name),g+=".txt",Ll(g,JSON.stringify(d,null,"  "))}function h(d){const g=new FileReader;g.onload=b=>{try{ne.set(c(JSON.parse(b.target.result)))}catch(_){window.alert(`Couldn't load scheme from a file: ${_}`)}};let m=d.target.files;g.readAsText(m[0])}function c(d){let g=1;for(let m of d.features)m.properties||(m.properties={name:"",description:"",intervention_type:"other"}),m.geometry.type=="LineString"&&!m.properties.length_meters&&(m.properties.length_meters=Xt(m,{units:"kilometers"})*1e3),m.id=g++;return d}function f(){n.scheme_name=this.value,ne.set(n)}return r.$$set=d=>{"authorityName"in d&&t(4,i=d.authorityName),"schema"in d&&t(5,o=d.schema)},r.$$.update=()=>{r.$$.dirty&193&&a&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,p,h,i,o,s,a,f]}class Al extends V{constructor(e){super(),K(this,e,Ol,$l,Z,{authorityName:4,schema:5})}}const Rl="/atip/scheme_overview/assets/zoom_out_map-b2e1091a.svg";function xl(r){let e,t,n,i,o;return{c(){e=E("button"),t=E("img"),Qt(t.src,n=Rl)||T(t,"src",n),T(t,"alt","Zoom to show entire boundary"),T(e,"type","button"),T(e,"title","Zoom to show entire boundary"),T(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),i||(o=U(e,"click",r[0]),i=!0)},p:G,i:G,o:G,d(s){s&&k(e),i=!1,o()}}}function Cl(r,e,t){let n;re(r,je,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(Kn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class Tl extends V{constructor(e){super(),K(this,e,Cl,xl,Z,{boundaryGeojson:1})}}function Pl(r){let e,t,n,i,o,s,a;return{c(){e=E("div"),t=z(`Basemap:
  `),n=E("select"),i=E("option"),i.textContent="Streets",o=E("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&_t(()=>r[2].call(n)),T(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[0]),s||(a=[U(n,"change",r[2]),U(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&Ke(n,l[0])},i:G,o:G,d(l){l&&k(e),s=!1,Ae(a)}}}function Il(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=bn(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Fl extends V{constructor(e){super(),K(this,e,Il,Pl,Z,{style:0})}}function Nl(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,d,g;return{c(){e=E("li"),t=E("span"),n=z("Areas"),i=A(),o=E("li"),s=E("span"),a=z("Routes"),l=A(),u=E("li"),p=E("span"),h=z("Crossings"),c=A(),f=E("li"),d=E("span"),g=z("Other"),T(t,"class","svelte-l42ea0"),ae(t,"background",he.area),T(s,"class","svelte-l42ea0"),ae(s,"background",he.route),T(p,"class","svelte-l42ea0"),ae(p,"background",he.crossing),T(d,"class","svelte-l42ea0"),ae(d,"background",he.other)},m(m,b){w(m,e,b),S(e,t),S(e,n),w(m,i,b),w(m,o,b),S(o,s),S(o,a),w(m,l,b),w(m,u,b),S(u,p),S(u,h),w(m,c,b),w(m,f,b),S(f,d),S(f,g)},p:G,d(m){m&&k(e),m&&k(i),m&&k(o),m&&k(l),m&&k(u),m&&k(c),m&&k(f)}}}function Bl(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,d,g;return{c(){e=E("li"),t=E("span"),n=z("Preapp"),i=A(),o=E("li"),s=E("span"),a=z("Outline"),l=A(),u=E("li"),p=E("span"),h=z("Reserved matters"),c=A(),f=E("li"),d=E("span"),g=z("Local plan"),T(t,"class","svelte-l42ea0"),ae(t,"background",he.preapp),T(s,"class","svelte-l42ea0"),ae(s,"background",he.outline),T(p,"class","svelte-l42ea0"),ae(p,"background",he["reserved matters"]),T(d,"class","svelte-l42ea0"),ae(d,"background",he["local plan"])},m(m,b){w(m,e,b),S(e,t),S(e,n),w(m,i,b),w(m,o,b),S(o,s),S(o,a),w(m,l,b),w(m,u,b),S(u,p),S(u,h),w(m,c,b),w(m,f,b),S(f,d),S(f,g)},p:G,d(m){m&&k(e),m&&k(i),m&&k(o),m&&k(l),m&&k(u),m&&k(c),m&&k(f)}}}function Dl(r){let e;function t(o,s){return o[0]=="planning"?Bl:Nl}let n=t(r),i=n(r);return{c(){e=E("ul"),i.c()},m(o,s){w(o,e,s),i.m(e,null)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&k(e),i.d()}}}function jl(r){let e,t,n;return t=new kn({props:{label:"Objects",open:!0,$$slots:{default:[Dl]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),T(e,"class","svelte-l42ea0")},m(i,o){w(i,e,o),B(t,e,null),n=!0},p(i,[o]){const s={};o&3&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){O(t.$$.fragment,i),n=!1},d(i){i&&k(e),D(t)}}}function Ul(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class ql extends V{constructor(e){super(),K(this,e,Ul,jl,Z,{schema:0})}}let ot="interventions";function Gl(r,e,t){let n,i;re(r,je,p=>t(1,n=p)),re(r,ne,p=>t(2,i=p));let{schema:o}=e;Qe(n,ot,i);const s=["match",["get","intervention_type"],"area",he.area,"route",he.route,"crossing",he.crossing,"other",he.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",he.preapp,"outline",he.outline,"reserved matters",he["reserved matters"],"local plan",he["local plan"],"white"],l=["!=","hide_while_editing",!0];return we(n,{id:"interventions-points",source:ot,filter:["all",vn,l,["!=","endpoint",!0]],...gt(s,Sn)}),we(n,{id:"interventions-lines",source:ot,filter:["all",yn,l],...ht(s,Tt)}),we(n,{id:"interventions-lines-endpoints",source:ot,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Tt,"circle-opacity":0,"circle-stroke-color":he.lineEndpointColor,"circle-stroke-width":2}}),we(n,{id:"interventions-polygons",source:ot,filter:["all",wn,l],..._n(o=="planning"?a:s,.5)}),r.$$set=p=>{"schema"in p&&t(0,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(i)),h=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])h.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(h),n.getSource(ot).setData(p)}},[o,n,i]}class Hl extends V{constructor(e){super(),K(this,e,Gl,null,Z,{schema:0})}}let st="hover";function Yl(r,e,t){let n,i,o,s,a;return re(r,je,l=>t(0,n=l)),re(r,ne,l=>t(1,i=l)),re(r,sn,l=>t(2,o=l)),re(r,He,l=>t(3,s=l)),re(r,Se,l=>t(4,a=l)),Qe(n,st,De()),we(n,{id:"hover-polygons",source:st,filter:wn,...ht(he.hovering,.5*Tt,1)}),we(n,{id:"hover-lines",source:st,filter:yn,...ht(he.hovering,1.5*Tt,1)}),we(n,{id:"hover-points",source:st,filter:vn,...gt(he.hovering,1.5*Sn,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(st).setData(i.features.find(u=>u.id==l)):n.getSource(st).setData(De())}},[n,i,o,s,a]}class Jl extends V{constructor(e){super(),K(this,e,Yl,null,Z,{})}}class nr{constructor(e,t){se(this,"owner");se(this,"map");se(this,"mapHandlers",{});se(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const qt="edit-point-mode";class Xl{constructor(e){se(this,"map");se(this,"active");se(this,"eventListenersSuccess");se(this,"eventListenersFailure");se(this,"cursor");se(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new nr(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Qe(e,qt,De()),we(e,{id:"edit-point-mode",source:qt,...gt(he.hovering,Sn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=zl(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(qt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=De();this.cursor&&e.features.push(this.cursor),this.map.getSource(qt).setData(e)}}function zl(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Oi(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Wl(r,e);var n=Ve(r),i=Ve(e),o=Ce(n[0]),s=Ce(i[0]),a=Ce(n[1]),l=Ce(i[1]),u=Math.sin(s-o)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return Pn(Math.atan2(u,p))}function Wl(r,e){var t=Oi(e,r);return t=(t+180)%360,t}function Gr(r,e,t,n){n===void 0&&(n={});var i=Ve(r),o=Ce(i[0]),s=Ce(i[1]),a=Ce(t),l=no(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),h=Pn(p),c=Pn(u);return pt([h,c],n.properties)}function Yn(r){if(!r)throw new Error("geojson is required");var e=[];return Zn(r,function(t){Vl(t,e)}),We(e)}function Vl(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Be(n);break;case"LineString":t=[Be(n)]}t.forEach(function(i){var o=Kl(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Kl(r,e){var t=[];return r.reduce(function(n,i){var o=dt([n,i],e);return o.bbox=Zl(n,i),t.push(o),i}),t}function Zl(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var mt={},Ql={get exports(){return mt},set exports(r){mt=r}},Jn={},ea={get exports(){return Jn},set exports(r){Jn=r}};(function(r,e){(function(t,n){r.exports=n()})(ro,function(){function t(_,v,y,M,L){(function C(R,F,x,P,q){for(;P>x;){if(P-x>600){var Y=P-x+1,te=F-x+1,le=Math.log(Y),ke=.5*Math.exp(2*le/3),xe=.5*Math.sqrt(le*ke*(Y-ke)/Y)*(te-Y/2<0?-1:1),oe=Math.max(x,Math.floor(F-te*ke/Y+xe)),ie=Math.min(P,Math.floor(F+(Y-te)*ke/Y+xe));C(R,F,oe,ie,q)}var Ie=R[F],Le=x,W=P;for(n(R,x,F),q(R[P],Ie)>0&&n(R,x,P);Le<W;){for(n(R,Le,W),Le++,W--;q(R[Le],Ie)<0;)Le++;for(;q(R[W],Ie)>0;)W--}q(R[x],Ie)===0?n(R,x,W):n(R,++W,P),W<=F&&(x=W+1),F<=W&&(P=W-1)}})(_,v,y||0,M||_.length-1,L||i)}function n(_,v,y){var M=_[v];_[v]=_[y],_[y]=M}function i(_,v){return _<v?-1:_>v?1:0}var o=function(_){_===void 0&&(_=9),this._maxEntries=Math.max(4,_),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(_,v,y){if(!y)return v.indexOf(_);for(var M=0;M<v.length;M++)if(y(_,v[M]))return M;return-1}function a(_,v){l(_,0,_.children.length,v,_)}function l(_,v,y,M,L){L||(L=m(null)),L.minX=1/0,L.minY=1/0,L.maxX=-1/0,L.maxY=-1/0;for(var C=v;C<y;C++){var R=_.children[C];u(L,_.leaf?M(R):R)}return L}function u(_,v){return _.minX=Math.min(_.minX,v.minX),_.minY=Math.min(_.minY,v.minY),_.maxX=Math.max(_.maxX,v.maxX),_.maxY=Math.max(_.maxY,v.maxY),_}function p(_,v){return _.minX-v.minX}function h(_,v){return _.minY-v.minY}function c(_){return(_.maxX-_.minX)*(_.maxY-_.minY)}function f(_){return _.maxX-_.minX+(_.maxY-_.minY)}function d(_,v){return _.minX<=v.minX&&_.minY<=v.minY&&v.maxX<=_.maxX&&v.maxY<=_.maxY}function g(_,v){return v.minX<=_.maxX&&v.minY<=_.maxY&&v.maxX>=_.minX&&v.maxY>=_.minY}function m(_){return{children:_,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function b(_,v,y,M,L){for(var C=[v,y];C.length;)if(!((y=C.pop())-(v=C.pop())<=M)){var R=v+Math.ceil((y-v)/M/2)*M;t(_,R,v,y,L),C.push(v,R,R,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(_){var v=this.data,y=[];if(!g(_,v))return y;for(var M=this.toBBox,L=[];v;){for(var C=0;C<v.children.length;C++){var R=v.children[C],F=v.leaf?M(R):R;g(_,F)&&(v.leaf?y.push(R):d(_,F)?this._all(R,y):L.push(R))}v=L.pop()}return y},o.prototype.collides=function(_){var v=this.data;if(!g(_,v))return!1;for(var y=[];v;){for(var M=0;M<v.children.length;M++){var L=v.children[M],C=v.leaf?this.toBBox(L):L;if(g(_,C)){if(v.leaf||d(_,C))return!0;y.push(L)}}v=y.pop()}return!1},o.prototype.load=function(_){if(!_||!_.length)return this;if(_.length<this._minEntries){for(var v=0;v<_.length;v++)this.insert(_[v]);return this}var y=this._build(_.slice(),0,_.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(_){return _&&this._insert(_,this.data.height-1),this},o.prototype.clear=function(){return this.data=m([]),this},o.prototype.remove=function(_,v){if(!_)return this;for(var y,M,L,C=this.data,R=this.toBBox(_),F=[],x=[];C||F.length;){if(C||(C=F.pop(),M=F[F.length-1],y=x.pop(),L=!0),C.leaf){var P=s(_,C.children,v);if(P!==-1)return C.children.splice(P,1),F.push(C),this._condense(F),this}L||C.leaf||!d(C,R)?M?(y++,C=M.children[y],L=!1):C=null:(F.push(C),x.push(y),y=0,M=C,C=C.children[0])}return this},o.prototype.toBBox=function(_){return _},o.prototype.compareMinX=function(_,v){return _.minX-v.minX},o.prototype.compareMinY=function(_,v){return _.minY-v.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(_){return this.data=_,this},o.prototype._all=function(_,v){for(var y=[];_;)_.leaf?v.push.apply(v,_.children):y.push.apply(y,_.children),_=y.pop();return v},o.prototype._build=function(_,v,y,M){var L,C=y-v+1,R=this._maxEntries;if(C<=R)return a(L=m(_.slice(v,y+1)),this.toBBox),L;M||(M=Math.ceil(Math.log(C)/Math.log(R)),R=Math.ceil(C/Math.pow(R,M-1))),(L=m([])).leaf=!1,L.height=M;var F=Math.ceil(C/R),x=F*Math.ceil(Math.sqrt(R));b(_,v,y,x,this.compareMinX);for(var P=v;P<=y;P+=x){var q=Math.min(P+x-1,y);b(_,P,q,F,this.compareMinY);for(var Y=P;Y<=q;Y+=F){var te=Math.min(Y+F-1,q);L.children.push(this._build(_,Y,te,M-1))}}return a(L,this.toBBox),L},o.prototype._chooseSubtree=function(_,v,y,M){for(;M.push(v),!v.leaf&&M.length-1!==y;){for(var L=1/0,C=1/0,R=void 0,F=0;F<v.children.length;F++){var x=v.children[F],P=c(x),q=(Y=_,te=x,(Math.max(te.maxX,Y.maxX)-Math.min(te.minX,Y.minX))*(Math.max(te.maxY,Y.maxY)-Math.min(te.minY,Y.minY))-P);q<C?(C=q,L=P<L?P:L,R=x):q===C&&P<L&&(L=P,R=x)}v=R||v.children[0]}var Y,te;return v},o.prototype._insert=function(_,v,y){var M=y?_:this.toBBox(_),L=[],C=this._chooseSubtree(M,this.data,v,L);for(C.children.push(_),u(C,M);v>=0&&L[v].children.length>this._maxEntries;)this._split(L,v),v--;this._adjustParentBBoxes(M,L,v)},o.prototype._split=function(_,v){var y=_[v],M=y.children.length,L=this._minEntries;this._chooseSplitAxis(y,L,M);var C=this._chooseSplitIndex(y,L,M),R=m(y.children.splice(C,y.children.length-C));R.height=y.height,R.leaf=y.leaf,a(y,this.toBBox),a(R,this.toBBox),v?_[v-1].children.push(R):this._splitRoot(y,R)},o.prototype._splitRoot=function(_,v){this.data=m([_,v]),this.data.height=_.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(_,v,y){for(var M,L,C,R,F,x,P,q=1/0,Y=1/0,te=v;te<=y-v;te++){var le=l(_,0,te,this.toBBox),ke=l(_,te,y,this.toBBox),xe=(L=le,C=ke,R=void 0,F=void 0,x=void 0,P=void 0,R=Math.max(L.minX,C.minX),F=Math.max(L.minY,C.minY),x=Math.min(L.maxX,C.maxX),P=Math.min(L.maxY,C.maxY),Math.max(0,x-R)*Math.max(0,P-F)),oe=c(le)+c(ke);xe<q?(q=xe,M=te,Y=oe<Y?oe:Y):xe===q&&oe<Y&&(Y=oe,M=te)}return M||y-v},o.prototype._chooseSplitAxis=function(_,v,y){var M=_.leaf?this.compareMinX:p,L=_.leaf?this.compareMinY:h;this._allDistMargin(_,v,y,M)<this._allDistMargin(_,v,y,L)&&_.children.sort(M)},o.prototype._allDistMargin=function(_,v,y,M){_.children.sort(M);for(var L=this.toBBox,C=l(_,0,v,L),R=l(_,y-v,y,L),F=f(C)+f(R),x=v;x<y-v;x++){var P=_.children[x];u(C,_.leaf?L(P):P),F+=f(C)}for(var q=y-v-1;q>=v;q--){var Y=_.children[q];u(R,_.leaf?L(Y):Y),F+=f(R)}return F},o.prototype._adjustParentBBoxes=function(_,v,y){for(var M=y;M>=0;M--)u(v[M],_)},o.prototype._condense=function(_){for(var v=_.length-1,y=void 0;v>=0;v--)_[v].children.length===0?v>0?(y=_[v-1].children).splice(y.indexOf(_[v]),1):this.clear():a(_[v],this.toBBox)},o})})(ea);const ta=Qn(io),na=Qn(oo),ra=Qn(so);var Fe=Jn,Ai=ta,Ri=na,lt=ra.default,ia=Ri.featureEach;Ri.coordEach;Ai.polygon;var Hr=Ai.featureCollection;function xi(r){var e=new Fe(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:lt(t),Fe.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:lt(i),n.push(i)}):ia(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:lt(i),n.push(i)}),Fe.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:lt(t),Fe.prototype.remove.call(this,t,n)},e.clear=function(){return Fe.prototype.clear.call(this)},e.search=function(t){var n=Fe.prototype.search.call(this,this.toBBox(t));return Hr(n)},e.collides=function(t){return Fe.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Fe.prototype.all.call(this);return Hr(t)},e.toJSON=function(){return Fe.prototype.toJSON.call(this)},e.fromJSON=function(t){return Fe.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=lt(t);else if(t.type==="FeatureCollection")n=lt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ql.exports=xi;mt.default=xi;function Ci(r,e){var t={},n=[];if(r.type==="LineString"&&(r=hr(r)),e.type==="LineString"&&(e=hr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Yr(r,e);return i&&n.push(i),We(n)}var o=mt();return o.load(Yn(e)),tn(Yn(r),function(s){tn(o.search(s),function(a){var l=Yr(s,a);if(l){var u=Be(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function Yr(r,e){var t=Be(r),n=Be(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],h=n[1][1],c=(h-u)*(s-i)-(p-l)*(a-o),f=(p-l)*(o-u)-(h-u)*(i-l),d=(s-i)*(o-u)-(a-o)*(i-l);if(c===0)return f===0&&d===0,null;var g=f/c,m=d/c;if(g>=0&&g<=1&&m>=0&&m<=1){var b=i+g*(s-i),_=o+g*(a-o);return pt([b,_])}return null}function It(r,e,t){t===void 0&&(t={});var n=pt([1/0,1/0],{dist:1/0}),i=0;return Zn(r,function(o){for(var s=Be(o),a=0;a<s.length-1;a++){var l=pt(s[a]);l.properties.dist=Je(e,l,t);var u=pt(s[a+1]);u.properties.dist=Je(e,u,t);var p=Je(l,u,t),h=Math.max(l.properties.dist,u.properties.dist),c=Oi(l,u),f=Gr(e,h,c+90,t),d=Gr(e,h,c-90,t),g=Ci(dt([f.geometry.coordinates,d.geometry.coordinates]),dt([l.geometry.coordinates,u.geometry.coordinates])),m=null;g.features.length>0&&(m=g.features[0],m.properties.dist=Je(e,m,t),m.properties.location=i+Je(l,m,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+p),m&&m.properties.dist<n.properties.dist&&(n=m,n.properties.index=a),i+=p}}),n}const at="edit-polygon-mode";class oa{constructor(e){se(this,"map");se(this,"active");se(this,"eventListenersSuccess");se(this,"eventListenersFailure");se(this,"points");se(this,"cursor");se(this,"hover");se(this,"dragFrom");se(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new nr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Qe(e,at,De()),we(e,{id:"edit-polygon-fill",source:at,filter:wn,..._n("red",["case",["boolean",["get","hover"],"false"],1,.5])}),we(e,{id:"edit-polygon-lines",source:at,filter:yn,...ht("black",8,.5)}),we(e,{id:"edit-polygon-vertices",source:at,filter:vn,...gt(he.hovering,Sn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Xr(this.points).forEach((n,i)=>{t.push([i+1,It(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(at),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=De();this.points.forEach((n,i)=>{let o=Jr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Xr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(at).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Jr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Jr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Xr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let X;const Ge=new Array(32).fill(void 0);Ge.push(void 0,null,!0,!1);function J(r){return Ge[r]}let Rt=Ge.length;function sa(r){r<36||(Ge[r]=Rt,Rt=r)}function Xn(r){const e=J(r);return sa(r),e}const Ti=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Ti.decode();let zt=new Uint8Array;function xt(){return zt.byteLength===0&&(zt=new Uint8Array(X.memory.buffer)),zt}function ft(r,e){return Ti.decode(xt().subarray(r,r+e))}function ve(r){Rt===Ge.length&&Ge.push(Ge.length+1);const e=Rt;return Rt=Ge[e],Ge[e]=r,e}function Rn(r){return r==null}let Wt=new Float64Array;function la(){return Wt.byteLength===0&&(Wt=new Float64Array(X.memory.buffer)),Wt}let Vt=new Int32Array;function ye(){return Vt.byteLength===0&&(Vt=new Int32Array(X.memory.buffer)),Vt}let ze=0;const Kt=new TextEncoder("utf-8"),aa=typeof Kt.encodeInto=="function"?function(r,e){return Kt.encodeInto(r,e)}:function(r,e){const t=Kt.encode(r);return e.set(t),{read:r.length,written:t.length}};function Gt(r,e,t){if(t===void 0){const a=Kt.encode(r),l=e(a.length);return xt().subarray(l,l+a.length).set(a),ze=a.length,l}let n=r.length,i=e(n);const o=xt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=xt().subarray(i+s,i+n),l=aa(r,a);s+=l.written}return ze=s,i}function zn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=zn(r[0]));for(let s=1;s<i;s++)o+=", "+zn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function ua(r,e){const t=e(r.length*1);return xt().set(r,t/1),ze=r.length,t}function xn(r,e){try{return r.apply(this,e)}catch(t){X.__wbindgen_exn_store(ve(t))}}class pn{static __wrap(e){const t=Object.create(pn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();X.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=X.__wbindgen_add_to_stack_pointer(-16),s=ua(e,X.__wbindgen_malloc),a=ze;X.jsroutesnapper_new(o,s,a);var t=ye()[o/4+0],n=ye()[o/4+1],i=ye()[o/4+2];if(i)throw Xn(n);return pn.__wrap(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){X.jsroutesnapper_setConfig(this.ptr,ve(e))}toFinalFeature(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];let i;return e!==0&&(i=ft(e,t).slice(),X.__wbindgen_free(e,t*1)),i}finally{X.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_renderGeojson(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];return ft(e,t)}finally{X.__wbindgen_add_to_stack_pointer(16),X.__wbindgen_free(e,t)}}setSnapMode(e){X.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return X.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){X.jsroutesnapper_onClick(this.ptr)}onDragStart(){return X.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return X.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){X.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_editExisting(i,this.ptr,ve(e));var t=ye()[i/4+0],n=ye()[i/4+1];if(n)throw Xn(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}}async function fa(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function ca(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Xn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ft(e,t));return ve(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=ft(e,t);return ve(n)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;la()[e/8+1]=Rn(i)?0:i,ye()[e/4+0]=!Rn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=Rn(i)?0:Gt(i,X.__wbindgen_malloc,X.__wbindgen_realloc),s=ze;ye()[e/4+1]=s,ye()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(J(t)),i=Gt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=ze;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return ve(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=J(e)[J(t)];return ve(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(J(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(J(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(J(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(J(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(J(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=J(e)[t>>>0];return ve(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=J(e).next;return ve(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return xn(function(e){const t=J(e).next();return ve(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return J(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=J(e).value;return ve(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ve(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return xn(function(e,t){const n=Reflect.get(J(e),J(t));return ve(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return xn(function(e,t){const n=J(e).call(J(t));return ve(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=J(e).buffer;return ve(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(J(e));return ve(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ve(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=Gt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=ze;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(ft(e,t))}finally{X.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=zn(J(t)),i=Gt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=ze;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ft(e,t))},r.wbg.__wbindgen_memory=function(){const e=X.memory;return ve(e)},r}function pa(r,e){return X=r.exports,Pi.__wbindgen_wasm_module=e,Wt=new Float64Array,Vt=new Int32Array,zt=new Uint8Array,X}async function Pi(r){typeof r>"u"&&(r="/atip/scheme_overview/assets/route_snapper_bg.wasm");const e=ca();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await fa(await r,e);return pa(t,n)}const wt="route-snapper",zr=10,ha=30;class da{constructor(e,t){se(this,"map");se(this,"inner");se(this,"active");se(this,"eventListenersSuccessRoute");se(this,"eventListenersSuccessArea");se(this,"eventListenersFailure");se(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new pn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Qe(e,wt,De()),we(e,{id:"route-points",source:wt,filter:vn,...gt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",zr/2,zr])}),we(e,{id:"route-lines",source:wt,filter:yn,...ht("black",2.5)}),we(e,{id:"route-polygons",source:wt,filter:wn,..._n("black",.5)}),this.events=new nr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-ha,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(wt).setData(JSON.parse(this.inner.renderGeojson()))}}function ma(r){let e,t,n,i,o,s,a,l;return{c(){e=E("button"),t=E("img"),i=A(),o=z(r[2]),Qt(t.src,n=r[3])||T(t,"src",n),T(t,"alt",r[2]),T(t,"class","svelte-1vvpkg9"),T(e,"type","button"),e.disabled=s=r[0]==r[1],T(e,"class","svelte-1vvpkg9")},m(u,p){w(u,e,p),S(e,t),S(e,i),S(e,o),a||(l=U(e,"click",r[5]),a=!0)},p(u,[p]){p&8&&!Qt(t.src,n=u[3])&&T(t,"src",n),p&4&&T(t,"alt",u[2]),p&4&&Pe(o,u[2]),p&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:G,o:G,d(u){u&&k(e),a=!1,l()}}}function _a(r,e,t){let{mode:n}=e,{thisMode:i}=e,{label:o}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(i);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,i=u.thisMode),"label"in u&&t(2,o=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,i,o,s,a,l]}class nt extends V{constructor(e){super(),K(this,e,_a,ma,Z,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function Wr(r){let e;function t(o,s){return o[1]?ba:ga}let n=t(r),i=n(r);return{c(){i.c(),e=be()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&k(e)}}}function ga(r){let e;return{c(){e=E("p"),e.textContent="Click an object to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function ba(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another object"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function va(r){let e,t=r[0]==ct&&Wr(r);return{c(){t&&t.c(),e=be()},m(n,i){t&&t.m(n,i),w(n,e,i)},p(n,[i]){n[0]==ct?t?t.p(n,i):(t=Wr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&k(e)}}}const ct="edit-attribute";function Ii(){}function ya(r,e,t){let n,i,o,s;re(r,je,f=>t(5,n=f)),re(r,ne,f=>t(6,i=f)),re(r,on,f=>t(7,o=f)),re(r,Se,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){Se.set(null)}n.on("mousemove",p),n.on("mouseout",h),n.on("click",c),Ft(()=>{n.off("mousemove",p),n.off("mouseout",h),n.off("click",c)});function p(f){var d;if(a==ct){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});He.set(((d=g[0])==null?void 0:d.id)||null)}}function h(){a==ct&&He.set(null)}function c(f){if(a==ct){let d=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});d.length>0?Se.set(d[0].id):Se.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let d=i.features.find(g=>g.id==f);d.geometry.type=="Point"?n.flyTo({center:d.geometry.coordinates,duration:500}):n.fitBounds(Kn(d),{padding:200,duration:500}),l(ct)}}},[a,s,l,Ii,u,n,i,o]}class wa extends V{constructor(e){super(),K(this,e,ya,va,Z,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Ii}get stop(){return this.$$.ctx[4]}}function ka(r){let e,t;return{c:G,m(n,i){e||(t=U(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function Sa(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class En extends V{constructor(e){super(),K(this,e,Sa,ka,Z,{tool:1})}}function Ea(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ma(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function $a(r){let e,t,n,i,o,s,a,l,u,p;function h(d,g){return d[1]?Ma:Ea}let c=h(r),f=c(r);return a=new En({props:{tool:r[0]}}),{c(){e=E("ul"),f.c(),t=A(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=A(),o=E("button"),o.textContent="Cancel",s=A(),N(a.$$.fragment),T(o,"type","button")},m(d,g){w(d,e,g),f.m(e,null),S(e,t),S(e,n),w(d,i,g),w(d,o,g),w(d,s,g),B(a,d,g),l=!0,u||(p=U(o,"click",r[2]),u=!0)},p(d,[g]){c!==(c=h(d))&&(f.d(1),f=c(d),f&&(f.c(),f.m(e,t)));const m={};g&1&&(m.tool=d[0]),a.$set(m)},i(d){l||($(a.$$.fragment,d),l=!0)},o(d){O(a.$$.fragment,d),l=!1},d(d){d&&k(e),f.d(),d&&k(i),d&&k(o),d&&k(s),D(a,d),u=!1,p()}}}function La(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Fi extends V{constructor(e){super(),K(this,e,La,$a,Z,{pointTool:0,editingExisting:1})}}function Oa(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Aa(r){let e,t,n,i,o,s,a,l,u,p,h;return e=new kn({props:{label:"Help",$$slots:{default:[Oa]},$$scope:{ctx:r}}}),l=new En({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=A(),n=E("div"),i=E("button"),i.textContent="Finish",o=A(),s=E("button"),s.textContent="Cancel",a=A(),N(l.$$.fragment),T(i,"type","button"),T(s,"type","button"),ae(n,"display","flex"),ae(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,i),S(n,o),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(h=[U(i,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const d={};f&8&&(d.$$scope={dirty:f,ctx:c}),e.$set(d);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){O(e.$$.fragment,c),O(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Ae(h)}}}function Ra(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Ni extends V{constructor(e){super(),K(this,e,Ra,Aa,Z,{polygonTool:0})}}function xa(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Ca(r){let e,t,n,i,o,s,a,l,u,p,h;return e=new kn({props:{label:"Help",$$slots:{default:[xa]},$$scope:{ctx:r}}}),l=new En({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=A(),n=E("div"),i=E("button"),i.textContent="Finish",o=A(),s=E("button"),s.textContent="Cancel",a=A(),N(l.$$.fragment),T(i,"type","button"),T(s,"type","button"),ae(n,"display","flex"),ae(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,i),S(n,o),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(h=[U(i,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const d={};f&8&&(d.$$scope={dirty:f,ctx:c}),e.$set(d);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){O(e.$$.fragment,c),O(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Ae(h)}}}function Ta(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Bi extends V{constructor(e){super(),K(this,e,Ta,Ca,Z,{routeTool:0})}}function Pa(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Ia(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,d,g;return e=new kn({props:{label:"Help",$$slots:{default:[Pa]},$$scope:{ctx:r}}}),c=new En({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=A(),n=E("label"),i=E("input"),o=z(`
  Avoid doubling back`),s=A(),a=E("div"),l=E("button"),l.textContent="Finish",u=A(),p=E("button"),p.textContent="Cancel",h=A(),N(c.$$.fragment),T(i,"type","checkbox"),T(l,"type","button"),T(p,"type","button"),ae(a,"display","flex"),ae(a,"justify-content","space-between")},m(m,b){B(e,m,b),w(m,t,b),w(m,n,b),S(n,i),i.checked=r[1],S(n,o),w(m,s,b),w(m,a,b),S(a,l),S(a,u),S(a,p),w(m,h,b),B(c,m,b),f=!0,d||(g=[U(i,"change",r[2]),U(l,"click",r[3]),U(p,"click",r[4])],d=!0)},p(m,[b]){const _={};b&32&&(_.$$scope={dirty:b,ctx:m}),e.$set(_),b&2&&(i.checked=m[1]);const v={};b&1&&(v.tool=m[0]),c.$set(v)},i(m){f||($(e.$$.fragment,m),$(c.$$.fragment,m),f=!0)},o(m){O(e.$$.fragment,m),O(c.$$.fragment,m),f=!1},d(m){D(e,m),m&&k(t),m&&k(n),m&&k(s),m&&k(a),m&&k(h),D(c,m),d=!1,Ae(g)}}}function Fa(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class Di extends V{constructor(e){super(),K(this,e,Fa,Ia,Z,{routeTool:0})}}function Vr(r){let e,t,n,i;const o=[Ua,ja,Da,Ba,Na],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=be()},m(l,u){s[e].m(l,u),w(l,n,u),i=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(de(),O(s[p],1,1,()=>{s[p]=null}),me(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){i||($(t),i=!0)},o(l){O(t),i=!1},d(l){s[e].d(l),l&&k(n)}}}function Na(r){let e;return{c(){e=E("p"),e.textContent="Click an object to edit its geometry"},m(t,n){w(t,e,n)},p:G,i:G,o:G,d(t){t&&k(e)}}}function Ba(r){let e,t;return e=new Di({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Da(r){let e,t;return e=new Bi({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ja(r){let e,t;return e=new Ni({props:{polygonTool:r[2]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ua(r){let e,t;return e=new Fi({props:{pointTool:r[1],editingExisting:!0}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function qa(r){let e,t,n=r[0]==Ue&&Vr(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==Ue?n?(n.p(i,o),o&1&&$(n,1)):(n=Vr(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(de(),O(n,1,1,()=>{n=null}),me())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const Ue="edit-geometry";function ji(){}function Ga(r,e,t){let n;re(r,je,g=>t(8,n=g));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(o.stop(),s.stop(),a.stop(),ne.update(g=>{let m=g.features.find(b=>b.id==l);return delete m.properties.hide_while_editing,g})),l=null,t(4,u=null),He.set(null)}n.on("mousemove",h),n.on("mouseout",c),n.on("click",f),Ft(()=>{n.off("mousemove",h),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(g=>{i==Ue&&(ne.update(m=>{let b=m.features.find(_=>_.id==l);return b.properties.length_meters=g.properties.length_meters,b.properties.waypoints=g.properties.waypoints,delete b.properties.hide_while_editing,b.geometry=g.geometry,m}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{i==Ue&&(ne.update(m=>{let b=m.features.find(_=>_.id==l);return b.properties.waypoints=g.properties.waypoints,delete b.properties.hide_while_editing,b.geometry=g.geometry,m}),l=null,t(4,u=null))});for(let g of[o,s])g.addEventListenerSuccess(m=>{i==Ue&&(ne.update(b=>{let _=b.features.find(v=>v.id==l);return _.geometry=m.geometry,delete _.properties.hide_while_editing,b}),l=null,t(4,u=null))});for(let g of[o,s,a])g.addEventListenerFailure(()=>{i==Ue&&(ne.update(m=>{let b=m.features.find(_=>_.id==l);return delete b.properties.hide_while_editing,m}),l=null,t(4,u=null))});function h(g){var m;if(i==Ue&&l==null){let b=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});He.set(((m=b[0])==null?void 0:m.id)||null)}}function c(){i==Ue&&l==null&&He.set(null)}function f(g){if(i==Ue&&l==null){let m=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0&&d(m[0].id)}}function d(g){He.set(null);let m=null;ne.update(_=>(m=_.features.find(v=>v.id==g),m.properties.hide_while_editing=!0,_));let b=m;l=g,b.geometry.type=="LineString"?(a.editExistingRoute(b),t(4,u="route")):b.geometry.type=="Polygon"?b.properties.waypoints?(a.editExistingArea(b),t(4,u="snap-polygon")):(s.editExisting(b),t(4,u="free-polygon")):b.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"pointTool"in g&&t(1,o=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[i,o,s,a,u,ji,p]}class Ha extends V{constructor(e){super(),K(this,e,Ga,qa,Z,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return ji}get stop(){return this.$$.ctx[6]}}async function Ya(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),o+=p.length;const h=100*o/i;e.style=`background: linear-gradient(to right, red ${h}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function Ja(r){let e,t;return e=new Di({props:{routeTool:r[0]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Xa(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&k(e),r[7](null)}}}function za(r){let e,t,n,i;const o=[Xa,Ja],s=[];function a(l,u){return l[0]?l[1]==Wn?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=be()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),i=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(de(),O(s[p],1,1,()=>{s[p]=null}),me()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||($(t),i=!0)},o(l){O(t),i=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const Wn="route";function Wa(r,e,t){let n;re(r,je,c=>t(8,n=c));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}gn(async()=>{await Pi(),console.log(`Grabbing ${s}`);try{const c=await Ya(s,a);t(0,l=new da(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==Wn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{i==Wn&&(ne.update(f=>(c.id=Nt(f),c.properties.intervention_type="route",f.features.push(c),f)),o("edit-attribute"),Se.set(c.id))})});function h(c){ue[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,i=c.mode),"changeMode"in c&&t(3,o=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,i,a,o,s,u,p,h]}class Va extends V{constructor(e){super(),K(this,e,Wa,za,Z,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Kr(r){let e,t;return e=new Fi({props:{pointTool:r[1],editingExisting:!1}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ka(r){let e,t,n=r[0]==hn&&Kr(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==hn?n?(n.p(i,o),o&1&&$(n,1)):(n=Kr(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(de(),O(n,1,1,()=>{n=null}),me())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const hn="point";function Za(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==hn&&(ne.update(u=>(l.id=Nt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),Se.set(l.id))}),o.addEventListenerFailure(()=>{n==hn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class Qa extends V{constructor(e){super(),K(this,e,Za,Ka,Z,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Zr(r){let e,t;return e=new Ni({props:{polygonTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function eu(r){let e,t,n=r[0]==dn&&Zr(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==dn?n?(n.p(i,o),o&1&&$(n,1)):(n=Zr(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(de(),O(n,1,1,()=>{n=null}),me())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const dn="free-polygon";function tu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==dn&&(ne.update(u=>(l.id=Nt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Se.set(l.id))}),o.addEventListenerFailure(()=>{n==dn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class nu extends V{constructor(e){super(),K(this,e,tu,eu,Z,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Qr(r){let e,t;return e=new Bi({props:{routeTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ru(r){let e,t,n=r[0]==mn&&Qr(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==mn?n?(n.p(i,o),o&1&&$(n,1)):(n=Qr(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(de(),O(n,1,1,()=>{n=null}),me())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const mn="snap-polygon";function iu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==mn&&(ne.update(u=>(l.id=Nt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Se.set(l.id))}),o.addEventListenerFailure(()=>{n==mn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class ou extends V{constructor(e){super(),K(this,e,iu,ru,Z,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function su(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Je(r.slice(0,2),[n,t]),s=Je(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function lu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return lo(r,function(s){au(s,o,n)}),r}function au(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function uu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Hn(r),n=Hn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=lu(e,{precision:7});switch(n){case"Point":return Vn(r,i);case"MultiPoint":return ei(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return ei(r,Ci(r,i))}}function ei(r,e){var t=[],n=mt();return Zn(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=Vn(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=su(ao(a)))}),n.load(We(t));else{var o=n.search(i);if(o.features.length){var s=Ui(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),tn(Vn(s,i),function(a){t.push(a),n.insert(a)})}}}),We(t)}function Vn(r,e){var t=[],n=Be(r)[0],i=Be(r)[r.geometry.coordinates.length-1];if(Cn(n,Ve(e))||Cn(i,Ve(e)))return We([r]);var o=mt(),s=Yn(r);o.load(s);var a=o.search(e);if(!a.features.length)return We([r]);var l=Ui(e,a),u=[n],p=uo(s,function(h,c,f){var d=Be(c)[1],g=Ve(e);return f===l.id?(h.push(g),t.push(dt(h)),Cn(g,d)?[g]:[g,d]):(h.push(d),h)},u);return p.length>1&&t.push(dt(p)),We(t)}function Ui(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return tn(e,function(i){var o=It(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function Cn(r,e){return r[0]===e[0]&&r[1]===e[1]}function fu(r,e,t){var n=Be(t);if(Hn(t)!=="LineString")throw new Error("line must be a LineString");var i=It(t,r),o=It(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),dt(a,t.properties)}function ti(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function cu(r){let e,t,n,i=r[0]==Ct&&ti();return{c(){i&&i.c(),e=be()},m(o,s){i&&i.m(o,s),w(o,e,s),t||(n=U(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Ct?i||(i=ti(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:G,o:G,d(o){i&&i.d(o),o&&k(e),t=!1,n()}}}const Ct="split-route",pu=10,hu=30;let Tn="split-route";function qi(){}function ni(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function du(r,e,t){let n,i;re(r,ne,g=>t(8,n=g)),re(r,je,g=>t(6,i=g));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",p),i.on("click",h),Ft(()=>{i.off("mousemove",p),i.off("click",h)}),Qe(i,Tn,De()),we(i,{id:"draw-split-route",source:Tn,...gt("black",pu,["case",["==",["get","snapped"],!0],1,.5])});function p(g){if(o!=Ct)return;t(5,l=ni(g.lngLat.toArray(),!1)),u=null;const m=[g.point.x-hu,g.point.y],b=i.unproject(g.point).distanceTo(i.unproject(m))/1e3;let _=[];for(let[v,y]of n.features.entries())if(y.geometry.type=="LineString"){let M=It(y.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=b&&_.push([v,M.geometry.coordinates,M.properties.dist])}_.sort((v,y)=>v[2]-y[2]),_.length>0&&(t(5,l=ni(_[0][1],!0)),u=_[0][0])}function h(){if(o==Ct)if(u==null)s("edit-attribute");else{let g=uu(n.features[u],l);if(g.features.length==2){let m=g.features[0],b=g.features[1];ne.update(_=>(m.id=_.features[u].id,b.id=Nt(_),m.properties=JSON.parse(JSON.stringify(_.features[u].properties)),b.properties=JSON.parse(JSON.stringify(m.properties)),c(_.features[u],m,b,l),_.features.splice(u,1,m,b),_))}a()}}function c(g,m,b,_){m.properties.length_meters=Xt(m,{units:"kilometers"})*1e3,b.properties.length_meters=Xt(b,{units:"kilometers"})*1e3,m.properties.waypoints=[],b.properties.waypoints=[];let v=f(g,_),y=!0,M=0;for(let L of g.properties.waypoints){let C=f(g,pt([L.lon,L.lat]));if(y)if(C<v)m.properties.waypoints.push(L);else{let R=L.snapped&&g.properties.waypoints[M-1].snapped;m.properties.waypoints.push({lon:_.geometry.coordinates[0],lat:_.geometry.coordinates[1],snapped:R}),y=!1,b.properties.waypoints.push({lon:_.geometry.coordinates[0],lat:_.geometry.coordinates[1],snapped:R}),b.properties.waypoints.push(L)}else b.properties.waypoints.push(L);M++}}function f(g,m){let b=g.geometry.coordinates[0],_=fu(b,m,g);return Xt(_,{units:"kilometers"})*1e3}function d(g){o==Ct&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=De();l&&g.features.push(l),i.getSource(Tn).setData(g)}},[o,d,s,qi,a,l,i]}class mu extends V{constructor(e){super(),K(this,e,du,cu,Z,{mode:0,changeMode:2,start:3,stop:4})}get start(){return qi}get stop(){return this.$$.ctx[4]}}const _u="/atip/scheme_overview/assets/edit_attributes-29b396e1.svg",gu="/atip/scheme_overview/assets/edit_geometry-02dad294.svg",bu="/atip/scheme_overview/assets/point-276f4055.svg",vu="/atip/scheme_overview/assets/polygon_snapped-18efbbea.svg",yu="/atip/scheme_overview/assets/polygon_freehand-cf965967.svg",wu="/atip/scheme_overview/assets/route-d3c0ebad.svg",ku="/atip/scheme_overview/assets/split_route-9e0ea2da.svg";function ri(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new Ha({props:n}),r[15](e),{c(){N(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){O(e.$$.fragment,i),t=!1},d(i){r[15](null),D(e,i)}}}function ii(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"point",label:"New point",icon:bu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function oi(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new ou({props:n}),r[18](e),{c(){N(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){O(e.$$.fragment,i),t=!1},d(i){r[18](null),D(e,i)}}}function si(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"route",label:"New route",icon:wu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function li(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:ku,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Su(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,d,g,m,b,_,v,y,M,L,C,R,F,x,P,q,Y,te,le,ke;n=new nt({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:_u,changeMode:r[13]}});let xe={mode:r[3],changeMode:r[13]};o=new wa({props:xe}),r[14](o),l=new nt({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:gu,changeMode:r[13]}});let oe=r[2]&&ri(r),ie=r[1]!="planning"&&ii(r),Ie={mode:r[3],changeMode:r[13],pointTool:r[11]};f=new Qa({props:Ie}),r[16](f),m=new nt({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:yu,changeMode:r[13]}});let Le={mode:r[3],changeMode:r[13],polygonTool:r[12]};_=new nu({props:Le}),r[17](_),M=new nt({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:vu,changeMode:r[13]}});let W=r[2]&&oi(r),pe=r[1]!="planning"&&si(r);function Dt(j){r[20](j)}let _e={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(_e.routeTool=r[2]),x=new Va({props:_e}),r[19](x),ue.push(()=>Ee(x,"routeTool",Dt,r[2]));let I=r[1]!="planning"&&li(r),ee={mode:r[3],changeMode:r[13]};return le=new mu({props:ee}),r[21](le),{c(){e=E("div"),t=E("div"),N(n.$$.fragment),i=A(),N(o.$$.fragment),s=A(),a=E("div"),N(l.$$.fragment),u=A(),oe&&oe.c(),p=A(),h=E("div"),ie&&ie.c(),c=A(),N(f.$$.fragment),d=A(),g=E("div"),N(m.$$.fragment),b=A(),N(_.$$.fragment),v=A(),y=E("div"),N(M.$$.fragment),L=A(),W&&W.c(),C=A(),R=E("div"),pe&&pe.c(),F=A(),N(x.$$.fragment),q=A(),Y=E("div"),I&&I.c(),te=A(),N(le.$$.fragment),T(e,"class","toolbox svelte-4s4d3o")},m(j,fe){w(j,e,fe),S(e,t),B(n,t,null),S(t,i),B(o,t,null),S(e,s),S(e,a),B(l,a,null),S(a,u),oe&&oe.m(a,null),S(e,p),S(e,h),ie&&ie.m(h,null),S(h,c),B(f,h,null),S(e,d),S(e,g),B(m,g,null),S(g,b),B(_,g,null),S(e,v),S(e,y),B(M,y,null),S(y,L),W&&W.m(y,null),S(e,C),S(e,R),pe&&pe.m(R,null),S(R,F),B(x,R,null),S(e,q),S(e,Y),I&&I.m(Y,null),S(Y,te),B(le,Y,null),ke=!0},p(j,[fe]){const rr={};fe&8&&(rr.mode=j[3]),n.$set(rr);const ir={};fe&8&&(ir.mode=j[3]),o.$set(ir);const or={};fe&8&&(or.mode=j[3]),l.$set(or),j[2]?oe?(oe.p(j,fe),fe&4&&$(oe,1)):(oe=ri(j),oe.c(),$(oe,1),oe.m(a,null)):oe&&(de(),O(oe,1,1,()=>{oe=null}),me()),j[1]!="planning"?ie?(ie.p(j,fe),fe&2&&$(ie,1)):(ie=ii(j),ie.c(),$(ie,1),ie.m(h,c)):ie&&(de(),O(ie,1,1,()=>{ie=null}),me());const sr={};fe&8&&(sr.mode=j[3]),f.$set(sr);const lr={};fe&8&&(lr.mode=j[3]),m.$set(lr);const ar={};fe&8&&(ar.mode=j[3]),_.$set(ar);const ur={};fe&8&&(ur.mode=j[3]),M.$set(ur),j[2]?W?(W.p(j,fe),fe&4&&$(W,1)):(W=oi(j),W.c(),$(W,1),W.m(y,null)):W&&(de(),O(W,1,1,()=>{W=null}),me()),j[1]!="planning"?pe?(pe.p(j,fe),fe&2&&$(pe,1)):(pe=si(j),pe.c(),$(pe,1),pe.m(R,F)):pe&&(de(),O(pe,1,1,()=>{pe=null}),me());const jt={};fe&8&&(jt.mode=j[3]),fe&1&&(jt.url=j[0]),!P&&fe&4&&(P=!0,jt.routeTool=j[2],Me(()=>P=!1)),x.$set(jt),j[1]!="planning"?I?(I.p(j,fe),fe&2&&$(I,1)):(I=li(j),I.c(),$(I,1),I.m(Y,te)):I&&(de(),O(I,1,1,()=>{I=null}),me());const fr={};fe&8&&(fr.mode=j[3]),le.$set(fr)},i(j){ke||($(n.$$.fragment,j),$(o.$$.fragment,j),$(l.$$.fragment,j),$(oe),$(ie),$(f.$$.fragment,j),$(m.$$.fragment,j),$(_.$$.fragment,j),$(M.$$.fragment,j),$(W),$(pe),$(x.$$.fragment,j),$(I),$(le.$$.fragment,j),ke=!0)},o(j){O(n.$$.fragment,j),O(o.$$.fragment,j),O(l.$$.fragment,j),O(oe),O(ie),O(f.$$.fragment,j),O(m.$$.fragment,j),O(_.$$.fragment,j),O(M.$$.fragment,j),O(W),O(pe),O(x.$$.fragment,j),O(I),O(le.$$.fragment,j),ke=!1},d(j){j&&k(e),D(n),r[14](null),D(o),D(l),oe&&oe.d(),ie&&ie.d(),r[16](null),D(f),D(m),r[17](null),D(_),D(M),W&&W.d(),pe&&pe.d(),r[19](null),D(x),I&&I.d(),r[21](null),D(le)}}}function Eu(r,e,t){let n;re(r,je,x=>t(22,n=x));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new Xl(n),l=new oa(n),u="edit-attribute",p,h,c,f,d,g,m;function b(x){let P={"edit-attribute":p,"edit-geometry":h,route:c,point:f,"free-polygon":d,"snap-polygon":g,"split-route":m};if(u==x){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),P[u].stop(),t(3,u=x),console.log(`Starting new mode ${u}`),P[u].start()}Ft(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function _(x){ue[x?"unshift":"push"](()=>{p=x,t(4,p)})}function v(x){ue[x?"unshift":"push"](()=>{h=x,t(5,h)})}function y(x){ue[x?"unshift":"push"](()=>{f=x,t(7,f)})}function M(x){ue[x?"unshift":"push"](()=>{d=x,t(8,d)})}function L(x){ue[x?"unshift":"push"](()=>{g=x,t(9,g)})}function C(x){ue[x?"unshift":"push"](()=>{c=x,t(6,c)})}function R(x){s=x,t(2,s)}function F(x){ue[x?"unshift":"push"](()=>{m=x,t(10,m)})}return r.$$set=x=>{"routeSnapperUrl"in x&&t(0,i=x.routeSnapperUrl),"schema"in x&&t(1,o=x.schema)},[i,o,s,u,p,h,c,f,d,g,m,a,l,b,_,v,y,M,L,C,R,F]}class Mu extends V{constructor(e){super(),K(this,e,Eu,Su,Z,{routeSnapperUrl:0,schema:1})}}function $u(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,d,g,m,b,_,v;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",i=A(),o=E("button"),o.textContent="About",s=A(),a=E("button"),a.textContent="Instructions",l=A(),u=E("br"),p=A(),h=E("label"),c=z(`ATIP schema:
      `),f=E("select"),d=E("option"),d.textContent="v1",g=E("option"),g.textContent="v2",m=E("option"),m.textContent="Housing developments",b=E("option"),b.textContent="Critical issues",T(n,"type","button"),T(o,"type","button"),T(a,"type","button"),d.__value="v1",d.value=d.__value,g.__value="v2",g.value=g.__value,m.__value="planning",m.value=m.__value,b.__value="criticals",b.value=b.__value,r[2]===void 0&&_t(()=>r[11].call(f)),T(e,"slot","nav")},m(y,M){w(y,e,M),S(e,t),S(t,n),S(t,i),S(t,o),S(t,s),S(t,a),S(e,l),S(e,u),S(e,p),S(e,h),S(h,c),S(h,f),S(f,d),S(f,g),S(f,m),S(f,b),Ke(f,r[2]),_||(v=[U(n,"click",r[10]),U(o,"click",r[7]),U(a,"click",r[8]),U(f,"change",r[11]),U(f,"change",r[9])],_=!0)},p(y,M){M&4&&Ke(f,y[2])},d(y){y&&k(e),_=!1,Ae(v)}}}function Lu(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,d,g,m;return o=new Tl({props:{boundaryGeojson:r[4]}}),a=new Al({props:{authorityName:r[5],schema:r[2]}}),h=new kl({props:{schema:r[2]}}),g=new Ml({}),{c(){e=E("div"),t=E("h1"),n=z(r[5]),i=A(),N(o.$$.fragment),s=A(),N(a.$$.fragment),l=A(),u=E("br"),p=A(),N(h.$$.fragment),c=A(),f=E("hr"),d=A(),N(g.$$.fragment),T(e,"slot","sidebar")},m(b,_){w(b,e,_),S(e,t),S(t,n),S(t,i),B(o,t,null),S(e,s),B(a,e,null),S(e,l),S(e,u),S(e,p),B(h,e,null),S(e,c),S(e,f),S(e,d),B(g,e,null),m=!0},p(b,_){const v={};_&16&&(v.boundaryGeojson=b[4]),o.$set(v);const y={};_&4&&(y.schema=b[2]),a.$set(y);const M={};_&4&&(M.schema=b[2]),h.$set(M)},i(b){m||($(o.$$.fragment,b),$(a.$$.fragment,b),$(h.$$.fragment,b),$(g.$$.fragment,b),m=!0)},o(b){O(o.$$.fragment,b),O(a.$$.fragment,b),O(h.$$.fragment,b),O(g.$$.fragment,b),m=!1},d(b){b&&k(e),D(o),D(a),D(h),D(g)}}}function Ou(r){let e,t,n,i,o,s,a,l,u,p,h,c;return e=new _s({props:{boundaryGeojson:r[4]}}),n=new Hl({props:{schema:r[2]}}),o=new Jl({}),a=new Mu({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new Fl({props:{style:r[6]}}),h=new ql({props:{schema:r[2]}}),{c(){N(e.$$.fragment),t=A(),N(n.$$.fragment),i=A(),N(o.$$.fragment),s=A(),N(a.$$.fragment),l=A(),N(u.$$.fragment),p=A(),N(h.$$.fragment)},m(f,d){B(e,f,d),w(f,t,d),B(n,f,d),w(f,i,d),B(o,f,d),w(f,s,d),B(a,f,d),w(f,l,d),B(u,f,d),w(f,p,d),B(h,f,d),c=!0},p(f,d){const g={};d&16&&(g.boundaryGeojson=f[4]),e.$set(g);const m={};d&4&&(m.schema=f[2]),n.$set(m);const b={};d&8&&(b.routeSnapperUrl=f[3]),d&4&&(b.schema=f[2]),a.$set(b);const _={};d&4&&(_.schema=f[2]),h.$set(_)},i(f){c||($(e.$$.fragment,f),$(n.$$.fragment,f),$(o.$$.fragment,f),$(a.$$.fragment,f),$(u.$$.fragment,f),$(h.$$.fragment,f),c=!0)},o(f){O(e.$$.fragment,f),O(n.$$.fragment,f),O(o.$$.fragment,f),O(a.$$.fragment,f),O(u.$$.fragment,f),O(h.$$.fragment,f),c=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(i),D(o,f),f&&k(s),D(a,f),f&&k(l),D(u,f),f&&k(p),D(h,f)}}}function Au(r){let e,t,n;return t=new go({props:{style:r[6],$$slots:{default:[Ou]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),T(e,"slot","main")},m(i,o){w(i,e,o),B(t,e,null),n=!0},p(i,o){const s={};o&524316&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){O(t.$$.fragment,i),n=!1},d(i){i&&k(e),D(t)}}}function Ru(r){let e,t,n,i,o,s,a,l;e=new _o({props:{$$slots:{main:[Au],sidebar:[Lu],nav:[$u]},$$scope:{ctx:r}}});function u(f){r[12](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new co({props:p}),ue.push(()=>Ee(n,"open",u,r[0]));function h(f){r[13](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Go({props:c}),ue.push(()=>Ee(s,"open",h,r[1])),{c(){N(e.$$.fragment),t=A(),N(n.$$.fragment),o=A(),N(s.$$.fragment)},m(f,d){B(e,f,d),w(f,t,d),B(n,f,d),w(f,o,d),B(s,f,d),l=!0},p(f,[d]){const g={};d&524316&&(g.$$scope={dirty:d,ctx:f}),e.$set(g);const m={};!i&&d&1&&(i=!0,m.open=f[0],Me(()=>i=!1)),n.$set(m);const b={};!a&&d&2&&(a=!0,b.open=f[1],Me(()=>a=!1)),s.$set(b)},i(f){l||($(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!0)},o(f){O(e.$$.fragment,f),O(n.$$.fragment,f),O(s.$$.fragment,f),l=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(o),D(s,f)}}}function xu(r,e,t){let n;re(r,nn,L=>t(15,n=L));let i=!1,o=!1,s=window.location.hostname.includes("atip.uk");const a=new URLSearchParams(window.location.search);let l=a.get("authority"),u=a.get("style")||"streets",p=a.get("schema")||"v1";var h=`https://atip.uk/route-snappers/${l}.bin`,c=`https://atip.uk/route-info/${l}.bin`;s||(h=`https://atip.uk/route-snappers-dev/${l}.bin`,c=`https://atip.uk/route-info-dev/${l}.bin`);function f(){t(0,i=!i),t(1,o=!1)}function d(){t(1,o=!o),t(0,i=!1)}let g;gn(async()=>{t(4,g=await m());const L=hi(new Ro);nn.set(await new L),await n.loadFile(c)});async function m(){const C=await(await fetch(po)).text(),R=JSON.parse(C);return R.features=R.features.filter(F=>{var x;return((x=F.properties)==null?void 0:x.name)==l}),R}function b(){let L=new URLSearchParams(window.location.search);L.set("schema",p);let C=`${window.location.pathname}?${L.toString()}${window.location.hash}`;window.location.href=C}const _=()=>window.open("index.html");function v(){p=bn(this),t(2,p)}function y(L){i=L,t(0,i)}function M(L){o=L,t(1,o)}return[i,o,p,h,g,l,u,f,d,b,_,v,y,M]}class Cu extends V{constructor(e){super(),K(this,e,xu,Ru,Z,{})}}new Cu({target:document.getElementById("app")});
