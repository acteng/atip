var Ui=Object.defineProperty;var qi=(r,e,t)=>e in r?Ui(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var oe=(r,e,t)=>(qi(r,typeof e!="symbol"?e+"":e,t),t);import{S as V,i as K,s as Z,b as ue,a as Ee,d as N,m as B,k as Me,n as $,o as O,q as D,e as E,c as R,g as w,E as G,p as k,F as Gi,G as Hi,H as se,I as Yi,v as Wn,J as Qe,K as we,L as dn,f as T,h as S,M as Kt,x as ae,t as z,N as Zt,O as Be,P as ht,Q as mn,R as Pt,T as be,U as _t,V as Ke,l as U,W as de,X as me,Y as _n,j as Oe,r as Re,A as De,Z as si,_ as Qt,$ as ur,y as fr,w as Ji,B as Xi,C as zi,D as Wi,a0 as Vi,a1 as Ki,a2 as Ce,a3 as Zi,a4 as Qi,a5 as gn,a6 as gt,a7 as bn,a8 as vn,a9 as Cn,aa as eo,ab as pt,ac as Vn,ad as We,ae as dt,af as to,ag as Kn,ah as no,ai as ro,aj as io,ak as cr,al as en,am as oo,an as so,ao as lo}from"./maplibre_helpers-79179479.js";import{M as ao,A as uo,a as fo}from"./authorities-86248eae.js";import{m as je,M as co,g as ne,l as Ct,s as tn,a as He,f as Se,o as nn,b as rn,d as pr,F as po,C as yn,c as he,e as wn,n as Ft,L as ho,h as mo}from"./CollapsibleCard-79efbdf3.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const li=Symbol("Comlink.proxy"),_o=Symbol("Comlink.endpoint"),go=Symbol("Comlink.releaseProxy"),Sn=Symbol("Comlink.finalizer"),Gt=Symbol("Comlink.thrown"),ai=r=>typeof r=="object"&&r!==null||typeof r=="function",bo={canHandle:r=>ai(r)&&r[li],serialize(r){const{port1:e,port2:t}=new MessageChannel;return Zn(r,e),[t,[t]]},deserialize(r){return r.start(),ci(r)}},vo={canHandle:r=>ai(r)&&Gt in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},ui=new Map([["proxy",bo],["throw",vo]]);function yo(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function Zn(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!yo(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(et);let u;try{const p=a.slice(0,-1).reduce((c,f)=>c[f],r),h=a.reduce((c,f)=>c[f],r);switch(s){case"GET":u=h;break;case"SET":p[a.slice(-1)[0]]=et(i.data.value),u=!0;break;case"APPLY":u=h.apply(p,l);break;case"CONSTRUCT":{const c=new h(...l);u=$o(c)}break;case"ENDPOINT":{const{port1:c,port2:f}=new MessageChannel;Zn(r,f),u=Mo(c,[c])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[Gt]:0}}Promise.resolve(u).catch(p=>({value:p,[Gt]:0})).then(p=>{const[h,c]=ln(p);e.postMessage(Object.assign(Object.assign({},h),{id:o}),c),s==="RELEASE"&&(e.removeEventListener("message",n),fi(e),Sn in r&&typeof r[Sn]=="function"&&r[Sn]())}).catch(p=>{const[h,c]=ln({value:new TypeError("Unserializable return value"),[Gt]:0});e.postMessage(Object.assign(Object.assign({},h),{id:o}),c)})}),e.start&&e.start()}function wo(r){return r.constructor.name==="MessagePort"}function fi(r){wo(r)&&r.close()}function ci(r,e){return Tn(r,[],e)}function jt(r){if(r)throw new Error("Proxy has been released and is not useable")}function pi(r){return ut(r,{type:"RELEASE"}).then(()=>{fi(r)})}const on=new WeakMap,sn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(on.get(r)||0)-1;on.set(r,e),e===0&&pi(r)});function ko(r,e){const t=(on.get(e)||0)+1;on.set(e,t),sn&&sn.register(r,e,r)}function So(r){sn&&sn.unregister(r)}function Tn(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(jt(n),s===go)return()=>{So(i),pi(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=ut(r,{type:"GET",path:e.map(l=>l.toString())}).then(et);return a.then.bind(a)}return Tn(r,[...e,s])},set(o,s,a){jt(n);const[l,u]=ln(a);return ut(r,{type:"SET",path:[...e,s].map(p=>p.toString()),value:l},u).then(et)},apply(o,s,a){jt(n);const l=e[e.length-1];if(l===_o)return ut(r,{type:"ENDPOINT"}).then(et);if(l==="bind")return Tn(r,e.slice(0,-1));const[u,p]=hr(a);return ut(r,{type:"APPLY",path:e.map(h=>h.toString()),argumentList:u},p).then(et)},construct(o,s){jt(n);const[a,l]=hr(s);return ut(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(et)}});return ko(i,r),i}function Eo(r){return Array.prototype.concat.apply([],r)}function hr(r){const e=r.map(ln);return[e.map(t=>t[0]),Eo(e.map(t=>t[1]))]}const hi=new WeakMap;function Mo(r,e){return hi.set(r,e),r}function $o(r){return Object.assign(r,{[li]:!0})}function ln(r){for(const[e,t]of ui)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},hi.get(r)||[]]}function et(r){switch(r.type){case"HANDLER":return ui.get(r.name).deserialize(r.value);case"RAW":return r.value}}function ut(r,e,t){return new Promise(n=>{const i=Lo();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function Lo(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Oo(){return new Worker("/atip/scheme_overview/assets/worker-0e3fcb5c.js")}let Q;const di=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&di.decode();let wt=null;function $t(){return(wt===null||wt.byteLength===0)&&(wt=new Uint8Array(Q.memory.buffer)),wt}function tt(r,e){return r=r>>>0,di.decode($t().subarray(r,r+e))}const qe=new Array(128).fill(void 0);qe.push(void 0,null,!0,!1);let Lt=qe.length;function ge(r){Lt===qe.length&&qe.push(qe.length+1);const e=Lt;return Lt=qe[e],qe[e]=r,e}function H(r){return qe[r]}let rt=0;const Ht=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Ro=typeof Ht.encodeInto=="function"?function(r,e){return Ht.encodeInto(r,e)}:function(r,e){const t=Ht.encode(r);return e.set(t),{read:r.length,written:t.length}};function En(r,e,t){if(t===void 0){const a=Ht.encode(r),l=e(a.length)>>>0;return $t().subarray(l,l+a.length).set(a),rt=a.length,l}let n=r.length,i=e(n)>>>0;const o=$t();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3)>>>0;const a=$t().subarray(i+s,i+n),l=Ro(r,a);s+=l.written}return rt=s,i}function bt(r){return r==null}let kt=null;function ce(){return(kt===null||kt.byteLength===0)&&(kt=new Int32Array(Q.memory.buffer)),kt}function Io(r){r<132||(qe[r]=Lt,Lt=r)}function St(r){const e=H(r);return Io(r),e}let Et=null;function Ao(){return(Et===null||Et.byteLength===0)&&(Et=new Float64Array(Q.memory.buffer)),Et}let Mt=null;function Co(){return(Mt===null||Mt.byteLength===0)&&(Mt=new BigInt64Array(Q.memory.buffer)),Mt}function xn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=xn(r[0]));for(let s=1;s<i;s++)o+=", "+xn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function To(r,e){const t=e(r.length*1)>>>0;return $t().set(r,t/1),rt=r.length,t}function Mn(r,e){try{return r.apply(this,e)}catch(t){Q.__wbindgen_exn_store(ge(t))}}let Pn=class{static __wrap(e){e=e>>>0;const t=Object.create(Pn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Q.__wbg_routeinfo_free(e)}constructor(e){try{const o=Q.__wbindgen_add_to_stack_pointer(-16),s=To(e,Q.__wbindgen_malloc),a=rt;Q.routeinfo_new(o,s,a);var t=ce()[o/4+0],n=ce()[o/4+1],i=ce()[o/4+2];if(i)throw St(n);return Pn.__wrap(t)}finally{Q.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const p=Q.__wbindgen_add_to_stack_pointer(-16);Q.routeinfo_nameForRoute(p,this.__wbg_ptr,ge(e));var i=ce()[p/4+0],o=ce()[p/4+1],s=ce()[p/4+2],a=ce()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,St(s);return t=l,n=u,tt(l,u)}finally{Q.__wbindgen_add_to_stack_pointer(16),Q.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const p=Q.__wbindgen_add_to_stack_pointer(-16);Q.routeinfo_speedLimitForRoute(p,this.__wbg_ptr,ge(e));var i=ce()[p/4+0],o=ce()[p/4+1],s=ce()[p/4+2],a=ce()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,St(s);return t=l,n=u,tt(l,u)}finally{Q.__wbindgen_add_to_stack_pointer(16),Q.__wbindgen_free(t,n)}}allSpeedLimits(){let e,t;try{const u=Q.__wbindgen_add_to_stack_pointer(-16);Q.routeinfo_allSpeedLimits(u,this.__wbg_ptr);var n=ce()[u/4+0],i=ce()[u/4+1],o=ce()[u/4+2],s=ce()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,St(o);return e=a,t=l,tt(a,l)}finally{Q.__wbindgen_add_to_stack_pointer(16),Q.__wbindgen_free(e,t)}}};async function xo(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Po(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=tt(e,t);return ge(n)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(tt(e,t));return ge(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=H(t),i=typeof n=="string"?n:void 0;var o=bt(i)?0:En(i,Q.__wbindgen_malloc,Q.__wbindgen_realloc),s=rt;ce()[e/4+1]=s,ce()[e/4+0]=o},r.wbg.__wbindgen_object_drop_ref=function(e){St(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=H(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof H(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return ge(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return H(e)===H(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=H(t),i=typeof n=="number"?n:void 0;Ao()[e/8+1]=bt(i)?0:i,ce()[e/4+0]=!bt(i)},r.wbg.__wbindgen_is_object=function(e){const t=H(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return H(e)in H(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ge(t)},r.wbg.__wbindgen_is_undefined=function(e){return H(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return H(e)==H(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=H(e);return ge(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=H(e)[H(t)];return ge(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=H(t).stack,i=En(n,Q.__wbindgen_malloc,Q.__wbindgen_realloc),o=rt;ce()[e/4+1]=o,ce()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(tt(e,t))}finally{Q.__wbindgen_free(n,i)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(H(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(H(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(H(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(H(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(H(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=H(e)[t>>>0];return ge(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return H(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof H(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=H(e).next;return ge(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return Mn(function(e){const t=H(e).next();return ge(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return H(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=H(e).value;return ge(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return ge(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return Mn(function(e,t){const n=Reflect.get(H(e),H(t));return ge(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return Mn(function(e,t){const n=H(e).call(H(t));return ge(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(H(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=H(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(H(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(H(e));return ge(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=H(e).buffer;return ge(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(H(e));return ge(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){H(e).set(H(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return H(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=H(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=H(t),i=typeof n=="bigint"?n:void 0;Co()[e/8+1]=bt(i)?BigInt(0):i,ce()[e/4+0]=!bt(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=xn(H(t)),i=En(n,Q.__wbindgen_malloc,Q.__wbindgen_realloc),o=rt;ce()[e/4+1]=o,ce()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(tt(e,t))},r.wbg.__wbindgen_memory=function(){const e=Q.memory;return ge(e)},r}function Fo(r,e){return Q=r.exports,mi.__wbindgen_wasm_module=e,Mt=null,Et=null,kt=null,wt=null,Q}async function mi(r){if(Q!==void 0)return Q;typeof r>"u"&&(r="/atip/scheme_overview/assets/route_info_bg.wasm");const e=Po();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await xo(await r,e);return Fo(t,n)}class No{constructor(){oe(this,"inner");this.inner=null}async loadFile(e){await mi(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new Pn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.speedLimitForRoute(e)}allSpeedLimits(){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.allSpeedLimits()}}Zn(No);function Bo(r){let e,t,n,i,o,s,a,l,u,p,h,c,f;return{c(){e=E("p"),e.textContent="For each intervention:",t=R(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=R(),o=E("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=R(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=R(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=R(),h=E("p"),h.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=R(),f=E("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(m,_){w(m,e,_),w(m,t,_),w(m,n,_),w(m,i,_),w(m,o,_),w(m,s,_),w(m,a,_),w(m,l,_),w(m,u,_),w(m,p,_),w(m,h,_),w(m,c,_),w(m,f,_)},p:G,d(m){m&&k(e),m&&k(t),m&&k(n),m&&k(i),m&&k(o),m&&k(s),m&&k(a),m&&k(l),m&&k(u),m&&k(p),m&&k(h),m&&k(c),m&&k(f)}}}function Do(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Bo]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new ao({props:o}),ue.push(()=>Ee(e,"open",i,r[0])),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function jo(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Uo extends V{constructor(e){super(),K(this,e,jo,Do,Z,{open:0})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function qo(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ze=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Go(r,e){return r>e?1:r<e?-1:0}function Ye(r,e,t){for(var n=new Ze(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function $n(r,e,t,n){var i=new Ze(r,e);if(t===null)return i.left=i.right=null,i;t=Ye(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function dr(r,e,t){var n=null,i=null;if(e){e=Ye(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Ho(r,e,t){return e===null?r:(r===null||(e=Ye(r.key,e,t),e.left=r),e)}function Fn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Fn(r.left,o,!1,n,i),r.right&&Fn(r.right,o,!0,n,i)}}var Qn=function(){function r(e){e===void 0&&(e=Go),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=$n(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ze(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ye(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ye(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ye(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ye(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ye(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Jo(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Dn(e,t,0,i-1,o),this._root===null)this._root=Nn(e,t,0,i),this._size=i;else{var s=Xo(this.toList(),Yo(e,t),o);i=this._size+i,this._root=Bn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Fn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=dr(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=$n(t,n,a,i):s=$n(t,n,s,i),this._root=Ho(s,a,i)},r.prototype.split=function(e){return dr(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return qo(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Nn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ze(s,a);return l.left=Nn(r,e,t,o),l.right=Nn(r,e,o+1,n),l}return null}function Yo(r,e){for(var t=new Ze(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ze(r[i],e[i]);return n.next=null,t.next}function Jo(r){for(var e=r,t=[],n=!1,i=new Ze(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Bn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Bn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Bn(r,i+1,t),s}return null}function Xo(r,e,t){for(var n=new Ze(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Dn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Dn(r,e,t,a,i),Dn(r,e,a+1,n,i)}}function Ie(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function mr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function $e(r,e,t){return e&&mr(r.prototype,e),t&&mr(r,t),r}var vt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},jn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Xe=Number.EPSILON;Xe===void 0&&(Xe=Math.pow(2,-52));var zo=Xe*Xe,Un=function(e,t){if(-Xe<e&&e<Xe&&-Xe<t&&t<Xe)return 0;var n=e-t;return n*n<zo*e*t?0:e<t?-1:1},Wo=function(){function r(){Ie(this,r),this.reset()}return $e(r,[{key:"reset",value:function(){this.xRounder=new _r,this.yRounder=new _r}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),_r=function(){function r(){Ie(this,r),this.tree=new Qn,this.round(0)}return $e(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Un(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Un(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Tt=new Wo,Ot=function(e,t){return e.x*t.y-e.y*t.x},_i=function(e,t){return e.x*t.x+e.y*t.y},gr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Ot(i,o);return Un(s,0)},an=function(e){return Math.sqrt(_i(e,e))},Vo=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Ot(o,i)/an(o)/an(i)},Ko=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return _i(o,i)/an(o)/an(i)},br=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},vr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},Zo=function(e,t,n,i){if(t.x===0)return vr(n,i,e.x);if(i.x===0)return vr(e,t,n.x);if(t.y===0)return br(n,i,e.y);if(i.y===0)return br(e,t,n.y);var o=Ot(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=Ot(s,t)/o,l=Ot(s,i)/o,u=e.x+l*t.x,p=n.x+a*i.x,h=e.y+l*t.y,c=n.y+a*i.y,f=(u+p)/2,m=(h+c)/2;return{x:f,y:m}},Fe=function(){$e(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:un.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Ie(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return $e(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:Vo(n.point,t.point,l.point),cosine:Ko(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,p=l.cosine,h=i.get(a),c=h.sine,f=h.cosine;return u>=0&&c>=0?p<f?1:p>f?-1:0:u<0&&c<0?p<f?-1:p>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),Qo=0,un=function(){$e(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,h=n.rightSE.point.y;if(i<o){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<h)return-1;if(l>u&&l>h)return 1;var m=n.comparePoint(t.leftSE.point);if(m!==0)return m;var _=t.comparePoint(n.rightSE.point);return _<0?1:_>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var g=n.comparePoint(t.rightSE.point);if(g!==0)return g}if(s>a){var b=t.comparePoint(n.rightSE.point);if(b<0)return 1;if(b>0)return-1}if(s!==a){var d=p-l,v=s-i,y=h-u,M=a-o;if(d>v&&y<M)return 1;if(d<v&&y>M)return-1}return s>a?1:s<a||p<h?-1:p>h?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Ie(this,r),this.id=++Qo,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return $e(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=jn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=vt(n,l)&&this.comparePoint(l)===0,h=vt(i,s)&&t.comparePoint(s)===0,c=vt(n,u)&&this.comparePoint(u)===0,f=vt(i,a)&&t.comparePoint(a)===0;if(h&&p)return f&&!c?a:!f&&c?u:null;if(h)return c&&s.x===u.x&&s.y===u.y?null:s;if(p)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var m=Zo(s,this.vector(),l,t.vector());return m===null||!vt(o,m)?null:Tt.round(m.x,m.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Fe(t,!0),s=new Fe(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Fe.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Fe.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var p=i.rings[l],h=i.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(h)):n.windings[c]+=h}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),i.push(u)):i[p]+=u}for(var h=[],c=[],f=0,m=n.length;f<m;f++)if(i[f]!==0){var _=n[f],g=_.poly;if(c.indexOf(g)===-1)if(_.isExterior)h.push(g);else{c.indexOf(g)===-1&&c.push(g);var b=h.indexOf(_.poly);b!==-1&&h.splice(b,1)}}for(var d=0,v=h.length;d<v;d++){var y=h[d].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Te.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Te.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(h){return h.length===1&&h[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Te.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Fe.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Fe(o,!0),p=new Fe(s,!1);return new r(u,p,[i],[a])}}]),r}(),yr=function(){function r(e,t,n){if(Ie(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Tt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Tt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(un.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(un.fromRing(o,i,this))}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),es=function(){function r(e,t){if(Ie(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new yr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new yr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),wr=function(){function r(e,t){if(Ie(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new es(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),ts=function(){$e(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],h=l.point,c=[];a=l,l=u,p.push(l),l.point!==h;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var m=p[0].point,_=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(m.x,",")+" ".concat(m.y,"]. Last matching segment found ends at")+" [".concat(_.x,", ").concat(_.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var g=null,b=0,d=c.length;b<d;b++)if(c[b].point===l.point){g=b;break}if(g!==null){var v=c.splice(g)[0],y=p.splice(v.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}c.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Ie(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return $e(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;gr(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];gr(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],m=h;m!=c;m+=p)f.push([n[m].x,n[m].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Fe.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),kr=function(){function r(e){Ie(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return $e(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),ns=function(){function r(e){Ie(this,r),this.rings=e,this.polys=this._composePolys(e)}return $e(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new kr(s));else{var a=s.enclosingRing();a.poly||n.push(new kr(a)),a.poly.addInterior(s)}}return n}}]),r}(),rs=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:un.compare;Ie(this,r),this.queue=e,this.tree=new Qn(t),this.segments=[]}return $e(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var h=l.getIntersection(n);if(h!==null&&(n.isAnEndpoint(h)||(p=h),!l.isAnEndpoint(h)))for(var c=this._splitSafely(l,h),f=0,m=c.length;f<m;f++)i.push(c[f])}var _=null;if(u){var g=u.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(_=g),!u.isAnEndpoint(g)))for(var b=this._splitSafely(u,g),d=0,v=b.length;d<v;d++)i.push(b[d])}if(p!==null||_!==null){var y=null;if(p===null)y=_;else if(_===null)y=p;else{var M=Fe.comparePoints(p,_);y=M<=0?p:_}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var L=n.split(y),A=0,I=L.length;A<I;A++)i.push(L[A])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var F=l.getIntersection(u);if(F!==null){if(!l.isAnEndpoint(F))for(var C=this._splitSafely(l,F),x=0,q=C.length;x<q;x++)i.push(C[x]);if(!u.isAnEndpoint(F))for(var Y=this._splitSafely(u,F),te=0,le=Y.length;te<le;te++)i.push(Y[te])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Sr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,is=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,os=function(){function r(){Ie(this,r)}return $e(r,[{key:"run",value:function(t,n,i){Te.type=t,Tt.reset();for(var o=[new wr(n,!0)],s=0,a=i.length;s<a;s++)o.push(new wr(i[s],!1));if(Te.numMultiPolys=o.length,Te.type==="difference")for(var l=o[0],u=1;u<o.length;)jn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Te.type==="intersection"){for(var p=0,h=o.length;p<h;p++)for(var c=o[p],f=p+1,m=o.length;f<m;f++)if(jn(c.bbox,o[f].bbox)===null)return[]}for(var _=new Qn(Fe.compare),g=0,b=o.length;g<b;g++)for(var d=o[g].getSweepEvents(),v=0,y=d.length;v<y;v++)if(_.insert(d[v]),_.size>Sr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new rs(_),L=_.size,A=_.pop();A;){var I=A.key;if(_.size===L){var F=I.segment;throw new Error("Unable to pop() ".concat(I.isLeft?"left":"right"," SweepEvent ")+"[".concat(I.point.x,", ").concat(I.point.y,"] from segment #").concat(F.id," ")+"[".concat(F.leftSE.point.x,", ").concat(F.leftSE.point.y,"] -> ")+"[".concat(F.rightSE.point.x,", ").concat(F.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(_.size>Sr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>is)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var C=M.process(I),x=0,q=C.length;x<q;x++){var Y=C[x];Y.consumedBy===void 0&&_.insert(Y)}L=_.size,A=_.pop()}Tt.reset();var te=ts.factory(M.segments),le=new ns(te);return le.getGeom()}}]),r}(),Te=new os,ss=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Te.run("union",e,n)},ls=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Te.run("intersection",e,n)},as=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Te.run("xor",e,n)},us=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Te.run("difference",e,n)},Yt={union:ss,intersection:ls,xor:as,difference:us};function fs(r,e){var t=ps(e),n=null;return r.type==="FeatureCollection"?n=cs(r):n=gi(Yt.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function cs(r){var e=r.features.length===2?Yt.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Yt.union.apply(Yt,r.features.map(function(t){return t.geometry.coordinates}));return gi(e)}function gi(r){return Gi(r)}function ps(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return Hi(t)}function hs(r,e,t){let n;se(r,je,s=>t(1,n=s));let{boundaryGeojson:i}=e;return Yi("setCamera")&&n.fitBounds(Wn(i),{padding:20,animate:!1}),Qe(n,"boundary",fs(i)),we(n,{id:"boundary",source:"boundary",...dn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class ds extends V{constructor(e){super(),K(this,e,hs,null,Z,{boundaryGeojson:0})}}function Er(r,e,t){const n=r.slice();return n[4]=e[t],n}function Mr(r,e,t){const n=r.slice();return n[7]=e[t],n}function $r(r){let e;return{c(){e=E("td"),T(e,"class","svelte-11t6rxo"),ae(e,"background-color",r[7])},m(t,n){w(t,e,n)},p(t,n){n&1&&ae(e,"background-color",t[7])},d(t){t&&k(e)}}}function Lr(r){let e,t=r[4]+"",n;return{c(){e=E("td"),n=z(t),T(e,"class","svelte-11t6rxo")},m(i,o){w(i,e,o),S(e,n)},p:G,d(i){i&&k(e)}}}function ms(r){let e,t,n,i,o=r[0],s=[];for(let u=0;u<o.length;u+=1)s[u]=$r(Mr(r,o,u));let a=r[1],l=[];for(let u=0;u<a.length;u+=1)l[u]=Lr(Er(r,a,u));return{c(){e=E("table"),t=E("tr");for(let u=0;u<s.length;u+=1)s[u].c();n=R(),i=E("tr");for(let u=0;u<l.length;u+=1)l[u].c();T(t,"class","svelte-11t6rxo"),T(i,"class","svelte-11t6rxo"),T(e,"class","svelte-11t6rxo")},m(u,p){w(u,e,p),S(e,t);for(let h=0;h<s.length;h+=1)s[h].m(t,null);S(e,n),S(e,i);for(let h=0;h<l.length;h+=1)l[h].m(i,null)},p(u,[p]){if(p&1){o=u[0];let h;for(h=0;h<o.length;h+=1){const c=Mr(u,o,h);s[h]?s[h].p(c,p):(s[h]=$r(c),s[h].c(),s[h].m(t,null))}for(;h<s.length;h+=1)s[h].d(1);s.length=o.length}if(p&2){a=u[1];let h;for(h=0;h<a.length;h+=1){const c=Er(u,a,h);l[h]?l[h].p(c,p):(l[h]=Lr(c),l[h].c(),l[h].m(i,null))}for(;h<l.length;h+=1)l[h].d(1);l.length=a.length}},i:G,o:G,d(u){u&&k(e),Kt(s,u),Kt(l,u)}}}function _s(r,e,t){let{colors:n}=e,{steps:i}=e;if(n.length!=i.length+1)throw new Error("There must be one more color than step");let o=[],s=0;for(let a of i)o.push(`${s}-${a}`),s=a;return o.push(`>${s}`),r.$$set=a=>{"colors"in a&&t(0,n=a.colors),"steps"in a&&t(2,i=a.steps)},[n,o,i]}class gs extends V{constructor(e){super(),K(this,e,_s,ms,Z,{colors:0,steps:2})}}const bs="/atip/scheme_overview/assets/help-d011708a.svg";function vs(r){let e,t;return{c(){e=E("img"),Zt(e.src,t=bs)||T(e,"src",t),T(e,"title",r[0]),T(e,"alt",r[0])},m(n,i){w(n,e,i)},p(n,[i]){i&1&&T(e,"title",n[0]),i&1&&T(e,"alt",n[0])},i:G,o:G,d(n){n&&k(e)}}}function ys(r,e,t){let{contents:n}=e;return r.$$set=i=>{"contents"in i&&t(0,n=i.contents)},[n]}class ws extends V{constructor(e){super(),K(this,e,ys,vs,Z,{contents:0})}}function ks(r){let e,t,n,i,o,s,a;return t=new ws({props:{contents:"Data comes from OpenStreetMap, and may not always be correct. Freehand segments and off-road paths generally have no speed data."}}),i=new gs({props:{colors:r[0],steps:r[1]}}),s=new co({props:{layers:["speed-limits"],contents:Ss}}),{c(){e=z(`(mph)
`),N(t.$$.fragment),n=R(),N(i.$$.fragment),o=R(),N(s.$$.fragment)},m(l,u){w(l,e,u),B(t,l,u),w(l,n,u),B(i,l,u),w(l,o,u),B(s,l,u),a=!0},p:G,i(l){a||($(t.$$.fragment,l),$(i.$$.fragment,l),$(s.$$.fragment,l),a=!0)},o(l){O(t.$$.fragment,l),O(i.$$.fragment,l),O(s.$$.fragment,l),a=!1},d(l){l&&k(e),D(t,l),l&&k(n),D(i,l),l&&k(o),D(s,l)}}}let it="speed-limits",Ln="speed-limits";function Ss(r){return r.speed_limit?`${Math.round(r.speed_limit)} mph`:"Unknown"}function Es(r,e,t){let n,i;se(r,je,p=>t(4,n=p)),se(r,ne,p=>t(5,i=p));let{routeInfo:o}=e,{id:s}=e,a=["#00AB4D","#8ECA4D","#F7BB00","#BB0000"],l=[30,40,50];const u=["step",["get","speed_limit"],a[0],l[0],a[1],l[1],a[2],l[2],a[3]];return Qe(n,it,Be()),we(n,{id:Ln,source:it,...ht(u,Ct,1)}),mn(async()=>{try{if(s){let p=i.features.find(c=>c.id==s),h=JSON.parse(await o.speedLimitForRoute(p.properties.waypoints));n.getSource(it).setData(h)}else{let p=JSON.parse(await o.allSpeedLimits());n.getSource(it).setData(p)}}catch(p){window.alert(`Couldn't calculate speed limits for route: ${p}`)}}),Pt(()=>{n.getLayer(Ln)&&n.removeLayer(Ln),n.getSource(it)&&n.removeSource(it)}),r.$$set=p=>{"routeInfo"in p&&t(2,o=p.routeInfo),"id"in p&&t(3,s=p.id)},[a,l,o,s]}class bi extends V{constructor(e){super(),K(this,e,Es,ks,Z,{routeInfo:2,id:3})}}function Or(r){let e,t;return e=new bi({props:{routeInfo:r[0],id:r[1]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeInfo=n[0]),i&2&&(o.id=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ms(r){let e,t,n,i,o,s,a,l,u,p,h=r[2]=="speed limits"&&Or(r);return{c(){e=E("label"),t=z(`Show details:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",s=R(),h&&h.c(),a=be(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,r[2]===void 0&&_t(()=>r[3].call(n))},m(c,f){w(c,e,f),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[2]),w(c,s,f),h&&h.m(c,f),w(c,a,f),l=!0,u||(p=U(n,"change",r[3]),u=!0)},p(c,[f]){f&4&&Ke(n,c[2]),c[2]=="speed limits"?h?(h.p(c,f),f&4&&$(h,1)):(h=Or(c),h.c(),$(h,1),h.m(a.parentNode,a)):h&&(de(),O(h,1,1,()=>{h=null}),me())},i(c){l||($(h),l=!0)},o(c){O(h),l=!1},d(c){c&&k(e),c&&k(s),h&&h.d(c),c&&k(a),u=!1,p()}}}function $s(r,e,t){let{routeInfo:n}=e,{id:i}=e,o="none";function s(){o=_n(this),t(2,o)}return r.$$set=a=>{"routeInfo"in a&&t(0,n=a.routeInfo),"id"in a&&t(1,i=a.id)},[n,i,o,s]}class Ls extends V{constructor(e){super(),K(this,e,$s,Ms,Z,{routeInfo:0,id:1})}}function Rr(r){let e,t=Ir(r[5])+"",n,i,o,s,a,l,u,p,h,c;return u=new Ls({props:{routeInfo:r[3],id:r[4]}}),{c(){e=z("Length: "),n=z(t),i=R(),o=E("br"),s=E("button"),s.textContent="Auto-fill details",a=E("br"),l=R(),N(u.$$.fragment),T(s,"type","button")},m(f,m){w(f,e,m),w(f,n,m),w(f,i,m),w(f,o,m),w(f,s,m),w(f,a,m),w(f,l,m),B(u,f,m),p=!0,h||(c=U(s,"click",r[14]),h=!0)},p(f,m){(!p||m&32)&&t!==(t=Ir(f[5])+"")&&De(n,t);const _={};m&8&&(_.routeInfo=f[3]),m&16&&(_.id=f[4]),u.$set(_)},i(f){p||($(u.$$.fragment,f),p=!0)},o(f){O(u.$$.fragment,f),p=!1},d(f){f&&k(e),f&&k(n),f&&k(i),f&&k(o),f&&k(s),f&&k(a),f&&k(l),D(u,f),h=!1,c()}}}function Os(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,m,_,g,b,d,v,y,M,L,A,I,F,C,x,q,Y,te,le,ke,Ae,ie,re,xe,Le,W,pe,Bt,_e=r[5]&&Rr(r);return{c(){e=E("label"),t=z("Name:"),n=E("br"),i=R(),o=E("input"),s=R(),a=E("br"),l=R(),u=E("br"),p=R(),h=E("label"),c=E("input"),f=z(`
  Area`),m=R(),_=E("label"),g=E("input"),b=z(`
  Route`),d=R(),v=E("label"),y=E("input"),M=z(`
  Crossing`),L=R(),A=E("label"),I=E("input"),F=z(`
  Other`),C=R(),x=E("br"),q=R(),Y=E("br"),te=R(),le=E("label"),ke=z("Description:"),Ae=E("br"),ie=R(),re=E("textarea"),xe=R(),_e&&_e.c(),Le=be(),T(o,"type","text"),ae(o,"width","100%"),T(c,"type","radio"),c.__value="area",c.value=c.__value,r[9][0].push(c),T(g,"type","radio"),g.__value="route",g.value=g.__value,r[9][0].push(g),T(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[9][0].push(y),T(I,"type","radio"),I.__value="other",I.value=I.__value,r[9][0].push(I),ae(re,"width","100%"),T(re,"rows","5"),T(re,"class","svelte-15lna0i")},m(P,ee){w(P,e,ee),S(e,t),S(e,n),S(e,i),S(e,o),Oe(o,r[0]),w(P,s,ee),w(P,a,ee),w(P,l,ee),w(P,u,ee),w(P,p,ee),w(P,h,ee),S(h,c),c.checked=c.__value===r[1],S(h,f),w(P,m,ee),w(P,_,ee),S(_,g),g.checked=g.__value===r[1],S(_,b),w(P,d,ee),w(P,v,ee),S(v,y),y.checked=y.__value===r[1],S(v,M),w(P,L,ee),w(P,A,ee),S(A,I),I.checked=I.__value===r[1],S(A,F),w(P,C,ee),w(P,x,ee),w(P,q,ee),w(P,Y,ee),w(P,te,ee),w(P,le,ee),S(le,ke),S(le,Ae),S(le,ie),S(le,re),Oe(re,r[2]),w(P,xe,ee),_e&&_e.m(P,ee),w(P,Le,ee),W=!0,pe||(Bt=[U(o,"input",r[7]),U(c,"change",r[8]),U(g,"change",r[10]),U(y,"change",r[11]),U(I,"change",r[12]),U(re,"input",r[13])],pe=!0)},p(P,[ee]){ee&1&&o.value!==P[0]&&Oe(o,P[0]),ee&2&&(c.checked=c.__value===P[1]),ee&2&&(g.checked=g.__value===P[1]),ee&2&&(y.checked=y.__value===P[1]),ee&2&&(I.checked=I.__value===P[1]),ee&4&&Oe(re,P[2]),P[5]?_e?(_e.p(P,ee),ee&32&&$(_e,1)):(_e=Rr(P),_e.c(),$(_e,1),_e.m(Le.parentNode,Le)):_e&&(de(),O(_e,1,1,()=>{_e=null}),me())},i(P){W||($(_e),W=!0)},o(P){O(_e),W=!1},d(P){P&&k(e),P&&k(s),P&&k(a),P&&k(l),P&&k(u),P&&k(p),P&&k(h),r[9][0].splice(r[9][0].indexOf(c),1),P&&k(m),P&&k(_),r[9][0].splice(r[9][0].indexOf(g),1),P&&k(d),P&&k(v),r[9][0].splice(r[9][0].indexOf(y),1),P&&k(L),P&&k(A),r[9][0].splice(r[9][0].indexOf(I),1),P&&k(C),P&&k(x),P&&k(q),P&&k(Y),P&&k(te),P&&k(le),P&&k(xe),_e&&_e.d(P),P&&k(Le),pe=!1,Re(Bt)}}}function Ir(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Rs(r,e,t){let n;se(r,ne,v=>t(15,n=v));let{routeInfo:i}=e,{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function p(){let v=n.features.find(y=>y.id==o);try{t(0,s=await i.nameForRoute(v))}catch(y){window.alert(`Couldn't auto-name route: ${y}`)}}const h=[[]];function c(){s=this.value,t(0,s)}function f(){a=this.__value,t(1,a)}function m(){a=this.__value,t(1,a)}function _(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function b(){l=this.value,t(2,l)}const d=()=>p();return r.$$set=v=>{"routeInfo"in v&&t(3,i=v.routeInfo),"id"in v&&t(4,o=v.id),"name"in v&&t(0,s=v.name),"intervention_type"in v&&t(1,a=v.intervention_type),"description"in v&&t(2,l=v.description),"length_meters"in v&&t(5,u=v.length_meters)},[s,a,l,i,o,u,p,c,f,h,m,_,g,b,d]}class Is extends V{constructor(e){super(),K(this,e,Rs,Os,Z,{routeInfo:3,id:4,name:0,intervention_type:1,description:2,length_meters:5})}}const As="Intervention",Cs=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],Ts={name:As,oneOf:Cs};function vi(r){return"members"in r}function yi(r){return"oneOf"in r}function wi(r){return typeof r=="string"}function ki(r){return typeof r=="object"&&"value"in r}function xs(r){return"type"in r&&r.type=="number"}function Si(r){return"type"in r&&r.type=="one-liner"}function Ei(r){return"type"in r&&r.type=="textbox"}function Mi(r){return"type"in r&&r.type=="checkbox"}function Ar(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Cr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Tr(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=z(t),T(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&De(n,t)},d(i){i&&k(e)}}}function Ps(r){let e,t,n;return{c(){e=E("input"),T(e,"type","checkbox")},m(i,o){w(i,e,o),e.checked=r[0],t||(n=U(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function Fs(r){let e,t,n;return{c(){e=E("textarea"),ae(e,"width","100%"),T(e,"rows","5"),T(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),Oe(e,r[0]),t||(n=U(e,"input",r[13]),t=!0)},p(i,o){o&1&&Oe(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function Ns(r){let e,t,n;return{c(){e=E("input"),T(e,"type","text"),ae(e,"width","100%")},m(i,o){w(i,e,o),Oe(e,r[0]),t||(n=U(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Oe(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function Bs(r){let e,t,n;return{c(){e=E("input"),T(e,"type","number")},m(i,o){w(i,e,o),Oe(e,r[0]),t||(n=U(e,"input",r[11]),t=!0)},p(i,o){o&1&&si(e.value)!==i[0]&&Oe(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function Ds(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=Pr(Ar(r,n,s));const o=s=>O(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=be()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Ar(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=Pr(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(de(),l=n.length;l<i.length;l+=1)o(l);me()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)O(i[a]);t=!1},d(s){Kt(i,s),s&&k(e)}}}function js(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=Fr(Cr(r,n,s));const o=s=>O(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=be()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Cr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=Fr(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(de(),l=n.length;l<i.length;l+=1)o(l);me()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)O(i[a]);t=!1},d(s){Kt(i,s),s&&k(e)}}}function Us(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,p,h,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&xr(r);return{c(){e=E("label"),t=E("input"),i=R(),s=z(o),a=E("br"),l=R(),f&&f.c(),u=be(),T(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(m,_){w(m,e,_),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),w(m,l,_),f&&f.m(m,_),w(m,u,_),p=!0,h||(c=[U(t,"change",r[9]),U(t,"change",r[4])],h=!0)},p(m,_){(!p||_&2&&n!==(n=m[15].name))&&(t.__value=n,t.value=t.__value),_&4&&(t.checked=t.__value===m[2]),(!p||_&2)&&o!==(o=m[15].name+"")&&De(s,o),m[2]==m[15].name&&typeof m[0]=="object"?f?(f.p(m,_),_&7&&$(f,1)):(f=xr(m),f.c(),$(f,1),f.m(u.parentNode,u)):f&&(de(),O(f,1,1,()=>{f=null}),me())},i(m){p||($(f),p=!0)},o(m){O(f),p=!1},d(m){m&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),m&&k(l),f&&f.d(m),m&&k(u),h=!1,Re(c)}}}function qs(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,p;function h(m,_){return m[15].description?Ys:Hs}let c=h(r),f=c(r);return{c(){e=E("label"),t=E("input"),i=R(),s=z(o),a=R(),f.c(),l=R(),T(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(m,_){w(m,e,_),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),f.m(e,null),S(e,l),u||(p=[U(t,"change",r[8]),U(t,"change",r[3])],u=!0)},p(m,_){_&2&&n!==(n=m[15].value)&&(t.__value=n,t.value=t.__value),_&4&&(t.checked=t.__value===m[2]),_&2&&o!==(o=m[15].value+"")&&De(s,o),c===(c=h(m))&&f?f.p(m,_):(f.d(1),f=c(m),f&&(f.c(),f.m(e,l)))},i:G,o:G,d(m){m&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Re(p)}}}function Gs(r){let e,t,n,i,o=r[15]+"",s,a,l,u,p,h;return{c(){e=E("label"),t=E("input"),i=R(),s=z(o),a=R(),l=E("br"),u=R(),T(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){w(c,e,f),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),S(e,l),S(e,u),p||(h=[U(t,"change",r[6]),U(t,"change",r[3])],p=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&o!==(o=c[15]+"")&&De(s,o)},i:G,o:G,d(c){c&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,Re(h)}}}function xr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Nt({props:l}),ue.push(()=>Ee(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),N(t.$$.fragment),i=R(),T(e,"class","svelte-1b72l00")},m(u,p){w(u,e,p),B(t,e,null),S(e,i),s=!0},p(u,p){r=u;const h={};p&2&&(h.spec=r[15]),!n&&p&3&&(n=!0,h.value=r[0][r[15].name],Me(()=>n=!1)),t.$set(h)},i(u){s||($(t.$$.fragment,u),_t(()=>{o||(o=Qt(e,tn,{duration:500},!0)),o.run(1)}),s=!0)},o(u){O(t.$$.fragment,u),o||(o=Qt(e,tn,{duration:500},!1)),o.run(0),s=!1},d(u){u&&k(e),D(t),u&&o&&o.end()}}}function Hs(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Ys(r){let e,t,n=r[15].description+"",i,o;return{c(){e=E("p"),t=z("("),i=z(n),o=z(")"),T(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,i),S(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&De(i,n)},d(s){s&&k(e)}}}function Pr(r){let e,t,n,i,o,s;const a=[Gs,qs,Us],l=[];function u(p,h){return h&2&&(e=null),h&2&&(t=null),e==null&&(e=!!wi(p[15])),e?0:(t==null&&(t=!!ki(p[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=be()},m(p,h){l[n].m(p,h),w(p,o,h),s=!0},p(p,h){let c=n;n=u(p,h),n===c?l[n].p(p,h):(de(),O(l[c],1,1,()=>{l[c]=null}),me(),i=l[n],i?i.p(p,h):(i=l[n]=a[n](p),i.c()),$(i,1),i.m(o.parentNode,o))},i(p){s||($(i),s=!0)},o(p){O(i),s=!1},d(p){l[n].d(p),p&&k(o)}}}function Fr(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function p(c){r[5](c,r[15])}let h={spec:r[15]};return r[0][r[15].name]!==void 0&&(h.value=r[0][r[15].name]),s=new Nt({props:h}),ue.push(()=>Ee(s,"value",p,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),i=z(n),o=R(),N(s.$$.fragment),l=R(),T(e,"class","svelte-1b72l00")},m(c,f){w(c,e,f),S(e,t),S(t,i),S(e,o),B(s,e,null),S(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&De(i,n);const m={};f&2&&(m.spec=r[15]),!a&&f&3&&(a=!0,m.value=r[0][r[15].name],Me(()=>a=!1)),s.$set(m)},i(c){u||($(s.$$.fragment,c),u=!0)},o(c){O(s.$$.fragment,c),u=!1},d(c){c&&k(e),D(s)}}}function Js(r){let e,t,n,i,o,s,a,l,u,p,h,c=r[1].description&&Tr(r);const f=[js,Ds,Bs,Ns,Fs,Ps],m=[];function _(g,b){return b&2&&(t=null),b&2&&(n=null),b&2&&(i=null),b&2&&(o=null),b&2&&(s=null),b&2&&(a=null),t==null&&(t=!!vi(g[1])),t?0:(n==null&&(n=!!yi(g[1])),n?1:(i==null&&(i=!!xs(g[1])),i?2:(o==null&&(o=!!Si(g[1])),o?3:(s==null&&(s=!!Ei(g[1])),s?4:(a==null&&(a=!!Mi(g[1])),a?5:-1)))))}return~(l=_(r,-1))&&(u=m[l]=f[l](r)),{c(){c&&c.c(),e=R(),u&&u.c(),p=be()},m(g,b){c&&c.m(g,b),w(g,e,b),~l&&m[l].m(g,b),w(g,p,b),h=!0},p(g,[b]){g[1].description?c?c.p(g,b):(c=Tr(g),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let d=l;l=_(g,b),l===d?~l&&m[l].p(g,b):(u&&(de(),O(m[d],1,1,()=>{m[d]=null}),me()),~l?(u=m[l],u?u.p(g,b):(u=m[l]=f[l](g),u.c()),$(u,1),u.m(p.parentNode,p)):u=null)},i(g){h||($(u),h=!0)},o(g){O(u),h=!1},d(g){c&&c.d(g),g&&k(e),~l&&m[l].d(g),g&&k(p)}}}function Xs(r,e,t){var d,v,y;let{spec:n}=e,{value:i}=e,o="";if(vi(n)){i||(i={});for(let M of n.members)Si(M)||Ei(M)?i[d=M.name]||(i[d]=""):Mi(M)?i[v=M.name]||(i[v]=!1):i[y=M.name]||(i[y]={})}else yi(n)&&(i||(i={}),wi(i)?o=i:ki(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,L){r.$$.not_equal(i[L.name],M)&&(i[L.name]=M,t(0,i))}function p(){o=this.__value,t(2,o)}function h(){o=this.__value,t(2,o)}function c(){o=this.__value,t(2,o)}function f(M,L){r.$$.not_equal(i[L.name],M)&&(i[L.name]=M,t(0,i))}function m(){i=si(this.value),t(0,i)}function _(){i=this.value,t(0,i)}function g(){i=this.value,t(0,i)}function b(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,p,l,h,c,f,m,_,g,b]}class Nt extends V{constructor(e){super(),K(this,e,Xs,Js,Z,{spec:1,value:0})}}function zs(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Nt({props:o}),ue.push(()=>Ee(e,"value",i,r[0].v2)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Ws(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=Ts;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Vs extends V{constructor(e){super(),K(this,e,Ws,zs,Z,{props:0})}}const Ks="Planning",Zs=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],Qs={name:Ks,members:Zs};function el(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Nt({props:o}),ue.push(()=>Ee(e,"value",i,r[0].planning)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function tl(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=Qs;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class nl extends V{constructor(e){super(),K(this,e,tl,el,Z,{props:0})}}const rl="CriticalIssue",il=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],ol={name:rl,members:il};function sl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Nt({props:o}),ue.push(()=>Ee(e,"value",i,r[0].criticals)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function ll(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=ol;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class al extends V{constructor(e){super(),K(this,e,ll,sl,Z,{props:0})}}function Nr(r){let e,t,n,i,o;const s=r[10].default,a=Ji(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),ae(e,"border","solid 1px black"),ae(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=U(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&Xi(a,s,l,l[9],n?Wi(s,l[9],u,null):zi(l[9]),null)},i(l){n||($(a,l),_t(()=>{t||(t=Qt(e,tn,{duration:100},!0)),t.run(1)}),n=!0)},o(l){O(a,l),t||(t=Qt(e,tn,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function ul(r){let e,t,n,i,o,s,a,l,u,p,h=r[4]&&Nr(r);return{c(){e=E("button"),t=ur("svg"),n=ur("path"),i=R(),o=z(r[1]),s=R(),h&&h.c(),a=be(),T(n,"d","M9 5l7 7-7 7"),T(t,"style","tran"),T(t,"width","20"),T(t,"height","20"),T(t,"fill","none"),T(t,"stroke-linecap","round"),T(t,"stroke-linejoin","round"),T(t,"stroke-width","2"),T(t,"viewBox","0 0 24 24"),T(t,"stroke","currentColor"),T(t,"class","svelte-t7fpgu"),T(e,"aria-expanded",r[4]),T(e,"class","svelte-t7fpgu"),fr(e,"underlined",r[3])},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,i),S(e,o),w(c,s,f),h&&h.m(c,f),w(c,a,f),l=!0,u||(p=[U(e,"click",r[5]),U(e,"mouseenter",r[11]),U(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&De(o,c[1]),(!l||f&16)&&T(e,"aria-expanded",c[4]),(!l||f&8)&&fr(e,"underlined",c[3]),c[4]?h?(h.p(c,f),f&16&&$(h,1)):(h=Nr(c),h.c(),$(h,1),h.m(a.parentNode,a)):h&&(de(),O(h,1,1,()=>{h=null}),me())},i(c){l||($(h),l=!0)},o(c){O(h),l=!1},d(c){c&&k(e),c&&k(s),h&&h.d(c),c&&k(a),u=!1,Re(p)}}}function fl(r,e,t){let n,i,o,s;se(r,He,d=>t(7,o=d)),se(r,Se,d=>t(8,s=d));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const h=()=>{Se.update(d=>d==u?null:u),s==u&&(nn.set(null),nn.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const m=()=>rn.set(u),_=()=>rn.set(null);function g(d){ue[d?"unshift":"push"](()=>{c=d,t(2,c)})}const b=()=>f();return r.$$set=d=>{"id"in d&&t(0,u=d.id),"label"in d&&t(1,p=d.label),"$$scope"in d&&t(9,l=d.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,p,c,i,n,h,f,o,s,l,a,m,_,g,b]}class cl extends V{constructor(e){super(),K(this,e,fl,ul,Z,{id:0,label:1})}}function Br(r,e,t){const n=r.slice();return n[14]=e[t],n[15]=e,n[16]=t,n}function pl(r){let e,t,n;function i(s){r[10](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new al({props:o}),ue.push(()=>Ee(e,"props",i,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function hl(r){let e,t,n;function i(s){r[9](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new nl({props:o}),ue.push(()=>Ee(e,"props",i,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function dl(r){let e,t,n;function i(s){r[8](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new Vs({props:o}),ue.push(()=>Ee(e,"props",i,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function ml(r){let e,t,n,i,o;function s(p){r[5](p,r[14])}function a(p){r[6](p,r[14])}function l(p){r[7](p,r[14])}let u={routeInfo:r[1],id:r[14].id,length_meters:r[14].properties.length_meters};return r[14].properties.name!==void 0&&(u.name=r[14].properties.name),r[14].properties.intervention_type!==void 0&&(u.intervention_type=r[14].properties.intervention_type),r[14].properties.description!==void 0&&(u.description=r[14].properties.description),e=new Is({props:u}),ue.push(()=>Ee(e,"name",s,r[14].properties.name)),ue.push(()=>Ee(e,"intervention_type",a,r[14].properties.intervention_type)),ue.push(()=>Ee(e,"description",l,r[14].properties.description)),{c(){N(e.$$.fragment)},m(p,h){B(e,p,h),o=!0},p(p,h){r=p;const c={};h&2&&(c.routeInfo=r[1]),h&4&&(c.id=r[14].id),h&4&&(c.length_meters=r[14].properties.length_meters),!t&&h&4&&(t=!0,c.name=r[14].properties.name,Me(()=>t=!1)),!n&&h&4&&(n=!0,c.intervention_type=r[14].properties.intervention_type,Me(()=>n=!1)),!i&&h&4&&(i=!0,c.description=r[14].properties.description,Me(()=>i=!1)),e.$set(c)},i(p){o||($(e.$$.fragment,p),o=!0)},o(p){O(e.$$.fragment,p),o=!1},d(p){D(e,p)}}}function _l(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,m,_;const g=[ml,dl,hl,pl],b=[];function d(y,M){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:y[0]=="criticals"?3:-1}~(e=d(r))&&(t=b[e]=g[e](r));function v(){return r[11](r[14])}return{c(){t&&t.c(),n=R(),i=E("br"),o=R(),s=E("br"),a=R(),l=E("div"),u=E("button"),u.textContent="Delete",p=R(),h=E("button"),h.textContent="Save",c=R(),T(u,"type","button"),T(h,"type","button"),ae(l,"display","flex"),ae(l,"justify-content","space-between")},m(y,M){~e&&b[e].m(y,M),w(y,n,M),w(y,i,M),w(y,o,M),w(y,s,M),w(y,a,M),w(y,l,M),S(l,u),S(l,p),S(l,h),w(y,c,M),f=!0,m||(_=[U(u,"click",v),U(h,"click",r[12])],m=!0)},p(y,M){r=y;let L=e;e=d(r),e===L?~e&&b[e].p(r,M):(t&&(de(),O(b[L],1,1,()=>{b[L]=null}),me()),~e?(t=b[e],t?t.p(r,M):(t=b[e]=g[e](r),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(y){f||($(t),f=!0)},o(y){O(t),f=!1},d(y){~e&&b[e].d(y),y&&k(n),y&&k(i),y&&k(o),y&&k(s),y&&k(a),y&&k(l),y&&k(c),m=!1,Re(_)}}}function Dr(r,e){let t,n,i;return n=new cl({props:{id:e[14].id,label:e[16]+1+") "+e[3](e[14]),$$slots:{default:[_l]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=be(),N(n.$$.fragment),this.first=t},m(o,s){w(o,t,s),B(n,o,s),i=!0},p(o,s){e=o;const a={};s&4&&(a.id=e[14].id),s&4&&(a.label=e[16]+1+") "+e[3](e[14])),s&131079&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){O(n.$$.fragment,o),i=!1},d(o){o&&k(t),D(n,o)}}}function gl(r){let e=[],t=new Map,n,i,o,s,a=r[2].features;const l=u=>u[14].id;for(let u=0;u<a.length;u+=1){let p=Br(r,a,u),h=l(p);t.set(h,e[u]=Dr(h,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=be()},m(u,p){for(let h=0;h<e.length;h+=1)e[h].m(u,p);w(u,n,p),i=!0,o||(s=U(window,"keydown",r[4]),o=!0)},p(u,[p]){p&15&&(a=u[2].features,de(),e=Vi(e,p,l,1,u,a,t,n.parentNode,Ki,Dr,n,Br),me())},i(u){if(!i){for(let p=0;p<a.length;p+=1)$(e[p]);i=!0}},o(u){for(let p=0;p<e.length;p+=1)O(e[p]);i=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&k(n),o=!1,s()}}}function bl(r,e,t){let n,i;se(r,Se,b=>t(13,n=b)),se(r,ne,b=>t(2,i=b));let{schema:o}=e,{routeInfo:s}=e;function a(b){var v,y,M,L,A;if(o=="planning")return((v=b.properties.planning)==null?void 0:v.name)||"Untitled polygon";if(o=="v2")return((M=(y=b.properties.v2)==null?void 0:y.Route)==null?void 0:M.name)||((A=(L=b.properties.v2)==null?void 0:L.Crossing)==null?void 0:A.name)||"Untitled intervention";if(b.properties.name)return b.properties.name;var d=b.properties.intervention_type;return d=="other"&&(b.geometry.type=="Point"?d="point":b.geometry.type=="LineString"?d="line":d="polygon"),`Untitled ${d}`}function l(b){if(b.key=="Delete"){const d=b.target.tagName;if(d=="INPUT"||d=="TEXTAREA")return;b.preventDefault();const v=n;v&&pr(v)}}function u(b,d){r.$$.not_equal(d.properties.name,b)&&(d.properties.name=b,ne.set(i))}function p(b,d){r.$$.not_equal(d.properties.intervention_type,b)&&(d.properties.intervention_type=b,ne.set(i))}function h(b,d){r.$$.not_equal(d.properties.description,b)&&(d.properties.description=b,ne.set(i))}function c(b,d){r.$$.not_equal(d.properties,b)&&(d.properties=b,ne.set(i))}function f(b,d){r.$$.not_equal(d.properties,b)&&(d.properties=b,ne.set(i))}function m(b,d){r.$$.not_equal(d.properties,b)&&(d.properties=b,ne.set(i))}const _=b=>pr(b.id),g=()=>Se.set(null);return r.$$set=b=>{"schema"in b&&t(0,o=b.schema),"routeInfo"in b&&t(1,s=b.routeInfo)},[o,s,i,a,l,u,p,h,c,f,m,_,g]}class vl extends V{constructor(e){super(),K(this,e,bl,gl,Z,{schema:0,routeInfo:1})}}function jr(r){let e,t;return e=new bi({props:{routeInfo:r[0],id:void 0}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeInfo=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function yl(r){let e,t,n,i,o,s,a,l,u,p,h,c=r[2]=="speed limits"&&jr(r);return{c(){e=E("label"),t=z(`Show layer:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",a=R(),c&&c.c(),l=be(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,n.disabled=s=r[1]!=null,r[2]===void 0&&_t(()=>r[3].call(n))},m(f,m){w(f,e,m),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[2]),w(f,a,m),c&&c.m(f,m),w(f,l,m),u=!0,p||(h=U(n,"change",r[3]),p=!0)},p(f,[m]){(!u||m&2&&s!==(s=f[1]!=null))&&(n.disabled=s),m&4&&Ke(n,f[2]),f[2]=="speed limits"?c?(c.p(f,m),m&4&&$(c,1)):(c=jr(f),c.c(),$(c,1),c.m(l.parentNode,l)):c&&(de(),O(c,1,1,()=>{c=null}),me())},i(f){u||($(c),u=!0)},o(f){O(c),u=!1},d(f){f&&k(e),f&&k(a),c&&c.d(f),f&&k(l),p=!1,h()}}}function wl(r,e,t){let n;se(r,Se,a=>t(1,n=a));let{routeInfo:i}=e,o="none";function s(){o=_n(this),t(2,o),t(1,n)}return r.$$set=a=>{"routeInfo"in a&&t(0,i=a.routeInfo)},r.$$.update=()=>{r.$$.dirty&2&&n&&t(2,o="none")},[i,n,o,s]}class kl extends V{constructor(e){super(),K(this,e,wl,yl,Z,{routeInfo:0})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ne(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function qn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Je(r,e,t){t===void 0&&(t={});var n=Ve(r),i=Ve(e),o=Ce(i[1]-n[1]),s=Ce(i[0]-n[0]),a=Ce(n[1]),l=Ce(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return Zi(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Jt(r,e){return e===void 0&&(e={}),Qi(r,function(t,n){var i=n.geometry.coordinates;return t+Je(i[0],i[1],e)},0)}function Sl(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,m,_,g,b=r[0].features.length+"",d,v,y,M,L,A,I,F,C;return u=new po({props:{label:"Load from GeoJSON",uniqueId:"load_geojson",loadFile:r[3]}}),{c(){e=E("div"),t=E("label"),n=z(`Scheme name:
    `),i=E("input"),o=R(),s=E("br"),a=R(),l=E("div"),N(u.$$.fragment),p=R(),h=E("button"),h.textContent="Export to GeoJSON",c=R(),f=E("br"),m=R(),_=E("div"),g=E("span"),d=z(b),v=z(" objects"),y=R(),M=E("button"),L=z("Clear all"),T(i,"type","text"),T(h,"type","button"),ae(h,"float","right"),T(M,"type","button"),T(M,"class","align-right"),M.disabled=A=r[0].features.length==0},m(x,q){w(x,e,q),S(e,t),S(t,n),S(t,i),Oe(i,r[0].scheme_name),w(x,o,q),w(x,s,q),w(x,a,q),w(x,l,q),B(u,l,null),S(l,p),S(l,h),w(x,c,q),w(x,f,q),w(x,m,q),w(x,_,q),S(_,g),S(g,d),S(g,v),S(_,y),S(_,M),S(M,L),I=!0,F||(C=[U(i,"input",r[8]),U(h,"click",r[2]),U(M,"click",r[1])],F=!0)},p(x,[q]){q&1&&i.value!==x[0].scheme_name&&Oe(i,x[0].scheme_name),(!I||q&1)&&b!==(b=x[0].features.length+"")&&De(d,b),(!I||q&1&&A!==(A=x[0].features.length==0))&&(M.disabled=A)},i(x){I||($(u.$$.fragment,x),I=!0)},o(x){O(u.$$.fragment,x),I=!1},d(x){x&&k(e),x&&k(o),x&&k(s),x&&k(a),x&&k(l),D(u),x&&k(c),x&&k(f),x&&k(m),x&&k(_),F=!1,Re(C)}}}function El(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Ml(r,e,t){let n;se(r,ne,m=>t(0,n=m));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=!1;mn(async()=>{let _=new URLSearchParams(window.location.search).get("geojsonUrl"),g=window.localStorage.getItem(s);if(_){console.log(`Loading GeoJSON from ${_}`);try{let d=await(await fetch(_)).text();ne.set(c(JSON.parse(d)))}catch(b){console.log(`Failed to load from URL: ${b}`)}}else if(g)try{ne.set(c(JSON.parse(g)))}catch(b){console.log(`Failed to load from local storage: ${b}`)}t(7,a=!0)});function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(ne.update(m=>(delete m.scheme_name,m.features=[],m)),Se.set(null),He.set(null),rn.set(null),nn.set(null))}function u(){const m=JSON.parse(JSON.stringify(n));for(let _ of m.features)delete _.properties.hide_while_editing;return m}function p(){let m=u();var _=s;m.authority=i,m.origin="atip-v1",m.scheme_name&&(_+="_"+m.scheme_name),_+=".txt",El(_,JSON.stringify(m,null,"  "))}function h(m){const _=new FileReader;_.onload=b=>{try{ne.set(c(JSON.parse(b.target.result)))}catch(d){window.alert(`Couldn't load scheme from a file: ${d}`)}};let g=m.target.files;_.readAsText(g[0])}function c(m){let _=1;for(let g of m.features)g.properties||(g.properties={name:"",description:"",intervention_type:"other"}),g.geometry.type=="LineString"&&!g.properties.length_meters&&(g.properties.length_meters=Jt(g,{units:"kilometers"})*1e3),g.id=_++;return m}function f(){n.scheme_name=this.value,ne.set(n)}return r.$$set=m=>{"authorityName"in m&&t(4,i=m.authorityName),"schema"in m&&t(5,o=m.schema)},r.$$.update=()=>{r.$$.dirty&193&&a&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,p,h,i,o,s,a,f]}class $l extends V{constructor(e){super(),K(this,e,Ml,Sl,Z,{authorityName:4,schema:5})}}const Ll="/atip/scheme_overview/assets/zoom_out_map-b2e1091a.svg";function Ol(r){let e,t,n,i,o;return{c(){e=E("button"),t=E("img"),Zt(t.src,n=Ll)||T(t,"src",n),T(t,"alt","Zoom to show entire boundary"),T(e,"type","button"),T(e,"title","Zoom to show entire boundary"),T(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),i||(o=U(e,"click",r[0]),i=!0)},p:G,i:G,o:G,d(s){s&&k(e),i=!1,o()}}}function Rl(r,e,t){let n;se(r,je,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(Wn(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class Il extends V{constructor(e){super(),K(this,e,Rl,Ol,Z,{boundaryGeojson:1})}}function Al(r){let e,t,n,i,o,s,a;return{c(){e=E("div"),t=z(`Basemap:
  `),n=E("select"),i=E("option"),i.textContent="Streets",o=E("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&_t(()=>r[2].call(n)),T(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[0]),s||(a=[U(n,"change",r[2]),U(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&Ke(n,l[0])},i:G,o:G,d(l){l&&k(e),s=!1,Re(a)}}}function Cl(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=_n(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Tl extends V{constructor(e){super(),K(this,e,Cl,Al,Z,{style:0})}}function xl(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,m,_;return{c(){e=E("li"),t=E("span"),n=z("Areas"),i=R(),o=E("li"),s=E("span"),a=z("Routes"),l=R(),u=E("li"),p=E("span"),h=z("Crossings"),c=R(),f=E("li"),m=E("span"),_=z("Other"),T(t,"class","svelte-l42ea0"),ae(t,"background",he.area),T(s,"class","svelte-l42ea0"),ae(s,"background",he.route),T(p,"class","svelte-l42ea0"),ae(p,"background",he.crossing),T(m,"class","svelte-l42ea0"),ae(m,"background",he.other)},m(g,b){w(g,e,b),S(e,t),S(e,n),w(g,i,b),w(g,o,b),S(o,s),S(o,a),w(g,l,b),w(g,u,b),S(u,p),S(u,h),w(g,c,b),w(g,f,b),S(f,m),S(f,_)},p:G,d(g){g&&k(e),g&&k(i),g&&k(o),g&&k(l),g&&k(u),g&&k(c),g&&k(f)}}}function Pl(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,m,_;return{c(){e=E("li"),t=E("span"),n=z("Preapp"),i=R(),o=E("li"),s=E("span"),a=z("Outline"),l=R(),u=E("li"),p=E("span"),h=z("Reserved matters"),c=R(),f=E("li"),m=E("span"),_=z("Local plan"),T(t,"class","svelte-l42ea0"),ae(t,"background",he.preapp),T(s,"class","svelte-l42ea0"),ae(s,"background",he.outline),T(p,"class","svelte-l42ea0"),ae(p,"background",he["reserved matters"]),T(m,"class","svelte-l42ea0"),ae(m,"background",he["local plan"])},m(g,b){w(g,e,b),S(e,t),S(e,n),w(g,i,b),w(g,o,b),S(o,s),S(o,a),w(g,l,b),w(g,u,b),S(u,p),S(u,h),w(g,c,b),w(g,f,b),S(f,m),S(f,_)},p:G,d(g){g&&k(e),g&&k(i),g&&k(o),g&&k(l),g&&k(u),g&&k(c),g&&k(f)}}}function Fl(r){let e;function t(o,s){return o[0]=="planning"?Pl:xl}let n=t(r),i=n(r);return{c(){e=E("ul"),i.c()},m(o,s){w(o,e,s),i.m(e,null)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&k(e),i.d()}}}function Nl(r){let e,t,n;return t=new yn({props:{label:"Objects",open:!0,$$slots:{default:[Fl]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),T(e,"class","svelte-l42ea0")},m(i,o){w(i,e,o),B(t,e,null),n=!0},p(i,[o]){const s={};o&3&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){O(t.$$.fragment,i),n=!1},d(i){i&&k(e),D(t)}}}function Bl(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class Dl extends V{constructor(e){super(),K(this,e,Bl,Nl,Z,{schema:0})}}let ot="interventions";function jl(r,e,t){let n,i;se(r,je,p=>t(1,n=p)),se(r,ne,p=>t(2,i=p));let{schema:o}=e;Qe(n,ot,i);const s=["match",["get","intervention_type"],"area",he.area,"route",he.route,"crossing",he.crossing,"other",he.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",he.preapp,"outline",he.outline,"reserved matters",he["reserved matters"],"local plan",he["local plan"],"white"],l=["!=","hide_while_editing",!0];return we(n,{id:"interventions-points",source:ot,filter:["all",gn,l,["!=","endpoint",!0]],...gt(s,wn)}),we(n,{id:"interventions-lines",source:ot,filter:["all",bn,l],...ht(s,Ct)}),we(n,{id:"interventions-lines-endpoints",source:ot,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Ct,"circle-opacity":0,"circle-stroke-color":he.lineEndpointColor,"circle-stroke-width":2}}),we(n,{id:"interventions-polygons",source:ot,filter:["all",vn,l],...dn(o=="planning"?a:s,.5)}),r.$$set=p=>{"schema"in p&&t(0,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(i)),h=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])h.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(h),n.getSource(ot).setData(p)}},[o,n,i]}class Ul extends V{constructor(e){super(),K(this,e,jl,null,Z,{schema:0})}}let st="hover";function ql(r,e,t){let n,i,o,s,a;return se(r,je,l=>t(0,n=l)),se(r,ne,l=>t(1,i=l)),se(r,rn,l=>t(2,o=l)),se(r,He,l=>t(3,s=l)),se(r,Se,l=>t(4,a=l)),Qe(n,st,Be()),we(n,{id:"hover-polygons",source:st,filter:vn,...ht(he.hovering,.5*Ct,1)}),we(n,{id:"hover-lines",source:st,filter:bn,...ht(he.hovering,1.5*Ct,1)}),we(n,{id:"hover-points",source:st,filter:gn,...gt(he.hovering,1.5*wn,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(st).setData(i.features.find(u=>u.id==l)):n.getSource(st).setData(Be())}},[n,i,o,s,a]}class Gl extends V{constructor(e){super(),K(this,e,ql,null,Z,{})}}class er{constructor(e,t){oe(this,"owner");oe(this,"map");oe(this,"mapHandlers",{});oe(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Ut="edit-point-mode";class Hl{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"cursor");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new er(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Qe(e,Ut,Be()),we(e,{id:"edit-point-mode",source:Ut,...gt(he.hovering,wn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=Yl(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Ut),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Be();this.cursor&&e.features.push(this.cursor),this.map.getSource(Ut).setData(e)}}function Yl(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function $i(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Jl(r,e);var n=Ve(r),i=Ve(e),o=Ce(n[0]),s=Ce(i[0]),a=Ce(n[1]),l=Ce(i[1]),u=Math.sin(s-o)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return Cn(Math.atan2(u,p))}function Jl(r,e){var t=$i(e,r);return t=(t+180)%360,t}function Ur(r,e,t,n){n===void 0&&(n={});var i=Ve(r),o=Ce(i[0]),s=Ce(i[1]),a=Ce(t),l=eo(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),h=Cn(p),c=Cn(u);return pt([h,c],n.properties)}function Gn(r){if(!r)throw new Error("geojson is required");var e=[];return Vn(r,function(t){Xl(t,e)}),We(e)}function Xl(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ne(n);break;case"LineString":t=[Ne(n)]}t.forEach(function(i){var o=zl(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function zl(r,e){var t=[];return r.reduce(function(n,i){var o=dt([n,i],e);return o.bbox=Wl(n,i),t.push(o),i}),t}function Wl(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var mt={},Vl={get exports(){return mt},set exports(r){mt=r}},Hn={},Kl={get exports(){return Hn},set exports(r){Hn=r}};(function(r,e){(function(t,n){r.exports=n()})(to,function(){function t(d,v,y,M,L){(function A(I,F,C,x,q){for(;x>C;){if(x-C>600){var Y=x-C+1,te=F-C+1,le=Math.log(Y),ke=.5*Math.exp(2*le/3),Ae=.5*Math.sqrt(le*ke*(Y-ke)/Y)*(te-Y/2<0?-1:1),ie=Math.max(C,Math.floor(F-te*ke/Y+Ae)),re=Math.min(x,Math.floor(F+(Y-te)*ke/Y+Ae));A(I,F,ie,re,q)}var xe=I[F],Le=C,W=x;for(n(I,C,F),q(I[x],xe)>0&&n(I,C,x);Le<W;){for(n(I,Le,W),Le++,W--;q(I[Le],xe)<0;)Le++;for(;q(I[W],xe)>0;)W--}q(I[C],xe)===0?n(I,C,W):n(I,++W,x),W<=F&&(C=W+1),F<=W&&(x=W-1)}})(d,v,y||0,M||d.length-1,L||i)}function n(d,v,y){var M=d[v];d[v]=d[y],d[y]=M}function i(d,v){return d<v?-1:d>v?1:0}var o=function(d){d===void 0&&(d=9),this._maxEntries=Math.max(4,d),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(d,v,y){if(!y)return v.indexOf(d);for(var M=0;M<v.length;M++)if(y(d,v[M]))return M;return-1}function a(d,v){l(d,0,d.children.length,v,d)}function l(d,v,y,M,L){L||(L=g(null)),L.minX=1/0,L.minY=1/0,L.maxX=-1/0,L.maxY=-1/0;for(var A=v;A<y;A++){var I=d.children[A];u(L,d.leaf?M(I):I)}return L}function u(d,v){return d.minX=Math.min(d.minX,v.minX),d.minY=Math.min(d.minY,v.minY),d.maxX=Math.max(d.maxX,v.maxX),d.maxY=Math.max(d.maxY,v.maxY),d}function p(d,v){return d.minX-v.minX}function h(d,v){return d.minY-v.minY}function c(d){return(d.maxX-d.minX)*(d.maxY-d.minY)}function f(d){return d.maxX-d.minX+(d.maxY-d.minY)}function m(d,v){return d.minX<=v.minX&&d.minY<=v.minY&&v.maxX<=d.maxX&&v.maxY<=d.maxY}function _(d,v){return v.minX<=d.maxX&&v.minY<=d.maxY&&v.maxX>=d.minX&&v.maxY>=d.minY}function g(d){return{children:d,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function b(d,v,y,M,L){for(var A=[v,y];A.length;)if(!((y=A.pop())-(v=A.pop())<=M)){var I=v+Math.ceil((y-v)/M/2)*M;t(d,I,v,y,L),A.push(v,I,I,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(d){var v=this.data,y=[];if(!_(d,v))return y;for(var M=this.toBBox,L=[];v;){for(var A=0;A<v.children.length;A++){var I=v.children[A],F=v.leaf?M(I):I;_(d,F)&&(v.leaf?y.push(I):m(d,F)?this._all(I,y):L.push(I))}v=L.pop()}return y},o.prototype.collides=function(d){var v=this.data;if(!_(d,v))return!1;for(var y=[];v;){for(var M=0;M<v.children.length;M++){var L=v.children[M],A=v.leaf?this.toBBox(L):L;if(_(d,A)){if(v.leaf||m(d,A))return!0;y.push(L)}}v=y.pop()}return!1},o.prototype.load=function(d){if(!d||!d.length)return this;if(d.length<this._minEntries){for(var v=0;v<d.length;v++)this.insert(d[v]);return this}var y=this._build(d.slice(),0,d.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(d){return d&&this._insert(d,this.data.height-1),this},o.prototype.clear=function(){return this.data=g([]),this},o.prototype.remove=function(d,v){if(!d)return this;for(var y,M,L,A=this.data,I=this.toBBox(d),F=[],C=[];A||F.length;){if(A||(A=F.pop(),M=F[F.length-1],y=C.pop(),L=!0),A.leaf){var x=s(d,A.children,v);if(x!==-1)return A.children.splice(x,1),F.push(A),this._condense(F),this}L||A.leaf||!m(A,I)?M?(y++,A=M.children[y],L=!1):A=null:(F.push(A),C.push(y),y=0,M=A,A=A.children[0])}return this},o.prototype.toBBox=function(d){return d},o.prototype.compareMinX=function(d,v){return d.minX-v.minX},o.prototype.compareMinY=function(d,v){return d.minY-v.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(d){return this.data=d,this},o.prototype._all=function(d,v){for(var y=[];d;)d.leaf?v.push.apply(v,d.children):y.push.apply(y,d.children),d=y.pop();return v},o.prototype._build=function(d,v,y,M){var L,A=y-v+1,I=this._maxEntries;if(A<=I)return a(L=g(d.slice(v,y+1)),this.toBBox),L;M||(M=Math.ceil(Math.log(A)/Math.log(I)),I=Math.ceil(A/Math.pow(I,M-1))),(L=g([])).leaf=!1,L.height=M;var F=Math.ceil(A/I),C=F*Math.ceil(Math.sqrt(I));b(d,v,y,C,this.compareMinX);for(var x=v;x<=y;x+=C){var q=Math.min(x+C-1,y);b(d,x,q,F,this.compareMinY);for(var Y=x;Y<=q;Y+=F){var te=Math.min(Y+F-1,q);L.children.push(this._build(d,Y,te,M-1))}}return a(L,this.toBBox),L},o.prototype._chooseSubtree=function(d,v,y,M){for(;M.push(v),!v.leaf&&M.length-1!==y;){for(var L=1/0,A=1/0,I=void 0,F=0;F<v.children.length;F++){var C=v.children[F],x=c(C),q=(Y=d,te=C,(Math.max(te.maxX,Y.maxX)-Math.min(te.minX,Y.minX))*(Math.max(te.maxY,Y.maxY)-Math.min(te.minY,Y.minY))-x);q<A?(A=q,L=x<L?x:L,I=C):q===A&&x<L&&(L=x,I=C)}v=I||v.children[0]}var Y,te;return v},o.prototype._insert=function(d,v,y){var M=y?d:this.toBBox(d),L=[],A=this._chooseSubtree(M,this.data,v,L);for(A.children.push(d),u(A,M);v>=0&&L[v].children.length>this._maxEntries;)this._split(L,v),v--;this._adjustParentBBoxes(M,L,v)},o.prototype._split=function(d,v){var y=d[v],M=y.children.length,L=this._minEntries;this._chooseSplitAxis(y,L,M);var A=this._chooseSplitIndex(y,L,M),I=g(y.children.splice(A,y.children.length-A));I.height=y.height,I.leaf=y.leaf,a(y,this.toBBox),a(I,this.toBBox),v?d[v-1].children.push(I):this._splitRoot(y,I)},o.prototype._splitRoot=function(d,v){this.data=g([d,v]),this.data.height=d.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(d,v,y){for(var M,L,A,I,F,C,x,q=1/0,Y=1/0,te=v;te<=y-v;te++){var le=l(d,0,te,this.toBBox),ke=l(d,te,y,this.toBBox),Ae=(L=le,A=ke,I=void 0,F=void 0,C=void 0,x=void 0,I=Math.max(L.minX,A.minX),F=Math.max(L.minY,A.minY),C=Math.min(L.maxX,A.maxX),x=Math.min(L.maxY,A.maxY),Math.max(0,C-I)*Math.max(0,x-F)),ie=c(le)+c(ke);Ae<q?(q=Ae,M=te,Y=ie<Y?ie:Y):Ae===q&&ie<Y&&(Y=ie,M=te)}return M||y-v},o.prototype._chooseSplitAxis=function(d,v,y){var M=d.leaf?this.compareMinX:p,L=d.leaf?this.compareMinY:h;this._allDistMargin(d,v,y,M)<this._allDistMargin(d,v,y,L)&&d.children.sort(M)},o.prototype._allDistMargin=function(d,v,y,M){d.children.sort(M);for(var L=this.toBBox,A=l(d,0,v,L),I=l(d,y-v,y,L),F=f(A)+f(I),C=v;C<y-v;C++){var x=d.children[C];u(A,d.leaf?L(x):x),F+=f(A)}for(var q=y-v-1;q>=v;q--){var Y=d.children[q];u(I,d.leaf?L(Y):Y),F+=f(I)}return F},o.prototype._adjustParentBBoxes=function(d,v,y){for(var M=y;M>=0;M--)u(v[M],d)},o.prototype._condense=function(d){for(var v=d.length-1,y=void 0;v>=0;v--)d[v].children.length===0?v>0?(y=d[v-1].children).splice(y.indexOf(d[v]),1):this.clear():a(d[v],this.toBBox)},o})})(Kl);const Zl=Kn(no),Ql=Kn(ro),ea=Kn(io);var Pe=Hn,Li=Zl,Oi=Ql,lt=ea.default,ta=Oi.featureEach;Oi.coordEach;Li.polygon;var qr=Li.featureCollection;function Ri(r){var e=new Pe(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:lt(t),Pe.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:lt(i),n.push(i)}):ta(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:lt(i),n.push(i)}),Pe.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:lt(t),Pe.prototype.remove.call(this,t,n)},e.clear=function(){return Pe.prototype.clear.call(this)},e.search=function(t){var n=Pe.prototype.search.call(this,this.toBBox(t));return qr(n)},e.collides=function(t){return Pe.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Pe.prototype.all.call(this);return qr(t)},e.toJSON=function(){return Pe.prototype.toJSON.call(this)},e.fromJSON=function(t){return Pe.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=lt(t);else if(t.type==="FeatureCollection")n=lt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Vl.exports=Ri;mt.default=Ri;function Ii(r,e){var t={},n=[];if(r.type==="LineString"&&(r=cr(r)),e.type==="LineString"&&(e=cr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Gr(r,e);return i&&n.push(i),We(n)}var o=mt();return o.load(Gn(e)),en(Gn(r),function(s){en(o.search(s),function(a){var l=Gr(s,a);if(l){var u=Ne(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function Gr(r,e){var t=Ne(r),n=Ne(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],h=n[1][1],c=(h-u)*(s-i)-(p-l)*(a-o),f=(p-l)*(o-u)-(h-u)*(i-l),m=(s-i)*(o-u)-(a-o)*(i-l);if(c===0)return f===0&&m===0,null;var _=f/c,g=m/c;if(_>=0&&_<=1&&g>=0&&g<=1){var b=i+_*(s-i),d=o+_*(a-o);return pt([b,d])}return null}function xt(r,e,t){t===void 0&&(t={});var n=pt([1/0,1/0],{dist:1/0}),i=0;return Vn(r,function(o){for(var s=Ne(o),a=0;a<s.length-1;a++){var l=pt(s[a]);l.properties.dist=Je(e,l,t);var u=pt(s[a+1]);u.properties.dist=Je(e,u,t);var p=Je(l,u,t),h=Math.max(l.properties.dist,u.properties.dist),c=$i(l,u),f=Ur(e,h,c+90,t),m=Ur(e,h,c-90,t),_=Ii(dt([f.geometry.coordinates,m.geometry.coordinates]),dt([l.geometry.coordinates,u.geometry.coordinates])),g=null;_.features.length>0&&(g=_.features[0],g.properties.dist=Je(e,g,t),g.properties.location=i+Je(l,g,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+p),g&&g.properties.dist<n.properties.dist&&(n=g,n.properties.index=a),i+=p}}),n}const at="edit-polygon-mode";class na{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"points");oe(this,"cursor");oe(this,"hover");oe(this,"dragFrom");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new er(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Qe(e,at,Be()),we(e,{id:"edit-polygon-fill",source:at,filter:vn,...dn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),we(e,{id:"edit-polygon-lines",source:at,filter:bn,...ht("black",8,.5)}),we(e,{id:"edit-polygon-vertices",source:at,filter:gn,...gt(he.hovering,wn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Yr(this.points).forEach((n,i)=>{t.push([i+1,xt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(at),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Be();this.points.forEach((n,i)=>{let o=Hr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Yr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(at).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Hr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Hr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Yr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let X;const Ge=new Array(32).fill(void 0);Ge.push(void 0,null,!0,!1);function J(r){return Ge[r]}let Rt=Ge.length;function ra(r){r<36||(Ge[r]=Rt,Rt=r)}function Yn(r){const e=J(r);return ra(r),e}const Ai=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Ai.decode();let Xt=new Uint8Array;function It(){return Xt.byteLength===0&&(Xt=new Uint8Array(X.memory.buffer)),Xt}function ft(r,e){return Ai.decode(It().subarray(r,r+e))}function ve(r){Rt===Ge.length&&Ge.push(Ge.length+1);const e=Rt;return Rt=Ge[e],Ge[e]=r,e}function On(r){return r==null}let zt=new Float64Array;function ia(){return zt.byteLength===0&&(zt=new Float64Array(X.memory.buffer)),zt}let Wt=new Int32Array;function ye(){return Wt.byteLength===0&&(Wt=new Int32Array(X.memory.buffer)),Wt}let ze=0;const Vt=new TextEncoder("utf-8"),oa=typeof Vt.encodeInto=="function"?function(r,e){return Vt.encodeInto(r,e)}:function(r,e){const t=Vt.encode(r);return e.set(t),{read:r.length,written:t.length}};function qt(r,e,t){if(t===void 0){const a=Vt.encode(r),l=e(a.length);return It().subarray(l,l+a.length).set(a),ze=a.length,l}let n=r.length,i=e(n);const o=It();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=It().subarray(i+s,i+n),l=oa(r,a);s+=l.written}return ze=s,i}function Jn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Jn(r[0]));for(let s=1;s<i;s++)o+=", "+Jn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function sa(r,e){const t=e(r.length*1);return It().set(r,t/1),ze=r.length,t}function Rn(r,e){try{return r.apply(this,e)}catch(t){X.__wbindgen_exn_store(ve(t))}}class fn{static __wrap(e){const t=Object.create(fn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();X.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=X.__wbindgen_add_to_stack_pointer(-16),s=sa(e,X.__wbindgen_malloc),a=ze;X.jsroutesnapper_new(o,s,a);var t=ye()[o/4+0],n=ye()[o/4+1],i=ye()[o/4+2];if(i)throw Yn(n);return fn.__wrap(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){X.jsroutesnapper_setConfig(this.ptr,ve(e))}toFinalFeature(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];let i;return e!==0&&(i=ft(e,t).slice(),X.__wbindgen_free(e,t*1)),i}finally{X.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_renderGeojson(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];return ft(e,t)}finally{X.__wbindgen_add_to_stack_pointer(16),X.__wbindgen_free(e,t)}}setSnapMode(e){X.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return X.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){X.jsroutesnapper_onClick(this.ptr)}onDragStart(){return X.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return X.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){X.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_editExisting(i,this.ptr,ve(e));var t=ye()[i/4+0],n=ye()[i/4+1];if(n)throw Yn(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}}async function la(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function aa(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Yn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ft(e,t));return ve(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=ft(e,t);return ve(n)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;ia()[e/8+1]=On(i)?0:i,ye()[e/4+0]=!On(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=On(i)?0:qt(i,X.__wbindgen_malloc,X.__wbindgen_realloc),s=ze;ye()[e/4+1]=s,ye()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(J(t)),i=qt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=ze;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return ve(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=J(e)[J(t)];return ve(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(J(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(J(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(J(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(J(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(J(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=J(e)[t>>>0];return ve(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=J(e).next;return ve(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Rn(function(e){const t=J(e).next();return ve(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return J(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=J(e).value;return ve(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ve(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Rn(function(e,t){const n=Reflect.get(J(e),J(t));return ve(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Rn(function(e,t){const n=J(e).call(J(t));return ve(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=J(e).buffer;return ve(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(J(e));return ve(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ve(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=qt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=ze;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(ft(e,t))}finally{X.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=Jn(J(t)),i=qt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=ze;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ft(e,t))},r.wbg.__wbindgen_memory=function(){const e=X.memory;return ve(e)},r}function ua(r,e){return X=r.exports,Ci.__wbindgen_wasm_module=e,zt=new Float64Array,Wt=new Int32Array,Xt=new Uint8Array,X}async function Ci(r){typeof r>"u"&&(r="/atip/scheme_overview/assets/route_snapper_bg.wasm");const e=aa();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await la(await r,e);return ua(t,n)}const yt="route-snapper",Jr=10,fa=30;class ca{constructor(e,t){oe(this,"map");oe(this,"inner");oe(this,"active");oe(this,"eventListenersSuccessRoute");oe(this,"eventListenersSuccessArea");oe(this,"eventListenersFailure");oe(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new fn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Qe(e,yt,Be()),we(e,{id:"route-points",source:yt,filter:gn,...gt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Jr/2,Jr])}),we(e,{id:"route-lines",source:yt,filter:bn,...ht("black",2.5)}),we(e,{id:"route-polygons",source:yt,filter:vn,...dn("black",.5)}),this.events=new er(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-fa,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(yt).setData(JSON.parse(this.inner.renderGeojson()))}}function pa(r){let e,t,n,i,o,s,a,l;return{c(){e=E("button"),t=E("img"),i=R(),o=z(r[2]),Zt(t.src,n=r[3])||T(t,"src",n),T(t,"alt",r[2]),T(t,"class","svelte-1vvpkg9"),T(e,"type","button"),e.disabled=s=r[0]==r[1],T(e,"class","svelte-1vvpkg9")},m(u,p){w(u,e,p),S(e,t),S(e,i),S(e,o),a||(l=U(e,"click",r[5]),a=!0)},p(u,[p]){p&8&&!Zt(t.src,n=u[3])&&T(t,"src",n),p&4&&T(t,"alt",u[2]),p&4&&De(o,u[2]),p&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:G,o:G,d(u){u&&k(e),a=!1,l()}}}function ha(r,e,t){let{mode:n}=e,{thisMode:i}=e,{label:o}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(i);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,i=u.thisMode),"label"in u&&t(2,o=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,i,o,s,a,l]}class nt extends V{constructor(e){super(),K(this,e,ha,pa,Z,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function Xr(r){let e;function t(o,s){return o[1]?ma:da}let n=t(r),i=n(r);return{c(){i.c(),e=be()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&k(e)}}}function da(r){let e;return{c(){e=E("p"),e.textContent="Click an object to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function ma(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another object"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function _a(r){let e,t=r[0]==ct&&Xr(r);return{c(){t&&t.c(),e=be()},m(n,i){t&&t.m(n,i),w(n,e,i)},p(n,[i]){n[0]==ct?t?t.p(n,i):(t=Xr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&k(e)}}}const ct="edit-attribute";function Ti(){}function ga(r,e,t){let n,i,o,s;se(r,je,f=>t(5,n=f)),se(r,ne,f=>t(6,i=f)),se(r,nn,f=>t(7,o=f)),se(r,Se,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){Se.set(null)}n.on("mousemove",p),n.on("mouseout",h),n.on("click",c),Pt(()=>{n.off("mousemove",p),n.off("mouseout",h),n.off("click",c)});function p(f){var m;if(a==ct){let _=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});He.set(((m=_[0])==null?void 0:m.id)||null)}}function h(){a==ct&&He.set(null)}function c(f){if(a==ct){let m=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0?Se.set(m[0].id):Se.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let m=i.features.find(_=>_.id==f);m.geometry.type=="Point"?n.flyTo({center:m.geometry.coordinates,duration:500}):n.fitBounds(Wn(m),{padding:200,duration:500}),l(ct)}}},[a,s,l,Ti,u,n,i,o]}class ba extends V{constructor(e){super(),K(this,e,ga,_a,Z,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Ti}get stop(){return this.$$.ctx[4]}}function va(r){let e,t;return{c:G,m(n,i){e||(t=U(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function ya(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class kn extends V{constructor(e){super(),K(this,e,ya,va,Z,{tool:1})}}function wa(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function ka(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Sa(r){let e,t,n,i,o,s,a,l,u,p;function h(m,_){return m[1]?ka:wa}let c=h(r),f=c(r);return a=new kn({props:{tool:r[0]}}),{c(){e=E("ul"),f.c(),t=R(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=R(),o=E("button"),o.textContent="Cancel",s=R(),N(a.$$.fragment),T(o,"type","button")},m(m,_){w(m,e,_),f.m(e,null),S(e,t),S(e,n),w(m,i,_),w(m,o,_),w(m,s,_),B(a,m,_),l=!0,u||(p=U(o,"click",r[2]),u=!0)},p(m,[_]){c!==(c=h(m))&&(f.d(1),f=c(m),f&&(f.c(),f.m(e,t)));const g={};_&1&&(g.tool=m[0]),a.$set(g)},i(m){l||($(a.$$.fragment,m),l=!0)},o(m){O(a.$$.fragment,m),l=!1},d(m){m&&k(e),f.d(),m&&k(i),m&&k(o),m&&k(s),D(a,m),u=!1,p()}}}function Ea(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class xi extends V{constructor(e){super(),K(this,e,Ea,Sa,Z,{pointTool:0,editingExisting:1})}}function Ma(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function $a(r){let e,t,n,i,o,s,a,l,u,p,h;return e=new yn({props:{label:"Help",$$slots:{default:[Ma]},$$scope:{ctx:r}}}),l=new kn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=R(),n=E("div"),i=E("button"),i.textContent="Finish",o=R(),s=E("button"),s.textContent="Cancel",a=R(),N(l.$$.fragment),T(i,"type","button"),T(s,"type","button"),ae(n,"display","flex"),ae(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,i),S(n,o),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(h=[U(i,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const m={};f&8&&(m.$$scope={dirty:f,ctx:c}),e.$set(m);const _={};f&1&&(_.tool=c[0]),l.$set(_)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){O(e.$$.fragment,c),O(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Re(h)}}}function La(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Pi extends V{constructor(e){super(),K(this,e,La,$a,Z,{polygonTool:0})}}function Oa(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Ra(r){let e,t,n,i,o,s,a,l,u,p,h;return e=new yn({props:{label:"Help",$$slots:{default:[Oa]},$$scope:{ctx:r}}}),l=new kn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=R(),n=E("div"),i=E("button"),i.textContent="Finish",o=R(),s=E("button"),s.textContent="Cancel",a=R(),N(l.$$.fragment),T(i,"type","button"),T(s,"type","button"),ae(n,"display","flex"),ae(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,i),S(n,o),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(h=[U(i,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const m={};f&8&&(m.$$scope={dirty:f,ctx:c}),e.$set(m);const _={};f&1&&(_.tool=c[0]),l.$set(_)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){O(e.$$.fragment,c),O(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Re(h)}}}function Ia(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Fi extends V{constructor(e){super(),K(this,e,Ia,Ra,Z,{routeTool:0})}}function Aa(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Ca(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,m,_;return e=new yn({props:{label:"Help",$$slots:{default:[Aa]},$$scope:{ctx:r}}}),c=new kn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=R(),n=E("label"),i=E("input"),o=z(`
  Avoid doubling back`),s=R(),a=E("div"),l=E("button"),l.textContent="Finish",u=R(),p=E("button"),p.textContent="Cancel",h=R(),N(c.$$.fragment),T(i,"type","checkbox"),T(l,"type","button"),T(p,"type","button"),ae(a,"display","flex"),ae(a,"justify-content","space-between")},m(g,b){B(e,g,b),w(g,t,b),w(g,n,b),S(n,i),i.checked=r[1],S(n,o),w(g,s,b),w(g,a,b),S(a,l),S(a,u),S(a,p),w(g,h,b),B(c,g,b),f=!0,m||(_=[U(i,"change",r[2]),U(l,"click",r[3]),U(p,"click",r[4])],m=!0)},p(g,[b]){const d={};b&32&&(d.$$scope={dirty:b,ctx:g}),e.$set(d),b&2&&(i.checked=g[1]);const v={};b&1&&(v.tool=g[0]),c.$set(v)},i(g){f||($(e.$$.fragment,g),$(c.$$.fragment,g),f=!0)},o(g){O(e.$$.fragment,g),O(c.$$.fragment,g),f=!1},d(g){D(e,g),g&&k(t),g&&k(n),g&&k(s),g&&k(a),g&&k(h),D(c,g),m=!1,Re(_)}}}function Ta(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class Ni extends V{constructor(e){super(),K(this,e,Ta,Ca,Z,{routeTool:0})}}function zr(r){let e,t,n,i;const o=[Ba,Na,Fa,Pa,xa],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=be()},m(l,u){s[e].m(l,u),w(l,n,u),i=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(de(),O(s[p],1,1,()=>{s[p]=null}),me(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){i||($(t),i=!0)},o(l){O(t),i=!1},d(l){s[e].d(l),l&&k(n)}}}function xa(r){let e;return{c(){e=E("p"),e.textContent="Click an object to edit its geometry"},m(t,n){w(t,e,n)},p:G,i:G,o:G,d(t){t&&k(e)}}}function Pa(r){let e,t;return e=new Ni({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Fa(r){let e,t;return e=new Fi({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Na(r){let e,t;return e=new Pi({props:{polygonTool:r[2]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ba(r){let e,t;return e=new xi({props:{pointTool:r[1],editingExisting:!0}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Da(r){let e,t,n=r[0]==Ue&&zr(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==Ue?n?(n.p(i,o),o&1&&$(n,1)):(n=zr(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(de(),O(n,1,1,()=>{n=null}),me())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const Ue="edit-geometry";function Bi(){}function ja(r,e,t){let n;se(r,je,_=>t(8,n=_));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(o.stop(),s.stop(),a.stop(),ne.update(_=>{let g=_.features.find(b=>b.id==l);return delete g.properties.hide_while_editing,_})),l=null,t(4,u=null),He.set(null)}n.on("mousemove",h),n.on("mouseout",c),n.on("click",f),Pt(()=>{n.off("mousemove",h),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(_=>{i==Ue&&(ne.update(g=>{let b=g.features.find(d=>d.id==l);return b.properties.length_meters=_.properties.length_meters,b.properties.waypoints=_.properties.waypoints,delete b.properties.hide_while_editing,b.geometry=_.geometry,g}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(_=>{i==Ue&&(ne.update(g=>{let b=g.features.find(d=>d.id==l);return b.properties.waypoints=_.properties.waypoints,delete b.properties.hide_while_editing,b.geometry=_.geometry,g}),l=null,t(4,u=null))});for(let _ of[o,s])_.addEventListenerSuccess(g=>{i==Ue&&(ne.update(b=>{let d=b.features.find(v=>v.id==l);return d.geometry=g.geometry,delete d.properties.hide_while_editing,b}),l=null,t(4,u=null))});for(let _ of[o,s,a])_.addEventListenerFailure(()=>{i==Ue&&(ne.update(g=>{let b=g.features.find(d=>d.id==l);return delete b.properties.hide_while_editing,g}),l=null,t(4,u=null))});function h(_){var g;if(i==Ue&&l==null){let b=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});He.set(((g=b[0])==null?void 0:g.id)||null)}}function c(){i==Ue&&l==null&&He.set(null)}function f(_){if(i==Ue&&l==null){let g=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0&&m(g[0].id)}}function m(_){He.set(null);let g=null;ne.update(d=>(g=d.features.find(v=>v.id==_),g.properties.hide_while_editing=!0,d));let b=g;l=_,b.geometry.type=="LineString"?(a.editExistingRoute(b),t(4,u="route")):b.geometry.type=="Polygon"?b.properties.waypoints?(a.editExistingArea(b),t(4,u="snap-polygon")):(s.editExisting(b),t(4,u="free-polygon")):b.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=_=>{"mode"in _&&t(0,i=_.mode),"pointTool"in _&&t(1,o=_.pointTool),"polygonTool"in _&&t(2,s=_.polygonTool),"routeTool"in _&&t(3,a=_.routeTool)},[i,o,s,a,u,Bi,p]}class Ua extends V{constructor(e){super(),K(this,e,ja,Da,Z,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Bi}get stop(){return this.$$.ctx[6]}}async function qa(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),o+=p.length;const h=100*o/i;e.style=`background: linear-gradient(to right, red ${h}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function Ga(r){let e,t;return e=new Ni({props:{routeTool:r[0]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ha(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&k(e),r[7](null)}}}function Ya(r){let e,t,n,i;const o=[Ha,Ga],s=[];function a(l,u){return l[0]?l[1]==Xn?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=be()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),i=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(de(),O(s[p],1,1,()=>{s[p]=null}),me()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||($(t),i=!0)},o(l){O(t),i=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const Xn="route";function Ja(r,e,t){let n;se(r,je,c=>t(8,n=c));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}mn(async()=>{await Ci(),console.log(`Grabbing ${s}`);try{const c=await qa(s,a);t(0,l=new ca(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==Xn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{i==Xn&&(ne.update(f=>(c.id=Ft(f),c.properties.intervention_type="route",f.features.push(c),f)),o("edit-attribute"),Se.set(c.id))})});function h(c){ue[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,i=c.mode),"changeMode"in c&&t(3,o=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,i,a,o,s,u,p,h]}class Xa extends V{constructor(e){super(),K(this,e,Ja,Ya,Z,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function Wr(r){let e,t;return e=new xi({props:{pointTool:r[1],editingExisting:!1}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function za(r){let e,t,n=r[0]==cn&&Wr(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==cn?n?(n.p(i,o),o&1&&$(n,1)):(n=Wr(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(de(),O(n,1,1,()=>{n=null}),me())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const cn="point";function Wa(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==cn&&(ne.update(u=>(l.id=Ft(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),Se.set(l.id))}),o.addEventListenerFailure(()=>{n==cn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class Va extends V{constructor(e){super(),K(this,e,Wa,za,Z,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Vr(r){let e,t;return e=new Pi({props:{polygonTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ka(r){let e,t,n=r[0]==pn&&Vr(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==pn?n?(n.p(i,o),o&1&&$(n,1)):(n=Vr(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(de(),O(n,1,1,()=>{n=null}),me())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const pn="free-polygon";function Za(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==pn&&(ne.update(u=>(l.id=Ft(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Se.set(l.id))}),o.addEventListenerFailure(()=>{n==pn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Qa extends V{constructor(e){super(),K(this,e,Za,Ka,Z,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Kr(r){let e,t;return e=new Fi({props:{routeTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function eu(r){let e,t,n=r[0]==hn&&Kr(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==hn?n?(n.p(i,o),o&1&&$(n,1)):(n=Kr(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(de(),O(n,1,1,()=>{n=null}),me())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const hn="snap-polygon";function tu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==hn&&(ne.update(u=>(l.id=Ft(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Se.set(l.id))}),o.addEventListenerFailure(()=>{n==hn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class nu extends V{constructor(e){super(),K(this,e,tu,eu,Z,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ru(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Je(r.slice(0,2),[n,t]),s=Je(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function iu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return oo(r,function(s){ou(s,o,n)}),r}function ou(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function su(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=qn(r),n=qn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=iu(e,{precision:7});switch(n){case"Point":return zn(r,i);case"MultiPoint":return Zr(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Zr(r,Ii(r,i))}}function Zr(r,e){var t=[],n=mt();return Vn(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=zn(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=ru(so(a)))}),n.load(We(t));else{var o=n.search(i);if(o.features.length){var s=Di(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),en(zn(s,i),function(a){t.push(a),n.insert(a)})}}}),We(t)}function zn(r,e){var t=[],n=Ne(r)[0],i=Ne(r)[r.geometry.coordinates.length-1];if(In(n,Ve(e))||In(i,Ve(e)))return We([r]);var o=mt(),s=Gn(r);o.load(s);var a=o.search(e);if(!a.features.length)return We([r]);var l=Di(e,a),u=[n],p=lo(s,function(h,c,f){var m=Ne(c)[1],_=Ve(e);return f===l.id?(h.push(_),t.push(dt(h)),In(_,m)?[_]:[_,m]):(h.push(m),h)},u);return p.length>1&&t.push(dt(p)),We(t)}function Di(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return en(e,function(i){var o=xt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function In(r,e){return r[0]===e[0]&&r[1]===e[1]}function lu(r,e,t){var n=Ne(t);if(qn(t)!=="LineString")throw new Error("line must be a LineString");var i=xt(t,r),o=xt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),dt(a,t.properties)}function Qr(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function au(r){let e,t,n,i=r[0]==At&&Qr();return{c(){i&&i.c(),e=be()},m(o,s){i&&i.m(o,s),w(o,e,s),t||(n=U(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==At?i||(i=Qr(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:G,o:G,d(o){i&&i.d(o),o&&k(e),t=!1,n()}}}const At="split-route",uu=10,fu=30;let An="split-route";function ji(){}function ei(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function cu(r,e,t){let n,i;se(r,ne,_=>t(8,n=_)),se(r,je,_=>t(6,i=_));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",p),i.on("click",h),Pt(()=>{i.off("mousemove",p),i.off("click",h)}),Qe(i,An,Be()),we(i,{id:"draw-split-route",source:An,...gt("black",uu,["case",["==",["get","snapped"],!0],1,.5])});function p(_){if(o!=At)return;t(5,l=ei(_.lngLat.toArray(),!1)),u=null;const g=[_.point.x-fu,_.point.y],b=i.unproject(_.point).distanceTo(i.unproject(g))/1e3;let d=[];for(let[v,y]of n.features.entries())if(y.geometry.type=="LineString"){let M=xt(y.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=b&&d.push([v,M.geometry.coordinates,M.properties.dist])}d.sort((v,y)=>v[2]-y[2]),d.length>0&&(t(5,l=ei(d[0][1],!0)),u=d[0][0])}function h(){if(o==At)if(u==null)s("edit-attribute");else{let _=su(n.features[u],l);if(_.features.length==2){let g=_.features[0],b=_.features[1];ne.update(d=>(g.id=d.features[u].id,b.id=Ft(d),g.properties=JSON.parse(JSON.stringify(d.features[u].properties)),b.properties=JSON.parse(JSON.stringify(g.properties)),c(d.features[u],g,b,l),d.features.splice(u,1,g,b),d))}a()}}function c(_,g,b,d){g.properties.length_meters=Jt(g,{units:"kilometers"})*1e3,b.properties.length_meters=Jt(b,{units:"kilometers"})*1e3,g.properties.waypoints=[],b.properties.waypoints=[];let v=f(_,d),y=!0,M=0;for(let L of _.properties.waypoints){let A=f(_,pt([L.lon,L.lat]));if(y)if(A<v)g.properties.waypoints.push(L);else{let I=L.snapped&&_.properties.waypoints[M-1].snapped;g.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:I}),y=!1,b.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:I}),b.properties.waypoints.push(L)}else b.properties.waypoints.push(L);M++}}function f(_,g){let b=_.geometry.coordinates[0],d=lu(b,g,_);return Jt(d,{units:"kilometers"})*1e3}function m(_){o==At&&_.key=="Escape"&&(s("edit-attribute"),_.preventDefault())}return r.$$set=_=>{"mode"in _&&t(0,o=_.mode),"changeMode"in _&&t(2,s=_.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let _=Be();l&&_.features.push(l),i.getSource(An).setData(_)}},[o,m,s,ji,a,l,i]}class pu extends V{constructor(e){super(),K(this,e,cu,au,Z,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ji}get stop(){return this.$$.ctx[4]}}const hu="/atip/scheme_overview/assets/edit_attributes-29b396e1.svg",du="/atip/scheme_overview/assets/edit_geometry-02dad294.svg",mu="/atip/scheme_overview/assets/point-276f4055.svg",_u="/atip/scheme_overview/assets/polygon_snapped-18efbbea.svg",gu="/atip/scheme_overview/assets/polygon_freehand-cf965967.svg",bu="/atip/scheme_overview/assets/route-d3c0ebad.svg",vu="/atip/scheme_overview/assets/split_route-9e0ea2da.svg";function ti(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new Ua({props:n}),r[15](e),{c(){N(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){O(e.$$.fragment,i),t=!1},d(i){r[15](null),D(e,i)}}}function ni(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"point",label:"New point",icon:mu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ri(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new nu({props:n}),r[18](e),{c(){N(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){O(e.$$.fragment,i),t=!1},d(i){r[18](null),D(e,i)}}}function ii(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"route",label:"New route",icon:bu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function oi(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:vu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function yu(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,m,_,g,b,d,v,y,M,L,A,I,F,C,x,q,Y,te,le,ke;n=new nt({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:hu,changeMode:r[13]}});let Ae={mode:r[3],changeMode:r[13]};o=new ba({props:Ae}),r[14](o),l=new nt({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:du,changeMode:r[13]}});let ie=r[2]&&ti(r),re=r[1]!="planning"&&ni(r),xe={mode:r[3],changeMode:r[13],pointTool:r[11]};f=new Va({props:xe}),r[16](f),g=new nt({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:gu,changeMode:r[13]}});let Le={mode:r[3],changeMode:r[13],polygonTool:r[12]};d=new Qa({props:Le}),r[17](d),M=new nt({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:_u,changeMode:r[13]}});let W=r[2]&&ri(r),pe=r[1]!="planning"&&ii(r);function Bt(j){r[20](j)}let _e={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(_e.routeTool=r[2]),C=new Xa({props:_e}),r[19](C),ue.push(()=>Ee(C,"routeTool",Bt,r[2]));let P=r[1]!="planning"&&oi(r),ee={mode:r[3],changeMode:r[13]};return le=new pu({props:ee}),r[21](le),{c(){e=E("div"),t=E("div"),N(n.$$.fragment),i=R(),N(o.$$.fragment),s=R(),a=E("div"),N(l.$$.fragment),u=R(),ie&&ie.c(),p=R(),h=E("div"),re&&re.c(),c=R(),N(f.$$.fragment),m=R(),_=E("div"),N(g.$$.fragment),b=R(),N(d.$$.fragment),v=R(),y=E("div"),N(M.$$.fragment),L=R(),W&&W.c(),A=R(),I=E("div"),pe&&pe.c(),F=R(),N(C.$$.fragment),q=R(),Y=E("div"),P&&P.c(),te=R(),N(le.$$.fragment),T(e,"class","toolbox svelte-4s4d3o")},m(j,fe){w(j,e,fe),S(e,t),B(n,t,null),S(t,i),B(o,t,null),S(e,s),S(e,a),B(l,a,null),S(a,u),ie&&ie.m(a,null),S(e,p),S(e,h),re&&re.m(h,null),S(h,c),B(f,h,null),S(e,m),S(e,_),B(g,_,null),S(_,b),B(d,_,null),S(e,v),S(e,y),B(M,y,null),S(y,L),W&&W.m(y,null),S(e,A),S(e,I),pe&&pe.m(I,null),S(I,F),B(C,I,null),S(e,q),S(e,Y),P&&P.m(Y,null),S(Y,te),B(le,Y,null),ke=!0},p(j,[fe]){const tr={};fe&8&&(tr.mode=j[3]),n.$set(tr);const nr={};fe&8&&(nr.mode=j[3]),o.$set(nr);const rr={};fe&8&&(rr.mode=j[3]),l.$set(rr),j[2]?ie?(ie.p(j,fe),fe&4&&$(ie,1)):(ie=ti(j),ie.c(),$(ie,1),ie.m(a,null)):ie&&(de(),O(ie,1,1,()=>{ie=null}),me()),j[1]!="planning"?re?(re.p(j,fe),fe&2&&$(re,1)):(re=ni(j),re.c(),$(re,1),re.m(h,c)):re&&(de(),O(re,1,1,()=>{re=null}),me());const ir={};fe&8&&(ir.mode=j[3]),f.$set(ir);const or={};fe&8&&(or.mode=j[3]),g.$set(or);const sr={};fe&8&&(sr.mode=j[3]),d.$set(sr);const lr={};fe&8&&(lr.mode=j[3]),M.$set(lr),j[2]?W?(W.p(j,fe),fe&4&&$(W,1)):(W=ri(j),W.c(),$(W,1),W.m(y,null)):W&&(de(),O(W,1,1,()=>{W=null}),me()),j[1]!="planning"?pe?(pe.p(j,fe),fe&2&&$(pe,1)):(pe=ii(j),pe.c(),$(pe,1),pe.m(I,F)):pe&&(de(),O(pe,1,1,()=>{pe=null}),me());const Dt={};fe&8&&(Dt.mode=j[3]),fe&1&&(Dt.url=j[0]),!x&&fe&4&&(x=!0,Dt.routeTool=j[2],Me(()=>x=!1)),C.$set(Dt),j[1]!="planning"?P?(P.p(j,fe),fe&2&&$(P,1)):(P=oi(j),P.c(),$(P,1),P.m(Y,te)):P&&(de(),O(P,1,1,()=>{P=null}),me());const ar={};fe&8&&(ar.mode=j[3]),le.$set(ar)},i(j){ke||($(n.$$.fragment,j),$(o.$$.fragment,j),$(l.$$.fragment,j),$(ie),$(re),$(f.$$.fragment,j),$(g.$$.fragment,j),$(d.$$.fragment,j),$(M.$$.fragment,j),$(W),$(pe),$(C.$$.fragment,j),$(P),$(le.$$.fragment,j),ke=!0)},o(j){O(n.$$.fragment,j),O(o.$$.fragment,j),O(l.$$.fragment,j),O(ie),O(re),O(f.$$.fragment,j),O(g.$$.fragment,j),O(d.$$.fragment,j),O(M.$$.fragment,j),O(W),O(pe),O(C.$$.fragment,j),O(P),O(le.$$.fragment,j),ke=!1},d(j){j&&k(e),D(n),r[14](null),D(o),D(l),ie&&ie.d(),re&&re.d(),r[16](null),D(f),D(g),r[17](null),D(d),D(M),W&&W.d(),pe&&pe.d(),r[19](null),D(C),P&&P.d(),r[21](null),D(le)}}}function wu(r,e,t){let n;se(r,je,C=>t(22,n=C));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new Hl(n),l=new na(n),u="edit-attribute",p,h,c,f,m,_,g;function b(C){let x={"edit-attribute":p,"edit-geometry":h,route:c,point:f,"free-polygon":m,"snap-polygon":_,"split-route":g};if(u==C){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),x[u].stop(),t(3,u=C),console.log(`Starting new mode ${u}`),x[u].start()}Pt(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function d(C){ue[C?"unshift":"push"](()=>{p=C,t(4,p)})}function v(C){ue[C?"unshift":"push"](()=>{h=C,t(5,h)})}function y(C){ue[C?"unshift":"push"](()=>{f=C,t(7,f)})}function M(C){ue[C?"unshift":"push"](()=>{m=C,t(8,m)})}function L(C){ue[C?"unshift":"push"](()=>{_=C,t(9,_)})}function A(C){ue[C?"unshift":"push"](()=>{c=C,t(6,c)})}function I(C){s=C,t(2,s)}function F(C){ue[C?"unshift":"push"](()=>{g=C,t(10,g)})}return r.$$set=C=>{"routeSnapperUrl"in C&&t(0,i=C.routeSnapperUrl),"schema"in C&&t(1,o=C.schema)},[i,o,s,u,p,h,c,f,m,_,g,a,l,b,d,v,y,M,L,A,I,F]}class ku extends V{constructor(e){super(),K(this,e,wu,yu,Z,{routeSnapperUrl:0,schema:1})}}function Su(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,m,_,g,b,d,v;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",i=R(),o=E("button"),o.textContent="About",s=R(),a=E("button"),a.textContent="Instructions",l=R(),u=E("br"),p=R(),h=E("label"),c=z(`ATIP schema:
      `),f=E("select"),m=E("option"),m.textContent="v1",_=E("option"),_.textContent="v2",g=E("option"),g.textContent="Housing developments",b=E("option"),b.textContent="Critical issues",T(n,"type","button"),T(o,"type","button"),T(a,"type","button"),m.__value="v1",m.value=m.__value,_.__value="v2",_.value=_.__value,g.__value="planning",g.value=g.__value,b.__value="criticals",b.value=b.__value,r[2]===void 0&&_t(()=>r[12].call(f)),T(e,"slot","nav")},m(y,M){w(y,e,M),S(e,t),S(t,n),S(t,i),S(t,o),S(t,s),S(t,a),S(e,l),S(e,u),S(e,p),S(e,h),S(h,c),S(h,f),S(f,m),S(f,_),S(f,g),S(f,b),Ke(f,r[2]),d||(v=[U(n,"click",r[11]),U(o,"click",r[8]),U(a,"click",r[9]),U(f,"change",r[12]),U(f,"change",r[10])],d=!0)},p(y,M){M&4&&Ke(f,y[2])},d(y){y&&k(e),d=!1,Re(v)}}}function Eu(r){let e,t,n,i,o,s,a,l,u,p,h,c,f,m,_,g;return o=new Il({props:{boundaryGeojson:r[5]}}),a=new $l({props:{authorityName:r[6],schema:r[2]}}),h=new vl({props:{schema:r[2],routeInfo:r[4]}}),_=new kl({props:{routeInfo:r[4]}}),{c(){e=E("div"),t=E("h1"),n=z(r[6]),i=R(),N(o.$$.fragment),s=R(),N(a.$$.fragment),l=R(),u=E("br"),p=R(),N(h.$$.fragment),c=R(),f=E("hr"),m=R(),N(_.$$.fragment),T(e,"slot","sidebar")},m(b,d){w(b,e,d),S(e,t),S(t,n),S(t,i),B(o,t,null),S(e,s),B(a,e,null),S(e,l),S(e,u),S(e,p),B(h,e,null),S(e,c),S(e,f),S(e,m),B(_,e,null),g=!0},p(b,d){const v={};d&32&&(v.boundaryGeojson=b[5]),o.$set(v);const y={};d&4&&(y.schema=b[2]),a.$set(y);const M={};d&4&&(M.schema=b[2]),d&16&&(M.routeInfo=b[4]),h.$set(M);const L={};d&16&&(L.routeInfo=b[4]),_.$set(L)},i(b){g||($(o.$$.fragment,b),$(a.$$.fragment,b),$(h.$$.fragment,b),$(_.$$.fragment,b),g=!0)},o(b){O(o.$$.fragment,b),O(a.$$.fragment,b),O(h.$$.fragment,b),O(_.$$.fragment,b),g=!1},d(b){b&&k(e),D(o),D(a),D(h),D(_)}}}function Mu(r){let e,t,n,i,o,s,a,l,u,p,h,c;return e=new ds({props:{boundaryGeojson:r[5]}}),n=new Ul({props:{schema:r[2]}}),o=new Gl({}),a=new ku({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new Tl({props:{style:r[7]}}),h=new Dl({props:{schema:r[2]}}),{c(){N(e.$$.fragment),t=R(),N(n.$$.fragment),i=R(),N(o.$$.fragment),s=R(),N(a.$$.fragment),l=R(),N(u.$$.fragment),p=R(),N(h.$$.fragment)},m(f,m){B(e,f,m),w(f,t,m),B(n,f,m),w(f,i,m),B(o,f,m),w(f,s,m),B(a,f,m),w(f,l,m),B(u,f,m),w(f,p,m),B(h,f,m),c=!0},p(f,m){const _={};m&32&&(_.boundaryGeojson=f[5]),e.$set(_);const g={};m&4&&(g.schema=f[2]),n.$set(g);const b={};m&8&&(b.routeSnapperUrl=f[3]),m&4&&(b.schema=f[2]),a.$set(b);const d={};m&4&&(d.schema=f[2]),h.$set(d)},i(f){c||($(e.$$.fragment,f),$(n.$$.fragment,f),$(o.$$.fragment,f),$(a.$$.fragment,f),$(u.$$.fragment,f),$(h.$$.fragment,f),c=!0)},o(f){O(e.$$.fragment,f),O(n.$$.fragment,f),O(o.$$.fragment,f),O(a.$$.fragment,f),O(u.$$.fragment,f),O(h.$$.fragment,f),c=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(i),D(o,f),f&&k(s),D(a,f),f&&k(l),D(u,f),f&&k(p),D(h,f)}}}function $u(r){let e,t,n;return t=new mo({props:{style:r[7],$$slots:{default:[Mu]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),T(e,"slot","main")},m(i,o){w(i,e,o),B(t,e,null),n=!0},p(i,o){const s={};o&524332&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){O(t.$$.fragment,i),n=!1},d(i){i&&k(e),D(t)}}}function Lu(r){let e,t,n,i,o,s,a,l;e=new ho({props:{$$slots:{main:[$u],sidebar:[Eu],nav:[Su]},$$scope:{ctx:r}}});function u(f){r[13](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new uo({props:p}),ue.push(()=>Ee(n,"open",u,r[0]));function h(f){r[14](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Uo({props:c}),ue.push(()=>Ee(s,"open",h,r[1])),{c(){N(e.$$.fragment),t=R(),N(n.$$.fragment),o=R(),N(s.$$.fragment)},m(f,m){B(e,f,m),w(f,t,m),B(n,f,m),w(f,o,m),B(s,f,m),l=!0},p(f,[m]){const _={};m&524348&&(_.$$scope={dirty:m,ctx:f}),e.$set(_);const g={};!i&&m&1&&(i=!0,g.open=f[0],Me(()=>i=!1)),n.$set(g);const b={};!a&&m&2&&(a=!0,b.open=f[1],Me(()=>a=!1)),s.$set(b)},i(f){l||($(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!0)},o(f){O(e.$$.fragment,f),O(n.$$.fragment,f),O(s.$$.fragment,f),l=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(o),D(s,f)}}}function Ou(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${a}.bin`,h=`https://atip.uk/route-info/${a}.bin`;o||(p=`https://atip.uk/route-snappers-dev/${a}.bin`,h=`https://atip.uk/route-info-dev/${a}.bin`);let c;function f(){t(0,n=!n),t(1,i=!1)}function m(){t(1,i=!i),t(0,n=!1)}let _;mn(async()=>{t(5,_=await g());const L=ci(new Oo);t(4,c=await new L),await c.loadFile(h)});async function g(){const A=await(await fetch(fo)).text(),I=JSON.parse(A);return I.features=I.features.filter(F=>{var C;return((C=F.properties)==null?void 0:C.name)==a}),I}function b(){let L=new URLSearchParams(window.location.search);L.set("schema",u);let A=`${window.location.pathname}?${L.toString()}${window.location.hash}`;window.location.href=A}const d=()=>window.open("index.html");function v(){u=_n(this),t(2,u)}function y(L){n=L,t(0,n)}function M(L){i=L,t(1,i)}return[n,i,u,p,c,_,a,l,f,m,b,d,v,y,M]}class Ru extends V{constructor(e){super(),K(this,e,Ou,Lu,Z,{})}}new Ru({target:document.getElementById("app")});
