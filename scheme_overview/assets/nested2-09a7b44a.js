import{S as fe,i as ue,s as pe,d as M,m as T,n as C,o as F,q as E,J as Z,R as me,F as _e,e as _,c as $,t as B,f as H,g as G,h as i,j as x,l as X,B as W,V as ie,W as oe,p as P,N as ce,r as ae,w as ee,X as he,G as de}from"./FileInput-ddab9480.js";import{L as $e,g as Q,h as be,I as ge,B as ye,i as we,M as Se,m as ke,C as ve}from"./InterventionLayer-0bc57503.js";function te(r,e,n){const l=r.slice();return l[16]=e[n],l}function le(r){let e,n;return e=new ve({props:{label:`${r[16].internal_scheme_id}: ${r[16].num_features} features`,$$slots:{default:[Ce]},$$scope:{ctx:r}}}),{c(){M(e.$$.fragment)},m(l,t){T(e,l,t),n=!0},p(l,t){const a={};t&1&&(a.label=`${l[16].internal_scheme_id}: ${l[16].num_features} features`),t&524289&&(a.$$scope={dirty:t,ctx:l}),e.$set(a)},i(l){n||(C(e.$$.fragment,l),n=!0)},o(l){F(e.$$.fragment,l),n=!1},d(l){E(e,l)}}}function Ce(r){let e,n,l,t=r[16].file_name+"",a,m,c,d,o=r[16].scheme_priority+"",b,R,g,L,j=r[16].authority_name+"",I,A,k=r[16].authority_code+"",J,s,u,y,N,w,D,O,U,q,z;function V(){return r[11](r[16])}function K(){return r[12](r[16])}return{c(){e=_("ul"),n=_("li"),l=B("Filename: "),a=B(t),m=$(),c=_("li"),d=B("Priority: "),b=B(o),R=$(),g=_("li"),L=B("Authority: "),I=B(j),A=B(" ("),J=B(k),s=B(")"),u=$(),y=_("li"),N=_("button"),N.textContent="Show on map",w=$(),D=_("li"),O=_("button"),O.textContent="Edit scheme",U=$(),H(N,"type","button"),H(O,"type","button")},m(S,f){G(S,e,f),i(e,n),i(n,l),i(n,a),i(e,m),i(e,c),i(c,d),i(c,b),i(e,R),i(e,g),i(g,L),i(g,I),i(g,A),i(g,J),i(g,s),i(e,u),i(e,y),i(y,N),i(e,w),i(e,D),i(D,O),G(S,U,f),q||(z=[X(N,"click",V),X(O,"click",K)],q=!0)},p(S,f){r=S,f&1&&t!==(t=r[16].file_name+"")&&W(a,t),f&1&&o!==(o=r[16].scheme_priority+"")&&W(b,o),f&1&&j!==(j=r[16].authority_name+"")&&W(I,j),f&1&&k!==(k=r[16].authority_code+"")&&W(J,k)},d(S){S&&P(e),S&&P(U),q=!1,ae(z)}}}function ne(r){let e=r[2].has(r[16].file_name),n,l,t=e&&le(r);return{c(){t&&t.c(),n=he()},m(a,m){t&&t.m(a,m),G(a,n,m),l=!0},p(a,m){m&5&&(e=a[2].has(a[16].file_name)),e?t?(t.p(a,m),m&5&&C(t,1)):(t=le(a),t.c(),C(t,1),t.m(n.parentNode,n)):t&&(ie(),F(t,1,1,()=>{t=null}),oe())},i(a){l||(C(t),l=!0)},o(a){F(t),l=!1},d(a){t&&t.d(a),a&&P(n)}}}function Be(r){let e,n,l,t,a,m,c,d,o,b,R,g,L,j,I,A,k,J,s,u,y,N,w=r[2].size+"",D,O,U,q,z,V,K;m=new _e({props:{label:"Load from GeoJSON",uniqueId:"load_geojson",loadFile:r[4]}});let S=r[0],f=[];for(let p=0;p<S.length;p+=1)f[p]=ne(te(r,S,p));const se=p=>F(f[p],1,1,()=>{f[p]=null});return{c(){e=_("div"),n=_("button"),n.textContent="Home",l=$(),t=_("h1"),t.textContent="Browse schemes",a=$(),M(m.$$.fragment),c=$(),d=_("br"),o=$(),b=_("br"),R=$(),g=_("div"),L=_("label"),j=B("Filter by any field: "),I=_("br"),A=$(),k=_("input"),J=$(),s=_("button"),s.textContent="Clear",u=$(),y=_("p"),N=B("Showing "),D=B(w),O=B(" schemes"),U=$(),q=_("ul");for(let p=0;p<f.length;p+=1)f[p].c();H(n,"type","button"),H(k,"type","text"),H(s,"type","button"),H(e,"slot","sidebar")},m(p,v){G(p,e,v),i(e,n),i(e,l),i(e,t),i(e,a),T(m,e,null),i(e,c),i(e,d),i(e,o),i(e,b),i(e,R),i(e,g),i(g,L),i(L,j),i(L,I),i(L,A),i(L,k),x(k,r[1]),i(g,J),i(g,s),i(e,u),i(e,y),i(y,N),i(y,D),i(y,O),i(e,U),i(e,q);for(let h=0;h<f.length;h+=1)f[h].m(q,null);z=!0,V||(K=[X(n,"click",r[8]),X(k,"input",r[9]),X(s,"click",r[10])],V=!0)},p(p,v){if(v&2&&k.value!==p[1]&&x(k,p[1]),(!z||v&4)&&w!==(w=p[2].size+"")&&W(D,w),v&101){S=p[0];let h;for(h=0;h<S.length;h+=1){const Y=te(p,S,h);f[h]?(f[h].p(Y,v),C(f[h],1)):(f[h]=ne(Y),f[h].c(),C(f[h],1),f[h].m(q,null))}for(ie(),h=S.length;h<f.length;h+=1)se(h);oe()}},i(p){if(!z){C(m.$$.fragment,p);for(let v=0;v<S.length;v+=1)C(f[v]);z=!0}},o(p){F(m.$$.fragment,p),f=f.filter(Boolean);for(let v=0;v<f.length;v+=1)F(f[v]);z=!1},d(p){p&&P(e),E(m),ce(f,p),V=!1,ae(K)}}}function Le(r){let e,n,l,t,a,m,c,d;return e=new ge({props:{schema:re}}),l=new ye({props:{style:r[3]}}),a=new we({props:{schema:re}}),c=new Se({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:je}}),{c(){M(e.$$.fragment),n=$(),M(l.$$.fragment),t=$(),M(a.$$.fragment),m=$(),M(c.$$.fragment)},m(o,b){T(e,o,b),G(o,n,b),T(l,o,b),G(o,t,b),T(a,o,b),G(o,m,b),T(c,o,b),d=!0},p:de,i(o){d||(C(e.$$.fragment,o),C(l.$$.fragment,o),C(a.$$.fragment,o),C(c.$$.fragment,o),d=!0)},o(o){F(e.$$.fragment,o),F(l.$$.fragment,o),F(a.$$.fragment,o),F(c.$$.fragment,o),d=!1},d(o){E(e,o),o&&P(n),E(l,o),o&&P(t),E(a,o),o&&P(m),E(c,o)}}}function Ne(r){let e,n,l;return n=new be({props:{style:r[3],$$slots:{default:[Le]},$$scope:{ctx:r}}}),{c(){e=_("div"),M(n.$$.fragment),H(e,"slot","main")},m(t,a){G(t,e,a),T(n,e,null),l=!0},p(t,a){const m={};a&524288&&(m.$$scope={dirty:a,ctx:t}),n.$set(m)},i(t){l||(C(n.$$.fragment,t),l=!0)},o(t){F(n.$$.fragment,t),l=!1},d(t){t&&P(e),E(n)}}}function Fe(r){let e,n;return e=new $e({props:{$$slots:{main:[Ne],sidebar:[Be]},$$scope:{ctx:r}}}),{c(){M(e.$$.fragment)},m(l,t){T(e,l,t),n=!0},p(l,[t]){const a={};t&524295&&(a.$$scope={dirty:t,ctx:l}),e.$set(a)},i(l){n||(C(e.$$.fragment,l),n=!0)},o(l){F(e.$$.fragment,l),n=!1},d(l){E(e,l)}}}const re="v1";function je(r){return JSON.stringify(r,null,"  ")}function Ie(r,e,n){let l,t;Z(r,Q,s=>n(7,l=s)),Z(r,ke,s=>n(13,t=s));let m=new URLSearchParams(window.location.search).get("style")||"streets",c=[],d="",o=new Set;me(()=>{Q.set(null)});function b(s){try{let u=JSON.parse(s);Q.set(u),R(u),t==null||t.fitBounds(ee(u),{padding:20,animate:!1})}catch(u){window.alert(`Couldn't load schemes from a file: ${u}`)}}function R(s){var y;let u={};for(let N of s.features){let w=N.properties;u[y=w.atip_file_name]||(u[y]={file_name:w.atip_file_name,authority_code:w.authority_code,authority_name:w.authority_name,internal_scheme_id:w.internal_scheme_id,scheme_priority:w.scheme_priority,num_features:0}),u[w.atip_file_name].num_features++}n(0,c=Object.values(u))}function g(s){let u={type:"FeatureCollection",features:l.features.filter(y=>y.properties.atip_file_name==s.file_name)};t==null||t.fitBounds(ee(u),{padding:20,animate:!1})}function L(s){let u={type:"FeatureCollection",features:l.features.filter(N=>N.properties.atip_file_name==s.file_name)},y=s.authority_name;window.localStorage.setItem(y,JSON.stringify(u)),window.open(`scheme.html?authority=${s.authority_name}`,"_blank")}const j=()=>window.open("index.html");function I(){d=this.value,n(1,d)}const A=()=>n(1,d=""),k=s=>g(s),J=s=>L(s);return r.$$.update=()=>{if(r.$$.dirty&135){if(o.clear(),d){let s=d.toLowerCase();for(let u of l.features)JSON.stringify(u.properties).toLowerCase().includes(s)&&o.add(u.properties.atip_file_name)}else for(let s of c)o.add(s.file_name);Q.update(s=>{if(!s)return null;for(let u of s.features)o.has(u.properties.atip_file_name)?delete u.properties.hide_while_editing:u.properties.hide_while_editing=!0;return s}),n(2,o),n(1,d),n(7,l),n(0,c)}},[c,d,o,m,b,g,L,l,j,I,A,k,J]}class Je extends fe{constructor(e){super(),ue(this,e,Ie,Fe,pe,{})}}new Je({target:document.getElementById("app")});
