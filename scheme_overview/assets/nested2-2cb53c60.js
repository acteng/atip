import{S as x,i as ee,s as te,d as C,m as B,n as y,o as S,q as j,J as W,F as ne,e as h,c as g,f as M,g as J,h as f,l as H,V as le,W as ae,p as N,N as re,w as z,G as oe,t as k,B as E,r as se}from"./FileInput-ddab9480.js";import{L as ie,h as ue,g as D,C as fe,I as me,B as ce,i as _e,M as pe,m as $e}from"./InterventionLayer-bae67c04.js";function K(r,e,a){const t=r.slice();return t[12]=e[a],t}function de(r){let e,a,t,l=r[12].file_name+"",u,c,p,d,o=r[12].scheme_priority+"",_,v,$,m,F=r[12].authority_name+"",n,s,i=r[12].authority_code+"",b,w,R,G,O,U,P,q,T,A,V;function Y(){return r[6](r[12])}function Z(){return r[7](r[12])}return{c(){e=h("ul"),a=h("li"),t=k("Filename: "),u=k(l),c=g(),p=h("li"),d=k("Priority: "),_=k(o),v=g(),$=h("li"),m=k("Authority: "),n=k(F),s=k(" ("),b=k(i),w=k(")"),R=g(),G=h("li"),O=h("button"),O.textContent="Show on map",U=g(),P=h("li"),q=h("button"),q.textContent="Edit scheme",T=g(),M(O,"type","button"),M(q,"type","button")},m(I,L){J(I,e,L),f(e,a),f(a,t),f(a,u),f(e,c),f(e,p),f(p,d),f(p,_),f(e,v),f(e,$),f($,m),f($,n),f($,s),f($,b),f($,w),f(e,R),f(e,G),f(G,O),f(e,U),f(e,P),f(P,q),J(I,T,L),A||(V=[H(O,"click",Y),H(q,"click",Z)],A=!0)},p(I,L){r=I,L&1&&l!==(l=r[12].file_name+"")&&E(u,l),L&1&&o!==(o=r[12].scheme_priority+"")&&E(_,o),L&1&&F!==(F=r[12].authority_name+"")&&E(n,F),L&1&&i!==(i=r[12].authority_code+"")&&E(b,i)},d(I){I&&N(e),I&&N(T),A=!1,se(V)}}}function Q(r){let e,a;return e=new fe({props:{label:`${r[12].internal_scheme_id}: ${r[12].num_features} features`,$$slots:{default:[de]},$$scope:{ctx:r}}}),{c(){C(e.$$.fragment)},m(t,l){B(e,t,l),a=!0},p(t,l){const u={};l&1&&(u.label=`${t[12].internal_scheme_id}: ${t[12].num_features} features`),l&32769&&(u.$$scope={dirty:l,ctx:t}),e.$set(u)},i(t){a||(y(e.$$.fragment,t),a=!0)},o(t){S(e.$$.fragment,t),a=!1},d(t){j(e,t)}}}function he(r){let e,a,t,l,u,c,p,d,o,_,v;c=new ne({props:{label:"Load from GeoJSON",uniqueId:"load_geojson",loadFile:r[2]}});let $=r[0],m=[];for(let n=0;n<$.length;n+=1)m[n]=Q(K(r,$,n));const F=n=>S(m[n],1,1,()=>{m[n]=null});return{c(){e=h("div"),a=h("button"),a.textContent="Home",t=g(),l=h("h1"),l.textContent="Browse schemes",u=g(),C(c.$$.fragment),p=g(),d=h("ul");for(let n=0;n<m.length;n+=1)m[n].c();M(a,"type","button"),M(e,"slot","sidebar")},m(n,s){J(n,e,s),f(e,a),f(e,t),f(e,l),f(e,u),B(c,e,null),f(e,p),f(e,d);for(let i=0;i<m.length;i+=1)m[i].m(d,null);o=!0,_||(v=H(a,"click",r[5]),_=!0)},p(n,s){if(s&25){$=n[0];let i;for(i=0;i<$.length;i+=1){const b=K(n,$,i);m[i]?(m[i].p(b,s),y(m[i],1)):(m[i]=Q(b),m[i].c(),y(m[i],1),m[i].m(d,null))}for(le(),i=$.length;i<m.length;i+=1)F(i);ae()}},i(n){if(!o){y(c.$$.fragment,n);for(let s=0;s<$.length;s+=1)y(m[s]);o=!0}},o(n){S(c.$$.fragment,n),m=m.filter(Boolean);for(let s=0;s<m.length;s+=1)S(m[s]);o=!1},d(n){n&&N(e),j(c),re(m,n),_=!1,v()}}}function ge(r){let e,a,t,l,u,c,p,d;return e=new me({props:{schema:X}}),t=new ce({props:{style:r[1]}}),u=new _e({props:{schema:X}}),p=new pe({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:we}}),{c(){C(e.$$.fragment),a=g(),C(t.$$.fragment),l=g(),C(u.$$.fragment),c=g(),C(p.$$.fragment)},m(o,_){B(e,o,_),J(o,a,_),B(t,o,_),J(o,l,_),B(u,o,_),J(o,c,_),B(p,o,_),d=!0},p:oe,i(o){d||(y(e.$$.fragment,o),y(t.$$.fragment,o),y(u.$$.fragment,o),y(p.$$.fragment,o),d=!0)},o(o){S(e.$$.fragment,o),S(t.$$.fragment,o),S(u.$$.fragment,o),S(p.$$.fragment,o),d=!1},d(o){j(e,o),o&&N(a),j(t,o),o&&N(l),j(u,o),o&&N(c),j(p,o)}}}function ye(r){let e,a,t;return a=new ue({props:{style:r[1],$$slots:{default:[ge]},$$scope:{ctx:r}}}),{c(){e=h("div"),C(a.$$.fragment),M(e,"slot","main")},m(l,u){J(l,e,u),B(a,e,null),t=!0},p(l,u){const c={};u&32768&&(c.$$scope={dirty:u,ctx:l}),a.$set(c)},i(l){t||(y(a.$$.fragment,l),t=!0)},o(l){S(a.$$.fragment,l),t=!1},d(l){l&&N(e),j(a)}}}function be(r){let e,a;return e=new ie({props:{$$slots:{main:[ye],sidebar:[he]},$$scope:{ctx:r}}}),{c(){C(e.$$.fragment)},m(t,l){B(e,t,l),a=!0},p(t,[l]){const u={};l&32769&&(u.$$scope={dirty:l,ctx:t}),e.$set(u)},i(t){a||(y(e.$$.fragment,t),a=!0)},o(t){S(e.$$.fragment,t),a=!1},d(t){j(e,t)}}}const X="v1";function we(r){return JSON.stringify(r)}function Se(r,e,a){let t,l;W(r,D,n=>a(8,t=n)),W(r,$e,n=>a(9,l=n));let c=new URLSearchParams(window.location.search).get("style")||"streets",p=[];function d(n){try{let s=JSON.parse(n);D.set(s),o(s),l==null||l.fitBounds(z(s),{padding:20,animate:!1})}catch(s){window.alert(`Couldn't load schemes from a file: ${s}`)}}function o(n){var i;let s={};for(let b of n.features){let w=b.properties;s[i=w.atip_file_name]||(s[i]={file_name:w.atip_file_name,authority_code:w.authority_code,authority_name:w.authority_name,internal_scheme_id:w.internal_scheme_id,scheme_priority:w.scheme_priority,num_features:0}),s[w.atip_file_name].num_features++}a(0,p=Object.values(s))}function _(n){let s={type:"FeatureCollection",features:t.features.filter(i=>i.properties.atip_file_name==n.file_name)};l==null||l.fitBounds(z(s),{padding:20,animate:!1})}function v(n){let s={type:"FeatureCollection",features:t.features.filter(b=>b.properties.atip_file_name==n.file_name)},i=n.authority_name;window.localStorage.setItem(i,JSON.stringify(s)),window.open(`scheme.html?authority=${n.authority_name}`,"_blank")}return[p,c,d,_,v,()=>window.open("index.html"),n=>_(n),n=>v(n)]}class ke extends x{constructor(e){super(),ee(this,e,Se,be,te,{})}}new ke({target:document.getElementById("app")});
