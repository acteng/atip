import{S as ve,i as Ce,s as Be,d as M,m as q,n as k,o as B,q as T,J as _e,R as Le,F as Ne,e as h,c as w,t as _,f as W,g as R,h as r,j as ce,l as Y,B as G,V as we,W as ye,p as Z,N as Fe,r as Se,w as he,X as Oe,G as je}from"./FileInput-ddab9480.js";import{L as Ie,g as ne,Z as Je,h as ze,I as Ge,B as Me,i as qe,M as Te,m as Ee,C as Pe}from"./InterventionLayer-96c88770.js";function de(o,e,n){const l=o.slice();return l[17]=e[n],l}function $e(o){let e,n;return e=new Pe({props:{label:`${o[17].internal_scheme_id}: ${o[17].num_features} features`,$$slots:{default:[Re]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},m(l,t){q(e,l,t),n=!0},p(l,t){const a={};t&1&&(a.label=`${l[17].internal_scheme_id}: ${l[17].num_features} features`),t&1048577&&(a.$$scope={dirty:t,ctx:l}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){B(e.$$.fragment,l),n=!1},d(l){T(e,l)}}}function Re(o){let e,n,l,t=o[17].file_name+"",a,p,g,m,s=o[17].scheme_priority+"",d,A,L,E,C=o[17].authority_name+"",N,D,J=o[17].authority_code+"",P,F,i,f,y,$,v,I,H,X,U;function Q(){return o[12](o[17])}function x(){return o[13](o[17])}return{c(){e=h("ul"),n=h("li"),l=_("Filename: "),a=_(t),p=w(),g=h("li"),m=_("Priority: "),d=_(s),A=w(),L=h("li"),E=_("Authority: "),N=_(C),D=_(" ("),P=_(J),F=_(")"),i=w(),f=h("li"),y=h("button"),y.textContent="Show on map",$=w(),v=h("li"),I=h("button"),I.textContent="Edit scheme",H=w(),W(y,"type","button"),W(I,"type","button")},m(O,j){R(O,e,j),r(e,n),r(n,l),r(n,a),r(e,p),r(e,g),r(g,m),r(g,d),r(e,A),r(e,L),r(L,E),r(L,N),r(L,D),r(L,P),r(L,F),r(e,i),r(e,f),r(f,y),r(e,$),r(e,v),r(v,I),R(O,H,j),X||(U=[Y(y,"click",Q),Y(I,"click",x)],X=!0)},p(O,j){o=O,j&1&&t!==(t=o[17].file_name+"")&&G(a,t),j&1&&s!==(s=o[17].scheme_priority+"")&&G(d,s),j&1&&C!==(C=o[17].authority_name+"")&&G(N,C),j&1&&J!==(J=o[17].authority_code+"")&&G(P,J)},d(O){O&&Z(e),O&&Z(H),X=!1,Se(U)}}}function ge(o){let e=o[2].has(o[17].file_name),n,l,t=e&&$e(o);return{c(){t&&t.c(),n=Oe()},m(a,p){t&&t.m(a,p),R(a,n,p),l=!0},p(a,p){p&5&&(e=a[2].has(a[17].file_name)),e?t?(t.p(a,p),p&5&&k(t,1)):(t=$e(a),t.c(),k(t,1),t.m(n.parentNode,n)):t&&(we(),B(t,1,1,()=>{t=null}),ye())},i(a){l||(k(t),l=!0)},o(a){B(t),l=!1},d(a){t&&t.d(a),a&&Z(n)}}}function Ze(o){let e,n,l,t,a,p,g,m,s,d,A,L,E,C,N,D,J,P,F,i,f,y,$,v,I=o[2].size+"",H,X,U=o[3].route+"",Q,x,O=o[3].area+"",j,ae,ee=o[3].crossing+"",re,ie,te=o[3].other+"",oe,ue,fe,le,z,se,pe;p=new Je({props:{boundaryGeojson:o[4]}}),m=new Ne({props:{label:"Load from GeoJSON",uniqueId:"load_geojson",loadFile:o[6]}});let V=o[0],c=[];for(let u=0;u<V.length;u+=1)c[u]=ge(de(o,V,u));const ke=u=>B(c[u],1,1,()=>{c[u]=null});return{c(){e=h("div"),n=h("button"),n.textContent="Home",l=w(),t=h("h1"),a=_(`Browse schemes
      `),M(p.$$.fragment),g=w(),M(m.$$.fragment),s=w(),d=h("br"),A=w(),L=h("br"),E=w(),C=h("div"),N=h("label"),D=_("Filter by any field: "),J=h("br"),P=w(),F=h("input"),i=w(),f=h("button"),f.textContent="Clear",y=w(),$=h("p"),v=_("Showing "),H=_(I),X=_(" schemes ("),Q=_(U),x=_(" routes, "),j=_(O),ae=_(` areas,
      `),re=_(ee),ie=_(" crossings, "),oe=_(te),ue=_(" other)"),fe=w(),le=h("ul");for(let u=0;u<c.length;u+=1)c[u].c();W(n,"type","button"),W(F,"type","text"),W(f,"type","button"),W(e,"slot","sidebar")},m(u,b){R(u,e,b),r(e,n),r(e,l),r(e,t),r(t,a),q(p,t,null),r(e,g),q(m,e,null),r(e,s),r(e,d),r(e,A),r(e,L),r(e,E),r(e,C),r(C,N),r(N,D),r(N,J),r(N,P),r(N,F),ce(F,o[1]),r(C,i),r(C,f),r(e,y),r(e,$),r($,v),r($,H),r($,X),r($,Q),r($,x),r($,j),r($,ae),r($,re),r($,ie),r($,oe),r($,ue),r(e,fe),r(e,le);for(let K=0;K<c.length;K+=1)c[K].m(le,null);z=!0,se||(pe=[Y(n,"click",o[9]),Y(F,"input",o[10]),Y(f,"click",o[11])],se=!0)},p(u,b){const K={};if(b&16&&(K.boundaryGeojson=u[4]),p.$set(K),b&2&&F.value!==u[1]&&ce(F,u[1]),(!z||b&4)&&I!==(I=u[2].size+"")&&G(H,I),(!z||b&8)&&U!==(U=u[3].route+"")&&G(Q,U),(!z||b&8)&&O!==(O=u[3].area+"")&&G(j,O),(!z||b&8)&&ee!==(ee=u[3].crossing+"")&&G(re,ee),(!z||b&8)&&te!==(te=u[3].other+"")&&G(oe,te),b&389){V=u[0];let S;for(S=0;S<V.length;S+=1){const me=de(u,V,S);c[S]?(c[S].p(me,b),k(c[S],1)):(c[S]=ge(me),c[S].c(),k(c[S],1),c[S].m(le,null))}for(we(),S=V.length;S<c.length;S+=1)ke(S);ye()}},i(u){if(!z){k(p.$$.fragment,u),k(m.$$.fragment,u);for(let b=0;b<V.length;b+=1)k(c[b]);z=!0}},o(u){B(p.$$.fragment,u),B(m.$$.fragment,u),c=c.filter(Boolean);for(let b=0;b<c.length;b+=1)B(c[b]);z=!1},d(u){u&&Z(e),T(p),T(m),Fe(c,u),se=!1,Se(pe)}}}function Ae(o){let e,n,l,t,a,p,g,m;return e=new Ge({props:{schema:be}}),l=new Me({props:{style:o[5]}}),a=new qe({props:{schema:be}}),g=new Te({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:Ue}}),{c(){M(e.$$.fragment),n=w(),M(l.$$.fragment),t=w(),M(a.$$.fragment),p=w(),M(g.$$.fragment)},m(s,d){q(e,s,d),R(s,n,d),q(l,s,d),R(s,t,d),q(a,s,d),R(s,p,d),q(g,s,d),m=!0},p:je,i(s){m||(k(e.$$.fragment,s),k(l.$$.fragment,s),k(a.$$.fragment,s),k(g.$$.fragment,s),m=!0)},o(s){B(e.$$.fragment,s),B(l.$$.fragment,s),B(a.$$.fragment,s),B(g.$$.fragment,s),m=!1},d(s){T(e,s),s&&Z(n),T(l,s),s&&Z(t),T(a,s),s&&Z(p),T(g,s)}}}function De(o){let e,n,l;return n=new ze({props:{style:o[5],$$slots:{default:[Ae]},$$scope:{ctx:o}}}),{c(){e=h("div"),M(n.$$.fragment),W(e,"slot","main")},m(t,a){R(t,e,a),q(n,e,null),l=!0},p(t,a){const p={};a&1048576&&(p.$$scope={dirty:a,ctx:t}),n.$set(p)},i(t){l||(k(n.$$.fragment,t),l=!0)},o(t){B(n.$$.fragment,t),l=!1},d(t){t&&Z(e),T(n)}}}function He(o){let e,n;return e=new Ie({props:{$$slots:{main:[De],sidebar:[Ze]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},m(l,t){q(e,l,t),n=!0},p(l,[t]){const a={};t&1048607&&(a.$$scope={dirty:t,ctx:l}),e.$set(a)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){B(e.$$.fragment,l),n=!1},d(l){T(e,l)}}}const be="v1";function Ue(o){return JSON.stringify(o,null,"  ")}function Ve(o,e,n){let l,t;_e(o,ne,i=>n(4,l=i)),_e(o,Ee,i=>n(14,t=i));let p=new URLSearchParams(window.location.search).get("style")||"streets",g=[],m="",s=new Set,d={area:0,route:0,crossing:0,other:0};Le(()=>{ne.set(null)});function A(i){try{let f=JSON.parse(i);ne.set(f),L(f),t==null||t.fitBounds(he(f),{padding:20,animate:!1})}catch(f){window.alert(`Couldn't load schemes from a file: ${f}`)}}function L(i){var y;let f={};for(let $ of i.features){let v=$.properties;f[y=v.atip_file_name]||(f[y]={file_name:v.atip_file_name,authority_code:v.authority_code,authority_name:v.authority_name,internal_scheme_id:v.internal_scheme_id,scheme_priority:v.scheme_priority,num_features:0}),f[v.atip_file_name].num_features++}n(0,g=Object.values(f))}function E(i){let f={type:"FeatureCollection",features:l.features.filter(y=>y.properties.atip_file_name==i.file_name)};t==null||t.fitBounds(he(f),{padding:20,animate:!1})}function C(i){let f={type:"FeatureCollection",features:l.features.filter($=>$.properties.atip_file_name==i.file_name)},y=i.authority_name;window.localStorage.setItem(y,JSON.stringify(f)),window.open(`scheme.html?authority=${i.authority_name}`,"_blank")}const N=()=>window.open("index.html");function D(){m=this.value,n(1,m)}const J=()=>n(1,m=""),P=i=>E(i),F=i=>C(i);return o.$$.update=()=>{if(o.$$.dirty&31){if(s.clear(),m){let i=m.toLowerCase();for(let f of l.features)JSON.stringify(f.properties).toLowerCase().includes(i)&&s.add(f.properties.atip_file_name)}else for(let i of g)s.add(i.file_name);ne.update(i=>{if(!i)return null;for(let f of i.features)s.has(f.properties.atip_file_name)?delete f.properties.hide_while_editing:f.properties.hide_while_editing=!0;return i}),n(3,d={area:0,route:0,crossing:0,other:0});for(let i of l==null?void 0:l.features)s.has(i.properties.atip_file_name)&&n(3,d[i.properties.intervention_type]++,d);n(2,s),n(1,m),n(4,l),n(0,g),n(3,d)}},[g,m,s,d,l,p,A,E,C,N,D,J,P,F]}class We extends ve{constructor(e){super(),Ce(this,e,Ve,He,Be,{})}}new We({target:document.getElementById("app")});
