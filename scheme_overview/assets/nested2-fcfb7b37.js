import{S as ie,i as re,s as se,d as q,m as z,n as b,o as B,q as M,J as W,R as ae,F as oe,e as $,c as C,t as k,f as A,y as fe,g as T,h as a,j as X,l as V,B as D,V as ee,W as te,p as E,N as ue,r as le,w as K,X as me,G as pe}from"./FileInput-ddab9480.js";import{L as _e,g as U,h as ce,I as he,B as de,i as $e,M as ge,m as ye,C as we}from"./InterventionLayer-0bc57503.js";function Q(i,e,n){const l=i.slice();return l[15]=e[n],l}function Y(i){let e,n;return e=new we({props:{label:`${i[15].internal_scheme_id}: ${i[15].num_features} features`,$$slots:{default:[be]},$$scope:{ctx:i}}}),{c(){q(e.$$.fragment)},m(l,t){z(e,l,t),n=!0},p(l,t){const s={};t&1&&(s.label=`${l[15].internal_scheme_id}: ${l[15].num_features} features`),t&262145&&(s.$$scope={dirty:t,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){B(e.$$.fragment,l),n=!1},d(l){M(e,l)}}}function be(i){let e,n,l,t=i[15].file_name+"",s,m,c,h,r=i[15].scheme_priority+"",g,S,v,L,I=i[15].authority_name+"",j,O,J=i[15].authority_code+"",o,f,w,N,y,F,p,G,u,d,_;function H(){return i[10](i[15])}function ne(){return i[11](i[15])}return{c(){e=$("ul"),n=$("li"),l=k("Filename: "),s=k(t),m=C(),c=$("li"),h=k("Priority: "),g=k(r),S=C(),v=$("li"),L=k("Authority: "),j=k(I),O=k(" ("),o=k(J),f=k(")"),w=C(),N=$("li"),y=$("button"),y.textContent="Show on map",F=C(),p=$("li"),G=$("button"),G.textContent="Edit scheme",u=C(),A(y,"type","button"),A(G,"type","button")},m(P,R){T(P,e,R),a(e,n),a(n,l),a(n,s),a(e,m),a(e,c),a(c,h),a(c,g),a(e,S),a(e,v),a(v,L),a(v,j),a(v,O),a(v,o),a(v,f),a(e,w),a(e,N),a(N,y),a(e,F),a(e,p),a(p,G),T(P,u,R),d||(_=[V(y,"click",H),V(G,"click",ne)],d=!0)},p(P,R){i=P,R&1&&t!==(t=i[15].file_name+"")&&D(s,t),R&1&&r!==(r=i[15].scheme_priority+"")&&D(g,r),R&1&&I!==(I=i[15].authority_name+"")&&D(j,I),R&1&&J!==(J=i[15].authority_code+"")&&D(o,J)},d(P){P&&E(e),P&&E(u),d=!1,le(_)}}}function Z(i){let e=i[2].has(i[15].file_name),n,l,t=e&&Y(i);return{c(){t&&t.c(),n=me()},m(s,m){t&&t.m(s,m),T(s,n,m),l=!0},p(s,m){m&5&&(e=s[2].has(s[15].file_name)),e?t?(t.p(s,m),m&5&&b(t,1)):(t=Y(s),t.c(),b(t,1),t.m(n.parentNode,n)):t&&(ee(),B(t,1,1,()=>{t=null}),te())},i(s){l||(b(t),l=!0)},o(s){B(t),l=!1},d(s){t&&t.d(s),s&&E(n)}}}function Se(i){let e,n,l,t,s,m,c,h,r,g,S,v,L,I,j=i[2].size+"",O,J,o,f,w,N,y;m=new oe({props:{label:"Load from GeoJSON",uniqueId:"load_geojson",loadFile:i[4]}});let F=i[0],p=[];for(let u=0;u<F.length;u+=1)p[u]=Z(Q(i,F,u));const G=u=>B(p[u],1,1,()=>{p[u]=null});return{c(){e=$("div"),n=$("button"),n.textContent="Home",l=C(),t=$("h1"),t.textContent="Browse schemes",s=C(),q(m.$$.fragment),c=C(),h=$("div"),r=$("label"),g=k(`Filter by any field:
        `),S=$("input"),v=C(),L=$("p"),I=k("Showing "),O=k(j),J=k(" schemes"),o=C(),f=$("ul");for(let u=0;u<p.length;u+=1)p[u].c();A(n,"type","button"),A(S,"type","text"),fe(S,"width","100%"),A(e,"slot","sidebar")},m(u,d){T(u,e,d),a(e,n),a(e,l),a(e,t),a(e,s),z(m,e,null),a(e,c),a(e,h),a(h,r),a(r,g),a(r,S),X(S,i[1]),a(e,v),a(e,L),a(L,I),a(L,O),a(L,J),a(e,o),a(e,f);for(let _=0;_<p.length;_+=1)p[_].m(f,null);w=!0,N||(y=[V(n,"click",i[8]),V(S,"input",i[9])],N=!0)},p(u,d){if(d&2&&S.value!==u[1]&&X(S,u[1]),(!w||d&4)&&j!==(j=u[2].size+"")&&D(O,j),d&101){F=u[0];let _;for(_=0;_<F.length;_+=1){const H=Q(u,F,_);p[_]?(p[_].p(H,d),b(p[_],1)):(p[_]=Z(H),p[_].c(),b(p[_],1),p[_].m(f,null))}for(ee(),_=F.length;_<p.length;_+=1)G(_);te()}},i(u){if(!w){b(m.$$.fragment,u);for(let d=0;d<F.length;d+=1)b(p[d]);w=!0}},o(u){B(m.$$.fragment,u),p=p.filter(Boolean);for(let d=0;d<p.length;d+=1)B(p[d]);w=!1},d(u){u&&E(e),M(m),ue(p,u),N=!1,le(y)}}}function ve(i){let e,n,l,t,s,m,c,h;return e=new he({props:{schema:x}}),l=new de({props:{style:i[3]}}),s=new $e({props:{schema:x}}),c=new ge({props:{layers:["interventions-points","interventions-lines","interventions-polygons"],contents:Be}}),{c(){q(e.$$.fragment),n=C(),q(l.$$.fragment),t=C(),q(s.$$.fragment),m=C(),q(c.$$.fragment)},m(r,g){z(e,r,g),T(r,n,g),z(l,r,g),T(r,t,g),z(s,r,g),T(r,m,g),z(c,r,g),h=!0},p:pe,i(r){h||(b(e.$$.fragment,r),b(l.$$.fragment,r),b(s.$$.fragment,r),b(c.$$.fragment,r),h=!0)},o(r){B(e.$$.fragment,r),B(l.$$.fragment,r),B(s.$$.fragment,r),B(c.$$.fragment,r),h=!1},d(r){M(e,r),r&&E(n),M(l,r),r&&E(t),M(s,r),r&&E(m),M(c,r)}}}function ke(i){let e,n,l;return n=new ce({props:{style:i[3],$$slots:{default:[ve]},$$scope:{ctx:i}}}),{c(){e=$("div"),q(n.$$.fragment),A(e,"slot","main")},m(t,s){T(t,e,s),z(n,e,null),l=!0},p(t,s){const m={};s&262144&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(t){l||(b(n.$$.fragment,t),l=!0)},o(t){B(n.$$.fragment,t),l=!1},d(t){t&&E(e),M(n)}}}function Ce(i){let e,n;return e=new _e({props:{$$slots:{main:[ke],sidebar:[Se]},$$scope:{ctx:i}}}),{c(){q(e.$$.fragment)},m(l,t){z(e,l,t),n=!0},p(l,[t]){const s={};t&262151&&(s.$$scope={dirty:t,ctx:l}),e.$set(s)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){B(e.$$.fragment,l),n=!1},d(l){M(e,l)}}}const x="v1";function Be(i){return JSON.stringify(i,null,"  ")}function Le(i,e,n){let l,t;W(i,U,o=>n(7,l=o)),W(i,ye,o=>n(12,t=o));let m=new URLSearchParams(window.location.search).get("style")||"streets",c=[],h="",r=new Set;ae(()=>{U.set(null)});function g(o){try{let f=JSON.parse(o);U.set(f),S(f),t==null||t.fitBounds(K(f),{padding:20,animate:!1})}catch(f){window.alert(`Couldn't load schemes from a file: ${f}`)}}function S(o){var w;let f={};for(let N of o.features){let y=N.properties;f[w=y.atip_file_name]||(f[w]={file_name:y.atip_file_name,authority_code:y.authority_code,authority_name:y.authority_name,internal_scheme_id:y.internal_scheme_id,scheme_priority:y.scheme_priority,num_features:0}),f[y.atip_file_name].num_features++}n(0,c=Object.values(f))}function v(o){let f={type:"FeatureCollection",features:l.features.filter(w=>w.properties.atip_file_name==o.file_name)};t==null||t.fitBounds(K(f),{padding:20,animate:!1})}function L(o){let f={type:"FeatureCollection",features:l.features.filter(N=>N.properties.atip_file_name==o.file_name)},w=o.authority_name;window.localStorage.setItem(w,JSON.stringify(f)),window.open(`scheme.html?authority=${o.authority_name}`,"_blank")}const I=()=>window.open("index.html");function j(){h=this.value,n(1,h)}const O=o=>v(o),J=o=>L(o);return i.$$.update=()=>{if(i.$$.dirty&135){if(r.clear(),h){let o=h.toLowerCase();for(let f of l.features)JSON.stringify(f.properties).toLowerCase().includes(o)&&r.add(f.properties.atip_file_name)}else for(let o of c)r.add(o.file_name);U.update(o=>{for(let f of o.features)r.has(f.properties.atip_file_name)?delete f.properties.hide_while_editing:f.properties.hide_while_editing=!0;return o}),n(2,r),n(1,h),n(7,l),n(0,c)}},[c,h,r,m,g,v,L,l,I,j,O,J]}class Ne extends ie{constructor(e){super(),re(this,e,Le,Ce,se,{})}}new Ne({target:document.getElementById("app")});
