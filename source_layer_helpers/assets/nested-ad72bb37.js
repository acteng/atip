var Wo=Object.defineProperty;var Vo=(r,e,t)=>e in r?Wo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var oe=(r,e,t)=>(Vo(r,typeof e!="symbol"?e+"":e,t),t);import{S as Z,i as Q,s as W,M as Ko,b as ae,a as Ee,d as N,m as B,k as Me,n as $,o as L,q as D,e as E,c as R,g as w,x as H,p as k,y as qe,f as C,z as ce,B as pe,C as Zo,D as yt,E as Sn,F as it,G as et,H as tt,I as nt,J as rt,K as pr,h as S,l as U,L as Qo,N as ei,O as me,P as le,Q as ti,w as Kn,t as K,R as he,j as Le,r as Ce,T as Fe,U as co,V as po,W as Ut,X as mt,Y as rn,Z as hr,_ as ni,$ as ri,a0 as Ie,a1 as oi,a2 as ii,a3 as Tn,a4 as on,a5 as ho,a6 as vt,a7 as ke,a8 as gn,a9 as wt,aa as bn,ab as Nt,ac as yn,ad as Zn,ae as In,af as si,ag as dt,ah as Qn,ai as We,aj as _t,ak as li,al as er,am as ai,an as ui,ao as fi,ap as dr,aq as sn,ar as ci,as as pi,at as hi,A as di,u as mi}from"./authorities-507bf24a.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mo=Symbol("Comlink.proxy"),_i=Symbol("Comlink.endpoint"),gi=Symbol("Comlink.releaseProxy"),En=Symbol("Comlink.finalizer"),Wt=Symbol("Comlink.thrown"),_o=r=>typeof r=="object"&&r!==null||typeof r=="function",bi={canHandle:r=>_o(r)&&r[mo],serialize(r){const{port1:e,port2:t}=new MessageChannel;return tr(r,e),[t,[t]]},deserialize(r){return r.start(),yo(r)}},yi={canHandle:r=>_o(r)&&Wt in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},go=new Map([["proxy",bi],["throw",yi]]);function vi(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function tr(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!vi(t,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:s,path:a}=Object.assign({path:[]},o.data),l=(o.data.argumentList||[]).map(Ze);let u;try{const p=a.slice(0,-1).reduce((c,f)=>c[f],r),m=a.reduce((c,f)=>c[f],r);switch(s){case"GET":u=m;break;case"SET":p[a.slice(-1)[0]]=Ze(o.data.value),u=!0;break;case"APPLY":u=m.apply(p,l);break;case"CONSTRUCT":{const c=new m(...l);u=$i(c)}break;case"ENDPOINT":{const{port1:c,port2:f}=new MessageChannel;tr(r,f),u=Mi(c,[c])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[Wt]:0}}Promise.resolve(u).catch(p=>({value:p,[Wt]:0})).then(p=>{const[m,c]=un(p);e.postMessage(Object.assign(Object.assign({},m),{id:i}),c),s==="RELEASE"&&(e.removeEventListener("message",n),bo(e),En in r&&typeof r[En]=="function"&&r[En]())}).catch(p=>{const[m,c]=un({value:new TypeError("Unserializable return value"),[Wt]:0});e.postMessage(Object.assign(Object.assign({},m),{id:i}),c)})}),e.start&&e.start()}function wi(r){return r.constructor.name==="MessagePort"}function bo(r){wi(r)&&r.close()}function yo(r,e){return Pn(r,[],e)}function Yt(r){if(r)throw new Error("Proxy has been released and is not useable")}function vo(r){return ct(r,{type:"RELEASE"}).then(()=>{bo(r)})}const ln=new WeakMap,an="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(ln.get(r)||0)-1;ln.set(r,e),e===0&&vo(r)});function ki(r,e){const t=(ln.get(e)||0)+1;ln.set(e,t),an&&an.register(r,e,r)}function Si(r){an&&an.unregister(r)}function Pn(r,e=[],t=function(){}){let n=!1;const o=new Proxy(t,{get(i,s){if(Yt(n),s===gi)return()=>{Si(o),vo(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>o};const a=ct(r,{type:"GET",path:e.map(l=>l.toString())}).then(Ze);return a.then.bind(a)}return Pn(r,[...e,s])},set(i,s,a){Yt(n);const[l,u]=un(a);return ct(r,{type:"SET",path:[...e,s].map(p=>p.toString()),value:l},u).then(Ze)},apply(i,s,a){Yt(n);const l=e[e.length-1];if(l===_i)return ct(r,{type:"ENDPOINT"}).then(Ze);if(l==="bind")return Pn(r,e.slice(0,-1));const[u,p]=mr(a);return ct(r,{type:"APPLY",path:e.map(m=>m.toString()),argumentList:u},p).then(Ze)},construct(i,s){Yt(n);const[a,l]=mr(s);return ct(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(Ze)}});return ki(o,r),o}function Ei(r){return Array.prototype.concat.apply([],r)}function mr(r){const e=r.map(un);return[e.map(t=>t[0]),Ei(e.map(t=>t[1]))]}const wo=new WeakMap;function Mi(r,e){return wo.set(r,e),r}function $i(r){return Object.assign(r,{[mo]:!0})}function un(r){for(const[e,t]of go)if(t.canHandle(r)){const[n,o]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:r},wo.get(r)||[]]}function Ze(r){switch(r.type){case"HANDLER":return go.get(r.name).deserialize(r.value);case"RAW":return r.value}}function ct(r,e,t){return new Promise(n=>{const o=Oi();r.addEventListener("message",function i(s){!s.data||!s.data.id||s.data.id!==o||(r.removeEventListener("message",i),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:o},e),t)})}function Oi(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Li(){return new Worker("/atip/source_layer_helpers/assets/worker-a5ef4858.js")}let se;const ko=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ko.decode();let $t=null;function Rt(){return($t===null||$t.byteLength===0)&&($t=new Uint8Array(se.memory.buffer)),$t}function Ot(r,e){return r=r>>>0,ko.decode(Rt().subarray(r,r+e))}const Ge=new Array(128).fill(void 0);Ge.push(void 0,null,!0,!1);let Tt=Ge.length;function _e(r){Tt===Ge.length&&Ge.push(Ge.length+1);const e=Tt;return Tt=Ge[e],Ge[e]=r,e}function X(r){return Ge[r]}let ot=0;const Vt=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Ci=typeof Vt.encodeInto=="function"?function(r,e){return Vt.encodeInto(r,e)}:function(r,e){const t=Vt.encode(r);return e.set(t),{read:r.length,written:t.length}};function Mn(r,e,t){if(t===void 0){const a=Vt.encode(r),l=e(a.length)>>>0;return Rt().subarray(l,l+a.length).set(a),ot=a.length,l}let n=r.length,o=e(n)>>>0;const i=Rt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;i[o+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),o=t(o,n,n=s+r.length*3)>>>0;const a=Rt().subarray(o+s,o+n),l=Ci(r,a);s+=l.written}return ot=s,o}function St(r){return r==null}let Lt=null;function we(){return(Lt===null||Lt.byteLength===0)&&(Lt=new Int32Array(se.memory.buffer)),Lt}function Ai(r){r<132||(Ge[r]=Tt,Tt=r)}function Fn(r){const e=X(r);return Ai(r),e}let Ct=null;function Ri(){return(Ct===null||Ct.byteLength===0)&&(Ct=new Float64Array(se.memory.buffer)),Ct}let At=null;function Ti(){return(At===null||At.byteLength===0)&&(At=new BigInt64Array(se.memory.buffer)),At}function xn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let i="[";o>0&&(i+=xn(r[0]));for(let s=1;s<o;s++)i+=", "+xn(r[s]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ii(r,e){const t=e(r.length*1)>>>0;return Rt().set(r,t/1),ot=r.length,t}function $n(r,e){try{return r.apply(this,e)}catch(t){se.__wbindgen_exn_store(_e(t))}}let Nn=class{static __wrap(e){e=e>>>0;const t=Object.create(Nn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();se.__wbg_routeinfo_free(e)}constructor(e){try{const i=se.__wbindgen_add_to_stack_pointer(-16),s=Ii(e,se.__wbindgen_malloc),a=ot;se.routeinfo_new(i,s,a);var t=we()[i/4+0],n=we()[i/4+1],o=we()[i/4+2];if(o)throw Fn(n);return Nn.__wrap(t)}finally{se.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const p=se.__wbindgen_add_to_stack_pointer(-16);se.routeinfo_nameForRoute(p,this.__wbg_ptr,_e(e));var o=we()[p/4+0],i=we()[p/4+1],s=we()[p/4+2],a=we()[p/4+3],l=o,u=i;if(a)throw l=0,u=0,Fn(s);return t=l,n=u,Ot(l,u)}finally{se.__wbindgen_add_to_stack_pointer(16),se.__wbindgen_free(t,n)}}};async function Pi(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Fi(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Ot(e,t);return _e(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=X(t),o=typeof n=="string"?n:void 0;var i=St(o)?0:Mn(o,se.__wbindgen_malloc,se.__wbindgen_realloc),s=ot;we()[e/4+1]=s,we()[e/4+0]=i},r.wbg.__wbindgen_object_drop_ref=function(e){Fn(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Ot(e,t));return _e(n)},r.wbg.__wbindgen_boolean_get=function(e){const t=X(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof X(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return _e(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return X(e)===X(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=X(t),o=typeof n=="number"?n:void 0;Ri()[e/8+1]=St(o)?0:o,we()[e/4+0]=!St(o)},r.wbg.__wbindgen_is_object=function(e){const t=X(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return X(e)in X(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return _e(t)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return X(e)==X(t)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return _e(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=X(t).stack,o=Mn(n,se.__wbindgen_malloc,se.__wbindgen_realloc),i=ot;we()[e/4+1]=i,we()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(Ot(e,t))}finally{se.__wbindgen_free(n,o)}},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(X(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=X(e)[t>>>0];return _e(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return X(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof X(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=X(e).next;return _e(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return $n(function(e){const t=X(e).next();return _e(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return X(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=X(e).value;return _e(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return _e(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return $n(function(e,t){const n=Reflect.get(X(e),X(t));return _e(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return $n(function(e,t){const n=X(e).call(X(t));return _e(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(X(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=X(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(X(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(X(e));return _e(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=X(e).buffer;return _e(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(X(e));return _e(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){X(e).set(X(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return X(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=X(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=X(t),o=typeof n=="bigint"?n:void 0;Ti()[e/8+1]=St(o)?BigInt(0):o,we()[e/4+0]=!St(o)},r.wbg.__wbindgen_debug_string=function(e,t){const n=xn(X(t)),o=Mn(n,se.__wbindgen_malloc,se.__wbindgen_realloc),i=ot;we()[e/4+1]=i,we()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Ot(e,t))},r.wbg.__wbindgen_memory=function(){const e=se.memory;return _e(e)},r}function xi(r,e){return se=r.exports,So.__wbindgen_wasm_module=e,At=null,Ct=null,Lt=null,$t=null,se}async function So(r){if(se!==void 0)return se;typeof r>"u"&&(r="/atip/source_layer_helpers/assets/route_info_bg.wasm");const e=Fi();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Pi(await r,e);return xi(t,n)}class Ni{constructor(){oe(this,"inner");this.inner=null}async loadFile(e){await So(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new Nn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.nameForRoute(e)}}tr(Ni);function Bi(r){let e,t,n,o,i,s,a,l,u,p,m,c,f;return{c(){e=E("p"),e.textContent="For each intervention:",t=R(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,o=R(),i=E("p"),i.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=R(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=R(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=R(),m=E("p"),m.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=R(),f=E("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(d,g){w(d,e,g),w(d,t,g),w(d,n,g),w(d,o,g),w(d,i,g),w(d,s,g),w(d,a,g),w(d,l,g),w(d,u,g),w(d,p,g),w(d,m,g),w(d,c,g),w(d,f,g)},p:H,d(d){d&&k(e),d&&k(t),d&&k(n),d&&k(o),d&&k(i),d&&k(s),d&&k(a),d&&k(l),d&&k(u),d&&k(p),d&&k(m),d&&k(c),d&&k(f)}}}function Di(r){let e,t,n;function o(s){r[1](s)}let i={title:"Instructions",$$slots:{default:[Bi]},$$scope:{ctx:r}};return r[0]!==void 0&&(i.open=r[0]),e=new Ko({props:i}),ae.push(()=>Ee(e,"open",o,r[0])),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function ji(r,e,t){let{open:n}=e;function o(i){n=i,t(0,n)}return r.$$set=i=>{"open"in i&&t(0,n=i.open)},[n,o]}class qi extends Z{constructor(e){super(),Q(this,e,ji,Di,W,{open:0})}}const st=[];function kt(r,e=H){let t;const n=new Set;function o(a){if(W(r,a)&&(r=a,t)){const l=!st.length;for(const u of n)u[1](),st.push(u,r);if(l){for(let u=0;u<st.length;u+=2)st[u][0](st[u+1]);st.length=0}}}function i(a){o(a(r))}function s(a,l=H){const u=[a,l];return n.add(u),n.size===1&&(t=e(o)||H),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:o,update:i,subscribe:s}}const Ae=kt(null),te=kt(qe()),Se=kt(null),De=kt(null),Bt=kt(null),Dt=kt(null);function Gt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function _r(r){console.log(`Deleting intervention ${r}`),te.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Se.set(null),De.set(null),Bt.set(null),Dt.set(null)}function gr(r){let e;const t=r[4].default,n=et(t,r,r[3],null);return{c(){n&&n.c()},m(o,i){n&&n.m(o,i),e=!0},p(o,i){n&&n.p&&(!e||i&8)&&tt(n,t,o,o[3],e?rt(t,o[3],i,null):nt(o[3]),null)},i(o){e||($(n,o),e=!0)},o(o){L(n,o),e=!1},d(o){n&&n.d(o)}}}function Ui(r){let e,t,n=r[1]&&gr(r);return{c(){e=E("div"),n&&n.c(),C(e,"class","map svelte-12dpf1u")},m(o,i){w(o,e,i),n&&n.m(e,null),r[5](e),t=!0},p(o,[i]){o[1]?n?(n.p(o,i),i&2&&$(n,1)):(n=gr(o),n.c(),$(n,1),n.m(e,null)):n&&(ce(),L(n,1,1,()=>{n=null}),pe())},i(o){t||($(n),t=!0)},o(o){L(n),t=!1},d(o){o&&k(e),n&&n.d(),r[5](null)}}}function Gi(r,e,t){let{$$slots:n={},$$scope:o}=e,{style:i}=e,s,a,l=!1;Zo("setCamera",!window.location.hash),yt(()=>{s=new Sn.Map({container:a,style:`https://api.maptiler.com/maps/${i}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new Sn.ScaleControl({})),s.addControl(new Sn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ae.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),it(()=>{s.remove()});function u(p){ae[p?"unshift":"push"](()=>{a=p,t(0,a)})}return r.$$set=p=>{"style"in p&&t(2,i=p.style),"$$scope"in p&&t(3,o=p.$$scope)},[a,l,i,o,n,u]}class Hi extends Z{constructor(e){super(),Q(this,e,Gi,Ui,W,{style:2})}}const zi=r=>({}),br=r=>({}),Yi=r=>({}),yr=r=>({}),Ji=r=>({}),vr=r=>({});function Xi(r){let e,t,n,o,i,s,a,l,u,p,m,c;const f=r[3].nav,d=et(f,r,r[2],vr),g=r[3].sidebar,_=et(g,r,r[2],yr),y=r[3].main,h=et(y,r,r[2],br);return{c(){e=E("aside"),t=E("div"),n=E("nav"),d&&d.c(),o=R(),_&&_.c(),i=R(),s=E("button"),s.textContent="→",l=R(),u=E("main"),h&&h.c(),C(n,"class","svelte-1u7vg8a"),C(t,"class","sidebar-content content-container svelte-1u7vg8a"),C(s,"type","button"),C(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),C(e,"class",a=pr(r[0]?"":"collapsed")+" svelte-1u7vg8a"),C(u,"class","svelte-1u7vg8a")},m(b,v){w(b,e,v),S(e,t),S(t,n),d&&d.m(n,null),S(t,o),_&&_.m(t,null),S(e,i),S(e,s),w(b,l,v),w(b,u,v),h&&h.m(u,null),p=!0,m||(c=U(s,"click",r[1]),m=!0)},p(b,[v]){d&&d.p&&(!p||v&4)&&tt(d,f,b,b[2],p?rt(f,b[2],v,Ji):nt(b[2]),vr),_&&_.p&&(!p||v&4)&&tt(_,g,b,b[2],p?rt(g,b[2],v,Yi):nt(b[2]),yr),(!p||v&1&&a!==(a=pr(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&C(e,"class",a),h&&h.p&&(!p||v&4)&&tt(h,y,b,b[2],p?rt(y,b[2],v,zi):nt(b[2]),br)},i(b){p||($(d,b),$(_,b),$(h,b),p=!0)},o(b){L(d,b),L(_,b),L(h,b),p=!1},d(b){b&&k(e),d&&d.d(b),_&&_.d(b),b&&k(l),b&&k(u),h&&h.d(b),m=!1,c()}}}function Wi(r,e,t){let{$$slots:n={},$$scope:o}=e,i=!0;function s(){t(0,i=!i)}return r.$$set=a=>{"$$scope"in a&&t(2,o=a.$$scope)},[i,s,o,n]}class Vi extends Z{constructor(e){super(),Q(this,e,Wi,Xi,W,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Ki(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,o=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){t.label=u[1];break}if(u[0]===6&&t.label<i[1]){t.label=i[1],i=u;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(u);break}i[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ke=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function Zi(r,e){return r>e?1:r<e?-1:0}function ze(r,e,t){for(var n=new Ke(null,null),o=n,i=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}i.left=e,i=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}o.right=e,o=e,e=e.right}else break}return o.right=e.left,i.left=e.right,e.left=n.right,e.right=n.left,e}function On(r,e,t,n){var o=new Ke(r,e);if(t===null)return o.left=o.right=null,o;t=ze(r,t,n);var i=n(r,t.key);return i<0?(o.left=t.left,o.right=t,t.left=null):i>=0&&(o.right=t.right,o.left=t,t.right=null),o}function wr(r,e,t){var n=null,o=null;if(e){e=ze(r,e,t);var i=t(e.key,r);i===0?(n=e.left,o=e.right):i<0?(o=e.right,e.right=null,n=e):(n=e.left,e.left=null,o=e)}return{left:n,right:o}}function Qi(r,e,t){return e===null?r:(r===null||(e=ze(r.key,e,t),e.left=r),e)}function Bn(r,e,t,n,o){if(r){n(""+e+(t?"└── ":"├── ")+o(r)+`
`);var i=e+(t?"    ":"│   ");r.left&&Bn(r.left,i,!1,n,o),r.right&&Bn(r.right,i,!0,n,o)}}var nr=function(){function r(e){e===void 0&&(e=Zi),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=On(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ke(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var o=this._comparator,i=ze(e,this._root,o),s=o(e,i.key);return s===0?this._root=i:(s<0?(n.left=i.left,n.right=i,i.left=null):s>0&&(n.right=i.right,n.left=i,i.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var o;if(t===null)return null;t=ze(e,t,n);var i=n(e,t.key);return i===0?(t.left===null?o=t.right:(o=ze(e,t.left,n),o.right=t.right),this._size--,o):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ze(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return t;o<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ze(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return!0;o<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,o=[],i=!1;!i;)n!==null?(o.push(n),n=n.left):o.length!==0?(n=o.pop(),e.call(t,n),n=n.right):i=!0;return this},r.prototype.range=function(e,t,n,o){for(var i=[],s=this._comparator,a=this._root,l;i.length!==0||a;)if(a)i.push(a),a=a.left;else{if(a=i.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(o,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,o=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),o===e)return t;o++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var o=this._comparator;t;){var i=o(e.key,t.key);if(i===0)break;i<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var o=this._comparator;t;){var i=o(e.key,t.key);if(i===0)break;i<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return ts(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var o=e.length,i=this._comparator;if(n&&qn(e,t,0,o-1,i),this._root===null)this._root=Dn(e,t,0,o),this._size=o;else{var s=ns(this.toList(),es(e,t),i);o=this._size+o,this._root=jn({head:s},0,o)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Bn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var o=this._comparator,i=wr(e,this._root,o),s=i.left,a=i.right;o(e,t)<0?a=On(t,n,a,o):s=On(t,n,s,o),this._root=Qi(s,a,o)},r.prototype.split=function(e){return wr(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return Ki(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Dn(r,e,t,n){var o=n-t;if(o>0){var i=t+Math.floor(o/2),s=r[i],a=e[i],l=new Ke(s,a);return l.left=Dn(r,e,t,i),l.right=Dn(r,e,i+1,n),l}return null}function es(r,e){for(var t=new Ke(null,null),n=t,o=0;o<r.length;o++)n=n.next=new Ke(r[o],e[o]);return n.next=null,t.next}function ts(r){for(var e=r,t=[],n=!1,o=new Ke(null,null),i=o;!n;)e?(t.push(e),e=e.left):t.length>0?(e=i=i.next=t.pop(),e=e.right):n=!0;return i.next=null,o.next}function jn(r,e,t){var n=t-e;if(n>0){var o=e+Math.floor(n/2),i=jn(r,e,o),s=r.head;return s.left=i,r.head=r.head.next,s.right=jn(r,o+1,t),s}return null}function ns(r,e,t){for(var n=new Ke(null,null),o=n,i=r,s=e;i!==null&&s!==null;)t(i.key,s.key)<0?(o.next=i,i=i.next):(o.next=s,s=s.next),o=o.next;return i!==null?o.next=i:s!==null&&(o.next=s),n.next}function qn(r,e,t,n,o){if(!(t>=n)){for(var i=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(o(r[s],i)<0);do a--;while(o(r[a],i)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}qn(r,e,t,a,o),qn(r,e,a+1,n,o)}}function Re(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function kr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function $e(r,e,t){return e&&kr(r.prototype,e),t&&kr(r,t),r}var Et=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Un=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,o=e.ur.x<t.ur.x?e.ur.x:t.ur.x,i=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:i},ur:{x:o,y:s}}},Je=Number.EPSILON;Je===void 0&&(Je=Math.pow(2,-52));var rs=Je*Je,Gn=function(e,t){if(-Je<e&&e<Je&&-Je<t&&t<Je)return 0;var n=e-t;return n*n<rs*e*t?0:e<t?-1:1},os=function(){function r(){Re(this,r),this.reset()}return $e(r,[{key:"reset",value:function(){this.xRounder=new Sr,this.yRounder=new Sr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Sr=function(){function r(){Re(this,r),this.tree=new nr,this.round(0)}return $e(r,[{key:"round",value:function(t){var n=this.tree.add(t),o=this.tree.prev(n);if(o!==null&&Gn(n.key,o.key)===0)return this.tree.remove(t),o.key;var i=this.tree.next(n);return i!==null&&Gn(n.key,i.key)===0?(this.tree.remove(t),i.key):t}}]),r}(),jt=new os,It=function(e,t){return e.x*t.y-e.y*t.x},Eo=function(e,t){return e.x*t.x+e.y*t.y},Er=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y},s=It(o,i);return Gn(s,0)},fn=function(e){return Math.sqrt(Eo(e,e))},is=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return It(i,o)/fn(i)/fn(o)},ss=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return Eo(i,o)/fn(i)/fn(o)},Mr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},$r=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},ls=function(e,t,n,o){if(t.x===0)return $r(n,o,e.x);if(o.x===0)return $r(e,t,n.x);if(t.y===0)return Mr(n,o,e.y);if(o.y===0)return Mr(e,t,n.y);var i=It(t,o);if(i==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=It(s,t)/i,l=It(s,o)/i,u=e.x+l*t.x,p=n.x+a*o.x,m=e.y+l*t.y,c=n.y+a*o.y,f=(u+p)/2,d=(m+c)/2;return{x:f,y:d}},Be=function(){$e(r,null,[{key:"compare",value:function(t,n){var o=r.comparePoints(t.point,n.point);return o!==0?o:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:cn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Re(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return $e(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,o=0,i=n.length;o<i;o++){var s=n[o];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var o=this.point.events[n];if(o.segment.consumedBy===void 0)for(var i=n+1;i<t;i++){var s=this.point.events[i];s.consumedBy===void 0&&o.otherSE.point.events===s.otherSE.point.events&&o.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,o=this.point.events.length;n<o;n++){var i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,o=new Map,i=function(a){var l=a.otherSE;o.set(a,{sine:is(n.point,t.point,l.point),cosine:ss(n.point,t.point,l.point)})};return function(s,a){o.has(s)||i(s),o.has(a)||i(a);var l=o.get(s),u=l.sine,p=l.cosine,m=o.get(a),c=m.sine,f=m.cosine;return u>=0&&c>=0?p<f?1:p>f?-1:0:u<0&&c<0?p<f?-1:p>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),as=0,cn=function(){$e(r,null,[{key:"compare",value:function(t,n){var o=t.leftSE.point.x,i=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<o)return 1;if(s<i)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,m=n.rightSE.point.y;if(o<i){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(o>i){if(l<u&&l<m)return-1;if(l>u&&l>m)return 1;var d=n.comparePoint(t.leftSE.point);if(d!==0)return d;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>a){var y=t.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(s!==a){var h=p-l,b=s-o,v=m-u,M=a-i;if(h>b&&v<M)return 1;if(h<b&&v>M)return-1}return s>a?1:s<a||p<m?-1:p>m?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,o){Re(this,r),this.id=++as,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=o}return $e(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,o=this.rightSE.point,i=this.vector();if(n.x===o.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/i.y,a=n.x+s*i.x;if(t.x===a)return 0;var l=(t.x-n.x)/i.x,u=n.y+l*i.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),o=t.bbox(),i=Un(n,o);if(i===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=Et(n,l)&&this.comparePoint(l)===0,m=Et(o,s)&&t.comparePoint(s)===0,c=Et(n,u)&&this.comparePoint(u)===0,f=Et(o,a)&&t.comparePoint(a)===0;if(m&&p)return f&&!c?a:!f&&c?u:null;if(m)return c&&s.x===u.x&&s.y===u.y?null:s;if(p)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var d=ls(s,this.vector(),l,t.vector());return d===null||!Et(i,d)?null:jt.round(d.x,d.y)}},{key:"split",value:function(t){var n=[],o=t.events!==void 0,i=new Be(t,!0),s=new Be(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(i);var l=new r(i,a,this.rings.slice(),this.windings.slice());return Be.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Be.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(i.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,o=this.windings.length;n<o;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,o=t;n.consumedBy;)n=n.consumedBy;for(;o.consumedBy;)o=o.consumedBy;var i=r.compare(n,o);if(i!==0){if(i>0){var s=n;n=o,o=s}if(n.prev===o){var a=n;n=o,o=a}for(var l=0,u=o.rings.length;l<u;l++){var p=o.rings[l],m=o.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(m)):n.windings[c]+=m}o.rings=null,o.windings=null,o.consumedBy=n,o.leftSE.consumedBy=n.leftSE,o.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,o=this._afterState.windings,i=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),o.push(u)):o[p]+=u}for(var m=[],c=[],f=0,d=n.length;f<d;f++)if(o[f]!==0){var g=n[f],_=g.poly;if(c.indexOf(_)===-1)if(g.isExterior)m.push(_);else{c.indexOf(_)===-1&&c.push(_);var y=m.indexOf(g.poly);y!==-1&&m.splice(y,1)}}for(var h=0,b=m.length;h<b;h++){var v=m[h].multiPoly;i.indexOf(v)===-1&&i.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Pe.type){case"union":{var o=t.length===0,i=n.length===0;this._isInResult=o!==i;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Pe.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(m){return m.length===1&&m[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Pe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,o){var i,s,a,l=Be.comparePoints(t,n);if(l<0)i=t,s=n,a=1;else if(l>0)i=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Be(i,!0),p=new Be(s,!1);return new r(u,p,[o],[a])}}]),r}(),Or=function(){function r(e,t,n){if(Re(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=jt.round(e[0][0],e[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var i=o,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=jt.round(e[s][0],e[s][1]);l.x===i.x&&l.y===i.y||(this.segments.push(cn.fromRing(i,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),i=l)}(o.x!==i.x||o.y!==i.y)&&this.segments.push(cn.fromRing(i,o,this))}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,o=this.segments.length;n<o;n++){var i=this.segments[n];t.push(i.leftSE),t.push(i.rightSE)}return t}}]),r}(),us=function(){function r(e,t){if(Re(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Or(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,o=e.length;n<o;n++){var i=new Or(e[n],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,o=this.interiorRings.length;n<o;n++)for(var i=this.interiorRings[n].getSweepEvents(),s=0,a=i.length;s<a;s++)t.push(i[s]);return t}}]),r}(),Lr=function(){function r(e,t){if(Re(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,o=e.length;n<o;n++){var i=new us(e[n],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,o=this.polys.length;n<o;n++)for(var i=this.polys[n].getSweepEvents(),s=0,a=i.length;s<a;s++)t.push(i[s]);return t}}]),r}(),fs=function(){$e(r,null,[{key:"factory",value:function(t){for(var n=[],o=0,i=t.length;o<i;o++){var s=t[o];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],m=l.point,c=[];a=l,l=u,p.push(l),l.point!==m;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var d=p[0].point,g=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var _=null,y=0,h=c.length;y<h;y++)if(c[y].point===l.point){_=y;break}if(_!==null){var b=c.splice(_)[0],v=p.splice(b.index);v.unshift(v[0].otherSE),n.push(new r(v.reverse()));continue}c.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Re(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return $e(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],o=1,i=this.events.length-1;o<i;o++){var s=this.events[o].point,a=this.events[o+1].point;Er(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Er(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],d=m;d!=c;d+=p)f.push([n[d].x,n[d].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,o=this.events.length;n<o;n++){var i=this.events[n];Be.compare(t,i)>0&&(t=i)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Cr=function(){function r(e){Re(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return $e(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,o=this.interiorRings.length;n<o;n++){var i=this.interiorRings[n].getGeom();i!==null&&t.push(i)}return t}}]),r}(),cs=function(){function r(e){Re(this,r),this.rings=e,this.polys=this._composePolys(e)}return $e(r,[{key:"getGeom",value:function(){for(var t=[],n=0,o=this.polys.length;n<o;n++){var i=this.polys[n].getGeom();i!==null&&t.push(i)}return t}},{key:"_composePolys",value:function(t){for(var n=[],o=0,i=t.length;o<i;o++){var s=t[o];if(!s.poly)if(s.isExteriorRing())n.push(new Cr(s));else{var a=s.enclosingRing();a.poly||n.push(new Cr(a)),a.poly.addInterior(s)}}return n}}]),r}(),ps=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:cn.compare;Re(this,r),this.queue=e,this.tree=new nr(t),this.segments=[]}return $e(r,[{key:"process",value:function(t){var n=t.segment,o=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),o;var i=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!i)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=i,a=i,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var m=l.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(p=m),!l.isAnEndpoint(m)))for(var c=this._splitSafely(l,m),f=0,d=c.length;f<d;f++)o.push(c[f])}var g=null;if(u){var _=u.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(g=_),!u.isAnEndpoint(_)))for(var y=this._splitSafely(u,_),h=0,b=y.length;h<b;h++)o.push(y[h])}if(p!==null||g!==null){var v=null;if(p===null)v=g;else if(g===null)v=p;else{var M=Be.comparePoints(p,g);v=M<=0?p:g}this.queue.remove(n.rightSE),o.push(n.rightSE);for(var O=n.split(v),I=0,A=O.length;I<A;I++)o.push(O[I])}o.length>0?(this.tree.remove(n),o.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var F=l.getIntersection(u);if(F!==null){if(!l.isAnEndpoint(F))for(var T=this._splitSafely(l,F),j=0,V=T.length;j<V;j++)o.push(T[j]);if(!u.isAnEndpoint(F))for(var P=this._splitSafely(u,F),z=0,ie=P.length;z<ie;z++)o.push(P[z])}}this.tree.remove(n)}return o}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var o=t.rightSE;this.queue.remove(o);var i=t.split(n);return i.push(o),t.consumedBy===void 0&&this.tree.insert(t),i}}]),r}(),Ar=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,hs=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ds=function(){function r(){Re(this,r)}return $e(r,[{key:"run",value:function(t,n,o){Pe.type=t,jt.reset();for(var i=[new Lr(n,!0)],s=0,a=o.length;s<a;s++)i.push(new Lr(o[s],!1));if(Pe.numMultiPolys=i.length,Pe.type==="difference")for(var l=i[0],u=1;u<i.length;)Un(i[u].bbox,l.bbox)!==null?u++:i.splice(u,1);if(Pe.type==="intersection"){for(var p=0,m=i.length;p<m;p++)for(var c=i[p],f=p+1,d=i.length;f<d;f++)if(Un(c.bbox,i[f].bbox)===null)return[]}for(var g=new nr(Be.compare),_=0,y=i.length;_<y;_++)for(var h=i[_].getSweepEvents(),b=0,v=h.length;b<v;b++)if(g.insert(h[b]),g.size>Ar)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new ps(g),O=g.size,I=g.pop();I;){var A=I.key;if(g.size===O){var F=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(F.id," ")+"[".concat(F.leftSE.point.x,", ").concat(F.leftSE.point.y,"] -> ")+"[".concat(F.rightSE.point.x,", ").concat(F.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Ar)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>hs)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var T=M.process(A),j=0,V=T.length;j<V;j++){var P=T[j];P.consumedBy===void 0&&g.insert(P)}O=g.size,I=g.pop()}jt.reset();var z=fs.factory(M.segments),ie=new cs(z);return ie.getGeom()}}]),r}(),Pe=new ds,ms=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Pe.run("union",e,n)},_s=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Pe.run("intersection",e,n)},gs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Pe.run("xor",e,n)},bs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Pe.run("difference",e,n)},Kt={union:ms,intersection:_s,xor:gs,difference:bs};function Rr(r,e){var t=vs(e),n=null;return r.type==="FeatureCollection"?n=ys(r):n=Mo(Kt.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(o){t.geometry.coordinates.push(o[0])}),t}function ys(r){var e=r.features.length===2?Kt.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):Kt.union.apply(Kt,r.features.map(function(t){return t.geometry.coordinates}));return Mo(e)}function Mo(r){return Qo(r)}function vs(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return ei(t)}const ws=r=>({source:r&1}),Tr=r=>({source:r[0]});function Ir(r){let e;const t=r[4].default,n=et(t,r,r[3],Tr);return{c(){n&&n.c()},m(o,i){n&&n.m(o,i),e=!0},p(o,i){n&&n.p&&(!e||i&9)&&tt(n,t,o,o[3],e?rt(t,o[3],i,ws):nt(o[3]),Tr)},i(o){e||($(n,o),e=!0)},o(o){L(n,o),e=!1},d(o){n&&n.d(o)}}}function ks(r){let e,t,n=r[1]&&Ir(r);return{c(){n&&n.c(),e=me()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[1]?n?(n.p(o,i),i&2&&$(n,1)):(n=Ir(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ce(),L(n,1,1,()=>{n=null}),pe())},i(o){t||($(n),t=!0)},o(o){L(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}function Ss(r,e,t){let n;le(r,Ae,u=>t(5,n=u));let{$$slots:o={},$$scope:i}=e,{id:s}=e,{data:a}=e,l=!1;return yt(()=>{console.log(`adding source ${s}`),n.addSource(s,{type:"geojson",data:a}),t(1,l=!0)}),it(()=>{console.log(`removing source ${s}`),n.removeSource(s)}),r.$$set=u=>{"id"in u&&t(0,s=u.id),"data"in u&&t(2,a=u.data),"$$scope"in u&&t(3,i=u.$$scope)},[s,l,a,i,o]}class Es extends Z{constructor(e){super(),Q(this,e,Ss,ks,W,{id:0,data:2})}}function Ms(r,e,t){let n;le(r,Ae,l=>t(4,n=l));let{id:o}=e,{source:i}=e,{color:s}=e,{opacity:a}=e;return yt(()=>{console.log(`adding layer ${o} under source ${i}`),n.addLayer({id:o,source:i,type:"fill",paint:{"fill-color":s,"fill-opacity":a}})}),it(()=>{console.log(`removing layer ${o} under source ${i}`),n.removeLayer(o)}),r.$$set=l=>{"id"in l&&t(0,o=l.id),"source"in l&&t(1,i=l.source),"color"in l&&t(2,s=l.color),"opacity"in l&&t(3,a=l.opacity)},[o,i,s,a]}class $s extends Z{constructor(e){super(),Q(this,e,Ms,null,W,{id:0,source:1,color:2,opacity:3})}}function Os(r){let e,t;return e=new $s({props:{id:"boundary",source:"boundary",color:"black",opacity:.5}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p:H,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ls(r){let e,t;return e=new Es({props:{id:"boundary",data:Rr(r[0]),$$slots:{default:[Os]},$$scope:{ctx:r}}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,[o]){const i={};o&1&&(i.data=Rr(n[0])),o&8&&(i.$$scope={dirty:o,ctx:n}),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Cs(r,e,t){let n;le(r,Ae,s=>t(1,n=s));let{boundaryGeojson:o}=e;return ti("setCamera")&&n.fitBounds(Kn(o),{padding:20,animate:!1}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,o=s.boundaryGeojson)},[o]}class As extends Z{constructor(e){super(),Q(this,e,Cs,Ls,W,{boundaryGeojson:0})}}function Pr(r){let e,t=Fr(r[3])+"",n,o,i,s,a,l;return{c(){e=K("Length: "),n=K(t),o=R(),i=E("br"),s=E("button"),s.textContent="Auto-fill details",C(s,"type","button")},m(u,p){w(u,e,p),w(u,n,p),w(u,o,p),w(u,i,p),w(u,s,p),a||(l=U(s,"click",r[14]),a=!0)},p(u,p){p&8&&t!==(t=Fr(u[3])+"")&&Fe(n,t)},d(u){u&&k(e),u&&k(n),u&&k(o),u&&k(i),u&&k(s),a=!1,l()}}}function Rs(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,g,_,y,h,b,v,M,O,I,A,F,T,j,V,P,z,ie,ve,Te,re,ne,xe,Oe,ee,de,ye=r[3]&&Pr(r);return{c(){e=E("label"),t=K("Name:"),n=E("br"),o=R(),i=E("input"),s=R(),a=E("br"),l=R(),u=E("br"),p=R(),m=E("label"),c=E("input"),f=K(`
  Area`),d=R(),g=E("label"),_=E("input"),y=K(`
  Route`),h=R(),b=E("label"),v=E("input"),M=K(`
  Crossing`),O=R(),I=E("label"),A=E("input"),F=K(`
  Other`),T=R(),j=E("br"),V=R(),P=E("br"),z=R(),ie=E("label"),ve=K("Description:"),Te=E("br"),re=R(),ne=E("textarea"),xe=R(),ye&&ye.c(),Oe=me(),C(i,"type","text"),he(i,"width","100%"),C(c,"type","radio"),c.__value="area",c.value=c.__value,r[9][0].push(c),C(_,"type","radio"),_.__value="route",_.value=_.__value,r[9][0].push(_),C(v,"type","radio"),v.__value="crossing",v.value=v.__value,r[9][0].push(v),C(A,"type","radio"),A.__value="other",A.value=A.__value,r[9][0].push(A),he(ne,"width","100%"),C(ne,"rows","5"),C(ne,"class","svelte-15lna0i")},m(x,G){w(x,e,G),S(e,t),S(e,n),S(e,o),S(e,i),Le(i,r[0]),w(x,s,G),w(x,a,G),w(x,l,G),w(x,u,G),w(x,p,G),w(x,m,G),S(m,c),c.checked=c.__value===r[1],S(m,f),w(x,d,G),w(x,g,G),S(g,_),_.checked=_.__value===r[1],S(g,y),w(x,h,G),w(x,b,G),S(b,v),v.checked=v.__value===r[1],S(b,M),w(x,O,G),w(x,I,G),S(I,A),A.checked=A.__value===r[1],S(I,F),w(x,T,G),w(x,j,G),w(x,V,G),w(x,P,G),w(x,z,G),w(x,ie,G),S(ie,ve),S(ie,Te),S(ie,re),S(ie,ne),Le(ne,r[2]),w(x,xe,G),ye&&ye.m(x,G),w(x,Oe,G),ee||(de=[U(i,"input",r[7]),U(c,"change",r[8]),U(_,"change",r[10]),U(v,"change",r[11]),U(A,"change",r[12]),U(ne,"input",r[13])],ee=!0)},p(x,[G]){G&1&&i.value!==x[0]&&Le(i,x[0]),G&2&&(c.checked=c.__value===x[1]),G&2&&(_.checked=_.__value===x[1]),G&2&&(v.checked=v.__value===x[1]),G&2&&(A.checked=A.__value===x[1]),G&4&&Le(ne,x[2]),x[3]?ye?ye.p(x,G):(ye=Pr(x),ye.c(),ye.m(Oe.parentNode,Oe)):ye&&(ye.d(1),ye=null)},i:H,o:H,d(x){x&&k(e),x&&k(s),x&&k(a),x&&k(l),x&&k(u),x&&k(p),x&&k(m),r[9][0].splice(r[9][0].indexOf(c),1),x&&k(d),x&&k(g),r[9][0].splice(r[9][0].indexOf(_),1),x&&k(h),x&&k(b),r[9][0].splice(r[9][0].indexOf(v),1),x&&k(O),x&&k(I),r[9][0].splice(r[9][0].indexOf(A),1),x&&k(T),x&&k(j),x&&k(V),x&&k(P),x&&k(z),x&&k(ie),x&&k(xe),ye&&ye.d(x),x&&k(Oe),ee=!1,Ce(de)}}}function Fr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Ts(r,e,t){let n;le(r,te,b=>t(15,n=b));let{routeInfo:o}=e,{id:i}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function p(){let b=n.features.find(v=>v.id==i);try{t(0,s=await o.nameForRoute(b))}catch(v){window.alert(`Couldn't auto-name route: ${v}`)}}const m=[[]];function c(){s=this.value,t(0,s)}function f(){a=this.__value,t(1,a)}function d(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function _(){a=this.__value,t(1,a)}function y(){l=this.value,t(2,l)}const h=()=>p();return r.$$set=b=>{"routeInfo"in b&&t(5,o=b.routeInfo),"id"in b&&t(6,i=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(3,u=b.length_meters)},[s,a,l,u,p,o,i,c,f,m,d,g,_,y,h]}class Is extends Z{constructor(e){super(),Q(this,e,Ts,Rs,W,{routeInfo:5,id:6,name:0,intervention_type:1,description:2,length_meters:3})}}const Ps="Intervention",Fs=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],xs={name:Ps,oneOf:Fs};function Ns(r){const e=r-1;return e*e*e+1}function gt(r,{delay:e=0,duration:t=400,easing:n=Ns}={}){const o=getComputedStyle(r),i=+o.opacity,s=parseFloat(o.height),a=parseFloat(o.paddingTop),l=parseFloat(o.paddingBottom),u=parseFloat(o.marginTop),p=parseFloat(o.marginBottom),m=parseFloat(o.borderTopWidth),c=parseFloat(o.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*i};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*p}px;border-top-width: ${f*m}px;border-bottom-width: ${f*c}px;`}}function $o(r){return"members"in r}function Oo(r){return"oneOf"in r}function Lo(r){return typeof r=="string"}function Co(r){return typeof r=="object"&&"value"in r}function Bs(r){return"type"in r&&r.type=="number"}function Ao(r){return"type"in r&&r.type=="one-liner"}function Ro(r){return"type"in r&&r.type=="textbox"}function To(r){return"type"in r&&r.type=="checkbox"}function xr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Nr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Br(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=K(t),C(e,"class","svelte-1b72l00")},m(o,i){w(o,e,i),S(e,n)},p(o,i){i&2&&t!==(t=o[1].description+"")&&Fe(n,t)},d(o){o&&k(e)}}}function Ds(r){let e,t,n;return{c(){e=E("input"),C(e,"type","checkbox")},m(o,i){w(o,e,i),e.checked=r[0],t||(n=U(e,"change",r[14]),t=!0)},p(o,i){i&1&&(e.checked=o[0])},i:H,o:H,d(o){o&&k(e),t=!1,n()}}}function js(r){let e,t,n;return{c(){e=E("textarea"),he(e,"width","100%"),C(e,"rows","5"),C(e,"class","svelte-1b72l00")},m(o,i){w(o,e,i),Le(e,r[0]),t||(n=U(e,"input",r[13]),t=!0)},p(o,i){i&1&&Le(e,o[0])},i:H,o:H,d(o){o&&k(e),t=!1,n()}}}function qs(r){let e,t,n;return{c(){e=E("input"),C(e,"type","text"),he(e,"width","100%")},m(o,i){w(o,e,i),Le(e,r[0]),t||(n=U(e,"input",r[12]),t=!0)},p(o,i){i&1&&e.value!==o[0]&&Le(e,o[0])},i:H,o:H,d(o){o&&k(e),t=!1,n()}}}function Us(r){let e,t,n;return{c(){e=E("input"),C(e,"type","number")},m(o,i){w(o,e,i),Le(e,r[0]),t||(n=U(e,"input",r[11]),t=!0)},p(o,i){i&1&&co(e.value)!==o[0]&&Le(e,o[0])},i:H,o:H,d(o){o&&k(e),t=!1,n()}}}function Gs(r){let e,t,n=r[1].oneOf,o=[];for(let s=0;s<n.length;s+=1)o[s]=jr(xr(r,n,s));const i=s=>L(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=me()},m(s,a){for(let l=0;l<o.length;l+=1)o[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=xr(s,n,l);o[l]?(o[l].p(u,a),$(o[l],1)):(o[l]=jr(u),o[l].c(),$(o[l],1),o[l].m(e.parentNode,e))}for(ce(),l=n.length;l<o.length;l+=1)i(l);pe()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)L(o[a]);t=!1},d(s){po(o,s),s&&k(e)}}}function Hs(r){let e,t,n=r[1].members,o=[];for(let s=0;s<n.length;s+=1)o[s]=qr(Nr(r,n,s));const i=s=>L(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=me()},m(s,a){for(let l=0;l<o.length;l+=1)o[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Nr(s,n,l);o[l]?(o[l].p(u,a),$(o[l],1)):(o[l]=qr(u),o[l].c(),$(o[l],1),o[l].m(e.parentNode,e))}for(ce(),l=n.length;l<o.length;l+=1)i(l);pe()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)L(o[a]);t=!1},d(s){po(o,s),s&&k(e)}}}function zs(r){let e,t,n,o,i=r[15].name+"",s,a,l,u,p,m,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&Dr(r);return{c(){e=E("label"),t=E("input"),o=R(),s=K(i),a=E("br"),l=R(),f&&f.c(),u=me(),C(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(d,g){w(d,e,g),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),w(d,l,g),f&&f.m(d,g),w(d,u,g),p=!0,m||(c=[U(t,"change",r[9]),U(t,"change",r[4])],m=!0)},p(d,g){(!p||g&2&&n!==(n=d[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===d[2]),(!p||g&2)&&i!==(i=d[15].name+"")&&Fe(s,i),d[2]==d[15].name&&typeof d[0]=="object"?f?(f.p(d,g),g&7&&$(f,1)):(f=Dr(d),f.c(),$(f,1),f.m(u.parentNode,u)):f&&(ce(),L(f,1,1,()=>{f=null}),pe())},i(d){p||($(f),p=!0)},o(d){L(f),p=!1},d(d){d&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),d&&k(l),f&&f.d(d),d&&k(u),m=!1,Ce(c)}}}function Ys(r){let e,t,n,o,i=r[15].value+"",s,a,l,u,p;function m(d,g){return d[15].description?Ws:Xs}let c=m(r),f=c(r);return{c(){e=E("label"),t=E("input"),o=R(),s=K(i),a=R(),f.c(),l=R(),C(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(d,g){w(d,e,g),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),f.m(e,null),S(e,l),u||(p=[U(t,"change",r[8]),U(t,"change",r[3])],u=!0)},p(d,g){g&2&&n!==(n=d[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===d[2]),g&2&&i!==(i=d[15].value+"")&&Fe(s,i),c===(c=m(d))&&f?f.p(d,g):(f.d(1),f=c(d),f&&(f.c(),f.m(e,l)))},i:H,o:H,d(d){d&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Ce(p)}}}function Js(r){let e,t,n,o,i=r[15]+"",s,a,l,u,p,m;return{c(){e=E("label"),t=E("input"),o=R(),s=K(i),a=R(),l=E("br"),u=R(),C(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){w(c,e,f),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),S(e,l),S(e,u),p||(m=[U(t,"change",r[6]),U(t,"change",r[3])],p=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&i!==(i=c[15]+"")&&Fe(s,i)},i:H,o:H,d(c){c&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,Ce(m)}}}function Dr(r){let e,t,n,o,i,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Ht({props:l}),ae.push(()=>Ee(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),N(t.$$.fragment),o=R(),C(e,"class","svelte-1b72l00")},m(u,p){w(u,e,p),B(t,e,null),S(e,o),s=!0},p(u,p){r=u;const m={};p&2&&(m.spec=r[15]),!n&&p&3&&(n=!0,m.value=r[0][r[15].name],Me(()=>n=!1)),t.$set(m)},i(u){s||($(t.$$.fragment,u),Ut(()=>{i||(i=mt(e,gt,{duration:500},!0)),i.run(1)}),s=!0)},o(u){L(t.$$.fragment,u),i||(i=mt(e,gt,{duration:500},!1)),i.run(0),s=!1},d(u){u&&k(e),D(t),u&&i&&i.end()}}}function Xs(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function Ws(r){let e,t,n=r[15].description+"",o,i;return{c(){e=E("p"),t=K("("),o=K(n),i=K(")"),C(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,o),S(e,i)},p(s,a){a&2&&n!==(n=s[15].description+"")&&Fe(o,n)},d(s){s&&k(e)}}}function jr(r){let e,t,n,o,i,s;const a=[Js,Ys,zs],l=[];function u(p,m){return m&2&&(e=null),m&2&&(t=null),e==null&&(e=!!Lo(p[15])),e?0:(t==null&&(t=!!Co(p[15])),t?1:2)}return n=u(r,-1),o=l[n]=a[n](r),{c(){o.c(),i=me()},m(p,m){l[n].m(p,m),w(p,i,m),s=!0},p(p,m){let c=n;n=u(p,m),n===c?l[n].p(p,m):(ce(),L(l[c],1,1,()=>{l[c]=null}),pe(),o=l[n],o?o.p(p,m):(o=l[n]=a[n](p),o.c()),$(o,1),o.m(i.parentNode,i))},i(p){s||($(o),s=!0)},o(p){L(o),s=!1},d(p){l[n].d(p),p&&k(i)}}}function qr(r){let e,t,n=r[15].name+"",o,i,s,a,l,u;function p(c){r[5](c,r[15])}let m={spec:r[15]};return r[0][r[15].name]!==void 0&&(m.value=r[0][r[15].name]),s=new Ht({props:m}),ae.push(()=>Ee(s,"value",p,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),o=K(n),i=R(),N(s.$$.fragment),l=R(),C(e,"class","svelte-1b72l00")},m(c,f){w(c,e,f),S(e,t),S(t,o),S(e,i),B(s,e,null),S(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&Fe(o,n);const d={};f&2&&(d.spec=r[15]),!a&&f&3&&(a=!0,d.value=r[0][r[15].name],Me(()=>a=!1)),s.$set(d)},i(c){u||($(s.$$.fragment,c),u=!0)},o(c){L(s.$$.fragment,c),u=!1},d(c){c&&k(e),D(s)}}}function Vs(r){let e,t,n,o,i,s,a,l,u,p,m,c=r[1].description&&Br(r);const f=[Hs,Gs,Us,qs,js,Ds],d=[];function g(_,y){return y&2&&(t=null),y&2&&(n=null),y&2&&(o=null),y&2&&(i=null),y&2&&(s=null),y&2&&(a=null),t==null&&(t=!!$o(_[1])),t?0:(n==null&&(n=!!Oo(_[1])),n?1:(o==null&&(o=!!Bs(_[1])),o?2:(i==null&&(i=!!Ao(_[1])),i?3:(s==null&&(s=!!Ro(_[1])),s?4:(a==null&&(a=!!To(_[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=d[l]=f[l](r)),{c(){c&&c.c(),e=R(),u&&u.c(),p=me()},m(_,y){c&&c.m(_,y),w(_,e,y),~l&&d[l].m(_,y),w(_,p,y),m=!0},p(_,[y]){_[1].description?c?c.p(_,y):(c=Br(_),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let h=l;l=g(_,y),l===h?~l&&d[l].p(_,y):(u&&(ce(),L(d[h],1,1,()=>{d[h]=null}),pe()),~l?(u=d[l],u?u.p(_,y):(u=d[l]=f[l](_),u.c()),$(u,1),u.m(p.parentNode,p)):u=null)},i(_){m||($(u),m=!0)},o(_){L(u),m=!1},d(_){c&&c.d(_),_&&k(e),~l&&d[l].d(_),_&&k(p)}}}function Ks(r,e,t){var h,b,v;let{spec:n}=e,{value:o}=e,i="";if($o(n)){o||(o={});for(let M of n.members)Ao(M)||Ro(M)?o[h=M.name]||(o[h]=""):To(M)?o[b=M.name]||(o[b]=!1):o[v=M.name]||(o[v]={})}else Oo(n)&&(o||(o={}),Lo(o)?i=o:Co(o)?i=o.value:i=Object.keys(o)[0]||"");function s(){t(0,o=i)}function a(){t(0,o={}),t(0,o[i]={},o)}const l=[[]];function u(M,O){r.$$.not_equal(o[O.name],M)&&(o[O.name]=M,t(0,o))}function p(){i=this.__value,t(2,i)}function m(){i=this.__value,t(2,i)}function c(){i=this.__value,t(2,i)}function f(M,O){r.$$.not_equal(o[O.name],M)&&(o[O.name]=M,t(0,o))}function d(){o=co(this.value),t(0,o)}function g(){o=this.value,t(0,o)}function _(){o=this.value,t(0,o)}function y(){o=this.checked,t(0,o)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,o=M.value)},[o,n,i,s,a,u,p,l,m,c,f,d,g,_,y]}class Ht extends Z{constructor(e){super(),Q(this,e,Ks,Vs,W,{spec:1,value:0})}}function Zs(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].v2!==void 0&&(i.value=r[0].v2),e=new Ht({props:i}),ae.push(()=>Ee(e,"value",o,r[0].v2)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Qs(r,e,t){let{props:n}=e;n.v2||(n.v2={});let o=xs;function i(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class el extends Z{constructor(e){super(),Q(this,e,Qs,Zs,W,{props:0})}}const tl="Planning",nl=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],rl={name:tl,members:nl};function ol(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].planning!==void 0&&(i.value=r[0].planning),e=new Ht({props:i}),ae.push(()=>Ee(e,"value",o,r[0].planning)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function il(r,e,t){let{props:n}=e;n.planning||(n.planning={});let o=rl;function i(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class sl extends Z{constructor(e){super(),Q(this,e,il,ol,W,{props:0})}}const ll="CriticalIssue",al=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],ul={name:ll,members:al};function fl(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].criticals!==void 0&&(i.value=r[0].criticals),e=new Ht({props:i}),ae.push(()=>Ee(e,"value",o,r[0].criticals)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function cl(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let o=ul;function i(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class pl extends Z{constructor(e){super(),Q(this,e,cl,fl,W,{props:0})}}function Ur(r){let e,t,n,o,i;const s=r[10].default,a=et(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),he(e,"border","solid 1px black"),he(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,o||(i=U(e,"introend",r[14]),o=!0)},p(l,u){a&&a.p&&(!n||u&512)&&tt(a,s,l,l[9],n?rt(s,l[9],u,null):nt(l[9]),null)},i(l){n||($(a,l),Ut(()=>{t||(t=mt(e,gt,{duration:100},!0)),t.run(1)}),n=!0)},o(l){L(a,l),t||(t=mt(e,gt,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),o=!1,i()}}}function hl(r){let e,t,n,o,i,s,a,l,u,p,m=r[4]&&Ur(r);return{c(){e=E("button"),t=rn("svg"),n=rn("path"),o=R(),i=K(r[1]),s=R(),m&&m.c(),a=me(),C(n,"d","M9 5l7 7-7 7"),C(t,"style","tran"),C(t,"width","20"),C(t,"height","20"),C(t,"fill","none"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"stroke-width","2"),C(t,"viewBox","0 0 24 24"),C(t,"stroke","currentColor"),C(t,"class","svelte-t7fpgu"),C(e,"aria-expanded",r[4]),C(e,"class","svelte-t7fpgu"),hr(e,"underlined",r[3])},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,o),S(e,i),w(c,s,f),m&&m.m(c,f),w(c,a,f),l=!0,u||(p=[U(e,"click",r[5]),U(e,"mouseenter",r[11]),U(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&Fe(i,c[1]),(!l||f&16)&&C(e,"aria-expanded",c[4]),(!l||f&8)&&hr(e,"underlined",c[3]),c[4]?m?(m.p(c,f),f&16&&$(m,1)):(m=Ur(c),m.c(),$(m,1),m.m(a.parentNode,a)):m&&(ce(),L(m,1,1,()=>{m=null}),pe())},i(c){l||($(m),l=!0)},o(c){L(m),l=!1},d(c){c&&k(e),c&&k(s),m&&m.d(c),c&&k(a),u=!1,Ce(p)}}}function dl(r,e,t){let n,o,i,s;le(r,De,h=>t(7,i=h)),le(r,Se,h=>t(8,s=h));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const m=()=>{Se.update(h=>h==u?null:u),s==u&&(Dt.set(null),Dt.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const d=()=>Bt.set(u),g=()=>Bt.set(null);function _(h){ae[h?"unshift":"push"](()=>{c=h,t(2,c)})}const y=()=>f();return r.$$set=h=>{"id"in h&&t(0,u=h.id),"label"in h&&t(1,p=h.label),"$$scope"in h&&t(9,l=h.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,o=i==u)},[u,p,c,o,n,m,f,i,s,l,a,d,g,_,y]}class ml extends Z{constructor(e){super(),Q(this,e,dl,hl,W,{id:0,label:1})}}function Gr(r,e,t){const n=r.slice();return n[14]=e[t],n[15]=e,n[16]=t,n}function _l(r){let e,t,n;function o(s){r[10](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new pl({props:i}),ae.push(()=>Ee(e,"props",o,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function gl(r){let e,t,n;function o(s){r[9](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new sl({props:i}),ae.push(()=>Ee(e,"props",o,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function bl(r){let e,t,n;function o(s){r[8](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new el({props:i}),ae.push(()=>Ee(e,"props",o,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function yl(r){let e,t,n,o,i;function s(p){r[5](p,r[14])}function a(p){r[6](p,r[14])}function l(p){r[7](p,r[14])}let u={routeInfo:r[1],id:r[14].id,length_meters:r[14].properties.length_meters};return r[14].properties.name!==void 0&&(u.name=r[14].properties.name),r[14].properties.intervention_type!==void 0&&(u.intervention_type=r[14].properties.intervention_type),r[14].properties.description!==void 0&&(u.description=r[14].properties.description),e=new Is({props:u}),ae.push(()=>Ee(e,"name",s,r[14].properties.name)),ae.push(()=>Ee(e,"intervention_type",a,r[14].properties.intervention_type)),ae.push(()=>Ee(e,"description",l,r[14].properties.description)),{c(){N(e.$$.fragment)},m(p,m){B(e,p,m),i=!0},p(p,m){r=p;const c={};m&2&&(c.routeInfo=r[1]),m&4&&(c.id=r[14].id),m&4&&(c.length_meters=r[14].properties.length_meters),!t&&m&4&&(t=!0,c.name=r[14].properties.name,Me(()=>t=!1)),!n&&m&4&&(n=!0,c.intervention_type=r[14].properties.intervention_type,Me(()=>n=!1)),!o&&m&4&&(o=!0,c.description=r[14].properties.description,Me(()=>o=!1)),e.$set(c)},i(p){i||($(e.$$.fragment,p),i=!0)},o(p){L(e.$$.fragment,p),i=!1},d(p){D(e,p)}}}function vl(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,g;const _=[yl,bl,gl,_l],y=[];function h(v,M){return v[0]=="v1"?0:v[0]=="v2"?1:v[0]=="planning"?2:v[0]=="criticals"?3:-1}~(e=h(r))&&(t=y[e]=_[e](r));function b(){return r[11](r[14])}return{c(){t&&t.c(),n=R(),o=E("br"),i=R(),s=E("br"),a=R(),l=E("div"),u=E("button"),u.textContent="Delete",p=R(),m=E("button"),m.textContent="Save",c=R(),C(u,"type","button"),C(m,"type","button"),he(l,"display","flex"),he(l,"justify-content","space-between")},m(v,M){~e&&y[e].m(v,M),w(v,n,M),w(v,o,M),w(v,i,M),w(v,s,M),w(v,a,M),w(v,l,M),S(l,u),S(l,p),S(l,m),w(v,c,M),f=!0,d||(g=[U(u,"click",b),U(m,"click",r[12])],d=!0)},p(v,M){r=v;let O=e;e=h(r),e===O?~e&&y[e].p(r,M):(t&&(ce(),L(y[O],1,1,()=>{y[O]=null}),pe()),~e?(t=y[e],t?t.p(r,M):(t=y[e]=_[e](r),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(v){f||($(t),f=!0)},o(v){L(t),f=!1},d(v){~e&&y[e].d(v),v&&k(n),v&&k(o),v&&k(i),v&&k(s),v&&k(a),v&&k(l),v&&k(c),d=!1,Ce(g)}}}function Hr(r,e){let t,n,o;return n=new ml({props:{id:e[14].id,label:e[16]+1+") "+e[3](e[14]),$$slots:{default:[vl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=me(),N(n.$$.fragment),this.first=t},m(i,s){w(i,t,s),B(n,i,s),o=!0},p(i,s){e=i;const a={};s&4&&(a.id=e[14].id),s&4&&(a.label=e[16]+1+") "+e[3](e[14])),s&131079&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(i){o||($(n.$$.fragment,i),o=!0)},o(i){L(n.$$.fragment,i),o=!1},d(i){i&&k(t),D(n,i)}}}function wl(r){let e=[],t=new Map,n,o,i,s,a=r[2].features;const l=u=>u[14].id;for(let u=0;u<a.length;u+=1){let p=Gr(r,a,u),m=l(p);t.set(m,e[u]=Hr(m,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=me()},m(u,p){for(let m=0;m<e.length;m+=1)e[m].m(u,p);w(u,n,p),o=!0,i||(s=U(window,"keydown",r[4]),i=!0)},p(u,[p]){p&15&&(a=u[2].features,ce(),e=ni(e,p,l,1,u,a,t,n.parentNode,ri,Hr,n,Gr),pe())},i(u){if(!o){for(let p=0;p<a.length;p+=1)$(e[p]);o=!0}},o(u){for(let p=0;p<e.length;p+=1)L(e[p]);o=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&k(n),i=!1,s()}}}function kl(r,e,t){let n,o;le(r,Se,y=>t(13,n=y)),le(r,te,y=>t(2,o=y));let{schema:i}=e,{routeInfo:s}=e;function a(y){var b,v,M,O,I;if(i=="planning")return((b=y.properties.planning)==null?void 0:b.name)||"Untitled polygon";if(i=="v2")return((M=(v=y.properties.v2)==null?void 0:v.Route)==null?void 0:M.name)||((I=(O=y.properties.v2)==null?void 0:O.Crossing)==null?void 0:I.name)||"Untitled intervention";if(y.properties.name)return y.properties.name;var h=y.properties.intervention_type;return h=="other"&&(y.geometry.type=="Point"?h="point":y.geometry.type=="LineString"?h="line":h="polygon"),`Untitled ${h}`}function l(y){if(y.key=="Delete"){const h=y.target.tagName;if(h=="INPUT"||h=="TEXTAREA")return;y.preventDefault();const b=n;b&&_r(b)}}function u(y,h){r.$$.not_equal(h.properties.name,y)&&(h.properties.name=y,te.set(o))}function p(y,h){r.$$.not_equal(h.properties.intervention_type,y)&&(h.properties.intervention_type=y,te.set(o))}function m(y,h){r.$$.not_equal(h.properties.description,y)&&(h.properties.description=y,te.set(o))}function c(y,h){r.$$.not_equal(h.properties,y)&&(h.properties=y,te.set(o))}function f(y,h){r.$$.not_equal(h.properties,y)&&(h.properties=y,te.set(o))}function d(y,h){r.$$.not_equal(h.properties,y)&&(h.properties=y,te.set(o))}const g=y=>_r(y.id),_=()=>Se.set(null);return r.$$set=y=>{"schema"in y&&t(0,i=y.schema),"routeInfo"in y&&t(1,s=y.routeInfo)},[i,s,o,a,l,u,p,m,c,f,d,g,_]}class Sl extends Z{constructor(e){super(),Q(this,e,kl,wl,W,{schema:0,routeInfo:1})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function je(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Hn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ye(r,e,t){t===void 0&&(t={});var n=Ve(r),o=Ve(e),i=Ie(o[1]-n[1]),s=Ie(o[0]-n[0]),a=Ie(n[1]),l=Ie(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return oi(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Zt(r,e){return e===void 0&&(e={}),ii(r,function(t,n){var o=n.geometry.coordinates;return t+Ye(o[0],o[1],e)},0)}function El(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,g,_,y,h,b,v=r[0].features.length+"",M,O,I,A,F,T,j,V;return{c(){e=E("div"),t=E("label"),n=K(`Scheme name:
    `),o=E("input"),i=R(),s=E("br"),a=R(),l=E("div"),u=E("label"),p=E("input"),m=R(),c=E("button"),c.textContent="Load from GeoJSON",f=R(),d=E("button"),d.textContent="Export to GeoJSON",g=R(),_=E("br"),y=R(),h=E("div"),b=E("span"),M=K(v),O=K(" interventions"),I=R(),A=E("button"),F=K("Clear all"),C(o,"type","text"),C(p,"type","file"),C(p,"id","load_geojson"),C(p,"class","svelte-lhyd1e"),C(c,"type","button"),C(d,"type","button"),C(d,"class","align-right svelte-lhyd1e"),C(A,"type","button"),C(A,"class","align-right svelte-lhyd1e"),A.disabled=T=r[0].features.length==0},m(P,z){w(P,e,z),S(e,t),S(t,n),S(t,o),Le(o,r[0].scheme_name),w(P,i,z),w(P,s,z),w(P,a,z),w(P,l,z),S(l,u),S(u,p),S(u,m),S(u,c),S(l,f),S(l,d),w(P,g,z),w(P,_,z),w(P,y,z),w(P,h,z),S(h,b),S(b,M),S(b,O),S(h,I),S(h,A),S(A,F),j||(V=[U(o,"input",r[7]),U(p,"change",r[3]),U(c,"click",$l),U(d,"click",r[2]),U(A,"click",r[1])],j=!0)},p(P,[z]){z&1&&o.value!==P[0].scheme_name&&Le(o,P[0].scheme_name),z&1&&v!==(v=P[0].features.length+"")&&Fe(M,v),z&1&&T!==(T=P[0].features.length==0)&&(A.disabled=T)},i:H,o:H,d(P){P&&k(e),P&&k(i),P&&k(s),P&&k(a),P&&k(l),P&&k(g),P&&k(_),P&&k(y),P&&k(h),j=!1,Ce(V)}}}function Ml(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function $l(){document.getElementById("load_geojson").click()}function Ol(r,e,t){let n;le(r,te,f=>t(0,n=f));let{authorityName:o}=e,{schema:i}=e,s=o;i!="v1"&&(s+=`_${i}`),yt(async()=>{let d=new URLSearchParams(window.location.search).get("geojsonUrl"),g=window.localStorage.getItem(s);if(d){console.log(`Loading GeoJSON from ${d}`);try{let y=await(await fetch(d)).text();te.set(m(JSON.parse(y)))}catch(_){console.log(`Failed to load from URL: ${_}`)}}else if(g)try{te.set(m(JSON.parse(g)))}catch(_){console.log(`Failed to load from local storage: ${_}`)}});function a(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(te.update(f=>(delete f.scheme_name,f.features=[],f)),Se.set(null),De.set(null),Bt.set(null),Dt.set(null))}function l(){const f=JSON.parse(JSON.stringify(n));for(let d of f.features)delete d.properties.hide_while_editing;return f}function u(){let f=l();var d=s;f.authority=o,f.origin="atip-v1",f.scheme_name&&(d+="_"+f.scheme_name),d+=".txt",Ml(d,JSON.stringify(f,null,"  "))}function p(f){const d=new FileReader;d.onload=_=>{try{te.set(m(JSON.parse(_.target.result)))}catch(y){window.alert(`Couldn't load scheme from a file: ${y}`)}};let g=f.target.files;d.readAsText(g[0])}function m(f){let d=1;for(let g of f.features)g.properties||(g.properties={name:"",description:"",intervention_type:"other"}),g.geometry.type=="LineString"&&!g.properties.length_meters&&(g.properties.length_meters=Zt(g,{units:"kilometers"})*1e3),g.id=d++;return f}function c(){n.scheme_name=this.value,te.set(n)}return r.$$set=f=>{"authorityName"in f&&t(4,o=f.authorityName),"schema"in f&&t(5,i=f.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(l())))},[n,a,u,p,o,i,s,c]}class Ll extends Z{constructor(e){super(),Q(this,e,Ol,El,W,{authorityName:4,schema:5})}}const Cl="/atip/source_layer_helpers/assets/zoom_out_map-b2e1091a.svg";function Al(r){let e,t,n,o,i;return{c(){e=E("button"),t=E("img"),Tn(t.src,n=Cl)||C(t,"src",n),C(t,"alt","Zoom to show entire boundary"),C(e,"type","button"),C(e,"title","Zoom to show entire boundary"),C(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),o||(i=U(e,"click",r[0]),o=!0)},p:H,i:H,o:H,d(s){s&&k(e),o=!1,i()}}}function Rl(r,e,t){let n;le(r,Ae,s=>t(2,n=s));let{boundaryGeojson:o}=e;function i(){n.fitBounds(Kn(o),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,o=s.boundaryGeojson)},[i,o]}class Tl extends Z{constructor(e){super(),Q(this,e,Rl,Al,W,{boundaryGeojson:1})}}function Il(r){let e,t,n,o,i,s,a;return{c(){e=E("div"),t=K(`Basemap:
  `),n=E("select"),o=E("option"),o.textContent="Streets",i=E("option"),i.textContent="Satellite",o.__value="streets",o.value=o.__value,i.__value="hybrid",i.value=i.__value,r[0]===void 0&&Ut(()=>r[2].call(n)),C(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,o),S(n,i),on(n,r[0]),s||(a=[U(n,"change",r[2]),U(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&on(n,l[0])},i:H,o:H,d(l){l&&k(e),s=!1,Ce(a)}}}function Pl(r,e,t){let{style:n}=e;function o(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function i(){n=ho(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,o,i]}class Fl extends Z{constructor(e){super(),Q(this,e,Pl,Il,W,{style:0})}}const fe={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},vn=10,pn=10;function zr(r){let e,t,n;const o=r[3].default,i=et(o,r,r[2],null);return{c(){e=E("div"),i&&i.c()},m(s,a){w(s,e,a),i&&i.m(e,null),n=!0},p(s,a){i&&i.p&&(!n||a&4)&&tt(i,o,s,s[2],n?rt(o,s[2],a,null):nt(s[2]),null)},i(s){n||($(i,s),Ut(()=>{t||(t=mt(e,gt,{duration:100},!0)),t.run(1)}),n=!0)},o(s){L(i,s),t||(t=mt(e,gt,{duration:100},!1)),t.run(0),n=!1},d(s){s&&k(e),i&&i.d(s),s&&t&&t.end()}}}function xl(r){let e,t,n,o,i,s,a,l,u,p,m=r[0]&&zr(r);return{c(){e=E("button"),t=rn("svg"),n=rn("path"),o=R(),i=K(r[1]),s=R(),m&&m.c(),a=me(),C(n,"d","M9 5l7 7-7 7"),C(t,"style","tran"),C(t,"width","20"),C(t,"height","20"),C(t,"fill","none"),C(t,"stroke-linecap","round"),C(t,"stroke-linejoin","round"),C(t,"stroke-width","2"),C(t,"viewBox","0 0 24 24"),C(t,"stroke","currentColor"),C(t,"class","svelte-una9lq"),C(e,"aria-expanded",r[0]),C(e,"class","svelte-una9lq")},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,o),S(e,i),w(c,s,f),m&&m.m(c,f),w(c,a,f),l=!0,u||(p=U(e,"click",r[4]),u=!0)},p(c,[f]){(!l||f&2)&&Fe(i,c[1]),(!l||f&1)&&C(e,"aria-expanded",c[0]),c[0]?m?(m.p(c,f),f&1&&$(m,1)):(m=zr(c),m.c(),$(m,1),m.m(a.parentNode,a)):m&&(ce(),L(m,1,1,()=>{m=null}),pe())},i(c){l||($(m),l=!0)},o(c){L(m),l=!1},d(c){c&&k(e),c&&k(s),m&&m.d(c),c&&k(a),u=!1,p()}}}function Nl(r,e,t){let{$$slots:n={},$$scope:o}=e,{label:i}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,i=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,o=l.$$scope)},[s,i,o,n,a]}class wn extends Z{constructor(e){super(),Q(this,e,Nl,xl,W,{label:1,open:0})}}function Bl(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,g;return{c(){e=E("li"),t=E("span"),n=K("Areas"),o=R(),i=E("li"),s=E("span"),a=K("Routes"),l=R(),u=E("li"),p=E("span"),m=K("Crossings"),c=R(),f=E("li"),d=E("span"),g=K("Other"),C(t,"class","svelte-l42ea0"),he(t,"background",fe.area),C(s,"class","svelte-l42ea0"),he(s,"background",fe.route),C(p,"class","svelte-l42ea0"),he(p,"background",fe.crossing),C(d,"class","svelte-l42ea0"),he(d,"background",fe.other)},m(_,y){w(_,e,y),S(e,t),S(e,n),w(_,o,y),w(_,i,y),S(i,s),S(i,a),w(_,l,y),w(_,u,y),S(u,p),S(u,m),w(_,c,y),w(_,f,y),S(f,d),S(f,g)},p:H,d(_){_&&k(e),_&&k(o),_&&k(i),_&&k(l),_&&k(u),_&&k(c),_&&k(f)}}}function Dl(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,g;return{c(){e=E("li"),t=E("span"),n=K("Preapp"),o=R(),i=E("li"),s=E("span"),a=K("Outline"),l=R(),u=E("li"),p=E("span"),m=K("Reserved matters"),c=R(),f=E("li"),d=E("span"),g=K("Local plan"),C(t,"class","svelte-l42ea0"),he(t,"background",fe.preapp),C(s,"class","svelte-l42ea0"),he(s,"background",fe.outline),C(p,"class","svelte-l42ea0"),he(p,"background",fe["reserved matters"]),C(d,"class","svelte-l42ea0"),he(d,"background",fe["local plan"])},m(_,y){w(_,e,y),S(e,t),S(e,n),w(_,o,y),w(_,i,y),S(i,s),S(i,a),w(_,l,y),w(_,u,y),S(u,p),S(u,m),w(_,c,y),w(_,f,y),S(f,d),S(f,g)},p:H,d(_){_&&k(e),_&&k(o),_&&k(i),_&&k(l),_&&k(u),_&&k(c),_&&k(f)}}}function jl(r){let e;function t(i,s){return i[0]=="planning"?Dl:Bl}let n=t(r),o=n(r);return{c(){e=E("ul"),o.c()},m(i,s){w(i,e,s),o.m(e,null)},p(i,s){n===(n=t(i))&&o?o.p(i,s):(o.d(1),o=n(i),o&&(o.c(),o.m(e,null)))},d(i){i&&k(e),o.d()}}}function ql(r){let e,t,n;return t=new wn({props:{label:"Interventions",open:!0,$$slots:{default:[jl]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),C(e,"class","svelte-l42ea0")},m(o,i){w(o,e,i),B(t,e,null),n=!0},p(o,[i]){const s={};i&3&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||($(t.$$.fragment,o),n=!0)},o(o){L(t.$$.fragment,o),n=!1},d(o){o&&k(e),D(t)}}}function Ul(r,e,t){let{schema:n}=e;return r.$$set=o=>{"schema"in o&&t(0,n=o.schema)},[n]}class Gl extends Z{constructor(e){super(),Q(this,e,Ul,ql,W,{schema:0})}}let lt="interventions";function Hl(r,e,t){let n,o;le(r,Ae,p=>t(1,n=p)),le(r,te,p=>t(2,o=p));let{schema:i}=e;vt(n,lt,{type:"geojson",data:o});const s=["match",["get","intervention_type"],"area",fe.area,"route",fe.route,"crossing",fe.crossing,"other",fe.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",fe.preapp,"outline",fe.outline,"reserved matters",fe["reserved matters"],"local plan",fe["local plan"],"white"],l=["!=","hide_while_editing",!0];return ke(n,{id:"interventions-points",source:lt,filter:["all",gn,l,["!=","endpoint",!0]],...wt(s,vn)}),ke(n,{id:"interventions-lines",source:lt,filter:["all",bn,l],...Nt(s,pn)}),ke(n,{id:"interventions-lines-endpoints",source:lt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*pn,"circle-opacity":0,"circle-stroke-color":fe.lineEndpointColor,"circle-stroke-width":2}}),ke(n,{id:"interventions-polygons",source:lt,filter:["all",yn,l],...Zn(i=="planning"?a:s,.5)}),r.$$set=p=>{"schema"in p&&t(0,i=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(o)),m=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])m.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(m),n.getSource(lt).setData(p)}},[i,n,o]}class zl extends Z{constructor(e){super(),Q(this,e,Hl,null,W,{schema:0})}}let at="hover";function Yl(r,e,t){let n,o,i,s,a;return le(r,Ae,l=>t(0,n=l)),le(r,te,l=>t(1,o=l)),le(r,Bt,l=>t(2,i=l)),le(r,De,l=>t(3,s=l)),le(r,Se,l=>t(4,a=l)),vt(n,at,{type:"geojson",data:qe()}),ke(n,{id:"hover-polygons",source:at,filter:yn,...Nt(fe.hovering,.5*pn,1)}),ke(n,{id:"hover-lines",source:at,filter:bn,...Nt(fe.hovering,1.5*pn,1)}),ke(n,{id:"hover-points",source:at,filter:gn,...wt(fe.hovering,1.5*vn,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||i;l!=null?n.getSource(at).setData(o.features.find(u=>u.id==l)):n.getSource(at).setData(qe())}},[n,o,i,s,a]}class Jl extends Z{constructor(e){super(),Q(this,e,Yl,null,W,{})}}class rr{constructor(e,t){oe(this,"owner");oe(this,"map");oe(this,"mapHandlers",{});oe(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Jt="edit-point-mode";class Xl{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"cursor");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new rr(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),vt(e,Jt,{type:"geojson",data:qe()}),ke(e,{id:"edit-point-mode",source:Jt,...wt(fe.hovering,vn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=Wl(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Jt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=qe();this.cursor&&e.features.push(this.cursor),this.map.getSource(Jt).setData(e)}}function Wl(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Io(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Vl(r,e);var n=Ve(r),o=Ve(e),i=Ie(n[0]),s=Ie(o[0]),a=Ie(n[1]),l=Ie(o[1]),u=Math.sin(s-i)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-i);return In(Math.atan2(u,p))}function Vl(r,e){var t=Io(e,r);return t=(t+180)%360,t}function Yr(r,e,t,n){n===void 0&&(n={});var o=Ve(r),i=Ie(o[0]),s=Ie(o[1]),a=Ie(t),l=si(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=i+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),m=In(p),c=In(u);return dt([m,c],n.properties)}function zn(r){if(!r)throw new Error("geojson is required");var e=[];return Qn(r,function(t){Kl(t,e)}),We(e)}function Kl(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=je(n);break;case"LineString":t=[je(n)]}t.forEach(function(o){var i=Zl(o,r.properties);i.forEach(function(s){s.id=e.length,e.push(s)})})}}function Zl(r,e){var t=[];return r.reduce(function(n,o){var i=_t([n,o],e);return i.bbox=Ql(n,o),t.push(i),o}),t}function Ql(r,e){var t=r[0],n=r[1],o=e[0],i=e[1],s=t<o?t:o,a=n<i?n:i,l=t>o?t:o,u=n>i?n:i;return[s,a,l,u]}var bt={},ea={get exports(){return bt},set exports(r){bt=r}},Yn={},ta={get exports(){return Yn},set exports(r){Yn=r}};(function(r,e){(function(t,n){r.exports=n()})(li,function(){function t(h,b,v,M,O){(function I(A,F,T,j,V){for(;j>T;){if(j-T>600){var P=j-T+1,z=F-T+1,ie=Math.log(P),ve=.5*Math.exp(2*ie/3),Te=.5*Math.sqrt(ie*ve*(P-ve)/P)*(z-P/2<0?-1:1),re=Math.max(T,Math.floor(F-z*ve/P+Te)),ne=Math.min(j,Math.floor(F+(P-z)*ve/P+Te));I(A,F,re,ne,V)}var xe=A[F],Oe=T,ee=j;for(n(A,T,F),V(A[j],xe)>0&&n(A,T,j);Oe<ee;){for(n(A,Oe,ee),Oe++,ee--;V(A[Oe],xe)<0;)Oe++;for(;V(A[ee],xe)>0;)ee--}V(A[T],xe)===0?n(A,T,ee):n(A,++ee,j),ee<=F&&(T=ee+1),F<=ee&&(j=ee-1)}})(h,b,v||0,M||h.length-1,O||o)}function n(h,b,v){var M=h[b];h[b]=h[v],h[v]=M}function o(h,b){return h<b?-1:h>b?1:0}var i=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(h,b,v){if(!v)return b.indexOf(h);for(var M=0;M<b.length;M++)if(v(h,b[M]))return M;return-1}function a(h,b){l(h,0,h.children.length,b,h)}function l(h,b,v,M,O){O||(O=_(null)),O.minX=1/0,O.minY=1/0,O.maxX=-1/0,O.maxY=-1/0;for(var I=b;I<v;I++){var A=h.children[I];u(O,h.leaf?M(A):A)}return O}function u(h,b){return h.minX=Math.min(h.minX,b.minX),h.minY=Math.min(h.minY,b.minY),h.maxX=Math.max(h.maxX,b.maxX),h.maxY=Math.max(h.maxY,b.maxY),h}function p(h,b){return h.minX-b.minX}function m(h,b){return h.minY-b.minY}function c(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function f(h){return h.maxX-h.minX+(h.maxY-h.minY)}function d(h,b){return h.minX<=b.minX&&h.minY<=b.minY&&b.maxX<=h.maxX&&b.maxY<=h.maxY}function g(h,b){return b.minX<=h.maxX&&b.minY<=h.maxY&&b.maxX>=h.minX&&b.maxY>=h.minY}function _(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(h,b,v,M,O){for(var I=[b,v];I.length;)if(!((v=I.pop())-(b=I.pop())<=M)){var A=b+Math.ceil((v-b)/M/2)*M;t(h,A,b,v,O),I.push(b,A,A,v)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(h){var b=this.data,v=[];if(!g(h,b))return v;for(var M=this.toBBox,O=[];b;){for(var I=0;I<b.children.length;I++){var A=b.children[I],F=b.leaf?M(A):A;g(h,F)&&(b.leaf?v.push(A):d(h,F)?this._all(A,v):O.push(A))}b=O.pop()}return v},i.prototype.collides=function(h){var b=this.data;if(!g(h,b))return!1;for(var v=[];b;){for(var M=0;M<b.children.length;M++){var O=b.children[M],I=b.leaf?this.toBBox(O):O;if(g(h,I)){if(b.leaf||d(h,I))return!0;v.push(O)}}b=v.pop()}return!1},i.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var b=0;b<h.length;b++)this.insert(h[b]);return this}var v=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var M=this.data;this.data=v,v=M}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},i.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},i.prototype.clear=function(){return this.data=_([]),this},i.prototype.remove=function(h,b){if(!h)return this;for(var v,M,O,I=this.data,A=this.toBBox(h),F=[],T=[];I||F.length;){if(I||(I=F.pop(),M=F[F.length-1],v=T.pop(),O=!0),I.leaf){var j=s(h,I.children,b);if(j!==-1)return I.children.splice(j,1),F.push(I),this._condense(F),this}O||I.leaf||!d(I,A)?M?(v++,I=M.children[v],O=!1):I=null:(F.push(I),T.push(v),v=0,M=I,I=I.children[0])}return this},i.prototype.toBBox=function(h){return h},i.prototype.compareMinX=function(h,b){return h.minX-b.minX},i.prototype.compareMinY=function(h,b){return h.minY-b.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(h){return this.data=h,this},i.prototype._all=function(h,b){for(var v=[];h;)h.leaf?b.push.apply(b,h.children):v.push.apply(v,h.children),h=v.pop();return b},i.prototype._build=function(h,b,v,M){var O,I=v-b+1,A=this._maxEntries;if(I<=A)return a(O=_(h.slice(b,v+1)),this.toBBox),O;M||(M=Math.ceil(Math.log(I)/Math.log(A)),A=Math.ceil(I/Math.pow(A,M-1))),(O=_([])).leaf=!1,O.height=M;var F=Math.ceil(I/A),T=F*Math.ceil(Math.sqrt(A));y(h,b,v,T,this.compareMinX);for(var j=b;j<=v;j+=T){var V=Math.min(j+T-1,v);y(h,j,V,F,this.compareMinY);for(var P=j;P<=V;P+=F){var z=Math.min(P+F-1,V);O.children.push(this._build(h,P,z,M-1))}}return a(O,this.toBBox),O},i.prototype._chooseSubtree=function(h,b,v,M){for(;M.push(b),!b.leaf&&M.length-1!==v;){for(var O=1/0,I=1/0,A=void 0,F=0;F<b.children.length;F++){var T=b.children[F],j=c(T),V=(P=h,z=T,(Math.max(z.maxX,P.maxX)-Math.min(z.minX,P.minX))*(Math.max(z.maxY,P.maxY)-Math.min(z.minY,P.minY))-j);V<I?(I=V,O=j<O?j:O,A=T):V===I&&j<O&&(O=j,A=T)}b=A||b.children[0]}var P,z;return b},i.prototype._insert=function(h,b,v){var M=v?h:this.toBBox(h),O=[],I=this._chooseSubtree(M,this.data,b,O);for(I.children.push(h),u(I,M);b>=0&&O[b].children.length>this._maxEntries;)this._split(O,b),b--;this._adjustParentBBoxes(M,O,b)},i.prototype._split=function(h,b){var v=h[b],M=v.children.length,O=this._minEntries;this._chooseSplitAxis(v,O,M);var I=this._chooseSplitIndex(v,O,M),A=_(v.children.splice(I,v.children.length-I));A.height=v.height,A.leaf=v.leaf,a(v,this.toBBox),a(A,this.toBBox),b?h[b-1].children.push(A):this._splitRoot(v,A)},i.prototype._splitRoot=function(h,b){this.data=_([h,b]),this.data.height=h.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(h,b,v){for(var M,O,I,A,F,T,j,V=1/0,P=1/0,z=b;z<=v-b;z++){var ie=l(h,0,z,this.toBBox),ve=l(h,z,v,this.toBBox),Te=(O=ie,I=ve,A=void 0,F=void 0,T=void 0,j=void 0,A=Math.max(O.minX,I.minX),F=Math.max(O.minY,I.minY),T=Math.min(O.maxX,I.maxX),j=Math.min(O.maxY,I.maxY),Math.max(0,T-A)*Math.max(0,j-F)),re=c(ie)+c(ve);Te<V?(V=Te,M=z,P=re<P?re:P):Te===V&&re<P&&(P=re,M=z)}return M||v-b},i.prototype._chooseSplitAxis=function(h,b,v){var M=h.leaf?this.compareMinX:p,O=h.leaf?this.compareMinY:m;this._allDistMargin(h,b,v,M)<this._allDistMargin(h,b,v,O)&&h.children.sort(M)},i.prototype._allDistMargin=function(h,b,v,M){h.children.sort(M);for(var O=this.toBBox,I=l(h,0,b,O),A=l(h,v-b,v,O),F=f(I)+f(A),T=b;T<v-b;T++){var j=h.children[T];u(I,h.leaf?O(j):j),F+=f(I)}for(var V=v-b-1;V>=b;V--){var P=h.children[V];u(A,h.leaf?O(P):P),F+=f(A)}return F},i.prototype._adjustParentBBoxes=function(h,b,v){for(var M=v;M>=0;M--)u(b[M],h)},i.prototype._condense=function(h){for(var b=h.length-1,v=void 0;b>=0;b--)h[b].children.length===0?b>0?(v=h[b-1].children).splice(v.indexOf(h[b]),1):this.clear():a(h[b],this.toBBox)},i})})(ta);const na=er(ai),ra=er(ui),oa=er(fi);var Ne=Yn,Po=na,Fo=ra,ut=oa.default,ia=Fo.featureEach;Fo.coordEach;Po.polygon;var Jr=Po.featureCollection;function xo(r){var e=new Ne(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ut(t),Ne.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:ut(o),n.push(o)}):ia(t,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:ut(o),n.push(o)}),Ne.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ut(t),Ne.prototype.remove.call(this,t,n)},e.clear=function(){return Ne.prototype.clear.call(this)},e.search=function(t){var n=Ne.prototype.search.call(this,this.toBBox(t));return Jr(n)},e.collides=function(t){return Ne.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ne.prototype.all.call(this);return Jr(t)},e.toJSON=function(){return Ne.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ne.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ut(t);else if(t.type==="FeatureCollection")n=ut(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}ea.exports=xo;bt.default=xo;function No(r,e){var t={},n=[];if(r.type==="LineString"&&(r=dr(r)),e.type==="LineString"&&(e=dr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=Xr(r,e);return o&&n.push(o),We(n)}var i=bt();return i.load(zn(e)),sn(zn(r),function(s){sn(i.search(s),function(a){var l=Xr(s,a);if(l){var u=je(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function Xr(r,e){var t=je(r),n=je(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=t[0][0],i=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],m=n[1][1],c=(m-u)*(s-o)-(p-l)*(a-i),f=(p-l)*(i-u)-(m-u)*(o-l),d=(s-o)*(i-u)-(a-i)*(o-l);if(c===0)return f===0&&d===0,null;var g=f/c,_=d/c;if(g>=0&&g<=1&&_>=0&&_<=1){var y=o+g*(s-o),h=i+g*(a-i);return dt([y,h])}return null}function qt(r,e,t){t===void 0&&(t={});var n=dt([1/0,1/0],{dist:1/0}),o=0;return Qn(r,function(i){for(var s=je(i),a=0;a<s.length-1;a++){var l=dt(s[a]);l.properties.dist=Ye(e,l,t);var u=dt(s[a+1]);u.properties.dist=Ye(e,u,t);var p=Ye(l,u,t),m=Math.max(l.properties.dist,u.properties.dist),c=Io(l,u),f=Yr(e,m,c+90,t),d=Yr(e,m,c-90,t),g=No(_t([f.geometry.coordinates,d.geometry.coordinates]),_t([l.geometry.coordinates,u.geometry.coordinates])),_=null;g.features.length>0&&(_=g.features[0],_.properties.dist=Ye(e,_,t),_.properties.location=o+Ye(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=o),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=o+p),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a),o+=p}}),n}const ft="edit-polygon-mode";class sa{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"points");oe(this,"cursor");oe(this,"hover");oe(this,"dragFrom");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new rr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),vt(e,ft,{type:"geojson",data:qe()}),ke(e,{id:"edit-polygon-fill",source:ft,filter:yn,...Zn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),ke(e,{id:"edit-polygon-lines",source:ft,filter:bn,...Nt("black",8,.5)}),ke(e,{id:"edit-polygon-vertices",source:ft,filter:gn,...wt(fe.hovering,vn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let o of this.points)o[0]-=t,o[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Vr(this.points).forEach((n,o)=>{t.push([o+1,qt(n,this.cursor).properties.dist])}),t.sort((n,o)=>n[1]-o[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(ft),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=qe();this.points.forEach((n,o)=>{let i=Wr(n);i.properties.hover=this.hover==o,i.properties.idx=o,e.features.push(i)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Vr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(ft).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Wr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Wr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Vr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let J;const He=new Array(32).fill(void 0);He.push(void 0,null,!0,!1);function Y(r){return He[r]}let Pt=He.length;function la(r){r<36||(He[r]=Pt,Pt=r)}function Jn(r){const e=Y(r);return la(r),e}const Bo=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Bo.decode();let Qt=new Uint8Array;function Ft(){return Qt.byteLength===0&&(Qt=new Uint8Array(J.memory.buffer)),Qt}function pt(r,e){return Bo.decode(Ft().subarray(r,r+e))}function ge(r){Pt===He.length&&He.push(He.length+1);const e=Pt;return Pt=He[e],He[e]=r,e}function Ln(r){return r==null}let en=new Float64Array;function aa(){return en.byteLength===0&&(en=new Float64Array(J.memory.buffer)),en}let tn=new Int32Array;function be(){return tn.byteLength===0&&(tn=new Int32Array(J.memory.buffer)),tn}let Xe=0;const nn=new TextEncoder("utf-8"),ua=typeof nn.encodeInto=="function"?function(r,e){return nn.encodeInto(r,e)}:function(r,e){const t=nn.encode(r);return e.set(t),{read:r.length,written:t.length}};function Xt(r,e,t){if(t===void 0){const a=nn.encode(r),l=e(a.length);return Ft().subarray(l,l+a.length).set(a),Xe=a.length,l}let n=r.length,o=e(n);const i=Ft();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;i[o+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),o=t(o,n,n=s+r.length*3);const a=Ft().subarray(o+s,o+n),l=ua(r,a);s+=l.written}return Xe=s,o}function Xn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let i="[";o>0&&(i+=Xn(r[0]));for(let s=1;s<o;s++)i+=", "+Xn(r[s]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function fa(r,e){const t=e(r.length*1);return Ft().set(r,t/1),Xe=r.length,t}function Cn(r,e){try{return r.apply(this,e)}catch(t){J.__wbindgen_exn_store(ge(t))}}class hn{static __wrap(e){const t=Object.create(hn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();J.__wbg_jsroutesnapper_free(e)}constructor(e){try{const i=J.__wbindgen_add_to_stack_pointer(-16),s=fa(e,J.__wbindgen_malloc),a=Xe;J.jsroutesnapper_new(i,s,a);var t=be()[i/4+0],n=be()[i/4+1],o=be()[i/4+2];if(o)throw Jn(n);return hn.__wrap(t)}finally{J.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){J.jsroutesnapper_setConfig(this.ptr,ge(e))}toFinalFeature(){try{const n=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_toFinalFeature(n,this.ptr);var e=be()[n/4+0],t=be()[n/4+1];let o;return e!==0&&(o=pt(e,t).slice(),J.__wbindgen_free(e,t*1)),o}finally{J.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_renderGeojson(n,this.ptr);var e=be()[n/4+0],t=be()[n/4+1];return pt(e,t)}finally{J.__wbindgen_add_to_stack_pointer(16),J.__wbindgen_free(e,t)}}setSnapMode(e){J.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return J.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){J.jsroutesnapper_onClick(this.ptr)}onDragStart(){return J.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return J.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){J.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const o=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_editExisting(o,this.ptr,ge(e));var t=be()[o/4+0],n=be()[o/4+1];if(n)throw Jn(t)}finally{J.__wbindgen_add_to_stack_pointer(16)}}}async function ca(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function pa(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Jn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=Y(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(pt(e,t));return ge(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=pt(e,t);return ge(n)},r.wbg.__wbindgen_is_object=function(e){const t=Y(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Y(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Y(e)in Y(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=Y(t),o=typeof n=="number"?n:void 0;aa()[e/8+1]=Ln(o)?0:o,be()[e/4+0]=!Ln(o)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Y(e)==Y(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Y(t),o=typeof n=="string"?n:void 0;var i=Ln(o)?0:Xt(o,J.__wbindgen_malloc,J.__wbindgen_realloc),s=Xe;be()[e/4+1]=s,be()[e/4+0]=i},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(Y(t)),o=Xt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),i=Xe;be()[e/4+1]=i,be()[e/4+0]=o},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Y(e);return ge(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=Y(e)[Y(t)];return ge(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(Y(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(Y(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(Y(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(Y(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(Y(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=Y(e)[t>>>0];return ge(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return Y(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Y(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=Y(e).next;return ge(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Cn(function(e){const t=Y(e).next();return ge(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return Y(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=Y(e).value;return ge(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ge(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Cn(function(e,t){const n=Reflect.get(Y(e),Y(t));return ge(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Cn(function(e,t){const n=Y(e).call(Y(t));return ge(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(Y(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=Y(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=Y(e).buffer;return ge(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(Y(e));return ge(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){Y(e).set(Y(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return Y(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=Y(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Y(t).stack,o=Xt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),i=Xe;be()[e/4+1]=i,be()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(pt(e,t))}finally{J.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=Xn(Y(t)),o=Xt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),i=Xe;be()[e/4+1]=i,be()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(pt(e,t))},r.wbg.__wbindgen_memory=function(){const e=J.memory;return ge(e)},r}function ha(r,e){return J=r.exports,Do.__wbindgen_wasm_module=e,en=new Float64Array,tn=new Int32Array,Qt=new Uint8Array,J}async function Do(r){typeof r>"u"&&(r="/atip/source_layer_helpers/assets/route_snapper_bg.wasm");const e=pa();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await ca(await r,e);return ha(t,n)}const Mt="route-snapper",Kr=10,da=30;class ma{constructor(e,t){oe(this,"map");oe(this,"inner");oe(this,"active");oe(this,"eventListenersSuccessRoute");oe(this,"eventListenersSuccessArea");oe(this,"eventListenersFailure");oe(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new hn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],vt(e,Mt,{type:"geojson",data:qe()}),ke(e,{id:"route-points",source:Mt,filter:gn,...wt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Kr/2,Kr])}),ke(e,{id:"route-lines",source:Mt,filter:bn,...Nt("black",2.5)}),ke(e,{id:"route-polygons",source:Mt,filter:yn,...Zn("black",.5)}),this.events=new rr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-da,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Mt).setData(JSON.parse(this.inner.renderGeojson()))}}function _a(r){let e,t,n,o,i,s,a,l;return{c(){e=E("button"),t=E("img"),o=R(),i=K(r[2]),Tn(t.src,n=r[3])||C(t,"src",n),C(t,"alt",r[2]),C(t,"class","svelte-1vvpkg9"),C(e,"type","button"),e.disabled=s=r[0]==r[1],C(e,"class","svelte-1vvpkg9")},m(u,p){w(u,e,p),S(e,t),S(e,o),S(e,i),a||(l=U(e,"click",r[5]),a=!0)},p(u,[p]){p&8&&!Tn(t.src,n=u[3])&&C(t,"src",n),p&4&&C(t,"alt",u[2]),p&4&&Fe(i,u[2]),p&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:H,o:H,d(u){u&&k(e),a=!1,l()}}}function ga(r,e,t){let{mode:n}=e,{thisMode:o}=e,{label:i}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(o);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,o=u.thisMode),"label"in u&&t(2,i=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,o,i,s,a,l]}class Qe extends Z{constructor(e){super(),Q(this,e,ga,_a,W,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function Zr(r){let e;function t(i,s){return i[1]?ya:ba}let n=t(r),o=n(r);return{c(){o.c(),e=me()},m(i,s){o.m(i,s),w(i,e,s)},p(i,s){n!==(n=t(i))&&(o.d(1),o=n(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){o.d(i),i&&k(e)}}}function ba(r){let e;return{c(){e=E("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function ya(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function va(r){let e,t=r[0]==ht&&Zr(r);return{c(){t&&t.c(),e=me()},m(n,o){t&&t.m(n,o),w(n,e,o)},p(n,[o]){n[0]==ht?t?t.p(n,o):(t=Zr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:H,o:H,d(n){t&&t.d(n),n&&k(e)}}}const ht="edit-attribute";function jo(){}function wa(r,e,t){let n,o,i,s;le(r,Ae,f=>t(5,n=f)),le(r,te,f=>t(6,o=f)),le(r,Dt,f=>t(7,i=f)),le(r,Se,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){Se.set(null)}n.on("mousemove",p),n.on("mouseout",m),n.on("click",c),it(()=>{n.off("mousemove",p),n.off("mouseout",m),n.off("click",c)});function p(f){var d;if(a==ht){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});De.set(((d=g[0])==null?void 0:d.id)||null)}}function m(){a==ht&&De.set(null)}function c(f){if(a==ht){let d=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});d.length>0?Se.set(d[0].id):Se.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=i;if(f){let d=o.features.find(g=>g.id==f);d.geometry.type=="Point"?n.flyTo({center:d.geometry.coordinates,duration:500}):n.fitBounds(Kn(d),{padding:200,duration:500}),l(ht)}}},[a,s,l,jo,u,n,o,i]}class ka extends Z{constructor(e){super(),Q(this,e,wa,va,W,{mode:0,changeMode:2,start:3,stop:4})}get start(){return jo}get stop(){return this.$$.ctx[4]}}function Sa(r){let e,t;return{c:H,m(n,o){e||(t=U(window,"keydown",r[0]),e=!0)},p:H,i:H,o:H,d(n){e=!1,t()}}}function Ea(r,e,t){let{tool:n}=e;function o(i){i.key=="Escape"&&(n.cancel(),i.preventDefault())}return r.$$set=i=>{"tool"in i&&t(1,n=i.tool)},[o,n]}class kn extends Z{constructor(e){super(),Q(this,e,Ea,Sa,W,{tool:1})}}function Ma(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function $a(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Oa(r){let e,t,n,o,i,s,a,l,u,p;function m(d,g){return d[1]?$a:Ma}let c=m(r),f=c(r);return a=new kn({props:{tool:r[0]}}),{c(){e=E("ul"),f.c(),t=R(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",o=R(),i=E("button"),i.textContent="Cancel",s=R(),N(a.$$.fragment),C(i,"type","button")},m(d,g){w(d,e,g),f.m(e,null),S(e,t),S(e,n),w(d,o,g),w(d,i,g),w(d,s,g),B(a,d,g),l=!0,u||(p=U(i,"click",r[2]),u=!0)},p(d,[g]){c!==(c=m(d))&&(f.d(1),f=c(d),f&&(f.c(),f.m(e,t)));const _={};g&1&&(_.tool=d[0]),a.$set(_)},i(d){l||($(a.$$.fragment,d),l=!0)},o(d){L(a.$$.fragment,d),l=!1},d(d){d&&k(e),f.d(),d&&k(o),d&&k(i),d&&k(s),D(a,d),u=!1,p()}}}function La(r,e,t){let{pointTool:n}=e,{editingExisting:o}=e;const i=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,o=s.editingExisting)},[n,o,i]}class qo extends Z{constructor(e){super(),Q(this,e,La,Oa,W,{pointTool:0,editingExisting:1})}}function Ca(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function Aa(r){let e,t,n,o,i,s,a,l,u,p,m;return e=new wn({props:{label:"Help",$$slots:{default:[Ca]},$$scope:{ctx:r}}}),l=new kn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=R(),n=E("div"),o=E("button"),o.textContent="Finish",i=R(),s=E("button"),s.textContent="Cancel",a=R(),N(l.$$.fragment),C(o,"type","button"),C(s,"type","button"),he(n,"display","flex"),he(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,o),S(n,i),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(m=[U(o,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const d={};f&8&&(d.$$scope={dirty:f,ctx:c}),e.$set(d);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){L(e.$$.fragment,c),L(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Ce(m)}}}function Ra(r,e,t){let{polygonTool:n}=e;const o=()=>n.finish(),i=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,o,i]}class Uo extends Z{constructor(e){super(),Q(this,e,Ra,Aa,W,{polygonTool:0})}}function Ta(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function Ia(r){let e,t,n,o,i,s,a,l,u,p,m;return e=new wn({props:{label:"Help",$$slots:{default:[Ta]},$$scope:{ctx:r}}}),l=new kn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=R(),n=E("div"),o=E("button"),o.textContent="Finish",i=R(),s=E("button"),s.textContent="Cancel",a=R(),N(l.$$.fragment),C(o,"type","button"),C(s,"type","button"),he(n,"display","flex"),he(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,o),S(n,i),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(m=[U(o,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const d={};f&8&&(d.$$scope={dirty:f,ctx:c}),e.$set(d);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){L(e.$$.fragment,c),L(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Ce(m)}}}function Pa(r,e,t){let{routeTool:n}=e;const o=()=>n.finish(),i=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,o,i]}class Go extends Z{constructor(e){super(),Q(this,e,Pa,Ia,W,{routeTool:0})}}function Fa(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function xa(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,g;return e=new wn({props:{label:"Help",$$slots:{default:[Fa]},$$scope:{ctx:r}}}),c=new kn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=R(),n=E("label"),o=E("input"),i=K(`
  Avoid doubling back`),s=R(),a=E("div"),l=E("button"),l.textContent="Finish",u=R(),p=E("button"),p.textContent="Cancel",m=R(),N(c.$$.fragment),C(o,"type","checkbox"),C(l,"type","button"),C(p,"type","button"),he(a,"display","flex"),he(a,"justify-content","space-between")},m(_,y){B(e,_,y),w(_,t,y),w(_,n,y),S(n,o),o.checked=r[1],S(n,i),w(_,s,y),w(_,a,y),S(a,l),S(a,u),S(a,p),w(_,m,y),B(c,_,y),f=!0,d||(g=[U(o,"change",r[2]),U(l,"click",r[3]),U(p,"click",r[4])],d=!0)},p(_,[y]){const h={};y&32&&(h.$$scope={dirty:y,ctx:_}),e.$set(h),y&2&&(o.checked=_[1]);const b={};y&1&&(b.tool=_[0]),c.$set(b)},i(_){f||($(e.$$.fragment,_),$(c.$$.fragment,_),f=!0)},o(_){L(e.$$.fragment,_),L(c.$$.fragment,_),f=!1},d(_){D(e,_),_&&k(t),_&&k(n),_&&k(s),_&&k(a),_&&k(m),D(c,_),d=!1,Ce(g)}}}function Na(r,e,t){let{routeTool:n}=e,o=!1;function i(){o=this.checked,t(1,o)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:o})},[n,o,i,s,a]}class Ho extends Z{constructor(e){super(),Q(this,e,Na,xa,W,{routeTool:0})}}function Qr(r){let e,t,n,o;const i=[Ua,qa,ja,Da,Ba],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=i[e](r),{c(){t.c(),n=me()},m(l,u){s[e].m(l,u),w(l,n,u),o=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(ce(),L(s[p],1,1,()=>{s[p]=null}),pe(),t=s[e],t?t.p(l,u):(t=s[e]=i[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){o||($(t),o=!0)},o(l){L(t),o=!1},d(l){s[e].d(l),l&&k(n)}}}function Ba(r){let e;return{c(){e=E("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){w(t,e,n)},p:H,i:H,o:H,d(t){t&&k(e)}}}function Da(r){let e,t;return e=new Ho({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.routeTool=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ja(r){let e,t;return e=new Go({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.routeTool=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function qa(r){let e,t;return e=new Uo({props:{polygonTool:r[2]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&4&&(i.polygonTool=n[2]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ua(r){let e,t;return e=new qo({props:{pointTool:r[1],editingExisting:!0}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.pointTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ga(r){let e,t,n=r[0]==Ue&&Qr(r);return{c(){n&&n.c(),e=me()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==Ue?n?(n.p(o,i),i&1&&$(n,1)):(n=Qr(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ce(),L(n,1,1,()=>{n=null}),pe())},i(o){t||($(n),t=!0)},o(o){L(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const Ue="edit-geometry";function zo(){}function Ha(r,e,t){let n;le(r,Ae,g=>t(8,n=g));let{mode:o}=e,{pointTool:i}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(i.stop(),s.stop(),a.stop(),te.update(g=>{let _=g.features.find(y=>y.id==l);return delete _.properties.hide_while_editing,g})),l=null,t(4,u=null),De.set(null)}n.on("mousemove",m),n.on("mouseout",c),n.on("click",f),it(()=>{n.off("mousemove",m),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(g=>{o==Ue&&(te.update(_=>{let y=_.features.find(h=>h.id==l);return y.properties.length_meters=g.properties.length_meters,y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,_}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{o==Ue&&(te.update(_=>{let y=_.features.find(h=>h.id==l);return y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,_}),l=null,t(4,u=null))});for(let g of[i,s])g.addEventListenerSuccess(_=>{o==Ue&&(te.update(y=>{let h=y.features.find(b=>b.id==l);return h.geometry=_.geometry,delete h.properties.hide_while_editing,y}),l=null,t(4,u=null))});for(let g of[i,s,a])g.addEventListenerFailure(()=>{o==Ue&&(te.update(_=>{let y=_.features.find(h=>h.id==l);return delete y.properties.hide_while_editing,_}),l=null,t(4,u=null))});function m(g){var _;if(o==Ue&&l==null){let y=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});De.set(((_=y[0])==null?void 0:_.id)||null)}}function c(){o==Ue&&l==null&&De.set(null)}function f(g){if(o==Ue&&l==null){let _=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&d(_[0].id)}}function d(g){De.set(null);let _=null;te.update(h=>(_=h.features.find(b=>b.id==g),_.properties.hide_while_editing=!0,h));let y=_;l=g,y.geometry.type=="LineString"?(a.editExistingRoute(y),t(4,u="route")):y.geometry.type=="Polygon"?y.properties.waypoints?(a.editExistingArea(y),t(4,u="snap-polygon")):(s.editExisting(y),t(4,u="free-polygon")):y.geometry.type=="Point"&&(i.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"pointTool"in g&&t(1,i=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[o,i,s,a,u,zo,p]}class za extends Z{constructor(e){super(),Q(this,e,Ha,Ga,W,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return zo}get stop(){return this.$$.ctx[6]}}async function Ya(r,e){const t=await fetch(r),n=t.body.getReader(),o=t.headers.get("Content-Length");let i=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),i+=p.length;const m=100*i/o;e.style=`background: linear-gradient(to right, red ${m}%, transparent 0);`}let a=new Uint8Array(i),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function Ja(r){let e,t;return e=new Ho({props:{routeTool:r[0]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&1&&(i.routeTool=n[0]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Xa(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:H,i:H,o:H,d(t){t&&k(e),r[7](null)}}}function Wa(r){let e,t,n,o;const i=[Xa,Ja],s=[];function a(l,u){return l[0]?l[1]==Wn?1:-1:0}return~(e=a(r))&&(t=s[e]=i[e](r)),{c(){t&&t.c(),n=me()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),o=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(ce(),L(s[p],1,1,()=>{s[p]=null}),pe()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=i[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){o||($(t),o=!0)},o(l){L(t),o=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const Wn="route";function Va(r,e,t){let n;le(r,Ae,c=>t(8,n=c));let{mode:o}=e,{changeMode:i}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}yt(async()=>{await Do(),console.log(`Grabbing ${s}`);try{const c=await Ya(s,a);t(0,l=new ma(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{o==Wn&&i("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{o==Wn&&(te.update(f=>(c.id=Gt(f),c.properties.intervention_type="route",f.features.push(c),f)),i("edit-attribute"),Se.set(c.id))})});function m(c){ae[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,o=c.mode),"changeMode"in c&&t(3,i=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,o,a,i,s,u,p,m]}class Ka extends Z{constructor(e){super(),Q(this,e,Va,Wa,W,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function eo(r){let e,t;return e=new qo({props:{pointTool:r[1],editingExisting:!1}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.pointTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Za(r){let e,t,n=r[0]==dn&&eo(r);return{c(){n&&n.c(),e=me()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==dn?n?(n.p(o,i),i&1&&$(n,1)):(n=eo(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ce(),L(n,1,1,()=>{n=null}),pe())},i(o){t||($(n),t=!0)},o(o){L(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const dn="point";function Qa(r,e,t){let{mode:n}=e,{changeMode:o}=e,{pointTool:i}=e;function s(){i.start()}function a(){i.stop()}return i.addEventListenerSuccess(l=>{n==dn&&(te.update(u=>(l.id=Gt(u),l.properties.intervention_type="other",u.features.push(l),u)),o("edit-attribute"),Se.set(l.id))}),i.addEventListenerFailure(()=>{n==dn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"pointTool"in l&&t(1,i=l.pointTool)},[n,i,o,s,a]}class eu extends Z{constructor(e){super(),Q(this,e,Qa,Za,W,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function to(r){let e,t;return e=new Uo({props:{polygonTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.polygonTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function tu(r){let e,t,n=r[0]==mn&&to(r);return{c(){n&&n.c(),e=me()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==mn?n?(n.p(o,i),i&1&&$(n,1)):(n=to(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ce(),L(n,1,1,()=>{n=null}),pe())},i(o){t||($(n),t=!0)},o(o){L(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const mn="free-polygon";function nu(r,e,t){let{mode:n}=e,{changeMode:o}=e,{polygonTool:i}=e;function s(){i.startNew()}function a(){i.stop()}return i.addEventListenerSuccess(l=>{n==mn&&(te.update(u=>(l.id=Gt(u),l.properties.intervention_type="area",u.features.push(l),u)),o("edit-attribute"),Se.set(l.id))}),i.addEventListenerFailure(()=>{n==mn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"polygonTool"in l&&t(1,i=l.polygonTool)},[n,i,o,s,a]}class ru extends Z{constructor(e){super(),Q(this,e,nu,tu,W,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function no(r){let e,t;return e=new Go({props:{routeTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.routeTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ou(r){let e,t,n=r[0]==_n&&no(r);return{c(){n&&n.c(),e=me()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==_n?n?(n.p(o,i),i&1&&$(n,1)):(n=no(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ce(),L(n,1,1,()=>{n=null}),pe())},i(o){t||($(n),t=!0)},o(o){L(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const _n="snap-polygon";function iu(r,e,t){let{mode:n}=e,{changeMode:o}=e,{routeTool:i}=e;function s(){i.startArea()}function a(){i.stop()}return i.addEventListenerSuccessArea(l=>{n==_n&&(te.update(u=>(l.id=Gt(u),l.properties.intervention_type="area",u.features.push(l),u)),o("edit-attribute"),Se.set(l.id))}),i.addEventListenerFailure(()=>{n==_n&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"routeTool"in l&&t(1,i=l.routeTool)},[n,i,o,s,a]}class su extends Z{constructor(e){super(),Q(this,e,iu,ou,W,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function lu(r){var e=r[0],t=r[1],n=r[2],o=r[3],i=Ye(r.slice(0,2),[n,t]),s=Ye(r.slice(0,2),[e,o]);if(i>=s){var a=(t+o)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(o-t)/2,t,l+(o-t)/2,o]}}function au(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,o=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(o===!1||o===void 0)&&(r=JSON.parse(JSON.stringify(r)));var i=Math.pow(10,t);return ci(r,function(s){uu(s,i,n)}),r}function uu(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function fu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Hn(r),n=Hn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var o=au(e,{precision:7});switch(n){case"Point":return Vn(r,o);case"MultiPoint":return ro(r,o);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return ro(r,No(r,o))}}function ro(r,e){var t=[],n=bt();return Qn(e,function(o){if(t.forEach(function(a,l){a.id=l}),!t.length)t=Vn(r,o).features,t.forEach(function(a){a.bbox||(a.bbox=lu(pi(a)))}),n.load(We(t));else{var i=n.search(o);if(i.features.length){var s=Yo(o,i);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),sn(Vn(s,o),function(a){t.push(a),n.insert(a)})}}}),We(t)}function Vn(r,e){var t=[],n=je(r)[0],o=je(r)[r.geometry.coordinates.length-1];if(An(n,Ve(e))||An(o,Ve(e)))return We([r]);var i=bt(),s=zn(r);i.load(s);var a=i.search(e);if(!a.features.length)return We([r]);var l=Yo(e,a),u=[n],p=hi(s,function(m,c,f){var d=je(c)[1],g=Ve(e);return f===l.id?(m.push(g),t.push(_t(m)),An(g,d)?[g]:[g,d]):(m.push(d),m)},u);return p.length>1&&t.push(_t(p)),We(t)}function Yo(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return sn(e,function(o){var i=qt(o,r),s=i.properties.dist;s<n&&(t=o,n=s)}),t}function An(r,e){return r[0]===e[0]&&r[1]===e[1]}function cu(r,e,t){var n=je(t);if(Hn(t)!=="LineString")throw new Error("line must be a LineString");var o=qt(t,r),i=qt(t,e),s;o.properties.index<=i.properties.index?s=[o,i]:s=[i,o];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),_t(a,t.properties)}function oo(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function pu(r){let e,t,n,o=r[0]==xt&&oo();return{c(){o&&o.c(),e=me()},m(i,s){o&&o.m(i,s),w(i,e,s),t||(n=U(window,"keydown",r[1]),t=!0)},p(i,[s]){i[0]==xt?o||(o=oo(),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null)},i:H,o:H,d(i){o&&o.d(i),i&&k(e),t=!1,n()}}}const xt="split-route",hu=10,du=30;let Rn="split-route";function Jo(){}function io(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function mu(r,e,t){let n,o;le(r,te,g=>t(8,n=g)),le(r,Ae,g=>t(6,o=g));let{mode:i}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;o.on("mousemove",p),o.on("click",m),it(()=>{o.off("mousemove",p),o.off("click",m)}),vt(o,Rn,{type:"geojson",data:qe()}),ke(o,{id:"draw-split-route",source:Rn,...wt("black",hu,["case",["==",["get","snapped"],!0],1,.5])});function p(g){if(i!=xt)return;t(5,l=io(g.lngLat.toArray(),!1)),u=null;const _=[g.point.x-du,g.point.y],y=o.unproject(g.point).distanceTo(o.unproject(_))/1e3;let h=[];for(let[b,v]of n.features.entries())if(v.geometry.type=="LineString"){let M=qt(v.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=y&&h.push([b,M.geometry.coordinates,M.properties.dist])}h.sort((b,v)=>b[2]-v[2]),h.length>0&&(t(5,l=io(h[0][1],!0)),u=h[0][0])}function m(){if(i==xt)if(u==null)s("edit-attribute");else{let g=fu(n.features[u],l);if(g.features.length==2){let _=g.features[0],y=g.features[1];te.update(h=>(_.id=h.features[u].id,y.id=Gt(h),_.properties=JSON.parse(JSON.stringify(h.features[u].properties)),y.properties=JSON.parse(JSON.stringify(_.properties)),c(h.features[u],_,y,l),h.features.splice(u,1,_,y),h))}a()}}function c(g,_,y,h){_.properties.length_meters=Zt(_,{units:"kilometers"})*1e3,y.properties.length_meters=Zt(y,{units:"kilometers"})*1e3,_.properties.waypoints=[],y.properties.waypoints=[];let b=f(g,h),v=!0,M=0;for(let O of g.properties.waypoints){let I=f(g,dt([O.lon,O.lat]));if(v)if(I<b)_.properties.waypoints.push(O);else{let A=O.snapped&&g.properties.waypoints[M-1].snapped;_.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:A}),v=!1,y.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:A}),y.properties.waypoints.push(O)}else y.properties.waypoints.push(O);M++}}function f(g,_){let y=g.geometry.coordinates[0],h=cu(y,_,g);return Zt(h,{units:"kilometers"})*1e3}function d(g){i==xt&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=qe();l&&g.features.push(l),o.getSource(Rn).setData(g)}},[i,d,s,Jo,a,l,o]}class _u extends Z{constructor(e){super(),Q(this,e,mu,pu,W,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Jo}get stop(){return this.$$.ctx[4]}}const gu="/atip/source_layer_helpers/assets/edit_attributes-29b396e1.svg",bu="/atip/source_layer_helpers/assets/edit_geometry-02dad294.svg",yu="/atip/source_layer_helpers/assets/point-276f4055.svg",vu="/atip/source_layer_helpers/assets/polygon_snapped-18efbbea.svg",wu="/atip/source_layer_helpers/assets/polygon_freehand-cf965967.svg",ku="/atip/source_layer_helpers/assets/route-d3c0ebad.svg",Su="/atip/source_layer_helpers/assets/split_route-9e0ea2da.svg";function so(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new za({props:n}),r[15](e),{c(){N(e.$$.fragment)},m(o,i){B(e,o,i),t=!0},p(o,i){const s={};i&8&&(s.mode=o[3]),i&4&&(s.routeTool=o[2]),e.$set(s)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){L(e.$$.fragment,o),t=!1},d(o){r[15](null),D(e,o)}}}function lo(r){let e,t;return e=new Qe({props:{mode:r[3],thisMode:"point",label:"New point",icon:yu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ao(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new su({props:n}),r[18](e),{c(){N(e.$$.fragment)},m(o,i){B(e,o,i),t=!0},p(o,i){const s={};i&8&&(s.mode=o[3]),i&4&&(s.routeTool=o[2]),e.$set(s)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){L(e.$$.fragment,o),t=!1},d(o){r[18](null),D(e,o)}}}function uo(r){let e,t;return e=new Qe({props:{mode:r[3],thisMode:"route",label:"New route",icon:ku,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function fo(r){let e,t;return e=new Qe({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:Su,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Eu(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,g,_,y,h,b,v,M,O,I,A,F,T,j,V,P,z,ie,ve;n=new Qe({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:gu,changeMode:r[13]}});let Te={mode:r[3],changeMode:r[13]};i=new ka({props:Te}),r[14](i),l=new Qe({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:bu,changeMode:r[13]}});let re=r[2]&&so(r),ne=r[1]!="planning"&&lo(r),xe={mode:r[3],changeMode:r[13],pointTool:r[11]};f=new eu({props:xe}),r[16](f),_=new Qe({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:wu,changeMode:r[13]}});let Oe={mode:r[3],changeMode:r[13],polygonTool:r[12]};h=new ru({props:Oe}),r[17](h),M=new Qe({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:vu,changeMode:r[13]}});let ee=r[2]&&ao(r),de=r[1]!="planning"&&uo(r);function ye(q){r[20](q)}let x={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(x.routeTool=r[2]),T=new Ka({props:x}),r[19](T),ae.push(()=>Ee(T,"routeTool",ye,r[2]));let G=r[1]!="planning"&&fo(r),Xo={mode:r[3],changeMode:r[13]};return ie=new _u({props:Xo}),r[21](ie),{c(){e=E("div"),t=E("div"),N(n.$$.fragment),o=R(),N(i.$$.fragment),s=R(),a=E("div"),N(l.$$.fragment),u=R(),re&&re.c(),p=R(),m=E("div"),ne&&ne.c(),c=R(),N(f.$$.fragment),d=R(),g=E("div"),N(_.$$.fragment),y=R(),N(h.$$.fragment),b=R(),v=E("div"),N(M.$$.fragment),O=R(),ee&&ee.c(),I=R(),A=E("div"),de&&de.c(),F=R(),N(T.$$.fragment),V=R(),P=E("div"),G&&G.c(),z=R(),N(ie.$$.fragment),C(e,"class","toolbox svelte-4s4d3o")},m(q,ue){w(q,e,ue),S(e,t),B(n,t,null),S(t,o),B(i,t,null),S(e,s),S(e,a),B(l,a,null),S(a,u),re&&re.m(a,null),S(e,p),S(e,m),ne&&ne.m(m,null),S(m,c),B(f,m,null),S(e,d),S(e,g),B(_,g,null),S(g,y),B(h,g,null),S(e,b),S(e,v),B(M,v,null),S(v,O),ee&&ee.m(v,null),S(e,I),S(e,A),de&&de.m(A,null),S(A,F),B(T,A,null),S(e,V),S(e,P),G&&G.m(P,null),S(P,z),B(ie,P,null),ve=!0},p(q,[ue]){const or={};ue&8&&(or.mode=q[3]),n.$set(or);const ir={};ue&8&&(ir.mode=q[3]),i.$set(ir);const sr={};ue&8&&(sr.mode=q[3]),l.$set(sr),q[2]?re?(re.p(q,ue),ue&4&&$(re,1)):(re=so(q),re.c(),$(re,1),re.m(a,null)):re&&(ce(),L(re,1,1,()=>{re=null}),pe()),q[1]!="planning"?ne?(ne.p(q,ue),ue&2&&$(ne,1)):(ne=lo(q),ne.c(),$(ne,1),ne.m(m,c)):ne&&(ce(),L(ne,1,1,()=>{ne=null}),pe());const lr={};ue&8&&(lr.mode=q[3]),f.$set(lr);const ar={};ue&8&&(ar.mode=q[3]),_.$set(ar);const ur={};ue&8&&(ur.mode=q[3]),h.$set(ur);const fr={};ue&8&&(fr.mode=q[3]),M.$set(fr),q[2]?ee?(ee.p(q,ue),ue&4&&$(ee,1)):(ee=ao(q),ee.c(),$(ee,1),ee.m(v,null)):ee&&(ce(),L(ee,1,1,()=>{ee=null}),pe()),q[1]!="planning"?de?(de.p(q,ue),ue&2&&$(de,1)):(de=uo(q),de.c(),$(de,1),de.m(A,F)):de&&(ce(),L(de,1,1,()=>{de=null}),pe());const zt={};ue&8&&(zt.mode=q[3]),ue&1&&(zt.url=q[0]),!j&&ue&4&&(j=!0,zt.routeTool=q[2],Me(()=>j=!1)),T.$set(zt),q[1]!="planning"?G?(G.p(q,ue),ue&2&&$(G,1)):(G=fo(q),G.c(),$(G,1),G.m(P,z)):G&&(ce(),L(G,1,1,()=>{G=null}),pe());const cr={};ue&8&&(cr.mode=q[3]),ie.$set(cr)},i(q){ve||($(n.$$.fragment,q),$(i.$$.fragment,q),$(l.$$.fragment,q),$(re),$(ne),$(f.$$.fragment,q),$(_.$$.fragment,q),$(h.$$.fragment,q),$(M.$$.fragment,q),$(ee),$(de),$(T.$$.fragment,q),$(G),$(ie.$$.fragment,q),ve=!0)},o(q){L(n.$$.fragment,q),L(i.$$.fragment,q),L(l.$$.fragment,q),L(re),L(ne),L(f.$$.fragment,q),L(_.$$.fragment,q),L(h.$$.fragment,q),L(M.$$.fragment,q),L(ee),L(de),L(T.$$.fragment,q),L(G),L(ie.$$.fragment,q),ve=!1},d(q){q&&k(e),D(n),r[14](null),D(i),D(l),re&&re.d(),ne&&ne.d(),r[16](null),D(f),D(_),r[17](null),D(h),D(M),ee&&ee.d(),de&&de.d(),r[19](null),D(T),G&&G.d(),r[21](null),D(ie)}}}function Mu(r,e,t){let n;le(r,Ae,T=>t(22,n=T));let{routeSnapperUrl:o}=e,{schema:i}=e,s,a=new Xl(n),l=new sa(n),u="edit-attribute",p,m,c,f,d,g,_;function y(T){let j={"edit-attribute":p,"edit-geometry":m,route:c,point:f,"free-polygon":d,"snap-polygon":g,"split-route":_};if(u==T){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),j[u].stop(),t(3,u=T),console.log(`Starting new mode ${u}`),j[u].start()}it(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function h(T){ae[T?"unshift":"push"](()=>{p=T,t(4,p)})}function b(T){ae[T?"unshift":"push"](()=>{m=T,t(5,m)})}function v(T){ae[T?"unshift":"push"](()=>{f=T,t(7,f)})}function M(T){ae[T?"unshift":"push"](()=>{d=T,t(8,d)})}function O(T){ae[T?"unshift":"push"](()=>{g=T,t(9,g)})}function I(T){ae[T?"unshift":"push"](()=>{c=T,t(6,c)})}function A(T){s=T,t(2,s)}function F(T){ae[T?"unshift":"push"](()=>{_=T,t(10,_)})}return r.$$set=T=>{"routeSnapperUrl"in T&&t(0,o=T.routeSnapperUrl),"schema"in T&&t(1,i=T.schema)},[o,i,s,u,p,m,c,f,d,g,_,a,l,y,h,b,v,M,O,I,A,F]}class $u extends Z{constructor(e){super(),Q(this,e,Mu,Eu,W,{routeSnapperUrl:0,schema:1})}}function Ou(r){let e,t,n,o,i,s,a,l,u,p,m,c,f,d,g,_,y,h,b;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",o=R(),i=E("button"),i.textContent="About",s=R(),a=E("button"),a.textContent="Instructions",l=R(),u=E("br"),p=R(),m=E("label"),c=K(`ATIP schema:
      `),f=E("select"),d=E("option"),d.textContent="v1",g=E("option"),g.textContent="v2",_=E("option"),_.textContent="Housing developments",y=E("option"),y.textContent="Critical issues",C(n,"type","button"),C(i,"type","button"),C(a,"type","button"),d.__value="v1",d.value=d.__value,g.__value="v2",g.value=g.__value,_.__value="planning",_.value=_.__value,y.__value="criticals",y.value=y.__value,r[2]===void 0&&Ut(()=>r[12].call(f)),C(e,"slot","nav")},m(v,M){w(v,e,M),S(e,t),S(t,n),S(t,o),S(t,i),S(t,s),S(t,a),S(e,l),S(e,u),S(e,p),S(e,m),S(m,c),S(m,f),S(f,d),S(f,g),S(f,_),S(f,y),on(f,r[2]),h||(b=[U(n,"click",r[11]),U(i,"click",r[8]),U(a,"click",r[9]),U(f,"change",r[12]),U(f,"change",r[10])],h=!0)},p(v,M){M&4&&on(f,v[2])},d(v){v&&k(e),h=!1,Ce(b)}}}function Lu(r){let e,t,n,o,i,s,a,l,u,p,m,c;return i=new Tl({props:{boundaryGeojson:r[5]}}),a=new Ll({props:{authorityName:r[6],schema:r[2]}}),m=new Sl({props:{schema:r[2],routeInfo:r[4]}}),{c(){e=E("div"),t=E("h1"),n=K(r[6]),o=R(),N(i.$$.fragment),s=R(),N(a.$$.fragment),l=R(),u=E("br"),p=R(),N(m.$$.fragment),C(e,"slot","sidebar")},m(f,d){w(f,e,d),S(e,t),S(t,n),S(t,o),B(i,t,null),S(e,s),B(a,e,null),S(e,l),S(e,u),S(e,p),B(m,e,null),c=!0},p(f,d){const g={};d&32&&(g.boundaryGeojson=f[5]),i.$set(g);const _={};d&4&&(_.schema=f[2]),a.$set(_);const y={};d&4&&(y.schema=f[2]),d&16&&(y.routeInfo=f[4]),m.$set(y)},i(f){c||($(i.$$.fragment,f),$(a.$$.fragment,f),$(m.$$.fragment,f),c=!0)},o(f){L(i.$$.fragment,f),L(a.$$.fragment,f),L(m.$$.fragment,f),c=!1},d(f){f&&k(e),D(i),D(a),D(m)}}}function Cu(r){let e,t,n,o,i,s,a,l,u,p,m,c;return e=new As({props:{boundaryGeojson:r[5]}}),n=new zl({props:{schema:r[2]}}),i=new Jl({}),a=new $u({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new Fl({props:{style:r[7]}}),m=new Gl({props:{schema:r[2]}}),{c(){N(e.$$.fragment),t=R(),N(n.$$.fragment),o=R(),N(i.$$.fragment),s=R(),N(a.$$.fragment),l=R(),N(u.$$.fragment),p=R(),N(m.$$.fragment)},m(f,d){B(e,f,d),w(f,t,d),B(n,f,d),w(f,o,d),B(i,f,d),w(f,s,d),B(a,f,d),w(f,l,d),B(u,f,d),w(f,p,d),B(m,f,d),c=!0},p(f,d){const g={};d&32&&(g.boundaryGeojson=f[5]),e.$set(g);const _={};d&4&&(_.schema=f[2]),n.$set(_);const y={};d&8&&(y.routeSnapperUrl=f[3]),d&4&&(y.schema=f[2]),a.$set(y);const h={};d&4&&(h.schema=f[2]),m.$set(h)},i(f){c||($(e.$$.fragment,f),$(n.$$.fragment,f),$(i.$$.fragment,f),$(a.$$.fragment,f),$(u.$$.fragment,f),$(m.$$.fragment,f),c=!0)},o(f){L(e.$$.fragment,f),L(n.$$.fragment,f),L(i.$$.fragment,f),L(a.$$.fragment,f),L(u.$$.fragment,f),L(m.$$.fragment,f),c=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(o),D(i,f),f&&k(s),D(a,f),f&&k(l),D(u,f),f&&k(p),D(m,f)}}}function Au(r){let e,t,n;return t=new Hi({props:{style:r[7],$$slots:{default:[Cu]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),C(e,"slot","main")},m(o,i){w(o,e,i),B(t,e,null),n=!0},p(o,i){const s={};i&524332&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||($(t.$$.fragment,o),n=!0)},o(o){L(t.$$.fragment,o),n=!1},d(o){o&&k(e),D(t)}}}function Ru(r){let e,t,n,o,i,s,a,l;e=new Vi({props:{$$slots:{main:[Au],sidebar:[Lu],nav:[Ou]},$$scope:{ctx:r}}});function u(f){r[13](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new di({props:p}),ae.push(()=>Ee(n,"open",u,r[0]));function m(f){r[14](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new qi({props:c}),ae.push(()=>Ee(s,"open",m,r[1])),{c(){N(e.$$.fragment),t=R(),N(n.$$.fragment),i=R(),N(s.$$.fragment)},m(f,d){B(e,f,d),w(f,t,d),B(n,f,d),w(f,i,d),B(s,f,d),l=!0},p(f,[d]){const g={};d&524348&&(g.$$scope={dirty:d,ctx:f}),e.$set(g);const _={};!o&&d&1&&(o=!0,_.open=f[0],Me(()=>o=!1)),n.$set(_);const y={};!a&&d&2&&(a=!0,y.open=f[1],Me(()=>a=!1)),s.$set(y)},i(f){l||($(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!0)},o(f){L(e.$$.fragment,f),L(n.$$.fragment,f),L(s.$$.fragment,f),l=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(i),D(s,f)}}}function Tu(r,e,t){let n=!1,o=!1,i=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${a}.bin`,m=`https://atip.uk/route-info/${a}.bin`;i||(p=`https://atip.uk/route-snappers-dev/${a}.bin`,m=`https://atip.uk/route-info-dev/${a}.bin`);let c;function f(){t(0,n=!n),t(1,o=!1)}function d(){t(1,o=!o),t(0,n=!1)}let g;yt(async()=>{t(5,g=await _());const O=yo(new Li);t(4,c=await new O),await c.loadFile(m)});async function _(){const I=await(await fetch(mi)).text(),A=JSON.parse(I);return A.features=A.features.filter(F=>{var T;return((T=F.properties)==null?void 0:T.name)==a}),A}function y(){let O=new URLSearchParams(window.location.search);O.set("schema",u);let I=`${window.location.pathname}?${O.toString()}${window.location.hash}`;window.location.href=I}const h=()=>window.open("index.html");function b(){u=ho(this),t(2,u)}function v(O){n=O,t(0,n)}function M(O){o=O,t(1,o)}return[n,o,u,p,c,g,a,l,f,d,y,h,b,v,M]}class Iu extends Z{constructor(e){super(),Q(this,e,Tu,Ru,W,{})}}new Iu({target:document.getElementById("app")});
