var ti=Object.defineProperty;var ni=(r,e,t)=>e in r?ti(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ie=(r,e,t)=>(ni(r,typeof e!="symbol"?e+"":e,t),t);import{S as V,i as K,s as Y,M as ri,b as ae,a as Ee,d as x,m as B,k as Me,n as $,o as L,q as D,e as E,c as R,g as w,x as G,p as k,y as Pe,f as O,z as ue,B as fe,C as oi,D as Jt,E as en,F as ot,G as mt,H as _t,I as gt,J as bt,K as gr,h as S,l as U,L as ii,N as si,O as se,P as li,w as rr,Q as Qe,R as we,T as Sn,U as fn,V as ce,t as W,W as cn,X as yt,Y as be,Z as it,_ as Ke,$ as En,j as Oe,r as Ce,a0 as Ne,a1 as yo,a2 as wt,a3 as pn,a4 as br,a5 as ai,a6 as ui,a7 as Te,a8 as fi,a9 as ci,aa as Mn,ab as Mt,ac as $n,ad as Ln,ae as jn,af as pi,ag as vt,ah as or,ai as We,aj as kt,ak as di,al as ir,am as hi,an as mi,ao as _i,ap as vr,aq as dn,ar as gi,as as bi,at as vi,A as yi,u as wi}from"./authorities-0f28c723.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const wo=Symbol("Comlink.proxy"),ki=Symbol("Comlink.endpoint"),Si=Symbol("Comlink.releaseProxy"),In=Symbol("Comlink.finalizer"),tn=Symbol("Comlink.thrown"),ko=r=>typeof r=="object"&&r!==null||typeof r=="function",Ei={canHandle:r=>ko(r)&&r[wo],serialize(r){const{port1:e,port2:t}=new MessageChannel;return sr(r,e),[t,[t]]},deserialize(r){return r.start(),Mo(r)}},Mi={canHandle:r=>ko(r)&&tn in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},So=new Map([["proxy",Ei],["throw",Mi]]);function $i(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function sr(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!$i(t,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:s,path:a}=Object.assign({path:[]},o.data),l=(o.data.argumentList||[]).map(et);let u;try{const p=a.slice(0,-1).reduce((c,f)=>c[f],r),d=a.reduce((c,f)=>c[f],r);switch(s){case"GET":u=d;break;case"SET":p[a.slice(-1)[0]]=et(o.data.value),u=!0;break;case"APPLY":u=d.apply(p,l);break;case"CONSTRUCT":{const c=new d(...l);u=Ai(c)}break;case"ENDPOINT":{const{port1:c,port2:f}=new MessageChannel;sr(r,f),u=Ii(c,[c])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[tn]:0}}Promise.resolve(u).catch(p=>({value:p,[tn]:0})).then(p=>{const[d,c]=_n(p);e.postMessage(Object.assign(Object.assign({},d),{id:i}),c),s==="RELEASE"&&(e.removeEventListener("message",n),Eo(e),In in r&&typeof r[In]=="function"&&r[In]())}).catch(p=>{const[d,c]=_n({value:new TypeError("Unserializable return value"),[tn]:0});e.postMessage(Object.assign(Object.assign({},d),{id:i}),c)})}),e.start&&e.start()}function Li(r){return r.constructor.name==="MessagePort"}function Eo(r){Li(r)&&r.close()}function Mo(r,e){return qn(r,[],e)}function Kt(r){if(r)throw new Error("Proxy has been released and is not useable")}function $o(r){return pt(r,{type:"RELEASE"}).then(()=>{Eo(r)})}const hn=new WeakMap,mn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(hn.get(r)||0)-1;hn.set(r,e),e===0&&$o(r)});function Oi(r,e){const t=(hn.get(e)||0)+1;hn.set(e,t),mn&&mn.register(r,e,r)}function Ci(r){mn&&mn.unregister(r)}function qn(r,e=[],t=function(){}){let n=!1;const o=new Proxy(t,{get(i,s){if(Kt(n),s===Si)return()=>{Ci(o),$o(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>o};const a=pt(r,{type:"GET",path:e.map(l=>l.toString())}).then(et);return a.then.bind(a)}return qn(r,[...e,s])},set(i,s,a){Kt(n);const[l,u]=_n(a);return pt(r,{type:"SET",path:[...e,s].map(p=>p.toString()),value:l},u).then(et)},apply(i,s,a){Kt(n);const l=e[e.length-1];if(l===ki)return pt(r,{type:"ENDPOINT"}).then(et);if(l==="bind")return qn(r,e.slice(0,-1));const[u,p]=yr(a);return pt(r,{type:"APPLY",path:e.map(d=>d.toString()),argumentList:u},p).then(et)},construct(i,s){Kt(n);const[a,l]=yr(s);return pt(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(et)}});return Oi(o,r),o}function Ri(r){return Array.prototype.concat.apply([],r)}function yr(r){const e=r.map(_n);return[e.map(t=>t[0]),Ri(e.map(t=>t[1]))]}const Lo=new WeakMap;function Ii(r,e){return Lo.set(r,e),r}function Ai(r){return Object.assign(r,{[wo]:!0})}function _n(r){for(const[e,t]of So)if(t.canHandle(r)){const[n,o]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:r},Lo.get(r)||[]]}function et(r){switch(r.type){case"HANDLER":return So.get(r.name).deserialize(r.value);case"RAW":return r.value}}function pt(r,e,t){return new Promise(n=>{const o=Ti();r.addEventListener("message",function i(s){!s.data||!s.data.id||s.data.id!==o||(r.removeEventListener("message",i),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:o},e),t)})}function Ti(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Fi(){return new Worker("/atip/speed_limit/assets/worker-3cbf056e.js")}let ee;const Oo=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Oo.decode();let Rt=null;function Pt(){return(Rt===null||Rt.byteLength===0)&&(Rt=new Uint8Array(ee.memory.buffer)),Rt}function tt(r,e){return r=r>>>0,Oo.decode(Pt().subarray(r,r+e))}const Ge=new Array(128).fill(void 0);Ge.push(void 0,null,!0,!1);let Nt=Ge.length;function ge(r){Nt===Ge.length&&Ge.push(Ge.length+1);const e=Nt;return Nt=Ge[e],Ge[e]=r,e}function z(r){return Ge[r]}let rt=0;const nn=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Pi=typeof nn.encodeInto=="function"?function(r,e){return nn.encodeInto(r,e)}:function(r,e){const t=nn.encode(r);return e.set(t),{read:r.length,written:t.length}};function An(r,e,t){if(t===void 0){const a=nn.encode(r),l=e(a.length)>>>0;return Pt().subarray(l,l+a.length).set(a),rt=a.length,l}let n=r.length,o=e(n)>>>0;const i=Pt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;i[o+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),o=t(o,n,n=s+r.length*3)>>>0;const a=Pt().subarray(o+s,o+n),l=Pi(r,a);s+=l.written}return rt=s,o}function Lt(r){return r==null}let It=null;function de(){return(It===null||It.byteLength===0)&&(It=new Int32Array(ee.memory.buffer)),It}function Ni(r){r<132||(Ge[r]=Nt,Nt=r)}function At(r){const e=z(r);return Ni(r),e}let Tt=null;function xi(){return(Tt===null||Tt.byteLength===0)&&(Tt=new Float64Array(ee.memory.buffer)),Tt}let Ft=null;function Bi(){return(Ft===null||Ft.byteLength===0)&&(Ft=new BigInt64Array(ee.memory.buffer)),Ft}function Un(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let i="[";o>0&&(i+=Un(r[0]));for(let s=1;s<o;s++)i+=", "+Un(r[s]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Di(r,e){const t=e(r.length*1)>>>0;return Pt().set(r,t/1),rt=r.length,t}function Tn(r,e){try{return r.apply(this,e)}catch(t){ee.__wbindgen_exn_store(ge(t))}}let Gn=class{static __wrap(e){e=e>>>0;const t=Object.create(Gn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();ee.__wbg_routeinfo_free(e)}constructor(e){try{const i=ee.__wbindgen_add_to_stack_pointer(-16),s=Di(e,ee.__wbindgen_malloc),a=rt;ee.routeinfo_new(i,s,a);var t=de()[i/4+0],n=de()[i/4+1],o=de()[i/4+2];if(o)throw At(n);return Gn.__wrap(t)}finally{ee.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const p=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_nameForRoute(p,this.__wbg_ptr,ge(e));var o=de()[p/4+0],i=de()[p/4+1],s=de()[p/4+2],a=de()[p/4+3],l=o,u=i;if(a)throw l=0,u=0,At(s);return t=l,n=u,tt(l,u)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const p=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_speedLimitForRoute(p,this.__wbg_ptr,ge(e));var o=de()[p/4+0],i=de()[p/4+1],s=de()[p/4+2],a=de()[p/4+3],l=o,u=i;if(a)throw l=0,u=0,At(s);return t=l,n=u,tt(l,u)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(t,n)}}allSpeedLimits(){let e,t;try{const u=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_allSpeedLimits(u,this.__wbg_ptr);var n=de()[u/4+0],o=de()[u/4+1],i=de()[u/4+2],s=de()[u/4+3],a=n,l=o;if(s)throw a=0,l=0,At(i);return e=a,t=l,tt(a,l)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(e,t)}}};async function ji(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function qi(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=tt(e,t);return ge(n)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(tt(e,t));return ge(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=z(t),o=typeof n=="string"?n:void 0;var i=Lt(o)?0:An(o,ee.__wbindgen_malloc,ee.__wbindgen_realloc),s=rt;de()[e/4+1]=s,de()[e/4+0]=i},r.wbg.__wbindgen_object_drop_ref=function(e){At(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=z(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof z(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return ge(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return z(e)===z(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=z(t),o=typeof n=="number"?n:void 0;xi()[e/8+1]=Lt(o)?0:o,de()[e/4+0]=!Lt(o)},r.wbg.__wbindgen_is_object=function(e){const t=z(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return z(e)in z(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ge(t)},r.wbg.__wbindgen_is_undefined=function(e){return z(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return z(e)==z(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=z(e);return ge(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=z(e)[z(t)];return ge(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=z(t).stack,o=An(n,ee.__wbindgen_malloc,ee.__wbindgen_realloc),i=rt;de()[e/4+1]=i,de()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(tt(e,t))}finally{ee.__wbindgen_free(n,o)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(z(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(z(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(z(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(z(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(z(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=z(e)[t>>>0];return ge(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return z(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof z(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=z(e).next;return ge(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return Tn(function(e){const t=z(e).next();return ge(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return z(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=z(e).value;return ge(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return ge(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return Tn(function(e,t){const n=Reflect.get(z(e),z(t));return ge(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return Tn(function(e,t){const n=z(e).call(z(t));return ge(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(z(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=z(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(z(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(z(e));return ge(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=z(e).buffer;return ge(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(z(e));return ge(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){z(e).set(z(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return z(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=z(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=z(t),o=typeof n=="bigint"?n:void 0;Bi()[e/8+1]=Lt(o)?BigInt(0):o,de()[e/4+0]=!Lt(o)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Un(z(t)),o=An(n,ee.__wbindgen_malloc,ee.__wbindgen_realloc),i=rt;de()[e/4+1]=i,de()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(tt(e,t))},r.wbg.__wbindgen_memory=function(){const e=ee.memory;return ge(e)},r}function Ui(r,e){return ee=r.exports,Co.__wbindgen_wasm_module=e,Ft=null,Tt=null,It=null,Rt=null,ee}async function Co(r){if(ee!==void 0)return ee;typeof r>"u"&&(r="/atip/speed_limit/assets/route_info_bg.wasm");const e=qi();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await ji(await r,e);return Ui(t,n)}class Gi{constructor(){ie(this,"inner");this.inner=null}async loadFile(e){await Co(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new Gn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.speedLimitForRoute(e)}allSpeedLimits(){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.allSpeedLimits()}}sr(Gi);function Hi(r){let e,t,n,o,i,s,a,l,u,p,d,c,f;return{c(){e=E("p"),e.textContent="For each intervention:",t=R(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,o=R(),i=E("p"),i.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=R(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=R(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=R(),d=E("p"),d.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=R(),f=E("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(m,g){w(m,e,g),w(m,t,g),w(m,n,g),w(m,o,g),w(m,i,g),w(m,s,g),w(m,a,g),w(m,l,g),w(m,u,g),w(m,p,g),w(m,d,g),w(m,c,g),w(m,f,g)},p:G,d(m){m&&k(e),m&&k(t),m&&k(n),m&&k(o),m&&k(i),m&&k(s),m&&k(a),m&&k(l),m&&k(u),m&&k(p),m&&k(d),m&&k(c),m&&k(f)}}}function zi(r){let e,t,n;function o(s){r[1](s)}let i={title:"Instructions",$$slots:{default:[Hi]},$$scope:{ctx:r}};return r[0]!==void 0&&(i.open=r[0]),e=new ri({props:i}),ae.push(()=>Ee(e,"open",o,r[0])),{c(){x(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Ji(r,e,t){let{open:n}=e;function o(i){n=i,t(0,n)}return r.$$set=i=>{"open"in i&&t(0,n=i.open)},[n,o]}class Yi extends V{constructor(e){super(),K(this,e,Ji,zi,Y,{open:0})}}const st=[];function $t(r,e=G){let t;const n=new Set;function o(a){if(Y(r,a)&&(r=a,t)){const l=!st.length;for(const u of n)u[1](),st.push(u,r);if(l){for(let u=0;u<st.length;u+=2)st[u][0](st[u+1]);st.length=0}}}function i(a){o(a(r))}function s(a,l=G){const u=[a,l];return n.add(u),n.size===1&&(t=e(o)||G),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:o,update:i,subscribe:s}}const Re=$t(null),ne=$t(Pe()),ke=$t(null),je=$t(null),qt=$t(null),Ut=$t(null);function Yt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function wr(r){console.log(`Deleting intervention ${r}`),ne.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),ke.set(null),je.set(null),qt.set(null),Ut.set(null)}function kr(r){let e;const t=r[4].default,n=mt(t,r,r[3],null);return{c(){n&&n.c()},m(o,i){n&&n.m(o,i),e=!0},p(o,i){n&&n.p&&(!e||i&8)&&_t(n,t,o,o[3],e?bt(t,o[3],i,null):gt(o[3]),null)},i(o){e||($(n,o),e=!0)},o(o){L(n,o),e=!1},d(o){n&&n.d(o)}}}function Xi(r){let e,t,n=r[1]&&kr(r);return{c(){e=E("div"),n&&n.c(),O(e,"class","map svelte-12dpf1u")},m(o,i){w(o,e,i),n&&n.m(e,null),r[5](e),t=!0},p(o,[i]){o[1]?n?(n.p(o,i),i&2&&$(n,1)):(n=kr(o),n.c(),$(n,1),n.m(e,null)):n&&(ue(),L(n,1,1,()=>{n=null}),fe())},i(o){t||($(n),t=!0)},o(o){L(n),t=!1},d(o){o&&k(e),n&&n.d(),r[5](null)}}}function Wi(r,e,t){let{$$slots:n={},$$scope:o}=e,{style:i}=e,s,a,l=!1;oi("setCamera",!window.location.hash),Jt(()=>{s=new en.Map({container:a,style:`https://api.maptiler.com/maps/${i}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new en.ScaleControl({})),s.addControl(new en.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Re.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),ot(()=>{s.remove()});function u(p){ae[p?"unshift":"push"](()=>{a=p,t(0,a)})}return r.$$set=p=>{"style"in p&&t(2,i=p.style),"$$scope"in p&&t(3,o=p.$$scope)},[a,l,i,o,n,u]}class Vi extends V{constructor(e){super(),K(this,e,Wi,Xi,Y,{style:2})}}const Ki=r=>({}),Sr=r=>({}),Zi=r=>({}),Er=r=>({}),Qi=r=>({}),Mr=r=>({});function es(r){let e,t,n,o,i,s,a,l,u,p,d,c;const f=r[3].nav,m=mt(f,r,r[2],Mr),g=r[3].sidebar,_=mt(g,r,r[2],Er),v=r[3].main,h=mt(v,r,r[2],Sr);return{c(){e=E("aside"),t=E("div"),n=E("nav"),m&&m.c(),o=R(),_&&_.c(),i=R(),s=E("button"),s.textContent="→",l=R(),u=E("main"),h&&h.c(),O(n,"class","svelte-1u7vg8a"),O(t,"class","sidebar-content content-container svelte-1u7vg8a"),O(s,"type","button"),O(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),O(e,"class",a=gr(r[0]?"":"collapsed")+" svelte-1u7vg8a"),O(u,"class","svelte-1u7vg8a")},m(b,y){w(b,e,y),S(e,t),S(t,n),m&&m.m(n,null),S(t,o),_&&_.m(t,null),S(e,i),S(e,s),w(b,l,y),w(b,u,y),h&&h.m(u,null),p=!0,d||(c=U(s,"click",r[1]),d=!0)},p(b,[y]){m&&m.p&&(!p||y&4)&&_t(m,f,b,b[2],p?bt(f,b[2],y,Qi):gt(b[2]),Mr),_&&_.p&&(!p||y&4)&&_t(_,g,b,b[2],p?bt(g,b[2],y,Zi):gt(b[2]),Er),(!p||y&1&&a!==(a=gr(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&O(e,"class",a),h&&h.p&&(!p||y&4)&&_t(h,v,b,b[2],p?bt(v,b[2],y,Ki):gt(b[2]),Sr)},i(b){p||($(m,b),$(_,b),$(h,b),p=!0)},o(b){L(m,b),L(_,b),L(h,b),p=!1},d(b){b&&k(e),m&&m.d(b),_&&_.d(b),b&&k(l),b&&k(u),h&&h.d(b),d=!1,c()}}}function ts(r,e,t){let{$$slots:n={},$$scope:o}=e,i=!0;function s(){t(0,i=!i)}return r.$$set=a=>{"$$scope"in a&&t(2,o=a.$$scope)},[i,s,o,n]}class ns extends V{constructor(e){super(),K(this,e,ts,es,Y,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function rs(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,o=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){t.label=u[1];break}if(u[0]===6&&t.label<i[1]){t.label=i[1],i=u;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(u);break}i[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ze=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function os(r,e){return r>e?1:r<e?-1:0}function ze(r,e,t){for(var n=new Ze(null,null),o=n,i=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}i.left=e,i=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}o.right=e,o=e,e=e.right}else break}return o.right=e.left,i.left=e.right,e.left=n.right,e.right=n.left,e}function Fn(r,e,t,n){var o=new Ze(r,e);if(t===null)return o.left=o.right=null,o;t=ze(r,t,n);var i=n(r,t.key);return i<0?(o.left=t.left,o.right=t,t.left=null):i>=0&&(o.right=t.right,o.left=t,t.right=null),o}function $r(r,e,t){var n=null,o=null;if(e){e=ze(r,e,t);var i=t(e.key,r);i===0?(n=e.left,o=e.right):i<0?(o=e.right,e.right=null,n=e):(n=e.left,e.left=null,o=e)}return{left:n,right:o}}function is(r,e,t){return e===null?r:(r===null||(e=ze(r.key,e,t),e.left=r),e)}function Hn(r,e,t,n,o){if(r){n(""+e+(t?"└── ":"├── ")+o(r)+`
`);var i=e+(t?"    ":"│   ");r.left&&Hn(r.left,i,!1,n,o),r.right&&Hn(r.right,i,!0,n,o)}}var lr=function(){function r(e){e===void 0&&(e=os),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Fn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ze(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var o=this._comparator,i=ze(e,this._root,o),s=o(e,i.key);return s===0?this._root=i:(s<0?(n.left=i.left,n.right=i,i.left=null):s>0&&(n.right=i.right,n.left=i,i.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var o;if(t===null)return null;t=ze(e,t,n);var i=n(e,t.key);return i===0?(t.left===null?o=t.right:(o=ze(e,t.left,n),o.right=t.right),this._size--,o):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ze(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return t;o<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ze(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return!0;o<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,o=[],i=!1;!i;)n!==null?(o.push(n),n=n.left):o.length!==0?(n=o.pop(),e.call(t,n),n=n.right):i=!0;return this},r.prototype.range=function(e,t,n,o){for(var i=[],s=this._comparator,a=this._root,l;i.length!==0||a;)if(a)i.push(a),a=a.left;else{if(a=i.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(o,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,o=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),o===e)return t;o++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var o=this._comparator;t;){var i=o(e.key,t.key);if(i===0)break;i<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var o=this._comparator;t;){var i=o(e.key,t.key);if(i===0)break;i<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return ls(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var o=e.length,i=this._comparator;if(n&&Yn(e,t,0,o-1,i),this._root===null)this._root=zn(e,t,0,o),this._size=o;else{var s=as(this.toList(),ss(e,t),i);o=this._size+o,this._root=Jn({head:s},0,o)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Hn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var o=this._comparator,i=$r(e,this._root,o),s=i.left,a=i.right;o(e,t)<0?a=Fn(t,n,a,o):s=Fn(t,n,s,o),this._root=is(s,a,o)},r.prototype.split=function(e){return $r(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return rs(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function zn(r,e,t,n){var o=n-t;if(o>0){var i=t+Math.floor(o/2),s=r[i],a=e[i],l=new Ze(s,a);return l.left=zn(r,e,t,i),l.right=zn(r,e,i+1,n),l}return null}function ss(r,e){for(var t=new Ze(null,null),n=t,o=0;o<r.length;o++)n=n.next=new Ze(r[o],e[o]);return n.next=null,t.next}function ls(r){for(var e=r,t=[],n=!1,o=new Ze(null,null),i=o;!n;)e?(t.push(e),e=e.left):t.length>0?(e=i=i.next=t.pop(),e=e.right):n=!0;return i.next=null,o.next}function Jn(r,e,t){var n=t-e;if(n>0){var o=e+Math.floor(n/2),i=Jn(r,e,o),s=r.head;return s.left=i,r.head=r.head.next,s.right=Jn(r,o+1,t),s}return null}function as(r,e,t){for(var n=new Ze(null,null),o=n,i=r,s=e;i!==null&&s!==null;)t(i.key,s.key)<0?(o.next=i,i=i.next):(o.next=s,s=s.next),o=o.next;return i!==null?o.next=i:s!==null&&(o.next=s),n.next}function Yn(r,e,t,n,o){if(!(t>=n)){for(var i=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(o(r[s],i)<0);do a--;while(o(r[a],i)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Yn(r,e,t,a,o),Yn(r,e,a+1,n,o)}}function Ie(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Lr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function $e(r,e,t){return e&&Lr(r.prototype,e),t&&Lr(r,t),r}var Ot=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Xn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,o=e.ur.x<t.ur.x?e.ur.x:t.ur.x,i=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:i},ur:{x:o,y:s}}},Ye=Number.EPSILON;Ye===void 0&&(Ye=Math.pow(2,-52));var us=Ye*Ye,Wn=function(e,t){if(-Ye<e&&e<Ye&&-Ye<t&&t<Ye)return 0;var n=e-t;return n*n<us*e*t?0:e<t?-1:1},fs=function(){function r(){Ie(this,r),this.reset()}return $e(r,[{key:"reset",value:function(){this.xRounder=new Or,this.yRounder=new Or}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Or=function(){function r(){Ie(this,r),this.tree=new lr,this.round(0)}return $e(r,[{key:"round",value:function(t){var n=this.tree.add(t),o=this.tree.prev(n);if(o!==null&&Wn(n.key,o.key)===0)return this.tree.remove(t),o.key;var i=this.tree.next(n);return i!==null&&Wn(n.key,i.key)===0?(this.tree.remove(t),i.key):t}}]),r}(),Gt=new fs,xt=function(e,t){return e.x*t.y-e.y*t.x},Ro=function(e,t){return e.x*t.x+e.y*t.y},Cr=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y},s=xt(o,i);return Wn(s,0)},gn=function(e){return Math.sqrt(Ro(e,e))},cs=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return xt(i,o)/gn(i)/gn(o)},ps=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return Ro(i,o)/gn(i)/gn(o)},Rr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Ir=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},ds=function(e,t,n,o){if(t.x===0)return Ir(n,o,e.x);if(o.x===0)return Ir(e,t,n.x);if(t.y===0)return Rr(n,o,e.y);if(o.y===0)return Rr(e,t,n.y);var i=xt(t,o);if(i==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=xt(s,t)/i,l=xt(s,o)/i,u=e.x+l*t.x,p=n.x+a*o.x,d=e.y+l*t.y,c=n.y+a*o.y,f=(u+p)/2,m=(d+c)/2;return{x:f,y:m}},De=function(){$e(r,null,[{key:"compare",value:function(t,n){var o=r.comparePoints(t.point,n.point);return o!==0?o:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:bn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Ie(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return $e(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,o=0,i=n.length;o<i;o++){var s=n[o];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var o=this.point.events[n];if(o.segment.consumedBy===void 0)for(var i=n+1;i<t;i++){var s=this.point.events[i];s.consumedBy===void 0&&o.otherSE.point.events===s.otherSE.point.events&&o.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,o=this.point.events.length;n<o;n++){var i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,o=new Map,i=function(a){var l=a.otherSE;o.set(a,{sine:cs(n.point,t.point,l.point),cosine:ps(n.point,t.point,l.point)})};return function(s,a){o.has(s)||i(s),o.has(a)||i(a);var l=o.get(s),u=l.sine,p=l.cosine,d=o.get(a),c=d.sine,f=d.cosine;return u>=0&&c>=0?p<f?1:p>f?-1:0:u<0&&c<0?p<f?-1:p>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),hs=0,bn=function(){$e(r,null,[{key:"compare",value:function(t,n){var o=t.leftSE.point.x,i=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<o)return 1;if(s<i)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,d=n.rightSE.point.y;if(o<i){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(o>i){if(l<u&&l<d)return-1;if(l>u&&l>d)return 1;var m=n.comparePoint(t.leftSE.point);if(m!==0)return m;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>a){var v=t.comparePoint(n.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(s!==a){var h=p-l,b=s-o,y=d-u,M=a-i;if(h>b&&y<M)return 1;if(h<b&&y>M)return-1}return s>a?1:s<a||p<d?-1:p>d?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,o){Ie(this,r),this.id=++hs,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=o}return $e(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,o=this.rightSE.point,i=this.vector();if(n.x===o.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/i.y,a=n.x+s*i.x;if(t.x===a)return 0;var l=(t.x-n.x)/i.x,u=n.y+l*i.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),o=t.bbox(),i=Xn(n,o);if(i===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=Ot(n,l)&&this.comparePoint(l)===0,d=Ot(o,s)&&t.comparePoint(s)===0,c=Ot(n,u)&&this.comparePoint(u)===0,f=Ot(o,a)&&t.comparePoint(a)===0;if(d&&p)return f&&!c?a:!f&&c?u:null;if(d)return c&&s.x===u.x&&s.y===u.y?null:s;if(p)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var m=ds(s,this.vector(),l,t.vector());return m===null||!Ot(i,m)?null:Gt.round(m.x,m.y)}},{key:"split",value:function(t){var n=[],o=t.events!==void 0,i=new De(t,!0),s=new De(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(i);var l=new r(i,a,this.rings.slice(),this.windings.slice());return De.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),De.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(i.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,o=this.windings.length;n<o;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,o=t;n.consumedBy;)n=n.consumedBy;for(;o.consumedBy;)o=o.consumedBy;var i=r.compare(n,o);if(i!==0){if(i>0){var s=n;n=o,o=s}if(n.prev===o){var a=n;n=o,o=a}for(var l=0,u=o.rings.length;l<u;l++){var p=o.rings[l],d=o.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(d)):n.windings[c]+=d}o.rings=null,o.windings=null,o.consumedBy=n,o.leftSE.consumedBy=n.leftSE,o.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,o=this._afterState.windings,i=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),o.push(u)):o[p]+=u}for(var d=[],c=[],f=0,m=n.length;f<m;f++)if(o[f]!==0){var g=n[f],_=g.poly;if(c.indexOf(_)===-1)if(g.isExterior)d.push(_);else{c.indexOf(_)===-1&&c.push(_);var v=d.indexOf(g.poly);v!==-1&&d.splice(v,1)}}for(var h=0,b=d.length;h<b;h++){var y=d[h].multiPoly;i.indexOf(y)===-1&&i.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Fe.type){case"union":{var o=t.length===0,i=n.length===0;this._isInResult=o!==i;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Fe.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(d){return d.length===1&&d[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Fe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,o){var i,s,a,l=De.comparePoints(t,n);if(l<0)i=t,s=n,a=1;else if(l>0)i=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new De(i,!0),p=new De(s,!1);return new r(u,p,[o],[a])}}]),r}(),Ar=function(){function r(e,t,n){if(Ie(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=Gt.round(e[0][0],e[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var i=o,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Gt.round(e[s][0],e[s][1]);l.x===i.x&&l.y===i.y||(this.segments.push(bn.fromRing(i,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),i=l)}(o.x!==i.x||o.y!==i.y)&&this.segments.push(bn.fromRing(i,o,this))}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,o=this.segments.length;n<o;n++){var i=this.segments[n];t.push(i.leftSE),t.push(i.rightSE)}return t}}]),r}(),ms=function(){function r(e,t){if(Ie(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ar(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,o=e.length;n<o;n++){var i=new Ar(e[n],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,o=this.interiorRings.length;n<o;n++)for(var i=this.interiorRings[n].getSweepEvents(),s=0,a=i.length;s<a;s++)t.push(i[s]);return t}}]),r}(),Tr=function(){function r(e,t){if(Ie(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,o=e.length;n<o;n++){var i=new ms(e[n],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,o=this.polys.length;n<o;n++)for(var i=this.polys[n].getSweepEvents(),s=0,a=i.length;s<a;s++)t.push(i[s]);return t}}]),r}(),_s=function(){$e(r,null,[{key:"factory",value:function(t){for(var n=[],o=0,i=t.length;o<i;o++){var s=t[o];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],d=l.point,c=[];a=l,l=u,p.push(l),l.point!==d;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var m=p[0].point,g=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(m.x,",")+" ".concat(m.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var _=null,v=0,h=c.length;v<h;v++)if(c[v].point===l.point){_=v;break}if(_!==null){var b=c.splice(_)[0],y=p.splice(b.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}c.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Ie(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return $e(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],o=1,i=this.events.length-1;o<i;o++){var s=this.events[o].point,a=this.events[o+1].point;Cr(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Cr(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],m=d;m!=c;m+=p)f.push([n[m].x,n[m].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,o=this.events.length;n<o;n++){var i=this.events[n];De.compare(t,i)>0&&(t=i)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Fr=function(){function r(e){Ie(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return $e(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,o=this.interiorRings.length;n<o;n++){var i=this.interiorRings[n].getGeom();i!==null&&t.push(i)}return t}}]),r}(),gs=function(){function r(e){Ie(this,r),this.rings=e,this.polys=this._composePolys(e)}return $e(r,[{key:"getGeom",value:function(){for(var t=[],n=0,o=this.polys.length;n<o;n++){var i=this.polys[n].getGeom();i!==null&&t.push(i)}return t}},{key:"_composePolys",value:function(t){for(var n=[],o=0,i=t.length;o<i;o++){var s=t[o];if(!s.poly)if(s.isExteriorRing())n.push(new Fr(s));else{var a=s.enclosingRing();a.poly||n.push(new Fr(a)),a.poly.addInterior(s)}}return n}}]),r}(),bs=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bn.compare;Ie(this,r),this.queue=e,this.tree=new lr(t),this.segments=[]}return $e(r,[{key:"process",value:function(t){var n=t.segment,o=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),o;var i=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!i)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=i,a=i,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var d=l.getIntersection(n);if(d!==null&&(n.isAnEndpoint(d)||(p=d),!l.isAnEndpoint(d)))for(var c=this._splitSafely(l,d),f=0,m=c.length;f<m;f++)o.push(c[f])}var g=null;if(u){var _=u.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(g=_),!u.isAnEndpoint(_)))for(var v=this._splitSafely(u,_),h=0,b=v.length;h<b;h++)o.push(v[h])}if(p!==null||g!==null){var y=null;if(p===null)y=g;else if(g===null)y=p;else{var M=De.comparePoints(p,g);y=M<=0?p:g}this.queue.remove(n.rightSE),o.push(n.rightSE);for(var C=n.split(y),T=0,I=C.length;T<I;T++)o.push(C[T])}o.length>0?(this.tree.remove(n),o.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var N=l.getIntersection(u);if(N!==null){if(!l.isAnEndpoint(N))for(var A=this._splitSafely(l,N),j=0,Z=A.length;j<Z;j++)o.push(A[j]);if(!u.isAnEndpoint(N))for(var P=this._splitSafely(u,N),H=0,le=P.length;H<le;H++)o.push(P[H])}}this.tree.remove(n)}return o}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var o=t.rightSE;this.queue.remove(o);var i=t.split(n);return i.push(o),t.consumedBy===void 0&&this.tree.insert(t),i}}]),r}(),Pr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,vs=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ys=function(){function r(){Ie(this,r)}return $e(r,[{key:"run",value:function(t,n,o){Fe.type=t,Gt.reset();for(var i=[new Tr(n,!0)],s=0,a=o.length;s<a;s++)i.push(new Tr(o[s],!1));if(Fe.numMultiPolys=i.length,Fe.type==="difference")for(var l=i[0],u=1;u<i.length;)Xn(i[u].bbox,l.bbox)!==null?u++:i.splice(u,1);if(Fe.type==="intersection"){for(var p=0,d=i.length;p<d;p++)for(var c=i[p],f=p+1,m=i.length;f<m;f++)if(Xn(c.bbox,i[f].bbox)===null)return[]}for(var g=new lr(De.compare),_=0,v=i.length;_<v;_++)for(var h=i[_].getSweepEvents(),b=0,y=h.length;b<y;b++)if(g.insert(h[b]),g.size>Pr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new bs(g),C=g.size,T=g.pop();T;){var I=T.key;if(g.size===C){var N=I.segment;throw new Error("Unable to pop() ".concat(I.isLeft?"left":"right"," SweepEvent ")+"[".concat(I.point.x,", ").concat(I.point.y,"] from segment #").concat(N.id," ")+"[".concat(N.leftSE.point.x,", ").concat(N.leftSE.point.y,"] -> ")+"[".concat(N.rightSE.point.x,", ").concat(N.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Pr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>vs)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var A=M.process(I),j=0,Z=A.length;j<Z;j++){var P=A[j];P.consumedBy===void 0&&g.insert(P)}C=g.size,T=g.pop()}Gt.reset();var H=_s.factory(M.segments),le=new gs(H);return le.getGeom()}}]),r}(),Fe=new ys,ws=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Fe.run("union",e,n)},ks=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Fe.run("intersection",e,n)},Ss=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Fe.run("xor",e,n)},Es=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Fe.run("difference",e,n)},rn={union:ws,intersection:ks,xor:Ss,difference:Es};function Ms(r,e){var t=Ls(e),n=null;return r.type==="FeatureCollection"?n=$s(r):n=Io(rn.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(o){t.geometry.coordinates.push(o[0])}),t}function $s(r){var e=r.features.length===2?rn.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):rn.union.apply(rn,r.features.map(function(t){return t.geometry.coordinates}));return Io(e)}function Io(r){return ii(r)}function Ls(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return si(t)}function Os(r,e,t){let n;se(r,Re,s=>t(1,n=s));let{boundaryGeojson:o}=e;return li("setCamera")&&n.fitBounds(rr(o),{padding:20,animate:!1}),Qe(n,"boundary",Ms(o)),we(n,{id:"boundary",source:"boundary",...Sn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,o=s.boundaryGeojson)},[o]}class Cs extends V{constructor(e){super(),K(this,e,Os,null,Y,{boundaryGeojson:0})}}const me={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},On=10,Ht=10;function Rs(r,e,t){let n;se(r,Re,u=>t(2,n=u));let{layer:o}=e,{contents:i}=e,s=new en.Popup({closeButton:!1,closeOnClick:!1});n.on("mousemove",a),n.on("mouseout",l),ot(()=>{n.off("mousemove",a),n.off("mouseout",l),s.remove()});function a(u){if(!n.getLayer(o)){s.remove();return}let p=n.queryRenderedFeatures(u.point,{layers:[o]});p.length>0?s.setLngLat(u.lngLat).setHTML(i(p[0].properties)).addTo(n):s.remove()}function l(){s.remove()}return r.$$set=u=>{"layer"in u&&t(0,o=u.layer),"contents"in u&&t(1,i=u.contents)},[o,i]}class Is extends V{constructor(e){super(),K(this,e,Rs,null,Y,{layer:0,contents:1})}}function Nr(r,e,t){const n=r.slice();return n[4]=e[t],n}function xr(r,e,t){const n=r.slice();return n[7]=e[t],n}function Br(r){let e;return{c(){e=E("td"),O(e,"class","svelte-11t6rxo"),ce(e,"background-color",r[7])},m(t,n){w(t,e,n)},p(t,n){n&1&&ce(e,"background-color",t[7])},d(t){t&&k(e)}}}function Dr(r){let e,t=r[4]+"",n;return{c(){e=E("td"),n=W(t),O(e,"class","svelte-11t6rxo")},m(o,i){w(o,e,i),S(e,n)},p:G,d(o){o&&k(e)}}}function As(r){let e,t,n,o,i=r[0],s=[];for(let u=0;u<i.length;u+=1)s[u]=Br(xr(r,i,u));let a=r[1],l=[];for(let u=0;u<a.length;u+=1)l[u]=Dr(Nr(r,a,u));return{c(){e=E("table"),t=E("tr");for(let u=0;u<s.length;u+=1)s[u].c();n=R(),o=E("tr");for(let u=0;u<l.length;u+=1)l[u].c();O(t,"class","svelte-11t6rxo"),O(o,"class","svelte-11t6rxo"),O(e,"class","svelte-11t6rxo")},m(u,p){w(u,e,p),S(e,t);for(let d=0;d<s.length;d+=1)s[d].m(t,null);S(e,n),S(e,o);for(let d=0;d<l.length;d+=1)l[d].m(o,null)},p(u,[p]){if(p&1){i=u[0];let d;for(d=0;d<i.length;d+=1){const c=xr(u,i,d);s[d]?s[d].p(c,p):(s[d]=Br(c),s[d].c(),s[d].m(t,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=i.length}if(p&2){a=u[1];let d;for(d=0;d<a.length;d+=1){const c=Nr(u,a,d);l[d]?l[d].p(c,p):(l[d]=Dr(c),l[d].c(),l[d].m(o,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},i:G,o:G,d(u){u&&k(e),fn(s,u),fn(l,u)}}}function Ts(r,e,t){let{colors:n}=e,{steps:o}=e;if(n.length!=o.length+1)throw new Error("There must be one more color than step");let i=[],s=0;for(let a of o)i.push(`${s}-${a}`),s=a;return i.push(`>${s}`),r.$$set=a=>{"colors"in a&&t(0,n=a.colors),"steps"in a&&t(2,o=a.steps)},[n,i,o]}class Fs extends V{constructor(e){super(),K(this,e,Ts,As,Y,{colors:0,steps:2})}}const Ps="/atip/speed_limit/assets/help-d011708a.svg";function Ns(r){let e,t;return{c(){e=E("img"),cn(e.src,t=Ps)||O(e,"src",t),O(e,"title",r[0]),O(e,"alt",r[0])},m(n,o){w(n,e,o)},p(n,[o]){o&1&&O(e,"title",n[0]),o&1&&O(e,"alt",n[0])},i:G,o:G,d(n){n&&k(e)}}}function xs(r,e,t){let{contents:n}=e;return r.$$set=o=>{"contents"in o&&t(0,n=o.contents)},[n]}class Bs extends V{constructor(e){super(),K(this,e,xs,Ns,Y,{contents:0})}}function Ds(r){let e,t,n,o,i,s,a;return t=new Bs({props:{contents:"Data comes from OpenStreetMap, and may not always be correct. Freehand segments and off-road paths generally have no speed data."}}),o=new Fs({props:{colors:r[0],steps:r[1]}}),s=new Is({props:{layer:"speed-limits",contents:js}}),{c(){e=W(`(mph)
`),x(t.$$.fragment),n=R(),x(o.$$.fragment),i=R(),x(s.$$.fragment)},m(l,u){w(l,e,u),B(t,l,u),w(l,n,u),B(o,l,u),w(l,i,u),B(s,l,u),a=!0},p:G,i(l){a||($(t.$$.fragment,l),$(o.$$.fragment,l),$(s.$$.fragment,l),a=!0)},o(l){L(t.$$.fragment,l),L(o.$$.fragment,l),L(s.$$.fragment,l),a=!1},d(l){l&&k(e),D(t,l),l&&k(n),D(o,l),l&&k(i),D(s,l)}}}let lt="speed-limits",Pn="speed-limits";function js(r){return r.speed_limit?`${Math.round(r.speed_limit)} mph`:"Unknown"}function qs(r,e,t){let n,o;se(r,Re,p=>t(4,n=p)),se(r,ne,p=>t(5,o=p));let{routeInfo:i}=e,{id:s}=e,a=["#00AB4D","#8ECA4D","#F7BB00","#BB0000"],l=[30,40,50];const u=["step",["get","speed_limit"],a[0],l[0],a[1],l[1],a[2],l[2],a[3]];return Qe(n,lt,Pe()),we(n,{id:Pn,source:lt,...yt(u,Ht,1)}),Jt(async()=>{try{if(s){let p=o.features.find(c=>c.id==s),d=JSON.parse(await i.speedLimitForRoute(p.properties.waypoints));n.getSource(lt).setData(d)}else{let p=JSON.parse(await i.allSpeedLimits());n.getSource(lt).setData(p)}}catch(p){window.alert(`Couldn't calculate speed limits for route: ${p}`)}}),ot(()=>{n.getLayer(Pn)&&n.removeLayer(Pn),n.getSource(lt)&&n.removeSource(lt)}),r.$$set=p=>{"routeInfo"in p&&t(2,i=p.routeInfo),"id"in p&&t(3,s=p.id)},[a,l,i,s]}class Ao extends V{constructor(e){super(),K(this,e,qs,Ds,Y,{routeInfo:2,id:3})}}function jr(r){let e,t;return e=new Ao({props:{routeInfo:r[0],id:r[1]}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&1&&(i.routeInfo=n[0]),o&2&&(i.id=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Us(r){let e,t,n,o,i,s,a,l,u,p,d=r[2]=="speed limits"&&jr(r);return{c(){e=E("label"),t=W(`Show details:
  `),n=E("select"),o=E("option"),o.textContent="None",i=E("option"),i.textContent="Speed limits",s=R(),d&&d.c(),a=be(),o.__value="none",o.value=o.__value,i.__value="speed limits",i.value=i.__value,r[2]===void 0&&it(()=>r[3].call(n))},m(c,f){w(c,e,f),S(e,t),S(e,n),S(n,o),S(n,i),Ke(n,r[2]),w(c,s,f),d&&d.m(c,f),w(c,a,f),l=!0,u||(p=U(n,"change",r[3]),u=!0)},p(c,[f]){f&4&&Ke(n,c[2]),c[2]=="speed limits"?d?(d.p(c,f),f&4&&$(d,1)):(d=jr(c),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(ue(),L(d,1,1,()=>{d=null}),fe())},i(c){l||($(d),l=!0)},o(c){L(d),l=!1},d(c){c&&k(e),c&&k(s),d&&d.d(c),c&&k(a),u=!1,p()}}}function Gs(r,e,t){let{routeInfo:n}=e,{id:o}=e,i="none";function s(){i=En(this),t(2,i)}return r.$$set=a=>{"routeInfo"in a&&t(0,n=a.routeInfo),"id"in a&&t(1,o=a.id)},[n,o,i,s]}class Hs extends V{constructor(e){super(),K(this,e,Gs,Us,Y,{routeInfo:0,id:1})}}function qr(r){let e,t=Ur(r[5])+"",n,o,i,s,a,l,u,p,d,c;return u=new Hs({props:{routeInfo:r[3],id:r[4]}}),{c(){e=W("Length: "),n=W(t),o=R(),i=E("br"),s=E("button"),s.textContent="Auto-fill details",a=E("br"),l=R(),x(u.$$.fragment),O(s,"type","button")},m(f,m){w(f,e,m),w(f,n,m),w(f,o,m),w(f,i,m),w(f,s,m),w(f,a,m),w(f,l,m),B(u,f,m),p=!0,d||(c=U(s,"click",r[14]),d=!0)},p(f,m){(!p||m&32)&&t!==(t=Ur(f[5])+"")&&Ne(n,t);const g={};m&8&&(g.routeInfo=f[3]),m&16&&(g.id=f[4]),u.$set(g)},i(f){p||($(u.$$.fragment,f),p=!0)},o(f){L(u.$$.fragment,f),p=!1},d(f){f&&k(e),f&&k(n),f&&k(o),f&&k(i),f&&k(s),f&&k(a),f&&k(l),D(u,f),d=!1,c()}}}function zs(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,m,g,_,v,h,b,y,M,C,T,I,N,A,j,Z,P,H,le,Se,Ae,oe,re,xe,Le,Q,he,Wt,_e=r[5]&&qr(r);return{c(){e=E("label"),t=W("Name:"),n=E("br"),o=R(),i=E("input"),s=R(),a=E("br"),l=R(),u=E("br"),p=R(),d=E("label"),c=E("input"),f=W(`
  Area`),m=R(),g=E("label"),_=E("input"),v=W(`
  Route`),h=R(),b=E("label"),y=E("input"),M=W(`
  Crossing`),C=R(),T=E("label"),I=E("input"),N=W(`
  Other`),A=R(),j=E("br"),Z=R(),P=E("br"),H=R(),le=E("label"),Se=W("Description:"),Ae=E("br"),oe=R(),re=E("textarea"),xe=R(),_e&&_e.c(),Le=be(),O(i,"type","text"),ce(i,"width","100%"),O(c,"type","radio"),c.__value="area",c.value=c.__value,r[9][0].push(c),O(_,"type","radio"),_.__value="route",_.value=_.__value,r[9][0].push(_),O(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[9][0].push(y),O(I,"type","radio"),I.__value="other",I.value=I.__value,r[9][0].push(I),ce(re,"width","100%"),O(re,"rows","5"),O(re,"class","svelte-15lna0i")},m(F,te){w(F,e,te),S(e,t),S(e,n),S(e,o),S(e,i),Oe(i,r[0]),w(F,s,te),w(F,a,te),w(F,l,te),w(F,u,te),w(F,p,te),w(F,d,te),S(d,c),c.checked=c.__value===r[1],S(d,f),w(F,m,te),w(F,g,te),S(g,_),_.checked=_.__value===r[1],S(g,v),w(F,h,te),w(F,b,te),S(b,y),y.checked=y.__value===r[1],S(b,M),w(F,C,te),w(F,T,te),S(T,I),I.checked=I.__value===r[1],S(T,N),w(F,A,te),w(F,j,te),w(F,Z,te),w(F,P,te),w(F,H,te),w(F,le,te),S(le,Se),S(le,Ae),S(le,oe),S(le,re),Oe(re,r[2]),w(F,xe,te),_e&&_e.m(F,te),w(F,Le,te),Q=!0,he||(Wt=[U(i,"input",r[7]),U(c,"change",r[8]),U(_,"change",r[10]),U(y,"change",r[11]),U(I,"change",r[12]),U(re,"input",r[13])],he=!0)},p(F,[te]){te&1&&i.value!==F[0]&&Oe(i,F[0]),te&2&&(c.checked=c.__value===F[1]),te&2&&(_.checked=_.__value===F[1]),te&2&&(y.checked=y.__value===F[1]),te&2&&(I.checked=I.__value===F[1]),te&4&&Oe(re,F[2]),F[5]?_e?(_e.p(F,te),te&32&&$(_e,1)):(_e=qr(F),_e.c(),$(_e,1),_e.m(Le.parentNode,Le)):_e&&(ue(),L(_e,1,1,()=>{_e=null}),fe())},i(F){Q||($(_e),Q=!0)},o(F){L(_e),Q=!1},d(F){F&&k(e),F&&k(s),F&&k(a),F&&k(l),F&&k(u),F&&k(p),F&&k(d),r[9][0].splice(r[9][0].indexOf(c),1),F&&k(m),F&&k(g),r[9][0].splice(r[9][0].indexOf(_),1),F&&k(h),F&&k(b),r[9][0].splice(r[9][0].indexOf(y),1),F&&k(C),F&&k(T),r[9][0].splice(r[9][0].indexOf(I),1),F&&k(A),F&&k(j),F&&k(Z),F&&k(P),F&&k(H),F&&k(le),F&&k(xe),_e&&_e.d(F),F&&k(Le),he=!1,Ce(Wt)}}}function Ur(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Js(r,e,t){let n;se(r,ne,b=>t(15,n=b));let{routeInfo:o}=e,{id:i}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function p(){let b=n.features.find(y=>y.id==i);try{t(0,s=await o.nameForRoute(b))}catch(y){window.alert(`Couldn't auto-name route: ${y}`)}}const d=[[]];function c(){s=this.value,t(0,s)}function f(){a=this.__value,t(1,a)}function m(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function _(){a=this.__value,t(1,a)}function v(){l=this.value,t(2,l)}const h=()=>p();return r.$$set=b=>{"routeInfo"in b&&t(3,o=b.routeInfo),"id"in b&&t(4,i=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(5,u=b.length_meters)},[s,a,l,o,i,u,p,c,f,d,m,g,_,v,h]}class Ys extends V{constructor(e){super(),K(this,e,Js,zs,Y,{routeInfo:3,id:4,name:0,intervention_type:1,description:2,length_meters:5})}}const Xs="Intervention",Ws=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],Vs={name:Xs,oneOf:Ws};function Ks(r){const e=r-1;return e*e*e+1}function St(r,{delay:e=0,duration:t=400,easing:n=Ks}={}){const o=getComputedStyle(r),i=+o.opacity,s=parseFloat(o.height),a=parseFloat(o.paddingTop),l=parseFloat(o.paddingBottom),u=parseFloat(o.marginTop),p=parseFloat(o.marginBottom),d=parseFloat(o.borderTopWidth),c=parseFloat(o.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*i};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*p}px;border-top-width: ${f*d}px;border-bottom-width: ${f*c}px;`}}function To(r){return"members"in r}function Fo(r){return"oneOf"in r}function Po(r){return typeof r=="string"}function No(r){return typeof r=="object"&&"value"in r}function Zs(r){return"type"in r&&r.type=="number"}function xo(r){return"type"in r&&r.type=="one-liner"}function Bo(r){return"type"in r&&r.type=="textbox"}function Do(r){return"type"in r&&r.type=="checkbox"}function Gr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Hr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function zr(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=W(t),O(e,"class","svelte-1b72l00")},m(o,i){w(o,e,i),S(e,n)},p(o,i){i&2&&t!==(t=o[1].description+"")&&Ne(n,t)},d(o){o&&k(e)}}}function Qs(r){let e,t,n;return{c(){e=E("input"),O(e,"type","checkbox")},m(o,i){w(o,e,i),e.checked=r[0],t||(n=U(e,"change",r[14]),t=!0)},p(o,i){i&1&&(e.checked=o[0])},i:G,o:G,d(o){o&&k(e),t=!1,n()}}}function el(r){let e,t,n;return{c(){e=E("textarea"),ce(e,"width","100%"),O(e,"rows","5"),O(e,"class","svelte-1b72l00")},m(o,i){w(o,e,i),Oe(e,r[0]),t||(n=U(e,"input",r[13]),t=!0)},p(o,i){i&1&&Oe(e,o[0])},i:G,o:G,d(o){o&&k(e),t=!1,n()}}}function tl(r){let e,t,n;return{c(){e=E("input"),O(e,"type","text"),ce(e,"width","100%")},m(o,i){w(o,e,i),Oe(e,r[0]),t||(n=U(e,"input",r[12]),t=!0)},p(o,i){i&1&&e.value!==o[0]&&Oe(e,o[0])},i:G,o:G,d(o){o&&k(e),t=!1,n()}}}function nl(r){let e,t,n;return{c(){e=E("input"),O(e,"type","number")},m(o,i){w(o,e,i),Oe(e,r[0]),t||(n=U(e,"input",r[11]),t=!0)},p(o,i){i&1&&yo(e.value)!==o[0]&&Oe(e,o[0])},i:G,o:G,d(o){o&&k(e),t=!1,n()}}}function rl(r){let e,t,n=r[1].oneOf,o=[];for(let s=0;s<n.length;s+=1)o[s]=Yr(Gr(r,n,s));const i=s=>L(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=be()},m(s,a){for(let l=0;l<o.length;l+=1)o[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Gr(s,n,l);o[l]?(o[l].p(u,a),$(o[l],1)):(o[l]=Yr(u),o[l].c(),$(o[l],1),o[l].m(e.parentNode,e))}for(ue(),l=n.length;l<o.length;l+=1)i(l);fe()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)L(o[a]);t=!1},d(s){fn(o,s),s&&k(e)}}}function ol(r){let e,t,n=r[1].members,o=[];for(let s=0;s<n.length;s+=1)o[s]=Xr(Hr(r,n,s));const i=s=>L(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=be()},m(s,a){for(let l=0;l<o.length;l+=1)o[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Hr(s,n,l);o[l]?(o[l].p(u,a),$(o[l],1)):(o[l]=Xr(u),o[l].c(),$(o[l],1),o[l].m(e.parentNode,e))}for(ue(),l=n.length;l<o.length;l+=1)i(l);fe()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)L(o[a]);t=!1},d(s){fn(o,s),s&&k(e)}}}function il(r){let e,t,n,o,i=r[15].name+"",s,a,l,u,p,d,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&Jr(r);return{c(){e=E("label"),t=E("input"),o=R(),s=W(i),a=E("br"),l=R(),f&&f.c(),u=be(),O(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(m,g){w(m,e,g),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),w(m,l,g),f&&f.m(m,g),w(m,u,g),p=!0,d||(c=[U(t,"change",r[9]),U(t,"change",r[4])],d=!0)},p(m,g){(!p||g&2&&n!==(n=m[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===m[2]),(!p||g&2)&&i!==(i=m[15].name+"")&&Ne(s,i),m[2]==m[15].name&&typeof m[0]=="object"?f?(f.p(m,g),g&7&&$(f,1)):(f=Jr(m),f.c(),$(f,1),f.m(u.parentNode,u)):f&&(ue(),L(f,1,1,()=>{f=null}),fe())},i(m){p||($(f),p=!0)},o(m){L(f),p=!1},d(m){m&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),m&&k(l),f&&f.d(m),m&&k(u),d=!1,Ce(c)}}}function sl(r){let e,t,n,o,i=r[15].value+"",s,a,l,u,p;function d(m,g){return m[15].description?ul:al}let c=d(r),f=c(r);return{c(){e=E("label"),t=E("input"),o=R(),s=W(i),a=R(),f.c(),l=R(),O(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(m,g){w(m,e,g),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),f.m(e,null),S(e,l),u||(p=[U(t,"change",r[8]),U(t,"change",r[3])],u=!0)},p(m,g){g&2&&n!==(n=m[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===m[2]),g&2&&i!==(i=m[15].value+"")&&Ne(s,i),c===(c=d(m))&&f?f.p(m,g):(f.d(1),f=c(m),f&&(f.c(),f.m(e,l)))},i:G,o:G,d(m){m&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Ce(p)}}}function ll(r){let e,t,n,o,i=r[15]+"",s,a,l,u,p,d;return{c(){e=E("label"),t=E("input"),o=R(),s=W(i),a=R(),l=E("br"),u=R(),O(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){w(c,e,f),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),S(e,l),S(e,u),p||(d=[U(t,"change",r[6]),U(t,"change",r[3])],p=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&i!==(i=c[15]+"")&&Ne(s,i)},i:G,o:G,d(c){c&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,Ce(d)}}}function Jr(r){let e,t,n,o,i,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Xt({props:l}),ae.push(()=>Ee(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),x(t.$$.fragment),o=R(),O(e,"class","svelte-1b72l00")},m(u,p){w(u,e,p),B(t,e,null),S(e,o),s=!0},p(u,p){r=u;const d={};p&2&&(d.spec=r[15]),!n&&p&3&&(n=!0,d.value=r[0][r[15].name],Me(()=>n=!1)),t.$set(d)},i(u){s||($(t.$$.fragment,u),it(()=>{i||(i=wt(e,St,{duration:500},!0)),i.run(1)}),s=!0)},o(u){L(t.$$.fragment,u),i||(i=wt(e,St,{duration:500},!1)),i.run(0),s=!1},d(u){u&&k(e),D(t),u&&i&&i.end()}}}function al(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function ul(r){let e,t,n=r[15].description+"",o,i;return{c(){e=E("p"),t=W("("),o=W(n),i=W(")"),O(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,o),S(e,i)},p(s,a){a&2&&n!==(n=s[15].description+"")&&Ne(o,n)},d(s){s&&k(e)}}}function Yr(r){let e,t,n,o,i,s;const a=[ll,sl,il],l=[];function u(p,d){return d&2&&(e=null),d&2&&(t=null),e==null&&(e=!!Po(p[15])),e?0:(t==null&&(t=!!No(p[15])),t?1:2)}return n=u(r,-1),o=l[n]=a[n](r),{c(){o.c(),i=be()},m(p,d){l[n].m(p,d),w(p,i,d),s=!0},p(p,d){let c=n;n=u(p,d),n===c?l[n].p(p,d):(ue(),L(l[c],1,1,()=>{l[c]=null}),fe(),o=l[n],o?o.p(p,d):(o=l[n]=a[n](p),o.c()),$(o,1),o.m(i.parentNode,i))},i(p){s||($(o),s=!0)},o(p){L(o),s=!1},d(p){l[n].d(p),p&&k(i)}}}function Xr(r){let e,t,n=r[15].name+"",o,i,s,a,l,u;function p(c){r[5](c,r[15])}let d={spec:r[15]};return r[0][r[15].name]!==void 0&&(d.value=r[0][r[15].name]),s=new Xt({props:d}),ae.push(()=>Ee(s,"value",p,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),o=W(n),i=R(),x(s.$$.fragment),l=R(),O(e,"class","svelte-1b72l00")},m(c,f){w(c,e,f),S(e,t),S(t,o),S(e,i),B(s,e,null),S(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&Ne(o,n);const m={};f&2&&(m.spec=r[15]),!a&&f&3&&(a=!0,m.value=r[0][r[15].name],Me(()=>a=!1)),s.$set(m)},i(c){u||($(s.$$.fragment,c),u=!0)},o(c){L(s.$$.fragment,c),u=!1},d(c){c&&k(e),D(s)}}}function fl(r){let e,t,n,o,i,s,a,l,u,p,d,c=r[1].description&&zr(r);const f=[ol,rl,nl,tl,el,Qs],m=[];function g(_,v){return v&2&&(t=null),v&2&&(n=null),v&2&&(o=null),v&2&&(i=null),v&2&&(s=null),v&2&&(a=null),t==null&&(t=!!To(_[1])),t?0:(n==null&&(n=!!Fo(_[1])),n?1:(o==null&&(o=!!Zs(_[1])),o?2:(i==null&&(i=!!xo(_[1])),i?3:(s==null&&(s=!!Bo(_[1])),s?4:(a==null&&(a=!!Do(_[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=m[l]=f[l](r)),{c(){c&&c.c(),e=R(),u&&u.c(),p=be()},m(_,v){c&&c.m(_,v),w(_,e,v),~l&&m[l].m(_,v),w(_,p,v),d=!0},p(_,[v]){_[1].description?c?c.p(_,v):(c=zr(_),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let h=l;l=g(_,v),l===h?~l&&m[l].p(_,v):(u&&(ue(),L(m[h],1,1,()=>{m[h]=null}),fe()),~l?(u=m[l],u?u.p(_,v):(u=m[l]=f[l](_),u.c()),$(u,1),u.m(p.parentNode,p)):u=null)},i(_){d||($(u),d=!0)},o(_){L(u),d=!1},d(_){c&&c.d(_),_&&k(e),~l&&m[l].d(_),_&&k(p)}}}function cl(r,e,t){var h,b,y;let{spec:n}=e,{value:o}=e,i="";if(To(n)){o||(o={});for(let M of n.members)xo(M)||Bo(M)?o[h=M.name]||(o[h]=""):Do(M)?o[b=M.name]||(o[b]=!1):o[y=M.name]||(o[y]={})}else Fo(n)&&(o||(o={}),Po(o)?i=o:No(o)?i=o.value:i=Object.keys(o)[0]||"");function s(){t(0,o=i)}function a(){t(0,o={}),t(0,o[i]={},o)}const l=[[]];function u(M,C){r.$$.not_equal(o[C.name],M)&&(o[C.name]=M,t(0,o))}function p(){i=this.__value,t(2,i)}function d(){i=this.__value,t(2,i)}function c(){i=this.__value,t(2,i)}function f(M,C){r.$$.not_equal(o[C.name],M)&&(o[C.name]=M,t(0,o))}function m(){o=yo(this.value),t(0,o)}function g(){o=this.value,t(0,o)}function _(){o=this.value,t(0,o)}function v(){o=this.checked,t(0,o)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,o=M.value)},[o,n,i,s,a,u,p,l,d,c,f,m,g,_,v]}class Xt extends V{constructor(e){super(),K(this,e,cl,fl,Y,{spec:1,value:0})}}function pl(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].v2!==void 0&&(i.value=r[0].v2),e=new Xt({props:i}),ae.push(()=>Ee(e,"value",o,r[0].v2)),{c(){x(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function dl(r,e,t){let{props:n}=e;n.v2||(n.v2={});let o=Vs;function i(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class hl extends V{constructor(e){super(),K(this,e,dl,pl,Y,{props:0})}}const ml="Planning",_l=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],gl={name:ml,members:_l};function bl(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].planning!==void 0&&(i.value=r[0].planning),e=new Xt({props:i}),ae.push(()=>Ee(e,"value",o,r[0].planning)),{c(){x(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function vl(r,e,t){let{props:n}=e;n.planning||(n.planning={});let o=gl;function i(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class yl extends V{constructor(e){super(),K(this,e,vl,bl,Y,{props:0})}}const wl="CriticalIssue",kl=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],Sl={name:wl,members:kl};function El(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].criticals!==void 0&&(i.value=r[0].criticals),e=new Xt({props:i}),ae.push(()=>Ee(e,"value",o,r[0].criticals)),{c(){x(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Ml(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let o=Sl;function i(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class $l extends V{constructor(e){super(),K(this,e,Ml,El,Y,{props:0})}}function Wr(r){let e,t,n,o,i;const s=r[10].default,a=mt(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),ce(e,"border","solid 1px black"),ce(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,o||(i=U(e,"introend",r[14]),o=!0)},p(l,u){a&&a.p&&(!n||u&512)&&_t(a,s,l,l[9],n?bt(s,l[9],u,null):gt(l[9]),null)},i(l){n||($(a,l),it(()=>{t||(t=wt(e,St,{duration:100},!0)),t.run(1)}),n=!0)},o(l){L(a,l),t||(t=wt(e,St,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),o=!1,i()}}}function Ll(r){let e,t,n,o,i,s,a,l,u,p,d=r[4]&&Wr(r);return{c(){e=E("button"),t=pn("svg"),n=pn("path"),o=R(),i=W(r[1]),s=R(),d&&d.c(),a=be(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-t7fpgu"),O(e,"aria-expanded",r[4]),O(e,"class","svelte-t7fpgu"),br(e,"underlined",r[3])},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,o),S(e,i),w(c,s,f),d&&d.m(c,f),w(c,a,f),l=!0,u||(p=[U(e,"click",r[5]),U(e,"mouseenter",r[11]),U(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&Ne(i,c[1]),(!l||f&16)&&O(e,"aria-expanded",c[4]),(!l||f&8)&&br(e,"underlined",c[3]),c[4]?d?(d.p(c,f),f&16&&$(d,1)):(d=Wr(c),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(ue(),L(d,1,1,()=>{d=null}),fe())},i(c){l||($(d),l=!0)},o(c){L(d),l=!1},d(c){c&&k(e),c&&k(s),d&&d.d(c),c&&k(a),u=!1,Ce(p)}}}function Ol(r,e,t){let n,o,i,s;se(r,je,h=>t(7,i=h)),se(r,ke,h=>t(8,s=h));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const d=()=>{ke.update(h=>h==u?null:u),s==u&&(Ut.set(null),Ut.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const m=()=>qt.set(u),g=()=>qt.set(null);function _(h){ae[h?"unshift":"push"](()=>{c=h,t(2,c)})}const v=()=>f();return r.$$set=h=>{"id"in h&&t(0,u=h.id),"label"in h&&t(1,p=h.label),"$$scope"in h&&t(9,l=h.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,o=i==u)},[u,p,c,o,n,d,f,i,s,l,a,m,g,_,v]}class Cl extends V{constructor(e){super(),K(this,e,Ol,Ll,Y,{id:0,label:1})}}function Vr(r,e,t){const n=r.slice();return n[14]=e[t],n[15]=e,n[16]=t,n}function Rl(r){let e,t,n;function o(s){r[10](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new $l({props:i}),ae.push(()=>Ee(e,"props",o,r[14].properties)),{c(){x(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Il(r){let e,t,n;function o(s){r[9](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new yl({props:i}),ae.push(()=>Ee(e,"props",o,r[14].properties)),{c(){x(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Al(r){let e,t,n;function o(s){r[8](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new hl({props:i}),ae.push(()=>Ee(e,"props",o,r[14].properties)),{c(){x(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Tl(r){let e,t,n,o,i;function s(p){r[5](p,r[14])}function a(p){r[6](p,r[14])}function l(p){r[7](p,r[14])}let u={routeInfo:r[1],id:r[14].id,length_meters:r[14].properties.length_meters};return r[14].properties.name!==void 0&&(u.name=r[14].properties.name),r[14].properties.intervention_type!==void 0&&(u.intervention_type=r[14].properties.intervention_type),r[14].properties.description!==void 0&&(u.description=r[14].properties.description),e=new Ys({props:u}),ae.push(()=>Ee(e,"name",s,r[14].properties.name)),ae.push(()=>Ee(e,"intervention_type",a,r[14].properties.intervention_type)),ae.push(()=>Ee(e,"description",l,r[14].properties.description)),{c(){x(e.$$.fragment)},m(p,d){B(e,p,d),i=!0},p(p,d){r=p;const c={};d&2&&(c.routeInfo=r[1]),d&4&&(c.id=r[14].id),d&4&&(c.length_meters=r[14].properties.length_meters),!t&&d&4&&(t=!0,c.name=r[14].properties.name,Me(()=>t=!1)),!n&&d&4&&(n=!0,c.intervention_type=r[14].properties.intervention_type,Me(()=>n=!1)),!o&&d&4&&(o=!0,c.description=r[14].properties.description,Me(()=>o=!1)),e.$set(c)},i(p){i||($(e.$$.fragment,p),i=!0)},o(p){L(e.$$.fragment,p),i=!1},d(p){D(e,p)}}}function Fl(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,m,g;const _=[Tl,Al,Il,Rl],v=[];function h(y,M){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:y[0]=="criticals"?3:-1}~(e=h(r))&&(t=v[e]=_[e](r));function b(){return r[11](r[14])}return{c(){t&&t.c(),n=R(),o=E("br"),i=R(),s=E("br"),a=R(),l=E("div"),u=E("button"),u.textContent="Delete",p=R(),d=E("button"),d.textContent="Save",c=R(),O(u,"type","button"),O(d,"type","button"),ce(l,"display","flex"),ce(l,"justify-content","space-between")},m(y,M){~e&&v[e].m(y,M),w(y,n,M),w(y,o,M),w(y,i,M),w(y,s,M),w(y,a,M),w(y,l,M),S(l,u),S(l,p),S(l,d),w(y,c,M),f=!0,m||(g=[U(u,"click",b),U(d,"click",r[12])],m=!0)},p(y,M){r=y;let C=e;e=h(r),e===C?~e&&v[e].p(r,M):(t&&(ue(),L(v[C],1,1,()=>{v[C]=null}),fe()),~e?(t=v[e],t?t.p(r,M):(t=v[e]=_[e](r),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(y){f||($(t),f=!0)},o(y){L(t),f=!1},d(y){~e&&v[e].d(y),y&&k(n),y&&k(o),y&&k(i),y&&k(s),y&&k(a),y&&k(l),y&&k(c),m=!1,Ce(g)}}}function Kr(r,e){let t,n,o;return n=new Cl({props:{id:e[14].id,label:e[16]+1+") "+e[3](e[14]),$$slots:{default:[Fl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=be(),x(n.$$.fragment),this.first=t},m(i,s){w(i,t,s),B(n,i,s),o=!0},p(i,s){e=i;const a={};s&4&&(a.id=e[14].id),s&4&&(a.label=e[16]+1+") "+e[3](e[14])),s&131079&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(i){o||($(n.$$.fragment,i),o=!0)},o(i){L(n.$$.fragment,i),o=!1},d(i){i&&k(t),D(n,i)}}}function Pl(r){let e=[],t=new Map,n,o,i,s,a=r[2].features;const l=u=>u[14].id;for(let u=0;u<a.length;u+=1){let p=Vr(r,a,u),d=l(p);t.set(d,e[u]=Kr(d,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=be()},m(u,p){for(let d=0;d<e.length;d+=1)e[d].m(u,p);w(u,n,p),o=!0,i||(s=U(window,"keydown",r[4]),i=!0)},p(u,[p]){p&15&&(a=u[2].features,ue(),e=ai(e,p,l,1,u,a,t,n.parentNode,ui,Kr,n,Vr),fe())},i(u){if(!o){for(let p=0;p<a.length;p+=1)$(e[p]);o=!0}},o(u){for(let p=0;p<e.length;p+=1)L(e[p]);o=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&k(n),i=!1,s()}}}function Nl(r,e,t){let n,o;se(r,ke,v=>t(13,n=v)),se(r,ne,v=>t(2,o=v));let{schema:i}=e,{routeInfo:s}=e;function a(v){var b,y,M,C,T;if(i=="planning")return((b=v.properties.planning)==null?void 0:b.name)||"Untitled polygon";if(i=="v2")return((M=(y=v.properties.v2)==null?void 0:y.Route)==null?void 0:M.name)||((T=(C=v.properties.v2)==null?void 0:C.Crossing)==null?void 0:T.name)||"Untitled intervention";if(v.properties.name)return v.properties.name;var h=v.properties.intervention_type;return h=="other"&&(v.geometry.type=="Point"?h="point":v.geometry.type=="LineString"?h="line":h="polygon"),`Untitled ${h}`}function l(v){if(v.key=="Delete"){const h=v.target.tagName;if(h=="INPUT"||h=="TEXTAREA")return;v.preventDefault();const b=n;b&&wr(b)}}function u(v,h){r.$$.not_equal(h.properties.name,v)&&(h.properties.name=v,ne.set(o))}function p(v,h){r.$$.not_equal(h.properties.intervention_type,v)&&(h.properties.intervention_type=v,ne.set(o))}function d(v,h){r.$$.not_equal(h.properties.description,v)&&(h.properties.description=v,ne.set(o))}function c(v,h){r.$$.not_equal(h.properties,v)&&(h.properties=v,ne.set(o))}function f(v,h){r.$$.not_equal(h.properties,v)&&(h.properties=v,ne.set(o))}function m(v,h){r.$$.not_equal(h.properties,v)&&(h.properties=v,ne.set(o))}const g=v=>wr(v.id),_=()=>ke.set(null);return r.$$set=v=>{"schema"in v&&t(0,i=v.schema),"routeInfo"in v&&t(1,s=v.routeInfo)},[i,s,o,a,l,u,p,d,c,f,m,g,_]}class xl extends V{constructor(e){super(),K(this,e,Nl,Pl,Y,{schema:0,routeInfo:1})}}function Zr(r){let e,t;return e=new Ao({props:{routeInfo:r[0],id:void 0}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&1&&(i.routeInfo=n[0]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Bl(r){let e,t,n,o,i,s,a,l,u,p,d,c=r[2]=="speed limits"&&Zr(r);return{c(){e=E("label"),t=W(`Show layer:
  `),n=E("select"),o=E("option"),o.textContent="None",i=E("option"),i.textContent="Speed limits",a=R(),c&&c.c(),l=be(),o.__value="none",o.value=o.__value,i.__value="speed limits",i.value=i.__value,n.disabled=s=r[1]!=null,r[2]===void 0&&it(()=>r[3].call(n))},m(f,m){w(f,e,m),S(e,t),S(e,n),S(n,o),S(n,i),Ke(n,r[2]),w(f,a,m),c&&c.m(f,m),w(f,l,m),u=!0,p||(d=U(n,"change",r[3]),p=!0)},p(f,[m]){(!u||m&2&&s!==(s=f[1]!=null))&&(n.disabled=s),m&4&&Ke(n,f[2]),f[2]=="speed limits"?c?(c.p(f,m),m&4&&$(c,1)):(c=Zr(f),c.c(),$(c,1),c.m(l.parentNode,l)):c&&(ue(),L(c,1,1,()=>{c=null}),fe())},i(f){u||($(c),u=!0)},o(f){L(c),u=!1},d(f){f&&k(e),f&&k(a),c&&c.d(f),f&&k(l),p=!1,d()}}}function Dl(r,e,t){let n;se(r,ke,a=>t(1,n=a));let{routeInfo:o}=e,i="none";function s(){i=En(this),t(2,i),t(1,n)}return r.$$set=a=>{"routeInfo"in a&&t(0,o=a.routeInfo)},r.$$.update=()=>{r.$$.dirty&2&&n&&t(2,i="none")},[o,n,i,s]}class jl extends V{constructor(e){super(),K(this,e,Dl,Bl,Y,{routeInfo:0})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function qe(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Vn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Je(r,e,t){t===void 0&&(t={});var n=Ve(r),o=Ve(e),i=Te(o[1]-n[1]),s=Te(o[0]-n[0]),a=Te(n[1]),l=Te(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return fi(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function on(r,e){return e===void 0&&(e={}),ci(r,function(t,n){var o=n.geometry.coordinates;return t+Je(o[0],o[1],e)},0)}function ql(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,m,g,_,v,h,b,y=r[0].features.length+"",M,C,T,I,N,A,j,Z;return{c(){e=E("div"),t=E("label"),n=W(`Scheme name:
    `),o=E("input"),i=R(),s=E("br"),a=R(),l=E("div"),u=E("label"),p=E("input"),d=R(),c=E("button"),c.textContent="Load from GeoJSON",f=R(),m=E("button"),m.textContent="Export to GeoJSON",g=R(),_=E("br"),v=R(),h=E("div"),b=E("span"),M=W(y),C=W(" objects"),T=R(),I=E("button"),N=W("Clear all"),O(o,"type","text"),O(p,"type","file"),O(p,"id","load_geojson"),O(p,"class","svelte-lhyd1e"),O(c,"type","button"),O(m,"type","button"),O(m,"class","align-right svelte-lhyd1e"),O(I,"type","button"),O(I,"class","align-right svelte-lhyd1e"),I.disabled=A=r[0].features.length==0},m(P,H){w(P,e,H),S(e,t),S(t,n),S(t,o),Oe(o,r[0].scheme_name),w(P,i,H),w(P,s,H),w(P,a,H),w(P,l,H),S(l,u),S(u,p),S(u,d),S(u,c),S(l,f),S(l,m),w(P,g,H),w(P,_,H),w(P,v,H),w(P,h,H),S(h,b),S(b,M),S(b,C),S(h,T),S(h,I),S(I,N),j||(Z=[U(o,"input",r[8]),U(p,"change",r[3]),U(c,"click",Gl),U(m,"click",r[2]),U(I,"click",r[1])],j=!0)},p(P,[H]){H&1&&o.value!==P[0].scheme_name&&Oe(o,P[0].scheme_name),H&1&&y!==(y=P[0].features.length+"")&&Ne(M,y),H&1&&A!==(A=P[0].features.length==0)&&(I.disabled=A)},i:G,o:G,d(P){P&&k(e),P&&k(i),P&&k(s),P&&k(a),P&&k(l),P&&k(g),P&&k(_),P&&k(v),P&&k(h),j=!1,Ce(Z)}}}function Ul(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Gl(){document.getElementById("load_geojson").click()}function Hl(r,e,t){let n;se(r,ne,m=>t(0,n=m));let{authorityName:o}=e,{schema:i}=e,s=o;i!="v1"&&(s+=`_${i}`);let a=!1;Jt(async()=>{let g=new URLSearchParams(window.location.search).get("geojsonUrl"),_=window.localStorage.getItem(s);if(g){console.log(`Loading GeoJSON from ${g}`);try{let h=await(await fetch(g)).text();ne.set(c(JSON.parse(h)))}catch(v){console.log(`Failed to load from URL: ${v}`)}}else if(_)try{ne.set(c(JSON.parse(_)))}catch(v){console.log(`Failed to load from local storage: ${v}`)}t(7,a=!0)});function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(ne.update(m=>(delete m.scheme_name,m.features=[],m)),ke.set(null),je.set(null),qt.set(null),Ut.set(null))}function u(){const m=JSON.parse(JSON.stringify(n));for(let g of m.features)delete g.properties.hide_while_editing;return m}function p(){let m=u();var g=s;m.authority=o,m.origin="atip-v1",m.scheme_name&&(g+="_"+m.scheme_name),g+=".txt",Ul(g,JSON.stringify(m,null,"  "))}function d(m){const g=new FileReader;g.onload=v=>{try{ne.set(c(JSON.parse(v.target.result)))}catch(h){window.alert(`Couldn't load scheme from a file: ${h}`)}};let _=m.target.files;g.readAsText(_[0])}function c(m){let g=1;for(let _ of m.features)_.properties||(_.properties={name:"",description:"",intervention_type:"other"}),_.geometry.type=="LineString"&&!_.properties.length_meters&&(_.properties.length_meters=on(_,{units:"kilometers"})*1e3),_.id=g++;return m}function f(){n.scheme_name=this.value,ne.set(n)}return r.$$set=m=>{"authorityName"in m&&t(4,o=m.authorityName),"schema"in m&&t(5,i=m.schema)},r.$$.update=()=>{r.$$.dirty&193&&a&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,p,d,o,i,s,a,f]}class zl extends V{constructor(e){super(),K(this,e,Hl,ql,Y,{authorityName:4,schema:5})}}const Jl="/atip/speed_limit/assets/zoom_out_map-b2e1091a.svg";function Yl(r){let e,t,n,o,i;return{c(){e=E("button"),t=E("img"),cn(t.src,n=Jl)||O(t,"src",n),O(t,"alt","Zoom to show entire boundary"),O(e,"type","button"),O(e,"title","Zoom to show entire boundary"),O(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),o||(i=U(e,"click",r[0]),o=!0)},p:G,i:G,o:G,d(s){s&&k(e),o=!1,i()}}}function Xl(r,e,t){let n;se(r,Re,s=>t(2,n=s));let{boundaryGeojson:o}=e;function i(){n.fitBounds(rr(o),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,o=s.boundaryGeojson)},[i,o]}class Wl extends V{constructor(e){super(),K(this,e,Xl,Yl,Y,{boundaryGeojson:1})}}function Vl(r){let e,t,n,o,i,s,a;return{c(){e=E("div"),t=W(`Basemap:
  `),n=E("select"),o=E("option"),o.textContent="Streets",i=E("option"),i.textContent="Satellite",o.__value="streets",o.value=o.__value,i.__value="hybrid",i.value=i.__value,r[0]===void 0&&it(()=>r[2].call(n)),O(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,o),S(n,i),Ke(n,r[0]),s||(a=[U(n,"change",r[2]),U(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&Ke(n,l[0])},i:G,o:G,d(l){l&&k(e),s=!1,Ce(a)}}}function Kl(r,e,t){let{style:n}=e;function o(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function i(){n=En(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,o,i]}class Zl extends V{constructor(e){super(),K(this,e,Kl,Vl,Y,{style:0})}}function Qr(r){let e,t,n;const o=r[3].default,i=mt(o,r,r[2],null);return{c(){e=E("div"),i&&i.c()},m(s,a){w(s,e,a),i&&i.m(e,null),n=!0},p(s,a){i&&i.p&&(!n||a&4)&&_t(i,o,s,s[2],n?bt(o,s[2],a,null):gt(s[2]),null)},i(s){n||($(i,s),it(()=>{t||(t=wt(e,St,{duration:100},!0)),t.run(1)}),n=!0)},o(s){L(i,s),t||(t=wt(e,St,{duration:100},!1)),t.run(0),n=!1},d(s){s&&k(e),i&&i.d(s),s&&t&&t.end()}}}function Ql(r){let e,t,n,o,i,s,a,l,u,p,d=r[0]&&Qr(r);return{c(){e=E("button"),t=pn("svg"),n=pn("path"),o=R(),i=W(r[1]),s=R(),d&&d.c(),a=be(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-una9lq"),O(e,"aria-expanded",r[0]),O(e,"class","svelte-una9lq")},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,o),S(e,i),w(c,s,f),d&&d.m(c,f),w(c,a,f),l=!0,u||(p=U(e,"click",r[4]),u=!0)},p(c,[f]){(!l||f&2)&&Ne(i,c[1]),(!l||f&1)&&O(e,"aria-expanded",c[0]),c[0]?d?(d.p(c,f),f&1&&$(d,1)):(d=Qr(c),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(ue(),L(d,1,1,()=>{d=null}),fe())},i(c){l||($(d),l=!0)},o(c){L(d),l=!1},d(c){c&&k(e),c&&k(s),d&&d.d(c),c&&k(a),u=!1,p()}}}function ea(r,e,t){let{$$slots:n={},$$scope:o}=e,{label:i}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,i=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,o=l.$$scope)},[s,i,o,n,a]}class Cn extends V{constructor(e){super(),K(this,e,ea,Ql,Y,{label:1,open:0})}}function ta(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,m,g;return{c(){e=E("li"),t=E("span"),n=W("Areas"),o=R(),i=E("li"),s=E("span"),a=W("Routes"),l=R(),u=E("li"),p=E("span"),d=W("Crossings"),c=R(),f=E("li"),m=E("span"),g=W("Other"),O(t,"class","svelte-l42ea0"),ce(t,"background",me.area),O(s,"class","svelte-l42ea0"),ce(s,"background",me.route),O(p,"class","svelte-l42ea0"),ce(p,"background",me.crossing),O(m,"class","svelte-l42ea0"),ce(m,"background",me.other)},m(_,v){w(_,e,v),S(e,t),S(e,n),w(_,o,v),w(_,i,v),S(i,s),S(i,a),w(_,l,v),w(_,u,v),S(u,p),S(u,d),w(_,c,v),w(_,f,v),S(f,m),S(f,g)},p:G,d(_){_&&k(e),_&&k(o),_&&k(i),_&&k(l),_&&k(u),_&&k(c),_&&k(f)}}}function na(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,m,g;return{c(){e=E("li"),t=E("span"),n=W("Preapp"),o=R(),i=E("li"),s=E("span"),a=W("Outline"),l=R(),u=E("li"),p=E("span"),d=W("Reserved matters"),c=R(),f=E("li"),m=E("span"),g=W("Local plan"),O(t,"class","svelte-l42ea0"),ce(t,"background",me.preapp),O(s,"class","svelte-l42ea0"),ce(s,"background",me.outline),O(p,"class","svelte-l42ea0"),ce(p,"background",me["reserved matters"]),O(m,"class","svelte-l42ea0"),ce(m,"background",me["local plan"])},m(_,v){w(_,e,v),S(e,t),S(e,n),w(_,o,v),w(_,i,v),S(i,s),S(i,a),w(_,l,v),w(_,u,v),S(u,p),S(u,d),w(_,c,v),w(_,f,v),S(f,m),S(f,g)},p:G,d(_){_&&k(e),_&&k(o),_&&k(i),_&&k(l),_&&k(u),_&&k(c),_&&k(f)}}}function ra(r){let e;function t(i,s){return i[0]=="planning"?na:ta}let n=t(r),o=n(r);return{c(){e=E("ul"),o.c()},m(i,s){w(i,e,s),o.m(e,null)},p(i,s){n===(n=t(i))&&o?o.p(i,s):(o.d(1),o=n(i),o&&(o.c(),o.m(e,null)))},d(i){i&&k(e),o.d()}}}function oa(r){let e,t,n;return t=new Cn({props:{label:"Objects",open:!0,$$slots:{default:[ra]},$$scope:{ctx:r}}}),{c(){e=E("div"),x(t.$$.fragment),O(e,"class","svelte-l42ea0")},m(o,i){w(o,e,i),B(t,e,null),n=!0},p(o,[i]){const s={};i&3&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||($(t.$$.fragment,o),n=!0)},o(o){L(t.$$.fragment,o),n=!1},d(o){o&&k(e),D(t)}}}function ia(r,e,t){let{schema:n}=e;return r.$$set=o=>{"schema"in o&&t(0,n=o.schema)},[n]}class sa extends V{constructor(e){super(),K(this,e,ia,oa,Y,{schema:0})}}let at="interventions";function la(r,e,t){let n,o;se(r,Re,p=>t(1,n=p)),se(r,ne,p=>t(2,o=p));let{schema:i}=e;Qe(n,at,o);const s=["match",["get","intervention_type"],"area",me.area,"route",me.route,"crossing",me.crossing,"other",me.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",me.preapp,"outline",me.outline,"reserved matters",me["reserved matters"],"local plan",me["local plan"],"white"],l=["!=","hide_while_editing",!0];return we(n,{id:"interventions-points",source:at,filter:["all",Mn,l,["!=","endpoint",!0]],...Mt(s,On)}),we(n,{id:"interventions-lines",source:at,filter:["all",$n,l],...yt(s,Ht)}),we(n,{id:"interventions-lines-endpoints",source:at,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Ht,"circle-opacity":0,"circle-stroke-color":me.lineEndpointColor,"circle-stroke-width":2}}),we(n,{id:"interventions-polygons",source:at,filter:["all",Ln,l],...Sn(i=="planning"?a:s,.5)}),r.$$set=p=>{"schema"in p&&t(0,i=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(o)),d=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])d.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(d),n.getSource(at).setData(p)}},[i,n,o]}class aa extends V{constructor(e){super(),K(this,e,la,null,Y,{schema:0})}}let ut="hover";function ua(r,e,t){let n,o,i,s,a;return se(r,Re,l=>t(0,n=l)),se(r,ne,l=>t(1,o=l)),se(r,qt,l=>t(2,i=l)),se(r,je,l=>t(3,s=l)),se(r,ke,l=>t(4,a=l)),Qe(n,ut,Pe()),we(n,{id:"hover-polygons",source:ut,filter:Ln,...yt(me.hovering,.5*Ht,1)}),we(n,{id:"hover-lines",source:ut,filter:$n,...yt(me.hovering,1.5*Ht,1)}),we(n,{id:"hover-points",source:ut,filter:Mn,...Mt(me.hovering,1.5*On,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||i;l!=null?n.getSource(ut).setData(o.features.find(u=>u.id==l)):n.getSource(ut).setData(Pe())}},[n,o,i,s,a]}class fa extends V{constructor(e){super(),K(this,e,ua,null,Y,{})}}class ar{constructor(e,t){ie(this,"owner");ie(this,"map");ie(this,"mapHandlers",{});ie(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Zt="edit-point-mode";class ca{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"cursor");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new ar(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Qe(e,Zt,Pe()),we(e,{id:"edit-point-mode",source:Zt,...Mt(me.hovering,On,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=pa(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Zt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Pe();this.cursor&&e.features.push(this.cursor),this.map.getSource(Zt).setData(e)}}function pa(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function jo(r,e,t){if(t===void 0&&(t={}),t.final===!0)return da(r,e);var n=Ve(r),o=Ve(e),i=Te(n[0]),s=Te(o[0]),a=Te(n[1]),l=Te(o[1]),u=Math.sin(s-i)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-i);return jn(Math.atan2(u,p))}function da(r,e){var t=jo(e,r);return t=(t+180)%360,t}function eo(r,e,t,n){n===void 0&&(n={});var o=Ve(r),i=Te(o[0]),s=Te(o[1]),a=Te(t),l=pi(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=i+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),d=jn(p),c=jn(u);return vt([d,c],n.properties)}function Kn(r){if(!r)throw new Error("geojson is required");var e=[];return or(r,function(t){ha(t,e)}),We(e)}function ha(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=qe(n);break;case"LineString":t=[qe(n)]}t.forEach(function(o){var i=ma(o,r.properties);i.forEach(function(s){s.id=e.length,e.push(s)})})}}function ma(r,e){var t=[];return r.reduce(function(n,o){var i=kt([n,o],e);return i.bbox=_a(n,o),t.push(i),o}),t}function _a(r,e){var t=r[0],n=r[1],o=e[0],i=e[1],s=t<o?t:o,a=n<i?n:i,l=t>o?t:o,u=n>i?n:i;return[s,a,l,u]}var Et={},ga={get exports(){return Et},set exports(r){Et=r}},Zn={},ba={get exports(){return Zn},set exports(r){Zn=r}};(function(r,e){(function(t,n){r.exports=n()})(di,function(){function t(h,b,y,M,C){(function T(I,N,A,j,Z){for(;j>A;){if(j-A>600){var P=j-A+1,H=N-A+1,le=Math.log(P),Se=.5*Math.exp(2*le/3),Ae=.5*Math.sqrt(le*Se*(P-Se)/P)*(H-P/2<0?-1:1),oe=Math.max(A,Math.floor(N-H*Se/P+Ae)),re=Math.min(j,Math.floor(N+(P-H)*Se/P+Ae));T(I,N,oe,re,Z)}var xe=I[N],Le=A,Q=j;for(n(I,A,N),Z(I[j],xe)>0&&n(I,A,j);Le<Q;){for(n(I,Le,Q),Le++,Q--;Z(I[Le],xe)<0;)Le++;for(;Z(I[Q],xe)>0;)Q--}Z(I[A],xe)===0?n(I,A,Q):n(I,++Q,j),Q<=N&&(A=Q+1),N<=Q&&(j=Q-1)}})(h,b,y||0,M||h.length-1,C||o)}function n(h,b,y){var M=h[b];h[b]=h[y],h[y]=M}function o(h,b){return h<b?-1:h>b?1:0}var i=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(h,b,y){if(!y)return b.indexOf(h);for(var M=0;M<b.length;M++)if(y(h,b[M]))return M;return-1}function a(h,b){l(h,0,h.children.length,b,h)}function l(h,b,y,M,C){C||(C=_(null)),C.minX=1/0,C.minY=1/0,C.maxX=-1/0,C.maxY=-1/0;for(var T=b;T<y;T++){var I=h.children[T];u(C,h.leaf?M(I):I)}return C}function u(h,b){return h.minX=Math.min(h.minX,b.minX),h.minY=Math.min(h.minY,b.minY),h.maxX=Math.max(h.maxX,b.maxX),h.maxY=Math.max(h.maxY,b.maxY),h}function p(h,b){return h.minX-b.minX}function d(h,b){return h.minY-b.minY}function c(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function f(h){return h.maxX-h.minX+(h.maxY-h.minY)}function m(h,b){return h.minX<=b.minX&&h.minY<=b.minY&&b.maxX<=h.maxX&&b.maxY<=h.maxY}function g(h,b){return b.minX<=h.maxX&&b.minY<=h.maxY&&b.maxX>=h.minX&&b.maxY>=h.minY}function _(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(h,b,y,M,C){for(var T=[b,y];T.length;)if(!((y=T.pop())-(b=T.pop())<=M)){var I=b+Math.ceil((y-b)/M/2)*M;t(h,I,b,y,C),T.push(b,I,I,y)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(h){var b=this.data,y=[];if(!g(h,b))return y;for(var M=this.toBBox,C=[];b;){for(var T=0;T<b.children.length;T++){var I=b.children[T],N=b.leaf?M(I):I;g(h,N)&&(b.leaf?y.push(I):m(h,N)?this._all(I,y):C.push(I))}b=C.pop()}return y},i.prototype.collides=function(h){var b=this.data;if(!g(h,b))return!1;for(var y=[];b;){for(var M=0;M<b.children.length;M++){var C=b.children[M],T=b.leaf?this.toBBox(C):C;if(g(h,T)){if(b.leaf||m(h,T))return!0;y.push(C)}}b=y.pop()}return!1},i.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var b=0;b<h.length;b++)this.insert(h[b]);return this}var y=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},i.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},i.prototype.clear=function(){return this.data=_([]),this},i.prototype.remove=function(h,b){if(!h)return this;for(var y,M,C,T=this.data,I=this.toBBox(h),N=[],A=[];T||N.length;){if(T||(T=N.pop(),M=N[N.length-1],y=A.pop(),C=!0),T.leaf){var j=s(h,T.children,b);if(j!==-1)return T.children.splice(j,1),N.push(T),this._condense(N),this}C||T.leaf||!m(T,I)?M?(y++,T=M.children[y],C=!1):T=null:(N.push(T),A.push(y),y=0,M=T,T=T.children[0])}return this},i.prototype.toBBox=function(h){return h},i.prototype.compareMinX=function(h,b){return h.minX-b.minX},i.prototype.compareMinY=function(h,b){return h.minY-b.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(h){return this.data=h,this},i.prototype._all=function(h,b){for(var y=[];h;)h.leaf?b.push.apply(b,h.children):y.push.apply(y,h.children),h=y.pop();return b},i.prototype._build=function(h,b,y,M){var C,T=y-b+1,I=this._maxEntries;if(T<=I)return a(C=_(h.slice(b,y+1)),this.toBBox),C;M||(M=Math.ceil(Math.log(T)/Math.log(I)),I=Math.ceil(T/Math.pow(I,M-1))),(C=_([])).leaf=!1,C.height=M;var N=Math.ceil(T/I),A=N*Math.ceil(Math.sqrt(I));v(h,b,y,A,this.compareMinX);for(var j=b;j<=y;j+=A){var Z=Math.min(j+A-1,y);v(h,j,Z,N,this.compareMinY);for(var P=j;P<=Z;P+=N){var H=Math.min(P+N-1,Z);C.children.push(this._build(h,P,H,M-1))}}return a(C,this.toBBox),C},i.prototype._chooseSubtree=function(h,b,y,M){for(;M.push(b),!b.leaf&&M.length-1!==y;){for(var C=1/0,T=1/0,I=void 0,N=0;N<b.children.length;N++){var A=b.children[N],j=c(A),Z=(P=h,H=A,(Math.max(H.maxX,P.maxX)-Math.min(H.minX,P.minX))*(Math.max(H.maxY,P.maxY)-Math.min(H.minY,P.minY))-j);Z<T?(T=Z,C=j<C?j:C,I=A):Z===T&&j<C&&(C=j,I=A)}b=I||b.children[0]}var P,H;return b},i.prototype._insert=function(h,b,y){var M=y?h:this.toBBox(h),C=[],T=this._chooseSubtree(M,this.data,b,C);for(T.children.push(h),u(T,M);b>=0&&C[b].children.length>this._maxEntries;)this._split(C,b),b--;this._adjustParentBBoxes(M,C,b)},i.prototype._split=function(h,b){var y=h[b],M=y.children.length,C=this._minEntries;this._chooseSplitAxis(y,C,M);var T=this._chooseSplitIndex(y,C,M),I=_(y.children.splice(T,y.children.length-T));I.height=y.height,I.leaf=y.leaf,a(y,this.toBBox),a(I,this.toBBox),b?h[b-1].children.push(I):this._splitRoot(y,I)},i.prototype._splitRoot=function(h,b){this.data=_([h,b]),this.data.height=h.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(h,b,y){for(var M,C,T,I,N,A,j,Z=1/0,P=1/0,H=b;H<=y-b;H++){var le=l(h,0,H,this.toBBox),Se=l(h,H,y,this.toBBox),Ae=(C=le,T=Se,I=void 0,N=void 0,A=void 0,j=void 0,I=Math.max(C.minX,T.minX),N=Math.max(C.minY,T.minY),A=Math.min(C.maxX,T.maxX),j=Math.min(C.maxY,T.maxY),Math.max(0,A-I)*Math.max(0,j-N)),oe=c(le)+c(Se);Ae<Z?(Z=Ae,M=H,P=oe<P?oe:P):Ae===Z&&oe<P&&(P=oe,M=H)}return M||y-b},i.prototype._chooseSplitAxis=function(h,b,y){var M=h.leaf?this.compareMinX:p,C=h.leaf?this.compareMinY:d;this._allDistMargin(h,b,y,M)<this._allDistMargin(h,b,y,C)&&h.children.sort(M)},i.prototype._allDistMargin=function(h,b,y,M){h.children.sort(M);for(var C=this.toBBox,T=l(h,0,b,C),I=l(h,y-b,y,C),N=f(T)+f(I),A=b;A<y-b;A++){var j=h.children[A];u(T,h.leaf?C(j):j),N+=f(T)}for(var Z=y-b-1;Z>=b;Z--){var P=h.children[Z];u(I,h.leaf?C(P):P),N+=f(I)}return N},i.prototype._adjustParentBBoxes=function(h,b,y){for(var M=y;M>=0;M--)u(b[M],h)},i.prototype._condense=function(h){for(var b=h.length-1,y=void 0;b>=0;b--)h[b].children.length===0?b>0?(y=h[b-1].children).splice(y.indexOf(h[b]),1):this.clear():a(h[b],this.toBBox)},i})})(ba);const va=ir(hi),ya=ir(mi),wa=ir(_i);var Be=Zn,qo=va,Uo=ya,ft=wa.default,ka=Uo.featureEach;Uo.coordEach;qo.polygon;var to=qo.featureCollection;function Go(r){var e=new Be(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ft(t),Be.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:ft(o),n.push(o)}):ka(t,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:ft(o),n.push(o)}),Be.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ft(t),Be.prototype.remove.call(this,t,n)},e.clear=function(){return Be.prototype.clear.call(this)},e.search=function(t){var n=Be.prototype.search.call(this,this.toBBox(t));return to(n)},e.collides=function(t){return Be.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Be.prototype.all.call(this);return to(t)},e.toJSON=function(){return Be.prototype.toJSON.call(this)},e.fromJSON=function(t){return Be.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ft(t);else if(t.type==="FeatureCollection")n=ft(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}ga.exports=Go;Et.default=Go;function Ho(r,e){var t={},n=[];if(r.type==="LineString"&&(r=vr(r)),e.type==="LineString"&&(e=vr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=no(r,e);return o&&n.push(o),We(n)}var i=Et();return i.load(Kn(e)),dn(Kn(r),function(s){dn(i.search(s),function(a){var l=no(s,a);if(l){var u=qe(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function no(r,e){var t=qe(r),n=qe(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=t[0][0],i=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],d=n[1][1],c=(d-u)*(s-o)-(p-l)*(a-i),f=(p-l)*(i-u)-(d-u)*(o-l),m=(s-o)*(i-u)-(a-i)*(o-l);if(c===0)return f===0&&m===0,null;var g=f/c,_=m/c;if(g>=0&&g<=1&&_>=0&&_<=1){var v=o+g*(s-o),h=i+g*(a-i);return vt([v,h])}return null}function zt(r,e,t){t===void 0&&(t={});var n=vt([1/0,1/0],{dist:1/0}),o=0;return or(r,function(i){for(var s=qe(i),a=0;a<s.length-1;a++){var l=vt(s[a]);l.properties.dist=Je(e,l,t);var u=vt(s[a+1]);u.properties.dist=Je(e,u,t);var p=Je(l,u,t),d=Math.max(l.properties.dist,u.properties.dist),c=jo(l,u),f=eo(e,d,c+90,t),m=eo(e,d,c-90,t),g=Ho(kt([f.geometry.coordinates,m.geometry.coordinates]),kt([l.geometry.coordinates,u.geometry.coordinates])),_=null;g.features.length>0&&(_=g.features[0],_.properties.dist=Je(e,_,t),_.properties.location=o+Je(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=o),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=o+p),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a),o+=p}}),n}const ct="edit-polygon-mode";class Sa{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"points");ie(this,"cursor");ie(this,"hover");ie(this,"dragFrom");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new ar(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Qe(e,ct,Pe()),we(e,{id:"edit-polygon-fill",source:ct,filter:Ln,...Sn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),we(e,{id:"edit-polygon-lines",source:ct,filter:$n,...yt("black",8,.5)}),we(e,{id:"edit-polygon-vertices",source:ct,filter:Mn,...Mt(me.hovering,On,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let o of this.points)o[0]-=t,o[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(oo(this.points).forEach((n,o)=>{t.push([o+1,zt(n,this.cursor).properties.dist])}),t.sort((n,o)=>n[1]-o[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(ct),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Pe();this.points.forEach((n,o)=>{let i=ro(n);i.properties.hover=this.hover==o,i.properties.idx=o,e.features.push(i)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(oo(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(ct).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=ro(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function ro(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function oo(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let X;const He=new Array(32).fill(void 0);He.push(void 0,null,!0,!1);function J(r){return He[r]}let Bt=He.length;function Ea(r){r<36||(He[r]=Bt,Bt=r)}function Qn(r){const e=J(r);return Ea(r),e}const zo=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});zo.decode();let sn=new Uint8Array;function Dt(){return sn.byteLength===0&&(sn=new Uint8Array(X.memory.buffer)),sn}function dt(r,e){return zo.decode(Dt().subarray(r,r+e))}function ve(r){Bt===He.length&&He.push(He.length+1);const e=Bt;return Bt=He[e],He[e]=r,e}function Nn(r){return r==null}let ln=new Float64Array;function Ma(){return ln.byteLength===0&&(ln=new Float64Array(X.memory.buffer)),ln}let an=new Int32Array;function ye(){return an.byteLength===0&&(an=new Int32Array(X.memory.buffer)),an}let Xe=0;const un=new TextEncoder("utf-8"),$a=typeof un.encodeInto=="function"?function(r,e){return un.encodeInto(r,e)}:function(r,e){const t=un.encode(r);return e.set(t),{read:r.length,written:t.length}};function Qt(r,e,t){if(t===void 0){const a=un.encode(r),l=e(a.length);return Dt().subarray(l,l+a.length).set(a),Xe=a.length,l}let n=r.length,o=e(n);const i=Dt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;i[o+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),o=t(o,n,n=s+r.length*3);const a=Dt().subarray(o+s,o+n),l=$a(r,a);s+=l.written}return Xe=s,o}function er(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let i="[";o>0&&(i+=er(r[0]));for(let s=1;s<o;s++)i+=", "+er(r[s]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function La(r,e){const t=e(r.length*1);return Dt().set(r,t/1),Xe=r.length,t}function xn(r,e){try{return r.apply(this,e)}catch(t){X.__wbindgen_exn_store(ve(t))}}class vn{static __wrap(e){const t=Object.create(vn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();X.__wbg_jsroutesnapper_free(e)}constructor(e){try{const i=X.__wbindgen_add_to_stack_pointer(-16),s=La(e,X.__wbindgen_malloc),a=Xe;X.jsroutesnapper_new(i,s,a);var t=ye()[i/4+0],n=ye()[i/4+1],o=ye()[i/4+2];if(o)throw Qn(n);return vn.__wrap(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){X.jsroutesnapper_setConfig(this.ptr,ve(e))}toFinalFeature(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];let o;return e!==0&&(o=dt(e,t).slice(),X.__wbindgen_free(e,t*1)),o}finally{X.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_renderGeojson(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];return dt(e,t)}finally{X.__wbindgen_add_to_stack_pointer(16),X.__wbindgen_free(e,t)}}setSnapMode(e){X.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return X.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){X.jsroutesnapper_onClick(this.ptr)}onDragStart(){return X.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return X.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){X.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const o=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_editExisting(o,this.ptr,ve(e));var t=ye()[o/4+0],n=ye()[o/4+1];if(n)throw Qn(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}}async function Oa(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ca(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Qn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(dt(e,t));return ve(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=dt(e,t);return ve(n)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),o=typeof n=="number"?n:void 0;Ma()[e/8+1]=Nn(o)?0:o,ye()[e/4+0]=!Nn(o)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),o=typeof n=="string"?n:void 0;var i=Nn(o)?0:Qt(o,X.__wbindgen_malloc,X.__wbindgen_realloc),s=Xe;ye()[e/4+1]=s,ye()[e/4+0]=i},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(J(t)),o=Qt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),i=Xe;ye()[e/4+1]=i,ye()[e/4+0]=o},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return ve(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=J(e)[J(t)];return ve(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(J(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(J(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(J(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(J(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(J(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=J(e)[t>>>0];return ve(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=J(e).next;return ve(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return xn(function(e){const t=J(e).next();return ve(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return J(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=J(e).value;return ve(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ve(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return xn(function(e,t){const n=Reflect.get(J(e),J(t));return ve(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return xn(function(e,t){const n=J(e).call(J(t));return ve(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=J(e).buffer;return ve(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(J(e));return ve(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ve(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,o=Qt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),i=Xe;ye()[e/4+1]=i,ye()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(dt(e,t))}finally{X.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=er(J(t)),o=Qt(n,X.__wbindgen_malloc,X.__wbindgen_realloc),i=Xe;ye()[e/4+1]=i,ye()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(dt(e,t))},r.wbg.__wbindgen_memory=function(){const e=X.memory;return ve(e)},r}function Ra(r,e){return X=r.exports,Jo.__wbindgen_wasm_module=e,ln=new Float64Array,an=new Int32Array,sn=new Uint8Array,X}async function Jo(r){typeof r>"u"&&(r="/atip/speed_limit/assets/route_snapper_bg.wasm");const e=Ca();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Oa(await r,e);return Ra(t,n)}const Ct="route-snapper",io=10,Ia=30;class Aa{constructor(e,t){ie(this,"map");ie(this,"inner");ie(this,"active");ie(this,"eventListenersSuccessRoute");ie(this,"eventListenersSuccessArea");ie(this,"eventListenersFailure");ie(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new vn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Qe(e,Ct,Pe()),we(e,{id:"route-points",source:Ct,filter:Mn,...Mt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",io/2,io])}),we(e,{id:"route-lines",source:Ct,filter:$n,...yt("black",2.5)}),we(e,{id:"route-polygons",source:Ct,filter:Ln,...Sn("black",.5)}),this.events=new ar(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Ia,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Ct).setData(JSON.parse(this.inner.renderGeojson()))}}function Ta(r){let e,t,n,o,i,s,a,l;return{c(){e=E("button"),t=E("img"),o=R(),i=W(r[2]),cn(t.src,n=r[3])||O(t,"src",n),O(t,"alt",r[2]),O(t,"class","svelte-1vvpkg9"),O(e,"type","button"),e.disabled=s=r[0]==r[1],O(e,"class","svelte-1vvpkg9")},m(u,p){w(u,e,p),S(e,t),S(e,o),S(e,i),a||(l=U(e,"click",r[5]),a=!0)},p(u,[p]){p&8&&!cn(t.src,n=u[3])&&O(t,"src",n),p&4&&O(t,"alt",u[2]),p&4&&Ne(i,u[2]),p&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:G,o:G,d(u){u&&k(e),a=!1,l()}}}function Fa(r,e,t){let{mode:n}=e,{thisMode:o}=e,{label:i}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(o);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,o=u.thisMode),"label"in u&&t(2,i=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,o,i,s,a,l]}class nt extends V{constructor(e){super(),K(this,e,Fa,Ta,Y,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function so(r){let e;function t(i,s){return i[1]?Na:Pa}let n=t(r),o=n(r);return{c(){o.c(),e=be()},m(i,s){o.m(i,s),w(i,e,s)},p(i,s){n!==(n=t(i))&&(o.d(1),o=n(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){o.d(i),i&&k(e)}}}function Pa(r){let e;return{c(){e=E("p"),e.textContent="Click an object to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Na(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another object"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function xa(r){let e,t=r[0]==ht&&so(r);return{c(){t&&t.c(),e=be()},m(n,o){t&&t.m(n,o),w(n,e,o)},p(n,[o]){n[0]==ht?t?t.p(n,o):(t=so(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&k(e)}}}const ht="edit-attribute";function Yo(){}function Ba(r,e,t){let n,o,i,s;se(r,Re,f=>t(5,n=f)),se(r,ne,f=>t(6,o=f)),se(r,Ut,f=>t(7,i=f)),se(r,ke,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){ke.set(null)}n.on("mousemove",p),n.on("mouseout",d),n.on("click",c),ot(()=>{n.off("mousemove",p),n.off("mouseout",d),n.off("click",c)});function p(f){var m;if(a==ht){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});je.set(((m=g[0])==null?void 0:m.id)||null)}}function d(){a==ht&&je.set(null)}function c(f){if(a==ht){let m=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0?ke.set(m[0].id):ke.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=i;if(f){let m=o.features.find(g=>g.id==f);m.geometry.type=="Point"?n.flyTo({center:m.geometry.coordinates,duration:500}):n.fitBounds(rr(m),{padding:200,duration:500}),l(ht)}}},[a,s,l,Yo,u,n,o,i]}class Da extends V{constructor(e){super(),K(this,e,Ba,xa,Y,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Yo}get stop(){return this.$$.ctx[4]}}function ja(r){let e,t;return{c:G,m(n,o){e||(t=U(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function qa(r,e,t){let{tool:n}=e;function o(i){i.key=="Escape"&&(n.cancel(),i.preventDefault())}return r.$$set=i=>{"tool"in i&&t(1,n=i.tool)},[o,n]}class Rn extends V{constructor(e){super(),K(this,e,qa,ja,Y,{tool:1})}}function Ua(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ga(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ha(r){let e,t,n,o,i,s,a,l,u,p;function d(m,g){return m[1]?Ga:Ua}let c=d(r),f=c(r);return a=new Rn({props:{tool:r[0]}}),{c(){e=E("ul"),f.c(),t=R(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",o=R(),i=E("button"),i.textContent="Cancel",s=R(),x(a.$$.fragment),O(i,"type","button")},m(m,g){w(m,e,g),f.m(e,null),S(e,t),S(e,n),w(m,o,g),w(m,i,g),w(m,s,g),B(a,m,g),l=!0,u||(p=U(i,"click",r[2]),u=!0)},p(m,[g]){c!==(c=d(m))&&(f.d(1),f=c(m),f&&(f.c(),f.m(e,t)));const _={};g&1&&(_.tool=m[0]),a.$set(_)},i(m){l||($(a.$$.fragment,m),l=!0)},o(m){L(a.$$.fragment,m),l=!1},d(m){m&&k(e),f.d(),m&&k(o),m&&k(i),m&&k(s),D(a,m),u=!1,p()}}}function za(r,e,t){let{pointTool:n}=e,{editingExisting:o}=e;const i=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,o=s.editingExisting)},[n,o,i]}class Xo extends V{constructor(e){super(),K(this,e,za,Ha,Y,{pointTool:0,editingExisting:1})}}function Ja(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Ya(r){let e,t,n,o,i,s,a,l,u,p,d;return e=new Cn({props:{label:"Help",$$slots:{default:[Ja]},$$scope:{ctx:r}}}),l=new Rn({props:{tool:r[0]}}),{c(){x(e.$$.fragment),t=R(),n=E("div"),o=E("button"),o.textContent="Finish",i=R(),s=E("button"),s.textContent="Cancel",a=R(),x(l.$$.fragment),O(o,"type","button"),O(s,"type","button"),ce(n,"display","flex"),ce(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,o),S(n,i),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(d=[U(o,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const m={};f&8&&(m.$$scope={dirty:f,ctx:c}),e.$set(m);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){L(e.$$.fragment,c),L(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Ce(d)}}}function Xa(r,e,t){let{polygonTool:n}=e;const o=()=>n.finish(),i=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,o,i]}class Wo extends V{constructor(e){super(),K(this,e,Xa,Ya,Y,{polygonTool:0})}}function Wa(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Va(r){let e,t,n,o,i,s,a,l,u,p,d;return e=new Cn({props:{label:"Help",$$slots:{default:[Wa]},$$scope:{ctx:r}}}),l=new Rn({props:{tool:r[0]}}),{c(){x(e.$$.fragment),t=R(),n=E("div"),o=E("button"),o.textContent="Finish",i=R(),s=E("button"),s.textContent="Cancel",a=R(),x(l.$$.fragment),O(o,"type","button"),O(s,"type","button"),ce(n,"display","flex"),ce(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,o),S(n,i),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(d=[U(o,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const m={};f&8&&(m.$$scope={dirty:f,ctx:c}),e.$set(m);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){L(e.$$.fragment,c),L(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Ce(d)}}}function Ka(r,e,t){let{routeTool:n}=e;const o=()=>n.finish(),i=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,o,i]}class Vo extends V{constructor(e){super(),K(this,e,Ka,Va,Y,{routeTool:0})}}function Za(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Qa(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,m,g;return e=new Cn({props:{label:"Help",$$slots:{default:[Za]},$$scope:{ctx:r}}}),c=new Rn({props:{tool:r[0]}}),{c(){x(e.$$.fragment),t=R(),n=E("label"),o=E("input"),i=W(`
  Avoid doubling back`),s=R(),a=E("div"),l=E("button"),l.textContent="Finish",u=R(),p=E("button"),p.textContent="Cancel",d=R(),x(c.$$.fragment),O(o,"type","checkbox"),O(l,"type","button"),O(p,"type","button"),ce(a,"display","flex"),ce(a,"justify-content","space-between")},m(_,v){B(e,_,v),w(_,t,v),w(_,n,v),S(n,o),o.checked=r[1],S(n,i),w(_,s,v),w(_,a,v),S(a,l),S(a,u),S(a,p),w(_,d,v),B(c,_,v),f=!0,m||(g=[U(o,"change",r[2]),U(l,"click",r[3]),U(p,"click",r[4])],m=!0)},p(_,[v]){const h={};v&32&&(h.$$scope={dirty:v,ctx:_}),e.$set(h),v&2&&(o.checked=_[1]);const b={};v&1&&(b.tool=_[0]),c.$set(b)},i(_){f||($(e.$$.fragment,_),$(c.$$.fragment,_),f=!0)},o(_){L(e.$$.fragment,_),L(c.$$.fragment,_),f=!1},d(_){D(e,_),_&&k(t),_&&k(n),_&&k(s),_&&k(a),_&&k(d),D(c,_),m=!1,Ce(g)}}}function eu(r,e,t){let{routeTool:n}=e,o=!1;function i(){o=this.checked,t(1,o)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:o})},[n,o,i,s,a]}class Ko extends V{constructor(e){super(),K(this,e,eu,Qa,Y,{routeTool:0})}}function lo(r){let e,t,n,o;const i=[iu,ou,ru,nu,tu],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=i[e](r),{c(){t.c(),n=be()},m(l,u){s[e].m(l,u),w(l,n,u),o=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(ue(),L(s[p],1,1,()=>{s[p]=null}),fe(),t=s[e],t?t.p(l,u):(t=s[e]=i[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){o||($(t),o=!0)},o(l){L(t),o=!1},d(l){s[e].d(l),l&&k(n)}}}function tu(r){let e;return{c(){e=E("p"),e.textContent="Click an object to edit its geometry"},m(t,n){w(t,e,n)},p:G,i:G,o:G,d(t){t&&k(e)}}}function nu(r){let e,t;return e=new Ko({props:{routeTool:r[3]}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.routeTool=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ru(r){let e,t;return e=new Vo({props:{routeTool:r[3]}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.routeTool=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ou(r){let e,t;return e=new Wo({props:{polygonTool:r[2]}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&4&&(i.polygonTool=n[2]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function iu(r){let e,t;return e=new Xo({props:{pointTool:r[1],editingExisting:!0}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.pointTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function su(r){let e,t,n=r[0]==Ue&&lo(r);return{c(){n&&n.c(),e=be()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==Ue?n?(n.p(o,i),i&1&&$(n,1)):(n=lo(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ue(),L(n,1,1,()=>{n=null}),fe())},i(o){t||($(n),t=!0)},o(o){L(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const Ue="edit-geometry";function Zo(){}function lu(r,e,t){let n;se(r,Re,g=>t(8,n=g));let{mode:o}=e,{pointTool:i}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(i.stop(),s.stop(),a.stop(),ne.update(g=>{let _=g.features.find(v=>v.id==l);return delete _.properties.hide_while_editing,g})),l=null,t(4,u=null),je.set(null)}n.on("mousemove",d),n.on("mouseout",c),n.on("click",f),ot(()=>{n.off("mousemove",d),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(g=>{o==Ue&&(ne.update(_=>{let v=_.features.find(h=>h.id==l);return v.properties.length_meters=g.properties.length_meters,v.properties.waypoints=g.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=g.geometry,_}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{o==Ue&&(ne.update(_=>{let v=_.features.find(h=>h.id==l);return v.properties.waypoints=g.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=g.geometry,_}),l=null,t(4,u=null))});for(let g of[i,s])g.addEventListenerSuccess(_=>{o==Ue&&(ne.update(v=>{let h=v.features.find(b=>b.id==l);return h.geometry=_.geometry,delete h.properties.hide_while_editing,v}),l=null,t(4,u=null))});for(let g of[i,s,a])g.addEventListenerFailure(()=>{o==Ue&&(ne.update(_=>{let v=_.features.find(h=>h.id==l);return delete v.properties.hide_while_editing,_}),l=null,t(4,u=null))});function d(g){var _;if(o==Ue&&l==null){let v=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});je.set(((_=v[0])==null?void 0:_.id)||null)}}function c(){o==Ue&&l==null&&je.set(null)}function f(g){if(o==Ue&&l==null){let _=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&m(_[0].id)}}function m(g){je.set(null);let _=null;ne.update(h=>(_=h.features.find(b=>b.id==g),_.properties.hide_while_editing=!0,h));let v=_;l=g,v.geometry.type=="LineString"?(a.editExistingRoute(v),t(4,u="route")):v.geometry.type=="Polygon"?v.properties.waypoints?(a.editExistingArea(v),t(4,u="snap-polygon")):(s.editExisting(v),t(4,u="free-polygon")):v.geometry.type=="Point"&&(i.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"pointTool"in g&&t(1,i=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[o,i,s,a,u,Zo,p]}class au extends V{constructor(e){super(),K(this,e,lu,su,Y,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Zo}get stop(){return this.$$.ctx[6]}}async function uu(r,e){const t=await fetch(r),n=t.body.getReader(),o=t.headers.get("Content-Length");let i=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),i+=p.length;const d=100*i/o;e.style=`background: linear-gradient(to right, red ${d}%, transparent 0);`}let a=new Uint8Array(i),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function fu(r){let e,t;return e=new Ko({props:{routeTool:r[0]}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&1&&(i.routeTool=n[0]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function cu(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&k(e),r[7](null)}}}function pu(r){let e,t,n,o;const i=[cu,fu],s=[];function a(l,u){return l[0]?l[1]==tr?1:-1:0}return~(e=a(r))&&(t=s[e]=i[e](r)),{c(){t&&t.c(),n=be()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),o=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(ue(),L(s[p],1,1,()=>{s[p]=null}),fe()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=i[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){o||($(t),o=!0)},o(l){L(t),o=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const tr="route";function du(r,e,t){let n;se(r,Re,c=>t(8,n=c));let{mode:o}=e,{changeMode:i}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}Jt(async()=>{await Jo(),console.log(`Grabbing ${s}`);try{const c=await uu(s,a);t(0,l=new Aa(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{o==tr&&i("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{o==tr&&(ne.update(f=>(c.id=Yt(f),c.properties.intervention_type="route",f.features.push(c),f)),i("edit-attribute"),ke.set(c.id))})});function d(c){ae[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,o=c.mode),"changeMode"in c&&t(3,i=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,o,a,i,s,u,p,d]}class hu extends V{constructor(e){super(),K(this,e,du,pu,Y,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function ao(r){let e,t;return e=new Xo({props:{pointTool:r[1],editingExisting:!1}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.pointTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function mu(r){let e,t,n=r[0]==yn&&ao(r);return{c(){n&&n.c(),e=be()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==yn?n?(n.p(o,i),i&1&&$(n,1)):(n=ao(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ue(),L(n,1,1,()=>{n=null}),fe())},i(o){t||($(n),t=!0)},o(o){L(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const yn="point";function _u(r,e,t){let{mode:n}=e,{changeMode:o}=e,{pointTool:i}=e;function s(){i.start()}function a(){i.stop()}return i.addEventListenerSuccess(l=>{n==yn&&(ne.update(u=>(l.id=Yt(u),l.properties.intervention_type="other",u.features.push(l),u)),o("edit-attribute"),ke.set(l.id))}),i.addEventListenerFailure(()=>{n==yn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"pointTool"in l&&t(1,i=l.pointTool)},[n,i,o,s,a]}class gu extends V{constructor(e){super(),K(this,e,_u,mu,Y,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function uo(r){let e,t;return e=new Wo({props:{polygonTool:r[1]}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.polygonTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function bu(r){let e,t,n=r[0]==wn&&uo(r);return{c(){n&&n.c(),e=be()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==wn?n?(n.p(o,i),i&1&&$(n,1)):(n=uo(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ue(),L(n,1,1,()=>{n=null}),fe())},i(o){t||($(n),t=!0)},o(o){L(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const wn="free-polygon";function vu(r,e,t){let{mode:n}=e,{changeMode:o}=e,{polygonTool:i}=e;function s(){i.startNew()}function a(){i.stop()}return i.addEventListenerSuccess(l=>{n==wn&&(ne.update(u=>(l.id=Yt(u),l.properties.intervention_type="area",u.features.push(l),u)),o("edit-attribute"),ke.set(l.id))}),i.addEventListenerFailure(()=>{n==wn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"polygonTool"in l&&t(1,i=l.polygonTool)},[n,i,o,s,a]}class yu extends V{constructor(e){super(),K(this,e,vu,bu,Y,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function fo(r){let e,t;return e=new Vo({props:{routeTool:r[1]}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.routeTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function wu(r){let e,t,n=r[0]==kn&&fo(r);return{c(){n&&n.c(),e=be()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==kn?n?(n.p(o,i),i&1&&$(n,1)):(n=fo(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ue(),L(n,1,1,()=>{n=null}),fe())},i(o){t||($(n),t=!0)},o(o){L(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const kn="snap-polygon";function ku(r,e,t){let{mode:n}=e,{changeMode:o}=e,{routeTool:i}=e;function s(){i.startArea()}function a(){i.stop()}return i.addEventListenerSuccessArea(l=>{n==kn&&(ne.update(u=>(l.id=Yt(u),l.properties.intervention_type="area",u.features.push(l),u)),o("edit-attribute"),ke.set(l.id))}),i.addEventListenerFailure(()=>{n==kn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"routeTool"in l&&t(1,i=l.routeTool)},[n,i,o,s,a]}class Su extends V{constructor(e){super(),K(this,e,ku,wu,Y,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Eu(r){var e=r[0],t=r[1],n=r[2],o=r[3],i=Je(r.slice(0,2),[n,t]),s=Je(r.slice(0,2),[e,o]);if(i>=s){var a=(t+o)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(o-t)/2,t,l+(o-t)/2,o]}}function Mu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,o=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(o===!1||o===void 0)&&(r=JSON.parse(JSON.stringify(r)));var i=Math.pow(10,t);return gi(r,function(s){$u(s,i,n)}),r}function $u(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Lu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Vn(r),n=Vn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var o=Mu(e,{precision:7});switch(n){case"Point":return nr(r,o);case"MultiPoint":return co(r,o);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return co(r,Ho(r,o))}}function co(r,e){var t=[],n=Et();return or(e,function(o){if(t.forEach(function(a,l){a.id=l}),!t.length)t=nr(r,o).features,t.forEach(function(a){a.bbox||(a.bbox=Eu(bi(a)))}),n.load(We(t));else{var i=n.search(o);if(i.features.length){var s=Qo(o,i);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),dn(nr(s,o),function(a){t.push(a),n.insert(a)})}}}),We(t)}function nr(r,e){var t=[],n=qe(r)[0],o=qe(r)[r.geometry.coordinates.length-1];if(Bn(n,Ve(e))||Bn(o,Ve(e)))return We([r]);var i=Et(),s=Kn(r);i.load(s);var a=i.search(e);if(!a.features.length)return We([r]);var l=Qo(e,a),u=[n],p=vi(s,function(d,c,f){var m=qe(c)[1],g=Ve(e);return f===l.id?(d.push(g),t.push(kt(d)),Bn(g,m)?[g]:[g,m]):(d.push(m),d)},u);return p.length>1&&t.push(kt(p)),We(t)}function Qo(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return dn(e,function(o){var i=zt(o,r),s=i.properties.dist;s<n&&(t=o,n=s)}),t}function Bn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Ou(r,e,t){var n=qe(t);if(Vn(t)!=="LineString")throw new Error("line must be a LineString");var o=zt(t,r),i=zt(t,e),s;o.properties.index<=i.properties.index?s=[o,i]:s=[i,o];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),kt(a,t.properties)}function po(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Cu(r){let e,t,n,o=r[0]==jt&&po();return{c(){o&&o.c(),e=be()},m(i,s){o&&o.m(i,s),w(i,e,s),t||(n=U(window,"keydown",r[1]),t=!0)},p(i,[s]){i[0]==jt?o||(o=po(),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null)},i:G,o:G,d(i){o&&o.d(i),i&&k(e),t=!1,n()}}}const jt="split-route",Ru=10,Iu=30;let Dn="split-route";function ei(){}function ho(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Au(r,e,t){let n,o;se(r,ne,g=>t(8,n=g)),se(r,Re,g=>t(6,o=g));let{mode:i}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;o.on("mousemove",p),o.on("click",d),ot(()=>{o.off("mousemove",p),o.off("click",d)}),Qe(o,Dn,Pe()),we(o,{id:"draw-split-route",source:Dn,...Mt("black",Ru,["case",["==",["get","snapped"],!0],1,.5])});function p(g){if(i!=jt)return;t(5,l=ho(g.lngLat.toArray(),!1)),u=null;const _=[g.point.x-Iu,g.point.y],v=o.unproject(g.point).distanceTo(o.unproject(_))/1e3;let h=[];for(let[b,y]of n.features.entries())if(y.geometry.type=="LineString"){let M=zt(y.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=v&&h.push([b,M.geometry.coordinates,M.properties.dist])}h.sort((b,y)=>b[2]-y[2]),h.length>0&&(t(5,l=ho(h[0][1],!0)),u=h[0][0])}function d(){if(i==jt)if(u==null)s("edit-attribute");else{let g=Lu(n.features[u],l);if(g.features.length==2){let _=g.features[0],v=g.features[1];ne.update(h=>(_.id=h.features[u].id,v.id=Yt(h),_.properties=JSON.parse(JSON.stringify(h.features[u].properties)),v.properties=JSON.parse(JSON.stringify(_.properties)),c(h.features[u],_,v,l),h.features.splice(u,1,_,v),h))}a()}}function c(g,_,v,h){_.properties.length_meters=on(_,{units:"kilometers"})*1e3,v.properties.length_meters=on(v,{units:"kilometers"})*1e3,_.properties.waypoints=[],v.properties.waypoints=[];let b=f(g,h),y=!0,M=0;for(let C of g.properties.waypoints){let T=f(g,vt([C.lon,C.lat]));if(y)if(T<b)_.properties.waypoints.push(C);else{let I=C.snapped&&g.properties.waypoints[M-1].snapped;_.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:I}),y=!1,v.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:I}),v.properties.waypoints.push(C)}else v.properties.waypoints.push(C);M++}}function f(g,_){let v=g.geometry.coordinates[0],h=Ou(v,_,g);return on(h,{units:"kilometers"})*1e3}function m(g){i==jt&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=Pe();l&&g.features.push(l),o.getSource(Dn).setData(g)}},[i,m,s,ei,a,l,o]}class Tu extends V{constructor(e){super(),K(this,e,Au,Cu,Y,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ei}get stop(){return this.$$.ctx[4]}}const Fu="/atip/speed_limit/assets/edit_attributes-29b396e1.svg",Pu="/atip/speed_limit/assets/edit_geometry-02dad294.svg",Nu="/atip/speed_limit/assets/point-276f4055.svg",xu="/atip/speed_limit/assets/polygon_snapped-18efbbea.svg",Bu="/atip/speed_limit/assets/polygon_freehand-cf965967.svg",Du="/atip/speed_limit/assets/route-d3c0ebad.svg",ju="/atip/speed_limit/assets/split_route-9e0ea2da.svg";function mo(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new au({props:n}),r[15](e),{c(){x(e.$$.fragment)},m(o,i){B(e,o,i),t=!0},p(o,i){const s={};i&8&&(s.mode=o[3]),i&4&&(s.routeTool=o[2]),e.$set(s)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){L(e.$$.fragment,o),t=!1},d(o){r[15](null),D(e,o)}}}function _o(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"point",label:"New point",icon:Nu,changeMode:r[13]}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function go(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Su({props:n}),r[18](e),{c(){x(e.$$.fragment)},m(o,i){B(e,o,i),t=!0},p(o,i){const s={};i&8&&(s.mode=o[3]),i&4&&(s.routeTool=o[2]),e.$set(s)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){L(e.$$.fragment,o),t=!1},d(o){r[18](null),D(e,o)}}}function bo(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"route",label:"New route",icon:Du,changeMode:r[13]}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function vo(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:ju,changeMode:r[13]}}),{c(){x(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function qu(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,m,g,_,v,h,b,y,M,C,T,I,N,A,j,Z,P,H,le,Se;n=new nt({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:Fu,changeMode:r[13]}});let Ae={mode:r[3],changeMode:r[13]};i=new Da({props:Ae}),r[14](i),l=new nt({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:Pu,changeMode:r[13]}});let oe=r[2]&&mo(r),re=r[1]!="planning"&&_o(r),xe={mode:r[3],changeMode:r[13],pointTool:r[11]};f=new gu({props:xe}),r[16](f),_=new nt({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:Bu,changeMode:r[13]}});let Le={mode:r[3],changeMode:r[13],polygonTool:r[12]};h=new yu({props:Le}),r[17](h),M=new nt({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:xu,changeMode:r[13]}});let Q=r[2]&&go(r),he=r[1]!="planning"&&bo(r);function Wt(q){r[20](q)}let _e={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(_e.routeTool=r[2]),A=new hu({props:_e}),r[19](A),ae.push(()=>Ee(A,"routeTool",Wt,r[2]));let F=r[1]!="planning"&&vo(r),te={mode:r[3],changeMode:r[13]};return le=new Tu({props:te}),r[21](le),{c(){e=E("div"),t=E("div"),x(n.$$.fragment),o=R(),x(i.$$.fragment),s=R(),a=E("div"),x(l.$$.fragment),u=R(),oe&&oe.c(),p=R(),d=E("div"),re&&re.c(),c=R(),x(f.$$.fragment),m=R(),g=E("div"),x(_.$$.fragment),v=R(),x(h.$$.fragment),b=R(),y=E("div"),x(M.$$.fragment),C=R(),Q&&Q.c(),T=R(),I=E("div"),he&&he.c(),N=R(),x(A.$$.fragment),Z=R(),P=E("div"),F&&F.c(),H=R(),x(le.$$.fragment),O(e,"class","toolbox svelte-4s4d3o")},m(q,pe){w(q,e,pe),S(e,t),B(n,t,null),S(t,o),B(i,t,null),S(e,s),S(e,a),B(l,a,null),S(a,u),oe&&oe.m(a,null),S(e,p),S(e,d),re&&re.m(d,null),S(d,c),B(f,d,null),S(e,m),S(e,g),B(_,g,null),S(g,v),B(h,g,null),S(e,b),S(e,y),B(M,y,null),S(y,C),Q&&Q.m(y,null),S(e,T),S(e,I),he&&he.m(I,null),S(I,N),B(A,I,null),S(e,Z),S(e,P),F&&F.m(P,null),S(P,H),B(le,P,null),Se=!0},p(q,[pe]){const ur={};pe&8&&(ur.mode=q[3]),n.$set(ur);const fr={};pe&8&&(fr.mode=q[3]),i.$set(fr);const cr={};pe&8&&(cr.mode=q[3]),l.$set(cr),q[2]?oe?(oe.p(q,pe),pe&4&&$(oe,1)):(oe=mo(q),oe.c(),$(oe,1),oe.m(a,null)):oe&&(ue(),L(oe,1,1,()=>{oe=null}),fe()),q[1]!="planning"?re?(re.p(q,pe),pe&2&&$(re,1)):(re=_o(q),re.c(),$(re,1),re.m(d,c)):re&&(ue(),L(re,1,1,()=>{re=null}),fe());const pr={};pe&8&&(pr.mode=q[3]),f.$set(pr);const dr={};pe&8&&(dr.mode=q[3]),_.$set(dr);const hr={};pe&8&&(hr.mode=q[3]),h.$set(hr);const mr={};pe&8&&(mr.mode=q[3]),M.$set(mr),q[2]?Q?(Q.p(q,pe),pe&4&&$(Q,1)):(Q=go(q),Q.c(),$(Q,1),Q.m(y,null)):Q&&(ue(),L(Q,1,1,()=>{Q=null}),fe()),q[1]!="planning"?he?(he.p(q,pe),pe&2&&$(he,1)):(he=bo(q),he.c(),$(he,1),he.m(I,N)):he&&(ue(),L(he,1,1,()=>{he=null}),fe());const Vt={};pe&8&&(Vt.mode=q[3]),pe&1&&(Vt.url=q[0]),!j&&pe&4&&(j=!0,Vt.routeTool=q[2],Me(()=>j=!1)),A.$set(Vt),q[1]!="planning"?F?(F.p(q,pe),pe&2&&$(F,1)):(F=vo(q),F.c(),$(F,1),F.m(P,H)):F&&(ue(),L(F,1,1,()=>{F=null}),fe());const _r={};pe&8&&(_r.mode=q[3]),le.$set(_r)},i(q){Se||($(n.$$.fragment,q),$(i.$$.fragment,q),$(l.$$.fragment,q),$(oe),$(re),$(f.$$.fragment,q),$(_.$$.fragment,q),$(h.$$.fragment,q),$(M.$$.fragment,q),$(Q),$(he),$(A.$$.fragment,q),$(F),$(le.$$.fragment,q),Se=!0)},o(q){L(n.$$.fragment,q),L(i.$$.fragment,q),L(l.$$.fragment,q),L(oe),L(re),L(f.$$.fragment,q),L(_.$$.fragment,q),L(h.$$.fragment,q),L(M.$$.fragment,q),L(Q),L(he),L(A.$$.fragment,q),L(F),L(le.$$.fragment,q),Se=!1},d(q){q&&k(e),D(n),r[14](null),D(i),D(l),oe&&oe.d(),re&&re.d(),r[16](null),D(f),D(_),r[17](null),D(h),D(M),Q&&Q.d(),he&&he.d(),r[19](null),D(A),F&&F.d(),r[21](null),D(le)}}}function Uu(r,e,t){let n;se(r,Re,A=>t(22,n=A));let{routeSnapperUrl:o}=e,{schema:i}=e,s,a=new ca(n),l=new Sa(n),u="edit-attribute",p,d,c,f,m,g,_;function v(A){let j={"edit-attribute":p,"edit-geometry":d,route:c,point:f,"free-polygon":m,"snap-polygon":g,"split-route":_};if(u==A){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),j[u].stop(),t(3,u=A),console.log(`Starting new mode ${u}`),j[u].start()}ot(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function h(A){ae[A?"unshift":"push"](()=>{p=A,t(4,p)})}function b(A){ae[A?"unshift":"push"](()=>{d=A,t(5,d)})}function y(A){ae[A?"unshift":"push"](()=>{f=A,t(7,f)})}function M(A){ae[A?"unshift":"push"](()=>{m=A,t(8,m)})}function C(A){ae[A?"unshift":"push"](()=>{g=A,t(9,g)})}function T(A){ae[A?"unshift":"push"](()=>{c=A,t(6,c)})}function I(A){s=A,t(2,s)}function N(A){ae[A?"unshift":"push"](()=>{_=A,t(10,_)})}return r.$$set=A=>{"routeSnapperUrl"in A&&t(0,o=A.routeSnapperUrl),"schema"in A&&t(1,i=A.schema)},[o,i,s,u,p,d,c,f,m,g,_,a,l,v,h,b,y,M,C,T,I,N]}class Gu extends V{constructor(e){super(),K(this,e,Uu,qu,Y,{routeSnapperUrl:0,schema:1})}}function Hu(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,m,g,_,v,h,b;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",o=R(),i=E("button"),i.textContent="About",s=R(),a=E("button"),a.textContent="Instructions",l=R(),u=E("br"),p=R(),d=E("label"),c=W(`ATIP schema:
      `),f=E("select"),m=E("option"),m.textContent="v1",g=E("option"),g.textContent="v2",_=E("option"),_.textContent="Housing developments",v=E("option"),v.textContent="Critical issues",O(n,"type","button"),O(i,"type","button"),O(a,"type","button"),m.__value="v1",m.value=m.__value,g.__value="v2",g.value=g.__value,_.__value="planning",_.value=_.__value,v.__value="criticals",v.value=v.__value,r[2]===void 0&&it(()=>r[12].call(f)),O(e,"slot","nav")},m(y,M){w(y,e,M),S(e,t),S(t,n),S(t,o),S(t,i),S(t,s),S(t,a),S(e,l),S(e,u),S(e,p),S(e,d),S(d,c),S(d,f),S(f,m),S(f,g),S(f,_),S(f,v),Ke(f,r[2]),h||(b=[U(n,"click",r[11]),U(i,"click",r[8]),U(a,"click",r[9]),U(f,"change",r[12]),U(f,"change",r[10])],h=!0)},p(y,M){M&4&&Ke(f,y[2])},d(y){y&&k(e),h=!1,Ce(b)}}}function zu(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,m,g,_;return i=new Wl({props:{boundaryGeojson:r[5]}}),a=new zl({props:{authorityName:r[6],schema:r[2]}}),d=new xl({props:{schema:r[2],routeInfo:r[4]}}),g=new jl({props:{routeInfo:r[4]}}),{c(){e=E("div"),t=E("h1"),n=W(r[6]),o=R(),x(i.$$.fragment),s=R(),x(a.$$.fragment),l=R(),u=E("br"),p=R(),x(d.$$.fragment),c=R(),f=E("hr"),m=R(),x(g.$$.fragment),O(e,"slot","sidebar")},m(v,h){w(v,e,h),S(e,t),S(t,n),S(t,o),B(i,t,null),S(e,s),B(a,e,null),S(e,l),S(e,u),S(e,p),B(d,e,null),S(e,c),S(e,f),S(e,m),B(g,e,null),_=!0},p(v,h){const b={};h&32&&(b.boundaryGeojson=v[5]),i.$set(b);const y={};h&4&&(y.schema=v[2]),a.$set(y);const M={};h&4&&(M.schema=v[2]),h&16&&(M.routeInfo=v[4]),d.$set(M);const C={};h&16&&(C.routeInfo=v[4]),g.$set(C)},i(v){_||($(i.$$.fragment,v),$(a.$$.fragment,v),$(d.$$.fragment,v),$(g.$$.fragment,v),_=!0)},o(v){L(i.$$.fragment,v),L(a.$$.fragment,v),L(d.$$.fragment,v),L(g.$$.fragment,v),_=!1},d(v){v&&k(e),D(i),D(a),D(d),D(g)}}}function Ju(r){let e,t,n,o,i,s,a,l,u,p,d,c;return e=new Cs({props:{boundaryGeojson:r[5]}}),n=new aa({props:{schema:r[2]}}),i=new fa({}),a=new Gu({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new Zl({props:{style:r[7]}}),d=new sa({props:{schema:r[2]}}),{c(){x(e.$$.fragment),t=R(),x(n.$$.fragment),o=R(),x(i.$$.fragment),s=R(),x(a.$$.fragment),l=R(),x(u.$$.fragment),p=R(),x(d.$$.fragment)},m(f,m){B(e,f,m),w(f,t,m),B(n,f,m),w(f,o,m),B(i,f,m),w(f,s,m),B(a,f,m),w(f,l,m),B(u,f,m),w(f,p,m),B(d,f,m),c=!0},p(f,m){const g={};m&32&&(g.boundaryGeojson=f[5]),e.$set(g);const _={};m&4&&(_.schema=f[2]),n.$set(_);const v={};m&8&&(v.routeSnapperUrl=f[3]),m&4&&(v.schema=f[2]),a.$set(v);const h={};m&4&&(h.schema=f[2]),d.$set(h)},i(f){c||($(e.$$.fragment,f),$(n.$$.fragment,f),$(i.$$.fragment,f),$(a.$$.fragment,f),$(u.$$.fragment,f),$(d.$$.fragment,f),c=!0)},o(f){L(e.$$.fragment,f),L(n.$$.fragment,f),L(i.$$.fragment,f),L(a.$$.fragment,f),L(u.$$.fragment,f),L(d.$$.fragment,f),c=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(o),D(i,f),f&&k(s),D(a,f),f&&k(l),D(u,f),f&&k(p),D(d,f)}}}function Yu(r){let e,t,n;return t=new Vi({props:{style:r[7],$$slots:{default:[Ju]},$$scope:{ctx:r}}}),{c(){e=E("div"),x(t.$$.fragment),O(e,"slot","main")},m(o,i){w(o,e,i),B(t,e,null),n=!0},p(o,i){const s={};i&524332&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||($(t.$$.fragment,o),n=!0)},o(o){L(t.$$.fragment,o),n=!1},d(o){o&&k(e),D(t)}}}function Xu(r){let e,t,n,o,i,s,a,l;e=new ns({props:{$$slots:{main:[Yu],sidebar:[zu],nav:[Hu]},$$scope:{ctx:r}}});function u(f){r[13](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new yi({props:p}),ae.push(()=>Ee(n,"open",u,r[0]));function d(f){r[14](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Yi({props:c}),ae.push(()=>Ee(s,"open",d,r[1])),{c(){x(e.$$.fragment),t=R(),x(n.$$.fragment),i=R(),x(s.$$.fragment)},m(f,m){B(e,f,m),w(f,t,m),B(n,f,m),w(f,i,m),B(s,f,m),l=!0},p(f,[m]){const g={};m&524348&&(g.$$scope={dirty:m,ctx:f}),e.$set(g);const _={};!o&&m&1&&(o=!0,_.open=f[0],Me(()=>o=!1)),n.$set(_);const v={};!a&&m&2&&(a=!0,v.open=f[1],Me(()=>a=!1)),s.$set(v)},i(f){l||($(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!0)},o(f){L(e.$$.fragment,f),L(n.$$.fragment,f),L(s.$$.fragment,f),l=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(i),D(s,f)}}}function Wu(r,e,t){let n=!1,o=!1,i=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${a}.bin`,d=`https://atip.uk/route-info/${a}.bin`;i||(p=`https://atip.uk/route-snappers-dev/${a}.bin`,d=`https://atip.uk/route-info-dev/${a}.bin`);let c;function f(){t(0,n=!n),t(1,o=!1)}function m(){t(1,o=!o),t(0,n=!1)}let g;Jt(async()=>{t(5,g=await _());const C=Mo(new Fi);t(4,c=await new C),await c.loadFile(d)});async function _(){const T=await(await fetch(wi)).text(),I=JSON.parse(T);return I.features=I.features.filter(N=>{var A;return((A=N.properties)==null?void 0:A.name)==a}),I}function v(){let C=new URLSearchParams(window.location.search);C.set("schema",u);let T=`${window.location.pathname}?${C.toString()}${window.location.hash}`;window.location.href=T}const h=()=>window.open("index.html");function b(){u=En(this),t(2,u)}function y(C){n=C,t(0,n)}function M(C){o=C,t(1,o)}return[n,o,u,p,c,g,a,l,f,m,v,h,b,y,M]}class Vu extends V{constructor(e){super(),K(this,e,Wu,Xu,Y,{})}}new Vu({target:document.getElementById("app")});
