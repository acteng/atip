var to=Object.defineProperty;var no=(r,e,t)=>e in r?to(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var oe=(r,e,t)=>(no(r,typeof e!="symbol"?e+"":e,t),t);import{S as V,i as K,s as Y,M as ro,b as ae,a as Ee,d as N,m as B,k as Me,n as $,o as L,q as D,e as E,c as R,g as w,x as G,p as k,y as xe,f as O,z as fe,B as ce,C as io,D as Yt,E as tn,F as it,G as mt,H as _t,I as gt,J as bt,K as br,h as S,l as q,L as oo,N as so,O as se,P as lo,w as ir,Q as Qe,R as we,T as En,U as cn,V as ue,t as W,W as Ce,X as pn,Y as yt,Z as be,_ as ot,$ as Ke,a0 as Mn,j as Oe,r as Re,a1 as yi,a2 as wt,a3 as dn,a4 as vr,a5 as ao,a6 as uo,a7 as Pe,a8 as fo,a9 as co,aa as $n,ab as Mt,ac as Ln,ad as On,ae as Un,af as po,ag as vt,ah as or,ai as We,aj as kt,ak as ho,al as sr,am as mo,an as _o,ao as go,ap as yr,aq as hn,ar as bo,as as vo,at as yo,A as wo,u as ko}from"./authorities-e00afe1e.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const wi=Symbol("Comlink.proxy"),So=Symbol("Comlink.endpoint"),Eo=Symbol("Comlink.releaseProxy"),In=Symbol("Comlink.finalizer"),nn=Symbol("Comlink.thrown"),ki=r=>typeof r=="object"&&r!==null||typeof r=="function",Mo={canHandle:r=>ki(r)&&r[wi],serialize(r){const{port1:e,port2:t}=new MessageChannel;return lr(r,e),[t,[t]]},deserialize(r){return r.start(),Mi(r)}},$o={canHandle:r=>ki(r)&&nn in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},Si=new Map([["proxy",Mo],["throw",$o]]);function Lo(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function lr(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!Lo(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(et);let u;try{const p=a.slice(0,-1).reduce((c,f)=>c[f],r),d=a.reduce((c,f)=>c[f],r);switch(s){case"GET":u=d;break;case"SET":p[a.slice(-1)[0]]=et(i.data.value),u=!0;break;case"APPLY":u=d.apply(p,l);break;case"CONSTRUCT":{const c=new d(...l);u=To(c)}break;case"ENDPOINT":{const{port1:c,port2:f}=new MessageChannel;lr(r,f),u=Io(c,[c])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[nn]:0}}Promise.resolve(u).catch(p=>({value:p,[nn]:0})).then(p=>{const[d,c]=gn(p);e.postMessage(Object.assign(Object.assign({},d),{id:o}),c),s==="RELEASE"&&(e.removeEventListener("message",n),Ei(e),In in r&&typeof r[In]=="function"&&r[In]())}).catch(p=>{const[d,c]=gn({value:new TypeError("Unserializable return value"),[nn]:0});e.postMessage(Object.assign(Object.assign({},d),{id:o}),c)})}),e.start&&e.start()}function Oo(r){return r.constructor.name==="MessagePort"}function Ei(r){Oo(r)&&r.close()}function Mi(r,e){return qn(r,[],e)}function Zt(r){if(r)throw new Error("Proxy has been released and is not useable")}function $i(r){return pt(r,{type:"RELEASE"}).then(()=>{Ei(r)})}const mn=new WeakMap,_n="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(mn.get(r)||0)-1;mn.set(r,e),e===0&&$i(r)});function Co(r,e){const t=(mn.get(e)||0)+1;mn.set(e,t),_n&&_n.register(r,e,r)}function Ro(r){_n&&_n.unregister(r)}function qn(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(Zt(n),s===Eo)return()=>{Ro(i),$i(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=pt(r,{type:"GET",path:e.map(l=>l.toString())}).then(et);return a.then.bind(a)}return qn(r,[...e,s])},set(o,s,a){Zt(n);const[l,u]=gn(a);return pt(r,{type:"SET",path:[...e,s].map(p=>p.toString()),value:l},u).then(et)},apply(o,s,a){Zt(n);const l=e[e.length-1];if(l===So)return pt(r,{type:"ENDPOINT"}).then(et);if(l==="bind")return qn(r,e.slice(0,-1));const[u,p]=wr(a);return pt(r,{type:"APPLY",path:e.map(d=>d.toString()),argumentList:u},p).then(et)},construct(o,s){Zt(n);const[a,l]=wr(s);return pt(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(et)}});return Co(i,r),i}function Ao(r){return Array.prototype.concat.apply([],r)}function wr(r){const e=r.map(gn);return[e.map(t=>t[0]),Ao(e.map(t=>t[1]))]}const Li=new WeakMap;function Io(r,e){return Li.set(r,e),r}function To(r){return Object.assign(r,{[wi]:!0})}function gn(r){for(const[e,t]of Si)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},Li.get(r)||[]]}function et(r){switch(r.type){case"HANDLER":return Si.get(r.name).deserialize(r.value);case"RAW":return r.value}}function pt(r,e,t){return new Promise(n=>{const i=Po();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function Po(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Fo(){return new Worker("/atip/speed_limit/assets/worker-07877116.js")}let ee;const Oi=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Oi.decode();let At=null;function xt(){return(At===null||At.byteLength===0)&&(At=new Uint8Array(ee.memory.buffer)),At}function tt(r,e){return r=r>>>0,Oi.decode(xt().subarray(r,r+e))}const Ge=new Array(128).fill(void 0);Ge.push(void 0,null,!0,!1);let Nt=Ge.length;function ge(r){Nt===Ge.length&&Ge.push(Ge.length+1);const e=Nt;return Nt=Ge[e],Ge[e]=r,e}function z(r){return Ge[r]}let rt=0;const rn=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},xo=typeof rn.encodeInto=="function"?function(r,e){return rn.encodeInto(r,e)}:function(r,e){const t=rn.encode(r);return e.set(t),{read:r.length,written:t.length}};function Tn(r,e,t){if(t===void 0){const a=rn.encode(r),l=e(a.length)>>>0;return xt().subarray(l,l+a.length).set(a),rt=a.length,l}let n=r.length,i=e(n)>>>0;const o=xt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3)>>>0;const a=xt().subarray(i+s,i+n),l=xo(r,a);s+=l.written}return rt=s,i}function Lt(r){return r==null}let It=null;function de(){return(It===null||It.byteLength===0)&&(It=new Int32Array(ee.memory.buffer)),It}function No(r){r<132||(Ge[r]=Nt,Nt=r)}function Tt(r){const e=z(r);return No(r),e}let Pt=null;function Bo(){return(Pt===null||Pt.byteLength===0)&&(Pt=new Float64Array(ee.memory.buffer)),Pt}let Ft=null;function Do(){return(Ft===null||Ft.byteLength===0)&&(Ft=new BigInt64Array(ee.memory.buffer)),Ft}function Gn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Gn(r[0]));for(let s=1;s<i;s++)o+=", "+Gn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function jo(r,e){const t=e(r.length*1)>>>0;return xt().set(r,t/1),rt=r.length,t}function Pn(r,e){try{return r.apply(this,e)}catch(t){ee.__wbindgen_exn_store(ge(t))}}let Hn=class{static __wrap(e){e=e>>>0;const t=Object.create(Hn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();ee.__wbg_routeinfo_free(e)}constructor(e){try{const o=ee.__wbindgen_add_to_stack_pointer(-16),s=jo(e,ee.__wbindgen_malloc),a=rt;ee.routeinfo_new(o,s,a);var t=de()[o/4+0],n=de()[o/4+1],i=de()[o/4+2];if(i)throw Tt(n);return Hn.__wrap(t)}finally{ee.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const p=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_nameForRoute(p,this.__wbg_ptr,ge(e));var i=de()[p/4+0],o=de()[p/4+1],s=de()[p/4+2],a=de()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,Tt(s);return t=l,n=u,tt(l,u)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const p=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_speedLimitForRoute(p,this.__wbg_ptr,ge(e));var i=de()[p/4+0],o=de()[p/4+1],s=de()[p/4+2],a=de()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,Tt(s);return t=l,n=u,tt(l,u)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(t,n)}}allSpeedLimits(){let e,t;try{const u=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_allSpeedLimits(u,this.__wbg_ptr);var n=de()[u/4+0],i=de()[u/4+1],o=de()[u/4+2],s=de()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,Tt(o);return e=a,t=l,tt(a,l)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(e,t)}}};async function Uo(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function qo(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=tt(e,t);return ge(n)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(tt(e,t));return ge(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=z(t),i=typeof n=="string"?n:void 0;var o=Lt(i)?0:Tn(i,ee.__wbindgen_malloc,ee.__wbindgen_realloc),s=rt;de()[e/4+1]=s,de()[e/4+0]=o},r.wbg.__wbindgen_object_drop_ref=function(e){Tt(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=z(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof z(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return ge(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return z(e)===z(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=z(t),i=typeof n=="number"?n:void 0;Bo()[e/8+1]=Lt(i)?0:i,de()[e/4+0]=!Lt(i)},r.wbg.__wbindgen_is_object=function(e){const t=z(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return z(e)in z(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ge(t)},r.wbg.__wbindgen_is_undefined=function(e){return z(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return z(e)==z(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=z(e);return ge(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=z(e)[z(t)];return ge(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=z(t).stack,i=Tn(n,ee.__wbindgen_malloc,ee.__wbindgen_realloc),o=rt;de()[e/4+1]=o,de()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(tt(e,t))}finally{ee.__wbindgen_free(n,i)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(z(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(z(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(z(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(z(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(z(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=z(e)[t>>>0];return ge(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return z(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof z(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=z(e).next;return ge(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return Pn(function(e){const t=z(e).next();return ge(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return z(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=z(e).value;return ge(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return ge(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return Pn(function(e,t){const n=Reflect.get(z(e),z(t));return ge(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return Pn(function(e,t){const n=z(e).call(z(t));return ge(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(z(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=z(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(z(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(z(e));return ge(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=z(e).buffer;return ge(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(z(e));return ge(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){z(e).set(z(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return z(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=z(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=z(t),i=typeof n=="bigint"?n:void 0;Do()[e/8+1]=Lt(i)?BigInt(0):i,de()[e/4+0]=!Lt(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Gn(z(t)),i=Tn(n,ee.__wbindgen_malloc,ee.__wbindgen_realloc),o=rt;de()[e/4+1]=o,de()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(tt(e,t))},r.wbg.__wbindgen_memory=function(){const e=ee.memory;return ge(e)},r}function Go(r,e){return ee=r.exports,Ci.__wbindgen_wasm_module=e,Ft=null,Pt=null,It=null,At=null,ee}async function Ci(r){if(ee!==void 0)return ee;typeof r>"u"&&(r="/atip/speed_limit/assets/route_info_bg.wasm");const e=qo();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Uo(await r,e);return Go(t,n)}class Ho{constructor(){oe(this,"inner");this.inner=null}async loadFile(e){await Ci(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new Hn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.speedLimitForRoute(e)}allSpeedLimits(){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.allSpeedLimits()}}lr(Ho);function zo(r){let e,t,n,i,o,s,a,l,u,p,d,c,f;return{c(){e=E("p"),e.textContent="For each intervention:",t=R(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=R(),o=E("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=R(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=R(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=R(),d=E("p"),d.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=R(),f=E("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(m,g){w(m,e,g),w(m,t,g),w(m,n,g),w(m,i,g),w(m,o,g),w(m,s,g),w(m,a,g),w(m,l,g),w(m,u,g),w(m,p,g),w(m,d,g),w(m,c,g),w(m,f,g)},p:G,d(m){m&&k(e),m&&k(t),m&&k(n),m&&k(i),m&&k(o),m&&k(s),m&&k(a),m&&k(l),m&&k(u),m&&k(p),m&&k(d),m&&k(c),m&&k(f)}}}function Jo(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[zo]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new ro({props:o}),ae.push(()=>Ee(e,"open",i,r[0])),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Yo(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Xo extends V{constructor(e){super(),K(this,e,Yo,Jo,Y,{open:0})}}const st=[];function $t(r,e=G){let t;const n=new Set;function i(a){if(Y(r,a)&&(r=a,t)){const l=!st.length;for(const u of n)u[1](),st.push(u,r);if(l){for(let u=0;u<st.length;u+=2)st[u][0](st[u+1]);st.length=0}}}function o(a){i(a(r))}function s(a,l=G){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||G),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ae=$t(null),ne=$t(xe()),ke=$t(null),je=$t(null),qt=$t(null),Gt=$t(null);function Xt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function kr(r){console.log(`Deleting intervention ${r}`),ne.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),ke.set(null),je.set(null),qt.set(null),Gt.set(null)}function Sr(r){let e;const t=r[4].default,n=mt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&_t(n,t,i,i[3],e?bt(t,i[3],o,null):gt(i[3]),null)},i(i){e||($(n,i),e=!0)},o(i){L(n,i),e=!1},d(i){n&&n.d(i)}}}function Wo(r){let e,t,n=r[1]&&Sr(r);return{c(){e=E("div"),n&&n.c(),O(e,"class","map svelte-12dpf1u")},m(i,o){w(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&$(n,1)):(n=Sr(i),n.c(),$(n,1),n.m(e,null)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){i&&k(e),n&&n.d(),r[5](null)}}}function Vo(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;io("setCamera",!window.location.hash),Yt(()=>{s=new tn.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new tn.ScaleControl({})),s.addControl(new tn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ae.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),it(()=>{s.remove()});function u(p){ae[p?"unshift":"push"](()=>{a=p,t(0,a)})}return r.$$set=p=>{"style"in p&&t(2,o=p.style),"$$scope"in p&&t(3,i=p.$$scope)},[a,l,o,i,n,u]}class Ko extends V{constructor(e){super(),K(this,e,Vo,Wo,Y,{style:2})}}const Zo=r=>({}),Er=r=>({}),Qo=r=>({}),Mr=r=>({}),es=r=>({}),$r=r=>({});function ts(r){let e,t,n,i,o,s,a,l,u,p,d,c;const f=r[3].nav,m=mt(f,r,r[2],$r),g=r[3].sidebar,_=mt(g,r,r[2],Mr),v=r[3].main,h=mt(v,r,r[2],Er);return{c(){e=E("aside"),t=E("div"),n=E("nav"),m&&m.c(),i=R(),_&&_.c(),o=R(),s=E("button"),s.textContent="→",l=R(),u=E("main"),h&&h.c(),O(n,"class","svelte-1u7vg8a"),O(t,"class","sidebar-content content-container svelte-1u7vg8a"),O(s,"type","button"),O(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),O(e,"class",a=br(r[0]?"":"collapsed")+" svelte-1u7vg8a"),O(u,"class","svelte-1u7vg8a")},m(b,y){w(b,e,y),S(e,t),S(t,n),m&&m.m(n,null),S(t,i),_&&_.m(t,null),S(e,o),S(e,s),w(b,l,y),w(b,u,y),h&&h.m(u,null),p=!0,d||(c=q(s,"click",r[1]),d=!0)},p(b,[y]){m&&m.p&&(!p||y&4)&&_t(m,f,b,b[2],p?bt(f,b[2],y,es):gt(b[2]),$r),_&&_.p&&(!p||y&4)&&_t(_,g,b,b[2],p?bt(g,b[2],y,Qo):gt(b[2]),Mr),(!p||y&1&&a!==(a=br(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&O(e,"class",a),h&&h.p&&(!p||y&4)&&_t(h,v,b,b[2],p?bt(v,b[2],y,Zo):gt(b[2]),Er)},i(b){p||($(m,b),$(_,b),$(h,b),p=!0)},o(b){L(m,b),L(_,b),L(h,b),p=!1},d(b){b&&k(e),m&&m.d(b),_&&_.d(b),b&&k(l),b&&k(u),h&&h.d(b),d=!1,c()}}}function ns(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class rs extends V{constructor(e){super(),K(this,e,ns,ts,Y,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function is(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ze=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function os(r,e){return r>e?1:r<e?-1:0}function ze(r,e,t){for(var n=new Ze(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Fn(r,e,t,n){var i=new Ze(r,e);if(t===null)return i.left=i.right=null,i;t=ze(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Lr(r,e,t){var n=null,i=null;if(e){e=ze(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function ss(r,e,t){return e===null?r:(r===null||(e=ze(r.key,e,t),e.left=r),e)}function zn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&zn(r.left,o,!1,n,i),r.right&&zn(r.right,o,!0,n,i)}}var ar=function(){function r(e){e===void 0&&(e=os),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Fn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ze(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=ze(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=ze(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=ze(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ze(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ze(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return as(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Xn(e,t,0,i-1,o),this._root===null)this._root=Jn(e,t,0,i),this._size=i;else{var s=us(this.toList(),ls(e,t),o);i=this._size+i,this._root=Yn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return zn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Lr(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=Fn(t,n,a,i):s=Fn(t,n,s,i),this._root=ss(s,a,i)},r.prototype.split=function(e){return Lr(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return is(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Jn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ze(s,a);return l.left=Jn(r,e,t,o),l.right=Jn(r,e,o+1,n),l}return null}function ls(r,e){for(var t=new Ze(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ze(r[i],e[i]);return n.next=null,t.next}function as(r){for(var e=r,t=[],n=!1,i=new Ze(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Yn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Yn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Yn(r,i+1,t),s}return null}function us(r,e,t){for(var n=new Ze(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Xn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Xn(r,e,t,a,i),Xn(r,e,a+1,n,i)}}function Ie(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Or(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function $e(r,e,t){return e&&Or(r.prototype,e),t&&Or(r,t),r}var Ot=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Wn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Ye=Number.EPSILON;Ye===void 0&&(Ye=Math.pow(2,-52));var fs=Ye*Ye,Vn=function(e,t){if(-Ye<e&&e<Ye&&-Ye<t&&t<Ye)return 0;var n=e-t;return n*n<fs*e*t?0:e<t?-1:1},cs=function(){function r(){Ie(this,r),this.reset()}return $e(r,[{key:"reset",value:function(){this.xRounder=new Cr,this.yRounder=new Cr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Cr=function(){function r(){Ie(this,r),this.tree=new ar,this.round(0)}return $e(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Vn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Vn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Ht=new cs,Bt=function(e,t){return e.x*t.y-e.y*t.x},Ri=function(e,t){return e.x*t.x+e.y*t.y},Rr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Bt(i,o);return Vn(s,0)},bn=function(e){return Math.sqrt(Ri(e,e))},ps=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Bt(o,i)/bn(o)/bn(i)},ds=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Ri(o,i)/bn(o)/bn(i)},Ar=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Ir=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},hs=function(e,t,n,i){if(t.x===0)return Ir(n,i,e.x);if(i.x===0)return Ir(e,t,n.x);if(t.y===0)return Ar(n,i,e.y);if(i.y===0)return Ar(e,t,n.y);var o=Bt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=Bt(s,t)/o,l=Bt(s,i)/o,u=e.x+l*t.x,p=n.x+a*i.x,d=e.y+l*t.y,c=n.y+a*i.y,f=(u+p)/2,m=(d+c)/2;return{x:f,y:m}},De=function(){$e(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:vn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Ie(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return $e(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:ps(n.point,t.point,l.point),cosine:ds(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,p=l.cosine,d=i.get(a),c=d.sine,f=d.cosine;return u>=0&&c>=0?p<f?1:p>f?-1:0:u<0&&c<0?p<f?-1:p>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),ms=0,vn=function(){$e(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,d=n.rightSE.point.y;if(i<o){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<d)return-1;if(l>u&&l>d)return 1;var m=n.comparePoint(t.leftSE.point);if(m!==0)return m;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>a){var v=t.comparePoint(n.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(s!==a){var h=p-l,b=s-i,y=d-u,M=a-o;if(h>b&&y<M)return 1;if(h<b&&y>M)return-1}return s>a?1:s<a||p<d?-1:p>d?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Ie(this,r),this.id=++ms,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return $e(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Wn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=Ot(n,l)&&this.comparePoint(l)===0,d=Ot(i,s)&&t.comparePoint(s)===0,c=Ot(n,u)&&this.comparePoint(u)===0,f=Ot(i,a)&&t.comparePoint(a)===0;if(d&&p)return f&&!c?a:!f&&c?u:null;if(d)return c&&s.x===u.x&&s.y===u.y?null:s;if(p)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var m=hs(s,this.vector(),l,t.vector());return m===null||!Ot(o,m)?null:Ht.round(m.x,m.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new De(t,!0),s=new De(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return De.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),De.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var p=i.rings[l],d=i.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(d)):n.windings[c]+=d}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),i.push(u)):i[p]+=u}for(var d=[],c=[],f=0,m=n.length;f<m;f++)if(i[f]!==0){var g=n[f],_=g.poly;if(c.indexOf(_)===-1)if(g.isExterior)d.push(_);else{c.indexOf(_)===-1&&c.push(_);var v=d.indexOf(g.poly);v!==-1&&d.splice(v,1)}}for(var h=0,b=d.length;h<b;h++){var y=d[h].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Fe.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Fe.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(d){return d.length===1&&d[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Fe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=De.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new De(o,!0),p=new De(s,!1);return new r(u,p,[i],[a])}}]),r}(),Tr=function(){function r(e,t,n){if(Ie(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Ht.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Ht.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(vn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(vn.fromRing(o,i,this))}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),_s=function(){function r(e,t){if(Ie(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Tr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Tr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Pr=function(){function r(e,t){if(Ie(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new _s(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),gs=function(){$e(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],d=l.point,c=[];a=l,l=u,p.push(l),l.point!==d;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var m=p[0].point,g=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(m.x,",")+" ".concat(m.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var _=null,v=0,h=c.length;v<h;v++)if(c[v].point===l.point){_=v;break}if(_!==null){var b=c.splice(_)[0],y=p.splice(b.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}c.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Ie(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return $e(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Rr(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Rr(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],m=d;m!=c;m+=p)f.push([n[m].x,n[m].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];De.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Fr=function(){function r(e){Ie(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return $e(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),bs=function(){function r(e){Ie(this,r),this.rings=e,this.polys=this._composePolys(e)}return $e(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Fr(s));else{var a=s.enclosingRing();a.poly||n.push(new Fr(a)),a.poly.addInterior(s)}}return n}}]),r}(),vs=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vn.compare;Ie(this,r),this.queue=e,this.tree=new ar(t),this.segments=[]}return $e(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var d=l.getIntersection(n);if(d!==null&&(n.isAnEndpoint(d)||(p=d),!l.isAnEndpoint(d)))for(var c=this._splitSafely(l,d),f=0,m=c.length;f<m;f++)i.push(c[f])}var g=null;if(u){var _=u.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(g=_),!u.isAnEndpoint(_)))for(var v=this._splitSafely(u,_),h=0,b=v.length;h<b;h++)i.push(v[h])}if(p!==null||g!==null){var y=null;if(p===null)y=g;else if(g===null)y=p;else{var M=De.comparePoints(p,g);y=M<=0?p:g}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var C=n.split(y),T=0,A=C.length;T<A;T++)i.push(C[T])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var x=l.getIntersection(u);if(x!==null){if(!l.isAnEndpoint(x))for(var I=this._splitSafely(l,x),j=0,Z=I.length;j<Z;j++)i.push(I[j]);if(!u.isAnEndpoint(x))for(var F=this._splitSafely(u,x),H=0,le=F.length;H<le;H++)i.push(F[H])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),xr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ys=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ws=function(){function r(){Ie(this,r)}return $e(r,[{key:"run",value:function(t,n,i){Fe.type=t,Ht.reset();for(var o=[new Pr(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Pr(i[s],!1));if(Fe.numMultiPolys=o.length,Fe.type==="difference")for(var l=o[0],u=1;u<o.length;)Wn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Fe.type==="intersection"){for(var p=0,d=o.length;p<d;p++)for(var c=o[p],f=p+1,m=o.length;f<m;f++)if(Wn(c.bbox,o[f].bbox)===null)return[]}for(var g=new ar(De.compare),_=0,v=o.length;_<v;_++)for(var h=o[_].getSweepEvents(),b=0,y=h.length;b<y;b++)if(g.insert(h[b]),g.size>xr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new vs(g),C=g.size,T=g.pop();T;){var A=T.key;if(g.size===C){var x=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(x.id," ")+"[".concat(x.leftSE.point.x,", ").concat(x.leftSE.point.y,"] -> ")+"[".concat(x.rightSE.point.x,", ").concat(x.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>xr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>ys)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var I=M.process(A),j=0,Z=I.length;j<Z;j++){var F=I[j];F.consumedBy===void 0&&g.insert(F)}C=g.size,T=g.pop()}Ht.reset();var H=gs.factory(M.segments),le=new bs(H);return le.getGeom()}}]),r}(),Fe=new ws,ks=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Fe.run("union",e,n)},Ss=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Fe.run("intersection",e,n)},Es=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Fe.run("xor",e,n)},Ms=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Fe.run("difference",e,n)},on={union:ks,intersection:Ss,xor:Es,difference:Ms};function $s(r,e){var t=Os(e),n=null;return r.type==="FeatureCollection"?n=Ls(r):n=Ai(on.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function Ls(r){var e=r.features.length===2?on.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):on.union.apply(on,r.features.map(function(t){return t.geometry.coordinates}));return Ai(e)}function Ai(r){return oo(r)}function Os(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return so(t)}function Cs(r,e,t){let n;se(r,Ae,s=>t(1,n=s));let{boundaryGeojson:i}=e;return lo("setCamera")&&n.fitBounds(ir(i),{padding:20,animate:!1}),Qe(n,"boundary",$s(i)),we(n,{id:"boundary",source:"boundary",...En("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class Rs extends V{constructor(e){super(),K(this,e,Cs,null,Y,{boundaryGeojson:0})}}const me={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Cn=10,zt=10;function As(r,e,t){let n;se(r,Ae,u=>t(2,n=u));let{layer:i}=e,{contents:o}=e,s=new tn.Popup({closeButton:!1,closeOnClick:!1});n.on("mousemove",a),n.on("mouseout",l),it(()=>{n.off("mousemove",a),n.off("mouseout",l),s.remove()});function a(u){if(!n.getLayer(i)){s.remove();return}let p=n.queryRenderedFeatures(u.point,{layers:[i]});p.length>0?s.setLngLat(u.lngLat).setHTML(o(p[0].properties)).addTo(n):s.remove()}function l(){s.remove()}return r.$$set=u=>{"layer"in u&&t(0,i=u.layer),"contents"in u&&t(1,o=u.contents)},[i,o]}class Is extends V{constructor(e){super(),K(this,e,As,null,Y,{layer:0,contents:1})}}function Nr(r,e,t){const n=r.slice();return n[3]=e[t],n}function Br(r,e,t){const n=r.slice();return n[6]=e[t],n}function Dr(r){let e;return{c(){e=E("td"),O(e,"class","svelte-11t6rxo"),ue(e,"background-color",r[6])},m(t,n){w(t,e,n)},p(t,n){n&1&&ue(e,"background-color",t[6])},d(t){t&&k(e)}}}function jr(r){let e,t=r[3]+"",n;return{c(){e=E("td"),n=W(t),O(e,"class","svelte-11t6rxo"),ue(e,"width",r[2])},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[3]+"")&&Ce(n,t)},d(i){i&&k(e)}}}function Ts(r){let e,t,n,i,o=r[0],s=[];for(let u=0;u<o.length;u+=1)s[u]=Dr(Br(r,o,u));let a=r[1],l=[];for(let u=0;u<a.length;u+=1)l[u]=jr(Nr(r,a,u));return{c(){e=E("table"),t=E("tr");for(let u=0;u<s.length;u+=1)s[u].c();n=R(),i=E("tr");for(let u=0;u<l.length;u+=1)l[u].c();O(t,"class","svelte-11t6rxo"),O(i,"class","svelte-11t6rxo"),O(e,"class","svelte-11t6rxo")},m(u,p){w(u,e,p),S(e,t);for(let d=0;d<s.length;d+=1)s[d].m(t,null);S(e,n),S(e,i);for(let d=0;d<l.length;d+=1)l[d].m(i,null)},p(u,[p]){if(p&1){o=u[0];let d;for(d=0;d<o.length;d+=1){const c=Br(u,o,d);s[d]?s[d].p(c,p):(s[d]=Dr(c),s[d].c(),s[d].m(t,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=o.length}if(p&6){a=u[1];let d;for(d=0;d<a.length;d+=1){const c=Nr(u,a,d);l[d]?l[d].p(c,p):(l[d]=jr(c),l[d].c(),l[d].m(i,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},i:G,o:G,d(u){u&&k(e),cn(s,u),cn(l,u)}}}function Ps(r,e,t){let{colors:n}=e,{labels:i}=e;if(n.length!=i.length)throw new Error("colors and labels must match");let o=`${100/n.length}%`;return r.$$set=s=>{"colors"in s&&t(0,n=s.colors),"labels"in s&&t(1,i=s.labels)},[n,i,o]}class Fs extends V{constructor(e){super(),K(this,e,Ps,Ts,Y,{colors:0,labels:1})}}const xs="/atip/speed_limit/assets/help-d011708a.svg";function Ns(r){let e,t;return{c(){e=E("img"),pn(e.src,t=xs)||O(e,"src",t),O(e,"title",r[0]),O(e,"alt",r[0])},m(n,i){w(n,e,i)},p(n,[i]){i&1&&O(e,"title",n[0]),i&1&&O(e,"alt",n[0])},i:G,o:G,d(n){n&&k(e)}}}function Bs(r,e,t){let{contents:n}=e;return r.$$set=i=>{"contents"in i&&t(0,n=i.contents)},[n]}class Ds extends V{constructor(e){super(),K(this,e,Bs,Ns,Y,{contents:0})}}function js(r){let e,t,n,i,o,s,a;return t=new Ds({props:{contents:"Data comes from OpenStreetMap, and may not always be correct. Unexpected values are treated as unknown. Freehand route segments and off-road paths generally have no speed data."}}),i=new Fs({props:{colors:r[0],labels:["< 20","20","30","40",">= 50"]}}),s=new Is({props:{layer:"speed-limits",contents:qs}}),{c(){e=W(`(mph)
`),N(t.$$.fragment),n=R(),N(i.$$.fragment),o=R(),N(s.$$.fragment)},m(l,u){w(l,e,u),B(t,l,u),w(l,n,u),B(i,l,u),w(l,o,u),B(s,l,u),a=!0},p:G,i(l){a||($(t.$$.fragment,l),$(i.$$.fragment,l),$(s.$$.fragment,l),a=!0)},o(l){L(t.$$.fragment,l),L(i.$$.fragment,l),L(s.$$.fragment,l),a=!1},d(l){l&&k(e),D(t,l),l&&k(n),D(i,l),l&&k(o),D(s,l)}}}let Us="white",lt="speed-limits",xn="speed-limits",Ct=.8;function qs(r){return r.speed_limit?`${Math.round(r.speed_limit)} mph`:"Unknown"}function Gs(r,e,t){let n,i;se(r,Ae,p=>t(3,n=p)),se(r,ne,p=>t(4,i=p));let{routeInfo:o}=e,{id:s}=e,a=["#00AB4D","#8ECA4D","#F7BB00","#BB0000","#470000"];const l=["case",["<",["get","speed_limit"],20],a[0],["==",["get","speed_limit"],20],a[1],["==",["get","speed_limit"],30],a[2],["==",["get","speed_limit"],40],a[3],[">=",["get","speed_limit"],50],a[4],Us],u=["case",["<",["get","speed_limit"],20],Ct,["==",["get","speed_limit"],20],Ct,["==",["get","speed_limit"],30],Ct,["==",["get","speed_limit"],40],Ct,[">=",["get","speed_limit"],50],Ct,0];return Qe(n,lt,xe()),we(n,{id:xn,source:lt,...yt(l,zt,u)}),Yt(async()=>{try{if(s){let p=i.features.find(c=>c.id==s),d=JSON.parse(await o.speedLimitForRoute(p.properties.waypoints));n.getSource(lt).setData(d)}else{let p=JSON.parse(await o.allSpeedLimits());n.getSource(lt).setData(p)}}catch(p){window.alert(`Couldn't calculate speed limits for route: ${p}`)}}),it(()=>{n.getLayer(xn)&&n.removeLayer(xn),n.getSource(lt)&&n.removeSource(lt)}),r.$$set=p=>{"routeInfo"in p&&t(1,o=p.routeInfo),"id"in p&&t(2,s=p.id)},[a,o,s]}class Ii extends V{constructor(e){super(),K(this,e,Gs,js,Y,{routeInfo:1,id:2})}}function Ur(r){let e,t;return e=new Ii({props:{routeInfo:r[0],id:r[1]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeInfo=n[0]),i&2&&(o.id=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Hs(r){let e,t,n,i,o,s,a,l,u,p,d=r[2]=="speed limits"&&Ur(r);return{c(){e=E("label"),t=W(`Show details:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",s=R(),d&&d.c(),a=be(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,r[2]===void 0&&ot(()=>r[3].call(n))},m(c,f){w(c,e,f),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[2]),w(c,s,f),d&&d.m(c,f),w(c,a,f),l=!0,u||(p=q(n,"change",r[3]),u=!0)},p(c,[f]){f&4&&Ke(n,c[2]),c[2]=="speed limits"?d?(d.p(c,f),f&4&&$(d,1)):(d=Ur(c),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(fe(),L(d,1,1,()=>{d=null}),ce())},i(c){l||($(d),l=!0)},o(c){L(d),l=!1},d(c){c&&k(e),c&&k(s),d&&d.d(c),c&&k(a),u=!1,p()}}}function zs(r,e,t){let{routeInfo:n}=e,{id:i}=e,o="none";function s(){o=Mn(this),t(2,o)}return r.$$set=a=>{"routeInfo"in a&&t(0,n=a.routeInfo),"id"in a&&t(1,i=a.id)},[n,i,o,s]}class Js extends V{constructor(e){super(),K(this,e,zs,Hs,Y,{routeInfo:0,id:1})}}function qr(r){let e,t=Gr(r[5])+"",n,i,o,s,a,l,u,p,d,c;return u=new Js({props:{routeInfo:r[3],id:r[4]}}),{c(){e=W("Length: "),n=W(t),i=R(),o=E("br"),s=E("button"),s.textContent="Auto-fill details",a=E("br"),l=R(),N(u.$$.fragment),O(s,"type","button")},m(f,m){w(f,e,m),w(f,n,m),w(f,i,m),w(f,o,m),w(f,s,m),w(f,a,m),w(f,l,m),B(u,f,m),p=!0,d||(c=q(s,"click",r[14]),d=!0)},p(f,m){(!p||m&32)&&t!==(t=Gr(f[5])+"")&&Ce(n,t);const g={};m&8&&(g.routeInfo=f[3]),m&16&&(g.id=f[4]),u.$set(g)},i(f){p||($(u.$$.fragment,f),p=!0)},o(f){L(u.$$.fragment,f),p=!1},d(f){f&&k(e),f&&k(n),f&&k(i),f&&k(o),f&&k(s),f&&k(a),f&&k(l),D(u,f),d=!1,c()}}}function Ys(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,m,g,_,v,h,b,y,M,C,T,A,x,I,j,Z,F,H,le,Se,Te,ie,re,Ne,Le,Q,he,Vt,_e=r[5]&&qr(r);return{c(){e=E("label"),t=W("Name:"),n=E("br"),i=R(),o=E("input"),s=R(),a=E("br"),l=R(),u=E("br"),p=R(),d=E("label"),c=E("input"),f=W(`
  Area`),m=R(),g=E("label"),_=E("input"),v=W(`
  Route`),h=R(),b=E("label"),y=E("input"),M=W(`
  Crossing`),C=R(),T=E("label"),A=E("input"),x=W(`
  Other`),I=R(),j=E("br"),Z=R(),F=E("br"),H=R(),le=E("label"),Se=W("Description:"),Te=E("br"),ie=R(),re=E("textarea"),Ne=R(),_e&&_e.c(),Le=be(),O(o,"type","text"),ue(o,"width","100%"),O(c,"type","radio"),c.__value="area",c.value=c.__value,r[9][0].push(c),O(_,"type","radio"),_.__value="route",_.value=_.__value,r[9][0].push(_),O(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[9][0].push(y),O(A,"type","radio"),A.__value="other",A.value=A.__value,r[9][0].push(A),ue(re,"width","100%"),O(re,"rows","5"),O(re,"class","svelte-15lna0i")},m(P,te){w(P,e,te),S(e,t),S(e,n),S(e,i),S(e,o),Oe(o,r[0]),w(P,s,te),w(P,a,te),w(P,l,te),w(P,u,te),w(P,p,te),w(P,d,te),S(d,c),c.checked=c.__value===r[1],S(d,f),w(P,m,te),w(P,g,te),S(g,_),_.checked=_.__value===r[1],S(g,v),w(P,h,te),w(P,b,te),S(b,y),y.checked=y.__value===r[1],S(b,M),w(P,C,te),w(P,T,te),S(T,A),A.checked=A.__value===r[1],S(T,x),w(P,I,te),w(P,j,te),w(P,Z,te),w(P,F,te),w(P,H,te),w(P,le,te),S(le,Se),S(le,Te),S(le,ie),S(le,re),Oe(re,r[2]),w(P,Ne,te),_e&&_e.m(P,te),w(P,Le,te),Q=!0,he||(Vt=[q(o,"input",r[7]),q(c,"change",r[8]),q(_,"change",r[10]),q(y,"change",r[11]),q(A,"change",r[12]),q(re,"input",r[13])],he=!0)},p(P,[te]){te&1&&o.value!==P[0]&&Oe(o,P[0]),te&2&&(c.checked=c.__value===P[1]),te&2&&(_.checked=_.__value===P[1]),te&2&&(y.checked=y.__value===P[1]),te&2&&(A.checked=A.__value===P[1]),te&4&&Oe(re,P[2]),P[5]?_e?(_e.p(P,te),te&32&&$(_e,1)):(_e=qr(P),_e.c(),$(_e,1),_e.m(Le.parentNode,Le)):_e&&(fe(),L(_e,1,1,()=>{_e=null}),ce())},i(P){Q||($(_e),Q=!0)},o(P){L(_e),Q=!1},d(P){P&&k(e),P&&k(s),P&&k(a),P&&k(l),P&&k(u),P&&k(p),P&&k(d),r[9][0].splice(r[9][0].indexOf(c),1),P&&k(m),P&&k(g),r[9][0].splice(r[9][0].indexOf(_),1),P&&k(h),P&&k(b),r[9][0].splice(r[9][0].indexOf(y),1),P&&k(C),P&&k(T),r[9][0].splice(r[9][0].indexOf(A),1),P&&k(I),P&&k(j),P&&k(Z),P&&k(F),P&&k(H),P&&k(le),P&&k(Ne),_e&&_e.d(P),P&&k(Le),he=!1,Re(Vt)}}}function Gr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Xs(r,e,t){let n;se(r,ne,b=>t(15,n=b));let{routeInfo:i}=e,{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function p(){let b=n.features.find(y=>y.id==o);try{t(0,s=await i.nameForRoute(b))}catch(y){window.alert(`Couldn't auto-name route: ${y}`)}}const d=[[]];function c(){s=this.value,t(0,s)}function f(){a=this.__value,t(1,a)}function m(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function _(){a=this.__value,t(1,a)}function v(){l=this.value,t(2,l)}const h=()=>p();return r.$$set=b=>{"routeInfo"in b&&t(3,i=b.routeInfo),"id"in b&&t(4,o=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(5,u=b.length_meters)},[s,a,l,i,o,u,p,c,f,d,m,g,_,v,h]}class Ws extends V{constructor(e){super(),K(this,e,Xs,Ys,Y,{routeInfo:3,id:4,name:0,intervention_type:1,description:2,length_meters:5})}}const Vs="Intervention",Ks=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],Zs={name:Vs,oneOf:Ks};function Qs(r){const e=r-1;return e*e*e+1}function St(r,{delay:e=0,duration:t=400,easing:n=Qs}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),p=parseFloat(i.marginBottom),d=parseFloat(i.borderTopWidth),c=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*p}px;border-top-width: ${f*d}px;border-bottom-width: ${f*c}px;`}}function Ti(r){return"members"in r}function Pi(r){return"oneOf"in r}function Fi(r){return typeof r=="string"}function xi(r){return typeof r=="object"&&"value"in r}function el(r){return"type"in r&&r.type=="number"}function Ni(r){return"type"in r&&r.type=="one-liner"}function Bi(r){return"type"in r&&r.type=="textbox"}function Di(r){return"type"in r&&r.type=="checkbox"}function Hr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function zr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Jr(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=W(t),O(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&Ce(n,t)},d(i){i&&k(e)}}}function tl(r){let e,t,n;return{c(){e=E("input"),O(e,"type","checkbox")},m(i,o){w(i,e,o),e.checked=r[0],t||(n=q(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function nl(r){let e,t,n;return{c(){e=E("textarea"),ue(e,"width","100%"),O(e,"rows","5"),O(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),Oe(e,r[0]),t||(n=q(e,"input",r[13]),t=!0)},p(i,o){o&1&&Oe(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function rl(r){let e,t,n;return{c(){e=E("input"),O(e,"type","text"),ue(e,"width","100%")},m(i,o){w(i,e,o),Oe(e,r[0]),t||(n=q(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Oe(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function il(r){let e,t,n;return{c(){e=E("input"),O(e,"type","number")},m(i,o){w(i,e,o),Oe(e,r[0]),t||(n=q(e,"input",r[11]),t=!0)},p(i,o){o&1&&yi(e.value)!==i[0]&&Oe(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function ol(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=Xr(Hr(r,n,s));const o=s=>L(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=be()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Hr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=Xr(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(fe(),l=n.length;l<i.length;l+=1)o(l);ce()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)L(i[a]);t=!1},d(s){cn(i,s),s&&k(e)}}}function sl(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=Wr(zr(r,n,s));const o=s=>L(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=be()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=zr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=Wr(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(fe(),l=n.length;l<i.length;l+=1)o(l);ce()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)L(i[a]);t=!1},d(s){cn(i,s),s&&k(e)}}}function ll(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,p,d,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&Yr(r);return{c(){e=E("label"),t=E("input"),i=R(),s=W(o),a=E("br"),l=R(),f&&f.c(),u=be(),O(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(m,g){w(m,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),w(m,l,g),f&&f.m(m,g),w(m,u,g),p=!0,d||(c=[q(t,"change",r[9]),q(t,"change",r[4])],d=!0)},p(m,g){(!p||g&2&&n!==(n=m[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===m[2]),(!p||g&2)&&o!==(o=m[15].name+"")&&Ce(s,o),m[2]==m[15].name&&typeof m[0]=="object"?f?(f.p(m,g),g&7&&$(f,1)):(f=Yr(m),f.c(),$(f,1),f.m(u.parentNode,u)):f&&(fe(),L(f,1,1,()=>{f=null}),ce())},i(m){p||($(f),p=!0)},o(m){L(f),p=!1},d(m){m&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),m&&k(l),f&&f.d(m),m&&k(u),d=!1,Re(c)}}}function al(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,p;function d(m,g){return m[15].description?cl:fl}let c=d(r),f=c(r);return{c(){e=E("label"),t=E("input"),i=R(),s=W(o),a=R(),f.c(),l=R(),O(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(m,g){w(m,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),f.m(e,null),S(e,l),u||(p=[q(t,"change",r[8]),q(t,"change",r[3])],u=!0)},p(m,g){g&2&&n!==(n=m[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===m[2]),g&2&&o!==(o=m[15].value+"")&&Ce(s,o),c===(c=d(m))&&f?f.p(m,g):(f.d(1),f=c(m),f&&(f.c(),f.m(e,l)))},i:G,o:G,d(m){m&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Re(p)}}}function ul(r){let e,t,n,i,o=r[15]+"",s,a,l,u,p,d;return{c(){e=E("label"),t=E("input"),i=R(),s=W(o),a=R(),l=E("br"),u=R(),O(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){w(c,e,f),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),S(e,l),S(e,u),p||(d=[q(t,"change",r[6]),q(t,"change",r[3])],p=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&o!==(o=c[15]+"")&&Ce(s,o)},i:G,o:G,d(c){c&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,Re(d)}}}function Yr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Wt({props:l}),ae.push(()=>Ee(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),N(t.$$.fragment),i=R(),O(e,"class","svelte-1b72l00")},m(u,p){w(u,e,p),B(t,e,null),S(e,i),s=!0},p(u,p){r=u;const d={};p&2&&(d.spec=r[15]),!n&&p&3&&(n=!0,d.value=r[0][r[15].name],Me(()=>n=!1)),t.$set(d)},i(u){s||($(t.$$.fragment,u),ot(()=>{o||(o=wt(e,St,{duration:500},!0)),o.run(1)}),s=!0)},o(u){L(t.$$.fragment,u),o||(o=wt(e,St,{duration:500},!1)),o.run(0),s=!1},d(u){u&&k(e),D(t),u&&o&&o.end()}}}function fl(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function cl(r){let e,t,n=r[15].description+"",i,o;return{c(){e=E("p"),t=W("("),i=W(n),o=W(")"),O(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,i),S(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&Ce(i,n)},d(s){s&&k(e)}}}function Xr(r){let e,t,n,i,o,s;const a=[ul,al,ll],l=[];function u(p,d){return d&2&&(e=null),d&2&&(t=null),e==null&&(e=!!Fi(p[15])),e?0:(t==null&&(t=!!xi(p[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=be()},m(p,d){l[n].m(p,d),w(p,o,d),s=!0},p(p,d){let c=n;n=u(p,d),n===c?l[n].p(p,d):(fe(),L(l[c],1,1,()=>{l[c]=null}),ce(),i=l[n],i?i.p(p,d):(i=l[n]=a[n](p),i.c()),$(i,1),i.m(o.parentNode,o))},i(p){s||($(i),s=!0)},o(p){L(i),s=!1},d(p){l[n].d(p),p&&k(o)}}}function Wr(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function p(c){r[5](c,r[15])}let d={spec:r[15]};return r[0][r[15].name]!==void 0&&(d.value=r[0][r[15].name]),s=new Wt({props:d}),ae.push(()=>Ee(s,"value",p,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),i=W(n),o=R(),N(s.$$.fragment),l=R(),O(e,"class","svelte-1b72l00")},m(c,f){w(c,e,f),S(e,t),S(t,i),S(e,o),B(s,e,null),S(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&Ce(i,n);const m={};f&2&&(m.spec=r[15]),!a&&f&3&&(a=!0,m.value=r[0][r[15].name],Me(()=>a=!1)),s.$set(m)},i(c){u||($(s.$$.fragment,c),u=!0)},o(c){L(s.$$.fragment,c),u=!1},d(c){c&&k(e),D(s)}}}function pl(r){let e,t,n,i,o,s,a,l,u,p,d,c=r[1].description&&Jr(r);const f=[sl,ol,il,rl,nl,tl],m=[];function g(_,v){return v&2&&(t=null),v&2&&(n=null),v&2&&(i=null),v&2&&(o=null),v&2&&(s=null),v&2&&(a=null),t==null&&(t=!!Ti(_[1])),t?0:(n==null&&(n=!!Pi(_[1])),n?1:(i==null&&(i=!!el(_[1])),i?2:(o==null&&(o=!!Ni(_[1])),o?3:(s==null&&(s=!!Bi(_[1])),s?4:(a==null&&(a=!!Di(_[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=m[l]=f[l](r)),{c(){c&&c.c(),e=R(),u&&u.c(),p=be()},m(_,v){c&&c.m(_,v),w(_,e,v),~l&&m[l].m(_,v),w(_,p,v),d=!0},p(_,[v]){_[1].description?c?c.p(_,v):(c=Jr(_),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let h=l;l=g(_,v),l===h?~l&&m[l].p(_,v):(u&&(fe(),L(m[h],1,1,()=>{m[h]=null}),ce()),~l?(u=m[l],u?u.p(_,v):(u=m[l]=f[l](_),u.c()),$(u,1),u.m(p.parentNode,p)):u=null)},i(_){d||($(u),d=!0)},o(_){L(u),d=!1},d(_){c&&c.d(_),_&&k(e),~l&&m[l].d(_),_&&k(p)}}}function dl(r,e,t){var h,b,y;let{spec:n}=e,{value:i}=e,o="";if(Ti(n)){i||(i={});for(let M of n.members)Ni(M)||Bi(M)?i[h=M.name]||(i[h]=""):Di(M)?i[b=M.name]||(i[b]=!1):i[y=M.name]||(i[y]={})}else Pi(n)&&(i||(i={}),Fi(i)?o=i:xi(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,C){r.$$.not_equal(i[C.name],M)&&(i[C.name]=M,t(0,i))}function p(){o=this.__value,t(2,o)}function d(){o=this.__value,t(2,o)}function c(){o=this.__value,t(2,o)}function f(M,C){r.$$.not_equal(i[C.name],M)&&(i[C.name]=M,t(0,i))}function m(){i=yi(this.value),t(0,i)}function g(){i=this.value,t(0,i)}function _(){i=this.value,t(0,i)}function v(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,p,l,d,c,f,m,g,_,v]}class Wt extends V{constructor(e){super(),K(this,e,dl,pl,Y,{spec:1,value:0})}}function hl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Wt({props:o}),ae.push(()=>Ee(e,"value",i,r[0].v2)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function ml(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=Zs;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class _l extends V{constructor(e){super(),K(this,e,ml,hl,Y,{props:0})}}const gl="Planning",bl=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],vl={name:gl,members:bl};function yl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Wt({props:o}),ae.push(()=>Ee(e,"value",i,r[0].planning)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function wl(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=vl;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class kl extends V{constructor(e){super(),K(this,e,wl,yl,Y,{props:0})}}const Sl="CriticalIssue",El=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],Ml={name:Sl,members:El};function $l(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Wt({props:o}),ae.push(()=>Ee(e,"value",i,r[0].criticals)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Ll(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=Ml;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Ol extends V{constructor(e){super(),K(this,e,Ll,$l,Y,{props:0})}}function Vr(r){let e,t,n,i,o;const s=r[10].default,a=mt(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),ue(e,"border","solid 1px black"),ue(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=q(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&_t(a,s,l,l[9],n?bt(s,l[9],u,null):gt(l[9]),null)},i(l){n||($(a,l),ot(()=>{t||(t=wt(e,St,{duration:100},!0)),t.run(1)}),n=!0)},o(l){L(a,l),t||(t=wt(e,St,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Cl(r){let e,t,n,i,o,s,a,l,u,p,d=r[4]&&Vr(r);return{c(){e=E("button"),t=dn("svg"),n=dn("path"),i=R(),o=W(r[1]),s=R(),d&&d.c(),a=be(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-t7fpgu"),O(e,"aria-expanded",r[4]),O(e,"class","svelte-t7fpgu"),vr(e,"underlined",r[3])},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,i),S(e,o),w(c,s,f),d&&d.m(c,f),w(c,a,f),l=!0,u||(p=[q(e,"click",r[5]),q(e,"mouseenter",r[11]),q(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&Ce(o,c[1]),(!l||f&16)&&O(e,"aria-expanded",c[4]),(!l||f&8)&&vr(e,"underlined",c[3]),c[4]?d?(d.p(c,f),f&16&&$(d,1)):(d=Vr(c),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(fe(),L(d,1,1,()=>{d=null}),ce())},i(c){l||($(d),l=!0)},o(c){L(d),l=!1},d(c){c&&k(e),c&&k(s),d&&d.d(c),c&&k(a),u=!1,Re(p)}}}function Rl(r,e,t){let n,i,o,s;se(r,je,h=>t(7,o=h)),se(r,ke,h=>t(8,s=h));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const d=()=>{ke.update(h=>h==u?null:u),s==u&&(Gt.set(null),Gt.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const m=()=>qt.set(u),g=()=>qt.set(null);function _(h){ae[h?"unshift":"push"](()=>{c=h,t(2,c)})}const v=()=>f();return r.$$set=h=>{"id"in h&&t(0,u=h.id),"label"in h&&t(1,p=h.label),"$$scope"in h&&t(9,l=h.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,p,c,i,n,d,f,o,s,l,a,m,g,_,v]}class Al extends V{constructor(e){super(),K(this,e,Rl,Cl,Y,{id:0,label:1})}}function Kr(r,e,t){const n=r.slice();return n[14]=e[t],n[15]=e,n[16]=t,n}function Il(r){let e,t,n;function i(s){r[10](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new Ol({props:o}),ae.push(()=>Ee(e,"props",i,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Tl(r){let e,t,n;function i(s){r[9](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new kl({props:o}),ae.push(()=>Ee(e,"props",i,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Pl(r){let e,t,n;function i(s){r[8](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new _l({props:o}),ae.push(()=>Ee(e,"props",i,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Fl(r){let e,t,n,i,o;function s(p){r[5](p,r[14])}function a(p){r[6](p,r[14])}function l(p){r[7](p,r[14])}let u={routeInfo:r[1],id:r[14].id,length_meters:r[14].properties.length_meters};return r[14].properties.name!==void 0&&(u.name=r[14].properties.name),r[14].properties.intervention_type!==void 0&&(u.intervention_type=r[14].properties.intervention_type),r[14].properties.description!==void 0&&(u.description=r[14].properties.description),e=new Ws({props:u}),ae.push(()=>Ee(e,"name",s,r[14].properties.name)),ae.push(()=>Ee(e,"intervention_type",a,r[14].properties.intervention_type)),ae.push(()=>Ee(e,"description",l,r[14].properties.description)),{c(){N(e.$$.fragment)},m(p,d){B(e,p,d),o=!0},p(p,d){r=p;const c={};d&2&&(c.routeInfo=r[1]),d&4&&(c.id=r[14].id),d&4&&(c.length_meters=r[14].properties.length_meters),!t&&d&4&&(t=!0,c.name=r[14].properties.name,Me(()=>t=!1)),!n&&d&4&&(n=!0,c.intervention_type=r[14].properties.intervention_type,Me(()=>n=!1)),!i&&d&4&&(i=!0,c.description=r[14].properties.description,Me(()=>i=!1)),e.$set(c)},i(p){o||($(e.$$.fragment,p),o=!0)},o(p){L(e.$$.fragment,p),o=!1},d(p){D(e,p)}}}function xl(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,m,g;const _=[Fl,Pl,Tl,Il],v=[];function h(y,M){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:y[0]=="criticals"?3:-1}~(e=h(r))&&(t=v[e]=_[e](r));function b(){return r[11](r[14])}return{c(){t&&t.c(),n=R(),i=E("br"),o=R(),s=E("br"),a=R(),l=E("div"),u=E("button"),u.textContent="Delete",p=R(),d=E("button"),d.textContent="Save",c=R(),O(u,"type","button"),O(d,"type","button"),ue(l,"display","flex"),ue(l,"justify-content","space-between")},m(y,M){~e&&v[e].m(y,M),w(y,n,M),w(y,i,M),w(y,o,M),w(y,s,M),w(y,a,M),w(y,l,M),S(l,u),S(l,p),S(l,d),w(y,c,M),f=!0,m||(g=[q(u,"click",b),q(d,"click",r[12])],m=!0)},p(y,M){r=y;let C=e;e=h(r),e===C?~e&&v[e].p(r,M):(t&&(fe(),L(v[C],1,1,()=>{v[C]=null}),ce()),~e?(t=v[e],t?t.p(r,M):(t=v[e]=_[e](r),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(y){f||($(t),f=!0)},o(y){L(t),f=!1},d(y){~e&&v[e].d(y),y&&k(n),y&&k(i),y&&k(o),y&&k(s),y&&k(a),y&&k(l),y&&k(c),m=!1,Re(g)}}}function Zr(r,e){let t,n,i;return n=new Al({props:{id:e[14].id,label:e[16]+1+") "+e[3](e[14]),$$slots:{default:[xl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=be(),N(n.$$.fragment),this.first=t},m(o,s){w(o,t,s),B(n,o,s),i=!0},p(o,s){e=o;const a={};s&4&&(a.id=e[14].id),s&4&&(a.label=e[16]+1+") "+e[3](e[14])),s&131079&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){L(n.$$.fragment,o),i=!1},d(o){o&&k(t),D(n,o)}}}function Nl(r){let e=[],t=new Map,n,i,o,s,a=r[2].features;const l=u=>u[14].id;for(let u=0;u<a.length;u+=1){let p=Kr(r,a,u),d=l(p);t.set(d,e[u]=Zr(d,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=be()},m(u,p){for(let d=0;d<e.length;d+=1)e[d].m(u,p);w(u,n,p),i=!0,o||(s=q(window,"keydown",r[4]),o=!0)},p(u,[p]){p&15&&(a=u[2].features,fe(),e=ao(e,p,l,1,u,a,t,n.parentNode,uo,Zr,n,Kr),ce())},i(u){if(!i){for(let p=0;p<a.length;p+=1)$(e[p]);i=!0}},o(u){for(let p=0;p<e.length;p+=1)L(e[p]);i=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&k(n),o=!1,s()}}}function Bl(r,e,t){let n,i;se(r,ke,v=>t(13,n=v)),se(r,ne,v=>t(2,i=v));let{schema:o}=e,{routeInfo:s}=e;function a(v){var b,y,M,C,T;if(o=="planning")return((b=v.properties.planning)==null?void 0:b.name)||"Untitled polygon";if(o=="v2")return((M=(y=v.properties.v2)==null?void 0:y.Route)==null?void 0:M.name)||((T=(C=v.properties.v2)==null?void 0:C.Crossing)==null?void 0:T.name)||"Untitled intervention";if(v.properties.name)return v.properties.name;var h=v.properties.intervention_type;return h=="other"&&(v.geometry.type=="Point"?h="point":v.geometry.type=="LineString"?h="line":h="polygon"),`Untitled ${h}`}function l(v){if(v.key=="Delete"){const h=v.target.tagName;if(h=="INPUT"||h=="TEXTAREA")return;v.preventDefault();const b=n;b&&kr(b)}}function u(v,h){r.$$.not_equal(h.properties.name,v)&&(h.properties.name=v,ne.set(i))}function p(v,h){r.$$.not_equal(h.properties.intervention_type,v)&&(h.properties.intervention_type=v,ne.set(i))}function d(v,h){r.$$.not_equal(h.properties.description,v)&&(h.properties.description=v,ne.set(i))}function c(v,h){r.$$.not_equal(h.properties,v)&&(h.properties=v,ne.set(i))}function f(v,h){r.$$.not_equal(h.properties,v)&&(h.properties=v,ne.set(i))}function m(v,h){r.$$.not_equal(h.properties,v)&&(h.properties=v,ne.set(i))}const g=v=>kr(v.id),_=()=>ke.set(null);return r.$$set=v=>{"schema"in v&&t(0,o=v.schema),"routeInfo"in v&&t(1,s=v.routeInfo)},[o,s,i,a,l,u,p,d,c,f,m,g,_]}class Dl extends V{constructor(e){super(),K(this,e,Bl,Nl,Y,{schema:0,routeInfo:1})}}function Qr(r){let e,t;return e=new Ii({props:{routeInfo:r[0],id:void 0}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeInfo=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function jl(r){let e,t,n,i,o,s,a,l,u,p,d,c=r[2]=="speed limits"&&Qr(r);return{c(){e=E("label"),t=W(`Show layer:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",a=R(),c&&c.c(),l=be(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,n.disabled=s=r[1]!=null,r[2]===void 0&&ot(()=>r[3].call(n))},m(f,m){w(f,e,m),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[2]),w(f,a,m),c&&c.m(f,m),w(f,l,m),u=!0,p||(d=q(n,"change",r[3]),p=!0)},p(f,[m]){(!u||m&2&&s!==(s=f[1]!=null))&&(n.disabled=s),m&4&&Ke(n,f[2]),f[2]=="speed limits"?c?(c.p(f,m),m&4&&$(c,1)):(c=Qr(f),c.c(),$(c,1),c.m(l.parentNode,l)):c&&(fe(),L(c,1,1,()=>{c=null}),ce())},i(f){u||($(c),u=!0)},o(f){L(c),u=!1},d(f){f&&k(e),f&&k(a),c&&c.d(f),f&&k(l),p=!1,d()}}}function Ul(r,e,t){let n;se(r,ke,a=>t(1,n=a));let{routeInfo:i}=e,o="none";function s(){o=Mn(this),t(2,o),t(1,n)}return r.$$set=a=>{"routeInfo"in a&&t(0,i=a.routeInfo)},r.$$.update=()=>{r.$$.dirty&2&&n&&t(2,o="none")},[i,n,o,s]}class ql extends V{constructor(e){super(),K(this,e,Ul,jl,Y,{routeInfo:0})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ue(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Kn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Je(r,e,t){t===void 0&&(t={});var n=Ve(r),i=Ve(e),o=Pe(i[1]-n[1]),s=Pe(i[0]-n[0]),a=Pe(n[1]),l=Pe(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return fo(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function sn(r,e){return e===void 0&&(e={}),co(r,function(t,n){var i=n.geometry.coordinates;return t+Je(i[0],i[1],e)},0)}function Gl(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,m,g,_,v,h,b,y=r[0].features.length+"",M,C,T,A,x,I,j,Z;return{c(){e=E("div"),t=E("label"),n=W(`Scheme name:
    `),i=E("input"),o=R(),s=E("br"),a=R(),l=E("div"),u=E("label"),p=E("input"),d=R(),c=E("button"),c.textContent="Load from GeoJSON",f=R(),m=E("button"),m.textContent="Export to GeoJSON",g=R(),_=E("br"),v=R(),h=E("div"),b=E("span"),M=W(y),C=W(" objects"),T=R(),A=E("button"),x=W("Clear all"),O(i,"type","text"),O(p,"type","file"),O(p,"id","load_geojson"),O(p,"class","svelte-lhyd1e"),O(c,"type","button"),O(m,"type","button"),O(m,"class","align-right svelte-lhyd1e"),O(A,"type","button"),O(A,"class","align-right svelte-lhyd1e"),A.disabled=I=r[0].features.length==0},m(F,H){w(F,e,H),S(e,t),S(t,n),S(t,i),Oe(i,r[0].scheme_name),w(F,o,H),w(F,s,H),w(F,a,H),w(F,l,H),S(l,u),S(u,p),S(u,d),S(u,c),S(l,f),S(l,m),w(F,g,H),w(F,_,H),w(F,v,H),w(F,h,H),S(h,b),S(b,M),S(b,C),S(h,T),S(h,A),S(A,x),j||(Z=[q(i,"input",r[8]),q(p,"change",r[3]),q(c,"click",zl),q(m,"click",r[2]),q(A,"click",r[1])],j=!0)},p(F,[H]){H&1&&i.value!==F[0].scheme_name&&Oe(i,F[0].scheme_name),H&1&&y!==(y=F[0].features.length+"")&&Ce(M,y),H&1&&I!==(I=F[0].features.length==0)&&(A.disabled=I)},i:G,o:G,d(F){F&&k(e),F&&k(o),F&&k(s),F&&k(a),F&&k(l),F&&k(g),F&&k(_),F&&k(v),F&&k(h),j=!1,Re(Z)}}}function Hl(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function zl(){document.getElementById("load_geojson").click()}function Jl(r,e,t){let n;se(r,ne,m=>t(0,n=m));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=!1;Yt(async()=>{let g=new URLSearchParams(window.location.search).get("geojsonUrl"),_=window.localStorage.getItem(s);if(g){console.log(`Loading GeoJSON from ${g}`);try{let h=await(await fetch(g)).text();ne.set(c(JSON.parse(h)))}catch(v){console.log(`Failed to load from URL: ${v}`)}}else if(_)try{ne.set(c(JSON.parse(_)))}catch(v){console.log(`Failed to load from local storage: ${v}`)}t(7,a=!0)});function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(ne.update(m=>(delete m.scheme_name,m.features=[],m)),ke.set(null),je.set(null),qt.set(null),Gt.set(null))}function u(){const m=JSON.parse(JSON.stringify(n));for(let g of m.features)delete g.properties.hide_while_editing;return m}function p(){let m=u();var g=s;m.authority=i,m.origin="atip-v1",m.scheme_name&&(g+="_"+m.scheme_name),g+=".txt",Hl(g,JSON.stringify(m,null,"  "))}function d(m){const g=new FileReader;g.onload=v=>{try{ne.set(c(JSON.parse(v.target.result)))}catch(h){window.alert(`Couldn't load scheme from a file: ${h}`)}};let _=m.target.files;g.readAsText(_[0])}function c(m){let g=1;for(let _ of m.features)_.properties||(_.properties={name:"",description:"",intervention_type:"other"}),_.geometry.type=="LineString"&&!_.properties.length_meters&&(_.properties.length_meters=sn(_,{units:"kilometers"})*1e3),_.id=g++;return m}function f(){n.scheme_name=this.value,ne.set(n)}return r.$$set=m=>{"authorityName"in m&&t(4,i=m.authorityName),"schema"in m&&t(5,o=m.schema)},r.$$.update=()=>{r.$$.dirty&193&&a&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,p,d,i,o,s,a,f]}class Yl extends V{constructor(e){super(),K(this,e,Jl,Gl,Y,{authorityName:4,schema:5})}}const Xl="/atip/speed_limit/assets/zoom_out_map-b2e1091a.svg";function Wl(r){let e,t,n,i,o;return{c(){e=E("button"),t=E("img"),pn(t.src,n=Xl)||O(t,"src",n),O(t,"alt","Zoom to show entire boundary"),O(e,"type","button"),O(e,"title","Zoom to show entire boundary"),O(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),i||(o=q(e,"click",r[0]),i=!0)},p:G,i:G,o:G,d(s){s&&k(e),i=!1,o()}}}function Vl(r,e,t){let n;se(r,Ae,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(ir(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class Kl extends V{constructor(e){super(),K(this,e,Vl,Wl,Y,{boundaryGeojson:1})}}function Zl(r){let e,t,n,i,o,s,a;return{c(){e=E("div"),t=W(`Basemap:
  `),n=E("select"),i=E("option"),i.textContent="Streets",o=E("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&ot(()=>r[2].call(n)),O(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[0]),s||(a=[q(n,"change",r[2]),q(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&Ke(n,l[0])},i:G,o:G,d(l){l&&k(e),s=!1,Re(a)}}}function Ql(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=Mn(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class ea extends V{constructor(e){super(),K(this,e,Ql,Zl,Y,{style:0})}}function ei(r){let e,t,n;const i=r[3].default,o=mt(i,r,r[2],null);return{c(){e=E("div"),o&&o.c()},m(s,a){w(s,e,a),o&&o.m(e,null),n=!0},p(s,a){o&&o.p&&(!n||a&4)&&_t(o,i,s,s[2],n?bt(i,s[2],a,null):gt(s[2]),null)},i(s){n||($(o,s),ot(()=>{t||(t=wt(e,St,{duration:100},!0)),t.run(1)}),n=!0)},o(s){L(o,s),t||(t=wt(e,St,{duration:100},!1)),t.run(0),n=!1},d(s){s&&k(e),o&&o.d(s),s&&t&&t.end()}}}function ta(r){let e,t,n,i,o,s,a,l,u,p,d=r[0]&&ei(r);return{c(){e=E("button"),t=dn("svg"),n=dn("path"),i=R(),o=W(r[1]),s=R(),d&&d.c(),a=be(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-una9lq"),O(e,"aria-expanded",r[0]),O(e,"class","svelte-una9lq")},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,i),S(e,o),w(c,s,f),d&&d.m(c,f),w(c,a,f),l=!0,u||(p=q(e,"click",r[4]),u=!0)},p(c,[f]){(!l||f&2)&&Ce(o,c[1]),(!l||f&1)&&O(e,"aria-expanded",c[0]),c[0]?d?(d.p(c,f),f&1&&$(d,1)):(d=ei(c),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(fe(),L(d,1,1,()=>{d=null}),ce())},i(c){l||($(d),l=!0)},o(c){L(d),l=!1},d(c){c&&k(e),c&&k(s),d&&d.d(c),c&&k(a),u=!1,p()}}}function na(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,o=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,i=l.$$scope)},[s,o,i,n,a]}class Rn extends V{constructor(e){super(),K(this,e,na,ta,Y,{label:1,open:0})}}function ra(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,m,g;return{c(){e=E("li"),t=E("span"),n=W("Areas"),i=R(),o=E("li"),s=E("span"),a=W("Routes"),l=R(),u=E("li"),p=E("span"),d=W("Crossings"),c=R(),f=E("li"),m=E("span"),g=W("Other"),O(t,"class","svelte-l42ea0"),ue(t,"background",me.area),O(s,"class","svelte-l42ea0"),ue(s,"background",me.route),O(p,"class","svelte-l42ea0"),ue(p,"background",me.crossing),O(m,"class","svelte-l42ea0"),ue(m,"background",me.other)},m(_,v){w(_,e,v),S(e,t),S(e,n),w(_,i,v),w(_,o,v),S(o,s),S(o,a),w(_,l,v),w(_,u,v),S(u,p),S(u,d),w(_,c,v),w(_,f,v),S(f,m),S(f,g)},p:G,d(_){_&&k(e),_&&k(i),_&&k(o),_&&k(l),_&&k(u),_&&k(c),_&&k(f)}}}function ia(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,m,g;return{c(){e=E("li"),t=E("span"),n=W("Preapp"),i=R(),o=E("li"),s=E("span"),a=W("Outline"),l=R(),u=E("li"),p=E("span"),d=W("Reserved matters"),c=R(),f=E("li"),m=E("span"),g=W("Local plan"),O(t,"class","svelte-l42ea0"),ue(t,"background",me.preapp),O(s,"class","svelte-l42ea0"),ue(s,"background",me.outline),O(p,"class","svelte-l42ea0"),ue(p,"background",me["reserved matters"]),O(m,"class","svelte-l42ea0"),ue(m,"background",me["local plan"])},m(_,v){w(_,e,v),S(e,t),S(e,n),w(_,i,v),w(_,o,v),S(o,s),S(o,a),w(_,l,v),w(_,u,v),S(u,p),S(u,d),w(_,c,v),w(_,f,v),S(f,m),S(f,g)},p:G,d(_){_&&k(e),_&&k(i),_&&k(o),_&&k(l),_&&k(u),_&&k(c),_&&k(f)}}}function oa(r){let e;function t(o,s){return o[0]=="planning"?ia:ra}let n=t(r),i=n(r);return{c(){e=E("ul"),i.c()},m(o,s){w(o,e,s),i.m(e,null)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&k(e),i.d()}}}function sa(r){let e,t,n;return t=new Rn({props:{label:"Objects",open:!0,$$slots:{default:[oa]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),O(e,"class","svelte-l42ea0")},m(i,o){w(i,e,o),B(t,e,null),n=!0},p(i,[o]){const s={};o&3&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){L(t.$$.fragment,i),n=!1},d(i){i&&k(e),D(t)}}}function la(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class aa extends V{constructor(e){super(),K(this,e,la,sa,Y,{schema:0})}}let at="interventions";function ua(r,e,t){let n,i;se(r,Ae,p=>t(1,n=p)),se(r,ne,p=>t(2,i=p));let{schema:o}=e;Qe(n,at,i);const s=["match",["get","intervention_type"],"area",me.area,"route",me.route,"crossing",me.crossing,"other",me.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",me.preapp,"outline",me.outline,"reserved matters",me["reserved matters"],"local plan",me["local plan"],"white"],l=["!=","hide_while_editing",!0];return we(n,{id:"interventions-points",source:at,filter:["all",$n,l,["!=","endpoint",!0]],...Mt(s,Cn)}),we(n,{id:"interventions-lines",source:at,filter:["all",Ln,l],...yt(s,zt)}),we(n,{id:"interventions-lines-endpoints",source:at,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*zt,"circle-opacity":0,"circle-stroke-color":me.lineEndpointColor,"circle-stroke-width":2}}),we(n,{id:"interventions-polygons",source:at,filter:["all",On,l],...En(o=="planning"?a:s,.5)}),r.$$set=p=>{"schema"in p&&t(0,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(i)),d=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])d.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(d),n.getSource(at).setData(p)}},[o,n,i]}class fa extends V{constructor(e){super(),K(this,e,ua,null,Y,{schema:0})}}let ut="hover";function ca(r,e,t){let n,i,o,s,a;return se(r,Ae,l=>t(0,n=l)),se(r,ne,l=>t(1,i=l)),se(r,qt,l=>t(2,o=l)),se(r,je,l=>t(3,s=l)),se(r,ke,l=>t(4,a=l)),Qe(n,ut,xe()),we(n,{id:"hover-polygons",source:ut,filter:On,...yt(me.hovering,.5*zt,1)}),we(n,{id:"hover-lines",source:ut,filter:Ln,...yt(me.hovering,1.5*zt,1)}),we(n,{id:"hover-points",source:ut,filter:$n,...Mt(me.hovering,1.5*Cn,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(ut).setData(i.features.find(u=>u.id==l)):n.getSource(ut).setData(xe())}},[n,i,o,s,a]}class pa extends V{constructor(e){super(),K(this,e,ca,null,Y,{})}}class ur{constructor(e,t){oe(this,"owner");oe(this,"map");oe(this,"mapHandlers",{});oe(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Qt="edit-point-mode";class da{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"cursor");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new ur(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Qe(e,Qt,xe()),we(e,{id:"edit-point-mode",source:Qt,...Mt(me.hovering,Cn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=ha(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Qt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=xe();this.cursor&&e.features.push(this.cursor),this.map.getSource(Qt).setData(e)}}function ha(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function ji(r,e,t){if(t===void 0&&(t={}),t.final===!0)return ma(r,e);var n=Ve(r),i=Ve(e),o=Pe(n[0]),s=Pe(i[0]),a=Pe(n[1]),l=Pe(i[1]),u=Math.sin(s-o)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return Un(Math.atan2(u,p))}function ma(r,e){var t=ji(e,r);return t=(t+180)%360,t}function ti(r,e,t,n){n===void 0&&(n={});var i=Ve(r),o=Pe(i[0]),s=Pe(i[1]),a=Pe(t),l=po(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),d=Un(p),c=Un(u);return vt([d,c],n.properties)}function Zn(r){if(!r)throw new Error("geojson is required");var e=[];return or(r,function(t){_a(t,e)}),We(e)}function _a(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ue(n);break;case"LineString":t=[Ue(n)]}t.forEach(function(i){var o=ga(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function ga(r,e){var t=[];return r.reduce(function(n,i){var o=kt([n,i],e);return o.bbox=ba(n,i),t.push(o),i}),t}function ba(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var Et={},va={get exports(){return Et},set exports(r){Et=r}},Qn={},ya={get exports(){return Qn},set exports(r){Qn=r}};(function(r,e){(function(t,n){r.exports=n()})(ho,function(){function t(h,b,y,M,C){(function T(A,x,I,j,Z){for(;j>I;){if(j-I>600){var F=j-I+1,H=x-I+1,le=Math.log(F),Se=.5*Math.exp(2*le/3),Te=.5*Math.sqrt(le*Se*(F-Se)/F)*(H-F/2<0?-1:1),ie=Math.max(I,Math.floor(x-H*Se/F+Te)),re=Math.min(j,Math.floor(x+(F-H)*Se/F+Te));T(A,x,ie,re,Z)}var Ne=A[x],Le=I,Q=j;for(n(A,I,x),Z(A[j],Ne)>0&&n(A,I,j);Le<Q;){for(n(A,Le,Q),Le++,Q--;Z(A[Le],Ne)<0;)Le++;for(;Z(A[Q],Ne)>0;)Q--}Z(A[I],Ne)===0?n(A,I,Q):n(A,++Q,j),Q<=x&&(I=Q+1),x<=Q&&(j=Q-1)}})(h,b,y||0,M||h.length-1,C||i)}function n(h,b,y){var M=h[b];h[b]=h[y],h[y]=M}function i(h,b){return h<b?-1:h>b?1:0}var o=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(h,b,y){if(!y)return b.indexOf(h);for(var M=0;M<b.length;M++)if(y(h,b[M]))return M;return-1}function a(h,b){l(h,0,h.children.length,b,h)}function l(h,b,y,M,C){C||(C=_(null)),C.minX=1/0,C.minY=1/0,C.maxX=-1/0,C.maxY=-1/0;for(var T=b;T<y;T++){var A=h.children[T];u(C,h.leaf?M(A):A)}return C}function u(h,b){return h.minX=Math.min(h.minX,b.minX),h.minY=Math.min(h.minY,b.minY),h.maxX=Math.max(h.maxX,b.maxX),h.maxY=Math.max(h.maxY,b.maxY),h}function p(h,b){return h.minX-b.minX}function d(h,b){return h.minY-b.minY}function c(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function f(h){return h.maxX-h.minX+(h.maxY-h.minY)}function m(h,b){return h.minX<=b.minX&&h.minY<=b.minY&&b.maxX<=h.maxX&&b.maxY<=h.maxY}function g(h,b){return b.minX<=h.maxX&&b.minY<=h.maxY&&b.maxX>=h.minX&&b.maxY>=h.minY}function _(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(h,b,y,M,C){for(var T=[b,y];T.length;)if(!((y=T.pop())-(b=T.pop())<=M)){var A=b+Math.ceil((y-b)/M/2)*M;t(h,A,b,y,C),T.push(b,A,A,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(h){var b=this.data,y=[];if(!g(h,b))return y;for(var M=this.toBBox,C=[];b;){for(var T=0;T<b.children.length;T++){var A=b.children[T],x=b.leaf?M(A):A;g(h,x)&&(b.leaf?y.push(A):m(h,x)?this._all(A,y):C.push(A))}b=C.pop()}return y},o.prototype.collides=function(h){var b=this.data;if(!g(h,b))return!1;for(var y=[];b;){for(var M=0;M<b.children.length;M++){var C=b.children[M],T=b.leaf?this.toBBox(C):C;if(g(h,T)){if(b.leaf||m(h,T))return!0;y.push(C)}}b=y.pop()}return!1},o.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var b=0;b<h.length;b++)this.insert(h[b]);return this}var y=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(h,b){if(!h)return this;for(var y,M,C,T=this.data,A=this.toBBox(h),x=[],I=[];T||x.length;){if(T||(T=x.pop(),M=x[x.length-1],y=I.pop(),C=!0),T.leaf){var j=s(h,T.children,b);if(j!==-1)return T.children.splice(j,1),x.push(T),this._condense(x),this}C||T.leaf||!m(T,A)?M?(y++,T=M.children[y],C=!1):T=null:(x.push(T),I.push(y),y=0,M=T,T=T.children[0])}return this},o.prototype.toBBox=function(h){return h},o.prototype.compareMinX=function(h,b){return h.minX-b.minX},o.prototype.compareMinY=function(h,b){return h.minY-b.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(h){return this.data=h,this},o.prototype._all=function(h,b){for(var y=[];h;)h.leaf?b.push.apply(b,h.children):y.push.apply(y,h.children),h=y.pop();return b},o.prototype._build=function(h,b,y,M){var C,T=y-b+1,A=this._maxEntries;if(T<=A)return a(C=_(h.slice(b,y+1)),this.toBBox),C;M||(M=Math.ceil(Math.log(T)/Math.log(A)),A=Math.ceil(T/Math.pow(A,M-1))),(C=_([])).leaf=!1,C.height=M;var x=Math.ceil(T/A),I=x*Math.ceil(Math.sqrt(A));v(h,b,y,I,this.compareMinX);for(var j=b;j<=y;j+=I){var Z=Math.min(j+I-1,y);v(h,j,Z,x,this.compareMinY);for(var F=j;F<=Z;F+=x){var H=Math.min(F+x-1,Z);C.children.push(this._build(h,F,H,M-1))}}return a(C,this.toBBox),C},o.prototype._chooseSubtree=function(h,b,y,M){for(;M.push(b),!b.leaf&&M.length-1!==y;){for(var C=1/0,T=1/0,A=void 0,x=0;x<b.children.length;x++){var I=b.children[x],j=c(I),Z=(F=h,H=I,(Math.max(H.maxX,F.maxX)-Math.min(H.minX,F.minX))*(Math.max(H.maxY,F.maxY)-Math.min(H.minY,F.minY))-j);Z<T?(T=Z,C=j<C?j:C,A=I):Z===T&&j<C&&(C=j,A=I)}b=A||b.children[0]}var F,H;return b},o.prototype._insert=function(h,b,y){var M=y?h:this.toBBox(h),C=[],T=this._chooseSubtree(M,this.data,b,C);for(T.children.push(h),u(T,M);b>=0&&C[b].children.length>this._maxEntries;)this._split(C,b),b--;this._adjustParentBBoxes(M,C,b)},o.prototype._split=function(h,b){var y=h[b],M=y.children.length,C=this._minEntries;this._chooseSplitAxis(y,C,M);var T=this._chooseSplitIndex(y,C,M),A=_(y.children.splice(T,y.children.length-T));A.height=y.height,A.leaf=y.leaf,a(y,this.toBBox),a(A,this.toBBox),b?h[b-1].children.push(A):this._splitRoot(y,A)},o.prototype._splitRoot=function(h,b){this.data=_([h,b]),this.data.height=h.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(h,b,y){for(var M,C,T,A,x,I,j,Z=1/0,F=1/0,H=b;H<=y-b;H++){var le=l(h,0,H,this.toBBox),Se=l(h,H,y,this.toBBox),Te=(C=le,T=Se,A=void 0,x=void 0,I=void 0,j=void 0,A=Math.max(C.minX,T.minX),x=Math.max(C.minY,T.minY),I=Math.min(C.maxX,T.maxX),j=Math.min(C.maxY,T.maxY),Math.max(0,I-A)*Math.max(0,j-x)),ie=c(le)+c(Se);Te<Z?(Z=Te,M=H,F=ie<F?ie:F):Te===Z&&ie<F&&(F=ie,M=H)}return M||y-b},o.prototype._chooseSplitAxis=function(h,b,y){var M=h.leaf?this.compareMinX:p,C=h.leaf?this.compareMinY:d;this._allDistMargin(h,b,y,M)<this._allDistMargin(h,b,y,C)&&h.children.sort(M)},o.prototype._allDistMargin=function(h,b,y,M){h.children.sort(M);for(var C=this.toBBox,T=l(h,0,b,C),A=l(h,y-b,y,C),x=f(T)+f(A),I=b;I<y-b;I++){var j=h.children[I];u(T,h.leaf?C(j):j),x+=f(T)}for(var Z=y-b-1;Z>=b;Z--){var F=h.children[Z];u(A,h.leaf?C(F):F),x+=f(A)}return x},o.prototype._adjustParentBBoxes=function(h,b,y){for(var M=y;M>=0;M--)u(b[M],h)},o.prototype._condense=function(h){for(var b=h.length-1,y=void 0;b>=0;b--)h[b].children.length===0?b>0?(y=h[b-1].children).splice(y.indexOf(h[b]),1):this.clear():a(h[b],this.toBBox)},o})})(ya);const wa=sr(mo),ka=sr(_o),Sa=sr(go);var Be=Qn,Ui=wa,qi=ka,ft=Sa.default,Ea=qi.featureEach;qi.coordEach;Ui.polygon;var ni=Ui.featureCollection;function Gi(r){var e=new Be(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ft(t),Be.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ft(i),n.push(i)}):Ea(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ft(i),n.push(i)}),Be.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ft(t),Be.prototype.remove.call(this,t,n)},e.clear=function(){return Be.prototype.clear.call(this)},e.search=function(t){var n=Be.prototype.search.call(this,this.toBBox(t));return ni(n)},e.collides=function(t){return Be.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Be.prototype.all.call(this);return ni(t)},e.toJSON=function(){return Be.prototype.toJSON.call(this)},e.fromJSON=function(t){return Be.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ft(t);else if(t.type==="FeatureCollection")n=ft(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}va.exports=Gi;Et.default=Gi;function Hi(r,e){var t={},n=[];if(r.type==="LineString"&&(r=yr(r)),e.type==="LineString"&&(e=yr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=ri(r,e);return i&&n.push(i),We(n)}var o=Et();return o.load(Zn(e)),hn(Zn(r),function(s){hn(o.search(s),function(a){var l=ri(s,a);if(l){var u=Ue(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function ri(r,e){var t=Ue(r),n=Ue(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],d=n[1][1],c=(d-u)*(s-i)-(p-l)*(a-o),f=(p-l)*(o-u)-(d-u)*(i-l),m=(s-i)*(o-u)-(a-o)*(i-l);if(c===0)return f===0&&m===0,null;var g=f/c,_=m/c;if(g>=0&&g<=1&&_>=0&&_<=1){var v=i+g*(s-i),h=o+g*(a-o);return vt([v,h])}return null}function Jt(r,e,t){t===void 0&&(t={});var n=vt([1/0,1/0],{dist:1/0}),i=0;return or(r,function(o){for(var s=Ue(o),a=0;a<s.length-1;a++){var l=vt(s[a]);l.properties.dist=Je(e,l,t);var u=vt(s[a+1]);u.properties.dist=Je(e,u,t);var p=Je(l,u,t),d=Math.max(l.properties.dist,u.properties.dist),c=ji(l,u),f=ti(e,d,c+90,t),m=ti(e,d,c-90,t),g=Hi(kt([f.geometry.coordinates,m.geometry.coordinates]),kt([l.geometry.coordinates,u.geometry.coordinates])),_=null;g.features.length>0&&(_=g.features[0],_.properties.dist=Je(e,_,t),_.properties.location=i+Je(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+p),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a),i+=p}}),n}const ct="edit-polygon-mode";class Ma{constructor(e){oe(this,"map");oe(this,"active");oe(this,"eventListenersSuccess");oe(this,"eventListenersFailure");oe(this,"points");oe(this,"cursor");oe(this,"hover");oe(this,"dragFrom");oe(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new ur(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Qe(e,ct,xe()),we(e,{id:"edit-polygon-fill",source:ct,filter:On,...En("red",["case",["boolean",["get","hover"],"false"],1,.5])}),we(e,{id:"edit-polygon-lines",source:ct,filter:Ln,...yt("black",8,.5)}),we(e,{id:"edit-polygon-vertices",source:ct,filter:$n,...Mt(me.hovering,Cn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(oi(this.points).forEach((n,i)=>{t.push([i+1,Jt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(ct),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=xe();this.points.forEach((n,i)=>{let o=ii(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(oi(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(ct).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=ii(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function ii(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function oi(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let X;const He=new Array(32).fill(void 0);He.push(void 0,null,!0,!1);function J(r){return He[r]}let Dt=He.length;function $a(r){r<36||(He[r]=Dt,Dt=r)}function er(r){const e=J(r);return $a(r),e}const zi=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});zi.decode();let ln=new Uint8Array;function jt(){return ln.byteLength===0&&(ln=new Uint8Array(X.memory.buffer)),ln}function dt(r,e){return zi.decode(jt().subarray(r,r+e))}function ve(r){Dt===He.length&&He.push(He.length+1);const e=Dt;return Dt=He[e],He[e]=r,e}function Nn(r){return r==null}let an=new Float64Array;function La(){return an.byteLength===0&&(an=new Float64Array(X.memory.buffer)),an}let un=new Int32Array;function ye(){return un.byteLength===0&&(un=new Int32Array(X.memory.buffer)),un}let Xe=0;const fn=new TextEncoder("utf-8"),Oa=typeof fn.encodeInto=="function"?function(r,e){return fn.encodeInto(r,e)}:function(r,e){const t=fn.encode(r);return e.set(t),{read:r.length,written:t.length}};function en(r,e,t){if(t===void 0){const a=fn.encode(r),l=e(a.length);return jt().subarray(l,l+a.length).set(a),Xe=a.length,l}let n=r.length,i=e(n);const o=jt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=jt().subarray(i+s,i+n),l=Oa(r,a);s+=l.written}return Xe=s,i}function tr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=tr(r[0]));for(let s=1;s<i;s++)o+=", "+tr(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ca(r,e){const t=e(r.length*1);return jt().set(r,t/1),Xe=r.length,t}function Bn(r,e){try{return r.apply(this,e)}catch(t){X.__wbindgen_exn_store(ve(t))}}class yn{static __wrap(e){const t=Object.create(yn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();X.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=X.__wbindgen_add_to_stack_pointer(-16),s=Ca(e,X.__wbindgen_malloc),a=Xe;X.jsroutesnapper_new(o,s,a);var t=ye()[o/4+0],n=ye()[o/4+1],i=ye()[o/4+2];if(i)throw er(n);return yn.__wrap(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){X.jsroutesnapper_setConfig(this.ptr,ve(e))}toFinalFeature(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];let i;return e!==0&&(i=dt(e,t).slice(),X.__wbindgen_free(e,t*1)),i}finally{X.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_renderGeojson(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];return dt(e,t)}finally{X.__wbindgen_add_to_stack_pointer(16),X.__wbindgen_free(e,t)}}setSnapMode(e){X.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return X.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){X.jsroutesnapper_onClick(this.ptr)}onDragStart(){return X.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return X.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){X.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_editExisting(i,this.ptr,ve(e));var t=ye()[i/4+0],n=ye()[i/4+1];if(n)throw er(t)}finally{X.__wbindgen_add_to_stack_pointer(16)}}}async function Ra(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Aa(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){er(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(dt(e,t));return ve(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=dt(e,t);return ve(n)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;La()[e/8+1]=Nn(i)?0:i,ye()[e/4+0]=!Nn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=Nn(i)?0:en(i,X.__wbindgen_malloc,X.__wbindgen_realloc),s=Xe;ye()[e/4+1]=s,ye()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(J(t)),i=en(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=Xe;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return ve(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=J(e)[J(t)];return ve(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(J(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(J(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(J(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(J(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(J(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=J(e)[t>>>0];return ve(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=J(e).next;return ve(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Bn(function(e){const t=J(e).next();return ve(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return J(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=J(e).value;return ve(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ve(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Bn(function(e,t){const n=Reflect.get(J(e),J(t));return ve(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Bn(function(e,t){const n=J(e).call(J(t));return ve(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=J(e).buffer;return ve(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(J(e));return ve(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ve(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=en(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=Xe;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(dt(e,t))}finally{X.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=tr(J(t)),i=en(n,X.__wbindgen_malloc,X.__wbindgen_realloc),o=Xe;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(dt(e,t))},r.wbg.__wbindgen_memory=function(){const e=X.memory;return ve(e)},r}function Ia(r,e){return X=r.exports,Ji.__wbindgen_wasm_module=e,an=new Float64Array,un=new Int32Array,ln=new Uint8Array,X}async function Ji(r){typeof r>"u"&&(r="/atip/speed_limit/assets/route_snapper_bg.wasm");const e=Aa();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Ra(await r,e);return Ia(t,n)}const Rt="route-snapper",si=10,Ta=30;class Pa{constructor(e,t){oe(this,"map");oe(this,"inner");oe(this,"active");oe(this,"eventListenersSuccessRoute");oe(this,"eventListenersSuccessArea");oe(this,"eventListenersFailure");oe(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new yn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Qe(e,Rt,xe()),we(e,{id:"route-points",source:Rt,filter:$n,...Mt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",si/2,si])}),we(e,{id:"route-lines",source:Rt,filter:Ln,...yt("black",2.5)}),we(e,{id:"route-polygons",source:Rt,filter:On,...En("black",.5)}),this.events=new ur(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Ta,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Rt).setData(JSON.parse(this.inner.renderGeojson()))}}function Fa(r){let e,t,n,i,o,s,a,l;return{c(){e=E("button"),t=E("img"),i=R(),o=W(r[2]),pn(t.src,n=r[3])||O(t,"src",n),O(t,"alt",r[2]),O(t,"class","svelte-1vvpkg9"),O(e,"type","button"),e.disabled=s=r[0]==r[1],O(e,"class","svelte-1vvpkg9")},m(u,p){w(u,e,p),S(e,t),S(e,i),S(e,o),a||(l=q(e,"click",r[5]),a=!0)},p(u,[p]){p&8&&!pn(t.src,n=u[3])&&O(t,"src",n),p&4&&O(t,"alt",u[2]),p&4&&Ce(o,u[2]),p&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:G,o:G,d(u){u&&k(e),a=!1,l()}}}function xa(r,e,t){let{mode:n}=e,{thisMode:i}=e,{label:o}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(i);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,i=u.thisMode),"label"in u&&t(2,o=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,i,o,s,a,l]}class nt extends V{constructor(e){super(),K(this,e,xa,Fa,Y,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function li(r){let e;function t(o,s){return o[1]?Ba:Na}let n=t(r),i=n(r);return{c(){i.c(),e=be()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&k(e)}}}function Na(r){let e;return{c(){e=E("p"),e.textContent="Click an object to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ba(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another object"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Da(r){let e,t=r[0]==ht&&li(r);return{c(){t&&t.c(),e=be()},m(n,i){t&&t.m(n,i),w(n,e,i)},p(n,[i]){n[0]==ht?t?t.p(n,i):(t=li(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&k(e)}}}const ht="edit-attribute";function Yi(){}function ja(r,e,t){let n,i,o,s;se(r,Ae,f=>t(5,n=f)),se(r,ne,f=>t(6,i=f)),se(r,Gt,f=>t(7,o=f)),se(r,ke,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){ke.set(null)}n.on("mousemove",p),n.on("mouseout",d),n.on("click",c),it(()=>{n.off("mousemove",p),n.off("mouseout",d),n.off("click",c)});function p(f){var m;if(a==ht){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});je.set(((m=g[0])==null?void 0:m.id)||null)}}function d(){a==ht&&je.set(null)}function c(f){if(a==ht){let m=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0?ke.set(m[0].id):ke.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let m=i.features.find(g=>g.id==f);m.geometry.type=="Point"?n.flyTo({center:m.geometry.coordinates,duration:500}):n.fitBounds(ir(m),{padding:200,duration:500}),l(ht)}}},[a,s,l,Yi,u,n,i,o]}class Ua extends V{constructor(e){super(),K(this,e,ja,Da,Y,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Yi}get stop(){return this.$$.ctx[4]}}function qa(r){let e,t;return{c:G,m(n,i){e||(t=q(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function Ga(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class An extends V{constructor(e){super(),K(this,e,Ga,qa,Y,{tool:1})}}function Ha(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function za(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ja(r){let e,t,n,i,o,s,a,l,u,p;function d(m,g){return m[1]?za:Ha}let c=d(r),f=c(r);return a=new An({props:{tool:r[0]}}),{c(){e=E("ul"),f.c(),t=R(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=R(),o=E("button"),o.textContent="Cancel",s=R(),N(a.$$.fragment),O(o,"type","button")},m(m,g){w(m,e,g),f.m(e,null),S(e,t),S(e,n),w(m,i,g),w(m,o,g),w(m,s,g),B(a,m,g),l=!0,u||(p=q(o,"click",r[2]),u=!0)},p(m,[g]){c!==(c=d(m))&&(f.d(1),f=c(m),f&&(f.c(),f.m(e,t)));const _={};g&1&&(_.tool=m[0]),a.$set(_)},i(m){l||($(a.$$.fragment,m),l=!0)},o(m){L(a.$$.fragment,m),l=!1},d(m){m&&k(e),f.d(),m&&k(i),m&&k(o),m&&k(s),D(a,m),u=!1,p()}}}function Ya(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Xi extends V{constructor(e){super(),K(this,e,Ya,Ja,Y,{pointTool:0,editingExisting:1})}}function Xa(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Wa(r){let e,t,n,i,o,s,a,l,u,p,d;return e=new Rn({props:{label:"Help",$$slots:{default:[Xa]},$$scope:{ctx:r}}}),l=new An({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=R(),n=E("div"),i=E("button"),i.textContent="Finish",o=R(),s=E("button"),s.textContent="Cancel",a=R(),N(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),ue(n,"display","flex"),ue(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,i),S(n,o),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(d=[q(i,"click",r[1]),q(s,"click",r[2])],p=!0)},p(c,[f]){const m={};f&8&&(m.$$scope={dirty:f,ctx:c}),e.$set(m);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){L(e.$$.fragment,c),L(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Re(d)}}}function Va(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Wi extends V{constructor(e){super(),K(this,e,Va,Wa,Y,{polygonTool:0})}}function Ka(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Za(r){let e,t,n,i,o,s,a,l,u,p,d;return e=new Rn({props:{label:"Help",$$slots:{default:[Ka]},$$scope:{ctx:r}}}),l=new An({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=R(),n=E("div"),i=E("button"),i.textContent="Finish",o=R(),s=E("button"),s.textContent="Cancel",a=R(),N(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),ue(n,"display","flex"),ue(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,i),S(n,o),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(d=[q(i,"click",r[1]),q(s,"click",r[2])],p=!0)},p(c,[f]){const m={};f&8&&(m.$$scope={dirty:f,ctx:c}),e.$set(m);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){L(e.$$.fragment,c),L(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Re(d)}}}function Qa(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Vi extends V{constructor(e){super(),K(this,e,Qa,Za,Y,{routeTool:0})}}function eu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function tu(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,m,g;return e=new Rn({props:{label:"Help",$$slots:{default:[eu]},$$scope:{ctx:r}}}),c=new An({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=R(),n=E("label"),i=E("input"),o=W(`
  Avoid doubling back`),s=R(),a=E("div"),l=E("button"),l.textContent="Finish",u=R(),p=E("button"),p.textContent="Cancel",d=R(),N(c.$$.fragment),O(i,"type","checkbox"),O(l,"type","button"),O(p,"type","button"),ue(a,"display","flex"),ue(a,"justify-content","space-between")},m(_,v){B(e,_,v),w(_,t,v),w(_,n,v),S(n,i),i.checked=r[1],S(n,o),w(_,s,v),w(_,a,v),S(a,l),S(a,u),S(a,p),w(_,d,v),B(c,_,v),f=!0,m||(g=[q(i,"change",r[2]),q(l,"click",r[3]),q(p,"click",r[4])],m=!0)},p(_,[v]){const h={};v&32&&(h.$$scope={dirty:v,ctx:_}),e.$set(h),v&2&&(i.checked=_[1]);const b={};v&1&&(b.tool=_[0]),c.$set(b)},i(_){f||($(e.$$.fragment,_),$(c.$$.fragment,_),f=!0)},o(_){L(e.$$.fragment,_),L(c.$$.fragment,_),f=!1},d(_){D(e,_),_&&k(t),_&&k(n),_&&k(s),_&&k(a),_&&k(d),D(c,_),m=!1,Re(g)}}}function nu(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class Ki extends V{constructor(e){super(),K(this,e,nu,tu,Y,{routeTool:0})}}function ai(r){let e,t,n,i;const o=[lu,su,ou,iu,ru],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=be()},m(l,u){s[e].m(l,u),w(l,n,u),i=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(fe(),L(s[p],1,1,()=>{s[p]=null}),ce(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){i||($(t),i=!0)},o(l){L(t),i=!1},d(l){s[e].d(l),l&&k(n)}}}function ru(r){let e;return{c(){e=E("p"),e.textContent="Click an object to edit its geometry"},m(t,n){w(t,e,n)},p:G,i:G,o:G,d(t){t&&k(e)}}}function iu(r){let e,t;return e=new Ki({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ou(r){let e,t;return e=new Vi({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function su(r){let e,t;return e=new Wi({props:{polygonTool:r[2]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function lu(r){let e,t;return e=new Xi({props:{pointTool:r[1],editingExisting:!0}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function au(r){let e,t,n=r[0]==qe&&ai(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==qe?n?(n.p(i,o),o&1&&$(n,1)):(n=ai(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const qe="edit-geometry";function Zi(){}function uu(r,e,t){let n;se(r,Ae,g=>t(8,n=g));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(o.stop(),s.stop(),a.stop(),ne.update(g=>{let _=g.features.find(v=>v.id==l);return delete _.properties.hide_while_editing,g})),l=null,t(4,u=null),je.set(null)}n.on("mousemove",d),n.on("mouseout",c),n.on("click",f),it(()=>{n.off("mousemove",d),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(g=>{i==qe&&(ne.update(_=>{let v=_.features.find(h=>h.id==l);return v.properties.length_meters=g.properties.length_meters,v.properties.waypoints=g.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=g.geometry,_}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{i==qe&&(ne.update(_=>{let v=_.features.find(h=>h.id==l);return v.properties.waypoints=g.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=g.geometry,_}),l=null,t(4,u=null))});for(let g of[o,s])g.addEventListenerSuccess(_=>{i==qe&&(ne.update(v=>{let h=v.features.find(b=>b.id==l);return h.geometry=_.geometry,delete h.properties.hide_while_editing,v}),l=null,t(4,u=null))});for(let g of[o,s,a])g.addEventListenerFailure(()=>{i==qe&&(ne.update(_=>{let v=_.features.find(h=>h.id==l);return delete v.properties.hide_while_editing,_}),l=null,t(4,u=null))});function d(g){var _;if(i==qe&&l==null){let v=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});je.set(((_=v[0])==null?void 0:_.id)||null)}}function c(){i==qe&&l==null&&je.set(null)}function f(g){if(i==qe&&l==null){let _=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&m(_[0].id)}}function m(g){je.set(null);let _=null;ne.update(h=>(_=h.features.find(b=>b.id==g),_.properties.hide_while_editing=!0,h));let v=_;l=g,v.geometry.type=="LineString"?(a.editExistingRoute(v),t(4,u="route")):v.geometry.type=="Polygon"?v.properties.waypoints?(a.editExistingArea(v),t(4,u="snap-polygon")):(s.editExisting(v),t(4,u="free-polygon")):v.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"pointTool"in g&&t(1,o=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[i,o,s,a,u,Zi,p]}class fu extends V{constructor(e){super(),K(this,e,uu,au,Y,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Zi}get stop(){return this.$$.ctx[6]}}async function cu(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),o+=p.length;const d=100*o/i;e.style=`background: linear-gradient(to right, red ${d}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function pu(r){let e,t;return e=new Ki({props:{routeTool:r[0]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function du(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&k(e),r[7](null)}}}function hu(r){let e,t,n,i;const o=[du,pu],s=[];function a(l,u){return l[0]?l[1]==nr?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=be()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),i=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(fe(),L(s[p],1,1,()=>{s[p]=null}),ce()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||($(t),i=!0)},o(l){L(t),i=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const nr="route";function mu(r,e,t){let n;se(r,Ae,c=>t(8,n=c));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}Yt(async()=>{await Ji(),console.log(`Grabbing ${s}`);try{const c=await cu(s,a);t(0,l=new Pa(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==nr&&o("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{i==nr&&(ne.update(f=>(c.id=Xt(f),c.properties.intervention_type="route",f.features.push(c),f)),o("edit-attribute"),ke.set(c.id))})});function d(c){ae[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,i=c.mode),"changeMode"in c&&t(3,o=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,i,a,o,s,u,p,d]}class _u extends V{constructor(e){super(),K(this,e,mu,hu,Y,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function ui(r){let e,t;return e=new Xi({props:{pointTool:r[1],editingExisting:!1}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function gu(r){let e,t,n=r[0]==wn&&ui(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==wn?n?(n.p(i,o),o&1&&$(n,1)):(n=ui(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const wn="point";function bu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==wn&&(ne.update(u=>(l.id=Xt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),ke.set(l.id))}),o.addEventListenerFailure(()=>{n==wn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class vu extends V{constructor(e){super(),K(this,e,bu,gu,Y,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function fi(r){let e,t;return e=new Wi({props:{polygonTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function yu(r){let e,t,n=r[0]==kn&&fi(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==kn?n?(n.p(i,o),o&1&&$(n,1)):(n=fi(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const kn="free-polygon";function wu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==kn&&(ne.update(u=>(l.id=Xt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),ke.set(l.id))}),o.addEventListenerFailure(()=>{n==kn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class ku extends V{constructor(e){super(),K(this,e,wu,yu,Y,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ci(r){let e,t;return e=new Vi({props:{routeTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Su(r){let e,t,n=r[0]==Sn&&ci(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==Sn?n?(n.p(i,o),o&1&&$(n,1)):(n=ci(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(fe(),L(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const Sn="snap-polygon";function Eu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==Sn&&(ne.update(u=>(l.id=Xt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),ke.set(l.id))}),o.addEventListenerFailure(()=>{n==Sn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class Mu extends V{constructor(e){super(),K(this,e,Eu,Su,Y,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function $u(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Je(r.slice(0,2),[n,t]),s=Je(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Lu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return bo(r,function(s){Ou(s,o,n)}),r}function Ou(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Cu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Kn(r),n=Kn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Lu(e,{precision:7});switch(n){case"Point":return rr(r,i);case"MultiPoint":return pi(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return pi(r,Hi(r,i))}}function pi(r,e){var t=[],n=Et();return or(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=rr(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=$u(vo(a)))}),n.load(We(t));else{var o=n.search(i);if(o.features.length){var s=Qi(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),hn(rr(s,i),function(a){t.push(a),n.insert(a)})}}}),We(t)}function rr(r,e){var t=[],n=Ue(r)[0],i=Ue(r)[r.geometry.coordinates.length-1];if(Dn(n,Ve(e))||Dn(i,Ve(e)))return We([r]);var o=Et(),s=Zn(r);o.load(s);var a=o.search(e);if(!a.features.length)return We([r]);var l=Qi(e,a),u=[n],p=yo(s,function(d,c,f){var m=Ue(c)[1],g=Ve(e);return f===l.id?(d.push(g),t.push(kt(d)),Dn(g,m)?[g]:[g,m]):(d.push(m),d)},u);return p.length>1&&t.push(kt(p)),We(t)}function Qi(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return hn(e,function(i){var o=Jt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function Dn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Ru(r,e,t){var n=Ue(t);if(Kn(t)!=="LineString")throw new Error("line must be a LineString");var i=Jt(t,r),o=Jt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),kt(a,t.properties)}function di(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Au(r){let e,t,n,i=r[0]==Ut&&di();return{c(){i&&i.c(),e=be()},m(o,s){i&&i.m(o,s),w(o,e,s),t||(n=q(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Ut?i||(i=di(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:G,o:G,d(o){i&&i.d(o),o&&k(e),t=!1,n()}}}const Ut="split-route",Iu=10,Tu=30;let jn="split-route";function eo(){}function hi(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Pu(r,e,t){let n,i;se(r,ne,g=>t(8,n=g)),se(r,Ae,g=>t(6,i=g));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",p),i.on("click",d),it(()=>{i.off("mousemove",p),i.off("click",d)}),Qe(i,jn,xe()),we(i,{id:"draw-split-route",source:jn,...Mt("black",Iu,["case",["==",["get","snapped"],!0],1,.5])});function p(g){if(o!=Ut)return;t(5,l=hi(g.lngLat.toArray(),!1)),u=null;const _=[g.point.x-Tu,g.point.y],v=i.unproject(g.point).distanceTo(i.unproject(_))/1e3;let h=[];for(let[b,y]of n.features.entries())if(y.geometry.type=="LineString"){let M=Jt(y.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=v&&h.push([b,M.geometry.coordinates,M.properties.dist])}h.sort((b,y)=>b[2]-y[2]),h.length>0&&(t(5,l=hi(h[0][1],!0)),u=h[0][0])}function d(){if(o==Ut)if(u==null)s("edit-attribute");else{let g=Cu(n.features[u],l);if(g.features.length==2){let _=g.features[0],v=g.features[1];ne.update(h=>(_.id=h.features[u].id,v.id=Xt(h),_.properties=JSON.parse(JSON.stringify(h.features[u].properties)),v.properties=JSON.parse(JSON.stringify(_.properties)),c(h.features[u],_,v,l),h.features.splice(u,1,_,v),h))}a()}}function c(g,_,v,h){_.properties.length_meters=sn(_,{units:"kilometers"})*1e3,v.properties.length_meters=sn(v,{units:"kilometers"})*1e3,_.properties.waypoints=[],v.properties.waypoints=[];let b=f(g,h),y=!0,M=0;for(let C of g.properties.waypoints){let T=f(g,vt([C.lon,C.lat]));if(y)if(T<b)_.properties.waypoints.push(C);else{let A=C.snapped&&g.properties.waypoints[M-1].snapped;_.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:A}),y=!1,v.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:A}),v.properties.waypoints.push(C)}else v.properties.waypoints.push(C);M++}}function f(g,_){let v=g.geometry.coordinates[0],h=Ru(v,_,g);return sn(h,{units:"kilometers"})*1e3}function m(g){o==Ut&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=xe();l&&g.features.push(l),i.getSource(jn).setData(g)}},[o,m,s,eo,a,l,i]}class Fu extends V{constructor(e){super(),K(this,e,Pu,Au,Y,{mode:0,changeMode:2,start:3,stop:4})}get start(){return eo}get stop(){return this.$$.ctx[4]}}const xu="/atip/speed_limit/assets/edit_attributes-29b396e1.svg",Nu="/atip/speed_limit/assets/edit_geometry-02dad294.svg",Bu="/atip/speed_limit/assets/point-276f4055.svg",Du="/atip/speed_limit/assets/polygon_snapped-18efbbea.svg",ju="/atip/speed_limit/assets/polygon_freehand-cf965967.svg",Uu="/atip/speed_limit/assets/route-d3c0ebad.svg",qu="/atip/speed_limit/assets/split_route-9e0ea2da.svg";function mi(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new fu({props:n}),r[15](e),{c(){N(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){r[15](null),D(e,i)}}}function _i(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"point",label:"New point",icon:Bu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function gi(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Mu({props:n}),r[18](e),{c(){N(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){r[18](null),D(e,i)}}}function bi(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"route",label:"New route",icon:Uu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function vi(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:qu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Gu(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,m,g,_,v,h,b,y,M,C,T,A,x,I,j,Z,F,H,le,Se;n=new nt({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:xu,changeMode:r[13]}});let Te={mode:r[3],changeMode:r[13]};o=new Ua({props:Te}),r[14](o),l=new nt({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:Nu,changeMode:r[13]}});let ie=r[2]&&mi(r),re=r[1]!="planning"&&_i(r),Ne={mode:r[3],changeMode:r[13],pointTool:r[11]};f=new vu({props:Ne}),r[16](f),_=new nt({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:ju,changeMode:r[13]}});let Le={mode:r[3],changeMode:r[13],polygonTool:r[12]};h=new ku({props:Le}),r[17](h),M=new nt({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:Du,changeMode:r[13]}});let Q=r[2]&&gi(r),he=r[1]!="planning"&&bi(r);function Vt(U){r[20](U)}let _e={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(_e.routeTool=r[2]),I=new _u({props:_e}),r[19](I),ae.push(()=>Ee(I,"routeTool",Vt,r[2]));let P=r[1]!="planning"&&vi(r),te={mode:r[3],changeMode:r[13]};return le=new Fu({props:te}),r[21](le),{c(){e=E("div"),t=E("div"),N(n.$$.fragment),i=R(),N(o.$$.fragment),s=R(),a=E("div"),N(l.$$.fragment),u=R(),ie&&ie.c(),p=R(),d=E("div"),re&&re.c(),c=R(),N(f.$$.fragment),m=R(),g=E("div"),N(_.$$.fragment),v=R(),N(h.$$.fragment),b=R(),y=E("div"),N(M.$$.fragment),C=R(),Q&&Q.c(),T=R(),A=E("div"),he&&he.c(),x=R(),N(I.$$.fragment),Z=R(),F=E("div"),P&&P.c(),H=R(),N(le.$$.fragment),O(e,"class","toolbox svelte-4s4d3o")},m(U,pe){w(U,e,pe),S(e,t),B(n,t,null),S(t,i),B(o,t,null),S(e,s),S(e,a),B(l,a,null),S(a,u),ie&&ie.m(a,null),S(e,p),S(e,d),re&&re.m(d,null),S(d,c),B(f,d,null),S(e,m),S(e,g),B(_,g,null),S(g,v),B(h,g,null),S(e,b),S(e,y),B(M,y,null),S(y,C),Q&&Q.m(y,null),S(e,T),S(e,A),he&&he.m(A,null),S(A,x),B(I,A,null),S(e,Z),S(e,F),P&&P.m(F,null),S(F,H),B(le,F,null),Se=!0},p(U,[pe]){const fr={};pe&8&&(fr.mode=U[3]),n.$set(fr);const cr={};pe&8&&(cr.mode=U[3]),o.$set(cr);const pr={};pe&8&&(pr.mode=U[3]),l.$set(pr),U[2]?ie?(ie.p(U,pe),pe&4&&$(ie,1)):(ie=mi(U),ie.c(),$(ie,1),ie.m(a,null)):ie&&(fe(),L(ie,1,1,()=>{ie=null}),ce()),U[1]!="planning"?re?(re.p(U,pe),pe&2&&$(re,1)):(re=_i(U),re.c(),$(re,1),re.m(d,c)):re&&(fe(),L(re,1,1,()=>{re=null}),ce());const dr={};pe&8&&(dr.mode=U[3]),f.$set(dr);const hr={};pe&8&&(hr.mode=U[3]),_.$set(hr);const mr={};pe&8&&(mr.mode=U[3]),h.$set(mr);const _r={};pe&8&&(_r.mode=U[3]),M.$set(_r),U[2]?Q?(Q.p(U,pe),pe&4&&$(Q,1)):(Q=gi(U),Q.c(),$(Q,1),Q.m(y,null)):Q&&(fe(),L(Q,1,1,()=>{Q=null}),ce()),U[1]!="planning"?he?(he.p(U,pe),pe&2&&$(he,1)):(he=bi(U),he.c(),$(he,1),he.m(A,x)):he&&(fe(),L(he,1,1,()=>{he=null}),ce());const Kt={};pe&8&&(Kt.mode=U[3]),pe&1&&(Kt.url=U[0]),!j&&pe&4&&(j=!0,Kt.routeTool=U[2],Me(()=>j=!1)),I.$set(Kt),U[1]!="planning"?P?(P.p(U,pe),pe&2&&$(P,1)):(P=vi(U),P.c(),$(P,1),P.m(F,H)):P&&(fe(),L(P,1,1,()=>{P=null}),ce());const gr={};pe&8&&(gr.mode=U[3]),le.$set(gr)},i(U){Se||($(n.$$.fragment,U),$(o.$$.fragment,U),$(l.$$.fragment,U),$(ie),$(re),$(f.$$.fragment,U),$(_.$$.fragment,U),$(h.$$.fragment,U),$(M.$$.fragment,U),$(Q),$(he),$(I.$$.fragment,U),$(P),$(le.$$.fragment,U),Se=!0)},o(U){L(n.$$.fragment,U),L(o.$$.fragment,U),L(l.$$.fragment,U),L(ie),L(re),L(f.$$.fragment,U),L(_.$$.fragment,U),L(h.$$.fragment,U),L(M.$$.fragment,U),L(Q),L(he),L(I.$$.fragment,U),L(P),L(le.$$.fragment,U),Se=!1},d(U){U&&k(e),D(n),r[14](null),D(o),D(l),ie&&ie.d(),re&&re.d(),r[16](null),D(f),D(_),r[17](null),D(h),D(M),Q&&Q.d(),he&&he.d(),r[19](null),D(I),P&&P.d(),r[21](null),D(le)}}}function Hu(r,e,t){let n;se(r,Ae,I=>t(22,n=I));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new da(n),l=new Ma(n),u="edit-attribute",p,d,c,f,m,g,_;function v(I){let j={"edit-attribute":p,"edit-geometry":d,route:c,point:f,"free-polygon":m,"snap-polygon":g,"split-route":_};if(u==I){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),j[u].stop(),t(3,u=I),console.log(`Starting new mode ${u}`),j[u].start()}it(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function h(I){ae[I?"unshift":"push"](()=>{p=I,t(4,p)})}function b(I){ae[I?"unshift":"push"](()=>{d=I,t(5,d)})}function y(I){ae[I?"unshift":"push"](()=>{f=I,t(7,f)})}function M(I){ae[I?"unshift":"push"](()=>{m=I,t(8,m)})}function C(I){ae[I?"unshift":"push"](()=>{g=I,t(9,g)})}function T(I){ae[I?"unshift":"push"](()=>{c=I,t(6,c)})}function A(I){s=I,t(2,s)}function x(I){ae[I?"unshift":"push"](()=>{_=I,t(10,_)})}return r.$$set=I=>{"routeSnapperUrl"in I&&t(0,i=I.routeSnapperUrl),"schema"in I&&t(1,o=I.schema)},[i,o,s,u,p,d,c,f,m,g,_,a,l,v,h,b,y,M,C,T,A,x]}class zu extends V{constructor(e){super(),K(this,e,Hu,Gu,Y,{routeSnapperUrl:0,schema:1})}}function Ju(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,m,g,_,v,h,b;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",i=R(),o=E("button"),o.textContent="About",s=R(),a=E("button"),a.textContent="Instructions",l=R(),u=E("br"),p=R(),d=E("label"),c=W(`ATIP schema:
      `),f=E("select"),m=E("option"),m.textContent="v1",g=E("option"),g.textContent="v2",_=E("option"),_.textContent="Housing developments",v=E("option"),v.textContent="Critical issues",O(n,"type","button"),O(o,"type","button"),O(a,"type","button"),m.__value="v1",m.value=m.__value,g.__value="v2",g.value=g.__value,_.__value="planning",_.value=_.__value,v.__value="criticals",v.value=v.__value,r[2]===void 0&&ot(()=>r[12].call(f)),O(e,"slot","nav")},m(y,M){w(y,e,M),S(e,t),S(t,n),S(t,i),S(t,o),S(t,s),S(t,a),S(e,l),S(e,u),S(e,p),S(e,d),S(d,c),S(d,f),S(f,m),S(f,g),S(f,_),S(f,v),Ke(f,r[2]),h||(b=[q(n,"click",r[11]),q(o,"click",r[8]),q(a,"click",r[9]),q(f,"change",r[12]),q(f,"change",r[10])],h=!0)},p(y,M){M&4&&Ke(f,y[2])},d(y){y&&k(e),h=!1,Re(b)}}}function Yu(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,m,g,_;return o=new Kl({props:{boundaryGeojson:r[5]}}),a=new Yl({props:{authorityName:r[6],schema:r[2]}}),d=new Dl({props:{schema:r[2],routeInfo:r[4]}}),g=new ql({props:{routeInfo:r[4]}}),{c(){e=E("div"),t=E("h1"),n=W(r[6]),i=R(),N(o.$$.fragment),s=R(),N(a.$$.fragment),l=R(),u=E("br"),p=R(),N(d.$$.fragment),c=R(),f=E("hr"),m=R(),N(g.$$.fragment),O(e,"slot","sidebar")},m(v,h){w(v,e,h),S(e,t),S(t,n),S(t,i),B(o,t,null),S(e,s),B(a,e,null),S(e,l),S(e,u),S(e,p),B(d,e,null),S(e,c),S(e,f),S(e,m),B(g,e,null),_=!0},p(v,h){const b={};h&32&&(b.boundaryGeojson=v[5]),o.$set(b);const y={};h&4&&(y.schema=v[2]),a.$set(y);const M={};h&4&&(M.schema=v[2]),h&16&&(M.routeInfo=v[4]),d.$set(M);const C={};h&16&&(C.routeInfo=v[4]),g.$set(C)},i(v){_||($(o.$$.fragment,v),$(a.$$.fragment,v),$(d.$$.fragment,v),$(g.$$.fragment,v),_=!0)},o(v){L(o.$$.fragment,v),L(a.$$.fragment,v),L(d.$$.fragment,v),L(g.$$.fragment,v),_=!1},d(v){v&&k(e),D(o),D(a),D(d),D(g)}}}function Xu(r){let e,t,n,i,o,s,a,l,u,p,d,c;return e=new Rs({props:{boundaryGeojson:r[5]}}),n=new fa({props:{schema:r[2]}}),o=new pa({}),a=new zu({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new ea({props:{style:r[7]}}),d=new aa({props:{schema:r[2]}}),{c(){N(e.$$.fragment),t=R(),N(n.$$.fragment),i=R(),N(o.$$.fragment),s=R(),N(a.$$.fragment),l=R(),N(u.$$.fragment),p=R(),N(d.$$.fragment)},m(f,m){B(e,f,m),w(f,t,m),B(n,f,m),w(f,i,m),B(o,f,m),w(f,s,m),B(a,f,m),w(f,l,m),B(u,f,m),w(f,p,m),B(d,f,m),c=!0},p(f,m){const g={};m&32&&(g.boundaryGeojson=f[5]),e.$set(g);const _={};m&4&&(_.schema=f[2]),n.$set(_);const v={};m&8&&(v.routeSnapperUrl=f[3]),m&4&&(v.schema=f[2]),a.$set(v);const h={};m&4&&(h.schema=f[2]),d.$set(h)},i(f){c||($(e.$$.fragment,f),$(n.$$.fragment,f),$(o.$$.fragment,f),$(a.$$.fragment,f),$(u.$$.fragment,f),$(d.$$.fragment,f),c=!0)},o(f){L(e.$$.fragment,f),L(n.$$.fragment,f),L(o.$$.fragment,f),L(a.$$.fragment,f),L(u.$$.fragment,f),L(d.$$.fragment,f),c=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(i),D(o,f),f&&k(s),D(a,f),f&&k(l),D(u,f),f&&k(p),D(d,f)}}}function Wu(r){let e,t,n;return t=new Ko({props:{style:r[7],$$slots:{default:[Xu]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),O(e,"slot","main")},m(i,o){w(i,e,o),B(t,e,null),n=!0},p(i,o){const s={};o&524332&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){L(t.$$.fragment,i),n=!1},d(i){i&&k(e),D(t)}}}function Vu(r){let e,t,n,i,o,s,a,l;e=new rs({props:{$$slots:{main:[Wu],sidebar:[Yu],nav:[Ju]},$$scope:{ctx:r}}});function u(f){r[13](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new wo({props:p}),ae.push(()=>Ee(n,"open",u,r[0]));function d(f){r[14](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Xo({props:c}),ae.push(()=>Ee(s,"open",d,r[1])),{c(){N(e.$$.fragment),t=R(),N(n.$$.fragment),o=R(),N(s.$$.fragment)},m(f,m){B(e,f,m),w(f,t,m),B(n,f,m),w(f,o,m),B(s,f,m),l=!0},p(f,[m]){const g={};m&524348&&(g.$$scope={dirty:m,ctx:f}),e.$set(g);const _={};!i&&m&1&&(i=!0,_.open=f[0],Me(()=>i=!1)),n.$set(_);const v={};!a&&m&2&&(a=!0,v.open=f[1],Me(()=>a=!1)),s.$set(v)},i(f){l||($(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!0)},o(f){L(e.$$.fragment,f),L(n.$$.fragment,f),L(s.$$.fragment,f),l=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(o),D(s,f)}}}function Ku(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${a}.bin`,d=`https://atip.uk/route-info/${a}.bin`;o||(p=`https://atip.uk/route-snappers-dev/${a}.bin`,d=`https://atip.uk/route-info-dev/${a}.bin`);let c;function f(){t(0,n=!n),t(1,i=!1)}function m(){t(1,i=!i),t(0,n=!1)}let g;Yt(async()=>{t(5,g=await _());const C=Mi(new Fo);t(4,c=await new C),await c.loadFile(d)});async function _(){const T=await(await fetch(ko)).text(),A=JSON.parse(T);return A.features=A.features.filter(x=>{var I;return((I=x.properties)==null?void 0:I.name)==a}),A}function v(){let C=new URLSearchParams(window.location.search);C.set("schema",u);let T=`${window.location.pathname}?${C.toString()}${window.location.hash}`;window.location.href=T}const h=()=>window.open("index.html");function b(){u=Mn(this),t(2,u)}function y(C){n=C,t(0,n)}function M(C){i=C,t(1,i)}return[n,i,u,p,c,g,a,l,f,m,v,h,b,y,M]}class Zu extends V{constructor(e){super(),K(this,e,Ku,Vu,Y,{})}}new Zu({target:document.getElementById("app")});
