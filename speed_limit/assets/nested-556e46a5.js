var Zo=Object.defineProperty;var Qo=(r,e,t)=>e in r?Zo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ie=(r,e,t)=>(Qo(r,typeof e!="symbol"?e+"":e,t),t);import{S as V,i as K,s as W,M as ei,b as ae,a as Ee,d as N,m as B,k as Me,n as $,o as O,q as D,e as E,c as R,g as w,x as G,p as k,y as Re,f as L,z as ce,B as pe,C as ti,D as er,E as Zt,F as kt,G as ct,H as pt,I as dt,J as ht,K as _r,h as S,l as U,L as ni,N as ri,O as se,P as oi,w as tr,Q as Ze,R as we,T as wn,U as un,V as ue,t as X,W as St,X as _t,r as Oe,Y as gt,Z as nr,_ as be,j as Ce,$ as xe,a0 as bo,a1 as bt,a2 as fn,a3 as gr,a4 as ii,a5 as si,a6 as Fe,a7 as li,a8 as ai,a9 as xn,aa as kn,ab as Et,ac as Sn,ad as En,ae as Nn,af as ui,ag as mt,ah as rr,ai as We,aj as vt,ak as fi,al as or,am as ci,an as pi,ao as di,ap as br,aq as cn,ar as hi,as as mi,at as _i,A as gi,u as bi}from"./authorities-34c81295.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vo=Symbol("Comlink.proxy"),vi=Symbol("Comlink.endpoint"),yi=Symbol("Comlink.releaseProxy"),On=Symbol("Comlink.finalizer"),Qt=Symbol("Comlink.thrown"),yo=r=>typeof r=="object"&&r!==null||typeof r=="function",wi={canHandle:r=>yo(r)&&r[vo],serialize(r){const{port1:e,port2:t}=new MessageChannel;return ir(r,e),[t,[t]]},deserialize(r){return r.start(),So(r)}},ki={canHandle:r=>yo(r)&&Qt in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},wo=new Map([["proxy",wi],["throw",ki]]);function Si(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function ir(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!Si(t,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:s,path:a}=Object.assign({path:[]},o.data),l=(o.data.argumentList||[]).map(Qe);let u;try{const p=a.slice(0,-1).reduce((c,f)=>c[f],r),h=a.reduce((c,f)=>c[f],r);switch(s){case"GET":u=h;break;case"SET":p[a.slice(-1)[0]]=Qe(o.data.value),u=!0;break;case"APPLY":u=h.apply(p,l);break;case"CONSTRUCT":{const c=new h(...l);u=Ci(c)}break;case"ENDPOINT":{const{port1:c,port2:f}=new MessageChannel;ir(r,f),u=Oi(c,[c])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[Qt]:0}}Promise.resolve(u).catch(p=>({value:p,[Qt]:0})).then(p=>{const[h,c]=hn(p);e.postMessage(Object.assign(Object.assign({},h),{id:i}),c),s==="RELEASE"&&(e.removeEventListener("message",n),ko(e),On in r&&typeof r[On]=="function"&&r[On]())}).catch(p=>{const[h,c]=hn({value:new TypeError("Unserializable return value"),[Qt]:0});e.postMessage(Object.assign(Object.assign({},h),{id:i}),c)})}),e.start&&e.start()}function Ei(r){return r.constructor.name==="MessagePort"}function ko(r){Ei(r)&&r.close()}function So(r,e){return Bn(r,[],e)}function Xt(r){if(r)throw new Error("Proxy has been released and is not useable")}function Eo(r){return lt(r,{type:"RELEASE"}).then(()=>{ko(r)})}const pn=new WeakMap,dn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(pn.get(r)||0)-1;pn.set(r,e),e===0&&Eo(r)});function Mi(r,e){const t=(pn.get(e)||0)+1;pn.set(e,t),dn&&dn.register(r,e,r)}function $i(r){dn&&dn.unregister(r)}function Bn(r,e=[],t=function(){}){let n=!1;const o=new Proxy(t,{get(i,s){if(Xt(n),s===yi)return()=>{$i(o),Eo(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>o};const a=lt(r,{type:"GET",path:e.map(l=>l.toString())}).then(Qe);return a.then.bind(a)}return Bn(r,[...e,s])},set(i,s,a){Xt(n);const[l,u]=hn(a);return lt(r,{type:"SET",path:[...e,s].map(p=>p.toString()),value:l},u).then(Qe)},apply(i,s,a){Xt(n);const l=e[e.length-1];if(l===vi)return lt(r,{type:"ENDPOINT"}).then(Qe);if(l==="bind")return Bn(r,e.slice(0,-1));const[u,p]=vr(a);return lt(r,{type:"APPLY",path:e.map(h=>h.toString()),argumentList:u},p).then(Qe)},construct(i,s){Xt(n);const[a,l]=vr(s);return lt(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(Qe)}});return Mi(o,r),o}function Li(r){return Array.prototype.concat.apply([],r)}function vr(r){const e=r.map(hn);return[e.map(t=>t[0]),Li(e.map(t=>t[1]))]}const Mo=new WeakMap;function Oi(r,e){return Mo.set(r,e),r}function Ci(r){return Object.assign(r,{[vo]:!0})}function hn(r){for(const[e,t]of wo)if(t.canHandle(r)){const[n,o]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:r},Mo.get(r)||[]]}function Qe(r){switch(r.type){case"HANDLER":return wo.get(r.name).deserialize(r.value);case"RAW":return r.value}}function lt(r,e,t){return new Promise(n=>{const o=Ri();r.addEventListener("message",function i(s){!s.data||!s.data.id||s.data.id!==o||(r.removeEventListener("message",i),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:o},e),t)})}function Ri(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Ai(){return new Worker("/atip/speed_limit/assets/worker-04729cb1.js")}let te;const Ge=new Array(128).fill(void 0);Ge.push(void 0,null,!0,!1);function z(r){return Ge[r]}let It=Ge.length;function Ti(r){r<132||(Ge[r]=It,It=r)}function en(r){const e=z(r);return Ti(r),e}const $o=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&$o.decode();let Ct=null;function Ft(){return(Ct===null||Ct.byteLength===0)&&(Ct=new Uint8Array(te.memory.buffer)),Ct}function at(r,e){return r=r>>>0,$o.decode(Ft().subarray(r,r+e))}function _e(r){It===Ge.length&&Ge.push(Ge.length+1);const e=It;return It=Ge[e],Ge[e]=r,e}let tt=0;const tn=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Ii=typeof tn.encodeInto=="function"?function(r,e){return tn.encodeInto(r,e)}:function(r,e){const t=tn.encode(r);return e.set(t),{read:r.length,written:t.length}};function Cn(r,e,t){if(t===void 0){const a=tn.encode(r),l=e(a.length)>>>0;return Ft().subarray(l,l+a.length).set(a),tt=a.length,l}let n=r.length,o=e(n)>>>0;const i=Ft();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;i[o+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),o=t(o,n,n=s+r.length*3)>>>0;const a=Ft().subarray(o+s,o+n),l=Ii(r,a);s+=l.written}return tt=s,o}function $t(r){return r==null}let Rt=null;function ge(){return(Rt===null||Rt.byteLength===0)&&(Rt=new Int32Array(te.memory.buffer)),Rt}let At=null;function Fi(){return(At===null||At.byteLength===0)&&(At=new Float64Array(te.memory.buffer)),At}let Tt=null;function Pi(){return(Tt===null||Tt.byteLength===0)&&(Tt=new BigInt64Array(te.memory.buffer)),Tt}function Dn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let i="[";o>0&&(i+=Dn(r[0]));for(let s=1;s<o;s++)i+=", "+Dn(r[s]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function xi(r,e){const t=e(r.length*1)>>>0;return Ft().set(r,t/1),tt=r.length,t}function Rn(r,e){try{return r.apply(this,e)}catch(t){te.__wbindgen_exn_store(_e(t))}}let jn=class{static __wrap(e){e=e>>>0;const t=Object.create(jn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();te.__wbg_routeinfo_free(e)}constructor(e){try{const i=te.__wbindgen_add_to_stack_pointer(-16),s=xi(e,te.__wbindgen_malloc),a=tt;te.routeinfo_new(i,s,a);var t=ge()[i/4+0],n=ge()[i/4+1],o=ge()[i/4+2];if(o)throw en(n);return jn.__wrap(t)}finally{te.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const p=te.__wbindgen_add_to_stack_pointer(-16);te.routeinfo_nameForRoute(p,this.__wbg_ptr,_e(e));var o=ge()[p/4+0],i=ge()[p/4+1],s=ge()[p/4+2],a=ge()[p/4+3],l=o,u=i;if(a)throw l=0,u=0,en(s);return t=l,n=u,at(l,u)}finally{te.__wbindgen_add_to_stack_pointer(16),te.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const p=te.__wbindgen_add_to_stack_pointer(-16);te.routeinfo_speedLimitForRoute(p,this.__wbg_ptr,_e(e));var o=ge()[p/4+0],i=ge()[p/4+1],s=ge()[p/4+2],a=ge()[p/4+3],l=o,u=i;if(a)throw l=0,u=0,en(s);return t=l,n=u,at(l,u)}finally{te.__wbindgen_add_to_stack_pointer(16),te.__wbindgen_free(t,n)}}};async function Ni(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Bi(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){en(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=z(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(at(e,t));return _e(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=z(t),o=typeof n=="string"?n:void 0;var i=$t(o)?0:Cn(o,te.__wbindgen_malloc,te.__wbindgen_realloc),s=tt;ge()[e/4+1]=s,ge()[e/4+0]=i},r.wbg.__wbindgen_is_bigint=function(e){return typeof z(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return _e(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return z(e)===z(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=z(t),o=typeof n=="number"?n:void 0;Fi()[e/8+1]=$t(o)?0:o,ge()[e/4+0]=!$t(o)},r.wbg.__wbindgen_is_object=function(e){const t=z(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return z(e)in z(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return _e(t)},r.wbg.__wbindgen_is_undefined=function(e){return z(e)===void 0},r.wbg.__wbindgen_string_new=function(e,t){const n=at(e,t);return _e(n)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return z(e)==z(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=z(e);return _e(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=z(e)[z(t)];return _e(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return _e(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=z(t).stack,o=Cn(n,te.__wbindgen_malloc,te.__wbindgen_realloc),i=tt;ge()[e/4+1]=i,ge()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(at(e,t))}finally{te.__wbindgen_free(n,o)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(z(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(z(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(z(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(z(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(z(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=z(e)[t>>>0];return _e(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return z(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof z(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=z(e).next;return _e(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return Rn(function(e){const t=z(e).next();return _e(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return z(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=z(e).value;return _e(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return _e(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return Rn(function(e,t){const n=Reflect.get(z(e),z(t));return _e(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return Rn(function(e,t){const n=z(e).call(z(t));return _e(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(z(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=z(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(z(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(z(e));return _e(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=z(e).buffer;return _e(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(z(e));return _e(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){z(e).set(z(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return z(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=z(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=z(t),o=typeof n=="bigint"?n:void 0;Pi()[e/8+1]=$t(o)?BigInt(0):o,ge()[e/4+0]=!$t(o)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Dn(z(t)),o=Cn(n,te.__wbindgen_malloc,te.__wbindgen_realloc),i=tt;ge()[e/4+1]=i,ge()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(at(e,t))},r.wbg.__wbindgen_memory=function(){const e=te.memory;return _e(e)},r}function Di(r,e){return te=r.exports,Lo.__wbindgen_wasm_module=e,Tt=null,At=null,Rt=null,Ct=null,te}async function Lo(r){if(te!==void 0)return te;typeof r>"u"&&(r="/atip/speed_limit/assets/route_info_bg.wasm");const e=Bi();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Ni(await r,e);return Di(t,n)}class ji{constructor(){ie(this,"inner");this.inner=null}async loadFile(e){await Lo(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new jn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.speedLimitForRoute(e)}}ir(ji);function qi(r){let e,t,n,o,i,s,a,l,u,p,h,c,f;return{c(){e=E("p"),e.textContent="For each intervention:",t=R(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,o=R(),i=E("p"),i.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=R(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=R(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=R(),h=E("p"),h.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=R(),f=E("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(d,g){w(d,e,g),w(d,t,g),w(d,n,g),w(d,o,g),w(d,i,g),w(d,s,g),w(d,a,g),w(d,l,g),w(d,u,g),w(d,p,g),w(d,h,g),w(d,c,g),w(d,f,g)},p:G,d(d){d&&k(e),d&&k(t),d&&k(n),d&&k(o),d&&k(i),d&&k(s),d&&k(a),d&&k(l),d&&k(u),d&&k(p),d&&k(h),d&&k(c),d&&k(f)}}}function Ui(r){let e,t,n;function o(s){r[1](s)}let i={title:"Instructions",$$slots:{default:[qi]},$$scope:{ctx:r}};return r[0]!==void 0&&(i.open=r[0]),e=new ei({props:i}),ae.push(()=>Ee(e,"open",o,r[0])),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Gi(r,e,t){let{open:n}=e;function o(i){n=i,t(0,n)}return r.$$set=i=>{"open"in i&&t(0,n=i.open)},[n,o]}class Hi extends V{constructor(e){super(),K(this,e,Gi,Ui,W,{open:0})}}const nt=[];function Mt(r,e=G){let t;const n=new Set;function o(a){if(W(r,a)&&(r=a,t)){const l=!nt.length;for(const u of n)u[1](),nt.push(u,r);if(l){for(let u=0;u<nt.length;u+=2)nt[u][0](nt[u+1]);nt.length=0}}}function i(a){o(a(r))}function s(a,l=G){const u=[a,l];return n.add(u),n.size===1&&(t=e(o)||G),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:o,update:i,subscribe:s}}const Ae=Mt(null),ne=Mt(Re()),Se=Mt(null),je=Mt(null),Dt=Mt(null),jt=Mt(null);function Ht(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function yr(r){console.log(`Deleting intervention ${r}`),ne.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Se.set(null),je.set(null),Dt.set(null),jt.set(null)}function wr(r){let e;const t=r[4].default,n=ct(t,r,r[3],null);return{c(){n&&n.c()},m(o,i){n&&n.m(o,i),e=!0},p(o,i){n&&n.p&&(!e||i&8)&&pt(n,t,o,o[3],e?ht(t,o[3],i,null):dt(o[3]),null)},i(o){e||($(n,o),e=!0)},o(o){O(n,o),e=!1},d(o){n&&n.d(o)}}}function zi(r){let e,t,n=r[1]&&wr(r);return{c(){e=E("div"),n&&n.c(),L(e,"class","map svelte-12dpf1u")},m(o,i){w(o,e,i),n&&n.m(e,null),r[5](e),t=!0},p(o,[i]){o[1]?n?(n.p(o,i),i&2&&$(n,1)):(n=wr(o),n.c(),$(n,1),n.m(e,null)):n&&(ce(),O(n,1,1,()=>{n=null}),pe())},i(o){t||($(n),t=!0)},o(o){O(n),t=!1},d(o){o&&k(e),n&&n.d(),r[5](null)}}}function Yi(r,e,t){let{$$slots:n={},$$scope:o}=e,{style:i}=e,s,a,l=!1;ti("setCamera",!window.location.hash),er(()=>{s=new Zt.Map({container:a,style:`https://api.maptiler.com/maps/${i}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new Zt.ScaleControl({})),s.addControl(new Zt.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ae.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),kt(()=>{s.remove()});function u(p){ae[p?"unshift":"push"](()=>{a=p,t(0,a)})}return r.$$set=p=>{"style"in p&&t(2,i=p.style),"$$scope"in p&&t(3,o=p.$$scope)},[a,l,i,o,n,u]}class Ji extends V{constructor(e){super(),K(this,e,Yi,zi,W,{style:2})}}const Xi=r=>({}),kr=r=>({}),Wi=r=>({}),Sr=r=>({}),Vi=r=>({}),Er=r=>({});function Ki(r){let e,t,n,o,i,s,a,l,u,p,h,c;const f=r[3].nav,d=ct(f,r,r[2],Er),g=r[3].sidebar,_=ct(g,r,r[2],Sr),v=r[3].main,m=ct(v,r,r[2],kr);return{c(){e=E("aside"),t=E("div"),n=E("nav"),d&&d.c(),o=R(),_&&_.c(),i=R(),s=E("button"),s.textContent="→",l=R(),u=E("main"),m&&m.c(),L(n,"class","svelte-1u7vg8a"),L(t,"class","sidebar-content content-container svelte-1u7vg8a"),L(s,"type","button"),L(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),L(e,"class",a=_r(r[0]?"":"collapsed")+" svelte-1u7vg8a"),L(u,"class","svelte-1u7vg8a")},m(b,y){w(b,e,y),S(e,t),S(t,n),d&&d.m(n,null),S(t,o),_&&_.m(t,null),S(e,i),S(e,s),w(b,l,y),w(b,u,y),m&&m.m(u,null),p=!0,h||(c=U(s,"click",r[1]),h=!0)},p(b,[y]){d&&d.p&&(!p||y&4)&&pt(d,f,b,b[2],p?ht(f,b[2],y,Vi):dt(b[2]),Er),_&&_.p&&(!p||y&4)&&pt(_,g,b,b[2],p?ht(g,b[2],y,Wi):dt(b[2]),Sr),(!p||y&1&&a!==(a=_r(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&L(e,"class",a),m&&m.p&&(!p||y&4)&&pt(m,v,b,b[2],p?ht(v,b[2],y,Xi):dt(b[2]),kr)},i(b){p||($(d,b),$(_,b),$(m,b),p=!0)},o(b){O(d,b),O(_,b),O(m,b),p=!1},d(b){b&&k(e),d&&d.d(b),_&&_.d(b),b&&k(l),b&&k(u),m&&m.d(b),h=!1,c()}}}function Zi(r,e,t){let{$$slots:n={},$$scope:o}=e,i=!0;function s(){t(0,i=!i)}return r.$$set=a=>{"$$scope"in a&&t(2,o=a.$$scope)},[i,s,o,n]}class Qi extends V{constructor(e){super(),K(this,e,Zi,Ki,W,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function es(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,o=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){t.label=u[1];break}if(u[0]===6&&t.label<i[1]){t.label=i[1],i=u;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(u);break}i[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ke=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function ts(r,e){return r>e?1:r<e?-1:0}function ze(r,e,t){for(var n=new Ke(null,null),o=n,i=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}i.left=e,i=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}o.right=e,o=e,e=e.right}else break}return o.right=e.left,i.left=e.right,e.left=n.right,e.right=n.left,e}function An(r,e,t,n){var o=new Ke(r,e);if(t===null)return o.left=o.right=null,o;t=ze(r,t,n);var i=n(r,t.key);return i<0?(o.left=t.left,o.right=t,t.left=null):i>=0&&(o.right=t.right,o.left=t,t.right=null),o}function Mr(r,e,t){var n=null,o=null;if(e){e=ze(r,e,t);var i=t(e.key,r);i===0?(n=e.left,o=e.right):i<0?(o=e.right,e.right=null,n=e):(n=e.left,e.left=null,o=e)}return{left:n,right:o}}function ns(r,e,t){return e===null?r:(r===null||(e=ze(r.key,e,t),e.left=r),e)}function qn(r,e,t,n,o){if(r){n(""+e+(t?"└── ":"├── ")+o(r)+`
`);var i=e+(t?"    ":"│   ");r.left&&qn(r.left,i,!1,n,o),r.right&&qn(r.right,i,!0,n,o)}}var sr=function(){function r(e){e===void 0&&(e=ts),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=An(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ke(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var o=this._comparator,i=ze(e,this._root,o),s=o(e,i.key);return s===0?this._root=i:(s<0?(n.left=i.left,n.right=i,i.left=null):s>0&&(n.right=i.right,n.left=i,i.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var o;if(t===null)return null;t=ze(e,t,n);var i=n(e,t.key);return i===0?(t.left===null?o=t.right:(o=ze(e,t.left,n),o.right=t.right),this._size--,o):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ze(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return t;o<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ze(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return!0;o<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,o=[],i=!1;!i;)n!==null?(o.push(n),n=n.left):o.length!==0?(n=o.pop(),e.call(t,n),n=n.right):i=!0;return this},r.prototype.range=function(e,t,n,o){for(var i=[],s=this._comparator,a=this._root,l;i.length!==0||a;)if(a)i.push(a),a=a.left;else{if(a=i.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(o,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,o=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),o===e)return t;o++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var o=this._comparator;t;){var i=o(e.key,t.key);if(i===0)break;i<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var o=this._comparator;t;){var i=o(e.key,t.key);if(i===0)break;i<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return os(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var o=e.length,i=this._comparator;if(n&&Hn(e,t,0,o-1,i),this._root===null)this._root=Un(e,t,0,o),this._size=o;else{var s=is(this.toList(),rs(e,t),i);o=this._size+o,this._root=Gn({head:s},0,o)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return qn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var o=this._comparator,i=Mr(e,this._root,o),s=i.left,a=i.right;o(e,t)<0?a=An(t,n,a,o):s=An(t,n,s,o),this._root=ns(s,a,o)},r.prototype.split=function(e){return Mr(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return es(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Un(r,e,t,n){var o=n-t;if(o>0){var i=t+Math.floor(o/2),s=r[i],a=e[i],l=new Ke(s,a);return l.left=Un(r,e,t,i),l.right=Un(r,e,i+1,n),l}return null}function rs(r,e){for(var t=new Ke(null,null),n=t,o=0;o<r.length;o++)n=n.next=new Ke(r[o],e[o]);return n.next=null,t.next}function os(r){for(var e=r,t=[],n=!1,o=new Ke(null,null),i=o;!n;)e?(t.push(e),e=e.left):t.length>0?(e=i=i.next=t.pop(),e=e.right):n=!0;return i.next=null,o.next}function Gn(r,e,t){var n=t-e;if(n>0){var o=e+Math.floor(n/2),i=Gn(r,e,o),s=r.head;return s.left=i,r.head=r.head.next,s.right=Gn(r,o+1,t),s}return null}function is(r,e,t){for(var n=new Ke(null,null),o=n,i=r,s=e;i!==null&&s!==null;)t(i.key,s.key)<0?(o.next=i,i=i.next):(o.next=s,s=s.next),o=o.next;return i!==null?o.next=i:s!==null&&(o.next=s),n.next}function Hn(r,e,t,n,o){if(!(t>=n)){for(var i=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(o(r[s],i)<0);do a--;while(o(r[a],i)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Hn(r,e,t,a,o),Hn(r,e,a+1,n,o)}}function Te(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function $r(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function $e(r,e,t){return e&&$r(r.prototype,e),t&&$r(r,t),r}var Lt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},zn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,o=e.ur.x<t.ur.x?e.ur.x:t.ur.x,i=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:i},ur:{x:o,y:s}}},Je=Number.EPSILON;Je===void 0&&(Je=Math.pow(2,-52));var ss=Je*Je,Yn=function(e,t){if(-Je<e&&e<Je&&-Je<t&&t<Je)return 0;var n=e-t;return n*n<ss*e*t?0:e<t?-1:1},ls=function(){function r(){Te(this,r),this.reset()}return $e(r,[{key:"reset",value:function(){this.xRounder=new Lr,this.yRounder=new Lr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Lr=function(){function r(){Te(this,r),this.tree=new sr,this.round(0)}return $e(r,[{key:"round",value:function(t){var n=this.tree.add(t),o=this.tree.prev(n);if(o!==null&&Yn(n.key,o.key)===0)return this.tree.remove(t),o.key;var i=this.tree.next(n);return i!==null&&Yn(n.key,i.key)===0?(this.tree.remove(t),i.key):t}}]),r}(),qt=new ls,Pt=function(e,t){return e.x*t.y-e.y*t.x},Oo=function(e,t){return e.x*t.x+e.y*t.y},Or=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y},s=Pt(o,i);return Yn(s,0)},mn=function(e){return Math.sqrt(Oo(e,e))},as=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return Pt(i,o)/mn(i)/mn(o)},us=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return Oo(i,o)/mn(i)/mn(o)},Cr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Rr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},fs=function(e,t,n,o){if(t.x===0)return Rr(n,o,e.x);if(o.x===0)return Rr(e,t,n.x);if(t.y===0)return Cr(n,o,e.y);if(o.y===0)return Cr(e,t,n.y);var i=Pt(t,o);if(i==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=Pt(s,t)/i,l=Pt(s,o)/i,u=e.x+l*t.x,p=n.x+a*o.x,h=e.y+l*t.y,c=n.y+a*o.y,f=(u+p)/2,d=(h+c)/2;return{x:f,y:d}},De=function(){$e(r,null,[{key:"compare",value:function(t,n){var o=r.comparePoints(t.point,n.point);return o!==0?o:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:_n.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Te(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return $e(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,o=0,i=n.length;o<i;o++){var s=n[o];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var o=this.point.events[n];if(o.segment.consumedBy===void 0)for(var i=n+1;i<t;i++){var s=this.point.events[i];s.consumedBy===void 0&&o.otherSE.point.events===s.otherSE.point.events&&o.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,o=this.point.events.length;n<o;n++){var i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,o=new Map,i=function(a){var l=a.otherSE;o.set(a,{sine:as(n.point,t.point,l.point),cosine:us(n.point,t.point,l.point)})};return function(s,a){o.has(s)||i(s),o.has(a)||i(a);var l=o.get(s),u=l.sine,p=l.cosine,h=o.get(a),c=h.sine,f=h.cosine;return u>=0&&c>=0?p<f?1:p>f?-1:0:u<0&&c<0?p<f?-1:p>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),cs=0,_n=function(){$e(r,null,[{key:"compare",value:function(t,n){var o=t.leftSE.point.x,i=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<o)return 1;if(s<i)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,h=n.rightSE.point.y;if(o<i){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(o>i){if(l<u&&l<h)return-1;if(l>u&&l>h)return 1;var d=n.comparePoint(t.leftSE.point);if(d!==0)return d;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var _=n.comparePoint(t.rightSE.point);if(_!==0)return _}if(s>a){var v=t.comparePoint(n.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(s!==a){var m=p-l,b=s-o,y=h-u,M=a-i;if(m>b&&y<M)return 1;if(m<b&&y>M)return-1}return s>a?1:s<a||p<h?-1:p>h?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,o){Te(this,r),this.id=++cs,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=o}return $e(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,o=this.rightSE.point,i=this.vector();if(n.x===o.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/i.y,a=n.x+s*i.x;if(t.x===a)return 0;var l=(t.x-n.x)/i.x,u=n.y+l*i.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),o=t.bbox(),i=zn(n,o);if(i===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=Lt(n,l)&&this.comparePoint(l)===0,h=Lt(o,s)&&t.comparePoint(s)===0,c=Lt(n,u)&&this.comparePoint(u)===0,f=Lt(o,a)&&t.comparePoint(a)===0;if(h&&p)return f&&!c?a:!f&&c?u:null;if(h)return c&&s.x===u.x&&s.y===u.y?null:s;if(p)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var d=fs(s,this.vector(),l,t.vector());return d===null||!Lt(i,d)?null:qt.round(d.x,d.y)}},{key:"split",value:function(t){var n=[],o=t.events!==void 0,i=new De(t,!0),s=new De(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(i);var l=new r(i,a,this.rings.slice(),this.windings.slice());return De.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),De.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(i.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,o=this.windings.length;n<o;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,o=t;n.consumedBy;)n=n.consumedBy;for(;o.consumedBy;)o=o.consumedBy;var i=r.compare(n,o);if(i!==0){if(i>0){var s=n;n=o,o=s}if(n.prev===o){var a=n;n=o,o=a}for(var l=0,u=o.rings.length;l<u;l++){var p=o.rings[l],h=o.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(h)):n.windings[c]+=h}o.rings=null,o.windings=null,o.consumedBy=n,o.leftSE.consumedBy=n.leftSE,o.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,o=this._afterState.windings,i=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),o.push(u)):o[p]+=u}for(var h=[],c=[],f=0,d=n.length;f<d;f++)if(o[f]!==0){var g=n[f],_=g.poly;if(c.indexOf(_)===-1)if(g.isExterior)h.push(_);else{c.indexOf(_)===-1&&c.push(_);var v=h.indexOf(g.poly);v!==-1&&h.splice(v,1)}}for(var m=0,b=h.length;m<b;m++){var y=h[m].multiPoly;i.indexOf(y)===-1&&i.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Pe.type){case"union":{var o=t.length===0,i=n.length===0;this._isInResult=o!==i;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Pe.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(h){return h.length===1&&h[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Pe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,o){var i,s,a,l=De.comparePoints(t,n);if(l<0)i=t,s=n,a=1;else if(l>0)i=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new De(i,!0),p=new De(s,!1);return new r(u,p,[o],[a])}}]),r}(),Ar=function(){function r(e,t,n){if(Te(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=qt.round(e[0][0],e[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var i=o,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=qt.round(e[s][0],e[s][1]);l.x===i.x&&l.y===i.y||(this.segments.push(_n.fromRing(i,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),i=l)}(o.x!==i.x||o.y!==i.y)&&this.segments.push(_n.fromRing(i,o,this))}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,o=this.segments.length;n<o;n++){var i=this.segments[n];t.push(i.leftSE),t.push(i.rightSE)}return t}}]),r}(),ps=function(){function r(e,t){if(Te(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ar(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,o=e.length;n<o;n++){var i=new Ar(e[n],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,o=this.interiorRings.length;n<o;n++)for(var i=this.interiorRings[n].getSweepEvents(),s=0,a=i.length;s<a;s++)t.push(i[s]);return t}}]),r}(),Tr=function(){function r(e,t){if(Te(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,o=e.length;n<o;n++){var i=new ps(e[n],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,o=this.polys.length;n<o;n++)for(var i=this.polys[n].getSweepEvents(),s=0,a=i.length;s<a;s++)t.push(i[s]);return t}}]),r}(),ds=function(){$e(r,null,[{key:"factory",value:function(t){for(var n=[],o=0,i=t.length;o<i;o++){var s=t[o];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],h=l.point,c=[];a=l,l=u,p.push(l),l.point!==h;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var d=p[0].point,g=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var _=null,v=0,m=c.length;v<m;v++)if(c[v].point===l.point){_=v;break}if(_!==null){var b=c.splice(_)[0],y=p.splice(b.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}c.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Te(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return $e(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],o=1,i=this.events.length-1;o<i;o++){var s=this.events[o].point,a=this.events[o+1].point;Or(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Or(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],d=h;d!=c;d+=p)f.push([n[d].x,n[d].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,o=this.events.length;n<o;n++){var i=this.events[n];De.compare(t,i)>0&&(t=i)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Ir=function(){function r(e){Te(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return $e(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,o=this.interiorRings.length;n<o;n++){var i=this.interiorRings[n].getGeom();i!==null&&t.push(i)}return t}}]),r}(),hs=function(){function r(e){Te(this,r),this.rings=e,this.polys=this._composePolys(e)}return $e(r,[{key:"getGeom",value:function(){for(var t=[],n=0,o=this.polys.length;n<o;n++){var i=this.polys[n].getGeom();i!==null&&t.push(i)}return t}},{key:"_composePolys",value:function(t){for(var n=[],o=0,i=t.length;o<i;o++){var s=t[o];if(!s.poly)if(s.isExteriorRing())n.push(new Ir(s));else{var a=s.enclosingRing();a.poly||n.push(new Ir(a)),a.poly.addInterior(s)}}return n}}]),r}(),ms=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_n.compare;Te(this,r),this.queue=e,this.tree=new sr(t),this.segments=[]}return $e(r,[{key:"process",value:function(t){var n=t.segment,o=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),o;var i=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!i)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=i,a=i,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var h=l.getIntersection(n);if(h!==null&&(n.isAnEndpoint(h)||(p=h),!l.isAnEndpoint(h)))for(var c=this._splitSafely(l,h),f=0,d=c.length;f<d;f++)o.push(c[f])}var g=null;if(u){var _=u.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(g=_),!u.isAnEndpoint(_)))for(var v=this._splitSafely(u,_),m=0,b=v.length;m<b;m++)o.push(v[m])}if(p!==null||g!==null){var y=null;if(p===null)y=g;else if(g===null)y=p;else{var M=De.comparePoints(p,g);y=M<=0?p:g}this.queue.remove(n.rightSE),o.push(n.rightSE);for(var C=n.split(y),I=0,A=C.length;I<A;I++)o.push(C[I])}o.length>0?(this.tree.remove(n),o.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var x=l.getIntersection(u);if(x!==null){if(!l.isAnEndpoint(x))for(var T=this._splitSafely(l,x),j=0,Z=T.length;j<Z;j++)o.push(T[j]);if(!u.isAnEndpoint(x))for(var P=this._splitSafely(u,x),H=0,le=P.length;H<le;H++)o.push(P[H])}}this.tree.remove(n)}return o}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var o=t.rightSE;this.queue.remove(o);var i=t.split(n);return i.push(o),t.consumedBy===void 0&&this.tree.insert(t),i}}]),r}(),Fr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,_s=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,gs=function(){function r(){Te(this,r)}return $e(r,[{key:"run",value:function(t,n,o){Pe.type=t,qt.reset();for(var i=[new Tr(n,!0)],s=0,a=o.length;s<a;s++)i.push(new Tr(o[s],!1));if(Pe.numMultiPolys=i.length,Pe.type==="difference")for(var l=i[0],u=1;u<i.length;)zn(i[u].bbox,l.bbox)!==null?u++:i.splice(u,1);if(Pe.type==="intersection"){for(var p=0,h=i.length;p<h;p++)for(var c=i[p],f=p+1,d=i.length;f<d;f++)if(zn(c.bbox,i[f].bbox)===null)return[]}for(var g=new sr(De.compare),_=0,v=i.length;_<v;_++)for(var m=i[_].getSweepEvents(),b=0,y=m.length;b<y;b++)if(g.insert(m[b]),g.size>Fr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new ms(g),C=g.size,I=g.pop();I;){var A=I.key;if(g.size===C){var x=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(x.id," ")+"[".concat(x.leftSE.point.x,", ").concat(x.leftSE.point.y,"] -> ")+"[".concat(x.rightSE.point.x,", ").concat(x.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Fr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>_s)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var T=M.process(A),j=0,Z=T.length;j<Z;j++){var P=T[j];P.consumedBy===void 0&&g.insert(P)}C=g.size,I=g.pop()}qt.reset();var H=ds.factory(M.segments),le=new hs(H);return le.getGeom()}}]),r}(),Pe=new gs,bs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Pe.run("union",e,n)},vs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Pe.run("intersection",e,n)},ys=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Pe.run("xor",e,n)},ws=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Pe.run("difference",e,n)},nn={union:bs,intersection:vs,xor:ys,difference:ws};function ks(r,e){var t=Es(e),n=null;return r.type==="FeatureCollection"?n=Ss(r):n=Co(nn.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(o){t.geometry.coordinates.push(o[0])}),t}function Ss(r){var e=r.features.length===2?nn.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):nn.union.apply(nn,r.features.map(function(t){return t.geometry.coordinates}));return Co(e)}function Co(r){return ni(r)}function Es(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return ri(t)}function Ms(r,e,t){let n;se(r,Ae,s=>t(1,n=s));let{boundaryGeojson:o}=e;return oi("setCamera")&&n.fitBounds(tr(o),{padding:20,animate:!1}),Ze(n,"boundary",{type:"geojson",data:ks(o)}),we(n,{id:"boundary",source:"boundary",...wn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,o=s.boundaryGeojson)},[o]}class $s extends V{constructor(e){super(),K(this,e,Ms,null,W,{boundaryGeojson:0})}}const he={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Mn=10,Ut=10;function Ls(r,e,t){let n;se(r,Ae,u=>t(2,n=u));let{layer:o}=e,{contents:i}=e,s=new Zt.Popup({closeButton:!1,closeOnClick:!1});n.on("mousemove",a),n.on("mouseout",l),kt(()=>{n.off("mousemove",a),n.off("mouseout",l)});function a(u){let p=n.queryRenderedFeatures(u.point,{layers:[o]});p.length>0?s.setLngLat(u.lngLat).setHTML(i(p[0].properties)).addTo(n):s.remove()}function l(){s.remove()}return r.$$set=u=>{"layer"in u&&t(0,o=u.layer),"contents"in u&&t(1,i=u.contents)},[o,i]}class Os extends V{constructor(e){super(),K(this,e,Ls,null,W,{layer:0,contents:1})}}function Pr(r,e,t){const n=r.slice();return n[4]=e[t],n}function xr(r,e,t){const n=r.slice();return n[7]=e[t],n}function Nr(r){let e;return{c(){e=E("td"),L(e,"class","svelte-11t6rxo"),ue(e,"background-color",r[7])},m(t,n){w(t,e,n)},p(t,n){n&1&&ue(e,"background-color",t[7])},d(t){t&&k(e)}}}function Br(r){let e,t=r[4]+"",n;return{c(){e=E("td"),n=X(t),L(e,"class","svelte-11t6rxo")},m(o,i){w(o,e,i),S(e,n)},p:G,d(o){o&&k(e)}}}function Cs(r){let e,t,n,o,i=r[0],s=[];for(let u=0;u<i.length;u+=1)s[u]=Nr(xr(r,i,u));let a=r[1],l=[];for(let u=0;u<a.length;u+=1)l[u]=Br(Pr(r,a,u));return{c(){e=E("table"),t=E("tr");for(let u=0;u<s.length;u+=1)s[u].c();n=R(),o=E("tr");for(let u=0;u<l.length;u+=1)l[u].c();L(t,"class","svelte-11t6rxo"),L(o,"class","svelte-11t6rxo"),L(e,"class","svelte-11t6rxo")},m(u,p){w(u,e,p),S(e,t);for(let h=0;h<s.length;h+=1)s[h].m(t,null);S(e,n),S(e,o);for(let h=0;h<l.length;h+=1)l[h].m(o,null)},p(u,[p]){if(p&1){i=u[0];let h;for(h=0;h<i.length;h+=1){const c=xr(u,i,h);s[h]?s[h].p(c,p):(s[h]=Nr(c),s[h].c(),s[h].m(t,null))}for(;h<s.length;h+=1)s[h].d(1);s.length=i.length}if(p&2){a=u[1];let h;for(h=0;h<a.length;h+=1){const c=Pr(u,a,h);l[h]?l[h].p(c,p):(l[h]=Br(c),l[h].c(),l[h].m(o,null))}for(;h<l.length;h+=1)l[h].d(1);l.length=a.length}},i:G,o:G,d(u){u&&k(e),un(s,u),un(l,u)}}}function Rs(r,e,t){let{colors:n}=e,{steps:o}=e;if(n.length!=o.length+1)throw new Error("There must be one more color than step");let i=[],s=0;for(let a of o)i.push(`${s}-${a}`),s=a;return i.push(`>${s}`),r.$$set=a=>{"colors"in a&&t(0,n=a.colors),"steps"in a&&t(2,o=a.steps)},[n,i,o]}class As extends V{constructor(e){super(),K(this,e,Rs,Cs,W,{colors:0,steps:2})}}function Dr(r){let e,t;return e=new As({props:{colors:r[1],steps:r[2]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p:G,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ts(r){let e,t,n,o,i,s,a,l,u,p,h,c=r[0]=="speed limits"&&Dr(r);return l=new Os({props:{layer:"speed-limits",contents:Is}}),{c(){e=E("label"),t=X(`Show details:
  `),n=E("select"),o=E("option"),o.textContent="None",i=E("option"),i.textContent="Speed limits",s=R(),c&&c.c(),a=R(),N(l.$$.fragment),o.__value="none",o.value=o.__value,i.__value="speed limits",i.value=i.__value,r[0]===void 0&&St(()=>r[6].call(n))},m(f,d){w(f,e,d),S(e,t),S(e,n),S(n,o),S(n,i),_t(n,r[0]),w(f,s,d),c&&c.m(f,d),w(f,a,d),B(l,f,d),u=!0,p||(h=[U(n,"change",r[6]),U(n,"change",r[3])],p=!0)},p(f,[d]){d&1&&_t(n,f[0]),f[0]=="speed limits"?c?(c.p(f,d),d&1&&$(c,1)):(c=Dr(f),c.c(),$(c,1),c.m(a.parentNode,a)):c&&(ce(),O(c,1,1,()=>{c=null}),pe())},i(f){u||($(c),$(l.$$.fragment,f),u=!0)},o(f){O(c),O(l.$$.fragment,f),u=!1},d(f){f&&k(e),f&&k(s),c&&c.d(f),f&&k(a),D(l,f),p=!1,Oe(h)}}}let Wt="speed-limits";function Is(r){return r.speed_limit?`${Math.round(r.speed_limit)} mph`:"Unknown"}function Fs(r,e,t){let n,o;se(r,Ae,f=>t(7,n=f)),se(r,ne,f=>t(8,o=f));let{routeInfo:i}=e,{id:s}=e,a="none",l=["#00AB4D","#8ECA4D","#F7BB00","#BB0000"],u=[30,40,50];const p=["step",["get","speed_limit"],l[0],u[0],l[1],u[1],l[2],u[2],l[3]];Ze(n,Wt,{type:"geojson",data:Re()}),we(n,{id:"speed-limits",source:Wt,...gt(p,Ut,1)});async function h(){if(a=="none"){n.getSource(Wt).setData(Re());return}let f=o.features.find(d=>d.id==s);try{let d=JSON.parse(await i.speedLimitForRoute(f.properties.waypoints));n.getSource(Wt).setData(d)}catch(d){window.alert(`Couldn't calculate speed limits for route: ${d}`)}}function c(){a=nr(this),t(0,a)}return r.$$set=f=>{"routeInfo"in f&&t(4,i=f.routeInfo),"id"in f&&t(5,s=f.id)},[a,l,u,h,i,s,c]}class Ps extends V{constructor(e){super(),K(this,e,Fs,Ts,W,{routeInfo:4,id:5})}}function jr(r){let e,t=qr(r[5])+"",n,o,i,s,a,l,u,p,h,c;return u=new Ps({props:{routeInfo:r[3],id:r[4]}}),{c(){e=X("Length: "),n=X(t),o=R(),i=E("br"),s=E("button"),s.textContent="Auto-fill details",a=E("br"),l=R(),N(u.$$.fragment),L(s,"type","button")},m(f,d){w(f,e,d),w(f,n,d),w(f,o,d),w(f,i,d),w(f,s,d),w(f,a,d),w(f,l,d),B(u,f,d),p=!0,h||(c=U(s,"click",r[14]),h=!0)},p(f,d){(!p||d&32)&&t!==(t=qr(f[5])+"")&&xe(n,t);const g={};d&8&&(g.routeInfo=f[3]),d&16&&(g.id=f[4]),u.$set(g)},i(f){p||($(u.$$.fragment,f),p=!0)},o(f){O(u.$$.fragment,f),p=!1},d(f){f&&k(e),f&&k(n),f&&k(o),f&&k(i),f&&k(s),f&&k(a),f&&k(l),D(u,f),h=!1,c()}}}function xs(r){let e,t,n,o,i,s,a,l,u,p,h,c,f,d,g,_,v,m,b,y,M,C,I,A,x,T,j,Z,P,H,le,ke,Ie,oe,re,Ne,Le,Q,de,Yt,me=r[5]&&jr(r);return{c(){e=E("label"),t=X("Name:"),n=E("br"),o=R(),i=E("input"),s=R(),a=E("br"),l=R(),u=E("br"),p=R(),h=E("label"),c=E("input"),f=X(`
  Area`),d=R(),g=E("label"),_=E("input"),v=X(`
  Route`),m=R(),b=E("label"),y=E("input"),M=X(`
  Crossing`),C=R(),I=E("label"),A=E("input"),x=X(`
  Other`),T=R(),j=E("br"),Z=R(),P=E("br"),H=R(),le=E("label"),ke=X("Description:"),Ie=E("br"),oe=R(),re=E("textarea"),Ne=R(),me&&me.c(),Le=be(),L(i,"type","text"),ue(i,"width","100%"),L(c,"type","radio"),c.__value="area",c.value=c.__value,r[9][0].push(c),L(_,"type","radio"),_.__value="route",_.value=_.__value,r[9][0].push(_),L(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[9][0].push(y),L(A,"type","radio"),A.__value="other",A.value=A.__value,r[9][0].push(A),ue(re,"width","100%"),L(re,"rows","5"),L(re,"class","svelte-15lna0i")},m(F,ee){w(F,e,ee),S(e,t),S(e,n),S(e,o),S(e,i),Ce(i,r[0]),w(F,s,ee),w(F,a,ee),w(F,l,ee),w(F,u,ee),w(F,p,ee),w(F,h,ee),S(h,c),c.checked=c.__value===r[1],S(h,f),w(F,d,ee),w(F,g,ee),S(g,_),_.checked=_.__value===r[1],S(g,v),w(F,m,ee),w(F,b,ee),S(b,y),y.checked=y.__value===r[1],S(b,M),w(F,C,ee),w(F,I,ee),S(I,A),A.checked=A.__value===r[1],S(I,x),w(F,T,ee),w(F,j,ee),w(F,Z,ee),w(F,P,ee),w(F,H,ee),w(F,le,ee),S(le,ke),S(le,Ie),S(le,oe),S(le,re),Ce(re,r[2]),w(F,Ne,ee),me&&me.m(F,ee),w(F,Le,ee),Q=!0,de||(Yt=[U(i,"input",r[7]),U(c,"change",r[8]),U(_,"change",r[10]),U(y,"change",r[11]),U(A,"change",r[12]),U(re,"input",r[13])],de=!0)},p(F,[ee]){ee&1&&i.value!==F[0]&&Ce(i,F[0]),ee&2&&(c.checked=c.__value===F[1]),ee&2&&(_.checked=_.__value===F[1]),ee&2&&(y.checked=y.__value===F[1]),ee&2&&(A.checked=A.__value===F[1]),ee&4&&Ce(re,F[2]),F[5]?me?(me.p(F,ee),ee&32&&$(me,1)):(me=jr(F),me.c(),$(me,1),me.m(Le.parentNode,Le)):me&&(ce(),O(me,1,1,()=>{me=null}),pe())},i(F){Q||($(me),Q=!0)},o(F){O(me),Q=!1},d(F){F&&k(e),F&&k(s),F&&k(a),F&&k(l),F&&k(u),F&&k(p),F&&k(h),r[9][0].splice(r[9][0].indexOf(c),1),F&&k(d),F&&k(g),r[9][0].splice(r[9][0].indexOf(_),1),F&&k(m),F&&k(b),r[9][0].splice(r[9][0].indexOf(y),1),F&&k(C),F&&k(I),r[9][0].splice(r[9][0].indexOf(A),1),F&&k(T),F&&k(j),F&&k(Z),F&&k(P),F&&k(H),F&&k(le),F&&k(Ne),me&&me.d(F),F&&k(Le),de=!1,Oe(Yt)}}}function qr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Ns(r,e,t){let n;se(r,ne,b=>t(15,n=b));let{routeInfo:o}=e,{id:i}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function p(){let b=n.features.find(y=>y.id==i);try{t(0,s=await o.nameForRoute(b))}catch(y){window.alert(`Couldn't auto-name route: ${y}`)}}const h=[[]];function c(){s=this.value,t(0,s)}function f(){a=this.__value,t(1,a)}function d(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function _(){a=this.__value,t(1,a)}function v(){l=this.value,t(2,l)}const m=()=>p();return r.$$set=b=>{"routeInfo"in b&&t(3,o=b.routeInfo),"id"in b&&t(4,i=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(5,u=b.length_meters)},[s,a,l,o,i,u,p,c,f,h,d,g,_,v,m]}class Bs extends V{constructor(e){super(),K(this,e,Ns,xs,W,{routeInfo:3,id:4,name:0,intervention_type:1,description:2,length_meters:5})}}const Ds="Intervention",js=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],qs={name:Ds,oneOf:js};function Us(r){const e=r-1;return e*e*e+1}function yt(r,{delay:e=0,duration:t=400,easing:n=Us}={}){const o=getComputedStyle(r),i=+o.opacity,s=parseFloat(o.height),a=parseFloat(o.paddingTop),l=parseFloat(o.paddingBottom),u=parseFloat(o.marginTop),p=parseFloat(o.marginBottom),h=parseFloat(o.borderTopWidth),c=parseFloat(o.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*i};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*p}px;border-top-width: ${f*h}px;border-bottom-width: ${f*c}px;`}}function Ro(r){return"members"in r}function Ao(r){return"oneOf"in r}function To(r){return typeof r=="string"}function Io(r){return typeof r=="object"&&"value"in r}function Gs(r){return"type"in r&&r.type=="number"}function Fo(r){return"type"in r&&r.type=="one-liner"}function Po(r){return"type"in r&&r.type=="textbox"}function xo(r){return"type"in r&&r.type=="checkbox"}function Ur(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Gr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Hr(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=X(t),L(e,"class","svelte-1b72l00")},m(o,i){w(o,e,i),S(e,n)},p(o,i){i&2&&t!==(t=o[1].description+"")&&xe(n,t)},d(o){o&&k(e)}}}function Hs(r){let e,t,n;return{c(){e=E("input"),L(e,"type","checkbox")},m(o,i){w(o,e,i),e.checked=r[0],t||(n=U(e,"change",r[14]),t=!0)},p(o,i){i&1&&(e.checked=o[0])},i:G,o:G,d(o){o&&k(e),t=!1,n()}}}function zs(r){let e,t,n;return{c(){e=E("textarea"),ue(e,"width","100%"),L(e,"rows","5"),L(e,"class","svelte-1b72l00")},m(o,i){w(o,e,i),Ce(e,r[0]),t||(n=U(e,"input",r[13]),t=!0)},p(o,i){i&1&&Ce(e,o[0])},i:G,o:G,d(o){o&&k(e),t=!1,n()}}}function Ys(r){let e,t,n;return{c(){e=E("input"),L(e,"type","text"),ue(e,"width","100%")},m(o,i){w(o,e,i),Ce(e,r[0]),t||(n=U(e,"input",r[12]),t=!0)},p(o,i){i&1&&e.value!==o[0]&&Ce(e,o[0])},i:G,o:G,d(o){o&&k(e),t=!1,n()}}}function Js(r){let e,t,n;return{c(){e=E("input"),L(e,"type","number")},m(o,i){w(o,e,i),Ce(e,r[0]),t||(n=U(e,"input",r[11]),t=!0)},p(o,i){i&1&&bo(e.value)!==o[0]&&Ce(e,o[0])},i:G,o:G,d(o){o&&k(e),t=!1,n()}}}function Xs(r){let e,t,n=r[1].oneOf,o=[];for(let s=0;s<n.length;s+=1)o[s]=Yr(Ur(r,n,s));const i=s=>O(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=be()},m(s,a){for(let l=0;l<o.length;l+=1)o[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Ur(s,n,l);o[l]?(o[l].p(u,a),$(o[l],1)):(o[l]=Yr(u),o[l].c(),$(o[l],1),o[l].m(e.parentNode,e))}for(ce(),l=n.length;l<o.length;l+=1)i(l);pe()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)O(o[a]);t=!1},d(s){un(o,s),s&&k(e)}}}function Ws(r){let e,t,n=r[1].members,o=[];for(let s=0;s<n.length;s+=1)o[s]=Jr(Gr(r,n,s));const i=s=>O(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=be()},m(s,a){for(let l=0;l<o.length;l+=1)o[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Gr(s,n,l);o[l]?(o[l].p(u,a),$(o[l],1)):(o[l]=Jr(u),o[l].c(),$(o[l],1),o[l].m(e.parentNode,e))}for(ce(),l=n.length;l<o.length;l+=1)i(l);pe()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)O(o[a]);t=!1},d(s){un(o,s),s&&k(e)}}}function Vs(r){let e,t,n,o,i=r[15].name+"",s,a,l,u,p,h,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&zr(r);return{c(){e=E("label"),t=E("input"),o=R(),s=X(i),a=E("br"),l=R(),f&&f.c(),u=be(),L(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(d,g){w(d,e,g),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),w(d,l,g),f&&f.m(d,g),w(d,u,g),p=!0,h||(c=[U(t,"change",r[9]),U(t,"change",r[4])],h=!0)},p(d,g){(!p||g&2&&n!==(n=d[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===d[2]),(!p||g&2)&&i!==(i=d[15].name+"")&&xe(s,i),d[2]==d[15].name&&typeof d[0]=="object"?f?(f.p(d,g),g&7&&$(f,1)):(f=zr(d),f.c(),$(f,1),f.m(u.parentNode,u)):f&&(ce(),O(f,1,1,()=>{f=null}),pe())},i(d){p||($(f),p=!0)},o(d){O(f),p=!1},d(d){d&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),d&&k(l),f&&f.d(d),d&&k(u),h=!1,Oe(c)}}}function Ks(r){let e,t,n,o,i=r[15].value+"",s,a,l,u,p;function h(d,g){return d[15].description?el:Qs}let c=h(r),f=c(r);return{c(){e=E("label"),t=E("input"),o=R(),s=X(i),a=R(),f.c(),l=R(),L(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(d,g){w(d,e,g),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),f.m(e,null),S(e,l),u||(p=[U(t,"change",r[8]),U(t,"change",r[3])],u=!0)},p(d,g){g&2&&n!==(n=d[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===d[2]),g&2&&i!==(i=d[15].value+"")&&xe(s,i),c===(c=h(d))&&f?f.p(d,g):(f.d(1),f=c(d),f&&(f.c(),f.m(e,l)))},i:G,o:G,d(d){d&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Oe(p)}}}function Zs(r){let e,t,n,o,i=r[15]+"",s,a,l,u,p,h;return{c(){e=E("label"),t=E("input"),o=R(),s=X(i),a=R(),l=E("br"),u=R(),L(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){w(c,e,f),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),S(e,l),S(e,u),p||(h=[U(t,"change",r[6]),U(t,"change",r[3])],p=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&i!==(i=c[15]+"")&&xe(s,i)},i:G,o:G,d(c){c&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,Oe(h)}}}function zr(r){let e,t,n,o,i,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new zt({props:l}),ae.push(()=>Ee(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),N(t.$$.fragment),o=R(),L(e,"class","svelte-1b72l00")},m(u,p){w(u,e,p),B(t,e,null),S(e,o),s=!0},p(u,p){r=u;const h={};p&2&&(h.spec=r[15]),!n&&p&3&&(n=!0,h.value=r[0][r[15].name],Me(()=>n=!1)),t.$set(h)},i(u){s||($(t.$$.fragment,u),St(()=>{i||(i=bt(e,yt,{duration:500},!0)),i.run(1)}),s=!0)},o(u){O(t.$$.fragment,u),i||(i=bt(e,yt,{duration:500},!1)),i.run(0),s=!1},d(u){u&&k(e),D(t),u&&i&&i.end()}}}function Qs(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function el(r){let e,t,n=r[15].description+"",o,i;return{c(){e=E("p"),t=X("("),o=X(n),i=X(")"),L(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,o),S(e,i)},p(s,a){a&2&&n!==(n=s[15].description+"")&&xe(o,n)},d(s){s&&k(e)}}}function Yr(r){let e,t,n,o,i,s;const a=[Zs,Ks,Vs],l=[];function u(p,h){return h&2&&(e=null),h&2&&(t=null),e==null&&(e=!!To(p[15])),e?0:(t==null&&(t=!!Io(p[15])),t?1:2)}return n=u(r,-1),o=l[n]=a[n](r),{c(){o.c(),i=be()},m(p,h){l[n].m(p,h),w(p,i,h),s=!0},p(p,h){let c=n;n=u(p,h),n===c?l[n].p(p,h):(ce(),O(l[c],1,1,()=>{l[c]=null}),pe(),o=l[n],o?o.p(p,h):(o=l[n]=a[n](p),o.c()),$(o,1),o.m(i.parentNode,i))},i(p){s||($(o),s=!0)},o(p){O(o),s=!1},d(p){l[n].d(p),p&&k(i)}}}function Jr(r){let e,t,n=r[15].name+"",o,i,s,a,l,u;function p(c){r[5](c,r[15])}let h={spec:r[15]};return r[0][r[15].name]!==void 0&&(h.value=r[0][r[15].name]),s=new zt({props:h}),ae.push(()=>Ee(s,"value",p,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),o=X(n),i=R(),N(s.$$.fragment),l=R(),L(e,"class","svelte-1b72l00")},m(c,f){w(c,e,f),S(e,t),S(t,o),S(e,i),B(s,e,null),S(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&xe(o,n);const d={};f&2&&(d.spec=r[15]),!a&&f&3&&(a=!0,d.value=r[0][r[15].name],Me(()=>a=!1)),s.$set(d)},i(c){u||($(s.$$.fragment,c),u=!0)},o(c){O(s.$$.fragment,c),u=!1},d(c){c&&k(e),D(s)}}}function tl(r){let e,t,n,o,i,s,a,l,u,p,h,c=r[1].description&&Hr(r);const f=[Ws,Xs,Js,Ys,zs,Hs],d=[];function g(_,v){return v&2&&(t=null),v&2&&(n=null),v&2&&(o=null),v&2&&(i=null),v&2&&(s=null),v&2&&(a=null),t==null&&(t=!!Ro(_[1])),t?0:(n==null&&(n=!!Ao(_[1])),n?1:(o==null&&(o=!!Gs(_[1])),o?2:(i==null&&(i=!!Fo(_[1])),i?3:(s==null&&(s=!!Po(_[1])),s?4:(a==null&&(a=!!xo(_[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=d[l]=f[l](r)),{c(){c&&c.c(),e=R(),u&&u.c(),p=be()},m(_,v){c&&c.m(_,v),w(_,e,v),~l&&d[l].m(_,v),w(_,p,v),h=!0},p(_,[v]){_[1].description?c?c.p(_,v):(c=Hr(_),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let m=l;l=g(_,v),l===m?~l&&d[l].p(_,v):(u&&(ce(),O(d[m],1,1,()=>{d[m]=null}),pe()),~l?(u=d[l],u?u.p(_,v):(u=d[l]=f[l](_),u.c()),$(u,1),u.m(p.parentNode,p)):u=null)},i(_){h||($(u),h=!0)},o(_){O(u),h=!1},d(_){c&&c.d(_),_&&k(e),~l&&d[l].d(_),_&&k(p)}}}function nl(r,e,t){var m,b,y;let{spec:n}=e,{value:o}=e,i="";if(Ro(n)){o||(o={});for(let M of n.members)Fo(M)||Po(M)?o[m=M.name]||(o[m]=""):xo(M)?o[b=M.name]||(o[b]=!1):o[y=M.name]||(o[y]={})}else Ao(n)&&(o||(o={}),To(o)?i=o:Io(o)?i=o.value:i=Object.keys(o)[0]||"");function s(){t(0,o=i)}function a(){t(0,o={}),t(0,o[i]={},o)}const l=[[]];function u(M,C){r.$$.not_equal(o[C.name],M)&&(o[C.name]=M,t(0,o))}function p(){i=this.__value,t(2,i)}function h(){i=this.__value,t(2,i)}function c(){i=this.__value,t(2,i)}function f(M,C){r.$$.not_equal(o[C.name],M)&&(o[C.name]=M,t(0,o))}function d(){o=bo(this.value),t(0,o)}function g(){o=this.value,t(0,o)}function _(){o=this.value,t(0,o)}function v(){o=this.checked,t(0,o)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,o=M.value)},[o,n,i,s,a,u,p,l,h,c,f,d,g,_,v]}class zt extends V{constructor(e){super(),K(this,e,nl,tl,W,{spec:1,value:0})}}function rl(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].v2!==void 0&&(i.value=r[0].v2),e=new zt({props:i}),ae.push(()=>Ee(e,"value",o,r[0].v2)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function ol(r,e,t){let{props:n}=e;n.v2||(n.v2={});let o=qs;function i(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class il extends V{constructor(e){super(),K(this,e,ol,rl,W,{props:0})}}const sl="Planning",ll=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],al={name:sl,members:ll};function ul(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].planning!==void 0&&(i.value=r[0].planning),e=new zt({props:i}),ae.push(()=>Ee(e,"value",o,r[0].planning)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function fl(r,e,t){let{props:n}=e;n.planning||(n.planning={});let o=al;function i(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class cl extends V{constructor(e){super(),K(this,e,fl,ul,W,{props:0})}}const pl="CriticalIssue",dl=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],hl={name:pl,members:dl};function ml(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].criticals!==void 0&&(i.value=r[0].criticals),e=new zt({props:i}),ae.push(()=>Ee(e,"value",o,r[0].criticals)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function _l(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let o=hl;function i(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class gl extends V{constructor(e){super(),K(this,e,_l,ml,W,{props:0})}}function Xr(r){let e,t,n,o,i;const s=r[10].default,a=ct(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),ue(e,"border","solid 1px black"),ue(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,o||(i=U(e,"introend",r[14]),o=!0)},p(l,u){a&&a.p&&(!n||u&512)&&pt(a,s,l,l[9],n?ht(s,l[9],u,null):dt(l[9]),null)},i(l){n||($(a,l),St(()=>{t||(t=bt(e,yt,{duration:100},!0)),t.run(1)}),n=!0)},o(l){O(a,l),t||(t=bt(e,yt,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),o=!1,i()}}}function bl(r){let e,t,n,o,i,s,a,l,u,p,h=r[4]&&Xr(r);return{c(){e=E("button"),t=fn("svg"),n=fn("path"),o=R(),i=X(r[1]),s=R(),h&&h.c(),a=be(),L(n,"d","M9 5l7 7-7 7"),L(t,"style","tran"),L(t,"width","20"),L(t,"height","20"),L(t,"fill","none"),L(t,"stroke-linecap","round"),L(t,"stroke-linejoin","round"),L(t,"stroke-width","2"),L(t,"viewBox","0 0 24 24"),L(t,"stroke","currentColor"),L(t,"class","svelte-t7fpgu"),L(e,"aria-expanded",r[4]),L(e,"class","svelte-t7fpgu"),gr(e,"underlined",r[3])},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,o),S(e,i),w(c,s,f),h&&h.m(c,f),w(c,a,f),l=!0,u||(p=[U(e,"click",r[5]),U(e,"mouseenter",r[11]),U(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&xe(i,c[1]),(!l||f&16)&&L(e,"aria-expanded",c[4]),(!l||f&8)&&gr(e,"underlined",c[3]),c[4]?h?(h.p(c,f),f&16&&$(h,1)):(h=Xr(c),h.c(),$(h,1),h.m(a.parentNode,a)):h&&(ce(),O(h,1,1,()=>{h=null}),pe())},i(c){l||($(h),l=!0)},o(c){O(h),l=!1},d(c){c&&k(e),c&&k(s),h&&h.d(c),c&&k(a),u=!1,Oe(p)}}}function vl(r,e,t){let n,o,i,s;se(r,je,m=>t(7,i=m)),se(r,Se,m=>t(8,s=m));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const h=()=>{Se.update(m=>m==u?null:u),s==u&&(jt.set(null),jt.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const d=()=>Dt.set(u),g=()=>Dt.set(null);function _(m){ae[m?"unshift":"push"](()=>{c=m,t(2,c)})}const v=()=>f();return r.$$set=m=>{"id"in m&&t(0,u=m.id),"label"in m&&t(1,p=m.label),"$$scope"in m&&t(9,l=m.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,o=i==u)},[u,p,c,o,n,h,f,i,s,l,a,d,g,_,v]}class yl extends V{constructor(e){super(),K(this,e,vl,bl,W,{id:0,label:1})}}function Wr(r,e,t){const n=r.slice();return n[14]=e[t],n[15]=e,n[16]=t,n}function wl(r){let e,t,n;function o(s){r[10](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new gl({props:i}),ae.push(()=>Ee(e,"props",o,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function kl(r){let e,t,n;function o(s){r[9](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new cl({props:i}),ae.push(()=>Ee(e,"props",o,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Sl(r){let e,t,n;function o(s){r[8](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new il({props:i}),ae.push(()=>Ee(e,"props",o,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function El(r){let e,t,n,o,i;function s(p){r[5](p,r[14])}function a(p){r[6](p,r[14])}function l(p){r[7](p,r[14])}let u={routeInfo:r[1],id:r[14].id,length_meters:r[14].properties.length_meters};return r[14].properties.name!==void 0&&(u.name=r[14].properties.name),r[14].properties.intervention_type!==void 0&&(u.intervention_type=r[14].properties.intervention_type),r[14].properties.description!==void 0&&(u.description=r[14].properties.description),e=new Bs({props:u}),ae.push(()=>Ee(e,"name",s,r[14].properties.name)),ae.push(()=>Ee(e,"intervention_type",a,r[14].properties.intervention_type)),ae.push(()=>Ee(e,"description",l,r[14].properties.description)),{c(){N(e.$$.fragment)},m(p,h){B(e,p,h),i=!0},p(p,h){r=p;const c={};h&2&&(c.routeInfo=r[1]),h&4&&(c.id=r[14].id),h&4&&(c.length_meters=r[14].properties.length_meters),!t&&h&4&&(t=!0,c.name=r[14].properties.name,Me(()=>t=!1)),!n&&h&4&&(n=!0,c.intervention_type=r[14].properties.intervention_type,Me(()=>n=!1)),!o&&h&4&&(o=!0,c.description=r[14].properties.description,Me(()=>o=!1)),e.$set(c)},i(p){i||($(e.$$.fragment,p),i=!0)},o(p){O(e.$$.fragment,p),i=!1},d(p){D(e,p)}}}function Ml(r){let e,t,n,o,i,s,a,l,u,p,h,c,f,d,g;const _=[El,Sl,kl,wl],v=[];function m(y,M){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:y[0]=="criticals"?3:-1}~(e=m(r))&&(t=v[e]=_[e](r));function b(){return r[11](r[14])}return{c(){t&&t.c(),n=R(),o=E("br"),i=R(),s=E("br"),a=R(),l=E("div"),u=E("button"),u.textContent="Delete",p=R(),h=E("button"),h.textContent="Save",c=R(),L(u,"type","button"),L(h,"type","button"),ue(l,"display","flex"),ue(l,"justify-content","space-between")},m(y,M){~e&&v[e].m(y,M),w(y,n,M),w(y,o,M),w(y,i,M),w(y,s,M),w(y,a,M),w(y,l,M),S(l,u),S(l,p),S(l,h),w(y,c,M),f=!0,d||(g=[U(u,"click",b),U(h,"click",r[12])],d=!0)},p(y,M){r=y;let C=e;e=m(r),e===C?~e&&v[e].p(r,M):(t&&(ce(),O(v[C],1,1,()=>{v[C]=null}),pe()),~e?(t=v[e],t?t.p(r,M):(t=v[e]=_[e](r),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(y){f||($(t),f=!0)},o(y){O(t),f=!1},d(y){~e&&v[e].d(y),y&&k(n),y&&k(o),y&&k(i),y&&k(s),y&&k(a),y&&k(l),y&&k(c),d=!1,Oe(g)}}}function Vr(r,e){let t,n,o;return n=new yl({props:{id:e[14].id,label:e[16]+1+") "+e[3](e[14]),$$slots:{default:[Ml]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=be(),N(n.$$.fragment),this.first=t},m(i,s){w(i,t,s),B(n,i,s),o=!0},p(i,s){e=i;const a={};s&4&&(a.id=e[14].id),s&4&&(a.label=e[16]+1+") "+e[3](e[14])),s&131079&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(i){o||($(n.$$.fragment,i),o=!0)},o(i){O(n.$$.fragment,i),o=!1},d(i){i&&k(t),D(n,i)}}}function $l(r){let e=[],t=new Map,n,o,i,s,a=r[2].features;const l=u=>u[14].id;for(let u=0;u<a.length;u+=1){let p=Wr(r,a,u),h=l(p);t.set(h,e[u]=Vr(h,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=be()},m(u,p){for(let h=0;h<e.length;h+=1)e[h].m(u,p);w(u,n,p),o=!0,i||(s=U(window,"keydown",r[4]),i=!0)},p(u,[p]){p&15&&(a=u[2].features,ce(),e=ii(e,p,l,1,u,a,t,n.parentNode,si,Vr,n,Wr),pe())},i(u){if(!o){for(let p=0;p<a.length;p+=1)$(e[p]);o=!0}},o(u){for(let p=0;p<e.length;p+=1)O(e[p]);o=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&k(n),i=!1,s()}}}function Ll(r,e,t){let n,o;se(r,Se,v=>t(13,n=v)),se(r,ne,v=>t(2,o=v));let{schema:i}=e,{routeInfo:s}=e;function a(v){var b,y,M,C,I;if(i=="planning")return((b=v.properties.planning)==null?void 0:b.name)||"Untitled polygon";if(i=="v2")return((M=(y=v.properties.v2)==null?void 0:y.Route)==null?void 0:M.name)||((I=(C=v.properties.v2)==null?void 0:C.Crossing)==null?void 0:I.name)||"Untitled intervention";if(v.properties.name)return v.properties.name;var m=v.properties.intervention_type;return m=="other"&&(v.geometry.type=="Point"?m="point":v.geometry.type=="LineString"?m="line":m="polygon"),`Untitled ${m}`}function l(v){if(v.key=="Delete"){const m=v.target.tagName;if(m=="INPUT"||m=="TEXTAREA")return;v.preventDefault();const b=n;b&&yr(b)}}function u(v,m){r.$$.not_equal(m.properties.name,v)&&(m.properties.name=v,ne.set(o))}function p(v,m){r.$$.not_equal(m.properties.intervention_type,v)&&(m.properties.intervention_type=v,ne.set(o))}function h(v,m){r.$$.not_equal(m.properties.description,v)&&(m.properties.description=v,ne.set(o))}function c(v,m){r.$$.not_equal(m.properties,v)&&(m.properties=v,ne.set(o))}function f(v,m){r.$$.not_equal(m.properties,v)&&(m.properties=v,ne.set(o))}function d(v,m){r.$$.not_equal(m.properties,v)&&(m.properties=v,ne.set(o))}const g=v=>yr(v.id),_=()=>Se.set(null);return r.$$set=v=>{"schema"in v&&t(0,i=v.schema),"routeInfo"in v&&t(1,s=v.routeInfo)},[i,s,o,a,l,u,p,h,c,f,d,g,_]}class Ol extends V{constructor(e){super(),K(this,e,Ll,$l,W,{schema:0,routeInfo:1})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function qe(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Jn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ye(r,e,t){t===void 0&&(t={});var n=Ve(r),o=Ve(e),i=Fe(o[1]-n[1]),s=Fe(o[0]-n[0]),a=Fe(n[1]),l=Fe(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return li(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function rn(r,e){return e===void 0&&(e={}),ai(r,function(t,n){var o=n.geometry.coordinates;return t+Ye(o[0],o[1],e)},0)}function Cl(r){let e,t,n,o,i,s,a,l,u,p,h,c,f,d,g,_,v,m,b,y=r[0].features.length+"",M,C,I,A,x,T,j,Z;return{c(){e=E("div"),t=E("label"),n=X(`Scheme name:
    `),o=E("input"),i=R(),s=E("br"),a=R(),l=E("div"),u=E("label"),p=E("input"),h=R(),c=E("button"),c.textContent="Load from GeoJSON",f=R(),d=E("button"),d.textContent="Export to GeoJSON",g=R(),_=E("br"),v=R(),m=E("div"),b=E("span"),M=X(y),C=X(" interventions"),I=R(),A=E("button"),x=X("Clear all"),L(o,"type","text"),L(p,"type","file"),L(p,"id","load_geojson"),L(p,"class","svelte-lhyd1e"),L(c,"type","button"),L(d,"type","button"),L(d,"class","align-right svelte-lhyd1e"),L(A,"type","button"),L(A,"class","align-right svelte-lhyd1e"),A.disabled=T=r[0].features.length==0},m(P,H){w(P,e,H),S(e,t),S(t,n),S(t,o),Ce(o,r[0].scheme_name),w(P,i,H),w(P,s,H),w(P,a,H),w(P,l,H),S(l,u),S(u,p),S(u,h),S(u,c),S(l,f),S(l,d),w(P,g,H),w(P,_,H),w(P,v,H),w(P,m,H),S(m,b),S(b,M),S(b,C),S(m,I),S(m,A),S(A,x),j||(Z=[U(o,"input",r[7]),U(p,"change",r[3]),U(c,"click",Al),U(d,"click",r[2]),U(A,"click",r[1])],j=!0)},p(P,[H]){H&1&&o.value!==P[0].scheme_name&&Ce(o,P[0].scheme_name),H&1&&y!==(y=P[0].features.length+"")&&xe(M,y),H&1&&T!==(T=P[0].features.length==0)&&(A.disabled=T)},i:G,o:G,d(P){P&&k(e),P&&k(i),P&&k(s),P&&k(a),P&&k(l),P&&k(g),P&&k(_),P&&k(v),P&&k(m),j=!1,Oe(Z)}}}function Rl(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Al(){document.getElementById("load_geojson").click()}function Tl(r,e,t){let n;se(r,ne,d=>t(0,n=d));let{authorityName:o}=e,{schema:i}=e,s=o;i!="v1"&&(s+=`_${i}`);let a=window.localStorage.getItem(s);if(a)try{ne.set(c(JSON.parse(a)))}catch(d){console.log(`Failed to load from local storage: ${d}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(ne.update(d=>(delete d.scheme_name,d.features=[],d)),Se.set(null),je.set(null),Dt.set(null),jt.set(null))}function u(){const d=JSON.parse(JSON.stringify(n));for(let g of d.features)delete g.properties.hide_while_editing;return d}function p(){let d=u();var g=s;d.authority=o,d.origin="atip-v1",d.scheme_name&&(g+="_"+d.scheme_name),g+=".txt",Rl(g,JSON.stringify(d,null,"  "))}function h(d){const g=new FileReader;g.onload=v=>{try{ne.set(c(JSON.parse(v.target.result)))}catch(m){window.alert(`Couldn't load scheme from a file: ${m}`)}};let _=d.target.files;g.readAsText(_[0])}function c(d){let g=1;for(let _ of d.features)_.properties||(_.properties={name:"",description:"",intervention_type:"other"}),_.geometry.type=="LineString"&&!_.properties.length_meters&&(_.properties.length_meters=rn(_,{units:"kilometers"})*1e3),_.id=g++;return d}function f(){n.scheme_name=this.value,ne.set(n)}return r.$$set=d=>{"authorityName"in d&&t(4,o=d.authorityName),"schema"in d&&t(5,i=d.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,p,h,o,i,s,f]}class Il extends V{constructor(e){super(),K(this,e,Tl,Cl,W,{authorityName:4,schema:5})}}const Fl="/atip/speed_limit/assets/zoom_out_map-b2e1091a.svg";function Pl(r){let e,t,n,o,i;return{c(){e=E("button"),t=E("img"),xn(t.src,n=Fl)||L(t,"src",n),L(t,"alt","Zoom to show entire boundary"),L(e,"type","button"),L(e,"title","Zoom to show entire boundary"),L(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),o||(i=U(e,"click",r[0]),o=!0)},p:G,i:G,o:G,d(s){s&&k(e),o=!1,i()}}}function xl(r,e,t){let n;se(r,Ae,s=>t(2,n=s));let{boundaryGeojson:o}=e;function i(){n.fitBounds(tr(o),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,o=s.boundaryGeojson)},[i,o]}class Nl extends V{constructor(e){super(),K(this,e,xl,Pl,W,{boundaryGeojson:1})}}function Bl(r){let e,t,n,o,i,s,a;return{c(){e=E("div"),t=X(`Basemap:
  `),n=E("select"),o=E("option"),o.textContent="Streets",i=E("option"),i.textContent="Satellite",o.__value="streets",o.value=o.__value,i.__value="hybrid",i.value=i.__value,r[0]===void 0&&St(()=>r[2].call(n)),L(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,o),S(n,i),_t(n,r[0]),s||(a=[U(n,"change",r[2]),U(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&_t(n,l[0])},i:G,o:G,d(l){l&&k(e),s=!1,Oe(a)}}}function Dl(r,e,t){let{style:n}=e;function o(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function i(){n=nr(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,o,i]}class jl extends V{constructor(e){super(),K(this,e,Dl,Bl,W,{style:0})}}function Kr(r){let e,t,n;const o=r[3].default,i=ct(o,r,r[2],null);return{c(){e=E("div"),i&&i.c()},m(s,a){w(s,e,a),i&&i.m(e,null),n=!0},p(s,a){i&&i.p&&(!n||a&4)&&pt(i,o,s,s[2],n?ht(o,s[2],a,null):dt(s[2]),null)},i(s){n||($(i,s),St(()=>{t||(t=bt(e,yt,{duration:100},!0)),t.run(1)}),n=!0)},o(s){O(i,s),t||(t=bt(e,yt,{duration:100},!1)),t.run(0),n=!1},d(s){s&&k(e),i&&i.d(s),s&&t&&t.end()}}}function ql(r){let e,t,n,o,i,s,a,l,u,p,h=r[0]&&Kr(r);return{c(){e=E("button"),t=fn("svg"),n=fn("path"),o=R(),i=X(r[1]),s=R(),h&&h.c(),a=be(),L(n,"d","M9 5l7 7-7 7"),L(t,"style","tran"),L(t,"width","20"),L(t,"height","20"),L(t,"fill","none"),L(t,"stroke-linecap","round"),L(t,"stroke-linejoin","round"),L(t,"stroke-width","2"),L(t,"viewBox","0 0 24 24"),L(t,"stroke","currentColor"),L(t,"class","svelte-una9lq"),L(e,"aria-expanded",r[0]),L(e,"class","svelte-una9lq")},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,o),S(e,i),w(c,s,f),h&&h.m(c,f),w(c,a,f),l=!0,u||(p=U(e,"click",r[4]),u=!0)},p(c,[f]){(!l||f&2)&&xe(i,c[1]),(!l||f&1)&&L(e,"aria-expanded",c[0]),c[0]?h?(h.p(c,f),f&1&&$(h,1)):(h=Kr(c),h.c(),$(h,1),h.m(a.parentNode,a)):h&&(ce(),O(h,1,1,()=>{h=null}),pe())},i(c){l||($(h),l=!0)},o(c){O(h),l=!1},d(c){c&&k(e),c&&k(s),h&&h.d(c),c&&k(a),u=!1,p()}}}function Ul(r,e,t){let{$$slots:n={},$$scope:o}=e,{label:i}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,i=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,o=l.$$scope)},[s,i,o,n,a]}class $n extends V{constructor(e){super(),K(this,e,Ul,ql,W,{label:1,open:0})}}function Gl(r){let e,t,n,o,i,s,a,l,u,p,h,c,f,d,g;return{c(){e=E("li"),t=E("span"),n=X("Areas"),o=R(),i=E("li"),s=E("span"),a=X("Routes"),l=R(),u=E("li"),p=E("span"),h=X("Crossings"),c=R(),f=E("li"),d=E("span"),g=X("Other"),L(t,"class","svelte-l42ea0"),ue(t,"background",he.area),L(s,"class","svelte-l42ea0"),ue(s,"background",he.route),L(p,"class","svelte-l42ea0"),ue(p,"background",he.crossing),L(d,"class","svelte-l42ea0"),ue(d,"background",he.other)},m(_,v){w(_,e,v),S(e,t),S(e,n),w(_,o,v),w(_,i,v),S(i,s),S(i,a),w(_,l,v),w(_,u,v),S(u,p),S(u,h),w(_,c,v),w(_,f,v),S(f,d),S(f,g)},p:G,d(_){_&&k(e),_&&k(o),_&&k(i),_&&k(l),_&&k(u),_&&k(c),_&&k(f)}}}function Hl(r){let e,t,n,o,i,s,a,l,u,p,h,c,f,d,g;return{c(){e=E("li"),t=E("span"),n=X("Preapp"),o=R(),i=E("li"),s=E("span"),a=X("Outline"),l=R(),u=E("li"),p=E("span"),h=X("Reserved matters"),c=R(),f=E("li"),d=E("span"),g=X("Local plan"),L(t,"class","svelte-l42ea0"),ue(t,"background",he.preapp),L(s,"class","svelte-l42ea0"),ue(s,"background",he.outline),L(p,"class","svelte-l42ea0"),ue(p,"background",he["reserved matters"]),L(d,"class","svelte-l42ea0"),ue(d,"background",he["local plan"])},m(_,v){w(_,e,v),S(e,t),S(e,n),w(_,o,v),w(_,i,v),S(i,s),S(i,a),w(_,l,v),w(_,u,v),S(u,p),S(u,h),w(_,c,v),w(_,f,v),S(f,d),S(f,g)},p:G,d(_){_&&k(e),_&&k(o),_&&k(i),_&&k(l),_&&k(u),_&&k(c),_&&k(f)}}}function zl(r){let e;function t(i,s){return i[0]=="planning"?Hl:Gl}let n=t(r),o=n(r);return{c(){e=E("ul"),o.c()},m(i,s){w(i,e,s),o.m(e,null)},p(i,s){n===(n=t(i))&&o?o.p(i,s):(o.d(1),o=n(i),o&&(o.c(),o.m(e,null)))},d(i){i&&k(e),o.d()}}}function Yl(r){let e,t,n;return t=new $n({props:{label:"Interventions",open:!0,$$slots:{default:[zl]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),L(e,"class","svelte-l42ea0")},m(o,i){w(o,e,i),B(t,e,null),n=!0},p(o,[i]){const s={};i&3&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||($(t.$$.fragment,o),n=!0)},o(o){O(t.$$.fragment,o),n=!1},d(o){o&&k(e),D(t)}}}function Jl(r,e,t){let{schema:n}=e;return r.$$set=o=>{"schema"in o&&t(0,n=o.schema)},[n]}class Xl extends V{constructor(e){super(),K(this,e,Jl,Yl,W,{schema:0})}}let rt="interventions";function Wl(r,e,t){let n,o;se(r,Ae,p=>t(1,n=p)),se(r,ne,p=>t(2,o=p));let{schema:i}=e;Ze(n,rt,{type:"geojson",data:o});const s=["match",["get","intervention_type"],"area",he.area,"route",he.route,"crossing",he.crossing,"other",he.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",he.preapp,"outline",he.outline,"reserved matters",he["reserved matters"],"local plan",he["local plan"],"white"],l=["!=","hide_while_editing",!0];return we(n,{id:"interventions-points",source:rt,filter:["all",kn,l,["!=","endpoint",!0]],...Et(s,Mn)}),we(n,{id:"interventions-lines",source:rt,filter:["all",Sn,l],...gt(s,Ut)}),we(n,{id:"interventions-lines-endpoints",source:rt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Ut,"circle-opacity":0,"circle-stroke-color":he.lineEndpointColor,"circle-stroke-width":2}}),we(n,{id:"interventions-polygons",source:rt,filter:["all",En,l],...wn(i=="planning"?a:s,.5)}),r.$$set=p=>{"schema"in p&&t(0,i=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(o)),h=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])h.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(h),n.getSource(rt).setData(p)}},[i,n,o]}class Vl extends V{constructor(e){super(),K(this,e,Wl,null,W,{schema:0})}}let ot="hover";function Kl(r,e,t){let n,o,i,s,a;return se(r,Ae,l=>t(0,n=l)),se(r,ne,l=>t(1,o=l)),se(r,Dt,l=>t(2,i=l)),se(r,je,l=>t(3,s=l)),se(r,Se,l=>t(4,a=l)),Ze(n,ot,{type:"geojson",data:Re()}),we(n,{id:"hover-polygons",source:ot,filter:En,...gt(he.hovering,.5*Ut,1)}),we(n,{id:"hover-lines",source:ot,filter:Sn,...gt(he.hovering,1.5*Ut,1)}),we(n,{id:"hover-points",source:ot,filter:kn,...Et(he.hovering,1.5*Mn,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||i;l!=null?n.getSource(ot).setData(o.features.find(u=>u.id==l)):n.getSource(ot).setData(Re())}},[n,o,i,s,a]}class Zl extends V{constructor(e){super(),K(this,e,Kl,null,W,{})}}class lr{constructor(e,t){ie(this,"owner");ie(this,"map");ie(this,"mapHandlers",{});ie(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Vt="edit-point-mode";class Ql{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"cursor");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new lr(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Ze(e,Vt,{type:"geojson",data:Re()}),we(e,{id:"edit-point-mode",source:Vt,...Et(he.hovering,Mn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=ea(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Vt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Re();this.cursor&&e.features.push(this.cursor),this.map.getSource(Vt).setData(e)}}function ea(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function No(r,e,t){if(t===void 0&&(t={}),t.final===!0)return ta(r,e);var n=Ve(r),o=Ve(e),i=Fe(n[0]),s=Fe(o[0]),a=Fe(n[1]),l=Fe(o[1]),u=Math.sin(s-i)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-i);return Nn(Math.atan2(u,p))}function ta(r,e){var t=No(e,r);return t=(t+180)%360,t}function Zr(r,e,t,n){n===void 0&&(n={});var o=Ve(r),i=Fe(o[0]),s=Fe(o[1]),a=Fe(t),l=ui(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=i+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),h=Nn(p),c=Nn(u);return mt([h,c],n.properties)}function Xn(r){if(!r)throw new Error("geojson is required");var e=[];return rr(r,function(t){na(t,e)}),We(e)}function na(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=qe(n);break;case"LineString":t=[qe(n)]}t.forEach(function(o){var i=ra(o,r.properties);i.forEach(function(s){s.id=e.length,e.push(s)})})}}function ra(r,e){var t=[];return r.reduce(function(n,o){var i=vt([n,o],e);return i.bbox=oa(n,o),t.push(i),o}),t}function oa(r,e){var t=r[0],n=r[1],o=e[0],i=e[1],s=t<o?t:o,a=n<i?n:i,l=t>o?t:o,u=n>i?n:i;return[s,a,l,u]}var wt={},ia={get exports(){return wt},set exports(r){wt=r}},Wn={},sa={get exports(){return Wn},set exports(r){Wn=r}};(function(r,e){(function(t,n){r.exports=n()})(fi,function(){function t(m,b,y,M,C){(function I(A,x,T,j,Z){for(;j>T;){if(j-T>600){var P=j-T+1,H=x-T+1,le=Math.log(P),ke=.5*Math.exp(2*le/3),Ie=.5*Math.sqrt(le*ke*(P-ke)/P)*(H-P/2<0?-1:1),oe=Math.max(T,Math.floor(x-H*ke/P+Ie)),re=Math.min(j,Math.floor(x+(P-H)*ke/P+Ie));I(A,x,oe,re,Z)}var Ne=A[x],Le=T,Q=j;for(n(A,T,x),Z(A[j],Ne)>0&&n(A,T,j);Le<Q;){for(n(A,Le,Q),Le++,Q--;Z(A[Le],Ne)<0;)Le++;for(;Z(A[Q],Ne)>0;)Q--}Z(A[T],Ne)===0?n(A,T,Q):n(A,++Q,j),Q<=x&&(T=Q+1),x<=Q&&(j=Q-1)}})(m,b,y||0,M||m.length-1,C||o)}function n(m,b,y){var M=m[b];m[b]=m[y],m[y]=M}function o(m,b){return m<b?-1:m>b?1:0}var i=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(m,b,y){if(!y)return b.indexOf(m);for(var M=0;M<b.length;M++)if(y(m,b[M]))return M;return-1}function a(m,b){l(m,0,m.children.length,b,m)}function l(m,b,y,M,C){C||(C=_(null)),C.minX=1/0,C.minY=1/0,C.maxX=-1/0,C.maxY=-1/0;for(var I=b;I<y;I++){var A=m.children[I];u(C,m.leaf?M(A):A)}return C}function u(m,b){return m.minX=Math.min(m.minX,b.minX),m.minY=Math.min(m.minY,b.minY),m.maxX=Math.max(m.maxX,b.maxX),m.maxY=Math.max(m.maxY,b.maxY),m}function p(m,b){return m.minX-b.minX}function h(m,b){return m.minY-b.minY}function c(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function f(m){return m.maxX-m.minX+(m.maxY-m.minY)}function d(m,b){return m.minX<=b.minX&&m.minY<=b.minY&&b.maxX<=m.maxX&&b.maxY<=m.maxY}function g(m,b){return b.minX<=m.maxX&&b.minY<=m.maxY&&b.maxX>=m.minX&&b.maxY>=m.minY}function _(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(m,b,y,M,C){for(var I=[b,y];I.length;)if(!((y=I.pop())-(b=I.pop())<=M)){var A=b+Math.ceil((y-b)/M/2)*M;t(m,A,b,y,C),I.push(b,A,A,y)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(m){var b=this.data,y=[];if(!g(m,b))return y;for(var M=this.toBBox,C=[];b;){for(var I=0;I<b.children.length;I++){var A=b.children[I],x=b.leaf?M(A):A;g(m,x)&&(b.leaf?y.push(A):d(m,x)?this._all(A,y):C.push(A))}b=C.pop()}return y},i.prototype.collides=function(m){var b=this.data;if(!g(m,b))return!1;for(var y=[];b;){for(var M=0;M<b.children.length;M++){var C=b.children[M],I=b.leaf?this.toBBox(C):C;if(g(m,I)){if(b.leaf||d(m,I))return!0;y.push(C)}}b=y.pop()}return!1},i.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var b=0;b<m.length;b++)this.insert(m[b]);return this}var y=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},i.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},i.prototype.clear=function(){return this.data=_([]),this},i.prototype.remove=function(m,b){if(!m)return this;for(var y,M,C,I=this.data,A=this.toBBox(m),x=[],T=[];I||x.length;){if(I||(I=x.pop(),M=x[x.length-1],y=T.pop(),C=!0),I.leaf){var j=s(m,I.children,b);if(j!==-1)return I.children.splice(j,1),x.push(I),this._condense(x),this}C||I.leaf||!d(I,A)?M?(y++,I=M.children[y],C=!1):I=null:(x.push(I),T.push(y),y=0,M=I,I=I.children[0])}return this},i.prototype.toBBox=function(m){return m},i.prototype.compareMinX=function(m,b){return m.minX-b.minX},i.prototype.compareMinY=function(m,b){return m.minY-b.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(m){return this.data=m,this},i.prototype._all=function(m,b){for(var y=[];m;)m.leaf?b.push.apply(b,m.children):y.push.apply(y,m.children),m=y.pop();return b},i.prototype._build=function(m,b,y,M){var C,I=y-b+1,A=this._maxEntries;if(I<=A)return a(C=_(m.slice(b,y+1)),this.toBBox),C;M||(M=Math.ceil(Math.log(I)/Math.log(A)),A=Math.ceil(I/Math.pow(A,M-1))),(C=_([])).leaf=!1,C.height=M;var x=Math.ceil(I/A),T=x*Math.ceil(Math.sqrt(A));v(m,b,y,T,this.compareMinX);for(var j=b;j<=y;j+=T){var Z=Math.min(j+T-1,y);v(m,j,Z,x,this.compareMinY);for(var P=j;P<=Z;P+=x){var H=Math.min(P+x-1,Z);C.children.push(this._build(m,P,H,M-1))}}return a(C,this.toBBox),C},i.prototype._chooseSubtree=function(m,b,y,M){for(;M.push(b),!b.leaf&&M.length-1!==y;){for(var C=1/0,I=1/0,A=void 0,x=0;x<b.children.length;x++){var T=b.children[x],j=c(T),Z=(P=m,H=T,(Math.max(H.maxX,P.maxX)-Math.min(H.minX,P.minX))*(Math.max(H.maxY,P.maxY)-Math.min(H.minY,P.minY))-j);Z<I?(I=Z,C=j<C?j:C,A=T):Z===I&&j<C&&(C=j,A=T)}b=A||b.children[0]}var P,H;return b},i.prototype._insert=function(m,b,y){var M=y?m:this.toBBox(m),C=[],I=this._chooseSubtree(M,this.data,b,C);for(I.children.push(m),u(I,M);b>=0&&C[b].children.length>this._maxEntries;)this._split(C,b),b--;this._adjustParentBBoxes(M,C,b)},i.prototype._split=function(m,b){var y=m[b],M=y.children.length,C=this._minEntries;this._chooseSplitAxis(y,C,M);var I=this._chooseSplitIndex(y,C,M),A=_(y.children.splice(I,y.children.length-I));A.height=y.height,A.leaf=y.leaf,a(y,this.toBBox),a(A,this.toBBox),b?m[b-1].children.push(A):this._splitRoot(y,A)},i.prototype._splitRoot=function(m,b){this.data=_([m,b]),this.data.height=m.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(m,b,y){for(var M,C,I,A,x,T,j,Z=1/0,P=1/0,H=b;H<=y-b;H++){var le=l(m,0,H,this.toBBox),ke=l(m,H,y,this.toBBox),Ie=(C=le,I=ke,A=void 0,x=void 0,T=void 0,j=void 0,A=Math.max(C.minX,I.minX),x=Math.max(C.minY,I.minY),T=Math.min(C.maxX,I.maxX),j=Math.min(C.maxY,I.maxY),Math.max(0,T-A)*Math.max(0,j-x)),oe=c(le)+c(ke);Ie<Z?(Z=Ie,M=H,P=oe<P?oe:P):Ie===Z&&oe<P&&(P=oe,M=H)}return M||y-b},i.prototype._chooseSplitAxis=function(m,b,y){var M=m.leaf?this.compareMinX:p,C=m.leaf?this.compareMinY:h;this._allDistMargin(m,b,y,M)<this._allDistMargin(m,b,y,C)&&m.children.sort(M)},i.prototype._allDistMargin=function(m,b,y,M){m.children.sort(M);for(var C=this.toBBox,I=l(m,0,b,C),A=l(m,y-b,y,C),x=f(I)+f(A),T=b;T<y-b;T++){var j=m.children[T];u(I,m.leaf?C(j):j),x+=f(I)}for(var Z=y-b-1;Z>=b;Z--){var P=m.children[Z];u(A,m.leaf?C(P):P),x+=f(A)}return x},i.prototype._adjustParentBBoxes=function(m,b,y){for(var M=y;M>=0;M--)u(b[M],m)},i.prototype._condense=function(m){for(var b=m.length-1,y=void 0;b>=0;b--)m[b].children.length===0?b>0?(y=m[b-1].children).splice(y.indexOf(m[b]),1):this.clear():a(m[b],this.toBBox)},i})})(sa);const la=or(ci),aa=or(pi),ua=or(di);var Be=Wn,Bo=la,Do=aa,it=ua.default,fa=Do.featureEach;Do.coordEach;Bo.polygon;var Qr=Bo.featureCollection;function jo(r){var e=new Be(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:it(t),Be.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:it(o),n.push(o)}):fa(t,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:it(o),n.push(o)}),Be.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:it(t),Be.prototype.remove.call(this,t,n)},e.clear=function(){return Be.prototype.clear.call(this)},e.search=function(t){var n=Be.prototype.search.call(this,this.toBBox(t));return Qr(n)},e.collides=function(t){return Be.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Be.prototype.all.call(this);return Qr(t)},e.toJSON=function(){return Be.prototype.toJSON.call(this)},e.fromJSON=function(t){return Be.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=it(t);else if(t.type==="FeatureCollection")n=it(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}ia.exports=jo;wt.default=jo;function qo(r,e){var t={},n=[];if(r.type==="LineString"&&(r=br(r)),e.type==="LineString"&&(e=br(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=eo(r,e);return o&&n.push(o),We(n)}var i=wt();return i.load(Xn(e)),cn(Xn(r),function(s){cn(i.search(s),function(a){var l=eo(s,a);if(l){var u=qe(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function eo(r,e){var t=qe(r),n=qe(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=t[0][0],i=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],h=n[1][1],c=(h-u)*(s-o)-(p-l)*(a-i),f=(p-l)*(i-u)-(h-u)*(o-l),d=(s-o)*(i-u)-(a-i)*(o-l);if(c===0)return f===0&&d===0,null;var g=f/c,_=d/c;if(g>=0&&g<=1&&_>=0&&_<=1){var v=o+g*(s-o),m=i+g*(a-i);return mt([v,m])}return null}function Gt(r,e,t){t===void 0&&(t={});var n=mt([1/0,1/0],{dist:1/0}),o=0;return rr(r,function(i){for(var s=qe(i),a=0;a<s.length-1;a++){var l=mt(s[a]);l.properties.dist=Ye(e,l,t);var u=mt(s[a+1]);u.properties.dist=Ye(e,u,t);var p=Ye(l,u,t),h=Math.max(l.properties.dist,u.properties.dist),c=No(l,u),f=Zr(e,h,c+90,t),d=Zr(e,h,c-90,t),g=qo(vt([f.geometry.coordinates,d.geometry.coordinates]),vt([l.geometry.coordinates,u.geometry.coordinates])),_=null;g.features.length>0&&(_=g.features[0],_.properties.dist=Ye(e,_,t),_.properties.location=o+Ye(l,_,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=o),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=o+p),_&&_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a),o+=p}}),n}const st="edit-polygon-mode";class ca{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"points");ie(this,"cursor");ie(this,"hover");ie(this,"dragFrom");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new lr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Ze(e,st,{type:"geojson",data:Re()}),we(e,{id:"edit-polygon-fill",source:st,filter:En,...wn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),we(e,{id:"edit-polygon-lines",source:st,filter:Sn,...gt("black",8,.5)}),we(e,{id:"edit-polygon-vertices",source:st,filter:kn,...Et(he.hovering,Mn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let o of this.points)o[0]-=t,o[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(no(this.points).forEach((n,o)=>{t.push([o+1,Gt(n,this.cursor).properties.dist])}),t.sort((n,o)=>n[1]-o[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(st),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Re();this.points.forEach((n,o)=>{let i=to(n);i.properties.hover=this.hover==o,i.properties.idx=o,e.features.push(i)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(no(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(st).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=to(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function to(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function no(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let J;const He=new Array(32).fill(void 0);He.push(void 0,null,!0,!1);function Y(r){return He[r]}let xt=He.length;function pa(r){r<36||(He[r]=xt,xt=r)}function Vn(r){const e=Y(r);return pa(r),e}const Uo=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Uo.decode();let on=new Uint8Array;function Nt(){return on.byteLength===0&&(on=new Uint8Array(J.memory.buffer)),on}function ut(r,e){return Uo.decode(Nt().subarray(r,r+e))}function ve(r){xt===He.length&&He.push(He.length+1);const e=xt;return xt=He[e],He[e]=r,e}function Tn(r){return r==null}let sn=new Float64Array;function da(){return sn.byteLength===0&&(sn=new Float64Array(J.memory.buffer)),sn}let ln=new Int32Array;function ye(){return ln.byteLength===0&&(ln=new Int32Array(J.memory.buffer)),ln}let Xe=0;const an=new TextEncoder("utf-8"),ha=typeof an.encodeInto=="function"?function(r,e){return an.encodeInto(r,e)}:function(r,e){const t=an.encode(r);return e.set(t),{read:r.length,written:t.length}};function Kt(r,e,t){if(t===void 0){const a=an.encode(r),l=e(a.length);return Nt().subarray(l,l+a.length).set(a),Xe=a.length,l}let n=r.length,o=e(n);const i=Nt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;i[o+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),o=t(o,n,n=s+r.length*3);const a=Nt().subarray(o+s,o+n),l=ha(r,a);s+=l.written}return Xe=s,o}function Kn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let i="[";o>0&&(i+=Kn(r[0]));for(let s=1;s<o;s++)i+=", "+Kn(r[s]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function ma(r,e){const t=e(r.length*1);return Nt().set(r,t/1),Xe=r.length,t}function In(r,e){try{return r.apply(this,e)}catch(t){J.__wbindgen_exn_store(ve(t))}}class gn{static __wrap(e){const t=Object.create(gn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();J.__wbg_jsroutesnapper_free(e)}constructor(e){try{const i=J.__wbindgen_add_to_stack_pointer(-16),s=ma(e,J.__wbindgen_malloc),a=Xe;J.jsroutesnapper_new(i,s,a);var t=ye()[i/4+0],n=ye()[i/4+1],o=ye()[i/4+2];if(o)throw Vn(n);return gn.__wrap(t)}finally{J.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){J.jsroutesnapper_setConfig(this.ptr,ve(e))}toFinalFeature(){try{const n=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];let o;return e!==0&&(o=ut(e,t).slice(),J.__wbindgen_free(e,t*1)),o}finally{J.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_renderGeojson(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];return ut(e,t)}finally{J.__wbindgen_add_to_stack_pointer(16),J.__wbindgen_free(e,t)}}setSnapMode(e){J.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return J.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){J.jsroutesnapper_onClick(this.ptr)}onDragStart(){return J.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return J.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){J.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const o=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_editExisting(o,this.ptr,ve(e));var t=ye()[o/4+0],n=ye()[o/4+1];if(n)throw Vn(t)}finally{J.__wbindgen_add_to_stack_pointer(16)}}}async function _a(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function ga(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Vn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=Y(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ut(e,t));return ve(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=ut(e,t);return ve(n)},r.wbg.__wbindgen_is_object=function(e){const t=Y(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Y(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Y(e)in Y(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=Y(t),o=typeof n=="number"?n:void 0;da()[e/8+1]=Tn(o)?0:o,ye()[e/4+0]=!Tn(o)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Y(e)==Y(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Y(t),o=typeof n=="string"?n:void 0;var i=Tn(o)?0:Kt(o,J.__wbindgen_malloc,J.__wbindgen_realloc),s=Xe;ye()[e/4+1]=s,ye()[e/4+0]=i},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(Y(t)),o=Kt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),i=Xe;ye()[e/4+1]=i,ye()[e/4+0]=o},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Y(e);return ve(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=Y(e)[Y(t)];return ve(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(Y(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(Y(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(Y(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(Y(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(Y(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=Y(e)[t>>>0];return ve(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return Y(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Y(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=Y(e).next;return ve(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return In(function(e){const t=Y(e).next();return ve(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return Y(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=Y(e).value;return ve(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ve(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return In(function(e,t){const n=Reflect.get(Y(e),Y(t));return ve(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return In(function(e,t){const n=Y(e).call(Y(t));return ve(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(Y(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=Y(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=Y(e).buffer;return ve(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(Y(e));return ve(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){Y(e).set(Y(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return Y(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=Y(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ve(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Y(t).stack,o=Kt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),i=Xe;ye()[e/4+1]=i,ye()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(ut(e,t))}finally{J.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=Kn(Y(t)),o=Kt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),i=Xe;ye()[e/4+1]=i,ye()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ut(e,t))},r.wbg.__wbindgen_memory=function(){const e=J.memory;return ve(e)},r}function ba(r,e){return J=r.exports,Go.__wbindgen_wasm_module=e,sn=new Float64Array,ln=new Int32Array,on=new Uint8Array,J}async function Go(r){typeof r>"u"&&(r="/atip/speed_limit/assets/route_snapper_bg.wasm");const e=ga();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await _a(await r,e);return ba(t,n)}const Ot="route-snapper",ro=10,va=30;class ya{constructor(e,t){ie(this,"map");ie(this,"inner");ie(this,"active");ie(this,"eventListenersSuccessRoute");ie(this,"eventListenersSuccessArea");ie(this,"eventListenersFailure");ie(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new gn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Ze(e,Ot,{type:"geojson",data:Re()}),we(e,{id:"route-points",source:Ot,filter:kn,...Et(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",ro/2,ro])}),we(e,{id:"route-lines",source:Ot,filter:Sn,...gt("black",2.5)}),we(e,{id:"route-polygons",source:Ot,filter:En,...wn("black",.5)}),this.events=new lr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-va,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Ot).setData(JSON.parse(this.inner.renderGeojson()))}}function wa(r){let e,t,n,o,i,s,a,l;return{c(){e=E("button"),t=E("img"),o=R(),i=X(r[2]),xn(t.src,n=r[3])||L(t,"src",n),L(t,"alt",r[2]),L(t,"class","svelte-1vvpkg9"),L(e,"type","button"),e.disabled=s=r[0]==r[1],L(e,"class","svelte-1vvpkg9")},m(u,p){w(u,e,p),S(e,t),S(e,o),S(e,i),a||(l=U(e,"click",r[5]),a=!0)},p(u,[p]){p&8&&!xn(t.src,n=u[3])&&L(t,"src",n),p&4&&L(t,"alt",u[2]),p&4&&xe(i,u[2]),p&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:G,o:G,d(u){u&&k(e),a=!1,l()}}}function ka(r,e,t){let{mode:n}=e,{thisMode:o}=e,{label:i}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(o);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,o=u.thisMode),"label"in u&&t(2,i=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,o,i,s,a,l]}class et extends V{constructor(e){super(),K(this,e,ka,wa,W,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function oo(r){let e;function t(i,s){return i[1]?Ea:Sa}let n=t(r),o=n(r);return{c(){o.c(),e=be()},m(i,s){o.m(i,s),w(i,e,s)},p(i,s){n!==(n=t(i))&&(o.d(1),o=n(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){o.d(i),i&&k(e)}}}function Sa(r){let e;return{c(){e=E("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ea(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ma(r){let e,t=r[0]==ft&&oo(r);return{c(){t&&t.c(),e=be()},m(n,o){t&&t.m(n,o),w(n,e,o)},p(n,[o]){n[0]==ft?t?t.p(n,o):(t=oo(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&k(e)}}}const ft="edit-attribute";function Ho(){}function $a(r,e,t){let n,o,i,s;se(r,Ae,f=>t(5,n=f)),se(r,ne,f=>t(6,o=f)),se(r,jt,f=>t(7,i=f)),se(r,Se,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){Se.set(null)}n.on("mousemove",p),n.on("mouseout",h),n.on("click",c),kt(()=>{n.off("mousemove",p),n.off("mouseout",h),n.off("click",c)});function p(f){var d;if(a==ft){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});je.set(((d=g[0])==null?void 0:d.id)||null)}}function h(){a==ft&&je.set(null)}function c(f){if(a==ft){let d=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});d.length>0?Se.set(d[0].id):Se.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=i;if(f){let d=o.features.find(g=>g.id==f);d.geometry.type=="Point"?n.flyTo({center:d.geometry.coordinates,duration:500}):n.fitBounds(tr(d),{padding:200,duration:500}),l(ft)}}},[a,s,l,Ho,u,n,o,i]}class La extends V{constructor(e){super(),K(this,e,$a,Ma,W,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Ho}get stop(){return this.$$.ctx[4]}}function Oa(r){let e,t;return{c:G,m(n,o){e||(t=U(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function Ca(r,e,t){let{tool:n}=e;function o(i){i.key=="Escape"&&(n.cancel(),i.preventDefault())}return r.$$set=i=>{"tool"in i&&t(1,n=i.tool)},[o,n]}class Ln extends V{constructor(e){super(),K(this,e,Ca,Oa,W,{tool:1})}}function Ra(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Aa(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ta(r){let e,t,n,o,i,s,a,l,u,p;function h(d,g){return d[1]?Aa:Ra}let c=h(r),f=c(r);return a=new Ln({props:{tool:r[0]}}),{c(){e=E("ul"),f.c(),t=R(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",o=R(),i=E("button"),i.textContent="Cancel",s=R(),N(a.$$.fragment),L(i,"type","button")},m(d,g){w(d,e,g),f.m(e,null),S(e,t),S(e,n),w(d,o,g),w(d,i,g),w(d,s,g),B(a,d,g),l=!0,u||(p=U(i,"click",r[2]),u=!0)},p(d,[g]){c!==(c=h(d))&&(f.d(1),f=c(d),f&&(f.c(),f.m(e,t)));const _={};g&1&&(_.tool=d[0]),a.$set(_)},i(d){l||($(a.$$.fragment,d),l=!0)},o(d){O(a.$$.fragment,d),l=!1},d(d){d&&k(e),f.d(),d&&k(o),d&&k(i),d&&k(s),D(a,d),u=!1,p()}}}function Ia(r,e,t){let{pointTool:n}=e,{editingExisting:o}=e;const i=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,o=s.editingExisting)},[n,o,i]}class zo extends V{constructor(e){super(),K(this,e,Ia,Ta,W,{pointTool:0,editingExisting:1})}}function Fa(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Pa(r){let e,t,n,o,i,s,a,l,u,p,h;return e=new $n({props:{label:"Help",$$slots:{default:[Fa]},$$scope:{ctx:r}}}),l=new Ln({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=R(),n=E("div"),o=E("button"),o.textContent="Finish",i=R(),s=E("button"),s.textContent="Cancel",a=R(),N(l.$$.fragment),L(o,"type","button"),L(s,"type","button"),ue(n,"display","flex"),ue(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,o),S(n,i),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(h=[U(o,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const d={};f&8&&(d.$$scope={dirty:f,ctx:c}),e.$set(d);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){O(e.$$.fragment,c),O(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Oe(h)}}}function xa(r,e,t){let{polygonTool:n}=e;const o=()=>n.finish(),i=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,o,i]}class Yo extends V{constructor(e){super(),K(this,e,xa,Pa,W,{polygonTool:0})}}function Na(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Ba(r){let e,t,n,o,i,s,a,l,u,p,h;return e=new $n({props:{label:"Help",$$slots:{default:[Na]},$$scope:{ctx:r}}}),l=new Ln({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=R(),n=E("div"),o=E("button"),o.textContent="Finish",i=R(),s=E("button"),s.textContent="Cancel",a=R(),N(l.$$.fragment),L(o,"type","button"),L(s,"type","button"),ue(n,"display","flex"),ue(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,o),S(n,i),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(h=[U(o,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const d={};f&8&&(d.$$scope={dirty:f,ctx:c}),e.$set(d);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){O(e.$$.fragment,c),O(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Oe(h)}}}function Da(r,e,t){let{routeTool:n}=e;const o=()=>n.finish(),i=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,o,i]}class Jo extends V{constructor(e){super(),K(this,e,Da,Ba,W,{routeTool:0})}}function ja(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function qa(r){let e,t,n,o,i,s,a,l,u,p,h,c,f,d,g;return e=new $n({props:{label:"Help",$$slots:{default:[ja]},$$scope:{ctx:r}}}),c=new Ln({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=R(),n=E("label"),o=E("input"),i=X(`
  Avoid doubling back`),s=R(),a=E("div"),l=E("button"),l.textContent="Finish",u=R(),p=E("button"),p.textContent="Cancel",h=R(),N(c.$$.fragment),L(o,"type","checkbox"),L(l,"type","button"),L(p,"type","button"),ue(a,"display","flex"),ue(a,"justify-content","space-between")},m(_,v){B(e,_,v),w(_,t,v),w(_,n,v),S(n,o),o.checked=r[1],S(n,i),w(_,s,v),w(_,a,v),S(a,l),S(a,u),S(a,p),w(_,h,v),B(c,_,v),f=!0,d||(g=[U(o,"change",r[2]),U(l,"click",r[3]),U(p,"click",r[4])],d=!0)},p(_,[v]){const m={};v&32&&(m.$$scope={dirty:v,ctx:_}),e.$set(m),v&2&&(o.checked=_[1]);const b={};v&1&&(b.tool=_[0]),c.$set(b)},i(_){f||($(e.$$.fragment,_),$(c.$$.fragment,_),f=!0)},o(_){O(e.$$.fragment,_),O(c.$$.fragment,_),f=!1},d(_){D(e,_),_&&k(t),_&&k(n),_&&k(s),_&&k(a),_&&k(h),D(c,_),d=!1,Oe(g)}}}function Ua(r,e,t){let{routeTool:n}=e,o=!1;function i(){o=this.checked,t(1,o)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:o})},[n,o,i,s,a]}class Xo extends V{constructor(e){super(),K(this,e,Ua,qa,W,{routeTool:0})}}function io(r){let e,t,n,o;const i=[Ja,Ya,za,Ha,Ga],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=i[e](r),{c(){t.c(),n=be()},m(l,u){s[e].m(l,u),w(l,n,u),o=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(ce(),O(s[p],1,1,()=>{s[p]=null}),pe(),t=s[e],t?t.p(l,u):(t=s[e]=i[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){o||($(t),o=!0)},o(l){O(t),o=!1},d(l){s[e].d(l),l&&k(n)}}}function Ga(r){let e;return{c(){e=E("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){w(t,e,n)},p:G,i:G,o:G,d(t){t&&k(e)}}}function Ha(r){let e,t;return e=new Xo({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.routeTool=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function za(r){let e,t;return e=new Jo({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.routeTool=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ya(r){let e,t;return e=new Yo({props:{polygonTool:r[2]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&4&&(i.polygonTool=n[2]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ja(r){let e,t;return e=new zo({props:{pointTool:r[1],editingExisting:!0}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.pointTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Xa(r){let e,t,n=r[0]==Ue&&io(r);return{c(){n&&n.c(),e=be()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==Ue?n?(n.p(o,i),i&1&&$(n,1)):(n=io(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ce(),O(n,1,1,()=>{n=null}),pe())},i(o){t||($(n),t=!0)},o(o){O(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const Ue="edit-geometry";function Wo(){}function Wa(r,e,t){let n;se(r,Ae,g=>t(8,n=g));let{mode:o}=e,{pointTool:i}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(i.stop(),s.stop(),a.stop(),ne.update(g=>{let _=g.features.find(v=>v.id==l);return delete _.properties.hide_while_editing,g})),l=null,t(4,u=null),je.set(null)}n.on("mousemove",h),n.on("mouseout",c),n.on("click",f),kt(()=>{n.off("mousemove",h),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(g=>{o==Ue&&(ne.update(_=>{let v=_.features.find(m=>m.id==l);return v.properties.length_meters=g.properties.length_meters,v.properties.waypoints=g.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=g.geometry,_}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{o==Ue&&(ne.update(_=>{let v=_.features.find(m=>m.id==l);return v.properties.waypoints=g.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=g.geometry,_}),l=null,t(4,u=null))});for(let g of[i,s])g.addEventListenerSuccess(_=>{o==Ue&&(ne.update(v=>{let m=v.features.find(b=>b.id==l);return m.geometry=_.geometry,delete m.properties.hide_while_editing,v}),l=null,t(4,u=null))});for(let g of[i,s,a])g.addEventListenerFailure(()=>{o==Ue&&(ne.update(_=>{let v=_.features.find(m=>m.id==l);return delete v.properties.hide_while_editing,_}),l=null,t(4,u=null))});function h(g){var _;if(o==Ue&&l==null){let v=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});je.set(((_=v[0])==null?void 0:_.id)||null)}}function c(){o==Ue&&l==null&&je.set(null)}function f(g){if(o==Ue&&l==null){let _=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0&&d(_[0].id)}}function d(g){je.set(null);let _=null;ne.update(m=>(_=m.features.find(b=>b.id==g),_.properties.hide_while_editing=!0,m));let v=_;l=g,v.geometry.type=="LineString"?(a.editExistingRoute(v),t(4,u="route")):v.geometry.type=="Polygon"?v.properties.waypoints?(a.editExistingArea(v),t(4,u="snap-polygon")):(s.editExisting(v),t(4,u="free-polygon")):v.geometry.type=="Point"&&(i.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"pointTool"in g&&t(1,i=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[o,i,s,a,u,Wo,p]}class Va extends V{constructor(e){super(),K(this,e,Wa,Xa,W,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Wo}get stop(){return this.$$.ctx[6]}}async function Ka(r,e){const t=await fetch(r),n=t.body.getReader(),o=t.headers.get("Content-Length");let i=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),i+=p.length;const h=100*i/o;e.style=`background: linear-gradient(to right, red ${h}%, transparent 0);`}let a=new Uint8Array(i),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function Za(r){let e,t;return e=new Xo({props:{routeTool:r[0]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&1&&(i.routeTool=n[0]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Qa(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&k(e),r[7](null)}}}function eu(r){let e,t,n,o;const i=[Qa,Za],s=[];function a(l,u){return l[0]?l[1]==Zn?1:-1:0}return~(e=a(r))&&(t=s[e]=i[e](r)),{c(){t&&t.c(),n=be()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),o=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(ce(),O(s[p],1,1,()=>{s[p]=null}),pe()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=i[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){o||($(t),o=!0)},o(l){O(t),o=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const Zn="route";function tu(r,e,t){let n;se(r,Ae,c=>t(8,n=c));let{mode:o}=e,{changeMode:i}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}er(async()=>{await Go(),console.log(`Grabbing ${s}`);try{const c=await Ka(s,a);t(0,l=new ya(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{o==Zn&&i("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{o==Zn&&(ne.update(f=>(c.id=Ht(f),c.properties.intervention_type="route",f.features.push(c),f)),i("edit-attribute"),Se.set(c.id))})});function h(c){ae[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,o=c.mode),"changeMode"in c&&t(3,i=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,o,a,i,s,u,p,h]}class nu extends V{constructor(e){super(),K(this,e,tu,eu,W,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function so(r){let e,t;return e=new zo({props:{pointTool:r[1],editingExisting:!1}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.pointTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ru(r){let e,t,n=r[0]==bn&&so(r);return{c(){n&&n.c(),e=be()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==bn?n?(n.p(o,i),i&1&&$(n,1)):(n=so(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ce(),O(n,1,1,()=>{n=null}),pe())},i(o){t||($(n),t=!0)},o(o){O(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const bn="point";function ou(r,e,t){let{mode:n}=e,{changeMode:o}=e,{pointTool:i}=e;function s(){i.start()}function a(){i.stop()}return i.addEventListenerSuccess(l=>{n==bn&&(ne.update(u=>(l.id=Ht(u),l.properties.intervention_type="other",u.features.push(l),u)),o("edit-attribute"),Se.set(l.id))}),i.addEventListenerFailure(()=>{n==bn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"pointTool"in l&&t(1,i=l.pointTool)},[n,i,o,s,a]}class iu extends V{constructor(e){super(),K(this,e,ou,ru,W,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function lo(r){let e,t;return e=new Yo({props:{polygonTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.polygonTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function su(r){let e,t,n=r[0]==vn&&lo(r);return{c(){n&&n.c(),e=be()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==vn?n?(n.p(o,i),i&1&&$(n,1)):(n=lo(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ce(),O(n,1,1,()=>{n=null}),pe())},i(o){t||($(n),t=!0)},o(o){O(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const vn="free-polygon";function lu(r,e,t){let{mode:n}=e,{changeMode:o}=e,{polygonTool:i}=e;function s(){i.startNew()}function a(){i.stop()}return i.addEventListenerSuccess(l=>{n==vn&&(ne.update(u=>(l.id=Ht(u),l.properties.intervention_type="area",u.features.push(l),u)),o("edit-attribute"),Se.set(l.id))}),i.addEventListenerFailure(()=>{n==vn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"polygonTool"in l&&t(1,i=l.polygonTool)},[n,i,o,s,a]}class au extends V{constructor(e){super(),K(this,e,lu,su,W,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ao(r){let e,t;return e=new Jo({props:{routeTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.routeTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function uu(r){let e,t,n=r[0]==yn&&ao(r);return{c(){n&&n.c(),e=be()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==yn?n?(n.p(o,i),i&1&&$(n,1)):(n=ao(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ce(),O(n,1,1,()=>{n=null}),pe())},i(o){t||($(n),t=!0)},o(o){O(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const yn="snap-polygon";function fu(r,e,t){let{mode:n}=e,{changeMode:o}=e,{routeTool:i}=e;function s(){i.startArea()}function a(){i.stop()}return i.addEventListenerSuccessArea(l=>{n==yn&&(ne.update(u=>(l.id=Ht(u),l.properties.intervention_type="area",u.features.push(l),u)),o("edit-attribute"),Se.set(l.id))}),i.addEventListenerFailure(()=>{n==yn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"routeTool"in l&&t(1,i=l.routeTool)},[n,i,o,s,a]}class cu extends V{constructor(e){super(),K(this,e,fu,uu,W,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function pu(r){var e=r[0],t=r[1],n=r[2],o=r[3],i=Ye(r.slice(0,2),[n,t]),s=Ye(r.slice(0,2),[e,o]);if(i>=s){var a=(t+o)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(o-t)/2,t,l+(o-t)/2,o]}}function du(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,o=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(o===!1||o===void 0)&&(r=JSON.parse(JSON.stringify(r)));var i=Math.pow(10,t);return hi(r,function(s){hu(s,i,n)}),r}function hu(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function mu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Jn(r),n=Jn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var o=du(e,{precision:7});switch(n){case"Point":return Qn(r,o);case"MultiPoint":return uo(r,o);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return uo(r,qo(r,o))}}function uo(r,e){var t=[],n=wt();return rr(e,function(o){if(t.forEach(function(a,l){a.id=l}),!t.length)t=Qn(r,o).features,t.forEach(function(a){a.bbox||(a.bbox=pu(mi(a)))}),n.load(We(t));else{var i=n.search(o);if(i.features.length){var s=Vo(o,i);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),cn(Qn(s,o),function(a){t.push(a),n.insert(a)})}}}),We(t)}function Qn(r,e){var t=[],n=qe(r)[0],o=qe(r)[r.geometry.coordinates.length-1];if(Fn(n,Ve(e))||Fn(o,Ve(e)))return We([r]);var i=wt(),s=Xn(r);i.load(s);var a=i.search(e);if(!a.features.length)return We([r]);var l=Vo(e,a),u=[n],p=_i(s,function(h,c,f){var d=qe(c)[1],g=Ve(e);return f===l.id?(h.push(g),t.push(vt(h)),Fn(g,d)?[g]:[g,d]):(h.push(d),h)},u);return p.length>1&&t.push(vt(p)),We(t)}function Vo(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return cn(e,function(o){var i=Gt(o,r),s=i.properties.dist;s<n&&(t=o,n=s)}),t}function Fn(r,e){return r[0]===e[0]&&r[1]===e[1]}function _u(r,e,t){var n=qe(t);if(Jn(t)!=="LineString")throw new Error("line must be a LineString");var o=Gt(t,r),i=Gt(t,e),s;o.properties.index<=i.properties.index?s=[o,i]:s=[i,o];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),vt(a,t.properties)}function fo(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function gu(r){let e,t,n,o=r[0]==Bt&&fo();return{c(){o&&o.c(),e=be()},m(i,s){o&&o.m(i,s),w(i,e,s),t||(n=U(window,"keydown",r[1]),t=!0)},p(i,[s]){i[0]==Bt?o||(o=fo(),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null)},i:G,o:G,d(i){o&&o.d(i),i&&k(e),t=!1,n()}}}const Bt="split-route",bu=10,vu=30;let Pn="split-route";function Ko(){}function co(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function yu(r,e,t){let n,o;se(r,ne,g=>t(8,n=g)),se(r,Ae,g=>t(6,o=g));let{mode:i}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;o.on("mousemove",p),o.on("click",h),kt(()=>{o.off("mousemove",p),o.off("click",h)}),Ze(o,Pn,{type:"geojson",data:Re()}),we(o,{id:"draw-split-route",source:Pn,...Et("black",bu,["case",["==",["get","snapped"],!0],1,.5])});function p(g){if(i!=Bt)return;t(5,l=co(g.lngLat.toArray(),!1)),u=null;const _=[g.point.x-vu,g.point.y],v=o.unproject(g.point).distanceTo(o.unproject(_))/1e3;let m=[];for(let[b,y]of n.features.entries())if(y.geometry.type=="LineString"){let M=Gt(y.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=v&&m.push([b,M.geometry.coordinates,M.properties.dist])}m.sort((b,y)=>b[2]-y[2]),m.length>0&&(t(5,l=co(m[0][1],!0)),u=m[0][0])}function h(){if(i==Bt)if(u==null)s("edit-attribute");else{let g=mu(n.features[u],l);if(g.features.length==2){let _=g.features[0],v=g.features[1];ne.update(m=>(_.id=m.features[u].id,v.id=Ht(m),_.properties=JSON.parse(JSON.stringify(m.features[u].properties)),v.properties=JSON.parse(JSON.stringify(_.properties)),c(m.features[u],_,v,l),m.features.splice(u,1,_,v),m))}a()}}function c(g,_,v,m){_.properties.length_meters=rn(_,{units:"kilometers"})*1e3,v.properties.length_meters=rn(v,{units:"kilometers"})*1e3,_.properties.waypoints=[],v.properties.waypoints=[];let b=f(g,m),y=!0,M=0;for(let C of g.properties.waypoints){let I=f(g,mt([C.lon,C.lat]));if(y)if(I<b)_.properties.waypoints.push(C);else{let A=C.snapped&&g.properties.waypoints[M-1].snapped;_.properties.waypoints.push({lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1],snapped:A}),y=!1,v.properties.waypoints.push({lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1],snapped:A}),v.properties.waypoints.push(C)}else v.properties.waypoints.push(C);M++}}function f(g,_){let v=g.geometry.coordinates[0],m=_u(v,_,g);return rn(m,{units:"kilometers"})*1e3}function d(g){i==Bt&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=Re();l&&g.features.push(l),o.getSource(Pn).setData(g)}},[i,d,s,Ko,a,l,o]}class wu extends V{constructor(e){super(),K(this,e,yu,gu,W,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Ko}get stop(){return this.$$.ctx[4]}}const ku="/atip/speed_limit/assets/edit_attributes-29b396e1.svg",Su="/atip/speed_limit/assets/edit_geometry-02dad294.svg",Eu="/atip/speed_limit/assets/point-276f4055.svg",Mu="/atip/speed_limit/assets/polygon_snapped-18efbbea.svg",$u="/atip/speed_limit/assets/polygon_freehand-cf965967.svg",Lu="/atip/speed_limit/assets/route-d3c0ebad.svg",Ou="/atip/speed_limit/assets/split_route-9e0ea2da.svg";function po(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new Va({props:n}),r[15](e),{c(){N(e.$$.fragment)},m(o,i){B(e,o,i),t=!0},p(o,i){const s={};i&8&&(s.mode=o[3]),i&4&&(s.routeTool=o[2]),e.$set(s)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){O(e.$$.fragment,o),t=!1},d(o){r[15](null),D(e,o)}}}function ho(r){let e,t;return e=new et({props:{mode:r[3],thisMode:"point",label:"New point",icon:Eu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function mo(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new cu({props:n}),r[18](e),{c(){N(e.$$.fragment)},m(o,i){B(e,o,i),t=!0},p(o,i){const s={};i&8&&(s.mode=o[3]),i&4&&(s.routeTool=o[2]),e.$set(s)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){O(e.$$.fragment,o),t=!1},d(o){r[18](null),D(e,o)}}}function _o(r){let e,t;return e=new et({props:{mode:r[3],thisMode:"route",label:"New route",icon:Lu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function go(r){let e,t;return e=new et({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:Ou,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Cu(r){let e,t,n,o,i,s,a,l,u,p,h,c,f,d,g,_,v,m,b,y,M,C,I,A,x,T,j,Z,P,H,le,ke;n=new et({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:ku,changeMode:r[13]}});let Ie={mode:r[3],changeMode:r[13]};i=new La({props:Ie}),r[14](i),l=new et({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:Su,changeMode:r[13]}});let oe=r[2]&&po(r),re=r[1]!="planning"&&ho(r),Ne={mode:r[3],changeMode:r[13],pointTool:r[11]};f=new iu({props:Ne}),r[16](f),_=new et({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:$u,changeMode:r[13]}});let Le={mode:r[3],changeMode:r[13],polygonTool:r[12]};m=new au({props:Le}),r[17](m),M=new et({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:Mu,changeMode:r[13]}});let Q=r[2]&&mo(r),de=r[1]!="planning"&&_o(r);function Yt(q){r[20](q)}let me={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(me.routeTool=r[2]),T=new nu({props:me}),r[19](T),ae.push(()=>Ee(T,"routeTool",Yt,r[2]));let F=r[1]!="planning"&&go(r),ee={mode:r[3],changeMode:r[13]};return le=new wu({props:ee}),r[21](le),{c(){e=E("div"),t=E("div"),N(n.$$.fragment),o=R(),N(i.$$.fragment),s=R(),a=E("div"),N(l.$$.fragment),u=R(),oe&&oe.c(),p=R(),h=E("div"),re&&re.c(),c=R(),N(f.$$.fragment),d=R(),g=E("div"),N(_.$$.fragment),v=R(),N(m.$$.fragment),b=R(),y=E("div"),N(M.$$.fragment),C=R(),Q&&Q.c(),I=R(),A=E("div"),de&&de.c(),x=R(),N(T.$$.fragment),Z=R(),P=E("div"),F&&F.c(),H=R(),N(le.$$.fragment),L(e,"class","toolbox svelte-4s4d3o")},m(q,fe){w(q,e,fe),S(e,t),B(n,t,null),S(t,o),B(i,t,null),S(e,s),S(e,a),B(l,a,null),S(a,u),oe&&oe.m(a,null),S(e,p),S(e,h),re&&re.m(h,null),S(h,c),B(f,h,null),S(e,d),S(e,g),B(_,g,null),S(g,v),B(m,g,null),S(e,b),S(e,y),B(M,y,null),S(y,C),Q&&Q.m(y,null),S(e,I),S(e,A),de&&de.m(A,null),S(A,x),B(T,A,null),S(e,Z),S(e,P),F&&F.m(P,null),S(P,H),B(le,P,null),ke=!0},p(q,[fe]){const ar={};fe&8&&(ar.mode=q[3]),n.$set(ar);const ur={};fe&8&&(ur.mode=q[3]),i.$set(ur);const fr={};fe&8&&(fr.mode=q[3]),l.$set(fr),q[2]?oe?(oe.p(q,fe),fe&4&&$(oe,1)):(oe=po(q),oe.c(),$(oe,1),oe.m(a,null)):oe&&(ce(),O(oe,1,1,()=>{oe=null}),pe()),q[1]!="planning"?re?(re.p(q,fe),fe&2&&$(re,1)):(re=ho(q),re.c(),$(re,1),re.m(h,c)):re&&(ce(),O(re,1,1,()=>{re=null}),pe());const cr={};fe&8&&(cr.mode=q[3]),f.$set(cr);const pr={};fe&8&&(pr.mode=q[3]),_.$set(pr);const dr={};fe&8&&(dr.mode=q[3]),m.$set(dr);const hr={};fe&8&&(hr.mode=q[3]),M.$set(hr),q[2]?Q?(Q.p(q,fe),fe&4&&$(Q,1)):(Q=mo(q),Q.c(),$(Q,1),Q.m(y,null)):Q&&(ce(),O(Q,1,1,()=>{Q=null}),pe()),q[1]!="planning"?de?(de.p(q,fe),fe&2&&$(de,1)):(de=_o(q),de.c(),$(de,1),de.m(A,x)):de&&(ce(),O(de,1,1,()=>{de=null}),pe());const Jt={};fe&8&&(Jt.mode=q[3]),fe&1&&(Jt.url=q[0]),!j&&fe&4&&(j=!0,Jt.routeTool=q[2],Me(()=>j=!1)),T.$set(Jt),q[1]!="planning"?F?(F.p(q,fe),fe&2&&$(F,1)):(F=go(q),F.c(),$(F,1),F.m(P,H)):F&&(ce(),O(F,1,1,()=>{F=null}),pe());const mr={};fe&8&&(mr.mode=q[3]),le.$set(mr)},i(q){ke||($(n.$$.fragment,q),$(i.$$.fragment,q),$(l.$$.fragment,q),$(oe),$(re),$(f.$$.fragment,q),$(_.$$.fragment,q),$(m.$$.fragment,q),$(M.$$.fragment,q),$(Q),$(de),$(T.$$.fragment,q),$(F),$(le.$$.fragment,q),ke=!0)},o(q){O(n.$$.fragment,q),O(i.$$.fragment,q),O(l.$$.fragment,q),O(oe),O(re),O(f.$$.fragment,q),O(_.$$.fragment,q),O(m.$$.fragment,q),O(M.$$.fragment,q),O(Q),O(de),O(T.$$.fragment,q),O(F),O(le.$$.fragment,q),ke=!1},d(q){q&&k(e),D(n),r[14](null),D(i),D(l),oe&&oe.d(),re&&re.d(),r[16](null),D(f),D(_),r[17](null),D(m),D(M),Q&&Q.d(),de&&de.d(),r[19](null),D(T),F&&F.d(),r[21](null),D(le)}}}function Ru(r,e,t){let n;se(r,Ae,T=>t(22,n=T));let{routeSnapperUrl:o}=e,{schema:i}=e,s,a=new Ql(n),l=new ca(n),u="edit-attribute",p,h,c,f,d,g,_;function v(T){let j={"edit-attribute":p,"edit-geometry":h,route:c,point:f,"free-polygon":d,"snap-polygon":g,"split-route":_};if(u==T){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),j[u].stop(),t(3,u=T),console.log(`Starting new mode ${u}`),j[u].start()}kt(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function m(T){ae[T?"unshift":"push"](()=>{p=T,t(4,p)})}function b(T){ae[T?"unshift":"push"](()=>{h=T,t(5,h)})}function y(T){ae[T?"unshift":"push"](()=>{f=T,t(7,f)})}function M(T){ae[T?"unshift":"push"](()=>{d=T,t(8,d)})}function C(T){ae[T?"unshift":"push"](()=>{g=T,t(9,g)})}function I(T){ae[T?"unshift":"push"](()=>{c=T,t(6,c)})}function A(T){s=T,t(2,s)}function x(T){ae[T?"unshift":"push"](()=>{_=T,t(10,_)})}return r.$$set=T=>{"routeSnapperUrl"in T&&t(0,o=T.routeSnapperUrl),"schema"in T&&t(1,i=T.schema)},[o,i,s,u,p,h,c,f,d,g,_,a,l,v,m,b,y,M,C,I,A,x]}class Au extends V{constructor(e){super(),K(this,e,Ru,Cu,W,{routeSnapperUrl:0,schema:1})}}function Tu(r){let e,t,n,o,i,s,a,l,u,p,h,c,f,d,g,_,v,m,b;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",o=R(),i=E("button"),i.textContent="About",s=R(),a=E("button"),a.textContent="Instructions",l=R(),u=E("br"),p=R(),h=E("label"),c=X(`ATIP schema:
      `),f=E("select"),d=E("option"),d.textContent="v1",g=E("option"),g.textContent="v2",_=E("option"),_.textContent="Housing developments",v=E("option"),v.textContent="Critical issues",L(n,"type","button"),L(i,"type","button"),L(a,"type","button"),d.__value="v1",d.value=d.__value,g.__value="v2",g.value=g.__value,_.__value="planning",_.value=_.__value,v.__value="criticals",v.value=v.__value,r[2]===void 0&&St(()=>r[12].call(f)),L(e,"slot","nav")},m(y,M){w(y,e,M),S(e,t),S(t,n),S(t,o),S(t,i),S(t,s),S(t,a),S(e,l),S(e,u),S(e,p),S(e,h),S(h,c),S(h,f),S(f,d),S(f,g),S(f,_),S(f,v),_t(f,r[2]),m||(b=[U(n,"click",r[11]),U(i,"click",r[8]),U(a,"click",r[9]),U(f,"change",r[12]),U(f,"change",r[10])],m=!0)},p(y,M){M&4&&_t(f,y[2])},d(y){y&&k(e),m=!1,Oe(b)}}}function Iu(r){let e,t,n,o,i,s,a,l,u,p,h,c;return i=new Nl({props:{boundaryGeojson:r[5]}}),a=new Il({props:{authorityName:r[6],schema:r[2]}}),h=new Ol({props:{schema:r[2],routeInfo:r[4]}}),{c(){e=E("div"),t=E("h1"),n=X(r[6]),o=R(),N(i.$$.fragment),s=R(),N(a.$$.fragment),l=R(),u=E("br"),p=R(),N(h.$$.fragment),L(e,"slot","sidebar")},m(f,d){w(f,e,d),S(e,t),S(t,n),S(t,o),B(i,t,null),S(e,s),B(a,e,null),S(e,l),S(e,u),S(e,p),B(h,e,null),c=!0},p(f,d){const g={};d&32&&(g.boundaryGeojson=f[5]),i.$set(g);const _={};d&4&&(_.schema=f[2]),a.$set(_);const v={};d&4&&(v.schema=f[2]),d&16&&(v.routeInfo=f[4]),h.$set(v)},i(f){c||($(i.$$.fragment,f),$(a.$$.fragment,f),$(h.$$.fragment,f),c=!0)},o(f){O(i.$$.fragment,f),O(a.$$.fragment,f),O(h.$$.fragment,f),c=!1},d(f){f&&k(e),D(i),D(a),D(h)}}}function Fu(r){let e,t,n,o,i,s,a,l,u,p,h,c;return e=new $s({props:{boundaryGeojson:r[5]}}),n=new Vl({props:{schema:r[2]}}),i=new Zl({}),a=new Au({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new jl({props:{style:r[7]}}),h=new Xl({props:{schema:r[2]}}),{c(){N(e.$$.fragment),t=R(),N(n.$$.fragment),o=R(),N(i.$$.fragment),s=R(),N(a.$$.fragment),l=R(),N(u.$$.fragment),p=R(),N(h.$$.fragment)},m(f,d){B(e,f,d),w(f,t,d),B(n,f,d),w(f,o,d),B(i,f,d),w(f,s,d),B(a,f,d),w(f,l,d),B(u,f,d),w(f,p,d),B(h,f,d),c=!0},p(f,d){const g={};d&32&&(g.boundaryGeojson=f[5]),e.$set(g);const _={};d&4&&(_.schema=f[2]),n.$set(_);const v={};d&8&&(v.routeSnapperUrl=f[3]),d&4&&(v.schema=f[2]),a.$set(v);const m={};d&4&&(m.schema=f[2]),h.$set(m)},i(f){c||($(e.$$.fragment,f),$(n.$$.fragment,f),$(i.$$.fragment,f),$(a.$$.fragment,f),$(u.$$.fragment,f),$(h.$$.fragment,f),c=!0)},o(f){O(e.$$.fragment,f),O(n.$$.fragment,f),O(i.$$.fragment,f),O(a.$$.fragment,f),O(u.$$.fragment,f),O(h.$$.fragment,f),c=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(o),D(i,f),f&&k(s),D(a,f),f&&k(l),D(u,f),f&&k(p),D(h,f)}}}function Pu(r){let e,t,n;return t=new Ji({props:{style:r[7],$$slots:{default:[Fu]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),L(e,"slot","main")},m(o,i){w(o,e,i),B(t,e,null),n=!0},p(o,i){const s={};i&524332&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||($(t.$$.fragment,o),n=!0)},o(o){O(t.$$.fragment,o),n=!1},d(o){o&&k(e),D(t)}}}function xu(r){let e,t,n,o,i,s,a,l;e=new Qi({props:{$$slots:{main:[Pu],sidebar:[Iu],nav:[Tu]},$$scope:{ctx:r}}});function u(f){r[13](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new gi({props:p}),ae.push(()=>Ee(n,"open",u,r[0]));function h(f){r[14](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new Hi({props:c}),ae.push(()=>Ee(s,"open",h,r[1])),{c(){N(e.$$.fragment),t=R(),N(n.$$.fragment),i=R(),N(s.$$.fragment)},m(f,d){B(e,f,d),w(f,t,d),B(n,f,d),w(f,i,d),B(s,f,d),l=!0},p(f,[d]){const g={};d&524348&&(g.$$scope={dirty:d,ctx:f}),e.$set(g);const _={};!o&&d&1&&(o=!0,_.open=f[0],Me(()=>o=!1)),n.$set(_);const v={};!a&&d&2&&(a=!0,v.open=f[1],Me(()=>a=!1)),s.$set(v)},i(f){l||($(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!0)},o(f){O(e.$$.fragment,f),O(n.$$.fragment,f),O(s.$$.fragment,f),l=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(i),D(s,f)}}}function Nu(r,e,t){let n=!1,o=!1,i=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${a}.bin`,h=`https://atip.uk/route-info/${a}.bin`;i||(p=`https://atip.uk/route-snappers-dev/${a}.bin`,h=`https://atip.uk/route-info-dev/${a}.bin`);let c;function f(){t(0,n=!n),t(1,o=!1)}function d(){t(1,o=!o),t(0,n=!1)}let g;er(async()=>{t(5,g=await _());const C=So(new Ai);t(4,c=await new C),await c.loadFile(h)});async function _(){const I=await(await fetch(bi)).text(),A=JSON.parse(I);return A.features=A.features.filter(x=>{var T;return((T=x.properties)==null?void 0:T.name)==a}),A}function v(){let C=new URLSearchParams(window.location.search);C.set("schema",u);let I=`${window.location.pathname}?${C.toString()}${window.location.hash}`;window.location.href=I}const m=()=>window.open("index.html");function b(){u=nr(this),t(2,u)}function y(C){n=C,t(0,n)}function M(C){o=C,t(1,o)}return[n,o,u,p,c,g,a,l,f,d,v,m,b,y,M]}class Bu extends V{constructor(e){super(),K(this,e,Nu,xu,W,{})}}new Bu({target:document.getElementById("app")});
