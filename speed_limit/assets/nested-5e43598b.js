var Vi=Object.defineProperty;var Ki=(r,e,t)=>e in r?Vi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var re=(r,e,t)=>(Ki(r,typeof e!="symbol"?e+"":e,t),t);import{S as Q,i as ee,s as K,M as Zi,b as oe,a as Oe,d as j,m as q,k as Le,n as C,o as $,q as U,e as k,c as A,g as S,x as G,p as E,y as Fe,f as O,z as me,B as ge,C as Qi,D as tr,E as Rn,F as Xt,G as mt,H as gt,I as bt,J as yt,K as _r,h as w,l as B,L as eo,N as to,O as ie,P as no,w as nr,Q as it,R as Ee,T as Sn,t as J,U as Lt,V as wt,r as xe,W as kt,X as rr,Y as be,Z as fe,j as Pe,_ as Je,$ as ci,a0 as pi,a1 as St,a2 as pn,a3 as mr,a4 as ro,a5 as io,a6 as je,a7 as oo,a8 as so,a9 as lo,aa as En,ab as Ct,ac as Mn,ad as On,ae as Bn,af as ao,ag as vt,ah as ir,ai as tt,aj as Et,ak as uo,al as or,am as fo,an as co,ao as po,ap as gr,aq as dn,ar as ho,as as _o,at as mo,A as go,u as bo}from"./authorities-69f6bf40.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const di=Symbol("Comlink.proxy"),yo=Symbol("Comlink.endpoint"),vo=Symbol("Comlink.releaseProxy"),An=Symbol("Comlink.finalizer"),nn=Symbol("Comlink.thrown"),hi=r=>typeof r=="object"&&r!==null||typeof r=="function",wo={canHandle:r=>hi(r)&&r[di],serialize(r){const{port1:e,port2:t}=new MessageChannel;return sr(r,e),[t,[t]]},deserialize(r){return r.start(),gi(r)}},ko={canHandle:r=>hi(r)&&nn in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},_i=new Map([["proxy",wo],["throw",ko]]);function So(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function sr(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!So(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(ot);let u;try{const p=a.slice(0,-1).reduce((f,c)=>f[c],r),_=a.reduce((f,c)=>f[c],r);switch(s){case"GET":u=_;break;case"SET":p[a.slice(-1)[0]]=ot(i.data.value),u=!0;break;case"APPLY":u=_.apply(p,l);break;case"CONSTRUCT":{const f=new _(...l);u=Ro(f)}break;case"ENDPOINT":{const{port1:f,port2:c}=new MessageChannel;sr(r,c),u=Co(f,[f])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[nn]:0}}Promise.resolve(u).catch(p=>({value:p,[nn]:0})).then(p=>{const[_,f]=mn(p);e.postMessage(Object.assign(Object.assign({},_),{id:o}),f),s==="RELEASE"&&(e.removeEventListener("message",n),mi(e),An in r&&typeof r[An]=="function"&&r[An]())}).catch(p=>{const[_,f]=mn({value:new TypeError("Unserializable return value"),[nn]:0});e.postMessage(Object.assign(Object.assign({},_),{id:o}),f)})}),e.start&&e.start()}function Eo(r){return r.constructor.name==="MessagePort"}function mi(r){Eo(r)&&r.close()}function gi(r,e){return Dn(r,[],e)}function Zt(r){if(r)throw new Error("Proxy has been released and is not useable")}function bi(r){return pt(r,{type:"RELEASE"}).then(()=>{mi(r)})}const hn=new WeakMap,_n="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(hn.get(r)||0)-1;hn.set(r,e),e===0&&bi(r)});function Mo(r,e){const t=(hn.get(e)||0)+1;hn.set(e,t),_n&&_n.register(r,e,r)}function Oo(r){_n&&_n.unregister(r)}function Dn(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(Zt(n),s===vo)return()=>{Oo(i),bi(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=pt(r,{type:"GET",path:e.map(l=>l.toString())}).then(ot);return a.then.bind(a)}return Dn(r,[...e,s])},set(o,s,a){Zt(n);const[l,u]=mn(a);return pt(r,{type:"SET",path:[...e,s].map(p=>p.toString()),value:l},u).then(ot)},apply(o,s,a){Zt(n);const l=e[e.length-1];if(l===yo)return pt(r,{type:"ENDPOINT"}).then(ot);if(l==="bind")return Dn(r,e.slice(0,-1));const[u,p]=br(a);return pt(r,{type:"APPLY",path:e.map(_=>_.toString()),argumentList:u},p).then(ot)},construct(o,s){Zt(n);const[a,l]=br(s);return pt(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(ot)}});return Mo(i,r),i}function Lo(r){return Array.prototype.concat.apply([],r)}function br(r){const e=r.map(mn);return[e.map(t=>t[0]),Lo(e.map(t=>t[1]))]}const yi=new WeakMap;function Co(r,e){return yi.set(r,e),r}function Ro(r){return Object.assign(r,{[di]:!0})}function mn(r){for(const[e,t]of _i)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},yi.get(r)||[]]}function ot(r){switch(r.type){case"HANDLER":return _i.get(r.name).deserialize(r.value);case"RAW":return r.value}}function pt(r,e,t){return new Promise(n=>{const i=Ao();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function Ao(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function $o(){return new Worker("/atip/speed_limit/assets/worker-06194aed.js")}let te;const We=new Array(128).fill(void 0);We.push(void 0,null,!0,!1);function H(r){return We[r]}let st=0,xt=null;function Nt(){return(xt===null||xt.byteLength===0)&&(xt=new Uint8Array(te.memory.buffer)),xt}const rn=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},To=typeof rn.encodeInto=="function"?function(r,e){return rn.encodeInto(r,e)}:function(r,e){const t=rn.encode(r);return e.set(t),{read:r.length,written:t.length}};function $n(r,e,t){if(t===void 0){const a=rn.encode(r),l=e(a.length)>>>0;return Nt().subarray(l,l+a.length).set(a),st=a.length,l}let n=r.length,i=e(n)>>>0;const o=Nt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3)>>>0;const a=Nt().subarray(i+s,i+n),l=To(r,a);s+=l.written}return st=s,i}function At(r){return r==null}let It=null;function _e(){return(It===null||It.byteLength===0)&&(It=new Int32Array(te.memory.buffer)),It}let Bt=We.length;function xo(r){r<132||(We[r]=Bt,Bt=r)}function on(r){const e=H(r);return xo(r),e}function ce(r){Bt===We.length&&We.push(We.length+1);const e=Bt;return Bt=We[e],We[e]=r,e}let Pt=null;function Io(){return(Pt===null||Pt.byteLength===0)&&(Pt=new Float64Array(te.memory.buffer)),Pt}const vi=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&vi.decode();function dt(r,e){return r=r>>>0,vi.decode(Nt().subarray(r,r+e))}let Ft=null;function Po(){return(Ft===null||Ft.byteLength===0)&&(Ft=new BigInt64Array(te.memory.buffer)),Ft}function jn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=jn(r[0]));for(let s=1;s<i;s++)o+=", "+jn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Fo(r,e){const t=e(r.length*1)>>>0;return Nt().set(r,t/1),st=r.length,t}function Tn(r,e){try{return r.apply(this,e)}catch(t){te.__wbindgen_exn_store(ce(t))}}let qn=class{static __wrap(e){e=e>>>0;const t=Object.create(qn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();te.__wbg_routeinfo_free(e)}constructor(e){try{const o=te.__wbindgen_add_to_stack_pointer(-16),s=Fo(e,te.__wbindgen_malloc),a=st;te.routeinfo_new(o,s,a);var t=_e()[o/4+0],n=_e()[o/4+1],i=_e()[o/4+2];if(i)throw on(n);return qn.__wrap(t)}finally{te.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const p=te.__wbindgen_add_to_stack_pointer(-16);te.routeinfo_nameForRoute(p,this.__wbg_ptr,ce(e));var i=_e()[p/4+0],o=_e()[p/4+1],s=_e()[p/4+2],a=_e()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,on(s);return t=l,n=u,dt(l,u)}finally{te.__wbindgen_add_to_stack_pointer(16),te.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const p=te.__wbindgen_add_to_stack_pointer(-16);te.routeinfo_speedLimitForRoute(p,this.__wbg_ptr,ce(e));var i=_e()[p/4+0],o=_e()[p/4+1],s=_e()[p/4+2],a=_e()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,on(s);return t=l,n=u,dt(l,u)}finally{te.__wbindgen_add_to_stack_pointer(16),te.__wbindgen_free(t,n)}}};async function No(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Bo(){const r={};return r.wbg={},r.wbg.__wbindgen_string_get=function(e,t){const n=H(t),i=typeof n=="string"?n:void 0;var o=At(i)?0:$n(i,te.__wbindgen_malloc,te.__wbindgen_realloc),s=st;_e()[e/4+1]=s,_e()[e/4+0]=o},r.wbg.__wbindgen_object_drop_ref=function(e){on(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=H(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof H(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return ce(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return H(e)===H(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=H(t),i=typeof n=="number"?n:void 0;Io()[e/8+1]=At(i)?0:i,_e()[e/4+0]=!At(i)},r.wbg.__wbindgen_is_object=function(e){const t=H(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return H(e)in H(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ce(t)},r.wbg.__wbindgen_is_undefined=function(e){return H(e)===void 0},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(dt(e,t));return ce(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=dt(e,t);return ce(n)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return H(e)==H(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=H(e);return ce(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=H(e)[H(t)];return ce(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ce(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=H(t).stack,i=$n(n,te.__wbindgen_malloc,te.__wbindgen_realloc),o=st;_e()[e/4+1]=o,_e()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(dt(e,t))}finally{te.__wbindgen_free(n,i)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(H(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(H(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(H(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(H(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(H(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=H(e)[t>>>0];return ce(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return H(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof H(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=H(e).next;return ce(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return Tn(function(e){const t=H(e).next();return ce(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return H(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=H(e).value;return ce(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return ce(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return Tn(function(e,t){const n=Reflect.get(H(e),H(t));return ce(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return Tn(function(e,t){const n=H(e).call(H(t));return ce(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(H(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=H(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(H(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(H(e));return ce(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=H(e).buffer;return ce(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(H(e));return ce(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){H(e).set(H(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return H(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=H(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=H(t),i=typeof n=="bigint"?n:void 0;Po()[e/8+1]=At(i)?BigInt(0):i,_e()[e/4+0]=!At(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=jn(H(t)),i=$n(n,te.__wbindgen_malloc,te.__wbindgen_realloc),o=st;_e()[e/4+1]=o,_e()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(dt(e,t))},r.wbg.__wbindgen_memory=function(){const e=te.memory;return ce(e)},r}function Do(r,e){return te=r.exports,wi.__wbindgen_wasm_module=e,Ft=null,Pt=null,It=null,xt=null,te}async function wi(r){if(te!==void 0)return te;typeof r>"u"&&(r="/atip/speed_limit/assets/route_info_bg.wasm");const e=Bo();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await No(await r,e);return Do(t,n)}class jo{constructor(){re(this,"inner");this.inner=null}async loadFile(e){await wi(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new qn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.speedLimitForRoute(e)}}sr(jo);function qo(r){let e,t,n,i,o,s,a,l,u,p,_,f,c;return{c(){e=k("p"),e.textContent="For each intervention:",t=A(),n=k("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=A(),o=k("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=A(),a=k("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=A(),u=k("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=A(),_=k("p"),_.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,f=A(),c=k("p"),c.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(h,g){S(h,e,g),S(h,t,g),S(h,n,g),S(h,i,g),S(h,o,g),S(h,s,g),S(h,a,g),S(h,l,g),S(h,u,g),S(h,p,g),S(h,_,g),S(h,f,g),S(h,c,g)},p:G,d(h){h&&E(e),h&&E(t),h&&E(n),h&&E(i),h&&E(o),h&&E(s),h&&E(a),h&&E(l),h&&E(u),h&&E(p),h&&E(_),h&&E(f),h&&E(c)}}}function Uo(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[qo]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new Zi({props:o}),oe.push(()=>Oe(e,"open",i,r[0])),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Le(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Go(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class zo extends Q{constructor(e){super(),ee(this,e,Go,Uo,K,{open:0})}}const lt=[];function Rt(r,e=G){let t;const n=new Set;function i(a){if(K(r,a)&&(r=a,t)){const l=!lt.length;for(const u of n)u[1](),lt.push(u,r);if(l){for(let u=0;u<lt.length;u+=2)lt[u][0](lt[u+1]);lt.length=0}}}function o(a){i(a(r))}function s(a,l=G){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||G),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ue=Rt(null),ne=Rt(Fe()),Me=Rt(null),He=Rt(null),Gt=Rt(null),zt=Rt(null);function Wt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function yr(r){console.log(`Deleting intervention ${r}`),ne.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Me.set(null),He.set(null),Gt.set(null),zt.set(null)}function vr(r){let e;const t=r[4].default,n=mt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&gt(n,t,i,i[3],e?yt(t,i[3],o,null):bt(i[3]),null)},i(i){e||(C(n,i),e=!0)},o(i){$(n,i),e=!1},d(i){n&&n.d(i)}}}function Ho(r){let e,t,n=r[1]&&vr(r);return{c(){e=k("div"),n&&n.c(),O(e,"class","map svelte-12dpf1u")},m(i,o){S(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&C(n,1)):(n=vr(i),n.c(),C(n,1),n.m(e,null)):n&&(me(),$(n,1,1,()=>{n=null}),ge())},i(i){t||(C(n),t=!0)},o(i){$(n),t=!1},d(i){i&&E(e),n&&n.d(),r[5](null)}}}function Yo(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;Qi("setCamera",!window.location.hash),tr(()=>{s=new Rn.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new Rn.ScaleControl({})),s.addControl(new Rn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ue.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),Xt(()=>{s.remove()});function u(p){oe[p?"unshift":"push"](()=>{a=p,t(0,a)})}return r.$$set=p=>{"style"in p&&t(2,o=p.style),"$$scope"in p&&t(3,i=p.$$scope)},[a,l,o,i,n,u]}class Jo extends Q{constructor(e){super(),ee(this,e,Yo,Ho,K,{style:2})}}const Xo=r=>({}),wr=r=>({}),Wo=r=>({}),kr=r=>({}),Vo=r=>({}),Sr=r=>({});function Ko(r){let e,t,n,i,o,s,a,l,u,p,_,f;const c=r[3].nav,h=mt(c,r,r[2],Sr),g=r[3].sidebar,m=mt(g,r,r[2],kr),y=r[3].main,d=mt(y,r,r[2],wr);return{c(){e=k("aside"),t=k("div"),n=k("nav"),h&&h.c(),i=A(),m&&m.c(),o=A(),s=k("button"),s.textContent="→",l=A(),u=k("main"),d&&d.c(),O(n,"class","svelte-1u7vg8a"),O(t,"class","sidebar-content content-container svelte-1u7vg8a"),O(s,"type","button"),O(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),O(e,"class",a=_r(r[0]?"":"collapsed")+" svelte-1u7vg8a"),O(u,"class","svelte-1u7vg8a")},m(b,v){S(b,e,v),w(e,t),w(t,n),h&&h.m(n,null),w(t,i),m&&m.m(t,null),w(e,o),w(e,s),S(b,l,v),S(b,u,v),d&&d.m(u,null),p=!0,_||(f=B(s,"click",r[1]),_=!0)},p(b,[v]){h&&h.p&&(!p||v&4)&&gt(h,c,b,b[2],p?yt(c,b[2],v,Vo):bt(b[2]),Sr),m&&m.p&&(!p||v&4)&&gt(m,g,b,b[2],p?yt(g,b[2],v,Wo):bt(b[2]),kr),(!p||v&1&&a!==(a=_r(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&O(e,"class",a),d&&d.p&&(!p||v&4)&&gt(d,y,b,b[2],p?yt(y,b[2],v,Xo):bt(b[2]),wr)},i(b){p||(C(h,b),C(m,b),C(d,b),p=!0)},o(b){$(h,b),$(m,b),$(d,b),p=!1},d(b){b&&E(e),h&&h.d(b),m&&m.d(b),b&&E(l),b&&E(u),d&&d.d(b),_=!1,f()}}}function Zo(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class Qo extends Q{constructor(e){super(),ee(this,e,Zo,Ko,K,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function es(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var rt=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function ts(r,e){return r>e?1:r<e?-1:0}function Ke(r,e,t){for(var n=new rt(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function xn(r,e,t,n){var i=new rt(r,e);if(t===null)return i.left=i.right=null,i;t=Ke(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Er(r,e,t){var n=null,i=null;if(e){e=Ke(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function ns(r,e,t){return e===null?r:(r===null||(e=Ke(r.key,e,t),e.left=r),e)}function Un(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Un(r.left,o,!1,n,i),r.right&&Un(r.right,o,!0,n,i)}}var lr=function(){function r(e){e===void 0&&(e=ts),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=xn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new rt(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ke(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ke(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ke(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ke(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ke(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return is(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Hn(e,t,0,i-1,o),this._root===null)this._root=Gn(e,t,0,i),this._size=i;else{var s=os(this.toList(),rs(e,t),o);i=this._size+i,this._root=zn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Un(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Er(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=xn(t,n,a,i):s=xn(t,n,s,i),this._root=ns(s,a,i)},r.prototype.split=function(e){return Er(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return es(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Gn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new rt(s,a);return l.left=Gn(r,e,t,o),l.right=Gn(r,e,o+1,n),l}return null}function rs(r,e){for(var t=new rt(null,null),n=t,i=0;i<r.length;i++)n=n.next=new rt(r[i],e[i]);return n.next=null,t.next}function is(r){for(var e=r,t=[],n=!1,i=new rt(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function zn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=zn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=zn(r,i+1,t),s}return null}function os(r,e,t){for(var n=new rt(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Hn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Hn(r,e,t,a,i),Hn(r,e,a+1,n,i)}}function Ne(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Mr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Ce(r,e,t){return e&&Mr(r.prototype,e),t&&Mr(r,t),r}var $t=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Yn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Qe=Number.EPSILON;Qe===void 0&&(Qe=Math.pow(2,-52));var ss=Qe*Qe,Jn=function(e,t){if(-Qe<e&&e<Qe&&-Qe<t&&t<Qe)return 0;var n=e-t;return n*n<ss*e*t?0:e<t?-1:1},ls=function(){function r(){Ne(this,r),this.reset()}return Ce(r,[{key:"reset",value:function(){this.xRounder=new Or,this.yRounder=new Or}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Or=function(){function r(){Ne(this,r),this.tree=new lr,this.round(0)}return Ce(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Jn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Jn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Ht=new ls,Dt=function(e,t){return e.x*t.y-e.y*t.x},ki=function(e,t){return e.x*t.x+e.y*t.y},Lr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Dt(i,o);return Jn(s,0)},gn=function(e){return Math.sqrt(ki(e,e))},as=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Dt(o,i)/gn(o)/gn(i)},us=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return ki(o,i)/gn(o)/gn(i)},Cr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Rr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},fs=function(e,t,n,i){if(t.x===0)return Rr(n,i,e.x);if(i.x===0)return Rr(e,t,n.x);if(t.y===0)return Cr(n,i,e.y);if(i.y===0)return Cr(e,t,n.y);var o=Dt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=Dt(s,t)/o,l=Dt(s,i)/o,u=e.x+l*t.x,p=n.x+a*i.x,_=e.y+l*t.y,f=n.y+a*i.y,c=(u+p)/2,h=(_+f)/2;return{x:c,y:h}},ze=function(){Ce(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:bn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Ne(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Ce(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:as(n.point,t.point,l.point),cosine:us(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,p=l.cosine,_=i.get(a),f=_.sine,c=_.cosine;return u>=0&&f>=0?p<c?1:p>c?-1:0:u<0&&f<0?p<c?-1:p>c?1:0:f<u?-1:f>u?1:0}}}]),r}(),cs=0,bn=function(){Ce(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,_=n.rightSE.point.y;if(i<o){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var f=t.comparePoint(n.leftSE.point);if(f<0)return 1;if(f>0)return-1;var c=n.comparePoint(t.rightSE.point);return c!==0?c:-1}if(i>o){if(l<u&&l<_)return-1;if(l>u&&l>_)return 1;var h=n.comparePoint(t.leftSE.point);if(h!==0)return h;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var m=n.comparePoint(t.rightSE.point);if(m!==0)return m}if(s>a){var y=t.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(s!==a){var d=p-l,b=s-i,v=_-u,M=a-o;if(d>b&&v<M)return 1;if(d<b&&v>M)return-1}return s>a?1:s<a||p<_?-1:p>_?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Ne(this,r),this.id=++cs,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Ce(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Yn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=$t(n,l)&&this.comparePoint(l)===0,_=$t(i,s)&&t.comparePoint(s)===0,f=$t(n,u)&&this.comparePoint(u)===0,c=$t(i,a)&&t.comparePoint(a)===0;if(_&&p)return c&&!f?a:!c&&f?u:null;if(_)return f&&s.x===u.x&&s.y===u.y?null:s;if(p)return c&&a.x===l.x&&a.y===l.y?null:l;if(c&&f)return null;if(c)return a;if(f)return u;var h=fs(s,this.vector(),l,t.vector());return h===null||!$t(o,h)?null:Ht.round(h.x,h.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new ze(t,!0),s=new ze(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return ze.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),ze.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var p=i.rings[l],_=i.windings[l],f=n.rings.indexOf(p);f===-1?(n.rings.push(p),n.windings.push(_)):n.windings[f]+=_}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),i.push(u)):i[p]+=u}for(var _=[],f=[],c=0,h=n.length;c<h;c++)if(i[c]!==0){var g=n[c],m=g.poly;if(f.indexOf(m)===-1)if(g.isExterior)_.push(m);else{f.indexOf(m)===-1&&f.push(m);var y=_.indexOf(g.poly);y!==-1&&_.splice(y,1)}}for(var d=0,b=_.length;d<b;d++){var v=_[d].multiPoly;o.indexOf(v)===-1&&o.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(qe.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===qe.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(_){return _.length===1&&_[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(qe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=ze.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new ze(o,!0),p=new ze(s,!1);return new r(u,p,[i],[a])}}]),r}(),Ar=function(){function r(e,t,n){if(Ne(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Ht.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Ht.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(bn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(bn.fromRing(o,i,this))}return Ce(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),ps=function(){function r(e,t){if(Ne(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ar(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Ar(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Ce(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),$r=function(){function r(e,t){if(Ne(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new ps(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Ce(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),ds=function(){Ce(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],_=l.point,f=[];a=l,l=u,p.push(l),l.point!==_;)for(;;){var c=l.getAvailableLinkedEvents();if(c.length===0){var h=p[0].point,g=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(c.length===1){u=c[0].otherSE;break}for(var m=null,y=0,d=f.length;y<d;y++)if(f[y].point===l.point){m=y;break}if(m!==null){var b=f.splice(m)[0],v=p.splice(b.index);v.unshift(v[0].otherSE),n.push(new r(v.reverse()));continue}f.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=c.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Ne(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Ce(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Lr(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Lr(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,_=this.isExteriorRing()?0:n.length-1,f=this.isExteriorRing()?n.length:-1,c=[],h=_;h!=f;h+=p)c.push([n[h].x,n[h].y]);return c}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];ze.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Tr=function(){function r(e){Ne(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Ce(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),hs=function(){function r(e){Ne(this,r),this.rings=e,this.polys=this._composePolys(e)}return Ce(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Tr(s));else{var a=s.enclosingRing();a.poly||n.push(new Tr(a)),a.poly.addInterior(s)}}return n}}]),r}(),_s=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bn.compare;Ne(this,r),this.queue=e,this.tree=new lr(t),this.segments=[]}return Ce(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var _=l.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(p=_),!l.isAnEndpoint(_)))for(var f=this._splitSafely(l,_),c=0,h=f.length;c<h;c++)i.push(f[c])}var g=null;if(u){var m=u.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(g=m),!u.isAnEndpoint(m)))for(var y=this._splitSafely(u,m),d=0,b=y.length;d<b;d++)i.push(y[d])}if(p!==null||g!==null){var v=null;if(p===null)v=g;else if(g===null)v=p;else{var M=ze.comparePoints(p,g);v=M<=0?p:g}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var L=n.split(v),T=0,R=L.length;T<R;T++)i.push(L[T])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var I=l.getIntersection(u);if(I!==null){if(!l.isAnEndpoint(I))for(var F=this._splitSafely(l,I),N=0,V=F.length;N<V;N++)i.push(F[N]);if(!u.isAnEndpoint(I))for(var x=this._splitSafely(u,I),D=0,se=x.length;D<se;D++)i.push(x[D])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),xr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ms=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,gs=function(){function r(){Ne(this,r)}return Ce(r,[{key:"run",value:function(t,n,i){qe.type=t,Ht.reset();for(var o=[new $r(n,!0)],s=0,a=i.length;s<a;s++)o.push(new $r(i[s],!1));if(qe.numMultiPolys=o.length,qe.type==="difference")for(var l=o[0],u=1;u<o.length;)Yn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(qe.type==="intersection"){for(var p=0,_=o.length;p<_;p++)for(var f=o[p],c=p+1,h=o.length;c<h;c++)if(Yn(f.bbox,o[c].bbox)===null)return[]}for(var g=new lr(ze.compare),m=0,y=o.length;m<y;m++)for(var d=o[m].getSweepEvents(),b=0,v=d.length;b<v;b++)if(g.insert(d[b]),g.size>xr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new _s(g),L=g.size,T=g.pop();T;){var R=T.key;if(g.size===L){var I=R.segment;throw new Error("Unable to pop() ".concat(R.isLeft?"left":"right"," SweepEvent ")+"[".concat(R.point.x,", ").concat(R.point.y,"] from segment #").concat(I.id," ")+"[".concat(I.leftSE.point.x,", ").concat(I.leftSE.point.y,"] -> ")+"[".concat(I.rightSE.point.x,", ").concat(I.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>xr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>ms)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var F=M.process(R),N=0,V=F.length;N<V;N++){var x=F[N];x.consumedBy===void 0&&g.insert(x)}L=g.size,T=g.pop()}Ht.reset();var D=ds.factory(M.segments),se=new hs(D);return se.getGeom()}}]),r}(),qe=new gs,bs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return qe.run("union",e,n)},ys=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return qe.run("intersection",e,n)},vs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return qe.run("xor",e,n)},ws=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return qe.run("difference",e,n)},sn={union:bs,intersection:ys,xor:vs,difference:ws};function ks(r,e){var t=Es(e),n=null;return r.type==="FeatureCollection"?n=Ss(r):n=Si(sn.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function Ss(r){var e=r.features.length===2?sn.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):sn.union.apply(sn,r.features.map(function(t){return t.geometry.coordinates}));return Si(e)}function Si(r){return eo(r)}function Es(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return to(t)}function Ms(r,e,t){let n;ie(r,Ue,s=>t(1,n=s));let{boundaryGeojson:i}=e;return no("setCamera")&&n.fitBounds(nr(i),{padding:20,animate:!1}),it(n,"boundary",{type:"geojson",data:ks(i)}),Ee(n,{id:"boundary",source:"boundary",...Sn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class Os extends Q{constructor(e){super(),ee(this,e,Ms,null,K,{boundaryGeojson:0})}}const ue={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Ln=10,Yt=10;function Ls(r){let e,t,n,i,o,s,a;return{c(){e=k("label"),t=J(`Show details:
  `),n=k("select"),i=k("option"),i.textContent="None",o=k("option"),o.textContent="Speed limits",i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,r[0]===void 0&&Lt(()=>r[4].call(n))},m(l,u){S(l,e,u),w(e,t),w(e,n),w(n,i),w(n,o),wt(n,r[0]),s||(a=[B(n,"change",r[4]),B(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&wt(n,l[0])},i:G,o:G,d(l){l&&E(e),s=!1,xe(a)}}}let Qt="speed-limits";function Cs(r,e,t){let n,i;ie(r,Ue,_=>t(5,n=_)),ie(r,ne,_=>t(6,i=_));let{routeInfo:o}=e,{id:s}=e,a="none";const l=["match",["get","type"],"snapped","red","free","blue","white"];it(n,Qt,{type:"geojson",data:Fe()}),Ee(n,{id:"speed-limits",source:Qt,...kt(l,Yt,1)});async function u(){if(a=="none"){n.getSource(Qt).setData(Fe());return}let _=i.features.find(f=>f.id==s);try{let f=JSON.parse(await o.speedLimitForRoute(_.properties.waypoints));n.getSource(Qt).setData(f)}catch(f){window.alert(`Couldn't calculate speed limits for route: ${f}`)}}function p(){a=rr(this),t(0,a)}return r.$$set=_=>{"routeInfo"in _&&t(2,o=_.routeInfo),"id"in _&&t(3,s=_.id)},[a,u,o,s,p]}class Rs extends Q{constructor(e){super(),ee(this,e,Cs,Ls,K,{routeInfo:2,id:3})}}function Ir(r){let e,t=Pr(r[5])+"",n,i,o,s,a,l,u,p,_;return l=new Rs({props:{routeInfo:r[3],id:r[4]}}),{c(){e=J("Length: "),n=J(t),i=A(),o=k("br"),s=k("button"),s.textContent="Auto-fill details",a=A(),j(l.$$.fragment),O(s,"type","button")},m(f,c){S(f,e,c),S(f,n,c),S(f,i,c),S(f,o,c),S(f,s,c),S(f,a,c),q(l,f,c),u=!0,p||(_=B(s,"click",r[14]),p=!0)},p(f,c){(!u||c&32)&&t!==(t=Pr(f[5])+"")&&Je(n,t);const h={};c&8&&(h.routeInfo=f[3]),c&16&&(h.id=f[4]),l.$set(h)},i(f){u||(C(l.$$.fragment,f),u=!0)},o(f){$(l.$$.fragment,f),u=!1},d(f){f&&E(e),f&&E(n),f&&E(i),f&&E(o),f&&E(s),f&&E(a),U(l,f),p=!1,_()}}}function As(r){let e,t,n,i,o,s,a,l,u,p,_,f,c,h,g,m,y,d,b,v,M,L,T,R,I,F,N,V,x,D,se,he,z,le,Re,Be,ye,pe,Ie,De,ae=r[5]&&Ir(r);return{c(){e=k("label"),t=J("Name:"),n=k("br"),i=A(),o=k("input"),s=A(),a=k("br"),l=A(),u=k("br"),p=A(),_=k("label"),f=k("input"),c=J(`
  Area`),h=A(),g=k("label"),m=k("input"),y=J(`
  Route`),d=A(),b=k("label"),v=k("input"),M=J(`
  Crossing`),L=A(),T=k("label"),R=k("input"),I=J(`
  Other`),F=A(),N=k("br"),V=A(),x=k("br"),D=A(),se=k("label"),he=J("Description:"),z=k("br"),le=A(),Re=k("textarea"),Be=A(),ae&&ae.c(),ye=be(),O(o,"type","text"),fe(o,"width","100%"),O(f,"type","radio"),f.__value="area",f.value=f.__value,r[9][0].push(f),O(m,"type","radio"),m.__value="route",m.value=m.__value,r[9][0].push(m),O(v,"type","radio"),v.__value="crossing",v.value=v.__value,r[9][0].push(v),O(R,"type","radio"),R.__value="other",R.value=R.__value,r[9][0].push(R),fe(Re,"width","100%"),O(Re,"rows","5"),O(Re,"class","svelte-15lna0i")},m(P,Z){S(P,e,Z),w(e,t),w(e,n),w(e,i),w(e,o),Pe(o,r[0]),S(P,s,Z),S(P,a,Z),S(P,l,Z),S(P,u,Z),S(P,p,Z),S(P,_,Z),w(_,f),f.checked=f.__value===r[1],w(_,c),S(P,h,Z),S(P,g,Z),w(g,m),m.checked=m.__value===r[1],w(g,y),S(P,d,Z),S(P,b,Z),w(b,v),v.checked=v.__value===r[1],w(b,M),S(P,L,Z),S(P,T,Z),w(T,R),R.checked=R.__value===r[1],w(T,I),S(P,F,Z),S(P,N,Z),S(P,V,Z),S(P,x,Z),S(P,D,Z),S(P,se,Z),w(se,he),w(se,z),w(se,le),w(se,Re),Pe(Re,r[2]),S(P,Be,Z),ae&&ae.m(P,Z),S(P,ye,Z),pe=!0,Ie||(De=[B(o,"input",r[7]),B(f,"change",r[8]),B(m,"change",r[10]),B(v,"change",r[11]),B(R,"change",r[12]),B(Re,"input",r[13])],Ie=!0)},p(P,[Z]){Z&1&&o.value!==P[0]&&Pe(o,P[0]),Z&2&&(f.checked=f.__value===P[1]),Z&2&&(m.checked=m.__value===P[1]),Z&2&&(v.checked=v.__value===P[1]),Z&2&&(R.checked=R.__value===P[1]),Z&4&&Pe(Re,P[2]),P[5]?ae?(ae.p(P,Z),Z&32&&C(ae,1)):(ae=Ir(P),ae.c(),C(ae,1),ae.m(ye.parentNode,ye)):ae&&(me(),$(ae,1,1,()=>{ae=null}),ge())},i(P){pe||(C(ae),pe=!0)},o(P){$(ae),pe=!1},d(P){P&&E(e),P&&E(s),P&&E(a),P&&E(l),P&&E(u),P&&E(p),P&&E(_),r[9][0].splice(r[9][0].indexOf(f),1),P&&E(h),P&&E(g),r[9][0].splice(r[9][0].indexOf(m),1),P&&E(d),P&&E(b),r[9][0].splice(r[9][0].indexOf(v),1),P&&E(L),P&&E(T),r[9][0].splice(r[9][0].indexOf(R),1),P&&E(F),P&&E(N),P&&E(V),P&&E(x),P&&E(D),P&&E(se),P&&E(Be),ae&&ae.d(P),P&&E(ye),Ie=!1,xe(De)}}}function Pr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function $s(r,e,t){let n;ie(r,ne,b=>t(15,n=b));let{routeInfo:i}=e,{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function p(){let b=n.features.find(v=>v.id==o);try{t(0,s=await i.nameForRoute(b))}catch(v){window.alert(`Couldn't auto-name route: ${v}`)}}const _=[[]];function f(){s=this.value,t(0,s)}function c(){a=this.__value,t(1,a)}function h(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function m(){a=this.__value,t(1,a)}function y(){l=this.value,t(2,l)}const d=()=>p();return r.$$set=b=>{"routeInfo"in b&&t(3,i=b.routeInfo),"id"in b&&t(4,o=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(5,u=b.length_meters)},[s,a,l,i,o,u,p,f,c,_,h,g,m,y,d]}class Ts extends Q{constructor(e){super(),ee(this,e,$s,As,K,{routeInfo:3,id:4,name:0,intervention_type:1,description:2,length_meters:5})}}const xs="Intervention",Is=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],Ps={name:xs,oneOf:Is};function Fs(r){const e=r-1;return e*e*e+1}function Mt(r,{delay:e=0,duration:t=400,easing:n=Fs}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),p=parseFloat(i.marginBottom),_=parseFloat(i.borderTopWidth),f=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:c=>`overflow: hidden;opacity: ${Math.min(c*20,1)*o};height: ${c*s}px;padding-top: ${c*a}px;padding-bottom: ${c*l}px;margin-top: ${c*u}px;margin-bottom: ${c*p}px;border-top-width: ${c*_}px;border-bottom-width: ${c*f}px;`}}function Ei(r){return"members"in r}function Mi(r){return"oneOf"in r}function Oi(r){return typeof r=="string"}function Li(r){return typeof r=="object"&&"value"in r}function Ns(r){return"type"in r&&r.type=="number"}function Ci(r){return"type"in r&&r.type=="one-liner"}function Ri(r){return"type"in r&&r.type=="textbox"}function Ai(r){return"type"in r&&r.type=="checkbox"}function Fr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Nr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Br(r){let e,t=r[1].description+"",n;return{c(){e=k("p"),n=J(t),O(e,"class","svelte-1b72l00")},m(i,o){S(i,e,o),w(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&Je(n,t)},d(i){i&&E(e)}}}function Bs(r){let e,t,n;return{c(){e=k("input"),O(e,"type","checkbox")},m(i,o){S(i,e,o),e.checked=r[0],t||(n=B(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:G,o:G,d(i){i&&E(e),t=!1,n()}}}function Ds(r){let e,t,n;return{c(){e=k("textarea"),fe(e,"width","100%"),O(e,"rows","5"),O(e,"class","svelte-1b72l00")},m(i,o){S(i,e,o),Pe(e,r[0]),t||(n=B(e,"input",r[13]),t=!0)},p(i,o){o&1&&Pe(e,i[0])},i:G,o:G,d(i){i&&E(e),t=!1,n()}}}function js(r){let e,t,n;return{c(){e=k("input"),O(e,"type","text"),fe(e,"width","100%")},m(i,o){S(i,e,o),Pe(e,r[0]),t||(n=B(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Pe(e,i[0])},i:G,o:G,d(i){i&&E(e),t=!1,n()}}}function qs(r){let e,t,n;return{c(){e=k("input"),O(e,"type","number")},m(i,o){S(i,e,o),Pe(e,r[0]),t||(n=B(e,"input",r[11]),t=!0)},p(i,o){o&1&&ci(e.value)!==i[0]&&Pe(e,i[0])},i:G,o:G,d(i){i&&E(e),t=!1,n()}}}function Us(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=jr(Fr(r,n,s));const o=s=>$(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=be()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);S(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Fr(s,n,l);i[l]?(i[l].p(u,a),C(i[l],1)):(i[l]=jr(u),i[l].c(),C(i[l],1),i[l].m(e.parentNode,e))}for(me(),l=n.length;l<i.length;l+=1)o(l);ge()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)C(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)$(i[a]);t=!1},d(s){pi(i,s),s&&E(e)}}}function Gs(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=qr(Nr(r,n,s));const o=s=>$(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=be()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);S(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Nr(s,n,l);i[l]?(i[l].p(u,a),C(i[l],1)):(i[l]=qr(u),i[l].c(),C(i[l],1),i[l].m(e.parentNode,e))}for(me(),l=n.length;l<i.length;l+=1)o(l);ge()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)C(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)$(i[a]);t=!1},d(s){pi(i,s),s&&E(e)}}}function zs(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,p,_,f,c=r[2]==r[15].name&&typeof r[0]=="object"&&Dr(r);return{c(){e=k("label"),t=k("input"),i=A(),s=J(o),a=k("br"),l=A(),c&&c.c(),u=be(),O(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(h,g){S(h,e,g),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),S(h,l,g),c&&c.m(h,g),S(h,u,g),p=!0,_||(f=[B(t,"change",r[9]),B(t,"change",r[4])],_=!0)},p(h,g){(!p||g&2&&n!==(n=h[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),(!p||g&2)&&o!==(o=h[15].name+"")&&Je(s,o),h[2]==h[15].name&&typeof h[0]=="object"?c?(c.p(h,g),g&7&&C(c,1)):(c=Dr(h),c.c(),C(c,1),c.m(u.parentNode,u)):c&&(me(),$(c,1,1,()=>{c=null}),ge())},i(h){p||(C(c),p=!0)},o(h){$(c),p=!1},d(h){h&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),h&&E(l),c&&c.d(h),h&&E(u),_=!1,xe(f)}}}function Hs(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,p;function _(h,g){return h[15].description?Xs:Js}let f=_(r),c=f(r);return{c(){e=k("label"),t=k("input"),i=A(),s=J(o),a=A(),c.c(),l=A(),O(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(h,g){S(h,e,g),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),c.m(e,null),w(e,l),u||(p=[B(t,"change",r[8]),B(t,"change",r[3])],u=!0)},p(h,g){g&2&&n!==(n=h[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),g&2&&o!==(o=h[15].value+"")&&Je(s,o),f===(f=_(h))&&c?c.p(h,g):(c.d(1),c=f(h),c&&(c.c(),c.m(e,l)))},i:G,o:G,d(h){h&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),c.d(),u=!1,xe(p)}}}function Ys(r){let e,t,n,i,o=r[15]+"",s,a,l,u,p,_;return{c(){e=k("label"),t=k("input"),i=A(),s=J(o),a=A(),l=k("br"),u=A(),O(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(f,c){S(f,e,c),w(e,t),t.checked=t.__value===r[2],w(e,i),w(e,s),w(e,a),w(e,l),w(e,u),p||(_=[B(t,"change",r[6]),B(t,"change",r[3])],p=!0)},p(f,c){c&2&&n!==(n=f[15])&&(t.__value=n,t.value=t.__value),c&4&&(t.checked=t.__value===f[2]),c&2&&o!==(o=f[15]+"")&&Je(s,o)},i:G,o:G,d(f){f&&E(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,xe(_)}}}function Dr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Vt({props:l}),oe.push(()=>Oe(t,"value",a,r[0][r[15].name])),{c(){e=k("div"),j(t.$$.fragment),i=A(),O(e,"class","svelte-1b72l00")},m(u,p){S(u,e,p),q(t,e,null),w(e,i),s=!0},p(u,p){r=u;const _={};p&2&&(_.spec=r[15]),!n&&p&3&&(n=!0,_.value=r[0][r[15].name],Le(()=>n=!1)),t.$set(_)},i(u){s||(C(t.$$.fragment,u),Lt(()=>{o||(o=St(e,Mt,{duration:500},!0)),o.run(1)}),s=!0)},o(u){$(t.$$.fragment,u),o||(o=St(e,Mt,{duration:500},!1)),o.run(0),s=!1},d(u){u&&E(e),U(t),u&&o&&o.end()}}}function Js(r){let e;return{c(){e=k("br")},m(t,n){S(t,e,n)},p:G,d(t){t&&E(e)}}}function Xs(r){let e,t,n=r[15].description+"",i,o;return{c(){e=k("p"),t=J("("),i=J(n),o=J(")"),O(e,"class","svelte-1b72l00")},m(s,a){S(s,e,a),w(e,t),w(e,i),w(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&Je(i,n)},d(s){s&&E(e)}}}function jr(r){let e,t,n,i,o,s;const a=[Ys,Hs,zs],l=[];function u(p,_){return _&2&&(e=null),_&2&&(t=null),e==null&&(e=!!Oi(p[15])),e?0:(t==null&&(t=!!Li(p[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=be()},m(p,_){l[n].m(p,_),S(p,o,_),s=!0},p(p,_){let f=n;n=u(p,_),n===f?l[n].p(p,_):(me(),$(l[f],1,1,()=>{l[f]=null}),ge(),i=l[n],i?i.p(p,_):(i=l[n]=a[n](p),i.c()),C(i,1),i.m(o.parentNode,o))},i(p){s||(C(i),s=!0)},o(p){$(i),s=!1},d(p){l[n].d(p),p&&E(o)}}}function qr(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function p(f){r[5](f,r[15])}let _={spec:r[15]};return r[0][r[15].name]!==void 0&&(_.value=r[0][r[15].name]),s=new Vt({props:_}),oe.push(()=>Oe(s,"value",p,r[0][r[15].name])),{c(){e=k("div"),t=k("h3"),i=J(n),o=A(),j(s.$$.fragment),l=A(),O(e,"class","svelte-1b72l00")},m(f,c){S(f,e,c),w(e,t),w(t,i),w(e,o),q(s,e,null),w(e,l),u=!0},p(f,c){r=f,(!u||c&2)&&n!==(n=r[15].name+"")&&Je(i,n);const h={};c&2&&(h.spec=r[15]),!a&&c&3&&(a=!0,h.value=r[0][r[15].name],Le(()=>a=!1)),s.$set(h)},i(f){u||(C(s.$$.fragment,f),u=!0)},o(f){$(s.$$.fragment,f),u=!1},d(f){f&&E(e),U(s)}}}function Ws(r){let e,t,n,i,o,s,a,l,u,p,_,f=r[1].description&&Br(r);const c=[Gs,Us,qs,js,Ds,Bs],h=[];function g(m,y){return y&2&&(t=null),y&2&&(n=null),y&2&&(i=null),y&2&&(o=null),y&2&&(s=null),y&2&&(a=null),t==null&&(t=!!Ei(m[1])),t?0:(n==null&&(n=!!Mi(m[1])),n?1:(i==null&&(i=!!Ns(m[1])),i?2:(o==null&&(o=!!Ci(m[1])),o?3:(s==null&&(s=!!Ri(m[1])),s?4:(a==null&&(a=!!Ai(m[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=h[l]=c[l](r)),{c(){f&&f.c(),e=A(),u&&u.c(),p=be()},m(m,y){f&&f.m(m,y),S(m,e,y),~l&&h[l].m(m,y),S(m,p,y),_=!0},p(m,[y]){m[1].description?f?f.p(m,y):(f=Br(m),f.c(),f.m(e.parentNode,e)):f&&(f.d(1),f=null);let d=l;l=g(m,y),l===d?~l&&h[l].p(m,y):(u&&(me(),$(h[d],1,1,()=>{h[d]=null}),ge()),~l?(u=h[l],u?u.p(m,y):(u=h[l]=c[l](m),u.c()),C(u,1),u.m(p.parentNode,p)):u=null)},i(m){_||(C(u),_=!0)},o(m){$(u),_=!1},d(m){f&&f.d(m),m&&E(e),~l&&h[l].d(m),m&&E(p)}}}function Vs(r,e,t){var d,b,v;let{spec:n}=e,{value:i}=e,o="";if(Ei(n)){i||(i={});for(let M of n.members)Ci(M)||Ri(M)?i[d=M.name]||(i[d]=""):Ai(M)?i[b=M.name]||(i[b]=!1):i[v=M.name]||(i[v]={})}else Mi(n)&&(i||(i={}),Oi(i)?o=i:Li(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,L){r.$$.not_equal(i[L.name],M)&&(i[L.name]=M,t(0,i))}function p(){o=this.__value,t(2,o)}function _(){o=this.__value,t(2,o)}function f(){o=this.__value,t(2,o)}function c(M,L){r.$$.not_equal(i[L.name],M)&&(i[L.name]=M,t(0,i))}function h(){i=ci(this.value),t(0,i)}function g(){i=this.value,t(0,i)}function m(){i=this.value,t(0,i)}function y(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,p,l,_,f,c,h,g,m,y]}class Vt extends Q{constructor(e){super(),ee(this,e,Vs,Ws,K,{spec:1,value:0})}}function Ks(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Vt({props:o}),oe.push(()=>Oe(e,"value",i,r[0].v2)),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Le(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function Zs(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=Ps;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Qs extends Q{constructor(e){super(),ee(this,e,Zs,Ks,K,{props:0})}}const el="Planning",tl=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],nl={name:el,members:tl};function rl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Vt({props:o}),oe.push(()=>Oe(e,"value",i,r[0].planning)),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Le(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function il(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=nl;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class ol extends Q{constructor(e){super(),ee(this,e,il,rl,K,{props:0})}}const sl="CriticalIssue",ll=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],al={name:sl,members:ll};function ul(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Vt({props:o}),oe.push(()=>Oe(e,"value",i,r[0].criticals)),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Le(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function fl(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=al;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class cl extends Q{constructor(e){super(),ee(this,e,fl,ul,K,{props:0})}}function Ur(r){let e,t,n,i,o;const s=r[10].default,a=mt(s,r,r[9],null);return{c(){e=k("div"),a&&a.c(),fe(e,"border","solid 1px black"),fe(e,"padding","10px")},m(l,u){S(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=B(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&gt(a,s,l,l[9],n?yt(s,l[9],u,null):bt(l[9]),null)},i(l){n||(C(a,l),Lt(()=>{t||(t=St(e,Mt,{duration:100},!0)),t.run(1)}),n=!0)},o(l){$(a,l),t||(t=St(e,Mt,{duration:100},!1)),t.run(0),n=!1},d(l){l&&E(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function pl(r){let e,t,n,i,o,s,a,l,u,p,_=r[4]&&Ur(r);return{c(){e=k("button"),t=pn("svg"),n=pn("path"),i=A(),o=J(r[1]),s=A(),_&&_.c(),a=be(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-t7fpgu"),O(e,"aria-expanded",r[4]),O(e,"class","svelte-t7fpgu"),mr(e,"underlined",r[3])},m(f,c){S(f,e,c),w(e,t),w(t,n),w(e,i),w(e,o),S(f,s,c),_&&_.m(f,c),S(f,a,c),l=!0,u||(p=[B(e,"click",r[5]),B(e,"mouseenter",r[11]),B(e,"mouseleave",r[12])],u=!0)},p(f,[c]){(!l||c&2)&&Je(o,f[1]),(!l||c&16)&&O(e,"aria-expanded",f[4]),(!l||c&8)&&mr(e,"underlined",f[3]),f[4]?_?(_.p(f,c),c&16&&C(_,1)):(_=Ur(f),_.c(),C(_,1),_.m(a.parentNode,a)):_&&(me(),$(_,1,1,()=>{_=null}),ge())},i(f){l||(C(_),l=!0)},o(f){$(_),l=!1},d(f){f&&E(e),f&&E(s),_&&_.d(f),f&&E(a),u=!1,xe(p)}}}function dl(r,e,t){let n,i,o,s;ie(r,He,d=>t(7,o=d)),ie(r,Me,d=>t(8,s=d));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const _=()=>{Me.update(d=>d==u?null:u),s==u&&(zt.set(null),zt.set(u))};let f;function c(){f==null||f.scrollIntoView({behavior:"smooth"})}const h=()=>Gt.set(u),g=()=>Gt.set(null);function m(d){oe[d?"unshift":"push"](()=>{f=d,t(2,f)})}const y=()=>c();return r.$$set=d=>{"id"in d&&t(0,u=d.id),"label"in d&&t(1,p=d.label),"$$scope"in d&&t(9,l=d.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,p,f,i,n,_,c,o,s,l,a,h,g,m,y]}class hl extends Q{constructor(e){super(),ee(this,e,dl,pl,K,{id:0,label:1})}}function Gr(r,e,t){const n=r.slice();return n[14]=e[t],n[15]=e,n[16]=t,n}function _l(r){let e,t,n;function i(s){r[10](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new cl({props:o}),oe.push(()=>Oe(e,"props",i,r[14].properties)),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Le(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function ml(r){let e,t,n;function i(s){r[9](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new ol({props:o}),oe.push(()=>Oe(e,"props",i,r[14].properties)),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Le(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function gl(r){let e,t,n;function i(s){r[8](s,r[14])}let o={};return r[14].properties!==void 0&&(o.props=r[14].properties),e=new Qs({props:o}),oe.push(()=>Oe(e,"props",i,r[14].properties)),{c(){j(e.$$.fragment)},m(s,a){q(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Le(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){U(e,s)}}}function bl(r){let e,t,n,i,o;function s(p){r[5](p,r[14])}function a(p){r[6](p,r[14])}function l(p){r[7](p,r[14])}let u={routeInfo:r[1],id:r[14].id,length_meters:r[14].properties.length_meters};return r[14].properties.name!==void 0&&(u.name=r[14].properties.name),r[14].properties.intervention_type!==void 0&&(u.intervention_type=r[14].properties.intervention_type),r[14].properties.description!==void 0&&(u.description=r[14].properties.description),e=new Ts({props:u}),oe.push(()=>Oe(e,"name",s,r[14].properties.name)),oe.push(()=>Oe(e,"intervention_type",a,r[14].properties.intervention_type)),oe.push(()=>Oe(e,"description",l,r[14].properties.description)),{c(){j(e.$$.fragment)},m(p,_){q(e,p,_),o=!0},p(p,_){r=p;const f={};_&2&&(f.routeInfo=r[1]),_&4&&(f.id=r[14].id),_&4&&(f.length_meters=r[14].properties.length_meters),!t&&_&4&&(t=!0,f.name=r[14].properties.name,Le(()=>t=!1)),!n&&_&4&&(n=!0,f.intervention_type=r[14].properties.intervention_type,Le(()=>n=!1)),!i&&_&4&&(i=!0,f.description=r[14].properties.description,Le(()=>i=!1)),e.$set(f)},i(p){o||(C(e.$$.fragment,p),o=!0)},o(p){$(e.$$.fragment,p),o=!1},d(p){U(e,p)}}}function yl(r){let e,t,n,i,o,s,a,l,u,p,_,f,c,h,g;const m=[bl,gl,ml,_l],y=[];function d(v,M){return v[0]=="v1"?0:v[0]=="v2"?1:v[0]=="planning"?2:v[0]=="criticals"?3:-1}~(e=d(r))&&(t=y[e]=m[e](r));function b(){return r[11](r[14])}return{c(){t&&t.c(),n=A(),i=k("br"),o=A(),s=k("br"),a=A(),l=k("div"),u=k("button"),u.textContent="Delete",p=A(),_=k("button"),_.textContent="Save",f=A(),O(u,"type","button"),O(_,"type","button"),fe(l,"display","flex"),fe(l,"justify-content","space-between")},m(v,M){~e&&y[e].m(v,M),S(v,n,M),S(v,i,M),S(v,o,M),S(v,s,M),S(v,a,M),S(v,l,M),w(l,u),w(l,p),w(l,_),S(v,f,M),c=!0,h||(g=[B(u,"click",b),B(_,"click",r[12])],h=!0)},p(v,M){r=v;let L=e;e=d(r),e===L?~e&&y[e].p(r,M):(t&&(me(),$(y[L],1,1,()=>{y[L]=null}),ge()),~e?(t=y[e],t?t.p(r,M):(t=y[e]=m[e](r),t.c()),C(t,1),t.m(n.parentNode,n)):t=null)},i(v){c||(C(t),c=!0)},o(v){$(t),c=!1},d(v){~e&&y[e].d(v),v&&E(n),v&&E(i),v&&E(o),v&&E(s),v&&E(a),v&&E(l),v&&E(f),h=!1,xe(g)}}}function zr(r,e){let t,n,i;return n=new hl({props:{id:e[14].id,label:e[16]+1+") "+e[3](e[14]),$$slots:{default:[yl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=be(),j(n.$$.fragment),this.first=t},m(o,s){S(o,t,s),q(n,o,s),i=!0},p(o,s){e=o;const a={};s&4&&(a.id=e[14].id),s&4&&(a.label=e[16]+1+") "+e[3](e[14])),s&131079&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||(C(n.$$.fragment,o),i=!0)},o(o){$(n.$$.fragment,o),i=!1},d(o){o&&E(t),U(n,o)}}}function vl(r){let e=[],t=new Map,n,i,o,s,a=r[2].features;const l=u=>u[14].id;for(let u=0;u<a.length;u+=1){let p=Gr(r,a,u),_=l(p);t.set(_,e[u]=zr(_,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=be()},m(u,p){for(let _=0;_<e.length;_+=1)e[_].m(u,p);S(u,n,p),i=!0,o||(s=B(window,"keydown",r[4]),o=!0)},p(u,[p]){p&15&&(a=u[2].features,me(),e=ro(e,p,l,1,u,a,t,n.parentNode,io,zr,n,Gr),ge())},i(u){if(!i){for(let p=0;p<a.length;p+=1)C(e[p]);i=!0}},o(u){for(let p=0;p<e.length;p+=1)$(e[p]);i=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&E(n),o=!1,s()}}}function wl(r,e,t){let n,i;ie(r,Me,y=>t(13,n=y)),ie(r,ne,y=>t(2,i=y));let{schema:o}=e,{routeInfo:s}=e;function a(y){var b,v,M,L,T;if(o=="planning")return((b=y.properties.planning)==null?void 0:b.name)||"Untitled polygon";if(o=="v2")return((M=(v=y.properties.v2)==null?void 0:v.Route)==null?void 0:M.name)||((T=(L=y.properties.v2)==null?void 0:L.Crossing)==null?void 0:T.name)||"Untitled intervention";if(y.properties.name)return y.properties.name;var d=y.properties.intervention_type;return d=="other"&&(y.geometry.type=="Point"?d="point":y.geometry.type=="LineString"?d="line":d="polygon"),`Untitled ${d}`}function l(y){if(y.key=="Delete"){const d=y.target.tagName;if(d=="INPUT"||d=="TEXTAREA")return;y.preventDefault();const b=n;b&&yr(b)}}function u(y,d){r.$$.not_equal(d.properties.name,y)&&(d.properties.name=y,ne.set(i))}function p(y,d){r.$$.not_equal(d.properties.intervention_type,y)&&(d.properties.intervention_type=y,ne.set(i))}function _(y,d){r.$$.not_equal(d.properties.description,y)&&(d.properties.description=y,ne.set(i))}function f(y,d){r.$$.not_equal(d.properties,y)&&(d.properties=y,ne.set(i))}function c(y,d){r.$$.not_equal(d.properties,y)&&(d.properties=y,ne.set(i))}function h(y,d){r.$$.not_equal(d.properties,y)&&(d.properties=y,ne.set(i))}const g=y=>yr(y.id),m=()=>Me.set(null);return r.$$set=y=>{"schema"in y&&t(0,o=y.schema),"routeInfo"in y&&t(1,s=y.routeInfo)},[o,s,i,a,l,u,p,_,f,c,h,g,m]}class kl extends Q{constructor(e){super(),ee(this,e,wl,vl,K,{schema:0,routeInfo:1})}}function nt(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ye(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Xn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ze(r,e,t){t===void 0&&(t={});var n=nt(r),i=nt(e),o=je(i[1]-n[1]),s=je(i[0]-n[0]),a=je(n[1]),l=je(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return oo(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function ln(r,e){return e===void 0&&(e={}),so(r,function(t,n){var i=n.geometry.coordinates;return t+Ze(i[0],i[1],e)},0)}function Sl(r){let e,t,n,i,o,s,a,l,u,p,_,f,c,h,g,m,y,d,b,v=r[0].features.length+"",M,L,T,R,I,F,N,V;return{c(){e=k("div"),t=k("label"),n=J(`Scheme name:
    `),i=k("input"),o=A(),s=k("br"),a=A(),l=k("div"),u=k("label"),p=k("input"),_=A(),f=k("button"),f.textContent="Load from GeoJSON",c=A(),h=k("button"),h.textContent="Export to GeoJSON",g=A(),m=k("br"),y=A(),d=k("div"),b=k("span"),M=J(v),L=J(" interventions"),T=A(),R=k("button"),I=J("Clear all"),O(i,"type","text"),O(p,"type","file"),O(p,"id","load_geojson"),O(p,"class","svelte-lhyd1e"),O(f,"type","button"),O(h,"type","button"),O(h,"class","align-right svelte-lhyd1e"),O(R,"type","button"),O(R,"class","align-right svelte-lhyd1e"),R.disabled=F=r[0].features.length==0},m(x,D){S(x,e,D),w(e,t),w(t,n),w(t,i),Pe(i,r[0].scheme_name),S(x,o,D),S(x,s,D),S(x,a,D),S(x,l,D),w(l,u),w(u,p),w(u,_),w(u,f),w(l,c),w(l,h),S(x,g,D),S(x,m,D),S(x,y,D),S(x,d,D),w(d,b),w(b,M),w(b,L),w(d,T),w(d,R),w(R,I),N||(V=[B(i,"input",r[7]),B(p,"change",r[3]),B(f,"click",Ml),B(h,"click",r[2]),B(R,"click",r[1])],N=!0)},p(x,[D]){D&1&&i.value!==x[0].scheme_name&&Pe(i,x[0].scheme_name),D&1&&v!==(v=x[0].features.length+"")&&Je(M,v),D&1&&F!==(F=x[0].features.length==0)&&(R.disabled=F)},i:G,o:G,d(x){x&&E(e),x&&E(o),x&&E(s),x&&E(a),x&&E(l),x&&E(g),x&&E(m),x&&E(y),x&&E(d),N=!1,xe(V)}}}function El(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Ml(){document.getElementById("load_geojson").click()}function Ol(r,e,t){let n;ie(r,ne,h=>t(0,n=h));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=window.localStorage.getItem(s);if(a)try{ne.set(f(JSON.parse(a)))}catch(h){console.log(`Failed to load from local storage: ${h}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(ne.update(h=>(delete h.scheme_name,h.features=[],h)),Me.set(null),He.set(null),Gt.set(null),zt.set(null))}function u(){const h=JSON.parse(JSON.stringify(n));for(let g of h.features)delete g.properties.hide_while_editing;return h}function p(){let h=u();var g=s;h.authority=i,h.origin="atip-v1",h.scheme_name&&(g+="_"+h.scheme_name),g+=".txt",El(g,JSON.stringify(h,null,"  "))}function _(h){const g=new FileReader;g.onload=y=>{try{ne.set(f(JSON.parse(y.target.result)))}catch(d){window.alert(`Couldn't load scheme from a file: ${d}`)}};let m=h.target.files;g.readAsText(m[0])}function f(h){let g=1;for(let m of h.features)m.properties||(m.properties={name:"",description:"",intervention_type:"other"}),m.geometry.type=="LineString"&&!m.properties.length_meters&&(m.properties.length_meters=ln(m,{units:"kilometers"})*1e3),m.id=g++;return h}function c(){n.scheme_name=this.value,ne.set(n)}return r.$$set=h=>{"authorityName"in h&&t(4,i=h.authorityName),"schema"in h&&t(5,o=h.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,p,_,i,o,s,c]}class Ll extends Q{constructor(e){super(),ee(this,e,Ol,Sl,K,{authorityName:4,schema:5})}}const Cl="/atip/speed_limit/assets/zoom_out_map-b2e1091a.svg";function Rl(r){let e,t,n,i,o;return{c(){e=k("button"),t=k("img"),lo(t.src,n=Cl)||O(t,"src",n),O(t,"alt","Zoom to show entire boundary"),O(e,"type","button"),O(e,"title","Zoom to show entire boundary"),O(e,"class","svelte-qzjsqo")},m(s,a){S(s,e,a),w(e,t),i||(o=B(e,"click",r[0]),i=!0)},p:G,i:G,o:G,d(s){s&&E(e),i=!1,o()}}}function Al(r,e,t){let n;ie(r,Ue,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(nr(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class $l extends Q{constructor(e){super(),ee(this,e,Al,Rl,K,{boundaryGeojson:1})}}function Tl(r){let e,t,n,i,o,s,a;return{c(){e=k("div"),t=J(`Basemap:
  `),n=k("select"),i=k("option"),i.textContent="Streets",o=k("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&Lt(()=>r[2].call(n)),O(e,"class","svelte-1tbnm6i")},m(l,u){S(l,e,u),w(e,t),w(e,n),w(n,i),w(n,o),wt(n,r[0]),s||(a=[B(n,"change",r[2]),B(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&wt(n,l[0])},i:G,o:G,d(l){l&&E(e),s=!1,xe(a)}}}function xl(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=rr(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class Il extends Q{constructor(e){super(),ee(this,e,xl,Tl,K,{style:0})}}function Pl(r){let e,t,n,i,o,s,a,l,u,p,_,f,c,h,g;return{c(){e=k("li"),t=k("span"),n=J("Areas"),i=A(),o=k("li"),s=k("span"),a=J("Routes"),l=A(),u=k("li"),p=k("span"),_=J("Crossings"),f=A(),c=k("li"),h=k("span"),g=J("Other"),O(t,"class","svelte-p551i1"),fe(t,"background",ue.area),O(s,"class","svelte-p551i1"),fe(s,"background",ue.route),O(p,"class","svelte-p551i1"),fe(p,"background",ue.crossing),O(h,"class","svelte-p551i1"),fe(h,"background",ue.other)},m(m,y){S(m,e,y),w(e,t),w(e,n),S(m,i,y),S(m,o,y),w(o,s),w(o,a),S(m,l,y),S(m,u,y),w(u,p),w(u,_),S(m,f,y),S(m,c,y),w(c,h),w(c,g)},p:G,d(m){m&&E(e),m&&E(i),m&&E(o),m&&E(l),m&&E(u),m&&E(f),m&&E(c)}}}function Fl(r){let e,t,n,i,o,s,a,l,u,p,_,f,c,h,g;return{c(){e=k("li"),t=k("span"),n=J("Preapp"),i=A(),o=k("li"),s=k("span"),a=J("Outline"),l=A(),u=k("li"),p=k("span"),_=J("Reserved matters"),f=A(),c=k("li"),h=k("span"),g=J("Local plan"),O(t,"class","svelte-p551i1"),fe(t,"background",ue.preapp),O(s,"class","svelte-p551i1"),fe(s,"background",ue.outline),O(p,"class","svelte-p551i1"),fe(p,"background",ue["reserved matters"]),O(h,"class","svelte-p551i1"),fe(h,"background",ue["local plan"])},m(m,y){S(m,e,y),w(e,t),w(e,n),S(m,i,y),S(m,o,y),w(o,s),w(o,a),S(m,l,y),S(m,u,y),w(u,p),w(u,_),S(m,f,y),S(m,c,y),w(c,h),w(c,g)},p:G,d(m){m&&E(e),m&&E(i),m&&E(o),m&&E(l),m&&E(u),m&&E(f),m&&E(c)}}}function Nl(r){let e,t,n,i;function o(l,u){return l[0]=="planning"?Fl:Pl}let s=o(r),a=s(r);return{c(){e=k("div"),t=k("h1"),t.textContent="Interventions",n=A(),i=k("ul"),a.c(),O(t,"class","svelte-p551i1"),O(e,"class","svelte-p551i1")},m(l,u){S(l,e,u),w(e,t),w(e,n),w(e,i),a.m(i,null)},p(l,[u]){s===(s=o(l))&&a?a.p(l,u):(a.d(1),a=s(l),a&&(a.c(),a.m(i,null)))},i:G,o:G,d(l){l&&E(e),a.d()}}}function Bl(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class Dl extends Q{constructor(e){super(),ee(this,e,Bl,Nl,K,{schema:0})}}let at="interventions";function jl(r,e,t){let n,i;ie(r,Ue,p=>t(1,n=p)),ie(r,ne,p=>t(2,i=p));let{schema:o}=e;it(n,at,{type:"geojson",data:i});const s=["match",["get","intervention_type"],"area",ue.area,"route",ue.route,"crossing",ue.crossing,"other",ue.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",ue.preapp,"outline",ue.outline,"reserved matters",ue["reserved matters"],"local plan",ue["local plan"],"white"],l=["!=","hide_while_editing",!0];return Ee(n,{id:"interventions-points",source:at,filter:["all",En,l,["!=","endpoint",!0]],...Ct(s,Ln)}),Ee(n,{id:"interventions-lines",source:at,filter:["all",Mn,l],...kt(s,Yt)},"route-lines"),Ee(n,{id:"interventions-lines-endpoints",source:at,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Yt,"circle-opacity":0,"circle-stroke-color":ue.lineEndpointColor,"circle-stroke-width":2}}),Ee(n,{id:"interventions-polygons",source:at,filter:["all",On,l],...Sn(o=="planning"?a:s,.5)},"hover-polygons"),r.$$set=p=>{"schema"in p&&t(0,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(i)),_=[];for(let f of p.features)if(f.geometry.type=="LineString")for(let c of[f.geometry.coordinates[0],f.geometry.coordinates[f.geometry.coordinates.length-1]])_.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:c}});p.features=p.features.concat(_),n.getSource(at).setData(p)}},[o,n,i]}class ql extends Q{constructor(e){super(),ee(this,e,jl,null,K,{schema:0})}}let ut="hover";function Ul(r,e,t){let n,i,o,s,a;return ie(r,Ue,l=>t(0,n=l)),ie(r,ne,l=>t(1,i=l)),ie(r,Gt,l=>t(2,o=l)),ie(r,He,l=>t(3,s=l)),ie(r,Me,l=>t(4,a=l)),it(n,ut,{type:"geojson",data:Fe()}),Ee(n,{id:"hover-polygons",source:ut,filter:On,...kt(ue.hovering,.5*Yt,1)}),Ee(n,{id:"hover-lines",source:ut,filter:Mn,...kt(ue.hovering,1.5*Yt,1)},"interventions-lines"),Ee(n,{id:"hover-points",source:ut,filter:En,...Ct(ue.hovering,1.5*Ln,1)},"interventions-points"),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(ut).setData(i.features.find(u=>u.id==l)):n.getSource(ut).setData(Fe())}},[n,i,o,s,a]}class Gl extends Q{constructor(e){super(),ee(this,e,Ul,null,K,{})}}class ar{constructor(e,t){re(this,"owner");re(this,"map");re(this,"mapHandlers",{});re(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const en="edit-point-mode";class zl{constructor(e){re(this,"map");re(this,"active");re(this,"eventListenersSuccess");re(this,"eventListenersFailure");re(this,"cursor");re(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new ar(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),it(e,en,{type:"geojson",data:Fe()}),Ee(e,{id:"edit-point-mode",source:en,...Ct(ue.hovering,Ln,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=Hl(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(en),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Fe();this.cursor&&e.features.push(this.cursor),this.map.getSource(en).setData(e)}}function Hl(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function $i(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Yl(r,e);var n=nt(r),i=nt(e),o=je(n[0]),s=je(i[0]),a=je(n[1]),l=je(i[1]),u=Math.sin(s-o)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return Bn(Math.atan2(u,p))}function Yl(r,e){var t=$i(e,r);return t=(t+180)%360,t}function Hr(r,e,t,n){n===void 0&&(n={});var i=nt(r),o=je(i[0]),s=je(i[1]),a=je(t),l=ao(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),_=Bn(p),f=Bn(u);return vt([_,f],n.properties)}function Wn(r){if(!r)throw new Error("geojson is required");var e=[];return ir(r,function(t){Jl(t,e)}),tt(e)}function Jl(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ye(n);break;case"LineString":t=[Ye(n)]}t.forEach(function(i){var o=Xl(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Xl(r,e){var t=[];return r.reduce(function(n,i){var o=Et([n,i],e);return o.bbox=Wl(n,i),t.push(o),i}),t}function Wl(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var Ot={},Vl={get exports(){return Ot},set exports(r){Ot=r}},Vn={},Kl={get exports(){return Vn},set exports(r){Vn=r}};(function(r,e){(function(t,n){r.exports=n()})(uo,function(){function t(d,b,v,M,L){(function T(R,I,F,N,V){for(;N>F;){if(N-F>600){var x=N-F+1,D=I-F+1,se=Math.log(x),he=.5*Math.exp(2*se/3),z=.5*Math.sqrt(se*he*(x-he)/x)*(D-x/2<0?-1:1),le=Math.max(F,Math.floor(I-D*he/x+z)),Re=Math.min(N,Math.floor(I+(x-D)*he/x+z));T(R,I,le,Re,V)}var Be=R[I],ye=F,pe=N;for(n(R,F,I),V(R[N],Be)>0&&n(R,F,N);ye<pe;){for(n(R,ye,pe),ye++,pe--;V(R[ye],Be)<0;)ye++;for(;V(R[pe],Be)>0;)pe--}V(R[F],Be)===0?n(R,F,pe):n(R,++pe,N),pe<=I&&(F=pe+1),I<=pe&&(N=pe-1)}})(d,b,v||0,M||d.length-1,L||i)}function n(d,b,v){var M=d[b];d[b]=d[v],d[v]=M}function i(d,b){return d<b?-1:d>b?1:0}var o=function(d){d===void 0&&(d=9),this._maxEntries=Math.max(4,d),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(d,b,v){if(!v)return b.indexOf(d);for(var M=0;M<b.length;M++)if(v(d,b[M]))return M;return-1}function a(d,b){l(d,0,d.children.length,b,d)}function l(d,b,v,M,L){L||(L=m(null)),L.minX=1/0,L.minY=1/0,L.maxX=-1/0,L.maxY=-1/0;for(var T=b;T<v;T++){var R=d.children[T];u(L,d.leaf?M(R):R)}return L}function u(d,b){return d.minX=Math.min(d.minX,b.minX),d.minY=Math.min(d.minY,b.minY),d.maxX=Math.max(d.maxX,b.maxX),d.maxY=Math.max(d.maxY,b.maxY),d}function p(d,b){return d.minX-b.minX}function _(d,b){return d.minY-b.minY}function f(d){return(d.maxX-d.minX)*(d.maxY-d.minY)}function c(d){return d.maxX-d.minX+(d.maxY-d.minY)}function h(d,b){return d.minX<=b.minX&&d.minY<=b.minY&&b.maxX<=d.maxX&&b.maxY<=d.maxY}function g(d,b){return b.minX<=d.maxX&&b.minY<=d.maxY&&b.maxX>=d.minX&&b.maxY>=d.minY}function m(d){return{children:d,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(d,b,v,M,L){for(var T=[b,v];T.length;)if(!((v=T.pop())-(b=T.pop())<=M)){var R=b+Math.ceil((v-b)/M/2)*M;t(d,R,b,v,L),T.push(b,R,R,v)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(d){var b=this.data,v=[];if(!g(d,b))return v;for(var M=this.toBBox,L=[];b;){for(var T=0;T<b.children.length;T++){var R=b.children[T],I=b.leaf?M(R):R;g(d,I)&&(b.leaf?v.push(R):h(d,I)?this._all(R,v):L.push(R))}b=L.pop()}return v},o.prototype.collides=function(d){var b=this.data;if(!g(d,b))return!1;for(var v=[];b;){for(var M=0;M<b.children.length;M++){var L=b.children[M],T=b.leaf?this.toBBox(L):L;if(g(d,T)){if(b.leaf||h(d,T))return!0;v.push(L)}}b=v.pop()}return!1},o.prototype.load=function(d){if(!d||!d.length)return this;if(d.length<this._minEntries){for(var b=0;b<d.length;b++)this.insert(d[b]);return this}var v=this._build(d.slice(),0,d.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var M=this.data;this.data=v,v=M}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},o.prototype.insert=function(d){return d&&this._insert(d,this.data.height-1),this},o.prototype.clear=function(){return this.data=m([]),this},o.prototype.remove=function(d,b){if(!d)return this;for(var v,M,L,T=this.data,R=this.toBBox(d),I=[],F=[];T||I.length;){if(T||(T=I.pop(),M=I[I.length-1],v=F.pop(),L=!0),T.leaf){var N=s(d,T.children,b);if(N!==-1)return T.children.splice(N,1),I.push(T),this._condense(I),this}L||T.leaf||!h(T,R)?M?(v++,T=M.children[v],L=!1):T=null:(I.push(T),F.push(v),v=0,M=T,T=T.children[0])}return this},o.prototype.toBBox=function(d){return d},o.prototype.compareMinX=function(d,b){return d.minX-b.minX},o.prototype.compareMinY=function(d,b){return d.minY-b.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(d){return this.data=d,this},o.prototype._all=function(d,b){for(var v=[];d;)d.leaf?b.push.apply(b,d.children):v.push.apply(v,d.children),d=v.pop();return b},o.prototype._build=function(d,b,v,M){var L,T=v-b+1,R=this._maxEntries;if(T<=R)return a(L=m(d.slice(b,v+1)),this.toBBox),L;M||(M=Math.ceil(Math.log(T)/Math.log(R)),R=Math.ceil(T/Math.pow(R,M-1))),(L=m([])).leaf=!1,L.height=M;var I=Math.ceil(T/R),F=I*Math.ceil(Math.sqrt(R));y(d,b,v,F,this.compareMinX);for(var N=b;N<=v;N+=F){var V=Math.min(N+F-1,v);y(d,N,V,I,this.compareMinY);for(var x=N;x<=V;x+=I){var D=Math.min(x+I-1,V);L.children.push(this._build(d,x,D,M-1))}}return a(L,this.toBBox),L},o.prototype._chooseSubtree=function(d,b,v,M){for(;M.push(b),!b.leaf&&M.length-1!==v;){for(var L=1/0,T=1/0,R=void 0,I=0;I<b.children.length;I++){var F=b.children[I],N=f(F),V=(x=d,D=F,(Math.max(D.maxX,x.maxX)-Math.min(D.minX,x.minX))*(Math.max(D.maxY,x.maxY)-Math.min(D.minY,x.minY))-N);V<T?(T=V,L=N<L?N:L,R=F):V===T&&N<L&&(L=N,R=F)}b=R||b.children[0]}var x,D;return b},o.prototype._insert=function(d,b,v){var M=v?d:this.toBBox(d),L=[],T=this._chooseSubtree(M,this.data,b,L);for(T.children.push(d),u(T,M);b>=0&&L[b].children.length>this._maxEntries;)this._split(L,b),b--;this._adjustParentBBoxes(M,L,b)},o.prototype._split=function(d,b){var v=d[b],M=v.children.length,L=this._minEntries;this._chooseSplitAxis(v,L,M);var T=this._chooseSplitIndex(v,L,M),R=m(v.children.splice(T,v.children.length-T));R.height=v.height,R.leaf=v.leaf,a(v,this.toBBox),a(R,this.toBBox),b?d[b-1].children.push(R):this._splitRoot(v,R)},o.prototype._splitRoot=function(d,b){this.data=m([d,b]),this.data.height=d.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(d,b,v){for(var M,L,T,R,I,F,N,V=1/0,x=1/0,D=b;D<=v-b;D++){var se=l(d,0,D,this.toBBox),he=l(d,D,v,this.toBBox),z=(L=se,T=he,R=void 0,I=void 0,F=void 0,N=void 0,R=Math.max(L.minX,T.minX),I=Math.max(L.minY,T.minY),F=Math.min(L.maxX,T.maxX),N=Math.min(L.maxY,T.maxY),Math.max(0,F-R)*Math.max(0,N-I)),le=f(se)+f(he);z<V?(V=z,M=D,x=le<x?le:x):z===V&&le<x&&(x=le,M=D)}return M||v-b},o.prototype._chooseSplitAxis=function(d,b,v){var M=d.leaf?this.compareMinX:p,L=d.leaf?this.compareMinY:_;this._allDistMargin(d,b,v,M)<this._allDistMargin(d,b,v,L)&&d.children.sort(M)},o.prototype._allDistMargin=function(d,b,v,M){d.children.sort(M);for(var L=this.toBBox,T=l(d,0,b,L),R=l(d,v-b,v,L),I=c(T)+c(R),F=b;F<v-b;F++){var N=d.children[F];u(T,d.leaf?L(N):N),I+=c(T)}for(var V=v-b-1;V>=b;V--){var x=d.children[V];u(R,d.leaf?L(x):x),I+=c(R)}return I},o.prototype._adjustParentBBoxes=function(d,b,v){for(var M=v;M>=0;M--)u(b[M],d)},o.prototype._condense=function(d){for(var b=d.length-1,v=void 0;b>=0;b--)d[b].children.length===0?b>0?(v=d[b-1].children).splice(v.indexOf(d[b]),1):this.clear():a(d[b],this.toBBox)},o})})(Kl);const Zl=or(fo),Ql=or(co),ea=or(po);var Ge=Vn,Ti=Zl,xi=Ql,ft=ea.default,ta=xi.featureEach;xi.coordEach;Ti.polygon;var Yr=Ti.featureCollection;function Ii(r){var e=new Ge(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ft(t),Ge.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ft(i),n.push(i)}):ta(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ft(i),n.push(i)}),Ge.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ft(t),Ge.prototype.remove.call(this,t,n)},e.clear=function(){return Ge.prototype.clear.call(this)},e.search=function(t){var n=Ge.prototype.search.call(this,this.toBBox(t));return Yr(n)},e.collides=function(t){return Ge.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ge.prototype.all.call(this);return Yr(t)},e.toJSON=function(){return Ge.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ge.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ft(t);else if(t.type==="FeatureCollection")n=ft(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Vl.exports=Ii;Ot.default=Ii;function Pi(r,e){var t={},n=[];if(r.type==="LineString"&&(r=gr(r)),e.type==="LineString"&&(e=gr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Jr(r,e);return i&&n.push(i),tt(n)}var o=Ot();return o.load(Wn(e)),dn(Wn(r),function(s){dn(o.search(s),function(a){var l=Jr(s,a);if(l){var u=Ye(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),tt(n)}function Jr(r,e){var t=Ye(r),n=Ye(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],_=n[1][1],f=(_-u)*(s-i)-(p-l)*(a-o),c=(p-l)*(o-u)-(_-u)*(i-l),h=(s-i)*(o-u)-(a-o)*(i-l);if(f===0)return c===0&&h===0,null;var g=c/f,m=h/f;if(g>=0&&g<=1&&m>=0&&m<=1){var y=i+g*(s-i),d=o+g*(a-o);return vt([y,d])}return null}function Jt(r,e,t){t===void 0&&(t={});var n=vt([1/0,1/0],{dist:1/0}),i=0;return ir(r,function(o){for(var s=Ye(o),a=0;a<s.length-1;a++){var l=vt(s[a]);l.properties.dist=Ze(e,l,t);var u=vt(s[a+1]);u.properties.dist=Ze(e,u,t);var p=Ze(l,u,t),_=Math.max(l.properties.dist,u.properties.dist),f=$i(l,u),c=Hr(e,_,f+90,t),h=Hr(e,_,f-90,t),g=Pi(Et([c.geometry.coordinates,h.geometry.coordinates]),Et([l.geometry.coordinates,u.geometry.coordinates])),m=null;g.features.length>0&&(m=g.features[0],m.properties.dist=Ze(e,m,t),m.properties.location=i+Ze(l,m,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+p),m&&m.properties.dist<n.properties.dist&&(n=m,n.properties.index=a),i+=p}}),n}const ct="edit-polygon-mode";class na{constructor(e){re(this,"map");re(this,"active");re(this,"eventListenersSuccess");re(this,"eventListenersFailure");re(this,"points");re(this,"cursor");re(this,"hover");re(this,"dragFrom");re(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new ar(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),it(e,ct,{type:"geojson",data:Fe()}),Ee(e,{id:"edit-polygon-fill",source:ct,filter:On,...Sn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Ee(e,{id:"edit-polygon-lines",source:ct,filter:Mn,...kt("black",8,.5)}),Ee(e,{id:"edit-polygon-vertices",source:ct,filter:En,...Ct(ue.hovering,Ln,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(Wr(this.points).forEach((n,i)=>{t.push([i+1,Jt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(ct),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Fe();this.points.forEach((n,i)=>{let o=Xr(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(Wr(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(ct).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Xr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function Xr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Wr(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let W;const Ve=new Array(32).fill(void 0);Ve.push(void 0,null,!0,!1);function X(r){return Ve[r]}let jt=Ve.length;function ra(r){r<36||(Ve[r]=jt,jt=r)}function Kn(r){const e=X(r);return ra(r),e}const Fi=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Fi.decode();let an=new Uint8Array;function qt(){return an.byteLength===0&&(an=new Uint8Array(W.memory.buffer)),an}function ht(r,e){return Fi.decode(qt().subarray(r,r+e))}function ke(r){jt===Ve.length&&Ve.push(Ve.length+1);const e=jt;return jt=Ve[e],Ve[e]=r,e}function In(r){return r==null}let un=new Float64Array;function ia(){return un.byteLength===0&&(un=new Float64Array(W.memory.buffer)),un}let fn=new Int32Array;function Se(){return fn.byteLength===0&&(fn=new Int32Array(W.memory.buffer)),fn}let et=0;const cn=new TextEncoder("utf-8"),oa=typeof cn.encodeInto=="function"?function(r,e){return cn.encodeInto(r,e)}:function(r,e){const t=cn.encode(r);return e.set(t),{read:r.length,written:t.length}};function tn(r,e,t){if(t===void 0){const a=cn.encode(r),l=e(a.length);return qt().subarray(l,l+a.length).set(a),et=a.length,l}let n=r.length,i=e(n);const o=qt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=qt().subarray(i+s,i+n),l=oa(r,a);s+=l.written}return et=s,i}function Zn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Zn(r[0]));for(let s=1;s<i;s++)o+=", "+Zn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function sa(r,e){const t=e(r.length*1);return qt().set(r,t/1),et=r.length,t}function Pn(r,e){try{return r.apply(this,e)}catch(t){W.__wbindgen_exn_store(ke(t))}}class yn{static __wrap(e){const t=Object.create(yn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();W.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=W.__wbindgen_add_to_stack_pointer(-16),s=sa(e,W.__wbindgen_malloc),a=et;W.jsroutesnapper_new(o,s,a);var t=Se()[o/4+0],n=Se()[o/4+1],i=Se()[o/4+2];if(i)throw Kn(n);return yn.__wrap(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){W.jsroutesnapper_setConfig(this.ptr,ke(e))}toFinalFeature(){try{const n=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_toFinalFeature(n,this.ptr);var e=Se()[n/4+0],t=Se()[n/4+1];let i;return e!==0&&(i=ht(e,t).slice(),W.__wbindgen_free(e,t*1)),i}finally{W.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_renderGeojson(n,this.ptr);var e=Se()[n/4+0],t=Se()[n/4+1];return ht(e,t)}finally{W.__wbindgen_add_to_stack_pointer(16),W.__wbindgen_free(e,t)}}setSnapMode(e){W.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return W.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){W.jsroutesnapper_onClick(this.ptr)}onDragStart(){return W.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return W.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){W.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=W.__wbindgen_add_to_stack_pointer(-16);W.jsroutesnapper_editExisting(i,this.ptr,ke(e));var t=Se()[i/4+0],n=Se()[i/4+1];if(n)throw Kn(t)}finally{W.__wbindgen_add_to_stack_pointer(16)}}}async function la(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function aa(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Kn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=X(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ht(e,t));return ke(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=ht(e,t);return ke(n)},r.wbg.__wbindgen_is_object=function(e){const t=X(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return X(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return X(e)in X(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=X(t),i=typeof n=="number"?n:void 0;ia()[e/8+1]=In(i)?0:i,Se()[e/4+0]=!In(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return X(e)==X(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=X(t),i=typeof n=="string"?n:void 0;var o=In(i)?0:tn(i,W.__wbindgen_malloc,W.__wbindgen_realloc),s=et;Se()[e/4+1]=s,Se()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(X(t)),i=tn(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=et;Se()[e/4+1]=o,Se()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=X(e);return ke(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=X(e)[X(t)];return ke(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(X(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(X(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(X(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(X(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(X(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=X(e)[t>>>0];return ke(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return X(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof X(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=X(e).next;return ke(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Pn(function(e){const t=X(e).next();return ke(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return X(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=X(e).value;return ke(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ke(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Pn(function(e,t){const n=Reflect.get(X(e),X(t));return ke(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Pn(function(e,t){const n=X(e).call(X(t));return ke(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(X(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=X(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=X(e).buffer;return ke(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(X(e));return ke(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){X(e).set(X(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return X(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=X(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ke(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=X(t).stack,i=tn(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=et;Se()[e/4+1]=o,Se()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(ht(e,t))}finally{W.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=Zn(X(t)),i=tn(n,W.__wbindgen_malloc,W.__wbindgen_realloc),o=et;Se()[e/4+1]=o,Se()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ht(e,t))},r.wbg.__wbindgen_memory=function(){const e=W.memory;return ke(e)},r}function ua(r,e){return W=r.exports,Ni.__wbindgen_wasm_module=e,un=new Float64Array,fn=new Int32Array,an=new Uint8Array,W}async function Ni(r){typeof r>"u"&&(r="/atip/speed_limit/assets/route_snapper_bg.wasm");const e=aa();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await la(await r,e);return ua(t,n)}const Tt="route-snapper",Vr=10,fa=30;class ca{constructor(e,t){re(this,"map");re(this,"inner");re(this,"active");re(this,"eventListenersSuccessRoute");re(this,"eventListenersSuccessArea");re(this,"eventListenersFailure");re(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new yn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],it(e,Tt,{type:"geojson",data:Fe()}),Ee(e,{id:"route-points",source:Tt,filter:En,...Ct(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",Vr/2,Vr])}),Ee(e,{id:"route-lines",source:Tt,filter:Mn,...kt("black",2.5)}),Ee(e,{id:"route-polygons",source:Tt,filter:On,...Sn("black",.5)}),this.events=new ar(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-fa,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Tt).setData(JSON.parse(this.inner.renderGeojson()))}}function Kr(r){let e;function t(o,s){return o[1]?da:pa}let n=t(r),i=n(r);return{c(){i.c(),e=be()},m(o,s){i.m(o,s),S(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&E(e)}}}function pa(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function da(r){let e;return{c(){e=k("p"),e.textContent="Edit attributes to the left, or click another intervention"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function ha(r){let e,t=r[0]==_t&&Kr(r);return{c(){t&&t.c(),e=be()},m(n,i){t&&t.m(n,i),S(n,e,i)},p(n,[i]){n[0]==_t?t?t.p(n,i):(t=Kr(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&E(e)}}}const _t="edit-attribute";function Bi(){}function _a(r,e,t){let n,i,o,s;ie(r,Ue,c=>t(5,n=c)),ie(r,ne,c=>t(6,i=c)),ie(r,zt,c=>t(7,o=c)),ie(r,Me,c=>t(1,s=c));let{mode:a}=e,{changeMode:l}=e;function u(){Me.set(null)}n.on("mousemove",p),n.on("mouseout",_),n.on("click",f),Xt(()=>{n.off("mousemove",p),n.off("mouseout",_),n.off("click",f)});function p(c){var h;if(a==_t){let g=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});He.set(((h=g[0])==null?void 0:h.id)||null)}}function _(){a==_t&&He.set(null)}function f(c){if(a==_t){let h=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});h.length>0?Me.set(h[0].id):Me.set(null)}}return r.$$set=c=>{"mode"in c&&t(0,a=c.mode),"changeMode"in c&&t(2,l=c.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let c=o;if(c){let h=i.features.find(g=>g.id==c);h.geometry.type=="Point"?n.flyTo({center:h.geometry.coordinates,duration:500}):n.fitBounds(nr(h),{padding:200,duration:500}),l(_t)}}},[a,s,l,Bi,u,n,i,o]}class ma extends Q{constructor(e){super(),ee(this,e,_a,ha,K,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Bi}get stop(){return this.$$.ctx[4]}}function ga(r){let e,t;return{c:G,m(n,i){e||(t=B(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function ba(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class Cn extends Q{constructor(e){super(),ee(this,e,ba,ga,K,{tool:1})}}function ya(r){let e;return{c(){e=k("li"),e.textContent="Click to add a new point"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function va(r){let e;return{c(){e=k("li"),e.textContent="Click to move the point here"},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function wa(r){let e,t,n,i,o,s,a,l,u,p;function _(h,g){return h[1]?va:ya}let f=_(r),c=f(r);return a=new Cn({props:{tool:r[0]}}),{c(){e=k("ul"),c.c(),t=A(),n=k("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=A(),o=k("button"),o.textContent="Cancel",s=A(),j(a.$$.fragment),O(o,"type","button")},m(h,g){S(h,e,g),c.m(e,null),w(e,t),w(e,n),S(h,i,g),S(h,o,g),S(h,s,g),q(a,h,g),l=!0,u||(p=B(o,"click",r[2]),u=!0)},p(h,[g]){f!==(f=_(h))&&(c.d(1),c=f(h),c&&(c.c(),c.m(e,t)));const m={};g&1&&(m.tool=h[0]),a.$set(m)},i(h){l||(C(a.$$.fragment,h),l=!0)},o(h){$(a.$$.fragment,h),l=!1},d(h){h&&E(e),c.d(),h&&E(i),h&&E(o),h&&E(s),U(a,h),u=!1,p()}}}function ka(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Di extends Q{constructor(e){super(),ee(this,e,ka,wa,K,{pointTool:0,editingExisting:1})}}function Zr(r){let e,t,n;const i=r[3].default,o=mt(i,r,r[2],null);return{c(){e=k("div"),o&&o.c()},m(s,a){S(s,e,a),o&&o.m(e,null),n=!0},p(s,a){o&&o.p&&(!n||a&4)&&gt(o,i,s,s[2],n?yt(i,s[2],a,null):bt(s[2]),null)},i(s){n||(C(o,s),Lt(()=>{t||(t=St(e,Mt,{duration:100},!0)),t.run(1)}),n=!0)},o(s){$(o,s),t||(t=St(e,Mt,{duration:100},!1)),t.run(0),n=!1},d(s){s&&E(e),o&&o.d(s),s&&t&&t.end()}}}function Sa(r){let e,t,n,i,o,s,a,l,u,p,_=r[1]&&Zr(r);return{c(){e=k("button"),t=pn("svg"),n=pn("path"),i=A(),o=J(r[0]),s=A(),_&&_.c(),a=be(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-una9lq"),O(e,"aria-expanded",r[1]),O(e,"class","svelte-una9lq")},m(f,c){S(f,e,c),w(e,t),w(t,n),w(e,i),w(e,o),S(f,s,c),_&&_.m(f,c),S(f,a,c),l=!0,u||(p=B(e,"click",r[4]),u=!0)},p(f,[c]){(!l||c&1)&&Je(o,f[0]),(!l||c&2)&&O(e,"aria-expanded",f[1]),f[1]?_?(_.p(f,c),c&2&&C(_,1)):(_=Zr(f),_.c(),C(_,1),_.m(a.parentNode,a)):_&&(me(),$(_,1,1,()=>{_=null}),ge())},i(f){l||(C(_),l=!0)},o(f){$(_),l=!1},d(f){f&&E(e),f&&E(s),_&&_.d(f),f&&E(a),u=!1,p()}}}function Ea(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,s=!1;const a=()=>t(1,s=!s);return r.$$set=l=>{"label"in l&&t(0,o=l.label),"$$scope"in l&&t(2,i=l.$$scope)},[o,s,i,n,a]}class ur extends Q{constructor(e){super(),ee(this,e,Ea,Sa,K,{label:0})}}function Ma(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},p:G,d(t){t&&E(e)}}}function Oa(r){let e,t,n,i,o,s,a,l,u,p,_;return e=new ur({props:{label:"Help",$$slots:{default:[Ma]},$$scope:{ctx:r}}}),l=new Cn({props:{tool:r[0]}}),{c(){j(e.$$.fragment),t=A(),n=k("div"),i=k("button"),i.textContent="Finish",o=A(),s=k("button"),s.textContent="Cancel",a=A(),j(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),fe(n,"display","flex"),fe(n,"justify-content","space-between")},m(f,c){q(e,f,c),S(f,t,c),S(f,n,c),w(n,i),w(n,o),w(n,s),S(f,a,c),q(l,f,c),u=!0,p||(_=[B(i,"click",r[1]),B(s,"click",r[2])],p=!0)},p(f,[c]){const h={};c&8&&(h.$$scope={dirty:c,ctx:f}),e.$set(h);const g={};c&1&&(g.tool=f[0]),l.$set(g)},i(f){u||(C(e.$$.fragment,f),C(l.$$.fragment,f),u=!0)},o(f){$(e.$$.fragment,f),$(l.$$.fragment,f),u=!1},d(f){U(e,f),f&&E(t),f&&E(n),f&&E(a),U(l,f),p=!1,xe(_)}}}function La(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class ji extends Q{constructor(e){super(),ee(this,e,La,Oa,K,{polygonTool:0})}}function Ca(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},p:G,d(t){t&&E(e)}}}function Ra(r){let e,t,n,i,o,s,a,l,u,p,_;return e=new ur({props:{label:"Help",$$slots:{default:[Ca]},$$scope:{ctx:r}}}),l=new Cn({props:{tool:r[0]}}),{c(){j(e.$$.fragment),t=A(),n=k("div"),i=k("button"),i.textContent="Finish",o=A(),s=k("button"),s.textContent="Cancel",a=A(),j(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),fe(n,"display","flex"),fe(n,"justify-content","space-between")},m(f,c){q(e,f,c),S(f,t,c),S(f,n,c),w(n,i),w(n,o),w(n,s),S(f,a,c),q(l,f,c),u=!0,p||(_=[B(i,"click",r[1]),B(s,"click",r[2])],p=!0)},p(f,[c]){const h={};c&8&&(h.$$scope={dirty:c,ctx:f}),e.$set(h);const g={};c&1&&(g.tool=f[0]),l.$set(g)},i(f){u||(C(e.$$.fragment,f),C(l.$$.fragment,f),u=!0)},o(f){$(e.$$.fragment,f),$(l.$$.fragment,f),u=!1},d(f){U(e,f),f&&E(t),f&&E(n),f&&E(a),U(l,f),p=!1,xe(_)}}}function Aa(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class qi extends Q{constructor(e){super(),ee(this,e,Aa,Ra,K,{routeTool:0})}}function $a(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},p:G,d(t){t&&E(e)}}}function Ta(r){let e,t,n,i,o,s,a,l,u,p,_,f,c,h,g;return e=new ur({props:{label:"Help",$$slots:{default:[$a]},$$scope:{ctx:r}}}),f=new Cn({props:{tool:r[0]}}),{c(){j(e.$$.fragment),t=A(),n=k("label"),i=k("input"),o=J(`
  Avoid doubling back`),s=A(),a=k("div"),l=k("button"),l.textContent="Finish",u=A(),p=k("button"),p.textContent="Cancel",_=A(),j(f.$$.fragment),O(i,"type","checkbox"),O(l,"type","button"),O(p,"type","button"),fe(a,"display","flex"),fe(a,"justify-content","space-between")},m(m,y){q(e,m,y),S(m,t,y),S(m,n,y),w(n,i),i.checked=r[1],w(n,o),S(m,s,y),S(m,a,y),w(a,l),w(a,u),w(a,p),S(m,_,y),q(f,m,y),c=!0,h||(g=[B(i,"change",r[2]),B(l,"click",r[3]),B(p,"click",r[4])],h=!0)},p(m,[y]){const d={};y&32&&(d.$$scope={dirty:y,ctx:m}),e.$set(d),y&2&&(i.checked=m[1]);const b={};y&1&&(b.tool=m[0]),f.$set(b)},i(m){c||(C(e.$$.fragment,m),C(f.$$.fragment,m),c=!0)},o(m){$(e.$$.fragment,m),$(f.$$.fragment,m),c=!1},d(m){U(e,m),m&&E(t),m&&E(n),m&&E(s),m&&E(a),m&&E(_),U(f,m),h=!1,xe(g)}}}function xa(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class Ui extends Q{constructor(e){super(),ee(this,e,xa,Ta,K,{routeTool:0})}}function Qr(r){let e,t,n,i;const o=[Ba,Na,Fa,Pa,Ia],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=be()},m(l,u){s[e].m(l,u),S(l,n,u),i=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(me(),$(s[p],1,1,()=>{s[p]=null}),ge(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),C(t,1),t.m(n.parentNode,n))},i(l){i||(C(t),i=!0)},o(l){$(t),i=!1},d(l){s[e].d(l),l&&E(n)}}}function Ia(r){let e;return{c(){e=k("p"),e.textContent="Click an intervention to edit its geometry"},m(t,n){S(t,e,n)},p:G,i:G,o:G,d(t){t&&E(e)}}}function Pa(r){let e,t;return e=new Ui({props:{routeTool:r[3]}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Fa(r){let e,t;return e=new qi({props:{routeTool:r[3]}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Na(r){let e,t;return e=new ji({props:{polygonTool:r[2]}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Ba(r){let e,t;return e=new Di({props:{pointTool:r[1],editingExisting:!0}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Da(r){let e,t,n=r[0]==Xe&&Qr(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==Xe?n?(n.p(i,o),o&1&&C(n,1)):(n=Qr(i),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(me(),$(n,1,1,()=>{n=null}),ge())},i(i){t||(C(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const Xe="edit-geometry";function Gi(){}function ja(r,e,t){let n;ie(r,Ue,g=>t(8,n=g));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(o.stop(),s.stop(),a.stop(),ne.update(g=>{let m=g.features.find(y=>y.id==l);return delete m.properties.hide_while_editing,g})),l=null,t(4,u=null),He.set(null)}n.on("mousemove",_),n.on("mouseout",f),n.on("click",c),Xt(()=>{n.off("mousemove",_),n.off("mouseout",f),n.off("click",c)}),a.addEventListenerSuccessRoute(g=>{i==Xe&&(ne.update(m=>{let y=m.features.find(d=>d.id==l);return y.properties.length_meters=g.properties.length_meters,y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,m}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{i==Xe&&(ne.update(m=>{let y=m.features.find(d=>d.id==l);return y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,m}),l=null,t(4,u=null))});for(let g of[o,s])g.addEventListenerSuccess(m=>{i==Xe&&(ne.update(y=>{let d=y.features.find(b=>b.id==l);return d.geometry=m.geometry,delete d.properties.hide_while_editing,y}),l=null,t(4,u=null))});for(let g of[o,s,a])g.addEventListenerFailure(()=>{i==Xe&&(ne.update(m=>{let y=m.features.find(d=>d.id==l);return delete y.properties.hide_while_editing,m}),l=null,t(4,u=null))});function _(g){var m;if(i==Xe&&l==null){let y=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});He.set(((m=y[0])==null?void 0:m.id)||null)}}function f(){i==Xe&&l==null&&He.set(null)}function c(g){if(i==Xe&&l==null){let m=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0&&h(m[0].id)}}function h(g){He.set(null);let m=null;ne.update(d=>(m=d.features.find(b=>b.id==g),m.properties.hide_while_editing=!0,d));let y=m;l=g,y.geometry.type=="LineString"?(a.editExistingRoute(y),t(4,u="route")):y.geometry.type=="Polygon"?y.properties.waypoints?(a.editExistingArea(y),t(4,u="snap-polygon")):(s.editExisting(y),t(4,u="free-polygon")):y.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"pointTool"in g&&t(1,o=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[i,o,s,a,u,Gi,p]}class qa extends Q{constructor(e){super(),ee(this,e,ja,Da,K,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Gi}get stop(){return this.$$.ctx[6]}}async function Ua(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),o+=p.length;const _=100*o/i;e.style=`background: linear-gradient(to right, red ${_}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function Ga(r){let e,t;return e=new Ui({props:{routeTool:r[0]}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function za(r){let e;return{c(){e=k("div"),e.textContent="Route tool loading..."},m(t,n){S(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&E(e),r[7](null)}}}function Ha(r){let e,t,n,i;const o=[za,Ga],s=[];function a(l,u){return l[0]?l[1]==Qn?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=be()},m(l,u){~e&&s[e].m(l,u),S(l,n,u),i=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(me(),$(s[p],1,1,()=>{s[p]=null}),ge()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),C(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(C(t),i=!0)},o(l){$(t),i=!1},d(l){~e&&s[e].d(l),l&&E(n)}}}const Qn="route";function Ya(r,e,t){let n;ie(r,Ue,f=>t(8,n=f));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}tr(async()=>{await Ni(),console.log(`Grabbing ${s}`);try{const f=await Ua(s,a);t(0,l=new ca(n,f))}catch(f){console.log(`Route tool broke: ${f}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==Qn&&o("edit-attribute")}),l.addEventListenerSuccessRoute(f=>{i==Qn&&(ne.update(c=>(f.id=Wt(c),f.properties.intervention_type="route",c.features.push(f),c)),o("edit-attribute"),Me.set(f.id))})});function _(f){oe[f?"unshift":"push"](()=>{a=f,t(2,a)})}return r.$$set=f=>{"mode"in f&&t(1,i=f.mode),"changeMode"in f&&t(3,o=f.changeMode),"url"in f&&t(4,s=f.url),"routeTool"in f&&t(0,l=f.routeTool)},[l,i,a,o,s,u,p,_]}class Ja extends Q{constructor(e){super(),ee(this,e,Ya,Ha,K,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function ei(r){let e,t;return e=new Di({props:{pointTool:r[1],editingExisting:!1}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Xa(r){let e,t,n=r[0]==vn&&ei(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==vn?n?(n.p(i,o),o&1&&C(n,1)):(n=ei(i),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(me(),$(n,1,1,()=>{n=null}),ge())},i(i){t||(C(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const vn="point";function Wa(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==vn&&(ne.update(u=>(l.id=Wt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),Me.set(l.id))}),o.addEventListenerFailure(()=>{n==vn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class Va extends Q{constructor(e){super(),ee(this,e,Wa,Xa,K,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ti(r){let e,t;return e=new ji({props:{polygonTool:r[1]}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function Ka(r){let e,t,n=r[0]==wn&&ti(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==wn?n?(n.p(i,o),o&1&&C(n,1)):(n=ti(i),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(me(),$(n,1,1,()=>{n=null}),ge())},i(i){t||(C(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const wn="free-polygon";function Za(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==wn&&(ne.update(u=>(l.id=Wt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Me.set(l.id))}),o.addEventListenerFailure(()=>{n==wn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Qa extends Q{constructor(e){super(),ee(this,e,Za,Ka,K,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ni(r){let e,t;return e=new qi({props:{routeTool:r[1]}}),{c(){j(e.$$.fragment)},m(n,i){q(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){U(e,n)}}}function eu(r){let e,t,n=r[0]==kn&&ni(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),S(i,e,o),t=!0},p(i,[o]){i[0]==kn?n?(n.p(i,o),o&1&&C(n,1)):(n=ni(i),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(me(),$(n,1,1,()=>{n=null}),ge())},i(i){t||(C(n),t=!0)},o(i){$(n),t=!1},d(i){n&&n.d(i),i&&E(e)}}}const kn="snap-polygon";function tu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==kn&&(ne.update(u=>(l.id=Wt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Me.set(l.id))}),o.addEventListenerFailure(()=>{n==kn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class nu extends Q{constructor(e){super(),ee(this,e,tu,eu,K,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ru(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Ze(r.slice(0,2),[n,t]),s=Ze(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function iu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return ho(r,function(s){ou(s,o,n)}),r}function ou(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function su(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Xn(r),n=Xn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=iu(e,{precision:7});switch(n){case"Point":return er(r,i);case"MultiPoint":return ri(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return ri(r,Pi(r,i))}}function ri(r,e){var t=[],n=Ot();return ir(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=er(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=ru(_o(a)))}),n.load(tt(t));else{var o=n.search(i);if(o.features.length){var s=zi(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),dn(er(s,i),function(a){t.push(a),n.insert(a)})}}}),tt(t)}function er(r,e){var t=[],n=Ye(r)[0],i=Ye(r)[r.geometry.coordinates.length-1];if(Fn(n,nt(e))||Fn(i,nt(e)))return tt([r]);var o=Ot(),s=Wn(r);o.load(s);var a=o.search(e);if(!a.features.length)return tt([r]);var l=zi(e,a),u=[n],p=mo(s,function(_,f,c){var h=Ye(f)[1],g=nt(e);return c===l.id?(_.push(g),t.push(Et(_)),Fn(g,h)?[g]:[g,h]):(_.push(h),_)},u);return p.length>1&&t.push(Et(p)),tt(t)}function zi(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return dn(e,function(i){var o=Jt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function Fn(r,e){return r[0]===e[0]&&r[1]===e[1]}function lu(r,e,t){var n=Ye(t);if(Xn(t)!=="LineString")throw new Error("line must be a LineString");var i=Jt(t,r),o=Jt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),Et(a,t.properties)}function ii(r){let e;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){S(t,e,n)},d(t){t&&E(e)}}}function au(r){let e,t,n,i=r[0]==Ut&&ii();return{c(){i&&i.c(),e=be()},m(o,s){i&&i.m(o,s),S(o,e,s),t||(n=B(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Ut?i||(i=ii(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:G,o:G,d(o){i&&i.d(o),o&&E(e),t=!1,n()}}}const Ut="split-route",uu=10,fu=30;let Nn="split-route";function Hi(){}function oi(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function cu(r,e,t){let n,i;ie(r,ne,g=>t(8,n=g)),ie(r,Ue,g=>t(6,i=g));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",p),i.on("click",_),Xt(()=>{i.off("mousemove",p),i.off("click",_)}),it(i,Nn,{type:"geojson",data:Fe()}),Ee(i,{id:"draw-split-route",source:Nn,...Ct("black",uu,["case",["==",["get","snapped"],!0],1,.5])});function p(g){if(o!=Ut)return;t(5,l=oi(g.lngLat.toArray(),!1)),u=null;const m=[g.point.x-fu,g.point.y],y=i.unproject(g.point).distanceTo(i.unproject(m))/1e3;let d=[];for(let[b,v]of n.features.entries())if(v.geometry.type=="LineString"){let M=Jt(v.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=y&&d.push([b,M.geometry.coordinates,M.properties.dist])}d.sort((b,v)=>b[2]-v[2]),d.length>0&&(t(5,l=oi(d[0][1],!0)),u=d[0][0])}function _(){if(o==Ut)if(u==null)s("edit-attribute");else{let g=su(n.features[u],l);if(g.features.length==2){let m=g.features[0],y=g.features[1];ne.update(d=>(m.id=d.features[u].id,y.id=Wt(d),m.properties=JSON.parse(JSON.stringify(d.features[u].properties)),y.properties=JSON.parse(JSON.stringify(m.properties)),f(d.features[u],m,y,l),d.features.splice(u,1,m,y),d))}a()}}function f(g,m,y,d){m.properties.length_meters=ln(m,{units:"kilometers"})*1e3,y.properties.length_meters=ln(y,{units:"kilometers"})*1e3,m.properties.waypoints=[],y.properties.waypoints=[];let b=c(g,d),v=!0,M=0;for(let L of g.properties.waypoints){let T=c(g,vt([L.lon,L.lat]));if(v)if(T<b)m.properties.waypoints.push(L);else{let R=L.snapped&&g.properties.waypoints[M-1].snapped;m.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:R}),v=!1,y.properties.waypoints.push({lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1],snapped:R}),y.properties.waypoints.push(L)}else y.properties.waypoints.push(L);M++}}function c(g,m){let y=g.geometry.coordinates[0],d=lu(y,m,g);return ln(d,{units:"kilometers"})*1e3}function h(g){o==Ut&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=Fe();l&&g.features.push(l),i.getSource(Nn).setData(g)}},[o,h,s,Hi,a,l,i]}class pu extends Q{constructor(e){super(),ee(this,e,cu,au,K,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Hi}get stop(){return this.$$.ctx[4]}}function si(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new qa({props:n}),r[17](e),{c(){j(e.$$.fragment)},m(i,o){q(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){r[17](null),U(e,i)}}}function li(r){let e,t,n,i,o;return{c(){e=k("button"),t=J("New point"),O(e,"type","button"),e.disabled=n=r[3]=="point",O(e,"class","svelte-1yde1zx")},m(s,a){S(s,e,a),w(e,t),i||(o=B(e,"click",r[18]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="point")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function ai(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new nu({props:n}),r[23](e),{c(){j(e.$$.fragment)},m(i,o){q(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){$(e.$$.fragment,i),t=!1},d(i){r[23](null),U(e,i)}}}function ui(r){let e,t,n,i,o;return{c(){e=k("button"),t=J("New route"),O(e,"type","button"),e.disabled=n=r[3]=="route",O(e,"class","svelte-1yde1zx")},m(s,a){S(s,e,a),w(e,t),i||(o=B(e,"click",r[24]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="route")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function fi(r){let e,t,n,i,o;return{c(){e=k("button"),t=J("Split route"),O(e,"type","button"),e.disabled=n=r[3]=="split-route",O(e,"class","svelte-1yde1zx")},m(s,a){S(s,e,a),w(e,t),i||(o=B(e,"click",r[27]),i=!0)},p(s,a){a&8&&n!==(n=s[3]=="split-route")&&(e.disabled=n)},d(s){s&&E(e),i=!1,o()}}}function du(r){let e,t,n,i,o,s,a,l,u,p,_,f,c,h,g,m,y,d,b,v,M,L,T,R,I,F,N,V,x,D,se,he,z,le,Re,Be,ye,pe,Ie,De,ae,P,Z={mode:r[3],changeMode:r[13]};a=new ma({props:Z}),r[15](a);let ve=r[2]&&si(r),Ae=r[1]!="planning"&&li(r),Yi={mode:r[3],changeMode:r[13],pointTool:r[11]};y=new Va({props:Yi}),r[19](y);let Ji={mode:r[3],changeMode:r[13],polygonTool:r[12]};R=new Qa({props:Ji}),r[21](R);let we=r[2]&&ai(r),$e=r[1]!="planning"&&ui(r);function Xi(Y){r[26](Y)}let fr={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(fr.routeTool=r[2]),le=new Ja({props:fr}),r[25](le),oe.push(()=>Oe(le,"routeTool",Xi,r[2]));let Te=r[1]!="planning"&&fi(r),Wi={mode:r[3],changeMode:r[13]};return Ie=new pu({props:Wi}),r[28](Ie),{c(){e=k("div"),t=k("div"),n=k("button"),i=J("Edit attributes"),s=A(),j(a.$$.fragment),l=A(),u=k("div"),p=k("button"),_=J("Edit geometry"),c=A(),ve&&ve.c(),h=A(),g=k("div"),Ae&&Ae.c(),m=A(),j(y.$$.fragment),d=A(),b=k("div"),v=k("button"),M=J("New polygon (freehand)"),T=A(),j(R.$$.fragment),I=A(),F=k("div"),N=k("button"),V=J("New polygon (snapped)"),D=A(),we&&we.c(),se=A(),he=k("div"),$e&&$e.c(),z=A(),j(le.$$.fragment),Be=A(),ye=k("div"),Te&&Te.c(),pe=A(),j(Ie.$$.fragment),O(n,"type","button"),n.disabled=o=r[3]=="edit-attribute",O(n,"class","svelte-1yde1zx"),O(p,"type","button"),p.disabled=f=r[3]=="edit-geometry",O(p,"class","svelte-1yde1zx"),O(v,"type","button"),v.disabled=L=r[3]=="free-polygon",O(v,"class","svelte-1yde1zx"),O(N,"type","button"),N.disabled=x=r[3]=="snap-polygon",O(N,"class","svelte-1yde1zx"),O(e,"class","toolbox svelte-1yde1zx")},m(Y,de){S(Y,e,de),w(e,t),w(t,n),w(n,i),w(t,s),q(a,t,null),w(e,l),w(e,u),w(u,p),w(p,_),w(u,c),ve&&ve.m(u,null),w(e,h),w(e,g),Ae&&Ae.m(g,null),w(g,m),q(y,g,null),w(e,d),w(e,b),w(b,v),w(v,M),w(b,T),q(R,b,null),w(e,I),w(e,F),w(F,N),w(N,V),w(F,D),we&&we.m(F,null),w(e,se),w(e,he),$e&&$e.m(he,null),w(he,z),q(le,he,null),w(e,Be),w(e,ye),Te&&Te.m(ye,null),w(ye,pe),q(Ie,ye,null),De=!0,ae||(P=[B(n,"click",r[14]),B(p,"click",r[16]),B(v,"click",r[20]),B(N,"click",r[22])],ae=!0)},p(Y,[de]){(!De||de&8&&o!==(o=Y[3]=="edit-attribute"))&&(n.disabled=o);const cr={};de&8&&(cr.mode=Y[3]),a.$set(cr),(!De||de&8&&f!==(f=Y[3]=="edit-geometry"))&&(p.disabled=f),Y[2]?ve?(ve.p(Y,de),de&4&&C(ve,1)):(ve=si(Y),ve.c(),C(ve,1),ve.m(u,null)):ve&&(me(),$(ve,1,1,()=>{ve=null}),ge()),Y[1]!="planning"?Ae?Ae.p(Y,de):(Ae=li(Y),Ae.c(),Ae.m(g,m)):Ae&&(Ae.d(1),Ae=null);const pr={};de&8&&(pr.mode=Y[3]),y.$set(pr),(!De||de&8&&L!==(L=Y[3]=="free-polygon"))&&(v.disabled=L);const dr={};de&8&&(dr.mode=Y[3]),R.$set(dr),(!De||de&8&&x!==(x=Y[3]=="snap-polygon"))&&(N.disabled=x),Y[2]?we?(we.p(Y,de),de&4&&C(we,1)):(we=ai(Y),we.c(),C(we,1),we.m(F,null)):we&&(me(),$(we,1,1,()=>{we=null}),ge()),Y[1]!="planning"?$e?$e.p(Y,de):($e=ui(Y),$e.c(),$e.m(he,z)):$e&&($e.d(1),$e=null);const Kt={};de&8&&(Kt.mode=Y[3]),de&1&&(Kt.url=Y[0]),!Re&&de&4&&(Re=!0,Kt.routeTool=Y[2],Le(()=>Re=!1)),le.$set(Kt),Y[1]!="planning"?Te?Te.p(Y,de):(Te=fi(Y),Te.c(),Te.m(ye,pe)):Te&&(Te.d(1),Te=null);const hr={};de&8&&(hr.mode=Y[3]),Ie.$set(hr)},i(Y){De||(C(a.$$.fragment,Y),C(ve),C(y.$$.fragment,Y),C(R.$$.fragment,Y),C(we),C(le.$$.fragment,Y),C(Ie.$$.fragment,Y),De=!0)},o(Y){$(a.$$.fragment,Y),$(ve),$(y.$$.fragment,Y),$(R.$$.fragment,Y),$(we),$(le.$$.fragment,Y),$(Ie.$$.fragment,Y),De=!1},d(Y){Y&&E(e),r[15](null),U(a),ve&&ve.d(),Ae&&Ae.d(),r[19](null),U(y),r[21](null),U(R),we&&we.d(),$e&&$e.d(),r[25](null),U(le),Te&&Te.d(),r[28](null),U(Ie),ae=!1,xe(P)}}}function hu(r,e,t){let n;ie(r,Ue,z=>t(29,n=z));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new zl(n),l=new na(n),u="edit-attribute",p,_,f,c,h,g,m;function y(z){let le={"edit-attribute":p,"edit-geometry":_,route:f,point:c,"free-polygon":h,"snap-polygon":g,"split-route":m};if(u==z){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),le[u].stop(),t(3,u=z),console.log(`Starting new mode ${u}`),le[u].start()}Xt(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});const d=()=>y("edit-attribute");function b(z){oe[z?"unshift":"push"](()=>{p=z,t(4,p)})}const v=()=>y("edit-geometry");function M(z){oe[z?"unshift":"push"](()=>{_=z,t(5,_)})}const L=()=>y("point");function T(z){oe[z?"unshift":"push"](()=>{c=z,t(7,c)})}const R=()=>y("free-polygon");function I(z){oe[z?"unshift":"push"](()=>{h=z,t(8,h)})}const F=()=>y("snap-polygon");function N(z){oe[z?"unshift":"push"](()=>{g=z,t(9,g)})}const V=()=>y("route");function x(z){oe[z?"unshift":"push"](()=>{f=z,t(6,f)})}function D(z){s=z,t(2,s)}const se=()=>y("split-route");function he(z){oe[z?"unshift":"push"](()=>{m=z,t(10,m)})}return r.$$set=z=>{"routeSnapperUrl"in z&&t(0,i=z.routeSnapperUrl),"schema"in z&&t(1,o=z.schema)},[i,o,s,u,p,_,f,c,h,g,m,a,l,y,d,b,v,M,L,T,R,I,F,N,V,x,D,se,he]}class _u extends Q{constructor(e){super(),ee(this,e,hu,du,K,{routeSnapperUrl:0,schema:1})}}function mu(r){let e,t,n,i,o,s,a,l,u,p,_,f,c,h,g,m,y,d,b;return{c(){e=k("div"),t=k("div"),n=k("button"),n.textContent="Home",i=A(),o=k("button"),o.textContent="About",s=A(),a=k("button"),a.textContent="Instructions",l=A(),u=k("br"),p=A(),_=k("label"),f=J(`ATIP schema:
      `),c=k("select"),h=k("option"),h.textContent="v1",g=k("option"),g.textContent="v2",m=k("option"),m.textContent="Housing developments",y=k("option"),y.textContent="Critical issues",O(n,"type","button"),O(o,"type","button"),O(a,"type","button"),h.__value="v1",h.value=h.__value,g.__value="v2",g.value=g.__value,m.__value="planning",m.value=m.__value,y.__value="criticals",y.value=y.__value,r[2]===void 0&&Lt(()=>r[12].call(c)),O(e,"slot","nav")},m(v,M){S(v,e,M),w(e,t),w(t,n),w(t,i),w(t,o),w(t,s),w(t,a),w(e,l),w(e,u),w(e,p),w(e,_),w(_,f),w(_,c),w(c,h),w(c,g),w(c,m),w(c,y),wt(c,r[2]),d||(b=[B(n,"click",r[11]),B(o,"click",r[8]),B(a,"click",r[9]),B(c,"change",r[12]),B(c,"change",r[10])],d=!0)},p(v,M){M&4&&wt(c,v[2])},d(v){v&&E(e),d=!1,xe(b)}}}function gu(r){let e,t,n,i,o,s,a,l,u,p,_,f;return o=new $l({props:{boundaryGeojson:r[5]}}),a=new Ll({props:{authorityName:r[6],schema:r[2]}}),_=new kl({props:{schema:r[2],routeInfo:r[4]}}),{c(){e=k("div"),t=k("h1"),n=J(r[6]),i=A(),j(o.$$.fragment),s=A(),j(a.$$.fragment),l=A(),u=k("br"),p=A(),j(_.$$.fragment),O(e,"slot","sidebar")},m(c,h){S(c,e,h),w(e,t),w(t,n),w(t,i),q(o,t,null),w(e,s),q(a,e,null),w(e,l),w(e,u),w(e,p),q(_,e,null),f=!0},p(c,h){const g={};h&32&&(g.boundaryGeojson=c[5]),o.$set(g);const m={};h&4&&(m.schema=c[2]),a.$set(m);const y={};h&4&&(y.schema=c[2]),h&16&&(y.routeInfo=c[4]),_.$set(y)},i(c){f||(C(o.$$.fragment,c),C(a.$$.fragment,c),C(_.$$.fragment,c),f=!0)},o(c){$(o.$$.fragment,c),$(a.$$.fragment,c),$(_.$$.fragment,c),f=!1},d(c){c&&E(e),U(o),U(a),U(_)}}}function bu(r){let e,t,n,i,o,s,a,l,u,p,_,f;return e=new Os({props:{boundaryGeojson:r[5]}}),n=new ql({props:{schema:r[2]}}),o=new Gl({}),a=new _u({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new Il({props:{style:r[7]}}),_=new Dl({props:{schema:r[2]}}),{c(){j(e.$$.fragment),t=A(),j(n.$$.fragment),i=A(),j(o.$$.fragment),s=A(),j(a.$$.fragment),l=A(),j(u.$$.fragment),p=A(),j(_.$$.fragment)},m(c,h){q(e,c,h),S(c,t,h),q(n,c,h),S(c,i,h),q(o,c,h),S(c,s,h),q(a,c,h),S(c,l,h),q(u,c,h),S(c,p,h),q(_,c,h),f=!0},p(c,h){const g={};h&32&&(g.boundaryGeojson=c[5]),e.$set(g);const m={};h&4&&(m.schema=c[2]),n.$set(m);const y={};h&8&&(y.routeSnapperUrl=c[3]),h&4&&(y.schema=c[2]),a.$set(y);const d={};h&4&&(d.schema=c[2]),_.$set(d)},i(c){f||(C(e.$$.fragment,c),C(n.$$.fragment,c),C(o.$$.fragment,c),C(a.$$.fragment,c),C(u.$$.fragment,c),C(_.$$.fragment,c),f=!0)},o(c){$(e.$$.fragment,c),$(n.$$.fragment,c),$(o.$$.fragment,c),$(a.$$.fragment,c),$(u.$$.fragment,c),$(_.$$.fragment,c),f=!1},d(c){U(e,c),c&&E(t),U(n,c),c&&E(i),U(o,c),c&&E(s),U(a,c),c&&E(l),U(u,c),c&&E(p),U(_,c)}}}function yu(r){let e,t,n;return t=new Jo({props:{style:r[7],$$slots:{default:[bu]},$$scope:{ctx:r}}}),{c(){e=k("div"),j(t.$$.fragment),O(e,"slot","main")},m(i,o){S(i,e,o),q(t,e,null),n=!0},p(i,o){const s={};o&524332&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(C(t.$$.fragment,i),n=!0)},o(i){$(t.$$.fragment,i),n=!1},d(i){i&&E(e),U(t)}}}function vu(r){let e,t,n,i,o,s,a,l;e=new Qo({props:{$$slots:{main:[yu],sidebar:[gu],nav:[mu]},$$scope:{ctx:r}}});function u(c){r[13](c)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new go({props:p}),oe.push(()=>Oe(n,"open",u,r[0]));function _(c){r[14](c)}let f={};return r[1]!==void 0&&(f.open=r[1]),s=new zo({props:f}),oe.push(()=>Oe(s,"open",_,r[1])),{c(){j(e.$$.fragment),t=A(),j(n.$$.fragment),o=A(),j(s.$$.fragment)},m(c,h){q(e,c,h),S(c,t,h),q(n,c,h),S(c,o,h),q(s,c,h),l=!0},p(c,[h]){const g={};h&524348&&(g.$$scope={dirty:h,ctx:c}),e.$set(g);const m={};!i&&h&1&&(i=!0,m.open=c[0],Le(()=>i=!1)),n.$set(m);const y={};!a&&h&2&&(a=!0,y.open=c[1],Le(()=>a=!1)),s.$set(y)},i(c){l||(C(e.$$.fragment,c),C(n.$$.fragment,c),C(s.$$.fragment,c),l=!0)},o(c){$(e.$$.fragment,c),$(n.$$.fragment,c),$(s.$$.fragment,c),l=!1},d(c){U(e,c),c&&E(t),U(n,c),c&&E(o),U(s,c)}}}function wu(r,e,t){let n=!1,i=!1,o=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${a}.bin`,_=`https://atip.uk/route-info/${a}.bin`;o||(p=`https://atip.uk/route-snappers-dev/${a}.bin`,_=`https://atip.uk/route-info-dev/${a}.bin`);let f;function c(){t(0,n=!n),t(1,i=!1)}function h(){t(1,i=!i),t(0,n=!1)}let g;tr(async()=>{t(5,g=await m());const L=gi(new $o);t(4,f=await new L),await f.loadFile(_)});async function m(){const T=await(await fetch(bo)).text(),R=JSON.parse(T);return R.features=R.features.filter(I=>{var F;return((F=I.properties)==null?void 0:F.name)==a}),R}function y(){let L=new URLSearchParams(window.location.search);L.set("schema",u);let T=`${window.location.pathname}?${L.toString()}${window.location.hash}`;window.location.href=T}const d=()=>window.open("index.html");function b(){u=rr(this),t(2,u)}function v(L){n=L,t(0,n)}function M(L){i=L,t(1,i)}return[n,i,u,p,f,g,a,l,c,h,y,d,b,v,M]}class ku extends Q{constructor(e){super(),ee(this,e,wu,vu,K,{})}}new ku({target:document.getElementById("app")});
