var Qo=Object.defineProperty;var ei=(r,e,t)=>e in r?Qo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ie=(r,e,t)=>(ei(r,typeof e!="symbol"?e+"":e,t),t);import{S as V,i as K,s as W,M as ti,b as ae,a as Ee,d as N,m as B,k as Me,n as $,o as O,q as D,e as E,c as C,g as w,x as G,p as k,y as Ce,f as L,z as pe,B as de,C as ni,D as kn,E as Qt,F as rt,G as dt,H as ht,I as mt,J as _t,K as gr,h as S,l as U,L as ri,N as oi,O as se,P as ii,w as nr,Q as Ze,R as we,T as Sn,U as un,V as ue,t as X,W as fn,X as Et,Y as bt,r as Oe,Z as vt,_ as rr,$ as be,j as Re,a0 as xe,a1 as vo,a2 as yt,a3 as cn,a4 as br,a5 as si,a6 as li,a7 as Fe,a8 as ai,a9 as ui,aa as En,ab as Mt,ac as Mn,ad as $n,ae as Dn,af as fi,ag as gt,ah as or,ai as We,aj as wt,ak as ci,al as ir,am as pi,an as di,ao as hi,ap as vr,aq as pn,ar as mi,as as _i,at as gi,A as bi,u as vi}from"./authorities-fe906188.js";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const yo=Symbol("Comlink.proxy"),yi=Symbol("Comlink.endpoint"),wi=Symbol("Comlink.releaseProxy"),Cn=Symbol("Comlink.finalizer"),en=Symbol("Comlink.thrown"),wo=r=>typeof r=="object"&&r!==null||typeof r=="function",ki={canHandle:r=>wo(r)&&r[yo],serialize(r){const{port1:e,port2:t}=new MessageChannel;return sr(r,e),[t,[t]]},deserialize(r){return r.start(),Eo(r)}},Si={canHandle:r=>wo(r)&&en in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},ko=new Map([["proxy",ki],["throw",Si]]);function Ei(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function sr(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!Ei(t,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:s,path:a}=Object.assign({path:[]},o.data),l=(o.data.argumentList||[]).map(Qe);let u;try{const p=a.slice(0,-1).reduce((c,f)=>c[f],r),d=a.reduce((c,f)=>c[f],r);switch(s){case"GET":u=d;break;case"SET":p[a.slice(-1)[0]]=Qe(o.data.value),u=!0;break;case"APPLY":u=d.apply(p,l);break;case"CONSTRUCT":{const c=new d(...l);u=Ci(c)}break;case"ENDPOINT":{const{port1:c,port2:f}=new MessageChannel;sr(r,f),u=Ri(c,[c])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[en]:0}}Promise.resolve(u).catch(p=>({value:p,[en]:0})).then(p=>{const[d,c]=mn(p);e.postMessage(Object.assign(Object.assign({},d),{id:i}),c),s==="RELEASE"&&(e.removeEventListener("message",n),So(e),Cn in r&&typeof r[Cn]=="function"&&r[Cn]())}).catch(p=>{const[d,c]=mn({value:new TypeError("Unserializable return value"),[en]:0});e.postMessage(Object.assign(Object.assign({},d),{id:i}),c)})}),e.start&&e.start()}function Mi(r){return r.constructor.name==="MessagePort"}function So(r){Mi(r)&&r.close()}function Eo(r,e){return jn(r,[],e)}function Vt(r){if(r)throw new Error("Proxy has been released and is not useable")}function Mo(r){return ft(r,{type:"RELEASE"}).then(()=>{So(r)})}const dn=new WeakMap,hn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(dn.get(r)||0)-1;dn.set(r,e),e===0&&Mo(r)});function $i(r,e){const t=(dn.get(e)||0)+1;dn.set(e,t),hn&&hn.register(r,e,r)}function Li(r){hn&&hn.unregister(r)}function jn(r,e=[],t=function(){}){let n=!1;const o=new Proxy(t,{get(i,s){if(Vt(n),s===wi)return()=>{Li(o),Mo(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>o};const a=ft(r,{type:"GET",path:e.map(l=>l.toString())}).then(Qe);return a.then.bind(a)}return jn(r,[...e,s])},set(i,s,a){Vt(n);const[l,u]=mn(a);return ft(r,{type:"SET",path:[...e,s].map(p=>p.toString()),value:l},u).then(Qe)},apply(i,s,a){Vt(n);const l=e[e.length-1];if(l===yi)return ft(r,{type:"ENDPOINT"}).then(Qe);if(l==="bind")return jn(r,e.slice(0,-1));const[u,p]=yr(a);return ft(r,{type:"APPLY",path:e.map(d=>d.toString()),argumentList:u},p).then(Qe)},construct(i,s){Vt(n);const[a,l]=yr(s);return ft(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(Qe)}});return $i(o,r),o}function Oi(r){return Array.prototype.concat.apply([],r)}function yr(r){const e=r.map(mn);return[e.map(t=>t[0]),Oi(e.map(t=>t[1]))]}const $o=new WeakMap;function Ri(r,e){return $o.set(r,e),r}function Ci(r){return Object.assign(r,{[yo]:!0})}function mn(r){for(const[e,t]of ko)if(t.canHandle(r)){const[n,o]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:r},$o.get(r)||[]]}function Qe(r){switch(r.type){case"HANDLER":return ko.get(r.name).deserialize(r.value);case"RAW":return r.value}}function ft(r,e,t){return new Promise(n=>{const o=Ai();r.addEventListener("message",function i(s){!s.data||!s.data.id||s.data.id!==o||(r.removeEventListener("message",i),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:o},e),t)})}function Ai(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Ti(){return new Worker("/atip/speed_limit/assets/worker-151cf597.js")}let ee;const Ge=new Array(128).fill(void 0);Ge.push(void 0,null,!0,!1);function z(r){return Ge[r]}let Pt=Ge.length;function Ii(r){r<132||(Ge[r]=Pt,Pt=r)}function Ct(r){const e=z(r);return Ii(r),e}const Lo=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Lo.decode();let At=null;function xt(){return(At===null||At.byteLength===0)&&(At=new Uint8Array(ee.memory.buffer)),At}function et(r,e){return r=r>>>0,Lo.decode(xt().subarray(r,r+e))}function ge(r){Pt===Ge.length&&Ge.push(Ge.length+1);const e=Pt;return Pt=Ge[e],Ge[e]=r,e}let nt=0;const tn=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Fi=typeof tn.encodeInto=="function"?function(r,e){return tn.encodeInto(r,e)}:function(r,e){const t=tn.encode(r);return e.set(t),{read:r.length,written:t.length}};function An(r,e,t){if(t===void 0){const a=tn.encode(r),l=e(a.length)>>>0;return xt().subarray(l,l+a.length).set(a),nt=a.length,l}let n=r.length,o=e(n)>>>0;const i=xt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;i[o+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),o=t(o,n,n=s+r.length*3)>>>0;const a=xt().subarray(o+s,o+n),l=Fi(r,a);s+=l.written}return nt=s,o}function Lt(r){return r==null}let Tt=null;function ce(){return(Tt===null||Tt.byteLength===0)&&(Tt=new Int32Array(ee.memory.buffer)),Tt}let It=null;function Pi(){return(It===null||It.byteLength===0)&&(It=new Float64Array(ee.memory.buffer)),It}let Ft=null;function xi(){return(Ft===null||Ft.byteLength===0)&&(Ft=new BigInt64Array(ee.memory.buffer)),Ft}function qn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let i="[";o>0&&(i+=qn(r[0]));for(let s=1;s<o;s++)i+=", "+qn(r[s]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ni(r,e){const t=e(r.length*1)>>>0;return xt().set(r,t/1),nt=r.length,t}function Tn(r,e){try{return r.apply(this,e)}catch(t){ee.__wbindgen_exn_store(ge(t))}}let Un=class{static __wrap(e){e=e>>>0;const t=Object.create(Un.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();ee.__wbg_routeinfo_free(e)}constructor(e){try{const i=ee.__wbindgen_add_to_stack_pointer(-16),s=Ni(e,ee.__wbindgen_malloc),a=nt;ee.routeinfo_new(i,s,a);var t=ce()[i/4+0],n=ce()[i/4+1],o=ce()[i/4+2];if(o)throw Ct(n);return Un.__wrap(t)}finally{ee.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const p=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_nameForRoute(p,this.__wbg_ptr,ge(e));var o=ce()[p/4+0],i=ce()[p/4+1],s=ce()[p/4+2],a=ce()[p/4+3],l=o,u=i;if(a)throw l=0,u=0,Ct(s);return t=l,n=u,et(l,u)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const p=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_speedLimitForRoute(p,this.__wbg_ptr,ge(e));var o=ce()[p/4+0],i=ce()[p/4+1],s=ce()[p/4+2],a=ce()[p/4+3],l=o,u=i;if(a)throw l=0,u=0,Ct(s);return t=l,n=u,et(l,u)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(t,n)}}allSpeedLimits(){let e,t;try{const u=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_allSpeedLimits(u,this.__wbg_ptr);var n=ce()[u/4+0],o=ce()[u/4+1],i=ce()[u/4+2],s=ce()[u/4+3],a=n,l=o;if(s)throw a=0,l=0,Ct(i);return e=a,t=l,et(a,l)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(e,t)}}};async function Bi(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Di(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Ct(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=z(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(et(e,t));return ge(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=z(t),o=typeof n=="string"?n:void 0;var i=Lt(o)?0:An(o,ee.__wbindgen_malloc,ee.__wbindgen_realloc),s=nt;ce()[e/4+1]=s,ce()[e/4+0]=i},r.wbg.__wbindgen_is_bigint=function(e){return typeof z(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return ge(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return z(e)===z(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=z(t),o=typeof n=="number"?n:void 0;Pi()[e/8+1]=Lt(o)?0:o,ce()[e/4+0]=!Lt(o)},r.wbg.__wbindgen_is_object=function(e){const t=z(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return z(e)in z(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ge(t)},r.wbg.__wbindgen_is_undefined=function(e){return z(e)===void 0},r.wbg.__wbindgen_string_new=function(e,t){const n=et(e,t);return ge(n)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return z(e)==z(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=z(e);return ge(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=z(e)[z(t)];return ge(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=z(t).stack,o=An(n,ee.__wbindgen_malloc,ee.__wbindgen_realloc),i=nt;ce()[e/4+1]=i,ce()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(et(e,t))}finally{ee.__wbindgen_free(n,o)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(z(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(z(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(z(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(z(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(z(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=z(e)[t>>>0];return ge(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return z(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof z(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=z(e).next;return ge(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return Tn(function(e){const t=z(e).next();return ge(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return z(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=z(e).value;return ge(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return ge(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return Tn(function(e,t){const n=Reflect.get(z(e),z(t));return ge(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return Tn(function(e,t){const n=z(e).call(z(t));return ge(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(z(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=z(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(z(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(z(e));return ge(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=z(e).buffer;return ge(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(z(e));return ge(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){z(e).set(z(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return z(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=z(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=z(t),o=typeof n=="bigint"?n:void 0;xi()[e/8+1]=Lt(o)?BigInt(0):o,ce()[e/4+0]=!Lt(o)},r.wbg.__wbindgen_debug_string=function(e,t){const n=qn(z(t)),o=An(n,ee.__wbindgen_malloc,ee.__wbindgen_realloc),i=nt;ce()[e/4+1]=i,ce()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(et(e,t))},r.wbg.__wbindgen_memory=function(){const e=ee.memory;return ge(e)},r}function ji(r,e){return ee=r.exports,Oo.__wbindgen_wasm_module=e,Ft=null,It=null,Tt=null,At=null,ee}async function Oo(r){if(ee!==void 0)return ee;typeof r>"u"&&(r="/atip/speed_limit/assets/route_info_bg.wasm");const e=Di();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Bi(await r,e);return ji(t,n)}class qi{constructor(){ie(this,"inner");this.inner=null}async loadFile(e){await Oo(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new Un(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.speedLimitForRoute(e)}allSpeedLimits(){if(!this.inner)throw new Error("Need to loadFile before using RouteInfo");return this.inner.allSpeedLimits()}}sr(qi);function Ui(r){let e,t,n,o,i,s,a,l,u,p,d,c,f;return{c(){e=E("p"),e.textContent="For each intervention:",t=C(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,o=C(),i=E("p"),i.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=C(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=C(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=C(),d=E("p"),d.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=C(),f=E("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(h,_){w(h,e,_),w(h,t,_),w(h,n,_),w(h,o,_),w(h,i,_),w(h,s,_),w(h,a,_),w(h,l,_),w(h,u,_),w(h,p,_),w(h,d,_),w(h,c,_),w(h,f,_)},p:G,d(h){h&&k(e),h&&k(t),h&&k(n),h&&k(o),h&&k(i),h&&k(s),h&&k(a),h&&k(l),h&&k(u),h&&k(p),h&&k(d),h&&k(c),h&&k(f)}}}function Gi(r){let e,t,n;function o(s){r[1](s)}let i={title:"Instructions",$$slots:{default:[Ui]},$$scope:{ctx:r}};return r[0]!==void 0&&(i.open=r[0]),e=new ti({props:i}),ae.push(()=>Ee(e,"open",o,r[0])),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Hi(r,e,t){let{open:n}=e;function o(i){n=i,t(0,n)}return r.$$set=i=>{"open"in i&&t(0,n=i.open)},[n,o]}class zi extends V{constructor(e){super(),K(this,e,Hi,Gi,W,{open:0})}}const ot=[];function $t(r,e=G){let t;const n=new Set;function o(a){if(W(r,a)&&(r=a,t)){const l=!ot.length;for(const u of n)u[1](),ot.push(u,r);if(l){for(let u=0;u<ot.length;u+=2)ot[u][0](ot[u+1]);ot.length=0}}}function i(a){o(a(r))}function s(a,l=G){const u=[a,l];return n.add(u),n.size===1&&(t=e(o)||G),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:o,update:i,subscribe:s}}const Ae=$t(null),ne=$t(Ce()),Se=$t(null),je=$t(null),qt=$t(null),Ut=$t(null);function Yt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function wr(r){console.log(`Deleting intervention ${r}`),ne.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Se.set(null),je.set(null),qt.set(null),Ut.set(null)}function kr(r){let e;const t=r[4].default,n=dt(t,r,r[3],null);return{c(){n&&n.c()},m(o,i){n&&n.m(o,i),e=!0},p(o,i){n&&n.p&&(!e||i&8)&&ht(n,t,o,o[3],e?_t(t,o[3],i,null):mt(o[3]),null)},i(o){e||($(n,o),e=!0)},o(o){O(n,o),e=!1},d(o){n&&n.d(o)}}}function Yi(r){let e,t,n=r[1]&&kr(r);return{c(){e=E("div"),n&&n.c(),L(e,"class","map svelte-12dpf1u")},m(o,i){w(o,e,i),n&&n.m(e,null),r[5](e),t=!0},p(o,[i]){o[1]?n?(n.p(o,i),i&2&&$(n,1)):(n=kr(o),n.c(),$(n,1),n.m(e,null)):n&&(pe(),O(n,1,1,()=>{n=null}),de())},i(o){t||($(n),t=!0)},o(o){O(n),t=!1},d(o){o&&k(e),n&&n.d(),r[5](null)}}}function Ji(r,e,t){let{$$slots:n={},$$scope:o}=e,{style:i}=e,s,a,l=!1;ni("setCamera",!window.location.hash),kn(()=>{s=new Qt.Map({container:a,style:`https://api.maptiler.com/maps/${i}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new Qt.ScaleControl({})),s.addControl(new Qt.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ae.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),rt(()=>{s.remove()});function u(p){ae[p?"unshift":"push"](()=>{a=p,t(0,a)})}return r.$$set=p=>{"style"in p&&t(2,i=p.style),"$$scope"in p&&t(3,o=p.$$scope)},[a,l,i,o,n,u]}class Xi extends V{constructor(e){super(),K(this,e,Ji,Yi,W,{style:2})}}const Wi=r=>({}),Sr=r=>({}),Vi=r=>({}),Er=r=>({}),Ki=r=>({}),Mr=r=>({});function Zi(r){let e,t,n,o,i,s,a,l,u,p,d,c;const f=r[3].nav,h=dt(f,r,r[2],Mr),_=r[3].sidebar,g=dt(_,r,r[2],Er),v=r[3].main,m=dt(v,r,r[2],Sr);return{c(){e=E("aside"),t=E("div"),n=E("nav"),h&&h.c(),o=C(),g&&g.c(),i=C(),s=E("button"),s.textContent="→",l=C(),u=E("main"),m&&m.c(),L(n,"class","svelte-1u7vg8a"),L(t,"class","sidebar-content content-container svelte-1u7vg8a"),L(s,"type","button"),L(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),L(e,"class",a=gr(r[0]?"":"collapsed")+" svelte-1u7vg8a"),L(u,"class","svelte-1u7vg8a")},m(b,y){w(b,e,y),S(e,t),S(t,n),h&&h.m(n,null),S(t,o),g&&g.m(t,null),S(e,i),S(e,s),w(b,l,y),w(b,u,y),m&&m.m(u,null),p=!0,d||(c=U(s,"click",r[1]),d=!0)},p(b,[y]){h&&h.p&&(!p||y&4)&&ht(h,f,b,b[2],p?_t(f,b[2],y,Ki):mt(b[2]),Mr),g&&g.p&&(!p||y&4)&&ht(g,_,b,b[2],p?_t(_,b[2],y,Vi):mt(b[2]),Er),(!p||y&1&&a!==(a=gr(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&L(e,"class",a),m&&m.p&&(!p||y&4)&&ht(m,v,b,b[2],p?_t(v,b[2],y,Wi):mt(b[2]),Sr)},i(b){p||($(h,b),$(g,b),$(m,b),p=!0)},o(b){O(h,b),O(g,b),O(m,b),p=!1},d(b){b&&k(e),h&&h.d(b),g&&g.d(b),b&&k(l),b&&k(u),m&&m.d(b),d=!1,c()}}}function Qi(r,e,t){let{$$slots:n={},$$scope:o}=e,i=!0;function s(){t(0,i=!i)}return r.$$set=a=>{"$$scope"in a&&t(2,o=a.$$scope)},[i,s,o,n]}class es extends V{constructor(e){super(),K(this,e,Qi,Zi,W,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function ts(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,o=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){t.label=u[1];break}if(u[0]===6&&t.label<i[1]){t.label=i[1],i=u;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(u);break}i[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ke=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function ns(r,e){return r>e?1:r<e?-1:0}function ze(r,e,t){for(var n=new Ke(null,null),o=n,i=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}i.left=e,i=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}o.right=e,o=e,e=e.right}else break}return o.right=e.left,i.left=e.right,e.left=n.right,e.right=n.left,e}function In(r,e,t,n){var o=new Ke(r,e);if(t===null)return o.left=o.right=null,o;t=ze(r,t,n);var i=n(r,t.key);return i<0?(o.left=t.left,o.right=t,t.left=null):i>=0&&(o.right=t.right,o.left=t,t.right=null),o}function $r(r,e,t){var n=null,o=null;if(e){e=ze(r,e,t);var i=t(e.key,r);i===0?(n=e.left,o=e.right):i<0?(o=e.right,e.right=null,n=e):(n=e.left,e.left=null,o=e)}return{left:n,right:o}}function rs(r,e,t){return e===null?r:(r===null||(e=ze(r.key,e,t),e.left=r),e)}function Gn(r,e,t,n,o){if(r){n(""+e+(t?"└── ":"├── ")+o(r)+`
`);var i=e+(t?"    ":"│   ");r.left&&Gn(r.left,i,!1,n,o),r.right&&Gn(r.right,i,!0,n,o)}}var lr=function(){function r(e){e===void 0&&(e=ns),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=In(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ke(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var o=this._comparator,i=ze(e,this._root,o),s=o(e,i.key);return s===0?this._root=i:(s<0?(n.left=i.left,n.right=i,i.left=null):s>0&&(n.right=i.right,n.left=i,i.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var o;if(t===null)return null;t=ze(e,t,n);var i=n(e,t.key);return i===0?(t.left===null?o=t.right:(o=ze(e,t.left,n),o.right=t.right),this._size--,o):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ze(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return t;o<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ze(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return!0;o<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,o=[],i=!1;!i;)n!==null?(o.push(n),n=n.left):o.length!==0?(n=o.pop(),e.call(t,n),n=n.right):i=!0;return this},r.prototype.range=function(e,t,n,o){for(var i=[],s=this._comparator,a=this._root,l;i.length!==0||a;)if(a)i.push(a),a=a.left;else{if(a=i.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(o,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,o=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),o===e)return t;o++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var o=this._comparator;t;){var i=o(e.key,t.key);if(i===0)break;i<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var o=this._comparator;t;){var i=o(e.key,t.key);if(i===0)break;i<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return is(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var o=e.length,i=this._comparator;if(n&&Yn(e,t,0,o-1,i),this._root===null)this._root=Hn(e,t,0,o),this._size=o;else{var s=ss(this.toList(),os(e,t),i);o=this._size+o,this._root=zn({head:s},0,o)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Gn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var o=this._comparator,i=$r(e,this._root,o),s=i.left,a=i.right;o(e,t)<0?a=In(t,n,a,o):s=In(t,n,s,o),this._root=rs(s,a,o)},r.prototype.split=function(e){return $r(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return ts(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Hn(r,e,t,n){var o=n-t;if(o>0){var i=t+Math.floor(o/2),s=r[i],a=e[i],l=new Ke(s,a);return l.left=Hn(r,e,t,i),l.right=Hn(r,e,i+1,n),l}return null}function os(r,e){for(var t=new Ke(null,null),n=t,o=0;o<r.length;o++)n=n.next=new Ke(r[o],e[o]);return n.next=null,t.next}function is(r){for(var e=r,t=[],n=!1,o=new Ke(null,null),i=o;!n;)e?(t.push(e),e=e.left):t.length>0?(e=i=i.next=t.pop(),e=e.right):n=!0;return i.next=null,o.next}function zn(r,e,t){var n=t-e;if(n>0){var o=e+Math.floor(n/2),i=zn(r,e,o),s=r.head;return s.left=i,r.head=r.head.next,s.right=zn(r,o+1,t),s}return null}function ss(r,e,t){for(var n=new Ke(null,null),o=n,i=r,s=e;i!==null&&s!==null;)t(i.key,s.key)<0?(o.next=i,i=i.next):(o.next=s,s=s.next),o=o.next;return i!==null?o.next=i:s!==null&&(o.next=s),n.next}function Yn(r,e,t,n,o){if(!(t>=n)){for(var i=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(o(r[s],i)<0);do a--;while(o(r[a],i)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Yn(r,e,t,a,o),Yn(r,e,a+1,n,o)}}function Te(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Lr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function $e(r,e,t){return e&&Lr(r.prototype,e),t&&Lr(r,t),r}var Ot=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Jn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,o=e.ur.x<t.ur.x?e.ur.x:t.ur.x,i=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:i},ur:{x:o,y:s}}},Je=Number.EPSILON;Je===void 0&&(Je=Math.pow(2,-52));var ls=Je*Je,Xn=function(e,t){if(-Je<e&&e<Je&&-Je<t&&t<Je)return 0;var n=e-t;return n*n<ls*e*t?0:e<t?-1:1},as=function(){function r(){Te(this,r),this.reset()}return $e(r,[{key:"reset",value:function(){this.xRounder=new Or,this.yRounder=new Or}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Or=function(){function r(){Te(this,r),this.tree=new lr,this.round(0)}return $e(r,[{key:"round",value:function(t){var n=this.tree.add(t),o=this.tree.prev(n);if(o!==null&&Xn(n.key,o.key)===0)return this.tree.remove(t),o.key;var i=this.tree.next(n);return i!==null&&Xn(n.key,i.key)===0?(this.tree.remove(t),i.key):t}}]),r}(),Gt=new as,Nt=function(e,t){return e.x*t.y-e.y*t.x},Ro=function(e,t){return e.x*t.x+e.y*t.y},Rr=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y},s=Nt(o,i);return Xn(s,0)},_n=function(e){return Math.sqrt(Ro(e,e))},us=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return Nt(i,o)/_n(i)/_n(o)},fs=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return Ro(i,o)/_n(i)/_n(o)},Cr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Ar=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},cs=function(e,t,n,o){if(t.x===0)return Ar(n,o,e.x);if(o.x===0)return Ar(e,t,n.x);if(t.y===0)return Cr(n,o,e.y);if(o.y===0)return Cr(e,t,n.y);var i=Nt(t,o);if(i==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=Nt(s,t)/i,l=Nt(s,o)/i,u=e.x+l*t.x,p=n.x+a*o.x,d=e.y+l*t.y,c=n.y+a*o.y,f=(u+p)/2,h=(d+c)/2;return{x:f,y:h}},De=function(){$e(r,null,[{key:"compare",value:function(t,n){var o=r.comparePoints(t.point,n.point);return o!==0?o:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:gn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Te(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return $e(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,o=0,i=n.length;o<i;o++){var s=n[o];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var o=this.point.events[n];if(o.segment.consumedBy===void 0)for(var i=n+1;i<t;i++){var s=this.point.events[i];s.consumedBy===void 0&&o.otherSE.point.events===s.otherSE.point.events&&o.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,o=this.point.events.length;n<o;n++){var i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,o=new Map,i=function(a){var l=a.otherSE;o.set(a,{sine:us(n.point,t.point,l.point),cosine:fs(n.point,t.point,l.point)})};return function(s,a){o.has(s)||i(s),o.has(a)||i(a);var l=o.get(s),u=l.sine,p=l.cosine,d=o.get(a),c=d.sine,f=d.cosine;return u>=0&&c>=0?p<f?1:p>f?-1:0:u<0&&c<0?p<f?-1:p>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),ps=0,gn=function(){$e(r,null,[{key:"compare",value:function(t,n){var o=t.leftSE.point.x,i=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<o)return 1;if(s<i)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,d=n.rightSE.point.y;if(o<i){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(o>i){if(l<u&&l<d)return-1;if(l>u&&l>d)return 1;var h=n.comparePoint(t.leftSE.point);if(h!==0)return h;var _=t.comparePoint(n.rightSE.point);return _<0?1:_>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var g=n.comparePoint(t.rightSE.point);if(g!==0)return g}if(s>a){var v=t.comparePoint(n.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(s!==a){var m=p-l,b=s-o,y=d-u,M=a-i;if(m>b&&y<M)return 1;if(m<b&&y>M)return-1}return s>a?1:s<a||p<d?-1:p>d?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,o){Te(this,r),this.id=++ps,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=o}return $e(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,o=this.rightSE.point,i=this.vector();if(n.x===o.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/i.y,a=n.x+s*i.x;if(t.x===a)return 0;var l=(t.x-n.x)/i.x,u=n.y+l*i.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),o=t.bbox(),i=Jn(n,o);if(i===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=Ot(n,l)&&this.comparePoint(l)===0,d=Ot(o,s)&&t.comparePoint(s)===0,c=Ot(n,u)&&this.comparePoint(u)===0,f=Ot(o,a)&&t.comparePoint(a)===0;if(d&&p)return f&&!c?a:!f&&c?u:null;if(d)return c&&s.x===u.x&&s.y===u.y?null:s;if(p)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var h=cs(s,this.vector(),l,t.vector());return h===null||!Ot(i,h)?null:Gt.round(h.x,h.y)}},{key:"split",value:function(t){var n=[],o=t.events!==void 0,i=new De(t,!0),s=new De(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(i);var l=new r(i,a,this.rings.slice(),this.windings.slice());return De.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),De.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(i.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,o=this.windings.length;n<o;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,o=t;n.consumedBy;)n=n.consumedBy;for(;o.consumedBy;)o=o.consumedBy;var i=r.compare(n,o);if(i!==0){if(i>0){var s=n;n=o,o=s}if(n.prev===o){var a=n;n=o,o=a}for(var l=0,u=o.rings.length;l<u;l++){var p=o.rings[l],d=o.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(d)):n.windings[c]+=d}o.rings=null,o.windings=null,o.consumedBy=n,o.leftSE.consumedBy=n.leftSE,o.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,o=this._afterState.windings,i=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),o.push(u)):o[p]+=u}for(var d=[],c=[],f=0,h=n.length;f<h;f++)if(o[f]!==0){var _=n[f],g=_.poly;if(c.indexOf(g)===-1)if(_.isExterior)d.push(g);else{c.indexOf(g)===-1&&c.push(g);var v=d.indexOf(_.poly);v!==-1&&d.splice(v,1)}}for(var m=0,b=d.length;m<b;m++){var y=d[m].multiPoly;i.indexOf(y)===-1&&i.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Pe.type){case"union":{var o=t.length===0,i=n.length===0;this._isInResult=o!==i;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Pe.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(d){return d.length===1&&d[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Pe.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,o){var i,s,a,l=De.comparePoints(t,n);if(l<0)i=t,s=n,a=1;else if(l>0)i=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new De(i,!0),p=new De(s,!1);return new r(u,p,[o],[a])}}]),r}(),Tr=function(){function r(e,t,n){if(Te(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=Gt.round(e[0][0],e[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var i=o,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Gt.round(e[s][0],e[s][1]);l.x===i.x&&l.y===i.y||(this.segments.push(gn.fromRing(i,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),i=l)}(o.x!==i.x||o.y!==i.y)&&this.segments.push(gn.fromRing(i,o,this))}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,o=this.segments.length;n<o;n++){var i=this.segments[n];t.push(i.leftSE),t.push(i.rightSE)}return t}}]),r}(),ds=function(){function r(e,t){if(Te(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Tr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,o=e.length;n<o;n++){var i=new Tr(e[n],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,o=this.interiorRings.length;n<o;n++)for(var i=this.interiorRings[n].getSweepEvents(),s=0,a=i.length;s<a;s++)t.push(i[s]);return t}}]),r}(),Ir=function(){function r(e,t){if(Te(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,o=e.length;n<o;n++){var i=new ds(e[n],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=t}return $e(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,o=this.polys.length;n<o;n++)for(var i=this.polys[n].getSweepEvents(),s=0,a=i.length;s<a;s++)t.push(i[s]);return t}}]),r}(),hs=function(){$e(r,null,[{key:"factory",value:function(t){for(var n=[],o=0,i=t.length;o<i;o++){var s=t[o];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],d=l.point,c=[];a=l,l=u,p.push(l),l.point!==d;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var h=p[0].point,_=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(_.x,", ").concat(_.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var g=null,v=0,m=c.length;v<m;v++)if(c[v].point===l.point){g=v;break}if(g!==null){var b=c.splice(g)[0],y=p.splice(b.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}c.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Te(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return $e(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],o=1,i=this.events.length-1;o<i;o++){var s=this.events[o].point,a=this.events[o+1].point;Rr(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Rr(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],h=d;h!=c;h+=p)f.push([n[h].x,n[h].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,o=this.events.length;n<o;n++){var i=this.events[n];De.compare(t,i)>0&&(t=i)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Fr=function(){function r(e){Te(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return $e(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,o=this.interiorRings.length;n<o;n++){var i=this.interiorRings[n].getGeom();i!==null&&t.push(i)}return t}}]),r}(),ms=function(){function r(e){Te(this,r),this.rings=e,this.polys=this._composePolys(e)}return $e(r,[{key:"getGeom",value:function(){for(var t=[],n=0,o=this.polys.length;n<o;n++){var i=this.polys[n].getGeom();i!==null&&t.push(i)}return t}},{key:"_composePolys",value:function(t){for(var n=[],o=0,i=t.length;o<i;o++){var s=t[o];if(!s.poly)if(s.isExteriorRing())n.push(new Fr(s));else{var a=s.enclosingRing();a.poly||n.push(new Fr(a)),a.poly.addInterior(s)}}return n}}]),r}(),_s=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gn.compare;Te(this,r),this.queue=e,this.tree=new lr(t),this.segments=[]}return $e(r,[{key:"process",value:function(t){var n=t.segment,o=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),o;var i=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!i)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=i,a=i,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var d=l.getIntersection(n);if(d!==null&&(n.isAnEndpoint(d)||(p=d),!l.isAnEndpoint(d)))for(var c=this._splitSafely(l,d),f=0,h=c.length;f<h;f++)o.push(c[f])}var _=null;if(u){var g=u.getIntersection(n);if(g!==null&&(n.isAnEndpoint(g)||(_=g),!u.isAnEndpoint(g)))for(var v=this._splitSafely(u,g),m=0,b=v.length;m<b;m++)o.push(v[m])}if(p!==null||_!==null){var y=null;if(p===null)y=_;else if(_===null)y=p;else{var M=De.comparePoints(p,_);y=M<=0?p:_}this.queue.remove(n.rightSE),o.push(n.rightSE);for(var R=n.split(y),I=0,A=R.length;I<A;I++)o.push(R[I])}o.length>0?(this.tree.remove(n),o.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var x=l.getIntersection(u);if(x!==null){if(!l.isAnEndpoint(x))for(var T=this._splitSafely(l,x),j=0,Z=T.length;j<Z;j++)o.push(T[j]);if(!u.isAnEndpoint(x))for(var P=this._splitSafely(u,x),H=0,le=P.length;H<le;H++)o.push(P[H])}}this.tree.remove(n)}return o}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var o=t.rightSE;this.queue.remove(o);var i=t.split(n);return i.push(o),t.consumedBy===void 0&&this.tree.insert(t),i}}]),r}(),Pr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,gs=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,bs=function(){function r(){Te(this,r)}return $e(r,[{key:"run",value:function(t,n,o){Pe.type=t,Gt.reset();for(var i=[new Ir(n,!0)],s=0,a=o.length;s<a;s++)i.push(new Ir(o[s],!1));if(Pe.numMultiPolys=i.length,Pe.type==="difference")for(var l=i[0],u=1;u<i.length;)Jn(i[u].bbox,l.bbox)!==null?u++:i.splice(u,1);if(Pe.type==="intersection"){for(var p=0,d=i.length;p<d;p++)for(var c=i[p],f=p+1,h=i.length;f<h;f++)if(Jn(c.bbox,i[f].bbox)===null)return[]}for(var _=new lr(De.compare),g=0,v=i.length;g<v;g++)for(var m=i[g].getSweepEvents(),b=0,y=m.length;b<y;b++)if(_.insert(m[b]),_.size>Pr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new _s(_),R=_.size,I=_.pop();I;){var A=I.key;if(_.size===R){var x=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(x.id," ")+"[".concat(x.leftSE.point.x,", ").concat(x.leftSE.point.y,"] -> ")+"[".concat(x.rightSE.point.x,", ").concat(x.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(_.size>Pr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>gs)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var T=M.process(A),j=0,Z=T.length;j<Z;j++){var P=T[j];P.consumedBy===void 0&&_.insert(P)}R=_.size,I=_.pop()}Gt.reset();var H=hs.factory(M.segments),le=new ms(H);return le.getGeom()}}]),r}(),Pe=new bs,vs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Pe.run("union",e,n)},ys=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Pe.run("intersection",e,n)},ws=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Pe.run("xor",e,n)},ks=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return Pe.run("difference",e,n)},nn={union:vs,intersection:ys,xor:ws,difference:ks};function Ss(r,e){var t=Ms(e),n=null;return r.type==="FeatureCollection"?n=Es(r):n=Co(nn.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(o){t.geometry.coordinates.push(o[0])}),t}function Es(r){var e=r.features.length===2?nn.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):nn.union.apply(nn,r.features.map(function(t){return t.geometry.coordinates}));return Co(e)}function Co(r){return ri(r)}function Ms(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return oi(t)}function $s(r,e,t){let n;se(r,Ae,s=>t(1,n=s));let{boundaryGeojson:o}=e;return ii("setCamera")&&n.fitBounds(nr(o),{padding:20,animate:!1}),Ze(n,"boundary",Ss(o)),we(n,{id:"boundary",source:"boundary",...Sn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,o=s.boundaryGeojson)},[o]}class Ls extends V{constructor(e){super(),K(this,e,$s,null,W,{boundaryGeojson:0})}}const me={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Ln=10,Ht=10;function Os(r,e,t){let n;se(r,Ae,u=>t(2,n=u));let{layer:o}=e,{contents:i}=e,s=new Qt.Popup({closeButton:!1,closeOnClick:!1});n.on("mousemove",a),n.on("mouseout",l),rt(()=>{n.off("mousemove",a),n.off("mouseout",l)});function a(u){let p=n.queryRenderedFeatures(u.point,{layers:[o]});p.length>0?s.setLngLat(u.lngLat).setHTML(i(p[0].properties)).addTo(n):s.remove()}function l(){s.remove()}return r.$$set=u=>{"layer"in u&&t(0,o=u.layer),"contents"in u&&t(1,i=u.contents)},[o,i]}class Rs extends V{constructor(e){super(),K(this,e,Os,null,W,{layer:0,contents:1})}}function xr(r,e,t){const n=r.slice();return n[4]=e[t],n}function Nr(r,e,t){const n=r.slice();return n[7]=e[t],n}function Br(r){let e;return{c(){e=E("td"),L(e,"class","svelte-11t6rxo"),ue(e,"background-color",r[7])},m(t,n){w(t,e,n)},p(t,n){n&1&&ue(e,"background-color",t[7])},d(t){t&&k(e)}}}function Dr(r){let e,t=r[4]+"",n;return{c(){e=E("td"),n=X(t),L(e,"class","svelte-11t6rxo")},m(o,i){w(o,e,i),S(e,n)},p:G,d(o){o&&k(e)}}}function Cs(r){let e,t,n,o,i=r[0],s=[];for(let u=0;u<i.length;u+=1)s[u]=Br(Nr(r,i,u));let a=r[1],l=[];for(let u=0;u<a.length;u+=1)l[u]=Dr(xr(r,a,u));return{c(){e=E("table"),t=E("tr");for(let u=0;u<s.length;u+=1)s[u].c();n=C(),o=E("tr");for(let u=0;u<l.length;u+=1)l[u].c();L(t,"class","svelte-11t6rxo"),L(o,"class","svelte-11t6rxo"),L(e,"class","svelte-11t6rxo")},m(u,p){w(u,e,p),S(e,t);for(let d=0;d<s.length;d+=1)s[d].m(t,null);S(e,n),S(e,o);for(let d=0;d<l.length;d+=1)l[d].m(o,null)},p(u,[p]){if(p&1){i=u[0];let d;for(d=0;d<i.length;d+=1){const c=Nr(u,i,d);s[d]?s[d].p(c,p):(s[d]=Br(c),s[d].c(),s[d].m(t,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=i.length}if(p&2){a=u[1];let d;for(d=0;d<a.length;d+=1){const c=xr(u,a,d);l[d]?l[d].p(c,p):(l[d]=Dr(c),l[d].c(),l[d].m(o,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},i:G,o:G,d(u){u&&k(e),un(s,u),un(l,u)}}}function As(r,e,t){let{colors:n}=e,{steps:o}=e;if(n.length!=o.length+1)throw new Error("There must be one more color than step");let i=[],s=0;for(let a of o)i.push(`${s}-${a}`),s=a;return i.push(`>${s}`),r.$$set=a=>{"colors"in a&&t(0,n=a.colors),"steps"in a&&t(2,o=a.steps)},[n,i,o]}class Ts extends V{constructor(e){super(),K(this,e,As,Cs,W,{colors:0,steps:2})}}const Is="/atip/speed_limit/assets/help-d011708a.svg";function Fs(r){let e,t;return{c(){e=E("img"),fn(e.src,t=Is)||L(e,"src",t),L(e,"title",r[0]),L(e,"alt",r[0])},m(n,o){w(n,e,o)},p(n,[o]){o&1&&L(e,"title",n[0]),o&1&&L(e,"alt",n[0])},i:G,o:G,d(n){n&&k(e)}}}function Ps(r,e,t){let{contents:n}=e;return r.$$set=o=>{"contents"in o&&t(0,n=o.contents)},[n]}class xs extends V{constructor(e){super(),K(this,e,Ps,Fs,W,{contents:0})}}function jr(r){let e,t,n,o,i;return t=new xs({props:{contents:"Data comes from OpenStreetMap, and may not always be correct. Freehand segments and off-road paths generally have no speed data."}}),o=new Ts({props:{colors:r[1],steps:r[2]}}),{c(){e=X(`(mph)
  `),N(t.$$.fragment),n=C(),N(o.$$.fragment)},m(s,a){w(s,e,a),B(t,s,a),w(s,n,a),B(o,s,a),i=!0},p:G,i(s){i||($(t.$$.fragment,s),$(o.$$.fragment,s),i=!0)},o(s){O(t.$$.fragment,s),O(o.$$.fragment,s),i=!1},d(s){s&&k(e),D(t,s),s&&k(n),D(o,s)}}}function Ns(r){let e,t,n,o,i,s,a,l,u,p,d,c=r[0]=="speed limits"&&jr(r);return l=new Rs({props:{layer:"speed-limits",contents:Bs}}),{c(){e=E("label"),t=X(`Show details:
  `),n=E("select"),o=E("option"),o.textContent="None",i=E("option"),i.textContent="Speed limits",s=C(),c&&c.c(),a=C(),N(l.$$.fragment),o.__value="none",o.value=o.__value,i.__value="speed limits",i.value=i.__value,r[0]===void 0&&Et(()=>r[6].call(n))},m(f,h){w(f,e,h),S(e,t),S(e,n),S(n,o),S(n,i),bt(n,r[0]),w(f,s,h),c&&c.m(f,h),w(f,a,h),B(l,f,h),u=!0,p||(d=[U(n,"change",r[6]),U(n,"change",r[3])],p=!0)},p(f,[h]){h&1&&bt(n,f[0]),f[0]=="speed limits"?c?(c.p(f,h),h&1&&$(c,1)):(c=jr(f),c.c(),$(c,1),c.m(a.parentNode,a)):c&&(pe(),O(c,1,1,()=>{c=null}),de())},i(f){u||($(c),$(l.$$.fragment,f),u=!0)},o(f){O(c),O(l.$$.fragment,f),u=!1},d(f){f&&k(e),f&&k(s),c&&c.d(f),f&&k(a),D(l,f),p=!1,Oe(d)}}}let it="speed-limits",Fn="speed-limits";function Bs(r){return r.speed_limit?`${Math.round(r.speed_limit)} mph`:"Unknown"}function Ds(r,e,t){let n,o;se(r,Ae,f=>t(7,n=f)),se(r,ne,f=>t(8,o=f));let{routeInfo:i}=e,{id:s}=e,a="none",l=["#00AB4D","#8ECA4D","#F7BB00","#BB0000"],u=[30,40,50];const p=["step",["get","speed_limit"],l[0],u[0],l[1],u[1],l[2],u[2],l[3]];Ze(n,it,Ce()),we(n,{id:Fn,source:it,...vt(p,Ht,1)}),rt(()=>{n.getLayer(Fn)&&n.removeLayer(Fn),n.getSource(it)&&n.removeSource(it)});async function d(){if(a=="none"){n.getSource(it).setData(Ce());return}let f=o.features.find(h=>h.id==s);try{let h=JSON.parse(await i.speedLimitForRoute(f.properties.waypoints));n.getSource(it).setData(h)}catch(h){window.alert(`Couldn't calculate speed limits for route: ${h}`)}}function c(){a=rr(this),t(0,a)}return r.$$set=f=>{"routeInfo"in f&&t(4,i=f.routeInfo),"id"in f&&t(5,s=f.id)},[a,l,u,d,i,s,c]}class js extends V{constructor(e){super(),K(this,e,Ds,Ns,W,{routeInfo:4,id:5})}}function qr(r){let e,t=Ur(r[5])+"",n,o,i,s,a,l,u,p,d,c;return u=new js({props:{routeInfo:r[3],id:r[4]}}),{c(){e=X("Length: "),n=X(t),o=C(),i=E("br"),s=E("button"),s.textContent="Auto-fill details",a=E("br"),l=C(),N(u.$$.fragment),L(s,"type","button")},m(f,h){w(f,e,h),w(f,n,h),w(f,o,h),w(f,i,h),w(f,s,h),w(f,a,h),w(f,l,h),B(u,f,h),p=!0,d||(c=U(s,"click",r[14]),d=!0)},p(f,h){(!p||h&32)&&t!==(t=Ur(f[5])+"")&&xe(n,t);const _={};h&8&&(_.routeInfo=f[3]),h&16&&(_.id=f[4]),u.$set(_)},i(f){p||($(u.$$.fragment,f),p=!0)},o(f){O(u.$$.fragment,f),p=!1},d(f){f&&k(e),f&&k(n),f&&k(o),f&&k(i),f&&k(s),f&&k(a),f&&k(l),D(u,f),d=!1,c()}}}function qs(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,h,_,g,v,m,b,y,M,R,I,A,x,T,j,Z,P,H,le,ke,Ie,oe,re,Ne,Le,Q,he,Xt,_e=r[5]&&qr(r);return{c(){e=E("label"),t=X("Name:"),n=E("br"),o=C(),i=E("input"),s=C(),a=E("br"),l=C(),u=E("br"),p=C(),d=E("label"),c=E("input"),f=X(`
  Area`),h=C(),_=E("label"),g=E("input"),v=X(`
  Route`),m=C(),b=E("label"),y=E("input"),M=X(`
  Crossing`),R=C(),I=E("label"),A=E("input"),x=X(`
  Other`),T=C(),j=E("br"),Z=C(),P=E("br"),H=C(),le=E("label"),ke=X("Description:"),Ie=E("br"),oe=C(),re=E("textarea"),Ne=C(),_e&&_e.c(),Le=be(),L(i,"type","text"),ue(i,"width","100%"),L(c,"type","radio"),c.__value="area",c.value=c.__value,r[9][0].push(c),L(g,"type","radio"),g.__value="route",g.value=g.__value,r[9][0].push(g),L(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[9][0].push(y),L(A,"type","radio"),A.__value="other",A.value=A.__value,r[9][0].push(A),ue(re,"width","100%"),L(re,"rows","5"),L(re,"class","svelte-15lna0i")},m(F,te){w(F,e,te),S(e,t),S(e,n),S(e,o),S(e,i),Re(i,r[0]),w(F,s,te),w(F,a,te),w(F,l,te),w(F,u,te),w(F,p,te),w(F,d,te),S(d,c),c.checked=c.__value===r[1],S(d,f),w(F,h,te),w(F,_,te),S(_,g),g.checked=g.__value===r[1],S(_,v),w(F,m,te),w(F,b,te),S(b,y),y.checked=y.__value===r[1],S(b,M),w(F,R,te),w(F,I,te),S(I,A),A.checked=A.__value===r[1],S(I,x),w(F,T,te),w(F,j,te),w(F,Z,te),w(F,P,te),w(F,H,te),w(F,le,te),S(le,ke),S(le,Ie),S(le,oe),S(le,re),Re(re,r[2]),w(F,Ne,te),_e&&_e.m(F,te),w(F,Le,te),Q=!0,he||(Xt=[U(i,"input",r[7]),U(c,"change",r[8]),U(g,"change",r[10]),U(y,"change",r[11]),U(A,"change",r[12]),U(re,"input",r[13])],he=!0)},p(F,[te]){te&1&&i.value!==F[0]&&Re(i,F[0]),te&2&&(c.checked=c.__value===F[1]),te&2&&(g.checked=g.__value===F[1]),te&2&&(y.checked=y.__value===F[1]),te&2&&(A.checked=A.__value===F[1]),te&4&&Re(re,F[2]),F[5]?_e?(_e.p(F,te),te&32&&$(_e,1)):(_e=qr(F),_e.c(),$(_e,1),_e.m(Le.parentNode,Le)):_e&&(pe(),O(_e,1,1,()=>{_e=null}),de())},i(F){Q||($(_e),Q=!0)},o(F){O(_e),Q=!1},d(F){F&&k(e),F&&k(s),F&&k(a),F&&k(l),F&&k(u),F&&k(p),F&&k(d),r[9][0].splice(r[9][0].indexOf(c),1),F&&k(h),F&&k(_),r[9][0].splice(r[9][0].indexOf(g),1),F&&k(m),F&&k(b),r[9][0].splice(r[9][0].indexOf(y),1),F&&k(R),F&&k(I),r[9][0].splice(r[9][0].indexOf(A),1),F&&k(T),F&&k(j),F&&k(Z),F&&k(P),F&&k(H),F&&k(le),F&&k(Ne),_e&&_e.d(F),F&&k(Le),he=!1,Oe(Xt)}}}function Ur(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Us(r,e,t){let n;se(r,ne,b=>t(15,n=b));let{routeInfo:o}=e,{id:i}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function p(){let b=n.features.find(y=>y.id==i);try{t(0,s=await o.nameForRoute(b))}catch(y){window.alert(`Couldn't auto-name route: ${y}`)}}const d=[[]];function c(){s=this.value,t(0,s)}function f(){a=this.__value,t(1,a)}function h(){a=this.__value,t(1,a)}function _(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function v(){l=this.value,t(2,l)}const m=()=>p();return r.$$set=b=>{"routeInfo"in b&&t(3,o=b.routeInfo),"id"in b&&t(4,i=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(5,u=b.length_meters)},[s,a,l,o,i,u,p,c,f,d,h,_,g,v,m]}class Gs extends V{constructor(e){super(),K(this,e,Us,qs,W,{routeInfo:3,id:4,name:0,intervention_type:1,description:2,length_meters:5})}}const Hs="Intervention",zs=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],Ys={name:Hs,oneOf:zs};function Js(r){const e=r-1;return e*e*e+1}function kt(r,{delay:e=0,duration:t=400,easing:n=Js}={}){const o=getComputedStyle(r),i=+o.opacity,s=parseFloat(o.height),a=parseFloat(o.paddingTop),l=parseFloat(o.paddingBottom),u=parseFloat(o.marginTop),p=parseFloat(o.marginBottom),d=parseFloat(o.borderTopWidth),c=parseFloat(o.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*i};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*p}px;border-top-width: ${f*d}px;border-bottom-width: ${f*c}px;`}}function Ao(r){return"members"in r}function To(r){return"oneOf"in r}function Io(r){return typeof r=="string"}function Fo(r){return typeof r=="object"&&"value"in r}function Xs(r){return"type"in r&&r.type=="number"}function Po(r){return"type"in r&&r.type=="one-liner"}function xo(r){return"type"in r&&r.type=="textbox"}function No(r){return"type"in r&&r.type=="checkbox"}function Gr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Hr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function zr(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=X(t),L(e,"class","svelte-1b72l00")},m(o,i){w(o,e,i),S(e,n)},p(o,i){i&2&&t!==(t=o[1].description+"")&&xe(n,t)},d(o){o&&k(e)}}}function Ws(r){let e,t,n;return{c(){e=E("input"),L(e,"type","checkbox")},m(o,i){w(o,e,i),e.checked=r[0],t||(n=U(e,"change",r[14]),t=!0)},p(o,i){i&1&&(e.checked=o[0])},i:G,o:G,d(o){o&&k(e),t=!1,n()}}}function Vs(r){let e,t,n;return{c(){e=E("textarea"),ue(e,"width","100%"),L(e,"rows","5"),L(e,"class","svelte-1b72l00")},m(o,i){w(o,e,i),Re(e,r[0]),t||(n=U(e,"input",r[13]),t=!0)},p(o,i){i&1&&Re(e,o[0])},i:G,o:G,d(o){o&&k(e),t=!1,n()}}}function Ks(r){let e,t,n;return{c(){e=E("input"),L(e,"type","text"),ue(e,"width","100%")},m(o,i){w(o,e,i),Re(e,r[0]),t||(n=U(e,"input",r[12]),t=!0)},p(o,i){i&1&&e.value!==o[0]&&Re(e,o[0])},i:G,o:G,d(o){o&&k(e),t=!1,n()}}}function Zs(r){let e,t,n;return{c(){e=E("input"),L(e,"type","number")},m(o,i){w(o,e,i),Re(e,r[0]),t||(n=U(e,"input",r[11]),t=!0)},p(o,i){i&1&&vo(e.value)!==o[0]&&Re(e,o[0])},i:G,o:G,d(o){o&&k(e),t=!1,n()}}}function Qs(r){let e,t,n=r[1].oneOf,o=[];for(let s=0;s<n.length;s+=1)o[s]=Jr(Gr(r,n,s));const i=s=>O(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=be()},m(s,a){for(let l=0;l<o.length;l+=1)o[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Gr(s,n,l);o[l]?(o[l].p(u,a),$(o[l],1)):(o[l]=Jr(u),o[l].c(),$(o[l],1),o[l].m(e.parentNode,e))}for(pe(),l=n.length;l<o.length;l+=1)i(l);de()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)O(o[a]);t=!1},d(s){un(o,s),s&&k(e)}}}function el(r){let e,t,n=r[1].members,o=[];for(let s=0;s<n.length;s+=1)o[s]=Xr(Hr(r,n,s));const i=s=>O(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=be()},m(s,a){for(let l=0;l<o.length;l+=1)o[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Hr(s,n,l);o[l]?(o[l].p(u,a),$(o[l],1)):(o[l]=Xr(u),o[l].c(),$(o[l],1),o[l].m(e.parentNode,e))}for(pe(),l=n.length;l<o.length;l+=1)i(l);de()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(o[a]);t=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)O(o[a]);t=!1},d(s){un(o,s),s&&k(e)}}}function tl(r){let e,t,n,o,i=r[15].name+"",s,a,l,u,p,d,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&Yr(r);return{c(){e=E("label"),t=E("input"),o=C(),s=X(i),a=E("br"),l=C(),f&&f.c(),u=be(),L(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(h,_){w(h,e,_),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),w(h,l,_),f&&f.m(h,_),w(h,u,_),p=!0,d||(c=[U(t,"change",r[9]),U(t,"change",r[4])],d=!0)},p(h,_){(!p||_&2&&n!==(n=h[15].name))&&(t.__value=n,t.value=t.__value),_&4&&(t.checked=t.__value===h[2]),(!p||_&2)&&i!==(i=h[15].name+"")&&xe(s,i),h[2]==h[15].name&&typeof h[0]=="object"?f?(f.p(h,_),_&7&&$(f,1)):(f=Yr(h),f.c(),$(f,1),f.m(u.parentNode,u)):f&&(pe(),O(f,1,1,()=>{f=null}),de())},i(h){p||($(f),p=!0)},o(h){O(f),p=!1},d(h){h&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),h&&k(l),f&&f.d(h),h&&k(u),d=!1,Oe(c)}}}function nl(r){let e,t,n,o,i=r[15].value+"",s,a,l,u,p;function d(h,_){return h[15].description?il:ol}let c=d(r),f=c(r);return{c(){e=E("label"),t=E("input"),o=C(),s=X(i),a=C(),f.c(),l=C(),L(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(h,_){w(h,e,_),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),f.m(e,null),S(e,l),u||(p=[U(t,"change",r[8]),U(t,"change",r[3])],u=!0)},p(h,_){_&2&&n!==(n=h[15].value)&&(t.__value=n,t.value=t.__value),_&4&&(t.checked=t.__value===h[2]),_&2&&i!==(i=h[15].value+"")&&xe(s,i),c===(c=d(h))&&f?f.p(h,_):(f.d(1),f=c(h),f&&(f.c(),f.m(e,l)))},i:G,o:G,d(h){h&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Oe(p)}}}function rl(r){let e,t,n,o,i=r[15]+"",s,a,l,u,p,d;return{c(){e=E("label"),t=E("input"),o=C(),s=X(i),a=C(),l=E("br"),u=C(),L(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){w(c,e,f),S(e,t),t.checked=t.__value===r[2],S(e,o),S(e,s),S(e,a),S(e,l),S(e,u),p||(d=[U(t,"change",r[6]),U(t,"change",r[3])],p=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&i!==(i=c[15]+"")&&xe(s,i)},i:G,o:G,d(c){c&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,Oe(d)}}}function Yr(r){let e,t,n,o,i,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Jt({props:l}),ae.push(()=>Ee(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),N(t.$$.fragment),o=C(),L(e,"class","svelte-1b72l00")},m(u,p){w(u,e,p),B(t,e,null),S(e,o),s=!0},p(u,p){r=u;const d={};p&2&&(d.spec=r[15]),!n&&p&3&&(n=!0,d.value=r[0][r[15].name],Me(()=>n=!1)),t.$set(d)},i(u){s||($(t.$$.fragment,u),Et(()=>{i||(i=yt(e,kt,{duration:500},!0)),i.run(1)}),s=!0)},o(u){O(t.$$.fragment,u),i||(i=yt(e,kt,{duration:500},!1)),i.run(0),s=!1},d(u){u&&k(e),D(t),u&&i&&i.end()}}}function ol(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function il(r){let e,t,n=r[15].description+"",o,i;return{c(){e=E("p"),t=X("("),o=X(n),i=X(")"),L(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,o),S(e,i)},p(s,a){a&2&&n!==(n=s[15].description+"")&&xe(o,n)},d(s){s&&k(e)}}}function Jr(r){let e,t,n,o,i,s;const a=[rl,nl,tl],l=[];function u(p,d){return d&2&&(e=null),d&2&&(t=null),e==null&&(e=!!Io(p[15])),e?0:(t==null&&(t=!!Fo(p[15])),t?1:2)}return n=u(r,-1),o=l[n]=a[n](r),{c(){o.c(),i=be()},m(p,d){l[n].m(p,d),w(p,i,d),s=!0},p(p,d){let c=n;n=u(p,d),n===c?l[n].p(p,d):(pe(),O(l[c],1,1,()=>{l[c]=null}),de(),o=l[n],o?o.p(p,d):(o=l[n]=a[n](p),o.c()),$(o,1),o.m(i.parentNode,i))},i(p){s||($(o),s=!0)},o(p){O(o),s=!1},d(p){l[n].d(p),p&&k(i)}}}function Xr(r){let e,t,n=r[15].name+"",o,i,s,a,l,u;function p(c){r[5](c,r[15])}let d={spec:r[15]};return r[0][r[15].name]!==void 0&&(d.value=r[0][r[15].name]),s=new Jt({props:d}),ae.push(()=>Ee(s,"value",p,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),o=X(n),i=C(),N(s.$$.fragment),l=C(),L(e,"class","svelte-1b72l00")},m(c,f){w(c,e,f),S(e,t),S(t,o),S(e,i),B(s,e,null),S(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&xe(o,n);const h={};f&2&&(h.spec=r[15]),!a&&f&3&&(a=!0,h.value=r[0][r[15].name],Me(()=>a=!1)),s.$set(h)},i(c){u||($(s.$$.fragment,c),u=!0)},o(c){O(s.$$.fragment,c),u=!1},d(c){c&&k(e),D(s)}}}function sl(r){let e,t,n,o,i,s,a,l,u,p,d,c=r[1].description&&zr(r);const f=[el,Qs,Zs,Ks,Vs,Ws],h=[];function _(g,v){return v&2&&(t=null),v&2&&(n=null),v&2&&(o=null),v&2&&(i=null),v&2&&(s=null),v&2&&(a=null),t==null&&(t=!!Ao(g[1])),t?0:(n==null&&(n=!!To(g[1])),n?1:(o==null&&(o=!!Xs(g[1])),o?2:(i==null&&(i=!!Po(g[1])),i?3:(s==null&&(s=!!xo(g[1])),s?4:(a==null&&(a=!!No(g[1])),a?5:-1)))))}return~(l=_(r,-1))&&(u=h[l]=f[l](r)),{c(){c&&c.c(),e=C(),u&&u.c(),p=be()},m(g,v){c&&c.m(g,v),w(g,e,v),~l&&h[l].m(g,v),w(g,p,v),d=!0},p(g,[v]){g[1].description?c?c.p(g,v):(c=zr(g),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let m=l;l=_(g,v),l===m?~l&&h[l].p(g,v):(u&&(pe(),O(h[m],1,1,()=>{h[m]=null}),de()),~l?(u=h[l],u?u.p(g,v):(u=h[l]=f[l](g),u.c()),$(u,1),u.m(p.parentNode,p)):u=null)},i(g){d||($(u),d=!0)},o(g){O(u),d=!1},d(g){c&&c.d(g),g&&k(e),~l&&h[l].d(g),g&&k(p)}}}function ll(r,e,t){var m,b,y;let{spec:n}=e,{value:o}=e,i="";if(Ao(n)){o||(o={});for(let M of n.members)Po(M)||xo(M)?o[m=M.name]||(o[m]=""):No(M)?o[b=M.name]||(o[b]=!1):o[y=M.name]||(o[y]={})}else To(n)&&(o||(o={}),Io(o)?i=o:Fo(o)?i=o.value:i=Object.keys(o)[0]||"");function s(){t(0,o=i)}function a(){t(0,o={}),t(0,o[i]={},o)}const l=[[]];function u(M,R){r.$$.not_equal(o[R.name],M)&&(o[R.name]=M,t(0,o))}function p(){i=this.__value,t(2,i)}function d(){i=this.__value,t(2,i)}function c(){i=this.__value,t(2,i)}function f(M,R){r.$$.not_equal(o[R.name],M)&&(o[R.name]=M,t(0,o))}function h(){o=vo(this.value),t(0,o)}function _(){o=this.value,t(0,o)}function g(){o=this.value,t(0,o)}function v(){o=this.checked,t(0,o)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,o=M.value)},[o,n,i,s,a,u,p,l,d,c,f,h,_,g,v]}class Jt extends V{constructor(e){super(),K(this,e,ll,sl,W,{spec:1,value:0})}}function al(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].v2!==void 0&&(i.value=r[0].v2),e=new Jt({props:i}),ae.push(()=>Ee(e,"value",o,r[0].v2)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function ul(r,e,t){let{props:n}=e;n.v2||(n.v2={});let o=Ys;function i(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class fl extends V{constructor(e){super(),K(this,e,ul,al,W,{props:0})}}const cl="Planning",pl=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],dl={name:cl,members:pl};function hl(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].planning!==void 0&&(i.value=r[0].planning),e=new Jt({props:i}),ae.push(()=>Ee(e,"value",o,r[0].planning)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function ml(r,e,t){let{props:n}=e;n.planning||(n.planning={});let o=dl;function i(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class _l extends V{constructor(e){super(),K(this,e,ml,hl,W,{props:0})}}const gl="CriticalIssue",bl=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],vl={name:gl,members:bl};function yl(r){let e,t,n;function o(s){r[2](s)}let i={spec:r[1]};return r[0].criticals!==void 0&&(i.value=r[0].criticals),e=new Jt({props:i}),ae.push(()=>Ee(e,"value",o,r[0].criticals)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function wl(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let o=vl;function i(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,o,i]}class kl extends V{constructor(e){super(),K(this,e,wl,yl,W,{props:0})}}function Wr(r){let e,t,n,o,i;const s=r[10].default,a=dt(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),ue(e,"border","solid 1px black"),ue(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,o||(i=U(e,"introend",r[14]),o=!0)},p(l,u){a&&a.p&&(!n||u&512)&&ht(a,s,l,l[9],n?_t(s,l[9],u,null):mt(l[9]),null)},i(l){n||($(a,l),Et(()=>{t||(t=yt(e,kt,{duration:100},!0)),t.run(1)}),n=!0)},o(l){O(a,l),t||(t=yt(e,kt,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),o=!1,i()}}}function Sl(r){let e,t,n,o,i,s,a,l,u,p,d=r[4]&&Wr(r);return{c(){e=E("button"),t=cn("svg"),n=cn("path"),o=C(),i=X(r[1]),s=C(),d&&d.c(),a=be(),L(n,"d","M9 5l7 7-7 7"),L(t,"style","tran"),L(t,"width","20"),L(t,"height","20"),L(t,"fill","none"),L(t,"stroke-linecap","round"),L(t,"stroke-linejoin","round"),L(t,"stroke-width","2"),L(t,"viewBox","0 0 24 24"),L(t,"stroke","currentColor"),L(t,"class","svelte-t7fpgu"),L(e,"aria-expanded",r[4]),L(e,"class","svelte-t7fpgu"),br(e,"underlined",r[3])},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,o),S(e,i),w(c,s,f),d&&d.m(c,f),w(c,a,f),l=!0,u||(p=[U(e,"click",r[5]),U(e,"mouseenter",r[11]),U(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&xe(i,c[1]),(!l||f&16)&&L(e,"aria-expanded",c[4]),(!l||f&8)&&br(e,"underlined",c[3]),c[4]?d?(d.p(c,f),f&16&&$(d,1)):(d=Wr(c),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(pe(),O(d,1,1,()=>{d=null}),de())},i(c){l||($(d),l=!0)},o(c){O(d),l=!1},d(c){c&&k(e),c&&k(s),d&&d.d(c),c&&k(a),u=!1,Oe(p)}}}function El(r,e,t){let n,o,i,s;se(r,je,m=>t(7,i=m)),se(r,Se,m=>t(8,s=m));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const d=()=>{Se.update(m=>m==u?null:u),s==u&&(Ut.set(null),Ut.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const h=()=>qt.set(u),_=()=>qt.set(null);function g(m){ae[m?"unshift":"push"](()=>{c=m,t(2,c)})}const v=()=>f();return r.$$set=m=>{"id"in m&&t(0,u=m.id),"label"in m&&t(1,p=m.label),"$$scope"in m&&t(9,l=m.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,o=i==u)},[u,p,c,o,n,d,f,i,s,l,a,h,_,g,v]}class Ml extends V{constructor(e){super(),K(this,e,El,Sl,W,{id:0,label:1})}}function Vr(r,e,t){const n=r.slice();return n[14]=e[t],n[15]=e,n[16]=t,n}function $l(r){let e,t,n;function o(s){r[10](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new kl({props:i}),ae.push(()=>Ee(e,"props",o,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Ll(r){let e,t,n;function o(s){r[9](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new _l({props:i}),ae.push(()=>Ee(e,"props",o,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Ol(r){let e,t,n;function o(s){r[8](s,r[14])}let i={};return r[14].properties!==void 0&&(i.props=r[14].properties),e=new fl({props:i}),ae.push(()=>Ee(e,"props",o,r[14].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&4&&(t=!0,l.props=r[14].properties,Me(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Rl(r){let e,t,n,o,i;function s(p){r[5](p,r[14])}function a(p){r[6](p,r[14])}function l(p){r[7](p,r[14])}let u={routeInfo:r[1],id:r[14].id,length_meters:r[14].properties.length_meters};return r[14].properties.name!==void 0&&(u.name=r[14].properties.name),r[14].properties.intervention_type!==void 0&&(u.intervention_type=r[14].properties.intervention_type),r[14].properties.description!==void 0&&(u.description=r[14].properties.description),e=new Gs({props:u}),ae.push(()=>Ee(e,"name",s,r[14].properties.name)),ae.push(()=>Ee(e,"intervention_type",a,r[14].properties.intervention_type)),ae.push(()=>Ee(e,"description",l,r[14].properties.description)),{c(){N(e.$$.fragment)},m(p,d){B(e,p,d),i=!0},p(p,d){r=p;const c={};d&2&&(c.routeInfo=r[1]),d&4&&(c.id=r[14].id),d&4&&(c.length_meters=r[14].properties.length_meters),!t&&d&4&&(t=!0,c.name=r[14].properties.name,Me(()=>t=!1)),!n&&d&4&&(n=!0,c.intervention_type=r[14].properties.intervention_type,Me(()=>n=!1)),!o&&d&4&&(o=!0,c.description=r[14].properties.description,Me(()=>o=!1)),e.$set(c)},i(p){i||($(e.$$.fragment,p),i=!0)},o(p){O(e.$$.fragment,p),i=!1},d(p){D(e,p)}}}function Cl(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,h,_;const g=[Rl,Ol,Ll,$l],v=[];function m(y,M){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:y[0]=="criticals"?3:-1}~(e=m(r))&&(t=v[e]=g[e](r));function b(){return r[11](r[14])}return{c(){t&&t.c(),n=C(),o=E("br"),i=C(),s=E("br"),a=C(),l=E("div"),u=E("button"),u.textContent="Delete",p=C(),d=E("button"),d.textContent="Save",c=C(),L(u,"type","button"),L(d,"type","button"),ue(l,"display","flex"),ue(l,"justify-content","space-between")},m(y,M){~e&&v[e].m(y,M),w(y,n,M),w(y,o,M),w(y,i,M),w(y,s,M),w(y,a,M),w(y,l,M),S(l,u),S(l,p),S(l,d),w(y,c,M),f=!0,h||(_=[U(u,"click",b),U(d,"click",r[12])],h=!0)},p(y,M){r=y;let R=e;e=m(r),e===R?~e&&v[e].p(r,M):(t&&(pe(),O(v[R],1,1,()=>{v[R]=null}),de()),~e?(t=v[e],t?t.p(r,M):(t=v[e]=g[e](r),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(y){f||($(t),f=!0)},o(y){O(t),f=!1},d(y){~e&&v[e].d(y),y&&k(n),y&&k(o),y&&k(i),y&&k(s),y&&k(a),y&&k(l),y&&k(c),h=!1,Oe(_)}}}function Kr(r,e){let t,n,o;return n=new Ml({props:{id:e[14].id,label:e[16]+1+") "+e[3](e[14]),$$slots:{default:[Cl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=be(),N(n.$$.fragment),this.first=t},m(i,s){w(i,t,s),B(n,i,s),o=!0},p(i,s){e=i;const a={};s&4&&(a.id=e[14].id),s&4&&(a.label=e[16]+1+") "+e[3](e[14])),s&131079&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(i){o||($(n.$$.fragment,i),o=!0)},o(i){O(n.$$.fragment,i),o=!1},d(i){i&&k(t),D(n,i)}}}function Al(r){let e=[],t=new Map,n,o,i,s,a=r[2].features;const l=u=>u[14].id;for(let u=0;u<a.length;u+=1){let p=Vr(r,a,u),d=l(p);t.set(d,e[u]=Kr(d,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=be()},m(u,p){for(let d=0;d<e.length;d+=1)e[d].m(u,p);w(u,n,p),o=!0,i||(s=U(window,"keydown",r[4]),i=!0)},p(u,[p]){p&15&&(a=u[2].features,pe(),e=si(e,p,l,1,u,a,t,n.parentNode,li,Kr,n,Vr),de())},i(u){if(!o){for(let p=0;p<a.length;p+=1)$(e[p]);o=!0}},o(u){for(let p=0;p<e.length;p+=1)O(e[p]);o=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&k(n),i=!1,s()}}}function Tl(r,e,t){let n,o;se(r,Se,v=>t(13,n=v)),se(r,ne,v=>t(2,o=v));let{schema:i}=e,{routeInfo:s}=e;function a(v){var b,y,M,R,I;if(i=="planning")return((b=v.properties.planning)==null?void 0:b.name)||"Untitled polygon";if(i=="v2")return((M=(y=v.properties.v2)==null?void 0:y.Route)==null?void 0:M.name)||((I=(R=v.properties.v2)==null?void 0:R.Crossing)==null?void 0:I.name)||"Untitled intervention";if(v.properties.name)return v.properties.name;var m=v.properties.intervention_type;return m=="other"&&(v.geometry.type=="Point"?m="point":v.geometry.type=="LineString"?m="line":m="polygon"),`Untitled ${m}`}function l(v){if(v.key=="Delete"){const m=v.target.tagName;if(m=="INPUT"||m=="TEXTAREA")return;v.preventDefault();const b=n;b&&wr(b)}}function u(v,m){r.$$.not_equal(m.properties.name,v)&&(m.properties.name=v,ne.set(o))}function p(v,m){r.$$.not_equal(m.properties.intervention_type,v)&&(m.properties.intervention_type=v,ne.set(o))}function d(v,m){r.$$.not_equal(m.properties.description,v)&&(m.properties.description=v,ne.set(o))}function c(v,m){r.$$.not_equal(m.properties,v)&&(m.properties=v,ne.set(o))}function f(v,m){r.$$.not_equal(m.properties,v)&&(m.properties=v,ne.set(o))}function h(v,m){r.$$.not_equal(m.properties,v)&&(m.properties=v,ne.set(o))}const _=v=>wr(v.id),g=()=>Se.set(null);return r.$$set=v=>{"schema"in v&&t(0,i=v.schema),"routeInfo"in v&&t(1,s=v.routeInfo)},[i,s,o,a,l,u,p,d,c,f,h,_,g]}class Il extends V{constructor(e){super(),K(this,e,Tl,Al,W,{schema:0,routeInfo:1})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function qe(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Wn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ye(r,e,t){t===void 0&&(t={});var n=Ve(r),o=Ve(e),i=Fe(o[1]-n[1]),s=Fe(o[0]-n[0]),a=Fe(n[1]),l=Fe(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return ai(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function rn(r,e){return e===void 0&&(e={}),ui(r,function(t,n){var o=n.geometry.coordinates;return t+Ye(o[0],o[1],e)},0)}function Fl(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,h,_,g,v,m,b,y=r[0].features.length+"",M,R,I,A,x,T,j,Z;return{c(){e=E("div"),t=E("label"),n=X(`Scheme name:
    `),o=E("input"),i=C(),s=E("br"),a=C(),l=E("div"),u=E("label"),p=E("input"),d=C(),c=E("button"),c.textContent="Load from GeoJSON",f=C(),h=E("button"),h.textContent="Export to GeoJSON",_=C(),g=E("br"),v=C(),m=E("div"),b=E("span"),M=X(y),R=X(" objects"),I=C(),A=E("button"),x=X("Clear all"),L(o,"type","text"),L(p,"type","file"),L(p,"id","load_geojson"),L(p,"class","svelte-lhyd1e"),L(c,"type","button"),L(h,"type","button"),L(h,"class","align-right svelte-lhyd1e"),L(A,"type","button"),L(A,"class","align-right svelte-lhyd1e"),A.disabled=T=r[0].features.length==0},m(P,H){w(P,e,H),S(e,t),S(t,n),S(t,o),Re(o,r[0].scheme_name),w(P,i,H),w(P,s,H),w(P,a,H),w(P,l,H),S(l,u),S(u,p),S(u,d),S(u,c),S(l,f),S(l,h),w(P,_,H),w(P,g,H),w(P,v,H),w(P,m,H),S(m,b),S(b,M),S(b,R),S(m,I),S(m,A),S(A,x),j||(Z=[U(o,"input",r[7]),U(p,"change",r[3]),U(c,"click",xl),U(h,"click",r[2]),U(A,"click",r[1])],j=!0)},p(P,[H]){H&1&&o.value!==P[0].scheme_name&&Re(o,P[0].scheme_name),H&1&&y!==(y=P[0].features.length+"")&&xe(M,y),H&1&&T!==(T=P[0].features.length==0)&&(A.disabled=T)},i:G,o:G,d(P){P&&k(e),P&&k(i),P&&k(s),P&&k(a),P&&k(l),P&&k(_),P&&k(g),P&&k(v),P&&k(m),j=!1,Oe(Z)}}}function Pl(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function xl(){document.getElementById("load_geojson").click()}function Nl(r,e,t){let n;se(r,ne,f=>t(0,n=f));let{authorityName:o}=e,{schema:i}=e,s=o;i!="v1"&&(s+=`_${i}`),kn(async()=>{let h=new URLSearchParams(window.location.search).get("geojsonUrl"),_=window.localStorage.getItem(s);if(h){console.log(`Loading GeoJSON from ${h}`);try{let v=await(await fetch(h)).text();ne.set(d(JSON.parse(v)))}catch(g){console.log(`Failed to load from URL: ${g}`)}}else if(_)try{ne.set(d(JSON.parse(_)))}catch(g){console.log(`Failed to load from local storage: ${g}`)}});function a(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(ne.update(f=>(delete f.scheme_name,f.features=[],f)),Se.set(null),je.set(null),qt.set(null),Ut.set(null))}function l(){const f=JSON.parse(JSON.stringify(n));for(let h of f.features)delete h.properties.hide_while_editing;return f}function u(){let f=l();var h=s;f.authority=o,f.origin="atip-v1",f.scheme_name&&(h+="_"+f.scheme_name),h+=".txt",Pl(h,JSON.stringify(f,null,"  "))}function p(f){const h=new FileReader;h.onload=g=>{try{ne.set(d(JSON.parse(g.target.result)))}catch(v){window.alert(`Couldn't load scheme from a file: ${v}`)}};let _=f.target.files;h.readAsText(_[0])}function d(f){let h=1;for(let _ of f.features)_.properties||(_.properties={name:"",description:"",intervention_type:"other"}),_.geometry.type=="LineString"&&!_.properties.length_meters&&(_.properties.length_meters=rn(_,{units:"kilometers"})*1e3),_.id=h++;return f}function c(){n.scheme_name=this.value,ne.set(n)}return r.$$set=f=>{"authorityName"in f&&t(4,o=f.authorityName),"schema"in f&&t(5,i=f.schema)},r.$$.update=()=>{r.$$.dirty&65&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(l())))},[n,a,u,p,o,i,s,c]}class Bl extends V{constructor(e){super(),K(this,e,Nl,Fl,W,{authorityName:4,schema:5})}}const Dl="/atip/speed_limit/assets/zoom_out_map-b2e1091a.svg";function jl(r){let e,t,n,o,i;return{c(){e=E("button"),t=E("img"),fn(t.src,n=Dl)||L(t,"src",n),L(t,"alt","Zoom to show entire boundary"),L(e,"type","button"),L(e,"title","Zoom to show entire boundary"),L(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),o||(i=U(e,"click",r[0]),o=!0)},p:G,i:G,o:G,d(s){s&&k(e),o=!1,i()}}}function ql(r,e,t){let n;se(r,Ae,s=>t(2,n=s));let{boundaryGeojson:o}=e;function i(){n.fitBounds(nr(o),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,o=s.boundaryGeojson)},[i,o]}class Ul extends V{constructor(e){super(),K(this,e,ql,jl,W,{boundaryGeojson:1})}}function Gl(r){let e,t,n,o,i,s,a;return{c(){e=E("div"),t=X(`Basemap:
  `),n=E("select"),o=E("option"),o.textContent="Streets",i=E("option"),i.textContent="Satellite",o.__value="streets",o.value=o.__value,i.__value="hybrid",i.value=i.__value,r[0]===void 0&&Et(()=>r[2].call(n)),L(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,o),S(n,i),bt(n,r[0]),s||(a=[U(n,"change",r[2]),U(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&bt(n,l[0])},i:G,o:G,d(l){l&&k(e),s=!1,Oe(a)}}}function Hl(r,e,t){let{style:n}=e;function o(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function i(){n=rr(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,o,i]}class zl extends V{constructor(e){super(),K(this,e,Hl,Gl,W,{style:0})}}function Zr(r){let e,t,n;const o=r[3].default,i=dt(o,r,r[2],null);return{c(){e=E("div"),i&&i.c()},m(s,a){w(s,e,a),i&&i.m(e,null),n=!0},p(s,a){i&&i.p&&(!n||a&4)&&ht(i,o,s,s[2],n?_t(o,s[2],a,null):mt(s[2]),null)},i(s){n||($(i,s),Et(()=>{t||(t=yt(e,kt,{duration:100},!0)),t.run(1)}),n=!0)},o(s){O(i,s),t||(t=yt(e,kt,{duration:100},!1)),t.run(0),n=!1},d(s){s&&k(e),i&&i.d(s),s&&t&&t.end()}}}function Yl(r){let e,t,n,o,i,s,a,l,u,p,d=r[0]&&Zr(r);return{c(){e=E("button"),t=cn("svg"),n=cn("path"),o=C(),i=X(r[1]),s=C(),d&&d.c(),a=be(),L(n,"d","M9 5l7 7-7 7"),L(t,"style","tran"),L(t,"width","20"),L(t,"height","20"),L(t,"fill","none"),L(t,"stroke-linecap","round"),L(t,"stroke-linejoin","round"),L(t,"stroke-width","2"),L(t,"viewBox","0 0 24 24"),L(t,"stroke","currentColor"),L(t,"class","svelte-una9lq"),L(e,"aria-expanded",r[0]),L(e,"class","svelte-una9lq")},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,o),S(e,i),w(c,s,f),d&&d.m(c,f),w(c,a,f),l=!0,u||(p=U(e,"click",r[4]),u=!0)},p(c,[f]){(!l||f&2)&&xe(i,c[1]),(!l||f&1)&&L(e,"aria-expanded",c[0]),c[0]?d?(d.p(c,f),f&1&&$(d,1)):(d=Zr(c),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(pe(),O(d,1,1,()=>{d=null}),de())},i(c){l||($(d),l=!0)},o(c){O(d),l=!1},d(c){c&&k(e),c&&k(s),d&&d.d(c),c&&k(a),u=!1,p()}}}function Jl(r,e,t){let{$$slots:n={},$$scope:o}=e,{label:i}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,i=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,o=l.$$scope)},[s,i,o,n,a]}class On extends V{constructor(e){super(),K(this,e,Jl,Yl,W,{label:1,open:0})}}function Xl(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,h,_;return{c(){e=E("li"),t=E("span"),n=X("Areas"),o=C(),i=E("li"),s=E("span"),a=X("Routes"),l=C(),u=E("li"),p=E("span"),d=X("Crossings"),c=C(),f=E("li"),h=E("span"),_=X("Other"),L(t,"class","svelte-l42ea0"),ue(t,"background",me.area),L(s,"class","svelte-l42ea0"),ue(s,"background",me.route),L(p,"class","svelte-l42ea0"),ue(p,"background",me.crossing),L(h,"class","svelte-l42ea0"),ue(h,"background",me.other)},m(g,v){w(g,e,v),S(e,t),S(e,n),w(g,o,v),w(g,i,v),S(i,s),S(i,a),w(g,l,v),w(g,u,v),S(u,p),S(u,d),w(g,c,v),w(g,f,v),S(f,h),S(f,_)},p:G,d(g){g&&k(e),g&&k(o),g&&k(i),g&&k(l),g&&k(u),g&&k(c),g&&k(f)}}}function Wl(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,h,_;return{c(){e=E("li"),t=E("span"),n=X("Preapp"),o=C(),i=E("li"),s=E("span"),a=X("Outline"),l=C(),u=E("li"),p=E("span"),d=X("Reserved matters"),c=C(),f=E("li"),h=E("span"),_=X("Local plan"),L(t,"class","svelte-l42ea0"),ue(t,"background",me.preapp),L(s,"class","svelte-l42ea0"),ue(s,"background",me.outline),L(p,"class","svelte-l42ea0"),ue(p,"background",me["reserved matters"]),L(h,"class","svelte-l42ea0"),ue(h,"background",me["local plan"])},m(g,v){w(g,e,v),S(e,t),S(e,n),w(g,o,v),w(g,i,v),S(i,s),S(i,a),w(g,l,v),w(g,u,v),S(u,p),S(u,d),w(g,c,v),w(g,f,v),S(f,h),S(f,_)},p:G,d(g){g&&k(e),g&&k(o),g&&k(i),g&&k(l),g&&k(u),g&&k(c),g&&k(f)}}}function Vl(r){let e;function t(i,s){return i[0]=="planning"?Wl:Xl}let n=t(r),o=n(r);return{c(){e=E("ul"),o.c()},m(i,s){w(i,e,s),o.m(e,null)},p(i,s){n===(n=t(i))&&o?o.p(i,s):(o.d(1),o=n(i),o&&(o.c(),o.m(e,null)))},d(i){i&&k(e),o.d()}}}function Kl(r){let e,t,n;return t=new On({props:{label:"Objects",open:!0,$$slots:{default:[Vl]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),L(e,"class","svelte-l42ea0")},m(o,i){w(o,e,i),B(t,e,null),n=!0},p(o,[i]){const s={};i&3&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||($(t.$$.fragment,o),n=!0)},o(o){O(t.$$.fragment,o),n=!1},d(o){o&&k(e),D(t)}}}function Zl(r,e,t){let{schema:n}=e;return r.$$set=o=>{"schema"in o&&t(0,n=o.schema)},[n]}class Ql extends V{constructor(e){super(),K(this,e,Zl,Kl,W,{schema:0})}}let st="interventions";function ea(r,e,t){let n,o;se(r,Ae,p=>t(1,n=p)),se(r,ne,p=>t(2,o=p));let{schema:i}=e;Ze(n,st,o);const s=["match",["get","intervention_type"],"area",me.area,"route",me.route,"crossing",me.crossing,"other",me.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",me.preapp,"outline",me.outline,"reserved matters",me["reserved matters"],"local plan",me["local plan"],"white"],l=["!=","hide_while_editing",!0];return we(n,{id:"interventions-points",source:st,filter:["all",En,l,["!=","endpoint",!0]],...Mt(s,Ln)}),we(n,{id:"interventions-lines",source:st,filter:["all",Mn,l],...vt(s,Ht)}),we(n,{id:"interventions-lines-endpoints",source:st,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Ht,"circle-opacity":0,"circle-stroke-color":me.lineEndpointColor,"circle-stroke-width":2}}),we(n,{id:"interventions-polygons",source:st,filter:["all",$n,l],...Sn(i=="planning"?a:s,.5)}),r.$$set=p=>{"schema"in p&&t(0,i=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(o)),d=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])d.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(d),n.getSource(st).setData(p)}},[i,n,o]}class ta extends V{constructor(e){super(),K(this,e,ea,null,W,{schema:0})}}let lt="hover";function na(r,e,t){let n,o,i,s,a;return se(r,Ae,l=>t(0,n=l)),se(r,ne,l=>t(1,o=l)),se(r,qt,l=>t(2,i=l)),se(r,je,l=>t(3,s=l)),se(r,Se,l=>t(4,a=l)),Ze(n,lt,Ce()),we(n,{id:"hover-polygons",source:lt,filter:$n,...vt(me.hovering,.5*Ht,1)}),we(n,{id:"hover-lines",source:lt,filter:Mn,...vt(me.hovering,1.5*Ht,1)}),we(n,{id:"hover-points",source:lt,filter:En,...Mt(me.hovering,1.5*Ln,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||i;l!=null?n.getSource(lt).setData(o.features.find(u=>u.id==l)):n.getSource(lt).setData(Ce())}},[n,o,i,s,a]}class ra extends V{constructor(e){super(),K(this,e,na,null,W,{})}}class ar{constructor(e,t){ie(this,"owner");ie(this,"map");ie(this,"mapHandlers",{});ie(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Kt="edit-point-mode";class oa{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"cursor");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new ar(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Ze(e,Kt,Ce()),we(e,{id:"edit-point-mode",source:Kt,...Mt(me.hovering,Ln,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=ia(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Kt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Ce();this.cursor&&e.features.push(this.cursor),this.map.getSource(Kt).setData(e)}}function ia(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Bo(r,e,t){if(t===void 0&&(t={}),t.final===!0)return sa(r,e);var n=Ve(r),o=Ve(e),i=Fe(n[0]),s=Fe(o[0]),a=Fe(n[1]),l=Fe(o[1]),u=Math.sin(s-i)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-i);return Dn(Math.atan2(u,p))}function sa(r,e){var t=Bo(e,r);return t=(t+180)%360,t}function Qr(r,e,t,n){n===void 0&&(n={});var o=Ve(r),i=Fe(o[0]),s=Fe(o[1]),a=Fe(t),l=fi(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=i+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),d=Dn(p),c=Dn(u);return gt([d,c],n.properties)}function Vn(r){if(!r)throw new Error("geojson is required");var e=[];return or(r,function(t){la(t,e)}),We(e)}function la(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=qe(n);break;case"LineString":t=[qe(n)]}t.forEach(function(o){var i=aa(o,r.properties);i.forEach(function(s){s.id=e.length,e.push(s)})})}}function aa(r,e){var t=[];return r.reduce(function(n,o){var i=wt([n,o],e);return i.bbox=ua(n,o),t.push(i),o}),t}function ua(r,e){var t=r[0],n=r[1],o=e[0],i=e[1],s=t<o?t:o,a=n<i?n:i,l=t>o?t:o,u=n>i?n:i;return[s,a,l,u]}var St={},fa={get exports(){return St},set exports(r){St=r}},Kn={},ca={get exports(){return Kn},set exports(r){Kn=r}};(function(r,e){(function(t,n){r.exports=n()})(ci,function(){function t(m,b,y,M,R){(function I(A,x,T,j,Z){for(;j>T;){if(j-T>600){var P=j-T+1,H=x-T+1,le=Math.log(P),ke=.5*Math.exp(2*le/3),Ie=.5*Math.sqrt(le*ke*(P-ke)/P)*(H-P/2<0?-1:1),oe=Math.max(T,Math.floor(x-H*ke/P+Ie)),re=Math.min(j,Math.floor(x+(P-H)*ke/P+Ie));I(A,x,oe,re,Z)}var Ne=A[x],Le=T,Q=j;for(n(A,T,x),Z(A[j],Ne)>0&&n(A,T,j);Le<Q;){for(n(A,Le,Q),Le++,Q--;Z(A[Le],Ne)<0;)Le++;for(;Z(A[Q],Ne)>0;)Q--}Z(A[T],Ne)===0?n(A,T,Q):n(A,++Q,j),Q<=x&&(T=Q+1),x<=Q&&(j=Q-1)}})(m,b,y||0,M||m.length-1,R||o)}function n(m,b,y){var M=m[b];m[b]=m[y],m[y]=M}function o(m,b){return m<b?-1:m>b?1:0}var i=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(m,b,y){if(!y)return b.indexOf(m);for(var M=0;M<b.length;M++)if(y(m,b[M]))return M;return-1}function a(m,b){l(m,0,m.children.length,b,m)}function l(m,b,y,M,R){R||(R=g(null)),R.minX=1/0,R.minY=1/0,R.maxX=-1/0,R.maxY=-1/0;for(var I=b;I<y;I++){var A=m.children[I];u(R,m.leaf?M(A):A)}return R}function u(m,b){return m.minX=Math.min(m.minX,b.minX),m.minY=Math.min(m.minY,b.minY),m.maxX=Math.max(m.maxX,b.maxX),m.maxY=Math.max(m.maxY,b.maxY),m}function p(m,b){return m.minX-b.minX}function d(m,b){return m.minY-b.minY}function c(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function f(m){return m.maxX-m.minX+(m.maxY-m.minY)}function h(m,b){return m.minX<=b.minX&&m.minY<=b.minY&&b.maxX<=m.maxX&&b.maxY<=m.maxY}function _(m,b){return b.minX<=m.maxX&&b.minY<=m.maxY&&b.maxX>=m.minX&&b.maxY>=m.minY}function g(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(m,b,y,M,R){for(var I=[b,y];I.length;)if(!((y=I.pop())-(b=I.pop())<=M)){var A=b+Math.ceil((y-b)/M/2)*M;t(m,A,b,y,R),I.push(b,A,A,y)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(m){var b=this.data,y=[];if(!_(m,b))return y;for(var M=this.toBBox,R=[];b;){for(var I=0;I<b.children.length;I++){var A=b.children[I],x=b.leaf?M(A):A;_(m,x)&&(b.leaf?y.push(A):h(m,x)?this._all(A,y):R.push(A))}b=R.pop()}return y},i.prototype.collides=function(m){var b=this.data;if(!_(m,b))return!1;for(var y=[];b;){for(var M=0;M<b.children.length;M++){var R=b.children[M],I=b.leaf?this.toBBox(R):R;if(_(m,I)){if(b.leaf||h(m,I))return!0;y.push(R)}}b=y.pop()}return!1},i.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var b=0;b<m.length;b++)this.insert(m[b]);return this}var y=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},i.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},i.prototype.clear=function(){return this.data=g([]),this},i.prototype.remove=function(m,b){if(!m)return this;for(var y,M,R,I=this.data,A=this.toBBox(m),x=[],T=[];I||x.length;){if(I||(I=x.pop(),M=x[x.length-1],y=T.pop(),R=!0),I.leaf){var j=s(m,I.children,b);if(j!==-1)return I.children.splice(j,1),x.push(I),this._condense(x),this}R||I.leaf||!h(I,A)?M?(y++,I=M.children[y],R=!1):I=null:(x.push(I),T.push(y),y=0,M=I,I=I.children[0])}return this},i.prototype.toBBox=function(m){return m},i.prototype.compareMinX=function(m,b){return m.minX-b.minX},i.prototype.compareMinY=function(m,b){return m.minY-b.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(m){return this.data=m,this},i.prototype._all=function(m,b){for(var y=[];m;)m.leaf?b.push.apply(b,m.children):y.push.apply(y,m.children),m=y.pop();return b},i.prototype._build=function(m,b,y,M){var R,I=y-b+1,A=this._maxEntries;if(I<=A)return a(R=g(m.slice(b,y+1)),this.toBBox),R;M||(M=Math.ceil(Math.log(I)/Math.log(A)),A=Math.ceil(I/Math.pow(A,M-1))),(R=g([])).leaf=!1,R.height=M;var x=Math.ceil(I/A),T=x*Math.ceil(Math.sqrt(A));v(m,b,y,T,this.compareMinX);for(var j=b;j<=y;j+=T){var Z=Math.min(j+T-1,y);v(m,j,Z,x,this.compareMinY);for(var P=j;P<=Z;P+=x){var H=Math.min(P+x-1,Z);R.children.push(this._build(m,P,H,M-1))}}return a(R,this.toBBox),R},i.prototype._chooseSubtree=function(m,b,y,M){for(;M.push(b),!b.leaf&&M.length-1!==y;){for(var R=1/0,I=1/0,A=void 0,x=0;x<b.children.length;x++){var T=b.children[x],j=c(T),Z=(P=m,H=T,(Math.max(H.maxX,P.maxX)-Math.min(H.minX,P.minX))*(Math.max(H.maxY,P.maxY)-Math.min(H.minY,P.minY))-j);Z<I?(I=Z,R=j<R?j:R,A=T):Z===I&&j<R&&(R=j,A=T)}b=A||b.children[0]}var P,H;return b},i.prototype._insert=function(m,b,y){var M=y?m:this.toBBox(m),R=[],I=this._chooseSubtree(M,this.data,b,R);for(I.children.push(m),u(I,M);b>=0&&R[b].children.length>this._maxEntries;)this._split(R,b),b--;this._adjustParentBBoxes(M,R,b)},i.prototype._split=function(m,b){var y=m[b],M=y.children.length,R=this._minEntries;this._chooseSplitAxis(y,R,M);var I=this._chooseSplitIndex(y,R,M),A=g(y.children.splice(I,y.children.length-I));A.height=y.height,A.leaf=y.leaf,a(y,this.toBBox),a(A,this.toBBox),b?m[b-1].children.push(A):this._splitRoot(y,A)},i.prototype._splitRoot=function(m,b){this.data=g([m,b]),this.data.height=m.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(m,b,y){for(var M,R,I,A,x,T,j,Z=1/0,P=1/0,H=b;H<=y-b;H++){var le=l(m,0,H,this.toBBox),ke=l(m,H,y,this.toBBox),Ie=(R=le,I=ke,A=void 0,x=void 0,T=void 0,j=void 0,A=Math.max(R.minX,I.minX),x=Math.max(R.minY,I.minY),T=Math.min(R.maxX,I.maxX),j=Math.min(R.maxY,I.maxY),Math.max(0,T-A)*Math.max(0,j-x)),oe=c(le)+c(ke);Ie<Z?(Z=Ie,M=H,P=oe<P?oe:P):Ie===Z&&oe<P&&(P=oe,M=H)}return M||y-b},i.prototype._chooseSplitAxis=function(m,b,y){var M=m.leaf?this.compareMinX:p,R=m.leaf?this.compareMinY:d;this._allDistMargin(m,b,y,M)<this._allDistMargin(m,b,y,R)&&m.children.sort(M)},i.prototype._allDistMargin=function(m,b,y,M){m.children.sort(M);for(var R=this.toBBox,I=l(m,0,b,R),A=l(m,y-b,y,R),x=f(I)+f(A),T=b;T<y-b;T++){var j=m.children[T];u(I,m.leaf?R(j):j),x+=f(I)}for(var Z=y-b-1;Z>=b;Z--){var P=m.children[Z];u(A,m.leaf?R(P):P),x+=f(A)}return x},i.prototype._adjustParentBBoxes=function(m,b,y){for(var M=y;M>=0;M--)u(b[M],m)},i.prototype._condense=function(m){for(var b=m.length-1,y=void 0;b>=0;b--)m[b].children.length===0?b>0?(y=m[b-1].children).splice(y.indexOf(m[b]),1):this.clear():a(m[b],this.toBBox)},i})})(ca);const pa=ir(pi),da=ir(di),ha=ir(hi);var Be=Kn,Do=pa,jo=da,at=ha.default,ma=jo.featureEach;jo.coordEach;Do.polygon;var eo=Do.featureCollection;function qo(r){var e=new Be(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:at(t),Be.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:at(o),n.push(o)}):ma(t,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:at(o),n.push(o)}),Be.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:at(t),Be.prototype.remove.call(this,t,n)},e.clear=function(){return Be.prototype.clear.call(this)},e.search=function(t){var n=Be.prototype.search.call(this,this.toBBox(t));return eo(n)},e.collides=function(t){return Be.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Be.prototype.all.call(this);return eo(t)},e.toJSON=function(){return Be.prototype.toJSON.call(this)},e.fromJSON=function(t){return Be.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=at(t);else if(t.type==="FeatureCollection")n=at(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}fa.exports=qo;St.default=qo;function Uo(r,e){var t={},n=[];if(r.type==="LineString"&&(r=vr(r)),e.type==="LineString"&&(e=vr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=to(r,e);return o&&n.push(o),We(n)}var i=St();return i.load(Vn(e)),pn(Vn(r),function(s){pn(i.search(s),function(a){var l=to(s,a);if(l){var u=qe(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function to(r,e){var t=qe(r),n=qe(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=t[0][0],i=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],d=n[1][1],c=(d-u)*(s-o)-(p-l)*(a-i),f=(p-l)*(i-u)-(d-u)*(o-l),h=(s-o)*(i-u)-(a-i)*(o-l);if(c===0)return f===0&&h===0,null;var _=f/c,g=h/c;if(_>=0&&_<=1&&g>=0&&g<=1){var v=o+_*(s-o),m=i+_*(a-i);return gt([v,m])}return null}function zt(r,e,t){t===void 0&&(t={});var n=gt([1/0,1/0],{dist:1/0}),o=0;return or(r,function(i){for(var s=qe(i),a=0;a<s.length-1;a++){var l=gt(s[a]);l.properties.dist=Ye(e,l,t);var u=gt(s[a+1]);u.properties.dist=Ye(e,u,t);var p=Ye(l,u,t),d=Math.max(l.properties.dist,u.properties.dist),c=Bo(l,u),f=Qr(e,d,c+90,t),h=Qr(e,d,c-90,t),_=Uo(wt([f.geometry.coordinates,h.geometry.coordinates]),wt([l.geometry.coordinates,u.geometry.coordinates])),g=null;_.features.length>0&&(g=_.features[0],g.properties.dist=Ye(e,g,t),g.properties.location=o+Ye(l,g,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=o),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=o+p),g&&g.properties.dist<n.properties.dist&&(n=g,n.properties.index=a),o+=p}}),n}const ut="edit-polygon-mode";class _a{constructor(e){ie(this,"map");ie(this,"active");ie(this,"eventListenersSuccess");ie(this,"eventListenersFailure");ie(this,"points");ie(this,"cursor");ie(this,"hover");ie(this,"dragFrom");ie(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new ar(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Ze(e,ut,Ce()),we(e,{id:"edit-polygon-fill",source:ut,filter:$n,...Sn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),we(e,{id:"edit-polygon-lines",source:ut,filter:Mn,...vt("black",8,.5)}),we(e,{id:"edit-polygon-vertices",source:ut,filter:En,...Mt(me.hovering,Ln,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let o of this.points)o[0]-=t,o[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(ro(this.points).forEach((n,o)=>{t.push([o+1,zt(n,this.cursor).properties.dist])}),t.sort((n,o)=>n[1]-o[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(ut),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Ce();this.points.forEach((n,o)=>{let i=no(n);i.properties.hover=this.hover==o,i.properties.idx=o,e.features.push(i)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(ro(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(ut).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=no(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function no(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function ro(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let J;const He=new Array(32).fill(void 0);He.push(void 0,null,!0,!1);function Y(r){return He[r]}let Bt=He.length;function ga(r){r<36||(He[r]=Bt,Bt=r)}function Zn(r){const e=Y(r);return ga(r),e}const Go=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Go.decode();let on=new Uint8Array;function Dt(){return on.byteLength===0&&(on=new Uint8Array(J.memory.buffer)),on}function ct(r,e){return Go.decode(Dt().subarray(r,r+e))}function ve(r){Bt===He.length&&He.push(He.length+1);const e=Bt;return Bt=He[e],He[e]=r,e}function Pn(r){return r==null}let sn=new Float64Array;function ba(){return sn.byteLength===0&&(sn=new Float64Array(J.memory.buffer)),sn}let ln=new Int32Array;function ye(){return ln.byteLength===0&&(ln=new Int32Array(J.memory.buffer)),ln}let Xe=0;const an=new TextEncoder("utf-8"),va=typeof an.encodeInto=="function"?function(r,e){return an.encodeInto(r,e)}:function(r,e){const t=an.encode(r);return e.set(t),{read:r.length,written:t.length}};function Zt(r,e,t){if(t===void 0){const a=an.encode(r),l=e(a.length);return Dt().subarray(l,l+a.length).set(a),Xe=a.length,l}let n=r.length,o=e(n);const i=Dt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;i[o+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),o=t(o,n,n=s+r.length*3);const a=Dt().subarray(o+s,o+n),l=va(r,a);s+=l.written}return Xe=s,o}function Qn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let i="[";o>0&&(i+=Qn(r[0]));for(let s=1;s<o;s++)i+=", "+Qn(r[s]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function ya(r,e){const t=e(r.length*1);return Dt().set(r,t/1),Xe=r.length,t}function xn(r,e){try{return r.apply(this,e)}catch(t){J.__wbindgen_exn_store(ve(t))}}class bn{static __wrap(e){const t=Object.create(bn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();J.__wbg_jsroutesnapper_free(e)}constructor(e){try{const i=J.__wbindgen_add_to_stack_pointer(-16),s=ya(e,J.__wbindgen_malloc),a=Xe;J.jsroutesnapper_new(i,s,a);var t=ye()[i/4+0],n=ye()[i/4+1],o=ye()[i/4+2];if(o)throw Zn(n);return bn.__wrap(t)}finally{J.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){J.jsroutesnapper_setConfig(this.ptr,ve(e))}toFinalFeature(){try{const n=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];let o;return e!==0&&(o=ct(e,t).slice(),J.__wbindgen_free(e,t*1)),o}finally{J.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_renderGeojson(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];return ct(e,t)}finally{J.__wbindgen_add_to_stack_pointer(16),J.__wbindgen_free(e,t)}}setSnapMode(e){J.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return J.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){J.jsroutesnapper_onClick(this.ptr)}onDragStart(){return J.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return J.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){J.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const o=J.__wbindgen_add_to_stack_pointer(-16);J.jsroutesnapper_editExisting(o,this.ptr,ve(e));var t=ye()[o/4+0],n=ye()[o/4+1];if(n)throw Zn(t)}finally{J.__wbindgen_add_to_stack_pointer(16)}}}async function wa(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function ka(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Zn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=Y(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ct(e,t));return ve(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=ct(e,t);return ve(n)},r.wbg.__wbindgen_is_object=function(e){const t=Y(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Y(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Y(e)in Y(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=Y(t),o=typeof n=="number"?n:void 0;ba()[e/8+1]=Pn(o)?0:o,ye()[e/4+0]=!Pn(o)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Y(e)==Y(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Y(t),o=typeof n=="string"?n:void 0;var i=Pn(o)?0:Zt(o,J.__wbindgen_malloc,J.__wbindgen_realloc),s=Xe;ye()[e/4+1]=s,ye()[e/4+0]=i},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(Y(t)),o=Zt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),i=Xe;ye()[e/4+1]=i,ye()[e/4+0]=o},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Y(e);return ve(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=Y(e)[Y(t)];return ve(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(Y(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(Y(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(Y(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(Y(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(Y(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=Y(e)[t>>>0];return ve(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return Y(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Y(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=Y(e).next;return ve(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return xn(function(e){const t=Y(e).next();return ve(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return Y(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=Y(e).value;return ve(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ve(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return xn(function(e,t){const n=Reflect.get(Y(e),Y(t));return ve(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return xn(function(e,t){const n=Y(e).call(Y(t));return ve(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(Y(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=Y(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=Y(e).buffer;return ve(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(Y(e));return ve(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){Y(e).set(Y(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return Y(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=Y(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ve(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Y(t).stack,o=Zt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),i=Xe;ye()[e/4+1]=i,ye()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(ct(e,t))}finally{J.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=Qn(Y(t)),o=Zt(n,J.__wbindgen_malloc,J.__wbindgen_realloc),i=Xe;ye()[e/4+1]=i,ye()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ct(e,t))},r.wbg.__wbindgen_memory=function(){const e=J.memory;return ve(e)},r}function Sa(r,e){return J=r.exports,Ho.__wbindgen_wasm_module=e,sn=new Float64Array,ln=new Int32Array,on=new Uint8Array,J}async function Ho(r){typeof r>"u"&&(r="/atip/speed_limit/assets/route_snapper_bg.wasm");const e=ka();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await wa(await r,e);return Sa(t,n)}const Rt="route-snapper",oo=10,Ea=30;class Ma{constructor(e,t){ie(this,"map");ie(this,"inner");ie(this,"active");ie(this,"eventListenersSuccessRoute");ie(this,"eventListenersSuccessArea");ie(this,"eventListenersFailure");ie(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new bn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Ze(e,Rt,Ce()),we(e,{id:"route-points",source:Rt,filter:En,...Mt(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",oo/2,oo])}),we(e,{id:"route-lines",source:Rt,filter:Mn,...vt("black",2.5)}),we(e,{id:"route-polygons",source:Rt,filter:$n,...Sn("black",.5)}),this.events=new ar(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Ea,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Rt).setData(JSON.parse(this.inner.renderGeojson()))}}function $a(r){let e,t,n,o,i,s,a,l;return{c(){e=E("button"),t=E("img"),o=C(),i=X(r[2]),fn(t.src,n=r[3])||L(t,"src",n),L(t,"alt",r[2]),L(t,"class","svelte-1vvpkg9"),L(e,"type","button"),e.disabled=s=r[0]==r[1],L(e,"class","svelte-1vvpkg9")},m(u,p){w(u,e,p),S(e,t),S(e,o),S(e,i),a||(l=U(e,"click",r[5]),a=!0)},p(u,[p]){p&8&&!fn(t.src,n=u[3])&&L(t,"src",n),p&4&&L(t,"alt",u[2]),p&4&&xe(i,u[2]),p&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:G,o:G,d(u){u&&k(e),a=!1,l()}}}function La(r,e,t){let{mode:n}=e,{thisMode:o}=e,{label:i}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(o);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,o=u.thisMode),"label"in u&&t(2,i=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,o,i,s,a,l]}class tt extends V{constructor(e){super(),K(this,e,La,$a,W,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function io(r){let e;function t(i,s){return i[1]?Ra:Oa}let n=t(r),o=n(r);return{c(){o.c(),e=be()},m(i,s){o.m(i,s),w(i,e,s)},p(i,s){n!==(n=t(i))&&(o.d(1),o=n(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){o.d(i),i&&k(e)}}}function Oa(r){let e;return{c(){e=E("p"),e.textContent="Click an object to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ra(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another object"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ca(r){let e,t=r[0]==pt&&io(r);return{c(){t&&t.c(),e=be()},m(n,o){t&&t.m(n,o),w(n,e,o)},p(n,[o]){n[0]==pt?t?t.p(n,o):(t=io(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&k(e)}}}const pt="edit-attribute";function zo(){}function Aa(r,e,t){let n,o,i,s;se(r,Ae,f=>t(5,n=f)),se(r,ne,f=>t(6,o=f)),se(r,Ut,f=>t(7,i=f)),se(r,Se,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){Se.set(null)}n.on("mousemove",p),n.on("mouseout",d),n.on("click",c),rt(()=>{n.off("mousemove",p),n.off("mouseout",d),n.off("click",c)});function p(f){var h;if(a==pt){let _=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});je.set(((h=_[0])==null?void 0:h.id)||null)}}function d(){a==pt&&je.set(null)}function c(f){if(a==pt){let h=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});h.length>0?Se.set(h[0].id):Se.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=i;if(f){let h=o.features.find(_=>_.id==f);h.geometry.type=="Point"?n.flyTo({center:h.geometry.coordinates,duration:500}):n.fitBounds(nr(h),{padding:200,duration:500}),l(pt)}}},[a,s,l,zo,u,n,o,i]}class Ta extends V{constructor(e){super(),K(this,e,Aa,Ca,W,{mode:0,changeMode:2,start:3,stop:4})}get start(){return zo}get stop(){return this.$$.ctx[4]}}function Ia(r){let e,t;return{c:G,m(n,o){e||(t=U(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function Fa(r,e,t){let{tool:n}=e;function o(i){i.key=="Escape"&&(n.cancel(),i.preventDefault())}return r.$$set=i=>{"tool"in i&&t(1,n=i.tool)},[o,n]}class Rn extends V{constructor(e){super(),K(this,e,Fa,Ia,W,{tool:1})}}function Pa(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function xa(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Na(r){let e,t,n,o,i,s,a,l,u,p;function d(h,_){return h[1]?xa:Pa}let c=d(r),f=c(r);return a=new Rn({props:{tool:r[0]}}),{c(){e=E("ul"),f.c(),t=C(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",o=C(),i=E("button"),i.textContent="Cancel",s=C(),N(a.$$.fragment),L(i,"type","button")},m(h,_){w(h,e,_),f.m(e,null),S(e,t),S(e,n),w(h,o,_),w(h,i,_),w(h,s,_),B(a,h,_),l=!0,u||(p=U(i,"click",r[2]),u=!0)},p(h,[_]){c!==(c=d(h))&&(f.d(1),f=c(h),f&&(f.c(),f.m(e,t)));const g={};_&1&&(g.tool=h[0]),a.$set(g)},i(h){l||($(a.$$.fragment,h),l=!0)},o(h){O(a.$$.fragment,h),l=!1},d(h){h&&k(e),f.d(),h&&k(o),h&&k(i),h&&k(s),D(a,h),u=!1,p()}}}function Ba(r,e,t){let{pointTool:n}=e,{editingExisting:o}=e;const i=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,o=s.editingExisting)},[n,o,i]}class Yo extends V{constructor(e){super(),K(this,e,Ba,Na,W,{pointTool:0,editingExisting:1})}}function Da(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function ja(r){let e,t,n,o,i,s,a,l,u,p,d;return e=new On({props:{label:"Help",$$slots:{default:[Da]},$$scope:{ctx:r}}}),l=new Rn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=C(),n=E("div"),o=E("button"),o.textContent="Finish",i=C(),s=E("button"),s.textContent="Cancel",a=C(),N(l.$$.fragment),L(o,"type","button"),L(s,"type","button"),ue(n,"display","flex"),ue(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,o),S(n,i),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(d=[U(o,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const h={};f&8&&(h.$$scope={dirty:f,ctx:c}),e.$set(h);const _={};f&1&&(_.tool=c[0]),l.$set(_)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){O(e.$$.fragment,c),O(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Oe(d)}}}function qa(r,e,t){let{polygonTool:n}=e;const o=()=>n.finish(),i=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,o,i]}class Jo extends V{constructor(e){super(),K(this,e,qa,ja,W,{polygonTool:0})}}function Ua(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Ga(r){let e,t,n,o,i,s,a,l,u,p,d;return e=new On({props:{label:"Help",$$slots:{default:[Ua]},$$scope:{ctx:r}}}),l=new Rn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=C(),n=E("div"),o=E("button"),o.textContent="Finish",i=C(),s=E("button"),s.textContent="Cancel",a=C(),N(l.$$.fragment),L(o,"type","button"),L(s,"type","button"),ue(n,"display","flex"),ue(n,"justify-content","space-between")},m(c,f){B(e,c,f),w(c,t,f),w(c,n,f),S(n,o),S(n,i),S(n,s),w(c,a,f),B(l,c,f),u=!0,p||(d=[U(o,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const h={};f&8&&(h.$$scope={dirty:f,ctx:c}),e.$set(h);const _={};f&1&&(_.tool=c[0]),l.$set(_)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){O(e.$$.fragment,c),O(l.$$.fragment,c),u=!1},d(c){D(e,c),c&&k(t),c&&k(n),c&&k(a),D(l,c),p=!1,Oe(d)}}}function Ha(r,e,t){let{routeTool:n}=e;const o=()=>n.finish(),i=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,o,i]}class Xo extends V{constructor(e){super(),K(this,e,Ha,Ga,W,{routeTool:0})}}function za(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Ya(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,h,_;return e=new On({props:{label:"Help",$$slots:{default:[za]},$$scope:{ctx:r}}}),c=new Rn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=C(),n=E("label"),o=E("input"),i=X(`
  Avoid doubling back`),s=C(),a=E("div"),l=E("button"),l.textContent="Finish",u=C(),p=E("button"),p.textContent="Cancel",d=C(),N(c.$$.fragment),L(o,"type","checkbox"),L(l,"type","button"),L(p,"type","button"),ue(a,"display","flex"),ue(a,"justify-content","space-between")},m(g,v){B(e,g,v),w(g,t,v),w(g,n,v),S(n,o),o.checked=r[1],S(n,i),w(g,s,v),w(g,a,v),S(a,l),S(a,u),S(a,p),w(g,d,v),B(c,g,v),f=!0,h||(_=[U(o,"change",r[2]),U(l,"click",r[3]),U(p,"click",r[4])],h=!0)},p(g,[v]){const m={};v&32&&(m.$$scope={dirty:v,ctx:g}),e.$set(m),v&2&&(o.checked=g[1]);const b={};v&1&&(b.tool=g[0]),c.$set(b)},i(g){f||($(e.$$.fragment,g),$(c.$$.fragment,g),f=!0)},o(g){O(e.$$.fragment,g),O(c.$$.fragment,g),f=!1},d(g){D(e,g),g&&k(t),g&&k(n),g&&k(s),g&&k(a),g&&k(d),D(c,g),h=!1,Oe(_)}}}function Ja(r,e,t){let{routeTool:n}=e,o=!1;function i(){o=this.checked,t(1,o)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:o})},[n,o,i,s,a]}class Wo extends V{constructor(e){super(),K(this,e,Ja,Ya,W,{routeTool:0})}}function so(r){let e,t,n,o;const i=[Za,Ka,Va,Wa,Xa],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=i[e](r),{c(){t.c(),n=be()},m(l,u){s[e].m(l,u),w(l,n,u),o=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(pe(),O(s[p],1,1,()=>{s[p]=null}),de(),t=s[e],t?t.p(l,u):(t=s[e]=i[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){o||($(t),o=!0)},o(l){O(t),o=!1},d(l){s[e].d(l),l&&k(n)}}}function Xa(r){let e;return{c(){e=E("p"),e.textContent="Click an object to edit its geometry"},m(t,n){w(t,e,n)},p:G,i:G,o:G,d(t){t&&k(e)}}}function Wa(r){let e,t;return e=new Wo({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.routeTool=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Va(r){let e,t;return e=new Xo({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.routeTool=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Ka(r){let e,t;return e=new Jo({props:{polygonTool:r[2]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&4&&(i.polygonTool=n[2]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Za(r){let e,t;return e=new Yo({props:{pointTool:r[1],editingExisting:!0}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.pointTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Qa(r){let e,t,n=r[0]==Ue&&so(r);return{c(){n&&n.c(),e=be()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==Ue?n?(n.p(o,i),i&1&&$(n,1)):(n=so(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(pe(),O(n,1,1,()=>{n=null}),de())},i(o){t||($(n),t=!0)},o(o){O(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const Ue="edit-geometry";function Vo(){}function eu(r,e,t){let n;se(r,Ae,_=>t(8,n=_));let{mode:o}=e,{pointTool:i}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(i.stop(),s.stop(),a.stop(),ne.update(_=>{let g=_.features.find(v=>v.id==l);return delete g.properties.hide_while_editing,_})),l=null,t(4,u=null),je.set(null)}n.on("mousemove",d),n.on("mouseout",c),n.on("click",f),rt(()=>{n.off("mousemove",d),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(_=>{o==Ue&&(ne.update(g=>{let v=g.features.find(m=>m.id==l);return v.properties.length_meters=_.properties.length_meters,v.properties.waypoints=_.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=_.geometry,g}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(_=>{o==Ue&&(ne.update(g=>{let v=g.features.find(m=>m.id==l);return v.properties.waypoints=_.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=_.geometry,g}),l=null,t(4,u=null))});for(let _ of[i,s])_.addEventListenerSuccess(g=>{o==Ue&&(ne.update(v=>{let m=v.features.find(b=>b.id==l);return m.geometry=g.geometry,delete m.properties.hide_while_editing,v}),l=null,t(4,u=null))});for(let _ of[i,s,a])_.addEventListenerFailure(()=>{o==Ue&&(ne.update(g=>{let v=g.features.find(m=>m.id==l);return delete v.properties.hide_while_editing,g}),l=null,t(4,u=null))});function d(_){var g;if(o==Ue&&l==null){let v=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});je.set(((g=v[0])==null?void 0:g.id)||null)}}function c(){o==Ue&&l==null&&je.set(null)}function f(_){if(o==Ue&&l==null){let g=n.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0&&h(g[0].id)}}function h(_){je.set(null);let g=null;ne.update(m=>(g=m.features.find(b=>b.id==_),g.properties.hide_while_editing=!0,m));let v=g;l=_,v.geometry.type=="LineString"?(a.editExistingRoute(v),t(4,u="route")):v.geometry.type=="Polygon"?v.properties.waypoints?(a.editExistingArea(v),t(4,u="snap-polygon")):(s.editExisting(v),t(4,u="free-polygon")):v.geometry.type=="Point"&&(i.start(),t(4,u="point"))}return r.$$set=_=>{"mode"in _&&t(0,o=_.mode),"pointTool"in _&&t(1,i=_.pointTool),"polygonTool"in _&&t(2,s=_.polygonTool),"routeTool"in _&&t(3,a=_.routeTool)},[o,i,s,a,u,Vo,p]}class tu extends V{constructor(e){super(),K(this,e,eu,Qa,W,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return Vo}get stop(){return this.$$.ctx[6]}}async function nu(r,e){const t=await fetch(r),n=t.body.getReader(),o=t.headers.get("Content-Length");let i=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),i+=p.length;const d=100*i/o;e.style=`background: linear-gradient(to right, red ${d}%, transparent 0);`}let a=new Uint8Array(i),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function ru(r){let e,t;return e=new Wo({props:{routeTool:r[0]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&1&&(i.routeTool=n[0]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ou(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&k(e),r[7](null)}}}function iu(r){let e,t,n,o;const i=[ou,ru],s=[];function a(l,u){return l[0]?l[1]==er?1:-1:0}return~(e=a(r))&&(t=s[e]=i[e](r)),{c(){t&&t.c(),n=be()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),o=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(pe(),O(s[p],1,1,()=>{s[p]=null}),de()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=i[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){o||($(t),o=!0)},o(l){O(t),o=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const er="route";function su(r,e,t){let n;se(r,Ae,c=>t(8,n=c));let{mode:o}=e,{changeMode:i}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}kn(async()=>{await Ho(),console.log(`Grabbing ${s}`);try{const c=await nu(s,a);t(0,l=new Ma(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{o==er&&i("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{o==er&&(ne.update(f=>(c.id=Yt(f),c.properties.intervention_type="route",f.features.push(c),f)),i("edit-attribute"),Se.set(c.id))})});function d(c){ae[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,o=c.mode),"changeMode"in c&&t(3,i=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,o,a,i,s,u,p,d]}class lu extends V{constructor(e){super(),K(this,e,su,iu,W,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function lo(r){let e,t;return e=new Yo({props:{pointTool:r[1],editingExisting:!1}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.pointTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function au(r){let e,t,n=r[0]==vn&&lo(r);return{c(){n&&n.c(),e=be()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==vn?n?(n.p(o,i),i&1&&$(n,1)):(n=lo(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(pe(),O(n,1,1,()=>{n=null}),de())},i(o){t||($(n),t=!0)},o(o){O(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const vn="point";function uu(r,e,t){let{mode:n}=e,{changeMode:o}=e,{pointTool:i}=e;function s(){i.start()}function a(){i.stop()}return i.addEventListenerSuccess(l=>{n==vn&&(ne.update(u=>(l.id=Yt(u),l.properties.intervention_type="other",u.features.push(l),u)),o("edit-attribute"),Se.set(l.id))}),i.addEventListenerFailure(()=>{n==vn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"pointTool"in l&&t(1,i=l.pointTool)},[n,i,o,s,a]}class fu extends V{constructor(e){super(),K(this,e,uu,au,W,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ao(r){let e,t;return e=new Jo({props:{polygonTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.polygonTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function cu(r){let e,t,n=r[0]==yn&&ao(r);return{c(){n&&n.c(),e=be()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==yn?n?(n.p(o,i),i&1&&$(n,1)):(n=ao(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(pe(),O(n,1,1,()=>{n=null}),de())},i(o){t||($(n),t=!0)},o(o){O(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const yn="free-polygon";function pu(r,e,t){let{mode:n}=e,{changeMode:o}=e,{polygonTool:i}=e;function s(){i.startNew()}function a(){i.stop()}return i.addEventListenerSuccess(l=>{n==yn&&(ne.update(u=>(l.id=Yt(u),l.properties.intervention_type="area",u.features.push(l),u)),o("edit-attribute"),Se.set(l.id))}),i.addEventListenerFailure(()=>{n==yn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"polygonTool"in l&&t(1,i=l.polygonTool)},[n,i,o,s,a]}class du extends V{constructor(e){super(),K(this,e,pu,cu,W,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function uo(r){let e,t;return e=new Xo({props:{routeTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&2&&(i.routeTool=n[1]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function hu(r){let e,t,n=r[0]==wn&&uo(r);return{c(){n&&n.c(),e=be()},m(o,i){n&&n.m(o,i),w(o,e,i),t=!0},p(o,[i]){o[0]==wn?n?(n.p(o,i),i&1&&$(n,1)):(n=uo(o),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(pe(),O(n,1,1,()=>{n=null}),de())},i(o){t||($(n),t=!0)},o(o){O(n),t=!1},d(o){n&&n.d(o),o&&k(e)}}}const wn="snap-polygon";function mu(r,e,t){let{mode:n}=e,{changeMode:o}=e,{routeTool:i}=e;function s(){i.startArea()}function a(){i.stop()}return i.addEventListenerSuccessArea(l=>{n==wn&&(ne.update(u=>(l.id=Yt(u),l.properties.intervention_type="area",u.features.push(l),u)),o("edit-attribute"),Se.set(l.id))}),i.addEventListenerFailure(()=>{n==wn&&o("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,o=l.changeMode),"routeTool"in l&&t(1,i=l.routeTool)},[n,i,o,s,a]}class _u extends V{constructor(e){super(),K(this,e,mu,hu,W,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function gu(r){var e=r[0],t=r[1],n=r[2],o=r[3],i=Ye(r.slice(0,2),[n,t]),s=Ye(r.slice(0,2),[e,o]);if(i>=s){var a=(t+o)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(o-t)/2,t,l+(o-t)/2,o]}}function bu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,o=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(o===!1||o===void 0)&&(r=JSON.parse(JSON.stringify(r)));var i=Math.pow(10,t);return mi(r,function(s){vu(s,i,n)}),r}function vu(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function yu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Wn(r),n=Wn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var o=bu(e,{precision:7});switch(n){case"Point":return tr(r,o);case"MultiPoint":return fo(r,o);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return fo(r,Uo(r,o))}}function fo(r,e){var t=[],n=St();return or(e,function(o){if(t.forEach(function(a,l){a.id=l}),!t.length)t=tr(r,o).features,t.forEach(function(a){a.bbox||(a.bbox=gu(_i(a)))}),n.load(We(t));else{var i=n.search(o);if(i.features.length){var s=Ko(o,i);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),pn(tr(s,o),function(a){t.push(a),n.insert(a)})}}}),We(t)}function tr(r,e){var t=[],n=qe(r)[0],o=qe(r)[r.geometry.coordinates.length-1];if(Nn(n,Ve(e))||Nn(o,Ve(e)))return We([r]);var i=St(),s=Vn(r);i.load(s);var a=i.search(e);if(!a.features.length)return We([r]);var l=Ko(e,a),u=[n],p=gi(s,function(d,c,f){var h=qe(c)[1],_=Ve(e);return f===l.id?(d.push(_),t.push(wt(d)),Nn(_,h)?[_]:[_,h]):(d.push(h),d)},u);return p.length>1&&t.push(wt(p)),We(t)}function Ko(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return pn(e,function(o){var i=zt(o,r),s=i.properties.dist;s<n&&(t=o,n=s)}),t}function Nn(r,e){return r[0]===e[0]&&r[1]===e[1]}function wu(r,e,t){var n=qe(t);if(Wn(t)!=="LineString")throw new Error("line must be a LineString");var o=zt(t,r),i=zt(t,e),s;o.properties.index<=i.properties.index?s=[o,i]:s=[i,o];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),wt(a,t.properties)}function co(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function ku(r){let e,t,n,o=r[0]==jt&&co();return{c(){o&&o.c(),e=be()},m(i,s){o&&o.m(i,s),w(i,e,s),t||(n=U(window,"keydown",r[1]),t=!0)},p(i,[s]){i[0]==jt?o||(o=co(),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null)},i:G,o:G,d(i){o&&o.d(i),i&&k(e),t=!1,n()}}}const jt="split-route",Su=10,Eu=30;let Bn="split-route";function Zo(){}function po(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Mu(r,e,t){let n,o;se(r,ne,_=>t(8,n=_)),se(r,Ae,_=>t(6,o=_));let{mode:i}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;o.on("mousemove",p),o.on("click",d),rt(()=>{o.off("mousemove",p),o.off("click",d)}),Ze(o,Bn,Ce()),we(o,{id:"draw-split-route",source:Bn,...Mt("black",Su,["case",["==",["get","snapped"],!0],1,.5])});function p(_){if(i!=jt)return;t(5,l=po(_.lngLat.toArray(),!1)),u=null;const g=[_.point.x-Eu,_.point.y],v=o.unproject(_.point).distanceTo(o.unproject(g))/1e3;let m=[];for(let[b,y]of n.features.entries())if(y.geometry.type=="LineString"){let M=zt(y.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=v&&m.push([b,M.geometry.coordinates,M.properties.dist])}m.sort((b,y)=>b[2]-y[2]),m.length>0&&(t(5,l=po(m[0][1],!0)),u=m[0][0])}function d(){if(i==jt)if(u==null)s("edit-attribute");else{let _=yu(n.features[u],l);if(_.features.length==2){let g=_.features[0],v=_.features[1];ne.update(m=>(g.id=m.features[u].id,v.id=Yt(m),g.properties=JSON.parse(JSON.stringify(m.features[u].properties)),v.properties=JSON.parse(JSON.stringify(g.properties)),c(m.features[u],g,v,l),m.features.splice(u,1,g,v),m))}a()}}function c(_,g,v,m){g.properties.length_meters=rn(g,{units:"kilometers"})*1e3,v.properties.length_meters=rn(v,{units:"kilometers"})*1e3,g.properties.waypoints=[],v.properties.waypoints=[];let b=f(_,m),y=!0,M=0;for(let R of _.properties.waypoints){let I=f(_,gt([R.lon,R.lat]));if(y)if(I<b)g.properties.waypoints.push(R);else{let A=R.snapped&&_.properties.waypoints[M-1].snapped;g.properties.waypoints.push({lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1],snapped:A}),y=!1,v.properties.waypoints.push({lon:m.geometry.coordinates[0],lat:m.geometry.coordinates[1],snapped:A}),v.properties.waypoints.push(R)}else v.properties.waypoints.push(R);M++}}function f(_,g){let v=_.geometry.coordinates[0],m=wu(v,g,_);return rn(m,{units:"kilometers"})*1e3}function h(_){i==jt&&_.key=="Escape"&&(s("edit-attribute"),_.preventDefault())}return r.$$set=_=>{"mode"in _&&t(0,i=_.mode),"changeMode"in _&&t(2,s=_.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let _=Ce();l&&_.features.push(l),o.getSource(Bn).setData(_)}},[i,h,s,Zo,a,l,o]}class $u extends V{constructor(e){super(),K(this,e,Mu,ku,W,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Zo}get stop(){return this.$$.ctx[4]}}const Lu="/atip/speed_limit/assets/edit_attributes-29b396e1.svg",Ou="/atip/speed_limit/assets/edit_geometry-02dad294.svg",Ru="/atip/speed_limit/assets/point-276f4055.svg",Cu="/atip/speed_limit/assets/polygon_snapped-18efbbea.svg",Au="/atip/speed_limit/assets/polygon_freehand-cf965967.svg",Tu="/atip/speed_limit/assets/route-d3c0ebad.svg",Iu="/atip/speed_limit/assets/split_route-9e0ea2da.svg";function ho(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new tu({props:n}),r[15](e),{c(){N(e.$$.fragment)},m(o,i){B(e,o,i),t=!0},p(o,i){const s={};i&8&&(s.mode=o[3]),i&4&&(s.routeTool=o[2]),e.$set(s)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){O(e.$$.fragment,o),t=!1},d(o){r[15](null),D(e,o)}}}function mo(r){let e,t;return e=new tt({props:{mode:r[3],thisMode:"point",label:"New point",icon:Ru,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function _o(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new _u({props:n}),r[18](e),{c(){N(e.$$.fragment)},m(o,i){B(e,o,i),t=!0},p(o,i){const s={};i&8&&(s.mode=o[3]),i&4&&(s.routeTool=o[2]),e.$set(s)},i(o){t||($(e.$$.fragment,o),t=!0)},o(o){O(e.$$.fragment,o),t=!1},d(o){r[18](null),D(e,o)}}}function go(r){let e,t;return e=new tt({props:{mode:r[3],thisMode:"route",label:"New route",icon:Tu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function bo(r){let e,t;return e=new tt({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:Iu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,o){B(e,n,o),t=!0},p(n,o){const i={};o&8&&(i.mode=n[3]),e.$set(i)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Fu(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,h,_,g,v,m,b,y,M,R,I,A,x,T,j,Z,P,H,le,ke;n=new tt({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:Lu,changeMode:r[13]}});let Ie={mode:r[3],changeMode:r[13]};i=new Ta({props:Ie}),r[14](i),l=new tt({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:Ou,changeMode:r[13]}});let oe=r[2]&&ho(r),re=r[1]!="planning"&&mo(r),Ne={mode:r[3],changeMode:r[13],pointTool:r[11]};f=new fu({props:Ne}),r[16](f),g=new tt({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:Au,changeMode:r[13]}});let Le={mode:r[3],changeMode:r[13],polygonTool:r[12]};m=new du({props:Le}),r[17](m),M=new tt({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:Cu,changeMode:r[13]}});let Q=r[2]&&_o(r),he=r[1]!="planning"&&go(r);function Xt(q){r[20](q)}let _e={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(_e.routeTool=r[2]),T=new lu({props:_e}),r[19](T),ae.push(()=>Ee(T,"routeTool",Xt,r[2]));let F=r[1]!="planning"&&bo(r),te={mode:r[3],changeMode:r[13]};return le=new $u({props:te}),r[21](le),{c(){e=E("div"),t=E("div"),N(n.$$.fragment),o=C(),N(i.$$.fragment),s=C(),a=E("div"),N(l.$$.fragment),u=C(),oe&&oe.c(),p=C(),d=E("div"),re&&re.c(),c=C(),N(f.$$.fragment),h=C(),_=E("div"),N(g.$$.fragment),v=C(),N(m.$$.fragment),b=C(),y=E("div"),N(M.$$.fragment),R=C(),Q&&Q.c(),I=C(),A=E("div"),he&&he.c(),x=C(),N(T.$$.fragment),Z=C(),P=E("div"),F&&F.c(),H=C(),N(le.$$.fragment),L(e,"class","toolbox svelte-4s4d3o")},m(q,fe){w(q,e,fe),S(e,t),B(n,t,null),S(t,o),B(i,t,null),S(e,s),S(e,a),B(l,a,null),S(a,u),oe&&oe.m(a,null),S(e,p),S(e,d),re&&re.m(d,null),S(d,c),B(f,d,null),S(e,h),S(e,_),B(g,_,null),S(_,v),B(m,_,null),S(e,b),S(e,y),B(M,y,null),S(y,R),Q&&Q.m(y,null),S(e,I),S(e,A),he&&he.m(A,null),S(A,x),B(T,A,null),S(e,Z),S(e,P),F&&F.m(P,null),S(P,H),B(le,P,null),ke=!0},p(q,[fe]){const ur={};fe&8&&(ur.mode=q[3]),n.$set(ur);const fr={};fe&8&&(fr.mode=q[3]),i.$set(fr);const cr={};fe&8&&(cr.mode=q[3]),l.$set(cr),q[2]?oe?(oe.p(q,fe),fe&4&&$(oe,1)):(oe=ho(q),oe.c(),$(oe,1),oe.m(a,null)):oe&&(pe(),O(oe,1,1,()=>{oe=null}),de()),q[1]!="planning"?re?(re.p(q,fe),fe&2&&$(re,1)):(re=mo(q),re.c(),$(re,1),re.m(d,c)):re&&(pe(),O(re,1,1,()=>{re=null}),de());const pr={};fe&8&&(pr.mode=q[3]),f.$set(pr);const dr={};fe&8&&(dr.mode=q[3]),g.$set(dr);const hr={};fe&8&&(hr.mode=q[3]),m.$set(hr);const mr={};fe&8&&(mr.mode=q[3]),M.$set(mr),q[2]?Q?(Q.p(q,fe),fe&4&&$(Q,1)):(Q=_o(q),Q.c(),$(Q,1),Q.m(y,null)):Q&&(pe(),O(Q,1,1,()=>{Q=null}),de()),q[1]!="planning"?he?(he.p(q,fe),fe&2&&$(he,1)):(he=go(q),he.c(),$(he,1),he.m(A,x)):he&&(pe(),O(he,1,1,()=>{he=null}),de());const Wt={};fe&8&&(Wt.mode=q[3]),fe&1&&(Wt.url=q[0]),!j&&fe&4&&(j=!0,Wt.routeTool=q[2],Me(()=>j=!1)),T.$set(Wt),q[1]!="planning"?F?(F.p(q,fe),fe&2&&$(F,1)):(F=bo(q),F.c(),$(F,1),F.m(P,H)):F&&(pe(),O(F,1,1,()=>{F=null}),de());const _r={};fe&8&&(_r.mode=q[3]),le.$set(_r)},i(q){ke||($(n.$$.fragment,q),$(i.$$.fragment,q),$(l.$$.fragment,q),$(oe),$(re),$(f.$$.fragment,q),$(g.$$.fragment,q),$(m.$$.fragment,q),$(M.$$.fragment,q),$(Q),$(he),$(T.$$.fragment,q),$(F),$(le.$$.fragment,q),ke=!0)},o(q){O(n.$$.fragment,q),O(i.$$.fragment,q),O(l.$$.fragment,q),O(oe),O(re),O(f.$$.fragment,q),O(g.$$.fragment,q),O(m.$$.fragment,q),O(M.$$.fragment,q),O(Q),O(he),O(T.$$.fragment,q),O(F),O(le.$$.fragment,q),ke=!1},d(q){q&&k(e),D(n),r[14](null),D(i),D(l),oe&&oe.d(),re&&re.d(),r[16](null),D(f),D(g),r[17](null),D(m),D(M),Q&&Q.d(),he&&he.d(),r[19](null),D(T),F&&F.d(),r[21](null),D(le)}}}function Pu(r,e,t){let n;se(r,Ae,T=>t(22,n=T));let{routeSnapperUrl:o}=e,{schema:i}=e,s,a=new oa(n),l=new _a(n),u="edit-attribute",p,d,c,f,h,_,g;function v(T){let j={"edit-attribute":p,"edit-geometry":d,route:c,point:f,"free-polygon":h,"snap-polygon":_,"split-route":g};if(u==T){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),j[u].stop(),t(3,u=T),console.log(`Starting new mode ${u}`),j[u].start()}rt(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function m(T){ae[T?"unshift":"push"](()=>{p=T,t(4,p)})}function b(T){ae[T?"unshift":"push"](()=>{d=T,t(5,d)})}function y(T){ae[T?"unshift":"push"](()=>{f=T,t(7,f)})}function M(T){ae[T?"unshift":"push"](()=>{h=T,t(8,h)})}function R(T){ae[T?"unshift":"push"](()=>{_=T,t(9,_)})}function I(T){ae[T?"unshift":"push"](()=>{c=T,t(6,c)})}function A(T){s=T,t(2,s)}function x(T){ae[T?"unshift":"push"](()=>{g=T,t(10,g)})}return r.$$set=T=>{"routeSnapperUrl"in T&&t(0,o=T.routeSnapperUrl),"schema"in T&&t(1,i=T.schema)},[o,i,s,u,p,d,c,f,h,_,g,a,l,v,m,b,y,M,R,I,A,x]}class xu extends V{constructor(e){super(),K(this,e,Pu,Fu,W,{routeSnapperUrl:0,schema:1})}}function Nu(r){let e,t,n,o,i,s,a,l,u,p,d,c,f,h,_,g,v,m,b;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",o=C(),i=E("button"),i.textContent="About",s=C(),a=E("button"),a.textContent="Instructions",l=C(),u=E("br"),p=C(),d=E("label"),c=X(`ATIP schema:
      `),f=E("select"),h=E("option"),h.textContent="v1",_=E("option"),_.textContent="v2",g=E("option"),g.textContent="Housing developments",v=E("option"),v.textContent="Critical issues",L(n,"type","button"),L(i,"type","button"),L(a,"type","button"),h.__value="v1",h.value=h.__value,_.__value="v2",_.value=_.__value,g.__value="planning",g.value=g.__value,v.__value="criticals",v.value=v.__value,r[2]===void 0&&Et(()=>r[12].call(f)),L(e,"slot","nav")},m(y,M){w(y,e,M),S(e,t),S(t,n),S(t,o),S(t,i),S(t,s),S(t,a),S(e,l),S(e,u),S(e,p),S(e,d),S(d,c),S(d,f),S(f,h),S(f,_),S(f,g),S(f,v),bt(f,r[2]),m||(b=[U(n,"click",r[11]),U(i,"click",r[8]),U(a,"click",r[9]),U(f,"change",r[12]),U(f,"change",r[10])],m=!0)},p(y,M){M&4&&bt(f,y[2])},d(y){y&&k(e),m=!1,Oe(b)}}}function Bu(r){let e,t,n,o,i,s,a,l,u,p,d,c;return i=new Ul({props:{boundaryGeojson:r[5]}}),a=new Bl({props:{authorityName:r[6],schema:r[2]}}),d=new Il({props:{schema:r[2],routeInfo:r[4]}}),{c(){e=E("div"),t=E("h1"),n=X(r[6]),o=C(),N(i.$$.fragment),s=C(),N(a.$$.fragment),l=C(),u=E("br"),p=C(),N(d.$$.fragment),L(e,"slot","sidebar")},m(f,h){w(f,e,h),S(e,t),S(t,n),S(t,o),B(i,t,null),S(e,s),B(a,e,null),S(e,l),S(e,u),S(e,p),B(d,e,null),c=!0},p(f,h){const _={};h&32&&(_.boundaryGeojson=f[5]),i.$set(_);const g={};h&4&&(g.schema=f[2]),a.$set(g);const v={};h&4&&(v.schema=f[2]),h&16&&(v.routeInfo=f[4]),d.$set(v)},i(f){c||($(i.$$.fragment,f),$(a.$$.fragment,f),$(d.$$.fragment,f),c=!0)},o(f){O(i.$$.fragment,f),O(a.$$.fragment,f),O(d.$$.fragment,f),c=!1},d(f){f&&k(e),D(i),D(a),D(d)}}}function Du(r){let e,t,n,o,i,s,a,l,u,p,d,c;return e=new Ls({props:{boundaryGeojson:r[5]}}),n=new ta({props:{schema:r[2]}}),i=new ra({}),a=new xu({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new zl({props:{style:r[7]}}),d=new Ql({props:{schema:r[2]}}),{c(){N(e.$$.fragment),t=C(),N(n.$$.fragment),o=C(),N(i.$$.fragment),s=C(),N(a.$$.fragment),l=C(),N(u.$$.fragment),p=C(),N(d.$$.fragment)},m(f,h){B(e,f,h),w(f,t,h),B(n,f,h),w(f,o,h),B(i,f,h),w(f,s,h),B(a,f,h),w(f,l,h),B(u,f,h),w(f,p,h),B(d,f,h),c=!0},p(f,h){const _={};h&32&&(_.boundaryGeojson=f[5]),e.$set(_);const g={};h&4&&(g.schema=f[2]),n.$set(g);const v={};h&8&&(v.routeSnapperUrl=f[3]),h&4&&(v.schema=f[2]),a.$set(v);const m={};h&4&&(m.schema=f[2]),d.$set(m)},i(f){c||($(e.$$.fragment,f),$(n.$$.fragment,f),$(i.$$.fragment,f),$(a.$$.fragment,f),$(u.$$.fragment,f),$(d.$$.fragment,f),c=!0)},o(f){O(e.$$.fragment,f),O(n.$$.fragment,f),O(i.$$.fragment,f),O(a.$$.fragment,f),O(u.$$.fragment,f),O(d.$$.fragment,f),c=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(o),D(i,f),f&&k(s),D(a,f),f&&k(l),D(u,f),f&&k(p),D(d,f)}}}function ju(r){let e,t,n;return t=new Xi({props:{style:r[7],$$slots:{default:[Du]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),L(e,"slot","main")},m(o,i){w(o,e,i),B(t,e,null),n=!0},p(o,i){const s={};i&524332&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){n||($(t.$$.fragment,o),n=!0)},o(o){O(t.$$.fragment,o),n=!1},d(o){o&&k(e),D(t)}}}function qu(r){let e,t,n,o,i,s,a,l;e=new es({props:{$$slots:{main:[ju],sidebar:[Bu],nav:[Nu]},$$scope:{ctx:r}}});function u(f){r[13](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new bi({props:p}),ae.push(()=>Ee(n,"open",u,r[0]));function d(f){r[14](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new zi({props:c}),ae.push(()=>Ee(s,"open",d,r[1])),{c(){N(e.$$.fragment),t=C(),N(n.$$.fragment),i=C(),N(s.$$.fragment)},m(f,h){B(e,f,h),w(f,t,h),B(n,f,h),w(f,i,h),B(s,f,h),l=!0},p(f,[h]){const _={};h&524348&&(_.$$scope={dirty:h,ctx:f}),e.$set(_);const g={};!o&&h&1&&(o=!0,g.open=f[0],Me(()=>o=!1)),n.$set(g);const v={};!a&&h&2&&(a=!0,v.open=f[1],Me(()=>a=!1)),s.$set(v)},i(f){l||($(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!0)},o(f){O(e.$$.fragment,f),O(n.$$.fragment,f),O(s.$$.fragment,f),l=!1},d(f){D(e,f),f&&k(t),D(n,f),f&&k(i),D(s,f)}}}function Uu(r,e,t){let n=!1,o=!1,i=window.location.hostname.includes("atip.uk");const s=new URLSearchParams(window.location.search);let a=s.get("authority"),l=s.get("style")||"streets",u=s.get("schema")||"v1";var p=`https://atip.uk/route-snappers/${a}.bin`,d=`https://atip.uk/route-info/${a}.bin`;i||(p=`https://atip.uk/route-snappers-dev/${a}.bin`,d=`https://atip.uk/route-info-dev/${a}.bin`);let c;function f(){t(0,n=!n),t(1,o=!1)}function h(){t(1,o=!o),t(0,n=!1)}let _;kn(async()=>{t(5,_=await g());const R=Eo(new Ti);t(4,c=await new R),await c.loadFile(d)});async function g(){const I=await(await fetch(vi)).text(),A=JSON.parse(I);return A.features=A.features.filter(x=>{var T;return((T=x.properties)==null?void 0:T.name)==a}),A}function v(){let R=new URLSearchParams(window.location.search);R.set("schema",u);let I=`${window.location.pathname}?${R.toString()}${window.location.hash}`;window.location.href=I}const m=()=>window.open("index.html");function b(){u=rr(this),t(2,u)}function y(R){n=R,t(0,n)}function M(R){o=R,t(1,o)}return[n,o,u,p,c,_,a,l,f,h,v,m,b,y,M]}class Gu extends V{constructor(e){super(),K(this,e,Uu,qu,W,{})}}new Gu({target:document.getElementById("app")});
