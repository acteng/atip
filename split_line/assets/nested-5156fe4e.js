var Bs=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var Oi=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)};var Dt=(n,e,t)=>(Bs(n,e,"access private method"),t);import{S as xe,i as Oe,s as Ie,x as ye,y as ct,f as X,z as cn,g as R,h as P,B as pt,C as Ce,p as F,D as Be,E as at,t as me,F as Ue,G as Kt,H as fe,e as U,I as Ze,J as L,l as ie,r as gt,K as Us,L as kn,c as J,n as V,M as it,o as W,N as ot,O as vl,P as bl,d as he,m as pe,q as ge,Q as eo,R as Tn,T as mt,U as vt,V as bt,W as _t,X as Gs,Y as ii,Z as Yn,_ as oi,$ as Je,b as je,a0 as _l,a1 as ta,a2 as zs,j as jn,a3 as js,a as kt,k as Mt,a4 as Gr,a5 as Vs,a6 as qs,a7 as Ii,a8 as to,a9 as na,w as no,aa as ra,ab as Ys,ac as Js,ad as ia,ae as Xs,af as Un,ag as Ws,ah as ro,A as Hs,u as Zs}from"./authorities-e7c2eb3f.js";function oa(n){let e,t;return{c(){e=ct("title"),t=me(n[1])},m(r,i){R(r,e,i),P(e,t)},p(r,i){i&2&&Ue(t,r[1])},d(r){r&&F(e)}}}function Ks(n){let e,t,r=n[1]&&oa(n),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],o={};for(let l=0;l<i.length;l+=1)o=ye(o,i[l]);return{c(){e=ct("svg"),r&&r.c(),t=ct("path"),X(t,"d","M22 16L12 26 10.6 24.6 19.2 16 10.6 7.4 12 6z"),cn(e,o)},m(l,s){R(l,e,s),r&&r.m(e,null),P(e,t)},p(l,[s]){l[1]?r?r.p(l,s):(r=oa(l),r.c(),r.m(e,t)):r&&(r.d(1),r=null),cn(e,o=pt(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},s&1&&{width:l[0]},s&1&&{height:l[0]},s&4&&l[2],s&8&&l[3]]))},i:Ce,o:Ce,d(l){l&&F(e),r&&r.d()}}}function Qs(n,e,t){let r,i;const o=["size","title"];let l=Be(e,o),{size:s=16}=e,{title:f=void 0}=e;return n.$$set=c=>{t(5,e=ye(ye({},e),at(c))),t(3,l=Be(e,o)),"size"in c&&t(0,s=c.size),"title"in c&&t(1,f=c.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||f),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=at(e),[s,f,i,l,r]}class $s extends xe{constructor(e){super(),Oe(this,e,Qs,Ks,Ie,{size:0,title:1})}}const io=$s;function aa(n,e,t){const r=n.slice();return r[2]=e[t].width,r}function eu(n){let e,t,r,i,o=[n[4],{style:t="width: "+n[2]+";"+n[4].style}],l={};for(let s=0;s<o.length;s+=1)l=ye(l,o[s]);return{c(){e=U("p"),Ze(e,l),L(e,"bx--skeleton__text",!0),L(e,"bx--skeleton__heading",n[0])},m(s,f){R(s,e,f),r||(i=[ie(e,"click",n[12]),ie(e,"mouseover",n[13]),ie(e,"mouseenter",n[14]),ie(e,"mouseleave",n[15])],r=!0)},p(s,f){Ze(e,l=pt(o,[f&16&&s[4],f&20&&t!==(t="width: "+s[2]+";"+s[4].style)&&{style:t}])),L(e,"bx--skeleton__text",!0),L(e,"bx--skeleton__heading",s[0])},d(s){s&&F(e),r=!1,gt(i)}}}function tu(n){let e,t,r,i=n[3],o=[];for(let f=0;f<i.length;f+=1)o[f]=la(aa(n,i,f));let l=[n[4]],s={};for(let f=0;f<l.length;f+=1)s=ye(s,l[f]);return{c(){e=U("div");for(let f=0;f<o.length;f+=1)o[f].c();Ze(e,s)},m(f,c){R(f,e,c);for(let g=0;g<o.length;g+=1)o[g].m(e,null);t||(r=[ie(e,"click",n[8]),ie(e,"mouseover",n[9]),ie(e,"mouseenter",n[10]),ie(e,"mouseleave",n[11])],t=!0)},p(f,c){if(c&9){i=f[3];let g;for(g=0;g<i.length;g+=1){const _=aa(f,i,g);o[g]?o[g].p(_,c):(o[g]=la(_),o[g].c(),o[g].m(e,null))}for(;g<o.length;g+=1)o[g].d(1);o.length=i.length}Ze(e,s=pt(l,[c&16&&f[4]]))},d(f){f&&F(e),Us(o,f),t=!1,gt(r)}}}function la(n){let e;return{c(){e=U("p"),kn(e,"width",n[2]),L(e,"bx--skeleton__text",!0),L(e,"bx--skeleton__heading",n[0])},m(t,r){R(t,e,r)},p(t,r){r&8&&kn(e,"width",t[2]),r&1&&L(e,"bx--skeleton__heading",t[0])},d(t){t&&F(e)}}}function nu(n){let e;function t(o,l){return o[1]?tu:eu}let r=t(n),i=r(n);return{c(){i.c(),e=Kt()},m(o,l){i.m(o,l),R(o,e,l)},p(o,[l]){r===(r=t(o))&&i?i.p(o,l):(i.d(1),i=r(o),i&&(i.c(),i.m(e.parentNode,e)))},i:Ce,o:Ce,d(o){i.d(o),o&&F(e)}}}function ru(n,e,t){let r,i,o;const l=["lines","heading","paragraph","width"];let s=Be(e,l),{lines:f=3}=e,{heading:c=!1}=e,{paragraph:g=!1}=e,{width:_="100%"}=e;const m=[.973,.153,.567];function d(M){fe.call(this,n,M)}function p(M){fe.call(this,n,M)}function w(M){fe.call(this,n,M)}function O(M){fe.call(this,n,M)}function z(M){fe.call(this,n,M)}function v(M){fe.call(this,n,M)}function b(M){fe.call(this,n,M)}function E(M){fe.call(this,n,M)}return n.$$set=M=>{e=ye(ye({},e),at(M)),t(4,s=Be(e,l)),"lines"in M&&t(5,f=M.lines),"heading"in M&&t(0,c=M.heading),"paragraph"in M&&t(1,g=M.paragraph),"width"in M&&t(2,_=M.width)},n.$$.update=()=>{if(n.$$.dirty&4&&t(7,i=parseInt(_,10)),n.$$.dirty&4&&t(6,o=_.includes("px")),n.$$.dirty&238&&g)for(let M=0;M<f;M++){const x=o?i-75:0,j=o?i:75,A=Math.floor(m[M%3]*(j-x+1))+x+"px";t(3,r=[...r,{width:o?A:`calc(${_} - ${A})`}])}},t(3,r=[]),[c,g,_,r,s,f,o,i,d,p,w,O,z,v,b,E]}class iu extends xe{constructor(e){super(),Oe(this,e,ru,nu,Ie,{lines:5,heading:0,paragraph:1,width:2})}}const ir=iu;function sa(n,e,t){const r=n.slice();return r[9]=e[t],r}function ua(n){let e,t,r,i,o,l,s,f,c,g,_,m,d;return r=new io({props:{class:"bx--accordion__arrow"}}),o=new ir({props:{class:"bx--accordion__title"}}),f=new ir({props:{width:"90%"}}),g=new ir({props:{width:"80%"}}),m=new ir({props:{width:"95%"}}),{c(){e=U("li"),t=U("span"),he(r.$$.fragment),i=J(),he(o.$$.fragment),l=J(),s=U("div"),he(f.$$.fragment),c=J(),he(g.$$.fragment),_=J(),he(m.$$.fragment),L(t,"bx--accordion__heading",!0),L(s,"bx--accordion__content",!0),L(e,"bx--accordion__item",!0),L(e,"bx--accordion__item--active",!0)},m(p,w){R(p,e,w),P(e,t),pe(r,t,null),P(t,i),pe(o,t,null),P(e,l),P(e,s),pe(f,s,null),P(s,c),pe(g,s,null),P(s,_),pe(m,s,null),d=!0},i(p){d||(V(r.$$.fragment,p),V(o.$$.fragment,p),V(f.$$.fragment,p),V(g.$$.fragment,p),V(m.$$.fragment,p),d=!0)},o(p){W(r.$$.fragment,p),W(o.$$.fragment,p),W(f.$$.fragment,p),W(g.$$.fragment,p),W(m.$$.fragment,p),d=!1},d(p){p&&F(e),ge(r),ge(o),ge(f),ge(g),ge(m)}}}function fa(n,e){let t,r,i,o,l,s,f;return i=new io({props:{class:"bx--accordion__arrow"}}),l=new ir({props:{class:"bx--accordion__title"}}),{key:n,first:null,c(){t=U("li"),r=U("span"),he(i.$$.fragment),o=J(),he(l.$$.fragment),s=J(),L(r,"bx--accordion__heading",!0),L(t,"bx--accordion__item",!0),this.first=t},m(c,g){R(c,t,g),P(t,r),pe(i,r,null),P(r,o),pe(l,r,null),P(t,s),f=!0},p(c,g){},i(c){f||(V(i.$$.fragment,c),V(l.$$.fragment,c),f=!0)},o(c){W(i.$$.fragment,c),W(l.$$.fragment,c),f=!1},d(c){c&&F(t),ge(i),ge(l)}}}function ou(n){let e,t,r=[],i=new Map,o,l,s,f=n[3]&&ua(),c=Array.from({length:n[3]?n[0]-1:n[0]},ca);const g=d=>d[9];for(let d=0;d<c.length;d+=1){let p=sa(n,c,d),w=g(p);i.set(w,r[d]=fa(w))}let _=[n[4]],m={};for(let d=0;d<_.length;d+=1)m=ye(m,_[d]);return{c(){e=U("ul"),f&&f.c(),t=J();for(let d=0;d<r.length;d+=1)r[d].c();Ze(e,m),L(e,"bx--skeleton",!0),L(e,"bx--accordion",!0),L(e,"bx--accordion--start",n[1]==="start"),L(e,"bx--accordion--end",n[1]==="end"),L(e,"bx--accordion--sm",n[2]==="sm"),L(e,"bx--accordion--xl",n[2]==="xl")},m(d,p){R(d,e,p),f&&f.m(e,null),P(e,t);for(let w=0;w<r.length;w+=1)r[w].m(e,null);o=!0,l||(s=[ie(e,"click",n[5]),ie(e,"mouseover",n[6]),ie(e,"mouseenter",n[7]),ie(e,"mouseleave",n[8])],l=!0)},p(d,[p]){d[3]?f?p&8&&V(f,1):(f=ua(),f.c(),V(f,1),f.m(e,t)):f&&(it(),W(f,1,1,()=>{f=null}),ot()),p&9&&(c=Array.from({length:d[3]?d[0]-1:d[0]},ca),it(),r=vl(r,p,g,1,d,c,i,e,bl,fa,null,sa),ot()),Ze(e,m=pt(_,[p&16&&d[4]])),L(e,"bx--skeleton",!0),L(e,"bx--accordion",!0),L(e,"bx--accordion--start",d[1]==="start"),L(e,"bx--accordion--end",d[1]==="end"),L(e,"bx--accordion--sm",d[2]==="sm"),L(e,"bx--accordion--xl",d[2]==="xl")},i(d){if(!o){V(f);for(let p=0;p<c.length;p+=1)V(r[p]);o=!0}},o(d){W(f);for(let p=0;p<r.length;p+=1)W(r[p]);o=!1},d(d){d&&F(e),f&&f.d();for(let p=0;p<r.length;p+=1)r[p].d();l=!1,gt(s)}}}const ca=(n,e)=>e;function au(n,e,t){const r=["count","align","size","open"];let i=Be(e,r),{count:o=4}=e,{align:l="end"}=e,{size:s=void 0}=e,{open:f=!0}=e;function c(d){fe.call(this,n,d)}function g(d){fe.call(this,n,d)}function _(d){fe.call(this,n,d)}function m(d){fe.call(this,n,d)}return n.$$set=d=>{e=ye(ye({},e),at(d)),t(4,i=Be(e,r)),"count"in d&&t(0,o=d.count),"align"in d&&t(1,l=d.align),"size"in d&&t(2,s=d.size),"open"in d&&t(3,f=d.open)},[o,l,s,f,i,c,g,_,m]}class lu extends xe{constructor(e){super(),Oe(this,e,au,ou,Ie,{count:0,align:1,size:2,open:3})}}const su=lu;function uu(n){let e,t,r,i;const o=n[6].default,l=mt(o,n,n[5],null);let s=[n[3]],f={};for(let c=0;c<s.length;c+=1)f=ye(f,s[c]);return{c(){e=U("ul"),l&&l.c(),Ze(e,f),L(e,"bx--accordion",!0),L(e,"bx--accordion--start",n[0]==="start"),L(e,"bx--accordion--end",n[0]==="end"),L(e,"bx--accordion--sm",n[1]==="sm"),L(e,"bx--accordion--xl",n[1]==="xl")},m(c,g){R(c,e,g),l&&l.m(e,null),t=!0,r||(i=[ie(e,"click",n[7]),ie(e,"mouseover",n[8]),ie(e,"mouseenter",n[9]),ie(e,"mouseleave",n[10])],r=!0)},p(c,g){l&&l.p&&(!t||g&32)&&vt(l,o,c,c[5],t?_t(o,c[5],g,null):bt(c[5]),null),Ze(e,f=pt(s,[g&8&&c[3]])),L(e,"bx--accordion",!0),L(e,"bx--accordion--start",c[0]==="start"),L(e,"bx--accordion--end",c[0]==="end"),L(e,"bx--accordion--sm",c[1]==="sm"),L(e,"bx--accordion--xl",c[1]==="xl")},i(c){t||(V(l,c),t=!0)},o(c){W(l,c),t=!1},d(c){c&&F(e),l&&l.d(c),r=!1,gt(i)}}}function fu(n){let e,t;const r=[n[3],{align:n[0]},{size:n[1]}];let i={};for(let o=0;o<r.length;o+=1)i=ye(i,r[o]);return e=new su({props:i}),e.$on("click",n[11]),e.$on("mouseover",n[12]),e.$on("mouseenter",n[13]),e.$on("mouseleave",n[14]),{c(){he(e.$$.fragment)},m(o,l){pe(e,o,l),t=!0},p(o,l){const s=l&11?pt(r,[l&8&&Gs(o[3]),l&1&&{align:o[0]},l&2&&{size:o[1]}]):{};e.$set(s)},i(o){t||(V(e.$$.fragment,o),t=!0)},o(o){W(e.$$.fragment,o),t=!1},d(o){ge(e,o)}}}function cu(n){let e,t,r,i;const o=[fu,uu],l=[];function s(f,c){return f[2]?0:1}return e=s(n),t=l[e]=o[e](n),{c(){t.c(),r=Kt()},m(f,c){l[e].m(f,c),R(f,r,c),i=!0},p(f,[c]){let g=e;e=s(f),e===g?l[e].p(f,c):(it(),W(l[g],1,1,()=>{l[g]=null}),ot(),t=l[e],t?t.p(f,c):(t=l[e]=o[e](f),t.c()),V(t,1),t.m(r.parentNode,r))},i(f){i||(V(t),i=!0)},o(f){W(t),i=!1},d(f){l[e].d(f),f&&F(r)}}}function du(n,e,t){const r=["align","size","disabled","skeleton"];let i=Be(e,r),{$$slots:o={},$$scope:l}=e,{align:s="end"}=e,{size:f=void 0}=e,{disabled:c=!1}=e,{skeleton:g=!1}=e;const _=Tn(c);eo("Accordion",{disableItems:_});function m(E){fe.call(this,n,E)}function d(E){fe.call(this,n,E)}function p(E){fe.call(this,n,E)}function w(E){fe.call(this,n,E)}function O(E){fe.call(this,n,E)}function z(E){fe.call(this,n,E)}function v(E){fe.call(this,n,E)}function b(E){fe.call(this,n,E)}return n.$$set=E=>{e=ye(ye({},e),at(E)),t(3,i=Be(e,r)),"align"in E&&t(0,s=E.align),"size"in E&&t(1,f=E.size),"disabled"in E&&t(4,c=E.disabled),"skeleton"in E&&t(2,g=E.skeleton),"$$scope"in E&&t(5,l=E.$$scope)},n.$$.update=()=>{n.$$.dirty&16&&_.set(c)},[s,f,g,i,c,l,o,m,d,p,w,O,z,v,b]}class hu extends xe{constructor(e){super(),Oe(this,e,du,cu,Ie,{align:0,size:1,disabled:4,skeleton:2})}}const pu=hu,gu=n=>({}),da=n=>({});function mu(n){let e;return{c(){e=me(n[2])},m(t,r){R(t,e,r)},p(t,r){r&4&&Ue(e,t[2])},d(t){t&&F(e)}}}function vu(n){let e,t,r,i,o,l,s,f,c,g;r=new io({props:{class:"bx--accordion__arrow","aria-label":n[3]}});const _=n[7].title,m=mt(_,n,n[6],da),d=m||mu(n),p=n[7].default,w=mt(p,n,n[6],null);let O=[n[5]],z={};for(let v=0;v<O.length;v+=1)z=ye(z,O[v]);return{c(){e=U("li"),t=U("button"),he(r.$$.fragment),i=J(),o=U("div"),d&&d.c(),l=J(),s=U("div"),w&&w.c(),L(o,"bx--accordion__title",!0),X(t,"type","button"),X(t,"title",n[3]),X(t,"aria-expanded",n[0]),t.disabled=n[1],L(t,"bx--accordion__heading",!0),L(s,"bx--accordion__content",!0),Ze(e,z),L(e,"bx--accordion__item",!0),L(e,"bx--accordion__item--active",n[0]),L(e,"bx--accordion__item--disabled",n[1]),L(e,"bx--accordion__item--expanding",n[4]==="expanding"),L(e,"bx--accordion__item--collapsing",n[4]==="collapsing")},m(v,b){R(v,e,b),P(e,t),pe(r,t,null),P(t,i),P(t,o),d&&d.m(o,null),P(e,l),P(e,s),w&&w.m(s,null),f=!0,c||(g=[ie(t,"click",n[9]),ie(t,"click",n[14]),ie(t,"mouseover",n[10]),ie(t,"mouseenter",n[11]),ie(t,"mouseleave",n[12]),ie(t,"keydown",n[13]),ie(t,"keydown",n[15]),ie(e,"animationend",n[8]),ie(e,"animationend",n[16])],c=!0)},p(v,[b]){const E={};b&8&&(E["aria-label"]=v[3]),r.$set(E),m?m.p&&(!f||b&64)&&vt(m,_,v,v[6],f?_t(_,v[6],b,gu):bt(v[6]),da):d&&d.p&&(!f||b&4)&&d.p(v,f?b:-1),(!f||b&8)&&X(t,"title",v[3]),(!f||b&1)&&X(t,"aria-expanded",v[0]),(!f||b&2)&&(t.disabled=v[1]),w&&w.p&&(!f||b&64)&&vt(w,p,v,v[6],f?_t(p,v[6],b,null):bt(v[6]),null),Ze(e,z=pt(O,[b&32&&v[5]])),L(e,"bx--accordion__item",!0),L(e,"bx--accordion__item--active",v[0]),L(e,"bx--accordion__item--disabled",v[1]),L(e,"bx--accordion__item--expanding",v[4]==="expanding"),L(e,"bx--accordion__item--collapsing",v[4]==="collapsing")},i(v){f||(V(r.$$.fragment,v),V(d,v),V(w,v),f=!0)},o(v){W(r.$$.fragment,v),W(d,v),W(w,v),f=!1},d(v){v&&F(e),ge(r),d&&d.d(v),w&&w.d(v),c=!1,gt(g)}}}function bu(n,e,t){const r=["title","open","disabled","iconDescription"];let i=Be(e,r),{$$slots:o={},$$scope:l}=e,{title:s="title"}=e,{open:f=!1}=e,{disabled:c=!1}=e,{iconDescription:g="Expand/Collapse"}=e,_=c;const d=ii("Accordion").disableItems.subscribe(A=>{!A&&_||t(1,c=A)});let p;Yn(()=>()=>{d()});function w(A){fe.call(this,n,A)}function O(A){fe.call(this,n,A)}function z(A){fe.call(this,n,A)}function v(A){fe.call(this,n,A)}function b(A){fe.call(this,n,A)}function E(A){fe.call(this,n,A)}const M=()=>{t(0,f=!f),t(4,p=f?"expanding":"collapsing")},x=({key:A})=>{f&&A==="Escape"&&t(0,f=!1)},j=()=>{t(4,p=void 0)};return n.$$set=A=>{e=ye(ye({},e),at(A)),t(5,i=Be(e,r)),"title"in A&&t(2,s=A.title),"open"in A&&t(0,f=A.open),"disabled"in A&&t(1,c=A.disabled),"iconDescription"in A&&t(3,g=A.iconDescription),"$$scope"in A&&t(6,l=A.$$scope)},[f,c,s,g,p,i,l,o,w,O,z,v,b,E,M,x,j]}class _u extends xe{constructor(e){super(),Oe(this,e,bu,vu,Ie,{title:2,open:0,disabled:1,iconDescription:3})}}const yu=_u;function ha(n){let e,t;return{c(){e=ct("title"),t=me(n[1])},m(r,i){R(r,e,i),P(e,t)},p(r,i){i&2&&Ue(t,r[1])},d(r){r&&F(e)}}}function wu(n){let e,t,r,i=n[1]&&ha(n),o=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],l={};for(let s=0;s<o.length;s+=1)l=ye(l,o[s]);return{c(){e=ct("svg"),i&&i.c(),t=ct("path"),r=ct("path"),X(t,"d","M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14C30,8.3,23.7,2,16,2z M14.9,8h2.2v11h-2.2V8z M16,25	c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22c0.8,0,1.5,0.7,1.5,1.5S16.8,25,16,25z"),X(r,"fill","none"),X(r,"d","M17.5,23.5c0,0.8-0.7,1.5-1.5,1.5c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22	C16.8,22,17.5,22.7,17.5,23.5z M17.1,8h-2.2v11h2.2V8z"),X(r,"data-icon-path","inner-path"),X(r,"opacity","0"),cn(e,l)},m(s,f){R(s,e,f),i&&i.m(e,null),P(e,t),P(e,r)},p(s,[f]){s[1]?i?i.p(s,f):(i=ha(s),i.c(),i.m(e,t)):i&&(i.d(1),i=null),cn(e,l=pt(o,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},f&1&&{width:s[0]},f&1&&{height:s[0]},f&4&&s[2],f&8&&s[3]]))},i:Ce,o:Ce,d(s){s&&F(e),i&&i.d()}}}function Eu(n,e,t){let r,i;const o=["size","title"];let l=Be(e,o),{size:s=16}=e,{title:f=void 0}=e;return n.$$set=c=>{t(5,e=ye(ye({},e),at(c))),t(3,l=Be(e,o)),"size"in c&&t(0,s=c.size),"title"in c&&t(1,f=c.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||f),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=at(e),[s,f,i,l,r]}class Su extends xe{constructor(e){super(),Oe(this,e,Eu,wu,Ie,{size:0,title:1})}}const yl=Su;function pa(n){let e,t;return{c(){e=ct("title"),t=me(n[1])},m(r,i){R(r,e,i),P(e,t)},p(r,i){i&2&&Ue(t,r[1])},d(r){r&&F(e)}}}function ku(n){let e,t,r,i,o=n[1]&&pa(n),l=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],s={};for(let f=0;f<l.length;f+=1)s=ye(s,l[f]);return{c(){e=ct("svg"),o&&o.c(),t=ct("path"),r=ct("path"),i=ct("path"),X(t,"fill","none"),X(t,"d","M16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Zm-1.125-5h2.25V12h-2.25Z"),X(t,"data-icon-path","inner-path"),X(r,"d","M16.002,6.1714h-.004L4.6487,27.9966,4.6506,28H27.3494l.0019-.0034ZM14.875,12h2.25v9h-2.25ZM16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Z"),X(i,"d","M29,30H3a1,1,0,0,1-.8872-1.4614l13-25a1,1,0,0,1,1.7744,0l13,25A1,1,0,0,1,29,30ZM4.6507,28H27.3493l.002-.0033L16.002,6.1714h-.004L4.6487,27.9967Z"),cn(e,s)},m(f,c){R(f,e,c),o&&o.m(e,null),P(e,t),P(e,r),P(e,i)},p(f,[c]){f[1]?o?o.p(f,c):(o=pa(f),o.c(),o.m(e,t)):o&&(o.d(1),o=null),cn(e,s=pt(l,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},c&1&&{width:f[0]},c&1&&{height:f[0]},c&4&&f[2],c&8&&f[3]]))},i:Ce,o:Ce,d(f){f&&F(e),o&&o.d()}}}function Mu(n,e,t){let r,i;const o=["size","title"];let l=Be(e,o),{size:s=16}=e,{title:f=void 0}=e;return n.$$set=c=>{t(5,e=ye(ye({},e),at(c))),t(3,l=Be(e,o)),"size"in c&&t(0,s=c.size),"title"in c&&t(1,f=c.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||f),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=at(e),[s,f,i,l,r]}class Tu extends xe{constructor(e){super(),Oe(this,e,Mu,ku,Ie,{size:0,title:1})}}const Cu=Tu,xu=n=>({}),ga=n=>({});function ma(n){let e,t;const r=n[16].labelText,i=mt(r,n,n[15],ga),o=i||Ou(n);return{c(){e=U("span"),o&&o.c(),L(e,"bx--visually-hidden",n[7])},m(l,s){R(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s&32768)&&vt(i,r,l,l[15],t?_t(r,l[15],s,xu):bt(l[15]),ga):o&&o.p&&(!t||s&64)&&o.p(l,t?s:-1),(!t||s&128)&&L(e,"bx--visually-hidden",l[7])},i(l){t||(V(o,l),t=!0)},o(l){W(o,l),t=!1},d(l){l&&F(e),o&&o.d(l)}}}function Ou(n){let e;return{c(){e=me(n[6])},m(t,r){R(t,e,r)},p(t,r){r&64&&Ue(e,t[6])},d(t){t&&F(e)}}}function Iu(n){let e,t,r,i,o,l,s,f,c,g=(n[6]||n[13].labelText)&&ma(n),_=[n[12]],m={};for(let d=0;d<_.length;d+=1)m=ye(m,_[d]);return{c(){e=U("div"),t=U("input"),r=J(),i=U("label"),o=U("span"),l=J(),g&&g.c(),X(t,"type","radio"),X(t,"id",n[8]),X(t,"name",n[9]),t.checked=n[0],t.disabled=n[3],t.required=n[4],t.value=n[2],L(t,"bx--radio-button",!0),L(o,"bx--radio-button__appearance",!0),X(i,"for",n[8]),L(i,"bx--radio-button__label",!0),Ze(e,m),L(e,"bx--radio-button-wrapper",!0),L(e,"bx--radio-button-wrapper--label-left",n[5]==="left")},m(d,p){R(d,e,p),P(e,t),n[18](t),P(e,r),P(e,i),P(i,o),P(i,l),g&&g.m(i,null),s=!0,f||(c=[ie(t,"change",n[17]),ie(t,"change",n[19])],f=!0)},p(d,[p]){(!s||p&256)&&X(t,"id",d[8]),(!s||p&512)&&X(t,"name",d[9]),(!s||p&1)&&(t.checked=d[0]),(!s||p&8)&&(t.disabled=d[3]),(!s||p&16)&&(t.required=d[4]),(!s||p&4)&&(t.value=d[2]),d[6]||d[13].labelText?g?(g.p(d,p),p&8256&&V(g,1)):(g=ma(d),g.c(),V(g,1),g.m(i,null)):g&&(it(),W(g,1,1,()=>{g=null}),ot()),(!s||p&256)&&X(i,"for",d[8]),Ze(e,m=pt(_,[p&4096&&d[12]])),L(e,"bx--radio-button-wrapper",!0),L(e,"bx--radio-button-wrapper--label-left",d[5]==="left")},i(d){s||(V(g),s=!0)},o(d){W(g),s=!1},d(d){d&&F(e),n[18](null),g&&g.d(),f=!1,gt(c)}}}function Lu(n,e,t){const r=["value","checked","disabled","required","labelPosition","labelText","hideLabel","id","name","ref"];let i=Be(e,r),o,{$$slots:l={},$$scope:s}=e;const f=oi(l);let{value:c=""}=e,{checked:g=!1}=e,{disabled:_=!1}=e,{required:m=!1}=e,{labelPosition:d="right"}=e,{labelText:p=""}=e,{hideLabel:w=!1}=e,{id:O="ccs-"+Math.random().toString(36)}=e,{name:z=""}=e,{ref:v=null}=e;const b=ii("RadioButtonGroup"),E=b?b.selectedValue:Tn(g?c:void 0);Je(n,E,A=>t(14,o=A)),b&&b.add({id:O,checked:g,disabled:_,value:c});function M(A){fe.call(this,n,A)}function x(A){je[A?"unshift":"push"](()=>{v=A,t(1,v)})}const j=()=>{b&&b.update(c)};return n.$$set=A=>{e=ye(ye({},e),at(A)),t(12,i=Be(e,r)),"value"in A&&t(2,c=A.value),"checked"in A&&t(0,g=A.checked),"disabled"in A&&t(3,_=A.disabled),"required"in A&&t(4,m=A.required),"labelPosition"in A&&t(5,d=A.labelPosition),"labelText"in A&&t(6,p=A.labelText),"hideLabel"in A&&t(7,w=A.hideLabel),"id"in A&&t(8,O=A.id),"name"in A&&t(9,z=A.name),"ref"in A&&t(1,v=A.ref),"$$scope"in A&&t(15,s=A.$$scope)},n.$$.update=()=>{n.$$.dirty&16388&&t(0,g=o===c)},[g,v,c,_,m,d,p,w,O,z,b,E,i,f,o,s,l,M,x,j]}class Pu extends xe{constructor(e){super(),Oe(this,e,Lu,Iu,Ie,{value:2,checked:0,disabled:3,required:4,labelPosition:5,labelText:6,hideLabel:7,id:8,name:9,ref:1})}}const zr=Pu;function va(n){let e,t;return{c(){e=ct("title"),t=me(n[1])},m(r,i){R(r,e,i),P(e,t)},p(r,i){i&2&&Ue(t,r[1])},d(r){r&&F(e)}}}function Au(n){let e,t,r=n[1]&&va(n),i=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],o={};for(let l=0;l<i.length;l+=1)o=ye(o,i[l]);return{c(){e=ct("svg"),r&&r.c(),t=ct("path"),X(t,"d","M30 28.6L3.4 2 2 3.4l10.1 10.1L4 21.6V28h6.4l8.1-8.1L28.6 30 30 28.6zM9.6 26H6v-3.6l7.5-7.5 3.6 3.6L9.6 26zM29.4 6.2L29.4 6.2l-3.6-3.6c-.8-.8-2-.8-2.8 0l0 0 0 0-8 8 1.4 1.4L20 8.4l3.6 3.6L20 15.6l1.4 1.4 8-8C30.2 8.2 30.2 7 29.4 6.2L29.4 6.2zM25 10.6L21.4 7l3-3L28 7.6 25 10.6z"),cn(e,o)},m(l,s){R(l,e,s),r&&r.m(e,null),P(e,t)},p(l,[s]){l[1]?r?r.p(l,s):(r=va(l),r.c(),r.m(e,t)):r&&(r.d(1),r=null),cn(e,o=pt(i,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},s&1&&{width:l[0]},s&1&&{height:l[0]},s&4&&l[2],s&8&&l[3]]))},i:Ce,o:Ce,d(l){l&&F(e),r&&r.d()}}}function Nu(n,e,t){let r,i;const o=["size","title"];let l=Be(e,o),{size:s=16}=e,{title:f=void 0}=e;return n.$$set=c=>{t(5,e=ye(ye({},e),at(c))),t(3,l=Be(e,o)),"size"in c&&t(0,s=c.size),"title"in c&&t(1,f=c.title)},n.$$.update=()=>{t(4,r=e["aria-label"]||e["aria-labelledby"]||f),t(2,i={"aria-hidden":r?void 0:!0,role:r?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=at(e),[s,f,i,l,r]}class Ru extends xe{constructor(e){super(),Oe(this,e,Nu,Au,Ie,{size:0,title:1})}}const Fu=Ru;function Du(n){let e,t,r,i;const o=n[5].default,l=mt(o,n,n[4],null);let s=[n[3]],f={};for(let c=0;c<s.length;c+=1)f=ye(f,s[c]);return{c(){e=U("ol"),l&&l.c(),Ze(e,f),L(e,"bx--list--ordered",!n[1]),L(e,"bx--list--ordered--native",n[1]),L(e,"bx--list--nested",n[0]),L(e,"bx--list--expressive",n[2])},m(c,g){R(c,e,g),l&&l.m(e,null),t=!0,r||(i=[ie(e,"click",n[6]),ie(e,"mouseover",n[7]),ie(e,"mouseenter",n[8]),ie(e,"mouseleave",n[9])],r=!0)},p(c,[g]){l&&l.p&&(!t||g&16)&&vt(l,o,c,c[4],t?_t(o,c[4],g,null):bt(c[4]),null),Ze(e,f=pt(s,[g&8&&c[3]])),L(e,"bx--list--ordered",!c[1]),L(e,"bx--list--ordered--native",c[1]),L(e,"bx--list--nested",c[0]),L(e,"bx--list--expressive",c[2])},i(c){t||(V(l,c),t=!0)},o(c){W(l,c),t=!1},d(c){c&&F(e),l&&l.d(c),r=!1,gt(i)}}}function Bu(n,e,t){const r=["nested","native","expressive"];let i=Be(e,r),{$$slots:o={},$$scope:l}=e,{nested:s=!1}=e,{native:f=!1}=e,{expressive:c=!1}=e;function g(p){fe.call(this,n,p)}function _(p){fe.call(this,n,p)}function m(p){fe.call(this,n,p)}function d(p){fe.call(this,n,p)}return n.$$set=p=>{e=ye(ye({},e),at(p)),t(3,i=Be(e,r)),"nested"in p&&t(0,s=p.nested),"native"in p&&t(1,f=p.native),"expressive"in p&&t(2,c=p.expressive),"$$scope"in p&&t(4,l=p.$$scope)},[s,f,c,i,l,o,g,_,m,d]}class Uu extends xe{constructor(e){super(),Oe(this,e,Bu,Du,Ie,{nested:0,native:1,expressive:2})}}const Gu=Uu,zu=n=>({}),ba=n=>({});function _a(n){let e,t;const r=n[11].legendText,i=mt(r,n,n[10],ba),o=i||ju(n);return{c(){e=U("legend"),o&&o.c(),L(e,"bx--label",!0),L(e,"bx--visually-hidden",n[2])},m(l,s){R(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s&1024)&&vt(i,r,l,l[10],t?_t(r,l[10],s,zu):bt(l[10]),ba):o&&o.p&&(!t||s&2)&&o.p(l,t?s:-1),(!t||s&4)&&L(e,"bx--visually-hidden",l[2])},i(l){t||(V(o,l),t=!0)},o(l){W(o,l),t=!1},d(l){l&&F(e),o&&o.d(l)}}}function ju(n){let e;return{c(){e=me(n[1])},m(t,r){R(t,e,r)},p(t,r){r&2&&Ue(e,t[1])},d(t){t&&F(e)}}}function Vu(n){let e,t,r,i,o,l,s=(n[1]||n[8].legendText)&&_a(n);const f=n[11].default,c=mt(f,n,n[10],null);let g=[{id:n[5]},n[7]],_={};for(let m=0;m<g.length;m+=1)_=ye(_,g[m]);return{c(){e=U("div"),t=U("fieldset"),s&&s.c(),r=J(),c&&c.c(),t.disabled=n[0],L(t,"bx--radio-button-group",!0),L(t,"bx--radio-button-group--vertical",n[4]==="vertical"),L(t,"bx--radio-button-group--label-left",n[3]==="left"),L(t,"bx--radio-button-group--label-right",n[3]==="right"),Ze(e,_),L(e,"bx--form-item",!0)},m(m,d){R(m,e,d),P(e,t),s&&s.m(t,null),P(t,r),c&&c.m(t,null),i=!0,o||(l=[ie(e,"click",n[12]),ie(e,"mouseover",n[13]),ie(e,"mouseenter",n[14]),ie(e,"mouseleave",n[15])],o=!0)},p(m,[d]){m[1]||m[8].legendText?s?(s.p(m,d),d&258&&V(s,1)):(s=_a(m),s.c(),V(s,1),s.m(t,r)):s&&(it(),W(s,1,1,()=>{s=null}),ot()),c&&c.p&&(!i||d&1024)&&vt(c,f,m,m[10],i?_t(f,m[10],d,null):bt(m[10]),null),(!i||d&1)&&(t.disabled=m[0]),(!i||d&16)&&L(t,"bx--radio-button-group--vertical",m[4]==="vertical"),(!i||d&8)&&L(t,"bx--radio-button-group--label-left",m[3]==="left"),(!i||d&8)&&L(t,"bx--radio-button-group--label-right",m[3]==="right"),Ze(e,_=pt(g,[(!i||d&32)&&{id:m[5]},d&128&&m[7]])),L(e,"bx--form-item",!0)},i(m){i||(V(s),V(c,m),i=!0)},o(m){W(s),W(c,m),i=!1},d(m){m&&F(e),s&&s.d(),c&&c.d(m),o=!1,gt(l)}}}function qu(n,e,t){const r=["selected","disabled","legendText","hideLegend","labelPosition","orientation","id"];let i=Be(e,r),o,{$$slots:l={},$$scope:s}=e;const f=oi(l);let{selected:c=void 0}=e,{disabled:g=!1}=e,{legendText:_=""}=e,{hideLegend:m=!1}=e,{labelPosition:d="right"}=e,{orientation:p="horizontal"}=e,{id:w=void 0}=e;const O=_l(),z=Tn(c);Je(n,z,x=>t(16,o=x)),eo("RadioButtonGroup",{selectedValue:z,add:({checked:x,value:j})=>{x&&z.set(j)},update:x=>{t(9,c=x)}}),Yn(()=>{ta(z,o=c,o)}),zs(()=>{ta(z,o=c,o)}),z.subscribe(x=>{t(9,c=x),O("change",x)});function v(x){fe.call(this,n,x)}function b(x){fe.call(this,n,x)}function E(x){fe.call(this,n,x)}function M(x){fe.call(this,n,x)}return n.$$set=x=>{e=ye(ye({},e),at(x)),t(7,i=Be(e,r)),"selected"in x&&t(9,c=x.selected),"disabled"in x&&t(0,g=x.disabled),"legendText"in x&&t(1,_=x.legendText),"hideLegend"in x&&t(2,m=x.hideLegend),"labelPosition"in x&&t(3,d=x.labelPosition),"orientation"in x&&t(4,p=x.orientation),"id"in x&&t(5,w=x.id),"$$scope"in x&&t(10,s=x.$$scope)},[g,_,m,d,p,w,z,i,f,c,s,l,v,b,E,M]}class Yu extends xe{constructor(e){super(),Oe(this,e,qu,Vu,Ie,{selected:9,disabled:0,legendText:1,hideLegend:2,labelPosition:3,orientation:4,id:5})}}const Ju=Yu,Xu=n=>({}),ya=n=>({});function wa(n){let e,t,r,i;const o=n[20].labelText,l=mt(o,n,n[19],ya),s=l||Wu(n);let f=n[5]&&Ea(n);return{c(){e=U("div"),t=U("label"),s&&s.c(),r=J(),f&&f.c(),X(t,"for",n[14]),L(t,"bx--label",!0),L(t,"bx--visually-hidden",n[11]),L(t,"bx--label--disabled",n[7]),L(e,"bx--text-area__label-wrapper",!0)},m(c,g){R(c,e,g),P(e,t),s&&s.m(t,null),P(e,r),f&&f.m(e,null),i=!0},p(c,g){l?l.p&&(!i||g[0]&524288)&&vt(l,o,c,c[19],i?_t(o,c[19],g,Xu):bt(c[19]),ya):s&&s.p&&(!i||g[0]&1024)&&s.p(c,i?g:[-1,-1]),(!i||g[0]&16384)&&X(t,"for",c[14]),(!i||g[0]&2048)&&L(t,"bx--visually-hidden",c[11]),(!i||g[0]&128)&&L(t,"bx--label--disabled",c[7]),c[5]?f?f.p(c,g):(f=Ea(c),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i(c){i||(V(s,c),i=!0)},o(c){W(s,c),i=!1},d(c){c&&F(e),s&&s.d(c),f&&f.d()}}}function Wu(n){let e;return{c(){e=me(n[10])},m(t,r){R(t,e,r)},p(t,r){r[0]&1024&&Ue(e,t[10])},d(t){t&&F(e)}}}function Ea(n){let e,t=n[0].length+"",r,i,o;return{c(){e=U("div"),r=me(t),i=me("/"),o=me(n[5]),L(e,"bx--label",!0),L(e,"bx--label--disabled",n[7])},m(l,s){R(l,e,s),P(e,r),P(e,i),P(e,o)},p(l,s){s[0]&1&&t!==(t=l[0].length+"")&&Ue(r,t),s[0]&32&&Ue(o,l[5]),s[0]&128&&L(e,"bx--label--disabled",l[7])},d(l){l&&F(e)}}}function Sa(n){let e,t;return e=new yl({props:{class:"bx--text-area__invalid-icon"}}),{c(){he(e.$$.fragment)},m(r,i){pe(e,r,i),t=!0},i(r){t||(V(e.$$.fragment,r),t=!0)},o(r){W(e.$$.fragment,r),t=!1},d(r){ge(e,r)}}}function ka(n){let e,t;return{c(){e=U("div"),t=me(n[9]),L(e,"bx--form__helper-text",!0),L(e,"bx--form__helper-text--disabled",n[7])},m(r,i){R(r,e,i),P(e,t)},p(r,i){i[0]&512&&Ue(t,r[9]),i[0]&128&&L(e,"bx--form__helper-text--disabled",r[7])},d(r){r&&F(e)}}}function Ma(n){let e,t;return{c(){e=U("div"),t=me(n[13]),X(e,"id",n[16]),L(e,"bx--form-requirement",!0)},m(r,i){R(r,e,i),P(e,t)},p(r,i){i[0]&8192&&Ue(t,r[13]),i[0]&65536&&X(e,"id",r[16])},d(r){r&&F(e)}}}function Hu(n){let e,t,r,i,o,l,s,f,c,g,_,m,d,p,w=(n[10]||n[17].labelText)&&!n[11]&&wa(n),O=n[12]&&Sa(),z=[{"aria-invalid":l=n[12]||void 0},{"aria-describedby":s=n[12]?n[16]:void 0},{disabled:n[7]},{id:n[14]},{name:n[15]},{cols:n[3]},{rows:n[4]},{placeholder:n[2]},{readOnly:n[8]},{maxlength:f=n[5]??void 0},n[18]],v={};for(let M=0;M<z.length;M+=1)v=ye(v,z[M]);let b=!n[12]&&n[9]&&ka(n),E=n[12]&&Ma(n);return{c(){e=U("div"),w&&w.c(),t=J(),r=U("div"),O&&O.c(),i=J(),o=U("textarea"),g=J(),b&&b.c(),_=J(),E&&E.c(),Ze(o,v),L(o,"bx--text-area",!0),L(o,"bx--text-area--light",n[6]),L(o,"bx--text-area--invalid",n[12]),X(r,"data-invalid",c=n[12]||void 0),L(r,"bx--text-area__wrapper",!0),L(e,"bx--form-item",!0)},m(M,x){R(M,e,x),w&&w.m(e,null),P(e,t),P(e,r),O&&O.m(r,null),P(r,i),P(r,o),o.autofocus&&o.focus(),n[32](o),jn(o,n[0]),P(e,g),b&&b.m(e,null),P(e,_),E&&E.m(e,null),m=!0,d||(p=[ie(o,"input",n[33]),ie(o,"change",n[25]),ie(o,"input",n[26]),ie(o,"keydown",n[27]),ie(o,"keyup",n[28]),ie(o,"focus",n[29]),ie(o,"blur",n[30]),ie(o,"paste",n[31]),ie(e,"click",n[21]),ie(e,"mouseover",n[22]),ie(e,"mouseenter",n[23]),ie(e,"mouseleave",n[24])],d=!0)},p(M,x){(M[10]||M[17].labelText)&&!M[11]?w?(w.p(M,x),x[0]&134144&&V(w,1)):(w=wa(M),w.c(),V(w,1),w.m(e,t)):w&&(it(),W(w,1,1,()=>{w=null}),ot()),M[12]?O?x[0]&4096&&V(O,1):(O=Sa(),O.c(),V(O,1),O.m(r,i)):O&&(it(),W(O,1,1,()=>{O=null}),ot()),Ze(o,v=pt(z,[(!m||x[0]&4096&&l!==(l=M[12]||void 0))&&{"aria-invalid":l},(!m||x[0]&69632&&s!==(s=M[12]?M[16]:void 0))&&{"aria-describedby":s},(!m||x[0]&128)&&{disabled:M[7]},(!m||x[0]&16384)&&{id:M[14]},(!m||x[0]&32768)&&{name:M[15]},(!m||x[0]&8)&&{cols:M[3]},(!m||x[0]&16)&&{rows:M[4]},(!m||x[0]&4)&&{placeholder:M[2]},(!m||x[0]&256)&&{readOnly:M[8]},(!m||x[0]&32&&f!==(f=M[5]??void 0))&&{maxlength:f},x[0]&262144&&M[18]])),x[0]&1&&jn(o,M[0]),L(o,"bx--text-area",!0),L(o,"bx--text-area--light",M[6]),L(o,"bx--text-area--invalid",M[12]),(!m||x[0]&4096&&c!==(c=M[12]||void 0))&&X(r,"data-invalid",c),!M[12]&&M[9]?b?b.p(M,x):(b=ka(M),b.c(),b.m(e,_)):b&&(b.d(1),b=null),M[12]?E?E.p(M,x):(E=Ma(M),E.c(),E.m(e,null)):E&&(E.d(1),E=null)},i(M){m||(V(w),V(O),m=!0)},o(M){W(w),W(O),m=!1},d(M){M&&F(e),w&&w.d(),O&&O.d(),n[32](null),b&&b.d(),E&&E.d(),d=!1,gt(p)}}}function Zu(n,e,t){let r;const i=["value","placeholder","cols","rows","maxCount","light","disabled","readonly","helperText","labelText","hideLabel","invalid","invalidText","id","name","ref"];let o=Be(e,i),{$$slots:l={},$$scope:s}=e;const f=oi(l);let{value:c=""}=e,{placeholder:g=""}=e,{cols:_=50}=e,{rows:m=4}=e,{maxCount:d=void 0}=e,{light:p=!1}=e,{disabled:w=!1}=e,{readonly:O=!1}=e,{helperText:z=""}=e,{labelText:v=""}=e,{hideLabel:b=!1}=e,{invalid:E=!1}=e,{invalidText:M=""}=e,{id:x="ccs-"+Math.random().toString(36)}=e,{name:j=void 0}=e,{ref:A=null}=e;function Y(I){fe.call(this,n,I)}function te(I){fe.call(this,n,I)}function N(I){fe.call(this,n,I)}function Z(I){fe.call(this,n,I)}function B(I){fe.call(this,n,I)}function $(I){fe.call(this,n,I)}function Q(I){fe.call(this,n,I)}function se(I){fe.call(this,n,I)}function ke(I){fe.call(this,n,I)}function we(I){fe.call(this,n,I)}function Se(I){fe.call(this,n,I)}function Le(I){je[I?"unshift":"push"](()=>{A=I,t(1,A)})}function ve(){c=this.value,t(0,c)}return n.$$set=I=>{e=ye(ye({},e),at(I)),t(18,o=Be(e,i)),"value"in I&&t(0,c=I.value),"placeholder"in I&&t(2,g=I.placeholder),"cols"in I&&t(3,_=I.cols),"rows"in I&&t(4,m=I.rows),"maxCount"in I&&t(5,d=I.maxCount),"light"in I&&t(6,p=I.light),"disabled"in I&&t(7,w=I.disabled),"readonly"in I&&t(8,O=I.readonly),"helperText"in I&&t(9,z=I.helperText),"labelText"in I&&t(10,v=I.labelText),"hideLabel"in I&&t(11,b=I.hideLabel),"invalid"in I&&t(12,E=I.invalid),"invalidText"in I&&t(13,M=I.invalidText),"id"in I&&t(14,x=I.id),"name"in I&&t(15,j=I.name),"ref"in I&&t(1,A=I.ref),"$$scope"in I&&t(19,s=I.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&16384&&t(16,r=`error-${x}`)},[c,A,g,_,m,d,p,w,O,z,v,b,E,M,x,j,r,f,o,s,l,Y,te,N,Z,B,$,Q,se,ke,we,Se,Le,ve]}class Ku extends xe{constructor(e){super(),Oe(this,e,Zu,Hu,Ie,{value:0,placeholder:2,cols:3,rows:4,maxCount:5,light:6,disabled:7,readonly:8,helperText:9,labelText:10,hideLabel:11,invalid:12,invalidText:13,id:14,name:15,ref:1},null,[-1,-1])}}const Qu=Ku,$u=n=>({}),Ta=n=>({}),ef=n=>({}),Ca=n=>({});function xa(n){let e,t,r,i=n[9]&&Oa(n),o=!n[20]&&n[6]&&Ia(n);return{c(){e=U("div"),i&&i.c(),t=J(),o&&o.c(),L(e,"bx--text-input__label-helper-wrapper",!0)},m(l,s){R(l,e,s),i&&i.m(e,null),P(e,t),o&&o.m(e,null),r=!0},p(l,s){l[9]?i?(i.p(l,s),s[0]&512&&V(i,1)):(i=Oa(l),i.c(),V(i,1),i.m(e,t)):i&&(it(),W(i,1,1,()=>{i=null}),ot()),!l[20]&&l[6]?o?o.p(l,s):(o=Ia(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(l){r||(V(i),r=!0)},o(l){W(i),r=!1},d(l){l&&F(e),i&&i.d(),o&&o.d()}}}function Oa(n){let e,t;const r=n[26].labelText,i=mt(r,n,n[25],Ca),o=i||tf(n);return{c(){e=U("label"),o&&o.c(),X(e,"for",n[7]),L(e,"bx--label",!0),L(e,"bx--visually-hidden",n[10]),L(e,"bx--label--disabled",n[5]),L(e,"bx--label--inline",n[16]),L(e,"bx--label--inline--sm",n[2]==="sm"),L(e,"bx--label--inline--xl",n[2]==="xl")},m(l,s){R(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s[0]&33554432)&&vt(i,r,l,l[25],t?_t(r,l[25],s,ef):bt(l[25]),Ca):o&&o.p&&(!t||s[0]&512)&&o.p(l,t?s:[-1,-1]),(!t||s[0]&128)&&X(e,"for",l[7]),(!t||s[0]&1024)&&L(e,"bx--visually-hidden",l[10]),(!t||s[0]&32)&&L(e,"bx--label--disabled",l[5]),(!t||s[0]&65536)&&L(e,"bx--label--inline",l[16]),(!t||s[0]&4)&&L(e,"bx--label--inline--sm",l[2]==="sm"),(!t||s[0]&4)&&L(e,"bx--label--inline--xl",l[2]==="xl")},i(l){t||(V(o,l),t=!0)},o(l){W(o,l),t=!1},d(l){l&&F(e),o&&o.d(l)}}}function tf(n){let e;return{c(){e=me(n[9])},m(t,r){R(t,e,r)},p(t,r){r[0]&512&&Ue(e,t[9])},d(t){t&&F(e)}}}function Ia(n){let e,t;return{c(){e=U("div"),t=me(n[6]),L(e,"bx--form__helper-text",!0),L(e,"bx--form__helper-text--disabled",n[5]),L(e,"bx--form__helper-text--inline",n[16])},m(r,i){R(r,e,i),P(e,t)},p(r,i){i[0]&64&&Ue(t,r[6]),i[0]&32&&L(e,"bx--form__helper-text--disabled",r[5]),i[0]&65536&&L(e,"bx--form__helper-text--inline",r[16])},d(r){r&&F(e)}}}function La(n){let e,t;const r=n[26].labelText,i=mt(r,n,n[25],Ta),o=i||nf(n);return{c(){e=U("label"),o&&o.c(),X(e,"for",n[7]),L(e,"bx--label",!0),L(e,"bx--visually-hidden",n[10]),L(e,"bx--label--disabled",n[5]),L(e,"bx--label--inline",n[16]),L(e,"bx--label--inline-sm",n[16]&&n[2]==="sm"),L(e,"bx--label--inline-xl",n[16]&&n[2]==="xl")},m(l,s){R(l,e,s),o&&o.m(e,null),t=!0},p(l,s){i?i.p&&(!t||s[0]&33554432)&&vt(i,r,l,l[25],t?_t(r,l[25],s,$u):bt(l[25]),Ta):o&&o.p&&(!t||s[0]&512)&&o.p(l,t?s:[-1,-1]),(!t||s[0]&128)&&X(e,"for",l[7]),(!t||s[0]&1024)&&L(e,"bx--visually-hidden",l[10]),(!t||s[0]&32)&&L(e,"bx--label--disabled",l[5]),(!t||s[0]&65536)&&L(e,"bx--label--inline",l[16]),(!t||s[0]&65540)&&L(e,"bx--label--inline-sm",l[16]&&l[2]==="sm"),(!t||s[0]&65540)&&L(e,"bx--label--inline-xl",l[16]&&l[2]==="xl")},i(l){t||(V(o,l),t=!0)},o(l){W(o,l),t=!1},d(l){l&&F(e),o&&o.d(l)}}}function nf(n){let e;return{c(){e=me(n[9])},m(t,r){R(t,e,r)},p(t,r){r[0]&512&&Ue(e,t[9])},d(t){t&&F(e)}}}function Pa(n){let e,t;return e=new yl({props:{class:"bx--text-input__invalid-icon"}}),{c(){he(e.$$.fragment)},m(r,i){pe(e,r,i),t=!0},i(r){t||(V(e.$$.fragment,r),t=!0)},o(r){W(e.$$.fragment,r),t=!1},d(r){ge(e,r)}}}function Aa(n){let e,t;return e=new Cu({props:{class:`bx--text-input__invalid-icon
            bx--text-input__invalid-icon--warning`}}),{c(){he(e.$$.fragment)},m(r,i){pe(e,r,i),t=!0},i(r){t||(V(e.$$.fragment,r),t=!0)},o(r){W(e.$$.fragment,r),t=!1},d(r){ge(e,r)}}}function Na(n){let e,t;return e=new Fu({props:{class:"bx--text-input__readonly-icon"}}),{c(){he(e.$$.fragment)},m(r,i){pe(e,r,i),t=!0},i(r){t||(V(e.$$.fragment,r),t=!0)},o(r){W(e.$$.fragment,r),t=!1},d(r){ge(e,r)}}}function Ra(n){let e;return{c(){e=U("hr"),L(e,"bx--text-input__divider",!0)},m(t,r){R(t,e,r)},d(t){t&&F(e)}}}function Fa(n){let e,t;return{c(){e=U("div"),t=me(n[12]),X(e,"id",n[19]),L(e,"bx--form-requirement",!0)},m(r,i){R(r,e,i),P(e,t)},p(r,i){i[0]&4096&&Ue(t,r[12]),i[0]&524288&&X(e,"id",r[19])},d(r){r&&F(e)}}}function Da(n){let e,t;return{c(){e=U("div"),t=me(n[14]),X(e,"id",n[18]),L(e,"bx--form-requirement",!0)},m(r,i){R(r,e,i),P(e,t)},p(r,i){i[0]&16384&&Ue(t,r[14]),i[0]&262144&&X(e,"id",r[18])},d(r){r&&F(e)}}}function Ba(n){let e,t;return{c(){e=U("div"),t=me(n[6]),L(e,"bx--form__helper-text",!0),L(e,"bx--form__helper-text--disabled",n[5]),L(e,"bx--form__helper-text--inline",n[16])},m(r,i){R(r,e,i),P(e,t)},p(r,i){i[0]&64&&Ue(t,r[6]),i[0]&32&&L(e,"bx--form__helper-text--disabled",r[5]),i[0]&65536&&L(e,"bx--form__helper-text--inline",r[16])},d(r){r&&F(e)}}}function Ua(n){let e,t;return{c(){e=U("div"),t=me(n[12]),X(e,"id",n[19]),L(e,"bx--form-requirement",!0)},m(r,i){R(r,e,i),P(e,t)},p(r,i){i[0]&4096&&Ue(t,r[12]),i[0]&524288&&X(e,"id",r[19])},d(r){r&&F(e)}}}function Ga(n){let e,t;return{c(){e=U("div"),t=me(n[14]),X(e,"id",n[18]),L(e,"bx--form-requirement",!0)},m(r,i){R(r,e,i),P(e,t)},p(r,i){i[0]&16384&&Ue(t,r[14]),i[0]&262144&&X(e,"id",r[18])},d(r){r&&F(e)}}}function rf(n){let e,t,r,i,o,l,s,f,c,g,_,m,d,p,w,O,z,v,b,E,M,x,j,A,Y=n[16]&&xa(n),te=!n[16]&&(n[9]||n[24].labelText)&&La(n),N=n[11]&&Pa(),Z=!n[11]&&n[13]&&Aa(),B=n[17]&&Na(),$=[{"data-invalid":g=n[11]||void 0},{"aria-invalid":_=n[11]||void 0},{"data-warn":m=n[13]||void 0},{"aria-describedby":d=n[11]?n[19]:n[13]?n[18]:void 0},{disabled:n[5]},{id:n[7]},{name:n[8]},{placeholder:n[3]},{required:n[15]},{readOnly:n[17]},n[23]],Q={};for(let I=0;I<$.length;I+=1)Q=ye(Q,$[I]);let se=n[20]&&Ra(),ke=n[20]&&!n[16]&&n[11]&&Fa(n),we=n[20]&&!n[16]&&n[13]&&Da(n),Se=!n[11]&&!n[13]&&!n[20]&&!n[16]&&n[6]&&Ba(n),Le=!n[20]&&n[11]&&Ua(n),ve=!n[20]&&!n[11]&&n[13]&&Ga(n);return{c(){e=U("div"),Y&&Y.c(),t=J(),te&&te.c(),r=J(),i=U("div"),o=U("div"),N&&N.c(),l=J(),Z&&Z.c(),s=J(),B&&B.c(),f=J(),c=U("input"),p=J(),se&&se.c(),w=J(),ke&&ke.c(),O=J(),we&&we.c(),b=J(),Se&&Se.c(),E=J(),Le&&Le.c(),M=J(),ve&&ve.c(),Ze(c,Q),L(c,"bx--text-input",!0),L(c,"bx--text-input--light",n[4]),L(c,"bx--text-input--invalid",n[11]),L(c,"bx--text-input--warn",n[13]),L(c,"bx--text-input--sm",n[2]==="sm"),L(c,"bx--text-input--xl",n[2]==="xl"),X(o,"data-invalid",z=n[11]||void 0),X(o,"data-warn",v=n[13]||void 0),L(o,"bx--text-input__field-wrapper",!0),L(o,"bx--text-input__field-wrapper--warning",!n[11]&&n[13]),L(i,"bx--text-input__field-outer-wrapper",!0),L(i,"bx--text-input__field-outer-wrapper--inline",n[16]),L(e,"bx--form-item",!0),L(e,"bx--text-input-wrapper",!0),L(e,"bx--text-input-wrapper--inline",n[16]),L(e,"bx--text-input-wrapper--light",n[4]),L(e,"bx--text-input-wrapper--readonly",n[17])},m(I,ce){R(I,e,ce),Y&&Y.m(e,null),P(e,t),te&&te.m(e,null),P(e,r),P(e,i),P(i,o),N&&N.m(o,null),P(o,l),Z&&Z.m(o,null),P(o,s),B&&B.m(o,null),P(o,f),P(o,c),c.autofocus&&c.focus(),n[36](c),jn(c,n[0]),P(o,p),se&&se.m(o,null),P(o,w),ke&&ke.m(o,null),P(o,O),we&&we.m(o,null),P(i,b),Se&&Se.m(i,null),P(i,E),Le&&Le.m(i,null),P(i,M),ve&&ve.m(i,null),x=!0,j||(A=[ie(c,"input",n[37]),ie(c,"change",n[22]),ie(c,"input",n[21]),ie(c,"keydown",n[31]),ie(c,"keyup",n[32]),ie(c,"focus",n[33]),ie(c,"blur",n[34]),ie(c,"paste",n[35]),ie(e,"click",n[27]),ie(e,"mouseover",n[28]),ie(e,"mouseenter",n[29]),ie(e,"mouseleave",n[30])],j=!0)},p(I,ce){I[16]?Y?(Y.p(I,ce),ce[0]&65536&&V(Y,1)):(Y=xa(I),Y.c(),V(Y,1),Y.m(e,t)):Y&&(it(),W(Y,1,1,()=>{Y=null}),ot()),!I[16]&&(I[9]||I[24].labelText)?te?(te.p(I,ce),ce[0]&16843264&&V(te,1)):(te=La(I),te.c(),V(te,1),te.m(e,r)):te&&(it(),W(te,1,1,()=>{te=null}),ot()),I[11]?N?ce[0]&2048&&V(N,1):(N=Pa(),N.c(),V(N,1),N.m(o,l)):N&&(it(),W(N,1,1,()=>{N=null}),ot()),!I[11]&&I[13]?Z?ce[0]&10240&&V(Z,1):(Z=Aa(),Z.c(),V(Z,1),Z.m(o,s)):Z&&(it(),W(Z,1,1,()=>{Z=null}),ot()),I[17]?B?ce[0]&131072&&V(B,1):(B=Na(),B.c(),V(B,1),B.m(o,f)):B&&(it(),W(B,1,1,()=>{B=null}),ot()),Ze(c,Q=pt($,[(!x||ce[0]&2048&&g!==(g=I[11]||void 0))&&{"data-invalid":g},(!x||ce[0]&2048&&_!==(_=I[11]||void 0))&&{"aria-invalid":_},(!x||ce[0]&8192&&m!==(m=I[13]||void 0))&&{"data-warn":m},(!x||ce[0]&796672&&d!==(d=I[11]?I[19]:I[13]?I[18]:void 0))&&{"aria-describedby":d},(!x||ce[0]&32)&&{disabled:I[5]},(!x||ce[0]&128)&&{id:I[7]},(!x||ce[0]&256)&&{name:I[8]},(!x||ce[0]&8)&&{placeholder:I[3]},(!x||ce[0]&32768)&&{required:I[15]},(!x||ce[0]&131072)&&{readOnly:I[17]},ce[0]&8388608&&I[23]])),ce[0]&1&&c.value!==I[0]&&jn(c,I[0]),L(c,"bx--text-input",!0),L(c,"bx--text-input--light",I[4]),L(c,"bx--text-input--invalid",I[11]),L(c,"bx--text-input--warn",I[13]),L(c,"bx--text-input--sm",I[2]==="sm"),L(c,"bx--text-input--xl",I[2]==="xl"),I[20]?se||(se=Ra(),se.c(),se.m(o,w)):se&&(se.d(1),se=null),I[20]&&!I[16]&&I[11]?ke?ke.p(I,ce):(ke=Fa(I),ke.c(),ke.m(o,O)):ke&&(ke.d(1),ke=null),I[20]&&!I[16]&&I[13]?we?we.p(I,ce):(we=Da(I),we.c(),we.m(o,null)):we&&(we.d(1),we=null),(!x||ce[0]&2048&&z!==(z=I[11]||void 0))&&X(o,"data-invalid",z),(!x||ce[0]&8192&&v!==(v=I[13]||void 0))&&X(o,"data-warn",v),(!x||ce[0]&10240)&&L(o,"bx--text-input__field-wrapper--warning",!I[11]&&I[13]),!I[11]&&!I[13]&&!I[20]&&!I[16]&&I[6]?Se?Se.p(I,ce):(Se=Ba(I),Se.c(),Se.m(i,E)):Se&&(Se.d(1),Se=null),!I[20]&&I[11]?Le?Le.p(I,ce):(Le=Ua(I),Le.c(),Le.m(i,M)):Le&&(Le.d(1),Le=null),!I[20]&&!I[11]&&I[13]?ve?ve.p(I,ce):(ve=Ga(I),ve.c(),ve.m(i,null)):ve&&(ve.d(1),ve=null),(!x||ce[0]&65536)&&L(i,"bx--text-input__field-outer-wrapper--inline",I[16]),(!x||ce[0]&65536)&&L(e,"bx--text-input-wrapper--inline",I[16]),(!x||ce[0]&16)&&L(e,"bx--text-input-wrapper--light",I[4]),(!x||ce[0]&131072)&&L(e,"bx--text-input-wrapper--readonly",I[17])},i(I){x||(V(Y),V(te),V(N),V(Z),V(B),x=!0)},o(I){W(Y),W(te),W(N),W(Z),W(B),x=!1},d(I){I&&F(e),Y&&Y.d(),te&&te.d(),N&&N.d(),Z&&Z.d(),B&&B.d(),n[36](null),se&&se.d(),ke&&ke.d(),we&&we.d(),Se&&Se.d(),Le&&Le.d(),ve&&ve.d(),j=!1,gt(A)}}}function of(n,e,t){let r,i,o;const l=["size","value","placeholder","light","disabled","helperText","id","name","labelText","hideLabel","invalid","invalidText","warn","warnText","ref","required","inline","readonly"];let s=Be(e,l),{$$slots:f={},$$scope:c}=e;const g=oi(f);let{size:_=void 0}=e,{value:m=""}=e,{placeholder:d=""}=e,{light:p=!1}=e,{disabled:w=!1}=e,{helperText:O=""}=e,{id:z="ccs-"+Math.random().toString(36)}=e,{name:v=void 0}=e,{labelText:b=""}=e,{hideLabel:E=!1}=e,{invalid:M=!1}=e,{invalidText:x=""}=e,{warn:j=!1}=e,{warnText:A=""}=e,{ref:Y=null}=e,{required:te=!1}=e,{inline:N=!1}=e,{readonly:Z=!1}=e;const B=ii("Form"),$=_l();function Q(oe){return s.type!=="number"?oe:oe!=""?Number(oe):null}const se=oe=>{t(0,m=Q(oe.target.value)),$("input",m)},ke=oe=>{$("change",Q(oe.target.value))};function we(oe){fe.call(this,n,oe)}function Se(oe){fe.call(this,n,oe)}function Le(oe){fe.call(this,n,oe)}function ve(oe){fe.call(this,n,oe)}function I(oe){fe.call(this,n,oe)}function ce(oe){fe.call(this,n,oe)}function Ve(oe){fe.call(this,n,oe)}function hn(oe){fe.call(this,n,oe)}function jt(oe){fe.call(this,n,oe)}function et(oe){je[oe?"unshift":"push"](()=>{Y=oe,t(1,Y)})}function le(){m=this.value,t(0,m)}return n.$$set=oe=>{e=ye(ye({},e),at(oe)),t(23,s=Be(e,l)),"size"in oe&&t(2,_=oe.size),"value"in oe&&t(0,m=oe.value),"placeholder"in oe&&t(3,d=oe.placeholder),"light"in oe&&t(4,p=oe.light),"disabled"in oe&&t(5,w=oe.disabled),"helperText"in oe&&t(6,O=oe.helperText),"id"in oe&&t(7,z=oe.id),"name"in oe&&t(8,v=oe.name),"labelText"in oe&&t(9,b=oe.labelText),"hideLabel"in oe&&t(10,E=oe.hideLabel),"invalid"in oe&&t(11,M=oe.invalid),"invalidText"in oe&&t(12,x=oe.invalidText),"warn"in oe&&t(13,j=oe.warn),"warnText"in oe&&t(14,A=oe.warnText),"ref"in oe&&t(1,Y=oe.ref),"required"in oe&&t(15,te=oe.required),"inline"in oe&&t(16,N=oe.inline),"readonly"in oe&&t(17,Z=oe.readonly),"$$scope"in oe&&t(25,c=oe.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&128&&t(19,i=`error-${z}`),n.$$.dirty[0]&128&&t(18,o=`warn-${z}`)},t(20,r=!!B&&B.isFluid),[m,Y,_,d,p,w,O,z,v,b,E,M,x,j,A,te,N,Z,o,i,r,se,ke,s,g,c,f,we,Se,Le,ve,I,ce,Ve,hn,jt,et,le]}class af extends xe{constructor(e){super(),Oe(this,e,of,rf,Ie,{size:2,value:0,placeholder:3,light:4,disabled:5,helperText:6,id:7,name:8,labelText:9,hideLabel:10,invalid:11,invalidText:12,warn:13,warnText:14,ref:1,required:15,inline:16,readonly:17},null,[-1,-1])}}const lf=af;function sf(n){let e;return{c(){e=me(`Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)`)},m(t,r){R(t,e,r)},d(t){t&&F(e)}}}function uf(n){let e;return{c(){e=me(`Draw the intervention on the map, clicking the original point or 'Finish
      snapping' for the Polygon and Route tools respectively`)},m(t,r){R(t,e,r)},d(t){t&&F(e)}}}function ff(n){let e;return{c(){e=me("Fill in the details that appear (Intervention type, name, description)")},m(t,r){R(t,e,r)},d(t){t&&F(e)}}}function cf(n){let e;return{c(){e=me(`Click the "Save" button or "Delete" button to save or remove the
      intervention`)},m(t,r){R(t,e,r)},d(t){t&&F(e)}}}function df(n){let e,t,r,i,o,l,s,f;return e=new Gr({props:{$$slots:{default:[sf]},$$scope:{ctx:n}}}),r=new Gr({props:{$$slots:{default:[uf]},$$scope:{ctx:n}}}),o=new Gr({props:{$$slots:{default:[ff]},$$scope:{ctx:n}}}),s=new Gr({props:{$$slots:{default:[cf]},$$scope:{ctx:n}}}),{c(){he(e.$$.fragment),t=J(),he(r.$$.fragment),i=J(),he(o.$$.fragment),l=J(),he(s.$$.fragment)},m(c,g){pe(e,c,g),R(c,t,g),pe(r,c,g),R(c,i,g),pe(o,c,g),R(c,l,g),pe(s,c,g),f=!0},p(c,g){const _={};g&4&&(_.$$scope={dirty:g,ctx:c}),e.$set(_);const m={};g&4&&(m.$$scope={dirty:g,ctx:c}),r.$set(m);const d={};g&4&&(d.$$scope={dirty:g,ctx:c}),o.$set(d);const p={};g&4&&(p.$$scope={dirty:g,ctx:c}),s.$set(p)},i(c){f||(V(e.$$.fragment,c),V(r.$$.fragment,c),V(o.$$.fragment,c),V(s.$$.fragment,c),f=!0)},o(c){W(e.$$.fragment,c),W(r.$$.fragment,c),W(o.$$.fragment,c),W(s.$$.fragment,c),f=!1},d(c){ge(e,c),c&&F(t),ge(r,c),c&&F(i),ge(o,c),c&&F(l),ge(s,c)}}}function hf(n){let e,t,r,i,o,l,s,f,c,g,_,m,d,p,w,O,z,v,b,E,M,x,j,A,Y,te;return o=new Gu({props:{$$slots:{default:[df]},$$scope:{ctx:n}}}),{c(){e=U("p"),e.textContent="For each intervention:",t=J(),r=U("br"),i=J(),he(o.$$.fragment),l=J(),s=U("br"),f=J(),c=U("p"),c.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,g=J(),_=U("br"),m=J(),d=U("p"),d.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,p=J(),w=U("br"),O=J(),z=U("p"),z.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,v=J(),b=U("br"),E=J(),M=U("p"),M.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,x=J(),j=U("br"),A=J(),Y=U("p"),Y.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(N,Z){R(N,e,Z),R(N,t,Z),R(N,r,Z),R(N,i,Z),pe(o,N,Z),R(N,l,Z),R(N,s,Z),R(N,f,Z),R(N,c,Z),R(N,g,Z),R(N,_,Z),R(N,m,Z),R(N,d,Z),R(N,p,Z),R(N,w,Z),R(N,O,Z),R(N,z,Z),R(N,v,Z),R(N,b,Z),R(N,E,Z),R(N,M,Z),R(N,x,Z),R(N,j,Z),R(N,A,Z),R(N,Y,Z),te=!0},p(N,Z){const B={};Z&4&&(B.$$scope={dirty:Z,ctx:N}),o.$set(B)},i(N){te||(V(o.$$.fragment,N),te=!0)},o(N){W(o.$$.fragment,N),te=!1},d(N){N&&F(e),N&&F(t),N&&F(r),N&&F(i),ge(o,N),N&&F(l),N&&F(s),N&&F(f),N&&F(c),N&&F(g),N&&F(_),N&&F(m),N&&F(d),N&&F(p),N&&F(w),N&&F(O),N&&F(z),N&&F(v),N&&F(b),N&&F(E),N&&F(M),N&&F(x),N&&F(j),N&&F(A),N&&F(Y)}}}function pf(n){let e,t,r;function i(l){n[1](l)}let o={passiveModal:!0,modalHeading:"Instructions",$$slots:{default:[hf]},$$scope:{ctx:n}};return n[0]!==void 0&&(o.open=n[0]),e=new js({props:o}),je.push(()=>kt(e,"open",i,n[0])),{c(){he(e.$$.fragment)},m(l,s){pe(e,l,s),r=!0},p(l,[s]){const f={};s&4&&(f.$$scope={dirty:s,ctx:l}),!t&&s&1&&(t=!0,f.open=l[0],Mt(()=>t=!1)),e.$set(f)},i(l){r||(V(e.$$.fragment,l),r=!0)},o(l){W(e.$$.fragment,l),r=!1},d(l){ge(e,l)}}}function gf(n,e,t){let{open:r}=e;function i(o){r=o,t(0,r)}return n.$$set=o=>{"open"in o&&t(0,r=o.open)},[r,i]}class mf extends xe{constructor(e){super(),Oe(this,e,gf,pf,Ie,{open:0})}}const At=Tn(null),De=Tn(sr()),Lt=Tn(null),Di=Tn(null);function sr(){return{type:"FeatureCollection",features:[]}}const ai=Vs(De,n=>{let e=n.features.find(t=>t.properties.editing);return e?e.id:null});function Mn(n){qs(ai)!=n&&(De.update(e=>{for(let t of e.features)t.id==n?t.properties.editing=!0:delete t.properties.editing;return e}),Lt.set(n))}function oo(n){let e=new Set;for(let r of n.features)e.add(r.id);let t=e.size+1;for(;e.has(t);)t++;return t}function za(n){let e;const t=n[4].default,r=mt(t,n,n[3],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),e=!0},p(i,o){r&&r.p&&(!e||o&8)&&vt(r,t,i,i[3],e?_t(t,i[3],o,null):bt(i[3]),null)},i(i){e||(V(r,i),e=!0)},o(i){W(r,i),e=!1},d(i){r&&r.d(i)}}}function vf(n){let e,t,r=n[1]&&za(n);return{c(){e=U("div"),r&&r.c(),X(e,"class","map svelte-12dpf1u")},m(i,o){R(i,e,o),r&&r.m(e,null),n[5](e),t=!0},p(i,[o]){i[1]?r?(r.p(i,o),o&2&&V(r,1)):(r=za(i),r.c(),V(r,1),r.m(e,null)):r&&(it(),W(r,1,1,()=>{r=null}),ot())},i(i){t||(V(r),t=!0)},o(i){W(r),t=!1},d(i){i&&F(e),r&&r.d(),n[5](null)}}}function bf(n,e,t){let{$$slots:r={},$$scope:i}=e,{style:o}=e,l,s,f=!1;eo("setCamera",!window.location.hash),Yn(()=>{l=new Ii.Map({container:s,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),l.addControl(new Ii.ScaleControl),l.addControl(new Ii.NavigationControl({visualizePitch:!0}),"bottom-right"),l.on("load",()=>{t(1,f=!0),At.set(l)}),new ResizeObserver(()=>{l.resize()}).observe(s)}),to(()=>{l.remove()});function c(g){je[g?"unshift":"push"](()=>{s=g,t(0,s)})}return n.$$set=g=>{"style"in g&&t(2,o=g.style),"$$scope"in g&&t(3,i=g.$$scope)},[s,f,o,i,r,c]}class _f extends xe{constructor(e){super(),Oe(this,e,bf,vf,Ie,{style:2})}}const yf=n=>({}),ja=n=>({}),wf=n=>({}),Va=n=>({}),Ef=n=>({}),qa=n=>({});function Sf(n){let e,t,r,i,o,l,s,f,c,g,_,m;const d=n[3].nav,p=mt(d,n,n[2],qa),w=n[3].sidebar,O=mt(w,n,n[2],Va),z=n[3].main,v=mt(z,n,n[2],ja);return{c(){e=U("aside"),t=U("div"),r=U("nav"),p&&p.c(),i=J(),O&&O.c(),o=J(),l=U("div"),l.textContent="→",f=J(),c=U("main"),v&&v.c(),X(r,"class","svelte-19nerxn"),X(t,"class","sidebar-content content-container svelte-19nerxn"),X(l,"class","sidebar-toggle rounded-rect svelte-19nerxn"),X(e,"class",s=na(n[0]?"":"collapsed")+" svelte-19nerxn"),X(c,"class","svelte-19nerxn")},m(b,E){R(b,e,E),P(e,t),P(t,r),p&&p.m(r,null),P(t,i),O&&O.m(t,null),P(e,o),P(e,l),R(b,f,E),R(b,c,E),v&&v.m(c,null),g=!0,_||(m=ie(l,"click",n[1]),_=!0)},p(b,[E]){p&&p.p&&(!g||E&4)&&vt(p,d,b,b[2],g?_t(d,b[2],E,Ef):bt(b[2]),qa),O&&O.p&&(!g||E&4)&&vt(O,w,b,b[2],g?_t(w,b[2],E,wf):bt(b[2]),Va),(!g||E&1&&s!==(s=na(b[0]?"":"collapsed")+" svelte-19nerxn"))&&X(e,"class",s),v&&v.p&&(!g||E&4)&&vt(v,z,b,b[2],g?_t(z,b[2],E,yf):bt(b[2]),ja)},i(b){g||(V(p,b),V(O,b),V(v,b),g=!0)},o(b){W(p,b),W(O,b),W(v,b),g=!1},d(b){b&&F(e),p&&p.d(b),O&&O.d(b),b&&F(f),b&&F(c),v&&v.d(b),_=!1,m()}}}function kf(n,e,t){let{$$slots:r={},$$scope:i}=e,o=!0;function l(){t(0,o=!o)}return n.$$set=s=>{"$$scope"in s&&t(2,i=s.$$scope)},[o,l,i,r]}class Mf extends xe{constructor(e){super(),Oe(this,e,kf,Sf,Ie,{})}}var lt=63710088e-1,ao={centimeters:lt*100,centimetres:lt*100,degrees:lt/111325,feet:lt*3.28084,inches:lt*39.37,kilometers:lt/1e3,kilometres:lt/1e3,meters:lt,metres:lt,miles:lt/1609.344,millimeters:lt*1e3,millimetres:lt*1e3,nauticalmiles:lt/1852,radians:1,yards:lt*1.0936},Tf={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/lt,yards:1.0936133},Bi={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ct(n,e,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function Cf(n,e,t){switch(n){case"Point":return ft(e).geometry;case"LineString":return dt(e).geometry;case"Polygon":return li(e).geometry;case"MultiPoint":return El(e).geometry;case"MultiLineString":return wl(e).geometry;case"MultiPolygon":return lo(e).geometry;default:throw new Error(n+" is invalid")}}function ft(n,e,t){if(t===void 0&&(t={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Hr(n[0])||!Hr(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return Ct(r,e,t)}function xf(n,e,t){return t===void 0&&(t={}),Tt(n.map(function(r){return ft(r,e)}),t)}function li(n,e,t){t===void 0&&(t={});for(var r=0,i=n;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:n};return Ct(s,e,t)}function Of(n,e,t){return t===void 0&&(t={}),Tt(n.map(function(r){return li(r,e)}),t)}function dt(n,e,t){if(t===void 0&&(t={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:n};return Ct(r,e,t)}function If(n,e,t){return t===void 0&&(t={}),Tt(n.map(function(r){return dt(r,e)}),t)}function Tt(n,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function wl(n,e,t){t===void 0&&(t={});var r={type:"MultiLineString",coordinates:n};return Ct(r,e,t)}function El(n,e,t){t===void 0&&(t={});var r={type:"MultiPoint",coordinates:n};return Ct(r,e,t)}function lo(n,e,t){t===void 0&&(t={});var r={type:"MultiPolygon",coordinates:n};return Ct(r,e,t)}function Lf(n,e,t){t===void 0&&(t={});var r={type:"GeometryCollection",geometries:n};return Ct(r,e,t)}function Pf(n,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(n*t)/t}function so(n,e){e===void 0&&(e="kilometers");var t=ao[e];if(!t)throw new Error(e+" units is invalid");return n*t}function si(n,e){e===void 0&&(e="kilometers");var t=ao[e];if(!t)throw new Error(e+" units is invalid");return n/t}function Af(n,e){return ur(si(n,e))}function Nf(n){var e=n%360;return e<0&&(e+=360),e}function ur(n){var e=n%(2*Math.PI);return e*180/Math.PI}function St(n){var e=n%360;return e*Math.PI/180}function Rf(n,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(n>=0))throw new Error("length must be a positive number");return so(si(n,e),t)}function Ff(n,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(n>=0))throw new Error("area must be a positive number");var r=Bi[e];if(!r)throw new Error("invalid original units");var i=Bi[t];if(!i)throw new Error("invalid final units");return n/r*i}function Hr(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function uo(n){return!!n&&n.constructor===Object}function Df(n){if(!n)throw new Error("bbox is required");if(!Array.isArray(n))throw new Error("bbox must be an Array");if(n.length!==4&&n.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");n.forEach(function(e){if(!Hr(e))throw new Error("bbox must only contain numbers")})}function Bf(n){if(!n)throw new Error("id is required");if(["string","number"].indexOf(typeof n)===-1)throw new Error("id must be a number or a string")}const Uf=Object.freeze(Object.defineProperty({__proto__:null,earthRadius:lt,factors:ao,unitsFactors:Tf,areaFactors:Bi,feature:Ct,geometry:Cf,point:ft,points:xf,polygon:li,polygons:Of,lineString:dt,lineStrings:If,featureCollection:Tt,multiLineString:wl,multiPoint:El,multiPolygon:lo,geometryCollection:Lf,round:Pf,radiansToLength:so,lengthToRadians:si,lengthToDegrees:Af,bearingToAzimuth:Nf,radiansToDegrees:ur,degreesToRadians:St,convertLength:Rf,convertArea:Ff,isNumber:Hr,isObject:uo,validateBBox:Df,validateId:Bf},Symbol.toStringTag,{value:"Module"}));/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Gf(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(c){return function(g){return f([c,g])}}function f(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(g){c=[6,g],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var dn=function(){function n(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return n}();function zf(n,e){return n>e?1:n<e?-1:0}function an(n,e,t){for(var r=new dn(null,null),i=r,o=r;;){var l=t(n,e.key);if(l<0){if(e.left===null)break;if(t(n,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}o.left=e,o=e,e=e.left}else if(l>0){if(e.right===null)break;if(t(n,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=r.right,e.right=r.left,e}function Li(n,e,t,r){var i=new dn(n,e);if(t===null)return i.left=i.right=null,i;t=an(n,t,r);var o=r(n,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Ya(n,e,t){var r=null,i=null;if(e){e=an(n,e,t);var o=t(e.key,n);o===0?(r=e.left,i=e.right):o<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function jf(n,e,t){return e===null?n:(n===null||(e=an(n.key,e,t),e.left=n),e)}function Ui(n,e,t,r,i){if(n){r(""+e+(t?"└── ":"├── ")+i(n)+`
`);var o=e+(t?"    ":"│   ");n.left&&Ui(n.left,o,!1,r,i),n.right&&Ui(n.right,o,!0,r,i)}}var fo=function(){function n(e){e===void 0&&(e=zf),this._root=null,this._size=0,this._comparator=e}return n.prototype.insert=function(e,t){return this._size++,this._root=Li(e,t,this._root,this._comparator)},n.prototype.add=function(e,t){var r=new dn(e,t);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,o=an(e,this._root,i),l=i(e,o.key);return l===0?this._root=o:(l<0?(r.left=o.left,r.right=o,o.left=null):l>0&&(r.right=o.right,r.left=o,o.right=null),this._size++,this._root=r),this._root},n.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},n.prototype._remove=function(e,t,r){var i;if(t===null)return null;t=an(e,t,r);var o=r(e,t.key);return o===0?(t.left===null?i=t.right:(i=an(e,t.left,r),i.right=t.right),this._size--,i):t},n.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=an(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},n.prototype.findStatic=function(e){for(var t=this._root,r=this._comparator;t;){var i=r(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},n.prototype.find=function(e){return this._root&&(this._root=an(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},n.prototype.contains=function(e){for(var t=this._root,r=this._comparator;t;){var i=r(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},n.prototype.forEach=function(e,t){for(var r=this._root,i=[],o=!1;!o;)r!==null?(i.push(r),r=r.left):i.length!==0?(r=i.pop(),e.call(t,r),r=r.right):o=!0;return this},n.prototype.range=function(e,t,r,i){for(var o=[],l=this._comparator,s=this._root,f;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),f=l(s.key,t),f>0)break;if(l(s.key,e)>=0&&r.call(i,s))return this;s=s.right}return this},n.prototype.keys=function(){var e=[];return this.forEach(function(t){var r=t.key;return e.push(r)}),e},n.prototype.values=function(){var e=[];return this.forEach(function(t){var r=t.data;return e.push(r)}),e},n.prototype.min=function(){return this._root?this.minNode(this._root).key:null},n.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},n.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},n.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},n.prototype.at=function(e){for(var t=this._root,r=!1,i=0,o=[];!r;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else r=!0;return null},n.prototype.next=function(e){var t=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(r=t,t=t.left):t=t.right}return r},n.prototype.prev=function(e){var t=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(r=t,t=t.right)}return r},n.prototype.clear=function(){return this._root=null,this._size=0,this},n.prototype.toList=function(){return qf(this._root)},n.prototype.load=function(e,t,r){t===void 0&&(t=[]),r===void 0&&(r=!1);var i=e.length,o=this._comparator;if(r&&ji(e,t,0,i-1,o),this._root===null)this._root=Gi(e,t,0,i),this._size=i;else{var l=Yf(this.toList(),Vf(e,t),o);i=this._size+i,this._root=zi({head:l},0,i)}return this},n.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var t=[];return Ui(this._root,"",!0,function(r){return t.push(r)},e),t.join("")},n.prototype.update=function(e,t,r){var i=this._comparator,o=Ya(e,this._root,i),l=o.left,s=o.right;i(e,t)<0?s=Li(t,r,s,i):l=Li(t,r,l,i),this._root=jf(l,s,i)},n.prototype.split=function(e){return Ya(e,this._root,this._comparator)},n.prototype[Symbol.iterator]=function(){var e;return Gf(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},n}();function Gi(n,e,t,r){var i=r-t;if(i>0){var o=t+Math.floor(i/2),l=n[o],s=e[o],f=new dn(l,s);return f.left=Gi(n,e,t,o),f.right=Gi(n,e,o+1,r),f}return null}function Vf(n,e){for(var t=new dn(null,null),r=t,i=0;i<n.length;i++)r=r.next=new dn(n[i],e[i]);return r.next=null,t.next}function qf(n){for(var e=n,t=[],r=!1,i=new dn(null,null),o=i;!r;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):r=!0;return o.next=null,i.next}function zi(n,e,t){var r=t-e;if(r>0){var i=e+Math.floor(r/2),o=zi(n,e,i),l=n.head;return l.left=o,n.head=n.head.next,l.right=zi(n,i+1,t),l}return null}function Yf(n,e,t){for(var r=new dn(null,null),i=r,o=n,l=e;o!==null&&l!==null;)t(o.key,l.key)<0?(i.next=o,o=o.next):(i.next=l,l=l.next),i=i.next;return o!==null?i.next=o:l!==null&&(i.next=l),r.next}function ji(n,e,t,r,i){if(!(t>=r)){for(var o=n[t+r>>1],l=t-1,s=r+1;;){do l++;while(i(n[l],o)<0);do s--;while(i(n[s],o)>0);if(l>=s)break;var f=n[l];n[l]=n[s],n[s]=f,f=e[l],e[l]=e[s],e[s]=f}ji(n,e,t,s,i),ji(n,e,s+1,r,i)}}function xt(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Ja(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function ht(n,e,t){return e&&Ja(n.prototype,e),t&&Ja(n,t),n}var rr=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Vi=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var r=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,l=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:r,y:o},ur:{x:i,y:l}}},sn=Number.EPSILON;sn===void 0&&(sn=Math.pow(2,-52));var Jf=sn*sn,qi=function(e,t){if(-sn<e&&e<sn&&-sn<t&&t<sn)return 0;var r=e-t;return r*r<Jf*e*t?0:e<t?-1:1},Xf=function(){function n(){xt(this,n),this.reset()}return ht(n,[{key:"reset",value:function(){this.xRounder=new Xa,this.yRounder=new Xa}},{key:"round",value:function(t,r){return{x:this.xRounder.round(t),y:this.yRounder.round(r)}}}]),n}(),Xa=function(){function n(){xt(this,n),this.tree=new fo,this.round(0)}return ht(n,[{key:"round",value:function(t){var r=this.tree.add(t),i=this.tree.prev(r);if(i!==null&&qi(r.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(r);return o!==null&&qi(r.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),n}(),fr=new Xf,or=function(e,t){return e.x*t.y-e.y*t.x},Sl=function(e,t){return e.x*t.x+e.y*t.y},Wa=function(e,t,r){var i={x:t.x-e.x,y:t.y-e.y},o={x:r.x-e.x,y:r.y-e.y},l=or(i,o);return qi(l,0)},Zr=function(e){return Math.sqrt(Sl(e,e))},Wf=function(e,t,r){var i={x:t.x-e.x,y:t.y-e.y},o={x:r.x-e.x,y:r.y-e.y};return or(o,i)/Zr(o)/Zr(i)},Hf=function(e,t,r){var i={x:t.x-e.x,y:t.y-e.y},o={x:r.x-e.x,y:r.y-e.y};return Sl(o,i)/Zr(o)/Zr(i)},Ha=function(e,t,r){return t.y===0?null:{x:e.x+t.x/t.y*(r-e.y),y:r}},Za=function(e,t,r){return t.x===0?null:{x:r,y:e.y+t.y/t.x*(r-e.x)}},Zf=function(e,t,r,i){if(t.x===0)return Za(r,i,e.x);if(i.x===0)return Za(e,t,r.x);if(t.y===0)return Ha(r,i,e.y);if(i.y===0)return Ha(e,t,r.y);var o=or(t,i);if(o==0)return null;var l={x:r.x-e.x,y:r.y-e.y},s=or(l,t)/o,f=or(l,i)/o,c=e.x+f*t.x,g=r.x+s*i.x,_=e.y+f*t.y,m=r.y+s*i.y,d=(c+g)/2,p=(_+m)/2;return{x:d,y:p}},Ut=function(){ht(n,null,[{key:"compare",value:function(t,r){var i=n.comparePoints(t.point,r.point);return i!==0?i:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:Kr.compare(t.segment,r.segment))}},{key:"comparePoints",value:function(t,r){return t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0}}]);function n(e,t){xt(this,n),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return ht(n,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var r=t.point.events,i=0,o=r.length;i<o;i++){var l=r[i];this.point.events.push(l),l.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,r=0;r<t;r++){var i=this.point.events[r];if(i.segment.consumedBy===void 0)for(var o=r+1;o<t;o++){var l=this.point.events[o];l.consumedBy===void 0&&i.otherSE.point.events===l.otherSE.point.events&&i.segment.consume(l.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],r=0,i=this.point.events.length;r<i;r++){var o=this.point.events[r];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var r=this,i=new Map,o=function(s){var f=s.otherSE;i.set(s,{sine:Wf(r.point,t.point,f.point),cosine:Hf(r.point,t.point,f.point)})};return function(l,s){i.has(l)||o(l),i.has(s)||o(s);var f=i.get(l),c=f.sine,g=f.cosine,_=i.get(s),m=_.sine,d=_.cosine;return c>=0&&m>=0?g<d?1:g>d?-1:0:c<0&&m<0?g<d?-1:g>d?1:0:m<c?-1:m>c?1:0}}}]),n}(),Kf=0,Kr=function(){ht(n,null,[{key:"compare",value:function(t,r){var i=t.leftSE.point.x,o=r.leftSE.point.x,l=t.rightSE.point.x,s=r.rightSE.point.x;if(s<i)return 1;if(l<o)return-1;var f=t.leftSE.point.y,c=r.leftSE.point.y,g=t.rightSE.point.y,_=r.rightSE.point.y;if(i<o){if(c<f&&c<g)return 1;if(c>f&&c>g)return-1;var m=t.comparePoint(r.leftSE.point);if(m<0)return 1;if(m>0)return-1;var d=r.comparePoint(t.rightSE.point);return d!==0?d:-1}if(i>o){if(f<c&&f<_)return-1;if(f>c&&f>_)return 1;var p=r.comparePoint(t.leftSE.point);if(p!==0)return p;var w=t.comparePoint(r.rightSE.point);return w<0?1:w>0?-1:1}if(f<c)return-1;if(f>c)return 1;if(l<s){var O=r.comparePoint(t.rightSE.point);if(O!==0)return O}if(l>s){var z=t.comparePoint(r.rightSE.point);if(z<0)return 1;if(z>0)return-1}if(l!==s){var v=g-f,b=l-i,E=_-c,M=s-o;if(v>b&&E<M)return 1;if(v<b&&E>M)return-1}return l>s?1:l<s||g<_?-1:g>_?1:t.id<r.id?-1:t.id>r.id?1:0}}]);function n(e,t,r,i){xt(this,n),this.id=++Kf,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=r,this.windings=i}return ht(n,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<r?t:r},ur:{x:this.rightSE.point.x,y:t>r?t:r}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var r=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(r.x===i.x)return t.x===r.x?0:t.x<r.x?1:-1;var l=(t.y-r.y)/o.y,s=r.x+l*o.x;if(t.x===s)return 0;var f=(t.x-r.x)/o.x,c=r.y+f*o.y;return t.y===c?0:t.y<c?-1:1}},{key:"getIntersection",value:function(t){var r=this.bbox(),i=t.bbox(),o=Vi(r,i);if(o===null)return null;var l=this.leftSE.point,s=this.rightSE.point,f=t.leftSE.point,c=t.rightSE.point,g=rr(r,f)&&this.comparePoint(f)===0,_=rr(i,l)&&t.comparePoint(l)===0,m=rr(r,c)&&this.comparePoint(c)===0,d=rr(i,s)&&t.comparePoint(s)===0;if(_&&g)return d&&!m?s:!d&&m?c:null;if(_)return m&&l.x===c.x&&l.y===c.y?null:l;if(g)return d&&s.x===f.x&&s.y===f.y?null:f;if(d&&m)return null;if(d)return s;if(m)return c;var p=Zf(l,this.vector(),f,t.vector());return p===null||!rr(o,p)?null:fr.round(p.x,p.y)}},{key:"split",value:function(t){var r=[],i=t.events!==void 0,o=new Ut(t,!0),l=new Ut(t,!1),s=this.rightSE;this.replaceRightSE(l),r.push(l),r.push(o);var f=new n(o,s,this.rings.slice(),this.windings.slice());return Ut.comparePoints(f.leftSE.point,f.rightSE.point)>0&&f.swapEvents(),Ut.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),l.checkForConsuming()),r}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var r=0,i=this.windings.length;r<i;r++)this.windings[r]*=-1}},{key:"consume",value:function(t){for(var r=this,i=t;r.consumedBy;)r=r.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=n.compare(r,i);if(o!==0){if(o>0){var l=r;r=i,i=l}if(r.prev===i){var s=r;r=i,i=s}for(var f=0,c=i.rings.length;f<c;f++){var g=i.rings[f],_=i.windings[f],m=r.rings.indexOf(g);m===-1?(r.rings.push(g),r.windings.push(_)):r.windings[m]+=_}i.rings=null,i.windings=null,i.consumedBy=r,i.leftSE.consumedBy=r.leftSE,i.rightSE.consumedBy=r.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var r=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,l=0,s=this.rings.length;l<s;l++){var f=this.rings[l],c=this.windings[l],g=r.indexOf(f);g===-1?(r.push(f),i.push(c)):i[g]+=c}for(var _=[],m=[],d=0,p=r.length;d<p;d++)if(i[d]!==0){var w=r[d],O=w.poly;if(m.indexOf(O)===-1)if(w.isExterior)_.push(O);else{m.indexOf(O)===-1&&m.push(O);var z=_.indexOf(w.poly);z!==-1&&_.splice(z,1)}}for(var v=0,b=_.length;v<b;v++){var E=_[v].multiPoly;o.indexOf(E)===-1&&o.push(E)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(Pt.type){case"union":{var i=t.length===0,o=r.length===0;this._isInResult=i!==o;break}case"intersection":{var l,s;t.length<r.length?(l=t.length,s=r.length):(l=r.length,s=t.length),this._isInResult=s===Pt.numMultiPolys&&l<s;break}case"xor":{var f=Math.abs(t.length-r.length);this._isInResult=f%2===1;break}case"difference":{var c=function(_){return _.length===1&&_[0].isSubject};this._isInResult=c(t)!==c(r);break}default:throw new Error("Unrecognized operation type found ".concat(Pt.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,r,i){var o,l,s,f=Ut.comparePoints(t,r);if(f<0)o=t,l=r,s=1;else if(f>0)o=r,l=t,s=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var c=new Ut(o,!0),g=new Ut(l,!1);return new n(c,g,[i],[s])}}]),n}(),Ka=function(){function n(e,t,r){if(xt(this,n),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=fr.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,l=1,s=e.length;l<s;l++){if(typeof e[l][0]!="number"||typeof e[l][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var f=fr.round(e[l][0],e[l][1]);f.x===o.x&&f.y===o.y||(this.segments.push(Kr.fromRing(o,f,this)),f.x<this.bbox.ll.x&&(this.bbox.ll.x=f.x),f.y<this.bbox.ll.y&&(this.bbox.ll.y=f.y),f.x>this.bbox.ur.x&&(this.bbox.ur.x=f.x),f.y>this.bbox.ur.y&&(this.bbox.ur.y=f.y),o=f)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Kr.fromRing(o,i,this))}return ht(n,[{key:"getSweepEvents",value:function(){for(var t=[],r=0,i=this.segments.length;r<i;r++){var o=this.segments[r];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),n}(),Qf=function(){function n(e,t){if(xt(this,n),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ka(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var o=new Ka(e[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return ht(n,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),r=0,i=this.interiorRings.length;r<i;r++)for(var o=this.interiorRings[r].getSweepEvents(),l=0,s=o.length;l<s;l++)t.push(o[l]);return t}}]),n}(),Qa=function(){function n(e,t){if(xt(this,n),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var o=new Qf(e[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return ht(n,[{key:"getSweepEvents",value:function(){for(var t=[],r=0,i=this.polys.length;r<i;r++)for(var o=this.polys[r].getSweepEvents(),l=0,s=o.length;l<s;l++)t.push(o[l]);return t}}]),n}(),$f=function(){ht(n,null,[{key:"factory",value:function(t){for(var r=[],i=0,o=t.length;i<o;i++){var l=t[i];if(!(!l.isInResult()||l.ringOut)){for(var s=null,f=l.leftSE,c=l.rightSE,g=[f],_=f.point,m=[];s=f,f=c,g.push(f),f.point!==_;)for(;;){var d=f.getAvailableLinkedEvents();if(d.length===0){var p=g[0].point,w=g[g.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(w.x,", ").concat(w.y,"]."))}if(d.length===1){c=d[0].otherSE;break}for(var O=null,z=0,v=m.length;z<v;z++)if(m[z].point===f.point){O=z;break}if(O!==null){var b=m.splice(O)[0],E=g.splice(b.index);E.unshift(E[0].otherSE),r.push(new n(E.reverse()));continue}m.push({index:g.length,point:f.point});var M=f.getLeftmostComparator(s);c=d.sort(M)[0].otherSE;break}r.push(new n(g))}}return r}}]);function n(e){xt(this,n),this.events=e;for(var t=0,r=e.length;t<r;t++)e[t].segment.ringOut=this;this.poly=null}return ht(n,[{key:"getGeom",value:function(){for(var t=this.events[0].point,r=[t],i=1,o=this.events.length-1;i<o;i++){var l=this.events[i].point,s=this.events[i+1].point;Wa(l,t,s)!==0&&(r.push(l),t=l)}if(r.length===1)return null;var f=r[0],c=r[1];Wa(f,t,c)===0&&r.shift(),r.push(r[0]);for(var g=this.isExteriorRing()?1:-1,_=this.isExteriorRing()?0:r.length-1,m=this.isExteriorRing()?r.length:-1,d=[],p=_;p!=m;p+=g)d.push([r[p].x,r[p].y]);return d}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],r=1,i=this.events.length;r<i;r++){var o=this.events[r];Ut.compare(t,o)>0&&(t=o)}for(var l=t.segment.prevInResult(),s=l?l.prevInResult():null;;){if(!l)return null;if(!s)return l.ringOut;if(s.ringOut!==l.ringOut)return s.ringOut.enclosingRing()!==l.ringOut?l.ringOut:l.ringOut.enclosingRing();l=s.prevInResult(),s=l?l.prevInResult():null}}}]),n}(),$a=function(){function n(e){xt(this,n),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return ht(n,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var r=0,i=this.interiorRings.length;r<i;r++){var o=this.interiorRings[r].getGeom();o!==null&&t.push(o)}return t}}]),n}(),ec=function(){function n(e){xt(this,n),this.rings=e,this.polys=this._composePolys(e)}return ht(n,[{key:"getGeom",value:function(){for(var t=[],r=0,i=this.polys.length;r<i;r++){var o=this.polys[r].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var r=[],i=0,o=t.length;i<o;i++){var l=t[i];if(!l.poly)if(l.isExteriorRing())r.push(new $a(l));else{var s=l.enclosingRing();s.poly||r.push(new $a(s)),s.poly.addInterior(l)}}return r}}]),n}(),tc=function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kr.compare;xt(this,n),this.queue=e,this.tree=new fo(t),this.segments=[]}return ht(n,[{key:"process",value:function(t){var r=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(r),i;var o=t.isLeft?this.tree.insert(r):this.tree.find(r);if(!o)throw new Error("Unable to find segment #".concat(r.id," ")+"[".concat(r.leftSE.point.x,", ").concat(r.leftSE.point.y,"] -> ")+"[".concat(r.rightSE.point.x,", ").concat(r.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var l=o,s=o,f=void 0,c=void 0;f===void 0;)l=this.tree.prev(l),l===null?f=null:l.key.consumedBy===void 0&&(f=l.key);for(;c===void 0;)s=this.tree.next(s),s===null?c=null:s.key.consumedBy===void 0&&(c=s.key);if(t.isLeft){var g=null;if(f){var _=f.getIntersection(r);if(_!==null&&(r.isAnEndpoint(_)||(g=_),!f.isAnEndpoint(_)))for(var m=this._splitSafely(f,_),d=0,p=m.length;d<p;d++)i.push(m[d])}var w=null;if(c){var O=c.getIntersection(r);if(O!==null&&(r.isAnEndpoint(O)||(w=O),!c.isAnEndpoint(O)))for(var z=this._splitSafely(c,O),v=0,b=z.length;v<b;v++)i.push(z[v])}if(g!==null||w!==null){var E=null;if(g===null)E=w;else if(w===null)E=g;else{var M=Ut.comparePoints(g,w);E=M<=0?g:w}this.queue.remove(r.rightSE),i.push(r.rightSE);for(var x=r.split(E),j=0,A=x.length;j<A;j++)i.push(x[j])}i.length>0?(this.tree.remove(r),i.push(t)):(this.segments.push(r),r.prev=f)}else{if(f&&c){var Y=f.getIntersection(c);if(Y!==null){if(!f.isAnEndpoint(Y))for(var te=this._splitSafely(f,Y),N=0,Z=te.length;N<Z;N++)i.push(te[N]);if(!c.isAnEndpoint(Y))for(var B=this._splitSafely(c,Y),$=0,Q=B.length;$<Q;$++)i.push(B[$])}}this.tree.remove(r)}return i}},{key:"_splitSafely",value:function(t,r){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(r);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),n}(),el=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,nc=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,rc=function(){function n(){xt(this,n)}return ht(n,[{key:"run",value:function(t,r,i){Pt.type=t,fr.reset();for(var o=[new Qa(r,!0)],l=0,s=i.length;l<s;l++)o.push(new Qa(i[l],!1));if(Pt.numMultiPolys=o.length,Pt.type==="difference")for(var f=o[0],c=1;c<o.length;)Vi(o[c].bbox,f.bbox)!==null?c++:o.splice(c,1);if(Pt.type==="intersection"){for(var g=0,_=o.length;g<_;g++)for(var m=o[g],d=g+1,p=o.length;d<p;d++)if(Vi(m.bbox,o[d].bbox)===null)return[]}for(var w=new fo(Ut.compare),O=0,z=o.length;O<z;O++)for(var v=o[O].getSweepEvents(),b=0,E=v.length;b<E;b++)if(w.insert(v[b]),w.size>el)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new tc(w),x=w.size,j=w.pop();j;){var A=j.key;if(w.size===x){var Y=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(Y.id," ")+"[".concat(Y.leftSE.point.x,", ").concat(Y.leftSE.point.y,"] -> ")+"[".concat(Y.rightSE.point.x,", ").concat(Y.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(w.size>el)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>nc)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var te=M.process(A),N=0,Z=te.length;N<Z;N++){var B=te[N];B.consumedBy===void 0&&w.insert(B)}x=w.size,j=w.pop()}fr.reset();var $=$f.factory(M.segments),Q=new ec($);return Q.getGeom()}}]),n}(),Pt=new rc,ic=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Pt.run("union",e,r)},oc=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Pt.run("intersection",e,r)},ac=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Pt.run("xor",e,r)},lc=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Pt.run("difference",e,r)},Vr={union:ic,intersection:oc,xor:ac,difference:lc};function sc(n,e){var t=fc(e),r=null;return n.type==="FeatureCollection"?r=uc(n):r=kl(Vr.union(n.geometry.coordinates)),r.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function uc(n){var e=n.features.length===2?Vr.union(n.features[0].geometry.coordinates,n.features[1].geometry.coordinates):Vr.union.apply(Vr,n.features.map(function(t){return t.geometry.coordinates}));return kl(e)}function kl(n){return lo(n)}function fc(n){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=n&&n.geometry.coordinates||e;return li(t)}const cc={"line-cap":"round","line-join":"round"},Ml=["==","$type","Polygon"],Tl=["==","$type","LineString"],Cl=["==","$type","Point"];function Yi(n,e,t=1){return{type:"line",layout:cc,paint:{"line-color":n,"line-width":e,"line-opacity":t}}}function xl(n,e){return{type:"fill",paint:{"fill-color":n,"fill-opacity":e}}}function co(n,e,t=1){return{type:"circle",paint:{"circle-radius":e,"circle-color":n,"circle-opacity":t}}}function ui(n,e,t){if(n.getSource(e)){let r=[];for(let i of n.getStyle().layers)i.source==e&&r.push(i.id);for(let i of r)n.removeLayer(i);n.removeSource(e)}n.addSource(e,t)}function Zt(n,e,t=null){n.getLayer(e.id)&&n.removeLayer(e.id),t&&!n.getLayer(t)&&(t=null),n.addLayer(e,t)}function dc(n,e,t){let r;Je(n,At,l=>t(1,r=l));let{boundaryGeojson:i}=e;return ii("setCamera")&&r.fitBounds(no(i),{padding:20,animate:!1}),ui(r,"boundary",{type:"geojson",data:sc(i)}),Zt(r,{id:"boundary",source:"boundary",...xl("black",.5)}),n.$$set=l=>{"boundaryGeojson"in l&&t(0,i=l.boundaryGeojson)},[i]}class hc extends xe{constructor(e){super(),Oe(this,e,dc,null,Ie,{boundaryGeojson:0})}}function pc(n){let e,t,r,i,o,l,s,f;return e=new zr({props:{labelText:"Area",value:"area"}}),r=new zr({props:{labelText:"Route",value:"route"}}),o=new zr({props:{labelText:"Crossing",value:"crossing"}}),s=new zr({props:{labelText:"Other",value:"other"}}),{c(){he(e.$$.fragment),t=J(),he(r.$$.fragment),i=J(),he(o.$$.fragment),l=J(),he(s.$$.fragment)},m(c,g){pe(e,c,g),R(c,t,g),pe(r,c,g),R(c,i,g),pe(o,c,g),R(c,l,g),pe(s,c,g),f=!0},p:Ce,i(c){f||(V(e.$$.fragment,c),V(r.$$.fragment,c),V(o.$$.fragment,c),V(s.$$.fragment,c),f=!0)},o(c){W(e.$$.fragment,c),W(r.$$.fragment,c),W(o.$$.fragment,c),W(s.$$.fragment,c),f=!1},d(c){ge(e,c),c&&F(t),ge(r,c),c&&F(i),ge(o,c),c&&F(l),ge(s,c)}}}function tl(n){let e,t,r=nl(n[3])+"",i,o,l;return{c(){e=U("p"),t=me("Length: "),i=me(r),o=J(),l=U("br")},m(s,f){R(s,e,f),P(e,t),P(e,i),R(s,o,f),R(s,l,f)},p(s,f){f&8&&r!==(r=nl(s[3])+"")&&Ue(i,r)},d(s){s&&F(e),s&&F(o),s&&F(l)}}}function gc(n){let e,t,r,i,o,l,s,f,c,g,_,m,d,p,w,O,z,v,b,E,M,x,j;function A(Q){n[7](Q)}let Y={labelText:"Name"};n[0]!==void 0&&(Y.value=n[0]),e=new lf({props:Y}),je.push(()=>kt(e,"value",A,n[0]));function te(Q){n[8](Q)}let N={$$slots:{default:[pc]},$$scope:{ctx:n}};n[1]!==void 0&&(N.selected=n[1]),l=new Ju({props:N}),je.push(()=>kt(l,"selected",te,n[1]));function Z(Q){n[9](Q)}let B={labelText:"Description"};n[2]!==void 0&&(B.value=n[2]),_=new Qu({props:B}),je.push(()=>kt(_,"value",Z,n[2]));let $=n[3]&&tl(n);return{c(){he(e.$$.fragment),r=J(),i=U("br"),o=J(),he(l.$$.fragment),f=J(),c=U("br"),g=J(),he(_.$$.fragment),d=J(),p=U("br"),w=J(),$&&$.c(),O=J(),z=U("div"),v=U("button"),v.textContent="Delete",b=J(),E=U("button"),E.textContent="Save",X(v,"type","button"),X(E,"type","button"),kn(E,"float","right")},m(Q,se){pe(e,Q,se),R(Q,r,se),R(Q,i,se),R(Q,o,se),pe(l,Q,se),R(Q,f,se),R(Q,c,se),R(Q,g,se),pe(_,Q,se),R(Q,d,se),R(Q,p,se),R(Q,w,se),$&&$.m(Q,se),R(Q,O,se),R(Q,z,se),P(z,v),P(z,b),P(z,E),n[11](z),M=!0,x||(j=[ie(v,"click",n[5]),ie(E,"click",n[10])],x=!0)},p(Q,[se]){const ke={};!t&&se&1&&(t=!0,ke.value=Q[0],Mt(()=>t=!1)),e.$set(ke);const we={};se&4096&&(we.$$scope={dirty:se,ctx:Q}),!s&&se&2&&(s=!0,we.selected=Q[1],Mt(()=>s=!1)),l.$set(we);const Se={};!m&&se&4&&(m=!0,Se.value=Q[2],Mt(()=>m=!1)),_.$set(Se),Q[3]?$?$.p(Q,se):($=tl(Q),$.c(),$.m(O.parentNode,O)):$&&($.d(1),$=null)},i(Q){M||(V(e.$$.fragment,Q),V(l.$$.fragment,Q),V(_.$$.fragment,Q),M=!0)},o(Q){W(e.$$.fragment,Q),W(l.$$.fragment,Q),W(_.$$.fragment,Q),M=!1},d(Q){ge(e,Q),Q&&F(r),Q&&F(i),Q&&F(o),ge(l,Q),Q&&F(f),Q&&F(c),Q&&F(g),ge(_,Q),Q&&F(d),Q&&F(p),Q&&F(w),$&&$.d(Q),Q&&F(O),Q&&F(z),n[11](null),x=!1,gt(j)}}}function nl(n){return n<1e3?Math.round(n)+" m":(n/1e3).toFixed(1)+"km"}function mc(n,e,t){let{id:r}=e,{name:i}=e,{intervention_type:o}=e,{description:l}=e,{length_meters:s}=e,f;ai.subscribe(w=>{r==w&&setTimeout(()=>f==null?void 0:f.scrollIntoView({behavior:"smooth"}),1)});function c(){De.update(w=>(w.features=w.features.filter(O=>O.id!=r),w)),Mn(null)}function g(w){i=w,t(0,i)}function _(w){o=w,t(1,o)}function m(w){l=w,t(2,l)}const d=()=>Mn(null);function p(w){je[w?"unshift":"push"](()=>{f=w,t(4,f)})}return n.$$set=w=>{"id"in w&&t(6,r=w.id),"name"in w&&t(0,i=w.name),"intervention_type"in w&&t(1,o=w.intervention_type),"description"in w&&t(2,l=w.description),"length_meters"in w&&t(3,s=w.length_meters)},[i,o,l,s,f,c,r,g,_,m,d,p]}class vc extends xe{constructor(e){super(),Oe(this,e,mc,gc,Ie,{id:6,name:0,intervention_type:1,description:2,length_meters:3})}}function rl(n,e,t){const r=n.slice();return r[10]=e[t],r[11]=e,r[12]=t,r}function bc(n){let e,t,r,i,o,l;function s(_){n[5](_,n[10])}function f(_){n[6](_,n[10])}function c(_){n[7](_,n[10])}let g={id:n[10].id,length_meters:n[10].properties.length_meters};return n[10].properties.name!==void 0&&(g.name=n[10].properties.name),n[10].properties.intervention_type!==void 0&&(g.intervention_type=n[10].properties.intervention_type),n[10].properties.description!==void 0&&(g.description=n[10].properties.description),e=new vc({props:g}),je.push(()=>kt(e,"name",s,n[10].properties.name)),je.push(()=>kt(e,"intervention_type",f,n[10].properties.intervention_type)),je.push(()=>kt(e,"description",c,n[10].properties.description)),{c(){he(e.$$.fragment),o=J()},m(_,m){pe(e,_,m),R(_,o,m),l=!0},p(_,m){n=_;const d={};m&1&&(d.id=n[10].id),m&1&&(d.length_meters=n[10].properties.length_meters),!t&&m&1&&(t=!0,d.name=n[10].properties.name,Mt(()=>t=!1)),!r&&m&1&&(r=!0,d.intervention_type=n[10].properties.intervention_type,Mt(()=>r=!1)),!i&&m&1&&(i=!0,d.description=n[10].properties.description,Mt(()=>i=!1)),e.$set(d)},i(_){l||(V(e.$$.fragment,_),l=!0)},o(_){W(e.$$.fragment,_),l=!1},d(_){ge(e,_),_&&F(o)}}}function _c(n){let e=n[12]+1+"",t,r,i=Qr(n[10])+"",o;return{c(){t=me(e),r=me(") "),o=me(i)},m(l,s){R(l,t,s),R(l,r,s),R(l,o,s)},p(l,s){s&1&&e!==(e=l[12]+1+"")&&Ue(t,e),s&1&&i!==(i=Qr(l[10])+"")&&Ue(o,i)},d(l){l&&F(t),l&&F(r),l&&F(o)}}}function yc(n){let e,t=n[12]+1+"",r,i,o=Qr(n[10])+"",l;return{c(){e=U("strong"),r=me(t),i=me(") "),l=me(o)},m(s,f){R(s,e,f),P(e,r),P(e,i),P(e,l)},p(s,f){f&1&&t!==(t=s[12]+1+"")&&Ue(r,t),f&1&&o!==(o=Qr(s[10])+"")&&Ue(l,o)},d(s){s&&F(e)}}}function wc(n){let e;function t(o,l){return o[10].id==o[1]?yc:_c}let r=t(n),i=r(n);return{c(){i.c(),e=J()},m(o,l){i.m(o,l),R(o,e,l)},p(o,l){r===(r=t(o))&&i?i.p(o,l):(i.d(1),i=r(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&F(e)}}}function il(n,e){let t,r,i,o;function l(f){e[8](f,e[10])}let s={$$slots:{title:[wc],default:[bc]},$$scope:{ctx:e}};return e[10].properties.editing!==void 0&&(s.open=e[10].properties.editing),r=new yu({props:s}),je.push(()=>kt(r,"open",l,e[10].properties.editing)),r.$on("click",function(){ra(e[3](e[10].id))&&e[3](e[10].id).apply(this,arguments)}),r.$on("mouseenter",function(){ra(e[2](e[10].id))&&e[2](e[10].id).apply(this,arguments)}),r.$on("mouseleave",e[2](null)),{key:n,first:null,c(){t=Kt(),he(r.$$.fragment),this.first=t},m(f,c){R(f,t,c),pe(r,f,c),o=!0},p(f,c){e=f;const g={};c&8195&&(g.$$scope={dirty:c,ctx:e}),!i&&c&1&&(i=!0,g.open=e[10].properties.editing,Mt(()=>i=!1)),r.$set(g)},i(f){o||(V(r.$$.fragment,f),o=!0)},o(f){W(r.$$.fragment,f),o=!1},d(f){f&&F(t),ge(r,f)}}}function Ec(n){let e=[],t=new Map,r,i,o=n[0].features;const l=s=>s[10].id;for(let s=0;s<o.length;s+=1){let f=rl(n,o,s),c=l(f);t.set(c,e[s]=il(c,f))}return{c(){for(let s=0;s<e.length;s+=1)e[s].c();r=Kt()},m(s,f){for(let c=0;c<e.length;c+=1)e[c].m(s,f);R(s,r,f),i=!0},p(s,f){f&15&&(o=s[0].features,it(),e=vl(e,f,l,1,s,o,t,r.parentNode,bl,il,r,rl),ot())},i(s){if(!i){for(let f=0;f<o.length;f+=1)V(e[f]);i=!0}},o(s){for(let f=0;f<e.length;f+=1)W(e[f]);i=!1},d(s){for(let f=0;f<e.length;f+=1)e[f].d(s);s&&F(r)}}}function Sc(n){let e,t,r,i;return e=new pu({props:{$$slots:{default:[Ec]},$$scope:{ctx:n}}}),{c(){he(e.$$.fragment)},m(o,l){pe(e,o,l),t=!0,r||(i=ie(window,"keydown",n[4]),r=!0)},p(o,[l]){const s={};l&8195&&(s.$$scope={dirty:l,ctx:o}),e.$set(s)},i(o){t||(V(e.$$.fragment,o),t=!0)},o(o){W(e.$$.fragment,o),t=!1},d(o){ge(e,o),r=!1,i()}}}function Qr(n){if(n.properties.name)return n.properties.name;var e=n.properties.intervention_type;return e=="other"&&(n.geometry.type=="Point"?e="point":n.geometry.type=="LineString"?e="line":e="polygon"),`Untitled ${e}`}function kc(n,e,t){let r,i,o;Je(n,ai,d=>t(9,r=d)),Je(n,De,d=>t(0,i=d)),Je(n,Lt,d=>t(1,o=d));function l(d){r==null&&Lt.set(d)}function s(d){console.log(`Clicked ${d} from the sidebar; going to edit-attribute`),Di.set(null),Di.set(d);for(let p of i.features)p.properties.editing&&p.id!=d&&delete p.properties.editing;Lt.set(d)}function f(d){const p=r;if(d.key=="Delete"){const w=d.originalTarget.tagName;if(w!="CANVAS"&&w!="BODY")return;d.preventDefault(),De.update(O=>(O.features=O.features.filter(z=>z.id!=p),O))}}function c(d,p){n.$$.not_equal(p.properties.name,d)&&(p.properties.name=d,De.set(i))}function g(d,p){n.$$.not_equal(p.properties.intervention_type,d)&&(p.properties.intervention_type=d,De.set(i))}function _(d,p){n.$$.not_equal(p.properties.description,d)&&(p.properties.description=d,De.set(i))}function m(d,p){n.$$.not_equal(p.properties.editing,d)&&(p.properties.editing=d,De.set(i))}return[i,o,l,s,f,c,g,_,m]}class Mc extends xe{constructor(e){super(),Oe(this,e,kc,Sc,Ie,{})}}function fn(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function zt(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ji(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function ln(n,e,t){t===void 0&&(t={});var r=fn(n),i=fn(e),o=St(i[1]-r[1]),l=St(i[0]-r[0]),s=St(r[1]),f=St(i[1]),c=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(s)*Math.cos(f);return so(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),t.units)}function Cn(n,e,t){if(n!==null)for(var r,i,o,l,s,f,c,g=0,_=0,m,d=n.type,p=d==="FeatureCollection",w=d==="Feature",O=p?n.features.length:1,z=0;z<O;z++){c=p?n.features[z].geometry:w?n.geometry:n,m=c?c.type==="GeometryCollection":!1,s=m?c.geometries.length:1;for(var v=0;v<s;v++){var b=0,E=0;if(l=m?c.geometries[v]:c,l!==null){f=l.coordinates;var M=l.type;switch(g=t&&(M==="Polygon"||M==="MultiPolygon")?1:0,M){case null:break;case"Point":if(e(f,_,z,b,E)===!1)return!1;_++,b++;break;case"LineString":case"MultiPoint":for(r=0;r<f.length;r++){if(e(f[r],_,z,b,E)===!1)return!1;_++,M==="MultiPoint"&&b++}M==="LineString"&&b++;break;case"Polygon":case"MultiLineString":for(r=0;r<f.length;r++){for(i=0;i<f[r].length-g;i++){if(e(f[r][i],_,z,b,E)===!1)return!1;_++}M==="MultiLineString"&&b++,M==="Polygon"&&E++}M==="Polygon"&&b++;break;case"MultiPolygon":for(r=0;r<f.length;r++){for(E=0,i=0;i<f[r].length;i++){for(o=0;o<f[r][i].length-g;o++){if(e(f[r][i][o],_,z,b,E)===!1)return!1;_++}E++}b++}break;case"GeometryCollection":for(r=0;r<l.geometries.length;r++)if(Cn(l.geometries[r],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Tc(n,e,t,r){var i=t;return Cn(n,function(o,l,s,f,c){l===0&&t===void 0?i=o:i=e(i,o,l,s,f,c)},r),i}function Ol(n,e){var t;switch(n.type){case"FeatureCollection":for(t=0;t<n.features.length&&e(n.features[t].properties,t)!==!1;t++);break;case"Feature":e(n.properties,0);break}}function Cc(n,e,t){var r=t;return Ol(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}function Vn(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}function Il(n,e,t){var r=t;return Vn(n,function(i,o){o===0&&t===void 0?r=i:r=e(r,i,o)}),r}function xc(n){var e=[];return Cn(n,function(t){e.push(t)}),e}function ho(n,e){var t,r,i,o,l,s,f,c,g,_,m=0,d=n.type==="FeatureCollection",p=n.type==="Feature",w=d?n.features.length:1;for(t=0;t<w;t++){for(s=d?n.features[t].geometry:p?n.geometry:n,c=d?n.features[t].properties:p?n.properties:{},g=d?n.features[t].bbox:p?n.bbox:void 0,_=d?n.features[t].id:p?n.id:void 0,f=s?s.type==="GeometryCollection":!1,l=f?s.geometries.length:1,i=0;i<l;i++){if(o=f?s.geometries[i]:s,o===null){if(e(null,m,c,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,m,c,g,_)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],m,c,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}m++}}function Oc(n,e,t){var r=t;return ho(n,function(i,o,l,s,f){o===0&&t===void 0?r=i:r=e(r,i,o,l,s,f)}),r}function xn(n,e){ho(n,function(t,r,i,o,l){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Ct(t,i,{bbox:o,id:l}),r,0)===!1?!1:void 0}var f;switch(s){case"MultiPoint":f="Point";break;case"MultiLineString":f="LineString";break;case"MultiPolygon":f="Polygon";break}for(var c=0;c<t.coordinates.length;c++){var g=t.coordinates[c],_={type:f,coordinates:g};if(e(Ct(_,i),r,c)===!1)return!1}})}function Ic(n,e,t){var r=t;return xn(n,function(i,o,l){o===0&&l===0&&t===void 0?r=i:r=e(r,i,o,l)}),r}function Ll(n,e){xn(n,function(t,r,i){var o=0;if(t.geometry){var l=t.geometry.type;if(!(l==="Point"||l==="MultiPoint")){var s,f=0,c=0,g=0;if(Cn(t,function(_,m,d,p,w){if(s===void 0||r>f||p>c||w>g){s=_,f=r,c=p,g=w,o=0;return}var O=dt([s,_],t.properties);if(e(O,r,i,w,o)===!1)return!1;o++,s=_})===!1)return!1}}})}function Pl(n,e,t){var r=t,i=!1;return Ll(n,function(o,l,s,f,c){i===!1&&t===void 0?r=o:r=e(r,o,l,s,f,c),i=!0}),r}function Al(n,e){if(!n)throw new Error("geojson is required");xn(n,function(t,r,i){if(t.geometry!==null){var o=t.geometry.type,l=t.geometry.coordinates;switch(o){case"LineString":if(e(t,r,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<l.length;s++)if(e(dt(l[s],t.properties),r,i,s)===!1)return!1;break}}})}function Lc(n,e,t){var r=t;return Al(n,function(i,o,l,s){o===0&&t===void 0?r=i:r=e(r,i,o,l,s)}),r}function Pc(n,e){if(e=e||{},!uo(e))throw new Error("options is invalid");var t=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,l=e.properties,s;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),l=l||n.features[t].properties,s=n.features[t].geometry;break;case"Feature":l=l||n.properties,s=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=n;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var f=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=f.length+o-1),dt([f[o],f[o+1]],l,e);case"Polygon":return i<0&&(i=f.length+i),o<0&&(o=f[i].length+o-1),dt([f[i][o],f[i][o+1]],l,e);case"MultiLineString":return r<0&&(r=f.length+r),o<0&&(o=f[r].length+o-1),dt([f[r][o],f[r][o+1]],l,e);case"MultiPolygon":return r<0&&(r=f.length+r),i<0&&(i=f[r].length+i),o<0&&(o=f[r][i].length-o-1),dt([f[r][i][o],f[r][i][o+1]],l,e)}throw new Error("geojson is invalid")}function Ac(n,e){if(e=e||{},!uo(e))throw new Error("options is invalid");var t=e.featureIndex||0,r=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,l=e.properties,s;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),l=l||n.features[t].properties,s=n.features[t].geometry;break;case"Feature":l=l||n.properties,s=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=n;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var f=s.coordinates;switch(s.type){case"Point":return ft(f,l,e);case"MultiPoint":return r<0&&(r=f.length+r),ft(f[r],l,e);case"LineString":return o<0&&(o=f.length+o),ft(f[o],l,e);case"Polygon":return i<0&&(i=f.length+i),o<0&&(o=f[i].length+o),ft(f[i][o],l,e);case"MultiLineString":return r<0&&(r=f.length+r),o<0&&(o=f[r].length+o),ft(f[r][o],l,e);case"MultiPolygon":return r<0&&(r=f.length+r),i<0&&(i=f[r].length+i),o<0&&(o=f[r][i].length-o),ft(f[r][i][o],l,e)}throw new Error("geojson is invalid")}const Nc=Object.freeze(Object.defineProperty({__proto__:null,coordAll:xc,coordEach:Cn,coordReduce:Tc,featureEach:Vn,featureReduce:Il,findPoint:Ac,findSegment:Pc,flattenEach:xn,flattenReduce:Ic,geomEach:ho,geomReduce:Oc,lineEach:Al,lineReduce:Lc,propEach:Ol,propReduce:Cc,segmentEach:Ll,segmentReduce:Pl},Symbol.toStringTag,{value:"Module"}));function qr(n,e){return e===void 0&&(e={}),Pl(n,function(t,r){var i=r.geometry.coordinates;return t+ln(i[0],i[1],e)},0)}function Rc(n){let e,t,r,i,o,l,s,f,c,g,_,m,d,p,w,O,z,v,b,E=n[0].features.length+"",M,x,j,A,Y,te,N,Z;return{c(){e=U("div"),t=U("label"),r=me(`Scheme name:
    `),i=U("input"),o=J(),l=U("br"),s=J(),f=U("div"),c=U("label"),g=U("input"),_=J(),m=U("button"),m.textContent="Load from GeoJSON",d=J(),p=U("button"),p.textContent="Export to GeoJSON",w=J(),O=U("br"),z=J(),v=U("div"),b=U("span"),M=me(E),x=me(" interventions"),j=J(),A=U("button"),Y=me("Clear all"),X(i,"type","text"),X(g,"type","file"),X(g,"id","load_geojson"),X(g,"class","svelte-lhyd1e"),X(m,"type","button"),X(m,"onclick","document.getElementById('load_geojson').click();"),X(p,"type","button"),X(p,"class","align-right svelte-lhyd1e"),X(A,"type","button"),X(A,"class","align-right svelte-lhyd1e"),A.disabled=te=n[0].features.length==0},m(B,$){R(B,e,$),P(e,t),P(t,r),P(t,i),jn(i,n[0].scheme_name),R(B,o,$),R(B,l,$),R(B,s,$),R(B,f,$),P(f,c),P(c,g),P(c,_),P(c,m),P(f,d),P(f,p),R(B,w,$),R(B,O,$),R(B,z,$),R(B,v,$),P(v,b),P(b,M),P(b,x),P(v,j),P(v,A),P(A,Y),N||(Z=[ie(i,"input",n[5]),ie(g,"change",n[3]),ie(p,"click",n[2]),ie(A,"click",n[1])],N=!0)},p(B,[$]){$&1&&i.value!==B[0].scheme_name&&jn(i,B[0].scheme_name),$&1&&E!==(E=B[0].features.length+"")&&Ue(M,E),$&1&&te!==(te=B[0].features.length==0)&&(A.disabled=te)},i:Ce,o:Ce,d(B){B&&F(e),B&&F(o),B&&F(l),B&&F(s),B&&F(f),B&&F(w),B&&F(O),B&&F(z),B&&F(v),N=!1,gt(Z)}}}function Fc(n,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",n),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Dc(n,e,t){let r;Je(n,De,m=>t(0,r=m));let{authorityName:i}=e,o=window.localStorage.getItem(i);if(o)try{De.set(g(JSON.parse(o)))}catch(m){console.log(`Failed to load from local storage: ${m}`)}function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&De.update(m=>(delete m.scheme_name,m.features=[],m))}function s(){const m=JSON.parse(JSON.stringify(r));for(let d of m.features)delete d.properties.editing,delete d.properties.hide_while_editing;return m}function f(){let m=s();var d=i;m.authority=i,m.origin="atip-v1",m.scheme_name&&(d+="_"+m.scheme_name),d+=".txt",Fc(d,JSON.stringify(m,null,"  "))}function c(m){const d=new FileReader;d.onload=p=>{try{De.set(g(JSON.parse(p.target.result)))}catch(w){window.alert(`Couldn't load scheme from a file: ${w}`)}},d.readAsText(m.target.files[0])}function g(m){let d=1;for(let p of m.features)p.geometry.type=="LineString"&&!p.properties.length_meters&&(p.properties.length_meters=qr(p.geometry,{units:"kilometers"})*1e3),p.id=d++;return m}function _(){r.scheme_name=this.value,De.set(r)}return n.$$set=m=>{"authorityName"in m&&t(4,i=m.authorityName)},n.$$.update=()=>{n.$$.dirty&17&&r&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(i,JSON.stringify(s())))},[r,l,f,c,i,_]}class Bc extends xe{constructor(e){super(),Oe(this,e,Dc,Rc,Ie,{authorityName:4})}}const Uc="/atip/split_line/assets/zoom_out_map-b2e1091a.svg";function Gc(n){let e,t,r,i,o;return{c(){e=U("button"),t=U("img"),Ys(t.src,r=Uc)||X(t,"src",r),X(t,"alt","Zoom to show entire boundary"),X(e,"type","button"),X(e,"title","Zoom to show entire boundary"),X(e,"class","svelte-qzjsqo")},m(l,s){R(l,e,s),P(e,t),i||(o=ie(e,"click",n[0]),i=!0)},p:Ce,i:Ce,o:Ce,d(l){l&&F(e),i=!1,o()}}}function zc(n,e,t){let r;Je(n,At,l=>t(2,r=l));let{boundaryGeojson:i}=e;function o(){r.fitBounds(no(i),{padding:20,animate:!0,duration:500})}return n.$$set=l=>{"boundaryGeojson"in l&&t(1,i=l.boundaryGeojson)},[o,i]}class jc extends xe{constructor(e){super(),Oe(this,e,zc,Gc,Ie,{boundaryGeojson:1})}}function Vc(n){let e,t,r,i,o,l,s;return{c(){e=U("div"),t=me(`Basemap:
  `),r=U("select"),i=U("option"),i.textContent="Streets",o=U("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,n[0]===void 0&&Js(()=>n[2].call(r)),X(e,"class","svelte-1tbnm6i")},m(f,c){R(f,e,c),P(e,t),P(e,r),P(r,i),P(r,o),ia(r,n[0]),l||(s=[ie(r,"change",n[2]),ie(r,"change",n[1])],l=!0)},p(f,[c]){c&1&&ia(r,f[0])},i:Ce,o:Ce,d(f){f&&F(e),l=!1,gt(s)}}}function qc(n,e,t){let{style:r}=e;function i(){let l=new URLSearchParams(window.location.search);l.set("style",r);let s=`${window.location.pathname}?${l.toString()}${window.location.hash}`;window.location.href=s}function o(){r=Xs(this),t(0,r)}return n.$$set=l=>{"style"in l&&t(0,r=l.style)},[r,i,o]}class Yc extends xe{constructor(e){super(),Oe(this,e,qc,Vc,Ie,{style:0})}}const Et={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",hovering:"black",lineEndpointColor:"black"},Nl=10,$r=10;function Jc(n){let e,t,r,i,o,l,s,f,c,g,_,m,d,p,w,O,z,v,b;return{c(){e=U("div"),t=U("h1"),t.textContent="Interventions",r=J(),i=U("ul"),o=U("li"),l=U("span"),s=me("Areas"),f=J(),c=U("li"),g=U("span"),_=me("Routes"),m=J(),d=U("li"),p=U("span"),w=me("Crossings"),O=J(),z=U("li"),v=U("span"),b=me("Other"),X(t,"class","svelte-p551i1"),X(l,"class","svelte-p551i1"),kn(l,"background",Et.area),X(g,"class","svelte-p551i1"),kn(g,"background",Et.route),X(p,"class","svelte-p551i1"),kn(p,"background",Et.crossing),X(v,"class","svelte-p551i1"),kn(v,"background",Et.other),X(e,"class","svelte-p551i1")},m(E,M){R(E,e,M),P(e,t),P(e,r),P(e,i),P(i,o),P(o,l),P(o,s),P(i,f),P(i,c),P(c,g),P(c,_),P(i,m),P(i,d),P(d,p),P(d,w),P(i,O),P(i,z),P(z,v),P(z,b)},p:Ce,i:Ce,o:Ce,d(E){E&&F(e)}}}class Xc extends xe{constructor(e){super(),Oe(this,e,null,Jc,Ie,{})}}let Fn="interventions";function Wc(n,e,t){let r,i;Je(n,At,f=>t(0,r=f)),Je(n,De,f=>t(1,i=f)),ui(r,Fn,{type:"geojson",data:i});const o=["match",["get","intervention_type"],"area",Et.area,"route",Et.route,"crossing",Et.crossing,"other",Et.other,"white"],l=["!=","hide_while_editing",!0];return Zt(r,{id:"interventions-points",source:Fn,filter:["all",Cl,l,["!=","endpoint",!0]],...co(o,Nl)}),Zt(r,{id:"interventions-lines",source:Fn,filter:["all",Tl,l],...Yi(o,$r)},"route-lines"),Zt(r,{id:"interventions-lines-endpoints",source:Fn,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*$r,"circle-opacity":0,"circle-stroke-color":Et.lineEndpointColor,"circle-stroke-width":2}}),Zt(r,{id:"interventions-polygons",source:Fn,filter:["all",Ml,l],...xl(o,.5)},"hover-polygons"),n.$$.update=()=>{if(n.$$.dirty&3){let f=JSON.parse(JSON.stringify(i)),c=[];for(let g of f.features)if(g.geometry.type=="LineString")for(let _ of[g.geometry.coordinates[0],g.geometry.coordinates[g.geometry.coordinates.length-1]])c.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:_}});f.features=f.features.concat(c),r.getSource(Fn).setData(f)}},[r,i]}class Hc extends xe{constructor(e){super(),Oe(this,e,Wc,null,Ie,{})}}let Dn="hover";function Zc(n,e,t){let r,i;return Je(n,At,o=>t(0,r=o)),Je(n,De,o=>t(1,i=o)),ui(r,Dn,{type:"geojson",data:sr()}),Zt(r,{id:"hover-polygons",source:Dn,filter:Ml,...Yi(Et.hovering,.5*$r,1)}),Zt(r,{id:"hover-lines",source:Dn,filter:Tl,...Yi(Et.hovering,1.5*$r,1)},"interventions-lines"),Zt(r,{id:"hover-points",source:Dn,filter:Cl,...co(Et.hovering,1.5*Nl,1)},"interventions-points"),Lt.subscribe(o=>{o!=null?r.getSource(Dn).setData(i.features.find(l=>l.id==o)):r.getSource(Dn).setData(sr())}),[]}class Kc extends xe{constructor(e){super(),Oe(this,e,Zc,null,Ie,{})}}var Xi={},Qc={get exports(){return Xi},set exports(n){Xi=n}};(function(n,e){(function(t,r){n.exports=r()})(Un,function(){var t=function(a,u){var h={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},y={on:function(k,T,q){if(h[k]===void 0)throw new Error("Invalid event type: "+k);h[k].push({selector:T,fn:q})},render:function(k){u.store.featureChanged(k)}},S=function(k,T){for(var q=h[k],H=q.length;H--;){var re=q[H];if(re.selector(T)){re.fn.call(y,T)||u.store.render(),u.ui.updateMapClasses();break}}};return a.start.call(y),{render:a.render,stop:function(){a.stop&&a.stop()},trash:function(){a.trash&&(a.trash(),u.store.render())},combineFeatures:function(){a.combineFeatures&&a.combineFeatures()},uncombineFeatures:function(){a.uncombineFeatures&&a.uncombineFeatures()},drag:function(k){S("drag",k)},click:function(k){S("click",k)},mousemove:function(k){S("mousemove",k)},mousedown:function(k){S("mousedown",k)},mouseup:function(k){S("mouseup",k)},mouseout:function(k){S("mouseout",k)},keydown:function(k){S("keydown",k)},keyup:function(k){S("keyup",k)},touchstart:function(k){S("touchstart",k)},touchmove:function(k){S("touchmove",k)},touchend:function(k){S("touchend",k)},tap:function(k){S("tap",k)}}};function r(a){if(a.__esModule)return a;var u=a.default;if(typeof u=="function"){var h=function y(){if(this instanceof y){var S=[null];S.push.apply(S,arguments);var k=Function.bind.apply(u,S);return new k}return u.apply(this,arguments)};h.prototype=u.prototype}else h={};return Object.defineProperty(h,"__esModule",{value:!0}),Object.keys(a).forEach(function(y){var S=Object.getOwnPropertyDescriptor(a,y);Object.defineProperty(h,y,S.get?S:{enumerable:!0,get:function(){return a[y]}})}),h}var i={},o={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},l=o;function s(a){var u=0;if(a&&a.length>0){u+=Math.abs(f(a[0]));for(var h=1;h<a.length;h++)u-=Math.abs(f(a[h]))}return u}function f(a){var u,h,y,S,k,T,q=0,H=a.length;if(H>2){for(T=0;T<H;T++)T===H-2?(y=H-2,S=H-1,k=0):T===H-1?(y=H-1,S=0,k=1):(y=T,S=T+1,k=T+2),u=a[y],h=a[S],q+=(c(a[k][0])-c(u[0]))*Math.sin(c(h[1]));q=q*l.RADIUS*l.RADIUS/2}return q}function c(a){return a*Math.PI/180}i.geometry=function a(u){var h,y=0;switch(u.type){case"Polygon":return s(u.coordinates);case"MultiPolygon":for(h=0;h<u.coordinates.length;h++)y+=s(u.coordinates[h]);return y;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(h=0;h<u.geometries.length;h++)y+=a(u.geometries[h]);return y}},i.ring=f;var g={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},_={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},m={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},d={POLYGON:"polygon",LINE:"line_string",POINT:"point"},p={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},w={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},O={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},z={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},v={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},b={ACTIVE:"true",INACTIVE:"false"},E=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],M=-85,x=Object.freeze({__proto__:null,classes:g,sources:_,cursors:m,types:d,geojsonTypes:p,modes:w,events:O,updateActions:z,meta:v,activeStates:b,interactions:E,LAT_MIN:-90,LAT_RENDERED_MIN:M,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),j={Point:0,LineString:1,MultiLineString:1,Polygon:2};function A(a,u){var h=j[a.geometry.type]-j[u.geometry.type];return h===0&&a.geometry.type===p.POLYGON?a.area-u.area:h}function Y(a){return a.map(function(u){return u.geometry.type===p.POLYGON&&(u.area=i.geometry({type:p.FEATURE,property:{},geometry:u.geometry})),u}).sort(A).map(function(u){return delete u.area,u})}function te(a,u){return u===void 0&&(u=0),[[a.point.x-u,a.point.y-u],[a.point.x+u,a.point.y+u]]}function N(a){if(this._items={},this._nums={},this._length=a?a.length:0,a)for(var u=0,h=a.length;u<h;u++)this.add(a[u]),a[u]!==void 0&&(typeof a[u]=="string"?this._items[a[u]]=u:this._nums[a[u]]=u)}N.prototype.add=function(a){return this.has(a)||(this._length++,typeof a=="string"?this._items[a]=this._length:this._nums[a]=this._length),this},N.prototype.delete=function(a){return this.has(a)===!1||(this._length--,delete this._items[a],delete this._nums[a]),this},N.prototype.has=function(a){return(typeof a=="string"||typeof a=="number")&&(this._items[a]!==void 0||this._nums[a]!==void 0)},N.prototype.values=function(){var a=this,u=[];return Object.keys(this._items).forEach(function(h){u.push({k:h,v:a._items[h]})}),Object.keys(this._nums).forEach(function(h){u.push({k:JSON.parse(h),v:a._nums[h]})}),u.sort(function(h,y){return h.v-y.v}).map(function(h){return h.k})},N.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Z=[v.FEATURE,v.MIDPOINT,v.VERTEX],B={click:function(a,u,h){return $(a,u,h,h.options.clickBuffer)},touch:function(a,u,h){return $(a,u,h,h.options.touchBuffer)}};function $(a,u,h,y){if(h.map===null)return[];var S=a?te(a,y):u,k={};h.options.styles&&(k.layers=h.options.styles.map(function(re){return re.id}));var T=h.map.queryRenderedFeatures(S,k).filter(function(re){return Z.indexOf(re.properties.meta)!==-1}),q=new N,H=[];return T.forEach(function(re){var ne=re.properties.id;q.has(ne)||(q.add(ne),H.push(re))}),Y(H)}function Q(a,u){var h=B.click(a,null,u),y={mouse:m.NONE};return h[0]&&(y.mouse=h[0].properties.active===b.ACTIVE?m.MOVE:m.POINTER,y.feature=h[0].properties.meta),u.events.currentModeName().indexOf("draw")!==-1&&(y.mouse=m.ADD),u.ui.queueMapClasses(y),u.ui.updateMapClasses(),h[0]}function se(a,u){var h=a.x-u.x,y=a.y-u.y;return Math.sqrt(h*h+y*y)}function ke(a,u,h){h===void 0&&(h={});var y=h.fineTolerance!=null?h.fineTolerance:4,S=h.grossTolerance!=null?h.grossTolerance:12,k=h.interval!=null?h.interval:500;a.point=a.point||u.point,a.time=a.time||u.time;var T=se(a.point,u.point);return T<y||T<S&&u.time-a.time<k}function we(a,u,h){h===void 0&&(h={});var y=h.tolerance!=null?h.tolerance:25,S=h.interval!=null?h.interval:250;return a.point=a.point||u.point,a.time=a.time||u.time,se(a.point,u.point)<y&&u.time-a.time<S}var Se={},Le={get exports(){return Se},set exports(a){Se=a}}.exports=function(a,u){if(u||(u=16),a===void 0&&(a=128),a<=0)return"0";for(var h=Math.log(Math.pow(2,a))/Math.log(u),y=2;h===1/0;y*=2)h=Math.log(Math.pow(2,a/y))/Math.log(u)*y;var S=h-Math.floor(h),k="";for(y=0;y<Math.floor(h);y++)k=Math.floor(Math.random()*u).toString(u)+k;if(S){var T=Math.pow(u,S);k=Math.floor(Math.random()*T).toString(u)+k}var q=parseInt(k,u);return q!==1/0&&q>=Math.pow(2,a)?Le(a,u):k};Le.rack=function(a,u,h){var y=function(k){var T=0;do{if(T++>10){if(!h)throw new Error("too many ID collisions, use more bits");a+=h}var q=Le(a,u)}while(Object.hasOwnProperty.call(S,q));return S[q]=k,q},S=y.hats={};return y.get=function(k){return y.hats[k]},y.set=function(k,T){return y.hats[k]=T,y},y.bits=a||128,y.base=u||16,y};var ve=function(a,u){this.ctx=a,this.properties=u.properties||{},this.coordinates=u.geometry.coordinates,this.id=u.id||Se(),this.type=u.geometry.type};ve.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},ve.prototype.incomingCoords=function(a){this.setCoordinates(a)},ve.prototype.setCoordinates=function(a){this.coordinates=a,this.changed()},ve.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},ve.prototype.setProperty=function(a,u){this.properties[a]=u},ve.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:p.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},ve.prototype.internal=function(a){var u={id:this.id,meta:v.FEATURE,"meta:type":this.type,active:b.INACTIVE,mode:a};if(this.ctx.options.userProperties)for(var h in this.properties)u["user_"+h]=this.properties[h];return{type:p.FEATURE,properties:u,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var I=function(a,u){ve.call(this,a,u)};(I.prototype=Object.create(ve.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},I.prototype.updateCoordinate=function(a,u,h){this.coordinates=arguments.length===3?[u,h]:[a,u],this.changed()},I.prototype.getCoordinate=function(){return this.getCoordinates()};var ce=function(a,u){ve.call(this,a,u)};(ce.prototype=Object.create(ve.prototype)).isValid=function(){return this.coordinates.length>1},ce.prototype.addCoordinate=function(a,u,h){this.changed();var y=parseInt(a,10);this.coordinates.splice(y,0,[u,h])},ce.prototype.getCoordinate=function(a){var u=parseInt(a,10);return JSON.parse(JSON.stringify(this.coordinates[u]))},ce.prototype.removeCoordinate=function(a){this.changed(),this.coordinates.splice(parseInt(a,10),1)},ce.prototype.updateCoordinate=function(a,u,h){var y=parseInt(a,10);this.coordinates[y]=[u,h],this.changed()};var Ve=function(a,u){ve.call(this,a,u),this.coordinates=this.coordinates.map(function(h){return h.slice(0,-1)})};(Ve.prototype=Object.create(ve.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(a){return a.length>2})},Ve.prototype.incomingCoords=function(a){this.coordinates=a.map(function(u){return u.slice(0,-1)}),this.changed()},Ve.prototype.setCoordinates=function(a){this.coordinates=a,this.changed()},Ve.prototype.addCoordinate=function(a,u,h){this.changed();var y=a.split(".").map(function(S){return parseInt(S,10)});this.coordinates[y[0]].splice(y[1],0,[u,h])},Ve.prototype.removeCoordinate=function(a){this.changed();var u=a.split(".").map(function(y){return parseInt(y,10)}),h=this.coordinates[u[0]];h&&(h.splice(u[1],1),h.length<3&&this.coordinates.splice(u[0],1))},Ve.prototype.getCoordinate=function(a){var u=a.split(".").map(function(y){return parseInt(y,10)}),h=this.coordinates[u[0]];return JSON.parse(JSON.stringify(h[u[1]]))},Ve.prototype.getCoordinates=function(){return this.coordinates.map(function(a){return a.concat([a[0]])})},Ve.prototype.updateCoordinate=function(a,u,h){this.changed();var y=a.split("."),S=parseInt(y[0],10),k=parseInt(y[1],10);this.coordinates[S]===void 0&&(this.coordinates[S]=[]),this.coordinates[S][k]=[u,h]};var hn={MultiPoint:I,MultiLineString:ce,MultiPolygon:Ve},jt=function(a,u,h,y,S){var k=h.split("."),T=parseInt(k[0],10),q=k[1]?k.slice(1).join("."):null;return a[T][u](q,y,S)},et=function(a,u){if(ve.call(this,a,u),delete this.coordinates,this.model=hn[u.geometry.type],this.model===void 0)throw new TypeError(u.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(u.geometry.coordinates)};function le(a){this.map=a.map,this.drawConfig=JSON.parse(JSON.stringify(a.options||{})),this._ctx=a}(et.prototype=Object.create(ve.prototype))._coordinatesToFeatures=function(a){var u=this,h=this.model.bind(this);return a.map(function(y){return new h(u.ctx,{id:Se(),type:p.FEATURE,properties:{},geometry:{coordinates:y,type:u.type.replace("Multi","")}})})},et.prototype.isValid=function(){return this.features.every(function(a){return a.isValid()})},et.prototype.setCoordinates=function(a){this.features=this._coordinatesToFeatures(a),this.changed()},et.prototype.getCoordinate=function(a){return jt(this.features,"getCoordinate",a)},et.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(a){return a.type===p.POLYGON?a.getCoordinates():a.coordinates})))},et.prototype.updateCoordinate=function(a,u,h){jt(this.features,"updateCoordinate",a,u,h),this.changed()},et.prototype.addCoordinate=function(a,u,h){jt(this.features,"addCoordinate",a,u,h),this.changed()},et.prototype.removeCoordinate=function(a){jt(this.features,"removeCoordinate",a),this.changed()},et.prototype.getFeatures=function(){return this.features},le.prototype.setSelected=function(a){return this._ctx.store.setSelected(a)},le.prototype.setSelectedCoordinates=function(a){var u=this;this._ctx.store.setSelectedCoordinates(a),a.reduce(function(h,y){return h[y.feature_id]===void 0&&(h[y.feature_id]=!0,u._ctx.store.get(y.feature_id).changed()),h},{})},le.prototype.getSelected=function(){return this._ctx.store.getSelected()},le.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},le.prototype.isSelected=function(a){return this._ctx.store.isSelected(a)},le.prototype.getFeature=function(a){return this._ctx.store.get(a)},le.prototype.select=function(a){return this._ctx.store.select(a)},le.prototype.deselect=function(a){return this._ctx.store.deselect(a)},le.prototype.deleteFeature=function(a,u){return u===void 0&&(u={}),this._ctx.store.delete(a,u)},le.prototype.addFeature=function(a){return this._ctx.store.add(a)},le.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},le.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},le.prototype.setActionableState=function(a){a===void 0&&(a={});var u={trash:a.trash||!1,combineFeatures:a.combineFeatures||!1,uncombineFeatures:a.uncombineFeatures||!1};return this._ctx.events.actionable(u)},le.prototype.changeMode=function(a,u,h){return u===void 0&&(u={}),h===void 0&&(h={}),this._ctx.events.changeMode(a,u,h)},le.prototype.updateUIClasses=function(a){return this._ctx.ui.queueMapClasses(a)},le.prototype.activateUIButton=function(a){return this._ctx.ui.setActiveButton(a)},le.prototype.featuresAt=function(a,u,h){if(h===void 0&&(h="click"),h!=="click"&&h!=="touch")throw new Error("invalid buffer type");return B[h](a,u,this._ctx)},le.prototype.newFeature=function(a){var u=a.geometry.type;return u===p.POINT?new I(this._ctx,a):u===p.LINE_STRING?new ce(this._ctx,a):u===p.POLYGON?new Ve(this._ctx,a):new et(this._ctx,a)},le.prototype.isInstanceOf=function(a,u){if(a===p.POINT)return u instanceof I;if(a===p.LINE_STRING)return u instanceof ce;if(a===p.POLYGON)return u instanceof Ve;if(a==="MultiFeature")return u instanceof et;throw new Error("Unknown feature class: "+a)},le.prototype.doRender=function(a){return this._ctx.store.featureChanged(a)},le.prototype.onSetup=function(){},le.prototype.onDrag=function(){},le.prototype.onClick=function(){},le.prototype.onMouseMove=function(){},le.prototype.onMouseDown=function(){},le.prototype.onMouseUp=function(){},le.prototype.onMouseOut=function(){},le.prototype.onKeyUp=function(){},le.prototype.onKeyDown=function(){},le.prototype.onTouchStart=function(){},le.prototype.onTouchMove=function(){},le.prototype.onTouchEnd=function(){},le.prototype.onTap=function(){},le.prototype.onStop=function(){},le.prototype.onTrash=function(){},le.prototype.onCombineFeature=function(){},le.prototype.onUncombineFeature=function(){},le.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var oe={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},fi=Object.keys(oe);function ci(a){var u=Object.keys(a);return function(h,y){y===void 0&&(y={});var S={},k=u.reduce(function(T,q){return T[q]=a[q],T},new le(h));return{start:function(){var T=this;S=k.onSetup(y),fi.forEach(function(q){var H,re=oe[q],ne=function(){return!1};a[re]&&(ne=function(){return!0}),T.on(q,ne,(H=re,function(K){return k[H](S,K)}))})},stop:function(){k.onStop(S)},trash:function(){k.onTrash(S)},combineFeatures:function(){k.onCombineFeatures(S)},uncombineFeatures:function(){k.onUncombineFeatures(S)},render:function(T,q){k.toDisplayFeatures(S,T,q)}}}}function pn(a){return[].concat(a).filter(function(u){return u!==void 0})}function Jn(){var a=this;if(!(a.ctx.map&&a.ctx.map.getSource(_.HOT)!==void 0))return H();var u=a.ctx.events.currentModeName();a.ctx.ui.queueMapClasses({mode:u});var h=[],y=[];a.isDirty?y=a.getAllIds():(h=a.getChangedIds().filter(function(re){return a.get(re)!==void 0}),y=a.sources.hot.filter(function(re){return re.properties.id&&h.indexOf(re.properties.id)===-1&&a.get(re.properties.id)!==void 0}).map(function(re){return re.properties.id})),a.sources.hot=[];var S=a.sources.cold.length;a.sources.cold=a.isDirty?[]:a.sources.cold.filter(function(re){var ne=re.properties.id||re.properties.parent;return h.indexOf(ne)===-1});var k=S!==a.sources.cold.length||y.length>0;function T(re,ne){var K=a.get(re).internal(u);a.ctx.events.currentModeRender(K,function(de){a.sources[ne].push(de)})}if(h.forEach(function(re){return T(re,"hot")}),y.forEach(function(re){return T(re,"cold")}),k&&a.ctx.map.getSource(_.COLD).setData({type:p.FEATURE_COLLECTION,features:a.sources.cold}),a.ctx.map.getSource(_.HOT).setData({type:p.FEATURE_COLLECTION,features:a.sources.hot}),a._emitSelectionChange&&(a.ctx.map.fire(O.SELECTION_CHANGE,{features:a.getSelected().map(function(re){return re.toGeoJSON()}),points:a.getSelectedCoordinates().map(function(re){return{type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:re.coordinates}}})}),a._emitSelectionChange=!1),a._deletedFeaturesToEmit.length){var q=a._deletedFeaturesToEmit.map(function(re){return re.toGeoJSON()});a._deletedFeaturesToEmit=[],a.ctx.map.fire(O.DELETE,{features:q})}function H(){a.isDirty=!1,a.clearChangedIds()}H(),a.ctx.map.fire(O.RENDER,{})}function Re(a){var u,h=this;this._features={},this._featureIds=new N,this._selectedFeatureIds=new N,this._selectedCoordinates=[],this._changedFeatureIds=new N,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=a,this.sources={hot:[],cold:[]},this.render=function(){u||(u=requestAnimationFrame(function(){u=null,Jn.call(h)}))},this.isDirty=!1}function _e(a,u){var h=a._selectedCoordinates.filter(function(y){return a._selectedFeatureIds.has(y.feature_id)});a._selectedCoordinates.length===h.length||u.silent||(a._emitSelectionChange=!0),a._selectedCoordinates=h}Re.prototype.createRenderBatch=function(){var a=this,u=this.render,h=0;return this.render=function(){h++},function(){a.render=u,h>0&&a.render()}},Re.prototype.setDirty=function(){return this.isDirty=!0,this},Re.prototype.featureChanged=function(a){return this._changedFeatureIds.add(a),this},Re.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Re.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Re.prototype.getAllIds=function(){return this._featureIds.values()},Re.prototype.add=function(a){return this.featureChanged(a.id),this._features[a.id]=a,this._featureIds.add(a.id),this},Re.prototype.delete=function(a,u){var h=this;return u===void 0&&(u={}),pn(a).forEach(function(y){h._featureIds.has(y)&&(h._featureIds.delete(y),h._selectedFeatureIds.delete(y),u.silent||h._deletedFeaturesToEmit.indexOf(h._features[y])===-1&&h._deletedFeaturesToEmit.push(h._features[y]),delete h._features[y],h.isDirty=!0)}),_e(this,u),this},Re.prototype.get=function(a){return this._features[a]},Re.prototype.getAll=function(){var a=this;return Object.keys(this._features).map(function(u){return a._features[u]})},Re.prototype.select=function(a,u){var h=this;return u===void 0&&(u={}),pn(a).forEach(function(y){h._selectedFeatureIds.has(y)||(h._selectedFeatureIds.add(y),h._changedFeatureIds.add(y),u.silent||(h._emitSelectionChange=!0))}),this},Re.prototype.deselect=function(a,u){var h=this;return u===void 0&&(u={}),pn(a).forEach(function(y){h._selectedFeatureIds.has(y)&&(h._selectedFeatureIds.delete(y),h._changedFeatureIds.add(y),u.silent||(h._emitSelectionChange=!0))}),_e(this,u),this},Re.prototype.clearSelected=function(a){return a===void 0&&(a={}),this.deselect(this._selectedFeatureIds.values(),{silent:a.silent}),this},Re.prototype.setSelected=function(a,u){var h=this;return u===void 0&&(u={}),a=pn(a),this.deselect(this._selectedFeatureIds.values().filter(function(y){return a.indexOf(y)===-1}),{silent:u.silent}),this.select(a.filter(function(y){return!h._selectedFeatureIds.has(y)}),{silent:u.silent}),this},Re.prototype.setSelectedCoordinates=function(a){return this._selectedCoordinates=a,this._emitSelectionChange=!0,this},Re.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Re.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Re.prototype.getSelected=function(){var a=this;return this._selectedFeatureIds.values().map(function(u){return a.get(u)})},Re.prototype.getSelectedCoordinates=function(){var a=this;return this._selectedCoordinates.map(function(u){return{coordinates:a.get(u.feature_id).getCoordinate(u.coord_path)}})},Re.prototype.isSelected=function(a){return this._selectedFeatureIds.has(a)},Re.prototype.setFeatureProperty=function(a,u,h){this.get(a).setProperty(u,h),this.featureChanged(a)},Re.prototype.storeMapConfig=function(){var a=this;E.forEach(function(u){a.ctx.map[u]&&(a._mapInitialConfig[u]=a.ctx.map[u].isEnabled())})},Re.prototype.restoreMapConfig=function(){var a=this;Object.keys(this._mapInitialConfig).forEach(function(u){a._mapInitialConfig[u]?a.ctx.map[u].enable():a.ctx.map[u].disable()})},Re.prototype.getInitialConfigValue=function(a){return this._mapInitialConfig[a]===void 0||this._mapInitialConfig[a]};var Ne=function(){for(var a=arguments,u={},h=0;h<arguments.length;h++){var y=a[h];for(var S in y)dr.call(y,S)&&(u[S]=y[S])}return u},dr=Object.prototype.hasOwnProperty,Xn=["mode","feature","mouse"];function Wn(a){var u=null,h=null,y={onRemove:function(){return a.map.off("load",y.connect),clearInterval(h),y.removeLayers(),a.store.restoreMapConfig(),a.ui.removeButtons(),a.events.removeEventListeners(),a.ui.clearMapClasses(),a.map=null,a.container=null,a.store=null,u&&u.parentNode&&u.parentNode.removeChild(u),u=null,this},connect:function(){a.map.off("load",y.connect),clearInterval(h),y.addLayers(),a.store.storeMapConfig(),a.events.addEventListeners()},onAdd:function(S){var k=S.fire;return S.fire=function(T,q){var H=arguments;return k.length===1&&arguments.length!==1&&(H=[Ne({},{type:T},q)]),k.apply(S,H)},a.map=S,a.events=function(T){var q=Object.keys(T.options.modes).reduce(function(G,ae){return G[ae]=ci(T.options.modes[ae]),G},{}),H={},re={},ne={},K=null,de=null;ne.drag=function(G,ae){ae({point:G.point,time:new Date().getTime()})?(T.ui.queueMapClasses({mouse:m.DRAG}),de.drag(G)):G.originalEvent.stopPropagation()},ne.mousedrag=function(G){ne.drag(G,function(ae){return!ke(H,ae)})},ne.touchdrag=function(G){ne.drag(G,function(ae){return!we(re,ae)})},ne.mousemove=function(G){if((G.originalEvent.buttons!==void 0?G.originalEvent.buttons:G.originalEvent.which)===1)return ne.mousedrag(G);var ae=Q(G,T);G.featureTarget=ae,de.mousemove(G)},ne.mousedown=function(G){H={time:new Date().getTime(),point:G.point};var ae=Q(G,T);G.featureTarget=ae,de.mousedown(G)},ne.mouseup=function(G){var ae=Q(G,T);G.featureTarget=ae,ke(H,{point:G.point,time:new Date().getTime()})?de.click(G):de.mouseup(G)},ne.mouseout=function(G){de.mouseout(G)},ne.touchstart=function(G){if(G.originalEvent.preventDefault(),T.options.touchEnabled){re={time:new Date().getTime(),point:G.point};var ae=B.touch(G,null,T)[0];G.featureTarget=ae,de.touchstart(G)}},ne.touchmove=function(G){if(G.originalEvent.preventDefault(),T.options.touchEnabled)return de.touchmove(G),ne.touchdrag(G)},ne.touchend=function(G){if(G.originalEvent.preventDefault(),T.options.touchEnabled){var ae=B.touch(G,null,T)[0];G.featureTarget=ae,we(re,{time:new Date().getTime(),point:G.point})?de.tap(G):de.touchend(G)}};var qe=function(G){return!(G===8||G===46||G>=48&&G<=57)};function be(G,ae,Pe){Pe===void 0&&(Pe={}),de.stop();var tt=q[G];if(tt===void 0)throw new Error(G+" is not valid");K=G;var We=tt(T,ae);de=t(We,T),Pe.silent||T.map.fire(O.MODE_CHANGE,{mode:G}),T.store.setDirty(),T.store.render()}ne.keydown=function(G){(G.srcElement||G.target).classList[0]==="mapboxgl-canvas"&&(G.keyCode!==8&&G.keyCode!==46||!T.options.controls.trash?qe(G.keyCode)?de.keydown(G):G.keyCode===49&&T.options.controls.point?be(w.DRAW_POINT):G.keyCode===50&&T.options.controls.line_string?be(w.DRAW_LINE_STRING):G.keyCode===51&&T.options.controls.polygon&&be(w.DRAW_POLYGON):(G.preventDefault(),de.trash()))},ne.keyup=function(G){qe(G.keyCode)&&de.keyup(G)},ne.zoomend=function(){T.store.changeZoom()},ne.data=function(G){if(G.dataType==="style"){var ae=T.setup,Pe=T.map,tt=T.options,We=T.store;tt.styles.some(function(bi){return Pe.getLayer(bi.id)})||(ae.addLayers(),We.setDirty(),We.render())}};var Xe={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){K=T.options.defaultMode,de=t(q[K](T),T)},changeMode:be,actionable:function(G){var ae=!1;Object.keys(G).forEach(function(Pe){if(Xe[Pe]===void 0)throw new Error("Invalid action type");Xe[Pe]!==G[Pe]&&(ae=!0),Xe[Pe]=G[Pe]}),ae&&T.map.fire(O.ACTIONABLE,{actions:Xe})},currentModeName:function(){return K},currentModeRender:function(G,ae){return de.render(G,ae)},fire:function(G,ae){ne[G]&&ne[G](ae)},addEventListeners:function(){T.map.on("mousemove",ne.mousemove),T.map.on("mousedown",ne.mousedown),T.map.on("mouseup",ne.mouseup),T.map.on("data",ne.data),T.map.on("touchmove",ne.touchmove),T.map.on("touchstart",ne.touchstart),T.map.on("touchend",ne.touchend),T.container.addEventListener("mouseout",ne.mouseout),T.options.keybindings&&(T.container.addEventListener("keydown",ne.keydown),T.container.addEventListener("keyup",ne.keyup))},removeEventListeners:function(){T.map.off("mousemove",ne.mousemove),T.map.off("mousedown",ne.mousedown),T.map.off("mouseup",ne.mouseup),T.map.off("data",ne.data),T.map.off("touchmove",ne.touchmove),T.map.off("touchstart",ne.touchstart),T.map.off("touchend",ne.touchend),T.container.removeEventListener("mouseout",ne.mouseout),T.options.keybindings&&(T.container.removeEventListener("keydown",ne.keydown),T.container.removeEventListener("keyup",ne.keyup))},trash:function(G){de.trash(G)},combineFeatures:function(){de.combineFeatures()},uncombineFeatures:function(){de.uncombineFeatures()},getMode:function(){return K}}}(a),a.ui=function(T){var q={},H=null,re={mode:null,feature:null,mouse:null},ne={mode:null,feature:null,mouse:null};function K(G){ne=Ne(ne,G)}function de(){var G,ae;if(T.container){var Pe=[],tt=[];Xn.forEach(function(We){ne[We]!==re[We]&&(Pe.push(We+"-"+re[We]),ne[We]!==null&&tt.push(We+"-"+ne[We]))}),Pe.length>0&&(G=T.container.classList).remove.apply(G,Pe),tt.length>0&&(ae=T.container.classList).add.apply(ae,tt),re=Ne(re,ne)}}function qe(G,ae){ae===void 0&&(ae={});var Pe=document.createElement("button");return Pe.className=g.CONTROL_BUTTON+" "+ae.className,Pe.setAttribute("title",ae.title),ae.container.appendChild(Pe),Pe.addEventListener("click",function(tt){if(tt.preventDefault(),tt.stopPropagation(),tt.target===H)return be(),void ae.onDeactivate();Xe(G),ae.onActivate()},!0),Pe}function be(){H&&(H.classList.remove(g.ACTIVE_BUTTON),H=null)}function Xe(G){be();var ae=q[G];ae&&ae&&G!=="trash"&&(ae.classList.add(g.ACTIVE_BUTTON),H=ae)}return{setActiveButton:Xe,queueMapClasses:K,updateMapClasses:de,clearMapClasses:function(){K({mode:null,feature:null,mouse:null}),de()},addButtons:function(){var G=T.options.controls,ae=document.createElement("div");return ae.className=g.CONTROL_GROUP+" "+g.CONTROL_BASE,G&&(G[d.LINE]&&(q[d.LINE]=qe(d.LINE,{container:ae,className:g.CONTROL_BUTTON_LINE,title:"LineString tool "+(T.options.keybindings?"(l)":""),onActivate:function(){return T.events.changeMode(w.DRAW_LINE_STRING)},onDeactivate:function(){return T.events.trash()}})),G[d.POLYGON]&&(q[d.POLYGON]=qe(d.POLYGON,{container:ae,className:g.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(T.options.keybindings?"(p)":""),onActivate:function(){return T.events.changeMode(w.DRAW_POLYGON)},onDeactivate:function(){return T.events.trash()}})),G[d.POINT]&&(q[d.POINT]=qe(d.POINT,{container:ae,className:g.CONTROL_BUTTON_POINT,title:"Marker tool "+(T.options.keybindings?"(m)":""),onActivate:function(){return T.events.changeMode(w.DRAW_POINT)},onDeactivate:function(){return T.events.trash()}})),G.trash&&(q.trash=qe("trash",{container:ae,className:g.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){T.events.trash()}})),G.combine_features&&(q.combine_features=qe("combineFeatures",{container:ae,className:g.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){T.events.combineFeatures()}})),G.uncombine_features&&(q.uncombine_features=qe("uncombineFeatures",{container:ae,className:g.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){T.events.uncombineFeatures()}}))),ae},removeButtons:function(){Object.keys(q).forEach(function(G){var ae=q[G];ae.parentNode&&ae.parentNode.removeChild(ae),delete q[G]})}}}(a),a.container=S.getContainer(),a.store=new Re(a),u=a.ui.addButtons(),a.options.boxSelect&&(S.boxZoom.disable(),S.dragPan.disable(),S.dragPan.enable()),S.loaded()?y.connect():(S.on("load",y.connect),h=setInterval(function(){S.loaded()&&y.connect()},16)),a.events.start(),u},addLayers:function(){a.map.addSource(_.COLD,{data:{type:p.FEATURE_COLLECTION,features:[]},type:"geojson"}),a.map.addSource(_.HOT,{data:{type:p.FEATURE_COLLECTION,features:[]},type:"geojson"}),a.options.styles.forEach(function(S){a.map.addLayer(S)}),a.store.setDirty(!0),a.store.render()},removeLayers:function(){a.options.styles.forEach(function(S){a.map.getLayer(S.id)&&a.map.removeLayer(S.id)}),a.map.getSource(_.COLD)&&a.map.removeSource(_.COLD),a.map.getSource(_.HOT)&&a.map.removeSource(_.HOT)}};return a.setup=y,y}var Qt=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function gn(a){return function(u){var h=u.featureTarget;return!!h&&!!h.properties&&h.properties.meta===a}}function po(a){return!!a.originalEvent&&!!a.originalEvent.shiftKey&&a.originalEvent.button===0}function mn(a){return!!a.featureTarget&&!!a.featureTarget.properties&&a.featureTarget.properties.active===b.ACTIVE&&a.featureTarget.properties.meta===v.FEATURE}function di(a){return!!a.featureTarget&&!!a.featureTarget.properties&&a.featureTarget.properties.active===b.INACTIVE&&a.featureTarget.properties.meta===v.FEATURE}function hr(a){return a.featureTarget===void 0}function go(a){return!!a.featureTarget&&!!a.featureTarget.properties&&a.featureTarget.properties.meta===v.FEATURE}function Hn(a){var u=a.featureTarget;return!!u&&!!u.properties&&u.properties.meta===v.VERTEX}function pr(a){return!!a.originalEvent&&a.originalEvent.shiftKey===!0}function gr(a){return a.keyCode===27}function mr(a){return a.keyCode===13}var Jl=Object.freeze({__proto__:null,isOfMetaType:gn,isShiftMousedown:po,isActiveFeature:mn,isInactiveFeature:di,noTarget:hr,isFeature:go,isVertex:Hn,isShiftDown:pr,isEscapeKey:gr,isEnterKey:mr,isTrue:function(){return!0}}),Xl=On;function On(a,u){this.x=a,this.y=u}function hi(a,u){var h=u.getBoundingClientRect();return new Xl(a.clientX-h.left-(u.clientLeft||0),a.clientY-h.top-(u.clientTop||0))}function In(a,u,h,y){return{type:p.FEATURE,properties:{meta:v.VERTEX,parent:a,coord_path:h,active:y?b.ACTIVE:b.INACTIVE},geometry:{type:p.POINT,coordinates:u}}}function mo(a,u,h){var y=u.geometry.coordinates,S=h.geometry.coordinates;if(y[1]>85||y[1]<M||S[1]>85||S[1]<M)return null;var k={lng:(y[0]+S[0])/2,lat:(y[1]+S[1])/2};return{type:p.FEATURE,properties:{meta:v.MIDPOINT,parent:a,lng:k.lng,lat:k.lat,coord_path:h.properties.coord_path},geometry:{type:p.POINT,coordinates:[k.lng,k.lat]}}}function vr(a,u,h){u===void 0&&(u={}),h===void 0&&(h=null);var y,S=a.geometry,k=S.type,T=S.coordinates,q=a.properties&&a.properties.id,H=[];function re(K,de){var qe="",be=null;K.forEach(function(Xe,G){var ae=de!=null?de+"."+G:String(G),Pe=In(q,Xe,ae,ne(ae));if(u.midpoints&&be){var tt=mo(q,be,Pe);tt&&H.push(tt)}be=Pe;var We=JSON.stringify(Xe);qe!==We&&H.push(Pe),G===0&&(qe=We)})}function ne(K){return!!u.selectedPaths&&u.selectedPaths.indexOf(K)!==-1}return k===p.POINT?H.push(In(q,T,h,ne(h))):k===p.POLYGON?T.forEach(function(K,de){re(K,h!==null?h+"."+de:String(de))}):k===p.LINE_STRING?re(T,h):k.indexOf(p.MULTI_PREFIX)===0&&(y=k.replace(p.MULTI_PREFIX,""),T.forEach(function(K,de){var qe={type:p.FEATURE,properties:a.properties,geometry:{type:y,coordinates:K}};H=H.concat(vr(qe,u,de))})),H}On.prototype={clone:function(){return new On(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,u){return this.clone()._rotateAround(a,u)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var u=a.x-this.x,h=a.y-this.y;return u*u+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,u){return Math.atan2(this.x*u-this.y*a,this.x*a+this.y*u)},_matMult:function(a){var u=a[0]*this.x+a[1]*this.y,h=a[2]*this.x+a[3]*this.y;return this.x=u,this.y=h,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var u=Math.cos(a),h=Math.sin(a),y=u*this.x-h*this.y,S=h*this.x+u*this.y;return this.x=y,this.y=S,this},_rotateAround:function(a,u){var h=Math.cos(a),y=Math.sin(a),S=u.x+h*(this.x-u.x)-y*(this.y-u.y),k=u.y+y*(this.x-u.x)+h*(this.y-u.y);return this.x=S,this.y=k,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},On.convert=function(a){return a instanceof On?a:Array.isArray(a)?new On(a[0],a[1]):a};var Ot={enable:function(a){setTimeout(function(){a.map&&a.map.doubleClickZoom&&a._ctx&&a._ctx.store&&a._ctx.store.getInitialConfigValue&&a._ctx.store.getInitialConfigValue("doubleClickZoom")&&a.map.doubleClickZoom.enable()},0)},disable:function(a){setTimeout(function(){a.map&&a.map.doubleClickZoom&&a.map.doubleClickZoom.disable()},0)}},Zn={},Wl={get exports(){return Zn},set exports(a){Zn=a}},vo=function(a){if(!a||!a.type)return null;var u=Hl[a.type];if(!u)return null;if(u==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:a}]};if(u==="feature")return{type:"FeatureCollection",features:[a]};if(u==="featurecollection")return a},Hl={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Zl=Object.freeze({__proto__:null,default:function a(u){switch(u&&u.type||null){case"FeatureCollection":return u.features=u.features.reduce(function(h,y){return h.concat(a(y))},[]),u;case"Feature":return u.geometry?a(u.geometry).map(function(h){var y={type:"Feature",properties:JSON.parse(JSON.stringify(u.properties)),geometry:h};return u.id!==void 0&&(y.id=u.id),y}):[u];case"MultiPoint":return u.coordinates.map(function(h){return{type:"Point",coordinates:h}});case"MultiPolygon":return u.coordinates.map(function(h){return{type:"Polygon",coordinates:h}});case"MultiLineString":return u.coordinates.map(function(h){return{type:"LineString",coordinates:h}});case"GeometryCollection":return u.geometries.map(a).reduce(function(h,y){return h.concat(y)},[]);case"Point":case"Polygon":case"LineString":return[u]}}}),Kl=vo,br=r(Zl),Ql=function(a){return function u(h){return Array.isArray(h)&&h.length&&typeof h[0]=="number"?[h]:h.reduce(function(y,S){return Array.isArray(S)&&Array.isArray(S[0])?y.concat(u(S)):(y.push(S),y)},[])}(a)};br instanceof Function||(br=br.default);var pi={},$l={get exports(){return pi},set exports(a){pi=a}}.exports=function(a){return new yt(a)};function yt(a){this.value=a}function bo(a,u,h){var y=[],S=[],k=!0;return function T(q){var H=h?_o(q):q,re={},ne=!0,K={node:H,node_:q,path:[].concat(y),parent:S[S.length-1],parents:S,key:y.slice(-1)[0],isRoot:y.length===0,level:y.length,circular:null,update:function(be,Xe){K.isRoot||(K.parent.node[K.key]=be),K.node=be,Xe&&(ne=!1)},delete:function(be){delete K.parent.node[K.key],be&&(ne=!1)},remove:function(be){yo(K.parent.node)?K.parent.node.splice(K.key,1):delete K.parent.node[K.key],be&&(ne=!1)},keys:null,before:function(be){re.before=be},after:function(be){re.after=be},pre:function(be){re.pre=be},post:function(be){re.post=be},stop:function(){k=!1},block:function(){ne=!1}};if(!k)return K;function de(){if(typeof K.node=="object"&&K.node!==null){K.keys&&K.node_===K.node||(K.keys=_r(K.node)),K.isLeaf=K.keys.length==0;for(var be=0;be<S.length;be++)if(S[be].node_===q){K.circular=S[be];break}}else K.isLeaf=!0,K.keys=null;K.notLeaf=!K.isLeaf,K.notRoot=!K.isRoot}de();var qe=u.call(K,K.node);return qe!==void 0&&K.update&&K.update(qe),re.before&&re.before.call(K,K.node),ne&&(typeof K.node!="object"||K.node===null||K.circular||(S.push(K),de(),yr(K.keys,function(be,Xe){y.push(be),re.pre&&re.pre.call(K,K.node[be],be);var G=T(K.node[be]);h&&wr.call(K.node,be)&&(K.node[be]=G.node),G.isLast=Xe==K.keys.length-1,G.isFirst=Xe==0,re.post&&re.post.call(K,G),y.pop()}),S.pop()),re.after&&re.after.call(K,K.node)),K}(a).node}function _o(a){if(typeof a=="object"&&a!==null){var u;if(yo(a))u=[];else if(Ln(a)==="[object Date]")u=new Date(a.getTime?a.getTime():a);else if(function(S){return Ln(S)==="[object RegExp]"}(a))u=new RegExp(a);else if(function(S){return Ln(S)==="[object Error]"}(a))u={message:a.message};else if(function(S){return Ln(S)==="[object Boolean]"}(a))u=new Boolean(a);else if(function(S){return Ln(S)==="[object Number]"}(a))u=new Number(a);else if(function(S){return Ln(S)==="[object String]"}(a))u=new String(a);else if(Object.create&&Object.getPrototypeOf)u=Object.create(Object.getPrototypeOf(a));else if(a.constructor===Object)u={};else{var h=a.constructor&&a.constructor.prototype||a.__proto__||{},y=function(){};y.prototype=h,u=new y}return yr(_r(a),function(S){u[S]=a[S]}),u}return a}yt.prototype.get=function(a){for(var u=this.value,h=0;h<a.length;h++){var y=a[h];if(!u||!wr.call(u,y)){u=void 0;break}u=u[y]}return u},yt.prototype.has=function(a){for(var u=this.value,h=0;h<a.length;h++){var y=a[h];if(!u||!wr.call(u,y))return!1;u=u[y]}return!0},yt.prototype.set=function(a,u){for(var h=this.value,y=0;y<a.length-1;y++){var S=a[y];wr.call(h,S)||(h[S]={}),h=h[S]}return h[a[y]]=u,u},yt.prototype.map=function(a){return bo(this.value,a,!0)},yt.prototype.forEach=function(a){return this.value=bo(this.value,a,!1),this.value},yt.prototype.reduce=function(a,u){var h=arguments.length===1,y=h?this.value:u;return this.forEach(function(S){this.isRoot&&h||(y=a.call(this,y,S))}),y},yt.prototype.paths=function(){var a=[];return this.forEach(function(u){a.push(this.path)}),a},yt.prototype.nodes=function(){var a=[];return this.forEach(function(u){a.push(this.node)}),a},yt.prototype.clone=function(){var a=[],u=[];return function h(y){for(var S=0;S<a.length;S++)if(a[S]===y)return u[S];if(typeof y=="object"&&y!==null){var k=_o(y);return a.push(y),u.push(k),yr(_r(y),function(T){k[T]=h(y[T])}),a.pop(),u.pop(),k}return y}(this.value)};var _r=Object.keys||function(a){var u=[];for(var h in a)u.push(h);return u};function Ln(a){return Object.prototype.toString.call(a)}var yo=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},yr=function(a,u){if(a.forEach)return a.forEach(u);for(var h=0;h<a.length;h++)u(a[h],h,a)};yr(_r(yt.prototype),function(a){$l[a]=function(u){var h=[].slice.call(arguments,1),y=new yt(u);return y[a].apply(y,h)}});var wr=Object.hasOwnProperty||function(a,u){return u in a},es=st;function st(a){if(!(this instanceof st))return new st(a);this._bbox=a||[1/0,1/0,-1/0,-1/0],this._valid=!!a}st.prototype.include=function(a){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],a[0]),this._bbox[1]=Math.min(this._bbox[1],a[1]),this._bbox[2]=Math.max(this._bbox[2],a[0]),this._bbox[3]=Math.max(this._bbox[3],a[1]),this},st.prototype.equals=function(a){var u;return u=a instanceof st?a.bbox():a,this._bbox[0]==u[0]&&this._bbox[1]==u[1]&&this._bbox[2]==u[2]&&this._bbox[3]==u[3]},st.prototype.center=function(a){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},st.prototype.union=function(a){var u;return this._valid=!0,u=a instanceof st?a.bbox():a,this._bbox[0]=Math.min(this._bbox[0],u[0]),this._bbox[1]=Math.min(this._bbox[1],u[1]),this._bbox[2]=Math.max(this._bbox[2],u[2]),this._bbox[3]=Math.max(this._bbox[3],u[3]),this},st.prototype.bbox=function(){return this._valid?this._bbox:null},st.prototype.contains=function(a){if(!a)return this._fastContains();if(!this._valid)return null;var u=a[0],h=a[1];return this._bbox[0]<=u&&this._bbox[1]<=h&&this._bbox[2]>=u&&this._bbox[3]>=h},st.prototype.intersect=function(a){return this._valid?(u=a instanceof st?a.bbox():a,!(this._bbox[0]>u[2]||this._bbox[2]<u[0]||this._bbox[3]<u[1]||this._bbox[1]>u[3])):null;var u},st.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var a="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",a)},st.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var ts=function(a){if(!a)return[];var u=br(Kl(a)),h=[];return u.features.forEach(function(y){y.geometry&&(h=h.concat(Ql(y.geometry.coordinates)))}),h},ns=pi,rs=es,wo={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},is=Object.keys(wo);function gi(a){for(var u=rs(),h=ts(a),y=0;y<h.length;y++)u.include(h[y]);return u}Wl.exports=function(a){return gi(a).bbox()},Zn.polygon=function(a){return gi(a).polygon()},Zn.bboxify=function(a){return ns(a).map(function(u){u&&is.some(function(h){return!!u[h]&&wo[h].indexOf(u.type)!==-1})&&(u.bbox=gi(u).bbox(),this.update(u))})};var Er=-90;function mi(a,u){var h=Er,y=90,S=Er,k=90,T=270,q=-270;a.forEach(function(re){var ne=Zn(re),K=ne[1],de=ne[3],qe=ne[0],be=ne[2];K>h&&(h=K),de<y&&(y=de),de>S&&(S=de),K<k&&(k=K),qe<T&&(T=qe),be>q&&(q=be)});var H=u;return h+H.lat>85&&(H.lat=85-h),S+H.lat>90&&(H.lat=90-S),y+H.lat<-85&&(H.lat=-85-y),k+H.lat<Er&&(H.lat=Er-k),T+H.lng<=-270&&(H.lng+=360*Math.ceil(Math.abs(H.lng)/360)),q+H.lng>=270&&(H.lng-=360*Math.ceil(Math.abs(H.lng)/360)),H}function vi(a,u){var h=mi(a.map(function(y){return y.toGeoJSON()}),u);a.forEach(function(y){var S,k=y.getCoordinates(),T=function(H){var re={lng:H[0]+h.lng,lat:H[1]+h.lat};return[re.lng,re.lat]},q=function(H){return H.map(function(re){return T(re)})};y.type===p.POINT?S=T(k):y.type===p.LINE_STRING||y.type===p.MULTI_POINT?S=k.map(T):y.type===p.POLYGON||y.type===p.MULTI_LINE_STRING?S=k.map(q):y.type===p.MULTI_POLYGON&&(S=k.map(function(H){return H.map(function(re){return q(re)})})),y.incomingCoords(S)})}var Ke={onSetup:function(a){var u=this,h={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:a.featureIds||[]};return this.setSelected(h.initiallySelectedFeatureIds.filter(function(y){return u.getFeature(y)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),h},fireUpdate:function(){this.map.fire(O.UPDATE,{action:z.MOVE,features:this.getSelected().map(function(a){return a.toGeoJSON()})})},fireActionable:function(){var a=this,u=this.getSelected(),h=u.filter(function(q){return a.isInstanceOf("MultiFeature",q)}),y=!1;if(u.length>1){y=!0;var S=u[0].type.replace("Multi","");u.forEach(function(q){q.type.replace("Multi","")!==S&&(y=!1)})}var k=h.length>0,T=u.length>0;this.setActionableState({combineFeatures:y,uncombineFeatures:k,trash:T})},getUniqueIds:function(a){return a.length?a.map(function(u){return u.properties.id}).filter(function(u){return u!==void 0}).reduce(function(u,h){return u.add(h),u},new N).values():[]},stopExtendedInteractions:function(a){a.boxSelectElement&&(a.boxSelectElement.parentNode&&a.boxSelectElement.parentNode.removeChild(a.boxSelectElement),a.boxSelectElement=null),this.map.dragPan.enable(),a.boxSelecting=!1,a.canBoxSelect=!1,a.dragMoving=!1,a.canDragMove=!1},onStop:function(){Ot.enable(this)},onMouseMove:function(a){return this.stopExtendedInteractions(a),!0},onMouseOut:function(a){return!a.dragMoving||this.fireUpdate()}};Ke.onTap=Ke.onClick=function(a,u){return hr(u)?this.clickAnywhere(a,u):gn(v.VERTEX)(u)?this.clickOnVertex(a,u):go(u)?this.clickOnFeature(a,u):void 0},Ke.clickAnywhere=function(a){var u=this,h=this.getSelectedIds();h.length&&(this.clearSelectedFeatures(),h.forEach(function(y){return u.doRender(y)})),Ot.enable(this),this.stopExtendedInteractions(a)},Ke.clickOnVertex=function(a,u){this.changeMode(w.DIRECT_SELECT,{featureId:u.featureTarget.properties.parent,coordPath:u.featureTarget.properties.coord_path,startPos:u.lngLat}),this.updateUIClasses({mouse:m.MOVE})},Ke.startOnActiveFeature=function(a,u){this.stopExtendedInteractions(a),this.map.dragPan.disable(),this.doRender(u.featureTarget.properties.id),a.canDragMove=!0,a.dragMoveLocation=u.lngLat},Ke.clickOnFeature=function(a,u){var h=this;Ot.disable(this),this.stopExtendedInteractions(a);var y=pr(u),S=this.getSelectedIds(),k=u.featureTarget.properties.id,T=this.isSelected(k);if(!y&&T&&this.getFeature(k).type!==p.POINT)return this.changeMode(w.DIRECT_SELECT,{featureId:k});T&&y?(this.deselect(k),this.updateUIClasses({mouse:m.POINTER}),S.length===1&&Ot.enable(this)):!T&&y?(this.select(k),this.updateUIClasses({mouse:m.MOVE})):T||y||(S.forEach(function(q){return h.doRender(q)}),this.setSelected(k),this.updateUIClasses({mouse:m.MOVE})),this.doRender(k)},Ke.onMouseDown=function(a,u){return mn(u)?this.startOnActiveFeature(a,u):this.drawConfig.boxSelect&&po(u)?this.startBoxSelect(a,u):void 0},Ke.startBoxSelect=function(a,u){this.stopExtendedInteractions(a),this.map.dragPan.disable(),a.boxSelectStartLocation=hi(u.originalEvent,this.map.getContainer()),a.canBoxSelect=!0},Ke.onTouchStart=function(a,u){if(mn(u))return this.startOnActiveFeature(a,u)},Ke.onDrag=function(a,u){return a.canDragMove?this.dragMove(a,u):this.drawConfig.boxSelect&&a.canBoxSelect?this.whileBoxSelect(a,u):void 0},Ke.whileBoxSelect=function(a,u){a.boxSelecting=!0,this.updateUIClasses({mouse:m.ADD}),a.boxSelectElement||(a.boxSelectElement=document.createElement("div"),a.boxSelectElement.classList.add(g.BOX_SELECT),this.map.getContainer().appendChild(a.boxSelectElement));var h=hi(u.originalEvent,this.map.getContainer()),y=Math.min(a.boxSelectStartLocation.x,h.x),S=Math.max(a.boxSelectStartLocation.x,h.x),k=Math.min(a.boxSelectStartLocation.y,h.y),T=Math.max(a.boxSelectStartLocation.y,h.y),q="translate("+y+"px, "+k+"px)";a.boxSelectElement.style.transform=q,a.boxSelectElement.style.WebkitTransform=q,a.boxSelectElement.style.width=S-y+"px",a.boxSelectElement.style.height=T-k+"px"},Ke.dragMove=function(a,u){a.dragMoving=!0,u.originalEvent.stopPropagation();var h={lng:u.lngLat.lng-a.dragMoveLocation.lng,lat:u.lngLat.lat-a.dragMoveLocation.lat};vi(this.getSelected(),h),a.dragMoveLocation=u.lngLat},Ke.onTouchEnd=Ke.onMouseUp=function(a,u){var h=this;if(a.dragMoving)this.fireUpdate();else if(a.boxSelecting){var y=[a.boxSelectStartLocation,hi(u.originalEvent,this.map.getContainer())],S=this.featuresAt(null,y,"click"),k=this.getUniqueIds(S).filter(function(T){return!h.isSelected(T)});k.length&&(this.select(k),k.forEach(function(T){return h.doRender(T)}),this.updateUIClasses({mouse:m.MOVE}))}this.stopExtendedInteractions(a)},Ke.toDisplayFeatures=function(a,u,h){u.properties.active=this.isSelected(u.properties.id)?b.ACTIVE:b.INACTIVE,h(u),this.fireActionable(),u.properties.active===b.ACTIVE&&u.geometry.type!==p.POINT&&vr(u).forEach(h)},Ke.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Ke.onCombineFeatures=function(){var a=this.getSelected();if(!(a.length===0||a.length<2)){for(var u=[],h=[],y=a[0].type.replace("Multi",""),S=0;S<a.length;S++){var k=a[S];if(k.type.replace("Multi","")!==y)return;k.type.includes("Multi")?k.getCoordinates().forEach(function(q){u.push(q)}):u.push(k.getCoordinates()),h.push(k.toGeoJSON())}if(h.length>1){var T=this.newFeature({type:p.FEATURE,properties:h[0].properties,geometry:{type:"Multi"+y,coordinates:u}});this.addFeature(T),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([T.id]),this.map.fire(O.COMBINE_FEATURES,{createdFeatures:[T.toGeoJSON()],deletedFeatures:h})}this.fireActionable()}},Ke.onUncombineFeatures=function(){var a=this,u=this.getSelected();if(u.length!==0){for(var h=[],y=[],S=function(T){var q=u[T];a.isInstanceOf("MultiFeature",q)&&(q.getFeatures().forEach(function(H){a.addFeature(H),H.properties=q.properties,h.push(H.toGeoJSON()),a.select([H.id])}),a.deleteFeature(q.id,{silent:!0}),y.push(q.toGeoJSON()))},k=0;k<u.length;k++)S(k);h.length>1&&this.map.fire(O.UNCOMBINE_FEATURES,{createdFeatures:h,deletedFeatures:y}),this.fireActionable()}};var Eo=gn(v.VERTEX),os=gn(v.MIDPOINT),$t={fireUpdate:function(){this.map.fire(O.UPDATE,{action:z.CHANGE_COORDINATES,features:this.getSelected().map(function(a){return a.toGeoJSON()})})},fireActionable:function(a){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:a.selectedCoordPaths.length>0})},startDragging:function(a,u){this.map.dragPan.disable(),a.canDragMove=!0,a.dragMoveLocation=u.lngLat},stopDragging:function(a){this.map.dragPan.enable(),a.dragMoving=!1,a.canDragMove=!1,a.dragMoveLocation=null},onVertex:function(a,u){this.startDragging(a,u);var h=u.featureTarget.properties,y=a.selectedCoordPaths.indexOf(h.coord_path);pr(u)||y!==-1?pr(u)&&y===-1&&a.selectedCoordPaths.push(h.coord_path):a.selectedCoordPaths=[h.coord_path];var S=this.pathsToCoordinates(a.featureId,a.selectedCoordPaths);this.setSelectedCoordinates(S)},onMidpoint:function(a,u){this.startDragging(a,u);var h=u.featureTarget.properties;a.feature.addCoordinate(h.coord_path,h.lng,h.lat),this.fireUpdate(),a.selectedCoordPaths=[h.coord_path]},pathsToCoordinates:function(a,u){return u.map(function(h){return{feature_id:a,coord_path:h}})},onFeature:function(a,u){a.selectedCoordPaths.length===0?this.startDragging(a,u):this.stopDragging(a)},dragFeature:function(a,u,h){vi(this.getSelected(),h),a.dragMoveLocation=u.lngLat},dragVertex:function(a,u,h){for(var y=a.selectedCoordPaths.map(function(q){return a.feature.getCoordinate(q)}),S=mi(y.map(function(q){return{type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:q}}}),h),k=0;k<y.length;k++){var T=y[k];a.feature.updateCoordinate(a.selectedCoordPaths[k],T[0]+S.lng,T[1]+S.lat)}},clickNoTarget:function(){this.changeMode(w.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(w.SIMPLE_SELECT)},clickActiveFeature:function(a){a.selectedCoordPaths=[],this.clearSelectedCoordinates(),a.feature.changed()},onSetup:function(a){var u=a.featureId,h=this.getFeature(u);if(!h)throw new Error("You must provide a featureId to enter direct_select mode");if(h.type===p.POINT)throw new TypeError("direct_select mode doesn't handle point features");var y={featureId:u,feature:h,dragMoveLocation:a.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:a.coordPath?[a.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(u,y.selectedCoordPaths)),this.setSelected(u),Ot.disable(this),this.setActionableState({trash:!0}),y},onStop:function(){Ot.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(a,u,h){a.featureId===u.properties.id?(u.properties.active=b.ACTIVE,h(u),vr(u,{map:this.map,midpoints:!0,selectedPaths:a.selectedCoordPaths}).forEach(h)):(u.properties.active=b.INACTIVE,h(u)),this.fireActionable(a)},onTrash:function(a){a.selectedCoordPaths.sort(function(u,h){return h.localeCompare(u,"en",{numeric:!0})}).forEach(function(u){return a.feature.removeCoordinate(u)}),this.fireUpdate(),a.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(a),a.feature.isValid()===!1&&(this.deleteFeature([a.featureId]),this.changeMode(w.SIMPLE_SELECT,{}))},onMouseMove:function(a,u){var h=mn(u),y=Eo(u),S=a.selectedCoordPaths.length===0;return h&&S||y&&!S?this.updateUIClasses({mouse:m.MOVE}):this.updateUIClasses({mouse:m.NONE}),this.stopDragging(a),!0},onMouseOut:function(a){return a.dragMoving&&this.fireUpdate(),!0}};$t.onTouchStart=$t.onMouseDown=function(a,u){return Eo(u)?this.onVertex(a,u):mn(u)?this.onFeature(a,u):os(u)?this.onMidpoint(a,u):void 0},$t.onDrag=function(a,u){if(a.canDragMove===!0){a.dragMoving=!0,u.originalEvent.stopPropagation();var h={lng:u.lngLat.lng-a.dragMoveLocation.lng,lat:u.lngLat.lat-a.dragMoveLocation.lat};a.selectedCoordPaths.length>0?this.dragVertex(a,u,h):this.dragFeature(a,u,h),a.dragMoveLocation=u.lngLat}},$t.onClick=function(a,u){return hr(u)?this.clickNoTarget(a,u):mn(u)?this.clickActiveFeature(a,u):di(u)?this.clickInactive(a,u):void this.stopDragging(a)},$t.onTap=function(a,u){return hr(u)?this.clickNoTarget(a,u):mn(u)?this.clickActiveFeature(a,u):di(u)?this.clickInactive(a,u):void 0},$t.onTouchEnd=$t.onMouseUp=function(a){a.dragMoving&&this.fireUpdate(),this.stopDragging(a)};var Nt={};function Sr(a,u){return!!a.lngLat&&a.lngLat.lng===u[0]&&a.lngLat.lat===u[1]}Nt.onSetup=function(){var a=this.newFeature({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:[]}});return this.addFeature(a),this.clearSelectedFeatures(),this.updateUIClasses({mouse:m.ADD}),this.activateUIButton(d.POINT),this.setActionableState({trash:!0}),{point:a}},Nt.stopDrawingAndRemove=function(a){this.deleteFeature([a.point.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT)},Nt.onTap=Nt.onClick=function(a,u){this.updateUIClasses({mouse:m.MOVE}),a.point.updateCoordinate("",u.lngLat.lng,u.lngLat.lat),this.map.fire(O.CREATE,{features:[a.point.toGeoJSON()]}),this.changeMode(w.SIMPLE_SELECT,{featureIds:[a.point.id]})},Nt.onStop=function(a){this.activateUIButton(),a.point.getCoordinate().length||this.deleteFeature([a.point.id],{silent:!0})},Nt.toDisplayFeatures=function(a,u,h){var y=u.properties.id===a.point.id;if(u.properties.active=y?b.ACTIVE:b.INACTIVE,!y)return h(u)},Nt.onTrash=Nt.stopDrawingAndRemove,Nt.onKeyUp=function(a,u){if(gr(u)||mr(u))return this.stopDrawingAndRemove(a,u)};var vn={onSetup:function(){var a=this.newFeature({type:p.FEATURE,properties:{},geometry:{type:p.POLYGON,coordinates:[[]]}});return this.addFeature(a),this.clearSelectedFeatures(),Ot.disable(this),this.updateUIClasses({mouse:m.ADD}),this.activateUIButton(d.POLYGON),this.setActionableState({trash:!0}),{polygon:a,currentVertexPosition:0}},clickAnywhere:function(a,u){if(a.currentVertexPosition>0&&Sr(u,a.polygon.coordinates[0][a.currentVertexPosition-1]))return this.changeMode(w.SIMPLE_SELECT,{featureIds:[a.polygon.id]});this.updateUIClasses({mouse:m.ADD}),a.polygon.updateCoordinate("0."+a.currentVertexPosition,u.lngLat.lng,u.lngLat.lat),a.currentVertexPosition++,a.polygon.updateCoordinate("0."+a.currentVertexPosition,u.lngLat.lng,u.lngLat.lat)},clickOnVertex:function(a){return this.changeMode(w.SIMPLE_SELECT,{featureIds:[a.polygon.id]})},onMouseMove:function(a,u){a.polygon.updateCoordinate("0."+a.currentVertexPosition,u.lngLat.lng,u.lngLat.lat),Hn(u)&&this.updateUIClasses({mouse:m.POINTER})}};vn.onTap=vn.onClick=function(a,u){return Hn(u)?this.clickOnVertex(a,u):this.clickAnywhere(a,u)},vn.onKeyUp=function(a,u){gr(u)?(this.deleteFeature([a.polygon.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT)):mr(u)&&this.changeMode(w.SIMPLE_SELECT,{featureIds:[a.polygon.id]})},vn.onStop=function(a){this.updateUIClasses({mouse:m.NONE}),Ot.enable(this),this.activateUIButton(),this.getFeature(a.polygon.id)!==void 0&&(a.polygon.removeCoordinate("0."+a.currentVertexPosition),a.polygon.isValid()?this.map.fire(O.CREATE,{features:[a.polygon.toGeoJSON()]}):(this.deleteFeature([a.polygon.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT,{},{silent:!0})))},vn.toDisplayFeatures=function(a,u,h){var y=u.properties.id===a.polygon.id;if(u.properties.active=y?b.ACTIVE:b.INACTIVE,!y)return h(u);if(u.geometry.coordinates.length!==0){var S=u.geometry.coordinates[0].length;if(!(S<3)){if(u.properties.meta=v.FEATURE,h(In(a.polygon.id,u.geometry.coordinates[0][0],"0.0",!1)),S>3){var k=u.geometry.coordinates[0].length-3;h(In(a.polygon.id,u.geometry.coordinates[0][k],"0."+k,!1))}if(S<=4){var T=[[u.geometry.coordinates[0][0][0],u.geometry.coordinates[0][0][1]],[u.geometry.coordinates[0][1][0],u.geometry.coordinates[0][1][1]]];if(h({type:p.FEATURE,properties:u.properties,geometry:{coordinates:T,type:p.LINE_STRING}}),S===3)return}return h(u)}}},vn.onTrash=function(a){this.deleteFeature([a.polygon.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT)};var bn={onSetup:function(a){var u,h,y=(a=a||{}).featureId,S="forward";if(y){if(!(u=this.getFeature(y)))throw new Error("Could not find a feature with the provided featureId");var k=a.from;if(k&&k.type==="Feature"&&k.geometry&&k.geometry.type==="Point"&&(k=k.geometry),k&&k.type==="Point"&&k.coordinates&&k.coordinates.length===2&&(k=k.coordinates),!k||!Array.isArray(k))throw new Error("Please use the `from` property to indicate which point to continue the line from");var T=u.coordinates.length-1;if(u.coordinates[T][0]===k[0]&&u.coordinates[T][1]===k[1])h=T+1,u.addCoordinate.apply(u,[h].concat(u.coordinates[T]));else{if(u.coordinates[0][0]!==k[0]||u.coordinates[0][1]!==k[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");S="backwards",h=0,u.addCoordinate.apply(u,[h].concat(u.coordinates[0]))}}else u=this.newFeature({type:p.FEATURE,properties:{},geometry:{type:p.LINE_STRING,coordinates:[]}}),h=0,this.addFeature(u);return this.clearSelectedFeatures(),Ot.disable(this),this.updateUIClasses({mouse:m.ADD}),this.activateUIButton(d.LINE),this.setActionableState({trash:!0}),{line:u,currentVertexPosition:h,direction:S}},clickAnywhere:function(a,u){if(a.currentVertexPosition>0&&Sr(u,a.line.coordinates[a.currentVertexPosition-1])||a.direction==="backwards"&&Sr(u,a.line.coordinates[a.currentVertexPosition+1]))return this.changeMode(w.SIMPLE_SELECT,{featureIds:[a.line.id]});this.updateUIClasses({mouse:m.ADD}),a.line.updateCoordinate(a.currentVertexPosition,u.lngLat.lng,u.lngLat.lat),a.direction==="forward"?(a.currentVertexPosition++,a.line.updateCoordinate(a.currentVertexPosition,u.lngLat.lng,u.lngLat.lat)):a.line.addCoordinate(0,u.lngLat.lng,u.lngLat.lat)},clickOnVertex:function(a){return this.changeMode(w.SIMPLE_SELECT,{featureIds:[a.line.id]})},onMouseMove:function(a,u){a.line.updateCoordinate(a.currentVertexPosition,u.lngLat.lng,u.lngLat.lat),Hn(u)&&this.updateUIClasses({mouse:m.POINTER})}};bn.onTap=bn.onClick=function(a,u){if(Hn(u))return this.clickOnVertex(a,u);this.clickAnywhere(a,u)},bn.onKeyUp=function(a,u){mr(u)?this.changeMode(w.SIMPLE_SELECT,{featureIds:[a.line.id]}):gr(u)&&(this.deleteFeature([a.line.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT))},bn.onStop=function(a){Ot.enable(this),this.activateUIButton(),this.getFeature(a.line.id)!==void 0&&(a.line.removeCoordinate(""+a.currentVertexPosition),a.line.isValid()?this.map.fire(O.CREATE,{features:[a.line.toGeoJSON()]}):(this.deleteFeature([a.line.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT,{},{silent:!0})))},bn.onTrash=function(a){this.deleteFeature([a.line.id],{silent:!0}),this.changeMode(w.SIMPLE_SELECT)},bn.toDisplayFeatures=function(a,u,h){var y=u.properties.id===a.line.id;if(u.properties.active=y?b.ACTIVE:b.INACTIVE,!y)return h(u);u.geometry.coordinates.length<2||(u.properties.meta=v.FEATURE,h(In(a.line.id,u.geometry.coordinates[a.direction==="forward"?u.geometry.coordinates.length-2:1],""+(a.direction==="forward"?u.geometry.coordinates.length-2:1),!1)),h(u))};var So={simple_select:Ke,direct_select:$t,draw_point:Nt,draw_polygon:vn,draw_line_string:bn},as={defaultMode:w.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Qt,modes:So,controls:{},userProperties:!1},ls={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ss={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function ko(a,u){return a.map(function(h){return h.source?h:Ne(h,{id:h.id+"."+u,source:u==="hot"?_.HOT:_.COLD})})}var kr={};(function(a,u){var h="__lodash_hash_undefined__",y=9007199254740991,S="[object Arguments]",k="[object Array]",T="[object Boolean]",q="[object Date]",H="[object Error]",re="[object Function]",ne="[object Map]",K="[object Number]",de="[object Object]",qe="[object Promise]",be="[object RegExp]",Xe="[object Set]",G="[object String]",ae="[object Symbol]",Pe="[object WeakMap]",tt="[object ArrayBuffer]",We="[object DataView]",bi=/^\[object .+?Constructor\]$/,hs=/^(?:0|[1-9]\d*)$/,Ge={};Ge["[object Float32Array]"]=Ge["[object Float64Array]"]=Ge["[object Int8Array]"]=Ge["[object Int16Array]"]=Ge["[object Int32Array]"]=Ge["[object Uint8Array]"]=Ge["[object Uint8ClampedArray]"]=Ge["[object Uint16Array]"]=Ge["[object Uint32Array]"]=!0,Ge[S]=Ge[k]=Ge[tt]=Ge[T]=Ge[We]=Ge[q]=Ge[H]=Ge[re]=Ge[ne]=Ge[K]=Ge[de]=Ge[be]=Ge[Xe]=Ge[G]=Ge[Pe]=!1;var To=typeof Un=="object"&&Un&&Un.Object===Object&&Un,ps=typeof self=="object"&&self&&self.Object===Object&&self,Vt=To||ps||Function("return this")(),Co=u&&!u.nodeType&&u,xo=Co&&a&&!a.nodeType&&a,Oo=xo&&xo.exports===Co,_i=Oo&&To.process,Io=function(){try{return _i&&_i.binding&&_i.binding("util")}catch{}}(),Lo=Io&&Io.isTypedArray;function gs(C,D){for(var ee=-1,ue=C==null?0:C.length;++ee<ue;)if(D(C[ee],ee,C))return!0;return!1}function ms(C){var D=-1,ee=Array(C.size);return C.forEach(function(ue,ze){ee[++D]=[ze,ue]}),ee}function vs(C){var D=-1,ee=Array(C.size);return C.forEach(function(ue){ee[++D]=ue}),ee}var Po,Ao,No,bs=Array.prototype,_s=Function.prototype,Tr=Object.prototype,yi=Vt["__core-js_shared__"],Ro=_s.toString,Rt=Tr.hasOwnProperty,Fo=(Po=/[^.]+$/.exec(yi&&yi.keys&&yi.keys.IE_PROTO||""))?"Symbol(src)_1."+Po:"",Do=Tr.toString,ys=RegExp("^"+Ro.call(Rt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Bo=Oo?Vt.Buffer:void 0,Cr=Vt.Symbol,Uo=Vt.Uint8Array,Go=Tr.propertyIsEnumerable,ws=bs.splice,_n=Cr?Cr.toStringTag:void 0,zo=Object.getOwnPropertySymbols,Es=Bo?Bo.isBuffer:void 0,Ss=(Ao=Object.keys,No=Object,function(C){return Ao(No(C))}),wi=Pn(Vt,"DataView"),Kn=Pn(Vt,"Map"),Ei=Pn(Vt,"Promise"),Si=Pn(Vt,"Set"),ki=Pn(Vt,"WeakMap"),Qn=Pn(Object,"create"),ks=En(wi),Ms=En(Kn),Ts=En(Ei),Cs=En(Si),xs=En(ki),jo=Cr?Cr.prototype:void 0,Mi=jo?jo.valueOf:void 0;function yn(C){var D=-1,ee=C==null?0:C.length;for(this.clear();++D<ee;){var ue=C[D];this.set(ue[0],ue[1])}}function qt(C){var D=-1,ee=C==null?0:C.length;for(this.clear();++D<ee;){var ue=C[D];this.set(ue[0],ue[1])}}function wn(C){var D=-1,ee=C==null?0:C.length;for(this.clear();++D<ee;){var ue=C[D];this.set(ue[0],ue[1])}}function xr(C){var D=-1,ee=C==null?0:C.length;for(this.__data__=new wn;++D<ee;)this.add(C[D])}function en(C){var D=this.__data__=new qt(C);this.size=D.size}function Os(C,D){var ee=Lr(C),ue=!ee&&Ns(C),ze=!ee&&!ue&&Ti(C),Me=!ee&&!ue&&!ze&&Ko(C),Ye=ee||ue||ze||Me,He=Ye?function($e,Ft){for(var Yt=-1,ut=Array($e);++Yt<$e;)ut[Yt]=Ft(Yt);return ut}(C.length,String):[],It=He.length;for(var Qe in C)!D&&!Rt.call(C,Qe)||Ye&&(Qe=="length"||ze&&(Qe=="offset"||Qe=="parent")||Me&&(Qe=="buffer"||Qe=="byteLength"||Qe=="byteOffset")||As(Qe,It))||He.push(Qe);return He}function Or(C,D){for(var ee=C.length;ee--;)if(Xo(C[ee][0],D))return ee;return-1}function $n(C){return C==null?C===void 0?"[object Undefined]":"[object Null]":_n&&_n in Object(C)?function(D){var ee=Rt.call(D,_n),ue=D[_n];try{D[_n]=void 0;var ze=!0}catch{}var Me=Do.call(D);return ze&&(ee?D[_n]=ue:delete D[_n]),Me}(C):function(D){return Do.call(D)}(C)}function Vo(C){return er(C)&&$n(C)==S}function qo(C,D,ee,ue,ze){return C===D||(C==null||D==null||!er(C)&&!er(D)?C!=C&&D!=D:function(Me,Ye,He,It,Qe,$e){var Ft=Lr(Me),Yt=Lr(Ye),ut=Ft?k:tn(Me),Jt=Yt?k:tn(Ye),An=(ut=ut==S?de:ut)==de,Pr=(Jt=Jt==S?de:Jt)==de,Nn=ut==Jt;if(Nn&&Ti(Me)){if(!Ti(Ye))return!1;Ft=!0,An=!1}if(Nn&&!An)return $e||($e=new en),Ft||Ko(Me)?Yo(Me,Ye,He,It,Qe,$e):function(Fe,Ae,Ar,nn,Ci,wt,Xt){switch(Ar){case We:if(Fe.byteLength!=Ae.byteLength||Fe.byteOffset!=Ae.byteOffset)return!1;Fe=Fe.buffer,Ae=Ae.buffer;case tt:return!(Fe.byteLength!=Ae.byteLength||!wt(new Uo(Fe),new Uo(Ae)));case T:case q:case K:return Xo(+Fe,+Ae);case H:return Fe.name==Ae.name&&Fe.message==Ae.message;case be:case G:return Fe==Ae+"";case ne:var rn=ms;case Xe:var nr=1&nn;if(rn||(rn=vs),Fe.size!=Ae.size&&!nr)return!1;var Nr=Xt.get(Fe);if(Nr)return Nr==Ae;nn|=2,Xt.set(Fe,Ae);var Rn=Yo(rn(Fe),rn(Ae),nn,Ci,wt,Xt);return Xt.delete(Fe),Rn;case ae:if(Mi)return Mi.call(Fe)==Mi.call(Ae)}return!1}(Me,Ye,ut,He,It,Qe,$e);if(!(1&He)){var tr=An&&Rt.call(Me,"__wrapped__"),Qo=Pr&&Rt.call(Ye,"__wrapped__");if(tr||Qo){var Fs=tr?Me.value():Me,Ds=Qo?Ye.value():Ye;return $e||($e=new en),Qe(Fs,Ds,He,It,$e)}}return Nn?($e||($e=new en),function(Fe,Ae,Ar,nn,Ci,wt){var Xt=1&Ar,rn=Jo(Fe),nr=rn.length,Nr=Jo(Ae).length;if(nr!=Nr&&!Xt)return!1;for(var Rn=nr;Rn--;){var Sn=rn[Rn];if(!(Xt?Sn in Ae:Rt.call(Ae,Sn)))return!1}var $o=wt.get(Fe);if($o&&wt.get(Ae))return $o==Ae;var Rr=!0;wt.set(Fe,Ae),wt.set(Ae,Fe);for(var xi=Xt;++Rn<nr;){var Fr=Fe[Sn=rn[Rn]],Dr=Ae[Sn];if(nn)var ea=Xt?nn(Dr,Fr,Sn,Ae,Fe,wt):nn(Fr,Dr,Sn,Fe,Ae,wt);if(!(ea===void 0?Fr===Dr||Ci(Fr,Dr,Ar,nn,wt):ea)){Rr=!1;break}xi||(xi=Sn=="constructor")}if(Rr&&!xi){var Br=Fe.constructor,Ur=Ae.constructor;Br==Ur||!("constructor"in Fe)||!("constructor"in Ae)||typeof Br=="function"&&Br instanceof Br&&typeof Ur=="function"&&Ur instanceof Ur||(Rr=!1)}return wt.delete(Fe),wt.delete(Ae),Rr}(Me,Ye,He,It,Qe,$e)):!1}(C,D,ee,ue,qo,ze))}function Is(C){return!(!Zo(C)||function(D){return!!Fo&&Fo in D}(C))&&(Wo(C)?ys:bi).test(En(C))}function Ls(C){if(ee=(D=C)&&D.constructor,ue=typeof ee=="function"&&ee.prototype||Tr,D!==ue)return Ss(C);var D,ee,ue,ze=[];for(var Me in Object(C))Rt.call(C,Me)&&Me!="constructor"&&ze.push(Me);return ze}function Yo(C,D,ee,ue,ze,Me){var Ye=1&ee,He=C.length,It=D.length;if(He!=It&&!(Ye&&It>He))return!1;var Qe=Me.get(C);if(Qe&&Me.get(D))return Qe==D;var $e=-1,Ft=!0,Yt=2&ee?new xr:void 0;for(Me.set(C,D),Me.set(D,C);++$e<He;){var ut=C[$e],Jt=D[$e];if(ue)var An=Ye?ue(Jt,ut,$e,D,C,Me):ue(ut,Jt,$e,C,D,Me);if(An!==void 0){if(An)continue;Ft=!1;break}if(Yt){if(!gs(D,function(Pr,Nn){if(tr=Nn,!Yt.has(tr)&&(ut===Pr||ze(ut,Pr,ee,ue,Me)))return Yt.push(Nn);var tr})){Ft=!1;break}}else if(ut!==Jt&&!ze(ut,Jt,ee,ue,Me)){Ft=!1;break}}return Me.delete(C),Me.delete(D),Ft}function Jo(C){return function(D,ee,ue){var ze=ee(D);return Lr(D)?ze:function(Me,Ye){for(var He=-1,It=Ye.length,Qe=Me.length;++He<It;)Me[Qe+He]=Ye[He];return Me}(ze,ue(D))}(C,Rs,Ps)}function Ir(C,D){var ee,ue,ze=C.__data__;return((ue=typeof(ee=D))=="string"||ue=="number"||ue=="symbol"||ue=="boolean"?ee!=="__proto__":ee===null)?ze[typeof D=="string"?"string":"hash"]:ze.map}function Pn(C,D){var ee=function(ue,ze){return ue==null?void 0:ue[ze]}(C,D);return Is(ee)?ee:void 0}yn.prototype.clear=function(){this.__data__=Qn?Qn(null):{},this.size=0},yn.prototype.delete=function(C){var D=this.has(C)&&delete this.__data__[C];return this.size-=D?1:0,D},yn.prototype.get=function(C){var D=this.__data__;if(Qn){var ee=D[C];return ee===h?void 0:ee}return Rt.call(D,C)?D[C]:void 0},yn.prototype.has=function(C){var D=this.__data__;return Qn?D[C]!==void 0:Rt.call(D,C)},yn.prototype.set=function(C,D){var ee=this.__data__;return this.size+=this.has(C)?0:1,ee[C]=Qn&&D===void 0?h:D,this},qt.prototype.clear=function(){this.__data__=[],this.size=0},qt.prototype.delete=function(C){var D=this.__data__,ee=Or(D,C);return!(ee<0)&&(ee==D.length-1?D.pop():ws.call(D,ee,1),--this.size,!0)},qt.prototype.get=function(C){var D=this.__data__,ee=Or(D,C);return ee<0?void 0:D[ee][1]},qt.prototype.has=function(C){return Or(this.__data__,C)>-1},qt.prototype.set=function(C,D){var ee=this.__data__,ue=Or(ee,C);return ue<0?(++this.size,ee.push([C,D])):ee[ue][1]=D,this},wn.prototype.clear=function(){this.size=0,this.__data__={hash:new yn,map:new(Kn||qt),string:new yn}},wn.prototype.delete=function(C){var D=Ir(this,C).delete(C);return this.size-=D?1:0,D},wn.prototype.get=function(C){return Ir(this,C).get(C)},wn.prototype.has=function(C){return Ir(this,C).has(C)},wn.prototype.set=function(C,D){var ee=Ir(this,C),ue=ee.size;return ee.set(C,D),this.size+=ee.size==ue?0:1,this},xr.prototype.add=xr.prototype.push=function(C){return this.__data__.set(C,h),this},xr.prototype.has=function(C){return this.__data__.has(C)},en.prototype.clear=function(){this.__data__=new qt,this.size=0},en.prototype.delete=function(C){var D=this.__data__,ee=D.delete(C);return this.size=D.size,ee},en.prototype.get=function(C){return this.__data__.get(C)},en.prototype.has=function(C){return this.__data__.has(C)},en.prototype.set=function(C,D){var ee=this.__data__;if(ee instanceof qt){var ue=ee.__data__;if(!Kn||ue.length<199)return ue.push([C,D]),this.size=++ee.size,this;ee=this.__data__=new wn(ue)}return ee.set(C,D),this.size=ee.size,this};var Ps=zo?function(C){return C==null?[]:(C=Object(C),function(D,ee){for(var ue=-1,ze=D==null?0:D.length,Me=0,Ye=[];++ue<ze;){var He=D[ue];ee(He,ue,D)&&(Ye[Me++]=He)}return Ye}(zo(C),function(D){return Go.call(C,D)}))}:function(){return[]},tn=$n;function As(C,D){return!!(D=D??y)&&(typeof C=="number"||hs.test(C))&&C>-1&&C%1==0&&C<D}function En(C){if(C!=null){try{return Ro.call(C)}catch{}try{return C+""}catch{}}return""}function Xo(C,D){return C===D||C!=C&&D!=D}(wi&&tn(new wi(new ArrayBuffer(1)))!=We||Kn&&tn(new Kn)!=ne||Ei&&tn(Ei.resolve())!=qe||Si&&tn(new Si)!=Xe||ki&&tn(new ki)!=Pe)&&(tn=function(C){var D=$n(C),ee=D==de?C.constructor:void 0,ue=ee?En(ee):"";if(ue)switch(ue){case ks:return We;case Ms:return ne;case Ts:return qe;case Cs:return Xe;case xs:return Pe}return D});var Ns=Vo(function(){return arguments}())?Vo:function(C){return er(C)&&Rt.call(C,"callee")&&!Go.call(C,"callee")},Lr=Array.isArray,Ti=Es||function(){return!1};function Wo(C){if(!Zo(C))return!1;var D=$n(C);return D==re||D=="[object GeneratorFunction]"||D=="[object AsyncFunction]"||D=="[object Proxy]"}function Ho(C){return typeof C=="number"&&C>-1&&C%1==0&&C<=y}function Zo(C){var D=typeof C;return C!=null&&(D=="object"||D=="function")}function er(C){return C!=null&&typeof C=="object"}var Ko=Lo?function(C){return function(D){return C(D)}}(Lo):function(C){return er(C)&&Ho(C.length)&&!!Ge[$n(C)]};function Rs(C){return(D=C)!=null&&Ho(D.length)&&!Wo(D)?Os(C):Ls(C);var D}a.exports=function(C,D){return qo(C,D)}})({get exports(){return kr},set exports(a){kr=a}},kr);var us=kr;function Mo(a,u){return a.length===u.length&&JSON.stringify(a.map(function(h){return h}).sort())===JSON.stringify(u.map(function(h){return h}).sort())}var fs={Polygon:Ve,LineString:ce,Point:I,MultiPolygon:et,MultiLineString:et,MultiPoint:et},cs=Object.freeze({__proto__:null,CommonSelectors:Jl,constrainFeatureMovement:mi,createMidPoint:mo,createSupplementaryPoints:vr,createVertex:In,doubleClickZoom:Ot,euclideanDistance:se,featuresAt:B,getFeatureAtAndSetCursors:Q,isClick:ke,isEventAtCoordinates:Sr,isTap:we,mapEventToBoundingBox:te,ModeHandler:t,moveFeatures:vi,sortFeatures:Y,stringSetsAreEqual:Mo,StringSet:N,theme:Qt,toDenseArray:pn}),ds=function(a,u){var h={options:a=function(S){S===void 0&&(S={});var k=Ne(S);return S.controls||(k.controls={}),S.displayControlsDefault===!1?k.controls=Ne(ss,S.controls):k.controls=Ne(ls,S.controls),(k=Ne(as,k)).styles=ko(k.styles,"cold").concat(ko(k.styles,"hot")),k}(a)};u=function(S,k){return k.modes=w,k.getFeatureIdsAt=function(T){return B.click({point:T},null,S).map(function(q){return q.properties.id})},k.getSelectedIds=function(){return S.store.getSelectedIds()},k.getSelected=function(){return{type:p.FEATURE_COLLECTION,features:S.store.getSelectedIds().map(function(T){return S.store.get(T)}).map(function(T){return T.toGeoJSON()})}},k.getSelectedPoints=function(){return{type:p.FEATURE_COLLECTION,features:S.store.getSelectedCoordinates().map(function(T){return{type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:T.coordinates}}})}},k.set=function(T){if(T.type===void 0||T.type!==p.FEATURE_COLLECTION||!Array.isArray(T.features))throw new Error("Invalid FeatureCollection");var q=S.store.createRenderBatch(),H=S.store.getAllIds().slice(),re=k.add(T),ne=new N(re);return(H=H.filter(function(K){return!ne.has(K)})).length&&k.delete(H),q(),re},k.add=function(T){var q=JSON.parse(JSON.stringify(vo(T))).features.map(function(H){if(H.id=H.id||Se(),H.geometry===null)throw new Error("Invalid geometry: null");if(S.store.get(H.id)===void 0||S.store.get(H.id).type!==H.geometry.type){var re=fs[H.geometry.type];if(re===void 0)throw new Error("Invalid geometry type: "+H.geometry.type+".");var ne=new re(S,H);S.store.add(ne)}else{var K=S.store.get(H.id);K.properties=H.properties,us(K.getCoordinates(),H.geometry.coordinates)||K.incomingCoords(H.geometry.coordinates)}return H.id});return S.store.render(),q},k.get=function(T){var q=S.store.get(T);if(q)return q.toGeoJSON()},k.getAll=function(){return{type:p.FEATURE_COLLECTION,features:S.store.getAll().map(function(T){return T.toGeoJSON()})}},k.delete=function(T){return S.store.delete(T,{silent:!0}),k.getMode()!==w.DIRECT_SELECT||S.store.getSelectedIds().length?S.store.render():S.events.changeMode(w.SIMPLE_SELECT,void 0,{silent:!0}),k},k.deleteAll=function(){return S.store.delete(S.store.getAllIds(),{silent:!0}),k.getMode()===w.DIRECT_SELECT?S.events.changeMode(w.SIMPLE_SELECT,void 0,{silent:!0}):S.store.render(),k},k.changeMode=function(T,q){return q===void 0&&(q={}),T===w.SIMPLE_SELECT&&k.getMode()===w.SIMPLE_SELECT?(Mo(q.featureIds||[],S.store.getSelectedIds())||(S.store.setSelected(q.featureIds,{silent:!0}),S.store.render()),k):(T===w.DIRECT_SELECT&&k.getMode()===w.DIRECT_SELECT&&q.featureId===S.store.getSelectedIds()[0]||S.events.changeMode(T,q,{silent:!0}),k)},k.getMode=function(){return S.events.getMode()},k.trash=function(){return S.events.trash({silent:!0}),k},k.combineFeatures=function(){return S.events.combineFeatures({silent:!0}),k},k.uncombineFeatures=function(){return S.events.uncombineFeatures({silent:!0}),k},k.setFeatureProperty=function(T,q,H){return S.store.setFeatureProperty(T,q,H),k},k}(h,u),h.api=u;var y=Wn(h);return u.onAdd=y.onAdd,u.onRemove=y.onRemove,u.types=d,u.options=a,u};function Mr(a){ds(a,this)}return Mr.modes=So,Mr.constants=x,Mr.lib=cs,Mr})})(Qc);const ol=Ws(Xi);function al(n){let e;return{c(){e=U("p"),e.textContent="Click an intervention to fill out its attributes"},m(t,r){R(t,e,r)},d(t){t&&F(e)}}}function $c(n){let e,t=n[0]==Gn&&al();return{c(){t&&t.c(),e=Kt()},m(r,i){t&&t.m(r,i),R(r,e,i)},p(r,[i]){r[0]==Gn?t||(t=al(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ce,o:Ce,d(r){t&&t.d(r),r&&F(e)}}}const Gn="edit-attribute";function Rl(){}function ed(n,e,t){let r,i,o;Je(n,At,c=>t(4,r=c)),Je(n,De,c=>t(5,i=c)),Je(n,ai,c=>t(6,o=c));let{mode:l}=e,{changeMode:s}=e;function f(){Mn(null)}return r.on("mousemove",c=>{if(l==Gn&&o==null){let _=r.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});var g=null;_.length>0&&(g=_[0].id),Lt.set(g)}}),r.on("mouseout",()=>{l==Gn&&o==null&&Lt.set(null)}),r.on("click",c=>{if(l==Gn){let g=r.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});g.length>0?Mn(g[0].id):Mn(null)}}),Di.subscribe(c=>{if(c){let g=i.features.find(_=>_.id==c);g.geometry.type=="Point"?r.flyTo({center:g.geometry.coordinates}):r.fitBounds(no(g),{padding:200,animate:!0,duration:500}),s(Gn)}}),n.$$set=c=>{"mode"in c&&t(0,l=c.mode),"changeMode"in c&&t(1,s=c.changeMode)},[l,s,Rl,f]}class td extends xe{constructor(e){super(),Oe(this,e,ed,$c,Ie,{mode:0,changeMode:1,start:2,stop:3})}get start(){return Rl}get stop(){return this.$$.ctx[3]}}function ll(n){let e;return{c(){e=U("p"),e.textContent="Click an intervention to edit its geometry"},m(t,r){R(t,e,r)},d(t){t&&F(e)}}}function nd(n){let e,t=n[0]==Wt&&ll();return{c(){t&&t.c(),e=Kt()},m(r,i){t&&t.m(r,i),R(r,e,i)},p(r,[i]){r[0]==Wt?t||(t=ll(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ce,o:Ce,d(r){t&&t.d(r),r&&F(e)}}}const Wt="edit-geometry";function Fl(){}function rd(n,e,t){let r;Je(n,At,_=>t(7,r=_));let{mode:i}=e,{routeSnapper:o}=e,{snapTool:l}=e,{drawControls:s}=e;function f(){c&&(s.changeMode("static"),s.deleteAll(),o.stop(),De.update(_=>{let m=_.features.find(d=>d.id==c);return delete m.properties.hide_while_editing,_})),c=null,Lt.set(null)}let c=null;r.on("mousemove",_=>{if(i==Wt&&c==null){let d=r.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});var m=null;d.length>0&&(m=d[0].id),Lt.set(m)}}),r.on("mouseout",()=>{i==Wt&&c==null&&Lt.set(null)}),r.on("click",_=>{if(i==Wt&&c==null){let m=r.queryRenderedFeatures(_.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0&&g(m[0].id)}}),l.addEventListener("new-route",_=>{if(i==Wt){const m=_.detail;De.update(d=>{let p=d.features.find(w=>w.id==c);return p.properties.length_meters=m.properties.length_meters,p.properties.waypoints=m.properties.waypoints,delete p.properties.hide_while_editing,p.geometry=m.geometry,d}),c=null}}),l.addEventListener("no-new-route",()=>{i==Wt&&(De.update(_=>{let m=_.features.find(d=>d.id==c);return delete m.properties.hide_while_editing,_}),c=null)}),r.on("draw.update",_=>{if(i==Wt){const m=_.features[0];De.update(d=>{let p=d.features.find(w=>w.id==c);return p.geometry=m.geometry,d})}}),r.on("draw.selectionchange",_=>{i==Wt&&_.features.length==0&&(s.changeMode("static"),s.deleteAll(),De.update(m=>{let d=m.features.find(p=>p.id==c);return delete d.properties.hide_while_editing,m}),c=null)});function g(_){Lt.set(null);let m;De.update(d=>(m=d.features.find(p=>p.id==_),m.properties.hide_while_editing=!0,d)),c=_,m.geometry.type=="LineString"?o.editExisting(m):m.geometry.type=="Polygon"?(s.add(m),s.changeMode("direct_select",{featureId:c})):m.geometry.type=="Point"&&(s.add(m),s.changeMode("simple_select"))}return n.$$set=_=>{"mode"in _&&t(0,i=_.mode),"routeSnapper"in _&&t(1,o=_.routeSnapper),"snapTool"in _&&t(2,l=_.snapTool),"drawControls"in _&&t(3,s=_.drawControls)},[i,o,l,s,Fl,f]}class id extends xe{constructor(e){super(),Oe(this,e,rd,nd,Ie,{mode:0,routeSnapper:1,snapTool:2,drawControls:3,start:4,stop:5})}get start(){return Fl}get stop(){return this.$$.ctx[5]}}let Ee;const Dl=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Dl.decode();let Yr=new Uint8Array;function ar(){return Yr.byteLength===0&&(Yr=new Uint8Array(Ee.memory.buffer)),Yr}function zn(n,e){return Dl.decode(ar().subarray(n,n+e))}const Ht=new Array(32).fill(void 0);Ht.push(void 0,null,!0,!1);let lr=Ht.length;function nt(n){lr===Ht.length&&Ht.push(Ht.length+1);const e=lr;return lr=Ht[e],Ht[e]=n,e}function Te(n){return Ht[n]}function od(n){n<36||(Ht[n]=lr,lr=n)}function Wi(n){const e=Te(n);return od(n),e}function Pi(n){return n==null}let Jr=new Float64Array;function ad(){return Jr.byteLength===0&&(Jr=new Float64Array(Ee.memory.buffer)),Jr}let Xr=new Int32Array;function rt(){return Xr.byteLength===0&&(Xr=new Int32Array(Ee.memory.buffer)),Xr}let un=0;const Wr=new TextEncoder("utf-8"),ld=typeof Wr.encodeInto=="function"?function(n,e){return Wr.encodeInto(n,e)}:function(n,e){const t=Wr.encode(n);return e.set(t),{read:n.length,written:t.length}};function jr(n,e,t){if(t===void 0){const s=Wr.encode(n),f=e(s.length);return ar().subarray(f,f+s.length).set(s),un=s.length,f}let r=n.length,i=e(r);const o=ar();let l=0;for(;l<r;l++){const s=n.charCodeAt(l);if(s>127)break;o[i+l]=s}if(l!==r){l!==0&&(n=n.slice(l)),i=t(i,r,r=l+n.length*3);const s=ar().subarray(i+l,i+r),f=ld(n,s);l+=f.written}return un=l,i}function Hi(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){const i=n.length;let o="[";i>0&&(o+=Hi(n[0]));for(let l=1;l<i;l++)o+=", "+Hi(n[l]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function sd(n,e){const t=e(n.length*1);return ar().set(n,t/1),un=n.length,t}function Ai(n,e){try{return n.apply(this,e)}catch(t){Ee.__wbindgen_exn_store(nt(t))}}class ei{static __wrap(e){const t=Object.create(ei.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Ee.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=Ee.__wbindgen_add_to_stack_pointer(-16),l=sd(e,Ee.__wbindgen_malloc),s=un;Ee.jsroutesnapper_new(o,l,s);var t=rt()[o/4+0],r=rt()[o/4+1],i=rt()[o/4+2];if(i)throw Wi(r);return ei.__wrap(t)}finally{Ee.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){Ee.jsroutesnapper_setConfig(this.ptr,nt(e))}toFinalFeature(){try{const r=Ee.__wbindgen_add_to_stack_pointer(-16);Ee.jsroutesnapper_toFinalFeature(r,this.ptr);var e=rt()[r/4+0],t=rt()[r/4+1];let i;return e!==0&&(i=zn(e,t).slice(),Ee.__wbindgen_free(e,t*1)),i}finally{Ee.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const r=Ee.__wbindgen_add_to_stack_pointer(-16);Ee.jsroutesnapper_renderGeojson(r,this.ptr);var e=rt()[r/4+0],t=rt()[r/4+1];return zn(e,t)}finally{Ee.__wbindgen_add_to_stack_pointer(16),Ee.__wbindgen_free(e,t)}}setSnapMode(e){Ee.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,r){return Ee.jsroutesnapper_onMouseMove(this.ptr,e,t,r)!==0}onClick(){Ee.jsroutesnapper_onClick(this.ptr)}onDragStart(){return Ee.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return Ee.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){Ee.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=Ee.__wbindgen_add_to_stack_pointer(-16);Ee.jsroutesnapper_editExisting(i,this.ptr,nt(e));var t=rt()[i/4+0],r=rt()[i/4+1];if(r)throw Wi(t)}finally{Ee.__wbindgen_add_to_stack_pointer(16)}}}async function ud(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function fd(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,t){const r=zn(e,t);return nt(r)},n.wbg.__wbindgen_object_drop_ref=function(e){Wi(e)},n.wbg.__wbindgen_boolean_get=function(e){const t=Te(e);return typeof t=="boolean"?t?1:0:2},n.wbg.__wbindgen_error_new=function(e,t){const r=new Error(zn(e,t));return nt(r)},n.wbg.__wbindgen_is_object=function(e){const t=Te(e);return typeof t=="object"&&t!==null},n.wbg.__wbindgen_is_undefined=function(e){return Te(e)===void 0},n.wbg.__wbindgen_in=function(e,t){return Te(e)in Te(t)},n.wbg.__wbindgen_number_get=function(e,t){const r=Te(t),i=typeof r=="number"?r:void 0;ad()[e/8+1]=Pi(i)?0:i,rt()[e/4+0]=!Pi(i)},n.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Te(e)==Te(t)},n.wbg.__wbindgen_string_get=function(e,t){const r=Te(t),i=typeof r=="string"?r:void 0;var o=Pi(i)?0:jr(i,Ee.__wbindgen_malloc,Ee.__wbindgen_realloc),l=un;rt()[e/4+1]=l,rt()[e/4+0]=o},n.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const r=String(Te(t)),i=jr(r,Ee.__wbindgen_malloc,Ee.__wbindgen_realloc),o=un;rt()[e/4+1]=o,rt()[e/4+0]=i},n.wbg.__wbindgen_object_clone_ref=function(e){const t=Te(e);return nt(t)},n.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const r=Te(e)[Te(t)];return nt(r)},n.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(Te(e))},n.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const r=Te(e)[t>>>0];return nt(r)},n.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return Te(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof Te(e)=="function"},n.wbg.__wbg_next_579e583d33566a86=function(e){const t=Te(e).next;return nt(t)},n.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Ai(function(e){const t=Te(e).next();return nt(t)},arguments)},n.wbg.__wbg_done_1b73b0672e15f234=function(e){return Te(e).done},n.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=Te(e).value;return nt(t)},n.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return nt(Symbol.iterator)},n.wbg.__wbg_get_765201544a2b6869=function(){return Ai(function(e,t){const r=Reflect.get(Te(e),Te(t));return nt(r)},arguments)},n.wbg.__wbg_call_97ae9d8645dc388b=function(){return Ai(function(e,t){const r=Te(e).call(Te(t));return nt(r)},arguments)},n.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(Te(e))},n.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=Te(e)instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=Te(e).buffer;return nt(t)},n.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(Te(e));return nt(t)},n.wbg.__wbg_set_83db9690f9353e79=function(e,t,r){Te(e).set(Te(t),r>>>0)},n.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return Te(e).length},n.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=Te(e)instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return nt(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=Te(t).stack,i=jr(r,Ee.__wbindgen_malloc,Ee.__wbindgen_realloc),o=un;rt()[e/4+1]=o,rt()[e/4+0]=i},n.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(zn(e,t))}finally{Ee.__wbindgen_free(e,t)}},n.wbg.__wbindgen_debug_string=function(e,t){const r=Hi(Te(t)),i=jr(r,Ee.__wbindgen_malloc,Ee.__wbindgen_realloc),o=un;rt()[e/4+1]=o,rt()[e/4+0]=i},n.wbg.__wbindgen_throw=function(e,t){throw new Error(zn(e,t))},n.wbg.__wbindgen_memory=function(){const e=Ee.memory;return nt(e)},n}function cd(n,e){return Ee=n.exports,Bl.__wbindgen_wasm_module=e,Jr=new Float64Array,Xr=new Int32Array,Yr=new Uint8Array,Ee}async function Bl(n){typeof n>"u"&&(n="/atip/split_line/assets/route_snapper_bg.wasm");const e=fd();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await ud(await n,e);return cd(t,r)}var cr,Zi,Gt,on;class dd{constructor(e,t,r){Oi(this,cr);Oi(this,Gt);this.controlDiv=r,this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new ei(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),console.log("JsRouteSnapper ready, waiting for idle event"),this.active=!1,this.loaded=!1,this.map.once("idle",()=>{console.log("JsRouteSnapper now usable"),this.map.addSource("route-snapper",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"route-points",type:"circle",source:"route-snapper",paint:{"circle-radius":["match",["get","type"],"unimportant",10/2,10],"circle-color":["match",["get","type"],"hovered","green","important","red","black"]},filter:["in","$type","Point"]}),this.map.addLayer({id:"route-lines",type:"line",source:"route-snapper",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":2.5},filter:["in","$type","LineString"]}),this.loaded=!0,this.map.on("mousemove",l=>{if(!this.active)return;const s={x:l.point.x-30,y:l.point.y},f=this.map.unproject(l.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(l.lngLat.lng,l.lngLat.lat,f)&&Dt(this,Gt,on).call(this)}),this.map.on("click",()=>{this.active&&(this.inner.onClick(),Dt(this,Gt,on).call(this))}),this.map.on("dragstart",l=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}),this.map.on("mouseup",l=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}),document.addEventListener("keypress",l=>{this.active&&l.key=="Enter"&&(l.preventDefault(),Dt(this,cr,Zi).call(this))}),document.addEventListener("keydown",l=>{this.active&&l.key=="Shift"&&(l.preventDefault(),this.inner.setSnapMode(!1),Dt(this,Gt,on).call(this))}),document.addEventListener("keyup",l=>{this.active&&l.key=="Shift"&&(l.preventDefault(),this.inner.setSnapMode(!0),Dt(this,Gt,on).call(this))}),this.stop()})}isActive(){return this.active}tearDown(){this.loaded&&(this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeSource("route-snapper"))}editExisting(e){if(!this.loaded){console.error("editExisting called before the map idle event received. Not starting tool.");return}e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.start(),this.inner.editExisting(e.properties.waypoints),Dt(this,Gt,on).call(this)}stop(){if(!this.loaded)return;this.active=!1,this.inner.clearState(),Dt(this,Gt,on).call(this),this.controlDiv.innerHTML="";let e=document.createElement("button");e.innerText="Route tool",e.type="button",e.onclick=()=>{this.controlDiv.dispatchEvent(new CustomEvent("activate")),this.start()},this.controlDiv.appendChild(e)}start(){if(this.active)return;this.active=!0;let e=document.createElement("button");e.type="button",e.innerText="Finish route",e.onclick=()=>{Dt(this,cr,Zi).call(this)};let t=document.createElement("button");t.type="button",t.innerText="Cancel",t.onclick=()=>{this.controlDiv.dispatchEvent(new CustomEvent("no-new-route")),this.stop()},this.controlDiv.innerHTML="";let r=document.createElement("div");r.style="display: flex; justify-content: space-evenly;",r.appendChild(e),r.appendChild(t),this.controlDiv.appendChild(r);let i=document.createElement("input");i.type="checkbox",i.id="avoidDoublingBack",i.onclick=()=>{this.inner.setConfig({avoid_doubling_back:i.checked}),Dt(this,Gt,on).call(this)};let o=document.createElement("label");o.innerText="Avoid doubling back",o.for=i.id;let l=document.createElement("div");l.appendChild(i),l.appendChild(o),this.controlDiv.append(l);const s=document.createElement("ul");s.innerHTML="<li><b>Click</b> green points on the transport network</br>to create snapped routes</li><li>Hold <b>Shift</b> to draw a point anywhere</li><li><b>Click and drag</b> any point to move it</li><li><b>Click</b> a red waypoint to delete it</li><li>Press <b>Enter</b> to finish route</li>",this.controlDiv.appendChild(s)}}cr=new WeakSet,Zi=function(){const e=this.inner.toFinalFeature();e?this.controlDiv.dispatchEvent(new CustomEvent("new-route",{detail:JSON.parse(e)})):this.controlDiv.dispatchEvent(new CustomEvent("no-new-route")),this.stop()},Gt=new WeakSet,on=function(){this.loaded&&this.map.getSource("route-snapper").setData(JSON.parse(this.inner.renderGeojson()))};async function hd(n,e){const t=await fetch(n),r=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,l=[];for(;;){const{done:c,value:g}=await r.read();if(c)break;l.push(g),o+=g.length;const _=100*o/i;e.style=`background: linear-gradient(to right, red ${_}%, transparent 0);`}let s=new Uint8Array(o),f=0;for(let c of l)s.set(c,f),f+=c.length;return s}function pd(n){let e,t;return{c(){e=U("div"),t=U("div"),t.textContent="Route tool loading..."},m(r,i){R(r,e,i),P(e,t),n[8](t),n[9](e)},p:Ce,i:Ce,o:Ce,d(r){r&&F(e),n[8](null),n[9](null)}}}const Ni="route";function gd(n,e,t){let r;Je(n,At,p=>t(10,r=p));let{mode:i}=e,{changeMode:o}=e,{url:l}=e,{snapTool:s}=e,f,{routeSnapper:c}=e;function g(){c.isActive()||c.start()}function _(){c==null||c.stop()}Yn(async()=>{await Bl(),console.log(`Grabbing ${l}`);try{const p=await hd(l,f);t(2,c=new dd(r,p,s))}catch(p){console.log(`Route tool broke: ${p}`),t(0,s.innerHTML="Failed to load",s)}s.addEventListener("activate",()=>{o(Ni)}),s.addEventListener("no-new-route",()=>{i==Ni&&o("edit-attribute")}),s.addEventListener("new-route",p=>{if(i==Ni){const w=p.detail;De.update(O=>(w.id=oo(O),w.properties.intervention_type="route",O.features.push(w),O)),o("edit-attribute"),Mn(w.id)}})}),to(()=>{c==null||c.tearDown()});function m(p){je[p?"unshift":"push"](()=>{f=p,t(1,f)})}function d(p){je[p?"unshift":"push"](()=>{s=p,t(0,s)})}return n.$$set=p=>{"mode"in p&&t(3,i=p.mode),"changeMode"in p&&t(4,o=p.changeMode),"url"in p&&t(5,l=p.url),"snapTool"in p&&t(0,s=p.snapTool),"routeSnapper"in p&&t(2,c=p.routeSnapper)},[s,f,c,i,o,l,g,_,m,d]}class md extends xe{constructor(e){super(),Oe(this,e,gd,pd,Ie,{mode:3,changeMode:4,url:5,snapTool:0,routeSnapper:2,start:6,stop:7})}get start(){return this.$$.ctx[6]}get stop(){return this.$$.ctx[7]}}function vd(n){let e;return{c(){e=U("p"),e.innerHTML="Click the map to add a vertex. Click the last vertex or press <strong>Enter</strong> to finish."},m(t,r){R(t,e,r)},d(t){t&&F(e)}}}function bd(n){let e;return{c(){e=U("p"),e.textContent="Click the map to draw a new point"},m(t,r){R(t,e,r)},d(t){t&&F(e)}}}function _d(n){let e;function t(o,l){if(o[1]=="point"&&o[0]==o[1])return bd;if(o[1]=="polygon"&&o[0]==o[1])return vd}let r=t(n),i=r&&r(n);return{c(){i&&i.c(),e=Kt()},m(o,l){i&&i.m(o,l),R(o,e,l)},p(o,[l]){r!==(r=t(o))&&(i&&i.d(1),i=r&&r(o),i&&(i.c(),i.m(e.parentNode,e)))},i:Ce,o:Ce,d(o){i&&i.d(o),o&&F(e)}}}function yd(n,e,t){let r;Je(n,At,_=>t(7,r=_));let{thisMode:i}=e,{mode:o}=e,{changeMode:l}=e,{drawControls:s}=e,f;function c(){s.changeMode(`draw_${i}`)}function g(){f=null,s.changeMode("static"),s.deleteAll()}return r.on("draw.create",_=>{if(o==i){const m=_.features[0];De.update(d=>(m.properties.intervention_type=i=="point"?"other":"area",m.id=oo(d),d.features.push(m),f=m.id,d))}}),r.on("draw.modechange",_=>{if(o==i){let m=f;l("edit-attribute"),m?(Mn(m),f=null):console.error(`After drawing a new ${i}, we lost the new feature ID`)}}),n.$$set=_=>{"thisMode"in _&&t(0,i=_.thisMode),"mode"in _&&t(1,o=_.mode),"changeMode"in _&&t(2,l=_.changeMode),"drawControls"in _&&t(3,s=_.drawControls)},[i,o,l,s,c,g]}class sl extends xe{constructor(e){super(),Oe(this,e,yd,_d,Ie,{thisMode:0,mode:1,changeMode:2,drawControls:3,start:4,stop:5})}get start(){return this.$$.ctx[4]}get stop(){return this.$$.ctx[5]}}function Ul(n,e,t){if(t===void 0&&(t={}),t.final===!0)return wd(n,e);var r=fn(n),i=fn(e),o=St(r[0]),l=St(i[0]),s=St(r[1]),f=St(i[1]),c=Math.sin(l-o)*Math.cos(f),g=Math.cos(s)*Math.sin(f)-Math.sin(s)*Math.cos(f)*Math.cos(l-o);return ur(Math.atan2(c,g))}function wd(n,e){var t=Ul(e,n);return t=(t+180)%360,t}function ul(n,e,t,r){r===void 0&&(r={});var i=fn(n),o=St(i[0]),l=St(i[1]),s=St(t),f=si(e,r.units),c=Math.asin(Math.sin(l)*Math.cos(f)+Math.cos(l)*Math.sin(f)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(f)*Math.cos(l),Math.cos(f)-Math.sin(l)*Math.sin(c)),_=ur(g),m=ur(c);return ft([_,m],r.properties)}function Ki(n){if(!n)throw new Error("geojson is required");var e=[];return xn(n,function(t){Ed(t,e)}),Tt(e)}function Ed(n,e){var t=[],r=n.geometry;if(r!==null){switch(r.type){case"Polygon":t=zt(r);break;case"LineString":t=[zt(r)]}t.forEach(function(i){var o=Sd(i,n.properties);o.forEach(function(l){l.id=e.length,e.push(l)})})}}function Sd(n,e){var t=[];return n.reduce(function(r,i){var o=dt([r,i],e);return o.bbox=kd(r,i),t.push(o),i}),t}function kd(n,e){var t=n[0],r=n[1],i=e[0],o=e[1],l=t<i?t:i,s=r<o?r:o,f=t>i?t:i,c=r>o?r:o;return[l,s,f,c]}var qn={},Md={get exports(){return qn},set exports(n){qn=n}},Qi={},Td={get exports(){return Qi},set exports(n){Qi=n}};(function(n,e){(function(t,r){n.exports=r()})(Un,function(){function t(v,b,E,M,x){(function j(A,Y,te,N,Z){for(;N>te;){if(N-te>600){var B=N-te+1,$=Y-te+1,Q=Math.log(B),se=.5*Math.exp(2*Q/3),ke=.5*Math.sqrt(Q*se*(B-se)/B)*($-B/2<0?-1:1),we=Math.max(te,Math.floor(Y-$*se/B+ke)),Se=Math.min(N,Math.floor(Y+(B-$)*se/B+ke));j(A,Y,we,Se,Z)}var Le=A[Y],ve=te,I=N;for(r(A,te,Y),Z(A[N],Le)>0&&r(A,te,N);ve<I;){for(r(A,ve,I),ve++,I--;Z(A[ve],Le)<0;)ve++;for(;Z(A[I],Le)>0;)I--}Z(A[te],Le)===0?r(A,te,I):r(A,++I,N),I<=Y&&(te=I+1),Y<=I&&(N=I-1)}})(v,b,E||0,M||v.length-1,x||i)}function r(v,b,E){var M=v[b];v[b]=v[E],v[E]=M}function i(v,b){return v<b?-1:v>b?1:0}var o=function(v){v===void 0&&(v=9),this._maxEntries=Math.max(4,v),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function l(v,b,E){if(!E)return b.indexOf(v);for(var M=0;M<b.length;M++)if(E(v,b[M]))return M;return-1}function s(v,b){f(v,0,v.children.length,b,v)}function f(v,b,E,M,x){x||(x=O(null)),x.minX=1/0,x.minY=1/0,x.maxX=-1/0,x.maxY=-1/0;for(var j=b;j<E;j++){var A=v.children[j];c(x,v.leaf?M(A):A)}return x}function c(v,b){return v.minX=Math.min(v.minX,b.minX),v.minY=Math.min(v.minY,b.minY),v.maxX=Math.max(v.maxX,b.maxX),v.maxY=Math.max(v.maxY,b.maxY),v}function g(v,b){return v.minX-b.minX}function _(v,b){return v.minY-b.minY}function m(v){return(v.maxX-v.minX)*(v.maxY-v.minY)}function d(v){return v.maxX-v.minX+(v.maxY-v.minY)}function p(v,b){return v.minX<=b.minX&&v.minY<=b.minY&&b.maxX<=v.maxX&&b.maxY<=v.maxY}function w(v,b){return b.minX<=v.maxX&&b.minY<=v.maxY&&b.maxX>=v.minX&&b.maxY>=v.minY}function O(v){return{children:v,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function z(v,b,E,M,x){for(var j=[b,E];j.length;)if(!((E=j.pop())-(b=j.pop())<=M)){var A=b+Math.ceil((E-b)/M/2)*M;t(v,A,b,E,x),j.push(b,A,A,E)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(v){var b=this.data,E=[];if(!w(v,b))return E;for(var M=this.toBBox,x=[];b;){for(var j=0;j<b.children.length;j++){var A=b.children[j],Y=b.leaf?M(A):A;w(v,Y)&&(b.leaf?E.push(A):p(v,Y)?this._all(A,E):x.push(A))}b=x.pop()}return E},o.prototype.collides=function(v){var b=this.data;if(!w(v,b))return!1;for(var E=[];b;){for(var M=0;M<b.children.length;M++){var x=b.children[M],j=b.leaf?this.toBBox(x):x;if(w(v,j)){if(b.leaf||p(v,j))return!0;E.push(x)}}b=E.pop()}return!1},o.prototype.load=function(v){if(!v||!v.length)return this;if(v.length<this._minEntries){for(var b=0;b<v.length;b++)this.insert(v[b]);return this}var E=this._build(v.slice(),0,v.length-1,0);if(this.data.children.length)if(this.data.height===E.height)this._splitRoot(this.data,E);else{if(this.data.height<E.height){var M=this.data;this.data=E,E=M}this._insert(E,this.data.height-E.height-1,!0)}else this.data=E;return this},o.prototype.insert=function(v){return v&&this._insert(v,this.data.height-1),this},o.prototype.clear=function(){return this.data=O([]),this},o.prototype.remove=function(v,b){if(!v)return this;for(var E,M,x,j=this.data,A=this.toBBox(v),Y=[],te=[];j||Y.length;){if(j||(j=Y.pop(),M=Y[Y.length-1],E=te.pop(),x=!0),j.leaf){var N=l(v,j.children,b);if(N!==-1)return j.children.splice(N,1),Y.push(j),this._condense(Y),this}x||j.leaf||!p(j,A)?M?(E++,j=M.children[E],x=!1):j=null:(Y.push(j),te.push(E),E=0,M=j,j=j.children[0])}return this},o.prototype.toBBox=function(v){return v},o.prototype.compareMinX=function(v,b){return v.minX-b.minX},o.prototype.compareMinY=function(v,b){return v.minY-b.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(v){return this.data=v,this},o.prototype._all=function(v,b){for(var E=[];v;)v.leaf?b.push.apply(b,v.children):E.push.apply(E,v.children),v=E.pop();return b},o.prototype._build=function(v,b,E,M){var x,j=E-b+1,A=this._maxEntries;if(j<=A)return s(x=O(v.slice(b,E+1)),this.toBBox),x;M||(M=Math.ceil(Math.log(j)/Math.log(A)),A=Math.ceil(j/Math.pow(A,M-1))),(x=O([])).leaf=!1,x.height=M;var Y=Math.ceil(j/A),te=Y*Math.ceil(Math.sqrt(A));z(v,b,E,te,this.compareMinX);for(var N=b;N<=E;N+=te){var Z=Math.min(N+te-1,E);z(v,N,Z,Y,this.compareMinY);for(var B=N;B<=Z;B+=Y){var $=Math.min(B+Y-1,Z);x.children.push(this._build(v,B,$,M-1))}}return s(x,this.toBBox),x},o.prototype._chooseSubtree=function(v,b,E,M){for(;M.push(b),!b.leaf&&M.length-1!==E;){for(var x=1/0,j=1/0,A=void 0,Y=0;Y<b.children.length;Y++){var te=b.children[Y],N=m(te),Z=(B=v,$=te,(Math.max($.maxX,B.maxX)-Math.min($.minX,B.minX))*(Math.max($.maxY,B.maxY)-Math.min($.minY,B.minY))-N);Z<j?(j=Z,x=N<x?N:x,A=te):Z===j&&N<x&&(x=N,A=te)}b=A||b.children[0]}var B,$;return b},o.prototype._insert=function(v,b,E){var M=E?v:this.toBBox(v),x=[],j=this._chooseSubtree(M,this.data,b,x);for(j.children.push(v),c(j,M);b>=0&&x[b].children.length>this._maxEntries;)this._split(x,b),b--;this._adjustParentBBoxes(M,x,b)},o.prototype._split=function(v,b){var E=v[b],M=E.children.length,x=this._minEntries;this._chooseSplitAxis(E,x,M);var j=this._chooseSplitIndex(E,x,M),A=O(E.children.splice(j,E.children.length-j));A.height=E.height,A.leaf=E.leaf,s(E,this.toBBox),s(A,this.toBBox),b?v[b-1].children.push(A):this._splitRoot(E,A)},o.prototype._splitRoot=function(v,b){this.data=O([v,b]),this.data.height=v.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(v,b,E){for(var M,x,j,A,Y,te,N,Z=1/0,B=1/0,$=b;$<=E-b;$++){var Q=f(v,0,$,this.toBBox),se=f(v,$,E,this.toBBox),ke=(x=Q,j=se,A=void 0,Y=void 0,te=void 0,N=void 0,A=Math.max(x.minX,j.minX),Y=Math.max(x.minY,j.minY),te=Math.min(x.maxX,j.maxX),N=Math.min(x.maxY,j.maxY),Math.max(0,te-A)*Math.max(0,N-Y)),we=m(Q)+m(se);ke<Z?(Z=ke,M=$,B=we<B?we:B):ke===Z&&we<B&&(B=we,M=$)}return M||E-b},o.prototype._chooseSplitAxis=function(v,b,E){var M=v.leaf?this.compareMinX:g,x=v.leaf?this.compareMinY:_;this._allDistMargin(v,b,E,M)<this._allDistMargin(v,b,E,x)&&v.children.sort(M)},o.prototype._allDistMargin=function(v,b,E,M){v.children.sort(M);for(var x=this.toBBox,j=f(v,0,b,x),A=f(v,E-b,E,x),Y=d(j)+d(A),te=b;te<E-b;te++){var N=v.children[te];c(j,v.leaf?x(N):N),Y+=d(j)}for(var Z=E-b-1;Z>=b;Z--){var B=v.children[Z];c(A,v.leaf?x(B):B),Y+=d(A)}return Y},o.prototype._adjustParentBBoxes=function(v,b,E){for(var M=E;M>=0;M--)c(b[M],v)},o.prototype._condense=function(v){for(var b=v.length-1,E=void 0;b>=0;b--)v[b].children.length===0?b>0?(E=v[b-1].children).splice(E.indexOf(v[b]),1):this.clear():s(v[b],this.toBBox)},o})})(Td);const Cd=ro(Uf),xd=ro(Nc);function ti(n){var e=[1/0,1/0,-1/0,-1/0];return Cn(n,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}ti.default=ti;const Od=Object.freeze(Object.defineProperty({__proto__:null,default:ti},Symbol.toStringTag,{value:"Module"})),Id=ro(Od);var Bt=Qi,Gl=Cd,zl=xd,Bn=Id.default,Ld=zl.featureEach;zl.coordEach;Gl.polygon;var fl=Gl.featureCollection;function jl(n){var e=new Bt(n);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Bn(t),Bt.prototype.insert.call(this,t)},e.load=function(t){var r=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:Bn(i),r.push(i)}):Ld(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:Bn(i),r.push(i)}),Bt.prototype.load.call(this,r)},e.remove=function(t,r){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Bn(t),Bt.prototype.remove.call(this,t,r)},e.clear=function(){return Bt.prototype.clear.call(this)},e.search=function(t){var r=Bt.prototype.search.call(this,this.toBBox(t));return fl(r)},e.collides=function(t){return Bt.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Bt.prototype.all.call(this);return fl(t)},e.toJSON=function(){return Bt.prototype.toJSON.call(this)},e.fromJSON=function(t){return Bt.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var r;if(t.bbox)r=t.bbox;else if(Array.isArray(t)&&t.length===4)r=t;else if(Array.isArray(t)&&t.length===6)r=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")r=Bn(t);else if(t.type==="FeatureCollection")r=Bn(t);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},e}Md.exports=jl;qn.default=jl;function Vl(n,e){var t={},r=[];if(n.type==="LineString"&&(n=Ct(n)),e.type==="LineString"&&(e=Ct(e)),n.type==="Feature"&&e.type==="Feature"&&n.geometry!==null&&e.geometry!==null&&n.geometry.type==="LineString"&&e.geometry.type==="LineString"&&n.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=cl(n,e);return i&&r.push(i),Tt(r)}var o=qn();return o.load(Ki(e)),Vn(Ki(n),function(l){Vn(o.search(l),function(s){var f=cl(l,s);if(f){var c=zt(f).join(",");t[c]||(t[c]=!0,r.push(f))}})}),Tt(r)}function cl(n,e){var t=zt(n),r=zt(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],l=t[1][0],s=t[1][1],f=r[0][0],c=r[0][1],g=r[1][0],_=r[1][1],m=(_-c)*(l-i)-(g-f)*(s-o),d=(g-f)*(o-c)-(_-c)*(i-f),p=(l-i)*(o-c)-(s-o)*(i-f);if(m===0)return d===0&&p===0,null;var w=d/m,O=p/m;if(w>=0&&w<=1&&O>=0&&O<=1){var z=i+w*(l-i),v=o+w*(s-o);return ft([z,v])}return null}function ni(n,e,t){t===void 0&&(t={});var r=ft([1/0,1/0],{dist:1/0}),i=0;return xn(n,function(o){for(var l=zt(o),s=0;s<l.length-1;s++){var f=ft(l[s]);f.properties.dist=ln(e,f,t);var c=ft(l[s+1]);c.properties.dist=ln(e,c,t);var g=ln(f,c,t),_=Math.max(f.properties.dist,c.properties.dist),m=Ul(f,c),d=ul(e,_,m+90,t),p=ul(e,_,m-90,t),w=Vl(dt([d.geometry.coordinates,p.geometry.coordinates]),dt([f.geometry.coordinates,c.geometry.coordinates])),O=null;w.features.length>0&&(O=w.features[0],O.properties.dist=ln(e,O,t),O.properties.location=i+ln(f,O,t)),f.properties.dist<r.properties.dist&&(r=f,r.properties.index=s,r.properties.location=i),c.properties.dist<r.properties.dist&&(r=c,r.properties.index=s+1,r.properties.location=i+g),O&&O.properties.dist<r.properties.dist&&(r=O,r.properties.index=s),i+=g}}),r}function Pd(n){var e=n[0],t=n[1],r=n[2],i=n[3],o=ln(n.slice(0,2),[r,t]),l=ln(n.slice(0,2),[e,i]);if(o>=l){var s=(t+i)/2;return[e,s-(r-e)/2,r,s+(r-e)/2]}else{var f=(e+r)/2;return[f-(i-t)/2,t,f+(i-t)/2,i]}}function Ad(n,e){e===void 0&&(e={});var t=e.precision,r=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,r=r==null||isNaN(r)?3:r,!n)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof r!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(n=JSON.parse(JSON.stringify(n)));var o=Math.pow(10,t);return Cn(n,function(l){Nd(l,o,r)}),n}function Nd(n,e,t){n.length>t&&n.splice(t,n.length);for(var r=0;r<n.length;r++)n[r]=Math.round(n[r]*e)/e;return n}function Rd(n,e){if(!n)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Ji(n),r=Ji(e);if(t!=="LineString")throw new Error("line must be LineString");if(r==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(r==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Ad(e,{precision:7});switch(r){case"Point":return $i(n,i);case"MultiPoint":return dl(n,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return dl(n,Vl(n,i))}}function dl(n,e){var t=[],r=qn();return xn(e,function(i){if(t.forEach(function(s,f){s.id=f}),!t.length)t=$i(n,i).features,t.forEach(function(s){s.bbox||(s.bbox=Pd(ti(s)))}),r.load(Tt(t));else{var o=r.search(i);if(o.features.length){var l=ql(i,o);t=t.filter(function(s){return s.id!==l.id}),r.remove(l),Vn($i(l,i),function(s){t.push(s),r.insert(s)})}}}),Tt(t)}function $i(n,e){var t=[],r=zt(n)[0],i=zt(n)[n.geometry.coordinates.length-1];if(Ri(r,fn(e))||Ri(i,fn(e)))return Tt([n]);var o=qn(),l=Ki(n);o.load(l);var s=o.search(e);if(!s.features.length)return Tt([n]);var f=ql(e,s),c=[r],g=Il(l,function(_,m,d){var p=zt(m)[1],w=fn(e);return d===f.id?(_.push(w),t.push(dt(_)),Ri(w,p)?[w]:[w,p]):(_.push(p),_)},c);return g.length>1&&t.push(dt(g)),Tt(t)}function ql(n,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,r=1/0;return Vn(e,function(i){var o=ni(i,n),l=o.properties.dist;l<r&&(t=i,r=l)}),t}function Ri(n,e){return n[0]===e[0]&&n[1]===e[1]}function Fd(n,e,t){var r=zt(t);if(Ji(t)!=="LineString")throw new Error("line must be a LineString");var i=ni(t,n),o=ni(t,e),l;i.properties.index<=o.properties.index?l=[i,o]:l=[o,i];for(var s=[l[0].geometry.coordinates],f=l[0].properties.index+1;f<l[1].properties.index+1;f++)s.push(r[f]);return s.push(l[1].geometry.coordinates),dt(s,t.properties)}function hl(n){let e;return{c(){e=U("p"),e.textContent="Click near a route to split it, or click on the map to cancel"},m(t,r){R(t,e,r)},d(t){t&&F(e)}}}function Dd(n){let e,t=n[0]==ri&&hl();return{c(){t&&t.c(),e=Kt()},m(r,i){t&&t.m(r,i),R(r,e,i)},p(r,[i]){r[0]==ri?t||(t=hl(),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ce,o:Ce,d(r){t&&t.d(r),r&&F(e)}}}const ri="split-route",Bd=10,Ud=30;let Fi="split-route";function Yl(){}function pl(n,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:n}}}function Gd(n,e,t){let r,i;Je(n,At,m=>t(5,r=m)),Je(n,De,m=>t(7,i=m));let{mode:o}=e,{changeMode:l}=e;function s(){t(4,f=null),c=null}let f=null,c=null;r.on("mousemove",m=>{if(o!=ri)return;t(4,f=pl(m.lngLat.toArray(),!1)),c=null;const d={x:m.point.x-Ud,y:m.point.y},p=r.unproject(m.point).distanceTo(r.unproject(d))/1e3;let w=[];for(let[O,z]of i.features.entries())if(z.geometry.type=="LineString"){let v=ni(z.geometry,f,{units:"kilometers"});v.properties.dist<=p&&w.push([O,v.geometry.coordinates,v.properties.dist])}w.sort((O,z)=>O[2]-z[2]),w.length>0&&(t(4,f=pl(w[0][1],!0)),c=w[0][0])}),r.on("click",m=>{if(o==ri){if(c!=null){let d=Rd(i.features[c],f);if(d.features.length==2){let p=d.features[0],w=d.features[1];De.update(O=>(p.id=O.features[c].id,w.id=oo(O),p.properties=JSON.parse(JSON.stringify(O.features[c].properties)),w.properties=JSON.parse(JSON.stringify(p.properties)),g(O.features[c],p,w,f),O.features.splice(c,1,p,w),O))}}l("edit-attribute")}}),ui(r,Fi,{type:"geojson",data:sr()}),Zt(r,{id:"draw-split-route",source:Fi,...co("black",Bd,["case",["==",["get","snapped"],!0],1,.5])});function g(m,d,p,w){d.properties.length_meters=qr(d.geometry,{units:"kilometers"})*1e3,p.properties.length_meters=qr(p.geometry,{units:"kilometers"})*1e3,d.properties.waypoints=[],p.properties.waypoints=[];let O=_(m,w),z=!0,v=0;for(let b of m.properties.waypoints){let E=_(m,ft([b.lon,b.lat]));if(z)if(E<O)d.properties.waypoints.push(b);else{let M=b.snapped&&m.properties.waypoints[v-1].snapped;d.properties.waypoints.push({lon:w.geometry.coordinates[0],lat:w.geometry.coordinates[1],snapped:M}),z=!1,p.properties.waypoints.push({lon:w.geometry.coordinates[0],lat:w.geometry.coordinates[1],snapped:M}),p.properties.waypoints.push(b)}else p.properties.waypoints.push(b);v++}}function _(m,d){let p=m.geometry.coordinates[0],w=Fd(p,d,m);return qr(w.geometry,{units:"kilometers"})*1e3}return n.$$set=m=>{"mode"in m&&t(0,o=m.mode),"changeMode"in m&&t(1,l=m.changeMode)},n.$$.update=()=>{if(n.$$.dirty&48){let m=sr();f&&m.features.push(f),r.getSource(Fi).setData(m)}},[o,l,Yl,s,f,r]}class zd extends xe{constructor(e){super(),Oe(this,e,Gd,Dd,Ie,{mode:0,changeMode:1,start:2,stop:3})}get start(){return Yl}get stop(){return this.$$.ctx[3]}}function gl(n){let e,t,r,i,o,l,s,f,c,g,_,m,d,p,w,O,z,v,b,E,M,x,j,A,Y,te,N,Z,B,$,Q,se,ke,we,Se,Le,ve,I,ce,Ve,hn,jt,et={mode:n[4],changeMode:n[11]};s=new td({props:et}),n[13](s);let le=n[1]&&n[2]&&ml(n),oe={thisMode:"point",mode:n[4],changeMode:n[11],drawControls:n[3]};E=new sl({props:oe}),n[17](E);let fi={thisMode:"polygon",mode:n[4],changeMode:n[11],drawControls:n[3]};N=new sl({props:fi}),n[19](N);function ci(_e){n[21](_e)}function pn(_e){n[22](_e)}let Jn={mode:n[4],changeMode:n[11],url:n[0]};n[1]!==void 0&&(Jn.routeSnapper=n[1]),n[2]!==void 0&&(Jn.snapTool=n[2]),$=new md({props:Jn}),n[20]($),je.push(()=>kt($,"routeSnapper",ci,n[1])),je.push(()=>kt($,"snapTool",pn,n[2]));let Re={mode:n[4],changeMode:n[11]};return ce=new zd({props:Re}),n[24](ce),{c(){e=U("div"),t=U("div"),r=U("button"),i=me("Edit attributes"),l=J(),he(s.$$.fragment),f=J(),c=U("div"),g=U("button"),_=me("Edit geometry"),d=J(),le&&le.c(),p=J(),w=U("div"),O=U("button"),z=me("New point"),b=J(),he(E.$$.fragment),M=J(),x=U("div"),j=U("button"),A=me("New polygon"),te=J(),he(N.$$.fragment),Z=J(),B=U("div"),he($.$$.fragment),ke=J(),we=U("div"),Se=U("button"),Le=me("Split route"),I=J(),he(ce.$$.fragment),X(r,"type","button"),r.disabled=o=n[4]=="edit-attribute",X(r,"class","svelte-51rdg3"),X(g,"type","button"),g.disabled=m=n[4]=="edit-geometry",X(g,"class","svelte-51rdg3"),X(O,"type","button"),O.disabled=v=n[4]=="point",X(O,"class","svelte-51rdg3"),X(j,"type","button"),j.disabled=Y=n[4]=="polygon",X(j,"class","svelte-51rdg3"),X(Se,"type","button"),Se.disabled=ve=n[4]=="split-route",X(Se,"class","svelte-51rdg3"),X(e,"class","toolbox svelte-51rdg3")},m(_e,Ne){R(_e,e,Ne),P(e,t),P(t,r),P(r,i),P(t,l),pe(s,t,null),P(e,f),P(e,c),P(c,g),P(g,_),P(c,d),le&&le.m(c,null),P(e,p),P(e,w),P(w,O),P(O,z),P(w,b),pe(E,w,null),P(e,M),P(e,x),P(x,j),P(j,A),P(x,te),pe(N,x,null),P(e,Z),P(e,B),pe($,B,null),P(e,ke),P(e,we),P(we,Se),P(Se,Le),P(we,I),pe(ce,we,null),Ve=!0,hn||(jt=[ie(r,"click",n[12]),ie(g,"click",n[14]),ie(O,"click",n[16]),ie(j,"click",n[18]),ie(Se,"click",n[23])],hn=!0)},p(_e,Ne){(!Ve||Ne&16&&o!==(o=_e[4]=="edit-attribute"))&&(r.disabled=o);const dr={};Ne&16&&(dr.mode=_e[4]),s.$set(dr),(!Ve||Ne&16&&m!==(m=_e[4]=="edit-geometry"))&&(g.disabled=m),_e[1]&&_e[2]?le?(le.p(_e,Ne),Ne&6&&V(le,1)):(le=ml(_e),le.c(),V(le,1),le.m(c,null)):le&&(it(),W(le,1,1,()=>{le=null}),ot()),(!Ve||Ne&16&&v!==(v=_e[4]=="point"))&&(O.disabled=v);const Xn={};Ne&16&&(Xn.mode=_e[4]),Ne&8&&(Xn.drawControls=_e[3]),E.$set(Xn),(!Ve||Ne&16&&Y!==(Y=_e[4]=="polygon"))&&(j.disabled=Y);const Wn={};Ne&16&&(Wn.mode=_e[4]),Ne&8&&(Wn.drawControls=_e[3]),N.$set(Wn);const Qt={};Ne&16&&(Qt.mode=_e[4]),Ne&1&&(Qt.url=_e[0]),!Q&&Ne&2&&(Q=!0,Qt.routeSnapper=_e[1],Mt(()=>Q=!1)),!se&&Ne&4&&(se=!0,Qt.snapTool=_e[2],Mt(()=>se=!1)),$.$set(Qt),(!Ve||Ne&16&&ve!==(ve=_e[4]=="split-route"))&&(Se.disabled=ve);const gn={};Ne&16&&(gn.mode=_e[4]),ce.$set(gn)},i(_e){Ve||(V(s.$$.fragment,_e),V(le),V(E.$$.fragment,_e),V(N.$$.fragment,_e),V($.$$.fragment,_e),V(ce.$$.fragment,_e),Ve=!0)},o(_e){W(s.$$.fragment,_e),W(le),W(E.$$.fragment,_e),W(N.$$.fragment,_e),W($.$$.fragment,_e),W(ce.$$.fragment,_e),Ve=!1},d(_e){_e&&F(e),n[13](null),ge(s),le&&le.d(),n[17](null),ge(E),n[19](null),ge(N),n[20](null),ge($),n[24](null),ge(ce),hn=!1,gt(jt)}}}function ml(n){let e,t,r={mode:n[4],routeSnapper:n[1],snapTool:n[2],drawControls:n[3]};return e=new id({props:r}),n[15](e),{c(){he(e.$$.fragment)},m(i,o){pe(e,i,o),t=!0},p(i,o){const l={};o&16&&(l.mode=i[4]),o&2&&(l.routeSnapper=i[1]),o&4&&(l.snapTool=i[2]),o&8&&(l.drawControls=i[3]),e.$set(l)},i(i){t||(V(e.$$.fragment,i),t=!0)},o(i){W(e.$$.fragment,i),t=!1},d(i){n[15](null),ge(e,i)}}}function jd(n){let e,t,r=n[3]&&gl(n);return{c(){r&&r.c(),e=Kt()},m(i,o){r&&r.m(i,o),R(i,e,o),t=!0},p(i,[o]){i[3]?r?(r.p(i,o),o&8&&V(r,1)):(r=gl(i),r.c(),V(r,1),r.m(e.parentNode,e)):r&&(it(),W(r,1,1,()=>{r=null}),ot())},i(i){t||(V(r),t=!0)},o(i){W(r),t=!1},d(i){r&&r.d(i),i&&F(e)}}}function Vd(n,e,t){let r;Je(n,At,B=>t(25,r=B));let{routeUrl:i}=e,o,l,s,f="edit-attribute",c,g,_,m,d,p;function w(B){let $={"edit-attribute":c,"edit-geometry":g,route:_,point:m,polygon:d,"split-route":p};if(f==B){console.log(`Mode is already ${f}, not changing`);return}console.log(`Stopping old mode ${f}`),$[f].stop(),t(4,f=B),console.log(`Starting new mode ${f}`),$[f].start()}Yn(()=>{let B={};B.onSetup=function(){return this.setActionableState(),{}},B.toDisplayFeatures=function(Q,se,ke){ke(se)},t(3,s=new ol({displayControlsDefault:!1,controls:{point:!0,polygon:!0},modes:Object.assign({static:B},ol.modes)})),r.addControl(s),s.changeMode("static");let $=document.getElementsByClassName("maplibregl-ctrl-top-right");for(;$.length>0;)$[0].remove()}),to(()=>{s&&(r.removeControl(s),t(3,s=null))});const O=()=>w("edit-attribute");function z(B){je[B?"unshift":"push"](()=>{c=B,t(5,c)})}const v=()=>w("edit-geometry");function b(B){je[B?"unshift":"push"](()=>{g=B,t(6,g)})}const E=()=>w("point");function M(B){je[B?"unshift":"push"](()=>{m=B,t(8,m)})}const x=()=>w("polygon");function j(B){je[B?"unshift":"push"](()=>{d=B,t(9,d)})}function A(B){je[B?"unshift":"push"](()=>{_=B,t(7,_)})}function Y(B){o=B,t(1,o)}function te(B){l=B,t(2,l)}const N=()=>w("split-route");function Z(B){je[B?"unshift":"push"](()=>{p=B,t(10,p)})}return n.$$set=B=>{"routeUrl"in B&&t(0,i=B.routeUrl)},[i,o,l,s,f,c,g,_,m,d,p,w,O,z,v,b,E,M,x,j,A,Y,te,N,Z]}class qd extends xe{constructor(e){super(),Oe(this,e,Vd,jd,Ie,{routeUrl:0})}}function Yd(n){let e,t,r,i,o,l,s,f;return{c(){e=U("div"),t=U("button"),t.textContent="Home",r=J(),i=U("button"),i.textContent="About",o=J(),l=U("button"),l.textContent="Instructions",X(t,"type","button"),X(t,"onclick","window.open('index.html');"),X(i,"type","button"),X(l,"type","button"),X(e,"slot","nav")},m(c,g){R(c,e,g),P(e,t),P(e,r),P(e,i),P(e,o),P(e,l),s||(f=[ie(i,"click",n[6]),ie(l,"click",n[7])],s=!0)},p:Ce,d(c){c&&F(e),s=!1,gt(f)}}}function Jd(n){let e,t,r,i,o,l,s,f,c,g,_,m;return o=new jc({props:{boundaryGeojson:n[3]}}),s=new Bc({props:{authorityName:n[4]}}),_=new Mc({}),{c(){e=U("div"),t=U("h1"),r=me(n[4]),i=J(),he(o.$$.fragment),l=J(),he(s.$$.fragment),f=J(),c=U("br"),g=J(),he(_.$$.fragment),X(e,"slot","sidebar")},m(d,p){R(d,e,p),P(e,t),P(t,r),P(t,i),pe(o,t,null),P(e,l),pe(s,e,null),P(e,f),P(e,c),P(e,g),pe(_,e,null),m=!0},p(d,p){const w={};p&8&&(w.boundaryGeojson=d[3]),o.$set(w)},i(d){m||(V(o.$$.fragment,d),V(s.$$.fragment,d),V(_.$$.fragment,d),m=!0)},o(d){W(o.$$.fragment,d),W(s.$$.fragment,d),W(_.$$.fragment,d),m=!1},d(d){d&&F(e),ge(o),ge(s),ge(_)}}}function Xd(n){let e,t,r,i,o,l,s,f,c,g,_,m;return e=new hc({props:{boundaryGeojson:n[3]}}),r=new Hc({}),o=new Kc({}),s=new qd({props:{routeUrl:n[2]}}),c=new Yc({props:{style:n[5]}}),_=new Xc({}),{c(){he(e.$$.fragment),t=J(),he(r.$$.fragment),i=J(),he(o.$$.fragment),l=J(),he(s.$$.fragment),f=J(),he(c.$$.fragment),g=J(),he(_.$$.fragment)},m(d,p){pe(e,d,p),R(d,t,p),pe(r,d,p),R(d,i,p),pe(o,d,p),R(d,l,p),pe(s,d,p),R(d,f,p),pe(c,d,p),R(d,g,p),pe(_,d,p),m=!0},p(d,p){const w={};p&8&&(w.boundaryGeojson=d[3]),e.$set(w);const O={};p&4&&(O.routeUrl=d[2]),s.$set(O)},i(d){m||(V(e.$$.fragment,d),V(r.$$.fragment,d),V(o.$$.fragment,d),V(s.$$.fragment,d),V(c.$$.fragment,d),V(_.$$.fragment,d),m=!0)},o(d){W(e.$$.fragment,d),W(r.$$.fragment,d),W(o.$$.fragment,d),W(s.$$.fragment,d),W(c.$$.fragment,d),W(_.$$.fragment,d),m=!1},d(d){ge(e,d),d&&F(t),ge(r,d),d&&F(i),ge(o,d),d&&F(l),ge(s,d),d&&F(f),ge(c,d),d&&F(g),ge(_,d)}}}function Wd(n){let e,t,r;return t=new _f({props:{style:n[5],$$slots:{default:[Xd]},$$scope:{ctx:n}}}),{c(){e=U("div"),he(t.$$.fragment),X(e,"slot","main")},m(i,o){R(i,e,o),pe(t,e,null),r=!0},p(i,o){const l={};o&8204&&(l.$$scope={dirty:o,ctx:i}),t.$set(l)},i(i){r||(V(t.$$.fragment,i),r=!0)},o(i){W(t.$$.fragment,i),r=!1},d(i){i&&F(e),ge(t)}}}function Hd(n){let e,t,r,i,o,l,s,f;e=new Mf({props:{$$slots:{main:[Wd],sidebar:[Jd],nav:[Yd]},$$scope:{ctx:n}}});function c(d){n[8](d)}let g={};n[0]!==void 0&&(g.open=n[0]),r=new Hs({props:g}),je.push(()=>kt(r,"open",c,n[0]));function _(d){n[9](d)}let m={};return n[1]!==void 0&&(m.open=n[1]),l=new mf({props:m}),je.push(()=>kt(l,"open",_,n[1])),{c(){he(e.$$.fragment),t=J(),he(r.$$.fragment),o=J(),he(l.$$.fragment)},m(d,p){pe(e,d,p),R(d,t,p),pe(r,d,p),R(d,o,p),pe(l,d,p),f=!0},p(d,[p]){const w={};p&8204&&(w.$$scope={dirty:p,ctx:d}),e.$set(w);const O={};!i&&p&1&&(i=!0,O.open=d[0],Mt(()=>i=!1)),r.$set(O);const z={};!s&&p&2&&(s=!0,z.open=d[1],Mt(()=>s=!1)),l.$set(z)},i(d){f||(V(e.$$.fragment,d),V(r.$$.fragment,d),V(l.$$.fragment,d),f=!0)},o(d){W(e.$$.fragment,d),W(r.$$.fragment,d),W(l.$$.fragment,d),f=!1},d(d){ge(e,d),d&&F(t),ge(r,d),d&&F(o),ge(l,d)}}}function Zd(n,e,t){let r=!1,i=!1,o=window.location.hostname.includes("atip.uk");const l=new URLSearchParams(window.location.search);let s=l.get("authority"),f=l.get("style")||"streets";var c=`https://atip.uk/route-snappers/${s}.bin`;o||(c=`https://atip.uk/route-snappers-dev/${s}.bin`);function g(){t(0,r=!r),t(1,i=!1)}function _(){t(1,i=!i),t(0,r=!1)}let m;Yn(async()=>{t(3,m=await d())});async function d(){const z=await(await fetch(Zs)).text(),v=JSON.parse(z);return v.features=v.features.filter(b=>b.properties.name==s),v}function p(O){r=O,t(0,r)}function w(O){i=O,t(1,i)}return[r,i,c,m,s,f,g,_,p,w]}class Kd extends xe{constructor(e){super(),Oe(this,e,Zd,Hd,Ie,{})}}new Kd({target:document.getElementById("app")});
