var Es=Object.defineProperty;var Ms=(n,e,r)=>e in n?Es(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var se=(n,e,r)=>(Ms(n,typeof e!="symbol"?e+"":e,r),r);import{S as j,i as Q,s as K,F as co,h as P,m as L,t as b,o as w,q as C,K as bn,E as gt,f as R,e as D,j as x,k as v,w as Mt,x as ke,p as $,N as jt,O as pe,P as Tn,Q as Qt,T as er,U as tr,V as Ke,W as Un,X as Ps,Y as ue,Z as ne,_ as ie,$ as po,a0 as Ls,r as q,a1 as Ae,a2 as Cs,a3 as Te,a4 as Fs,a5 as Rs,a6 as W,C as rr,a7 as As,a8 as Ns,a9 as Os,aa as Ye,ab as wn,ac as kn,ad as Is,ae as ho,af as Ne,ag as Bs,ah as Ds,ai as Gs,aj as mo,ak as Ts,al as Us,am as ve,an as Sn,ao as xs,G as ht,ap as qs,l as J,a as re,v as G,J as ge,b as ce,c as de,n as _e,aq as go,ar as ye,u as We,H as Pt,as as En,at as xn,au as Be,av as Zr,aw as zs,ax as Ys,ay as Ie,az as wr,aA as qn,aB as nt,aC as _o,aD as sr,aE as Js,aF as Mn,R as yo,I as Dr,aG as Pn,aH as Xs,aI as Vs,B as Ws,d as vo,aJ as zn,aK as Hs,M as Zs,aL as Yn,L as Ks,g as js,y as Qs,z as el}from"./index-8b819676.js";import{M as Kr,C as tl,a as jr,B as He,R as rl,b as Lt,c as nl,d as $o,t as il,r as Qr,S as ol,Z as sl,G as ll}from"./ZoomOutMap-bff6ffab.js";import{D as at,A as al}from"./About-7ed44e1a.js";function ul(n){let e,r,t,o,i,s;return e=new gt({props:{errorMessage:n[2]}}),{c(){P(e.$$.fragment),r=R(),t=D("input"),x(t,"type","text"),x(t,"class","govuk-input"),x(t,"id",n[3])},m(l,a){L(e,l,a),v(l,r,a),v(l,t,a),Mt(t,n[0]),o=!0,i||(s=ke(t,"input",n[5]),i=!0)},p(l,a){const u={};a&4&&(u.errorMessage=l[2]),e.$set(u),a&1&&t.value!==l[0]&&Mt(t,l[0])},i(l){o||(b(e.$$.fragment,l),o=!0)},o(l){w(e.$$.fragment,l),o=!1},d(l){l&&($(r),$(t)),C(e,l),i=!1,s()}}}function fl(n){let e,r;return e=new co({props:{label:n[1],id:n[3],$$slots:{default:[ul]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,[o]){const i={};o&2&&(i.label=t[1]),o&69&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function cl(n,e,r){let t,{label:o}=e,{value:i}=e,{required:s=!1}=e,l=bn();function a(){i=this.value,r(0,i)}return n.$$set=u=>{"label"in u&&r(1,o=u.label),"value"in u&&r(0,i=u.value),"required"in u&&r(4,s=u.required)},n.$$.update=()=>{n.$$.dirty&17&&r(2,t=s&&(i==null||i=="")?"Required":"")},[i,o,t,l,s,a]}class pl extends j{constructor(e){super(),Q(this,e,cl,fl,K,{label:1,value:0,required:4})}}function dl(n){let e,r,t,o;const i=n[2].default,s=jt(i,n,n[1],null);let l=[{type:"button"},{class:"govuk-button govuk-button--warning"},{"data-module":"govuk-button"},n[0]],a={};for(let u=0;u<l.length;u+=1)a=pe(a,l[u]);return{c(){e=D("button"),s&&s.c(),Tn(e,a)},m(u,c){v(u,e,c),s&&s.m(e,null),e.autofocus&&e.focus(),r=!0,t||(o=ke(e,"click",n[3]),t=!0)},p(u,[c]){s&&s.p&&(!r||c&2)&&Qt(s,i,u,u[1],r?tr(i,u[1],c,null):er(u[1]),null),Tn(e,a=Ke(l,[{type:"button"},{class:"govuk-button govuk-button--warning"},{"data-module":"govuk-button"},c&1&&u[0]]))},i(u){r||(b(s,u),r=!0)},o(u){w(s,u),r=!1},d(u){u&&$(e),s&&s.d(u),t=!1,o()}}}function hl(n,e,r){let{$$slots:t={},$$scope:o}=e;function i(s){Ps.call(this,n,s)}return n.$$set=s=>{r(0,e=pe(pe({},e),Un(s))),"$$scope"in s&&r(1,o=s.$$scope)},e=Un(e),[e,o,t,i]}class _t extends j{constructor(e){super(),Q(this,e,hl,dl,K,{})}}function Jn(n){let e=n[0],r,t,o=Xn(n);return{c(){o.c(),r=ue()},m(i,s){o.m(i,s),v(i,r,s),t=!0},p(i,s){s&1&&K(e,e=i[0])?(ne(),w(o,1,1,W),ie(),o=Xn(i),o.c(),b(o,1),o.m(r.parentNode,r)):o.p(i,s)},i(i){t||(b(o),t=!0)},o(i){w(o),t=!1},d(i){i&&$(r),o.d(i)}}}function Xn(n){let e;const r=n[10].default,t=jt(r,n,n[9],null);return{c(){t&&t.c()},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&512)&&Qt(t,r,o,o[9],e?tr(r,o[9],i,null):er(o[9]),null)},i(o){e||(b(t,o),e=!0)},o(o){w(t,o),e=!1},d(o){t&&t.d(o)}}}function ml(n){let e,r,t=n[0]&&Jn(n);return{c(){t&&t.c(),e=ue()},m(o,i){t&&t.m(o,i),v(o,e,i),r=!0},p(o,[i]){o[0]?t?(t.p(o,i),i&1&&b(t,1)):(t=Jn(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(ne(),w(t,1,1,()=>{t=null}),ie())},i(o){r||(b(t),r=!0)},o(o){w(t),r=!1},d(o){o&&$(e),t&&t.d(o)}}}function gl(n,e,r){let t,o,{$$slots:i={},$$scope:s}=e,{id:l=po("image")}=e,{url:a}=e,{coordinates:u}=e;const{map:c,self:f}=Ls();q(n,c,h=>r(8,o=h)),q(n,f,h=>r(0,t=h));let d,p=!0;return Ae(()=>{t&&o&&(Cs(c,t,d),Te(f,t=null,t),r(6,d=void 0))}),n.$$set=h=>{"id"in h&&r(3,l=h.id),"url"in h&&r(4,a=h.url),"coordinates"in h&&r(5,u=h.coordinates),"$$scope"in h&&r(9,s=h.$$scope)},n.$$.update=()=>{n.$$.dirty&313&&o&&t!==l&&(Te(f,t=l,t),Fs(o,t,Rs({type:"image",url:a,coordinates:u}),h=>o&&h===t,()=>{t&&(r(6,d=o==null?void 0:o.getSource(t)),r(7,p=!0))})),n.$$.dirty&264&&(o==null||o.on("style.load",()=>{r(6,d=o==null?void 0:o.getSource(l))})),n.$$.dirty&224&&d&&(p?r(7,p=!1):d.setCoordinates(u))},[t,c,f,l,a,u,d,p,o,s,i]}class _l extends j{constructor(e){super(),Q(this,e,gl,ml,K,{id:3,url:4,coordinates:5})}}class Tr{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const r=this._partials;let t=0;for(let o=0;o<this._n&&o<32;o++){const i=r[o],s=e+i,l=Math.abs(e)<Math.abs(i)?e-(s-i):i-(s-e);l&&(r[t++]=l),e=s}return r[t]=e,this._n=t+1,this}valueOf(){const e=this._partials;let r=this._n,t,o,i,s=0;if(r>0){for(s=e[--r];r>0&&(t=s,o=e[--r],s=t+o,i=o-(s-t),!i););r>0&&(i<0&&e[r-1]<0||i>0&&e[r-1]>0)&&(o=i*2,t=s+o,o==t-s&&(s=t))}return s}}var yl=1e-6,Vn=1e-12,Ln=Math.PI,Wn=Ln/2,Hn=180/Ln,Je=Ln/180,bo=Math.atan2,Xe=Math.cos,en=Math.hypot,Ve=Math.sin,vl=Math.sqrt;function wo(n){return n>1?Wn:n<-1?-Wn:Math.asin(n)}function $l(){}function kr(n,e){n&&Kn.hasOwnProperty(n.type)&&Kn[n.type](n,e)}var Zn={Feature:function(n,e){kr(n.geometry,e)},FeatureCollection:function(n,e){for(var r=n.features,t=-1,o=r.length;++t<o;)kr(r[t].geometry,e)}},Kn={Sphere:function(n,e){e.sphere()},Point:function(n,e){n=n.coordinates,e.point(n[0],n[1],n[2])},MultiPoint:function(n,e){for(var r=n.coordinates,t=-1,o=r.length;++t<o;)n=r[t],e.point(n[0],n[1],n[2])},LineString:function(n,e){tn(n.coordinates,e,0)},MultiLineString:function(n,e){for(var r=n.coordinates,t=-1,o=r.length;++t<o;)tn(r[t],e,0)},Polygon:function(n,e){jn(n.coordinates,e)},MultiPolygon:function(n,e){for(var r=n.coordinates,t=-1,o=r.length;++t<o;)jn(r[t],e)},GeometryCollection:function(n,e){for(var r=n.geometries,t=-1,o=r.length;++t<o;)kr(r[t],e)}};function tn(n,e,r){var t=-1,o=n.length-r,i;for(e.lineStart();++t<o;)i=n[t],e.point(i[0],i[1],i[2]);e.lineEnd()}function jn(n,e){var r=-1,t=n.length;for(e.polygonStart();++r<t;)tn(n[r],e,1);e.polygonEnd()}function bl(n,e){n&&Zn.hasOwnProperty(n.type)?Zn[n.type](n,e):kr(n,e)}var Dt,Sr,Er,Mr,Pr,Lr,Cr,Fr,rn,nn,on,ko,So,Se,Ee,Me,De={sphere:$l,point:Cn,lineStart:Qn,lineEnd:ei,polygonStart:function(){De.lineStart=Sl,De.lineEnd=El},polygonEnd:function(){De.lineStart=Qn,De.lineEnd=ei}};function Cn(n,e){n*=Je,e*=Je;var r=Xe(e);nr(r*Xe(n),r*Ve(n),Ve(e))}function nr(n,e,r){++Dt,Er+=(n-Er)/Dt,Mr+=(e-Mr)/Dt,Pr+=(r-Pr)/Dt}function Qn(){De.point=wl}function wl(n,e){n*=Je,e*=Je;var r=Xe(e);Se=r*Xe(n),Ee=r*Ve(n),Me=Ve(e),De.point=kl,nr(Se,Ee,Me)}function kl(n,e){n*=Je,e*=Je;var r=Xe(e),t=r*Xe(n),o=r*Ve(n),i=Ve(e),s=bo(vl((s=Ee*i-Me*o)*s+(s=Me*t-Se*i)*s+(s=Se*o-Ee*t)*s),Se*t+Ee*o+Me*i);Sr+=s,Lr+=s*(Se+(Se=t)),Cr+=s*(Ee+(Ee=o)),Fr+=s*(Me+(Me=i)),nr(Se,Ee,Me)}function ei(){De.point=Cn}function Sl(){De.point=Ml}function El(){Eo(ko,So),De.point=Cn}function Ml(n,e){ko=n,So=e,n*=Je,e*=Je,De.point=Eo;var r=Xe(e);Se=r*Xe(n),Ee=r*Ve(n),Me=Ve(e),nr(Se,Ee,Me)}function Eo(n,e){n*=Je,e*=Je;var r=Xe(e),t=r*Xe(n),o=r*Ve(n),i=Ve(e),s=Ee*i-Me*o,l=Me*t-Se*i,a=Se*o-Ee*t,u=en(s,l,a),c=wo(u),f=u&&-c/u;rn.add(f*s),nn.add(f*l),on.add(f*a),Sr+=c,Lr+=c*(Se+(Se=t)),Cr+=c*(Ee+(Ee=o)),Fr+=c*(Me+(Me=i)),nr(Se,Ee,Me)}function Pl(n){Dt=Sr=Er=Mr=Pr=Lr=Cr=Fr=0,rn=new Tr,nn=new Tr,on=new Tr,bl(n,De);var e=+rn,r=+nn,t=+on,o=en(e,r,t);return o<Vn&&(e=Lr,r=Cr,t=Fr,Sr<yl&&(e=Er,r=Mr,t=Pr),o=en(e,r,t),o<Vn)?[NaN,NaN]:[bo(r,e)*Hn,wo(t/o)*Hn]}const{Map:Ll}=ho;function ti(n,e,r){const t=n.slice();t[40]=e[r];const o=t[1](t[40]);t[41]=o;const i=typeof t[7]=="function"?t[7](t[40]):t[7];return t[42]=i,t}const Cl=n=>({feature:n[0]&1024,position:n[0]&1026}),ri=n=>({feature:n[40],position:n[41]});function ni(n){let e=[],r=new Ll,t,o,i=Ye(n[10]);const s=l=>l[40].id;for(let l=0;l<i.length;l+=1){let a=ti(n,i,l),u=s(a);r.set(u,e[l]=ii(u,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();t=ue()},m(l,a){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(l,a);v(l,t,a),o=!0},p(l,a){a[0]&264095|a[1]&4&&(i=Ye(l[10]),ne(),e=wn(e,a,s,1,l,i,r,t.parentNode,kn,ii,t,ti),ie())},i(l){if(!o){for(let a=0;a<i.length;a+=1)b(e[a]);o=!0}},o(l){for(let a=0;a<e.length;a+=1)w(e[a]);o=!1},d(l){l&&$(t);for(let a=0;a<e.length;a+=1)e[a].d(l)}}}function Fl(n){let e,r;const t=n[24].default,o=jt(t,n,n[33],ri);return{c(){o&&o.c(),e=R()},m(i,s){o&&o.m(i,s),v(i,e,s),r=!0},p(i,s){o&&o.p&&(!r||s[0]&1026|s[1]&4)&&Qt(o,t,i,i[33],r?tr(t,i[33],s,Cl):er(i[33]),ri)},i(i){r||(b(o,i),r=!0)},o(i){w(o,i),r=!1},d(i){i&&$(e),o&&o.d(i)}}}function ii(n,e){let r,t,o;function i(){return e[25](e[40])}function s(){return e[26](e[40])}function l(...p){return e[27](e[40],...p)}function a(...p){return e[28](e[40],...p)}function u(...p){return e[29](e[40],...p)}function c(...p){return e[30](e[40],...p)}function f(...p){return e[31](e[40],...p)}function d(...p){return e[32](e[40],...p)}return t=new Kr({props:{asButton:e[3],interactive:e[2],draggable:e[4],class:e[8],zIndex:e[42],lngLat:e[41],$$slots:{default:[Fl]},$$scope:{ctx:e}}}),t.$on("mouseenter",i),t.$on("mouseleave",s),t.$on("dragstart",l),t.$on("drag",a),t.$on("dragend",u),t.$on("click",c),t.$on("dblclick",f),t.$on("contextmenu",d),{key:n,first:null,c(){r=ue(),P(t.$$.fragment),this.first=r},m(p,h){v(p,r,h),L(t,p,h),o=!0},p(p,h){e=p;const g={};h[0]&8&&(g.asButton=e[3]),h[0]&4&&(g.interactive=e[2]),h[0]&16&&(g.draggable=e[4]),h[0]&256&&(g.class=e[8]),h[0]&1152&&(g.zIndex=e[42]),h[0]&1026&&(g.lngLat=e[41]),h[0]&1026|h[1]&4&&(g.$$scope={dirty:h,ctx:e}),t.$set(g)},i(p){o||(b(t.$$.fragment,p),o=!0)},o(p){w(t.$$.fragment,p),o=!1},d(p){p&&$(r),C(t,p)}}}function Rl(n){let e,r,t,o;e=new rr({props:{minzoom:n[5],maxzoom:n[6],paint:{"fill-opacity":0},beforeLayerType:"symbol"}});let i=n[11]>=n[13]&&n[11]<=n[12]&&ni(n);return{c(){P(e.$$.fragment),r=R(),i&&i.c(),t=ue()},m(s,l){L(e,s,l),v(s,r,l),i&&i.m(s,l),v(s,t,l),o=!0},p(s,l){const a={};l[0]&32&&(a.minzoom=s[5]),l[0]&64&&(a.maxzoom=s[6]),e.$set(a),s[11]>=s[13]&&s[11]<=s[12]?i?(i.p(s,l),l[0]&14336&&b(i,1)):(i=ni(s),i.c(),b(i,1),i.m(t.parentNode,t)):i&&(ne(),w(i,1,1,()=>{i=null}),ie())},i(s){o||(b(e.$$.fragment,s),b(i),o=!0)},o(s){w(e.$$.fragment,s),w(i),o=!1},d(s){s&&($(r),$(t)),C(e,s),i&&i.d(s)}}}function Al(n,e,r){let t,o,i,s,l,a,u,{$$slots:c={},$$scope:f}=e;const{map:d,source:p,minzoom:h,maxzoom:g}=As();q(n,d,Y=>r(21,s=Y)),q(n,p,Y=>r(9,l=Y)),q(n,h,Y=>r(23,u=Y)),q(n,g,Y=>r(22,a=Y));const y=Ns();let{applyToClusters:S=void 0}=e,{filter:_=void 0}=e,{markerLngLat:m=Pl}=e,{interactive:M=!0}=e,{asButton:E=!1}=e,{draggable:k=!1}=e,{minzoom:A=void 0}=e,{maxzoom:B=void 0}=e,{hovered:T=null}=e,{zIndex:z=void 0}=e,{class:N=void 0}=e,O=!1;function I(){s&&(O=!0,s.on("zoom",Re),s.on("move",te),s.on("moveend",te),s.loaded()?s.once("load",te):te())}function F(Y){Y.sourceId===l&&Y.isSourceLoaded&&(O?te():I())}Ae(()=>{s&&(s.off("zoom",Re),s.off("move",te),s.off("moveend",te),s.off("sourcedata",F))});let ee=[];function te(){var Gn;if(!s||!l)return;let Y=s.querySourceFeatures(l,{filter:i}),Le=new Map;for(let Ze of Y)Ze.id||((Gn=Ze.properties)!=null&&Gn.cluster_id?Ze.id="autocluster_"+Ze.properties.cluster_id:Ze.id=po("autofeat")),Le.set(Ze.id,Ze);r(10,ee=[...Le.values()].sort((Ze,Ss)=>Ze.id.toString().localeCompare(Ss.id.toString())))}let he=(s==null?void 0:s.getZoom())??0;function Re(Y){r(11,he=s.getZoom()),te()}const $t=Y=>{r(0,T=Y)},U=Y=>{(T==null?void 0:T.id)===Y.id&&r(0,T=null)},V=(Y,Le)=>y("dragstart",{...Le.detail,source:l,feature:Y}),ae=(Y,Le)=>y("drag",{...Le.detail,source:l,feature:Y}),Nt=(Y,Le)=>y("dragend",{...Le.detail,source:l,feature:Y}),Ot=(Y,Le)=>y("click",{...Le.detail,source:l,feature:Y}),It=(Y,Le)=>y("dblclick",{...Le.detail,source:l,feature:Y}),ks=(Y,Le)=>y("contextmenu",{...Le.detail,source:l,feature:Y});return n.$$set=Y=>{"applyToClusters"in Y&&r(19,S=Y.applyToClusters),"filter"in Y&&r(20,_=Y.filter),"markerLngLat"in Y&&r(1,m=Y.markerLngLat),"interactive"in Y&&r(2,M=Y.interactive),"asButton"in Y&&r(3,E=Y.asButton),"draggable"in Y&&r(4,k=Y.draggable),"minzoom"in Y&&r(5,A=Y.minzoom),"maxzoom"in Y&&r(6,B=Y.maxzoom),"hovered"in Y&&r(0,T=Y.hovered),"zIndex"in Y&&r(7,z=Y.zIndex),"class"in Y&&r(8,N=Y.class),"$$scope"in Y&&r(33,f=Y.$$scope)},n.$$.update=()=>{if(n.$$.dirty[0]&8388640&&r(13,t=A??u),n.$$.dirty[0]&4194368&&r(12,o=B??a),n.$$.dirty[0]&1572864&&(i=Os("all",Is(S),_)),n.$$.dirty[0]&2097664&&s&&l){let Y=s.getSource(l);Y!=null&&Y.loaded()?I():s.on("sourcedata",F)}},[T,m,M,E,k,A,B,z,N,l,ee,he,o,t,d,p,h,g,y,S,_,s,a,u,c,$t,U,V,ae,Nt,Ot,It,ks,f]}class Nl extends j{constructor(e){super(),Q(this,e,Al,Rl,K,{applyToClusters:19,filter:20,markerLngLat:1,interactive:2,asButton:3,draggable:4,minzoom:5,maxzoom:6,hovered:0,zIndex:7,class:8},null,[-1,-1])}}const Ol="/atip/ss_huge_refactor_pt1/assets/warning-81bba3f6.svg";function Il(n){let e,r;return{c(){e=D("img"),Ne(e.src,r=Ol)||x(e,"src",r),x(e,"title",n[0]),x(e,"alt",n[0])},m(t,o){v(t,e,o)},p(t,[o]){o&1&&x(e,"title",t[0]),o&1&&x(e,"alt",t[0])},i:W,o:W,d(t){t&&$(e)}}}function Bl(n,e,r){let{text:t}=e;return n.$$set=o=>{"text"in o&&r(0,t=o.text)},[t]}let Dl=class extends j{constructor(e){super(),Q(this,e,Bl,Il,K,{text:0})}};/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Gl(n,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},t,o,i,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(u){return function(c){return a([u,c])}}function a(u){if(t)throw new TypeError("Generator is already executing.");for(;r;)try{if(t=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,o=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(n,r)}catch(c){u=[6,c],o=0}finally{t=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var lt=function(){function n(e,r){this.next=null,this.key=e,this.data=r,this.left=null,this.right=null}return n}();function Tl(n,e){return n>e?1:n<e?-1:0}function tt(n,e,r){for(var t=new lt(null,null),o=t,i=t;;){var s=r(n,e.key);if(s<0){if(e.left===null)break;if(r(n,e.left.key)<0){var l=e.left;if(e.left=l.right,l.right=e,e=l,e.left===null)break}i.left=e,i=e,e=e.left}else if(s>0){if(e.right===null)break;if(r(n,e.right.key)>0){var l=e.right;if(e.right=l.left,l.left=e,e=l,e.right===null)break}o.right=e,o=e,e=e.right}else break}return o.right=e.left,i.left=e.right,e.left=t.right,e.right=t.left,e}function Ur(n,e,r,t){var o=new lt(n,e);if(r===null)return o.left=o.right=null,o;r=tt(n,r,t);var i=t(n,r.key);return i<0?(o.left=r.left,o.right=r,r.left=null):i>=0&&(o.right=r.right,o.left=r,r.right=null),o}function oi(n,e,r){var t=null,o=null;if(e){e=tt(n,e,r);var i=r(e.key,n);i===0?(t=e.left,o=e.right):i<0?(o=e.right,e.right=null,t=e):(t=e.left,e.left=null,o=e)}return{left:t,right:o}}function Ul(n,e,r){return e===null?n:(n===null||(e=tt(n.key,e,r),e.left=n),e)}function sn(n,e,r,t,o){if(n){t(""+e+(r?"└── ":"├── ")+o(n)+`
`);var i=e+(r?"    ":"│   ");n.left&&sn(n.left,i,!1,t,o),n.right&&sn(n.right,i,!0,t,o)}}var Fn=function(){function n(e){e===void 0&&(e=Tl),this._root=null,this._size=0,this._comparator=e}return n.prototype.insert=function(e,r){return this._size++,this._root=Ur(e,r,this._root,this._comparator)},n.prototype.add=function(e,r){var t=new lt(e,r);this._root===null&&(t.left=t.right=null,this._size++,this._root=t);var o=this._comparator,i=tt(e,this._root,o),s=o(e,i.key);return s===0?this._root=i:(s<0?(t.left=i.left,t.right=i,i.left=null):s>0&&(t.right=i.right,t.left=i,i.right=null),this._size++,this._root=t),this._root},n.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},n.prototype._remove=function(e,r,t){var o;if(r===null)return null;r=tt(e,r,t);var i=t(e,r.key);return i===0?(r.left===null?o=r.right:(o=tt(e,r.left,t),o.right=r.right),this._size--,o):r},n.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=tt(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},n.prototype.findStatic=function(e){for(var r=this._root,t=this._comparator;r;){var o=t(e,r.key);if(o===0)return r;o<0?r=r.left:r=r.right}return null},n.prototype.find=function(e){return this._root&&(this._root=tt(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},n.prototype.contains=function(e){for(var r=this._root,t=this._comparator;r;){var o=t(e,r.key);if(o===0)return!0;o<0?r=r.left:r=r.right}return!1},n.prototype.forEach=function(e,r){for(var t=this._root,o=[],i=!1;!i;)t!==null?(o.push(t),t=t.left):o.length!==0?(t=o.pop(),e.call(r,t),t=t.right):i=!0;return this},n.prototype.range=function(e,r,t,o){for(var i=[],s=this._comparator,l=this._root,a;i.length!==0||l;)if(l)i.push(l),l=l.left;else{if(l=i.pop(),a=s(l.key,r),a>0)break;if(s(l.key,e)>=0&&t.call(o,l))return this;l=l.right}return this},n.prototype.keys=function(){var e=[];return this.forEach(function(r){var t=r.key;return e.push(t)}),e},n.prototype.values=function(){var e=[];return this.forEach(function(r){var t=r.data;return e.push(t)}),e},n.prototype.min=function(){return this._root?this.minNode(this._root).key:null},n.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},n.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},n.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},n.prototype.at=function(e){for(var r=this._root,t=!1,o=0,i=[];!t;)if(r)i.push(r),r=r.left;else if(i.length>0){if(r=i.pop(),o===e)return r;o++,r=r.right}else t=!0;return null},n.prototype.next=function(e){var r=this._root,t=null;if(e.right){for(t=e.right;t.left;)t=t.left;return t}for(var o=this._comparator;r;){var i=o(e.key,r.key);if(i===0)break;i<0?(t=r,r=r.left):r=r.right}return t},n.prototype.prev=function(e){var r=this._root,t=null;if(e.left!==null){for(t=e.left;t.right;)t=t.right;return t}for(var o=this._comparator;r;){var i=o(e.key,r.key);if(i===0)break;i<0?r=r.left:(t=r,r=r.right)}return t},n.prototype.clear=function(){return this._root=null,this._size=0,this},n.prototype.toList=function(){return ql(this._root)},n.prototype.load=function(e,r,t){r===void 0&&(r=[]),t===void 0&&(t=!1);var o=e.length,i=this._comparator;if(t&&un(e,r,0,o-1,i),this._root===null)this._root=ln(e,r,0,o),this._size=o;else{var s=zl(this.toList(),xl(e,r),i);o=this._size+o,this._root=an({head:s},0,o)}return this},n.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){e===void 0&&(e=function(t){return String(t.key)});var r=[];return sn(this._root,"",!0,function(t){return r.push(t)},e),r.join("")},n.prototype.update=function(e,r,t){var o=this._comparator,i=oi(e,this._root,o),s=i.left,l=i.right;o(e,r)<0?l=Ur(r,t,l,o):s=Ur(r,t,s,o),this._root=Ul(s,l,o)},n.prototype.split=function(e){return oi(e,this._root,this._comparator)},n.prototype[Symbol.iterator]=function(){var e;return Gl(this,function(r){switch(r.label){case 0:e=this.minNode(),r.label=1;case 1:return e?[4,e]:[3,3];case 2:return r.sent(),e=this.next(e),[3,1];case 3:return[2]}})},n}();function ln(n,e,r,t){var o=t-r;if(o>0){var i=r+Math.floor(o/2),s=n[i],l=e[i],a=new lt(s,l);return a.left=ln(n,e,r,i),a.right=ln(n,e,i+1,t),a}return null}function xl(n,e){for(var r=new lt(null,null),t=r,o=0;o<n.length;o++)t=t.next=new lt(n[o],e[o]);return t.next=null,r.next}function ql(n){for(var e=n,r=[],t=!1,o=new lt(null,null),i=o;!t;)e?(r.push(e),e=e.left):r.length>0?(e=i=i.next=r.pop(),e=e.right):t=!0;return i.next=null,o.next}function an(n,e,r){var t=r-e;if(t>0){var o=e+Math.floor(t/2),i=an(n,e,o),s=n.head;return s.left=i,n.head=n.head.next,s.right=an(n,o+1,r),s}return null}function zl(n,e,r){for(var t=new lt(null,null),o=t,i=n,s=e;i!==null&&s!==null;)r(i.key,s.key)<0?(o.next=i,i=i.next):(o.next=s,s=s.next),o=o.next;return i!==null?o.next=i:s!==null&&(o.next=s),t.next}function un(n,e,r,t,o){if(!(r>=t)){for(var i=n[r+t>>1],s=r-1,l=t+1;;){do s++;while(o(n[s],i)<0);do l--;while(o(n[l],i)>0);if(s>=l)break;var a=n[s];n[s]=n[l],n[l]=a,a=e[s],e[s]=e[l],e[l]=a}un(n,e,r,l,o),un(n,e,l+1,t,o)}}function Oe(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function si(n,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function Pe(n,e,r){return e&&si(n.prototype,e),r&&si(n,r),n}var Bt=function(e,r){return e.ll.x<=r.x&&r.x<=e.ur.x&&e.ll.y<=r.y&&r.y<=e.ur.y},fn=function(e,r){if(r.ur.x<e.ll.x||e.ur.x<r.ll.x||r.ur.y<e.ll.y||e.ur.y<r.ll.y)return null;var t=e.ll.x<r.ll.x?r.ll.x:e.ll.x,o=e.ur.x<r.ur.x?e.ur.x:r.ur.x,i=e.ll.y<r.ll.y?r.ll.y:e.ll.y,s=e.ur.y<r.ur.y?e.ur.y:r.ur.y;return{ll:{x:t,y:i},ur:{x:o,y:s}}},it=Number.EPSILON;it===void 0&&(it=Math.pow(2,-52));var Yl=it*it,cn=function(e,r){if(-it<e&&e<it&&-it<r&&r<it)return 0;var t=e-r;return t*t<Yl*e*r?0:e<r?-1:1},Jl=function(){function n(){Oe(this,n),this.reset()}return Pe(n,[{key:"reset",value:function(){this.xRounder=new li,this.yRounder=new li}},{key:"round",value:function(r,t){return{x:this.xRounder.round(r),y:this.yRounder.round(t)}}}]),n}(),li=function(){function n(){Oe(this,n),this.tree=new Fn,this.round(0)}return Pe(n,[{key:"round",value:function(r){var t=this.tree.add(r),o=this.tree.prev(t);if(o!==null&&cn(t.key,o.key)===0)return this.tree.remove(r),o.key;var i=this.tree.next(t);return i!==null&&cn(t.key,i.key)===0?(this.tree.remove(r),i.key):r}}]),n}(),Wt=new Jl,qt=function(e,r){return e.x*r.y-e.y*r.x},Mo=function(e,r){return e.x*r.x+e.y*r.y},ai=function(e,r,t){var o={x:r.x-e.x,y:r.y-e.y},i={x:t.x-e.x,y:t.y-e.y},s=qt(o,i);return cn(s,0)},Rr=function(e){return Math.sqrt(Mo(e,e))},Xl=function(e,r,t){var o={x:r.x-e.x,y:r.y-e.y},i={x:t.x-e.x,y:t.y-e.y};return qt(i,o)/Rr(i)/Rr(o)},Vl=function(e,r,t){var o={x:r.x-e.x,y:r.y-e.y},i={x:t.x-e.x,y:t.y-e.y};return Mo(i,o)/Rr(i)/Rr(o)},ui=function(e,r,t){return r.y===0?null:{x:e.x+r.x/r.y*(t-e.y),y:t}},fi=function(e,r,t){return r.x===0?null:{x:t,y:e.y+r.y/r.x*(t-e.x)}},Wl=function(e,r,t,o){if(r.x===0)return fi(t,o,e.x);if(o.x===0)return fi(e,r,t.x);if(r.y===0)return ui(t,o,e.y);if(o.y===0)return ui(e,r,t.y);var i=qt(r,o);if(i==0)return null;var s={x:t.x-e.x,y:t.y-e.y},l=qt(s,r)/i,a=qt(s,o)/i,u=e.x+a*r.x,c=t.x+l*o.x,f=e.y+a*r.y,d=t.y+l*o.y,p=(u+c)/2,h=(f+d)/2;return{x:p,y:h}},qe=function(){Pe(n,null,[{key:"compare",value:function(r,t){var o=n.comparePoints(r.point,t.point);return o!==0?o:(r.point!==t.point&&r.link(t),r.isLeft!==t.isLeft?r.isLeft?1:-1:Ar.compare(r.segment,t.segment))}},{key:"comparePoints",value:function(r,t){return r.x<t.x?-1:r.x>t.x?1:r.y<t.y?-1:r.y>t.y?1:0}}]);function n(e,r){Oe(this,n),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=r}return Pe(n,[{key:"link",value:function(r){if(r.point===this.point)throw new Error("Tried to link already linked events");for(var t=r.point.events,o=0,i=t.length;o<i;o++){var s=t[o];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var r=this.point.events.length,t=0;t<r;t++){var o=this.point.events[t];if(o.segment.consumedBy===void 0)for(var i=t+1;i<r;i++){var s=this.point.events[i];s.consumedBy===void 0&&o.otherSE.point.events===s.otherSE.point.events&&o.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var r=[],t=0,o=this.point.events.length;t<o;t++){var i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&r.push(i)}return r}},{key:"getLeftmostComparator",value:function(r){var t=this,o=new Map,i=function(l){var a=l.otherSE;o.set(l,{sine:Xl(t.point,r.point,a.point),cosine:Vl(t.point,r.point,a.point)})};return function(s,l){o.has(s)||i(s),o.has(l)||i(l);var a=o.get(s),u=a.sine,c=a.cosine,f=o.get(l),d=f.sine,p=f.cosine;return u>=0&&d>=0?c<p?1:c>p?-1:0:u<0&&d<0?c<p?-1:c>p?1:0:d<u?-1:d>u?1:0}}}]),n}(),Hl=0,Ar=function(){Pe(n,null,[{key:"compare",value:function(r,t){var o=r.leftSE.point.x,i=t.leftSE.point.x,s=r.rightSE.point.x,l=t.rightSE.point.x;if(l<o)return 1;if(s<i)return-1;var a=r.leftSE.point.y,u=t.leftSE.point.y,c=r.rightSE.point.y,f=t.rightSE.point.y;if(o<i){if(u<a&&u<c)return 1;if(u>a&&u>c)return-1;var d=r.comparePoint(t.leftSE.point);if(d<0)return 1;if(d>0)return-1;var p=t.comparePoint(r.rightSE.point);return p!==0?p:-1}if(o>i){if(a<u&&a<f)return-1;if(a>u&&a>f)return 1;var h=t.comparePoint(r.leftSE.point);if(h!==0)return h;var g=r.comparePoint(t.rightSE.point);return g<0?1:g>0?-1:1}if(a<u)return-1;if(a>u)return 1;if(s<l){var y=t.comparePoint(r.rightSE.point);if(y!==0)return y}if(s>l){var S=r.comparePoint(t.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(s!==l){var _=c-a,m=s-o,M=f-u,E=l-i;if(_>m&&M<E)return 1;if(_<m&&M>E)return-1}return s>l?1:s<l||c<f?-1:c>f?1:r.id<t.id?-1:r.id>t.id?1:0}}]);function n(e,r,t,o){Oe(this,n),this.id=++Hl,this.leftSE=e,e.segment=this,e.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=e,this.rings=t,this.windings=o}return Pe(n,[{key:"replaceRightSE",value:function(r){this.rightSE=r,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var r=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:r<t?r:t},ur:{x:this.rightSE.point.x,y:r>t?r:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(r){return r.x===this.leftSE.point.x&&r.y===this.leftSE.point.y||r.x===this.rightSE.point.x&&r.y===this.rightSE.point.y}},{key:"comparePoint",value:function(r){if(this.isAnEndpoint(r))return 0;var t=this.leftSE.point,o=this.rightSE.point,i=this.vector();if(t.x===o.x)return r.x===t.x?0:r.x<t.x?1:-1;var s=(r.y-t.y)/i.y,l=t.x+s*i.x;if(r.x===l)return 0;var a=(r.x-t.x)/i.x,u=t.y+a*i.y;return r.y===u?0:r.y<u?-1:1}},{key:"getIntersection",value:function(r){var t=this.bbox(),o=r.bbox(),i=fn(t,o);if(i===null)return null;var s=this.leftSE.point,l=this.rightSE.point,a=r.leftSE.point,u=r.rightSE.point,c=Bt(t,a)&&this.comparePoint(a)===0,f=Bt(o,s)&&r.comparePoint(s)===0,d=Bt(t,u)&&this.comparePoint(u)===0,p=Bt(o,l)&&r.comparePoint(l)===0;if(f&&c)return p&&!d?l:!p&&d?u:null;if(f)return d&&s.x===u.x&&s.y===u.y?null:s;if(c)return p&&l.x===a.x&&l.y===a.y?null:a;if(p&&d)return null;if(p)return l;if(d)return u;var h=Wl(s,this.vector(),a,r.vector());return h===null||!Bt(i,h)?null:Wt.round(h.x,h.y)}},{key:"split",value:function(r){var t=[],o=r.events!==void 0,i=new qe(r,!0),s=new qe(r,!1),l=this.rightSE;this.replaceRightSE(s),t.push(s),t.push(i);var a=new n(i,l,this.rings.slice(),this.windings.slice());return qe.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),qe.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(i.checkForConsuming(),s.checkForConsuming()),t}},{key:"swapEvents",value:function(){var r=this.rightSE;this.rightSE=this.leftSE,this.leftSE=r,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,o=this.windings.length;t<o;t++)this.windings[t]*=-1}},{key:"consume",value:function(r){for(var t=this,o=r;t.consumedBy;)t=t.consumedBy;for(;o.consumedBy;)o=o.consumedBy;var i=n.compare(t,o);if(i!==0){if(i>0){var s=t;t=o,o=s}if(t.prev===o){var l=t;t=o,o=l}for(var a=0,u=o.rings.length;a<u;a++){var c=o.rings[a],f=o.windings[a],d=t.rings.indexOf(c);d===-1?(t.rings.push(c),t.windings.push(f)):t.windings[d]+=f}o.rings=null,o.windings=null,o.consumedBy=t,o.leftSE.consumedBy=t.leftSE,o.rightSE.consumedBy=t.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var r=this.prev.consumedBy||this.prev;this._beforeState=r.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var r=this.beforeState();this._afterState={rings:r.rings.slice(0),windings:r.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,o=this._afterState.windings,i=this._afterState.multiPolys,s=0,l=this.rings.length;s<l;s++){var a=this.rings[s],u=this.windings[s],c=t.indexOf(a);c===-1?(t.push(a),o.push(u)):o[c]+=u}for(var f=[],d=[],p=0,h=t.length;p<h;p++)if(o[p]!==0){var g=t[p],y=g.poly;if(d.indexOf(y)===-1)if(g.isExterior)f.push(y);else{d.indexOf(y)===-1&&d.push(y);var S=f.indexOf(g.poly);S!==-1&&f.splice(S,1)}}for(var _=0,m=f.length;_<m;_++){var M=f[_].multiPoly;i.indexOf(M)===-1&&i.push(M)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var r=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Ge.type){case"union":{var o=r.length===0,i=t.length===0;this._isInResult=o!==i;break}case"intersection":{var s,l;r.length<t.length?(s=r.length,l=t.length):(s=t.length,l=r.length),this._isInResult=l===Ge.numMultiPolys&&s<l;break}case"xor":{var a=Math.abs(r.length-t.length);this._isInResult=a%2===1;break}case"difference":{var u=function(f){return f.length===1&&f[0].isSubject};this._isInResult=u(r)!==u(t);break}default:throw new Error("Unrecognized operation type found ".concat(Ge.type))}return this._isInResult}}],[{key:"fromRing",value:function(r,t,o){var i,s,l,a=qe.comparePoints(r,t);if(a<0)i=r,s=t,l=1;else if(a>0)i=t,s=r,l=-1;else throw new Error("Tried to create degenerate segment at [".concat(r.x,", ").concat(r.y,"]"));var u=new qe(i,!0),c=new qe(s,!1);return new n(u,c,[o],[l])}}]),n}(),ci=function(){function n(e,r,t){if(Oe(this,n),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=t,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=Wt.round(e[0][0],e[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var i=o,s=1,l=e.length;s<l;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var a=Wt.round(e[s][0],e[s][1]);a.x===i.x&&a.y===i.y||(this.segments.push(Ar.fromRing(i,a,this)),a.x<this.bbox.ll.x&&(this.bbox.ll.x=a.x),a.y<this.bbox.ll.y&&(this.bbox.ll.y=a.y),a.x>this.bbox.ur.x&&(this.bbox.ur.x=a.x),a.y>this.bbox.ur.y&&(this.bbox.ur.y=a.y),i=a)}(o.x!==i.x||o.y!==i.y)&&this.segments.push(Ar.fromRing(i,o,this))}return Pe(n,[{key:"getSweepEvents",value:function(){for(var r=[],t=0,o=this.segments.length;t<o;t++){var i=this.segments[t];r.push(i.leftSE),r.push(i.rightSE)}return r}}]),n}(),Zl=function(){function n(e,r){if(Oe(this,n),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ci(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var t=1,o=e.length;t<o;t++){var i=new ci(e[t],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=r}return Pe(n,[{key:"getSweepEvents",value:function(){for(var r=this.exteriorRing.getSweepEvents(),t=0,o=this.interiorRings.length;t<o;t++)for(var i=this.interiorRings[t].getSweepEvents(),s=0,l=i.length;s<l;s++)r.push(i[s]);return r}}]),n}(),pi=function(){function n(e,r){if(Oe(this,n),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var t=0,o=e.length;t<o;t++){var i=new Zl(e[t],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=r}return Pe(n,[{key:"getSweepEvents",value:function(){for(var r=[],t=0,o=this.polys.length;t<o;t++)for(var i=this.polys[t].getSweepEvents(),s=0,l=i.length;s<l;s++)r.push(i[s]);return r}}]),n}(),Kl=function(){Pe(n,null,[{key:"factory",value:function(r){for(var t=[],o=0,i=r.length;o<i;o++){var s=r[o];if(!(!s.isInResult()||s.ringOut)){for(var l=null,a=s.leftSE,u=s.rightSE,c=[a],f=a.point,d=[];l=a,a=u,c.push(a),a.point!==f;)for(;;){var p=a.getAvailableLinkedEvents();if(p.length===0){var h=c[0].point,g=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(p.length===1){u=p[0].otherSE;break}for(var y=null,S=0,_=d.length;S<_;S++)if(d[S].point===a.point){y=S;break}if(y!==null){var m=d.splice(y)[0],M=c.splice(m.index);M.unshift(M[0].otherSE),t.push(new n(M.reverse()));continue}d.push({index:c.length,point:a.point});var E=a.getLeftmostComparator(l);u=p.sort(E)[0].otherSE;break}t.push(new n(c))}}return t}}]);function n(e){Oe(this,n),this.events=e;for(var r=0,t=e.length;r<t;r++)e[r].segment.ringOut=this;this.poly=null}return Pe(n,[{key:"getGeom",value:function(){for(var r=this.events[0].point,t=[r],o=1,i=this.events.length-1;o<i;o++){var s=this.events[o].point,l=this.events[o+1].point;ai(s,r,l)!==0&&(t.push(s),r=s)}if(t.length===1)return null;var a=t[0],u=t[1];ai(a,r,u)===0&&t.shift(),t.push(t[0]);for(var c=this.isExteriorRing()?1:-1,f=this.isExteriorRing()?0:t.length-1,d=this.isExteriorRing()?t.length:-1,p=[],h=f;h!=d;h+=c)p.push([t[h].x,t[h].y]);return p}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var r=this.enclosingRing();this._isExteriorRing=r?!r.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var r=this.events[0],t=1,o=this.events.length;t<o;t++){var i=this.events[t];qe.compare(r,i)>0&&(r=i)}for(var s=r.segment.prevInResult(),l=s?s.prevInResult():null;;){if(!s)return null;if(!l)return s.ringOut;if(l.ringOut!==s.ringOut)return l.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=l.prevInResult(),l=s?s.prevInResult():null}}}]),n}(),di=function(){function n(e){Oe(this,n),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Pe(n,[{key:"addInterior",value:function(r){this.interiorRings.push(r),r.poly=this}},{key:"getGeom",value:function(){var r=[this.exteriorRing.getGeom()];if(r[0]===null)return null;for(var t=0,o=this.interiorRings.length;t<o;t++){var i=this.interiorRings[t].getGeom();i!==null&&r.push(i)}return r}}]),n}(),jl=function(){function n(e){Oe(this,n),this.rings=e,this.polys=this._composePolys(e)}return Pe(n,[{key:"getGeom",value:function(){for(var r=[],t=0,o=this.polys.length;t<o;t++){var i=this.polys[t].getGeom();i!==null&&r.push(i)}return r}},{key:"_composePolys",value:function(r){for(var t=[],o=0,i=r.length;o<i;o++){var s=r[o];if(!s.poly)if(s.isExteriorRing())t.push(new di(s));else{var l=s.enclosingRing();l.poly||t.push(new di(l)),l.poly.addInterior(s)}}return t}}]),n}(),Ql=function(){function n(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ar.compare;Oe(this,n),this.queue=e,this.tree=new Fn(r),this.segments=[]}return Pe(n,[{key:"process",value:function(r){var t=r.segment,o=[];if(r.consumedBy)return r.isLeft?this.queue.remove(r.otherSE):this.tree.remove(t),o;var i=r.isLeft?this.tree.insert(t):this.tree.find(t);if(!i)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=i,l=i,a=void 0,u=void 0;a===void 0;)s=this.tree.prev(s),s===null?a=null:s.key.consumedBy===void 0&&(a=s.key);for(;u===void 0;)l=this.tree.next(l),l===null?u=null:l.key.consumedBy===void 0&&(u=l.key);if(r.isLeft){var c=null;if(a){var f=a.getIntersection(t);if(f!==null&&(t.isAnEndpoint(f)||(c=f),!a.isAnEndpoint(f)))for(var d=this._splitSafely(a,f),p=0,h=d.length;p<h;p++)o.push(d[p])}var g=null;if(u){var y=u.getIntersection(t);if(y!==null&&(t.isAnEndpoint(y)||(g=y),!u.isAnEndpoint(y)))for(var S=this._splitSafely(u,y),_=0,m=S.length;_<m;_++)o.push(S[_])}if(c!==null||g!==null){var M=null;if(c===null)M=g;else if(g===null)M=c;else{var E=qe.comparePoints(c,g);M=E<=0?c:g}this.queue.remove(t.rightSE),o.push(t.rightSE);for(var k=t.split(M),A=0,B=k.length;A<B;A++)o.push(k[A])}o.length>0?(this.tree.remove(t),o.push(r)):(this.segments.push(t),t.prev=a)}else{if(a&&u){var T=a.getIntersection(u);if(T!==null){if(!a.isAnEndpoint(T))for(var z=this._splitSafely(a,T),N=0,O=z.length;N<O;N++)o.push(z[N]);if(!u.isAnEndpoint(T))for(var I=this._splitSafely(u,T),F=0,ee=I.length;F<ee;F++)o.push(I[F])}}this.tree.remove(t)}return o}},{key:"_splitSafely",value:function(r,t){this.tree.remove(r);var o=r.rightSE;this.queue.remove(o);var i=r.split(t);return i.push(o),r.consumedBy===void 0&&this.tree.insert(r),i}}]),n}(),hi=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ea=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ta=function(){function n(){Oe(this,n)}return Pe(n,[{key:"run",value:function(r,t,o){Ge.type=r,Wt.reset();for(var i=[new pi(t,!0)],s=0,l=o.length;s<l;s++)i.push(new pi(o[s],!1));if(Ge.numMultiPolys=i.length,Ge.type==="difference")for(var a=i[0],u=1;u<i.length;)fn(i[u].bbox,a.bbox)!==null?u++:i.splice(u,1);if(Ge.type==="intersection"){for(var c=0,f=i.length;c<f;c++)for(var d=i[c],p=c+1,h=i.length;p<h;p++)if(fn(d.bbox,i[p].bbox)===null)return[]}for(var g=new Fn(qe.compare),y=0,S=i.length;y<S;y++)for(var _=i[y].getSweepEvents(),m=0,M=_.length;m<M;m++)if(g.insert(_[m]),g.size>hi)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var E=new Ql(g),k=g.size,A=g.pop();A;){var B=A.key;if(g.size===k){var T=B.segment;throw new Error("Unable to pop() ".concat(B.isLeft?"left":"right"," SweepEvent ")+"[".concat(B.point.x,", ").concat(B.point.y,"] from segment #").concat(T.id," ")+"[".concat(T.leftSE.point.x,", ").concat(T.leftSE.point.y,"] -> ")+"[".concat(T.rightSE.point.x,", ").concat(T.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>hi)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(E.segments.length>ea)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var z=E.process(B),N=0,O=z.length;N<O;N++){var I=z[N];I.consumedBy===void 0&&g.insert(I)}k=g.size,A=g.pop()}Wt.reset();var F=Kl.factory(E.segments),ee=new jl(F);return ee.getGeom()}}]),n}(),Ge=new ta,ra=function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),o=1;o<r;o++)t[o-1]=arguments[o];return Ge.run("union",e,t)},na=function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),o=1;o<r;o++)t[o-1]=arguments[o];return Ge.run("intersection",e,t)},ia=function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),o=1;o<r;o++)t[o-1]=arguments[o];return Ge.run("xor",e,t)},oa=function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),o=1;o<r;o++)t[o-1]=arguments[o];return Ge.run("difference",e,t)},mr={union:ra,intersection:na,xor:ia,difference:oa},sa=Object.defineProperty,Gr=(n,e)=>sa(n,"name",{value:e,configurable:!0});function Po(n,e){var r=Co(e),t=null;return n.type==="FeatureCollection"?t=Lo(n):t=Rn(mr.union(n.geometry.coordinates)),t.geometry.coordinates.forEach(function(o){r.geometry.coordinates.push(o[0])}),r}Gr(Po,"mask");function Lo(n){var e=n.features.length===2?mr.union(n.features[0].geometry.coordinates,n.features[1].geometry.coordinates):mr.union.apply(mr,n.features.map(function(r){return r.geometry.coordinates}));return Rn(e)}Gr(Lo,"unionFc");function Rn(n){return Bs(n)}Gr(Rn,"createGeomFromPolygonClippingOutput");function Co(n){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],r=n&&n.geometry.coordinates||e;return Ds(r)}Gr(Co,"createMask");var mi=Po;function la(n,e){let r=new Set(n.getStyle().layers.filter(t=>t.type=="line").map(t=>t.id));if(e=="dataviz")return["Road network","Path"].filter(t=>r.has(t));if(e=="hybrid")return["Path","Road","Tunnel"].filter(t=>r.has(t));if(e=="streets"){let t=[];for(let o of["road","bridge","tunnel"])for(let i of["link","minor","minor_construction","motorway","motorway_construction","motorway_link","path_pedestrian","secondary_tertiary","secondary_tertiary_construction","service_track","service_track_construction","street","trunk_primary","trunk_primary_construction","trunk_primary_link"])t.push(`${o}_${i}`);return t.filter(o=>r.has(o))}return e=="uk-openzoomstack-light"?n.getStyle().layers.filter(t=>t["source-layer"]=="roads"&&t.type=="line").map(t=>t.id):[]}var $e=[];for(var xr=0;xr<256;++xr)$e.push((xr+256).toString(16).slice(1));function aa(n,e=0){return($e[n[e+0]]+$e[n[e+1]]+$e[n[e+2]]+$e[n[e+3]]+"-"+$e[n[e+4]]+$e[n[e+5]]+"-"+$e[n[e+6]]+$e[n[e+7]]+"-"+$e[n[e+8]]+$e[n[e+9]]+"-"+$e[n[e+10]]+$e[n[e+11]]+$e[n[e+12]]+$e[n[e+13]]+$e[n[e+14]]+$e[n[e+15]]).toLowerCase()}var lr,ua=new Uint8Array(16);function fa(){if(!lr&&(lr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!lr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return lr(ua)}var ca=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const gi={randomUUID:ca};function pa(n,e,r){if(gi.randomUUID&&!e&&!n)return gi.randomUUID();n=n||{};var t=n.random||(n.rng||fa)();if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,e){r=r||0;for(var o=0;o<16;++o)e[r+o]=t[o];return e}return aa(t)}const zt={hovering:"black",lineEndpointColor:"black"},Nr=10,pt=10;function da(){return ha(["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"])}function ha(n){return n[Math.floor(Math.random()*n.length)]}function Fo(){let n={type:"FeatureCollection",features:[],schemes:{}};return Ro(n),n}function Ro(n){let e=pa();n.schemes[e]={scheme_reference:e,color:da()}}class ma{constructor(e){se(this,"map");se(this,"active");se(this,"eventListenersSuccess");se(this,"eventListenersFailure");se(this,"cursor");se(this,"onMouseMove",e=>{this.active&&(this.cursor={type:"Feature",properties:{},geometry:{type:"Point",coordinates:Qo(e.lngLat.toArray())}})});se(this,"onClick",()=>{if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}});se(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),document.removeEventListener("keydown",this.onKeyDown)}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersFailure=[]}start(){this.map.getCanvas().style.cursor="crosshair",this.active=!0}stop(){this.map.getCanvas().style.cursor="inherit",this.cursor=null,this.active=!1}}function ga(n){var e=n%(2*Math.PI);return e*180/Math.PI}function ar(n){var e=n%360;return e*Math.PI/180}function st(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ze(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function pn(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function Ao(n,e,r){if(r===void 0&&(r={}),r.final===!0)return _a(n,e);var t=st(n),o=st(e),i=ar(t[0]),s=ar(o[0]),l=ar(t[1]),a=ar(o[1]),u=Math.sin(s-i)*Math.cos(a),c=Math.cos(l)*Math.sin(a)-Math.sin(l)*Math.cos(a)*Math.cos(s-i);return ga(Math.atan2(u,c))}function _a(n,e){var r=Ao(e,n);return r=(r+180)%360,r}var Ce=63710088e-1,ya={centimeters:Ce*100,centimetres:Ce*100,degrees:Ce/111325,feet:Ce*3.28084,inches:Ce*39.37,kilometers:Ce/1e3,kilometres:Ce/1e3,meters:Ce,metres:Ce,miles:Ce/1609.344,millimeters:Ce*1e3,millimetres:Ce*1e3,nauticalmiles:Ce/1852,radians:1,yards:Ce*1.0936};function va(n,e){e===void 0&&(e="kilometers");var r=ya[e];if(!r)throw new Error(e+" units is invalid");return n*r}function ur(n){var e=n%360;return e*Math.PI/180}function rt(n,e,r){r===void 0&&(r={});var t=st(n),o=st(e),i=ur(o[1]-t[1]),s=ur(o[0]-t[0]),l=ur(t[1]),a=ur(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(a);return va(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),r.units)}var Fe=63710088e-1,$a={centimeters:Fe*100,centimetres:Fe*100,degrees:Fe/111325,feet:Fe*3.28084,inches:Fe*39.37,kilometers:Fe/1e3,kilometres:Fe/1e3,meters:Fe,metres:Fe,miles:Fe/1609.344,millimeters:Fe*1e3,millimetres:Fe*1e3,nauticalmiles:Fe/1852,radians:1,yards:Fe*1.0936};function ba(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function wa(n,e,r){if(r===void 0&&(r={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!yi(n[0])||!yi(n[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:n};return ba(t,e,r)}function ka(n,e){e===void 0&&(e="kilometers");var r=$a[e];if(!r)throw new Error(e+" units is invalid");return n/r}function _i(n){var e=n%(2*Math.PI);return e*180/Math.PI}function qr(n){var e=n%360;return e*Math.PI/180}function yi(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function vi(n,e,r,t){t===void 0&&(t={});var o=st(n),i=qr(o[0]),s=qr(o[1]),l=qr(r),a=ka(e,t.units),u=Math.asin(Math.sin(s)*Math.cos(a)+Math.cos(s)*Math.sin(a)*Math.cos(l)),c=i+Math.atan2(Math.sin(l)*Math.sin(a)*Math.cos(s),Math.cos(a)-Math.sin(s)*Math.sin(u)),f=_i(c),d=_i(u);return wa([f,d],t.properties)}function dn(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function Sa(n,e,r){if(r===void 0&&(r={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!bi(n[0])||!bi(n[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:n};return dn(t,e,r)}function $i(n,e){e===void 0&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=n,r}function bi(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Ea(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function Ma(n,e,r){if(r===void 0&&(r={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:n};return Ea(t,e,r)}function Pa(n,e){e===void 0&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=n,r}function Or(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function bt(n,e,r){if(r===void 0&&(r={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!wi(n[0])||!wi(n[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:n};return Or(t,e,r)}function St(n,e,r){if(r===void 0&&(r={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:n};return Or(t,e,r)}function wi(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function No(n){return!!n&&n.constructor===Object}function yt(n,e,r){if(n!==null)for(var t,o,i,s,l,a,u,c=0,f=0,d,p=n.type,h=p==="FeatureCollection",g=p==="Feature",y=h?n.features.length:1,S=0;S<y;S++){u=h?n.features[S].geometry:g?n.geometry:n,d=u?u.type==="GeometryCollection":!1,l=d?u.geometries.length:1;for(var _=0;_<l;_++){var m=0,M=0;if(s=d?u.geometries[_]:u,s!==null){a=s.coordinates;var E=s.type;switch(c=r&&(E==="Polygon"||E==="MultiPolygon")?1:0,E){case null:break;case"Point":if(e(a,f,S,m,M)===!1)return!1;f++,m++;break;case"LineString":case"MultiPoint":for(t=0;t<a.length;t++){if(e(a[t],f,S,m,M)===!1)return!1;f++,E==="MultiPoint"&&m++}E==="LineString"&&m++;break;case"Polygon":case"MultiLineString":for(t=0;t<a.length;t++){for(o=0;o<a[t].length-c;o++){if(e(a[t][o],f,S,m,M)===!1)return!1;f++}E==="MultiLineString"&&m++,E==="Polygon"&&M++}E==="Polygon"&&m++;break;case"MultiPolygon":for(t=0;t<a.length;t++){for(M=0,o=0;o<a[t].length;o++){for(i=0;i<a[t][o].length-c;i++){if(e(a[t][o][i],f,S,m,M)===!1)return!1;f++}M++}m++}break;case"GeometryCollection":for(t=0;t<s.geometries.length;t++)if(yt(s.geometries[t],e,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function La(n,e,r,t){var o=r;return yt(n,function(i,s,l,a,u){s===0&&r===void 0?o=i:o=e(o,i,s,l,a,u)},t),o}function Oo(n,e){var r;switch(n.type){case"FeatureCollection":for(r=0;r<n.features.length&&e(n.features[r].properties,r)!==!1;r++);break;case"Feature":e(n.properties,0);break}}function Ca(n,e,r){var t=r;return Oo(n,function(o,i){i===0&&r===void 0?t=o:t=e(t,o,i)}),t}function Ct(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var r=0;r<n.features.length&&e(n.features[r],r)!==!1;r++);}function Io(n,e,r){var t=r;return Ct(n,function(o,i){i===0&&r===void 0?t=o:t=e(t,o,i)}),t}function Fa(n){var e=[];return yt(n,function(r){e.push(r)}),e}function An(n,e){var r,t,o,i,s,l,a,u,c,f,d=0,p=n.type==="FeatureCollection",h=n.type==="Feature",g=p?n.features.length:1;for(r=0;r<g;r++){for(l=p?n.features[r].geometry:h?n.geometry:n,u=p?n.features[r].properties:h?n.properties:{},c=p?n.features[r].bbox:h?n.bbox:void 0,f=p?n.features[r].id:h?n.id:void 0,a=l?l.type==="GeometryCollection":!1,s=a?l.geometries.length:1,o=0;o<s;o++){if(i=a?l.geometries[o]:l,i===null){if(e(null,d,u,c,f)===!1)return!1;continue}switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(i,d,u,c,f)===!1)return!1;break}case"GeometryCollection":{for(t=0;t<i.geometries.length;t++)if(e(i.geometries[t],d,u,c,f)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}d++}}function Ra(n,e,r){var t=r;return An(n,function(o,i,s,l,a){i===0&&r===void 0?t=o:t=e(t,o,i,s,l,a)}),t}function vt(n,e){An(n,function(r,t,o,i,s){var l=r===null?null:r.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(Or(r,o,{bbox:i,id:s}),t,0)===!1?!1:void 0}var a;switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<r.coordinates.length;u++){var c=r.coordinates[u],f={type:a,coordinates:c};if(e(Or(f,o),t,u)===!1)return!1}})}function Aa(n,e,r){var t=r;return vt(n,function(o,i,s){i===0&&s===0&&r===void 0?t=o:t=e(t,o,i,s)}),t}function Bo(n,e){vt(n,function(r,t,o){var i=0;if(r.geometry){var s=r.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,a=0,u=0,c=0;if(yt(r,function(f,d,p,h,g){if(l===void 0||t>a||h>u||g>c){l=f,a=t,u=h,c=g,i=0;return}var y=St([l,f],r.properties);if(e(y,t,o,g,i)===!1)return!1;i++,l=f})===!1)return!1}}})}function Do(n,e,r){var t=r,o=!1;return Bo(n,function(i,s,l,a,u){o===!1&&r===void 0?t=i:t=e(t,i,s,l,a,u),o=!0}),t}function Go(n,e){if(!n)throw new Error("geojson is required");vt(n,function(r,t,o){if(r.geometry!==null){var i=r.geometry.type,s=r.geometry.coordinates;switch(i){case"LineString":if(e(r,t,o,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(e(St(s[l],r.properties),t,o,l)===!1)return!1;break}}})}function Na(n,e,r){var t=r;return Go(n,function(o,i,s,l){i===0&&r===void 0?t=o:t=e(t,o,i,s,l)}),t}function Oa(n,e){if(e=e||{},!No(e))throw new Error("options is invalid");var r=e.featureIndex||0,t=e.multiFeatureIndex||0,o=e.geometryIndex||0,i=e.segmentIndex||0,s=e.properties,l;switch(n.type){case"FeatureCollection":r<0&&(r=n.features.length+r),s=s||n.features[r].properties,l=n.features[r].geometry;break;case"Feature":s=s||n.properties,l=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=n;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var a=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return i<0&&(i=a.length+i-1),St([a[i],a[i+1]],s,e);case"Polygon":return o<0&&(o=a.length+o),i<0&&(i=a[o].length+i-1),St([a[o][i],a[o][i+1]],s,e);case"MultiLineString":return t<0&&(t=a.length+t),i<0&&(i=a[t].length+i-1),St([a[t][i],a[t][i+1]],s,e);case"MultiPolygon":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),i<0&&(i=a[t][o].length-i-1),St([a[t][o][i],a[t][o][i+1]],s,e)}throw new Error("geojson is invalid")}function Ia(n,e){if(e=e||{},!No(e))throw new Error("options is invalid");var r=e.featureIndex||0,t=e.multiFeatureIndex||0,o=e.geometryIndex||0,i=e.coordIndex||0,s=e.properties,l;switch(n.type){case"FeatureCollection":r<0&&(r=n.features.length+r),s=s||n.features[r].properties,l=n.features[r].geometry;break;case"Feature":s=s||n.properties,l=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=n;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var a=l.coordinates;switch(l.type){case"Point":return bt(a,s,e);case"MultiPoint":return t<0&&(t=a.length+t),bt(a[t],s,e);case"LineString":return i<0&&(i=a.length+i),bt(a[i],s,e);case"Polygon":return o<0&&(o=a.length+o),i<0&&(i=a[o].length+i),bt(a[o][i],s,e);case"MultiLineString":return t<0&&(t=a.length+t),i<0&&(i=a[t].length+i),bt(a[t][i],s,e);case"MultiPolygon":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),i<0&&(i=a[t][o].length-i),bt(a[t][o][i],s,e)}throw new Error("geojson is invalid")}const Ba=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Fa,coordEach:yt,coordReduce:La,featureEach:Ct,featureReduce:Io,findPoint:Ia,findSegment:Oa,flattenEach:vt,flattenReduce:Aa,geomEach:An,geomReduce:Ra,lineEach:Go,lineReduce:Na,propEach:Oo,propReduce:Ca,segmentEach:Bo,segmentReduce:Do},Symbol.toStringTag,{value:"Module"}));function hn(n){if(!n)throw new Error("geojson is required");var e=[];return vt(n,function(r){Da(r,e)}),Pa(e)}function Da(n,e){var r=[],t=n.geometry;if(t!==null){switch(t.type){case"Polygon":r=ze(t);break;case"LineString":r=[ze(t)]}r.forEach(function(o){var i=Ga(o,n.properties);i.forEach(function(s){s.id=e.length,e.push(s)})})}}function Ga(n,e){var r=[];return n.reduce(function(t,o){var i=Ma([t,o],e);return i.bbox=Ta(t,o),r.push(i),o}),r}function Ta(n,e){var r=n[0],t=n[1],o=e[0],i=e[1],s=r<o?r:o,l=t<i?t:i,a=r>o?r:o,u=t>i?t:i;return[s,l,a,u]}var Nn={exports:{}},To={exports:{}};(function(n,e){(function(r,t){n.exports=t()})(Gs,function(){function r(_,m,M,E,k){(function A(B,T,z,N,O){for(;N>z;){if(N-z>600){var I=N-z+1,F=T-z+1,ee=Math.log(I),te=.5*Math.exp(2*ee/3),he=.5*Math.sqrt(ee*te*(I-te)/I)*(F-I/2<0?-1:1),Re=Math.max(z,Math.floor(T-F*te/I+he)),$t=Math.min(N,Math.floor(T+(I-F)*te/I+he));A(B,T,Re,$t,O)}var U=B[T],V=z,ae=N;for(t(B,z,T),O(B[N],U)>0&&t(B,z,N);V<ae;){for(t(B,V,ae),V++,ae--;O(B[V],U)<0;)V++;for(;O(B[ae],U)>0;)ae--}O(B[z],U)===0?t(B,z,ae):t(B,++ae,N),ae<=T&&(z=ae+1),T<=ae&&(N=ae-1)}})(_,m,M||0,E||_.length-1,k||o)}function t(_,m,M){var E=_[m];_[m]=_[M],_[M]=E}function o(_,m){return _<m?-1:_>m?1:0}var i=function(_){_===void 0&&(_=9),this._maxEntries=Math.max(4,_),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(_,m,M){if(!M)return m.indexOf(_);for(var E=0;E<m.length;E++)if(M(_,m[E]))return E;return-1}function l(_,m){a(_,0,_.children.length,m,_)}function a(_,m,M,E,k){k||(k=y(null)),k.minX=1/0,k.minY=1/0,k.maxX=-1/0,k.maxY=-1/0;for(var A=m;A<M;A++){var B=_.children[A];u(k,_.leaf?E(B):B)}return k}function u(_,m){return _.minX=Math.min(_.minX,m.minX),_.minY=Math.min(_.minY,m.minY),_.maxX=Math.max(_.maxX,m.maxX),_.maxY=Math.max(_.maxY,m.maxY),_}function c(_,m){return _.minX-m.minX}function f(_,m){return _.minY-m.minY}function d(_){return(_.maxX-_.minX)*(_.maxY-_.minY)}function p(_){return _.maxX-_.minX+(_.maxY-_.minY)}function h(_,m){return _.minX<=m.minX&&_.minY<=m.minY&&m.maxX<=_.maxX&&m.maxY<=_.maxY}function g(_,m){return m.minX<=_.maxX&&m.minY<=_.maxY&&m.maxX>=_.minX&&m.maxY>=_.minY}function y(_){return{children:_,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function S(_,m,M,E,k){for(var A=[m,M];A.length;)if(!((M=A.pop())-(m=A.pop())<=E)){var B=m+Math.ceil((M-m)/E/2)*E;r(_,B,m,M,k),A.push(m,B,B,M)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(_){var m=this.data,M=[];if(!g(_,m))return M;for(var E=this.toBBox,k=[];m;){for(var A=0;A<m.children.length;A++){var B=m.children[A],T=m.leaf?E(B):B;g(_,T)&&(m.leaf?M.push(B):h(_,T)?this._all(B,M):k.push(B))}m=k.pop()}return M},i.prototype.collides=function(_){var m=this.data;if(!g(_,m))return!1;for(var M=[];m;){for(var E=0;E<m.children.length;E++){var k=m.children[E],A=m.leaf?this.toBBox(k):k;if(g(_,A)){if(m.leaf||h(_,A))return!0;M.push(k)}}m=M.pop()}return!1},i.prototype.load=function(_){if(!_||!_.length)return this;if(_.length<this._minEntries){for(var m=0;m<_.length;m++)this.insert(_[m]);return this}var M=this._build(_.slice(),0,_.length-1,0);if(this.data.children.length)if(this.data.height===M.height)this._splitRoot(this.data,M);else{if(this.data.height<M.height){var E=this.data;this.data=M,M=E}this._insert(M,this.data.height-M.height-1,!0)}else this.data=M;return this},i.prototype.insert=function(_){return _&&this._insert(_,this.data.height-1),this},i.prototype.clear=function(){return this.data=y([]),this},i.prototype.remove=function(_,m){if(!_)return this;for(var M,E,k,A=this.data,B=this.toBBox(_),T=[],z=[];A||T.length;){if(A||(A=T.pop(),E=T[T.length-1],M=z.pop(),k=!0),A.leaf){var N=s(_,A.children,m);if(N!==-1)return A.children.splice(N,1),T.push(A),this._condense(T),this}k||A.leaf||!h(A,B)?E?(M++,A=E.children[M],k=!1):A=null:(T.push(A),z.push(M),M=0,E=A,A=A.children[0])}return this},i.prototype.toBBox=function(_){return _},i.prototype.compareMinX=function(_,m){return _.minX-m.minX},i.prototype.compareMinY=function(_,m){return _.minY-m.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(_){return this.data=_,this},i.prototype._all=function(_,m){for(var M=[];_;)_.leaf?m.push.apply(m,_.children):M.push.apply(M,_.children),_=M.pop();return m},i.prototype._build=function(_,m,M,E){var k,A=M-m+1,B=this._maxEntries;if(A<=B)return l(k=y(_.slice(m,M+1)),this.toBBox),k;E||(E=Math.ceil(Math.log(A)/Math.log(B)),B=Math.ceil(A/Math.pow(B,E-1))),(k=y([])).leaf=!1,k.height=E;var T=Math.ceil(A/B),z=T*Math.ceil(Math.sqrt(B));S(_,m,M,z,this.compareMinX);for(var N=m;N<=M;N+=z){var O=Math.min(N+z-1,M);S(_,N,O,T,this.compareMinY);for(var I=N;I<=O;I+=T){var F=Math.min(I+T-1,O);k.children.push(this._build(_,I,F,E-1))}}return l(k,this.toBBox),k},i.prototype._chooseSubtree=function(_,m,M,E){for(;E.push(m),!m.leaf&&E.length-1!==M;){for(var k=1/0,A=1/0,B=void 0,T=0;T<m.children.length;T++){var z=m.children[T],N=d(z),O=(I=_,F=z,(Math.max(F.maxX,I.maxX)-Math.min(F.minX,I.minX))*(Math.max(F.maxY,I.maxY)-Math.min(F.minY,I.minY))-N);O<A?(A=O,k=N<k?N:k,B=z):O===A&&N<k&&(k=N,B=z)}m=B||m.children[0]}var I,F;return m},i.prototype._insert=function(_,m,M){var E=M?_:this.toBBox(_),k=[],A=this._chooseSubtree(E,this.data,m,k);for(A.children.push(_),u(A,E);m>=0&&k[m].children.length>this._maxEntries;)this._split(k,m),m--;this._adjustParentBBoxes(E,k,m)},i.prototype._split=function(_,m){var M=_[m],E=M.children.length,k=this._minEntries;this._chooseSplitAxis(M,k,E);var A=this._chooseSplitIndex(M,k,E),B=y(M.children.splice(A,M.children.length-A));B.height=M.height,B.leaf=M.leaf,l(M,this.toBBox),l(B,this.toBBox),m?_[m-1].children.push(B):this._splitRoot(M,B)},i.prototype._splitRoot=function(_,m){this.data=y([_,m]),this.data.height=_.height+1,this.data.leaf=!1,l(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(_,m,M){for(var E,k,A,B,T,z,N,O=1/0,I=1/0,F=m;F<=M-m;F++){var ee=a(_,0,F,this.toBBox),te=a(_,F,M,this.toBBox),he=(k=ee,A=te,B=void 0,T=void 0,z=void 0,N=void 0,B=Math.max(k.minX,A.minX),T=Math.max(k.minY,A.minY),z=Math.min(k.maxX,A.maxX),N=Math.min(k.maxY,A.maxY),Math.max(0,z-B)*Math.max(0,N-T)),Re=d(ee)+d(te);he<O?(O=he,E=F,I=Re<I?Re:I):he===O&&Re<I&&(I=Re,E=F)}return E||M-m},i.prototype._chooseSplitAxis=function(_,m,M){var E=_.leaf?this.compareMinX:c,k=_.leaf?this.compareMinY:f;this._allDistMargin(_,m,M,E)<this._allDistMargin(_,m,M,k)&&_.children.sort(E)},i.prototype._allDistMargin=function(_,m,M,E){_.children.sort(E);for(var k=this.toBBox,A=a(_,0,m,k),B=a(_,M-m,M,k),T=p(A)+p(B),z=m;z<M-m;z++){var N=_.children[z];u(A,_.leaf?k(N):N),T+=p(A)}for(var O=M-m-1;O>=m;O--){var I=_.children[O];u(B,_.leaf?k(I):I),T+=p(B)}return T},i.prototype._adjustParentBBoxes=function(_,m,M){for(var E=M;E>=0;E--)u(m[E],_)},i.prototype._condense=function(_){for(var m=_.length-1,M=void 0;m>=0;m--)_[m].children.length===0?m>0?(M=_[m-1].children).splice(M.indexOf(_[m]),1):this.clear():l(_[m],this.toBBox)},i})})(To);var Ua=To.exports,Uo={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.earthRadius=63710088e-1,n.factors={centimeters:n.earthRadius*100,centimetres:n.earthRadius*100,degrees:n.earthRadius/111325,feet:n.earthRadius*3.28084,inches:n.earthRadius*39.37,kilometers:n.earthRadius/1e3,kilometres:n.earthRadius/1e3,meters:n.earthRadius,metres:n.earthRadius,miles:n.earthRadius/1609.344,millimeters:n.earthRadius*1e3,millimetres:n.earthRadius*1e3,nauticalmiles:n.earthRadius/1852,radians:1,yards:n.earthRadius*1.0936},n.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/n.earthRadius,yards:1.0936133},n.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function e(N,O,I){I===void 0&&(I={});var F={type:"Feature"};return(I.id===0||I.id)&&(F.id=I.id),I.bbox&&(F.bbox=I.bbox),F.properties=O||{},F.geometry=N,F}n.feature=e;function r(N,O,I){switch(N){case"Point":return t(O).geometry;case"LineString":return l(O).geometry;case"Polygon":return i(O).geometry;case"MultiPoint":return f(O).geometry;case"MultiLineString":return c(O).geometry;case"MultiPolygon":return d(O).geometry;default:throw new Error(N+" is invalid")}}n.geometry=r;function t(N,O,I){if(I===void 0&&(I={}),!N)throw new Error("coordinates is required");if(!Array.isArray(N))throw new Error("coordinates must be an Array");if(N.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!A(N[0])||!A(N[1]))throw new Error("coordinates must contain numbers");var F={type:"Point",coordinates:N};return e(F,O,I)}n.point=t;function o(N,O,I){return I===void 0&&(I={}),u(N.map(function(F){return t(F,O)}),I)}n.points=o;function i(N,O,I){I===void 0&&(I={});for(var F=0,ee=N;F<ee.length;F++){var te=ee[F];if(te.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var he=0;he<te[te.length-1].length;he++)if(te[te.length-1][he]!==te[0][he])throw new Error("First and last Position are not equivalent.")}var Re={type:"Polygon",coordinates:N};return e(Re,O,I)}n.polygon=i;function s(N,O,I){return I===void 0&&(I={}),u(N.map(function(F){return i(F,O)}),I)}n.polygons=s;function l(N,O,I){if(I===void 0&&(I={}),N.length<2)throw new Error("coordinates must be an array of two or more positions");var F={type:"LineString",coordinates:N};return e(F,O,I)}n.lineString=l;function a(N,O,I){return I===void 0&&(I={}),u(N.map(function(F){return l(F,O)}),I)}n.lineStrings=a;function u(N,O){O===void 0&&(O={});var I={type:"FeatureCollection"};return O.id&&(I.id=O.id),O.bbox&&(I.bbox=O.bbox),I.features=N,I}n.featureCollection=u;function c(N,O,I){I===void 0&&(I={});var F={type:"MultiLineString",coordinates:N};return e(F,O,I)}n.multiLineString=c;function f(N,O,I){I===void 0&&(I={});var F={type:"MultiPoint",coordinates:N};return e(F,O,I)}n.multiPoint=f;function d(N,O,I){I===void 0&&(I={});var F={type:"MultiPolygon",coordinates:N};return e(F,O,I)}n.multiPolygon=d;function p(N,O,I){I===void 0&&(I={});var F={type:"GeometryCollection",geometries:N};return e(F,O,I)}n.geometryCollection=p;function h(N,O){if(O===void 0&&(O=0),O&&!(O>=0))throw new Error("precision must be a positive number");var I=Math.pow(10,O||0);return Math.round(N*I)/I}n.round=h;function g(N,O){O===void 0&&(O="kilometers");var I=n.factors[O];if(!I)throw new Error(O+" units is invalid");return N*I}n.radiansToLength=g;function y(N,O){O===void 0&&(O="kilometers");var I=n.factors[O];if(!I)throw new Error(O+" units is invalid");return N/I}n.lengthToRadians=y;function S(N,O){return m(y(N,O))}n.lengthToDegrees=S;function _(N){var O=N%360;return O<0&&(O+=360),O}n.bearingToAzimuth=_;function m(N){var O=N%(2*Math.PI);return O*180/Math.PI}n.radiansToDegrees=m;function M(N){var O=N%360;return O*Math.PI/180}n.degreesToRadians=M;function E(N,O,I){if(O===void 0&&(O="kilometers"),I===void 0&&(I="kilometers"),!(N>=0))throw new Error("length must be a positive number");return g(y(N,O),I)}n.convertLength=E;function k(N,O,I){if(O===void 0&&(O="meters"),I===void 0&&(I="kilometers"),!(N>=0))throw new Error("area must be a positive number");var F=n.areaFactors[O];if(!F)throw new Error("invalid original units");var ee=n.areaFactors[I];if(!ee)throw new Error("invalid final units");return N/F*ee}n.convertArea=k;function A(N){return!isNaN(N)&&N!==null&&!Array.isArray(N)}n.isNumber=A;function B(N){return!!N&&N.constructor===Object}n.isObject=B;function T(N){if(!N)throw new Error("bbox is required");if(!Array.isArray(N))throw new Error("bbox must be an Array");if(N.length!==4&&N.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");N.forEach(function(O){if(!A(O))throw new Error("bbox must only contain numbers")})}n.validateBBox=T;function z(N){if(!N)throw new Error("id is required");if(["string","number"].indexOf(typeof N)===-1)throw new Error("id must be a number or a string")}n.validateId=z})(Uo);const xa=mo(Ba),qa=mo(Ts);var xe=Ua,xo=Uo,qo=xa,wt=qa.default,za=qo.featureEach;qo.coordEach;xo.polygon;var ki=xo.featureCollection;function zo(n){var e=new xe(n);return e.insert=function(r){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:wt(r),xe.prototype.insert.call(this,r)},e.load=function(r){var t=[];return Array.isArray(r)?r.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:wt(o),t.push(o)}):za(r,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:wt(o),t.push(o)}),xe.prototype.load.call(this,t)},e.remove=function(r,t){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:wt(r),xe.prototype.remove.call(this,r,t)},e.clear=function(){return xe.prototype.clear.call(this)},e.search=function(r){var t=xe.prototype.search.call(this,this.toBBox(r));return ki(t)},e.collides=function(r){return xe.prototype.collides.call(this,this.toBBox(r))},e.all=function(){var r=xe.prototype.all.call(this);return ki(r)},e.toJSON=function(){return xe.prototype.toJSON.call(this)},e.fromJSON=function(r){return xe.prototype.fromJSON.call(this,r)},e.toBBox=function(r){var t;if(r.bbox)t=r.bbox;else if(Array.isArray(r)&&r.length===4)t=r;else if(Array.isArray(r)&&r.length===6)t=[r[0],r[1],r[3],r[4]];else if(r.type==="Feature")t=wt(r);else if(r.type==="FeatureCollection")t=wt(r);else throw new Error("invalid geojson");return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},e}Nn.exports=zo;Nn.exports.default=zo;var Ya=Nn.exports;const On=Us(Ya);function Yo(n,e){var r={},t=[];if(n.type==="LineString"&&(n=dn(n)),e.type==="LineString"&&(e=dn(e)),n.type==="Feature"&&e.type==="Feature"&&n.geometry!==null&&e.geometry!==null&&n.geometry.type==="LineString"&&e.geometry.type==="LineString"&&n.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=Si(n,e);return o&&t.push(o),$i(t)}var i=On();return i.load(hn(e)),Ct(hn(n),function(s){Ct(i.search(s),function(l){var a=Si(s,l);if(a){var u=ze(a).join(",");r[u]||(r[u]=!0,t.push(a))}})}),$i(t)}function Si(n,e){var r=ze(n),t=ze(e);if(r.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(t.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=r[0][0],i=r[0][1],s=r[1][0],l=r[1][1],a=t[0][0],u=t[0][1],c=t[1][0],f=t[1][1],d=(f-u)*(s-o)-(c-a)*(l-i),p=(c-a)*(i-u)-(f-u)*(o-a),h=(s-o)*(i-u)-(l-i)*(o-a);if(d===0)return null;var g=p/d,y=h/d;if(g>=0&&g<=1&&y>=0&&y<=1){var S=o+g*(s-o),_=i+g*(l-i);return Sa([S,_])}return null}function Jo(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function zr(n,e,r){if(r===void 0&&(r={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Mi(n[0])||!Mi(n[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:n};return Jo(t,e,r)}function Ei(n,e,r){if(r===void 0&&(r={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:n};return Jo(t,e,r)}function Mi(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Ir(n,e,r){r===void 0&&(r={});var t=zr([1/0,1/0],{dist:1/0}),o=0;return vt(n,function(i){for(var s=ze(i),l=0;l<s.length-1;l++){var a=zr(s[l]);a.properties.dist=rt(e,a,r);var u=zr(s[l+1]);u.properties.dist=rt(e,u,r);var c=rt(a,u,r),f=Math.max(a.properties.dist,u.properties.dist),d=Ao(a,u),p=vi(e,f,d+90,r),h=vi(e,f,d-90,r),g=Yo(Ei([p.geometry.coordinates,h.geometry.coordinates]),Ei([a.geometry.coordinates,u.geometry.coordinates])),y=null;g.features.length>0&&(y=g.features[0],y.properties.dist=rt(e,y,r),y.properties.location=o+rt(a,y,r)),a.properties.dist<t.properties.dist&&(t=a,t.properties.index=l,t.properties.location=o),u.properties.dist<t.properties.dist&&(t=u,t.properties.index=l+1,t.properties.location=o+c),y&&y.properties.dist<t.properties.dist&&(t=y,t.properties.index=l),o+=c}}),t}function Xo(){return{type:"FeatureCollection",features:[]}}function Yr(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Vo(n)}}}function Vo(n){return[Math.round(n[0]*1e7)/1e7,Math.round(n[1]*1e7)/1e7]}const Wo=ve(Xo()),Ho=ve(0),Ja=100;class Xa{constructor(e){se(this,"map");se(this,"active");se(this,"eventListenersSuccess");se(this,"eventListenersUpdated");se(this,"eventListenersFailure");se(this,"points");se(this,"cursor");se(this,"hover");se(this,"dragFrom");se(this,"previousStates");se(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let r=this.dragFrom[0]-e.lngLat.lng,t=this.dragFrom[1]-e.lngLat.lat;for(let o of this.points)o[0]-=r,o[1]-=t}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});se(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let r=[];if(Pi(this.points).forEach((t,o)=>{r.push([o+1,Ir(t,this.cursor).properties.dist])}),r.sort((t,o)=>t[1]-o[1]),r.length>0){let t=r[0][0];this.points.splice(t,0,this.cursor.geometry.coordinates),this.hover=t}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});se(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Yr(e.lngLat.toArray()),this.onClick(e),this.finish())});se(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});se(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});se(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});se(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let r of this.eventListenersSuccess)r(e);else for(let r of this.eventListenersFailure)r();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=Xo();this.points.forEach((o,i)=>{let s=Yr(o);s.properties.hover=this.hover==i,s.properties.idx=i,e.features.push(s)}),e.features=e.features.concat(Pi(this.points));let r=this.polygonFeature();r&&(r.properties.hover=this.hover=="polygon",e.features.push(r)),Wo.set(e);let t="crosshair";this.hover!=null&&(t=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=t,Ho.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let r of this.eventListenersUpdated)r(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let r of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(r.geometry.type=="Polygon"){this.hover="polygon";break}else if(r.geometry.type=="Point"&&Object.hasOwn(r.properties,"idx")){this.hover=r.properties.idx;break}this.hover==null&&(this.cursor=Yr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(Vo),r=[JSON.parse(JSON.stringify(e))];return r[0].push(JSON.parse(JSON.stringify(r[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:r},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>Ja&&this.previousStates.shift()}}function Pi(n){let e=[];for(let r=0;r<n.length-1;r++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[r],n[r+1]]},properties:{}});return n.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[n.length-1],n[0]]},properties:{}}),e}let X;const Zo=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Zo.decode();let Gt=null;function Yt(){return(Gt===null||Gt.byteLength===0)&&(Gt=new Uint8Array(X.memory.buffer)),Gt}function je(n,e){return n=n>>>0,Zo.decode(Yt().subarray(n,n+e))}const Qe=new Array(128).fill(void 0);Qe.push(void 0,null,!0,!1);let Jt=Qe.length;function me(n){Jt===Qe.length&&Qe.push(Qe.length+1);const e=Jt;return Jt=Qe[e],Qe[e]=n,e}function H(n){return Qe[n]}function Va(n){n<132||(Qe[n]=Jt,Jt=n)}function gr(n){const e=H(n);return Va(n),e}function Jr(n){return n==null}let Tt=null;function Wa(){return(Tt===null||Tt.byteLength===0)&&(Tt=new Float64Array(X.memory.buffer)),Tt}let Ut=null;function le(){return(Ut===null||Ut.byteLength===0)&&(Ut=new Int32Array(X.memory.buffer)),Ut}let ot=0;const _r=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Ha=typeof _r.encodeInto=="function"?function(n,e){return _r.encodeInto(n,e)}:function(n,e){const r=_r.encode(n);return e.set(r),{read:n.length,written:r.length}};function fr(n,e,r){if(r===void 0){const l=_r.encode(n),a=e(l.length,1)>>>0;return Yt().subarray(a,a+l.length).set(l),ot=l.length,a}let t=n.length,o=e(t,1)>>>0;const i=Yt();let s=0;for(;s<t;s++){const l=n.charCodeAt(s);if(l>127)break;i[o+s]=l}if(s!==t){s!==0&&(n=n.slice(s)),o=r(o,t,t=s+n.length*3,1)>>>0;const l=Yt().subarray(o+s,o+t),a=Ha(n,l);s+=a.written}return ot=s,o}function mn(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const o=n.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=n.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(n)){const o=n.length;let i="[";o>0&&(i+=mn(n[0]));for(let s=1;s<o;s++)i+=", "+mn(n[s]);return i+="]",i}const r=/\[object ([^\]]+)\]/.exec(toString.call(n));let t;if(r.length>1)t=r[1];else return toString.call(n);if(t=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:t}function Za(n,e){const r=e(n.length*1,1)>>>0;return Yt().set(n,r/1),ot=n.length,r}function Xr(n,e){try{return n.apply(this,e)}catch(r){X.__wbindgen_exn_store(me(r))}}class Br{static __wrap(e){e=e>>>0;const r=Object.create(Br.prototype);return r.__wbg_ptr=e,r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();X.__wbg_jsroutesnapper_free(e)}constructor(e){try{const i=X.__wbindgen_add_to_stack_pointer(-16),s=Za(e,X.__wbindgen_malloc),l=ot;X.jsroutesnapper_new(i,s,l);var r=le()[i/4+0],t=le()[i/4+1],o=le()[i/4+2];if(o)throw gr(t);return Br.__wrap(r)}finally{X.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){X.jsroutesnapper_setRouteConfig(this.__wbg_ptr,me(e))}setAreaMode(){X.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,r;try{const i=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_getConfig(i,this.__wbg_ptr);var t=le()[i/4+0],o=le()[i/4+1];return e=t,r=o,je(t,o)}finally{X.__wbindgen_add_to_stack_pointer(16),X.__wbindgen_free(e,r,1)}}toFinalFeature(){try{const t=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=le()[t/4+0],r=le()[t/4+1];let o;return e!==0&&(o=je(e,r).slice(),X.__wbindgen_free(e,r*1)),o}finally{X.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,r;try{const i=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_renderGeojson(i,this.__wbg_ptr);var t=le()[i/4+0],o=le()[i/4+1];return e=t,r=o,je(t,o)}finally{X.__wbindgen_add_to_stack_pointer(16),X.__wbindgen_free(e,r,1)}}toggleSnapMode(){X.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,r,t){return X.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,r,t)!==0}onClick(){X.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return X.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return X.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){X.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_editExisting(o,this.__wbg_ptr,me(e));var r=le()[o/4+0],t=le()[o/4+1];if(t)throw gr(r)}finally{X.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,r;try{const i=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_debugRenderGraph(i,this.__wbg_ptr);var t=le()[i/4+0],o=le()[i/4+1];return e=t,r=o,je(t,o)}finally{X.__wbindgen_add_to_stack_pointer(16),X.__wbindgen_free(e,r,1)}}routeNameForWaypoints(e){let r,t;try{const c=X.__wbindgen_add_to_stack_pointer(-16);X.jsroutesnapper_routeNameForWaypoints(c,this.__wbg_ptr,me(e));var o=le()[c/4+0],i=le()[c/4+1],s=le()[c/4+2],l=le()[c/4+3],a=o,u=i;if(l)throw a=0,u=0,gr(s);return r=a,t=u,je(a,u)}finally{X.__wbindgen_add_to_stack_pointer(16),X.__wbindgen_free(r,t,1)}}addSnappedWaypoint(e,r){X.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,r)}undo(){X.jsroutesnapper_undo(this.__wbg_ptr)}}async function Ka(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(t){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const r=await n.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(n,e);return r instanceof WebAssembly.Instance?{instance:r,module:n}:r}}function ja(){const n={};return n.wbg={},n.wbg.__wbindgen_string_new=function(e,r){const t=je(e,r);return me(t)},n.wbg.__wbindgen_object_drop_ref=function(e){gr(e)},n.wbg.__wbindgen_error_new=function(e,r){const t=new Error(je(e,r));return me(t)},n.wbg.__wbindgen_is_object=function(e){const r=H(e);return typeof r=="object"&&r!==null},n.wbg.__wbindgen_is_undefined=function(e){return H(e)===void 0},n.wbg.__wbindgen_in=function(e,r){return H(e)in H(r)},n.wbg.__wbindgen_number_get=function(e,r){const t=H(r),o=typeof t=="number"?t:void 0;Wa()[e/8+1]=Jr(o)?0:o,le()[e/4+0]=!Jr(o)},n.wbg.__wbindgen_boolean_get=function(e){const r=H(e);return typeof r=="boolean"?r?1:0:2},n.wbg.__wbindgen_object_clone_ref=function(e){const r=H(e);return me(r)},n.wbg.__wbindgen_jsval_loose_eq=function(e,r){return H(e)==H(r)},n.wbg.__wbindgen_string_get=function(e,r){const t=H(r),o=typeof t=="string"?t:void 0;var i=Jr(o)?0:fr(o,X.__wbindgen_malloc,X.__wbindgen_realloc),s=ot;le()[e/4+1]=s,le()[e/4+0]=i},n.wbg.__wbg_String_4370c5505c674d30=function(e,r){const t=String(H(r)),o=fr(t,X.__wbindgen_malloc,X.__wbindgen_realloc),i=ot;le()[e/4+1]=i,le()[e/4+0]=o},n.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,r){const t=H(e)[H(r)];return me(t)},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return me(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,r){const t=H(r).stack,o=fr(t,X.__wbindgen_malloc,X.__wbindgen_realloc),i=ot;le()[e/4+1]=i,le()[e/4+0]=o},n.wbg.__wbg_error_f851667af71bcfc6=function(e,r){let t,o;try{t=e,o=r,console.error(je(e,r))}finally{X.__wbindgen_free(t,o,1)}},n.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(H(e))},n.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(H(e))},n.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(H(e))},n.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(H(e))},n.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(H(e))},n.wbg.__wbg_get_44be0491f933a435=function(e,r){const t=H(e)[r>>>0];return me(t)},n.wbg.__wbg_length_fff51ee6522a1a18=function(e){return H(e).length},n.wbg.__wbindgen_is_function=function(e){return typeof H(e)=="function"},n.wbg.__wbg_next_526fc47e980da008=function(e){const r=H(e).next;return me(r)},n.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Xr(function(e){const r=H(e).next();return me(r)},arguments)},n.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return H(e).done},n.wbg.__wbg_value_1695675138684bd5=function(e){const r=H(e).value;return me(r)},n.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return me(Symbol.iterator)},n.wbg.__wbg_get_97b561fb56f034b5=function(){return Xr(function(e,r){const t=Reflect.get(H(e),H(r));return me(t)},arguments)},n.wbg.__wbg_call_cb65541d95d71282=function(){return Xr(function(e,r){const t=H(e).call(H(r));return me(t)},arguments)},n.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(H(e))},n.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let r;try{r=H(e)instanceof ArrayBuffer}catch{r=!1}return r},n.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const r=H(e).buffer;return me(r)},n.wbg.__wbg_new_8125e318e6245eed=function(e){const r=new Uint8Array(H(e));return me(r)},n.wbg.__wbg_set_5cf90238115182c3=function(e,r,t){H(e).set(H(r),t>>>0)},n.wbg.__wbg_length_72e2208bbc0efc61=function(e){return H(e).length},n.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let r;try{r=H(e)instanceof Uint8Array}catch{r=!1}return r},n.wbg.__wbindgen_debug_string=function(e,r){const t=mn(H(r)),o=fr(t,X.__wbindgen_malloc,X.__wbindgen_realloc),i=ot;le()[e/4+1]=i,le()[e/4+0]=o},n.wbg.__wbindgen_throw=function(e,r){throw new Error(je(e,r))},n.wbg.__wbindgen_memory=function(){const e=X.memory;return me(e)},n}function Qa(n,e){return X=n.exports,Ko.__wbindgen_wasm_module=e,Tt=null,Ut=null,Gt=null,X}async function Ko(n){if(X!==void 0)return X;typeof n>"u"&&(n="/atip/ss_huge_refactor_pt1/assets/route_snapper_bg.wasm");const e=ja();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:r,module:t}=await Ka(await n,e);return Qa(r,t)}function eu(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function tu(n,e,r){if(r===void 0&&(r={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Li(n[0])||!Li(n[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:n};return eu(t,e,r)}function Li(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function gn(n,e){return e===void 0&&(e={}),Do(n,function(r,t){var o=t.geometry.coordinates;return r+rt(o[0],o[1],e)},0)}function ru(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function nu(n,e,r){if(r===void 0&&(r={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:n};return ru(t,e,r)}function iu(n,e,r){var t=ze(r);if(pn(r)!=="LineString")throw new Error("line must be a LineString");var o=Ir(r,n),i=Ir(r,e),s;o.properties.index<=i.properties.index?s=[o,i]:s=[i,o];for(var l=[s[0].geometry.coordinates],a=s[0].properties.index+1;a<s[1].properties.index+1;a++)l.push(t[a]);return l.push(s[1].geometry.coordinates),nu(l,r.properties)}function ou(n){var e=n[0],r=n[1],t=n[2],o=n[3],i=rt(n.slice(0,2),[t,r]),s=rt(n.slice(0,2),[e,o]);if(i>=s){var l=(r+o)/2;return[e,l-(t-e)/2,t,l+(t-e)/2]}else{var a=(e+t)/2;return[a-(o-r)/2,r,a+(o-r)/2,o]}}function _n(n){var e=[1/0,1/0,-1/0,-1/0];return yt(n,function(r){e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])}),e}_n.default=_n;function su(n,e){e===void 0&&(e={});var r=e.precision,t=e.coordinates,o=e.mutate;if(r=r==null||isNaN(r)?6:r,t=t==null||isNaN(t)?3:t,!n)throw new Error("<geojson> is required");if(typeof r!="number")throw new Error("<precision> must be a number");if(typeof t!="number")throw new Error("<coordinates> must be a number");(o===!1||o===void 0)&&(n=JSON.parse(JSON.stringify(n)));var i=Math.pow(10,r);return yt(n,function(s){lu(s,i,t)}),n}function lu(n,e,r){n.length>r&&n.splice(r,n.length);for(var t=0;t<n.length;t++)n[t]=Math.round(n[t]*e)/e;return n}function au(n,e,r){r===void 0&&(r={});var t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=e||{},t.geometry=n,t}function Ci(n,e,r){if(r===void 0&&(r={}),n.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:n};return au(t,e,r)}function Xt(n,e){e===void 0&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=n,r}function uu(n,e){if(!n)throw new Error("line is required");if(!e)throw new Error("splitter is required");var r=pn(n),t=pn(e);if(r!=="LineString")throw new Error("line must be LineString");if(t==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(t==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var o=su(e,{precision:7});switch(t){case"Point":return yn(n,o);case"MultiPoint":return Fi(n,o);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Fi(n,Yo(n,o))}}function Fi(n,e){var r=[],t=On();return vt(e,function(o){if(r.forEach(function(l,a){l.id=a}),!r.length)r=yn(n,o).features,r.forEach(function(l){l.bbox||(l.bbox=ou(_n(l)))}),t.load(Xt(r));else{var i=t.search(o);if(i.features.length){var s=jo(o,i);r=r.filter(function(l){return l.id!==s.id}),t.remove(s),Ct(yn(s,o),function(l){r.push(l),t.insert(l)})}}}),Xt(r)}function yn(n,e){var r=[],t=ze(n)[0],o=ze(n)[n.geometry.coordinates.length-1];if(Vr(t,st(e))||Vr(o,st(e)))return Xt([n]);var i=On(),s=hn(n);i.load(s);var l=i.search(e);if(!l.features.length)return Xt([n]);var a=jo(e,l),u=[t],c=Io(s,function(f,d,p){var h=ze(d)[1],g=st(e);return p===a.id?(f.push(g),r.push(Ci(f)),Vr(g,h)?[g]:[g,h]):(f.push(h),f)},u);return c.length>1&&r.push(Ci(c)),Xt(r)}function jo(n,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var r,t=1/0;return Ct(e,function(o){var i=Ir(o,n),s=i.properties.dist;s<t&&(r=o,t=s)}),r}function Vr(n,e){return n[0]===e[0]&&n[1]===e[1]}function fu(n,e){let r=uu(n,e);if(r.features.length!=2)return null;let t=r.features[0],o=r.features[1];return t.geometry.coordinates=t.geometry.coordinates.map(Ai),o.geometry.coordinates=o.geometry.coordinates.map(Ai),t.properties=JSON.parse(JSON.stringify(n.properties)),o.properties=JSON.parse(JSON.stringify(n.properties)),cu(n,t,o,e),[t,o]}function cu(n,e,r,t){e.properties.length_meters=gn(e,{units:"kilometers"})*1e3,r.properties.length_meters=gn(r,{units:"kilometers"})*1e3,e.properties.waypoints=[],r.properties.waypoints=[];let o=Ri(n,t),i=!0,s=0;for(let l of n.properties.waypoints){let a=Ri(n,tu([l.lon,l.lat]));if(i)if(a<o)e.properties.waypoints.push(l);else{let u=l.snapped&&n.properties.waypoints[s-1].snapped;e.properties.waypoints.push({lon:t.geometry.coordinates[0],lat:t.geometry.coordinates[1],snapped:u}),i=!1,r.properties.waypoints.push({lon:t.geometry.coordinates[0],lat:t.geometry.coordinates[1],snapped:u}),r.properties.waypoints.push(l)}else r.properties.waypoints.push(l);s++}}function Ri(n,e){let r=n.geometry.coordinates[0],t=iu(r,e,n);return gn(t,{units:"kilometers"})*1e3}function Ai(n){return[Math.round(n[0]*1e7)/1e7,Math.round(n[1]*1e7)/1e7]}const pu=30;class du{constructor(e,r,t,o,i){this.onMouseMove=s=>{if(!this.active)return;const l=[s.point.x-pu,s.point.y],a=this.map.unproject(s.point).distanceTo(this.map.unproject(l));this.inner.onMouseMove(s.lngLat.lng,s.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=s=>{this.active&&(s.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=s=>{this.active&&s.key=="Escape"&&(s.stopPropagation(),this.cancel())},this.onKeyPress=s=>{this.active&&s.target.tagName!="INPUT"&&(s.key=="Enter"?(s.stopPropagation(),this.finish()):s.key=="s"||s.key=="S"?(s.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):s.key=="z"&&s.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Br(r),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=o,this.undoLength=i,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersSuccess)r(JSON.parse(e));else for(let r of this.eventListenersFailure)r();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let r of this.eventListenersUpdated)r(JSON.parse(e))}}function hu(n){return n=="google"||n=="bing"}const oe=ve(Fo()),Ht=ve(null),Ft=ve(null),et=ve(null),Vt=ve(new Set),Et=ve(null),Z=ve({mode:"list"});function yr(n){let e=new Set;for(let t of n.features)e.add(t.id);let r=e.size+1;for(;e.has(r);)r++;return r}function Ni(n){console.log(`Deleting intervention ${n}`),oe.update(e=>(e.features=e.features.filter(r=>r.id!=n),e)),Et.set(null),Z.set({mode:"list"})}function Wr(n){return Object.values(n.schemes)[0].scheme_reference}function Qo(n){return[Math.round(n[0]*1e7)/1e7,Math.round(n[1]*1e7)/1e7]}const mt=ve(mu());mt.subscribe(n=>window.localStorage.setItem("userSettings",JSON.stringify(n)));function mu(){let n={streetViewImagery:"google",avoidDoublingBack:!1};try{let e=JSON.parse(window.localStorage.getItem("userSettings")||"{}");hu(e.streetViewImagery)&&(n.streetViewImagery=e.streetViewImagery),typeof e.avoidDoublingBack=="boolean"&&(n.avoidDoublingBack=e.avoidDoublingBack)}catch(e){console.log(`Couldn't parse userSettings from local storage: ${e}`)}return n}let Ue=ve(null);const gu=ve("dataviz");let fe={interventionName:n=>n.properties.name||`Untitled ${n.geometry.type}`,schemeName:n=>`scheme ${n.scheme_reference}`,backfill:n=>n,interventionWarning:n=>null,editFeatureForm:null,newPointFeature:n=>{oe.update(e=>(n.id=yr(e),n.properties||(n.properties={}),n.properties.scheme_reference=Wr(e),e.features.push(n),e))},newPolygonFeature:n=>{oe.update(e=>(n.id=yr(e),n.properties||(n.properties={}),n.properties.scheme_reference=Wr(e),e.features.push(n),e))},newLineStringFeature:n=>{oe.update(e=>(n.id=yr(e),n.properties||(n.properties={}),n.properties.scheme_reference=Wr(e),e.features.push(n),e))},updateFeature:(n,e)=>{}};function be(n){return{id:n,beforeId:_u(n)}}function _u(n){let e=Sn(Ue);if(!e){console.warn(`getBeforeId(${n}) called before map is ready. Z-ordering may be incorrect.`);return}let r,t=!1;for(let o=Oi.length-1;o>=0;o--){let i=Oi[o];if(i==n){t=!0;break}e.getLayer(i)&&(r=i)}if(!t)throw new Error(`Layer ID ${n} not defined in layerZorder`);return r}const Oi=["interventions-coverage-polygons-outlines","interventions-polygons","interventions-polygons-outlines","hover-polygons","hover-lines","interventions-lines","interventions-lines-endpoints","hover-points","interventions-points","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices","draw-split-route","route-points","route-lines","route-polygons","road_label","boundary","georeferenced-image"],dt=["==",["geometry-type"],"Polygon"],Zt=["==",["geometry-type"],"LineString"],Kt=["==",["geometry-type"],"Point"];function Rt(){return{type:"FeatureCollection",features:[]}}function xt(n,e,r){let t=["match",n];for(let[o,i]of Object.entries(e))t.push(o),t.push(i);return t.push(r),t}function es(n){return xs(n)}function yu(n){var r,t;let e={type:"FeatureCollection",features:[]};for(let o of n.features)if(e.features.push(o),o.geometry.type=="LineString"&&!((r=o.properties)!=null&&r.hide_while_editing))for(let i of[o.geometry.coordinates[0],o.geometry.coordinates[o.geometry.coordinates.length-1]])e.features.push({type:"Feature",properties:{endpoint:!0,scheme_reference:(t=o.properties)==null?void 0:t.scheme_reference},geometry:{type:"Point",coordinates:i}});return e}function vu(n){let e,r;const t=[be("boundary"),{paint:{"fill-color":"black","fill-opacity":.5}}];let o={};for(let i=0;i<t.length;i+=1)o=pe(o,t[i]);return e=new rr({props:o}),{c(){P(e.$$.fragment)},m(i,s){L(e,i,s),r=!0},p(i,s){const l={};e.$set(l)},i(i){r||(b(e.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),r=!1},d(i){C(e,i)}}}function $u(n){let e,r;return e=new ht({props:{data:mi(n[0]),$$slots:{default:[vu]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,[o]){const i={};o&1&&(i.data=mi(t[0])),o&8&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function bu(n,e,r){let t;q(n,Ue,s=>r(2,t=s));let{boundaryGeojson:o}=e,{fitBoundsAtStart:i=!1}=e;return(qs("setCamera")||i)&&(t==null||t.fitBounds(es(o),{padding:20,animate:!1})),n.$$set=s=>{"boundaryGeojson"in s&&r(0,o=s.boundaryGeojson),"fitBoundsAtStart"in s&&r(1,i=s.fitBoundsAtStart)},[o,i]}class wu extends j{constructor(e){super(),Q(this,e,bu,$u,K,{boundaryGeojson:0,fitBoundsAtStart:1})}}function ku(n){let e;return{c(){e=D("li"),e.textContent="Click to add a new point"},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Su(n){let e;return{c(){e=D("li"),e.textContent="Click to move the point here"},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Eu(n){let e,r,t;function o(l,a){return l[0]?Su:ku}let i=o(n),s=i(n);return{c(){e=D("ul"),s.c(),r=R(),t=D("li"),t.innerHTML=`Press <b>Escape</b>
    to cancel`},m(l,a){v(l,e,a),s.m(e,null),J(e,r),J(e,t)},p(l,[a]){i!==(i=o(l))&&(s.d(1),s=i(l),s&&(s.c(),s.m(e,r)))},i:W,o:W,d(l){l&&$(e),s.d()}}}function Mu(n,e,r){let{editingExisting:t}=e;return n.$$set=o=>{"editingExisting"in o&&r(0,t=o.editingExisting)},[t]}class ts extends j{constructor(e){super(),Q(this,e,Mu,Eu,K,{editingExisting:0})}}function Pu(n){let e,r,t;return{c(){e=G("Undo ("),r=G(n[0]),t=G(")")},m(o,i){v(o,e,i),v(o,r,i),v(o,t,i)},p(o,i){i&1&&ge(r,o[0])},d(o){o&&($(e),$(r),$(t))}}}function Lu(n){let e;return{c(){e=G("Undo")},m(r,t){v(r,e,t)},p:W,d(r){r&&$(e)}}}function Cu(n){let e;function r(i,s){return i[0]==0?Lu:Pu}let t=r(n),o=t(n);return{c(){o.c(),e=ue()},m(i,s){o.m(i,s),v(i,e,s)},p(i,s){t===(t=r(i))&&o?o.p(i,s):(o.d(1),o=t(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){i&&$(e),o.d(i)}}}function Fu(n){let e,r,t,o;return e=new re({props:{disabled:n[0]==0,$$slots:{default:[Cu]},$$scope:{ctx:n}}}),e.$on("click",n[1]),{c(){P(e.$$.fragment),r=R(),t=D("ul"),t.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`},m(i,s){L(e,i,s),v(i,r,s),v(i,t,s),o=!0},p(i,[s]){const l={};s&1&&(l.disabled=i[0]==0),s&9&&(l.$$scope={dirty:s,ctx:i}),e.$set(l)},i(i){o||(b(e.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),o=!1},d(i){i&&($(r),$(t)),C(e,i)}}}function Ru(n,e,r){let t,o;q(n,Ft,s=>r(2,t=s)),q(n,Ho,s=>r(0,o=s));function i(){t.undo()}return[o,i]}class rs extends j{constructor(e){super(),Q(this,e,Ru,Fu,K,{})}}const ns=ve(Rt()),vr=ve(Rt()),is=ve(!0),In=ve(0);function Ii(n,e,r){const t=n.slice();return t[8]=e[r],t}function Bi(n){let e,r,t=n[8].place_name+"",o,i,s;function l(...a){return n[4](n[8],...a)}return{c(){e=D("li"),r=D("a"),o=G(t),x(r,"href","#")},m(a,u){v(a,e,u),J(e,r),J(r,o),i||(s=ke(r,"click",l),i=!0)},p(a,u){n=a,u&2&&t!==(t=n[8].place_name+"")&&ge(o,t)},d(a){a&&$(e),i=!1,s()}}}function Au(n){let e,r,t,o,i;function s(c){n[3](c)}let l={label:"Add waypoint by search"};n[0]!==void 0&&(l.value=n[0]),e=new pl({props:l}),ce.push(()=>de(e,"value",s));let a=Ye(n[1].features),u=[];for(let c=0;c<a.length;c+=1)u[c]=Bi(Ii(n,a,c));return{c(){P(e.$$.fragment),t=R(),o=D("ol");for(let c=0;c<u.length;c+=1)u[c].c();x(o,"class","govuk-list govuk-list--number")},m(c,f){L(e,c,f),v(c,t,f),v(c,o,f);for(let d=0;d<u.length;d+=1)u[d]&&u[d].m(o,null);i=!0},p(c,[f]){const d={};if(!r&&f&1&&(r=!0,d.value=c[0],_e(()=>r=!1)),e.$set(d),f&6){a=Ye(c[1].features);let p;for(p=0;p<a.length;p+=1){const h=Ii(c,a,p);u[p]?u[p].p(h,f):(u[p]=Bi(h),u[p].c(),u[p].m(o,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=a.length}},i(c){i||(b(e.$$.fragment,c),i=!0)},o(c){w(e.$$.fragment,c),i=!1},d(c){c&&($(t),$(o)),C(e,c),go(u,c)}}}function Nu(n,e,r){let t,o,i;q(n,et,f=>r(5,t=f)),q(n,vr,f=>r(1,o=f)),q(n,Ue,f=>r(6,i=f));let s="";async function l(f){if(!f){Te(vr,o=Rt(),o);return}let d=new URLSearchParams({country:"gb",proximity:i.getCenter().toArray().join(","),fuzzyMatch:"true",key:"MZEJTanw3WpxRvt7qDfo"}).toString(),p=`https://api.maptiler.com/geocoding/${f}.json?${d}`,g=await(await fetch(p)).json(),y=1;for(let S of g.features)S.properties.number=y++;Te(vr,o=g,o)}function a(f,d){f.preventDefault(),t.addSnappedWaypoint(d),r(0,s="")}function u(f){s=f,r(0,s)}const c=(f,d)=>a(d,f.center);return n.$$.update=()=>{n.$$.dirty&1&&l(s)},[s,o,a,u,c]}class Ou extends j{constructor(e){super(),Q(this,e,Nu,Au,K,{})}}function Iu(n){let e,r,t;return{c(){e=G("Undo ("),r=G(n[2]),t=G(")")},m(o,i){v(o,e,i),v(o,r,i),v(o,t,i)},p(o,i){i&4&&ge(r,o[2])},d(o){o&&($(e),$(r),$(t))}}}function Bu(n){let e;return{c(){e=G("Undo")},m(r,t){v(r,e,t)},p:W,d(r){r&&$(e)}}}function Du(n){let e;function r(i,s){return i[2]==0?Bu:Iu}let t=r(n),o=t(n);return{c(){o.c(),e=ue()},m(i,s){o.m(i,s),v(i,e,s)},p(i,s){t===(t=r(i))&&o?o.p(i,s):(o.d(1),o=t(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){i&&$(e),o.d(i)}}}function Gu(n){let e,r,t,o;return t=new re({props:{$$slots:{default:[Uu]},$$scope:{ctx:n}}}),t.$on("click",n[5]),{c(){e=D("p"),e.innerHTML=`Drawing points anywhere. Press <b>s</b>
    or click below to snap to roads`,r=R(),P(t.$$.fragment),ye(e,"background","blue"),ye(e,"color","white"),ye(e,"padding","8px")},m(i,s){v(i,e,s),v(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&512&&(l.$$scope={dirty:s,ctx:i}),t.$set(l)},i(i){o||(b(t.$$.fragment,i),o=!0)},o(i){w(t.$$.fragment,i),o=!1},d(i){i&&($(e),$(r)),C(t,i)}}}function Tu(n){let e,r,t,o;return t=new re({props:{$$slots:{default:[xu]},$$scope:{ctx:n}}}),t.$on("click",n[5]),{c(){e=D("p"),e.innerHTML=`Snapping to existing roads. Press <b>s</b>
    or click below to draw anywhere`,r=R(),P(t.$$.fragment),ye(e,"background","red"),ye(e,"color","white"),ye(e,"padding","8px")},m(i,s){v(i,e,s),v(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&512&&(l.$$scope={dirty:s,ctx:i}),t.$set(l)},i(i){o||(b(t.$$.fragment,i),o=!0)},o(i){w(t.$$.fragment,i),o=!1},d(i){i&&($(e),$(r)),C(t,i)}}}function Uu(n){let e;return{c(){e=G("Snap to roads")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function xu(n){let e;return{c(){e=G("Draw anywhere")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function qu(n){let e;return{c(){e=G("Add points to end")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function zu(n){let e;return{c(){e=G("Avoid doubling back")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Yu(n){let e,r,t,o,i,s;function l(f){n[7](f)}let a={hint:"Keep clicking to add more points to the end of the route",$$slots:{default:[qu]},$$scope:{ctx:n}};n[0]!==void 0&&(a.checked=n[0]),e=new jr({props:a}),ce.push(()=>de(e,"checked",l));function u(f){n[8](f)}let c={hint:"Try to make the route avoid using the same streets with multiple waypoints",$$slots:{default:[zu]},$$scope:{ctx:n}};return n[1].avoidDoublingBack!==void 0&&(c.checked=n[1].avoidDoublingBack),o=new jr({props:c}),ce.push(()=>de(o,"checked",u)),{c(){P(e.$$.fragment),t=R(),P(o.$$.fragment)},m(f,d){L(e,f,d),v(f,t,d),L(o,f,d),s=!0},p(f,d){const p={};d&512&&(p.$$scope={dirty:d,ctx:f}),!r&&d&1&&(r=!0,p.checked=f[0],_e(()=>r=!1)),e.$set(p);const h={};d&512&&(h.$$scope={dirty:d,ctx:f}),!i&&d&2&&(i=!0,h.checked=f[1].avoidDoublingBack,_e(()=>i=!1)),o.$set(h)},i(f){s||(b(e.$$.fragment,f),b(o.$$.fragment,f),s=!0)},o(f){w(e.$$.fragment,f),w(o.$$.fragment,f),s=!1},d(f){f&&$(t),C(e,f),C(o,f)}}}function Ju(n){let e,r,t,o,i,s,l,a,u,c,f;e=new re({props:{disabled:n[2]==0,$$slots:{default:[Du]},$$scope:{ctx:n}}}),e.$on("click",n[4]);const d=[Tu,Gu],p=[];function h(g,y){return g[3]?0:1}return t=h(n),o=p[t]=d[t](n),a=new tl({props:{small:!0,$$slots:{default:[Yu]},$$scope:{ctx:n}}}),c=new Ou({}),{c(){P(e.$$.fragment),r=R(),o.c(),i=R(),s=D("ul"),s.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li>Press <b>s</b>
    to switch between snapping points to existing roads and drawing anywhere</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,l=R(),P(a.$$.fragment),u=R(),P(c.$$.fragment)},m(g,y){L(e,g,y),v(g,r,y),p[t].m(g,y),v(g,i,y),v(g,s,y),v(g,l,y),L(a,g,y),v(g,u,y),L(c,g,y),f=!0},p(g,[y]){const S={};y&4&&(S.disabled=g[2]==0),y&516&&(S.$$scope={dirty:y,ctx:g}),e.$set(S);let _=t;t=h(g),t===_?p[t].p(g,y):(ne(),w(p[_],1,1,()=>{p[_]=null}),ie(),o=p[t],o?o.p(g,y):(o=p[t]=d[t](g),o.c()),b(o,1),o.m(i.parentNode,i));const m={};y&515&&(m.$$scope={dirty:y,ctx:g}),a.$set(m)},i(g){f||(b(e.$$.fragment,g),b(o),b(a.$$.fragment,g),b(c.$$.fragment,g),f=!0)},o(g){w(e.$$.fragment,g),w(o),w(a.$$.fragment,g),w(c.$$.fragment,g),f=!1},d(g){g&&($(r),$(i),$(s),$(l),$(u)),C(e,g),p[t].d(g),C(a,g),C(c,g)}}}function Xu(n,e,r){let t,o,i,s;q(n,et,d=>r(6,t=d)),q(n,mt,d=>r(1,o=d)),q(n,In,d=>r(2,i=d)),q(n,is,d=>r(3,s=d));let{extendRoute:l}=e;function a(){t.undo()}function u(){t.toggleSnapMode()}function c(d){l=d,r(0,l)}function f(d){n.$$.not_equal(o.avoidDoublingBack,d)&&(o.avoidDoublingBack=d,mt.set(o))}return n.$$set=d=>{"extendRoute"in d&&r(0,l=d.extendRoute)},n.$$.update=()=>{n.$$.dirty&67&&t.setRouteConfig({avoid_doubling_back:o.avoidDoublingBack,extend_route:l})},[l,o,i,s,a,u,t,c,f]}class os extends j{constructor(e){super(),Q(this,e,Xu,Ju,K,{extendRoute:0})}}function Vu(n){let e,r,t;return{c(){e=G("Undo ("),r=G(n[0]),t=G(")")},m(o,i){v(o,e,i),v(o,r,i),v(o,t,i)},p(o,i){i&1&&ge(r,o[0])},d(o){o&&($(e),$(r),$(t))}}}function Wu(n){let e;return{c(){e=G("Undo")},m(r,t){v(r,e,t)},p:W,d(r){r&&$(e)}}}function Hu(n){let e;function r(i,s){return i[0]==0?Wu:Vu}let t=r(n),o=t(n);return{c(){o.c(),e=ue()},m(i,s){o.m(i,s),v(i,e,s)},p(i,s){t===(t=r(i))&&o?o.p(i,s):(o.d(1),o=t(i),o&&(o.c(),o.m(e.parentNode,e)))},d(i){i&&$(e),o.d(i)}}}function Zu(n){let e,r,t,o;return e=new re({props:{disabled:n[0]==0,$$slots:{default:[Hu]},$$scope:{ctx:n}}}),e.$on("click",n[1]),{c(){P(e.$$.fragment),r=R(),t=D("ul"),t.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`},m(i,s){L(e,i,s),v(i,r,s),v(i,t,s),o=!0},p(i,[s]){const l={};s&1&&(l.disabled=i[0]==0),s&9&&(l.$$scope={dirty:s,ctx:i}),e.$set(l)},i(i){o||(b(e.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),o=!1},d(i){i&&($(r),$(t)),C(e,i)}}}function Ku(n,e,r){let t,o;q(n,et,s=>r(2,t=s)),q(n,In,s=>r(0,o=s));function i(){t.undo()}return[o,i]}class ss extends j{constructor(e){super(),Q(this,e,Ku,Zu,K,{})}}function ju(n){let e;return{c(){e=G("Finish")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Qu(n){let e;return{c(){e=G("Cancel")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function ef(n){let e,r,t,o;return e=new at({props:{$$slots:{default:[ju]},$$scope:{ctx:n}}}),e.$on("click",n[2]),t=new re({props:{$$slots:{default:[Qu]},$$scope:{ctx:n}}}),t.$on("click",n[3]),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&8192&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&8192&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function tf(n){let e,r;return e=new ss({}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function rf(n){let e,r;return e=new rs({}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function nf(n){let e,r;return e=new os({props:{extendRoute:!1}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function of(n){let e,r;return e=new ts({props:{editingExisting:!0}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function sf(n){let e,r,t,o,i,s,l,a,u,c;i=new He({props:{$$slots:{default:[ef]},$$scope:{ctx:n}}});const f=[of,nf,rf,tf],d=[];function p(h,g){return h[1]=="point"?0:h[1]=="route"?1:h[1]=="freehand-polygon"?2:h[1]=="snapped-polygon"?3:-1}return~(l=p(n))&&(a=d[l]=f[l](n)),{c(){e=D("h2"),r=G("Editing "),t=G(n[0]),o=R(),P(i.$$.fragment),s=R(),a&&a.c(),u=ue()},m(h,g){v(h,e,g),J(e,r),J(e,t),v(h,o,g),L(i,h,g),v(h,s,g),~l&&d[l].m(h,g),v(h,u,g),c=!0},p(h,[g]){(!c||g&1)&&ge(t,h[0]);const y={};g&8192&&(y.$$scope={dirty:g,ctx:h}),i.$set(y);let S=l;l=p(h),l!==S&&(a&&(ne(),w(d[S],1,1,()=>{d[S]=null}),ie()),~l?(a=d[l],a||(a=d[l]=f[l](h),a.c()),b(a,1),a.m(u.parentNode,u)):a=null)},i(h){c||(b(i.$$.fragment,h),b(a),c=!0)},o(h){w(i.$$.fragment,h),w(a),c=!1},d(h){h&&($(e),$(o),$(s),$(u)),C(i,h),~l&&d[l].d(h)}}}function lf(n,e,r){let t,o,i;q(n,Ft,y=>r(6,t=y)),q(n,et,y=>r(7,o=y)),q(n,Ht,y=>r(8,i=y));let{id:s}=e,l="",a="",u=null;We(()=>{let y=null;oe.update(_=>(y=_.features.find(m=>m.id==s),y.properties.hide_while_editing=!0,_));let S=y;r(0,l=fe.interventionName(S)),S.geometry.type=="LineString"?(o==null||o.editExistingRoute(S),o==null||o.addEventListenerSuccess(c),o==null||o.addEventListenerUpdated(f),o==null||o.addEventListenerFailure(d),r(1,a="route")):S.geometry.type=="Polygon"?S.properties.waypoints?(o==null||o.editExistingArea(S),o==null||o.addEventListenerSuccess(c),o==null||o.addEventListenerUpdated(f),o==null||o.addEventListenerFailure(d),r(1,a="snapped-polygon")):(t==null||t.editExisting(S),t==null||t.addEventListenerSuccess(c),t==null||t.addEventListenerUpdated(f),t==null||t.addEventListenerFailure(d),r(1,a="freehand-polygon")):S.geometry.type=="Point"&&(i==null||i.start(),i==null||i.addEventListenerSuccess(c),i==null||i.addEventListenerFailure(d),r(1,a="point"))}),Ae(()=>{i==null||i.stop(),i==null||i.clearEventListeners(),o==null||o.stop(),o==null||o.clearEventListeners(),t==null||t.stop(),t==null||t.clearEventListeners(),oe.update(y=>{let S=y.features.find(_=>_.id==s);return delete S.properties.hide_while_editing,u&&p(S,u),y})});function c(y){y.properties??(y.properties={}),u=y,Z.set({mode:"edit-form",id:s})}function f(y){u=y}function d(){u=null,Z.set({mode:"edit-form",id:s})}function p(y,S){y.geometry=S.geometry,S.properties.length_meters&&(y.properties.length_meters=S.properties.length_meters),S.properties.waypoints&&(y.properties.waypoints=S.properties.waypoints)}function h(){Z.set({mode:"edit-form",id:s})}function g(){u=null,Z.set({mode:"edit-form",id:s})}return n.$$set=y=>{"id"in y&&r(4,s=y.id)},[l,a,h,g,s]}class af extends j{constructor(e){super(),Q(this,e,lf,sf,K,{id:4})}}const $r=ve(null),br=ve(100);function Di(n){let e,r;return e=new _l({props:{url:n[2],coordinates:[[n[0].lng,n[0].lat],[n[3].lng,n[0].lat],[n[3].lng,n[3].lat],[n[0].lng,n[3].lat]],$$slots:{default:[uf]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&4&&(i.url=t[2]),o&9&&(i.coordinates=[[t[0].lng,t[0].lat],[t[3].lng,t[0].lat],[t[3].lng,t[3].lat],[t[0].lng,t[3].lat]]),o&272&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function uf(n){let e,r;const t=[be("georeferenced-image"),{paint:{"raster-fade-duration":0,"raster-opacity":n[4]/100}}];let o={};for(let i=0;i<t.length;i+=1)o=pe(o,t[i]);return e=new rl({props:o}),{c(){P(e.$$.fragment)},m(i,s){L(e,i,s),r=!0},p(i,s){const l=s&16?Ke(t,[t[0],{paint:{"raster-fade-duration":0,"raster-opacity":i[4]/100}}]):{};e.$set(l)},i(i){r||(b(e.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),r=!1},d(i){C(e,i)}}}function Gi(n){let e,r,t,o,i,s;function l(f){n[6](f)}let a={draggable:!0,$$slots:{default:[ff]},$$scope:{ctx:n}};n[0]!==void 0&&(a.lngLat=n[0]),e=new Kr({props:a}),ce.push(()=>de(e,"lngLat",l));function u(f){n[7](f)}let c={draggable:!0,$$slots:{default:[cf]},$$scope:{ctx:n}};return n[3]!==void 0&&(c.lngLat=n[3]),o=new Kr({props:c}),ce.push(()=>de(o,"lngLat",u)),{c(){P(e.$$.fragment),t=R(),P(o.$$.fragment)},m(f,d){L(e,f,d),v(f,t,d),L(o,f,d),s=!0},p(f,d){const p={};d&256&&(p.$$scope={dirty:d,ctx:f}),!r&&d&1&&(r=!0,p.lngLat=f[0],_e(()=>r=!1)),e.$set(p);const h={};d&256&&(h.$$scope={dirty:d,ctx:f}),!i&&d&8&&(i=!0,h.lngLat=f[3],_e(()=>i=!1)),o.$set(h)},i(f){s||(b(e.$$.fragment,f),b(o.$$.fragment,f),s=!0)},o(f){w(e.$$.fragment,f),w(o.$$.fragment,f),s=!1},d(f){f&&$(t),C(e,f),C(o,f)}}}function ff(n){let e;return{c(){e=D("span"),x(e,"class","dot svelte-1tmbx1c"),ye(e,"background-color","red")},m(r,t){v(r,e,t)},p:W,d(r){r&&$(e)}}}function cf(n){let e;return{c(){e=D("span"),x(e,"class","dot svelte-1tmbx1c"),ye(e,"background-color","blue")},m(r,t){v(r,e,t)},p:W,d(r){r&&$(e)}}}function pf(n){let e,r,t,o=n[2]&&Di(n),i=n[2]&&n[1].mode=="set-image"&&Gi(n);return{c(){o&&o.c(),e=R(),i&&i.c(),r=ue()},m(s,l){o&&o.m(s,l),v(s,e,l),i&&i.m(s,l),v(s,r,l),t=!0},p(s,[l]){s[2]?o?(o.p(s,l),l&4&&b(o,1)):(o=Di(s),o.c(),b(o,1),o.m(e.parentNode,e)):o&&(ne(),w(o,1,1,()=>{o=null}),ie()),s[2]&&s[1].mode=="set-image"?i?(i.p(s,l),l&6&&b(i,1)):(i=Gi(s),i.c(),b(i,1),i.m(r.parentNode,r)):i&&(ne(),w(i,1,1,()=>{i=null}),ie())},i(s){t||(b(o),b(i),t=!0)},o(s){w(o),w(i),t=!1},d(s){s&&($(e),$(r)),o&&o.d(s),i&&i.d(s)}}}function df(n,e,r){let t,o,i,s;q(n,Ue,f=>r(5,t=f)),q(n,Z,f=>r(1,o=f)),q(n,$r,f=>r(2,i=f)),q(n,br,f=>r(4,s=f));let l={lng:0,lat:0},a={lng:0,lat:0};function u(f){l=f,r(0,l),r(5,t),r(2,i),r(1,o)}function c(f){a=f,r(3,a),r(5,t),r(2,i),r(1,o),r(0,l)}return n.$$.update=()=>{if(n.$$.dirty&39&&t&&i&&o.mode=="set-image"&&l.lng==0&&l.lat==0){let f=t.getBounds();r(0,l.lng=f.getWest()+.4*(f.getEast()-f.getWest()),l),r(3,a.lng=f.getWest()+.6*(f.getEast()-f.getWest()),a),r(0,l.lat=f.getNorth()+.4*(f.getSouth()-f.getNorth()),l),r(3,a.lat=f.getNorth()+.6*(f.getSouth()-f.getNorth()),a)}},[l,o,i,a,s,t,u,c]}class hf extends j{constructor(e){super(),Q(this,e,df,pf,K,{})}}function mf(n){let e,r,t,o,i,s;const l=[be("hover-polygons"),{filter:dt},{paint:{"line-color":zt.hovering,"line-width":.5*pt}}];let a={};for(let p=0;p<l.length;p+=1)a=pe(a,l[p]);e=new Pt({props:a});const u=[be("hover-lines"),{filter:Zt},{paint:{"line-color":zt.hovering,"line-width":1.5*pt}}];let c={};for(let p=0;p<u.length;p+=1)c=pe(c,u[p]);t=new Pt({props:c});const f=[be("hover-points"),{filter:Kt},{paint:{"circle-color":zt.hovering,"circle-radius":1.5*Nr}}];let d={};for(let p=0;p<f.length;p+=1)d=pe(d,f[p]);return i=new Lt({props:d}),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment),o=R(),P(i.$$.fragment)},m(p,h){L(e,p,h),v(p,r,h),L(t,p,h),v(p,o,h),L(i,p,h),s=!0},p(p,h){const g={};e.$set(g);const y={};t.$set(y);const S={};i.$set(S)},i(p){s||(b(e.$$.fragment,p),b(t.$$.fragment,p),b(i.$$.fragment,p),s=!0)},o(p){w(e.$$.fragment,p),w(t.$$.fragment,p),w(i.$$.fragment,p),s=!1},d(p){p&&($(r),$(o)),C(e,p),C(t,p),C(i,p)}}}function gf(n){let e,r;return e=new ht({props:{data:n[0],$$slots:{default:[mf]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,[o]){const i={};o&1&&(i.data=t[0]),o&8&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function _f(n,e,r){let t,o,i;return q(n,Et,s=>r(1,o=s)),q(n,oe,s=>r(2,i=s)),n.$$.update=()=>{n.$$.dirty&6&&r(0,t=o==null?Rt():i.features.find(s=>s.id==o))},[t,o,i]}class yf extends j{constructor(e){super(),Q(this,e,_f,gf,K,{})}}function Ti(n){let e,r;return e=new En({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[vf,({features:t})=>({14:t}),({features:t})=>t?16384:0]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&49152&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function vf(n){let e,r,t=n[7](n[14])+"",o;return{c(){e=D("div"),r=D("p"),o=G(t),x(e,"class","govuk-prose")},m(i,s){v(i,e,s),J(e,r),J(r,o)},p(i,s){s&16384&&t!==(t=i[7](i[14])+"")&&ge(o,t)},d(i){i&&$(e)}}}function $f(n){let e,r,t=n[2]&&Ti(n);return{c(){t&&t.c(),e=ue()},m(o,i){t&&t.m(o,i),v(o,e,i),r=!0},p(o,i){o[2]?t?(t.p(o,i),i&4&&b(t,1)):(t=Ti(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(ne(),w(t,1,1,()=>{t=null}),ie())},i(o){r||(b(t),r=!0)},o(o){w(t),r=!1},d(o){o&&$(e),t&&t.d(o)}}}function Ui(n){let e,r;return e=new En({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[bf,({features:t})=>({14:t}),({features:t})=>t?16384:0]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&49152&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function bf(n){let e,r,t=n[7](n[14])+"",o;return{c(){e=D("div"),r=D("p"),o=G(t),x(e,"class","govuk-prose")},m(i,s){v(i,e,s),J(e,r),J(r,o)},p(i,s){s&16384&&t!==(t=i[7](i[14])+"")&&ge(o,t)},d(i){i&&$(e)}}}function wf(n){let e,r,t=n[2]&&Ui(n);return{c(){t&&t.c(),e=ue()},m(o,i){t&&t.m(o,i),v(o,e,i),r=!0},p(o,i){o[2]?t?(t.p(o,i),i&4&&b(t,1)):(t=Ui(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(ne(),w(t,1,1,()=>{t=null}),ie())},i(o){r||(b(t),r=!0)},o(o){w(t),r=!1},d(o){o&&$(e),t&&t.d(o)}}}function xi(n){let e,r;return e=new En({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[kf,({features:t})=>({14:t}),({features:t})=>t?16384:0]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&49152&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function kf(n){let e,r,t=n[7](n[14])+"",o;return{c(){e=D("div"),r=D("p"),o=G(t),x(e,"class","govuk-prose")},m(i,s){v(i,e,s),J(e,r),J(r,o)},p(i,s){s&16384&&t!==(t=i[7](i[14])+"")&&ge(o,t)},d(i){i&&$(e)}}}function Sf(n){let e,r,t=n[2]&&xi(n);return{c(){t&&t.c(),e=ue()},m(o,i){t&&t.m(o,i),v(o,e,i),r=!0},p(o,i){o[2]?t?(t.p(o,i),i&4&&b(t,1)):(t=xi(o),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(ne(),w(t,1,1,()=>{t=null}),ie())},i(o){r||(b(t),r=!0)},o(o){w(t),r=!1},d(o){o&&$(e),t&&t.d(o)}}}function Ef(n){let e,r,t,o,i,s,l,a,u,c;const f=[be("interventions-points"),{filter:["all",Kt,n[4],n[5],n[1]]},{paint:{"circle-color":n[0],"circle-radius":Nr}},{hoverCursor:n[2]?"pointer":void 0},{manageHoverState:n[2]}];let d={$$slots:{default:[$f]},$$scope:{ctx:n}};for(let E=0;E<f.length;E+=1)d=pe(d,f[E]);e=new Lt({props:d}),e.$on("click",n[6]);const p=[be("interventions-lines"),{filter:["all",Zt,n[4],n[1]]},{paint:{"line-color":n[0],"line-width":pt}},{hoverCursor:n[2]?"pointer":void 0},{manageHoverState:n[2]}];let h={$$slots:{default:[wf]},$$scope:{ctx:n}};for(let E=0;E<p.length;E+=1)h=pe(h,p[E]);t=new Pt({props:h}),t.$on("click",n[6]);const g=[be("interventions-lines-endpoints"),{filter:["all",["==",["get","endpoint"],!0],n[1]]},{paint:{"circle-radius":.5*pt,"circle-opacity":0,"circle-stroke-color":zt.lineEndpointColor,"circle-stroke-width":2}}];let y={};for(let E=0;E<g.length;E+=1)y=pe(y,g[E]);i=new Lt({props:y});const S=[be("interventions-polygons"),{filter:["all",dt,n[4],n[1]]},{paint:{"fill-color":n[0],"fill-opacity":.2}},{hoverCursor:n[2]?"pointer":void 0},{manageHoverState:n[2]}];let _={$$slots:{default:[Sf]},$$scope:{ctx:n}};for(let E=0;E<S.length;E+=1)_=pe(_,S[E]);l=new rr({props:_}),l.$on("click",n[6]);const m=[be("interventions-polygons-outlines"),{filter:["all",dt,n[4],n[1]]},{paint:{"line-color":n[0],"line-opacity":.5,"line-width":.7*pt}}];let M={};for(let E=0;E<m.length;E+=1)M=pe(M,m[E]);return u=new Pt({props:M}),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment),o=R(),P(i.$$.fragment),s=R(),P(l.$$.fragment),a=R(),P(u.$$.fragment)},m(E,k){L(e,E,k),v(E,r,k),L(t,E,k),v(E,o,k),L(i,E,k),v(E,s,k),L(l,E,k),v(E,a,k),L(u,E,k),c=!0},p(E,k){const A=k&55?Ke(f,[f[0],k&50&&{filter:["all",Kt,E[4],E[5],E[1]]},k&1&&{paint:{"circle-color":E[0],"circle-radius":Nr}},k&4&&{hoverCursor:E[2]?"pointer":void 0},k&4&&{manageHoverState:E[2]}]):{};k&32772&&(A.$$scope={dirty:k,ctx:E}),e.$set(A);const B=k&23?Ke(p,[p[0],k&18&&{filter:["all",Zt,E[4],E[1]]},k&1&&{paint:{"line-color":E[0],"line-width":pt}},k&4&&{hoverCursor:E[2]?"pointer":void 0},k&4&&{manageHoverState:E[2]}]):{};k&32772&&(B.$$scope={dirty:k,ctx:E}),t.$set(B);const T=k&2?Ke(g,[g[0],{filter:["all",["==",["get","endpoint"],!0],E[1]]},g[2]]):{};i.$set(T);const z=k&23?Ke(S,[S[0],k&18&&{filter:["all",dt,E[4],E[1]]},k&1&&{paint:{"fill-color":E[0],"fill-opacity":.2}},k&4&&{hoverCursor:E[2]?"pointer":void 0},k&4&&{manageHoverState:E[2]}]):{};k&32772&&(z.$$scope={dirty:k,ctx:E}),l.$set(z);const N=k&19?Ke(m,[m[0],k&18&&{filter:["all",dt,E[4],E[1]]},k&1&&{paint:{"line-color":E[0],"line-opacity":.5,"line-width":.7*pt}}]):{};u.$set(N)},i(E){c||(b(e.$$.fragment,E),b(t.$$.fragment,E),b(i.$$.fragment,E),b(l.$$.fragment,E),b(u.$$.fragment,E),c=!0)},o(E){w(e.$$.fragment,E),w(t.$$.fragment,E),w(i.$$.fragment,E),w(l.$$.fragment,E),w(u.$$.fragment,E),c=!1},d(E){E&&($(r),$(o),$(s),$(a)),C(e,E),C(t,E),C(i,E),C(l,E),C(u,E)}}}function Mf(n){let e,r;return e=new ht({props:{data:n[3],$$slots:{default:[Ef]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,[o]){const i={};o&8&&(i.data=t[3]),o&32775&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Pf(n){let e=["all"];for(let r of n.keys())e.push(["!=",["get","scheme_reference"],r]);return e}function Lf(n,e,r){let t,o,i,s,l,a,u,c;q(n,oe,S=>r(9,l=S)),q(n,Ue,S=>r(12,a=S)),q(n,Z,S=>r(10,u=S)),q(n,Vt,S=>r(11,c=S));const f=["!=",["get","hide_while_editing"],!0],d=["!=",["get","endpoint"],!0];let p;function h(S){return xt(["get","scheme_reference"],Object.fromEntries(Object.values(S.schemes).map(_=>[_.scheme_reference,_.color])),"black")}function g(S){u.mode!="list"||!a||S.detail.features[0]&&(a.getCanvas().style.cursor="inherit",Z.set({mode:"edit-form",id:S.detail.features[0].id}))}function y(S){if(S){let _=S[0],m=fe.interventionName(_),M=fe.schemeName(l.schemes[_.properties.scheme_reference]);return`${m} (${M})`}return"Tooltip bug"}return n.$$.update=()=>{if(n.$$.dirty&512&&r(3,t=yu(l)),n.$$.dirty&1024&&r(2,o=u.mode=="list"),n.$$.dirty&2048&&r(1,i=Pf(c)),n.$$.dirty&512&&r(8,s=h(l)),n.$$.dirty&1280){let S="grey";u.mode=="edit-form"?r(0,p=["case",["==",["id"],u.id],s,S]):u.mode=="list"?r(0,p=s):u.mode=="split-route"?r(0,p=["case",["==","intervention_type","route"],s,S]):r(0,p=S)}},[p,i,o,t,f,d,g,y,s,l,u,c]}class Cf extends j{constructor(e){super(),Q(this,e,Lf,Mf,K,{})}}function Ff(n){let e,r,t,o,i,s;const l=[be("edit-polygon-fill"),{filter:dt},{paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}];let a={};for(let p=0;p<l.length;p+=1)a=pe(a,l[p]);e=new rr({props:a});const u=[be("edit-polygon-lines"),{filter:Zt},{paint:{"line-color":"black","line-width":8,"line-opacity":.5}}];let c={};for(let p=0;p<u.length;p+=1)c=pe(c,u[p]);t=new Pt({props:c});const f=[be("edit-polygon-vertices"),{filter:Kt},{paint:{"circle-color":zt.hovering,"circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":Nr}}];let d={};for(let p=0;p<f.length;p+=1)d=pe(d,f[p]);return i=new Lt({props:d}),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment),o=R(),P(i.$$.fragment)},m(p,h){L(e,p,h),v(p,r,h),L(t,p,h),v(p,o,h),L(i,p,h),s=!0},p(p,h){const g={};e.$set(g);const y={};t.$set(y);const S={};i.$set(S)},i(p){s||(b(e.$$.fragment,p),b(t.$$.fragment,p),b(i.$$.fragment,p),s=!0)},o(p){w(e.$$.fragment,p),w(t.$$.fragment,p),w(i.$$.fragment,p),s=!1},d(p){p&&($(r),$(o)),C(e,p),C(t,p),C(i,p)}}}function Rf(n){let e,r;return e=new ht({props:{data:n[0],$$slots:{default:[Ff]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,[o]){const i={};o&1&&(i.data=t[0]),o&2&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Af(n,e,r){let t;return q(n,Wo,o=>r(0,t=o)),[t]}class Nf extends j{constructor(e){super(),Q(this,e,Af,Rf,K,{})}}function Of(n){let e,r,t,o,i,s;const l=[be("route-points"),{filter:Kt},{paint:{"circle-color":xt(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":xt(["get","type"],{node:cr/2},cr)}}];let a={};for(let p=0;p<l.length;p+=1)a=pe(a,l[p]);e=new Lt({props:a});const u=[be("route-lines"),{filter:Zt},{paint:{"line-color":["case",["get","snapped"],"red","blue"],"line-width":2.5}}];let c={};for(let p=0;p<u.length;p+=1)c=pe(c,u[p]);t=new Pt({props:c});const f=[be("route-polygons"),{filter:dt},{paint:{"fill-color":"black","fill-opacity":.5}}];let d={};for(let p=0;p<f.length;p+=1)d=pe(d,f[p]);return i=new rr({props:d}),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment),o=R(),P(i.$$.fragment)},m(p,h){L(e,p,h),v(p,r,h),L(t,p,h),v(p,o,h),L(i,p,h),s=!0},p(p,h){const g=h&0?Ke(l,[l[0],l[1],{paint:{"circle-color":xt(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":xt(["get","type"],{node:cr/2},cr)}}]):{};e.$set(g);const y={};t.$set(y);const S={};i.$set(S)},i(p){s||(b(e.$$.fragment,p),b(t.$$.fragment,p),b(i.$$.fragment,p),s=!0)},o(p){w(e.$$.fragment,p),w(t.$$.fragment,p),w(i.$$.fragment,p),s=!1},d(p){p&&($(r),$(o)),C(e,p),C(t,p),C(i,p)}}}function If(n){let e,r=qi(n[2])+"",t;return{c(){e=D("div"),t=G(r),ye(e,"font-size","30px"),ye(e,"background","white"),ye(e,"padding","16px"),ye(e,"border-radius","50%")},m(o,i){v(o,e,i),J(e,t)},p(o,i){i&4&&r!==(r=qi(o[2])+"")&&ge(t,r)},d(o){o&&$(e)}}}function Bf(n){let e,r;return e=new Nl({props:{$$slots:{default:[If,({feature:t})=>({2:t}),({feature:t})=>t?4:0]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&12&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Df(n){let e,r,t,o;return e=new ht({props:{data:n[0],$$slots:{default:[Of]},$$scope:{ctx:n}}}),t=new ht({props:{data:n[1],$$slots:{default:[Bf]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,[s]){const l={};s&1&&(l.data=i[0]),s&8&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&2&&(a.data=i[1]),s&8&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}const cr=10;function qi(n){var e;return(e=n.properties)==null?void 0:e.number}function Gf(n,e,r){let t,o;return q(n,ns,i=>r(0,t=i)),q(n,vr,i=>r(1,o=i)),[t,o]}class Tf extends j{constructor(e){super(),Q(this,e,Gf,Df,K,{})}}var Uf=Object.defineProperty,ut=(n,e)=>Uf(n,"name",{value:e,configurable:!0});function At(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ut(At,"getCoord");function ls(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ut(ls,"getCoords");function as(n){if(n.length>1&&xn(n[0])&&xn(n[1]))return!0;if(Array.isArray(n[0])&&n[0].length)return as(n[0]);throw new Error("coordinates must only contain numbers")}ut(as,"containsNumber");function xf(n,e,r){if(!e||!r)throw new Error("type and name required");if(!n||n.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.type)}ut(xf,"geojsonType");function qf(n,e,r){if(!n)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}ut(qf,"featureOf");function zf(n,e,r){if(!n)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!n||n.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const t of n.features){if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}}ut(zf,"collectionOf");function Yf(n){return n.type==="Feature"?n.geometry:n}ut(Yf,"getGeom");function Jf(n,e){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}ut(Jf,"getType");var Xf=Object.defineProperty,us=(n,e)=>Xf(n,"name",{value:e,configurable:!0});function Bn(n,e,r={}){if(r.final===!0)return fs(n,e);const t=At(n),o=At(e),i=Be(t[0]),s=Be(o[0]),l=Be(t[1]),a=Be(o[1]),u=Math.sin(s-i)*Math.cos(a),c=Math.cos(l)*Math.sin(a)-Math.sin(l)*Math.cos(a)*Math.cos(s-i);return Zr(Math.atan2(u,c))}us(Bn,"bearing");function fs(n,e){let r=Bn(e,n);return r=(r+180)%360,r}us(fs,"calculateFinalBearing");var Vf=Object.defineProperty,Wf=(n,e)=>Vf(n,"name",{value:e,configurable:!0});function kt(n,e,r={}){var t=At(n),o=At(e),i=Be(o[1]-t[1]),s=Be(o[0]-t[0]),l=Be(t[1]),a=Be(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(a);return zs(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),r.units)}Wf(kt,"distance");var Hf=Object.defineProperty,Zf=(n,e)=>Hf(n,"name",{value:e,configurable:!0});function vn(n,e,r,t={}){const o=At(n),i=Be(o[0]),s=Be(o[1]),l=Be(r),a=Ys(e,t.units),u=Math.asin(Math.sin(s)*Math.cos(a)+Math.cos(s)*Math.sin(a)*Math.cos(l)),c=i+Math.atan2(Math.sin(l)*Math.sin(a)*Math.cos(s),Math.cos(a)-Math.sin(s)*Math.sin(u)),f=Zr(c),d=Zr(u);return Ie([f,d],t.properties)}Zf(vn,"destination");class cs{constructor(e=[],r=Kf){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:t}=this,o=r[e];for(;e>0;){const i=e-1>>1,s=r[i];if(t(o,s)>=0)break;r[e]=s,e=i}r[e]=o}_down(e){const{data:r,compare:t}=this,o=this.length>>1,i=r[e];for(;e<o;){let s=(e<<1)+1,l=r[s];const a=s+1;if(a<this.length&&t(r[a],l)<0&&(s=a,l=r[a]),t(l,i)>=0)break;r[e]=l,e=s}r[e]=i}}function Kf(n,e){return n<e?-1:n>e?1:0}function ps(n,e){return n.p.x>e.p.x?1:n.p.x<e.p.x?-1:n.p.y!==e.p.y?n.p.y>e.p.y?1:-1:1}function jf(n,e){return n.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:n.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:n.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?n.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class zi{constructor(e,r,t,o){this.p={x:e[0],y:e[1]},this.featureId=r,this.ringId=t,this.eventId=o,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}function Qf(n,e){if(n.type==="FeatureCollection"){const r=n.features;for(let t=0;t<r.length;t++)Yi(r[t],e)}else Yi(n,e)}let pr=0,dr=0,hr=0;function Yi(n,e){const r=n.type==="Feature"?n.geometry:n;let t=r.coordinates;(r.type==="Polygon"||r.type==="MultiLineString")&&(t=[t]),r.type==="LineString"&&(t=[[t]]);for(let o=0;o<t.length;o++)for(let i=0;i<t[o].length;i++){let s=t[o][i][0],l=null;dr=dr+1;for(let a=0;a<t[o][i].length-1;a++){l=t[o][i][a+1];const u=new zi(s,pr,dr,hr),c=new zi(l,pr,dr,hr+1);u.otherEvent=c,c.otherEvent=u,ps(u,c)>0?(c.isLeftEndpoint=!0,u.isLeftEndpoint=!1):(u.isLeftEndpoint=!0,c.isLeftEndpoint=!1),e.push(u),e.push(c),s=l,hr=hr+1}}pr=pr+1}class ec{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function tc(n,e){if(n===null||e===null||n.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(n.rightSweepEvent.isSamePoint(e.leftSweepEvent)||n.rightSweepEvent.isSamePoint(e.leftSweepEvent)||n.rightSweepEvent.isSamePoint(e.rightSweepEvent)||n.leftSweepEvent.isSamePoint(e.leftSweepEvent)||n.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const r=n.leftSweepEvent.p.x,t=n.leftSweepEvent.p.y,o=n.rightSweepEvent.p.x,i=n.rightSweepEvent.p.y,s=e.leftSweepEvent.p.x,l=e.leftSweepEvent.p.y,a=e.rightSweepEvent.p.x,u=e.rightSweepEvent.p.y,c=(u-l)*(o-r)-(a-s)*(i-t),f=(a-s)*(t-l)-(u-l)*(r-s),d=(o-r)*(t-l)-(i-t)*(r-s);if(c===0)return!1;const p=f/c,h=d/c;if(p>=0&&p<=1&&h>=0&&h<=1){const g=r+p*(o-r),y=t+p*(i-t);return[g,y]}return!1}function rc(n,e){e=e||!1;const r=[],t=new cs([],jf);for(;n.length;){const o=n.pop();if(o.isLeftEndpoint){const i=new ec(o);for(let s=0;s<t.data.length;s++){const l=t.data[s];if(e&&l.leftSweepEvent.featureId===o.featureId)continue;const a=tc(i,l);a!==!1&&r.push(a)}t.push(i)}else o.isLeftEndpoint===!1&&t.pop()}return r}function nc(n,e){const r=new cs([],ps);return Qf(n,r),rc(r,e)}var ic=Object.defineProperty,oc=(n,e)=>ic(n,"name",{value:e,configurable:!0}),sc=nc;function ds(n,e,r={}){const{removeDuplicates:t=!0,ignoreSelfIntersections:o=!1}=r;let i=[];n.type==="FeatureCollection"?i=i.concat(n.features):n.type==="Feature"?i.push(n):(n.type==="LineString"||n.type==="Polygon"||n.type==="MultiLineString"||n.type==="MultiPolygon")&&i.push(wr(n)),e.type==="FeatureCollection"?i=i.concat(e.features):e.type==="Feature"?i.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&i.push(wr(e));const s=sc(qn(i),o);let l=[];if(t){const a={};s.forEach(u=>{const c=u.join(",");a[c]||(a[c]=!0,l.push(u))})}else l=s;return qn(l.map(a=>Ie(a)))}oc(ds,"lineIntersect");var lc=Object.defineProperty,we=(n,e)=>lc(n,"name",{value:e,configurable:!0});function ir(n,e,r){if(n!==null)for(var t,o,i,s,l,a,u,c=0,f=0,d,p=n.type,h=p==="FeatureCollection",g=p==="Feature",y=h?n.features.length:1,S=0;S<y;S++){u=h?n.features[S].geometry:g?n.geometry:n,d=u?u.type==="GeometryCollection":!1,l=d?u.geometries.length:1;for(var _=0;_<l;_++){var m=0,M=0;if(s=d?u.geometries[_]:u,s!==null){a=s.coordinates;var E=s.type;switch(c=r&&(E==="Polygon"||E==="MultiPolygon")?1:0,E){case null:break;case"Point":if(e(a,f,S,m,M)===!1)return!1;f++,m++;break;case"LineString":case"MultiPoint":for(t=0;t<a.length;t++){if(e(a[t],f,S,m,M)===!1)return!1;f++,E==="MultiPoint"&&m++}E==="LineString"&&m++;break;case"Polygon":case"MultiLineString":for(t=0;t<a.length;t++){for(o=0;o<a[t].length-c;o++){if(e(a[t][o],f,S,m,M)===!1)return!1;f++}E==="MultiLineString"&&m++,E==="Polygon"&&M++}E==="Polygon"&&m++;break;case"MultiPolygon":for(t=0;t<a.length;t++){for(M=0,o=0;o<a[t].length;o++){for(i=0;i<a[t][o].length-c;i++){if(e(a[t][o][i],f,S,m,M)===!1)return!1;f++}M++}m++}break;case"GeometryCollection":for(t=0;t<s.geometries.length;t++)if(ir(s.geometries[t],e,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}we(ir,"coordEach");function ac(n,e,r,t){var o=r;return ir(n,function(i,s,l,a,u){s===0&&r===void 0?o=i:o=e(o,i,s,l,a,u)},t),o}we(ac,"coordReduce");function hs(n,e){var r;switch(n.type){case"FeatureCollection":for(r=0;r<n.features.length&&e(n.features[r].properties,r)!==!1;r++);break;case"Feature":e(n.properties,0);break}}we(hs,"propEach");function uc(n,e,r){var t=r;return hs(n,function(o,i){i===0&&r===void 0?t=o:t=e(t,o,i)}),t}we(uc,"propReduce");function ms(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var r=0;r<n.features.length&&e(n.features[r],r)!==!1;r++);}we(ms,"featureEach");function fc(n,e,r){var t=r;return ms(n,function(o,i){i===0&&r===void 0?t=o:t=e(t,o,i)}),t}we(fc,"featureReduce");function cc(n){var e=[];return ir(n,function(r){e.push(r)}),e}we(cc,"coordAll");function Dn(n,e){var r,t,o,i,s,l,a,u,c,f,d=0,p=n.type==="FeatureCollection",h=n.type==="Feature",g=p?n.features.length:1;for(r=0;r<g;r++){for(l=p?n.features[r].geometry:h?n.geometry:n,u=p?n.features[r].properties:h?n.properties:{},c=p?n.features[r].bbox:h?n.bbox:void 0,f=p?n.features[r].id:h?n.id:void 0,a=l?l.type==="GeometryCollection":!1,s=a?l.geometries.length:1,o=0;o<s;o++){if(i=a?l.geometries[o]:l,i===null){if(e(null,d,u,c,f)===!1)return!1;continue}switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(i,d,u,c,f)===!1)return!1;break}case"GeometryCollection":{for(t=0;t<i.geometries.length;t++)if(e(i.geometries[t],d,u,c,f)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}d++}}we(Dn,"geomEach");function pc(n,e,r){var t=r;return Dn(n,function(o,i,s,l,a){i===0&&r===void 0?t=o:t=e(t,o,i,s,l,a)}),t}we(pc,"geomReduce");function or(n,e){Dn(n,function(r,t,o,i,s){var l=r===null?null:r.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return e(wr(r,o,{bbox:i,id:s}),t,0)===!1?!1:void 0}var a;switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<r.coordinates.length;u++){var c=r.coordinates[u],f={type:a,coordinates:c};if(e(wr(f,o),t,u)===!1)return!1}})}we(or,"flattenEach");function dc(n,e,r){var t=r;return or(n,function(o,i,s){i===0&&s===0&&r===void 0?t=o:t=e(t,o,i,s)}),t}we(dc,"flattenReduce");function gs(n,e){or(n,function(r,t,o){var i=0;if(r.geometry){var s=r.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,a=0,u=0,c=0;if(ir(r,function(f,d,p,h,g){if(l===void 0||t>a||h>u||g>c){l=f,a=t,u=h,c=g,i=0;return}var y=nt([l,f],r.properties);if(e(y,t,o,g,i)===!1)return!1;i++,l=f})===!1)return!1}}})}we(gs,"segmentEach");function hc(n,e,r){var t=r,o=!1;return gs(n,function(i,s,l,a,u){o===!1&&r===void 0?t=i:t=e(t,i,s,l,a,u),o=!0}),t}we(hc,"segmentReduce");function _s(n,e){if(!n)throw new Error("geojson is required");or(n,function(r,t,o){if(r.geometry!==null){var i=r.geometry.type,s=r.geometry.coordinates;switch(i){case"LineString":if(e(r,t,o,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(e(nt(s[l],r.properties),t,o,l)===!1)return!1;break}}})}we(_s,"lineEach");function mc(n,e,r){var t=r;return _s(n,function(o,i,s,l){i===0&&r===void 0?t=o:t=e(t,o,i,s,l)}),t}we(mc,"lineReduce");function gc(n,e){if(e=e||{},!_o(e))throw new Error("options is invalid");var r=e.featureIndex||0,t=e.multiFeatureIndex||0,o=e.geometryIndex||0,i=e.segmentIndex||0,s=e.properties,l;switch(n.type){case"FeatureCollection":r<0&&(r=n.features.length+r),s=s||n.features[r].properties,l=n.features[r].geometry;break;case"Feature":s=s||n.properties,l=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=n;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var a=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return i<0&&(i=a.length+i-1),nt([a[i],a[i+1]],s,e);case"Polygon":return o<0&&(o=a.length+o),i<0&&(i=a[o].length+i-1),nt([a[o][i],a[o][i+1]],s,e);case"MultiLineString":return t<0&&(t=a.length+t),i<0&&(i=a[t].length+i-1),nt([a[t][i],a[t][i+1]],s,e);case"MultiPolygon":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),i<0&&(i=a[t][o].length-i-1),nt([a[t][o][i],a[t][o][i+1]],s,e)}throw new Error("geojson is invalid")}we(gc,"findSegment");function _c(n,e){if(e=e||{},!_o(e))throw new Error("options is invalid");var r=e.featureIndex||0,t=e.multiFeatureIndex||0,o=e.geometryIndex||0,i=e.coordIndex||0,s=e.properties,l;switch(n.type){case"FeatureCollection":r<0&&(r=n.features.length+r),s=s||n.features[r].properties,l=n.features[r].geometry;break;case"Feature":s=s||n.properties,l=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=n;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var a=l.coordinates;switch(l.type){case"Point":return Ie(a,s,e);case"MultiPoint":return t<0&&(t=a.length+t),Ie(a[t],s,e);case"LineString":return i<0&&(i=a.length+i),Ie(a[i],s,e);case"Polygon":return o<0&&(o=a.length+o),i<0&&(i=a[o].length+i),Ie(a[o][i],s,e);case"MultiLineString":return t<0&&(t=a.length+t),i<0&&(i=a[t].length+i),Ie(a[t][i],s,e);case"MultiPolygon":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),i<0&&(i=a[t][o].length-i),Ie(a[t][o][i],s,e)}throw new Error("geojson is invalid")}we(_c,"findPoint");var ys=Object.defineProperty,yc=Object.defineProperties,vc=Object.getOwnPropertyDescriptors,Ji=Object.getOwnPropertySymbols,$c=Object.prototype.hasOwnProperty,bc=Object.prototype.propertyIsEnumerable,Xi=(n,e,r)=>e in n?ys(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,ft=(n,e)=>{for(var r in e||(e={}))$c.call(e,r)&&Xi(n,r,e[r]);if(Ji)for(var r of Ji(e))bc.call(e,r)&&Xi(n,r,e[r]);return n},ct=(n,e)=>yc(n,vc(e)),wc=(n,e)=>ys(n,"name",{value:e,configurable:!0});function vs(n,e,r={}){if(!n||!e)throw new Error("lines and pt are required arguments");let t=Ie([1/0,1/0],{dist:1/0,index:-1,location:-1}),o=0;return or(n,function(i){const s=ls(i);for(let l=0;l<s.length-1;l++){const a=Ie(s[l]);a.properties.dist=kt(e,a,r);const u=Ie(s[l+1]);u.properties.dist=kt(e,u,r);const c=kt(a,u,r),f=Math.max(a.properties.dist,u.properties.dist),d=Bn(a,u),p=vn(e,f,d+90,r),h=vn(e,f,d-90,r),g=ds(nt([p.geometry.coordinates,h.geometry.coordinates]),nt([a.geometry.coordinates,u.geometry.coordinates]));let y;g.features.length>0&&g.features[0]&&(y=ct(ft({},g.features[0]),{properties:{dist:kt(e,g.features[0],r),location:o+kt(a,g.features[0],r)}})),a.properties.dist<t.properties.dist&&(t=ct(ft({},a),{properties:ct(ft({},a.properties),{index:l,location:o})})),u.properties.dist<t.properties.dist&&(t=ct(ft({},u),{properties:ct(ft({},u.properties),{index:l+1,location:o+c})})),y&&y.properties.dist<t.properties.dist&&(t=ct(ft({},y),{properties:ct(ft({},y.properties),{index:l})})),o+=c}}),t}wc(vs,"nearestPointOnLine");var kc=vs;const $s="/atip/ss_huge_refactor_pt1/assets/split_route-9e0ea2da.svg";function Sc(n){let e,r;const t=[be("draw-split-route"),{paint:{"circle-color":"black","circle-radius":Vi}}];let o={};for(let i=0;i<t.length;i+=1)o=pe(o,t[i]);return e=new Lt({props:o}),{c(){P(e.$$.fragment)},m(i,s){L(e,i,s),r=!0},p(i,s){const l=s&0?Ke(t,[t[0],{paint:{"circle-color":"black","circle-radius":Vi}}]):{};e.$set(l)},i(i){r||(b(e.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),r=!1},d(i){C(e,i)}}}function Ec(n){let e,r,t,o,i,s;return e=new nl({}),e.$on("mousemove",n[1]),e.$on("click",n[2]),t=new ht({props:{data:n[0],$$slots:{default:[Sc]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(l,a){L(e,l,a),v(l,r,a),L(t,l,a),o=!0,i||(s=ke(window,"keydown",n[3]),i=!0)},p(l,[a]){const u={};a&1&&(u.data=l[0]),a&512&&(u.$$scope={dirty:a,ctx:l}),t.$set(u)},i(l){o||(b(e.$$.fragment,l),b(t.$$.fragment,l),o=!0)},o(l){w(e.$$.fragment,l),w(t.$$.fragment,l),o=!1},d(l){l&&$(r),C(e,l),C(t,l),i=!1,s()}}}const Vi=10,Mc=30;function Pc(n,e,r){let t,o;q(n,oe,d=>r(6,t=d)),q(n,Ue,d=>r(7,o=d)),We(()=>{o&&(o.getCanvas().style.cursor=`url(${$s}), crosshair`)}),Ae(()=>{o&&(o.getCanvas().style.cursor="inherit")});let i=null,s=null,l=Rt();function a(d){if(!o)return;r(4,i=null),s=null;let p=f(d.detail.lngLat.toArray());const h=[d.detail.point.x-Mc,d.detail.point.y],g=o.unproject(d.detail.point).distanceTo(o.unproject(h))/1e3;let y=[];for(let[S,_]of t.features.entries())if(_.geometry.type=="LineString"){let m=kc(_.geometry,p,{units:"kilometers"});m.properties.dist!=null&&m.properties.dist<=g&&y.push([S,m.geometry.coordinates,m.properties.dist])}y.sort((S,_)=>S[2]-_[2]),y.length>0&&(r(4,i=f(y[0][1])),s=y[0][0])}function u(){if(s==null){Z.set({mode:"list"});return}let d=fu(t.features[s],i);if(d!=null){let[p,h]=d;oe.update(g=>(p.id=g.features[s].id,h.id=yr(g),g.features.splice(s,1,p,h),g))}r(4,i=null),s=null}function c(d){d.key=="Escape"&&(d.stopPropagation(),Z.set({mode:"list"}))}function f(d){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Qo(d)}}}return n.$$.update=()=>{if(n.$$.dirty&16){let d=Rt();i&&d.features.push(i),r(0,l=d)}},[l,a,u,c,i]}class Lc extends j{constructor(e){super(),Q(this,e,Pc,Ec,K,{})}}function Wi(n){let e,r;return e=new re({props:{$$slots:{default:[Cc]},$$scope:{ctx:n}}}),e.$on("click",n[5]),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&128&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Cc(n){let e;return{c(){e=G("X")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Fc(n){let e,r,t,o,i,s,l,a,u,c,f=n[2]&&Wi(n);const d=n[4].default,p=jt(d,n,n[7],null);return{c(){e=D("div"),r=D("div"),t=D("div"),o=D("h1"),i=G(n[1]),s=R(),f&&f.c(),l=R(),p&&p.c(),x(o,"class","govuk-heading-l"),ye(t,"display","flex"),ye(t,"justify-content","space-between"),x(r,"class","content centered-fullscreen svelte-1st8ub0"),x(e,"class","background svelte-1st8ub0"),sr(e,"open",n[0]),sr(e,"closed",!n[0])},m(h,g){v(h,e,g),J(e,r),J(r,t),J(t,o),J(o,i),J(t,s),f&&f.m(t,null),J(r,l),p&&p.m(r,null),a=!0,u||(c=[ke(r,"click",Js(Rc)),ke(e,"click",n[6])],u=!0)},p(h,[g]){(!a||g&2)&&ge(i,h[1]),h[2]?f?(f.p(h,g),g&4&&b(f,1)):(f=Wi(h),f.c(),b(f,1),f.m(t,null)):f&&(ne(),w(f,1,1,()=>{f=null}),ie()),p&&p.p&&(!a||g&128)&&Qt(p,d,h,h[7],a?tr(d,h[7],g,null):er(h[7]),null),(!a||g&1)&&sr(e,"open",h[0]),(!a||g&1)&&sr(e,"closed",!h[0])},i(h){a||(b(f),b(p,h),a=!0)},o(h){w(f),w(p,h),a=!1},d(h){h&&$(e),f&&f.d(),p&&p.d(h),u=!1,Mn(c)}}}const Rc=()=>null;function Ac(n,e,r){let{$$slots:t={},$$scope:o}=e,{title:i}=e,{open:s=!1}=e,{displayEscapeButton:l=!0}=e,{canCloseByClickingBackground:a=!0}=e;const u=()=>r(0,s=!1),c=()=>{a&&r(0,s=!1)};return n.$$set=f=>{"title"in f&&r(1,i=f.title),"open"in f&&r(0,s=f.open),"displayEscapeButton"in f&&r(2,l=f.displayEscapeButton),"canCloseByClickingBackground"in f&&r(3,a=f.canCloseByClickingBackground),"$$scope"in f&&r(7,o=f.$$scope)},[s,i,l,a,t,u,c,o]}class Nc extends j{constructor(e){super(),Q(this,e,Ac,Fc,K,{title:1,open:0,displayEscapeButton:2,canCloseByClickingBackground:3})}}function Oc(n){let e;return{c(){e=D("ul"),e.innerHTML=`<li><b>Click</b>
    on the map to open a new tab with a 3rd-party imagery provider</li> <li>Press <b>Escape</b>
    to exit this mode</li> <li>Cursor by <a href="https://icon-icons.com/icon/screenshot-cursor-camera/100181" target="_blank" rel="noreferrer">Luc Chaissac</a></li>`},m(r,t){v(r,e,t)},p:W,i:W,o:W,d(r){r&&$(e)}}}class bs extends j{constructor(e){super(),Q(this,e,null,Oc,K,{})}}const Ic="/atip/ss_huge_refactor_pt1/assets/camera_cursor-824d29b6.svg",{window:Bc}=ho;function Hi(n){let e,r,t,o;const i=[Gc,Dc],s=[];function l(a,u){return a[0]?0:1}return e=l(n),r=s[e]=i[e](n),{c(){r.c(),t=ue()},m(a,u){s[e].m(a,u),v(a,t,u),o=!0},p(a,u){let c=e;e=l(a),e===c?s[e].p(a,u):(ne(),w(s[c],1,1,()=>{s[c]=null}),ie(),r=s[e],r?r.p(a,u):(r=s[e]=i[e](a),r.c()),b(r,1),r.m(t.parentNode,t))},i(a){o||(b(r),o=!0)},o(a){w(r),o=!1},d(a){a&&$(t),s[e].d(a)}}}function Dc(n){let e,r;return e=new re({props:{$$slots:{default:[Tc]},$$scope:{ctx:n}}}),e.$on("click",n[6]),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&8192&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Gc(n){let e,r,t,o,i,s,l;e=new re({props:{$$slots:{default:[Uc]},$$scope:{ctx:n}}}),e.$on("click",n[4]);function a(c){n[5](c)}let u={legend:"Source",choices:[["google","Google Street View"],["bing","Bing Streetside"]]};return n[2].streetViewImagery!==void 0&&(u.value=n[2].streetViewImagery),t=new yo({props:u}),ce.push(()=>de(t,"value",a)),s=new $o({props:{label:"Help",$$slots:{default:[xc]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment),i=R(),P(s.$$.fragment)},m(c,f){L(e,c,f),v(c,r,f),L(t,c,f),v(c,i,f),L(s,c,f),l=!0},p(c,f){const d={};f&8192&&(d.$$scope={dirty:f,ctx:c}),e.$set(d);const p={};!o&&f&4&&(o=!0,p.value=c[2].streetViewImagery,_e(()=>o=!1)),t.$set(p);const h={};f&8192&&(h.$$scope={dirty:f,ctx:c}),s.$set(h)},i(c){l||(b(e.$$.fragment,c),b(t.$$.fragment,c),b(s.$$.fragment,c),l=!0)},o(c){w(e.$$.fragment,c),w(t.$$.fragment,c),w(s.$$.fragment,c),l=!1},d(c){c&&($(r),$(i)),C(e,c),C(t,c),C(s,c)}}}function Tc(n){let e;return{c(){e=G("Enable Street View")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Uc(n){let e;return{c(){e=G("Disable Street View")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function xc(n){let e,r;return e=new bs({}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function qc(n){let e,r,t,o,i=n[1]&&Hi(n);return{c(){i&&i.c(),e=ue()},m(s,l){i&&i.m(s,l),v(s,e,l),r=!0,t||(o=ke(Bc,"keydown",n[3]),t=!0)},p(s,[l]){s[1]?i?(i.p(s,l),l&2&&b(i,1)):(i=Hi(s),i.c(),b(i,1),i.m(e.parentNode,e)):i&&(ne(),w(i,1,1,()=>{i=null}),ie())},i(s){r||(b(i),r=!0)},o(s){w(i),r=!1},d(s){s&&$(e),i&&i.d(s),t=!1,o()}}}function zc(n,e,r){let t,o,i;q(n,mt,y=>r(2,t=y)),q(n,Ue,y=>r(8,o=y)),q(n,gu,y=>r(9,i=y));let{enabled:s}=e,{showControls:l=!0}=e,a=[];function u(){if(o){o.on("click",f),o.getCanvas().style.cursor=`url(${Ic}), auto`;for(let y of la(o,i))a.push([y,o.getPaintProperty(y,"line-color")]),o.setPaintProperty(y,"line-color","cyan")}}function c(){if(o){o.off("click",f),o.getCanvas().style.cursor="inherit";for(let[y,S]of a)o.setPaintProperty(y,"line-color",S);a=[]}}Ae(c);function f(y){if(!s)return;let S=y.lngLat.lng,_=y.lngLat.lat;t.streetViewImagery=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${_},${S}&cbp=11,0,0,0,0`,"_blank"):t.streetViewImagery=="bing"&&window.open(`https://www.bing.com/maps?cp=${_}~${S}&style=x`,"_blank")}function d(y){s&&y.key=="Escape"&&(y.stopPropagation(),r(0,s=!1))}const p=()=>r(0,s=!1);function h(y){n.$$.not_equal(t.streetViewImagery,y)&&(t.streetViewImagery=y,mt.set(t))}const g=()=>r(0,s=!0);return n.$$set=y=>{"enabled"in y&&r(0,s=y.enabled),"showControls"in y&&r(1,l=y.showControls)},n.$$.update=()=>{n.$$.dirty&1&&(s?u():c())},[s,l,t,d,p,h,g]}class Yc extends j{constructor(e){super(),Q(this,e,zc,qc,K,{enabled:0,showControls:1})}}const Jc="/atip/ss_huge_refactor_pt1/assets/warning-81bba3f6.svg";function Xc(n){let e,r;return{c(){e=D("img"),Ne(e.src,r=Jc)||x(e,"src",r),x(e,"title",n[0]),x(e,"alt",n[0])},m(t,o){v(t,e,o)},p(t,[o]){o&1&&x(e,"title",t[0]),o&1&&x(e,"alt",t[0])},i:W,o:W,d(t){t&&$(e)}}}function Vc(n,e,r){let{text:t}=e;return n.$$set=o=>{"text"in o&&r(0,t=o.text)},[t]}class Wc extends j{constructor(e){super(),Q(this,e,Vc,Xc,K,{text:0})}}async function Hc(n,e){let r=await fetch(n),t=r.body.getReader(),o=r.headers.get("Content-Length");if(!o)throw new Error(`No Content-Length header from ${n}`);let i=parseInt(o),s=0,l=[];for(;;){let{done:c,value:f}=await t.read();if(c)break;f&&(l.push(f),s+=f.length,e(100*s/i))}let a=new Uint8Array(s),u=0;for(let c of l)a.set(c,u),u+=c.length;return a}function Zc(n){let e;return{c(){e=G("Finish")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Kc(n){let e,r,t,o,i,s,l,a,u,c;function f(g){n[2](g)}let d={showControls:!1};n[0]!==void 0&&(d.enabled=n[0]),e=new Yc({props:d}),ce.push(()=>de(e,"enabled",f)),o=new at({props:{$$slots:{default:[Zc]},$$scope:{ctx:n}}}),o.$on("click",n[3]);function p(g){n[4](g)}let h={legend:"Source",choices:[["google","Google Street View"],["bing","Bing Streetside"]],inlineSmall:!0};return n[1].streetViewImagery!==void 0&&(h.value=n[1].streetViewImagery),s=new yo({props:h}),ce.push(()=>de(s,"value",p)),u=new bs({}),{c(){P(e.$$.fragment),t=R(),P(o.$$.fragment),i=R(),P(s.$$.fragment),a=R(),P(u.$$.fragment)},m(g,y){L(e,g,y),v(g,t,y),L(o,g,y),v(g,i,y),L(s,g,y),v(g,a,y),L(u,g,y),c=!0},p(g,[y]){const S={};!r&&y&1&&(r=!0,S.enabled=g[0],_e(()=>r=!1)),e.$set(S);const _={};y&32&&(_.$$scope={dirty:y,ctx:g}),o.$set(_);const m={};!l&&y&2&&(l=!0,m.value=g[1].streetViewImagery,_e(()=>l=!1)),s.$set(m)},i(g){c||(b(e.$$.fragment,g),b(o.$$.fragment,g),b(s.$$.fragment,g),b(u.$$.fragment,g),c=!0)},o(g){w(e.$$.fragment,g),w(o.$$.fragment,g),w(s.$$.fragment,g),w(u.$$.fragment,g),c=!1},d(g){g&&($(t),$(i),$(a)),C(e,g),C(o,g),C(s,g),C(u,g)}}}function jc(n,e,r){let t;q(n,mt,a=>r(1,t=a));let o=!0;function i(a){o=a,r(0,o)}const s=()=>r(0,o=!1);function l(a){n.$$.not_equal(t.streetViewImagery,a)&&(t.streetViewImagery=a,mt.set(t))}return n.$$.update=()=>{n.$$.dirty&1&&(o||Z.set({mode:"list"}))},[o,t,i,s,l]}class Qc extends j{constructor(e){super(),Q(this,e,jc,Kc,K,{})}}const ep="/atip/ss_huge_refactor_pt1/assets/image-3e3a13e8.svg",tp="/atip/ss_huge_refactor_pt1/assets/point-276f4055.svg",rp="/atip/ss_huge_refactor_pt1/assets/polygon_freehand-cf965967.svg",np="/atip/ss_huge_refactor_pt1/assets/polygon_snapped-18efbbea.svg",ip="/atip/ss_huge_refactor_pt1/assets/route-d3c0ebad.svg",op="/atip/ss_huge_refactor_pt1/assets/street_view-48580b6a.svg";function sp(n){let e,r,t;return{c(){e=D("img"),t=G(`
    New point`),Ne(e.src,r=tp)||x(e,"src",r),x(e,"alt","New point")},m(o,i){v(o,e,i),v(o,t,i)},p:W,d(o){o&&($(e),$(t))}}}function lp(n){let e,r,t;return{c(){e=D("img"),t=G(`
    New route`),Ne(e.src,r=ip)||x(e,"src",r),x(e,"alt","New route")},m(o,i){v(o,e,i),v(o,t,i)},p:W,d(o){o&&($(e),$(t))}}}function ap(n){let e,r,t;return{c(){e=D("img"),t=G(`
    New polygon (freehand)`),Ne(e.src,r=rp)||x(e,"src",r),x(e,"alt","New polygon (freehand)")},m(o,i){v(o,e,i),v(o,t,i)},p:W,d(o){o&&($(e),$(t))}}}function up(n){let e,r,t;return{c(){e=D("img"),t=G(`
    New polygon (snapped)`),Ne(e.src,r=np)||x(e,"src",r),x(e,"alt","New polygon (snapped)")},m(o,i){v(o,e,i),v(o,t,i)},p:W,d(o){o&&($(e),$(t))}}}function fp(n){let e,r,t;return{c(){e=D("img"),t=G(`
    Split route`),Ne(e.src,r=$s)||x(e,"src",r),x(e,"alt","Split route")},m(o,i){v(o,e,i),v(o,t,i)},p:W,d(o){o&&($(e),$(t))}}}function cp(n){let e,r,t;return{c(){e=D("img"),t=G(`
    Georeference image`),Ne(e.src,r=ep)||x(e,"src",r),x(e,"alt","Georeference image")},m(o,i){v(o,e,i),v(o,t,i)},p:W,d(o){o&&($(e),$(t))}}}function pp(n){let e,r,t;return{c(){e=D("img"),t=G(`
    StreetView`),Ne(e.src,r=op)||x(e,"src",r),x(e,"alt","StreetView")},m(o,i){v(o,e,i),v(o,t,i)},p:W,d(o){o&&($(e),$(t))}}}function dp(n){let e,r,t,o,i,s,l,a,u,c,f,d,p,h,g,y,S;return e=new yf({}),o=new re({props:{disabled:!n[0],$$slots:{default:[sp]},$$scope:{ctx:n}}}),o.$on("click",n[3]),s=new re({props:{disabled:!n[1],$$slots:{default:[lp]},$$scope:{ctx:n}}}),s.$on("click",n[4]),a=new re({props:{disabled:!n[2],$$slots:{default:[ap]},$$scope:{ctx:n}}}),a.$on("click",n[5]),c=new re({props:{disabled:!n[1],$$slots:{default:[up]},$$scope:{ctx:n}}}),c.$on("click",n[6]),d=new re({props:{$$slots:{default:[fp]},$$scope:{ctx:n}}}),d.$on("click",n[7]),h=new re({props:{$$slots:{default:[cp]},$$scope:{ctx:n}}}),h.$on("click",n[8]),y=new re({props:{$$slots:{default:[pp]},$$scope:{ctx:n}}}),y.$on("click",n[9]),{c(){P(e.$$.fragment),r=R(),t=D("div"),P(o.$$.fragment),i=R(),P(s.$$.fragment),l=R(),P(a.$$.fragment),u=R(),P(c.$$.fragment),f=R(),P(d.$$.fragment),p=R(),P(h.$$.fragment),g=R(),P(y.$$.fragment),x(t,"class","top govuk-prose svelte-1kai3ke")},m(_,m){L(e,_,m),v(_,r,m),v(_,t,m),L(o,t,null),J(t,i),L(s,t,null),J(t,l),L(a,t,null),J(t,u),L(c,t,null),J(t,f),L(d,t,null),J(t,p),L(h,t,null),J(t,g),L(y,t,null),S=!0},p(_,[m]){const M={};m&1&&(M.disabled=!_[0]),m&1024&&(M.$$scope={dirty:m,ctx:_}),o.$set(M);const E={};m&2&&(E.disabled=!_[1]),m&1024&&(E.$$scope={dirty:m,ctx:_}),s.$set(E);const k={};m&4&&(k.disabled=!_[2]),m&1024&&(k.$$scope={dirty:m,ctx:_}),a.$set(k);const A={};m&2&&(A.disabled=!_[1]),m&1024&&(A.$$scope={dirty:m,ctx:_}),c.$set(A);const B={};m&1024&&(B.$$scope={dirty:m,ctx:_}),d.$set(B);const T={};m&1024&&(T.$$scope={dirty:m,ctx:_}),h.$set(T);const z={};m&1024&&(z.$$scope={dirty:m,ctx:_}),y.$set(z)},i(_){S||(b(e.$$.fragment,_),b(o.$$.fragment,_),b(s.$$.fragment,_),b(a.$$.fragment,_),b(c.$$.fragment,_),b(d.$$.fragment,_),b(h.$$.fragment,_),b(y.$$.fragment,_),S=!0)},o(_){w(e.$$.fragment,_),w(o.$$.fragment,_),w(s.$$.fragment,_),w(a.$$.fragment,_),w(c.$$.fragment,_),w(d.$$.fragment,_),w(h.$$.fragment,_),w(y.$$.fragment,_),S=!1},d(_){_&&($(r),$(t)),C(e,_),C(o),C(s),C(a),C(c),C(d),C(h),C(y)}}}function hp(n,e,r){let t,o,i;return q(n,Ht,p=>r(0,t=p)),q(n,et,p=>r(1,o=p)),q(n,Ft,p=>r(2,i=p)),[t,o,i,()=>Z.set({mode:"new-point"}),()=>Z.set({mode:"new-route"}),()=>Z.set({mode:"new-freehand-polygon"}),()=>Z.set({mode:"new-snapped-polygon"}),()=>Z.set({mode:"split-route"}),()=>Z.set({mode:"set-image"}),()=>Z.set({mode:"streetview"})]}class mp extends j{constructor(e){super(),Q(this,e,hp,dp,K,{})}}const gp="/atip/ss_huge_refactor_pt1/assets/delete-3c023172.svg",_p="/atip/ss_huge_refactor_pt1/assets/save-74d8f3c2.svg";function Hr(n){var t,o,i,s,l,a,u,c;let e=Sn(Dr),r=1;for(let f of n.features)f.properties||(f.properties={name:"",scheme_reference:"",description:"",intervention_type:"other",is_coverage_polygon:!1}),e=="pipeline"&&!f.properties.intervention_type&&(f.properties.intervention_type=new Map([["LineString","route"],["Polygon","area"]]).get(f.geometry.type)??"other"),f.geometry.type=="LineString"&&!f.properties.length_meters&&(f.properties.length_meters=il(f,{units:"kilometers"})*1e3),f.id=r++;if(!n.schemes){let f=bn();n.schemes={},n.schemes[f]={scheme_reference:f,color:Qr()},n.scheme_name&&(n.schemes[f].scheme_name=n.scheme_name,delete n.scheme_name),n.pipeline&&(n.schemes[f].pipeline=n.pipeline,delete n.pipeline);for(let d of n.features)d.properties.scheme_reference=f}for(let f of Object.values(n.schemes)){let d=f;if(d.color??(d.color=Qr()),e=="pipeline"){d.pipeline??(d.pipeline=ws()),(t=d.pipeline).development_funded??(t.development_funded=!1),(o=d.pipeline).construction_funded??(o.construction_funded=!1),(i=d.pipeline).funding_sources??(i.funding_sources=$n()),delete d.pipeline.budget_funded,delete d.pipeline.budget_unfunded,delete d.pipeline.funding_source,delete d.pipeline.funded;for(let p of n.features)p.properties.pipeline&&((s=p.properties.pipeline).development_funded??(s.development_funded=!1),(l=p.properties.pipeline).construction_funded??(l.construction_funded=!1),(a=p.properties.pipeline).funding_sources??(a.funding_sources=$n()),(u=p.properties.pipeline).status??(u.status=""),(c=p.properties.pipeline).timescale??(c.timescale=""))}}return n}function yp(){let n={type:"FeatureCollection",features:[],schemes:{}};return vp(n),n}function vp(n){let e=bn();const r={};r[e]={scheme_reference:e,color:Qr()},Object.keys(n.schemes).forEach(o=>{r[o]=n.schemes[o]}),Sn(Dr)=="pipeline"&&(r[e].pipeline=ws()),n.schemes=r}function ws(){return{scheme_type:"",atf4_lead_type:"",scheme_description:"",status:"",timescale:"",development_funded:!1,construction_funded:!1,funding_sources:$n()}}function $n(){return{atf2:!1,atf3:!1,atf4:!1,atf4e:!1,crsts:!1,luf:!1,other:""}}function Zi(n,e,r){const t=n.slice();return t[8]=e[r],t}function $p(n){let e;return{c(){e=G("Delete all sketch data from browser")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Ki(n){let e,r,t,o,i=Ye(n[1].storedStrings),s=[];for(let a=0;a<i.length;a+=1)s[a]=Qi(Zi(n,i,a));const l=a=>w(s[a],1,1,()=>{s[a]=null});return{c(){e=D("p"),e.textContent=`Otherwise here is a breakdown of what is currently stored locally. You can
      delete individual items (normally storage quota is 5MB or 10MB):`,r=R();for(let a=0;a<s.length;a+=1)s[a].c();t=ue()},m(a,u){v(a,e,u),v(a,r,u);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(a,u);v(a,t,u),o=!0},p(a,u){if(u&14){i=Ye(a[1].storedStrings);let c;for(c=0;c<i.length;c+=1){const f=Zi(a,i,c);s[c]?(s[c].p(f,u),b(s[c],1)):(s[c]=Qi(f),s[c].c(),b(s[c],1),s[c].m(t.parentNode,t))}for(ne(),c=i.length;c<s.length;c+=1)l(c);ie()}},i(a){if(!o){for(let u=0;u<i.length;u+=1)b(s[u]);o=!0}},o(a){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)w(s[u]);o=!1},d(a){a&&($(e),$(r),$(t)),go(s,a)}}}function ji(n){let e,r,t,o;return r=new Dl({props:{text:"warning icon"}}),{c(){e=D("p"),P(r.$$.fragment),t=G(`The button below deletes the
          current sketch.`)},m(i,s){v(i,e,s),L(r,e,null),J(e,t),o=!0},i(i){o||(b(r.$$.fragment,i),o=!0)},o(i){w(r.$$.fragment,i),o=!1},d(i){i&&$(e),C(r)}}}function bp(n){let e,r=n[8].key+"",t,o,i=n[8].storageUsedInMB.toFixed(2)+"",s,l;return{c(){e=G("Remove stored item for "),t=G(r),o=G("("),s=G(i),l=G(`MB)
      `)},m(a,u){v(a,e,u),v(a,t,u),v(a,o,u),v(a,s,u),v(a,l,u)},p(a,u){u&2&&r!==(r=a[8].key+"")&&ge(t,r),u&2&&i!==(i=a[8].storageUsedInMB.toFixed(2)+"")&&ge(s,i)},d(a){a&&($(e),$(t),$(o),$(s),$(l))}}}function Qi(n){let e,r,t,o=n[8].key===n[2]&&ji();function i(){return n[6](n[8])}return r=new re({props:{$$slots:{default:[bp]},$$scope:{ctx:n}}}),r.$on("click",i),{c(){o&&o.c(),e=R(),P(r.$$.fragment)},m(s,l){o&&o.m(s,l),v(s,e,l),L(r,s,l),t=!0},p(s,l){n=s,n[8].key===n[2]?o?l&6&&b(o,1):(o=ji(),o.c(),b(o,1),o.m(e.parentNode,e)):o&&(ne(),w(o,1,1,()=>{o=null}),ie());const a={};l&2050&&(a.$$scope={dirty:l,ctx:n}),r.$set(a)},i(s){t||(b(o),b(r.$$.fragment,s),t=!0)},o(s){w(o),w(r.$$.fragment,s),t=!1},d(s){s&&$(e),o&&o.d(s),C(r,s)}}}function wp(n){var d;let e,r=((d=n[1])==null?void 0:d.message)+"",t,o,i,s,l,a,u,c;l=new _t({props:{$$slots:{default:[$p]},$$scope:{ctx:n}}}),l.$on("click",n[4]);let f=n[1]&&Ki(n);return{c(){e=D("p"),t=G(r),o=R(),i=D("p"),i.textContent=`If you have saved your work locally to a geojson file recently, you can
    delete all files stored in the browser for all authorities to free up space.
    Be sure that you're not losing anything important before doing this!`,s=R(),P(l.$$.fragment),a=R(),f&&f.c(),u=ue()},m(p,h){v(p,e,h),J(e,t),v(p,o,h),v(p,i,h),v(p,s,h),L(l,p,h),v(p,a,h),f&&f.m(p,h),v(p,u,h),c=!0},p(p,h){var y;(!c||h&2)&&r!==(r=((y=p[1])==null?void 0:y.message)+"")&&ge(t,r);const g={};h&2048&&(g.$$scope={dirty:h,ctx:p}),l.$set(g),p[1]?f?(f.p(p,h),h&2&&b(f,1)):(f=Ki(p),f.c(),b(f,1),f.m(u.parentNode,u)):f&&(ne(),w(f,1,1,()=>{f=null}),ie())},i(p){c||(b(l.$$.fragment,p),b(f),c=!0)},o(p){w(l.$$.fragment,p),w(f),c=!1},d(p){p&&($(e),$(o),$(i),$(s),$(a),$(u)),C(l,p),f&&f.d(p)}}}function kp(n){let e,r,t;function o(s){n[7](s)}let i={title:"Local Storage Quota Exceeded",$$slots:{default:[wp]},$$scope:{ctx:n}};return n[0]!==void 0&&(i.open=n[0]),e=new Pn({props:i}),ce.push(()=>de(e,"open",o)),{c(){P(e.$$.fragment)},m(s,l){L(e,s,l),t=!0},p(s,[l]){const a={};l&2054&&(a.$$scope={dirty:l,ctx:s}),!r&&l&1&&(r=!0,a.open=s[0],_e(()=>r=!1)),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){C(e,s)}}}function Sp(n,e,r){let{show:t}=e,{setStorageError:o}=e,{clearCurrentSketch:i}=e,{currentAuthority:s}=e;function l(f){let d=Xs(f);o&&r(1,o.storedStrings=d,o),f===s&&i()}function a(){i(),Vs(),r(0,t=!1),r(1,o=void 0)}const u=f=>l(f.key);function c(f){t=f,r(0,t)}return n.$$set=f=>{"show"in f&&r(0,t=f.show),"setStorageError"in f&&r(1,o=f.setStorageError),"clearCurrentSketch"in f&&r(5,i=f.clearCurrentSketch),"currentAuthority"in f&&r(2,s=f.currentAuthority)},[t,o,s,l,a,i,u,c]}class Ep extends j{constructor(e){super(),Q(this,e,Sp,kp,K,{show:0,setStorageError:1,clearCurrentSketch:5,currentAuthority:2})}}function eo(n){let e,r;return e=new $o({props:{label:"Manage files",$$slots:{default:[Np]},$$scope:{ctx:n}}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&524294&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Mp(n){let e,r,t;return{c(){e=D("img"),t=G(`
        Save`),Ne(e.src,r=_p)||x(e,"src",r),x(e,"alt","Save as GeoJSON file")},m(o,i){v(o,e,i),v(o,t,i)},p:W,d(o){o&&($(e),$(t))}}}function Pp(n){let e,r,t;return{c(){e=D("img"),t=G(`
        Clear all`),Ne(e.src,r=gp)||x(e,"src",r),x(e,"alt","Clear all")},m(o,i){v(o,e,i),v(o,t,i)},p:W,d(o){o&&($(e),$(t))}}}function Lp(n){let e,r,t,o;return e=new re({props:{$$slots:{default:[Mp]},$$scope:{ctx:n}}}),e.$on("click",n[7]),t=new _t({props:{$$slots:{default:[Pp]},$$scope:{ctx:n}}}),t.$on("click",n[12]),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&524288&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&524288&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function Cp(n){let e;return{c(){e=G("Clear all work")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Fp(n){let e;return{c(){e=G("Cancel")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Rp(n){let e,r,t,o;return e=new _t({props:{$$slots:{default:[Cp]},$$scope:{ctx:n}}}),e.$on("click",n[6]),t=new re({props:{$$slots:{default:[Fp]},$$scope:{ctx:n}}}),t.$on("click",n[13]),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&524288&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&524288&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function Ap(n){let e,r,t,o;return t=new He({props:{$$slots:{default:[Rp]},$$scope:{ctx:n}}}),{c(){e=D("p"),e.textContent="This will delete everything for all schemes.",r=R(),P(t.$$.fragment)},m(i,s){v(i,e,s),v(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&524292&&(l.$$scope={dirty:s,ctx:i}),t.$set(l)},i(i){o||(b(t.$$.fragment,i),o=!0)},o(i){w(t.$$.fragment,i),o=!1},d(i){i&&($(e),$(r)),C(t,i)}}}function Np(n){let e,r,t,o,i,s,l,a,u;e=new vo({props:{label:"Load GeoJSON file",loadFile:n[8]}}),t=new He({props:{$$slots:{default:[Lp]},$$scope:{ctx:n}}}),i=new gt({props:{errorMessage:n[1]}});function c(d){n[14](d)}let f={title:"Would you like to clear your work?",displayEscapeButton:!1,$$slots:{default:[Ap]},$$scope:{ctx:n}};return n[2]!==void 0&&(f.open=n[2]),l=new Pn({props:f}),ce.push(()=>de(l,"open",c)),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment),o=R(),P(i.$$.fragment),s=R(),P(l.$$.fragment)},m(d,p){L(e,d,p),v(d,r,p),L(t,d,p),v(d,o,p),L(i,d,p),v(d,s,p),L(l,d,p),u=!0},p(d,p){const h={};p&524292&&(h.$$scope={dirty:p,ctx:d}),t.$set(h);const g={};p&2&&(g.errorMessage=d[1]),i.$set(g);const y={};p&524292&&(y.$$scope={dirty:p,ctx:d}),!a&&p&4&&(a=!0,y.open=d[2],_e(()=>a=!1)),l.$set(y)},i(d){u||(b(e.$$.fragment,d),b(t.$$.fragment,d),b(i.$$.fragment,d),b(l.$$.fragment,d),u=!0)},o(d){w(e.$$.fragment,d),w(t.$$.fragment,d),w(i.$$.fragment,d),w(l.$$.fragment,d),u=!1},d(d){d&&($(r),$(o),$(s)),C(e,d),C(t,d),C(i,d),C(l,d)}}}function Op(n){let e,r,t,o,i,s=n[5].mode=="list"&&eo(n);function l(c){n[15](c)}function a(c){n[16](c)}let u={clearCurrentSketch:n[6],currentAuthority:n[0]};return n[3]!==void 0&&(u.show=n[3]),n[4]!==void 0&&(u.setStorageError=n[4]),r=new Ep({props:u}),ce.push(()=>de(r,"show",l)),ce.push(()=>de(r,"setStorageError",a)),{c(){s&&s.c(),e=R(),P(r.$$.fragment)},m(c,f){s&&s.m(c,f),v(c,e,f),L(r,c,f),i=!0},p(c,[f]){c[5].mode=="list"?s?(s.p(c,f),f&32&&b(s,1)):(s=eo(c),s.c(),b(s,1),s.m(e.parentNode,e)):s&&(ne(),w(s,1,1,()=>{s=null}),ie());const d={};f&1&&(d.currentAuthority=c[0]),!t&&f&8&&(t=!0,d.show=c[3],_e(()=>t=!1)),!o&&f&16&&(o=!0,d.setStorageError=c[4],_e(()=>o=!1)),r.$set(d)},i(c){i||(b(s),b(r.$$.fragment,c),i=!0)},o(c){w(s),w(r.$$.fragment,c),i=!1},d(c){c&&$(e),s&&s.d(c),C(r,c)}}}function Ip(n,e){var r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),r.setAttribute("download",n),document.body.appendChild(r),r.click(),document.body.removeChild(r)}function Bp(n,e,r){let t,o,i;q(n,oe,k=>r(11,t=k)),q(n,Z,k=>r(5,o=k)),q(n,Dr,k=>r(17,i=k));let{authorityName:s}=e,l="",a=s;i!="v1"&&(a+=`_${i}`);let u=!1,c=!1;We(async()=>{let A=new URLSearchParams(window.location.search).get("geojsonUrl"),B=window.localStorage.getItem(a);if(A){console.log(`Loading GeoJSON from ${A}`);try{let z=await(await fetch(A)).text();oe.set(Hr(JSON.parse(z)))}catch(T){console.log(`Failed to load from URL: ${T}`)}}else if(B)try{oe.set(Hr(JSON.parse(B)))}catch(T){console.log(`Failed to load from local storage: ${T}`)}r(10,u=!0)});let f=!1,d;function p(){r(2,c=!1),oe.update(k=>{let A=yp();return A.origin=k.origin,A.authority=k.authority,A}),Et.set(null),Vt.set(new Set),Te(Z,o.mode="list",o)}function h(){const k=JSON.parse(JSON.stringify(t));for(let A of k.features)delete A.properties.hide_while_editing;return k}function g(){let k=h();k.authority=s,k.origin="atip-v2",Ip(`${a}.geojson`,JSON.stringify(k,null,"  "))}function y(k){try{oe.set(Hr(JSON.parse(k))),r(1,l="")}catch(A){r(1,l=`Couldn't load scheme from a file: ${A}`)}}const S=()=>r(2,c=!0),_=()=>r(2,c=!1);function m(k){c=k,r(2,c)}function M(k){f=k,r(3,f),r(10,u),r(11,t),r(9,a)}function E(k){d=k,r(4,d),r(10,u),r(11,t),r(9,a)}return n.$$set=k=>{"authorityName"in k&&r(0,s=k.authorityName)},n.$$.update=()=>{if(n.$$.dirty&3584&&u&&t){console.log("GJ changed, saving to local storage");const k=Ws(a,JSON.stringify(h()));k.isQuotaError&&(r(3,f=!0),r(4,d=k))}},[s,l,c,f,d,o,p,g,y,a,u,t,S,_,m,M,E]}class Dp extends j{constructor(e){super(),Q(this,e,Bp,Op,K,{authorityName:0})}}function Gp(n){let e;return{c(){e=D("div"),e.innerHTML=`<h2>Saving files</h2> <p>ATIP does not send any data over the network or store your data in the
      cloud. The current file you&#39;re editing will be saved in your browser&#39;s
      local storage and automatically resume when you return to the page. Click <b>Edit scheme</b>
      , then
      <b>Export to GeoJSON</b>
      or
      <b>Load from GeoJSON</b>
      to save or load a file to your computer. You can share these files with others
      to collaborate on designs.</p>`,x(e,"class","govuk-prose")},m(r,t){v(r,e,t)},p:W,d(r){r&&$(e)}}}function Tp(n){let e,r,t;function o(s){n[1](s)}let i={title:"Instructions",$$slots:{default:[Gp]},$$scope:{ctx:n}};return n[0]!==void 0&&(i.open=n[0]),e=new Pn({props:i}),ce.push(()=>de(e,"open",o)),{c(){P(e.$$.fragment)},m(s,l){L(e,s,l),t=!0},p(s,[l]){const a={};l&4&&(a.$$scope={dirty:l,ctx:s}),!r&&l&1&&(r=!0,a.open=s[0],_e(()=>r=!1)),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){C(e,s)}}}function Up(n,e,r){let{open:t}=e;function o(i){t=i,r(0,t)}return n.$$set=i=>{"open"in i&&r(0,t=i.open)},[t,o]}class xp extends j{constructor(e){super(),Q(this,e,Up,Tp,K,{open:0})}}function qp(n){let e;return{c(){e=G("Save")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function zp(n){let e;return{c(){e=G("Edit geometry")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Yp(n){let e;return{c(){e=G("Delete")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Jp(n){let e,r,t,o,i,s;return e=new at({props:{$$slots:{default:[qp]},$$scope:{ctx:n}}}),e.$on("click",n[3]),t=new re({props:{$$slots:{default:[zp]},$$scope:{ctx:n}}}),t.$on("click",n[4]),i=new _t({props:{$$slots:{default:[Yp]},$$scope:{ctx:n}}}),i.$on("click",n[5]),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment),o=R(),P(i.$$.fragment)},m(l,a){L(e,l,a),v(l,r,a),L(t,l,a),v(l,o,a),L(i,l,a),s=!0},p(l,a){const u={};a&2048&&(u.$$scope={dirty:a,ctx:l}),e.$set(u);const c={};a&2048&&(c.$$scope={dirty:a,ctx:l}),t.$set(c);const f={};a&2048&&(f.$$scope={dirty:a,ctx:l}),i.$set(f)},i(l){s||(b(e.$$.fragment,l),b(t.$$.fragment,l),b(i.$$.fragment,l),s=!0)},o(l){w(e.$$.fragment,l),w(t.$$.fragment,l),w(i.$$.fragment,l),s=!1},d(l){l&&($(r),$(o)),C(e,l),C(t,l),C(i,l)}}}function Xp(n){let e,r,t=fe.interventionName(n[1])+"",o,i,s,l,a,u,c,f,d,p,h,g;s=new He({props:{$$slots:{default:[Jp]},$$scope:{ctx:n}}}),a=new gt({props:{errorMessage:fe.interventionWarning(n[1])}});function y(m){n[6](m)}var S=fe.editFeatureForm;function _(m,M){let E={};return m[1].properties!==void 0&&(E.props=m[1].properties),{props:E}}return S&&(c=zn(S,_(n)),ce.push(()=>de(c,"props",y))),{c(){e=D("h2"),r=G("Editing "),o=G(t),i=R(),P(s.$$.fragment),l=R(),P(a.$$.fragment),u=R(),c&&P(c.$$.fragment),d=ue()},m(m,M){v(m,e,M),J(e,r),J(e,o),v(m,i,M),L(s,m,M),v(m,l,M),L(a,m,M),v(m,u,M),c&&L(c,m,M),v(m,d,M),p=!0,h||(g=ke(window,"keydown",n[2]),h=!0)},p(m,[M]){(!p||M&2)&&t!==(t=fe.interventionName(m[1])+"")&&ge(o,t);const E={};M&2049&&(E.$$scope={dirty:M,ctx:m}),s.$set(E);const k={};if(M&2&&(k.errorMessage=fe.interventionWarning(m[1])),a.$set(k),S!==(S=fe.editFeatureForm)){if(c){ne();const A=c;w(A.$$.fragment,1,0,()=>{C(A,1)}),ie()}S?(c=zn(S,_(m)),ce.push(()=>de(c,"props",y)),P(c.$$.fragment),b(c.$$.fragment,1),L(c,d.parentNode,d)):c=null}else if(S){const A={};!f&&M&2&&(f=!0,A.props=m[1].properties,_e(()=>f=!1)),c.$set(A)}},i(m){p||(b(s.$$.fragment,m),b(a.$$.fragment,m),c&&b(c.$$.fragment,m),p=!0)},o(m){w(s.$$.fragment,m),w(a.$$.fragment,m),c&&w(c.$$.fragment,m),p=!1},d(m){m&&($(e),$(i),$(l),$(u),$(d)),C(s,m),C(a,m),c&&C(c,m),h=!1,g()}}}function Vp(n,e,r){let t,o;q(n,Ue,h=>r(7,t=h)),q(n,oe,h=>r(8,o=h));let{id:i}=e,s=o.features.find(h=>h.id==i);function l(h){oe.set(o)}We(()=>{t==null||t.on("click",a)}),Ae(()=>{t==null||t.off("click",a)});function a(h){for(let g of t.queryRenderedFeatures(h.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]}))if(g.id==i)return;Z.set({mode:"list"})}function u(h){if(h.key=="Escape"){h.stopPropagation(),Z.set({mode:"list"});return}if(h.key=="Delete"){const g=h.target.tagName;if(g=="INPUT"||g=="TEXTAREA")return;h.stopPropagation(),Ni(i)}if(h.key=="e"){const g=h.target.tagName;if(g=="INPUT"||g=="TEXTAREA")return;h.stopPropagation(),Z.set({mode:"edit-geometry",id:i})}}const c=()=>Z.set({mode:"list"}),f=()=>Z.set({mode:"edit-geometry",id:i}),d=()=>Ni(i);function p(h){n.$$.not_equal(s.properties,h)&&(s.properties=h,r(1,s))}return n.$$set=h=>{"id"in h&&r(0,i=h.id)},n.$$.update=()=>{n.$$.dirty&2&&l()},[i,s,u,c,f,d,p]}class Wp extends j{constructor(e){super(),Q(this,e,Vp,Xp,K,{id:0})}}const Hp="/atip/ss_huge_refactor_pt1/assets/delete-3c023172.svg";function to(n,e,r){const t=n.slice();t[27]=e[r];const o=fe.interventionWarning(t[27]);return t[28]=o,t}function Zp(n){let e,r,t;return{c(){e=D("img"),t=G(`
    Delete`),Ne(e.src,r=Hp)||x(e,"src",r),x(e,"alt","Delete scheme")},m(o,i){v(o,e,i),v(o,t,i)},p:W,d(o){o&&($(e),$(t))}}}function Kp(n){let e;return{c(){e=G("Show")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function jp(n){let e,r;return e=new gt({props:{errorMessage:"There's a problem with "+n[6]+" interventions below"}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&64&&(i.errorMessage="There's a problem with "+t[6]+" interventions below"),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Qp(n){let e,r;return e=new gt({props:{errorMessage:"There's a problem with one intervention below"}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p:W,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function ro(n){let e,r;return e=new Wc({props:{text:n[28]}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&3&&(i.text=t[28]),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function no(n,e){let r,t,o,i=fe.interventionName(e[27])+"",s,l,a,u,c,f=e[28]&&ro(e);function d(...g){return e[18](e[27],...g)}function p(){return e[19](e[27])}function h(){return e[20](e[27])}return{key:n,first:null,c(){r=D("li"),t=D("a"),f&&f.c(),o=R(),s=G(i),l=R(),x(t,"href","#"),this.first=r},m(g,y){v(g,r,y),J(r,t),f&&f.m(t,null),J(t,o),J(t,s),J(r,l),a=!0,u||(c=[ke(t,"click",d),ke(t,"mouseenter",p),ke(t,"mouseleave",h)],u=!0)},p(g,y){e=g,e[28]?f?(f.p(e,y),y&3&&b(f,1)):(f=ro(e),f.c(),b(f,1),f.m(t,o)):f&&(ne(),w(f,1,1,()=>{f=null}),ie()),(!a||y&3)&&i!==(i=fe.interventionName(e[27])+"")&&ge(s,i)},i(g){a||(b(f),a=!0)},o(g){w(f),a=!1},d(g){g&&$(r),f&&f.d(),u=!1,Mn(c)}}}function io(n){let e,r,t,o,i=n[5]==1?"intervention":"interventions",s,l,a,u,c,f;function d(h){n[21](h)}let p={label:"Move interventions to another scheme",choices:n[11]()};return n[3]!==void 0&&(p.value=n[3]),u=new ol({props:p}),ce.push(()=>de(u,"value",d)),u.$on("change",n[10]),{c(){e=D("p"),r=G("Do you want to first move "),t=G(n[5]),o=R(),s=G(i),l=G(" to another scheme?"),a=R(),P(u.$$.fragment)},m(h,g){v(h,e,g),J(e,r),J(e,t),J(e,o),J(e,s),J(e,l),v(h,a,g),L(u,h,g),f=!0},p(h,g){(!f||g&32)&&ge(t,h[5]),(!f||g&32)&&i!==(i=h[5]==1?"intervention":"interventions")&&ge(s,i);const y={};!c&&g&8&&(c=!0,y.value=h[3],_e(()=>c=!1)),u.$set(y)},i(h){f||(b(u.$$.fragment,h),f=!0)},o(h){w(u.$$.fragment,h),f=!1},d(h){h&&($(e),$(a)),C(u,h)}}}function ed(n){let e;return{c(){e=G("Delete scheme")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function td(n){let e;return{c(){e=G("Cancel")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function rd(n){let e,r,t,o;return e=new _t({props:{$$slots:{default:[ed]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new re({props:{$$slots:{default:[td]},$$scope:{ctx:n}}}),t.$on("click",n[22]),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&16777216&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&16777216&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function nd(n){let e=n[5]>0&&n[11]().length>0,r,t,o,i=e&&io(n);return t=new He({props:{$$slots:{default:[rd]},$$scope:{ctx:n}}}),{c(){i&&i.c(),r=R(),P(t.$$.fragment)},m(s,l){i&&i.m(s,l),v(s,r,l),L(t,s,l),o=!0},p(s,l){l&32&&(e=s[5]>0&&s[11]().length>0),e?i?(i.p(s,l),l&32&&b(i,1)):(i=io(s),i.c(),b(i,1),i.m(r.parentNode,r)):i&&(ne(),w(i,1,1,()=>{i=null}),ie());const a={};l&16777220&&(a.$$scope={dirty:l,ctx:s}),t.$set(a)},i(s){o||(b(i),b(t.$$.fragment,s),o=!0)},o(s){w(i),w(t.$$.fragment,s),o=!1},d(s){s&&$(r),i&&i.d(s),C(t,s)}}}function id(n){let e,r=fe.schemeName(n[1].schemes[n[0]])+"",t,o,i,s,l,a,u,c,f,d,p,h,g,y,S=[],_=new Map,m,M,E,k,A,B;l=new _t({props:{$$slots:{default:[Zp]},$$scope:{ctx:n}}}),l.$on("click",n[15]);function T(U){n[16](U)}let z={$$slots:{default:[Kp]},$$scope:{ctx:n}};n[4]!==void 0&&(z.checked=n[4]),u=new jr({props:z}),ce.push(()=>de(u,"checked",T)),u.$on("change",n[12]);const N=n[13].default,O=jt(N,n,n[24],null),I=[Qp,jp],F=[];function ee(U,V){return U[6]==1?0:U[6]>0?1:-1}~(p=ee(n))&&(h=F[p]=I[p](n));let te=Ye(n[1].features.filter(n[17]));const he=U=>U[27].id;for(let U=0;U<te.length;U+=1){let V=to(n,te,U),ae=he(V);_.set(ae,S[U]=no(ae,V))}function Re(U){n[23](U)}let $t={title:"Delete this scheme?",displayEscapeButton:!1,$$slots:{default:[nd]},$$scope:{ctx:n}};return n[2]!==void 0&&($t.open=n[2]),M=new Nc({props:$t}),ce.push(()=>de(M,"open",Re)),{c(){e=D("h3"),t=G(r),o=R(),i=D("input"),s=R(),P(l.$$.fragment),a=R(),P(u.$$.fragment),f=R(),O&&O.c(),d=R(),h&&h.c(),g=R(),y=D("ol");for(let U=0;U<S.length;U+=1)S[U].c();m=R(),P(M.$$.fragment),x(i,"type","color"),x(y,"class","govuk-list govuk-list--number")},m(U,V){v(U,e,V),J(e,t),J(e,o),J(e,i),Mt(i,n[1].schemes[n[0]].color),J(e,s),L(l,e,null),v(U,a,V),L(u,U,V),v(U,f,V),O&&O.m(U,V),v(U,d,V),~p&&F[p].m(U,V),v(U,g,V),v(U,y,V);for(let ae=0;ae<S.length;ae+=1)S[ae]&&S[ae].m(y,null);v(U,m,V),L(M,U,V),k=!0,A||(B=ke(i,"input",n[14]),A=!0)},p(U,[V]){(!k||V&3)&&r!==(r=fe.schemeName(U[1].schemes[U[0]])+"")&&ge(t,r),V&3&&Mt(i,U[1].schemes[U[0]].color);const ae={};V&16777216&&(ae.$$scope={dirty:V,ctx:U}),l.$set(ae);const Nt={};V&16777216&&(Nt.$$scope={dirty:V,ctx:U}),!c&&V&16&&(c=!0,Nt.checked=U[4],_e(()=>c=!1)),u.$set(Nt),O&&O.p&&(!k||V&16777216)&&Qt(O,N,U,U[24],k?tr(N,U[24],V,null):er(U[24]),null);let Ot=p;p=ee(U),p===Ot?~p&&F[p].p(U,V):(h&&(ne(),w(F[Ot],1,1,()=>{F[Ot]=null}),ie()),~p?(h=F[p],h?h.p(U,V):(h=F[p]=I[p](U),h.c()),b(h,1),h.m(g.parentNode,g)):h=null),V&387&&(te=Ye(U[1].features.filter(U[17])),ne(),S=wn(S,V,he,1,U,te,_,y,kn,no,null,to),ie());const It={};V&16777260&&(It.$$scope={dirty:V,ctx:U}),!E&&V&4&&(E=!0,It.open=U[2],_e(()=>E=!1)),M.$set(It)},i(U){if(!k){b(l.$$.fragment,U),b(u.$$.fragment,U),b(O,U),b(h);for(let V=0;V<te.length;V+=1)b(S[V]);b(M.$$.fragment,U),k=!0}},o(U){w(l.$$.fragment,U),w(u.$$.fragment,U),w(O,U),w(h);for(let V=0;V<S.length;V+=1)w(S[V]);w(M.$$.fragment,U),k=!1},d(U){U&&($(e),$(a),$(f),$(d),$(g),$(y),$(m)),C(l),C(u,U),O&&O.d(U),~p&&F[p].d(U);for(let V=0;V<S.length;V+=1)S[V].d();C(M,U),A=!1,B()}}}function od(n,e,r){let t,o,i,s,l;q(n,Vt,F=>r(25,i=F)),q(n,oe,F=>r(1,s=F)),q(n,Ue,F=>r(26,l=F));let{$$slots:a={},$$scope:u}=e,{scheme_reference:c}=e,f=!1;Ae(()=>{Et.set(null)});function d(F,ee){F.preventDefault();let te=s.features.find(he=>he.id==ee);te.geometry.type=="Point"?l==null||l.flyTo({center:te.geometry.coordinates,duration:500}):l==null||l.fitBounds(es(te),{padding:200,duration:500}),Z.set({mode:"edit-form",id:ee})}function p(F){Et.update(ee=>ee==F?null:ee)}function h(){oe.update(F=>(F.features=F.features.filter(ee=>ee.properties.scheme_reference!=c),delete F.schemes[c],Object.keys(F.schemes).length==0&&(F=Fo()),F)),Vt.update(F=>(F.delete(c),F)),r(2,f=!1)}let g="";function y(){g&&oe.update(F=>{for(let ee of F.features)ee.properties.scheme_reference==c&&(ee.properties.scheme_reference=g);return F})}function S(){return Object.values(s.schemes).filter(F=>F.scheme_reference!=c).map(F=>[F.scheme_reference,fe.schemeName(F)])}let _=!i.has(c);function m(){Vt.update(F=>(_?F.delete(c):F.add(c),F))}function M(){s.schemes[c].color=this.value,oe.set(s)}const E=()=>r(2,f=!0);function k(F){_=F,r(4,_)}const A=F=>F.properties.scheme_reference==c,B=(F,ee)=>d(ee,F.id),T=F=>Et.set(F.id),z=F=>p(F.id);function N(F){g=F,r(3,g)}const O=()=>r(2,f=!1);function I(F){f=F,r(2,f)}return n.$$set=F=>{"scheme_reference"in F&&r(0,c=F.scheme_reference),"$$scope"in F&&r(24,u=F.$$scope)},n.$$.update=()=>{n.$$.dirty&3&&r(6,t=s.features.filter(F=>F.properties.scheme_reference==c&&fe.interventionWarning(F)!=null).length),n.$$.dirty&3&&r(5,o=s.features.filter(F=>F.properties.scheme_reference==c).length)},[c,s,f,g,_,o,t,d,p,h,y,S,m,a,M,E,k,A,B,T,z,N,O,I,u]}class sd extends j{constructor(e){super(),Q(this,e,od,id,K,{scheme_reference:0})}}function oo(n,e,r){const t=n.slice();return t[7]=e[r],t[9]=r,t}function ld(n){let e;return{c(){e=G("Add new blank scheme")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function so(n){let e,r,t,o;function i(){return n[5](n[7])}e=new re({props:{disabled:n[9]==0,$$slots:{default:[ad]},$$scope:{ctx:n}}}),e.$on("click",i);function s(){return n[6](n[7])}return t=new re({props:{disabled:n[9]==Object.keys(n[1].schemes).length-1,$$slots:{default:[ud]},$$scope:{ctx:n}}}),t.$on("click",s),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(l,a){L(e,l,a),v(l,r,a),L(t,l,a),o=!0},p(l,a){n=l;const u={};a&2&&(u.disabled=n[9]==0),a&1024&&(u.$$scope={dirty:a,ctx:n}),e.$set(u);const c={};a&2&&(c.disabled=n[9]==Object.keys(n[1].schemes).length-1),a&1024&&(c.$$scope={dirty:a,ctx:n}),t.$set(c)},i(l){o||(b(e.$$.fragment,l),b(t.$$.fragment,l),o=!0)},o(l){w(e.$$.fragment,l),w(t.$$.fragment,l),o=!1},d(l){l&&$(r),C(e,l),C(t,l)}}}function ad(n){let e;return{c(){e=G("Move up")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function ud(n){let e;return{c(){e=G("Move down")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function fd(n){let e=Object.keys(n[1].schemes).length>1,r,t,o=e&&so(n);return{c(){o&&o.c(),r=ue()},m(i,s){o&&o.m(i,s),v(i,r,s),t=!0},p(i,s){s&2&&(e=Object.keys(i[1].schemes).length>1),e?o?(o.p(i,s),s&2&&b(o,1)):(o=so(i),o.c(),b(o,1),o.m(r.parentNode,r)):o&&(ne(),w(o,1,1,()=>{o=null}),ie())},i(i){t||(b(o),t=!0)},o(i){w(o),t=!1},d(i){i&&$(r),o&&o.d(i)}}}function lo(n,e){let r,t,o,i,s;return t=new sd({props:{scheme_reference:e[7],$$slots:{default:[fd]},$$scope:{ctx:e}}}),{key:n,first:null,c(){r=ue(),P(t.$$.fragment),o=R(),i=D("hr"),this.first=r},m(l,a){v(l,r,a),L(t,l,a),v(l,o,a),v(l,i,a),s=!0},p(l,a){e=l;const u={};a&2&&(u.scheme_reference=e[7]),a&1026&&(u.$$scope={dirty:a,ctx:e}),t.$set(u)},i(l){s||(b(t.$$.fragment,l),s=!0)},o(l){w(t.$$.fragment,l),s=!1},d(l){l&&($(r),$(o),$(i)),C(t,l)}}}function cd(n){let e,r,t,o,i,s,l,a,u=[],c=new Map,f,d;e=new re({props:{$$slots:{default:[ld]},$$scope:{ctx:n}}}),e.$on("click",n[2]),t=new vo({props:{label:"Add scheme from file",onLoad:n[3]}}),i=new gt({props:{errorMessage:n[0]}});let p=Ye(Object.keys(n[1].schemes));const h=g=>g[7];for(let g=0;g<p.length;g+=1){let y=oo(n,p,g),S=h(y);c.set(S,u[g]=lo(S,y))}return{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment),o=R(),P(i.$$.fragment),s=R(),l=D("hr"),a=R();for(let g=0;g<u.length;g+=1)u[g].c();f=ue()},m(g,y){L(e,g,y),v(g,r,y),L(t,g,y),v(g,o,y),L(i,g,y),v(g,s,y),v(g,l,y),v(g,a,y);for(let S=0;S<u.length;S+=1)u[S]&&u[S].m(g,y);v(g,f,y),d=!0},p(g,[y]){const S={};y&1024&&(S.$$scope={dirty:y,ctx:g}),e.$set(S);const _={};y&1&&(_.errorMessage=g[0]),i.$set(_),y&18&&(p=Ye(Object.keys(g[1].schemes)),ne(),u=wn(u,y,h,1,g,p,c,f.parentNode,kn,lo,f,oo),ie())},i(g){if(!d){b(e.$$.fragment,g),b(t.$$.fragment,g),b(i.$$.fragment,g);for(let y=0;y<p.length;y+=1)b(u[y]);d=!0}},o(g){w(e.$$.fragment,g),w(t.$$.fragment,g),w(i.$$.fragment,g);for(let y=0;y<u.length;y+=1)w(u[y]);d=!1},d(g){g&&($(r),$(o),$(s),$(l),$(a),$(f)),C(e,g),C(t,g),C(i,g);for(let y=0;y<u.length;y+=1)u[y].d(g)}}}function pd(n,e,r){[n[e],n[r]]=[n[r],n[e]]}function dd(n,e){const r={};return n.forEach(t=>{r[t]=e[t]}),r}function hd(n,e,r){let t;q(n,oe,c=>r(1,t=c));function o(){Ro(t),oe.set(t)}let i="";function s(c,f){try{let d=fe.backfill(JSON.parse(f));for(let h of Object.values(d.schemes)){if(h.scheme_reference in t.schemes)throw new Error("The file you're loading seems to contain duplicate data. Are you merging in the same file accidentally?");Te(oe,t.schemes[h.scheme_reference]=h,t)}Te(oe,t.features=t.features.concat(d.features),t);let p=1;t.features.forEach(h=>{h.id=p++}),oe.set(t),r(0,i="")}catch(d){r(0,i=`Couldn't load scheme from a file: ${d}`)}}function l(c,f){const d=JSON.parse(JSON.stringify(Object.keys(t.schemes))),p=d.indexOf(c);if(p+f>=0&&p+f<d.length){pd(d,p,p+f);const h=dd(d,t.schemes);Te(oe,t.schemes=h,t),oe.set(t)}}return[i,t,o,s,l,c=>l(c,-1),c=>l(c,1)]}class md extends j{constructor(e){super(),Q(this,e,hd,cd,K,{})}}function gd(n){let e;return{c(){e=G("Save")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function _d(n){let e;return{c(){e=G("Delete")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function yd(n){let e,r,t,o;return e=new at({props:{$$slots:{default:[gd]},$$scope:{ctx:n}}}),e.$on("click",n[6]),t=new _t({props:{disabled:!n[2],$$slots:{default:[_d]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&512&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&4&&(a.disabled=!i[2]),s&512&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function vd(n){let e,r,t;return{c(){e=D("input"),x(e,"class","govuk-file-upload"),x(e,"id","load-image"),x(e,"type","file")},m(o,i){v(o,e,i),n[7](e),r||(t=ke(e,"change",n[3]),r=!0)},p:W,d(o){o&&$(e),n[7](null),r=!1,t()}}}function ao(n){let e,r,t,o,i,s,l,a;return{c(){e=D("div"),r=D("label"),t=D("input"),o=G(`
      Opacity: `),i=G(n[1]),s=G("%"),x(t,"type","range"),x(t,"min","0"),x(t,"max","100")},m(u,c){v(u,e,c),J(e,r),J(r,t),Mt(t,n[1]),J(r,o),J(r,i),J(r,s),l||(a=[ke(t,"change",n[8]),ke(t,"input",n[8])],l=!0)},p(u,c){c&2&&Mt(t,u[1]),c&2&&ge(i,u[1])},d(u){u&&$(e),l=!1,Mn(a)}}}function $d(n){let e,r,t,o,i,s,l,a,u;e=new He({props:{$$slots:{default:[yd]},$$scope:{ctx:n}}}),t=new co({props:{label:"Load an image",id:"load-image",$$slots:{default:[vd]},$$scope:{ctx:n}}});let c=n[2]&&ao(n);return{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment),o=R(),c&&c.c(),i=R(),s=D("p"),s.textContent=`Note this image isn't saved as part of this scheme. When you close this page,
  it'll be lost.`},m(f,d){L(e,f,d),v(f,r,d),L(t,f,d),v(f,o,d),c&&c.m(f,d),v(f,i,d),v(f,s,d),l=!0,a||(u=ke(window,"keydown",n[5]),a=!0)},p(f,[d]){const p={};d&516&&(p.$$scope={dirty:d,ctx:f}),e.$set(p);const h={};d&513&&(h.$$scope={dirty:d,ctx:f}),t.$set(h),f[2]?c?c.p(f,d):(c=ao(f),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null)},i(f){l||(b(e.$$.fragment,f),b(t.$$.fragment,f),l=!0)},o(f){w(e.$$.fragment,f),w(t.$$.fragment,f),l=!1},d(f){f&&($(r),$(o),$(i),$(s)),C(e,f),C(t,f),c&&c.d(f),a=!1,u()}}}function bd(n,e,r){let t,o;q(n,br,d=>r(1,t=d)),q(n,$r,d=>r(2,o=d));let i;async function s(d){let p=await i.files[0].arrayBuffer(),h=new Blob([new Uint8Array(p)]);Te($r,o=URL.createObjectURL(h),o)}function l(){Te($r,o=null,o),Te(br,t=100,t)}function a(d){d.key=="Escape"&&(d.stopPropagation(),Z.set({mode:"list"}))}const u=()=>Z.set({mode:"list"});function c(d){ce[d?"unshift":"push"](()=>{i=d,r(0,i)})}function f(){t=Hs(this.value),br.set(t)}return[i,t,o,s,l,a,u,c,f]}class wd extends j{constructor(e){super(),Q(this,e,bd,$d,K,{})}}function kd(n){let e;return{c(){e=G("Cancel")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Sd(n){let e,r,t,o;return e=new re({props:{$$slots:{default:[kd]},$$scope:{ctx:n}}}),e.$on("click",n[0]),t=new ts({props:{editingExisting:!1}}),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,[s]){const l={};s&8&&(l.$$scope={dirty:s,ctx:i}),e.$set(l)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function Ed(n,e,r){let t;q(n,Ht,s=>r(1,t=s)),We(()=>{t.start(),t.addEventListenerSuccess(o),t.addEventListenerFailure(i)}),Ae(()=>{t.stop(),t.clearEventListeners()});function o(s){fe.newPointFeature(s),Z.set({mode:"edit-form",id:s.id})}function i(){Z.set({mode:"list"})}return[i]}class Md extends j{constructor(e){super(),Q(this,e,Ed,Sd,K,{})}}function Pd(n){let e;return{c(){e=G("Finish")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Ld(n){let e;return{c(){e=G("Cancel")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Cd(n){let e,r,t,o;return e=new at({props:{$$slots:{default:[Pd]},$$scope:{ctx:n}}}),e.$on("click",n[1]),t=new re({props:{$$slots:{default:[Ld]},$$scope:{ctx:n}}}),t.$on("click",n[0]),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&16&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function Fd(n){let e,r,t,o;return e=new He({props:{$$slots:{default:[Cd]},$$scope:{ctx:n}}}),t=new rs({}),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,[s]){const l={};s&16&&(l.$$scope={dirty:s,ctx:i}),e.$set(l)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function Rd(n,e,r){let t;q(n,Ft,l=>r(2,t=l)),We(()=>{t.startNew(),t.addEventListenerSuccess(o),t.addEventListenerFailure(i)}),Ae(()=>{t.stop(),t.clearEventListeners()});function o(l){fe.newPolygonFeature(l),Z.set({mode:"edit-form",id:l.id})}function i(){Z.set({mode:"list"})}function s(){t.finish()}return[i,s]}class Ad extends j{constructor(e){super(),Q(this,e,Rd,Fd,K,{})}}function Nd(n){let e;return{c(){e=G("Finish")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Od(n){let e;return{c(){e=G("Cancel")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Id(n){let e,r,t,o;return e=new at({props:{$$slots:{default:[Nd]},$$scope:{ctx:n}}}),e.$on("click",n[1]),t=new re({props:{$$slots:{default:[Od]},$$scope:{ctx:n}}}),t.$on("click",n[0]),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&16&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function Bd(n){let e,r,t,o;return e=new He({props:{$$slots:{default:[Id]},$$scope:{ctx:n}}}),t=new os({props:{extendRoute:!0}}),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,[s]){const l={};s&16&&(l.$$scope={dirty:s,ctx:i}),e.$set(l)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function Dd(n,e,r){let t;q(n,et,l=>r(2,t=l)),We(()=>{t.startRoute(),t.addEventListenerSuccess(o),t.addEventListenerFailure(i)}),Ae(()=>{t.stop(),t.clearEventListeners()});function o(l){fe.newLineStringFeature(l),Z.set({mode:"edit-form",id:l.id})}function i(){Z.set({mode:"list"})}function s(){t.finish()}return[i,s]}class Gd extends j{constructor(e){super(),Q(this,e,Dd,Bd,K,{})}}function Td(n){let e,r;return e=new gt({props:{errorMessage:"Failed to load route snapper"}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p:W,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Ud(n){let e,r,t;return{c(){e=D("label"),e.textContent="Route data unpacking",r=R(),t=D("progress"),x(e,"for","route-unpacking"),x(t,"id","route-unpacking"),x(t,"class","svelte-q3473n")},m(o,i){v(o,e,i),v(o,r,i),v(o,t,i)},p:W,i:W,o:W,d(o){o&&($(e),$(r),$(t))}}}function xd(n){let e,r,t;return{c(){e=D("label"),e.textContent="Route tool loading",r=R(),t=D("progress"),x(e,"for","route-loading"),x(t,"id","route-loading"),t.value=n[0],x(t,"class","svelte-q3473n")},m(o,i){v(o,e,i),v(o,r,i),v(o,t,i)},p(o,i){i&1&&(t.value=o[0])},i:W,o:W,d(o){o&&($(e),$(r),$(t))}}}function qd(n){let e,r,t,o;const i=[xd,Ud,Td],s=[];function l(a,u){return!a[1]&&!a[2]&&!a[3]?0:a[3]&&!a[1]&&!a[2]?1:a[2]?2:-1}return~(e=l(n))&&(r=s[e]=i[e](n)),{c(){r&&r.c(),t=ue()},m(a,u){~e&&s[e].m(a,u),v(a,t,u),o=!0},p(a,[u]){let c=e;e=l(a),e===c?~e&&s[e].p(a,u):(r&&(ne(),w(s[c],1,1,()=>{s[c]=null}),ie()),~e?(r=s[e],r?r.p(a,u):(r=s[e]=i[e](a),r.c()),b(r,1),r.m(t.parentNode,t)):r=null)},i(a){o||(b(r),o=!0)},o(a){w(r),o=!1},d(a){a&&$(t),~e&&s[e].d(a)}}}function zd(n,e,r){let t,o;q(n,Ue,u=>r(5,o=u));let{url:i}=e,s=0,l=!1,a=!1;return We(async()=>{await Ko(),console.log(`Grabbing ${i}`);try{const u=await Hc(i,c=>{r(0,s=c)});et.set(new du(o,u,ns,is,In)),r(0,s=100),r(1,l=!0)}catch(u){console.log(`Route tool broke: ${u}`),r(2,a=!0)}}),n.$$set=u=>{"url"in u&&r(4,i=u.url)},n.$$.update=()=>{n.$$.dirty&1&&r(3,t=s>=100)},[s,l,a,t,i]}class Yd extends j{constructor(e){super(),Q(this,e,zd,qd,K,{url:4})}}function Jd(n){let e;return{c(){e=G("Finish")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Xd(n){let e;return{c(){e=G("Cancel")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function Vd(n){let e,r,t,o;return e=new at({props:{$$slots:{default:[Jd]},$$scope:{ctx:n}}}),e.$on("click",n[1]),t=new re({props:{$$slots:{default:[Xd]},$$scope:{ctx:n}}}),t.$on("click",n[0]),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&16&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function Wd(n){let e,r,t,o;return e=new He({props:{$$slots:{default:[Vd]},$$scope:{ctx:n}}}),t=new ss({}),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,[s]){const l={};s&16&&(l.$$scope={dirty:s,ctx:i}),e.$set(l)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function Hd(n,e,r){let t;q(n,et,l=>r(2,t=l)),We(()=>{t.startArea(),t.addEventListenerSuccess(o),t.addEventListenerFailure(i)}),Ae(()=>{t.stop(),t.clearEventListeners()});function o(l){fe.newPolygonFeature(l),Z.set({mode:"edit-form",id:l.id})}function i(){Z.set({mode:"list"})}function s(){t.finish()}return[i,s]}class Zd extends j{constructor(e){super(),Q(this,e,Hd,Wd,K,{})}}function uo(n){let e,r;return e=new Yd({props:{url:n[0]}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&1&&(i.url=t[0]),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function Kd(n){let e,r,t,o;return t=new Qc({}),{c(){e=D("h2"),e.textContent="StreetView",r=R(),P(t.$$.fragment)},m(i,s){v(i,e,s),v(i,r,s),L(t,i,s),o=!0},p:W,i(i){o||(b(t.$$.fragment,i),o=!0)},o(i){w(t.$$.fragment,i),o=!1},d(i){i&&($(e),$(r)),C(t,i)}}}function jd(n){let e,r,t,o;return t=new wd({}),{c(){e=D("h2"),e.textContent="Georeference image",r=R(),P(t.$$.fragment)},m(i,s){v(i,e,s),v(i,r,s),L(t,i,s),o=!0},p:W,i(i){o||(b(t.$$.fragment,i),o=!0)},o(i){w(t.$$.fragment,i),o=!1},d(i){i&&($(e),$(r)),C(t,i)}}}function Qd(n){let e,r,t,o,i,s;return t=new at({props:{$$slots:{default:[lh]},$$scope:{ctx:n}}}),t.$on("click",n[5]),{c(){e=D("h2"),e.textContent="Split route",r=R(),P(t.$$.fragment),o=R(),i=D("ul"),i.innerHTML=`<li><b>Click</b>
      on a route to split it</li> <li><b>Click</b>
      on the map or press
      <b>Escape</b>
      to cancel</li>`},m(l,a){v(l,e,a),v(l,r,a),L(t,l,a),v(l,o,a),v(l,i,a),s=!0},p(l,a){const u={};a&128&&(u.$$scope={dirty:a,ctx:l}),t.$set(u)},i(l){s||(b(t.$$.fragment,l),s=!0)},o(l){w(t.$$.fragment,l),s=!1},d(l){l&&($(e),$(r),$(o),$(i)),C(t,l)}}}function eh(n){let e,r,t,o;return t=new Zd({}),{c(){e=D("h2"),e.textContent="New polygon (snapped)",r=R(),P(t.$$.fragment)},m(i,s){v(i,e,s),v(i,r,s),L(t,i,s),o=!0},p:W,i(i){o||(b(t.$$.fragment,i),o=!0)},o(i){w(t.$$.fragment,i),o=!1},d(i){i&&($(e),$(r)),C(t,i)}}}function th(n){let e,r,t,o;return t=new Ad({}),{c(){e=D("h2"),e.textContent="New polygon (freehand)",r=R(),P(t.$$.fragment)},m(i,s){v(i,e,s),v(i,r,s),L(t,i,s),o=!0},p:W,i(i){o||(b(t.$$.fragment,i),o=!0)},o(i){w(t.$$.fragment,i),o=!1},d(i){i&&($(e),$(r)),C(t,i)}}}function rh(n){let e,r,t,o;return t=new Gd({}),{c(){e=D("h2"),e.textContent="New route",r=R(),P(t.$$.fragment)},m(i,s){v(i,e,s),v(i,r,s),L(t,i,s),o=!0},p:W,i(i){o||(b(t.$$.fragment,i),o=!0)},o(i){w(t.$$.fragment,i),o=!1},d(i){i&&($(e),$(r)),C(t,i)}}}function nh(n){let e,r,t,o;return t=new Md({}),{c(){e=D("h2"),e.textContent="New point",r=R(),P(t.$$.fragment)},m(i,s){v(i,e,s),v(i,r,s),L(t,i,s),o=!0},p:W,i(i){o||(b(t.$$.fragment,i),o=!0)},o(i){w(t.$$.fragment,i),o=!1},d(i){i&&($(e),$(r)),C(t,i)}}}function ih(n){let e,r;return e=new af({props:{id:n[2].id}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&4&&(i.id=t[2].id),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function oh(n){let e,r;return e=new Wp({props:{id:n[2].id}}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p(t,o){const i={};o&4&&(i.id=t[2].id),e.$set(i)},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function sh(n){let e,r;return e=new md({}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},p:W,i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function lh(n){let e;return{c(){e=G("Finish")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function ah(n){let e,r,t,o,i,s,l=n[1]&&uo(n);const a=[sh,oh,ih,nh,rh,th,eh,Qd,jd,Kd],u=[];function c(f,d){return f[2].mode=="list"?0:f[2].mode=="edit-form"?1:f[2].mode=="edit-geometry"?2:f[2].mode=="new-point"?3:f[2].mode=="new-route"?4:f[2].mode=="new-freehand-polygon"?5:f[2].mode=="new-snapped-polygon"?6:f[2].mode=="split-route"?7:f[2].mode=="set-image"?8:f[2].mode=="streetview"?9:-1}return~(t=c(n))&&(o=u[t]=a[t](n)),{c(){e=D("div"),l&&l.c(),r=R(),o&&o.c(),i=ue(),ye(e,"visibility",n[2].mode=="list"?"visible":"hidden")},m(f,d){v(f,e,d),l&&l.m(e,null),v(f,r,d),~t&&u[t].m(f,d),v(f,i,d),s=!0},p(f,[d]){f[1]?l?(l.p(f,d),d&2&&b(l,1)):(l=uo(f),l.c(),b(l,1),l.m(e,null)):l&&(ne(),w(l,1,1,()=>{l=null}),ie()),d&4&&ye(e,"visibility",f[2].mode=="list"?"visible":"hidden");let p=t;t=c(f),t===p?~t&&u[t].p(f,d):(o&&(ne(),w(u[p],1,1,()=>{u[p]=null}),ie()),~t?(o=u[t],o?o.p(f,d):(o=u[t]=a[t](f),o.c()),b(o,1),o.m(i.parentNode,i)):o=null)},i(f){s||(b(l),b(o),s=!0)},o(f){w(l),w(o),s=!1},d(f){f&&($(e),$(r),$(i)),l&&l.d(),~t&&u[t].d(f)}}}function uh(n,e,r){let t,o,i,s,l;q(n,et,c=>r(6,t=c)),q(n,Ft,c=>r(3,o=c)),q(n,Ht,c=>r(4,i=c)),q(n,Ue,c=>r(1,s=c)),q(n,Z,c=>r(2,l=c));let{routeSnapperUrl:a}=e;Ae(()=>{i==null||i.tearDown(),o==null||o.tearDown(),t==null||t.tearDown()});const u=()=>Z.set({mode:"list"});return n.$$set=c=>{"routeSnapperUrl"in c&&r(0,a=c.routeSnapperUrl)},n.$$.update=()=>{n.$$.dirty&18&&s&&!i&&Ht.set(new ma(s)),n.$$.dirty&10&&s&&!o&&Ft.set(new Xa(s))},[a,s,l,o,i,u]}class fh extends j{constructor(e){super(),Q(this,e,uh,ah,K,{routeSnapperUrl:0})}}function fo(n){let e,r,t,o,i,s,l,a,u,c,f,d,p,h,g,y,S;return d=new sl({props:{boundaryGeojson:n[2]}}),h=new He({props:{$$slots:{default:[dh]},$$scope:{ctx:n}}}),y=new Ks({}),{c(){e=D("h2"),e.textContent="ATIP Scheme Sketcher",r=R(),t=D("p"),t.textContent=`App version: ${js()}`,o=R(),i=D("div"),s=D("p"),s.textContent=`${n[10]()}`,l=R(),a=D("a"),u=G("Change area"),f=R(),P(d.$$.fragment),p=R(),P(h.$$.fragment),g=R(),P(y.$$.fragment),x(e,"class","svelte-1750ds5"),x(t,"class","svelte-1750ds5"),x(s,"class","svelte-1750ds5"),x(a,"href",c=`index.html?schema=${n[4]}`),x(a,"class","svelte-1750ds5"),ye(i,"display","flex"),ye(i,"justify-content","space-between"),x(i,"class","svelte-1750ds5")},m(_,m){v(_,e,m),v(_,r,m),v(_,t,m),v(_,o,m),v(_,i,m),J(i,s),J(i,l),J(i,a),J(a,u),J(i,f),L(d,i,null),v(_,p,m),L(h,_,m),v(_,g,m),L(y,_,m),S=!0},p(_,m){(!S||m&16&&c!==(c=`index.html?schema=${_[4]}`))&&x(a,"href",c);const M={};m&4&&(M.boundaryGeojson=_[2]),d.$set(M);const E={};m&32768&&(E.$$scope={dirty:m,ctx:_}),h.$set(E)},i(_){S||(b(d.$$.fragment,_),b(h.$$.fragment,_),b(y.$$.fragment,_),S=!0)},o(_){w(d.$$.fragment,_),w(h.$$.fragment,_),w(y.$$.fragment,_),S=!1},d(_){_&&($(e),$(r),$(t),$(o),$(i),$(p),$(g)),C(d),C(h,_),C(y,_)}}}function ch(n){let e;return{c(){e=G("About")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function ph(n){let e;return{c(){e=G("Instructions")},m(r,t){v(r,e,t)},d(r){r&&$(e)}}}function dh(n){let e,r,t,o;return e=new re({props:{$$slots:{default:[ch]},$$scope:{ctx:n}}}),e.$on("click",n[8]),t=new re({props:{$$slots:{default:[ph]},$$scope:{ctx:n}}}),t.$on("click",n[9]),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment)},m(i,s){L(e,i,s),v(i,r,s),L(t,i,s),o=!0},p(i,s){const l={};s&32768&&(l.$$scope={dirty:s,ctx:i}),e.$set(l);const a={};s&32768&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){o||(b(e.$$.fragment,i),b(t.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(t.$$.fragment,i),o=!1},d(i){i&&$(r),C(e,i),C(t,i)}}}function hh(n){let e,r;return e=new Lc({}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function mh(n){let e,r;return e=new mp({}),{c(){P(e.$$.fragment)},m(t,o){L(e,t,o),r=!0},i(t){r||(b(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function gh(n){let e,r,t,o,i,s,l,a,u,c,f,d,p,h,g;e=new ll({props:{position:"top-right"}}),t=new wu({props:{boundaryGeojson:n[2]}}),i=new Cf({}),l=new hf({});const y=[mh,hh],S=[];function _(m,M){return m[3].mode=="list"?0:m[3].mode=="split-route"?1:-1}return~(u=_(n))&&(c=S[u]=y[u](n)),d=new Tf({}),h=new Nf({}),{c(){P(e.$$.fragment),r=R(),P(t.$$.fragment),o=R(),P(i.$$.fragment),s=R(),P(l.$$.fragment),a=R(),c&&c.c(),f=R(),P(d.$$.fragment),p=R(),P(h.$$.fragment)},m(m,M){L(e,m,M),v(m,r,M),L(t,m,M),v(m,o,M),L(i,m,M),v(m,s,M),L(l,m,M),v(m,a,M),~u&&S[u].m(m,M),v(m,f,M),L(d,m,M),v(m,p,M),L(h,m,M),g=!0},p(m,M){const E={};M&4&&(E.boundaryGeojson=m[2]),t.$set(E);let k=u;u=_(m),u!==k&&(c&&(ne(),w(S[k],1,1,()=>{S[k]=null}),ie()),~u?(c=S[u],c||(c=S[u]=y[u](m),c.c()),b(c,1),c.m(f.parentNode,f)):c=null)},i(m){g||(b(e.$$.fragment,m),b(t.$$.fragment,m),b(i.$$.fragment,m),b(l.$$.fragment,m),b(c),b(d.$$.fragment,m),b(h.$$.fragment,m),g=!0)},o(m){w(e.$$.fragment,m),w(t.$$.fragment,m),w(i.$$.fragment,m),w(l.$$.fragment,m),w(c),w(d.$$.fragment,m),w(h.$$.fragment,m),g=!1},d(m){m&&($(r),$(o),$(s),$(a),$(f),$(p)),C(e,m),C(t,m),C(i,m),C(l,m),~u&&S[u].d(m),C(d,m),C(h,m)}}}function _h(n){let e,r,t,o,i,s,l,a,u,c,f,d,p,h,g,y,S=n[3].mode=="list"&&fo(n);o=new Dp({props:{authorityName:n[6]}}),s=new fh({props:{routeSnapperUrl:n[7]}}),u=new Zs({props:{style:n[5],$$slots:{default:[gh]},$$scope:{ctx:n}}});function _(k){n[11](k)}let m={};n[0]!==void 0&&(m.open=n[0]),f=new al({props:m}),ce.push(()=>de(f,"open",_));function M(k){n[12](k)}let E={};return n[1]!==void 0&&(E.open=n[1]),h=new xp({props:E}),ce.push(()=>de(h,"open",M)),{c(){e=D("div"),r=D("div"),S&&S.c(),t=R(),P(o.$$.fragment),i=R(),P(s.$$.fragment),l=R(),a=D("div"),P(u.$$.fragment),c=R(),P(f.$$.fragment),p=R(),P(h.$$.fragment),x(r,"class","sidebar govuk-prose svelte-1750ds5"),x(a,"class","main svelte-1750ds5"),x(e,"class","overall-layout svelte-1750ds5")},m(k,A){v(k,e,A),J(e,r),S&&S.m(r,null),J(r,t),L(o,r,null),J(r,i),L(s,r,null),J(e,l),J(e,a),L(u,a,null),v(k,c,A),L(f,k,A),v(k,p,A),L(h,k,A),y=!0},p(k,[A]){k[3].mode=="list"?S?(S.p(k,A),A&8&&b(S,1)):(S=fo(k),S.c(),b(S,1),S.m(r,t)):S&&(ne(),w(S,1,1,()=>{S=null}),ie());const B={};A&32&&(B.style=k[5]),A&32780&&(B.$$scope={dirty:A,ctx:k}),u.$set(B);const T={};!d&&A&1&&(d=!0,T.open=k[0],_e(()=>d=!1)),f.$set(T);const z={};!g&&A&2&&(g=!0,z.open=k[1],_e(()=>g=!1)),h.$set(z)},i(k){y||(b(S),b(o.$$.fragment,k),b(s.$$.fragment,k),b(u.$$.fragment,k),b(f.$$.fragment,k),b(h.$$.fragment,k),y=!0)},o(k){w(S),w(o.$$.fragment,k),w(s.$$.fragment,k),w(u.$$.fragment,k),w(f.$$.fragment,k),w(h.$$.fragment,k),y=!1},d(k){k&&($(e),$(c),$(p)),S&&S.d(),C(o),C(s),C(u),C(f,k),C(h,k)}}}function yh(n,e,r){let t,o,i;q(n,Z,_=>r(3,t=_)),q(n,Dr,_=>r(4,o=_)),q(n,Yn,_=>r(5,i=_));let s=!1,l=!1,a=new URLSearchParams(window.location.search),u=a.get("authority");Yn.set(a.get("style")||"streets");let c=`https://atip.uk/route-snappers/v2.6/${u}.bin.gz`;function f(){r(0,s=!s),r(1,l=!1)}function d(){r(1,l=!l),r(0,s=!1)}let p;We(async()=>{Qs(),r(2,p=await h())});async function h(){let _=await el();return _.features=_.features.filter(m=>m.properties.full_name==u),_.features.length===0&&(window.location.href=`index.html?error=Authority name not found: ${u}`),_}function g(){let _=u.split("_");if(_.length==2){if(_[0]=="LAD")return`${_[1]} (LAD)`;if(_[0]=="TA")return`${_[1]} (Transport Authority)`}return u}function y(_){s=_,r(0,s)}function S(_){l=_,r(1,l)}return[s,l,p,t,o,i,u,c,f,d,g,y,S]}class vh extends j{constructor(e){super(),Q(this,e,yh,_h,K,{})}}document.body.className+=" js-enabled"+("noModule"in HTMLScriptElement.prototype?" govuk-frontend-supported":"");new vh({target:document.getElementById("app")});
