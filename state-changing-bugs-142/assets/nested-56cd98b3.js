var io=Object.defineProperty;var oo=(r,e,t)=>e in r?io(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ae=(r,e,t)=>(oo(r,typeof e!="symbol"?e+"":e,t),t);import{x as G,s as X,y as Ne,S as V,i as K,M as ki,b as le,a as ve,d as I,m as B,k as we,n as C,o as L,q as N,e as E,c as A,g as w,p as k,f as O,z as ce,B as pe,C as so,D as Yt,E as tn,F as Qe,G as _t,H as gt,I as bt,J as yt,K as vr,h as S,l as U,L as lo,N as ao,O as oe,P as uo,w as sr,Q as et,R as Me,T as Mn,U as cn,V as fe,t as Y,W as Le,X as pn,Y as wt,Z as ye,_ as st,$ as Ke,a0 as Cn,j as Re,r as Te,a1 as Si,a2 as kt,a3 as dn,a4 as wr,a5 as fo,a6 as co,a7 as Ie,a8 as po,a9 as ho,aa as mo,ab as $n,ac as Ct,ad as Ln,ae as On,af as qn,ag as _o,ah as vt,ai as lr,aj as We,ak as St,al as go,am as ar,an as bo,ao as yo,ap as vo,aq as kr,ar as hn,as as wo,at as ko,au as So,A as Eo,u as Mo}from"./authorities-f581b3c6.js";const lt=[];function tt(r,e=G){let t;const n=new Set;function i(a){if(X(r,a)&&(r=a,t)){const l=!lt.length;for(const u of n)u[1](),lt.push(u,r);if(l){for(let u=0;u<lt.length;u+=2)lt[u][0](lt[u+1]);lt.length=0}}}function o(a){i(a(r))}function s(a,l=G){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||G),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Pe=tt(null),mn=tt(null),ie=tt(Ne()),$e=tt(null),je=tt(null),qt=tt(null),Gt=tt(null),Gn=tt("edit-attribute");function Xt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Sr(r){console.log(`Deleting intervention ${r}`),ie.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),$e.set(null),je.set(null),qt.set(null),Gt.set(null)}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ei=Symbol("Comlink.proxy"),Co=Symbol("Comlink.endpoint"),$o=Symbol("Comlink.releaseProxy"),Pn=Symbol("Comlink.finalizer"),nn=Symbol("Comlink.thrown"),Mi=r=>typeof r=="object"&&r!==null||typeof r=="function",Lo={canHandle:r=>Mi(r)&&r[Ei],serialize(r){const{port1:e,port2:t}=new MessageChannel;return ur(r,e),[t,[t]]},deserialize(r){return r.start(),Li(r)}},Oo={canHandle:r=>Mi(r)&&nn in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},Ci=new Map([["proxy",Lo],["throw",Oo]]);function Ao(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function ur(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!Ao(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(nt);let u;try{const p=a.slice(0,-1).reduce((f,c)=>f[c],r),d=a.reduce((f,c)=>f[c],r);switch(s){case"GET":u=d;break;case"SET":p[a.slice(-1)[0]]=nt(i.data.value),u=!0;break;case"APPLY":u=d.apply(p,l);break;case"CONSTRUCT":{const f=new d(...l);u=Bo(f)}break;case"ENDPOINT":{const{port1:f,port2:c}=new MessageChannel;ur(r,c),u=Io(f,[f])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[nn]:0}}Promise.resolve(u).catch(p=>({value:p,[nn]:0})).then(p=>{const[d,f]=bn(p);e.postMessage(Object.assign(Object.assign({},d),{id:o}),f),s==="RELEASE"&&(e.removeEventListener("message",n),$i(e),Pn in r&&typeof r[Pn]=="function"&&r[Pn]())}).catch(p=>{const[d,f]=bn({value:new TypeError("Unserializable return value"),[nn]:0});e.postMessage(Object.assign(Object.assign({},d),{id:o}),f)})}),e.start&&e.start()}function To(r){return r.constructor.name==="MessagePort"}function $i(r){To(r)&&r.close()}function Li(r,e){return Hn(r,[],e)}function Zt(r){if(r)throw new Error("Proxy has been released and is not useable")}function Oi(r){return dt(r,{type:"RELEASE"}).then(()=>{$i(r)})}const _n=new WeakMap,gn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(_n.get(r)||0)-1;_n.set(r,e),e===0&&Oi(r)});function Ro(r,e){const t=(_n.get(e)||0)+1;_n.set(e,t),gn&&gn.register(r,e,r)}function Po(r){gn&&gn.unregister(r)}function Hn(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(Zt(n),s===$o)return()=>{Po(i),Oi(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=dt(r,{type:"GET",path:e.map(l=>l.toString())}).then(nt);return a.then.bind(a)}return Hn(r,[...e,s])},set(o,s,a){Zt(n);const[l,u]=bn(a);return dt(r,{type:"SET",path:[...e,s].map(p=>p.toString()),value:l},u).then(nt)},apply(o,s,a){Zt(n);const l=e[e.length-1];if(l===Co)return dt(r,{type:"ENDPOINT"}).then(nt);if(l==="bind")return Hn(r,e.slice(0,-1));const[u,p]=Er(a);return dt(r,{type:"APPLY",path:e.map(d=>d.toString()),argumentList:u},p).then(nt)},construct(o,s){Zt(n);const[a,l]=Er(s);return dt(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(nt)}});return Ro(i,r),i}function Fo(r){return Array.prototype.concat.apply([],r)}function Er(r){const e=r.map(bn);return[e.map(t=>t[0]),Fo(e.map(t=>t[1]))]}const Ai=new WeakMap;function Io(r,e){return Ai.set(r,e),r}function Bo(r){return Object.assign(r,{[Ei]:!0})}function bn(r){for(const[e,t]of Ci)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},Ai.get(r)||[]]}function nt(r){switch(r.type){case"HANDLER":return Ci.get(r.name).deserialize(r.value);case"RAW":return r.value}}function dt(r,e,t){return new Promise(n=>{const i=No();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function No(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function xo(){return new Worker("/atip/state-changing-bugs-142/assets/worker-84d6db03.js")}let te;const Ti=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Ti.decode();let Tt=null;function Bt(){return(Tt===null||Tt.byteLength===0)&&(Tt=new Uint8Array(te.memory.buffer)),Tt}function rt(r,e){return r=r>>>0,Ti.decode(Bt().subarray(r,r+e))}const Ge=new Array(128).fill(void 0);Ge.push(void 0,null,!0,!1);let Nt=Ge.length;function be(r){Nt===Ge.length&&Ge.push(Ge.length+1);const e=Nt;return Nt=Ge[e],Ge[e]=r,e}function J(r){return Ge[r]}let ot=0;const rn=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Do=typeof rn.encodeInto=="function"?function(r,e){return rn.encodeInto(r,e)}:function(r,e){const t=rn.encode(r);return e.set(t),{read:r.length,written:t.length}};function Fn(r,e,t){if(t===void 0){const a=rn.encode(r),l=e(a.length)>>>0;return Bt().subarray(l,l+a.length).set(a),ot=a.length,l}let n=r.length,i=e(n)>>>0;const o=Bt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3)>>>0;const a=Bt().subarray(i+s,i+n),l=Do(r,a);s+=l.written}return ot=s,i}function $t(r){return r==null}let Rt=null;function he(){return(Rt===null||Rt.byteLength===0)&&(Rt=new Int32Array(te.memory.buffer)),Rt}function jo(r){r<132||(Ge[r]=Nt,Nt=r)}function Pt(r){const e=J(r);return jo(r),e}let Ft=null;function Uo(){return(Ft===null||Ft.byteLength===0)&&(Ft=new Float64Array(te.memory.buffer)),Ft}let It=null;function qo(){return(It===null||It.byteLength===0)&&(It=new BigInt64Array(te.memory.buffer)),It}function zn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=zn(r[0]));for(let s=1;s<i;s++)o+=", "+zn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Go(r,e){const t=e(r.length*1)>>>0;return Bt().set(r,t/1),ot=r.length,t}function In(r,e){try{return r.apply(this,e)}catch(t){te.__wbindgen_exn_store(be(t))}}let Jn=class{static __wrap(e){e=e>>>0;const t=Object.create(Jn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();te.__wbg_routeinfo_free(e)}constructor(e){try{const o=te.__wbindgen_add_to_stack_pointer(-16),s=Go(e,te.__wbindgen_malloc),a=ot;te.routeinfo_new(o,s,a);var t=he()[o/4+0],n=he()[o/4+1],i=he()[o/4+2];if(i)throw Pt(n);return Jn.__wrap(t)}finally{te.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const p=te.__wbindgen_add_to_stack_pointer(-16);te.routeinfo_nameForRoute(p,this.__wbg_ptr,be(e));var i=he()[p/4+0],o=he()[p/4+1],s=he()[p/4+2],a=he()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,Pt(s);return t=l,n=u,rt(l,u)}finally{te.__wbindgen_add_to_stack_pointer(16),te.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const p=te.__wbindgen_add_to_stack_pointer(-16);te.routeinfo_speedLimitForRoute(p,this.__wbg_ptr,be(e));var i=he()[p/4+0],o=he()[p/4+1],s=he()[p/4+2],a=he()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,Pt(s);return t=l,n=u,rt(l,u)}finally{te.__wbindgen_add_to_stack_pointer(16),te.__wbindgen_free(t,n)}}allSpeedLimits(){let e,t;try{const u=te.__wbindgen_add_to_stack_pointer(-16);te.routeinfo_allSpeedLimits(u,this.__wbg_ptr);var n=he()[u/4+0],i=he()[u/4+1],o=he()[u/4+2],s=he()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,Pt(o);return e=a,t=l,rt(a,l)}finally{te.__wbindgen_add_to_stack_pointer(16),te.__wbindgen_free(e,t)}}};async function Ho(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function zo(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=rt(e,t);return be(n)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(rt(e,t));return be(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=J(t),i=typeof n=="string"?n:void 0;var o=$t(i)?0:Fn(i,te.__wbindgen_malloc,te.__wbindgen_realloc),s=ot;he()[e/4+1]=s,he()[e/4+0]=o},r.wbg.__wbindgen_object_drop_ref=function(e){Pt(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=J(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof J(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return be(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return J(e)===J(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=J(t),i=typeof n=="number"?n:void 0;Uo()[e/8+1]=$t(i)?0:i,he()[e/4+0]=!$t(i)},r.wbg.__wbindgen_is_object=function(e){const t=J(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return J(e)in J(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return be(t)},r.wbg.__wbindgen_is_undefined=function(e){return J(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return J(e)==J(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=J(e);return be(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=J(e)[J(t)];return be(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return be(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=J(t).stack,i=Fn(n,te.__wbindgen_malloc,te.__wbindgen_realloc),o=ot;he()[e/4+1]=o,he()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(rt(e,t))}finally{te.__wbindgen_free(n,i)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(J(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(J(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(J(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(J(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(J(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=J(e)[t>>>0];return be(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return J(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof J(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=J(e).next;return be(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return In(function(e){const t=J(e).next();return be(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return J(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=J(e).value;return be(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return be(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return In(function(e,t){const n=Reflect.get(J(e),J(t));return be(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return In(function(e,t){const n=J(e).call(J(t));return be(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(J(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=J(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(J(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(J(e));return be(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=J(e).buffer;return be(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(J(e));return be(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){J(e).set(J(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return J(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=J(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=J(t),i=typeof n=="bigint"?n:void 0;qo()[e/8+1]=$t(i)?BigInt(0):i,he()[e/4+0]=!$t(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=zn(J(t)),i=Fn(n,te.__wbindgen_malloc,te.__wbindgen_realloc),o=ot;he()[e/4+1]=o,he()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(rt(e,t))},r.wbg.__wbindgen_memory=function(){const e=te.memory;return be(e)},r}function Jo(r,e){return te=r.exports,Ri.__wbindgen_wasm_module=e,It=null,Ft=null,Rt=null,Tt=null,te}async function Ri(r){if(te!==void 0)return te;typeof r>"u"&&(r="/atip/state-changing-bugs-142/assets/route_info_bg.wasm");const e=zo();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Ho(await r,e);return Jo(t,n)}class Yo{constructor(){ae(this,"inner");this.inner=null}async loadFile(e){await Ri(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new Jn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.speedLimitForRoute(e)}allSpeedLimits(){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.allSpeedLimits()}}ur(Yo);function Xo(r){let e,t,n,i,o,s,a,l,u,p,d,f,c;return{c(){e=E("p"),e.textContent="For each intervention:",t=A(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=A(),o=E("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=A(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=A(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=A(),d=E("p"),d.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,f=A(),c=E("p"),c.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(h,g){w(h,e,g),w(h,t,g),w(h,n,g),w(h,i,g),w(h,o,g),w(h,s,g),w(h,a,g),w(h,l,g),w(h,u,g),w(h,p,g),w(h,d,g),w(h,f,g),w(h,c,g)},p:G,d(h){h&&k(e),h&&k(t),h&&k(n),h&&k(i),h&&k(o),h&&k(s),h&&k(a),h&&k(l),h&&k(u),h&&k(p),h&&k(d),h&&k(f),h&&k(c)}}}function Wo(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Xo]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new ki({props:o}),le.push(()=>ve(e,"open",i,r[0])),{c(){I(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],we(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function Vo(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Ko extends V{constructor(e){super(),K(this,e,Vo,Wo,X,{open:0})}}function Mr(r){let e;const t=r[4].default,n=_t(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&gt(n,t,i,i[3],e?yt(t,i[3],o,null):bt(i[3]),null)},i(i){e||(C(n,i),e=!0)},o(i){L(n,i),e=!1},d(i){n&&n.d(i)}}}function Zo(r){let e,t,n=r[1]&&Mr(r);return{c(){e=E("div"),n&&n.c(),O(e,"class","map svelte-12dpf1u")},m(i,o){w(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&C(n,1)):(n=Mr(i),n.c(),C(n,1),n.m(e,null)):n&&(ce(),L(n,1,1,()=>{n=null}),pe())},i(i){t||(C(n),t=!0)},o(i){L(n),t=!1},d(i){i&&k(e),n&&n.d(),r[5](null)}}}function Qo(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;so("setCamera",!window.location.hash),Yt(()=>{s=new tn.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new tn.ScaleControl({})),s.addControl(new tn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Pe.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),Qe(()=>{s.remove()});function u(p){le[p?"unshift":"push"](()=>{a=p,t(0,a)})}return r.$$set=p=>{"style"in p&&t(2,o=p.style),"$$scope"in p&&t(3,i=p.$$scope)},[a,l,o,i,n,u]}class es extends V{constructor(e){super(),K(this,e,Qo,Zo,X,{style:2})}}const ts=r=>({}),Cr=r=>({}),ns=r=>({}),$r=r=>({}),rs=r=>({}),Lr=r=>({});function is(r){let e,t,n,i,o,s,a,l,u,p,d,f;const c=r[3].nav,h=_t(c,r,r[2],Lr),g=r[3].sidebar,m=_t(g,r,r[2],$r),y=r[3].main,_=_t(y,r,r[2],Cr);return{c(){e=E("aside"),t=E("div"),n=E("nav"),h&&h.c(),i=A(),m&&m.c(),o=A(),s=E("button"),s.textContent="→",l=A(),u=E("main"),_&&_.c(),O(n,"class","svelte-1u7vg8a"),O(t,"class","sidebar-content content-container svelte-1u7vg8a"),O(s,"type","button"),O(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),O(e,"class",a=vr(r[0]?"":"collapsed")+" svelte-1u7vg8a"),O(u,"class","svelte-1u7vg8a")},m(b,v){w(b,e,v),S(e,t),S(t,n),h&&h.m(n,null),S(t,i),m&&m.m(t,null),S(e,o),S(e,s),w(b,l,v),w(b,u,v),_&&_.m(u,null),p=!0,d||(f=U(s,"click",r[1]),d=!0)},p(b,[v]){h&&h.p&&(!p||v&4)&&gt(h,c,b,b[2],p?yt(c,b[2],v,rs):bt(b[2]),Lr),m&&m.p&&(!p||v&4)&&gt(m,g,b,b[2],p?yt(g,b[2],v,ns):bt(b[2]),$r),(!p||v&1&&a!==(a=vr(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&O(e,"class",a),_&&_.p&&(!p||v&4)&&gt(_,y,b,b[2],p?yt(y,b[2],v,ts):bt(b[2]),Cr)},i(b){p||(C(h,b),C(m,b),C(_,b),p=!0)},o(b){L(h,b),L(m,b),L(_,b),p=!1},d(b){b&&k(e),h&&h.d(b),m&&m.d(b),b&&k(l),b&&k(u),_&&_.d(b),d=!1,f()}}}function os(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class ss extends V{constructor(e){super(),K(this,e,os,is,X,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function ls(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ze=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function as(r,e){return r>e?1:r<e?-1:0}function ze(r,e,t){for(var n=new Ze(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Bn(r,e,t,n){var i=new Ze(r,e);if(t===null)return i.left=i.right=null,i;t=ze(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Or(r,e,t){var n=null,i=null;if(e){e=ze(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function us(r,e,t){return e===null?r:(r===null||(e=ze(r.key,e,t),e.left=r),e)}function Yn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Yn(r.left,o,!1,n,i),r.right&&Yn(r.right,o,!0,n,i)}}var fr=function(){function r(e){e===void 0&&(e=as),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Bn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ze(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=ze(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=ze(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=ze(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ze(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ze(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return cs(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Vn(e,t,0,i-1,o),this._root===null)this._root=Xn(e,t,0,i),this._size=i;else{var s=ps(this.toList(),fs(e,t),o);i=this._size+i,this._root=Wn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Yn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Or(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=Bn(t,n,a,i):s=Bn(t,n,s,i),this._root=us(s,a,i)},r.prototype.split=function(e){return Or(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return ls(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Xn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ze(s,a);return l.left=Xn(r,e,t,o),l.right=Xn(r,e,o+1,n),l}return null}function fs(r,e){for(var t=new Ze(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ze(r[i],e[i]);return n.next=null,t.next}function cs(r){for(var e=r,t=[],n=!1,i=new Ze(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Wn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Wn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Wn(r,i+1,t),s}return null}function ps(r,e,t){for(var n=new Ze(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Vn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Vn(r,e,t,a,i),Vn(r,e,a+1,n,i)}}function Fe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Ar(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Oe(r,e,t){return e&&Ar(r.prototype,e),t&&Ar(r,t),r}var Lt=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Kn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Ye=Number.EPSILON;Ye===void 0&&(Ye=Math.pow(2,-52));var ds=Ye*Ye,Zn=function(e,t){if(-Ye<e&&e<Ye&&-Ye<t&&t<Ye)return 0;var n=e-t;return n*n<ds*e*t?0:e<t?-1:1},hs=function(){function r(){Fe(this,r),this.reset()}return Oe(r,[{key:"reset",value:function(){this.xRounder=new Tr,this.yRounder=new Tr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Tr=function(){function r(){Fe(this,r),this.tree=new fr,this.round(0)}return Oe(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Zn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Zn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Ht=new hs,xt=function(e,t){return e.x*t.y-e.y*t.x},Pi=function(e,t){return e.x*t.x+e.y*t.y},Rr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=xt(i,o);return Zn(s,0)},yn=function(e){return Math.sqrt(Pi(e,e))},ms=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return xt(o,i)/yn(o)/yn(i)},_s=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Pi(o,i)/yn(o)/yn(i)},Pr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Fr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},gs=function(e,t,n,i){if(t.x===0)return Fr(n,i,e.x);if(i.x===0)return Fr(e,t,n.x);if(t.y===0)return Pr(n,i,e.y);if(i.y===0)return Pr(e,t,n.y);var o=xt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=xt(s,t)/o,l=xt(s,i)/o,u=e.x+l*t.x,p=n.x+a*i.x,d=e.y+l*t.y,f=n.y+a*i.y,c=(u+p)/2,h=(d+f)/2;return{x:c,y:h}},De=function(){Oe(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:vn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Fe(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Oe(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:ms(n.point,t.point,l.point),cosine:_s(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,p=l.cosine,d=i.get(a),f=d.sine,c=d.cosine;return u>=0&&f>=0?p<c?1:p>c?-1:0:u<0&&f<0?p<c?-1:p>c?1:0:f<u?-1:f>u?1:0}}}]),r}(),bs=0,vn=function(){Oe(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,d=n.rightSE.point.y;if(i<o){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var f=t.comparePoint(n.leftSE.point);if(f<0)return 1;if(f>0)return-1;var c=n.comparePoint(t.rightSE.point);return c!==0?c:-1}if(i>o){if(l<u&&l<d)return-1;if(l>u&&l>d)return 1;var h=n.comparePoint(t.leftSE.point);if(h!==0)return h;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var m=n.comparePoint(t.rightSE.point);if(m!==0)return m}if(s>a){var y=t.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(s!==a){var _=p-l,b=s-i,v=d-u,M=a-o;if(_>b&&v<M)return 1;if(_<b&&v>M)return-1}return s>a?1:s<a||p<d?-1:p>d?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Fe(this,r),this.id=++bs,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Oe(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Kn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=Lt(n,l)&&this.comparePoint(l)===0,d=Lt(i,s)&&t.comparePoint(s)===0,f=Lt(n,u)&&this.comparePoint(u)===0,c=Lt(i,a)&&t.comparePoint(a)===0;if(d&&p)return c&&!f?a:!c&&f?u:null;if(d)return f&&s.x===u.x&&s.y===u.y?null:s;if(p)return c&&a.x===l.x&&a.y===l.y?null:l;if(c&&f)return null;if(c)return a;if(f)return u;var h=gs(s,this.vector(),l,t.vector());return h===null||!Lt(o,h)?null:Ht.round(h.x,h.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new De(t,!0),s=new De(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return De.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),De.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var p=i.rings[l],d=i.windings[l],f=n.rings.indexOf(p);f===-1?(n.rings.push(p),n.windings.push(d)):n.windings[f]+=d}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),i.push(u)):i[p]+=u}for(var d=[],f=[],c=0,h=n.length;c<h;c++)if(i[c]!==0){var g=n[c],m=g.poly;if(f.indexOf(m)===-1)if(g.isExterior)d.push(m);else{f.indexOf(m)===-1&&f.push(m);var y=d.indexOf(g.poly);y!==-1&&d.splice(y,1)}}for(var _=0,b=d.length;_<b;_++){var v=d[_].multiPoly;o.indexOf(v)===-1&&o.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Be.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Be.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(d){return d.length===1&&d[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Be.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=De.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new De(o,!0),p=new De(s,!1);return new r(u,p,[i],[a])}}]),r}(),Ir=function(){function r(e,t,n){if(Fe(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Ht.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Ht.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(vn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(vn.fromRing(o,i,this))}return Oe(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),ys=function(){function r(e,t){if(Fe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ir(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Ir(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Oe(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Br=function(){function r(e,t){if(Fe(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new ys(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Oe(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),vs=function(){Oe(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],d=l.point,f=[];a=l,l=u,p.push(l),l.point!==d;)for(;;){var c=l.getAvailableLinkedEvents();if(c.length===0){var h=p[0].point,g=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(c.length===1){u=c[0].otherSE;break}for(var m=null,y=0,_=f.length;y<_;y++)if(f[y].point===l.point){m=y;break}if(m!==null){var b=f.splice(m)[0],v=p.splice(b.index);v.unshift(v[0].otherSE),n.push(new r(v.reverse()));continue}f.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=c.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Fe(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Oe(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Rr(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Rr(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:n.length-1,f=this.isExteriorRing()?n.length:-1,c=[],h=d;h!=f;h+=p)c.push([n[h].x,n[h].y]);return c}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];De.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Nr=function(){function r(e){Fe(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Oe(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),ws=function(){function r(e){Fe(this,r),this.rings=e,this.polys=this._composePolys(e)}return Oe(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Nr(s));else{var a=s.enclosingRing();a.poly||n.push(new Nr(a)),a.poly.addInterior(s)}}return n}}]),r}(),ks=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vn.compare;Fe(this,r),this.queue=e,this.tree=new fr(t),this.segments=[]}return Oe(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var d=l.getIntersection(n);if(d!==null&&(n.isAnEndpoint(d)||(p=d),!l.isAnEndpoint(d)))for(var f=this._splitSafely(l,d),c=0,h=f.length;c<h;c++)i.push(f[c])}var g=null;if(u){var m=u.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(g=m),!u.isAnEndpoint(m)))for(var y=this._splitSafely(u,m),_=0,b=y.length;_<b;_++)i.push(y[_])}if(p!==null||g!==null){var v=null;if(p===null)v=g;else if(g===null)v=p;else{var M=De.comparePoints(p,g);v=M<=0?p:g}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var $=n.split(v),R=0,T=$.length;R<T;R++)i.push($[R])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var x=l.getIntersection(u);if(x!==null){if(!l.isAnEndpoint(x))for(var j=this._splitSafely(l,x),P=0,z=j.length;P<z;P++)i.push(j[P]);if(!u.isAnEndpoint(x))for(var H=this._splitSafely(u,x),Z=0,se=H.length;Z<se;Z++)i.push(H[Z])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),xr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ss=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Es=function(){function r(){Fe(this,r)}return Oe(r,[{key:"run",value:function(t,n,i){Be.type=t,Ht.reset();for(var o=[new Br(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Br(i[s],!1));if(Be.numMultiPolys=o.length,Be.type==="difference")for(var l=o[0],u=1;u<o.length;)Kn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Be.type==="intersection"){for(var p=0,d=o.length;p<d;p++)for(var f=o[p],c=p+1,h=o.length;c<h;c++)if(Kn(f.bbox,o[c].bbox)===null)return[]}for(var g=new fr(De.compare),m=0,y=o.length;m<y;m++)for(var _=o[m].getSweepEvents(),b=0,v=_.length;b<v;b++)if(g.insert(_[b]),g.size>xr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new ks(g),$=g.size,R=g.pop();R;){var T=R.key;if(g.size===$){var x=T.segment;throw new Error("Unable to pop() ".concat(T.isLeft?"left":"right"," SweepEvent ")+"[".concat(T.point.x,", ").concat(T.point.y,"] from segment #").concat(x.id," ")+"[".concat(x.leftSE.point.x,", ").concat(x.leftSE.point.y,"] -> ")+"[".concat(x.rightSE.point.x,", ").concat(x.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>xr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>Ss)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var j=M.process(T),P=0,z=j.length;P<z;P++){var H=j[P];H.consumedBy===void 0&&g.insert(H)}$=g.size,R=g.pop()}Ht.reset();var Z=vs.factory(M.segments),se=new ws(Z);return se.getGeom()}}]),r}(),Be=new Es,Ms=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Be.run("union",e,n)},Cs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Be.run("intersection",e,n)},$s=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Be.run("xor",e,n)},Ls=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Be.run("difference",e,n)},on={union:Ms,intersection:Cs,xor:$s,difference:Ls};function Os(r,e){var t=Ts(e),n=null;return r.type==="FeatureCollection"?n=As(r):n=Fi(on.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function As(r){var e=r.features.length===2?on.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):on.union.apply(on,r.features.map(function(t){return t.geometry.coordinates}));return Fi(e)}function Fi(r){return lo(r)}function Ts(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return ao(t)}function Rs(r,e,t){let n;oe(r,Pe,s=>t(1,n=s));let{boundaryGeojson:i}=e;return uo("setCamera")&&n.fitBounds(sr(i),{padding:20,animate:!1}),et(n,"boundary",Os(i)),Me(n,{id:"boundary",source:"boundary",...Mn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class Ps extends V{constructor(e){super(),K(this,e,Rs,null,X,{boundaryGeojson:0})}}const _e={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},An=10,zt=10;function Fs(r,e,t){let n;oe(r,Pe,u=>t(2,n=u));let{layer:i}=e,{contents:o}=e,s=new tn.Popup({closeButton:!1,closeOnClick:!1});n.on("mousemove",a),n.on("mouseout",l),Qe(()=>{n.off("mousemove",a),n.off("mouseout",l),s.remove()});function a(u){if(!n.getLayer(i)){s.remove();return}let p=n.queryRenderedFeatures(u.point,{layers:[i]});p.length>0?s.setLngLat(u.lngLat).setHTML(o(p[0].properties)).addTo(n):s.remove()}function l(){s.remove()}return r.$$set=u=>{"layer"in u&&t(0,i=u.layer),"contents"in u&&t(1,o=u.contents)},[i,o]}class Is extends V{constructor(e){super(),K(this,e,Fs,null,X,{layer:0,contents:1})}}function Dr(r,e,t){const n=r.slice();return n[3]=e[t],n}function jr(r,e,t){const n=r.slice();return n[6]=e[t],n}function Ur(r){let e;return{c(){e=E("td"),O(e,"class","svelte-11t6rxo"),fe(e,"background-color",r[6])},m(t,n){w(t,e,n)},p(t,n){n&1&&fe(e,"background-color",t[6])},d(t){t&&k(e)}}}function qr(r){let e,t=r[3]+"",n;return{c(){e=E("td"),n=Y(t),O(e,"class","svelte-11t6rxo"),fe(e,"width",r[2])},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[3]+"")&&Le(n,t)},d(i){i&&k(e)}}}function Bs(r){let e,t,n,i,o=r[0],s=[];for(let u=0;u<o.length;u+=1)s[u]=Ur(jr(r,o,u));let a=r[1],l=[];for(let u=0;u<a.length;u+=1)l[u]=qr(Dr(r,a,u));return{c(){e=E("table"),t=E("tr");for(let u=0;u<s.length;u+=1)s[u].c();n=A(),i=E("tr");for(let u=0;u<l.length;u+=1)l[u].c();O(t,"class","svelte-11t6rxo"),O(i,"class","svelte-11t6rxo"),O(e,"class","svelte-11t6rxo")},m(u,p){w(u,e,p),S(e,t);for(let d=0;d<s.length;d+=1)s[d].m(t,null);S(e,n),S(e,i);for(let d=0;d<l.length;d+=1)l[d].m(i,null)},p(u,[p]){if(p&1){o=u[0];let d;for(d=0;d<o.length;d+=1){const f=jr(u,o,d);s[d]?s[d].p(f,p):(s[d]=Ur(f),s[d].c(),s[d].m(t,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=o.length}if(p&6){a=u[1];let d;for(d=0;d<a.length;d+=1){const f=Dr(u,a,d);l[d]?l[d].p(f,p):(l[d]=qr(f),l[d].c(),l[d].m(i,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},i:G,o:G,d(u){u&&k(e),cn(s,u),cn(l,u)}}}function Ns(r,e,t){let{colors:n}=e,{labels:i}=e;if(n.length!=i.length)throw new Error("colors and labels must match");let o=`${100/n.length}%`;return r.$$set=s=>{"colors"in s&&t(0,n=s.colors),"labels"in s&&t(1,i=s.labels)},[n,i,o]}class xs extends V{constructor(e){super(),K(this,e,Ns,Bs,X,{colors:0,labels:1})}}const Ds="/atip/state-changing-bugs-142/assets/help-d011708a.svg";function js(r){let e,t;return{c(){e=E("img"),pn(e.src,t=Ds)||O(e,"src",t),O(e,"title",r[0]),O(e,"alt",r[0])},m(n,i){w(n,e,i)},p(n,[i]){i&1&&O(e,"title",n[0]),i&1&&O(e,"alt",n[0])},i:G,o:G,d(n){n&&k(e)}}}function Us(r,e,t){let{contents:n}=e;return r.$$set=i=>{"contents"in i&&t(0,n=i.contents)},[n]}class qs extends V{constructor(e){super(),K(this,e,Us,js,X,{contents:0})}}function Gs(r){let e,t,n,i,o,s,a;return t=new qs({props:{contents:"Data comes from OpenStreetMap, and may not always be correct. Unexpected values are treated as unknown. Freehand route segments and off-road paths generally have no speed data."}}),i=new xs({props:{colors:r[0],labels:["< 20","20","30","40",">= 50"]}}),s=new Is({props:{layer:"speed-limits",contents:zs}}),{c(){e=Y(`(mph)
`),I(t.$$.fragment),n=A(),I(i.$$.fragment),o=A(),I(s.$$.fragment)},m(l,u){w(l,e,u),B(t,l,u),w(l,n,u),B(i,l,u),w(l,o,u),B(s,l,u),a=!0},p:G,i(l){a||(C(t.$$.fragment,l),C(i.$$.fragment,l),C(s.$$.fragment,l),a=!0)},o(l){L(t.$$.fragment,l),L(i.$$.fragment,l),L(s.$$.fragment,l),a=!1},d(l){l&&k(e),N(t,l),l&&k(n),N(i,l),l&&k(o),N(s,l)}}}let Hs="white",at="speed-limits",Nn="speed-limits",Ot=.8;function zs(r){return r.speed_limit?`${Math.round(r.speed_limit)} mph`:"Unknown"}function Js(r,e,t){let n,i,o;oe(r,Pe,p=>t(2,n=p)),oe(r,mn,p=>t(3,i=p)),oe(r,ie,p=>t(4,o=p));let{id:s}=e,a=["#00AB4D","#8ECA4D","#F7BB00","#BB0000","#470000"];const l=["case",["<",["get","speed_limit"],20],a[0],["==",["get","speed_limit"],20],a[1],["==",["get","speed_limit"],30],a[2],["==",["get","speed_limit"],40],a[3],[">=",["get","speed_limit"],50],a[4],Hs],u=["case",["<",["get","speed_limit"],20],Ot,["==",["get","speed_limit"],20],Ot,["==",["get","speed_limit"],30],Ot,["==",["get","speed_limit"],40],Ot,[">=",["get","speed_limit"],50],Ot,0];return et(n,at,Ne()),Me(n,{id:Nn,source:at,...wt(l,zt,u)}),Yt(async()=>{try{if(s){let p=o.features.find(f=>f.id==s),d=JSON.parse(await i.speedLimitForRoute(p.properties.waypoints));n.getSource(at).setData(d)}else{let p=JSON.parse(await i.allSpeedLimits());n.getSource(at).setData(p)}}catch(p){window.alert(`Couldn't calculate speed limits for route: ${p}`)}}),Qe(()=>{n.getLayer(Nn)&&n.removeLayer(Nn),n.getSource(at)&&n.removeSource(at)}),r.$$set=p=>{"id"in p&&t(1,s=p.id)},[a,s]}class Ii extends V{constructor(e){super(),K(this,e,Js,Gs,X,{id:1})}}function Gr(r){let e,t;return e=new Ii({props:{id:r[0]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.id=n[0]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Ys(r){let e,t,n,i,o,s,a,l,u,p,d=r[1]=="speed limits"&&Gr(r);return{c(){e=E("label"),t=Y(`Show details:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",s=A(),d&&d.c(),a=ye(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,r[1]===void 0&&st(()=>r[2].call(n))},m(f,c){w(f,e,c),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[1]),w(f,s,c),d&&d.m(f,c),w(f,a,c),l=!0,u||(p=U(n,"change",r[2]),u=!0)},p(f,[c]){c&2&&Ke(n,f[1]),f[1]=="speed limits"?d?(d.p(f,c),c&2&&C(d,1)):(d=Gr(f),d.c(),C(d,1),d.m(a.parentNode,a)):d&&(ce(),L(d,1,1,()=>{d=null}),pe())},i(f){l||(C(d),l=!0)},o(f){L(d),l=!1},d(f){f&&k(e),f&&k(s),d&&d.d(f),f&&k(a),u=!1,p()}}}function Xs(r,e,t){let{id:n}=e,i="none";function o(){i=Cn(this),t(1,i)}return r.$$set=s=>{"id"in s&&t(0,n=s.id)},[n,i,o]}class Ws extends V{constructor(e){super(),K(this,e,Xs,Ys,X,{id:0})}}function Hr(r){let e,t=zr(r[4])+"",n,i,o,s,a,l,u,p,d,f;return u=new Ws({props:{id:r[3]}}),{c(){e=Y("Length: "),n=Y(t),i=A(),o=E("br"),s=E("button"),s.textContent="Auto-fill details",a=E("br"),l=A(),I(u.$$.fragment),O(s,"type","button")},m(c,h){w(c,e,h),w(c,n,h),w(c,i,h),w(c,o,h),w(c,s,h),w(c,a,h),w(c,l,h),B(u,c,h),p=!0,d||(f=U(s,"click",r[13]),d=!0)},p(c,h){(!p||h&16)&&t!==(t=zr(c[4])+"")&&Le(n,t);const g={};h&8&&(g.id=c[3]),u.$set(g)},i(c){p||(C(u.$$.fragment,c),p=!0)},o(c){L(u.$$.fragment,c),p=!1},d(c){c&&k(e),c&&k(n),c&&k(i),c&&k(o),c&&k(s),c&&k(a),c&&k(l),N(u,c),d=!1,f()}}}function Vs(r){let e,t,n,i,o,s,a,l,u,p,d,f,c,h,g,m,y,_,b,v,M,$,R,T,x,j,P,z,H,Z,se,ke,Ae,re,D,ue,Ce,ee,me,Vt,ge=r[4]&&Hr(r);return{c(){e=E("label"),t=Y("Name:"),n=E("br"),i=A(),o=E("input"),s=A(),a=E("br"),l=A(),u=E("br"),p=A(),d=E("label"),f=E("input"),c=Y(`
  Area`),h=A(),g=E("label"),m=E("input"),y=Y(`
  Route`),_=A(),b=E("label"),v=E("input"),M=Y(`
  Crossing`),$=A(),R=E("label"),T=E("input"),x=Y(`
  Other`),j=A(),P=E("br"),z=A(),H=E("br"),Z=A(),se=E("label"),ke=Y("Description:"),Ae=E("br"),re=A(),D=E("textarea"),ue=A(),ge&&ge.c(),Ce=ye(),O(o,"type","text"),fe(o,"width","100%"),O(f,"type","radio"),f.__value="area",f.value=f.__value,r[8][0].push(f),O(m,"type","radio"),m.__value="route",m.value=m.__value,r[8][0].push(m),O(v,"type","radio"),v.__value="crossing",v.value=v.__value,r[8][0].push(v),O(T,"type","radio"),T.__value="other",T.value=T.__value,r[8][0].push(T),fe(D,"width","100%"),O(D,"rows","5"),O(D,"class","svelte-15lna0i")},m(F,ne){w(F,e,ne),S(e,t),S(e,n),S(e,i),S(e,o),Re(o,r[0]),w(F,s,ne),w(F,a,ne),w(F,l,ne),w(F,u,ne),w(F,p,ne),w(F,d,ne),S(d,f),f.checked=f.__value===r[1],S(d,c),w(F,h,ne),w(F,g,ne),S(g,m),m.checked=m.__value===r[1],S(g,y),w(F,_,ne),w(F,b,ne),S(b,v),v.checked=v.__value===r[1],S(b,M),w(F,$,ne),w(F,R,ne),S(R,T),T.checked=T.__value===r[1],S(R,x),w(F,j,ne),w(F,P,ne),w(F,z,ne),w(F,H,ne),w(F,Z,ne),w(F,se,ne),S(se,ke),S(se,Ae),S(se,re),S(se,D),Re(D,r[2]),w(F,ue,ne),ge&&ge.m(F,ne),w(F,Ce,ne),ee=!0,me||(Vt=[U(o,"input",r[6]),U(f,"change",r[7]),U(m,"change",r[9]),U(v,"change",r[10]),U(T,"change",r[11]),U(D,"input",r[12])],me=!0)},p(F,[ne]){ne&1&&o.value!==F[0]&&Re(o,F[0]),ne&2&&(f.checked=f.__value===F[1]),ne&2&&(m.checked=m.__value===F[1]),ne&2&&(v.checked=v.__value===F[1]),ne&2&&(T.checked=T.__value===F[1]),ne&4&&Re(D,F[2]),F[4]?ge?(ge.p(F,ne),ne&16&&C(ge,1)):(ge=Hr(F),ge.c(),C(ge,1),ge.m(Ce.parentNode,Ce)):ge&&(ce(),L(ge,1,1,()=>{ge=null}),pe())},i(F){ee||(C(ge),ee=!0)},o(F){L(ge),ee=!1},d(F){F&&k(e),F&&k(s),F&&k(a),F&&k(l),F&&k(u),F&&k(p),F&&k(d),r[8][0].splice(r[8][0].indexOf(f),1),F&&k(h),F&&k(g),r[8][0].splice(r[8][0].indexOf(m),1),F&&k(_),F&&k(b),r[8][0].splice(r[8][0].indexOf(v),1),F&&k($),F&&k(R),r[8][0].splice(r[8][0].indexOf(T),1),F&&k(j),F&&k(P),F&&k(z),F&&k(H),F&&k(Z),F&&k(se),F&&k(ue),ge&&ge.d(F),F&&k(Ce),me=!1,Te(Vt)}}}function zr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Ks(r,e,t){let n,i;oe(r,mn,b=>t(14,n=b)),oe(r,ie,b=>t(15,i=b));let{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function p(){let b=i.features.find(v=>v.id==o);try{t(0,s=await n.nameForRoute(b))}catch(v){window.alert(`Couldn't auto-name route: ${v}`)}}const d=[[]];function f(){s=this.value,t(0,s)}function c(){a=this.__value,t(1,a)}function h(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function m(){a=this.__value,t(1,a)}function y(){l=this.value,t(2,l)}const _=()=>p();return r.$$set=b=>{"id"in b&&t(3,o=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(4,u=b.length_meters)},[s,a,l,o,u,p,f,c,d,h,g,m,y,_]}class Zs extends V{constructor(e){super(),K(this,e,Ks,Vs,X,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}const Qs="Intervention",el=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],tl={name:Qs,oneOf:el};function nl(r){const e=r-1;return e*e*e+1}function Et(r,{delay:e=0,duration:t=400,easing:n=nl}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),p=parseFloat(i.marginBottom),d=parseFloat(i.borderTopWidth),f=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:c=>`overflow: hidden;opacity: ${Math.min(c*20,1)*o};height: ${c*s}px;padding-top: ${c*a}px;padding-bottom: ${c*l}px;margin-top: ${c*u}px;margin-bottom: ${c*p}px;border-top-width: ${c*d}px;border-bottom-width: ${c*f}px;`}}function Bi(r){return"members"in r}function Ni(r){return"oneOf"in r}function xi(r){return typeof r=="string"}function Di(r){return typeof r=="object"&&"value"in r}function rl(r){return"type"in r&&r.type=="number"}function ji(r){return"type"in r&&r.type=="one-liner"}function Ui(r){return"type"in r&&r.type=="textbox"}function qi(r){return"type"in r&&r.type=="checkbox"}function Jr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Yr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Xr(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=Y(t),O(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&Le(n,t)},d(i){i&&k(e)}}}function il(r){let e,t,n;return{c(){e=E("input"),O(e,"type","checkbox")},m(i,o){w(i,e,o),e.checked=r[0],t||(n=U(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function ol(r){let e,t,n;return{c(){e=E("textarea"),fe(e,"width","100%"),O(e,"rows","5"),O(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),Re(e,r[0]),t||(n=U(e,"input",r[13]),t=!0)},p(i,o){o&1&&Re(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function sl(r){let e,t,n;return{c(){e=E("input"),O(e,"type","text"),fe(e,"width","100%")},m(i,o){w(i,e,o),Re(e,r[0]),t||(n=U(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Re(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function ll(r){let e,t,n;return{c(){e=E("input"),O(e,"type","number")},m(i,o){w(i,e,o),Re(e,r[0]),t||(n=U(e,"input",r[11]),t=!0)},p(i,o){o&1&&Si(e.value)!==i[0]&&Re(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function al(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=Vr(Jr(r,n,s));const o=s=>L(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ye()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Jr(s,n,l);i[l]?(i[l].p(u,a),C(i[l],1)):(i[l]=Vr(u),i[l].c(),C(i[l],1),i[l].m(e.parentNode,e))}for(ce(),l=n.length;l<i.length;l+=1)o(l);pe()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)C(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)L(i[a]);t=!1},d(s){cn(i,s),s&&k(e)}}}function ul(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=Kr(Yr(r,n,s));const o=s=>L(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=ye()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Yr(s,n,l);i[l]?(i[l].p(u,a),C(i[l],1)):(i[l]=Kr(u),i[l].c(),C(i[l],1),i[l].m(e.parentNode,e))}for(ce(),l=n.length;l<i.length;l+=1)o(l);pe()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)C(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)L(i[a]);t=!1},d(s){cn(i,s),s&&k(e)}}}function fl(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,p,d,f,c=r[2]==r[15].name&&typeof r[0]=="object"&&Wr(r);return{c(){e=E("label"),t=E("input"),i=A(),s=Y(o),a=E("br"),l=A(),c&&c.c(),u=ye(),O(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(h,g){w(h,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),w(h,l,g),c&&c.m(h,g),w(h,u,g),p=!0,d||(f=[U(t,"change",r[9]),U(t,"change",r[4])],d=!0)},p(h,g){(!p||g&2&&n!==(n=h[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),(!p||g&2)&&o!==(o=h[15].name+"")&&Le(s,o),h[2]==h[15].name&&typeof h[0]=="object"?c?(c.p(h,g),g&7&&C(c,1)):(c=Wr(h),c.c(),C(c,1),c.m(u.parentNode,u)):c&&(ce(),L(c,1,1,()=>{c=null}),pe())},i(h){p||(C(c),p=!0)},o(h){L(c),p=!1},d(h){h&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),h&&k(l),c&&c.d(h),h&&k(u),d=!1,Te(f)}}}function cl(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,p;function d(h,g){return h[15].description?hl:dl}let f=d(r),c=f(r);return{c(){e=E("label"),t=E("input"),i=A(),s=Y(o),a=A(),c.c(),l=A(),O(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(h,g){w(h,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),c.m(e,null),S(e,l),u||(p=[U(t,"change",r[8]),U(t,"change",r[3])],u=!0)},p(h,g){g&2&&n!==(n=h[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),g&2&&o!==(o=h[15].value+"")&&Le(s,o),f===(f=d(h))&&c?c.p(h,g):(c.d(1),c=f(h),c&&(c.c(),c.m(e,l)))},i:G,o:G,d(h){h&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),c.d(),u=!1,Te(p)}}}function pl(r){let e,t,n,i,o=r[15]+"",s,a,l,u,p,d;return{c(){e=E("label"),t=E("input"),i=A(),s=Y(o),a=A(),l=E("br"),u=A(),O(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(f,c){w(f,e,c),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),S(e,l),S(e,u),p||(d=[U(t,"change",r[6]),U(t,"change",r[3])],p=!0)},p(f,c){c&2&&n!==(n=f[15])&&(t.__value=n,t.value=t.__value),c&4&&(t.checked=t.__value===f[2]),c&2&&o!==(o=f[15]+"")&&Le(s,o)},i:G,o:G,d(f){f&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,Te(d)}}}function Wr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Wt({props:l}),le.push(()=>ve(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),I(t.$$.fragment),i=A(),O(e,"class","svelte-1b72l00")},m(u,p){w(u,e,p),B(t,e,null),S(e,i),s=!0},p(u,p){r=u;const d={};p&2&&(d.spec=r[15]),!n&&p&3&&(n=!0,d.value=r[0][r[15].name],we(()=>n=!1)),t.$set(d)},i(u){s||(C(t.$$.fragment,u),st(()=>{o||(o=kt(e,Et,{duration:500},!0)),o.run(1)}),s=!0)},o(u){L(t.$$.fragment,u),o||(o=kt(e,Et,{duration:500},!1)),o.run(0),s=!1},d(u){u&&k(e),N(t),u&&o&&o.end()}}}function dl(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function hl(r){let e,t,n=r[15].description+"",i,o;return{c(){e=E("p"),t=Y("("),i=Y(n),o=Y(")"),O(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,i),S(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&Le(i,n)},d(s){s&&k(e)}}}function Vr(r){let e,t,n,i,o,s;const a=[pl,cl,fl],l=[];function u(p,d){return d&2&&(e=null),d&2&&(t=null),e==null&&(e=!!xi(p[15])),e?0:(t==null&&(t=!!Di(p[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=ye()},m(p,d){l[n].m(p,d),w(p,o,d),s=!0},p(p,d){let f=n;n=u(p,d),n===f?l[n].p(p,d):(ce(),L(l[f],1,1,()=>{l[f]=null}),pe(),i=l[n],i?i.p(p,d):(i=l[n]=a[n](p),i.c()),C(i,1),i.m(o.parentNode,o))},i(p){s||(C(i),s=!0)},o(p){L(i),s=!1},d(p){l[n].d(p),p&&k(o)}}}function Kr(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function p(f){r[5](f,r[15])}let d={spec:r[15]};return r[0][r[15].name]!==void 0&&(d.value=r[0][r[15].name]),s=new Wt({props:d}),le.push(()=>ve(s,"value",p,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),i=Y(n),o=A(),I(s.$$.fragment),l=A(),O(e,"class","svelte-1b72l00")},m(f,c){w(f,e,c),S(e,t),S(t,i),S(e,o),B(s,e,null),S(e,l),u=!0},p(f,c){r=f,(!u||c&2)&&n!==(n=r[15].name+"")&&Le(i,n);const h={};c&2&&(h.spec=r[15]),!a&&c&3&&(a=!0,h.value=r[0][r[15].name],we(()=>a=!1)),s.$set(h)},i(f){u||(C(s.$$.fragment,f),u=!0)},o(f){L(s.$$.fragment,f),u=!1},d(f){f&&k(e),N(s)}}}function ml(r){let e,t,n,i,o,s,a,l,u,p,d,f=r[1].description&&Xr(r);const c=[ul,al,ll,sl,ol,il],h=[];function g(m,y){return y&2&&(t=null),y&2&&(n=null),y&2&&(i=null),y&2&&(o=null),y&2&&(s=null),y&2&&(a=null),t==null&&(t=!!Bi(m[1])),t?0:(n==null&&(n=!!Ni(m[1])),n?1:(i==null&&(i=!!rl(m[1])),i?2:(o==null&&(o=!!ji(m[1])),o?3:(s==null&&(s=!!Ui(m[1])),s?4:(a==null&&(a=!!qi(m[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=h[l]=c[l](r)),{c(){f&&f.c(),e=A(),u&&u.c(),p=ye()},m(m,y){f&&f.m(m,y),w(m,e,y),~l&&h[l].m(m,y),w(m,p,y),d=!0},p(m,[y]){m[1].description?f?f.p(m,y):(f=Xr(m),f.c(),f.m(e.parentNode,e)):f&&(f.d(1),f=null);let _=l;l=g(m,y),l===_?~l&&h[l].p(m,y):(u&&(ce(),L(h[_],1,1,()=>{h[_]=null}),pe()),~l?(u=h[l],u?u.p(m,y):(u=h[l]=c[l](m),u.c()),C(u,1),u.m(p.parentNode,p)):u=null)},i(m){d||(C(u),d=!0)},o(m){L(u),d=!1},d(m){f&&f.d(m),m&&k(e),~l&&h[l].d(m),m&&k(p)}}}function _l(r,e,t){var _,b,v;let{spec:n}=e,{value:i}=e,o="";if(Bi(n)){i||(i={});for(let M of n.members)ji(M)||Ui(M)?i[_=M.name]||(i[_]=""):qi(M)?i[b=M.name]||(i[b]=!1):i[v=M.name]||(i[v]={})}else Ni(n)&&(i||(i={}),xi(i)?o=i:Di(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,$){r.$$.not_equal(i[$.name],M)&&(i[$.name]=M,t(0,i))}function p(){o=this.__value,t(2,o)}function d(){o=this.__value,t(2,o)}function f(){o=this.__value,t(2,o)}function c(M,$){r.$$.not_equal(i[$.name],M)&&(i[$.name]=M,t(0,i))}function h(){i=Si(this.value),t(0,i)}function g(){i=this.value,t(0,i)}function m(){i=this.value,t(0,i)}function y(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,p,l,d,f,c,h,g,m,y]}class Wt extends V{constructor(e){super(),K(this,e,_l,ml,X,{spec:1,value:0})}}function gl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Wt({props:o}),le.push(()=>ve(e,"value",i,r[0].v2)),{c(){I(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,we(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function bl(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=tl;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class yl extends V{constructor(e){super(),K(this,e,bl,gl,X,{props:0})}}const vl="Planning",wl=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],kl={name:vl,members:wl};function Sl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Wt({props:o}),le.push(()=>ve(e,"value",i,r[0].planning)),{c(){I(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,we(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function El(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=kl;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Ml extends V{constructor(e){super(),K(this,e,El,Sl,X,{props:0})}}const Cl="CriticalIssue",$l=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],Ll={name:Cl,members:$l};function Ol(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Wt({props:o}),le.push(()=>ve(e,"value",i,r[0].criticals)),{c(){I(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,we(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function Al(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=Ll;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Tl extends V{constructor(e){super(),K(this,e,Al,Ol,X,{props:0})}}function Zr(r){let e,t,n,i,o;const s=r[10].default,a=_t(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),fe(e,"border","solid 1px black"),fe(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=U(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&gt(a,s,l,l[9],n?yt(s,l[9],u,null):bt(l[9]),null)},i(l){n||(C(a,l),st(()=>{t||(t=kt(e,Et,{duration:100},!0)),t.run(1)}),n=!0)},o(l){L(a,l),t||(t=kt(e,Et,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Rl(r){let e,t,n,i,o,s,a,l,u,p,d=r[4]&&Zr(r);return{c(){e=E("button"),t=dn("svg"),n=dn("path"),i=A(),o=Y(r[1]),s=A(),d&&d.c(),a=ye(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-t7fpgu"),O(e,"aria-expanded",r[4]),O(e,"class","svelte-t7fpgu"),wr(e,"underlined",r[3])},m(f,c){w(f,e,c),S(e,t),S(t,n),S(e,i),S(e,o),w(f,s,c),d&&d.m(f,c),w(f,a,c),l=!0,u||(p=[U(e,"click",r[5]),U(e,"mouseenter",r[11]),U(e,"mouseleave",r[12])],u=!0)},p(f,[c]){(!l||c&2)&&Le(o,f[1]),(!l||c&16)&&O(e,"aria-expanded",f[4]),(!l||c&8)&&wr(e,"underlined",f[3]),f[4]?d?(d.p(f,c),c&16&&C(d,1)):(d=Zr(f),d.c(),C(d,1),d.m(a.parentNode,a)):d&&(ce(),L(d,1,1,()=>{d=null}),pe())},i(f){l||(C(d),l=!0)},o(f){L(d),l=!1},d(f){f&&k(e),f&&k(s),d&&d.d(f),f&&k(a),u=!1,Te(p)}}}function Pl(r,e,t){let n,i,o,s;oe(r,je,_=>t(7,o=_)),oe(r,$e,_=>t(8,s=_));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const d=()=>{$e.update(_=>_==u?null:u),s==u&&(Gt.set(null),Gt.set(u))};let f;function c(){f==null||f.scrollIntoView({behavior:"smooth"})}const h=()=>qt.set(u),g=()=>qt.set(null);function m(_){le[_?"unshift":"push"](()=>{f=_,t(2,f)})}const y=()=>c();return r.$$set=_=>{"id"in _&&t(0,u=_.id),"label"in _&&t(1,p=_.label),"$$scope"in _&&t(9,l=_.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,p,f,i,n,d,c,o,s,l,a,h,g,m,y]}class Fl extends V{constructor(e){super(),K(this,e,Pl,Rl,X,{id:0,label:1})}}function Qr(r,e,t){const n=r.slice();return n[13]=e[t],n[14]=e,n[15]=t,n}function Il(r){let e,t,n;function i(s){r[9](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Tl({props:o}),le.push(()=>ve(e,"props",i,r[13].properties)),{c(){I(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,we(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function Bl(r){let e,t,n;function i(s){r[8](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Ml({props:o}),le.push(()=>ve(e,"props",i,r[13].properties)),{c(){I(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,we(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function Nl(r){let e,t,n;function i(s){r[7](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new yl({props:o}),le.push(()=>ve(e,"props",i,r[13].properties)),{c(){I(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,we(()=>t=!1)),e.$set(l)},i(s){n||(C(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){N(e,s)}}}function xl(r){let e,t,n,i,o;function s(p){r[4](p,r[13])}function a(p){r[5](p,r[13])}function l(p){r[6](p,r[13])}let u={id:r[13].id,length_meters:r[13].properties.length_meters};return r[13].properties.name!==void 0&&(u.name=r[13].properties.name),r[13].properties.intervention_type!==void 0&&(u.intervention_type=r[13].properties.intervention_type),r[13].properties.description!==void 0&&(u.description=r[13].properties.description),e=new Zs({props:u}),le.push(()=>ve(e,"name",s,r[13].properties.name)),le.push(()=>ve(e,"intervention_type",a,r[13].properties.intervention_type)),le.push(()=>ve(e,"description",l,r[13].properties.description)),{c(){I(e.$$.fragment)},m(p,d){B(e,p,d),o=!0},p(p,d){r=p;const f={};d&2&&(f.id=r[13].id),d&2&&(f.length_meters=r[13].properties.length_meters),!t&&d&2&&(t=!0,f.name=r[13].properties.name,we(()=>t=!1)),!n&&d&2&&(n=!0,f.intervention_type=r[13].properties.intervention_type,we(()=>n=!1)),!i&&d&2&&(i=!0,f.description=r[13].properties.description,we(()=>i=!1)),e.$set(f)},i(p){o||(C(e.$$.fragment,p),o=!0)},o(p){L(e.$$.fragment,p),o=!1},d(p){N(e,p)}}}function Dl(r){let e,t,n,i,o,s,a,l,u,p,d,f,c,h,g;const m=[xl,Nl,Bl,Il],y=[];function _(v,M){return v[0]=="v1"?0:v[0]=="v2"?1:v[0]=="planning"?2:v[0]=="criticals"?3:-1}~(e=_(r))&&(t=y[e]=m[e](r));function b(){return r[10](r[13])}return{c(){t&&t.c(),n=A(),i=E("br"),o=A(),s=E("br"),a=A(),l=E("div"),u=E("button"),u.textContent="Delete",p=A(),d=E("button"),d.textContent="Save",f=A(),O(u,"type","button"),O(d,"type","button"),fe(l,"display","flex"),fe(l,"justify-content","space-between")},m(v,M){~e&&y[e].m(v,M),w(v,n,M),w(v,i,M),w(v,o,M),w(v,s,M),w(v,a,M),w(v,l,M),S(l,u),S(l,p),S(l,d),w(v,f,M),c=!0,h||(g=[U(u,"click",b),U(d,"click",r[11])],h=!0)},p(v,M){r=v;let $=e;e=_(r),e===$?~e&&y[e].p(r,M):(t&&(ce(),L(y[$],1,1,()=>{y[$]=null}),pe()),~e?(t=y[e],t?t.p(r,M):(t=y[e]=m[e](r),t.c()),C(t,1),t.m(n.parentNode,n)):t=null)},i(v){c||(C(t),c=!0)},o(v){L(t),c=!1},d(v){~e&&y[e].d(v),v&&k(n),v&&k(i),v&&k(o),v&&k(s),v&&k(a),v&&k(l),v&&k(f),h=!1,Te(g)}}}function ei(r,e){let t,n,i;return n=new Fl({props:{id:e[13].id,label:e[15]+1+") "+e[2](e[13]),$$slots:{default:[Dl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=ye(),I(n.$$.fragment),this.first=t},m(o,s){w(o,t,s),B(n,o,s),i=!0},p(o,s){e=o;const a={};s&2&&(a.id=e[13].id),s&2&&(a.label=e[15]+1+") "+e[2](e[13])),s&65539&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||(C(n.$$.fragment,o),i=!0)},o(o){L(n.$$.fragment,o),i=!1},d(o){o&&k(t),N(n,o)}}}function jl(r){let e=[],t=new Map,n,i,o,s,a=r[1].features;const l=u=>u[13].id;for(let u=0;u<a.length;u+=1){let p=Qr(r,a,u),d=l(p);t.set(d,e[u]=ei(d,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=ye()},m(u,p){for(let d=0;d<e.length;d+=1)e[d].m(u,p);w(u,n,p),i=!0,o||(s=U(window,"keydown",r[3]),o=!0)},p(u,[p]){p&7&&(a=u[1].features,ce(),e=fo(e,p,l,1,u,a,t,n.parentNode,co,ei,n,Qr),pe())},i(u){if(!i){for(let p=0;p<a.length;p+=1)C(e[p]);i=!0}},o(u){for(let p=0;p<e.length;p+=1)L(e[p]);i=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&k(n),o=!1,s()}}}function Ul(r,e,t){let n,i;oe(r,$e,m=>t(12,n=m)),oe(r,ie,m=>t(1,i=m));let{schema:o}=e;function s(m){var _,b,v,M,$;if(o=="planning")return((_=m.properties.planning)==null?void 0:_.name)||"Untitled polygon";if(o=="v2")return((v=(b=m.properties.v2)==null?void 0:b.Route)==null?void 0:v.name)||(($=(M=m.properties.v2)==null?void 0:M.Crossing)==null?void 0:$.name)||"Untitled intervention";if(m.properties.name)return m.properties.name;var y=m.properties.intervention_type;return y=="other"&&(m.geometry.type=="Point"?y="point":m.geometry.type=="LineString"?y="line":y="polygon"),`Untitled ${y}`}function a(m){if(m.key=="Delete"){const y=m.target.tagName;if(y=="INPUT"||y=="TEXTAREA")return;m.preventDefault();const _=n;_&&Sr(_)}}function l(m,y){r.$$.not_equal(y.properties.name,m)&&(y.properties.name=m,ie.set(i))}function u(m,y){r.$$.not_equal(y.properties.intervention_type,m)&&(y.properties.intervention_type=m,ie.set(i))}function p(m,y){r.$$.not_equal(y.properties.description,m)&&(y.properties.description=m,ie.set(i))}function d(m,y){r.$$.not_equal(y.properties,m)&&(y.properties=m,ie.set(i))}function f(m,y){r.$$.not_equal(y.properties,m)&&(y.properties=m,ie.set(i))}function c(m,y){r.$$.not_equal(y.properties,m)&&(y.properties=m,ie.set(i))}const h=m=>Sr(m.id),g=()=>$e.set(null);return r.$$set=m=>{"schema"in m&&t(0,o=m.schema)},[o,i,s,a,l,u,p,d,f,c,h,g]}class ql extends V{constructor(e){super(),K(this,e,Ul,jl,X,{schema:0})}}function ti(r){let e,t;return e=new Ii({props:{id:void 0}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p:G,i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Gl(r){let e,t,n,i,o,s,a,l,u,p,d,f=r[1]=="speed limits"&&ti();return{c(){e=E("label"),t=Y(`Show layer:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",a=A(),f&&f.c(),l=ye(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,n.disabled=s=r[0]!=null,r[1]===void 0&&st(()=>r[2].call(n))},m(c,h){w(c,e,h),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[1]),w(c,a,h),f&&f.m(c,h),w(c,l,h),u=!0,p||(d=U(n,"change",r[2]),p=!0)},p(c,[h]){(!u||h&1&&s!==(s=c[0]!=null))&&(n.disabled=s),h&2&&Ke(n,c[1]),c[1]=="speed limits"?f?(f.p(c,h),h&2&&C(f,1)):(f=ti(),f.c(),C(f,1),f.m(l.parentNode,l)):f&&(ce(),L(f,1,1,()=>{f=null}),pe())},i(c){u||(C(f),u=!0)},o(c){L(f),u=!1},d(c){c&&k(e),c&&k(a),f&&f.d(c),c&&k(l),p=!1,d()}}}function Hl(r,e,t){let n;oe(r,$e,s=>t(0,n=s));let i="none";function o(){i=Cn(this),t(1,i),t(0,n)}return r.$$.update=()=>{r.$$.dirty&1&&n&&t(1,i="none")},[n,i,o]}class zl extends V{constructor(e){super(),K(this,e,Hl,Gl,X,{})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ue(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Qn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Je(r,e,t){t===void 0&&(t={});var n=Ve(r),i=Ve(e),o=Ie(i[1]-n[1]),s=Ie(i[0]-n[0]),a=Ie(n[1]),l=Ie(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return po(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function sn(r,e){return e===void 0&&(e={}),ho(r,function(t,n){var i=n.geometry.coordinates;return t+Je(i[0],i[1],e)},0)}function Jl(r){let e,t,n,i,o,s,a,l,u,p;return{c(){e=E("p"),t=Y(r[4]),n=A(),i=E("button"),o=Y(r[5]),s=A(),a=E("button"),l=Y(r[6]),O(i,"type","button"),O(a,"type","button")},m(d,f){w(d,e,f),S(e,t),w(d,n,f),w(d,i,f),S(i,o),w(d,s,f),w(d,a,f),S(a,l),u||(p=[U(i,"click",r[7]),U(a,"click",r[8])],u=!0)},p(d,f){f&16&&Le(t,d[4]),f&32&&Le(o,d[5]),f&64&&Le(l,d[6])},d(d){d&&k(e),d&&k(n),d&&k(i),d&&k(s),d&&k(a),u=!1,Te(p)}}}function Yl(r){let e,t,n,i,o,s;function a(f){r[9](f)}function l(f){r[10](f)}function u(f){r[11](f)}function p(f){r[12](f)}let d={$$slots:{default:[Jl]},$$scope:{ctx:r}};return r[3]!==void 0&&(d.title=r[3]),r[0]!==void 0&&(d.open=r[0]),r[1]!==void 0&&(d.displayEscapeButton=r[1]),r[2]!==void 0&&(d.canCloseByClickingBackground=r[2]),e=new ki({props:d}),le.push(()=>ve(e,"title",a,r[3])),le.push(()=>ve(e,"open",l,r[0])),le.push(()=>ve(e,"displayEscapeButton",u,r[1])),le.push(()=>ve(e,"canCloseByClickingBackground",p,r[2])),{c(){I(e.$$.fragment)},m(f,c){B(e,f,c),s=!0},p(f,[c]){const h={};c&16496&&(h.$$scope={dirty:c,ctx:f}),!t&&c&8&&(t=!0,h.title=f[3],we(()=>t=!1)),!n&&c&1&&(n=!0,h.open=f[0],we(()=>n=!1)),!i&&c&2&&(i=!0,h.displayEscapeButton=f[1],we(()=>i=!1)),!o&&c&4&&(o=!0,h.canCloseByClickingBackground=f[2],we(()=>o=!1)),e.$set(h)},i(f){s||(C(e.$$.fragment,f),s=!0)},o(f){L(e.$$.fragment,f),s=!1},d(f){N(e,f)}}}function Xl(r,e,t){const n=mo();let{open:i=!1}=e,{displayEscapeButton:o=!1}=e,{canCloseByClickingBackground:s=!1}=e,{title:a="Confirm"}=e,{message:l="Message"}=e,{confirmButtonText:u="Confirm"}=e,{cancelButtonText:p="Cancel"}=e;function d(){n("confirmAction")}function f(){n("cancelAction")}function c(y){a=y,t(3,a)}function h(y){i=y,t(0,i)}function g(y){o=y,t(1,o)}function m(y){s=y,t(2,s)}return r.$$set=y=>{"open"in y&&t(0,i=y.open),"displayEscapeButton"in y&&t(1,o=y.displayEscapeButton),"canCloseByClickingBackground"in y&&t(2,s=y.canCloseByClickingBackground),"title"in y&&t(3,a=y.title),"message"in y&&t(4,l=y.message),"confirmButtonText"in y&&t(5,u=y.confirmButtonText),"cancelButtonText"in y&&t(6,p=y.cancelButtonText)},[i,o,s,a,l,u,p,d,f,c,h,g,m]}class Wl extends V{constructor(e){super(),K(this,e,Xl,Yl,X,{open:0,displayEscapeButton:1,canCloseByClickingBackground:2,title:3,message:4,confirmButtonText:5,cancelButtonText:6})}}function Vl(r){let e,t,n,i,o,s,a,l,u,p,d,f,c,h,g,m,y,_,b,v=r[0].features.length+"",M,$,R,T,x,j,P,z,H,Z,se,ke;function Ae(D){r[13](D)}let re={};return r[2]!==void 0&&(re.open=r[2]),z=new Wl({props:re}),le.push(()=>ve(z,"open",Ae,r[2])),z.$on("cancelAction",r[4]),z.$on("confirmAction",r[5]),{c(){e=E("div"),t=E("label"),n=Y(`Scheme name:
    `),i=E("input"),o=A(),s=E("br"),a=A(),l=E("div"),u=E("label"),p=E("input"),d=A(),f=E("button"),f.textContent="Load from GeoJSON",c=A(),h=E("button"),h.textContent="Export to GeoJSON",g=A(),m=E("br"),y=A(),_=E("div"),b=E("span"),M=Y(v),$=Y(" objects"),R=A(),T=E("button"),x=Y("Clear all"),P=A(),I(z.$$.fragment),O(i,"type","text"),O(p,"type","file"),O(p,"id","load_geojson"),O(p,"class","svelte-lhyd1e"),O(f,"type","button"),O(h,"type","button"),O(h,"class","align-right svelte-lhyd1e"),O(T,"type","button"),O(T,"class","align-right svelte-lhyd1e"),T.disabled=j=r[0].features.length==0||r[1]!=="edit-attribute"},m(D,ue){w(D,e,ue),S(e,t),S(t,n),S(t,i),Re(i,r[0].scheme_name),w(D,o,ue),w(D,s,ue),w(D,a,ue),w(D,l,ue),S(l,u),S(u,p),S(u,d),S(u,f),S(l,c),S(l,h),w(D,g,ue),w(D,m,ue),w(D,y,ue),w(D,_,ue),S(_,b),S(b,M),S(b,$),S(_,R),S(_,T),S(T,x),S(_,P),B(z,_,null),Z=!0,se||(ke=[U(i,"input",r[12]),U(p,"change",r[7]),U(f,"click",Zl),U(h,"click",r[6]),U(T,"click",r[3])],se=!0)},p(D,[ue]){ue&1&&i.value!==D[0].scheme_name&&Re(i,D[0].scheme_name),(!Z||ue&1)&&v!==(v=D[0].features.length+"")&&Le(M,v),(!Z||ue&3&&j!==(j=D[0].features.length==0||D[1]!=="edit-attribute"))&&(T.disabled=j);const Ce={};!H&&ue&4&&(H=!0,Ce.open=D[2],we(()=>H=!1)),z.$set(Ce)},i(D){Z||(C(z.$$.fragment,D),Z=!0)},o(D){L(z.$$.fragment,D),Z=!1},d(D){D&&k(e),D&&k(o),D&&k(s),D&&k(a),D&&k(l),D&&k(g),D&&k(m),D&&k(y),D&&k(_),N(z),se=!1,Te(ke)}}}function Kl(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Zl(){document.getElementById("load_geojson").click()}function Ql(r,e,t){let n;oe(r,ie,v=>t(0,n=v));let{authorityName:i}=e,{schema:o}=e,s="edit-attribute";const a=Gn.subscribe(v=>t(1,s=v));let l=i;o!="v1"&&(l+=`_${o}`);let u=!1,p=!1;Yt(async()=>{let M=new URLSearchParams(window.location.search).get("geojsonUrl"),$=window.localStorage.getItem(l);if(M){console.log(`Loading GeoJSON from ${M}`);try{let T=await(await fetch(M)).text();ie.set(y(JSON.parse(T)))}catch(R){console.log(`Failed to load from URL: ${R}`)}}else if($)try{ie.set(y(JSON.parse($)))}catch(R){console.log(`Failed to load from local storage: ${R}`)}t(11,u=!0)});function d(){t(2,p=!0)}function f(){t(2,p=!1)}function c(){t(2,p=!1),ie.update(v=>(delete v.scheme_name,v.features=[],v)),$e.set(null),je.set(null),qt.set(null),Gt.set(null)}function h(){const v=JSON.parse(JSON.stringify(n));for(let M of v.features)delete M.properties.hide_while_editing;return v}function g(){let v=h();var M=l;v.authority=i,v.origin="atip-v1",v.scheme_name&&(M+="_"+v.scheme_name),M+=".txt",Kl(M,JSON.stringify(v,null,"  "))}function m(v){const M=new FileReader;M.onload=R=>{try{ie.set(y(JSON.parse(R.target.result)))}catch(T){window.alert(`Couldn't load scheme from a file: ${T}`)}};let $=v.target.files;M.readAsText($[0])}function y(v){let M=1;for(let $ of v.features)$.properties||($.properties={name:"",description:"",intervention_type:"other"}),$.geometry.type=="LineString"&&!$.properties.length_meters&&($.properties.length_meters=sn($,{units:"kilometers"})*1e3),$.id=M++;return v}Qe(()=>{a()});function _(){n.scheme_name=this.value,ie.set(n)}function b(v){p=v,t(2,p)}return r.$$set=v=>{"authorityName"in v&&t(8,i=v.authorityName),"schema"in v&&t(9,o=v.schema)},r.$$.update=()=>{r.$$.dirty&3073&&u&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(l,JSON.stringify(h())))},[n,s,p,d,f,c,g,m,i,o,l,u,_,b]}class ea extends V{constructor(e){super(),K(this,e,Ql,Vl,X,{authorityName:8,schema:9})}}const ta="/atip/state-changing-bugs-142/assets/zoom_out_map-b2e1091a.svg";function na(r){let e,t,n,i,o;return{c(){e=E("button"),t=E("img"),pn(t.src,n=ta)||O(t,"src",n),O(t,"alt","Zoom to show entire boundary"),O(e,"type","button"),O(e,"title","Zoom to show entire boundary"),O(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),i||(o=U(e,"click",r[0]),i=!0)},p:G,i:G,o:G,d(s){s&&k(e),i=!1,o()}}}function ra(r,e,t){let n;oe(r,Pe,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(sr(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class ia extends V{constructor(e){super(),K(this,e,ra,na,X,{boundaryGeojson:1})}}function oa(r){let e,t,n,i,o,s,a;return{c(){e=E("div"),t=Y(`Basemap:
  `),n=E("select"),i=E("option"),i.textContent="Streets",o=E("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&st(()=>r[2].call(n)),O(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[0]),s||(a=[U(n,"change",r[2]),U(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&Ke(n,l[0])},i:G,o:G,d(l){l&&k(e),s=!1,Te(a)}}}function sa(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=Cn(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class la extends V{constructor(e){super(),K(this,e,sa,oa,X,{style:0})}}function ni(r){let e,t,n;const i=r[3].default,o=_t(i,r,r[2],null);return{c(){e=E("div"),o&&o.c()},m(s,a){w(s,e,a),o&&o.m(e,null),n=!0},p(s,a){o&&o.p&&(!n||a&4)&&gt(o,i,s,s[2],n?yt(i,s[2],a,null):bt(s[2]),null)},i(s){n||(C(o,s),st(()=>{t||(t=kt(e,Et,{duration:100},!0)),t.run(1)}),n=!0)},o(s){L(o,s),t||(t=kt(e,Et,{duration:100},!1)),t.run(0),n=!1},d(s){s&&k(e),o&&o.d(s),s&&t&&t.end()}}}function aa(r){let e,t,n,i,o,s,a,l,u,p,d=r[0]&&ni(r);return{c(){e=E("button"),t=dn("svg"),n=dn("path"),i=A(),o=Y(r[1]),s=A(),d&&d.c(),a=ye(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-una9lq"),O(e,"aria-expanded",r[0]),O(e,"class","svelte-una9lq")},m(f,c){w(f,e,c),S(e,t),S(t,n),S(e,i),S(e,o),w(f,s,c),d&&d.m(f,c),w(f,a,c),l=!0,u||(p=U(e,"click",r[4]),u=!0)},p(f,[c]){(!l||c&2)&&Le(o,f[1]),(!l||c&1)&&O(e,"aria-expanded",f[0]),f[0]?d?(d.p(f,c),c&1&&C(d,1)):(d=ni(f),d.c(),C(d,1),d.m(a.parentNode,a)):d&&(ce(),L(d,1,1,()=>{d=null}),pe())},i(f){l||(C(d),l=!0)},o(f){L(d),l=!1},d(f){f&&k(e),f&&k(s),d&&d.d(f),f&&k(a),u=!1,p()}}}function ua(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,o=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,i=l.$$scope)},[s,o,i,n,a]}class Tn extends V{constructor(e){super(),K(this,e,ua,aa,X,{label:1,open:0})}}function fa(r){let e,t,n,i,o,s,a,l,u,p,d,f,c,h,g;return{c(){e=E("li"),t=E("span"),n=Y("Areas"),i=A(),o=E("li"),s=E("span"),a=Y("Routes"),l=A(),u=E("li"),p=E("span"),d=Y("Crossings"),f=A(),c=E("li"),h=E("span"),g=Y("Other"),O(t,"class","svelte-l42ea0"),fe(t,"background",_e.area),O(s,"class","svelte-l42ea0"),fe(s,"background",_e.route),O(p,"class","svelte-l42ea0"),fe(p,"background",_e.crossing),O(h,"class","svelte-l42ea0"),fe(h,"background",_e.other)},m(m,y){w(m,e,y),S(e,t),S(e,n),w(m,i,y),w(m,o,y),S(o,s),S(o,a),w(m,l,y),w(m,u,y),S(u,p),S(u,d),w(m,f,y),w(m,c,y),S(c,h),S(c,g)},p:G,d(m){m&&k(e),m&&k(i),m&&k(o),m&&k(l),m&&k(u),m&&k(f),m&&k(c)}}}function ca(r){let e,t,n,i,o,s,a,l,u,p,d,f,c,h,g;return{c(){e=E("li"),t=E("span"),n=Y("Preapp"),i=A(),o=E("li"),s=E("span"),a=Y("Outline"),l=A(),u=E("li"),p=E("span"),d=Y("Reserved matters"),f=A(),c=E("li"),h=E("span"),g=Y("Local plan"),O(t,"class","svelte-l42ea0"),fe(t,"background",_e.preapp),O(s,"class","svelte-l42ea0"),fe(s,"background",_e.outline),O(p,"class","svelte-l42ea0"),fe(p,"background",_e["reserved matters"]),O(h,"class","svelte-l42ea0"),fe(h,"background",_e["local plan"])},m(m,y){w(m,e,y),S(e,t),S(e,n),w(m,i,y),w(m,o,y),S(o,s),S(o,a),w(m,l,y),w(m,u,y),S(u,p),S(u,d),w(m,f,y),w(m,c,y),S(c,h),S(c,g)},p:G,d(m){m&&k(e),m&&k(i),m&&k(o),m&&k(l),m&&k(u),m&&k(f),m&&k(c)}}}function pa(r){let e;function t(o,s){return o[0]=="planning"?ca:fa}let n=t(r),i=n(r);return{c(){e=E("ul"),i.c()},m(o,s){w(o,e,s),i.m(e,null)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&k(e),i.d()}}}function da(r){let e,t,n;return t=new Tn({props:{label:"Objects",open:!0,$$slots:{default:[pa]},$$scope:{ctx:r}}}),{c(){e=E("div"),I(t.$$.fragment),O(e,"class","svelte-l42ea0")},m(i,o){w(i,e,o),B(t,e,null),n=!0},p(i,[o]){const s={};o&3&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(C(t.$$.fragment,i),n=!0)},o(i){L(t.$$.fragment,i),n=!1},d(i){i&&k(e),N(t)}}}function ha(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class ma extends V{constructor(e){super(),K(this,e,ha,da,X,{schema:0})}}let ut="interventions";function _a(r,e,t){let n,i;oe(r,Pe,p=>t(1,n=p)),oe(r,ie,p=>t(2,i=p));let{schema:o}=e;et(n,ut,i);const s=["match",["get","intervention_type"],"area",_e.area,"route",_e.route,"crossing",_e.crossing,"other",_e.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",_e.preapp,"outline",_e.outline,"reserved matters",_e["reserved matters"],"local plan",_e["local plan"],"white"],l=["!=","hide_while_editing",!0];return Me(n,{id:"interventions-points",source:ut,filter:["all",$n,l,["!=","endpoint",!0]],...Ct(s,An)}),Me(n,{id:"interventions-lines",source:ut,filter:["all",Ln,l],...wt(s,zt)}),Me(n,{id:"interventions-lines-endpoints",source:ut,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*zt,"circle-opacity":0,"circle-stroke-color":_e.lineEndpointColor,"circle-stroke-width":2}}),Me(n,{id:"interventions-polygons",source:ut,filter:["all",On,l],...Mn(o=="planning"?a:s,.5)}),r.$$set=p=>{"schema"in p&&t(0,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(i)),d=[];for(let f of p.features)if(f.geometry.type=="LineString")for(let c of[f.geometry.coordinates[0],f.geometry.coordinates[f.geometry.coordinates.length-1]])d.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:c}});p.features=p.features.concat(d),n.getSource(ut).setData(p)}},[o,n,i]}class ga extends V{constructor(e){super(),K(this,e,_a,null,X,{schema:0})}}let ft="hover";function ba(r,e,t){let n,i,o,s,a;return oe(r,Pe,l=>t(0,n=l)),oe(r,ie,l=>t(1,i=l)),oe(r,qt,l=>t(2,o=l)),oe(r,je,l=>t(3,s=l)),oe(r,$e,l=>t(4,a=l)),et(n,ft,Ne()),Me(n,{id:"hover-polygons",source:ft,filter:On,...wt(_e.hovering,.5*zt,1)}),Me(n,{id:"hover-lines",source:ft,filter:Ln,...wt(_e.hovering,1.5*zt,1)}),Me(n,{id:"hover-points",source:ft,filter:$n,...Ct(_e.hovering,1.5*An,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(ft).setData(i.features.find(u=>u.id==l)):n.getSource(ft).setData(Ne())}},[n,i,o,s,a]}class ya extends V{constructor(e){super(),K(this,e,ba,null,X,{})}}class cr{constructor(e,t){ae(this,"owner");ae(this,"map");ae(this,"mapHandlers",{});ae(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Qt="edit-point-mode";class va{constructor(e){ae(this,"map");ae(this,"active");ae(this,"eventListenersSuccess");ae(this,"eventListenersFailure");ae(this,"cursor");ae(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new cr(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),et(e,Qt,Ne()),Me(e,{id:"edit-point-mode",source:Qt,...Ct(_e.hovering,An,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=wa(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Qt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Ne();this.cursor&&e.features.push(this.cursor),this.map.getSource(Qt).setData(e)}}function wa(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Gi(r,e,t){if(t===void 0&&(t={}),t.final===!0)return ka(r,e);var n=Ve(r),i=Ve(e),o=Ie(n[0]),s=Ie(i[0]),a=Ie(n[1]),l=Ie(i[1]),u=Math.sin(s-o)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return qn(Math.atan2(u,p))}function ka(r,e){var t=Gi(e,r);return t=(t+180)%360,t}function ri(r,e,t,n){n===void 0&&(n={});var i=Ve(r),o=Ie(i[0]),s=Ie(i[1]),a=Ie(t),l=_o(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),d=qn(p),f=qn(u);return vt([d,f],n.properties)}function er(r){if(!r)throw new Error("geojson is required");var e=[];return lr(r,function(t){Sa(t,e)}),We(e)}function Sa(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ue(n);break;case"LineString":t=[Ue(n)]}t.forEach(function(i){var o=Ea(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Ea(r,e){var t=[];return r.reduce(function(n,i){var o=St([n,i],e);return o.bbox=Ma(n,i),t.push(o),i}),t}function Ma(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var Mt={},Ca={get exports(){return Mt},set exports(r){Mt=r}},tr={},$a={get exports(){return tr},set exports(r){tr=r}};(function(r,e){(function(t,n){r.exports=n()})(go,function(){function t(_,b,v,M,$){(function R(T,x,j,P,z){for(;P>j;){if(P-j>600){var H=P-j+1,Z=x-j+1,se=Math.log(H),ke=.5*Math.exp(2*se/3),Ae=.5*Math.sqrt(se*ke*(H-ke)/H)*(Z-H/2<0?-1:1),re=Math.max(j,Math.floor(x-Z*ke/H+Ae)),D=Math.min(P,Math.floor(x+(H-Z)*ke/H+Ae));R(T,x,re,D,z)}var ue=T[x],Ce=j,ee=P;for(n(T,j,x),z(T[P],ue)>0&&n(T,j,P);Ce<ee;){for(n(T,Ce,ee),Ce++,ee--;z(T[Ce],ue)<0;)Ce++;for(;z(T[ee],ue)>0;)ee--}z(T[j],ue)===0?n(T,j,ee):n(T,++ee,P),ee<=x&&(j=ee+1),x<=ee&&(P=ee-1)}})(_,b,v||0,M||_.length-1,$||i)}function n(_,b,v){var M=_[b];_[b]=_[v],_[v]=M}function i(_,b){return _<b?-1:_>b?1:0}var o=function(_){_===void 0&&(_=9),this._maxEntries=Math.max(4,_),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(_,b,v){if(!v)return b.indexOf(_);for(var M=0;M<b.length;M++)if(v(_,b[M]))return M;return-1}function a(_,b){l(_,0,_.children.length,b,_)}function l(_,b,v,M,$){$||($=m(null)),$.minX=1/0,$.minY=1/0,$.maxX=-1/0,$.maxY=-1/0;for(var R=b;R<v;R++){var T=_.children[R];u($,_.leaf?M(T):T)}return $}function u(_,b){return _.minX=Math.min(_.minX,b.minX),_.minY=Math.min(_.minY,b.minY),_.maxX=Math.max(_.maxX,b.maxX),_.maxY=Math.max(_.maxY,b.maxY),_}function p(_,b){return _.minX-b.minX}function d(_,b){return _.minY-b.minY}function f(_){return(_.maxX-_.minX)*(_.maxY-_.minY)}function c(_){return _.maxX-_.minX+(_.maxY-_.minY)}function h(_,b){return _.minX<=b.minX&&_.minY<=b.minY&&b.maxX<=_.maxX&&b.maxY<=_.maxY}function g(_,b){return b.minX<=_.maxX&&b.minY<=_.maxY&&b.maxX>=_.minX&&b.maxY>=_.minY}function m(_){return{children:_,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(_,b,v,M,$){for(var R=[b,v];R.length;)if(!((v=R.pop())-(b=R.pop())<=M)){var T=b+Math.ceil((v-b)/M/2)*M;t(_,T,b,v,$),R.push(b,T,T,v)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(_){var b=this.data,v=[];if(!g(_,b))return v;for(var M=this.toBBox,$=[];b;){for(var R=0;R<b.children.length;R++){var T=b.children[R],x=b.leaf?M(T):T;g(_,x)&&(b.leaf?v.push(T):h(_,x)?this._all(T,v):$.push(T))}b=$.pop()}return v},o.prototype.collides=function(_){var b=this.data;if(!g(_,b))return!1;for(var v=[];b;){for(var M=0;M<b.children.length;M++){var $=b.children[M],R=b.leaf?this.toBBox($):$;if(g(_,R)){if(b.leaf||h(_,R))return!0;v.push($)}}b=v.pop()}return!1},o.prototype.load=function(_){if(!_||!_.length)return this;if(_.length<this._minEntries){for(var b=0;b<_.length;b++)this.insert(_[b]);return this}var v=this._build(_.slice(),0,_.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var M=this.data;this.data=v,v=M}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},o.prototype.insert=function(_){return _&&this._insert(_,this.data.height-1),this},o.prototype.clear=function(){return this.data=m([]),this},o.prototype.remove=function(_,b){if(!_)return this;for(var v,M,$,R=this.data,T=this.toBBox(_),x=[],j=[];R||x.length;){if(R||(R=x.pop(),M=x[x.length-1],v=j.pop(),$=!0),R.leaf){var P=s(_,R.children,b);if(P!==-1)return R.children.splice(P,1),x.push(R),this._condense(x),this}$||R.leaf||!h(R,T)?M?(v++,R=M.children[v],$=!1):R=null:(x.push(R),j.push(v),v=0,M=R,R=R.children[0])}return this},o.prototype.toBBox=function(_){return _},o.prototype.compareMinX=function(_,b){return _.minX-b.minX},o.prototype.compareMinY=function(_,b){return _.minY-b.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(_){return this.data=_,this},o.prototype._all=function(_,b){for(var v=[];_;)_.leaf?b.push.apply(b,_.children):v.push.apply(v,_.children),_=v.pop();return b},o.prototype._build=function(_,b,v,M){var $,R=v-b+1,T=this._maxEntries;if(R<=T)return a($=m(_.slice(b,v+1)),this.toBBox),$;M||(M=Math.ceil(Math.log(R)/Math.log(T)),T=Math.ceil(R/Math.pow(T,M-1))),($=m([])).leaf=!1,$.height=M;var x=Math.ceil(R/T),j=x*Math.ceil(Math.sqrt(T));y(_,b,v,j,this.compareMinX);for(var P=b;P<=v;P+=j){var z=Math.min(P+j-1,v);y(_,P,z,x,this.compareMinY);for(var H=P;H<=z;H+=x){var Z=Math.min(H+x-1,z);$.children.push(this._build(_,H,Z,M-1))}}return a($,this.toBBox),$},o.prototype._chooseSubtree=function(_,b,v,M){for(;M.push(b),!b.leaf&&M.length-1!==v;){for(var $=1/0,R=1/0,T=void 0,x=0;x<b.children.length;x++){var j=b.children[x],P=f(j),z=(H=_,Z=j,(Math.max(Z.maxX,H.maxX)-Math.min(Z.minX,H.minX))*(Math.max(Z.maxY,H.maxY)-Math.min(Z.minY,H.minY))-P);z<R?(R=z,$=P<$?P:$,T=j):z===R&&P<$&&($=P,T=j)}b=T||b.children[0]}var H,Z;return b},o.prototype._insert=function(_,b,v){var M=v?_:this.toBBox(_),$=[],R=this._chooseSubtree(M,this.data,b,$);for(R.children.push(_),u(R,M);b>=0&&$[b].children.length>this._maxEntries;)this._split($,b),b--;this._adjustParentBBoxes(M,$,b)},o.prototype._split=function(_,b){var v=_[b],M=v.children.length,$=this._minEntries;this._chooseSplitAxis(v,$,M);var R=this._chooseSplitIndex(v,$,M),T=m(v.children.splice(R,v.children.length-R));T.height=v.height,T.leaf=v.leaf,a(v,this.toBBox),a(T,this.toBBox),b?_[b-1].children.push(T):this._splitRoot(v,T)},o.prototype._splitRoot=function(_,b){this.data=m([_,b]),this.data.height=_.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(_,b,v){for(var M,$,R,T,x,j,P,z=1/0,H=1/0,Z=b;Z<=v-b;Z++){var se=l(_,0,Z,this.toBBox),ke=l(_,Z,v,this.toBBox),Ae=($=se,R=ke,T=void 0,x=void 0,j=void 0,P=void 0,T=Math.max($.minX,R.minX),x=Math.max($.minY,R.minY),j=Math.min($.maxX,R.maxX),P=Math.min($.maxY,R.maxY),Math.max(0,j-T)*Math.max(0,P-x)),re=f(se)+f(ke);Ae<z?(z=Ae,M=Z,H=re<H?re:H):Ae===z&&re<H&&(H=re,M=Z)}return M||v-b},o.prototype._chooseSplitAxis=function(_,b,v){var M=_.leaf?this.compareMinX:p,$=_.leaf?this.compareMinY:d;this._allDistMargin(_,b,v,M)<this._allDistMargin(_,b,v,$)&&_.children.sort(M)},o.prototype._allDistMargin=function(_,b,v,M){_.children.sort(M);for(var $=this.toBBox,R=l(_,0,b,$),T=l(_,v-b,v,$),x=c(R)+c(T),j=b;j<v-b;j++){var P=_.children[j];u(R,_.leaf?$(P):P),x+=c(R)}for(var z=v-b-1;z>=b;z--){var H=_.children[z];u(T,_.leaf?$(H):H),x+=c(T)}return x},o.prototype._adjustParentBBoxes=function(_,b,v){for(var M=v;M>=0;M--)u(b[M],_)},o.prototype._condense=function(_){for(var b=_.length-1,v=void 0;b>=0;b--)_[b].children.length===0?b>0?(v=_[b-1].children).splice(v.indexOf(_[b]),1):this.clear():a(_[b],this.toBBox)},o})})($a);const La=ar(bo),Oa=ar(yo),Aa=ar(vo);var xe=tr,Hi=La,zi=Oa,ct=Aa.default,Ta=zi.featureEach;zi.coordEach;Hi.polygon;var ii=Hi.featureCollection;function Ji(r){var e=new xe(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ct(t),xe.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ct(i),n.push(i)}):Ta(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ct(i),n.push(i)}),xe.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ct(t),xe.prototype.remove.call(this,t,n)},e.clear=function(){return xe.prototype.clear.call(this)},e.search=function(t){var n=xe.prototype.search.call(this,this.toBBox(t));return ii(n)},e.collides=function(t){return xe.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=xe.prototype.all.call(this);return ii(t)},e.toJSON=function(){return xe.prototype.toJSON.call(this)},e.fromJSON=function(t){return xe.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ct(t);else if(t.type==="FeatureCollection")n=ct(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ca.exports=Ji;Mt.default=Ji;function Yi(r,e){var t={},n=[];if(r.type==="LineString"&&(r=kr(r)),e.type==="LineString"&&(e=kr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=oi(r,e);return i&&n.push(i),We(n)}var o=Mt();return o.load(er(e)),hn(er(r),function(s){hn(o.search(s),function(a){var l=oi(s,a);if(l){var u=Ue(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function oi(r,e){var t=Ue(r),n=Ue(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],d=n[1][1],f=(d-u)*(s-i)-(p-l)*(a-o),c=(p-l)*(o-u)-(d-u)*(i-l),h=(s-i)*(o-u)-(a-o)*(i-l);if(f===0)return c===0&&h===0,null;var g=c/f,m=h/f;if(g>=0&&g<=1&&m>=0&&m<=1){var y=i+g*(s-i),_=o+g*(a-o);return vt([y,_])}return null}function Jt(r,e,t){t===void 0&&(t={});var n=vt([1/0,1/0],{dist:1/0}),i=0;return lr(r,function(o){for(var s=Ue(o),a=0;a<s.length-1;a++){var l=vt(s[a]);l.properties.dist=Je(e,l,t);var u=vt(s[a+1]);u.properties.dist=Je(e,u,t);var p=Je(l,u,t),d=Math.max(l.properties.dist,u.properties.dist),f=Gi(l,u),c=ri(e,d,f+90,t),h=ri(e,d,f-90,t),g=Yi(St([c.geometry.coordinates,h.geometry.coordinates]),St([l.geometry.coordinates,u.geometry.coordinates])),m=null;g.features.length>0&&(m=g.features[0],m.properties.dist=Je(e,m,t),m.properties.location=i+Je(l,m,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+p),m&&m.properties.dist<n.properties.dist&&(n=m,n.properties.index=a),i+=p}}),n}const pt="edit-polygon-mode";class Ra{constructor(e){ae(this,"map");ae(this,"active");ae(this,"eventListenersSuccess");ae(this,"eventListenersFailure");ae(this,"points");ae(this,"cursor");ae(this,"hover");ae(this,"dragFrom");ae(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new cr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),et(e,pt,Ne()),Me(e,{id:"edit-polygon-fill",source:pt,filter:On,...Mn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Me(e,{id:"edit-polygon-lines",source:pt,filter:Ln,...wt("black",8,.5)}),Me(e,{id:"edit-polygon-vertices",source:pt,filter:$n,...Ct(_e.hovering,An,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(li(this.points).forEach((n,i)=>{t.push([i+1,Jt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(pt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Ne();this.points.forEach((n,i)=>{let o=si(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(li(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(pt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=si(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function si(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function li(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let Q;const He=new Array(32).fill(void 0);He.push(void 0,null,!0,!1);function W(r){return He[r]}let Dt=He.length;function Pa(r){r<36||(He[r]=Dt,Dt=r)}function nr(r){const e=W(r);return Pa(r),e}const Xi=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Xi.decode();let ln=new Uint8Array;function jt(){return ln.byteLength===0&&(ln=new Uint8Array(Q.memory.buffer)),ln}function ht(r,e){return Xi.decode(jt().subarray(r,r+e))}function Se(r){Dt===He.length&&He.push(He.length+1);const e=Dt;return Dt=He[e],He[e]=r,e}function xn(r){return r==null}let an=new Float64Array;function Fa(){return an.byteLength===0&&(an=new Float64Array(Q.memory.buffer)),an}let un=new Int32Array;function Ee(){return un.byteLength===0&&(un=new Int32Array(Q.memory.buffer)),un}let Xe=0;const fn=new TextEncoder("utf-8"),Ia=typeof fn.encodeInto=="function"?function(r,e){return fn.encodeInto(r,e)}:function(r,e){const t=fn.encode(r);return e.set(t),{read:r.length,written:t.length}};function en(r,e,t){if(t===void 0){const a=fn.encode(r),l=e(a.length);return jt().subarray(l,l+a.length).set(a),Xe=a.length,l}let n=r.length,i=e(n);const o=jt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=jt().subarray(i+s,i+n),l=Ia(r,a);s+=l.written}return Xe=s,i}function rr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=rr(r[0]));for(let s=1;s<i;s++)o+=", "+rr(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ba(r,e){const t=e(r.length*1);return jt().set(r,t/1),Xe=r.length,t}function Dn(r,e){try{return r.apply(this,e)}catch(t){Q.__wbindgen_exn_store(Se(t))}}class wn{static __wrap(e){const t=Object.create(wn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Q.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=Q.__wbindgen_add_to_stack_pointer(-16),s=Ba(e,Q.__wbindgen_malloc),a=Xe;Q.jsroutesnapper_new(o,s,a);var t=Ee()[o/4+0],n=Ee()[o/4+1],i=Ee()[o/4+2];if(i)throw nr(n);return wn.__wrap(t)}finally{Q.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){Q.jsroutesnapper_setConfig(this.ptr,Se(e))}toFinalFeature(){try{const n=Q.__wbindgen_add_to_stack_pointer(-16);Q.jsroutesnapper_toFinalFeature(n,this.ptr);var e=Ee()[n/4+0],t=Ee()[n/4+1];let i;return e!==0&&(i=ht(e,t).slice(),Q.__wbindgen_free(e,t*1)),i}finally{Q.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=Q.__wbindgen_add_to_stack_pointer(-16);Q.jsroutesnapper_renderGeojson(n,this.ptr);var e=Ee()[n/4+0],t=Ee()[n/4+1];return ht(e,t)}finally{Q.__wbindgen_add_to_stack_pointer(16),Q.__wbindgen_free(e,t)}}setSnapMode(e){Q.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return Q.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){Q.jsroutesnapper_onClick(this.ptr)}onDragStart(){return Q.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return Q.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){Q.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=Q.__wbindgen_add_to_stack_pointer(-16);Q.jsroutesnapper_editExisting(i,this.ptr,Se(e));var t=Ee()[i/4+0],n=Ee()[i/4+1];if(n)throw nr(t)}finally{Q.__wbindgen_add_to_stack_pointer(16)}}}async function Na(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function xa(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){nr(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=W(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ht(e,t));return Se(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=ht(e,t);return Se(n)},r.wbg.__wbindgen_is_object=function(e){const t=W(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return W(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return W(e)in W(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=W(t),i=typeof n=="number"?n:void 0;Fa()[e/8+1]=xn(i)?0:i,Ee()[e/4+0]=!xn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return W(e)==W(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=W(t),i=typeof n=="string"?n:void 0;var o=xn(i)?0:en(i,Q.__wbindgen_malloc,Q.__wbindgen_realloc),s=Xe;Ee()[e/4+1]=s,Ee()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(W(t)),i=en(n,Q.__wbindgen_malloc,Q.__wbindgen_realloc),o=Xe;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=W(e);return Se(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=W(e)[W(t)];return Se(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(W(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(W(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(W(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(W(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(W(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=W(e)[t>>>0];return Se(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return W(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof W(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=W(e).next;return Se(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Dn(function(e){const t=W(e).next();return Se(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return W(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=W(e).value;return Se(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return Se(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Dn(function(e,t){const n=Reflect.get(W(e),W(t));return Se(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Dn(function(e,t){const n=W(e).call(W(t));return Se(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(W(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=W(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=W(e).buffer;return Se(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(W(e));return Se(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){W(e).set(W(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return W(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=W(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Se(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=W(t).stack,i=en(n,Q.__wbindgen_malloc,Q.__wbindgen_realloc),o=Xe;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(ht(e,t))}finally{Q.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=rr(W(t)),i=en(n,Q.__wbindgen_malloc,Q.__wbindgen_realloc),o=Xe;Ee()[e/4+1]=o,Ee()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ht(e,t))},r.wbg.__wbindgen_memory=function(){const e=Q.memory;return Se(e)},r}function Da(r,e){return Q=r.exports,Wi.__wbindgen_wasm_module=e,an=new Float64Array,un=new Int32Array,ln=new Uint8Array,Q}async function Wi(r){typeof r>"u"&&(r="/atip/state-changing-bugs-142/assets/route_snapper_bg.wasm");const e=xa();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Na(await r,e);return Da(t,n)}const At="route-snapper",ai=10,ja=30;class Ua{constructor(e,t){ae(this,"map");ae(this,"inner");ae(this,"active");ae(this,"eventListenersSuccessRoute");ae(this,"eventListenersSuccessArea");ae(this,"eventListenersFailure");ae(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new wn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],et(e,At,Ne()),Me(e,{id:"route-points",source:At,filter:$n,...Ct(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",ai/2,ai])}),Me(e,{id:"route-lines",source:At,filter:Ln,...wt("black",2.5)}),Me(e,{id:"route-polygons",source:At,filter:On,...Mn("black",.5)}),this.events=new cr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-ja,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(At).setData(JSON.parse(this.inner.renderGeojson()))}}function qa(r){let e,t,n,i,o,s,a,l;return{c(){e=E("button"),t=E("img"),i=A(),o=Y(r[2]),pn(t.src,n=r[3])||O(t,"src",n),O(t,"alt",r[2]),O(t,"class","svelte-1vvpkg9"),O(e,"type","button"),e.disabled=s=r[0]==r[1],O(e,"class","svelte-1vvpkg9")},m(u,p){w(u,e,p),S(e,t),S(e,i),S(e,o),a||(l=U(e,"click",r[5]),a=!0)},p(u,[p]){p&8&&!pn(t.src,n=u[3])&&O(t,"src",n),p&4&&O(t,"alt",u[2]),p&4&&Le(o,u[2]),p&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:G,o:G,d(u){u&&k(e),a=!1,l()}}}function Ga(r,e,t){let{mode:n}=e,{thisMode:i}=e,{label:o}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(i);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,i=u.thisMode),"label"in u&&t(2,o=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,i,o,s,a,l]}class it extends V{constructor(e){super(),K(this,e,Ga,qa,X,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function ui(r){let e;function t(o,s){return o[1]?za:Ha}let n=t(r),i=n(r);return{c(){i.c(),e=ye()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&k(e)}}}function Ha(r){let e;return{c(){e=E("p"),e.textContent="Click an object to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function za(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another object"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ja(r){let e,t=r[0]==mt&&ui(r);return{c(){t&&t.c(),e=ye()},m(n,i){t&&t.m(n,i),w(n,e,i)},p(n,[i]){n[0]==mt?t?t.p(n,i):(t=ui(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&k(e)}}}const mt="edit-attribute";function Vi(){}function Ya(r,e,t){let n,i,o,s;oe(r,Pe,c=>t(5,n=c)),oe(r,ie,c=>t(6,i=c)),oe(r,Gt,c=>t(7,o=c)),oe(r,$e,c=>t(1,s=c));let{mode:a}=e,{changeMode:l}=e;function u(){$e.set(null)}n.on("mousemove",p),n.on("mouseout",d),n.on("click",f),Qe(()=>{n.off("mousemove",p),n.off("mouseout",d),n.off("click",f)});function p(c){var h;if(a==mt){let g=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});je.set(((h=g[0])==null?void 0:h.id)||null)}}function d(){a==mt&&je.set(null)}function f(c){if(a==mt){let h=n.queryRenderedFeatures(c.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});h.length>0?$e.set(h[0].id):$e.set(null)}}return r.$$set=c=>{"mode"in c&&t(0,a=c.mode),"changeMode"in c&&t(2,l=c.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let c=o;if(c){let h=i.features.find(g=>g.id==c);h.geometry.type=="Point"?n.flyTo({center:h.geometry.coordinates,duration:500}):n.fitBounds(sr(h),{padding:200,duration:500}),l(mt)}}},[a,s,l,Vi,u,n,i,o]}class Xa extends V{constructor(e){super(),K(this,e,Ya,Ja,X,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Vi}get stop(){return this.$$.ctx[4]}}function Wa(r){let e,t;return{c:G,m(n,i){e||(t=U(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function Va(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class Rn extends V{constructor(e){super(),K(this,e,Va,Wa,X,{tool:1})}}function Ka(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Za(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Qa(r){let e,t,n,i,o,s,a,l,u,p;function d(h,g){return h[1]?Za:Ka}let f=d(r),c=f(r);return a=new Rn({props:{tool:r[0]}}),{c(){e=E("ul"),c.c(),t=A(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=A(),o=E("button"),o.textContent="Cancel",s=A(),I(a.$$.fragment),O(o,"type","button")},m(h,g){w(h,e,g),c.m(e,null),S(e,t),S(e,n),w(h,i,g),w(h,o,g),w(h,s,g),B(a,h,g),l=!0,u||(p=U(o,"click",r[2]),u=!0)},p(h,[g]){f!==(f=d(h))&&(c.d(1),c=f(h),c&&(c.c(),c.m(e,t)));const m={};g&1&&(m.tool=h[0]),a.$set(m)},i(h){l||(C(a.$$.fragment,h),l=!0)},o(h){L(a.$$.fragment,h),l=!1},d(h){h&&k(e),c.d(),h&&k(i),h&&k(o),h&&k(s),N(a,h),u=!1,p()}}}function eu(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Ki extends V{constructor(e){super(),K(this,e,eu,Qa,X,{pointTool:0,editingExisting:1})}}function tu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function nu(r){let e,t,n,i,o,s,a,l,u,p,d;return e=new Tn({props:{label:"Help",$$slots:{default:[tu]},$$scope:{ctx:r}}}),l=new Rn({props:{tool:r[0]}}),{c(){I(e.$$.fragment),t=A(),n=E("div"),i=E("button"),i.textContent="Finish",o=A(),s=E("button"),s.textContent="Cancel",a=A(),I(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),fe(n,"display","flex"),fe(n,"justify-content","space-between")},m(f,c){B(e,f,c),w(f,t,c),w(f,n,c),S(n,i),S(n,o),S(n,s),w(f,a,c),B(l,f,c),u=!0,p||(d=[U(i,"click",r[1]),U(s,"click",r[2])],p=!0)},p(f,[c]){const h={};c&8&&(h.$$scope={dirty:c,ctx:f}),e.$set(h);const g={};c&1&&(g.tool=f[0]),l.$set(g)},i(f){u||(C(e.$$.fragment,f),C(l.$$.fragment,f),u=!0)},o(f){L(e.$$.fragment,f),L(l.$$.fragment,f),u=!1},d(f){N(e,f),f&&k(t),f&&k(n),f&&k(a),N(l,f),p=!1,Te(d)}}}function ru(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Zi extends V{constructor(e){super(),K(this,e,ru,nu,X,{polygonTool:0})}}function iu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function ou(r){let e,t,n,i,o,s,a,l,u,p,d;return e=new Tn({props:{label:"Help",$$slots:{default:[iu]},$$scope:{ctx:r}}}),l=new Rn({props:{tool:r[0]}}),{c(){I(e.$$.fragment),t=A(),n=E("div"),i=E("button"),i.textContent="Finish",o=A(),s=E("button"),s.textContent="Cancel",a=A(),I(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),fe(n,"display","flex"),fe(n,"justify-content","space-between")},m(f,c){B(e,f,c),w(f,t,c),w(f,n,c),S(n,i),S(n,o),S(n,s),w(f,a,c),B(l,f,c),u=!0,p||(d=[U(i,"click",r[1]),U(s,"click",r[2])],p=!0)},p(f,[c]){const h={};c&8&&(h.$$scope={dirty:c,ctx:f}),e.$set(h);const g={};c&1&&(g.tool=f[0]),l.$set(g)},i(f){u||(C(e.$$.fragment,f),C(l.$$.fragment,f),u=!0)},o(f){L(e.$$.fragment,f),L(l.$$.fragment,f),u=!1},d(f){N(e,f),f&&k(t),f&&k(n),f&&k(a),N(l,f),p=!1,Te(d)}}}function su(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Qi extends V{constructor(e){super(),K(this,e,su,ou,X,{routeTool:0})}}function lu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function au(r){let e,t,n,i,o,s,a,l,u,p,d,f,c,h,g;return e=new Tn({props:{label:"Help",$$slots:{default:[lu]},$$scope:{ctx:r}}}),f=new Rn({props:{tool:r[0]}}),{c(){I(e.$$.fragment),t=A(),n=E("label"),i=E("input"),o=Y(`
  Avoid doubling back`),s=A(),a=E("div"),l=E("button"),l.textContent="Finish",u=A(),p=E("button"),p.textContent="Cancel",d=A(),I(f.$$.fragment),O(i,"type","checkbox"),O(l,"type","button"),O(p,"type","button"),fe(a,"display","flex"),fe(a,"justify-content","space-between")},m(m,y){B(e,m,y),w(m,t,y),w(m,n,y),S(n,i),i.checked=r[1],S(n,o),w(m,s,y),w(m,a,y),S(a,l),S(a,u),S(a,p),w(m,d,y),B(f,m,y),c=!0,h||(g=[U(i,"change",r[2]),U(l,"click",r[3]),U(p,"click",r[4])],h=!0)},p(m,[y]){const _={};y&32&&(_.$$scope={dirty:y,ctx:m}),e.$set(_),y&2&&(i.checked=m[1]);const b={};y&1&&(b.tool=m[0]),f.$set(b)},i(m){c||(C(e.$$.fragment,m),C(f.$$.fragment,m),c=!0)},o(m){L(e.$$.fragment,m),L(f.$$.fragment,m),c=!1},d(m){N(e,m),m&&k(t),m&&k(n),m&&k(s),m&&k(a),m&&k(d),N(f,m),h=!1,Te(g)}}}function uu(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class eo extends V{constructor(e){super(),K(this,e,uu,au,X,{routeTool:0})}}function fi(r){let e,t,n,i;const o=[hu,du,pu,cu,fu],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=ye()},m(l,u){s[e].m(l,u),w(l,n,u),i=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(ce(),L(s[p],1,1,()=>{s[p]=null}),pe(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),C(t,1),t.m(n.parentNode,n))},i(l){i||(C(t),i=!0)},o(l){L(t),i=!1},d(l){s[e].d(l),l&&k(n)}}}function fu(r){let e;return{c(){e=E("p"),e.textContent="Click an object to edit its geometry"},m(t,n){w(t,e,n)},p:G,i:G,o:G,d(t){t&&k(e)}}}function cu(r){let e,t;return e=new eo({props:{routeTool:r[3]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function pu(r){let e,t;return e=new Qi({props:{routeTool:r[3]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function du(r){let e,t;return e=new Zi({props:{polygonTool:r[2]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function hu(r){let e,t;return e=new Ki({props:{pointTool:r[1],editingExisting:!0}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function mu(r){let e,t,n=r[0]==qe&&fi(r);return{c(){n&&n.c(),e=ye()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==qe?n?(n.p(i,o),o&1&&C(n,1)):(n=fi(i),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(ce(),L(n,1,1,()=>{n=null}),pe())},i(i){t||(C(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const qe="edit-geometry";function to(){}function _u(r,e,t){let n;oe(r,Pe,g=>t(8,n=g));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(o.stop(),s.stop(),a.stop(),ie.update(g=>{let m=g.features.find(y=>y.id==l);return delete m.properties.hide_while_editing,g})),l=null,t(4,u=null),je.set(null)}n.on("mousemove",d),n.on("mouseout",f),n.on("click",c),Qe(()=>{n.off("mousemove",d),n.off("mouseout",f),n.off("click",c)}),a.addEventListenerSuccessRoute(g=>{i==qe&&(ie.update(m=>{let y=m.features.find(_=>_.id==l);return y.properties.length_meters=g.properties.length_meters,y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,m}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{i==qe&&(ie.update(m=>{let y=m.features.find(_=>_.id==l);return y.properties.waypoints=g.properties.waypoints,delete y.properties.hide_while_editing,y.geometry=g.geometry,m}),l=null,t(4,u=null))});for(let g of[o,s])g.addEventListenerSuccess(m=>{i==qe&&(ie.update(y=>{let _=y.features.find(b=>b.id==l);return _.geometry=m.geometry,delete _.properties.hide_while_editing,y}),l=null,t(4,u=null))});for(let g of[o,s,a])g.addEventListenerFailure(()=>{i==qe&&(ie.update(m=>{let y=m.features.find(_=>_.id==l);return delete y.properties.hide_while_editing,m}),l=null,t(4,u=null))});function d(g){var m;if(i==qe&&l==null){let y=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});je.set(((m=y[0])==null?void 0:m.id)||null)}}function f(){i==qe&&l==null&&je.set(null)}function c(g){if(i==qe&&l==null){let m=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0&&h(m[0].id)}}function h(g){je.set(null);let m=null;ie.update(_=>(m=_.features.find(b=>b.id==g),m.properties.hide_while_editing=!0,_));let y=m;l=g,y.geometry.type=="LineString"?(a.editExistingRoute(y),t(4,u="route")):y.geometry.type=="Polygon"?y.properties.waypoints?(a.editExistingArea(y),t(4,u="snap-polygon")):(s.editExisting(y),t(4,u="free-polygon")):y.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"pointTool"in g&&t(1,o=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[i,o,s,a,u,to,p]}class gu extends V{constructor(e){super(),K(this,e,_u,mu,X,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return to}get stop(){return this.$$.ctx[6]}}async function bu(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),o+=p.length;const d=100*o/i;e.style=`background: linear-gradient(to right, red ${d}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function yu(r){let e,t;return e=new eo({props:{routeTool:r[0]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function vu(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&k(e),r[7](null)}}}function wu(r){let e,t,n,i;const o=[vu,yu],s=[];function a(l,u){return l[0]?l[1]==ir?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=ye()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),i=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(ce(),L(s[p],1,1,()=>{s[p]=null}),pe()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),C(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||(C(t),i=!0)},o(l){L(t),i=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const ir="route";function ku(r,e,t){let n;oe(r,Pe,f=>t(8,n=f));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}Yt(async()=>{await Wi(),console.log(`Grabbing ${s}`);try{const f=await bu(s,a);t(0,l=new Ua(n,f))}catch(f){console.log(`Route tool broke: ${f}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==ir&&o("edit-attribute")}),l.addEventListenerSuccessRoute(f=>{i==ir&&(ie.update(c=>(f.id=Xt(c),f.properties.intervention_type="route",c.features.push(f),c)),o("edit-attribute"),$e.set(f.id))})});function d(f){le[f?"unshift":"push"](()=>{a=f,t(2,a)})}return r.$$set=f=>{"mode"in f&&t(1,i=f.mode),"changeMode"in f&&t(3,o=f.changeMode),"url"in f&&t(4,s=f.url),"routeTool"in f&&t(0,l=f.routeTool)},[l,i,a,o,s,u,p,d]}class Su extends V{constructor(e){super(),K(this,e,ku,wu,X,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function ci(r){let e,t;return e=new Ki({props:{pointTool:r[1],editingExisting:!1}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Eu(r){let e,t,n=r[0]==kn&&ci(r);return{c(){n&&n.c(),e=ye()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==kn?n?(n.p(i,o),o&1&&C(n,1)):(n=ci(i),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(ce(),L(n,1,1,()=>{n=null}),pe())},i(i){t||(C(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const kn="point";function Mu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==kn&&(ie.update(u=>(l.id=Xt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),$e.set(l.id))}),o.addEventListenerFailure(()=>{n==kn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class Cu extends V{constructor(e){super(),K(this,e,Mu,Eu,X,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function pi(r){let e,t;return e=new Zi({props:{polygonTool:r[1]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function $u(r){let e,t,n=r[0]==Sn&&pi(r);return{c(){n&&n.c(),e=ye()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==Sn?n?(n.p(i,o),o&1&&C(n,1)):(n=pi(i),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(ce(),L(n,1,1,()=>{n=null}),pe())},i(i){t||(C(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const Sn="free-polygon";function Lu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Sn&&(ie.update(u=>(l.id=Xt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),$e.set(l.id))}),o.addEventListenerFailure(()=>{n==Sn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Ou extends V{constructor(e){super(),K(this,e,Lu,$u,X,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function di(r){let e,t;return e=new Qi({props:{routeTool:r[1]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Au(r){let e,t,n=r[0]==En&&di(r);return{c(){n&&n.c(),e=ye()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==En?n?(n.p(i,o),o&1&&C(n,1)):(n=di(i),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(ce(),L(n,1,1,()=>{n=null}),pe())},i(i){t||(C(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const En="snap-polygon";function Tu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==En&&(ie.update(u=>(l.id=Xt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),$e.set(l.id))}),o.addEventListenerFailure(()=>{n==En&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class Ru extends V{constructor(e){super(),K(this,e,Tu,Au,X,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Pu(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Je(r.slice(0,2),[n,t]),s=Je(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Fu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return wo(r,function(s){Iu(s,o,n)}),r}function Iu(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Bu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Qn(r),n=Qn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Fu(e,{precision:7});switch(n){case"Point":return or(r,i);case"MultiPoint":return hi(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return hi(r,Yi(r,i))}}function hi(r,e){var t=[],n=Mt();return lr(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=or(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=Pu(ko(a)))}),n.load(We(t));else{var o=n.search(i);if(o.features.length){var s=no(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),hn(or(s,i),function(a){t.push(a),n.insert(a)})}}}),We(t)}function or(r,e){var t=[],n=Ue(r)[0],i=Ue(r)[r.geometry.coordinates.length-1];if(jn(n,Ve(e))||jn(i,Ve(e)))return We([r]);var o=Mt(),s=er(r);o.load(s);var a=o.search(e);if(!a.features.length)return We([r]);var l=no(e,a),u=[n],p=So(s,function(d,f,c){var h=Ue(f)[1],g=Ve(e);return c===l.id?(d.push(g),t.push(St(d)),jn(g,h)?[g]:[g,h]):(d.push(h),d)},u);return p.length>1&&t.push(St(p)),We(t)}function no(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return hn(e,function(i){var o=Jt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function jn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Nu(r,e,t){var n=Ue(t);if(Qn(t)!=="LineString")throw new Error("line must be a LineString");var i=Jt(t,r),o=Jt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),St(a,t.properties)}function mi(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function xu(r){let e,t,n,i=r[0]==Ut&&mi();return{c(){i&&i.c(),e=ye()},m(o,s){i&&i.m(o,s),w(o,e,s),t||(n=U(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Ut?i||(i=mi(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:G,o:G,d(o){i&&i.d(o),o&&k(e),t=!1,n()}}}const Ut="split-route",Du=10,ju=30;let Un="split-route";function ro(){}function _i(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Uu(r,e,t){let n,i;oe(r,ie,g=>t(8,n=g)),oe(r,Pe,g=>t(6,i=g));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",p),i.on("click",d),Qe(()=>{i.off("mousemove",p),i.off("click",d)}),et(i,Un,Ne()),Me(i,{id:"draw-split-route",source:Un,...Ct("black",Du,["case",["==",["get","snapped"],!0],1,.5])});function p(g){if(o!=Ut)return;t(5,l=_i(g.lngLat.toArray(),!1)),u=null;const m=[g.point.x-ju,g.point.y],y=i.unproject(g.point).distanceTo(i.unproject(m))/1e3;let _=[];for(let[b,v]of n.features.entries())if(v.geometry.type=="LineString"){let M=Jt(v.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=y&&_.push([b,M.geometry.coordinates,M.properties.dist])}_.sort((b,v)=>b[2]-v[2]),_.length>0&&(t(5,l=_i(_[0][1],!0)),u=_[0][0])}function d(){if(o==Ut)if(u==null)s("edit-attribute");else{let g=Bu(n.features[u],l);if(g.features.length==2){let m=g.features[0],y=g.features[1];ie.update(_=>(m.id=_.features[u].id,y.id=Xt(_),m.properties=JSON.parse(JSON.stringify(_.features[u].properties)),y.properties=JSON.parse(JSON.stringify(m.properties)),f(_.features[u],m,y,l),_.features.splice(u,1,m,y),_))}a()}}function f(g,m,y,_){m.properties.length_meters=sn(m,{units:"kilometers"})*1e3,y.properties.length_meters=sn(y,{units:"kilometers"})*1e3,m.properties.waypoints=[],y.properties.waypoints=[];let b=c(g,_),v=!0,M=0;for(let $ of g.properties.waypoints){let R=c(g,vt([$.lon,$.lat]));if(v)if(R<b)m.properties.waypoints.push($);else{let T=$.snapped&&g.properties.waypoints[M-1].snapped;m.properties.waypoints.push({lon:_.geometry.coordinates[0],lat:_.geometry.coordinates[1],snapped:T}),v=!1,y.properties.waypoints.push({lon:_.geometry.coordinates[0],lat:_.geometry.coordinates[1],snapped:T}),y.properties.waypoints.push($)}else y.properties.waypoints.push($);M++}}function c(g,m){let y=g.geometry.coordinates[0],_=Nu(y,m,g);return sn(_,{units:"kilometers"})*1e3}function h(g){o==Ut&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=Ne();l&&g.features.push(l),i.getSource(Un).setData(g)}},[o,h,s,ro,a,l,i]}class qu extends V{constructor(e){super(),K(this,e,Uu,xu,X,{mode:0,changeMode:2,start:3,stop:4})}get start(){return ro}get stop(){return this.$$.ctx[4]}}const Gu="/atip/state-changing-bugs-142/assets/edit_attributes-29b396e1.svg",Hu="/atip/state-changing-bugs-142/assets/edit_geometry-02dad294.svg",zu="/atip/state-changing-bugs-142/assets/point-276f4055.svg",Ju="/atip/state-changing-bugs-142/assets/polygon_snapped-18efbbea.svg",Yu="/atip/state-changing-bugs-142/assets/polygon_freehand-cf965967.svg",Xu="/atip/state-changing-bugs-142/assets/route-d3c0ebad.svg",Wu="/atip/state-changing-bugs-142/assets/split_route-9e0ea2da.svg";function gi(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new gu({props:n}),r[15](e),{c(){I(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){r[15](null),N(e,i)}}}function bi(r){let e,t;return e=new it({props:{mode:r[3],thisMode:"point",label:"New point",icon:zu,changeMode:r[13]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function yi(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Ru({props:n}),r[18](e),{c(){I(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){r[18](null),N(e,i)}}}function vi(r){let e,t;return e=new it({props:{mode:r[3],thisMode:"route",label:"New route",icon:Xu,changeMode:r[13]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function wi(r){let e,t;return e=new it({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:Wu,changeMode:r[13]}}),{c(){I(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){N(e,n)}}}function Vu(r){let e,t,n,i,o,s,a,l,u,p,d,f,c,h,g,m,y,_,b,v,M,$,R,T,x,j,P,z,H,Z,se,ke;n=new it({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:Gu,changeMode:r[13]}});let Ae={mode:r[3],changeMode:r[13]};o=new Xa({props:Ae}),r[14](o),l=new it({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:Hu,changeMode:r[13]}});let re=r[2]&&gi(r),D=r[1]!="planning"&&bi(r),ue={mode:r[3],changeMode:r[13],pointTool:r[11]};c=new Cu({props:ue}),r[16](c),m=new it({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:Yu,changeMode:r[13]}});let Ce={mode:r[3],changeMode:r[13],polygonTool:r[12]};_=new Ou({props:Ce}),r[17](_),M=new it({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:Ju,changeMode:r[13]}});let ee=r[2]&&yi(r),me=r[1]!="planning"&&vi(r);function Vt(q){r[20](q)}let ge={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(ge.routeTool=r[2]),j=new Su({props:ge}),r[19](j),le.push(()=>ve(j,"routeTool",Vt,r[2]));let F=r[1]!="planning"&&wi(r),ne={mode:r[3],changeMode:r[13]};return se=new qu({props:ne}),r[21](se),{c(){e=E("div"),t=E("div"),I(n.$$.fragment),i=A(),I(o.$$.fragment),s=A(),a=E("div"),I(l.$$.fragment),u=A(),re&&re.c(),p=A(),d=E("div"),D&&D.c(),f=A(),I(c.$$.fragment),h=A(),g=E("div"),I(m.$$.fragment),y=A(),I(_.$$.fragment),b=A(),v=E("div"),I(M.$$.fragment),$=A(),ee&&ee.c(),R=A(),T=E("div"),me&&me.c(),x=A(),I(j.$$.fragment),z=A(),H=E("div"),F&&F.c(),Z=A(),I(se.$$.fragment),O(e,"class","toolbox svelte-4s4d3o")},m(q,de){w(q,e,de),S(e,t),B(n,t,null),S(t,i),B(o,t,null),S(e,s),S(e,a),B(l,a,null),S(a,u),re&&re.m(a,null),S(e,p),S(e,d),D&&D.m(d,null),S(d,f),B(c,d,null),S(e,h),S(e,g),B(m,g,null),S(g,y),B(_,g,null),S(e,b),S(e,v),B(M,v,null),S(v,$),ee&&ee.m(v,null),S(e,R),S(e,T),me&&me.m(T,null),S(T,x),B(j,T,null),S(e,z),S(e,H),F&&F.m(H,null),S(H,Z),B(se,H,null),ke=!0},p(q,[de]){const pr={};de&8&&(pr.mode=q[3]),n.$set(pr);const dr={};de&8&&(dr.mode=q[3]),o.$set(dr);const hr={};de&8&&(hr.mode=q[3]),l.$set(hr),q[2]?re?(re.p(q,de),de&4&&C(re,1)):(re=gi(q),re.c(),C(re,1),re.m(a,null)):re&&(ce(),L(re,1,1,()=>{re=null}),pe()),q[1]!="planning"?D?(D.p(q,de),de&2&&C(D,1)):(D=bi(q),D.c(),C(D,1),D.m(d,f)):D&&(ce(),L(D,1,1,()=>{D=null}),pe());const mr={};de&8&&(mr.mode=q[3]),c.$set(mr);const _r={};de&8&&(_r.mode=q[3]),m.$set(_r);const gr={};de&8&&(gr.mode=q[3]),_.$set(gr);const br={};de&8&&(br.mode=q[3]),M.$set(br),q[2]?ee?(ee.p(q,de),de&4&&C(ee,1)):(ee=yi(q),ee.c(),C(ee,1),ee.m(v,null)):ee&&(ce(),L(ee,1,1,()=>{ee=null}),pe()),q[1]!="planning"?me?(me.p(q,de),de&2&&C(me,1)):(me=vi(q),me.c(),C(me,1),me.m(T,x)):me&&(ce(),L(me,1,1,()=>{me=null}),pe());const Kt={};de&8&&(Kt.mode=q[3]),de&1&&(Kt.url=q[0]),!P&&de&4&&(P=!0,Kt.routeTool=q[2],we(()=>P=!1)),j.$set(Kt),q[1]!="planning"?F?(F.p(q,de),de&2&&C(F,1)):(F=wi(q),F.c(),C(F,1),F.m(H,Z)):F&&(ce(),L(F,1,1,()=>{F=null}),pe());const yr={};de&8&&(yr.mode=q[3]),se.$set(yr)},i(q){ke||(C(n.$$.fragment,q),C(o.$$.fragment,q),C(l.$$.fragment,q),C(re),C(D),C(c.$$.fragment,q),C(m.$$.fragment,q),C(_.$$.fragment,q),C(M.$$.fragment,q),C(ee),C(me),C(j.$$.fragment,q),C(F),C(se.$$.fragment,q),ke=!0)},o(q){L(n.$$.fragment,q),L(o.$$.fragment,q),L(l.$$.fragment,q),L(re),L(D),L(c.$$.fragment,q),L(m.$$.fragment,q),L(_.$$.fragment,q),L(M.$$.fragment,q),L(ee),L(me),L(j.$$.fragment,q),L(F),L(se.$$.fragment,q),ke=!1},d(q){q&&k(e),N(n),r[14](null),N(o),N(l),re&&re.d(),D&&D.d(),r[16](null),N(c),N(m),r[17](null),N(_),N(M),ee&&ee.d(),me&&me.d(),r[19](null),N(j),F&&F.d(),r[21](null),N(se)}}}function Ku(r,e,t){let n;oe(r,Pe,P=>t(22,n=P));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new va(n),l=new Ra(n),u="edit-attribute",p,d,f,c,h,g,m;const y=Gn.subscribe(P=>t(3,u=P));function _(P){let z={"edit-attribute":p,"edit-geometry":d,route:f,point:c,"free-polygon":h,"snap-polygon":g,"split-route":m};if(u==P){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),z[u].stop(),Gn.set(P),console.log(`Starting new mode ${u}`),z[P].start()}Qe(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown(),y()});function b(P){le[P?"unshift":"push"](()=>{p=P,t(4,p)})}function v(P){le[P?"unshift":"push"](()=>{d=P,t(5,d)})}function M(P){le[P?"unshift":"push"](()=>{c=P,t(7,c)})}function $(P){le[P?"unshift":"push"](()=>{h=P,t(8,h)})}function R(P){le[P?"unshift":"push"](()=>{g=P,t(9,g)})}function T(P){le[P?"unshift":"push"](()=>{f=P,t(6,f)})}function x(P){s=P,t(2,s)}function j(P){le[P?"unshift":"push"](()=>{m=P,t(10,m)})}return r.$$set=P=>{"routeSnapperUrl"in P&&t(0,i=P.routeSnapperUrl),"schema"in P&&t(1,o=P.schema)},[i,o,s,u,p,d,f,c,h,g,m,a,l,_,b,v,M,$,R,T,x,j]}class Zu extends V{constructor(e){super(),K(this,e,Ku,Vu,X,{routeSnapperUrl:0,schema:1})}}function Qu(r){let e,t,n,i,o,s,a,l,u,p,d,f,c,h,g,m,y,_,b;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",i=A(),o=E("button"),o.textContent="About",s=A(),a=E("button"),a.textContent="Instructions",l=A(),u=E("br"),p=A(),d=E("label"),f=Y(`ATIP schema:
      `),c=E("select"),h=E("option"),h.textContent="v1",g=E("option"),g.textContent="v2",m=E("option"),m.textContent="Housing developments",y=E("option"),y.textContent="Critical issues",O(n,"type","button"),O(o,"type","button"),O(a,"type","button"),h.__value="v1",h.value=h.__value,g.__value="v2",g.value=g.__value,m.__value="planning",m.value=m.__value,y.__value="criticals",y.value=y.__value,r[2]===void 0&&st(()=>r[11].call(c)),O(e,"slot","nav")},m(v,M){w(v,e,M),S(e,t),S(t,n),S(t,i),S(t,o),S(t,s),S(t,a),S(e,l),S(e,u),S(e,p),S(e,d),S(d,f),S(d,c),S(c,h),S(c,g),S(c,m),S(c,y),Ke(c,r[2]),_||(b=[U(n,"click",r[10]),U(o,"click",r[7]),U(a,"click",r[8]),U(c,"change",r[11]),U(c,"change",r[9])],_=!0)},p(v,M){M&4&&Ke(c,v[2])},d(v){v&&k(e),_=!1,Te(b)}}}function ef(r){let e,t,n,i,o,s,a,l,u,p,d,f,c,h,g,m;return o=new ia({props:{boundaryGeojson:r[4]}}),a=new ea({props:{authorityName:r[5],schema:r[2]}}),d=new ql({props:{schema:r[2]}}),g=new zl({}),{c(){e=E("div"),t=E("h1"),n=Y(r[5]),i=A(),I(o.$$.fragment),s=A(),I(a.$$.fragment),l=A(),u=E("br"),p=A(),I(d.$$.fragment),f=A(),c=E("hr"),h=A(),I(g.$$.fragment),O(e,"slot","sidebar")},m(y,_){w(y,e,_),S(e,t),S(t,n),S(t,i),B(o,t,null),S(e,s),B(a,e,null),S(e,l),S(e,u),S(e,p),B(d,e,null),S(e,f),S(e,c),S(e,h),B(g,e,null),m=!0},p(y,_){const b={};_&16&&(b.boundaryGeojson=y[4]),o.$set(b);const v={};_&4&&(v.schema=y[2]),a.$set(v);const M={};_&4&&(M.schema=y[2]),d.$set(M)},i(y){m||(C(o.$$.fragment,y),C(a.$$.fragment,y),C(d.$$.fragment,y),C(g.$$.fragment,y),m=!0)},o(y){L(o.$$.fragment,y),L(a.$$.fragment,y),L(d.$$.fragment,y),L(g.$$.fragment,y),m=!1},d(y){y&&k(e),N(o),N(a),N(d),N(g)}}}function tf(r){let e,t,n,i,o,s,a,l,u,p,d,f;return e=new Ps({props:{boundaryGeojson:r[4]}}),n=new ga({props:{schema:r[2]}}),o=new ya({}),a=new Zu({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new la({props:{style:r[6]}}),d=new ma({props:{schema:r[2]}}),{c(){I(e.$$.fragment),t=A(),I(n.$$.fragment),i=A(),I(o.$$.fragment),s=A(),I(a.$$.fragment),l=A(),I(u.$$.fragment),p=A(),I(d.$$.fragment)},m(c,h){B(e,c,h),w(c,t,h),B(n,c,h),w(c,i,h),B(o,c,h),w(c,s,h),B(a,c,h),w(c,l,h),B(u,c,h),w(c,p,h),B(d,c,h),f=!0},p(c,h){const g={};h&16&&(g.boundaryGeojson=c[4]),e.$set(g);const m={};h&4&&(m.schema=c[2]),n.$set(m);const y={};h&8&&(y.routeSnapperUrl=c[3]),h&4&&(y.schema=c[2]),a.$set(y);const _={};h&4&&(_.schema=c[2]),d.$set(_)},i(c){f||(C(e.$$.fragment,c),C(n.$$.fragment,c),C(o.$$.fragment,c),C(a.$$.fragment,c),C(u.$$.fragment,c),C(d.$$.fragment,c),f=!0)},o(c){L(e.$$.fragment,c),L(n.$$.fragment,c),L(o.$$.fragment,c),L(a.$$.fragment,c),L(u.$$.fragment,c),L(d.$$.fragment,c),f=!1},d(c){N(e,c),c&&k(t),N(n,c),c&&k(i),N(o,c),c&&k(s),N(a,c),c&&k(l),N(u,c),c&&k(p),N(d,c)}}}function nf(r){let e,t,n;return t=new es({props:{style:r[6],$$slots:{default:[tf]},$$scope:{ctx:r}}}),{c(){e=E("div"),I(t.$$.fragment),O(e,"slot","main")},m(i,o){w(i,e,o),B(t,e,null),n=!0},p(i,o){const s={};o&524316&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||(C(t.$$.fragment,i),n=!0)},o(i){L(t.$$.fragment,i),n=!1},d(i){i&&k(e),N(t)}}}function rf(r){let e,t,n,i,o,s,a,l;e=new ss({props:{$$slots:{main:[nf],sidebar:[ef],nav:[Qu]},$$scope:{ctx:r}}});function u(c){r[12](c)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new Eo({props:p}),le.push(()=>ve(n,"open",u,r[0]));function d(c){r[13](c)}let f={};return r[1]!==void 0&&(f.open=r[1]),s=new Ko({props:f}),le.push(()=>ve(s,"open",d,r[1])),{c(){I(e.$$.fragment),t=A(),I(n.$$.fragment),o=A(),I(s.$$.fragment)},m(c,h){B(e,c,h),w(c,t,h),B(n,c,h),w(c,o,h),B(s,c,h),l=!0},p(c,[h]){const g={};h&524316&&(g.$$scope={dirty:h,ctx:c}),e.$set(g);const m={};!i&&h&1&&(i=!0,m.open=c[0],we(()=>i=!1)),n.$set(m);const y={};!a&&h&2&&(a=!0,y.open=c[1],we(()=>a=!1)),s.$set(y)},i(c){l||(C(e.$$.fragment,c),C(n.$$.fragment,c),C(s.$$.fragment,c),l=!0)},o(c){L(e.$$.fragment,c),L(n.$$.fragment,c),L(s.$$.fragment,c),l=!1},d(c){N(e,c),c&&k(t),N(n,c),c&&k(o),N(s,c)}}}function of(r,e,t){let n;oe(r,mn,$=>t(15,n=$));let i=!1,o=!1,s=window.location.hostname.includes("atip.uk");const a=new URLSearchParams(window.location.search);let l=a.get("authority"),u=a.get("style")||"streets",p=a.get("schema")||"v1";var d=`https://atip.uk/route-snappers/${l}.bin`,f=`https://atip.uk/route-info/${l}.bin`;s||(d=`https://atip.uk/route-snappers-dev/${l}.bin`,f=`https://atip.uk/route-info-dev/${l}.bin`);function c(){t(0,i=!i),t(1,o=!1)}function h(){t(1,o=!o),t(0,i=!1)}let g;Yt(async()=>{t(4,g=await m());const $=Li(new xo);mn.set(await new $),await n.loadFile(f)});async function m(){const R=await(await fetch(Mo)).text(),T=JSON.parse(R);return T.features=T.features.filter(x=>{var j;return((j=x.properties)==null?void 0:j.name)==l}),T}function y(){let $=new URLSearchParams(window.location.search);$.set("schema",p);let R=`${window.location.pathname}?${$.toString()}${window.location.hash}`;window.location.href=R}const _=()=>window.open("index.html");function b(){p=Cn(this),t(2,p)}function v($){i=$,t(0,i)}function M($){o=$,t(1,o)}return[i,o,p,d,g,l,u,c,h,y,_,b,v,M]}class sf extends V{constructor(e){super(),K(this,e,of,rf,X,{})}}new sf({target:document.getElementById("app")});
