var ro=Object.defineProperty;var io=(r,e,t)=>e in r?ro(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var se=(r,e,t)=>(io(r,typeof e!="symbol"?e+"":e,t),t);import{x as G,s as Y,y as xe,S as W,i as V,M as wi,b as le,a as we,d as N,m as B,k as ke,n as $,o as O,q as D,e as E,c as C,g as w,p as k,f as L,z as fe,B as ce,C as oo,D as Yt,E as tn,F as it,G as _t,H as gt,I as bt,J as vt,K as vr,h as S,l as U,L as so,N as lo,O as re,P as ao,w as or,Q as Qe,R as Se,T as Mn,U as cn,V as ue,t as J,W as $e,X as pn,Y as wt,Z as be,_ as ot,$ as Ke,a0 as $n,j as Ae,r as Ce,a1 as ki,a2 as kt,a3 as dn,a4 as yr,a5 as uo,a6 as fo,a7 as Fe,a8 as co,a9 as po,aa as Ln,ab as $t,ac as On,ad as Cn,ae as qn,af as ho,ag as yt,ah as sr,ai as We,aj as St,ak as mo,al as lr,am as _o,an as go,ao as bo,ap as wr,aq as hn,ar as vo,as as yo,at as wo,au as ko,A as So,u as Eo}from"./authorities-b8f51a0a.js";const lt=[];function st(r,e=G){let t;const n=new Set;function i(a){if(Y(r,a)&&(r=a,t)){const l=!lt.length;for(const u of n)u[1](),lt.push(u,r);if(l){for(let u=0;u<lt.length;u+=2)lt[u][0](lt[u+1]);lt.length=0}}}function o(a){i(a(r))}function s(a,l=G){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||G),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Te=st(null),mn=st(null),ne=st(xe()),Ee=st(null),je=st(null),qt=st(null),Gt=st(null);function Xt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function kr(r){console.log(`Deleting intervention ${r}`),ne.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),Ee.set(null),je.set(null),qt.set(null),Gt.set(null)}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Si=Symbol("Comlink.proxy"),Mo=Symbol("Comlink.endpoint"),$o=Symbol("Comlink.releaseProxy"),Pn=Symbol("Comlink.finalizer"),nn=Symbol("Comlink.thrown"),Ei=r=>typeof r=="object"&&r!==null||typeof r=="function",Lo={canHandle:r=>Ei(r)&&r[Si],serialize(r){const{port1:e,port2:t}=new MessageChannel;return ar(r,e),[t,[t]]},deserialize(r){return r.start(),Li(r)}},Oo={canHandle:r=>Ei(r)&&nn in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},Mi=new Map([["proxy",Lo],["throw",Oo]]);function Co(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function ar(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!Co(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(et);let u;try{const c=a.slice(0,-1).reduce((f,p)=>f[p],r),d=a.reduce((f,p)=>f[p],r);switch(s){case"GET":u=d;break;case"SET":c[a.slice(-1)[0]]=et(i.data.value),u=!0;break;case"APPLY":u=d.apply(c,l);break;case"CONSTRUCT":{const f=new d(...l);u=Io(f)}break;case"ENDPOINT":{const{port1:f,port2:p}=new MessageChannel;ar(r,p),u=Fo(f,[f])}break;case"RELEASE":u=void 0;break;default:return}}catch(c){u={value:c,[nn]:0}}Promise.resolve(u).catch(c=>({value:c,[nn]:0})).then(c=>{const[d,f]=bn(c);e.postMessage(Object.assign(Object.assign({},d),{id:o}),f),s==="RELEASE"&&(e.removeEventListener("message",n),$i(e),Pn in r&&typeof r[Pn]=="function"&&r[Pn]())}).catch(c=>{const[d,f]=bn({value:new TypeError("Unserializable return value"),[nn]:0});e.postMessage(Object.assign(Object.assign({},d),{id:o}),f)})}),e.start&&e.start()}function Ao(r){return r.constructor.name==="MessagePort"}function $i(r){Ao(r)&&r.close()}function Li(r,e){return Gn(r,[],e)}function Zt(r){if(r)throw new Error("Proxy has been released and is not useable")}function Oi(r){return dt(r,{type:"RELEASE"}).then(()=>{$i(r)})}const _n=new WeakMap,gn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(_n.get(r)||0)-1;_n.set(r,e),e===0&&Oi(r)});function To(r,e){const t=(_n.get(e)||0)+1;_n.set(e,t),gn&&gn.register(r,e,r)}function Ro(r){gn&&gn.unregister(r)}function Gn(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(Zt(n),s===$o)return()=>{Ro(i),Oi(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=dt(r,{type:"GET",path:e.map(l=>l.toString())}).then(et);return a.then.bind(a)}return Gn(r,[...e,s])},set(o,s,a){Zt(n);const[l,u]=bn(a);return dt(r,{type:"SET",path:[...e,s].map(c=>c.toString()),value:l},u).then(et)},apply(o,s,a){Zt(n);const l=e[e.length-1];if(l===Mo)return dt(r,{type:"ENDPOINT"}).then(et);if(l==="bind")return Gn(r,e.slice(0,-1));const[u,c]=Sr(a);return dt(r,{type:"APPLY",path:e.map(d=>d.toString()),argumentList:u},c).then(et)},construct(o,s){Zt(n);const[a,l]=Sr(s);return dt(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(et)}});return To(i,r),i}function Po(r){return Array.prototype.concat.apply([],r)}function Sr(r){const e=r.map(bn);return[e.map(t=>t[0]),Po(e.map(t=>t[1]))]}const Ci=new WeakMap;function Fo(r,e){return Ci.set(r,e),r}function Io(r){return Object.assign(r,{[Si]:!0})}function bn(r){for(const[e,t]of Mi)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},Ci.get(r)||[]]}function et(r){switch(r.type){case"HANDLER":return Mi.get(r.name).deserialize(r.value);case"RAW":return r.value}}function dt(r,e,t){return new Promise(n=>{const i=xo();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function xo(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function No(){return new Worker("/atip/state-changing-bugs-142/assets/worker-84d6db03.js")}let ee;const Ai=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Ai.decode();let Tt=null;function xt(){return(Tt===null||Tt.byteLength===0)&&(Tt=new Uint8Array(ee.memory.buffer)),Tt}function tt(r,e){return r=r>>>0,Ai.decode(xt().subarray(r,r+e))}const Ge=new Array(128).fill(void 0);Ge.push(void 0,null,!0,!1);let Nt=Ge.length;function ge(r){Nt===Ge.length&&Ge.push(Ge.length+1);const e=Nt;return Nt=Ge[e],Ge[e]=r,e}function z(r){return Ge[r]}let rt=0;const rn=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Bo=typeof rn.encodeInto=="function"?function(r,e){return rn.encodeInto(r,e)}:function(r,e){const t=rn.encode(r);return e.set(t),{read:r.length,written:t.length}};function Fn(r,e,t){if(t===void 0){const a=rn.encode(r),l=e(a.length)>>>0;return xt().subarray(l,l+a.length).set(a),rt=a.length,l}let n=r.length,i=e(n)>>>0;const o=xt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3)>>>0;const a=xt().subarray(i+s,i+n),l=Bo(r,a);s+=l.written}return rt=s,i}function Lt(r){return r==null}let Rt=null;function de(){return(Rt===null||Rt.byteLength===0)&&(Rt=new Int32Array(ee.memory.buffer)),Rt}function Do(r){r<132||(Ge[r]=Nt,Nt=r)}function Pt(r){const e=z(r);return Do(r),e}let Ft=null;function jo(){return(Ft===null||Ft.byteLength===0)&&(Ft=new Float64Array(ee.memory.buffer)),Ft}let It=null;function Uo(){return(It===null||It.byteLength===0)&&(It=new BigInt64Array(ee.memory.buffer)),It}function Hn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Hn(r[0]));for(let s=1;s<i;s++)o+=", "+Hn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function qo(r,e){const t=e(r.length*1)>>>0;return xt().set(r,t/1),rt=r.length,t}function In(r,e){try{return r.apply(this,e)}catch(t){ee.__wbindgen_exn_store(ge(t))}}let zn=class{static __wrap(e){e=e>>>0;const t=Object.create(zn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();ee.__wbg_routeinfo_free(e)}constructor(e){try{const o=ee.__wbindgen_add_to_stack_pointer(-16),s=qo(e,ee.__wbindgen_malloc),a=rt;ee.routeinfo_new(o,s,a);var t=de()[o/4+0],n=de()[o/4+1],i=de()[o/4+2];if(i)throw Pt(n);return zn.__wrap(t)}finally{ee.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const c=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_nameForRoute(c,this.__wbg_ptr,ge(e));var i=de()[c/4+0],o=de()[c/4+1],s=de()[c/4+2],a=de()[c/4+3],l=i,u=o;if(a)throw l=0,u=0,Pt(s);return t=l,n=u,tt(l,u)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const c=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_speedLimitForRoute(c,this.__wbg_ptr,ge(e));var i=de()[c/4+0],o=de()[c/4+1],s=de()[c/4+2],a=de()[c/4+3],l=i,u=o;if(a)throw l=0,u=0,Pt(s);return t=l,n=u,tt(l,u)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(t,n)}}allSpeedLimits(){let e,t;try{const u=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_allSpeedLimits(u,this.__wbg_ptr);var n=de()[u/4+0],i=de()[u/4+1],o=de()[u/4+2],s=de()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,Pt(o);return e=a,t=l,tt(a,l)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(e,t)}}};async function Go(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ho(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=tt(e,t);return ge(n)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(tt(e,t));return ge(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=z(t),i=typeof n=="string"?n:void 0;var o=Lt(i)?0:Fn(i,ee.__wbindgen_malloc,ee.__wbindgen_realloc),s=rt;de()[e/4+1]=s,de()[e/4+0]=o},r.wbg.__wbindgen_object_drop_ref=function(e){Pt(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=z(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof z(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return ge(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return z(e)===z(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=z(t),i=typeof n=="number"?n:void 0;jo()[e/8+1]=Lt(i)?0:i,de()[e/4+0]=!Lt(i)},r.wbg.__wbindgen_is_object=function(e){const t=z(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return z(e)in z(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ge(t)},r.wbg.__wbindgen_is_undefined=function(e){return z(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return z(e)==z(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=z(e);return ge(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=z(e)[z(t)];return ge(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ge(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=z(t).stack,i=Fn(n,ee.__wbindgen_malloc,ee.__wbindgen_realloc),o=rt;de()[e/4+1]=o,de()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(tt(e,t))}finally{ee.__wbindgen_free(n,i)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(z(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(z(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(z(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(z(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(z(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=z(e)[t>>>0];return ge(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return z(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof z(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=z(e).next;return ge(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return In(function(e){const t=z(e).next();return ge(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return z(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=z(e).value;return ge(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return ge(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return In(function(e,t){const n=Reflect.get(z(e),z(t));return ge(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return In(function(e,t){const n=z(e).call(z(t));return ge(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(z(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=z(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(z(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(z(e));return ge(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=z(e).buffer;return ge(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(z(e));return ge(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){z(e).set(z(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return z(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=z(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=z(t),i=typeof n=="bigint"?n:void 0;Uo()[e/8+1]=Lt(i)?BigInt(0):i,de()[e/4+0]=!Lt(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Hn(z(t)),i=Fn(n,ee.__wbindgen_malloc,ee.__wbindgen_realloc),o=rt;de()[e/4+1]=o,de()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(tt(e,t))},r.wbg.__wbindgen_memory=function(){const e=ee.memory;return ge(e)},r}function zo(r,e){return ee=r.exports,Ti.__wbindgen_wasm_module=e,It=null,Ft=null,Rt=null,Tt=null,ee}async function Ti(r){if(ee!==void 0)return ee;typeof r>"u"&&(r="/atip/state-changing-bugs-142/assets/route_info_bg.wasm");const e=Ho();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Go(await r,e);return zo(t,n)}class Jo{constructor(){se(this,"inner");this.inner=null}async loadFile(e){await Ti(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new zn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.speedLimitForRoute(e)}allSpeedLimits(){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.allSpeedLimits()}}ar(Jo);function Yo(r){let e,t,n,i,o,s,a,l,u,c,d,f,p;return{c(){e=E("p"),e.textContent="For each intervention:",t=C(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=C(),o=E("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=C(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=C(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,c=C(),d=E("p"),d.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,f=C(),p=E("p"),p.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(_,g){w(_,e,g),w(_,t,g),w(_,n,g),w(_,i,g),w(_,o,g),w(_,s,g),w(_,a,g),w(_,l,g),w(_,u,g),w(_,c,g),w(_,d,g),w(_,f,g),w(_,p,g)},p:G,d(_){_&&k(e),_&&k(t),_&&k(n),_&&k(i),_&&k(o),_&&k(s),_&&k(a),_&&k(l),_&&k(u),_&&k(c),_&&k(d),_&&k(f),_&&k(p)}}}function Xo(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[Yo]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new wi({props:o}),le.push(()=>we(e,"open",i,r[0])),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],ke(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Wo(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class Vo extends W{constructor(e){super(),V(this,e,Wo,Xo,Y,{open:0})}}function Er(r){let e;const t=r[4].default,n=_t(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&gt(n,t,i,i[3],e?vt(t,i[3],o,null):bt(i[3]),null)},i(i){e||($(n,i),e=!0)},o(i){O(n,i),e=!1},d(i){n&&n.d(i)}}}function Ko(r){let e,t,n=r[1]&&Er(r);return{c(){e=E("div"),n&&n.c(),L(e,"class","map svelte-12dpf1u")},m(i,o){w(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&$(n,1)):(n=Er(i),n.c(),$(n,1),n.m(e,null)):n&&(fe(),O(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){i&&k(e),n&&n.d(),r[5](null)}}}function Zo(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;oo("setCamera",!window.location.hash),Yt(()=>{s=new tn.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new tn.ScaleControl({})),s.addControl(new tn.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Te.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),it(()=>{s.remove()});function u(c){le[c?"unshift":"push"](()=>{a=c,t(0,a)})}return r.$$set=c=>{"style"in c&&t(2,o=c.style),"$$scope"in c&&t(3,i=c.$$scope)},[a,l,o,i,n,u]}class Qo extends W{constructor(e){super(),V(this,e,Zo,Ko,Y,{style:2})}}const es=r=>({}),Mr=r=>({}),ts=r=>({}),$r=r=>({}),ns=r=>({}),Lr=r=>({});function rs(r){let e,t,n,i,o,s,a,l,u,c,d,f;const p=r[3].nav,_=_t(p,r,r[2],Lr),g=r[3].sidebar,m=_t(g,r,r[2],$r),v=r[3].main,h=_t(v,r,r[2],Mr);return{c(){e=E("aside"),t=E("div"),n=E("nav"),_&&_.c(),i=C(),m&&m.c(),o=C(),s=E("button"),s.textContent="→",l=C(),u=E("main"),h&&h.c(),L(n,"class","svelte-1u7vg8a"),L(t,"class","sidebar-content content-container svelte-1u7vg8a"),L(s,"type","button"),L(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),L(e,"class",a=vr(r[0]?"":"collapsed")+" svelte-1u7vg8a"),L(u,"class","svelte-1u7vg8a")},m(b,y){w(b,e,y),S(e,t),S(t,n),_&&_.m(n,null),S(t,i),m&&m.m(t,null),S(e,o),S(e,s),w(b,l,y),w(b,u,y),h&&h.m(u,null),c=!0,d||(f=U(s,"click",r[1]),d=!0)},p(b,[y]){_&&_.p&&(!c||y&4)&&gt(_,p,b,b[2],c?vt(p,b[2],y,ns):bt(b[2]),Lr),m&&m.p&&(!c||y&4)&&gt(m,g,b,b[2],c?vt(g,b[2],y,ts):bt(b[2]),$r),(!c||y&1&&a!==(a=vr(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&L(e,"class",a),h&&h.p&&(!c||y&4)&&gt(h,v,b,b[2],c?vt(v,b[2],y,es):bt(b[2]),Mr)},i(b){c||($(_,b),$(m,b),$(h,b),c=!0)},o(b){O(_,b),O(m,b),O(h,b),c=!1},d(b){b&&k(e),_&&_.d(b),m&&m.d(b),b&&k(l),b&&k(u),h&&h.d(b),d=!1,f()}}}function is(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class os extends W{constructor(e){super(),V(this,e,is,rs,Y,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function ss(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(c){u=[6,c],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var Ze=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function ls(r,e){return r>e?1:r<e?-1:0}function ze(r,e,t){for(var n=new Ze(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function xn(r,e,t,n){var i=new Ze(r,e);if(t===null)return i.left=i.right=null,i;t=ze(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Or(r,e,t){var n=null,i=null;if(e){e=ze(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function as(r,e,t){return e===null?r:(r===null||(e=ze(r.key,e,t),e.left=r),e)}function Jn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Jn(r.left,o,!1,n,i),r.right&&Jn(r.right,o,!0,n,i)}}var ur=function(){function r(e){e===void 0&&(e=ls),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=xn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ze(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=ze(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=ze(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=ze(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ze(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ze(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return fs(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Wn(e,t,0,i-1,o),this._root===null)this._root=Yn(e,t,0,i),this._size=i;else{var s=cs(this.toList(),us(e,t),o);i=this._size+i,this._root=Xn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Jn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Or(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=xn(t,n,a,i):s=xn(t,n,s,i),this._root=as(s,a,i)},r.prototype.split=function(e){return Or(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return ss(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Yn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new Ze(s,a);return l.left=Yn(r,e,t,o),l.right=Yn(r,e,o+1,n),l}return null}function us(r,e){for(var t=new Ze(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ze(r[i],e[i]);return n.next=null,t.next}function fs(r){for(var e=r,t=[],n=!1,i=new Ze(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Xn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Xn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Xn(r,i+1,t),s}return null}function cs(r,e,t){for(var n=new Ze(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Wn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Wn(r,e,t,a,i),Wn(r,e,a+1,n,i)}}function Re(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Cr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Le(r,e,t){return e&&Cr(r.prototype,e),t&&Cr(r,t),r}var Ot=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Vn=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Ye=Number.EPSILON;Ye===void 0&&(Ye=Math.pow(2,-52));var ps=Ye*Ye,Kn=function(e,t){if(-Ye<e&&e<Ye&&-Ye<t&&t<Ye)return 0;var n=e-t;return n*n<ps*e*t?0:e<t?-1:1},ds=function(){function r(){Re(this,r),this.reset()}return Le(r,[{key:"reset",value:function(){this.xRounder=new Ar,this.yRounder=new Ar}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Ar=function(){function r(){Re(this,r),this.tree=new ur,this.round(0)}return Le(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Kn(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&Kn(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Ht=new ds,Bt=function(e,t){return e.x*t.y-e.y*t.x},Ri=function(e,t){return e.x*t.x+e.y*t.y},Tr=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=Bt(i,o);return Kn(s,0)},vn=function(e){return Math.sqrt(Ri(e,e))},hs=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Bt(o,i)/vn(o)/vn(i)},ms=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Ri(o,i)/vn(o)/vn(i)},Rr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Pr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},_s=function(e,t,n,i){if(t.x===0)return Pr(n,i,e.x);if(i.x===0)return Pr(e,t,n.x);if(t.y===0)return Rr(n,i,e.y);if(i.y===0)return Rr(e,t,n.y);var o=Bt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=Bt(s,t)/o,l=Bt(s,i)/o,u=e.x+l*t.x,c=n.x+a*i.x,d=e.y+l*t.y,f=n.y+a*i.y,p=(u+c)/2,_=(d+f)/2;return{x:p,y:_}},De=function(){Le(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:yn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Re(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Le(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:hs(n.point,t.point,l.point),cosine:ms(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,c=l.cosine,d=i.get(a),f=d.sine,p=d.cosine;return u>=0&&f>=0?c<p?1:c>p?-1:0:u<0&&f<0?c<p?-1:c>p?1:0:f<u?-1:f>u?1:0}}}]),r}(),gs=0,yn=function(){Le(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,c=t.rightSE.point.y,d=n.rightSE.point.y;if(i<o){if(u<l&&u<c)return 1;if(u>l&&u>c)return-1;var f=t.comparePoint(n.leftSE.point);if(f<0)return 1;if(f>0)return-1;var p=n.comparePoint(t.rightSE.point);return p!==0?p:-1}if(i>o){if(l<u&&l<d)return-1;if(l>u&&l>d)return 1;var _=n.comparePoint(t.leftSE.point);if(_!==0)return _;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var m=n.comparePoint(t.rightSE.point);if(m!==0)return m}if(s>a){var v=t.comparePoint(n.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(s!==a){var h=c-l,b=s-i,y=d-u,M=a-o;if(h>b&&y<M)return 1;if(h<b&&y>M)return-1}return s>a?1:s<a||c<d?-1:c>d?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Re(this,r),this.id=++gs,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Le(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=Vn(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,c=Ot(n,l)&&this.comparePoint(l)===0,d=Ot(i,s)&&t.comparePoint(s)===0,f=Ot(n,u)&&this.comparePoint(u)===0,p=Ot(i,a)&&t.comparePoint(a)===0;if(d&&c)return p&&!f?a:!p&&f?u:null;if(d)return f&&s.x===u.x&&s.y===u.y?null:s;if(c)return p&&a.x===l.x&&a.y===l.y?null:l;if(p&&f)return null;if(p)return a;if(f)return u;var _=_s(s,this.vector(),l,t.vector());return _===null||!Ot(o,_)?null:Ht.round(_.x,_.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new De(t,!0),s=new De(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return De.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),De.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var c=i.rings[l],d=i.windings[l],f=n.rings.indexOf(c);f===-1?(n.rings.push(c),n.windings.push(d)):n.windings[f]+=d}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],c=n.indexOf(l);c===-1?(n.push(l),i.push(u)):i[c]+=u}for(var d=[],f=[],p=0,_=n.length;p<_;p++)if(i[p]!==0){var g=n[p],m=g.poly;if(f.indexOf(m)===-1)if(g.isExterior)d.push(m);else{f.indexOf(m)===-1&&f.push(m);var v=d.indexOf(g.poly);v!==-1&&d.splice(v,1)}}for(var h=0,b=d.length;h<b;h++){var y=d[h].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ie.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===Ie.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(d){return d.length===1&&d[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ie.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=De.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new De(o,!0),c=new De(s,!1);return new r(u,c,[i],[a])}}]),r}(),Fr=function(){function r(e,t,n){if(Re(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Ht.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Ht.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(yn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(yn.fromRing(o,i,this))}return Le(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),bs=function(){function r(e,t){if(Re(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Fr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new Fr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Le(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Ir=function(){function r(e,t){if(Re(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new bs(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Le(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),vs=function(){Le(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,c=[l],d=l.point,f=[];a=l,l=u,c.push(l),l.point!==d;)for(;;){var p=l.getAvailableLinkedEvents();if(p.length===0){var _=c[0].point,g=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(_.x,",")+" ".concat(_.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(p.length===1){u=p[0].otherSE;break}for(var m=null,v=0,h=f.length;v<h;v++)if(f[v].point===l.point){m=v;break}if(m!==null){var b=f.splice(m)[0],y=c.splice(b.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}f.push({index:c.length,point:l.point});var M=l.getLeftmostComparator(a);u=p.sort(M)[0].otherSE;break}n.push(new r(c))}}return n}}]);function r(e){Re(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Le(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Tr(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Tr(l,t,u)===0&&n.shift(),n.push(n[0]);for(var c=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:n.length-1,f=this.isExteriorRing()?n.length:-1,p=[],_=d;_!=f;_+=c)p.push([n[_].x,n[_].y]);return p}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];De.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),xr=function(){function r(e){Re(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Le(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),ys=function(){function r(e){Re(this,r),this.rings=e,this.polys=this._composePolys(e)}return Le(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new xr(s));else{var a=s.enclosingRing();a.poly||n.push(new xr(a)),a.poly.addInterior(s)}}return n}}]),r}(),ws=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yn.compare;Re(this,r),this.queue=e,this.tree=new ur(t),this.segments=[]}return Le(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var c=null;if(l){var d=l.getIntersection(n);if(d!==null&&(n.isAnEndpoint(d)||(c=d),!l.isAnEndpoint(d)))for(var f=this._splitSafely(l,d),p=0,_=f.length;p<_;p++)i.push(f[p])}var g=null;if(u){var m=u.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(g=m),!u.isAnEndpoint(m)))for(var v=this._splitSafely(u,m),h=0,b=v.length;h<b;h++)i.push(v[h])}if(c!==null||g!==null){var y=null;if(c===null)y=g;else if(g===null)y=c;else{var M=De.comparePoints(c,g);y=M<=0?c:g}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var T=n.split(y),P=0,A=T.length;P<A;P++)i.push(T[P])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var x=l.getIntersection(u);if(x!==null){if(!l.isAnEndpoint(x))for(var R=this._splitSafely(l,x),j=0,Z=R.length;j<Z;j++)i.push(R[j]);if(!u.isAnEndpoint(x))for(var I=this._splitSafely(u,x),H=0,ae=I.length;H<ae;H++)i.push(I[H])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Nr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ks=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Ss=function(){function r(){Re(this,r)}return Le(r,[{key:"run",value:function(t,n,i){Ie.type=t,Ht.reset();for(var o=[new Ir(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Ir(i[s],!1));if(Ie.numMultiPolys=o.length,Ie.type==="difference")for(var l=o[0],u=1;u<o.length;)Vn(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(Ie.type==="intersection"){for(var c=0,d=o.length;c<d;c++)for(var f=o[c],p=c+1,_=o.length;p<_;p++)if(Vn(f.bbox,o[p].bbox)===null)return[]}for(var g=new ur(De.compare),m=0,v=o.length;m<v;m++)for(var h=o[m].getSweepEvents(),b=0,y=h.length;b<y;b++)if(g.insert(h[b]),g.size>Nr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new ws(g),T=g.size,P=g.pop();P;){var A=P.key;if(g.size===T){var x=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(x.id," ")+"[".concat(x.leftSE.point.x,", ").concat(x.leftSE.point.y,"] -> ")+"[".concat(x.rightSE.point.x,", ").concat(x.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Nr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>ks)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var R=M.process(A),j=0,Z=R.length;j<Z;j++){var I=R[j];I.consumedBy===void 0&&g.insert(I)}T=g.size,P=g.pop()}Ht.reset();var H=vs.factory(M.segments),ae=new ys(H);return ae.getGeom()}}]),r}(),Ie=new Ss,Es=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ie.run("union",e,n)},Ms=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ie.run("intersection",e,n)},$s=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ie.run("xor",e,n)},Ls=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ie.run("difference",e,n)},on={union:Es,intersection:Ms,xor:$s,difference:Ls};function Os(r,e){var t=As(e),n=null;return r.type==="FeatureCollection"?n=Cs(r):n=Pi(on.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function Cs(r){var e=r.features.length===2?on.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):on.union.apply(on,r.features.map(function(t){return t.geometry.coordinates}));return Pi(e)}function Pi(r){return so(r)}function As(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return lo(t)}function Ts(r,e,t){let n;re(r,Te,s=>t(1,n=s));let{boundaryGeojson:i}=e;return ao("setCamera")&&n.fitBounds(or(i),{padding:20,animate:!1}),Qe(n,"boundary",Os(i)),Se(n,{id:"boundary",source:"boundary",...Mn("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class Rs extends W{constructor(e){super(),V(this,e,Ts,null,Y,{boundaryGeojson:0})}}const me={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},An=10,zt=10;function Ps(r,e,t){let n;re(r,Te,u=>t(2,n=u));let{layer:i}=e,{contents:o}=e,s=new tn.Popup({closeButton:!1,closeOnClick:!1});n.on("mousemove",a),n.on("mouseout",l),it(()=>{n.off("mousemove",a),n.off("mouseout",l),s.remove()});function a(u){if(!n.getLayer(i)){s.remove();return}let c=n.queryRenderedFeatures(u.point,{layers:[i]});c.length>0?s.setLngLat(u.lngLat).setHTML(o(c[0].properties)).addTo(n):s.remove()}function l(){s.remove()}return r.$$set=u=>{"layer"in u&&t(0,i=u.layer),"contents"in u&&t(1,o=u.contents)},[i,o]}class Fs extends W{constructor(e){super(),V(this,e,Ps,null,Y,{layer:0,contents:1})}}function Br(r,e,t){const n=r.slice();return n[3]=e[t],n}function Dr(r,e,t){const n=r.slice();return n[6]=e[t],n}function jr(r){let e;return{c(){e=E("td"),L(e,"class","svelte-11t6rxo"),ue(e,"background-color",r[6])},m(t,n){w(t,e,n)},p(t,n){n&1&&ue(e,"background-color",t[6])},d(t){t&&k(e)}}}function Ur(r){let e,t=r[3]+"",n;return{c(){e=E("td"),n=J(t),L(e,"class","svelte-11t6rxo"),ue(e,"width",r[2])},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[3]+"")&&$e(n,t)},d(i){i&&k(e)}}}function Is(r){let e,t,n,i,o=r[0],s=[];for(let u=0;u<o.length;u+=1)s[u]=jr(Dr(r,o,u));let a=r[1],l=[];for(let u=0;u<a.length;u+=1)l[u]=Ur(Br(r,a,u));return{c(){e=E("table"),t=E("tr");for(let u=0;u<s.length;u+=1)s[u].c();n=C(),i=E("tr");for(let u=0;u<l.length;u+=1)l[u].c();L(t,"class","svelte-11t6rxo"),L(i,"class","svelte-11t6rxo"),L(e,"class","svelte-11t6rxo")},m(u,c){w(u,e,c),S(e,t);for(let d=0;d<s.length;d+=1)s[d].m(t,null);S(e,n),S(e,i);for(let d=0;d<l.length;d+=1)l[d].m(i,null)},p(u,[c]){if(c&1){o=u[0];let d;for(d=0;d<o.length;d+=1){const f=Dr(u,o,d);s[d]?s[d].p(f,c):(s[d]=jr(f),s[d].c(),s[d].m(t,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=o.length}if(c&6){a=u[1];let d;for(d=0;d<a.length;d+=1){const f=Br(u,a,d);l[d]?l[d].p(f,c):(l[d]=Ur(f),l[d].c(),l[d].m(i,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},i:G,o:G,d(u){u&&k(e),cn(s,u),cn(l,u)}}}function xs(r,e,t){let{colors:n}=e,{labels:i}=e;if(n.length!=i.length)throw new Error("colors and labels must match");let o=`${100/n.length}%`;return r.$$set=s=>{"colors"in s&&t(0,n=s.colors),"labels"in s&&t(1,i=s.labels)},[n,i,o]}class Ns extends W{constructor(e){super(),V(this,e,xs,Is,Y,{colors:0,labels:1})}}const Bs="/atip/state-changing-bugs-142/assets/help-d011708a.svg";function Ds(r){let e,t;return{c(){e=E("img"),pn(e.src,t=Bs)||L(e,"src",t),L(e,"title",r[0]),L(e,"alt",r[0])},m(n,i){w(n,e,i)},p(n,[i]){i&1&&L(e,"title",n[0]),i&1&&L(e,"alt",n[0])},i:G,o:G,d(n){n&&k(e)}}}function js(r,e,t){let{contents:n}=e;return r.$$set=i=>{"contents"in i&&t(0,n=i.contents)},[n]}class Us extends W{constructor(e){super(),V(this,e,js,Ds,Y,{contents:0})}}function qs(r){let e,t,n,i,o,s,a;return t=new Us({props:{contents:"Data comes from OpenStreetMap, and may not always be correct. Unexpected values are treated as unknown. Freehand route segments and off-road paths generally have no speed data."}}),i=new Ns({props:{colors:r[0],labels:["< 20","20","30","40",">= 50"]}}),s=new Fs({props:{layer:"speed-limits",contents:Hs}}),{c(){e=J(`(mph)
`),N(t.$$.fragment),n=C(),N(i.$$.fragment),o=C(),N(s.$$.fragment)},m(l,u){w(l,e,u),B(t,l,u),w(l,n,u),B(i,l,u),w(l,o,u),B(s,l,u),a=!0},p:G,i(l){a||($(t.$$.fragment,l),$(i.$$.fragment,l),$(s.$$.fragment,l),a=!0)},o(l){O(t.$$.fragment,l),O(i.$$.fragment,l),O(s.$$.fragment,l),a=!1},d(l){l&&k(e),D(t,l),l&&k(n),D(i,l),l&&k(o),D(s,l)}}}let Gs="white",at="speed-limits",Nn="speed-limits",Ct=.8;function Hs(r){return r.speed_limit?`${Math.round(r.speed_limit)} mph`:"Unknown"}function zs(r,e,t){let n,i,o;re(r,Te,c=>t(2,n=c)),re(r,mn,c=>t(3,i=c)),re(r,ne,c=>t(4,o=c));let{id:s}=e,a=["#00AB4D","#8ECA4D","#F7BB00","#BB0000","#470000"];const l=["case",["<",["get","speed_limit"],20],a[0],["==",["get","speed_limit"],20],a[1],["==",["get","speed_limit"],30],a[2],["==",["get","speed_limit"],40],a[3],[">=",["get","speed_limit"],50],a[4],Gs],u=["case",["<",["get","speed_limit"],20],Ct,["==",["get","speed_limit"],20],Ct,["==",["get","speed_limit"],30],Ct,["==",["get","speed_limit"],40],Ct,[">=",["get","speed_limit"],50],Ct,0];return Qe(n,at,xe()),Se(n,{id:Nn,source:at,...wt(l,zt,u)}),Yt(async()=>{try{if(s){let c=o.features.find(f=>f.id==s),d=JSON.parse(await i.speedLimitForRoute(c.properties.waypoints));n.getSource(at).setData(d)}else{let c=JSON.parse(await i.allSpeedLimits());n.getSource(at).setData(c)}}catch(c){window.alert(`Couldn't calculate speed limits for route: ${c}`)}}),it(()=>{n.getLayer(Nn)&&n.removeLayer(Nn),n.getSource(at)&&n.removeSource(at)}),r.$$set=c=>{"id"in c&&t(1,s=c.id)},[a,s]}class Fi extends W{constructor(e){super(),V(this,e,zs,qs,Y,{id:1})}}function qr(r){let e,t;return e=new Fi({props:{id:r[0]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.id=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Js(r){let e,t,n,i,o,s,a,l,u,c,d=r[1]=="speed limits"&&qr(r);return{c(){e=E("label"),t=J(`Show details:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",s=C(),d&&d.c(),a=be(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,r[1]===void 0&&ot(()=>r[2].call(n))},m(f,p){w(f,e,p),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[1]),w(f,s,p),d&&d.m(f,p),w(f,a,p),l=!0,u||(c=U(n,"change",r[2]),u=!0)},p(f,[p]){p&2&&Ke(n,f[1]),f[1]=="speed limits"?d?(d.p(f,p),p&2&&$(d,1)):(d=qr(f),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(fe(),O(d,1,1,()=>{d=null}),ce())},i(f){l||($(d),l=!0)},o(f){O(d),l=!1},d(f){f&&k(e),f&&k(s),d&&d.d(f),f&&k(a),u=!1,c()}}}function Ys(r,e,t){let{id:n}=e,i="none";function o(){i=$n(this),t(1,i)}return r.$$set=s=>{"id"in s&&t(0,n=s.id)},[n,i,o]}class Xs extends W{constructor(e){super(),V(this,e,Ys,Js,Y,{id:0})}}function Gr(r){let e,t=Hr(r[4])+"",n,i,o,s,a,l,u,c,d,f;return u=new Xs({props:{id:r[3]}}),{c(){e=J("Length: "),n=J(t),i=C(),o=E("br"),s=E("button"),s.textContent="Auto-fill details",a=E("br"),l=C(),N(u.$$.fragment),L(s,"type","button")},m(p,_){w(p,e,_),w(p,n,_),w(p,i,_),w(p,o,_),w(p,s,_),w(p,a,_),w(p,l,_),B(u,p,_),c=!0,d||(f=U(s,"click",r[13]),d=!0)},p(p,_){(!c||_&16)&&t!==(t=Hr(p[4])+"")&&$e(n,t);const g={};_&8&&(g.id=p[3]),u.$set(g)},i(p){c||($(u.$$.fragment,p),c=!0)},o(p){O(u.$$.fragment,p),c=!1},d(p){p&&k(e),p&&k(n),p&&k(i),p&&k(o),p&&k(s),p&&k(a),p&&k(l),D(u,p),d=!1,f()}}}function Ws(r){let e,t,n,i,o,s,a,l,u,c,d,f,p,_,g,m,v,h,b,y,M,T,P,A,x,R,j,Z,I,H,ae,Me,Pe,oe,ie,Ne,Oe,Q,he,Vt,_e=r[4]&&Gr(r);return{c(){e=E("label"),t=J("Name:"),n=E("br"),i=C(),o=E("input"),s=C(),a=E("br"),l=C(),u=E("br"),c=C(),d=E("label"),f=E("input"),p=J(`
  Area`),_=C(),g=E("label"),m=E("input"),v=J(`
  Route`),h=C(),b=E("label"),y=E("input"),M=J(`
  Crossing`),T=C(),P=E("label"),A=E("input"),x=J(`
  Other`),R=C(),j=E("br"),Z=C(),I=E("br"),H=C(),ae=E("label"),Me=J("Description:"),Pe=E("br"),oe=C(),ie=E("textarea"),Ne=C(),_e&&_e.c(),Oe=be(),L(o,"type","text"),ue(o,"width","100%"),L(f,"type","radio"),f.__value="area",f.value=f.__value,r[8][0].push(f),L(m,"type","radio"),m.__value="route",m.value=m.__value,r[8][0].push(m),L(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[8][0].push(y),L(A,"type","radio"),A.__value="other",A.value=A.__value,r[8][0].push(A),ue(ie,"width","100%"),L(ie,"rows","5"),L(ie,"class","svelte-15lna0i")},m(F,te){w(F,e,te),S(e,t),S(e,n),S(e,i),S(e,o),Ae(o,r[0]),w(F,s,te),w(F,a,te),w(F,l,te),w(F,u,te),w(F,c,te),w(F,d,te),S(d,f),f.checked=f.__value===r[1],S(d,p),w(F,_,te),w(F,g,te),S(g,m),m.checked=m.__value===r[1],S(g,v),w(F,h,te),w(F,b,te),S(b,y),y.checked=y.__value===r[1],S(b,M),w(F,T,te),w(F,P,te),S(P,A),A.checked=A.__value===r[1],S(P,x),w(F,R,te),w(F,j,te),w(F,Z,te),w(F,I,te),w(F,H,te),w(F,ae,te),S(ae,Me),S(ae,Pe),S(ae,oe),S(ae,ie),Ae(ie,r[2]),w(F,Ne,te),_e&&_e.m(F,te),w(F,Oe,te),Q=!0,he||(Vt=[U(o,"input",r[6]),U(f,"change",r[7]),U(m,"change",r[9]),U(y,"change",r[10]),U(A,"change",r[11]),U(ie,"input",r[12])],he=!0)},p(F,[te]){te&1&&o.value!==F[0]&&Ae(o,F[0]),te&2&&(f.checked=f.__value===F[1]),te&2&&(m.checked=m.__value===F[1]),te&2&&(y.checked=y.__value===F[1]),te&2&&(A.checked=A.__value===F[1]),te&4&&Ae(ie,F[2]),F[4]?_e?(_e.p(F,te),te&16&&$(_e,1)):(_e=Gr(F),_e.c(),$(_e,1),_e.m(Oe.parentNode,Oe)):_e&&(fe(),O(_e,1,1,()=>{_e=null}),ce())},i(F){Q||($(_e),Q=!0)},o(F){O(_e),Q=!1},d(F){F&&k(e),F&&k(s),F&&k(a),F&&k(l),F&&k(u),F&&k(c),F&&k(d),r[8][0].splice(r[8][0].indexOf(f),1),F&&k(_),F&&k(g),r[8][0].splice(r[8][0].indexOf(m),1),F&&k(h),F&&k(b),r[8][0].splice(r[8][0].indexOf(y),1),F&&k(T),F&&k(P),r[8][0].splice(r[8][0].indexOf(A),1),F&&k(R),F&&k(j),F&&k(Z),F&&k(I),F&&k(H),F&&k(ae),F&&k(Ne),_e&&_e.d(F),F&&k(Oe),he=!1,Ce(Vt)}}}function Hr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function Vs(r,e,t){let n,i;re(r,mn,b=>t(14,n=b)),re(r,ne,b=>t(15,i=b));let{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function c(){let b=i.features.find(y=>y.id==o);try{t(0,s=await n.nameForRoute(b))}catch(y){window.alert(`Couldn't auto-name route: ${y}`)}}const d=[[]];function f(){s=this.value,t(0,s)}function p(){a=this.__value,t(1,a)}function _(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function m(){a=this.__value,t(1,a)}function v(){l=this.value,t(2,l)}const h=()=>c();return r.$$set=b=>{"id"in b&&t(3,o=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(4,u=b.length_meters)},[s,a,l,o,u,c,f,p,d,_,g,m,v,h]}class Ks extends W{constructor(e){super(),V(this,e,Vs,Ws,Y,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}const Zs="Intervention",Qs=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],el={name:Zs,oneOf:Qs};function tl(r){const e=r-1;return e*e*e+1}function Et(r,{delay:e=0,duration:t=400,easing:n=tl}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),c=parseFloat(i.marginBottom),d=parseFloat(i.borderTopWidth),f=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:p=>`overflow: hidden;opacity: ${Math.min(p*20,1)*o};height: ${p*s}px;padding-top: ${p*a}px;padding-bottom: ${p*l}px;margin-top: ${p*u}px;margin-bottom: ${p*c}px;border-top-width: ${p*d}px;border-bottom-width: ${p*f}px;`}}function Ii(r){return"members"in r}function xi(r){return"oneOf"in r}function Ni(r){return typeof r=="string"}function Bi(r){return typeof r=="object"&&"value"in r}function nl(r){return"type"in r&&r.type=="number"}function Di(r){return"type"in r&&r.type=="one-liner"}function ji(r){return"type"in r&&r.type=="textbox"}function Ui(r){return"type"in r&&r.type=="checkbox"}function zr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Jr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function Yr(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=J(t),L(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&$e(n,t)},d(i){i&&k(e)}}}function rl(r){let e,t,n;return{c(){e=E("input"),L(e,"type","checkbox")},m(i,o){w(i,e,o),e.checked=r[0],t||(n=U(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function il(r){let e,t,n;return{c(){e=E("textarea"),ue(e,"width","100%"),L(e,"rows","5"),L(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),Ae(e,r[0]),t||(n=U(e,"input",r[13]),t=!0)},p(i,o){o&1&&Ae(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function ol(r){let e,t,n;return{c(){e=E("input"),L(e,"type","text"),ue(e,"width","100%")},m(i,o){w(i,e,o),Ae(e,r[0]),t||(n=U(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Ae(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function sl(r){let e,t,n;return{c(){e=E("input"),L(e,"type","number")},m(i,o){w(i,e,o),Ae(e,r[0]),t||(n=U(e,"input",r[11]),t=!0)},p(i,o){o&1&&ki(e.value)!==i[0]&&Ae(e,i[0])},i:G,o:G,d(i){i&&k(e),t=!1,n()}}}function ll(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=Wr(zr(r,n,s));const o=s=>O(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=be()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=zr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=Wr(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(fe(),l=n.length;l<i.length;l+=1)o(l);ce()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)O(i[a]);t=!1},d(s){cn(i,s),s&&k(e)}}}function al(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=Vr(Jr(r,n,s));const o=s=>O(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=be()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Jr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=Vr(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(fe(),l=n.length;l<i.length;l+=1)o(l);ce()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)O(i[a]);t=!1},d(s){cn(i,s),s&&k(e)}}}function ul(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,c,d,f,p=r[2]==r[15].name&&typeof r[0]=="object"&&Xr(r);return{c(){e=E("label"),t=E("input"),i=C(),s=J(o),a=E("br"),l=C(),p&&p.c(),u=be(),L(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(_,g){w(_,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),w(_,l,g),p&&p.m(_,g),w(_,u,g),c=!0,d||(f=[U(t,"change",r[9]),U(t,"change",r[4])],d=!0)},p(_,g){(!c||g&2&&n!==(n=_[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===_[2]),(!c||g&2)&&o!==(o=_[15].name+"")&&$e(s,o),_[2]==_[15].name&&typeof _[0]=="object"?p?(p.p(_,g),g&7&&$(p,1)):(p=Xr(_),p.c(),$(p,1),p.m(u.parentNode,u)):p&&(fe(),O(p,1,1,()=>{p=null}),ce())},i(_){c||($(p),c=!0)},o(_){O(p),c=!1},d(_){_&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),_&&k(l),p&&p.d(_),_&&k(u),d=!1,Ce(f)}}}function fl(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,c;function d(_,g){return _[15].description?dl:pl}let f=d(r),p=f(r);return{c(){e=E("label"),t=E("input"),i=C(),s=J(o),a=C(),p.c(),l=C(),L(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(_,g){w(_,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),p.m(e,null),S(e,l),u||(c=[U(t,"change",r[8]),U(t,"change",r[3])],u=!0)},p(_,g){g&2&&n!==(n=_[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===_[2]),g&2&&o!==(o=_[15].value+"")&&$e(s,o),f===(f=d(_))&&p?p.p(_,g):(p.d(1),p=f(_),p&&(p.c(),p.m(e,l)))},i:G,o:G,d(_){_&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),p.d(),u=!1,Ce(c)}}}function cl(r){let e,t,n,i,o=r[15]+"",s,a,l,u,c,d;return{c(){e=E("label"),t=E("input"),i=C(),s=J(o),a=C(),l=E("br"),u=C(),L(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(f,p){w(f,e,p),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),S(e,l),S(e,u),c||(d=[U(t,"change",r[6]),U(t,"change",r[3])],c=!0)},p(f,p){p&2&&n!==(n=f[15])&&(t.__value=n,t.value=t.__value),p&4&&(t.checked=t.__value===f[2]),p&2&&o!==(o=f[15]+"")&&$e(s,o)},i:G,o:G,d(f){f&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),c=!1,Ce(d)}}}function Xr(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Wt({props:l}),le.push(()=>we(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),N(t.$$.fragment),i=C(),L(e,"class","svelte-1b72l00")},m(u,c){w(u,e,c),B(t,e,null),S(e,i),s=!0},p(u,c){r=u;const d={};c&2&&(d.spec=r[15]),!n&&c&3&&(n=!0,d.value=r[0][r[15].name],ke(()=>n=!1)),t.$set(d)},i(u){s||($(t.$$.fragment,u),ot(()=>{o||(o=kt(e,Et,{duration:500},!0)),o.run(1)}),s=!0)},o(u){O(t.$$.fragment,u),o||(o=kt(e,Et,{duration:500},!1)),o.run(0),s=!1},d(u){u&&k(e),D(t),u&&o&&o.end()}}}function pl(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function dl(r){let e,t,n=r[15].description+"",i,o;return{c(){e=E("p"),t=J("("),i=J(n),o=J(")"),L(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,i),S(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&$e(i,n)},d(s){s&&k(e)}}}function Wr(r){let e,t,n,i,o,s;const a=[cl,fl,ul],l=[];function u(c,d){return d&2&&(e=null),d&2&&(t=null),e==null&&(e=!!Ni(c[15])),e?0:(t==null&&(t=!!Bi(c[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=be()},m(c,d){l[n].m(c,d),w(c,o,d),s=!0},p(c,d){let f=n;n=u(c,d),n===f?l[n].p(c,d):(fe(),O(l[f],1,1,()=>{l[f]=null}),ce(),i=l[n],i?i.p(c,d):(i=l[n]=a[n](c),i.c()),$(i,1),i.m(o.parentNode,o))},i(c){s||($(i),s=!0)},o(c){O(i),s=!1},d(c){l[n].d(c),c&&k(o)}}}function Vr(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function c(f){r[5](f,r[15])}let d={spec:r[15]};return r[0][r[15].name]!==void 0&&(d.value=r[0][r[15].name]),s=new Wt({props:d}),le.push(()=>we(s,"value",c,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),i=J(n),o=C(),N(s.$$.fragment),l=C(),L(e,"class","svelte-1b72l00")},m(f,p){w(f,e,p),S(e,t),S(t,i),S(e,o),B(s,e,null),S(e,l),u=!0},p(f,p){r=f,(!u||p&2)&&n!==(n=r[15].name+"")&&$e(i,n);const _={};p&2&&(_.spec=r[15]),!a&&p&3&&(a=!0,_.value=r[0][r[15].name],ke(()=>a=!1)),s.$set(_)},i(f){u||($(s.$$.fragment,f),u=!0)},o(f){O(s.$$.fragment,f),u=!1},d(f){f&&k(e),D(s)}}}function hl(r){let e,t,n,i,o,s,a,l,u,c,d,f=r[1].description&&Yr(r);const p=[al,ll,sl,ol,il,rl],_=[];function g(m,v){return v&2&&(t=null),v&2&&(n=null),v&2&&(i=null),v&2&&(o=null),v&2&&(s=null),v&2&&(a=null),t==null&&(t=!!Ii(m[1])),t?0:(n==null&&(n=!!xi(m[1])),n?1:(i==null&&(i=!!nl(m[1])),i?2:(o==null&&(o=!!Di(m[1])),o?3:(s==null&&(s=!!ji(m[1])),s?4:(a==null&&(a=!!Ui(m[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=_[l]=p[l](r)),{c(){f&&f.c(),e=C(),u&&u.c(),c=be()},m(m,v){f&&f.m(m,v),w(m,e,v),~l&&_[l].m(m,v),w(m,c,v),d=!0},p(m,[v]){m[1].description?f?f.p(m,v):(f=Yr(m),f.c(),f.m(e.parentNode,e)):f&&(f.d(1),f=null);let h=l;l=g(m,v),l===h?~l&&_[l].p(m,v):(u&&(fe(),O(_[h],1,1,()=>{_[h]=null}),ce()),~l?(u=_[l],u?u.p(m,v):(u=_[l]=p[l](m),u.c()),$(u,1),u.m(c.parentNode,c)):u=null)},i(m){d||($(u),d=!0)},o(m){O(u),d=!1},d(m){f&&f.d(m),m&&k(e),~l&&_[l].d(m),m&&k(c)}}}function ml(r,e,t){var h,b,y;let{spec:n}=e,{value:i}=e,o="";if(Ii(n)){i||(i={});for(let M of n.members)Di(M)||ji(M)?i[h=M.name]||(i[h]=""):Ui(M)?i[b=M.name]||(i[b]=!1):i[y=M.name]||(i[y]={})}else xi(n)&&(i||(i={}),Ni(i)?o=i:Bi(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,T){r.$$.not_equal(i[T.name],M)&&(i[T.name]=M,t(0,i))}function c(){o=this.__value,t(2,o)}function d(){o=this.__value,t(2,o)}function f(){o=this.__value,t(2,o)}function p(M,T){r.$$.not_equal(i[T.name],M)&&(i[T.name]=M,t(0,i))}function _(){i=ki(this.value),t(0,i)}function g(){i=this.value,t(0,i)}function m(){i=this.value,t(0,i)}function v(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,c,l,d,f,p,_,g,m,v]}class Wt extends W{constructor(e){super(),V(this,e,ml,hl,Y,{spec:1,value:0})}}function _l(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Wt({props:o}),le.push(()=>we(e,"value",i,r[0].v2)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,ke(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function gl(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=el;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class bl extends W{constructor(e){super(),V(this,e,gl,_l,Y,{props:0})}}const vl="Planning",yl=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],wl={name:vl,members:yl};function kl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Wt({props:o}),le.push(()=>we(e,"value",i,r[0].planning)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,ke(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Sl(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=wl;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class El extends W{constructor(e){super(),V(this,e,Sl,kl,Y,{props:0})}}const Ml="CriticalIssue",$l=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],Ll={name:Ml,members:$l};function Ol(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Wt({props:o}),le.push(()=>we(e,"value",i,r[0].criticals)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,ke(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Cl(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=Ll;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Al extends W{constructor(e){super(),V(this,e,Cl,Ol,Y,{props:0})}}function Kr(r){let e,t,n,i,o;const s=r[10].default,a=_t(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),ue(e,"border","solid 1px black"),ue(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=U(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&gt(a,s,l,l[9],n?vt(s,l[9],u,null):bt(l[9]),null)},i(l){n||($(a,l),ot(()=>{t||(t=kt(e,Et,{duration:100},!0)),t.run(1)}),n=!0)},o(l){O(a,l),t||(t=kt(e,Et,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Tl(r){let e,t,n,i,o,s,a,l,u,c,d=r[4]&&Kr(r);return{c(){e=E("button"),t=dn("svg"),n=dn("path"),i=C(),o=J(r[1]),s=C(),d&&d.c(),a=be(),L(n,"d","M9 5l7 7-7 7"),L(t,"style","tran"),L(t,"width","20"),L(t,"height","20"),L(t,"fill","none"),L(t,"stroke-linecap","round"),L(t,"stroke-linejoin","round"),L(t,"stroke-width","2"),L(t,"viewBox","0 0 24 24"),L(t,"stroke","currentColor"),L(t,"class","svelte-t7fpgu"),L(e,"aria-expanded",r[4]),L(e,"class","svelte-t7fpgu"),yr(e,"underlined",r[3])},m(f,p){w(f,e,p),S(e,t),S(t,n),S(e,i),S(e,o),w(f,s,p),d&&d.m(f,p),w(f,a,p),l=!0,u||(c=[U(e,"click",r[5]),U(e,"mouseenter",r[11]),U(e,"mouseleave",r[12])],u=!0)},p(f,[p]){(!l||p&2)&&$e(o,f[1]),(!l||p&16)&&L(e,"aria-expanded",f[4]),(!l||p&8)&&yr(e,"underlined",f[3]),f[4]?d?(d.p(f,p),p&16&&$(d,1)):(d=Kr(f),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(fe(),O(d,1,1,()=>{d=null}),ce())},i(f){l||($(d),l=!0)},o(f){O(d),l=!1},d(f){f&&k(e),f&&k(s),d&&d.d(f),f&&k(a),u=!1,Ce(c)}}}function Rl(r,e,t){let n,i,o,s;re(r,je,h=>t(7,o=h)),re(r,Ee,h=>t(8,s=h));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:c}=e;const d=()=>{Ee.update(h=>h==u?null:u),s==u&&(Gt.set(null),Gt.set(u))};let f;function p(){f==null||f.scrollIntoView({behavior:"smooth"})}const _=()=>qt.set(u),g=()=>qt.set(null);function m(h){le[h?"unshift":"push"](()=>{f=h,t(2,f)})}const v=()=>p();return r.$$set=h=>{"id"in h&&t(0,u=h.id),"label"in h&&t(1,c=h.label),"$$scope"in h&&t(9,l=h.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,c,f,i,n,d,p,o,s,l,a,_,g,m,v]}class Pl extends W{constructor(e){super(),V(this,e,Rl,Tl,Y,{id:0,label:1})}}function Zr(r,e,t){const n=r.slice();return n[13]=e[t],n[14]=e,n[15]=t,n}function Fl(r){let e,t,n;function i(s){r[9](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Al({props:o}),le.push(()=>we(e,"props",i,r[13].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,ke(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Il(r){let e,t,n;function i(s){r[8](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new El({props:o}),le.push(()=>we(e,"props",i,r[13].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,ke(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function xl(r){let e,t,n;function i(s){r[7](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new bl({props:o}),le.push(()=>we(e,"props",i,r[13].properties)),{c(){N(e.$$.fragment)},m(s,a){B(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,ke(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){O(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function Nl(r){let e,t,n,i,o;function s(c){r[4](c,r[13])}function a(c){r[5](c,r[13])}function l(c){r[6](c,r[13])}let u={id:r[13].id,length_meters:r[13].properties.length_meters};return r[13].properties.name!==void 0&&(u.name=r[13].properties.name),r[13].properties.intervention_type!==void 0&&(u.intervention_type=r[13].properties.intervention_type),r[13].properties.description!==void 0&&(u.description=r[13].properties.description),e=new Ks({props:u}),le.push(()=>we(e,"name",s,r[13].properties.name)),le.push(()=>we(e,"intervention_type",a,r[13].properties.intervention_type)),le.push(()=>we(e,"description",l,r[13].properties.description)),{c(){N(e.$$.fragment)},m(c,d){B(e,c,d),o=!0},p(c,d){r=c;const f={};d&2&&(f.id=r[13].id),d&2&&(f.length_meters=r[13].properties.length_meters),!t&&d&2&&(t=!0,f.name=r[13].properties.name,ke(()=>t=!1)),!n&&d&2&&(n=!0,f.intervention_type=r[13].properties.intervention_type,ke(()=>n=!1)),!i&&d&2&&(i=!0,f.description=r[13].properties.description,ke(()=>i=!1)),e.$set(f)},i(c){o||($(e.$$.fragment,c),o=!0)},o(c){O(e.$$.fragment,c),o=!1},d(c){D(e,c)}}}function Bl(r){let e,t,n,i,o,s,a,l,u,c,d,f,p,_,g;const m=[Nl,xl,Il,Fl],v=[];function h(y,M){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:y[0]=="criticals"?3:-1}~(e=h(r))&&(t=v[e]=m[e](r));function b(){return r[10](r[13])}return{c(){t&&t.c(),n=C(),i=E("br"),o=C(),s=E("br"),a=C(),l=E("div"),u=E("button"),u.textContent="Delete",c=C(),d=E("button"),d.textContent="Save",f=C(),L(u,"type","button"),L(d,"type","button"),ue(l,"display","flex"),ue(l,"justify-content","space-between")},m(y,M){~e&&v[e].m(y,M),w(y,n,M),w(y,i,M),w(y,o,M),w(y,s,M),w(y,a,M),w(y,l,M),S(l,u),S(l,c),S(l,d),w(y,f,M),p=!0,_||(g=[U(u,"click",b),U(d,"click",r[11])],_=!0)},p(y,M){r=y;let T=e;e=h(r),e===T?~e&&v[e].p(r,M):(t&&(fe(),O(v[T],1,1,()=>{v[T]=null}),ce()),~e?(t=v[e],t?t.p(r,M):(t=v[e]=m[e](r),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(y){p||($(t),p=!0)},o(y){O(t),p=!1},d(y){~e&&v[e].d(y),y&&k(n),y&&k(i),y&&k(o),y&&k(s),y&&k(a),y&&k(l),y&&k(f),_=!1,Ce(g)}}}function Qr(r,e){let t,n,i;return n=new Pl({props:{id:e[13].id,label:e[15]+1+") "+e[2](e[13]),$$slots:{default:[Bl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=be(),N(n.$$.fragment),this.first=t},m(o,s){w(o,t,s),B(n,o,s),i=!0},p(o,s){e=o;const a={};s&2&&(a.id=e[13].id),s&2&&(a.label=e[15]+1+") "+e[2](e[13])),s&65539&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){O(n.$$.fragment,o),i=!1},d(o){o&&k(t),D(n,o)}}}function Dl(r){let e=[],t=new Map,n,i,o,s,a=r[1].features;const l=u=>u[13].id;for(let u=0;u<a.length;u+=1){let c=Zr(r,a,u),d=l(c);t.set(d,e[u]=Qr(d,c))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=be()},m(u,c){for(let d=0;d<e.length;d+=1)e[d].m(u,c);w(u,n,c),i=!0,o||(s=U(window,"keydown",r[3]),o=!0)},p(u,[c]){c&7&&(a=u[1].features,fe(),e=uo(e,c,l,1,u,a,t,n.parentNode,fo,Qr,n,Zr),ce())},i(u){if(!i){for(let c=0;c<a.length;c+=1)$(e[c]);i=!0}},o(u){for(let c=0;c<e.length;c+=1)O(e[c]);i=!1},d(u){for(let c=0;c<e.length;c+=1)e[c].d(u);u&&k(n),o=!1,s()}}}function jl(r,e,t){let n,i;re(r,Ee,m=>t(12,n=m)),re(r,ne,m=>t(1,i=m));let{schema:o}=e;function s(m){var h,b,y,M,T;if(o=="planning")return((h=m.properties.planning)==null?void 0:h.name)||"Untitled polygon";if(o=="v2")return((y=(b=m.properties.v2)==null?void 0:b.Route)==null?void 0:y.name)||((T=(M=m.properties.v2)==null?void 0:M.Crossing)==null?void 0:T.name)||"Untitled intervention";if(m.properties.name)return m.properties.name;var v=m.properties.intervention_type;return v=="other"&&(m.geometry.type=="Point"?v="point":m.geometry.type=="LineString"?v="line":v="polygon"),`Untitled ${v}`}function a(m){if(m.key=="Delete"){const v=m.target.tagName;if(v=="INPUT"||v=="TEXTAREA")return;m.preventDefault();const h=n;h&&kr(h)}}function l(m,v){r.$$.not_equal(v.properties.name,m)&&(v.properties.name=m,ne.set(i))}function u(m,v){r.$$.not_equal(v.properties.intervention_type,m)&&(v.properties.intervention_type=m,ne.set(i))}function c(m,v){r.$$.not_equal(v.properties.description,m)&&(v.properties.description=m,ne.set(i))}function d(m,v){r.$$.not_equal(v.properties,m)&&(v.properties=m,ne.set(i))}function f(m,v){r.$$.not_equal(v.properties,m)&&(v.properties=m,ne.set(i))}function p(m,v){r.$$.not_equal(v.properties,m)&&(v.properties=m,ne.set(i))}const _=m=>kr(m.id),g=()=>Ee.set(null);return r.$$set=m=>{"schema"in m&&t(0,o=m.schema)},[o,i,s,a,l,u,c,d,f,p,_,g]}class Ul extends W{constructor(e){super(),V(this,e,jl,Dl,Y,{schema:0})}}function ei(r){let e,t;return e=new Fi({props:{id:void 0}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p:G,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ql(r){let e,t,n,i,o,s,a,l,u,c,d,f=r[1]=="speed limits"&&ei();return{c(){e=E("label"),t=J(`Show layer:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",a=C(),f&&f.c(),l=be(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,n.disabled=s=r[0]!=null,r[1]===void 0&&ot(()=>r[2].call(n))},m(p,_){w(p,e,_),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[1]),w(p,a,_),f&&f.m(p,_),w(p,l,_),u=!0,c||(d=U(n,"change",r[2]),c=!0)},p(p,[_]){(!u||_&1&&s!==(s=p[0]!=null))&&(n.disabled=s),_&2&&Ke(n,p[1]),p[1]=="speed limits"?f?(f.p(p,_),_&2&&$(f,1)):(f=ei(),f.c(),$(f,1),f.m(l.parentNode,l)):f&&(fe(),O(f,1,1,()=>{f=null}),ce())},i(p){u||($(f),u=!0)},o(p){O(f),u=!1},d(p){p&&k(e),p&&k(a),f&&f.d(p),p&&k(l),c=!1,d()}}}function Gl(r,e,t){let n;re(r,Ee,s=>t(0,n=s));let i="none";function o(){i=$n(this),t(1,i),t(0,n)}return r.$$.update=()=>{r.$$.dirty&1&&n&&t(1,i="none")},[n,i,o]}class Hl extends W{constructor(e){super(),V(this,e,Gl,ql,Y,{})}}function Ve(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ue(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Zn(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Je(r,e,t){t===void 0&&(t={});var n=Ve(r),i=Ve(e),o=Fe(i[1]-n[1]),s=Fe(i[0]-n[0]),a=Fe(n[1]),l=Fe(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return co(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function sn(r,e){return e===void 0&&(e={}),po(r,function(t,n){var i=n.geometry.coordinates;return t+Je(i[0],i[1],e)},0)}function zl(r){let e,t,n,i,o,s,a,l,u,c,d,f,p,_,g,m,v,h,b,y=r[0].features.length+"",M,T,P,A,x,R,j,Z;return{c(){e=E("div"),t=E("label"),n=J(`Scheme name:
    `),i=E("input"),o=C(),s=E("br"),a=C(),l=E("div"),u=E("label"),c=E("input"),d=C(),f=E("button"),f.textContent="Load from GeoJSON",p=C(),_=E("button"),_.textContent="Export to GeoJSON",g=C(),m=E("br"),v=C(),h=E("div"),b=E("span"),M=J(y),T=J(" objects"),P=C(),A=E("button"),x=J("Clear all"),L(i,"type","text"),L(c,"type","file"),L(c,"id","load_geojson"),L(c,"class","svelte-lhyd1e"),L(f,"type","button"),L(_,"type","button"),L(_,"class","align-right svelte-lhyd1e"),L(A,"type","button"),L(A,"class","align-right svelte-lhyd1e"),A.disabled=R=r[0].features.length==0},m(I,H){w(I,e,H),S(e,t),S(t,n),S(t,i),Ae(i,r[0].scheme_name),w(I,o,H),w(I,s,H),w(I,a,H),w(I,l,H),S(l,u),S(u,c),S(u,d),S(u,f),S(l,p),S(l,_),w(I,g,H),w(I,m,H),w(I,v,H),w(I,h,H),S(h,b),S(b,M),S(b,T),S(h,P),S(h,A),S(A,x),j||(Z=[U(i,"input",r[8]),U(c,"change",r[3]),U(f,"click",Yl),U(_,"click",r[2]),U(A,"click",r[1])],j=!0)},p(I,[H]){H&1&&i.value!==I[0].scheme_name&&Ae(i,I[0].scheme_name),H&1&&y!==(y=I[0].features.length+"")&&$e(M,y),H&1&&R!==(R=I[0].features.length==0)&&(A.disabled=R)},i:G,o:G,d(I){I&&k(e),I&&k(o),I&&k(s),I&&k(a),I&&k(l),I&&k(g),I&&k(m),I&&k(v),I&&k(h),j=!1,Ce(Z)}}}function Jl(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Yl(){document.getElementById("load_geojson").click()}function Xl(r,e,t){let n;re(r,ne,_=>t(0,n=_));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=!1;Yt(async()=>{let g=new URLSearchParams(window.location.search).get("geojsonUrl"),m=window.localStorage.getItem(s);if(g){console.log(`Loading GeoJSON from ${g}`);try{let h=await(await fetch(g)).text();ne.set(f(JSON.parse(h)))}catch(v){console.log(`Failed to load from URL: ${v}`)}}else if(m)try{ne.set(f(JSON.parse(m)))}catch(v){console.log(`Failed to load from local storage: ${v}`)}t(7,a=!0)});function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(ne.update(_=>(delete _.scheme_name,_.features=[],_)),Ee.set(null),je.set(null),qt.set(null),Gt.set(null))}function u(){const _=JSON.parse(JSON.stringify(n));for(let g of _.features)delete g.properties.hide_while_editing;return _}function c(){let _=u();var g=s;_.authority=i,_.origin="atip-v1",_.scheme_name&&(g+="_"+_.scheme_name),g+=".txt",Jl(g,JSON.stringify(_,null,"  "))}function d(_){const g=new FileReader;g.onload=v=>{try{ne.set(f(JSON.parse(v.target.result)))}catch(h){window.alert(`Couldn't load scheme from a file: ${h}`)}};let m=_.target.files;g.readAsText(m[0])}function f(_){let g=1;for(let m of _.features)m.properties||(m.properties={name:"",description:"",intervention_type:"other"}),m.geometry.type=="LineString"&&!m.properties.length_meters&&(m.properties.length_meters=sn(m,{units:"kilometers"})*1e3),m.id=g++;return _}function p(){n.scheme_name=this.value,ne.set(n)}return r.$$set=_=>{"authorityName"in _&&t(4,i=_.authorityName),"schema"in _&&t(5,o=_.schema)},r.$$.update=()=>{r.$$.dirty&193&&a&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,c,d,i,o,s,a,p]}class Wl extends W{constructor(e){super(),V(this,e,Xl,zl,Y,{authorityName:4,schema:5})}}const Vl="/atip/state-changing-bugs-142/assets/zoom_out_map-b2e1091a.svg";function Kl(r){let e,t,n,i,o;return{c(){e=E("button"),t=E("img"),pn(t.src,n=Vl)||L(t,"src",n),L(t,"alt","Zoom to show entire boundary"),L(e,"type","button"),L(e,"title","Zoom to show entire boundary"),L(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),i||(o=U(e,"click",r[0]),i=!0)},p:G,i:G,o:G,d(s){s&&k(e),i=!1,o()}}}function Zl(r,e,t){let n;re(r,Te,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(or(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class Ql extends W{constructor(e){super(),V(this,e,Zl,Kl,Y,{boundaryGeojson:1})}}function ea(r){let e,t,n,i,o,s,a;return{c(){e=E("div"),t=J(`Basemap:
  `),n=E("select"),i=E("option"),i.textContent="Streets",o=E("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&ot(()=>r[2].call(n)),L(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,i),S(n,o),Ke(n,r[0]),s||(a=[U(n,"change",r[2]),U(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&Ke(n,l[0])},i:G,o:G,d(l){l&&k(e),s=!1,Ce(a)}}}function ta(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=$n(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class na extends W{constructor(e){super(),V(this,e,ta,ea,Y,{style:0})}}function ti(r){let e,t,n;const i=r[3].default,o=_t(i,r,r[2],null);return{c(){e=E("div"),o&&o.c()},m(s,a){w(s,e,a),o&&o.m(e,null),n=!0},p(s,a){o&&o.p&&(!n||a&4)&&gt(o,i,s,s[2],n?vt(i,s[2],a,null):bt(s[2]),null)},i(s){n||($(o,s),ot(()=>{t||(t=kt(e,Et,{duration:100},!0)),t.run(1)}),n=!0)},o(s){O(o,s),t||(t=kt(e,Et,{duration:100},!1)),t.run(0),n=!1},d(s){s&&k(e),o&&o.d(s),s&&t&&t.end()}}}function ra(r){let e,t,n,i,o,s,a,l,u,c,d=r[0]&&ti(r);return{c(){e=E("button"),t=dn("svg"),n=dn("path"),i=C(),o=J(r[1]),s=C(),d&&d.c(),a=be(),L(n,"d","M9 5l7 7-7 7"),L(t,"style","tran"),L(t,"width","20"),L(t,"height","20"),L(t,"fill","none"),L(t,"stroke-linecap","round"),L(t,"stroke-linejoin","round"),L(t,"stroke-width","2"),L(t,"viewBox","0 0 24 24"),L(t,"stroke","currentColor"),L(t,"class","svelte-una9lq"),L(e,"aria-expanded",r[0]),L(e,"class","svelte-una9lq")},m(f,p){w(f,e,p),S(e,t),S(t,n),S(e,i),S(e,o),w(f,s,p),d&&d.m(f,p),w(f,a,p),l=!0,u||(c=U(e,"click",r[4]),u=!0)},p(f,[p]){(!l||p&2)&&$e(o,f[1]),(!l||p&1)&&L(e,"aria-expanded",f[0]),f[0]?d?(d.p(f,p),p&1&&$(d,1)):(d=ti(f),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(fe(),O(d,1,1,()=>{d=null}),ce())},i(f){l||($(d),l=!0)},o(f){O(d),l=!1},d(f){f&&k(e),f&&k(s),d&&d.d(f),f&&k(a),u=!1,c()}}}function ia(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,o=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,i=l.$$scope)},[s,o,i,n,a]}class Tn extends W{constructor(e){super(),V(this,e,ia,ra,Y,{label:1,open:0})}}function oa(r){let e,t,n,i,o,s,a,l,u,c,d,f,p,_,g;return{c(){e=E("li"),t=E("span"),n=J("Areas"),i=C(),o=E("li"),s=E("span"),a=J("Routes"),l=C(),u=E("li"),c=E("span"),d=J("Crossings"),f=C(),p=E("li"),_=E("span"),g=J("Other"),L(t,"class","svelte-l42ea0"),ue(t,"background",me.area),L(s,"class","svelte-l42ea0"),ue(s,"background",me.route),L(c,"class","svelte-l42ea0"),ue(c,"background",me.crossing),L(_,"class","svelte-l42ea0"),ue(_,"background",me.other)},m(m,v){w(m,e,v),S(e,t),S(e,n),w(m,i,v),w(m,o,v),S(o,s),S(o,a),w(m,l,v),w(m,u,v),S(u,c),S(u,d),w(m,f,v),w(m,p,v),S(p,_),S(p,g)},p:G,d(m){m&&k(e),m&&k(i),m&&k(o),m&&k(l),m&&k(u),m&&k(f),m&&k(p)}}}function sa(r){let e,t,n,i,o,s,a,l,u,c,d,f,p,_,g;return{c(){e=E("li"),t=E("span"),n=J("Preapp"),i=C(),o=E("li"),s=E("span"),a=J("Outline"),l=C(),u=E("li"),c=E("span"),d=J("Reserved matters"),f=C(),p=E("li"),_=E("span"),g=J("Local plan"),L(t,"class","svelte-l42ea0"),ue(t,"background",me.preapp),L(s,"class","svelte-l42ea0"),ue(s,"background",me.outline),L(c,"class","svelte-l42ea0"),ue(c,"background",me["reserved matters"]),L(_,"class","svelte-l42ea0"),ue(_,"background",me["local plan"])},m(m,v){w(m,e,v),S(e,t),S(e,n),w(m,i,v),w(m,o,v),S(o,s),S(o,a),w(m,l,v),w(m,u,v),S(u,c),S(u,d),w(m,f,v),w(m,p,v),S(p,_),S(p,g)},p:G,d(m){m&&k(e),m&&k(i),m&&k(o),m&&k(l),m&&k(u),m&&k(f),m&&k(p)}}}function la(r){let e;function t(o,s){return o[0]=="planning"?sa:oa}let n=t(r),i=n(r);return{c(){e=E("ul"),i.c()},m(o,s){w(o,e,s),i.m(e,null)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&k(e),i.d()}}}function aa(r){let e,t,n;return t=new Tn({props:{label:"Objects",open:!0,$$slots:{default:[la]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),L(e,"class","svelte-l42ea0")},m(i,o){w(i,e,o),B(t,e,null),n=!0},p(i,[o]){const s={};o&3&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){O(t.$$.fragment,i),n=!1},d(i){i&&k(e),D(t)}}}function ua(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class fa extends W{constructor(e){super(),V(this,e,ua,aa,Y,{schema:0})}}let ut="interventions";function ca(r,e,t){let n,i;re(r,Te,c=>t(1,n=c)),re(r,ne,c=>t(2,i=c));let{schema:o}=e;Qe(n,ut,i);const s=["match",["get","intervention_type"],"area",me.area,"route",me.route,"crossing",me.crossing,"other",me.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",me.preapp,"outline",me.outline,"reserved matters",me["reserved matters"],"local plan",me["local plan"],"white"],l=["!=","hide_while_editing",!0];return Se(n,{id:"interventions-points",source:ut,filter:["all",Ln,l,["!=","endpoint",!0]],...$t(s,An)}),Se(n,{id:"interventions-lines",source:ut,filter:["all",On,l],...wt(s,zt)}),Se(n,{id:"interventions-lines-endpoints",source:ut,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*zt,"circle-opacity":0,"circle-stroke-color":me.lineEndpointColor,"circle-stroke-width":2}}),Se(n,{id:"interventions-polygons",source:ut,filter:["all",Cn,l],...Mn(o=="planning"?a:s,.5)}),r.$$set=c=>{"schema"in c&&t(0,o=c.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let c=JSON.parse(JSON.stringify(i)),d=[];for(let f of c.features)if(f.geometry.type=="LineString")for(let p of[f.geometry.coordinates[0],f.geometry.coordinates[f.geometry.coordinates.length-1]])d.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:p}});c.features=c.features.concat(d),n.getSource(ut).setData(c)}},[o,n,i]}class pa extends W{constructor(e){super(),V(this,e,ca,null,Y,{schema:0})}}let ft="hover";function da(r,e,t){let n,i,o,s,a;return re(r,Te,l=>t(0,n=l)),re(r,ne,l=>t(1,i=l)),re(r,qt,l=>t(2,o=l)),re(r,je,l=>t(3,s=l)),re(r,Ee,l=>t(4,a=l)),Qe(n,ft,xe()),Se(n,{id:"hover-polygons",source:ft,filter:Cn,...wt(me.hovering,.5*zt,1)}),Se(n,{id:"hover-lines",source:ft,filter:On,...wt(me.hovering,1.5*zt,1)}),Se(n,{id:"hover-points",source:ft,filter:Ln,...$t(me.hovering,1.5*An,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(ft).setData(i.features.find(u=>u.id==l)):n.getSource(ft).setData(xe())}},[n,i,o,s,a]}class ha extends W{constructor(e){super(),V(this,e,da,null,Y,{})}}class fr{constructor(e,t){se(this,"owner");se(this,"map");se(this,"mapHandlers",{});se(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const Qt="edit-point-mode";class ma{constructor(e){se(this,"map");se(this,"active");se(this,"eventListenersSuccess");se(this,"eventListenersFailure");se(this,"cursor");se(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new fr(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Qe(e,Qt,xe()),Se(e,{id:"edit-point-mode",source:Qt,...$t(me.hovering,An,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=_a(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(Qt),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=xe();this.cursor&&e.features.push(this.cursor),this.map.getSource(Qt).setData(e)}}function _a(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function qi(r,e,t){if(t===void 0&&(t={}),t.final===!0)return ga(r,e);var n=Ve(r),i=Ve(e),o=Fe(n[0]),s=Fe(i[0]),a=Fe(n[1]),l=Fe(i[1]),u=Math.sin(s-o)*Math.cos(l),c=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return qn(Math.atan2(u,c))}function ga(r,e){var t=qi(e,r);return t=(t+180)%360,t}function ni(r,e,t,n){n===void 0&&(n={});var i=Ve(r),o=Fe(i[0]),s=Fe(i[1]),a=Fe(t),l=ho(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),c=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),d=qn(c),f=qn(u);return yt([d,f],n.properties)}function Qn(r){if(!r)throw new Error("geojson is required");var e=[];return sr(r,function(t){ba(t,e)}),We(e)}function ba(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Ue(n);break;case"LineString":t=[Ue(n)]}t.forEach(function(i){var o=va(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function va(r,e){var t=[];return r.reduce(function(n,i){var o=St([n,i],e);return o.bbox=ya(n,i),t.push(o),i}),t}function ya(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var Mt={},wa={get exports(){return Mt},set exports(r){Mt=r}},er={},ka={get exports(){return er},set exports(r){er=r}};(function(r,e){(function(t,n){r.exports=n()})(mo,function(){function t(h,b,y,M,T){(function P(A,x,R,j,Z){for(;j>R;){if(j-R>600){var I=j-R+1,H=x-R+1,ae=Math.log(I),Me=.5*Math.exp(2*ae/3),Pe=.5*Math.sqrt(ae*Me*(I-Me)/I)*(H-I/2<0?-1:1),oe=Math.max(R,Math.floor(x-H*Me/I+Pe)),ie=Math.min(j,Math.floor(x+(I-H)*Me/I+Pe));P(A,x,oe,ie,Z)}var Ne=A[x],Oe=R,Q=j;for(n(A,R,x),Z(A[j],Ne)>0&&n(A,R,j);Oe<Q;){for(n(A,Oe,Q),Oe++,Q--;Z(A[Oe],Ne)<0;)Oe++;for(;Z(A[Q],Ne)>0;)Q--}Z(A[R],Ne)===0?n(A,R,Q):n(A,++Q,j),Q<=x&&(R=Q+1),x<=Q&&(j=Q-1)}})(h,b,y||0,M||h.length-1,T||i)}function n(h,b,y){var M=h[b];h[b]=h[y],h[y]=M}function i(h,b){return h<b?-1:h>b?1:0}var o=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(h,b,y){if(!y)return b.indexOf(h);for(var M=0;M<b.length;M++)if(y(h,b[M]))return M;return-1}function a(h,b){l(h,0,h.children.length,b,h)}function l(h,b,y,M,T){T||(T=m(null)),T.minX=1/0,T.minY=1/0,T.maxX=-1/0,T.maxY=-1/0;for(var P=b;P<y;P++){var A=h.children[P];u(T,h.leaf?M(A):A)}return T}function u(h,b){return h.minX=Math.min(h.minX,b.minX),h.minY=Math.min(h.minY,b.minY),h.maxX=Math.max(h.maxX,b.maxX),h.maxY=Math.max(h.maxY,b.maxY),h}function c(h,b){return h.minX-b.minX}function d(h,b){return h.minY-b.minY}function f(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function p(h){return h.maxX-h.minX+(h.maxY-h.minY)}function _(h,b){return h.minX<=b.minX&&h.minY<=b.minY&&b.maxX<=h.maxX&&b.maxY<=h.maxY}function g(h,b){return b.minX<=h.maxX&&b.minY<=h.maxY&&b.maxX>=h.minX&&b.maxY>=h.minY}function m(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(h,b,y,M,T){for(var P=[b,y];P.length;)if(!((y=P.pop())-(b=P.pop())<=M)){var A=b+Math.ceil((y-b)/M/2)*M;t(h,A,b,y,T),P.push(b,A,A,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(h){var b=this.data,y=[];if(!g(h,b))return y;for(var M=this.toBBox,T=[];b;){for(var P=0;P<b.children.length;P++){var A=b.children[P],x=b.leaf?M(A):A;g(h,x)&&(b.leaf?y.push(A):_(h,x)?this._all(A,y):T.push(A))}b=T.pop()}return y},o.prototype.collides=function(h){var b=this.data;if(!g(h,b))return!1;for(var y=[];b;){for(var M=0;M<b.children.length;M++){var T=b.children[M],P=b.leaf?this.toBBox(T):T;if(g(h,P)){if(b.leaf||_(h,P))return!0;y.push(T)}}b=y.pop()}return!1},o.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var b=0;b<h.length;b++)this.insert(h[b]);return this}var y=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},o.prototype.clear=function(){return this.data=m([]),this},o.prototype.remove=function(h,b){if(!h)return this;for(var y,M,T,P=this.data,A=this.toBBox(h),x=[],R=[];P||x.length;){if(P||(P=x.pop(),M=x[x.length-1],y=R.pop(),T=!0),P.leaf){var j=s(h,P.children,b);if(j!==-1)return P.children.splice(j,1),x.push(P),this._condense(x),this}T||P.leaf||!_(P,A)?M?(y++,P=M.children[y],T=!1):P=null:(x.push(P),R.push(y),y=0,M=P,P=P.children[0])}return this},o.prototype.toBBox=function(h){return h},o.prototype.compareMinX=function(h,b){return h.minX-b.minX},o.prototype.compareMinY=function(h,b){return h.minY-b.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(h){return this.data=h,this},o.prototype._all=function(h,b){for(var y=[];h;)h.leaf?b.push.apply(b,h.children):y.push.apply(y,h.children),h=y.pop();return b},o.prototype._build=function(h,b,y,M){var T,P=y-b+1,A=this._maxEntries;if(P<=A)return a(T=m(h.slice(b,y+1)),this.toBBox),T;M||(M=Math.ceil(Math.log(P)/Math.log(A)),A=Math.ceil(P/Math.pow(A,M-1))),(T=m([])).leaf=!1,T.height=M;var x=Math.ceil(P/A),R=x*Math.ceil(Math.sqrt(A));v(h,b,y,R,this.compareMinX);for(var j=b;j<=y;j+=R){var Z=Math.min(j+R-1,y);v(h,j,Z,x,this.compareMinY);for(var I=j;I<=Z;I+=x){var H=Math.min(I+x-1,Z);T.children.push(this._build(h,I,H,M-1))}}return a(T,this.toBBox),T},o.prototype._chooseSubtree=function(h,b,y,M){for(;M.push(b),!b.leaf&&M.length-1!==y;){for(var T=1/0,P=1/0,A=void 0,x=0;x<b.children.length;x++){var R=b.children[x],j=f(R),Z=(I=h,H=R,(Math.max(H.maxX,I.maxX)-Math.min(H.minX,I.minX))*(Math.max(H.maxY,I.maxY)-Math.min(H.minY,I.minY))-j);Z<P?(P=Z,T=j<T?j:T,A=R):Z===P&&j<T&&(T=j,A=R)}b=A||b.children[0]}var I,H;return b},o.prototype._insert=function(h,b,y){var M=y?h:this.toBBox(h),T=[],P=this._chooseSubtree(M,this.data,b,T);for(P.children.push(h),u(P,M);b>=0&&T[b].children.length>this._maxEntries;)this._split(T,b),b--;this._adjustParentBBoxes(M,T,b)},o.prototype._split=function(h,b){var y=h[b],M=y.children.length,T=this._minEntries;this._chooseSplitAxis(y,T,M);var P=this._chooseSplitIndex(y,T,M),A=m(y.children.splice(P,y.children.length-P));A.height=y.height,A.leaf=y.leaf,a(y,this.toBBox),a(A,this.toBBox),b?h[b-1].children.push(A):this._splitRoot(y,A)},o.prototype._splitRoot=function(h,b){this.data=m([h,b]),this.data.height=h.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(h,b,y){for(var M,T,P,A,x,R,j,Z=1/0,I=1/0,H=b;H<=y-b;H++){var ae=l(h,0,H,this.toBBox),Me=l(h,H,y,this.toBBox),Pe=(T=ae,P=Me,A=void 0,x=void 0,R=void 0,j=void 0,A=Math.max(T.minX,P.minX),x=Math.max(T.minY,P.minY),R=Math.min(T.maxX,P.maxX),j=Math.min(T.maxY,P.maxY),Math.max(0,R-A)*Math.max(0,j-x)),oe=f(ae)+f(Me);Pe<Z?(Z=Pe,M=H,I=oe<I?oe:I):Pe===Z&&oe<I&&(I=oe,M=H)}return M||y-b},o.prototype._chooseSplitAxis=function(h,b,y){var M=h.leaf?this.compareMinX:c,T=h.leaf?this.compareMinY:d;this._allDistMargin(h,b,y,M)<this._allDistMargin(h,b,y,T)&&h.children.sort(M)},o.prototype._allDistMargin=function(h,b,y,M){h.children.sort(M);for(var T=this.toBBox,P=l(h,0,b,T),A=l(h,y-b,y,T),x=p(P)+p(A),R=b;R<y-b;R++){var j=h.children[R];u(P,h.leaf?T(j):j),x+=p(P)}for(var Z=y-b-1;Z>=b;Z--){var I=h.children[Z];u(A,h.leaf?T(I):I),x+=p(A)}return x},o.prototype._adjustParentBBoxes=function(h,b,y){for(var M=y;M>=0;M--)u(b[M],h)},o.prototype._condense=function(h){for(var b=h.length-1,y=void 0;b>=0;b--)h[b].children.length===0?b>0?(y=h[b-1].children).splice(y.indexOf(h[b]),1):this.clear():a(h[b],this.toBBox)},o})})(ka);const Sa=lr(_o),Ea=lr(go),Ma=lr(bo);var Be=er,Gi=Sa,Hi=Ea,ct=Ma.default,$a=Hi.featureEach;Hi.coordEach;Gi.polygon;var ri=Gi.featureCollection;function zi(r){var e=new Be(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ct(t),Be.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ct(i),n.push(i)}):$a(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ct(i),n.push(i)}),Be.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ct(t),Be.prototype.remove.call(this,t,n)},e.clear=function(){return Be.prototype.clear.call(this)},e.search=function(t){var n=Be.prototype.search.call(this,this.toBBox(t));return ri(n)},e.collides=function(t){return Be.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Be.prototype.all.call(this);return ri(t)},e.toJSON=function(){return Be.prototype.toJSON.call(this)},e.fromJSON=function(t){return Be.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=ct(t);else if(t.type==="FeatureCollection")n=ct(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}wa.exports=zi;Mt.default=zi;function Ji(r,e){var t={},n=[];if(r.type==="LineString"&&(r=wr(r)),e.type==="LineString"&&(e=wr(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=ii(r,e);return i&&n.push(i),We(n)}var o=Mt();return o.load(Qn(e)),hn(Qn(r),function(s){hn(o.search(s),function(a){var l=ii(s,a);if(l){var u=Ue(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),We(n)}function ii(r,e){var t=Ue(r),n=Ue(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],c=n[1][0],d=n[1][1],f=(d-u)*(s-i)-(c-l)*(a-o),p=(c-l)*(o-u)-(d-u)*(i-l),_=(s-i)*(o-u)-(a-o)*(i-l);if(f===0)return p===0&&_===0,null;var g=p/f,m=_/f;if(g>=0&&g<=1&&m>=0&&m<=1){var v=i+g*(s-i),h=o+g*(a-o);return yt([v,h])}return null}function Jt(r,e,t){t===void 0&&(t={});var n=yt([1/0,1/0],{dist:1/0}),i=0;return sr(r,function(o){for(var s=Ue(o),a=0;a<s.length-1;a++){var l=yt(s[a]);l.properties.dist=Je(e,l,t);var u=yt(s[a+1]);u.properties.dist=Je(e,u,t);var c=Je(l,u,t),d=Math.max(l.properties.dist,u.properties.dist),f=qi(l,u),p=ni(e,d,f+90,t),_=ni(e,d,f-90,t),g=Ji(St([p.geometry.coordinates,_.geometry.coordinates]),St([l.geometry.coordinates,u.geometry.coordinates])),m=null;g.features.length>0&&(m=g.features[0],m.properties.dist=Je(e,m,t),m.properties.location=i+Je(l,m,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+c),m&&m.properties.dist<n.properties.dist&&(n=m,n.properties.index=a),i+=c}}),n}const pt="edit-polygon-mode";class La{constructor(e){se(this,"map");se(this,"active");se(this,"eventListenersSuccess");se(this,"eventListenersFailure");se(this,"points");se(this,"cursor");se(this,"hover");se(this,"dragFrom");se(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new fr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Qe(e,pt,xe()),Se(e,{id:"edit-polygon-fill",source:pt,filter:Cn,...Mn("red",["case",["boolean",["get","hover"],"false"],1,.5])}),Se(e,{id:"edit-polygon-lines",source:pt,filter:On,...wt("black",8,.5)}),Se(e,{id:"edit-polygon-vertices",source:pt,filter:Ln,...$t(me.hovering,An,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(si(this.points).forEach((n,i)=>{t.push([i+1,Jt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(pt),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=xe();this.points.forEach((n,i)=>{let o=oi(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(si(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(pt).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=oi(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function oi(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function si(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let K;const He=new Array(32).fill(void 0);He.push(void 0,null,!0,!1);function X(r){return He[r]}let Dt=He.length;function Oa(r){r<36||(He[r]=Dt,Dt=r)}function tr(r){const e=X(r);return Oa(r),e}const Yi=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Yi.decode();let ln=new Uint8Array;function jt(){return ln.byteLength===0&&(ln=new Uint8Array(K.memory.buffer)),ln}function ht(r,e){return Yi.decode(jt().subarray(r,r+e))}function ve(r){Dt===He.length&&He.push(He.length+1);const e=Dt;return Dt=He[e],He[e]=r,e}function Bn(r){return r==null}let an=new Float64Array;function Ca(){return an.byteLength===0&&(an=new Float64Array(K.memory.buffer)),an}let un=new Int32Array;function ye(){return un.byteLength===0&&(un=new Int32Array(K.memory.buffer)),un}let Xe=0;const fn=new TextEncoder("utf-8"),Aa=typeof fn.encodeInto=="function"?function(r,e){return fn.encodeInto(r,e)}:function(r,e){const t=fn.encode(r);return e.set(t),{read:r.length,written:t.length}};function en(r,e,t){if(t===void 0){const a=fn.encode(r),l=e(a.length);return jt().subarray(l,l+a.length).set(a),Xe=a.length,l}let n=r.length,i=e(n);const o=jt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=jt().subarray(i+s,i+n),l=Aa(r,a);s+=l.written}return Xe=s,i}function nr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=nr(r[0]));for(let s=1;s<i;s++)o+=", "+nr(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ta(r,e){const t=e(r.length*1);return jt().set(r,t/1),Xe=r.length,t}function Dn(r,e){try{return r.apply(this,e)}catch(t){K.__wbindgen_exn_store(ve(t))}}class wn{static __wrap(e){const t=Object.create(wn.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();K.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=K.__wbindgen_add_to_stack_pointer(-16),s=Ta(e,K.__wbindgen_malloc),a=Xe;K.jsroutesnapper_new(o,s,a);var t=ye()[o/4+0],n=ye()[o/4+1],i=ye()[o/4+2];if(i)throw tr(n);return wn.__wrap(t)}finally{K.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){K.jsroutesnapper_setConfig(this.ptr,ve(e))}toFinalFeature(){try{const n=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_toFinalFeature(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];let i;return e!==0&&(i=ht(e,t).slice(),K.__wbindgen_free(e,t*1)),i}finally{K.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_renderGeojson(n,this.ptr);var e=ye()[n/4+0],t=ye()[n/4+1];return ht(e,t)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(e,t)}}setSnapMode(e){K.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return K.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){K.jsroutesnapper_onClick(this.ptr)}onDragStart(){return K.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return K.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){K.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=K.__wbindgen_add_to_stack_pointer(-16);K.jsroutesnapper_editExisting(i,this.ptr,ve(e));var t=ye()[i/4+0],n=ye()[i/4+1];if(n)throw tr(t)}finally{K.__wbindgen_add_to_stack_pointer(16)}}}async function Ra(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Pa(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){tr(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=X(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ht(e,t));return ve(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=ht(e,t);return ve(n)},r.wbg.__wbindgen_is_object=function(e){const t=X(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return X(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return X(e)in X(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=X(t),i=typeof n=="number"?n:void 0;Ca()[e/8+1]=Bn(i)?0:i,ye()[e/4+0]=!Bn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return X(e)==X(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=X(t),i=typeof n=="string"?n:void 0;var o=Bn(i)?0:en(i,K.__wbindgen_malloc,K.__wbindgen_realloc),s=Xe;ye()[e/4+1]=s,ye()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(X(t)),i=en(n,K.__wbindgen_malloc,K.__wbindgen_realloc),o=Xe;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=X(e);return ve(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=X(e)[X(t)];return ve(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(X(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(X(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(X(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(X(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(X(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=X(e)[t>>>0];return ve(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return X(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof X(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=X(e).next;return ve(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Dn(function(e){const t=X(e).next();return ve(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return X(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=X(e).value;return ve(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ve(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Dn(function(e,t){const n=Reflect.get(X(e),X(t));return ve(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Dn(function(e,t){const n=X(e).call(X(t));return ve(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(X(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=X(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=X(e).buffer;return ve(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(X(e));return ve(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){X(e).set(X(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return X(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=X(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ve(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=X(t).stack,i=en(n,K.__wbindgen_malloc,K.__wbindgen_realloc),o=Xe;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(ht(e,t))}finally{K.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=nr(X(t)),i=en(n,K.__wbindgen_malloc,K.__wbindgen_realloc),o=Xe;ye()[e/4+1]=o,ye()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ht(e,t))},r.wbg.__wbindgen_memory=function(){const e=K.memory;return ve(e)},r}function Fa(r,e){return K=r.exports,Xi.__wbindgen_wasm_module=e,an=new Float64Array,un=new Int32Array,ln=new Uint8Array,K}async function Xi(r){typeof r>"u"&&(r="/atip/state-changing-bugs-142/assets/route_snapper_bg.wasm");const e=Pa();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Ra(await r,e);return Fa(t,n)}const At="route-snapper",li=10,Ia=30;class xa{constructor(e,t){se(this,"map");se(this,"inner");se(this,"active");se(this,"eventListenersSuccessRoute");se(this,"eventListenersSuccessArea");se(this,"eventListenersFailure");se(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new wn(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Qe(e,At,xe()),Se(e,{id:"route-points",source:At,filter:Ln,...$t(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",li/2,li])}),Se(e,{id:"route-lines",source:At,filter:On,...wt("black",2.5)}),Se(e,{id:"route-polygons",source:At,filter:Cn,...Mn("black",.5)}),this.events=new fr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Ia,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(At).setData(JSON.parse(this.inner.renderGeojson()))}}function Na(r){let e,t,n,i,o,s,a,l;return{c(){e=E("button"),t=E("img"),i=C(),o=J(r[2]),pn(t.src,n=r[3])||L(t,"src",n),L(t,"alt",r[2]),L(t,"class","svelte-1vvpkg9"),L(e,"type","button"),e.disabled=s=r[0]==r[1],L(e,"class","svelte-1vvpkg9")},m(u,c){w(u,e,c),S(e,t),S(e,i),S(e,o),a||(l=U(e,"click",r[5]),a=!0)},p(u,[c]){c&8&&!pn(t.src,n=u[3])&&L(t,"src",n),c&4&&L(t,"alt",u[2]),c&4&&$e(o,u[2]),c&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:G,o:G,d(u){u&&k(e),a=!1,l()}}}function Ba(r,e,t){let{mode:n}=e,{thisMode:i}=e,{label:o}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(i);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,i=u.thisMode),"label"in u&&t(2,o=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,i,o,s,a,l]}class nt extends W{constructor(e){super(),V(this,e,Ba,Na,Y,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function ai(r){let e;function t(o,s){return o[1]?ja:Da}let n=t(r),i=n(r);return{c(){i.c(),e=be()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&k(e)}}}function Da(r){let e;return{c(){e=E("p"),e.textContent="Click an object to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function ja(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another object"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ua(r){let e,t=r[0]==mt&&ai(r);return{c(){t&&t.c(),e=be()},m(n,i){t&&t.m(n,i),w(n,e,i)},p(n,[i]){n[0]==mt?t?t.p(n,i):(t=ai(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:G,o:G,d(n){t&&t.d(n),n&&k(e)}}}const mt="edit-attribute";function Wi(){}function qa(r,e,t){let n,i,o,s;re(r,Te,p=>t(5,n=p)),re(r,ne,p=>t(6,i=p)),re(r,Gt,p=>t(7,o=p)),re(r,Ee,p=>t(1,s=p));let{mode:a}=e,{changeMode:l}=e;function u(){Ee.set(null)}n.on("mousemove",c),n.on("mouseout",d),n.on("click",f),it(()=>{n.off("mousemove",c),n.off("mouseout",d),n.off("click",f)});function c(p){var _;if(a==mt){let g=n.queryRenderedFeatures(p.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});je.set(((_=g[0])==null?void 0:_.id)||null)}}function d(){a==mt&&je.set(null)}function f(p){if(a==mt){let _=n.queryRenderedFeatures(p.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});_.length>0?Ee.set(_[0].id):Ee.set(null)}}return r.$$set=p=>{"mode"in p&&t(0,a=p.mode),"changeMode"in p&&t(2,l=p.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let p=o;if(p){let _=i.features.find(g=>g.id==p);_.geometry.type=="Point"?n.flyTo({center:_.geometry.coordinates,duration:500}):n.fitBounds(or(_),{padding:200,duration:500}),l(mt)}}},[a,s,l,Wi,u,n,i,o]}class Ga extends W{constructor(e){super(),V(this,e,qa,Ua,Y,{mode:0,changeMode:2,start:3,stop:4})}get start(){return Wi}get stop(){return this.$$.ctx[4]}}function Ha(r){let e,t;return{c:G,m(n,i){e||(t=U(window,"keydown",r[0]),e=!0)},p:G,i:G,o:G,d(n){e=!1,t()}}}function za(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class Rn extends W{constructor(e){super(),V(this,e,za,Ha,Y,{tool:1})}}function Ja(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Ya(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Xa(r){let e,t,n,i,o,s,a,l,u,c;function d(_,g){return _[1]?Ya:Ja}let f=d(r),p=f(r);return a=new Rn({props:{tool:r[0]}}),{c(){e=E("ul"),p.c(),t=C(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=C(),o=E("button"),o.textContent="Cancel",s=C(),N(a.$$.fragment),L(o,"type","button")},m(_,g){w(_,e,g),p.m(e,null),S(e,t),S(e,n),w(_,i,g),w(_,o,g),w(_,s,g),B(a,_,g),l=!0,u||(c=U(o,"click",r[2]),u=!0)},p(_,[g]){f!==(f=d(_))&&(p.d(1),p=f(_),p&&(p.c(),p.m(e,t)));const m={};g&1&&(m.tool=_[0]),a.$set(m)},i(_){l||($(a.$$.fragment,_),l=!0)},o(_){O(a.$$.fragment,_),l=!1},d(_){_&&k(e),p.d(),_&&k(i),_&&k(o),_&&k(s),D(a,_),u=!1,c()}}}function Wa(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class Vi extends W{constructor(e){super(),V(this,e,Wa,Xa,Y,{pointTool:0,editingExisting:1})}}function Va(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function Ka(r){let e,t,n,i,o,s,a,l,u,c,d;return e=new Tn({props:{label:"Help",$$slots:{default:[Va]},$$scope:{ctx:r}}}),l=new Rn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=C(),n=E("div"),i=E("button"),i.textContent="Finish",o=C(),s=E("button"),s.textContent="Cancel",a=C(),N(l.$$.fragment),L(i,"type","button"),L(s,"type","button"),ue(n,"display","flex"),ue(n,"justify-content","space-between")},m(f,p){B(e,f,p),w(f,t,p),w(f,n,p),S(n,i),S(n,o),S(n,s),w(f,a,p),B(l,f,p),u=!0,c||(d=[U(i,"click",r[1]),U(s,"click",r[2])],c=!0)},p(f,[p]){const _={};p&8&&(_.$$scope={dirty:p,ctx:f}),e.$set(_);const g={};p&1&&(g.tool=f[0]),l.$set(g)},i(f){u||($(e.$$.fragment,f),$(l.$$.fragment,f),u=!0)},o(f){O(e.$$.fragment,f),O(l.$$.fragment,f),u=!1},d(f){D(e,f),f&&k(t),f&&k(n),f&&k(a),D(l,f),c=!1,Ce(d)}}}function Za(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class Ki extends W{constructor(e){super(),V(this,e,Za,Ka,Y,{polygonTool:0})}}function Qa(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function eu(r){let e,t,n,i,o,s,a,l,u,c,d;return e=new Tn({props:{label:"Help",$$slots:{default:[Qa]},$$scope:{ctx:r}}}),l=new Rn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=C(),n=E("div"),i=E("button"),i.textContent="Finish",o=C(),s=E("button"),s.textContent="Cancel",a=C(),N(l.$$.fragment),L(i,"type","button"),L(s,"type","button"),ue(n,"display","flex"),ue(n,"justify-content","space-between")},m(f,p){B(e,f,p),w(f,t,p),w(f,n,p),S(n,i),S(n,o),S(n,s),w(f,a,p),B(l,f,p),u=!0,c||(d=[U(i,"click",r[1]),U(s,"click",r[2])],c=!0)},p(f,[p]){const _={};p&8&&(_.$$scope={dirty:p,ctx:f}),e.$set(_);const g={};p&1&&(g.tool=f[0]),l.$set(g)},i(f){u||($(e.$$.fragment,f),$(l.$$.fragment,f),u=!0)},o(f){O(e.$$.fragment,f),O(l.$$.fragment,f),u=!1},d(f){D(e,f),f&&k(t),f&&k(n),f&&k(a),D(l,f),c=!1,Ce(d)}}}function tu(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class Zi extends W{constructor(e){super(),V(this,e,tu,eu,Y,{routeTool:0})}}function nu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:G,d(t){t&&k(e)}}}function ru(r){let e,t,n,i,o,s,a,l,u,c,d,f,p,_,g;return e=new Tn({props:{label:"Help",$$slots:{default:[nu]},$$scope:{ctx:r}}}),f=new Rn({props:{tool:r[0]}}),{c(){N(e.$$.fragment),t=C(),n=E("label"),i=E("input"),o=J(`
  Avoid doubling back`),s=C(),a=E("div"),l=E("button"),l.textContent="Finish",u=C(),c=E("button"),c.textContent="Cancel",d=C(),N(f.$$.fragment),L(i,"type","checkbox"),L(l,"type","button"),L(c,"type","button"),ue(a,"display","flex"),ue(a,"justify-content","space-between")},m(m,v){B(e,m,v),w(m,t,v),w(m,n,v),S(n,i),i.checked=r[1],S(n,o),w(m,s,v),w(m,a,v),S(a,l),S(a,u),S(a,c),w(m,d,v),B(f,m,v),p=!0,_||(g=[U(i,"change",r[2]),U(l,"click",r[3]),U(c,"click",r[4])],_=!0)},p(m,[v]){const h={};v&32&&(h.$$scope={dirty:v,ctx:m}),e.$set(h),v&2&&(i.checked=m[1]);const b={};v&1&&(b.tool=m[0]),f.$set(b)},i(m){p||($(e.$$.fragment,m),$(f.$$.fragment,m),p=!0)},o(m){O(e.$$.fragment,m),O(f.$$.fragment,m),p=!1},d(m){D(e,m),m&&k(t),m&&k(n),m&&k(s),m&&k(a),m&&k(d),D(f,m),_=!1,Ce(g)}}}function iu(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class Qi extends W{constructor(e){super(),V(this,e,iu,ru,Y,{routeTool:0})}}function ui(r){let e,t,n,i;const o=[uu,au,lu,su,ou],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=be()},m(l,u){s[e].m(l,u),w(l,n,u),i=!0},p(l,u){let c=e;e=a(l),e===c?s[e].p(l,u):(fe(),O(s[c],1,1,()=>{s[c]=null}),ce(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){i||($(t),i=!0)},o(l){O(t),i=!1},d(l){s[e].d(l),l&&k(n)}}}function ou(r){let e;return{c(){e=E("p"),e.textContent="Click an object to edit its geometry"},m(t,n){w(t,e,n)},p:G,i:G,o:G,d(t){t&&k(e)}}}function su(r){let e,t;return e=new Qi({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function lu(r){let e,t;return e=new Zi({props:{routeTool:r[3]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function au(r){let e,t;return e=new Ki({props:{polygonTool:r[2]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function uu(r){let e,t;return e=new Vi({props:{pointTool:r[1],editingExisting:!0}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function fu(r){let e,t,n=r[0]==qe&&ui(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==qe?n?(n.p(i,o),o&1&&$(n,1)):(n=ui(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(fe(),O(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const qe="edit-geometry";function eo(){}function cu(r,e,t){let n;re(r,Te,g=>t(8,n=g));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function c(){l&&(o.stop(),s.stop(),a.stop(),ne.update(g=>{let m=g.features.find(v=>v.id==l);return delete m.properties.hide_while_editing,g})),l=null,t(4,u=null),je.set(null)}n.on("mousemove",d),n.on("mouseout",f),n.on("click",p),it(()=>{n.off("mousemove",d),n.off("mouseout",f),n.off("click",p)}),a.addEventListenerSuccessRoute(g=>{i==qe&&(ne.update(m=>{let v=m.features.find(h=>h.id==l);return v.properties.length_meters=g.properties.length_meters,v.properties.waypoints=g.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=g.geometry,m}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{i==qe&&(ne.update(m=>{let v=m.features.find(h=>h.id==l);return v.properties.waypoints=g.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=g.geometry,m}),l=null,t(4,u=null))});for(let g of[o,s])g.addEventListenerSuccess(m=>{i==qe&&(ne.update(v=>{let h=v.features.find(b=>b.id==l);return h.geometry=m.geometry,delete h.properties.hide_while_editing,v}),l=null,t(4,u=null))});for(let g of[o,s,a])g.addEventListenerFailure(()=>{i==qe&&(ne.update(m=>{let v=m.features.find(h=>h.id==l);return delete v.properties.hide_while_editing,m}),l=null,t(4,u=null))});function d(g){var m;if(i==qe&&l==null){let v=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});je.set(((m=v[0])==null?void 0:m.id)||null)}}function f(){i==qe&&l==null&&je.set(null)}function p(g){if(i==qe&&l==null){let m=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0&&_(m[0].id)}}function _(g){je.set(null);let m=null;ne.update(h=>(m=h.features.find(b=>b.id==g),m.properties.hide_while_editing=!0,h));let v=m;l=g,v.geometry.type=="LineString"?(a.editExistingRoute(v),t(4,u="route")):v.geometry.type=="Polygon"?v.properties.waypoints?(a.editExistingArea(v),t(4,u="snap-polygon")):(s.editExisting(v),t(4,u="free-polygon")):v.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"pointTool"in g&&t(1,o=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[i,o,s,a,u,eo,c]}class pu extends W{constructor(e){super(),V(this,e,cu,fu,Y,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return eo}get stop(){return this.$$.ctx[6]}}async function du(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:c}=await n.read();if(u)break;s.push(c),o+=c.length;const d=100*o/i;e.style=`background: linear-gradient(to right, red ${d}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function hu(r){let e,t;return e=new Qi({props:{routeTool:r[0]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function mu(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:G,i:G,o:G,d(t){t&&k(e),r[7](null)}}}function _u(r){let e,t,n,i;const o=[mu,hu],s=[];function a(l,u){return l[0]?l[1]==rr?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=be()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),i=!0},p(l,[u]){let c=e;e=a(l),e===c?~e&&s[e].p(l,u):(t&&(fe(),O(s[c],1,1,()=>{s[c]=null}),ce()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||($(t),i=!0)},o(l){O(t),i=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const rr="route";function gu(r,e,t){let n;re(r,Te,f=>t(8,n=f));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function c(){l==null||l.stop()}Yt(async()=>{await Xi(),console.log(`Grabbing ${s}`);try{const f=await du(s,a);t(0,l=new xa(n,f))}catch(f){console.log(`Route tool broke: ${f}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==rr&&o("edit-attribute")}),l.addEventListenerSuccessRoute(f=>{i==rr&&(ne.update(p=>(f.id=Xt(p),f.properties.intervention_type="route",p.features.push(f),p)),o("edit-attribute"),Ee.set(f.id))})});function d(f){le[f?"unshift":"push"](()=>{a=f,t(2,a)})}return r.$$set=f=>{"mode"in f&&t(1,i=f.mode),"changeMode"in f&&t(3,o=f.changeMode),"url"in f&&t(4,s=f.url),"routeTool"in f&&t(0,l=f.routeTool)},[l,i,a,o,s,u,c,d]}class bu extends W{constructor(e){super(),V(this,e,gu,_u,Y,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function fi(r){let e,t;return e=new Vi({props:{pointTool:r[1],editingExisting:!1}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function vu(r){let e,t,n=r[0]==kn&&fi(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==kn?n?(n.p(i,o),o&1&&$(n,1)):(n=fi(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(fe(),O(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const kn="point";function yu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==kn&&(ne.update(u=>(l.id=Xt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),Ee.set(l.id))}),o.addEventListenerFailure(()=>{n==kn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class wu extends W{constructor(e){super(),V(this,e,yu,vu,Y,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ci(r){let e,t;return e=new Ki({props:{polygonTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function ku(r){let e,t,n=r[0]==Sn&&ci(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==Sn?n?(n.p(i,o),o&1&&$(n,1)):(n=ci(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(fe(),O(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const Sn="free-polygon";function Su(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Sn&&(ne.update(u=>(l.id=Xt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Ee.set(l.id))}),o.addEventListenerFailure(()=>{n==Sn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Eu extends W{constructor(e){super(),V(this,e,Su,ku,Y,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function pi(r){let e,t;return e=new Zi({props:{routeTool:r[1]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function Mu(r){let e,t,n=r[0]==En&&pi(r);return{c(){n&&n.c(),e=be()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==En?n?(n.p(i,o),o&1&&$(n,1)):(n=pi(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(fe(),O(n,1,1,()=>{n=null}),ce())},i(i){t||($(n),t=!0)},o(i){O(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const En="snap-polygon";function $u(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==En&&(ne.update(u=>(l.id=Xt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),Ee.set(l.id))}),o.addEventListenerFailure(()=>{n==En&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class Lu extends W{constructor(e){super(),V(this,e,$u,Mu,Y,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function Ou(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Je(r.slice(0,2),[n,t]),s=Je(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function Cu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return vo(r,function(s){Au(s,o,n)}),r}function Au(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Tu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=Zn(r),n=Zn(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Cu(e,{precision:7});switch(n){case"Point":return ir(r,i);case"MultiPoint":return di(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return di(r,Ji(r,i))}}function di(r,e){var t=[],n=Mt();return sr(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=ir(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=Ou(yo(a)))}),n.load(We(t));else{var o=n.search(i);if(o.features.length){var s=to(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),hn(ir(s,i),function(a){t.push(a),n.insert(a)})}}}),We(t)}function ir(r,e){var t=[],n=Ue(r)[0],i=Ue(r)[r.geometry.coordinates.length-1];if(jn(n,Ve(e))||jn(i,Ve(e)))return We([r]);var o=Mt(),s=Qn(r);o.load(s);var a=o.search(e);if(!a.features.length)return We([r]);var l=to(e,a),u=[n],c=wo(s,function(d,f,p){var _=Ue(f)[1],g=Ve(e);return p===l.id?(d.push(g),t.push(St(d)),jn(g,_)?[g]:[g,_]):(d.push(_),d)},u);return c.length>1&&t.push(St(c)),We(t)}function to(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return hn(e,function(i){var o=Jt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function jn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Ru(r,e,t){var n=Ue(t);if(Zn(t)!=="LineString")throw new Error("line must be a LineString");var i=Jt(t,r),o=Jt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),St(a,t.properties)}function hi(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Pu(r){let e,t,n,i=r[0]==Ut&&hi();return{c(){i&&i.c(),e=be()},m(o,s){i&&i.m(o,s),w(o,e,s),t||(n=U(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Ut?i||(i=hi(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:G,o:G,d(o){i&&i.d(o),o&&k(e),t=!1,n()}}}const Ut="split-route",Fu=10,Iu=30;let Un="split-route";function no(){}function mi(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function xu(r,e,t){let n,i;re(r,ne,g=>t(8,n=g)),re(r,Te,g=>t(6,i=g));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",c),i.on("click",d),it(()=>{i.off("mousemove",c),i.off("click",d)}),Qe(i,Un,xe()),Se(i,{id:"draw-split-route",source:Un,...$t("black",Fu,["case",["==",["get","snapped"],!0],1,.5])});function c(g){if(o!=Ut)return;t(5,l=mi(g.lngLat.toArray(),!1)),u=null;const m=[g.point.x-Iu,g.point.y],v=i.unproject(g.point).distanceTo(i.unproject(m))/1e3;let h=[];for(let[b,y]of n.features.entries())if(y.geometry.type=="LineString"){let M=Jt(y.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=v&&h.push([b,M.geometry.coordinates,M.properties.dist])}h.sort((b,y)=>b[2]-y[2]),h.length>0&&(t(5,l=mi(h[0][1],!0)),u=h[0][0])}function d(){if(o==Ut)if(u==null)s("edit-attribute");else{let g=Tu(n.features[u],l);if(g.features.length==2){let m=g.features[0],v=g.features[1];ne.update(h=>(m.id=h.features[u].id,v.id=Xt(h),m.properties=JSON.parse(JSON.stringify(h.features[u].properties)),v.properties=JSON.parse(JSON.stringify(m.properties)),f(h.features[u],m,v,l),h.features.splice(u,1,m,v),h))}a()}}function f(g,m,v,h){m.properties.length_meters=sn(m,{units:"kilometers"})*1e3,v.properties.length_meters=sn(v,{units:"kilometers"})*1e3,m.properties.waypoints=[],v.properties.waypoints=[];let b=p(g,h),y=!0,M=0;for(let T of g.properties.waypoints){let P=p(g,yt([T.lon,T.lat]));if(y)if(P<b)m.properties.waypoints.push(T);else{let A=T.snapped&&g.properties.waypoints[M-1].snapped;m.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:A}),y=!1,v.properties.waypoints.push({lon:h.geometry.coordinates[0],lat:h.geometry.coordinates[1],snapped:A}),v.properties.waypoints.push(T)}else v.properties.waypoints.push(T);M++}}function p(g,m){let v=g.geometry.coordinates[0],h=Ru(v,m,g);return sn(h,{units:"kilometers"})*1e3}function _(g){o==Ut&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=xe();l&&g.features.push(l),i.getSource(Un).setData(g)}},[o,_,s,no,a,l,i]}class Nu extends W{constructor(e){super(),V(this,e,xu,Pu,Y,{mode:0,changeMode:2,start:3,stop:4})}get start(){return no}get stop(){return this.$$.ctx[4]}}const Bu="/atip/state-changing-bugs-142/assets/edit_attributes-29b396e1.svg",Du="/atip/state-changing-bugs-142/assets/edit_geometry-02dad294.svg",ju="/atip/state-changing-bugs-142/assets/point-276f4055.svg",Uu="/atip/state-changing-bugs-142/assets/polygon_snapped-18efbbea.svg",qu="/atip/state-changing-bugs-142/assets/polygon_freehand-cf965967.svg",Gu="/atip/state-changing-bugs-142/assets/route-d3c0ebad.svg",Hu="/atip/state-changing-bugs-142/assets/split_route-9e0ea2da.svg";function _i(r){let e,t,n={mode:r[3],pointTool:r[11],polygonTool:r[12],routeTool:r[2]};return e=new pu({props:n}),r[15](e),{c(){N(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){O(e.$$.fragment,i),t=!1},d(i){r[15](null),D(e,i)}}}function gi(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"point",label:"New point",icon:ju,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function bi(r){let e,t,n={mode:r[3],changeMode:r[13],routeTool:r[2]};return e=new Lu({props:n}),r[18](e),{c(){N(e.$$.fragment)},m(i,o){B(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){O(e.$$.fragment,i),t=!1},d(i){r[18](null),D(e,i)}}}function vi(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"route",label:"New route",icon:Gu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function yi(r){let e,t;return e=new nt({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:Hu,changeMode:r[13]}}),{c(){N(e.$$.fragment)},m(n,i){B(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){O(e.$$.fragment,n),t=!1},d(n){D(e,n)}}}function zu(r){let e,t,n,i,o,s,a,l,u,c,d,f,p,_,g,m,v,h,b,y,M,T,P,A,x,R,j,Z,I,H,ae,Me;n=new nt({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:Bu,changeMode:r[13]}});let Pe={mode:r[3],changeMode:r[13]};o=new Ga({props:Pe}),r[14](o),l=new nt({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:Du,changeMode:r[13]}});let oe=r[2]&&_i(r),ie=r[1]!="planning"&&gi(r),Ne={mode:r[3],changeMode:r[13],pointTool:r[11]};p=new wu({props:Ne}),r[16](p),m=new nt({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:qu,changeMode:r[13]}});let Oe={mode:r[3],changeMode:r[13],polygonTool:r[12]};h=new Eu({props:Oe}),r[17](h),M=new nt({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:Uu,changeMode:r[13]}});let Q=r[2]&&bi(r),he=r[1]!="planning"&&vi(r);function Vt(q){r[20](q)}let _e={mode:r[3],changeMode:r[13],url:r[0]};r[2]!==void 0&&(_e.routeTool=r[2]),R=new bu({props:_e}),r[19](R),le.push(()=>we(R,"routeTool",Vt,r[2]));let F=r[1]!="planning"&&yi(r),te={mode:r[3],changeMode:r[13]};return ae=new Nu({props:te}),r[21](ae),{c(){e=E("div"),t=E("div"),N(n.$$.fragment),i=C(),N(o.$$.fragment),s=C(),a=E("div"),N(l.$$.fragment),u=C(),oe&&oe.c(),c=C(),d=E("div"),ie&&ie.c(),f=C(),N(p.$$.fragment),_=C(),g=E("div"),N(m.$$.fragment),v=C(),N(h.$$.fragment),b=C(),y=E("div"),N(M.$$.fragment),T=C(),Q&&Q.c(),P=C(),A=E("div"),he&&he.c(),x=C(),N(R.$$.fragment),Z=C(),I=E("div"),F&&F.c(),H=C(),N(ae.$$.fragment),L(e,"class","toolbox svelte-4s4d3o")},m(q,pe){w(q,e,pe),S(e,t),B(n,t,null),S(t,i),B(o,t,null),S(e,s),S(e,a),B(l,a,null),S(a,u),oe&&oe.m(a,null),S(e,c),S(e,d),ie&&ie.m(d,null),S(d,f),B(p,d,null),S(e,_),S(e,g),B(m,g,null),S(g,v),B(h,g,null),S(e,b),S(e,y),B(M,y,null),S(y,T),Q&&Q.m(y,null),S(e,P),S(e,A),he&&he.m(A,null),S(A,x),B(R,A,null),S(e,Z),S(e,I),F&&F.m(I,null),S(I,H),B(ae,I,null),Me=!0},p(q,[pe]){const cr={};pe&8&&(cr.mode=q[3]),n.$set(cr);const pr={};pe&8&&(pr.mode=q[3]),o.$set(pr);const dr={};pe&8&&(dr.mode=q[3]),l.$set(dr),q[2]?oe?(oe.p(q,pe),pe&4&&$(oe,1)):(oe=_i(q),oe.c(),$(oe,1),oe.m(a,null)):oe&&(fe(),O(oe,1,1,()=>{oe=null}),ce()),q[1]!="planning"?ie?(ie.p(q,pe),pe&2&&$(ie,1)):(ie=gi(q),ie.c(),$(ie,1),ie.m(d,f)):ie&&(fe(),O(ie,1,1,()=>{ie=null}),ce());const hr={};pe&8&&(hr.mode=q[3]),p.$set(hr);const mr={};pe&8&&(mr.mode=q[3]),m.$set(mr);const _r={};pe&8&&(_r.mode=q[3]),h.$set(_r);const gr={};pe&8&&(gr.mode=q[3]),M.$set(gr),q[2]?Q?(Q.p(q,pe),pe&4&&$(Q,1)):(Q=bi(q),Q.c(),$(Q,1),Q.m(y,null)):Q&&(fe(),O(Q,1,1,()=>{Q=null}),ce()),q[1]!="planning"?he?(he.p(q,pe),pe&2&&$(he,1)):(he=vi(q),he.c(),$(he,1),he.m(A,x)):he&&(fe(),O(he,1,1,()=>{he=null}),ce());const Kt={};pe&8&&(Kt.mode=q[3]),pe&1&&(Kt.url=q[0]),!j&&pe&4&&(j=!0,Kt.routeTool=q[2],ke(()=>j=!1)),R.$set(Kt),q[1]!="planning"?F?(F.p(q,pe),pe&2&&$(F,1)):(F=yi(q),F.c(),$(F,1),F.m(I,H)):F&&(fe(),O(F,1,1,()=>{F=null}),ce());const br={};pe&8&&(br.mode=q[3]),ae.$set(br)},i(q){Me||($(n.$$.fragment,q),$(o.$$.fragment,q),$(l.$$.fragment,q),$(oe),$(ie),$(p.$$.fragment,q),$(m.$$.fragment,q),$(h.$$.fragment,q),$(M.$$.fragment,q),$(Q),$(he),$(R.$$.fragment,q),$(F),$(ae.$$.fragment,q),Me=!0)},o(q){O(n.$$.fragment,q),O(o.$$.fragment,q),O(l.$$.fragment,q),O(oe),O(ie),O(p.$$.fragment,q),O(m.$$.fragment,q),O(h.$$.fragment,q),O(M.$$.fragment,q),O(Q),O(he),O(R.$$.fragment,q),O(F),O(ae.$$.fragment,q),Me=!1},d(q){q&&k(e),D(n),r[14](null),D(o),D(l),oe&&oe.d(),ie&&ie.d(),r[16](null),D(p),D(m),r[17](null),D(h),D(M),Q&&Q.d(),he&&he.d(),r[19](null),D(R),F&&F.d(),r[21](null),D(ae)}}}function Ju(r,e,t){let n;re(r,Te,R=>t(22,n=R));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new ma(n),l=new La(n),u="edit-attribute",c,d,f,p,_,g,m;function v(R){let j={"edit-attribute":c,"edit-geometry":d,route:f,point:p,"free-polygon":_,"snap-polygon":g,"split-route":m};if(u==R){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),j[u].stop(),t(3,u=R),console.log(`Starting new mode ${u}`),j[u].start()}it(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function h(R){le[R?"unshift":"push"](()=>{c=R,t(4,c)})}function b(R){le[R?"unshift":"push"](()=>{d=R,t(5,d)})}function y(R){le[R?"unshift":"push"](()=>{p=R,t(7,p)})}function M(R){le[R?"unshift":"push"](()=>{_=R,t(8,_)})}function T(R){le[R?"unshift":"push"](()=>{g=R,t(9,g)})}function P(R){le[R?"unshift":"push"](()=>{f=R,t(6,f)})}function A(R){s=R,t(2,s)}function x(R){le[R?"unshift":"push"](()=>{m=R,t(10,m)})}return r.$$set=R=>{"routeSnapperUrl"in R&&t(0,i=R.routeSnapperUrl),"schema"in R&&t(1,o=R.schema)},[i,o,s,u,c,d,f,p,_,g,m,a,l,v,h,b,y,M,T,P,A,x]}class Yu extends W{constructor(e){super(),V(this,e,Ju,zu,Y,{routeSnapperUrl:0,schema:1})}}function Xu(r){let e,t,n,i,o,s,a,l,u,c;return{c(){e=E("p"),t=J(r[2]),n=C(),i=E("button"),o=J(r[3]),s=C(),a=E("button"),l=J(r[4]),L(i,"type","button"),L(a,"type","button")},m(d,f){w(d,e,f),S(e,t),w(d,n,f),w(d,i,f),S(i,o),w(d,s,f),w(d,a,f),S(a,l),u||(c=[U(i,"click",r[5]("confirmAction")),U(a,"click",r[6])],u=!0)},p(d,f){f&4&&$e(t,d[2]),f&8&&$e(o,d[3]),f&16&&$e(l,d[4])},d(d){d&&k(e),d&&k(n),d&&k(i),d&&k(s),d&&k(a),u=!1,Ce(c)}}}function Wu(r){let e,t,n,i;function o(l){r[7](l)}function s(l){r[8](l)}let a={$$slots:{default:[Xu]},$$scope:{ctx:r}};return r[1]!==void 0&&(a.title=r[1]),r[0]!==void 0&&(a.open=r[0]),e=new wi({props:a}),le.push(()=>we(e,"title",o,r[1])),le.push(()=>we(e,"open",s,r[0])),{c(){N(e.$$.fragment)},m(l,u){B(e,l,u),i=!0},p(l,[u]){const c={};u&540&&(c.$$scope={dirty:u,ctx:l}),!t&&u&2&&(t=!0,c.title=l[1],ke(()=>t=!1)),!n&&u&1&&(n=!0,c.open=l[0],ke(()=>n=!1)),e.$set(c)},i(l){i||($(e.$$.fragment,l),i=!0)},o(l){O(e.$$.fragment,l),i=!1},d(l){D(e,l)}}}function Vu(r,e,t){const n=ko();let{open:i=!1}=e,{title:o=""}=e,{confirmationMessage:s=""}=e,{confirmButtonText:a=""}=e,{cancelButtonText:l=""}=e;function u(){t(0,i=!1),console.log("testing"),n("cancelAction")}function c(f){o=f,t(1,o)}function d(f){i=f,t(0,i)}return r.$$set=f=>{"open"in f&&t(0,i=f.open),"title"in f&&t(1,o=f.title),"confirmationMessage"in f&&t(2,s=f.confirmationMessage),"confirmButtonText"in f&&t(3,a=f.confirmButtonText),"cancelButtonText"in f&&t(4,l=f.cancelButtonText)},[i,o,s,a,l,n,u,c,d]}class Ku extends W{constructor(e){super(),V(this,e,Vu,Wu,Y,{open:0,title:1,confirmationMessage:2,confirmButtonText:3,cancelButtonText:4})}}function Zu(r){let e,t,n,i,o,s,a,l,u,c,d,f,p,_,g,m,v,h,b,y,M;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",i=C(),o=E("button"),o.textContent="About",s=C(),a=E("button"),a.textContent="Instructions",l=C(),u=E("button"),u.textContent="Instructions",c=C(),d=E("br"),f=C(),p=E("label"),_=J(`ATIP schema:
      `),g=E("select"),m=E("option"),m.textContent="v1",v=E("option"),v.textContent="v2",h=E("option"),h.textContent="Housing developments",b=E("option"),b.textContent="Critical issues",L(n,"type","button"),L(o,"type","button"),L(a,"type","button"),L(u,"type","button"),m.__value="v1",m.value=m.__value,v.__value="v2",v.value=v.__value,h.__value="planning",h.value=h.__value,b.__value="criticals",b.value=b.__value,r[3]===void 0&&ot(()=>r[12].call(g)),L(e,"slot","nav")},m(T,P){w(T,e,P),S(e,t),S(t,n),S(t,i),S(t,o),S(t,s),S(t,a),S(t,l),S(t,u),S(e,c),S(e,d),S(e,f),S(e,p),S(p,_),S(p,g),S(g,m),S(g,v),S(g,h),S(g,b),Ke(g,r[3]),y||(M=[U(n,"click",r[11]),U(o,"click",r[8]),U(a,"click",r[9]),U(u,"click",r[9]),U(g,"change",r[12]),U(g,"change",r[10])],y=!0)},p(T,P){P&8&&Ke(g,T[3])},d(T){T&&k(e),y=!1,Ce(M)}}}function Qu(r){let e,t,n,i,o,s,a,l,u,c,d,f,p,_,g,m;return o=new Ql({props:{boundaryGeojson:r[5]}}),a=new Wl({props:{authorityName:r[6],schema:r[3]}}),d=new Ul({props:{schema:r[3]}}),g=new Hl({}),{c(){e=E("div"),t=E("h1"),n=J(r[6]),i=C(),N(o.$$.fragment),s=C(),N(a.$$.fragment),l=C(),u=E("br"),c=C(),N(d.$$.fragment),f=C(),p=E("hr"),_=C(),N(g.$$.fragment),L(e,"slot","sidebar")},m(v,h){w(v,e,h),S(e,t),S(t,n),S(t,i),B(o,t,null),S(e,s),B(a,e,null),S(e,l),S(e,u),S(e,c),B(d,e,null),S(e,f),S(e,p),S(e,_),B(g,e,null),m=!0},p(v,h){const b={};h&32&&(b.boundaryGeojson=v[5]),o.$set(b);const y={};h&8&&(y.schema=v[3]),a.$set(y);const M={};h&8&&(M.schema=v[3]),d.$set(M)},i(v){m||($(o.$$.fragment,v),$(a.$$.fragment,v),$(d.$$.fragment,v),$(g.$$.fragment,v),m=!0)},o(v){O(o.$$.fragment,v),O(a.$$.fragment,v),O(d.$$.fragment,v),O(g.$$.fragment,v),m=!1},d(v){v&&k(e),D(o),D(a),D(d),D(g)}}}function ef(r){let e,t,n,i,o,s,a,l,u,c,d,f;return e=new Rs({props:{boundaryGeojson:r[5]}}),n=new pa({props:{schema:r[3]}}),o=new ha({}),a=new Yu({props:{routeSnapperUrl:r[4],schema:r[3]}}),u=new na({props:{style:r[7]}}),d=new fa({props:{schema:r[3]}}),{c(){N(e.$$.fragment),t=C(),N(n.$$.fragment),i=C(),N(o.$$.fragment),s=C(),N(a.$$.fragment),l=C(),N(u.$$.fragment),c=C(),N(d.$$.fragment)},m(p,_){B(e,p,_),w(p,t,_),B(n,p,_),w(p,i,_),B(o,p,_),w(p,s,_),B(a,p,_),w(p,l,_),B(u,p,_),w(p,c,_),B(d,p,_),f=!0},p(p,_){const g={};_&32&&(g.boundaryGeojson=p[5]),e.$set(g);const m={};_&8&&(m.schema=p[3]),n.$set(m);const v={};_&16&&(v.routeSnapperUrl=p[4]),_&8&&(v.schema=p[3]),a.$set(v);const h={};_&8&&(h.schema=p[3]),d.$set(h)},i(p){f||($(e.$$.fragment,p),$(n.$$.fragment,p),$(o.$$.fragment,p),$(a.$$.fragment,p),$(u.$$.fragment,p),$(d.$$.fragment,p),f=!0)},o(p){O(e.$$.fragment,p),O(n.$$.fragment,p),O(o.$$.fragment,p),O(a.$$.fragment,p),O(u.$$.fragment,p),O(d.$$.fragment,p),f=!1},d(p){D(e,p),p&&k(t),D(n,p),p&&k(i),D(o,p),p&&k(s),D(a,p),p&&k(l),D(u,p),p&&k(c),D(d,p)}}}function tf(r){let e,t,n;return t=new Qo({props:{style:r[7],$$slots:{default:[ef]},$$scope:{ctx:r}}}),{c(){e=E("div"),N(t.$$.fragment),L(e,"slot","main")},m(i,o){w(i,e,o),B(t,e,null),n=!0},p(i,o){const s={};o&4194360&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){O(t.$$.fragment,i),n=!1},d(i){i&&k(e),D(t)}}}function nf(r){let e,t,n,i,o,s,a,l,u,c,d;e=new os({props:{$$slots:{main:[tf],sidebar:[Qu],nav:[Zu]},$$scope:{ctx:r}}});function f(h){r[13](h)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new So({props:p}),le.push(()=>we(n,"open",f,r[0]));function _(h){r[14](h)}let g={};r[1]!==void 0&&(g.open=r[1]),s=new Vo({props:g}),le.push(()=>we(s,"open",_,r[1]));function m(h){r[15](h)}let v={};return r[2]!==void 0&&(v.open=r[2]),u=new Ku({props:v}),le.push(()=>we(u,"open",m,r[2])),u.$on("confirmAction",rf),u.$on("cancelAction",of),{c(){N(e.$$.fragment),t=C(),N(n.$$.fragment),o=C(),N(s.$$.fragment),l=C(),N(u.$$.fragment)},m(h,b){B(e,h,b),w(h,t,b),B(n,h,b),w(h,o,b),B(s,h,b),w(h,l,b),B(u,h,b),d=!0},p(h,[b]){const y={};b&4194360&&(y.$$scope={dirty:b,ctx:h}),e.$set(y);const M={};!i&&b&1&&(i=!0,M.open=h[0],ke(()=>i=!1)),n.$set(M);const T={};!a&&b&2&&(a=!0,T.open=h[1],ke(()=>a=!1)),s.$set(T);const P={};!c&&b&4&&(c=!0,P.open=h[2],ke(()=>c=!1)),u.$set(P)},i(h){d||($(e.$$.fragment,h),$(n.$$.fragment,h),$(s.$$.fragment,h),$(u.$$.fragment,h),d=!0)},o(h){O(e.$$.fragment,h),O(n.$$.fragment,h),O(s.$$.fragment,h),O(u.$$.fragment,h),d=!1},d(h){D(e,h),h&&k(t),D(n,h),h&&k(o),D(s,h),h&&k(l),D(u,h)}}}function rf(){console.log("hello confirm")}function of(){console.log("hello cancel")}function sf(r,e,t){let n;re(r,mn,A=>t(17,n=A));let i=!1,o=!1,s=!1,a=window.location.hostname.includes("atip.uk");const l=new URLSearchParams(window.location.search);let u=l.get("authority"),c=l.get("style")||"streets",d=l.get("schema")||"v1";var f=`https://atip.uk/route-snappers/${u}.bin`,p=`https://atip.uk/route-info/${u}.bin`;a||(f=`https://atip.uk/route-snappers-dev/${u}.bin`,p=`https://atip.uk/route-info-dev/${u}.bin`);function _(){t(0,i=!i),t(1,o=!1)}function g(){t(1,o=!o),t(0,i=!1)}let m;Yt(async()=>{t(5,m=await v());const A=Li(new No);mn.set(await new A),await n.loadFile(p)});async function v(){const x=await(await fetch(Eo)).text(),R=JSON.parse(x);return R.features=R.features.filter(j=>{var Z;return((Z=j.properties)==null?void 0:Z.name)==u}),R}function h(){let A=new URLSearchParams(window.location.search);A.set("schema",d);let x=`${window.location.pathname}?${A.toString()}${window.location.hash}`;window.location.href=x}const b=()=>window.open("index.html");function y(){d=$n(this),t(3,d)}function M(A){i=A,t(0,i)}function T(A){o=A,t(1,o)}function P(A){s=A,t(2,s)}return[i,o,s,d,f,m,u,c,_,g,h,b,y,M,T,P]}class lf extends W{constructor(e){super(),V(this,e,sf,nf,Y,{})}}new lf({target:document.getElementById("app")});
