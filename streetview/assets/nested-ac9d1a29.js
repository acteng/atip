var mo=Object.defineProperty;var _o=(r,e,t)=>e in r?mo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var re=(r,e,t)=>(_o(r,typeof e!="symbol"?e+"":e,t),t);import{x as H,s as W,y as Pe,S as K,i as Z,M as go,b as oe,a as Oe,d as I,m as N,k as Ce,n as $,o as L,q as x,e as E,c as C,g as w,p as k,f as O,z as ae,B as ue,C as bo,D as Kt,E as on,F as it,G as yt,H as wt,I as kt,J as St,K as $r,h as S,l as U,L as vo,N as yo,O as te,P as wo,w as ur,Q as Xe,R as ke,T as On,U as hn,V as le,t as X,W as xe,X as mn,Y as Mt,Z as de,_ as at,$ as nt,a0 as Cn,j as Ne,r as Fe,a1 as Ci,a2 as $t,a3 as _n,a4 as Lr,a5 as ko,a6 as So,a7 as De,a8 as Eo,a9 as Mo,aa as Rn,ab as ut,ac as An,ad as Tn,ae as Jn,af as $o,ag as Et,ah as fr,ai as et,aj as Lt,ak as Lo,al as cr,am as Oo,an as Co,ao as Ro,ap as Or,aq as gn,ar as Ao,as as To,at as Po,au as Fo,A as Io,u as No}from"./authorities-81277cbe.js";const ct=[];function ft(r,e=H){let t;const n=new Set;function i(a){if(W(r,a)&&(r=a,t)){const l=!ct.length;for(const u of n)u[1](),ct.push(u,r);if(l){for(let u=0;u<ct.length;u+=2)ct[u][0](ct[u+1]);ct.length=0}}}function o(a){i(a(r))}function s(a,l=H){const u=[a,l];return n.add(u),n.size===1&&(t=e(i)||H),a(r),()=>{n.delete(u),n.size===0&&(t(),t=null)}}return{set:i,update:o,subscribe:s}}const Ie=ft(null),bn=ft(null),ne=ft(Pe()),$e=ft(null),Ge=ft(null),Jt=ft(null),Yt=ft(null);function Zt(r){let e=new Set;for(let n of r.features)e.add(n.id);let t=e.size+1;for(;e.has(t);)t++;return t}function Cr(r){console.log(`Deleting intervention ${r}`),ne.update(e=>(e.features=e.features.filter(t=>t.id!=r),e)),$e.set(null),Ge.set(null),Jt.set(null),Yt.set(null)}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ri=Symbol("Comlink.proxy"),xo=Symbol("Comlink.endpoint"),Bo=Symbol("Comlink.releaseProxy"),Nn=Symbol("Comlink.finalizer"),sn=Symbol("Comlink.thrown"),Ai=r=>typeof r=="object"&&r!==null||typeof r=="function",Do={canHandle:r=>Ai(r)&&r[Ri],serialize(r){const{port1:e,port2:t}=new MessageChannel;return pr(r,e),[t,[t]]},deserialize(r){return r.start(),Fi(r)}},jo={canHandle:r=>Ai(r)&&sn in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},Ti=new Map([["proxy",Do],["throw",jo]]);function qo(r,e){for(const t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function pr(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!qo(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(ot);let u;try{const p=a.slice(0,-1).reduce((c,f)=>c[f],r),d=a.reduce((c,f)=>c[f],r);switch(s){case"GET":u=d;break;case"SET":p[a.slice(-1)[0]]=ot(i.data.value),u=!0;break;case"APPLY":u=d.apply(p,l);break;case"CONSTRUCT":{const c=new d(...l);u=Yo(c)}break;case"ENDPOINT":{const{port1:c,port2:f}=new MessageChannel;pr(r,f),u=Jo(c,[c])}break;case"RELEASE":u=void 0;break;default:return}}catch(p){u={value:p,[sn]:0}}Promise.resolve(u).catch(p=>({value:p,[sn]:0})).then(p=>{const[d,c]=wn(p);e.postMessage(Object.assign(Object.assign({},d),{id:o}),c),s==="RELEASE"&&(e.removeEventListener("message",n),Pi(e),Nn in r&&typeof r[Nn]=="function"&&r[Nn]())}).catch(p=>{const[d,c]=wn({value:new TypeError("Unserializable return value"),[sn]:0});e.postMessage(Object.assign(Object.assign({},d),{id:o}),c)})}),e.start&&e.start()}function Uo(r){return r.constructor.name==="MessagePort"}function Pi(r){Uo(r)&&r.close()}function Fi(r,e){return Yn(r,[],e)}function tn(r){if(r)throw new Error("Proxy has been released and is not useable")}function Ii(r){return gt(r,{type:"RELEASE"}).then(()=>{Pi(r)})}const vn=new WeakMap,yn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(vn.get(r)||0)-1;vn.set(r,e),e===0&&Ii(r)});function Go(r,e){const t=(vn.get(e)||0)+1;vn.set(e,t),yn&&yn.register(r,e,r)}function Ho(r){yn&&yn.unregister(r)}function Yn(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,s){if(tn(n),s===Bo)return()=>{Ho(i),Ii(r),n=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=gt(r,{type:"GET",path:e.map(l=>l.toString())}).then(ot);return a.then.bind(a)}return Yn(r,[...e,s])},set(o,s,a){tn(n);const[l,u]=wn(a);return gt(r,{type:"SET",path:[...e,s].map(p=>p.toString()),value:l},u).then(ot)},apply(o,s,a){tn(n);const l=e[e.length-1];if(l===xo)return gt(r,{type:"ENDPOINT"}).then(ot);if(l==="bind")return Yn(r,e.slice(0,-1));const[u,p]=Rr(a);return gt(r,{type:"APPLY",path:e.map(d=>d.toString()),argumentList:u},p).then(ot)},construct(o,s){tn(n);const[a,l]=Rr(s);return gt(r,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},l).then(ot)}});return Go(i,r),i}function zo(r){return Array.prototype.concat.apply([],r)}function Rr(r){const e=r.map(wn);return[e.map(t=>t[0]),zo(e.map(t=>t[1]))]}const Ni=new WeakMap;function Jo(r,e){return Ni.set(r,e),r}function Yo(r){return Object.assign(r,{[Ri]:!0})}function wn(r){for(const[e,t]of Ti)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},Ni.get(r)||[]]}function ot(r){switch(r.type){case"HANDLER":return Ti.get(r.name).deserialize(r.value);case"RAW":return r.value}}function gt(r,e,t){return new Promise(n=>{const i=Xo();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function Xo(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Wo(){return new Worker("/atip/streetview/assets/worker-734fd9dc.js")}let ee;const xi=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&xi.decode();let Ft=null;function Dt(){return(Ft===null||Ft.byteLength===0)&&(Ft=new Uint8Array(ee.memory.buffer)),Ft}function st(r,e){return r=r>>>0,xi.decode(Dt().subarray(r,r+e))}const Je=new Array(128).fill(void 0);Je.push(void 0,null,!0,!1);let jt=Je.length;function me(r){jt===Je.length&&Je.push(Je.length+1);const e=jt;return jt=Je[e],Je[e]=r,e}function Y(r){return Je[r]}let lt=0;const ln=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Vo=typeof ln.encodeInto=="function"?function(r,e){return ln.encodeInto(r,e)}:function(r,e){const t=ln.encode(r);return e.set(t),{read:r.length,written:t.length}};function xn(r,e,t){if(t===void 0){const a=ln.encode(r),l=e(a.length)>>>0;return Dt().subarray(l,l+a.length).set(a),lt=a.length,l}let n=r.length,i=e(n)>>>0;const o=Dt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3)>>>0;const a=Dt().subarray(i+s,i+n),l=Vo(r,a);s+=l.written}return lt=s,i}function Rt(r){return r==null}let It=null;function fe(){return(It===null||It.byteLength===0)&&(It=new Int32Array(ee.memory.buffer)),It}function Ko(r){r<132||(Je[r]=jt,jt=r)}function Nt(r){const e=Y(r);return Ko(r),e}let xt=null;function Zo(){return(xt===null||xt.byteLength===0)&&(xt=new Float64Array(ee.memory.buffer)),xt}let Bt=null;function Qo(){return(Bt===null||Bt.byteLength===0)&&(Bt=new BigInt64Array(ee.memory.buffer)),Bt}function Xn(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Xn(r[0]));for(let s=1;s<i;s++)o+=", "+Xn(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function es(r,e){const t=e(r.length*1)>>>0;return Dt().set(r,t/1),lt=r.length,t}function Bn(r,e){try{return r.apply(this,e)}catch(t){ee.__wbindgen_exn_store(me(t))}}let Wn=class{static __wrap(e){e=e>>>0;const t=Object.create(Wn.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();ee.__wbg_routeinfo_free(e)}constructor(e){try{const o=ee.__wbindgen_add_to_stack_pointer(-16),s=es(e,ee.__wbindgen_malloc),a=lt;ee.routeinfo_new(o,s,a);var t=fe()[o/4+0],n=fe()[o/4+1],i=fe()[o/4+2];if(i)throw Nt(n);return Wn.__wrap(t)}finally{ee.__wbindgen_add_to_stack_pointer(16)}}nameForRoute(e){let t,n;try{const p=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_nameForRoute(p,this.__wbg_ptr,me(e));var i=fe()[p/4+0],o=fe()[p/4+1],s=fe()[p/4+2],a=fe()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,Nt(s);return t=l,n=u,st(l,u)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(t,n)}}speedLimitForRoute(e){let t,n;try{const p=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_speedLimitForRoute(p,this.__wbg_ptr,me(e));var i=fe()[p/4+0],o=fe()[p/4+1],s=fe()[p/4+2],a=fe()[p/4+3],l=i,u=o;if(a)throw l=0,u=0,Nt(s);return t=l,n=u,st(l,u)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(t,n)}}allSpeedLimits(){let e,t;try{const u=ee.__wbindgen_add_to_stack_pointer(-16);ee.routeinfo_allSpeedLimits(u,this.__wbg_ptr);var n=fe()[u/4+0],i=fe()[u/4+1],o=fe()[u/4+2],s=fe()[u/4+3],a=n,l=i;if(s)throw a=0,l=0,Nt(o);return e=a,t=l,st(a,l)}finally{ee.__wbindgen_add_to_stack_pointer(16),ee.__wbindgen_free(e,t)}}};async function ts(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function ns(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=st(e,t);return me(n)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(st(e,t));return me(n)},r.wbg.__wbindgen_string_get=function(e,t){const n=Y(t),i=typeof n=="string"?n:void 0;var o=Rt(i)?0:xn(i,ee.__wbindgen_malloc,ee.__wbindgen_realloc),s=lt;fe()[e/4+1]=s,fe()[e/4+0]=o},r.wbg.__wbindgen_object_drop_ref=function(e){Nt(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=Y(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof Y(e)=="bigint"},r.wbg.__wbindgen_bigint_from_i64=function(e){return me(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return Y(e)===Y(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=Y(t),i=typeof n=="number"?n:void 0;Zo()[e/8+1]=Rt(i)?0:i,fe()[e/4+0]=!Rt(i)},r.wbg.__wbindgen_is_object=function(e){const t=Y(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return Y(e)in Y(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return me(t)},r.wbg.__wbindgen_is_undefined=function(e){return Y(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Y(e)==Y(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Y(e);return me(t)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,t){const n=Y(e)[Y(t)];return me(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return me(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Y(t).stack,i=xn(n,ee.__wbindgen_malloc,ee.__wbindgen_realloc),o=lt;fe()[e/4+1]=o,fe()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(st(e,t))}finally{ee.__wbindgen_free(n,i)}},r.wbg.__wbg_debug_917e579618ee56f5=function(e){console.debug(Y(e))},r.wbg.__wbg_error_ea7597dedb63d9a4=function(e){console.error(Y(e))},r.wbg.__wbg_info_fc2a17f38101c41c=function(e){console.info(Y(e))},r.wbg.__wbg_log_003c998d6df63565=function(e){console.log(Y(e))},r.wbg.__wbg_warn_ebfcadd0780df93a=function(e){console.warn(Y(e))},r.wbg.__wbg_get_e52aaca45f37b337=function(e,t){const n=Y(e)[t>>>0];return me(n)},r.wbg.__wbg_length_070e3265c186df02=function(e){return Y(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Y(e)=="function"},r.wbg.__wbg_next_3975dcca26737a22=function(e){const t=Y(e).next;return me(t)},r.wbg.__wbg_next_5a9700550e162aa3=function(){return Bn(function(e){const t=Y(e).next();return me(t)},arguments)},r.wbg.__wbg_done_a184612220756243=function(e){return Y(e).done},r.wbg.__wbg_value_6cc144c1d9645dd5=function(e){const t=Y(e).value;return me(t)},r.wbg.__wbg_iterator_c1677479667ea090=function(){return me(Symbol.iterator)},r.wbg.__wbg_get_363c3b466fe4896b=function(){return Bn(function(e,t){const n=Reflect.get(Y(e),Y(t));return me(n)},arguments)},r.wbg.__wbg_call_f96b398515635514=function(){return Bn(function(e,t){const n=Y(e).call(Y(t));return me(n)},arguments)},r.wbg.__wbg_isArray_07d89ced8fb14171=function(e){return Array.isArray(Y(e))},r.wbg.__wbg_instanceof_ArrayBuffer_de688b806c28ff28=function(e){let t;try{t=Y(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_fcdf4c4f25c86778=function(e){return Number.isSafeInteger(Y(e))},r.wbg.__wbg_entries_c3e06bf0354f5d20=function(e){const t=Object.entries(Y(e));return me(t)},r.wbg.__wbg_buffer_fcbfb6d88b2732e9=function(e){const t=Y(e).buffer;return me(t)},r.wbg.__wbg_new_bc5d9aad3f9ac80e=function(e){const t=new Uint8Array(Y(e));return me(t)},r.wbg.__wbg_set_4b3aa8445ac1e91c=function(e,t,n){Y(e).set(Y(t),n>>>0)},r.wbg.__wbg_length_d9c4ded7e708c6a1=function(e){return Y(e).length},r.wbg.__wbg_instanceof_Uint8Array_4733577ba827276b=function(e){let t;try{t=Y(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=Y(t),i=typeof n=="bigint"?n:void 0;Qo()[e/8+1]=Rt(i)?BigInt(0):i,fe()[e/4+0]=!Rt(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Xn(Y(t)),i=xn(n,ee.__wbindgen_malloc,ee.__wbindgen_realloc),o=lt;fe()[e/4+1]=o,fe()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(st(e,t))},r.wbg.__wbindgen_memory=function(){const e=ee.memory;return me(e)},r}function rs(r,e){return ee=r.exports,Bi.__wbindgen_wasm_module=e,Bt=null,xt=null,It=null,Ft=null,ee}async function Bi(r){if(ee!==void 0)return ee;typeof r>"u"&&(r="/atip/streetview/assets/route_info_bg.wasm");const e=ns();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await ts(await r,e);return rs(t,n)}class is{constructor(){re(this,"inner");this.inner=null}async loadFile(e){await Bi(),console.log(`Grabbing A/B Street map model data from ${e}`);let n=await(await fetch(e)).arrayBuffer();this.inner=new Wn(new Uint8Array(n)),console.log("RouteInfo is ready!")}nameForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.nameForRoute(e)}speedLimitForRoute(e){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.speedLimitForRoute(e)}allSpeedLimits(){if(!this.inner)throw new Error("Still loading route info, please retry after a few seconds");return this.inner.allSpeedLimits()}}pr(is);function os(r){let e,t,n,i,o,s,a,l,u,p,d,c,f;return{c(){e=E("p"),e.textContent="For each intervention:",t=C(),n=E("ol"),n.innerHTML=`<li>Click one of the draw icons to the top right of the map (the icons allow
      you to draw points, lines, polygons or routes)</li> 
    <li>Draw the intervention on the map, clicking the original point or &#39;Finish
      snapping&#39; for the Polygon and Route tools respectively</li> 
    <li>Fill in the details that appear (Intervention type, name, description)</li> 
    <li>Click the &quot;Save&quot; button or &quot;Delete&quot; button to save or remove the
      intervention</li>`,i=C(),o=E("p"),o.textContent=`Repeat the steps above for each substantial infrastructure intervention in
    the scheme.`,s=C(),a=E("p"),a.textContent=`To make further edits to attribute data, or to delete an intervention, click
    on its name in the left hand panel or its geometry in the map.`,l=C(),u=E("p"),u.textContent=`Click the "Export to GeoJSON" button to download the dataset representing
    the scheme, which can be made up of one or more intervention, as a GeoJSON
    file. After saving the file, you can delete the interventions, change the
    scheme name, and start a new set of interventions representing a new scheme.`,p=C(),d=E("p"),d.textContent=`To load a GeoJSON file that you have already saved from the tool, click the
    "Load from GeoJSON" button and select the file.`,c=C(),f=E("p"),f.innerHTML=`Note: the <strong>Route tool</strong> works by calculating routes between
    start and end points using the existing transport network according to
    OpenStreetMap. Use it by clicking on the location where you would like the
    route to start and then clicking on the location where you would like the
    route to end on the map. The route will be calculated and drawn on the map.
    After you click &quot;Finish snapping&quot; you can edit the route by dragging
    individual points. This can be useful for representing links that are not
    part of the existing transport network, such as a new bridge or path.
    However,
    <strong>you cannot add or remove points</strong> with the Route tool. If the
    planned route intervention you would like to sketch as part of a scheme contains
    one or more new links (for example containing new bridges or paths between cul-de-sacs),
    you may want to use the Line tool instead.`},m(h,g){w(h,e,g),w(h,t,g),w(h,n,g),w(h,i,g),w(h,o,g),w(h,s,g),w(h,a,g),w(h,l,g),w(h,u,g),w(h,p,g),w(h,d,g),w(h,c,g),w(h,f,g)},p:H,d(h){h&&k(e),h&&k(t),h&&k(n),h&&k(i),h&&k(o),h&&k(s),h&&k(a),h&&k(l),h&&k(u),h&&k(p),h&&k(d),h&&k(c),h&&k(f)}}}function ss(r){let e,t,n;function i(s){r[1](s)}let o={title:"Instructions",$$slots:{default:[os]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.open=r[0]),e=new go({props:o}),oe.push(()=>Oe(e,"open",i,r[0])),{c(){I(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,[a]){const l={};a&4&&(l.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,l.open=s[0],Ce(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){x(e,s)}}}function ls(r,e,t){let{open:n}=e;function i(o){n=o,t(0,n)}return r.$$set=o=>{"open"in o&&t(0,n=o.open)},[n,i]}class as extends K{constructor(e){super(),Z(this,e,ls,ss,W,{open:0})}}function Ar(r){let e;const t=r[4].default,n=yt(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wt(n,t,i,i[3],e?St(t,i[3],o,null):kt(i[3]),null)},i(i){e||($(n,i),e=!0)},o(i){L(n,i),e=!1},d(i){n&&n.d(i)}}}function us(r){let e,t,n=r[1]&&Ar(r);return{c(){e=E("div"),n&&n.c(),O(e,"class","map svelte-12dpf1u")},m(i,o){w(i,e,o),n&&n.m(e,null),r[5](e),t=!0},p(i,[o]){i[1]?n?(n.p(i,o),o&2&&$(n,1)):(n=Ar(i),n.c(),$(n,1),n.m(e,null)):n&&(ae(),L(n,1,1,()=>{n=null}),ue())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){i&&k(e),n&&n.d(),r[5](null)}}}function fs(r,e,t){let{$$slots:n={},$$scope:i}=e,{style:o}=e,s,a,l=!1;bo("setCamera",!window.location.hash),Kt(()=>{s=new on.Map({container:a,style:`https://api.maptiler.com/maps/${o}/style.json?key=MZEJTanw3WpxRvt7qDfo`,hash:!0}),s.addControl(new on.ScaleControl({})),s.addControl(new on.NavigationControl({visualizePitch:!0}),"bottom-right"),s.on("load",()=>{t(1,l=!0),Ie.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(a)}),it(()=>{s.remove()});function u(p){oe[p?"unshift":"push"](()=>{a=p,t(0,a)})}return r.$$set=p=>{"style"in p&&t(2,o=p.style),"$$scope"in p&&t(3,i=p.$$scope)},[a,l,o,i,n,u]}class cs extends K{constructor(e){super(),Z(this,e,fs,us,W,{style:2})}}const ps=r=>({}),Tr=r=>({}),ds=r=>({}),Pr=r=>({}),hs=r=>({}),Fr=r=>({});function ms(r){let e,t,n,i,o,s,a,l,u,p,d,c;const f=r[3].nav,h=yt(f,r,r[2],Fr),g=r[3].sidebar,m=yt(g,r,r[2],Pr),v=r[3].main,_=yt(v,r,r[2],Tr);return{c(){e=E("aside"),t=E("div"),n=E("nav"),h&&h.c(),i=C(),m&&m.c(),o=C(),s=E("button"),s.textContent="→",l=C(),u=E("main"),_&&_.c(),O(n,"class","svelte-1u7vg8a"),O(t,"class","sidebar-content content-container svelte-1u7vg8a"),O(s,"type","button"),O(s,"class","sidebar-toggle rounded-rect svelte-1u7vg8a"),O(e,"class",a=$r(r[0]?"":"collapsed")+" svelte-1u7vg8a"),O(u,"class","svelte-1u7vg8a")},m(b,y){w(b,e,y),S(e,t),S(t,n),h&&h.m(n,null),S(t,i),m&&m.m(t,null),S(e,o),S(e,s),w(b,l,y),w(b,u,y),_&&_.m(u,null),p=!0,d||(c=U(s,"click",r[1]),d=!0)},p(b,[y]){h&&h.p&&(!p||y&4)&&wt(h,f,b,b[2],p?St(f,b[2],y,hs):kt(b[2]),Fr),m&&m.p&&(!p||y&4)&&wt(m,g,b,b[2],p?St(g,b[2],y,ds):kt(b[2]),Pr),(!p||y&1&&a!==(a=$r(b[0]?"":"collapsed")+" svelte-1u7vg8a"))&&O(e,"class",a),_&&_.p&&(!p||y&4)&&wt(_,v,b,b[2],p?St(v,b[2],y,ps):kt(b[2]),Tr)},i(b){p||($(h,b),$(m,b),$(_,b),p=!0)},o(b){L(h,b),L(m,b),L(_,b),p=!1},d(b){b&&k(e),h&&h.d(b),m&&m.d(b),b&&k(l),b&&k(u),_&&_.d(b),d=!1,c()}}}function _s(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!0;function s(){t(0,o=!o)}return r.$$set=a=>{"$$scope"in a&&t(2,i=a.$$scope)},[o,s,i,n]}class gs extends K{constructor(e){super(),Z(this,e,_s,ms,W,{})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function bs(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(p){return l([u,p])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(p){u=[6,p],i=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var rt=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function vs(r,e){return r>e?1:r<e?-1:0}function We(r,e,t){for(var n=new rt(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Dn(r,e,t,n){var i=new rt(r,e);if(t===null)return i.left=i.right=null,i;t=We(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function Ir(r,e,t){var n=null,i=null;if(e){e=We(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function ys(r,e,t){return e===null?r:(r===null||(e=We(r.key,e,t),e.left=r),e)}function Vn(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Vn(r.left,o,!1,n,i),r.right&&Vn(r.right,o,!0,n,i)}}var dr=function(){function r(e){e===void 0&&(e=vs),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Dn(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new rt(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=We(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=We(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=We(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=We(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=We(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,a=this._root,l;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),l=s(a.key,t),l>0)break;if(s(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return ks(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Qn(e,t,0,i-1,o),this._root===null)this._root=Kn(e,t,0,i),this._size=i;else{var s=Ss(this.toList(),ws(e,t),o);i=this._size+i,this._root=Zn({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Vn(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=Ir(e,this._root,i),s=o.left,a=o.right;i(e,t)<0?a=Dn(t,n,a,i):s=Dn(t,n,s,i),this._root=ys(s,a,i)},r.prototype.split=function(e){return Ir(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return bs(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function Kn(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],a=e[o],l=new rt(s,a);return l.left=Kn(r,e,t,o),l.right=Kn(r,e,o+1,n),l}return null}function ws(r,e){for(var t=new rt(null,null),n=t,i=0;i<r.length;i++)n=n.next=new rt(r[i],e[i]);return n.next=null,t.next}function ks(r){for(var e=r,t=[],n=!1,i=new rt(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Zn(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Zn(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Zn(r,i+1,t),s}return null}function Ss(r,e,t){for(var n=new rt(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Qn(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,a=n+1;;){do s++;while(i(r[s],o)<0);do a--;while(i(r[a],o)>0);if(s>=a)break;var l=r[s];r[s]=r[a],r[a]=l,l=e[s],e[s]=e[a],e[a]=l}Qn(r,e,t,a,i),Qn(r,e,a+1,n,i)}}function Be(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Nr(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function Re(r,e,t){return e&&Nr(r.prototype,e),t&&Nr(r,t),r}var At=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},er=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,o=e.ll.y<t.ll.y?t.ll.y:e.ll.y,s=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:s}}},Ze=Number.EPSILON;Ze===void 0&&(Ze=Math.pow(2,-52));var Es=Ze*Ze,tr=function(e,t){if(-Ze<e&&e<Ze&&-Ze<t&&t<Ze)return 0;var n=e-t;return n*n<Es*e*t?0:e<t?-1:1},Ms=function(){function r(){Be(this,r),this.reset()}return Re(r,[{key:"reset",value:function(){this.xRounder=new xr,this.yRounder=new xr}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),xr=function(){function r(){Be(this,r),this.tree=new dr,this.round(0)}return Re(r,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&tr(n.key,i.key)===0)return this.tree.remove(t),i.key;var o=this.tree.next(n);return o!==null&&tr(n.key,o.key)===0?(this.tree.remove(t),o.key):t}}]),r}(),Xt=new Ms,qt=function(e,t){return e.x*t.y-e.y*t.x},Di=function(e,t){return e.x*t.x+e.y*t.y},Br=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y},s=qt(i,o);return tr(s,0)},kn=function(e){return Math.sqrt(Di(e,e))},$s=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return qt(o,i)/kn(o)/kn(i)},Ls=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Di(o,i)/kn(o)/kn(i)},Dr=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},jr=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},Os=function(e,t,n,i){if(t.x===0)return jr(n,i,e.x);if(i.x===0)return jr(e,t,n.x);if(t.y===0)return Dr(n,i,e.y);if(i.y===0)return Dr(e,t,n.y);var o=qt(t,i);if(o==0)return null;var s={x:n.x-e.x,y:n.y-e.y},a=qt(s,t)/o,l=qt(s,i)/o,u=e.x+l*t.x,p=n.x+a*i.x,d=e.y+l*t.y,c=n.y+a*i.y,f=(u+p)/2,h=(d+c)/2;return{x:f,y:h}},Ue=function(){Re(r,null,[{key:"compare",value:function(t,n){var i=r.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Sn.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){Be(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return Re(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,o=n.length;i<o;i++){var s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<t;o++){var s=this.point.events[o];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&t.push(o)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,o=function(a){var l=a.otherSE;i.set(a,{sine:$s(n.point,t.point,l.point),cosine:Ls(n.point,t.point,l.point)})};return function(s,a){i.has(s)||o(s),i.has(a)||o(a);var l=i.get(s),u=l.sine,p=l.cosine,d=i.get(a),c=d.sine,f=d.cosine;return u>=0&&c>=0?p<f?1:p>f?-1:0:u<0&&c<0?p<f?-1:p>f?1:0:c<u?-1:c>u?1:0}}}]),r}(),Cs=0,Sn=function(){Re(r,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,o=n.leftSE.point.x,s=t.rightSE.point.x,a=n.rightSE.point.x;if(a<i)return 1;if(s<o)return-1;var l=t.leftSE.point.y,u=n.leftSE.point.y,p=t.rightSE.point.y,d=n.rightSE.point.y;if(i<o){if(u<l&&u<p)return 1;if(u>l&&u>p)return-1;var c=t.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=n.comparePoint(t.rightSE.point);return f!==0?f:-1}if(i>o){if(l<u&&l<d)return-1;if(l>u&&l>d)return 1;var h=n.comparePoint(t.leftSE.point);if(h!==0)return h;var g=t.comparePoint(n.rightSE.point);return g<0?1:g>0?-1:1}if(l<u)return-1;if(l>u)return 1;if(s<a){var m=n.comparePoint(t.rightSE.point);if(m!==0)return m}if(s>a){var v=t.comparePoint(n.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(s!==a){var _=p-l,b=s-i,y=d-u,M=a-o;if(_>b&&y<M)return 1;if(_<b&&y>M)return-1}return s>a?1:s<a||p<d?-1:p>d?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,i){Be(this,r),this.id=++Cs,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}return Re(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var s=(t.y-n.y)/o.y,a=n.x+s*o.x;if(t.x===a)return 0;var l=(t.x-n.x)/o.x,u=n.y+l*o.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),o=er(n,i);if(o===null)return null;var s=this.leftSE.point,a=this.rightSE.point,l=t.leftSE.point,u=t.rightSE.point,p=At(n,l)&&this.comparePoint(l)===0,d=At(i,s)&&t.comparePoint(s)===0,c=At(n,u)&&this.comparePoint(u)===0,f=At(i,a)&&t.comparePoint(a)===0;if(d&&p)return f&&!c?a:!f&&c?u:null;if(d)return c&&s.x===u.x&&s.y===u.y?null:s;if(p)return f&&a.x===l.x&&a.y===l.y?null:l;if(f&&c)return null;if(f)return a;if(c)return u;var h=Os(s,this.vector(),l,t.vector());return h===null||!At(o,h)?null:Xt.round(h.x,h.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,o=new Ue(t,!0),s=new Ue(t,!1),a=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(o);var l=new r(o,a,this.rings.slice(),this.windings.slice());return Ue.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Ue.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),s.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=r.compare(n,i);if(o!==0){if(o>0){var s=n;n=i,i=s}if(n.prev===i){var a=n;n=i,i=a}for(var l=0,u=i.rings.length;l<u;l++){var p=i.rings[l],d=i.windings[l],c=n.rings.indexOf(p);c===-1?(n.rings.push(p),n.windings.push(d)):n.windings[c]+=d}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,s=0,a=this.rings.length;s<a;s++){var l=this.rings[s],u=this.windings[s],p=n.indexOf(l);p===-1?(n.push(l),i.push(u)):i[p]+=u}for(var d=[],c=[],f=0,h=n.length;f<h;f++)if(i[f]!==0){var g=n[f],m=g.poly;if(c.indexOf(m)===-1)if(g.isExterior)d.push(m);else{c.indexOf(m)===-1&&c.push(m);var v=d.indexOf(g.poly);v!==-1&&d.splice(v,1)}}for(var _=0,b=d.length;_<b;_++){var y=d[_].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(je.type){case"union":{var i=t.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var s,a;t.length<n.length?(s=t.length,a=n.length):(s=n.length,a=t.length),this._isInResult=a===je.numMultiPolys&&s<a;break}case"xor":{var l=Math.abs(t.length-n.length);this._isInResult=l%2===1;break}case"difference":{var u=function(d){return d.length===1&&d[0].isSubject};this._isInResult=u(t)!==u(n);break}default:throw new Error("Unrecognized operation type found ".concat(je.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var o,s,a,l=Ue.comparePoints(t,n);if(l<0)o=t,s=n,a=1;else if(l>0)o=n,s=t,a=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var u=new Ue(o,!0),p=new Ue(s,!1);return new r(u,p,[i],[a])}}]),r}(),qr=function(){function r(e,t,n){if(Be(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Xt.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,a=e.length;s<a;s++){if(typeof e[s][0]!="number"||typeof e[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Xt.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(Sn.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Sn.fromRing(o,i,this))}return Re(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];t.push(o.leftSE),t.push(o.rightSE)}return t}}]),r}(),Rs=function(){function r(e,t){if(Be(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new qr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new qr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}return Re(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),Ur=function(){function r(e,t){if(Be(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new Rs(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}return Re(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),s=0,a=o.length;s<a;s++)t.push(o[s]);return t}}]),r}(),As=function(){Re(r,null,[{key:"factory",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!(!s.isInResult()||s.ringOut)){for(var a=null,l=s.leftSE,u=s.rightSE,p=[l],d=l.point,c=[];a=l,l=u,p.push(l),l.point!==d;)for(;;){var f=l.getAvailableLinkedEvents();if(f.length===0){var h=p[0].point,g=p[p.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(h.x,",")+" ".concat(h.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(f.length===1){u=f[0].otherSE;break}for(var m=null,v=0,_=c.length;v<_;v++)if(c[v].point===l.point){m=v;break}if(m!==null){var b=c.splice(m)[0],y=p.splice(b.index);y.unshift(y[0].otherSE),n.push(new r(y.reverse()));continue}c.push({index:p.length,point:l.point});var M=l.getLeftmostComparator(a);u=f.sort(M)[0].otherSE;break}n.push(new r(p))}}return n}}]);function r(e){Be(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return Re(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,o=this.events.length-1;i<o;i++){var s=this.events[i].point,a=this.events[i+1].point;Br(s,t,a)!==0&&(n.push(s),t=s)}if(n.length===1)return null;var l=n[0],u=n[1];Br(l,t,u)===0&&n.shift(),n.push(n[0]);for(var p=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:n.length-1,c=this.isExteriorRing()?n.length:-1,f=[],h=d;h!=c;h+=p)f.push([n[h].x,n[h].y]);return f}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];Ue.compare(t,o)>0&&(t=o)}for(var s=t.segment.prevInResult(),a=s?s.prevInResult():null;;){if(!s)return null;if(!a)return s.ringOut;if(a.ringOut!==s.ringOut)return a.ringOut.enclosingRing()!==s.ringOut?s.ringOut:s.ringOut.enclosingRing();s=a.prevInResult(),a=s?s.prevInResult():null}}}]),r}(),Gr=function(){function r(e){Be(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Re(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&t.push(o)}return t}}]),r}(),Ts=function(){function r(e){Be(this,r),this.rings=e,this.polys=this._composePolys(e)}return Re(r,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&t.push(o)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if(!s.poly)if(s.isExteriorRing())n.push(new Gr(s));else{var a=s.enclosingRing();a.poly||n.push(new Gr(a)),a.poly.addInterior(s)}}return n}}]),r}(),Ps=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sn.compare;Be(this,r),this.queue=e,this.tree=new dr(t),this.segments=[]}return Re(r,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var o=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var s=o,a=o,l=void 0,u=void 0;l===void 0;)s=this.tree.prev(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){var p=null;if(l){var d=l.getIntersection(n);if(d!==null&&(n.isAnEndpoint(d)||(p=d),!l.isAnEndpoint(d)))for(var c=this._splitSafely(l,d),f=0,h=c.length;f<h;f++)i.push(c[f])}var g=null;if(u){var m=u.getIntersection(n);if(m!==null&&(n.isAnEndpoint(m)||(g=m),!u.isAnEndpoint(m)))for(var v=this._splitSafely(u,m),_=0,b=v.length;_<b;_++)i.push(v[_])}if(p!==null||g!==null){var y=null;if(p===null)y=g;else if(g===null)y=p;else{var M=Ue.comparePoints(p,g);y=M<=0?p:g}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var R=n.split(y),T=0,A=R.length;T<A;T++)i.push(R[T])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=l)}else{if(l&&u){var B=l.getIntersection(u);if(B!==null){if(!l.isAnEndpoint(B))for(var D=this._splitSafely(l,B),G=0,F=D.length;G<F;G++)i.push(D[G]);if(!u.isAnEndpoint(B))for(var P=this._splitSafely(u,B),J=0,ie=P.length;J<ie;J++)i.push(P[J])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var o=t.split(n);return o.push(i),t.consumedBy===void 0&&this.tree.insert(t),o}}]),r}(),Hr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Fs=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Is=function(){function r(){Be(this,r)}return Re(r,[{key:"run",value:function(t,n,i){je.type=t,Xt.reset();for(var o=[new Ur(n,!0)],s=0,a=i.length;s<a;s++)o.push(new Ur(i[s],!1));if(je.numMultiPolys=o.length,je.type==="difference")for(var l=o[0],u=1;u<o.length;)er(o[u].bbox,l.bbox)!==null?u++:o.splice(u,1);if(je.type==="intersection"){for(var p=0,d=o.length;p<d;p++)for(var c=o[p],f=p+1,h=o.length;f<h;f++)if(er(c.bbox,o[f].bbox)===null)return[]}for(var g=new dr(Ue.compare),m=0,v=o.length;m<v;m++)for(var _=o[m].getSweepEvents(),b=0,y=_.length;b<y;b++)if(g.insert(_[b]),g.size>Hr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var M=new Ps(g),R=g.size,T=g.pop();T;){var A=T.key;if(g.size===R){var B=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(B.id," ")+"[".concat(B.leftSE.point.x,", ").concat(B.leftSE.point.y,"] -> ")+"[".concat(B.rightSE.point.x,", ").concat(B.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Hr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(M.segments.length>Fs)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var D=M.process(A),G=0,F=D.length;G<F;G++){var P=D[G];P.consumedBy===void 0&&g.insert(P)}R=g.size,T=g.pop()}Xt.reset();var J=As.factory(M.segments),ie=new Ts(J);return ie.getGeom()}}]),r}(),je=new Is,Ns=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return je.run("union",e,n)},xs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return je.run("intersection",e,n)},Bs=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return je.run("xor",e,n)},Ds=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return je.run("difference",e,n)},an={union:Ns,intersection:xs,xor:Bs,difference:Ds};function js(r,e){var t=Us(e),n=null;return r.type==="FeatureCollection"?n=qs(r):n=ji(an.union(r.geometry.coordinates)),n.geometry.coordinates.forEach(function(i){t.geometry.coordinates.push(i[0])}),t}function qs(r){var e=r.features.length===2?an.union(r.features[0].geometry.coordinates,r.features[1].geometry.coordinates):an.union.apply(an,r.features.map(function(t){return t.geometry.coordinates}));return ji(e)}function ji(r){return vo(r)}function Us(r){var e=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],t=r&&r.geometry.coordinates||e;return yo(t)}function Gs(r,e,t){let n;te(r,Ie,s=>t(1,n=s));let{boundaryGeojson:i}=e;return wo("setCamera")&&n.fitBounds(ur(i),{padding:20,animate:!1}),Xe(n,"boundary",js(i)),ke(n,{id:"boundary",source:"boundary",...On("black",.5)}),r.$$set=s=>{"boundaryGeojson"in s&&t(0,i=s.boundaryGeojson)},[i]}class Hs extends K{constructor(e){super(),Z(this,e,Gs,null,W,{boundaryGeojson:0})}}const pe={area:"#e41a1c",route:"#377eb8",crossing:"#4daf4a",other:"#984ea3",preapp:"#e41a1c",outline:"#377eb8","reserved matters":"#4daf4a","local plan":"#984ea3",hovering:"black",lineEndpointColor:"black"},Pn=10,Wt=10;function zs(r,e,t){let n;te(r,Ie,u=>t(2,n=u));let{layer:i}=e,{contents:o}=e,s=new on.Popup({closeButton:!1,closeOnClick:!1});n.on("mousemove",a),n.on("mouseout",l),it(()=>{n.off("mousemove",a),n.off("mouseout",l),s.remove()});function a(u){if(!n.getLayer(i)){s.remove();return}let p=n.queryRenderedFeatures(u.point,{layers:[i]});p.length>0?s.setLngLat(u.lngLat).setHTML(o(p[0].properties)).addTo(n):s.remove()}function l(){s.remove()}return r.$$set=u=>{"layer"in u&&t(0,i=u.layer),"contents"in u&&t(1,o=u.contents)},[i,o]}class Js extends K{constructor(e){super(),Z(this,e,zs,null,W,{layer:0,contents:1})}}function zr(r,e,t){const n=r.slice();return n[3]=e[t],n}function Jr(r,e,t){const n=r.slice();return n[6]=e[t],n}function Yr(r){let e;return{c(){e=E("td"),O(e,"class","svelte-11t6rxo"),le(e,"background-color",r[6])},m(t,n){w(t,e,n)},p(t,n){n&1&&le(e,"background-color",t[6])},d(t){t&&k(e)}}}function Xr(r){let e,t=r[3]+"",n;return{c(){e=E("td"),n=X(t),O(e,"class","svelte-11t6rxo"),le(e,"width",r[2])},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[3]+"")&&xe(n,t)},d(i){i&&k(e)}}}function Ys(r){let e,t,n,i,o=r[0],s=[];for(let u=0;u<o.length;u+=1)s[u]=Yr(Jr(r,o,u));let a=r[1],l=[];for(let u=0;u<a.length;u+=1)l[u]=Xr(zr(r,a,u));return{c(){e=E("table"),t=E("tr");for(let u=0;u<s.length;u+=1)s[u].c();n=C(),i=E("tr");for(let u=0;u<l.length;u+=1)l[u].c();O(t,"class","svelte-11t6rxo"),O(i,"class","svelte-11t6rxo"),O(e,"class","svelte-11t6rxo")},m(u,p){w(u,e,p),S(e,t);for(let d=0;d<s.length;d+=1)s[d].m(t,null);S(e,n),S(e,i);for(let d=0;d<l.length;d+=1)l[d].m(i,null)},p(u,[p]){if(p&1){o=u[0];let d;for(d=0;d<o.length;d+=1){const c=Jr(u,o,d);s[d]?s[d].p(c,p):(s[d]=Yr(c),s[d].c(),s[d].m(t,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=o.length}if(p&6){a=u[1];let d;for(d=0;d<a.length;d+=1){const c=zr(u,a,d);l[d]?l[d].p(c,p):(l[d]=Xr(c),l[d].c(),l[d].m(i,null))}for(;d<l.length;d+=1)l[d].d(1);l.length=a.length}},i:H,o:H,d(u){u&&k(e),hn(s,u),hn(l,u)}}}function Xs(r,e,t){let{colors:n}=e,{labels:i}=e;if(n.length!=i.length)throw new Error("colors and labels must match");let o=`${100/n.length}%`;return r.$$set=s=>{"colors"in s&&t(0,n=s.colors),"labels"in s&&t(1,i=s.labels)},[n,i,o]}class Ws extends K{constructor(e){super(),Z(this,e,Xs,Ys,W,{colors:0,labels:1})}}const Vs="/atip/streetview/assets/help-d011708a.svg";function Ks(r){let e,t;return{c(){e=E("img"),mn(e.src,t=Vs)||O(e,"src",t),O(e,"title",r[0]),O(e,"alt",r[0])},m(n,i){w(n,e,i)},p(n,[i]){i&1&&O(e,"title",n[0]),i&1&&O(e,"alt",n[0])},i:H,o:H,d(n){n&&k(e)}}}function Zs(r,e,t){let{contents:n}=e;return r.$$set=i=>{"contents"in i&&t(0,n=i.contents)},[n]}class Qs extends K{constructor(e){super(),Z(this,e,Zs,Ks,W,{contents:0})}}function el(r){let e,t,n,i,o,s,a;return t=new Qs({props:{contents:"Data comes from OpenStreetMap, and may not always be correct. Unexpected values are treated as unknown. Freehand route segments and off-road paths generally have no speed data."}}),i=new Ws({props:{colors:r[0],labels:["< 20","20","30","40",">= 50"]}}),s=new Js({props:{layer:"speed-limits",contents:nl}}),{c(){e=X(`(mph)
`),I(t.$$.fragment),n=C(),I(i.$$.fragment),o=C(),I(s.$$.fragment)},m(l,u){w(l,e,u),N(t,l,u),w(l,n,u),N(i,l,u),w(l,o,u),N(s,l,u),a=!0},p:H,i(l){a||($(t.$$.fragment,l),$(i.$$.fragment,l),$(s.$$.fragment,l),a=!0)},o(l){L(t.$$.fragment,l),L(i.$$.fragment,l),L(s.$$.fragment,l),a=!1},d(l){l&&k(e),x(t,l),l&&k(n),x(i,l),l&&k(o),x(s,l)}}}let tl="white",pt="speed-limits",jn="speed-limits",Tt=.8;function nl(r){return r.speed_limit?`${Math.round(r.speed_limit)} mph`:"Unknown"}function rl(r,e,t){let n,i,o;te(r,Ie,p=>t(2,n=p)),te(r,bn,p=>t(3,i=p)),te(r,ne,p=>t(4,o=p));let{id:s}=e,a=["#00AB4D","#8ECA4D","#F7BB00","#BB0000","#470000"];const l=["case",["<",["get","speed_limit"],20],a[0],["==",["get","speed_limit"],20],a[1],["==",["get","speed_limit"],30],a[2],["==",["get","speed_limit"],40],a[3],[">=",["get","speed_limit"],50],a[4],tl],u=["case",["<",["get","speed_limit"],20],Tt,["==",["get","speed_limit"],20],Tt,["==",["get","speed_limit"],30],Tt,["==",["get","speed_limit"],40],Tt,[">=",["get","speed_limit"],50],Tt,0];return Xe(n,pt,Pe()),ke(n,{id:jn,source:pt,...Mt(l,Wt,u)}),Kt(async()=>{try{if(s){let p=o.features.find(c=>c.id==s),d=JSON.parse(await i.speedLimitForRoute(p.properties.waypoints));n.getSource(pt).setData(d)}else{let p=JSON.parse(await i.allSpeedLimits());n.getSource(pt).setData(p)}}catch(p){window.alert(`Couldn't calculate speed limits for route: ${p}`)}}),it(()=>{n.getLayer(jn)&&n.removeLayer(jn),n.getSource(pt)&&n.removeSource(pt)}),r.$$set=p=>{"id"in p&&t(1,s=p.id)},[a,s]}class qi extends K{constructor(e){super(),Z(this,e,rl,el,W,{id:1})}}function Wr(r){let e,t;return e=new qi({props:{id:r[0]}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.id=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function il(r){let e,t,n,i,o,s,a,l,u,p,d=r[1]=="speed limits"&&Wr(r);return{c(){e=E("label"),t=X(`Show details:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",s=C(),d&&d.c(),a=de(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,r[1]===void 0&&at(()=>r[2].call(n))},m(c,f){w(c,e,f),S(e,t),S(e,n),S(n,i),S(n,o),nt(n,r[1]),w(c,s,f),d&&d.m(c,f),w(c,a,f),l=!0,u||(p=U(n,"change",r[2]),u=!0)},p(c,[f]){f&2&&nt(n,c[1]),c[1]=="speed limits"?d?(d.p(c,f),f&2&&$(d,1)):(d=Wr(c),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(ae(),L(d,1,1,()=>{d=null}),ue())},i(c){l||($(d),l=!0)},o(c){L(d),l=!1},d(c){c&&k(e),c&&k(s),d&&d.d(c),c&&k(a),u=!1,p()}}}function ol(r,e,t){let{id:n}=e,i="none";function o(){i=Cn(this),t(1,i)}return r.$$set=s=>{"id"in s&&t(0,n=s.id)},[n,i,o]}class sl extends K{constructor(e){super(),Z(this,e,ol,il,W,{id:0})}}function Vr(r){let e,t=Kr(r[4])+"",n,i,o,s,a,l,u,p,d,c;return u=new sl({props:{id:r[3]}}),{c(){e=X("Length: "),n=X(t),i=C(),o=E("br"),s=E("button"),s.textContent="Auto-fill details",a=E("br"),l=C(),I(u.$$.fragment),O(s,"type","button")},m(f,h){w(f,e,h),w(f,n,h),w(f,i,h),w(f,o,h),w(f,s,h),w(f,a,h),w(f,l,h),N(u,f,h),p=!0,d||(c=U(s,"click",r[13]),d=!0)},p(f,h){(!p||h&16)&&t!==(t=Kr(f[4])+"")&&xe(n,t);const g={};h&8&&(g.id=f[3]),u.$set(g)},i(f){p||($(u.$$.fragment,f),p=!0)},o(f){L(u.$$.fragment,f),p=!1},d(f){f&&k(e),f&&k(n),f&&k(i),f&&k(o),f&&k(s),f&&k(a),f&&k(l),x(u,f),d=!1,c()}}}function ll(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,h,g,m,v,_,b,y,M,R,T,A,B,D,G,F,P,J,ie,Ae,Le,Se,Te,Ee,Me,ge,ce,he,_e=r[4]&&Vr(r);return{c(){e=E("label"),t=X("Name:"),n=E("br"),i=C(),o=E("input"),s=C(),a=E("br"),l=C(),u=E("br"),p=C(),d=E("label"),c=E("input"),f=X(`
  Area`),h=C(),g=E("label"),m=E("input"),v=X(`
  Route`),_=C(),b=E("label"),y=E("input"),M=X(`
  Crossing`),R=C(),T=E("label"),A=E("input"),B=X(`
  Other`),D=C(),G=E("br"),F=C(),P=E("br"),J=C(),ie=E("label"),Ae=X("Description:"),Le=E("br"),Se=C(),Te=E("textarea"),Ee=C(),_e&&_e.c(),Me=de(),O(o,"type","text"),le(o,"width","100%"),O(c,"type","radio"),c.__value="area",c.value=c.__value,r[8][0].push(c),O(m,"type","radio"),m.__value="route",m.value=m.__value,r[8][0].push(m),O(y,"type","radio"),y.__value="crossing",y.value=y.__value,r[8][0].push(y),O(A,"type","radio"),A.__value="other",A.value=A.__value,r[8][0].push(A),le(Te,"width","100%"),O(Te,"rows","5"),O(Te,"class","svelte-15lna0i")},m(j,z){w(j,e,z),S(e,t),S(e,n),S(e,i),S(e,o),Ne(o,r[0]),w(j,s,z),w(j,a,z),w(j,l,z),w(j,u,z),w(j,p,z),w(j,d,z),S(d,c),c.checked=c.__value===r[1],S(d,f),w(j,h,z),w(j,g,z),S(g,m),m.checked=m.__value===r[1],S(g,v),w(j,_,z),w(j,b,z),S(b,y),y.checked=y.__value===r[1],S(b,M),w(j,R,z),w(j,T,z),S(T,A),A.checked=A.__value===r[1],S(T,B),w(j,D,z),w(j,G,z),w(j,F,z),w(j,P,z),w(j,J,z),w(j,ie,z),S(ie,Ae),S(ie,Le),S(ie,Se),S(ie,Te),Ne(Te,r[2]),w(j,Ee,z),_e&&_e.m(j,z),w(j,Me,z),ge=!0,ce||(he=[U(o,"input",r[6]),U(c,"change",r[7]),U(m,"change",r[9]),U(y,"change",r[10]),U(A,"change",r[11]),U(Te,"input",r[12])],ce=!0)},p(j,[z]){z&1&&o.value!==j[0]&&Ne(o,j[0]),z&2&&(c.checked=c.__value===j[1]),z&2&&(m.checked=m.__value===j[1]),z&2&&(y.checked=y.__value===j[1]),z&2&&(A.checked=A.__value===j[1]),z&4&&Ne(Te,j[2]),j[4]?_e?(_e.p(j,z),z&16&&$(_e,1)):(_e=Vr(j),_e.c(),$(_e,1),_e.m(Me.parentNode,Me)):_e&&(ae(),L(_e,1,1,()=>{_e=null}),ue())},i(j){ge||($(_e),ge=!0)},o(j){L(_e),ge=!1},d(j){j&&k(e),j&&k(s),j&&k(a),j&&k(l),j&&k(u),j&&k(p),j&&k(d),r[8][0].splice(r[8][0].indexOf(c),1),j&&k(h),j&&k(g),r[8][0].splice(r[8][0].indexOf(m),1),j&&k(_),j&&k(b),r[8][0].splice(r[8][0].indexOf(y),1),j&&k(R),j&&k(T),r[8][0].splice(r[8][0].indexOf(A),1),j&&k(D),j&&k(G),j&&k(F),j&&k(P),j&&k(J),j&&k(ie),j&&k(Ee),_e&&_e.d(j),j&&k(Me),ce=!1,Fe(he)}}}function Kr(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+"km"}function al(r,e,t){let n,i;te(r,bn,b=>t(14,n=b)),te(r,ne,b=>t(15,i=b));let{id:o}=e,{name:s}=e,{intervention_type:a}=e,{description:l}=e,{length_meters:u}=e;async function p(){let b=i.features.find(y=>y.id==o);try{t(0,s=await n.nameForRoute(b))}catch(y){window.alert(`Couldn't auto-name route: ${y}`)}}const d=[[]];function c(){s=this.value,t(0,s)}function f(){a=this.__value,t(1,a)}function h(){a=this.__value,t(1,a)}function g(){a=this.__value,t(1,a)}function m(){a=this.__value,t(1,a)}function v(){l=this.value,t(2,l)}const _=()=>p();return r.$$set=b=>{"id"in b&&t(3,o=b.id),"name"in b&&t(0,s=b.name),"intervention_type"in b&&t(1,a=b.intervention_type),"description"in b&&t(2,l=b.description),"length_meters"in b&&t(4,u=b.length_meters)},[s,a,l,o,u,p,c,f,d,h,g,m,v,_]}class ul extends K{constructor(e){super(),Z(this,e,al,ll,W,{id:3,name:0,intervention_type:1,description:2,length_meters:4})}}const fl="Intervention",cl=[{name:"Route",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"RouteType",oneOf:[{name:"OnRoad",description:"Directly on or parallel to the carriageway",members:[{name:"OnRoadType",oneOf:["FullSeparation",{value:"Stepped",description:"Raised above the road, but below the footway. Only appropriate on roads with speeds under 30 mph."},"PartSeparation","MandatoryLane","AdvisoryLane",{name:"NoSeparation",description:"If there's no physical separation between the road, why not? Justify why separation is unnecessary.",oneOf:["TrafficCalming","ModalFilters","LowSpeed"]}]},{name:"SourceOfSpace",oneOf:["ReallocateEntireLane","RoadDiet","PavementDiet","ReallocateVerge"]}]},{name:"OffRoad",oneOf:["ThroughPark","CanalTowpath"]}]},{name:"Users",oneOf:["Footpath","Cyclepath","SharedUseNoSeparation",{name:"SharedUseWithSeparation",members:[{name:"width_footpath",type:"number"},{name:"width_cyclepath",type:"number"}]}]}]},{name:"Crossing",members:[{name:"name",type:"one-liner"},{name:"description",type:"textbox"},{name:"CrossingType",oneOf:["Zebra",{name:"Signalised",members:[{name:"SignalisedCrossingType",oneOf:["Puffin","Toucan","Pegasus"]},{name:"CrossingActivation",oneOf:["PressButton","InductionLoop","FixedTimer"]},{name:"MaxTimeWaitingForGreen",description:"After activating the signal, what is the maximum time somebody will wait before getting a green light? (seconds)",type:"number"},{name:"GreenDuration",type:"number"}]},"SchoolCrossing","Refuge",{name:"GradeSeparated",members:[{name:"GradeSeparatedType",oneOf:["Bridge","Tunnel"]},{name:"AccessRamp",type:"checkbox"},{name:"Steps",type:"checkbox"}]}]},{name:"MatchesDesireLine",type:"checkbox"},{name:"MotorTrafficFlow",oneOf:["> 8000","3000 - 8000","< 3000"]},{name:"MotorTrafficSpeed",oneOf:["> 30 mph","20 - 30 mph","< 20 mph"]}]}],pl={name:fl,oneOf:cl};function dl(r){const e=r-1;return e*e*e+1}function Ot(r,{delay:e=0,duration:t=400,easing:n=dl}={}){const i=getComputedStyle(r),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),u=parseFloat(i.marginTop),p=parseFloat(i.marginBottom),d=parseFloat(i.borderTopWidth),c=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*o};height: ${f*s}px;padding-top: ${f*a}px;padding-bottom: ${f*l}px;margin-top: ${f*u}px;margin-bottom: ${f*p}px;border-top-width: ${f*d}px;border-bottom-width: ${f*c}px;`}}function Ui(r){return"members"in r}function Gi(r){return"oneOf"in r}function Hi(r){return typeof r=="string"}function zi(r){return typeof r=="object"&&"value"in r}function hl(r){return"type"in r&&r.type=="number"}function Ji(r){return"type"in r&&r.type=="one-liner"}function Yi(r){return"type"in r&&r.type=="textbox"}function Xi(r){return"type"in r&&r.type=="checkbox"}function Zr(r,e,t){const n=r.slice();return n[15]=e[t],n[18]=e,n[19]=t,n}function Qr(r,e,t){const n=r.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function ei(r){let e,t=r[1].description+"",n;return{c(){e=E("p"),n=X(t),O(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),S(e,n)},p(i,o){o&2&&t!==(t=i[1].description+"")&&xe(n,t)},d(i){i&&k(e)}}}function ml(r){let e,t,n;return{c(){e=E("input"),O(e,"type","checkbox")},m(i,o){w(i,e,o),e.checked=r[0],t||(n=U(e,"change",r[14]),t=!0)},p(i,o){o&1&&(e.checked=i[0])},i:H,o:H,d(i){i&&k(e),t=!1,n()}}}function _l(r){let e,t,n;return{c(){e=E("textarea"),le(e,"width","100%"),O(e,"rows","5"),O(e,"class","svelte-1b72l00")},m(i,o){w(i,e,o),Ne(e,r[0]),t||(n=U(e,"input",r[13]),t=!0)},p(i,o){o&1&&Ne(e,i[0])},i:H,o:H,d(i){i&&k(e),t=!1,n()}}}function gl(r){let e,t,n;return{c(){e=E("input"),O(e,"type","text"),le(e,"width","100%")},m(i,o){w(i,e,o),Ne(e,r[0]),t||(n=U(e,"input",r[12]),t=!0)},p(i,o){o&1&&e.value!==i[0]&&Ne(e,i[0])},i:H,o:H,d(i){i&&k(e),t=!1,n()}}}function bl(r){let e,t,n;return{c(){e=E("input"),O(e,"type","number")},m(i,o){w(i,e,o),Ne(e,r[0]),t||(n=U(e,"input",r[11]),t=!0)},p(i,o){o&1&&Ci(e.value)!==i[0]&&Ne(e,i[0])},i:H,o:H,d(i){i&&k(e),t=!1,n()}}}function vl(r){let e,t,n=r[1].oneOf,i=[];for(let s=0;s<n.length;s+=1)i[s]=ni(Zr(r,n,s));const o=s=>L(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=de()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&31){n=s[1].oneOf;let l;for(l=0;l<n.length;l+=1){const u=Zr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=ni(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(ae(),l=n.length;l<i.length;l+=1)o(l);ue()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)L(i[a]);t=!1},d(s){hn(i,s),s&&k(e)}}}function yl(r){let e,t,n=r[1].members,i=[];for(let s=0;s<n.length;s+=1)i[s]=ri(Qr(r,n,s));const o=s=>L(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=de()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);w(s,e,a),t=!0},p(s,a){if(a&3){n=s[1].members;let l;for(l=0;l<n.length;l+=1){const u=Qr(s,n,l);i[l]?(i[l].p(u,a),$(i[l],1)):(i[l]=ri(u),i[l].c(),$(i[l],1),i[l].m(e.parentNode,e))}for(ae(),l=n.length;l<i.length;l+=1)o(l);ue()}},i(s){if(!t){for(let a=0;a<n.length;a+=1)$(i[a]);t=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)L(i[a]);t=!1},d(s){hn(i,s),s&&k(e)}}}function wl(r){let e,t,n,i,o=r[15].name+"",s,a,l,u,p,d,c,f=r[2]==r[15].name&&typeof r[0]=="object"&&ti(r);return{c(){e=E("label"),t=E("input"),i=C(),s=X(o),a=E("br"),l=C(),f&&f.c(),u=de(),O(t,"type","radio"),t.__value=n=r[15].name,t.value=t.__value,r[7][0].push(t)},m(h,g){w(h,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),w(h,l,g),f&&f.m(h,g),w(h,u,g),p=!0,d||(c=[U(t,"change",r[9]),U(t,"change",r[4])],d=!0)},p(h,g){(!p||g&2&&n!==(n=h[15].name))&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),(!p||g&2)&&o!==(o=h[15].name+"")&&xe(s,o),h[2]==h[15].name&&typeof h[0]=="object"?f?(f.p(h,g),g&7&&$(f,1)):(f=ti(h),f.c(),$(f,1),f.m(u.parentNode,u)):f&&(ae(),L(f,1,1,()=>{f=null}),ue())},i(h){p||($(f),p=!0)},o(h){L(f),p=!1},d(h){h&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),h&&k(l),f&&f.d(h),h&&k(u),d=!1,Fe(c)}}}function kl(r){let e,t,n,i,o=r[15].value+"",s,a,l,u,p;function d(h,g){return h[15].description?Ml:El}let c=d(r),f=c(r);return{c(){e=E("label"),t=E("input"),i=C(),s=X(o),a=C(),f.c(),l=C(),O(t,"type","radio"),t.__value=n=r[15].value,t.value=t.__value,r[7][0].push(t)},m(h,g){w(h,e,g),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),f.m(e,null),S(e,l),u||(p=[U(t,"change",r[8]),U(t,"change",r[3])],u=!0)},p(h,g){g&2&&n!==(n=h[15].value)&&(t.__value=n,t.value=t.__value),g&4&&(t.checked=t.__value===h[2]),g&2&&o!==(o=h[15].value+"")&&xe(s,o),c===(c=d(h))&&f?f.p(h,g):(f.d(1),f=c(h),f&&(f.c(),f.m(e,l)))},i:H,o:H,d(h){h&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),f.d(),u=!1,Fe(p)}}}function Sl(r){let e,t,n,i,o=r[15]+"",s,a,l,u,p,d;return{c(){e=E("label"),t=E("input"),i=C(),s=X(o),a=C(),l=E("br"),u=C(),O(t,"type","radio"),t.__value=n=r[15],t.value=t.__value,r[7][0].push(t)},m(c,f){w(c,e,f),S(e,t),t.checked=t.__value===r[2],S(e,i),S(e,s),S(e,a),S(e,l),S(e,u),p||(d=[U(t,"change",r[6]),U(t,"change",r[3])],p=!0)},p(c,f){f&2&&n!==(n=c[15])&&(t.__value=n,t.value=t.__value),f&4&&(t.checked=t.__value===c[2]),f&2&&o!==(o=c[15]+"")&&xe(s,o)},i:H,o:H,d(c){c&&k(e),r[7][0].splice(r[7][0].indexOf(t),1),p=!1,Fe(d)}}}function ti(r){let e,t,n,i,o,s;function a(u){r[10](u,r[15])}let l={spec:r[15]};return r[0][r[15].name]!==void 0&&(l.value=r[0][r[15].name]),t=new Qt({props:l}),oe.push(()=>Oe(t,"value",a,r[0][r[15].name])),{c(){e=E("div"),I(t.$$.fragment),i=C(),O(e,"class","svelte-1b72l00")},m(u,p){w(u,e,p),N(t,e,null),S(e,i),s=!0},p(u,p){r=u;const d={};p&2&&(d.spec=r[15]),!n&&p&3&&(n=!0,d.value=r[0][r[15].name],Ce(()=>n=!1)),t.$set(d)},i(u){s||($(t.$$.fragment,u),at(()=>{o||(o=$t(e,Ot,{duration:500},!0)),o.run(1)}),s=!0)},o(u){L(t.$$.fragment,u),o||(o=$t(e,Ot,{duration:500},!1)),o.run(0),s=!1},d(u){u&&k(e),x(t),u&&o&&o.end()}}}function El(r){let e;return{c(){e=E("br")},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function Ml(r){let e,t,n=r[15].description+"",i,o;return{c(){e=E("p"),t=X("("),i=X(n),o=X(")"),O(e,"class","svelte-1b72l00")},m(s,a){w(s,e,a),S(e,t),S(e,i),S(e,o)},p(s,a){a&2&&n!==(n=s[15].description+"")&&xe(i,n)},d(s){s&&k(e)}}}function ni(r){let e,t,n,i,o,s;const a=[Sl,kl,wl],l=[];function u(p,d){return d&2&&(e=null),d&2&&(t=null),e==null&&(e=!!Hi(p[15])),e?0:(t==null&&(t=!!zi(p[15])),t?1:2)}return n=u(r,-1),i=l[n]=a[n](r),{c(){i.c(),o=de()},m(p,d){l[n].m(p,d),w(p,o,d),s=!0},p(p,d){let c=n;n=u(p,d),n===c?l[n].p(p,d):(ae(),L(l[c],1,1,()=>{l[c]=null}),ue(),i=l[n],i?i.p(p,d):(i=l[n]=a[n](p),i.c()),$(i,1),i.m(o.parentNode,o))},i(p){s||($(i),s=!0)},o(p){L(i),s=!1},d(p){l[n].d(p),p&&k(o)}}}function ri(r){let e,t,n=r[15].name+"",i,o,s,a,l,u;function p(c){r[5](c,r[15])}let d={spec:r[15]};return r[0][r[15].name]!==void 0&&(d.value=r[0][r[15].name]),s=new Qt({props:d}),oe.push(()=>Oe(s,"value",p,r[0][r[15].name])),{c(){e=E("div"),t=E("h3"),i=X(n),o=C(),I(s.$$.fragment),l=C(),O(e,"class","svelte-1b72l00")},m(c,f){w(c,e,f),S(e,t),S(t,i),S(e,o),N(s,e,null),S(e,l),u=!0},p(c,f){r=c,(!u||f&2)&&n!==(n=r[15].name+"")&&xe(i,n);const h={};f&2&&(h.spec=r[15]),!a&&f&3&&(a=!0,h.value=r[0][r[15].name],Ce(()=>a=!1)),s.$set(h)},i(c){u||($(s.$$.fragment,c),u=!0)},o(c){L(s.$$.fragment,c),u=!1},d(c){c&&k(e),x(s)}}}function $l(r){let e,t,n,i,o,s,a,l,u,p,d,c=r[1].description&&ei(r);const f=[yl,vl,bl,gl,_l,ml],h=[];function g(m,v){return v&2&&(t=null),v&2&&(n=null),v&2&&(i=null),v&2&&(o=null),v&2&&(s=null),v&2&&(a=null),t==null&&(t=!!Ui(m[1])),t?0:(n==null&&(n=!!Gi(m[1])),n?1:(i==null&&(i=!!hl(m[1])),i?2:(o==null&&(o=!!Ji(m[1])),o?3:(s==null&&(s=!!Yi(m[1])),s?4:(a==null&&(a=!!Xi(m[1])),a?5:-1)))))}return~(l=g(r,-1))&&(u=h[l]=f[l](r)),{c(){c&&c.c(),e=C(),u&&u.c(),p=de()},m(m,v){c&&c.m(m,v),w(m,e,v),~l&&h[l].m(m,v),w(m,p,v),d=!0},p(m,[v]){m[1].description?c?c.p(m,v):(c=ei(m),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);let _=l;l=g(m,v),l===_?~l&&h[l].p(m,v):(u&&(ae(),L(h[_],1,1,()=>{h[_]=null}),ue()),~l?(u=h[l],u?u.p(m,v):(u=h[l]=f[l](m),u.c()),$(u,1),u.m(p.parentNode,p)):u=null)},i(m){d||($(u),d=!0)},o(m){L(u),d=!1},d(m){c&&c.d(m),m&&k(e),~l&&h[l].d(m),m&&k(p)}}}function Ll(r,e,t){var _,b,y;let{spec:n}=e,{value:i}=e,o="";if(Ui(n)){i||(i={});for(let M of n.members)Ji(M)||Yi(M)?i[_=M.name]||(i[_]=""):Xi(M)?i[b=M.name]||(i[b]=!1):i[y=M.name]||(i[y]={})}else Gi(n)&&(i||(i={}),Hi(i)?o=i:zi(i)?o=i.value:o=Object.keys(i)[0]||"");function s(){t(0,i=o)}function a(){t(0,i={}),t(0,i[o]={},i)}const l=[[]];function u(M,R){r.$$.not_equal(i[R.name],M)&&(i[R.name]=M,t(0,i))}function p(){o=this.__value,t(2,o)}function d(){o=this.__value,t(2,o)}function c(){o=this.__value,t(2,o)}function f(M,R){r.$$.not_equal(i[R.name],M)&&(i[R.name]=M,t(0,i))}function h(){i=Ci(this.value),t(0,i)}function g(){i=this.value,t(0,i)}function m(){i=this.value,t(0,i)}function v(){i=this.checked,t(0,i)}return r.$$set=M=>{"spec"in M&&t(1,n=M.spec),"value"in M&&t(0,i=M.value)},[i,n,o,s,a,u,p,l,d,c,f,h,g,m,v]}class Qt extends K{constructor(e){super(),Z(this,e,Ll,$l,W,{spec:1,value:0})}}function Ol(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].v2!==void 0&&(o.value=r[0].v2),e=new Qt({props:o}),oe.push(()=>Oe(e,"value",i,r[0].v2)),{c(){I(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].v2,Ce(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){x(e,s)}}}function Cl(r,e,t){let{props:n}=e;n.v2||(n.v2={});let i=pl;function o(s){r.$$.not_equal(n.v2,s)&&(n.v2=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Rl extends K{constructor(e){super(),Z(this,e,Cl,Ol,W,{props:0})}}const Al="Planning",Tl=[{name:"name",type:"one-liner"},{name:"notes",type:"textbox"},{name:"reference_type",oneOf:["preapp","outline","reserved matters","local plan"]},{name:"size",type:"number"},{name:"size_units",oneOf:["number of units","floorspace","area"]},{name:"triage",oneOf:["No Comment","Standing Advice","Toolkit Assessment"]},{name:"recommendation",oneOf:["No Comment","No Objection","Standing Advice","Deferral","Approve subject to conditions and/or obligations","Refusal"]}],Pl={name:Al,members:Tl};function Fl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].planning!==void 0&&(o.value=r[0].planning),e=new Qt({props:o}),oe.push(()=>Oe(e,"value",i,r[0].planning)),{c(){I(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].planning,Ce(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){x(e,s)}}}function Il(r,e,t){let{props:n}=e;n.planning||(n.planning={});let i=Pl;function o(s){r.$$.not_equal(n.planning,s)&&(n.planning=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Nl extends K{constructor(e){super(),Z(this,e,Il,Fl,W,{props:0})}}const xl="CriticalIssue",Bl=[{name:"Type",oneOf:[{value:"Conflict with motor traffic at side roads / priority junctions",description:">2500vpd cut across main cycling or walking streams"},{value:"Conflict with motor traffic at signal controlled junctions and roundabouts",description:">2500vpd cut across main cycling or walking streams"},{value:"Collision alongside or from behind",description:"Cyclists are not protected in traffic lanes between 3.25 and 3.9m wide."},{value:"Trip hazard",description:"There are level differences of greater than 20mm with no colour contrast to help identify them."},{value:"Conflict with kerbside activity (parking, loading, risk of 'dooring') ",description:"Cycle facility next to parking/loading with no buffer."},{value:"Kerbside activity or risk of crossing conflict",description:"On busy roads (>8000vpd) formal crossings are more than 400m apart. On quieter roads (<8000vpd), desire lines are blocked by parking and loading."},{value:"Standard of crossing facility",description:"On busy roads (>8000vpd), there are uncontrolled crossings of two or more lanes with no gaps in traffic. At signal junctions there are arms with no green man for pedestrians."},{value:"Speed of traffic (where cyclists are not separated or pedestrians crossing uncontrolled)",description:"85th percentile > 37mph (60kph)"},{value:"Total volume of traffic (where cyclists are not separated or pedestrians cross uncontrolled)",description:">10000 vpd. >5% of traffic is HGVs."},{value:"Required crossing speed (risk of pedestrians coming into conflict with traffic)",description:"Pedestrians must cross at a speed of over 1.2m/s to get across the crossing in time."},{value:"Clear walking spaces free of obstructions and furniture, reducing risk of pedestrians walking in the carriageway.",description:"<1.5m clear footway width. Or, 1.5m-2m clear footway width and pedestrian comfort is poor (PCL of D-E)."},{value:"Effective width next to tram line on a straight run",description:"<2.4m from tramline edge to kerb."},{value:"Crossing angle (between cyclist desire line and tram tracks)",description:"Crossing angle less than 60 degrees."},{value:"Defects: non cycle friendly ironworks, raised/ sunken covers/gullies",description:"Major defects"},{value:"Defects: non flush tables, misleading tactile information, cracked paving, slip-risks present from covers, steep slopes",description:"Major defects"}]},{name:"comment",type:"textbox"},{name:"photographed",type:"checkbox"}],Dl={name:xl,members:Bl};function jl(r){let e,t,n;function i(s){r[2](s)}let o={spec:r[1]};return r[0].criticals!==void 0&&(o.value=r[0].criticals),e=new Qt({props:o}),oe.push(()=>Oe(e,"value",i,r[0].criticals)),{c(){I(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,[a]){const l={};!t&&a&1&&(t=!0,l.value=s[0].criticals,Ce(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){x(e,s)}}}function ql(r,e,t){let{props:n}=e;n.criticals||(n.criticals={});let i=Dl;function o(s){r.$$.not_equal(n.criticals,s)&&(n.criticals=s,t(0,n))}return r.$$set=s=>{"props"in s&&t(0,n=s.props)},[n,i,o]}class Ul extends K{constructor(e){super(),Z(this,e,ql,jl,W,{props:0})}}function ii(r){let e,t,n,i,o;const s=r[10].default,a=yt(s,r,r[9],null);return{c(){e=E("div"),a&&a.c(),le(e,"border","solid 1px black"),le(e,"padding","10px")},m(l,u){w(l,e,u),a&&a.m(e,null),r[13](e),n=!0,i||(o=U(e,"introend",r[14]),i=!0)},p(l,u){a&&a.p&&(!n||u&512)&&wt(a,s,l,l[9],n?St(s,l[9],u,null):kt(l[9]),null)},i(l){n||($(a,l),at(()=>{t||(t=$t(e,Ot,{duration:100},!0)),t.run(1)}),n=!0)},o(l){L(a,l),t||(t=$t(e,Ot,{duration:100},!1)),t.run(0),n=!1},d(l){l&&k(e),a&&a.d(l),r[13](null),l&&t&&t.end(),i=!1,o()}}}function Gl(r){let e,t,n,i,o,s,a,l,u,p,d=r[4]&&ii(r);return{c(){e=E("button"),t=_n("svg"),n=_n("path"),i=C(),o=X(r[1]),s=C(),d&&d.c(),a=de(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-t7fpgu"),O(e,"aria-expanded",r[4]),O(e,"class","svelte-t7fpgu"),Lr(e,"underlined",r[3])},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,i),S(e,o),w(c,s,f),d&&d.m(c,f),w(c,a,f),l=!0,u||(p=[U(e,"click",r[5]),U(e,"mouseenter",r[11]),U(e,"mouseleave",r[12])],u=!0)},p(c,[f]){(!l||f&2)&&xe(o,c[1]),(!l||f&16)&&O(e,"aria-expanded",c[4]),(!l||f&8)&&Lr(e,"underlined",c[3]),c[4]?d?(d.p(c,f),f&16&&$(d,1)):(d=ii(c),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(ae(),L(d,1,1,()=>{d=null}),ue())},i(c){l||($(d),l=!0)},o(c){L(d),l=!1},d(c){c&&k(e),c&&k(s),d&&d.d(c),c&&k(a),u=!1,Fe(p)}}}function Hl(r,e,t){let n,i,o,s;te(r,Ge,_=>t(7,o=_)),te(r,$e,_=>t(8,s=_));let{$$slots:a={},$$scope:l}=e,{id:u}=e,{label:p}=e;const d=()=>{$e.update(_=>_==u?null:u),s==u&&(Yt.set(null),Yt.set(u))};let c;function f(){c==null||c.scrollIntoView({behavior:"smooth"})}const h=()=>Jt.set(u),g=()=>Jt.set(null);function m(_){oe[_?"unshift":"push"](()=>{c=_,t(2,c)})}const v=()=>f();return r.$$set=_=>{"id"in _&&t(0,u=_.id),"label"in _&&t(1,p=_.label),"$$scope"in _&&t(9,l=_.$$scope)},r.$$.update=()=>{r.$$.dirty&257&&t(4,n=s==u),r.$$.dirty&129&&t(3,i=o==u)},[u,p,c,i,n,d,f,o,s,l,a,h,g,m,v]}class zl extends K{constructor(e){super(),Z(this,e,Hl,Gl,W,{id:0,label:1})}}function oi(r,e,t){const n=r.slice();return n[13]=e[t],n[14]=e,n[15]=t,n}function Jl(r){let e,t,n;function i(s){r[9](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Ul({props:o}),oe.push(()=>Oe(e,"props",i,r[13].properties)),{c(){I(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,Ce(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){x(e,s)}}}function Yl(r){let e,t,n;function i(s){r[8](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Nl({props:o}),oe.push(()=>Oe(e,"props",i,r[13].properties)),{c(){I(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,Ce(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){x(e,s)}}}function Xl(r){let e,t,n;function i(s){r[7](s,r[13])}let o={};return r[13].properties!==void 0&&(o.props=r[13].properties),e=new Rl({props:o}),oe.push(()=>Oe(e,"props",i,r[13].properties)),{c(){I(e.$$.fragment)},m(s,a){N(e,s,a),n=!0},p(s,a){r=s;const l={};!t&&a&2&&(t=!0,l.props=r[13].properties,Ce(()=>t=!1)),e.$set(l)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){x(e,s)}}}function Wl(r){let e,t,n,i,o;function s(p){r[4](p,r[13])}function a(p){r[5](p,r[13])}function l(p){r[6](p,r[13])}let u={id:r[13].id,length_meters:r[13].properties.length_meters};return r[13].properties.name!==void 0&&(u.name=r[13].properties.name),r[13].properties.intervention_type!==void 0&&(u.intervention_type=r[13].properties.intervention_type),r[13].properties.description!==void 0&&(u.description=r[13].properties.description),e=new ul({props:u}),oe.push(()=>Oe(e,"name",s,r[13].properties.name)),oe.push(()=>Oe(e,"intervention_type",a,r[13].properties.intervention_type)),oe.push(()=>Oe(e,"description",l,r[13].properties.description)),{c(){I(e.$$.fragment)},m(p,d){N(e,p,d),o=!0},p(p,d){r=p;const c={};d&2&&(c.id=r[13].id),d&2&&(c.length_meters=r[13].properties.length_meters),!t&&d&2&&(t=!0,c.name=r[13].properties.name,Ce(()=>t=!1)),!n&&d&2&&(n=!0,c.intervention_type=r[13].properties.intervention_type,Ce(()=>n=!1)),!i&&d&2&&(i=!0,c.description=r[13].properties.description,Ce(()=>i=!1)),e.$set(c)},i(p){o||($(e.$$.fragment,p),o=!0)},o(p){L(e.$$.fragment,p),o=!1},d(p){x(e,p)}}}function Vl(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,h,g;const m=[Wl,Xl,Yl,Jl],v=[];function _(y,M){return y[0]=="v1"?0:y[0]=="v2"?1:y[0]=="planning"?2:y[0]=="criticals"?3:-1}~(e=_(r))&&(t=v[e]=m[e](r));function b(){return r[10](r[13])}return{c(){t&&t.c(),n=C(),i=E("br"),o=C(),s=E("br"),a=C(),l=E("div"),u=E("button"),u.textContent="Delete",p=C(),d=E("button"),d.textContent="Save",c=C(),O(u,"type","button"),O(d,"type","button"),le(l,"display","flex"),le(l,"justify-content","space-between")},m(y,M){~e&&v[e].m(y,M),w(y,n,M),w(y,i,M),w(y,o,M),w(y,s,M),w(y,a,M),w(y,l,M),S(l,u),S(l,p),S(l,d),w(y,c,M),f=!0,h||(g=[U(u,"click",b),U(d,"click",r[11])],h=!0)},p(y,M){r=y;let R=e;e=_(r),e===R?~e&&v[e].p(r,M):(t&&(ae(),L(v[R],1,1,()=>{v[R]=null}),ue()),~e?(t=v[e],t?t.p(r,M):(t=v[e]=m[e](r),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(y){f||($(t),f=!0)},o(y){L(t),f=!1},d(y){~e&&v[e].d(y),y&&k(n),y&&k(i),y&&k(o),y&&k(s),y&&k(a),y&&k(l),y&&k(c),h=!1,Fe(g)}}}function si(r,e){let t,n,i;return n=new zl({props:{id:e[13].id,label:e[15]+1+") "+e[2](e[13]),$$slots:{default:[Vl]},$$scope:{ctx:e}}}),{key:r,first:null,c(){t=de(),I(n.$$.fragment),this.first=t},m(o,s){w(o,t,s),N(n,o,s),i=!0},p(o,s){e=o;const a={};s&2&&(a.id=e[13].id),s&2&&(a.label=e[15]+1+") "+e[2](e[13])),s&65539&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){L(n.$$.fragment,o),i=!1},d(o){o&&k(t),x(n,o)}}}function Kl(r){let e=[],t=new Map,n,i,o,s,a=r[1].features;const l=u=>u[13].id;for(let u=0;u<a.length;u+=1){let p=oi(r,a,u),d=l(p);t.set(d,e[u]=si(d,p))}return{c(){for(let u=0;u<e.length;u+=1)e[u].c();n=de()},m(u,p){for(let d=0;d<e.length;d+=1)e[d].m(u,p);w(u,n,p),i=!0,o||(s=U(window,"keydown",r[3]),o=!0)},p(u,[p]){p&7&&(a=u[1].features,ae(),e=ko(e,p,l,1,u,a,t,n.parentNode,So,si,n,oi),ue())},i(u){if(!i){for(let p=0;p<a.length;p+=1)$(e[p]);i=!0}},o(u){for(let p=0;p<e.length;p+=1)L(e[p]);i=!1},d(u){for(let p=0;p<e.length;p+=1)e[p].d(u);u&&k(n),o=!1,s()}}}function Zl(r,e,t){let n,i;te(r,$e,m=>t(12,n=m)),te(r,ne,m=>t(1,i=m));let{schema:o}=e;function s(m){var _,b,y,M,R;if(o=="planning")return((_=m.properties.planning)==null?void 0:_.name)||"Untitled polygon";if(o=="v2")return((y=(b=m.properties.v2)==null?void 0:b.Route)==null?void 0:y.name)||((R=(M=m.properties.v2)==null?void 0:M.Crossing)==null?void 0:R.name)||"Untitled intervention";if(m.properties.name)return m.properties.name;var v=m.properties.intervention_type;return v=="other"&&(m.geometry.type=="Point"?v="point":m.geometry.type=="LineString"?v="line":v="polygon"),`Untitled ${v}`}function a(m){if(m.key=="Delete"){const v=m.target.tagName;if(v=="INPUT"||v=="TEXTAREA")return;m.preventDefault();const _=n;_&&Cr(_)}}function l(m,v){r.$$.not_equal(v.properties.name,m)&&(v.properties.name=m,ne.set(i))}function u(m,v){r.$$.not_equal(v.properties.intervention_type,m)&&(v.properties.intervention_type=m,ne.set(i))}function p(m,v){r.$$.not_equal(v.properties.description,m)&&(v.properties.description=m,ne.set(i))}function d(m,v){r.$$.not_equal(v.properties,m)&&(v.properties=m,ne.set(i))}function c(m,v){r.$$.not_equal(v.properties,m)&&(v.properties=m,ne.set(i))}function f(m,v){r.$$.not_equal(v.properties,m)&&(v.properties=m,ne.set(i))}const h=m=>Cr(m.id),g=()=>$e.set(null);return r.$$set=m=>{"schema"in m&&t(0,o=m.schema)},[o,i,s,a,l,u,p,d,c,f,h,g]}class Ql extends K{constructor(e){super(),Z(this,e,Zl,Kl,W,{schema:0})}}function li(r){let e,t;return e=new qi({props:{id:void 0}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p:H,i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function ea(r){let e,t,n,i,o,s,a,l,u,p,d,c=r[1]=="speed limits"&&li();return{c(){e=E("label"),t=X(`Show layer:
  `),n=E("select"),i=E("option"),i.textContent="None",o=E("option"),o.textContent="Speed limits",a=C(),c&&c.c(),l=de(),i.__value="none",i.value=i.__value,o.__value="speed limits",o.value=o.__value,n.disabled=s=r[0]!=null,r[1]===void 0&&at(()=>r[2].call(n))},m(f,h){w(f,e,h),S(e,t),S(e,n),S(n,i),S(n,o),nt(n,r[1]),w(f,a,h),c&&c.m(f,h),w(f,l,h),u=!0,p||(d=U(n,"change",r[2]),p=!0)},p(f,[h]){(!u||h&1&&s!==(s=f[0]!=null))&&(n.disabled=s),h&2&&nt(n,f[1]),f[1]=="speed limits"?c?(c.p(f,h),h&2&&$(c,1)):(c=li(),c.c(),$(c,1),c.m(l.parentNode,l)):c&&(ae(),L(c,1,1,()=>{c=null}),ue())},i(f){u||($(c),u=!0)},o(f){L(c),u=!1},d(f){f&&k(e),f&&k(a),c&&c.d(f),f&&k(l),p=!1,d()}}}function ta(r,e,t){let n;te(r,$e,s=>t(0,n=s));let i="none";function o(){i=Cn(this),t(1,i),t(0,n)}return r.$$.update=()=>{r.$$.dirty&1&&n&&t(1,i="none")},[n,i,o]}class na extends K{constructor(e){super(),Z(this,e,ta,ea,W,{})}}function tt(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function He(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function nr(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function Ve(r,e,t){t===void 0&&(t={});var n=tt(r),i=tt(e),o=De(i[1]-n[1]),s=De(i[0]-n[0]),a=De(n[1]),l=De(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return Eo(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function un(r,e){return e===void 0&&(e={}),Mo(r,function(t,n){var i=n.geometry.coordinates;return t+Ve(i[0],i[1],e)},0)}function ra(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,h,g,m,v,_,b,y=r[0].features.length+"",M,R,T,A,B,D,G,F;return{c(){e=E("div"),t=E("label"),n=X(`Scheme name:
    `),i=E("input"),o=C(),s=E("br"),a=C(),l=E("div"),u=E("label"),p=E("input"),d=C(),c=E("button"),c.textContent="Load from GeoJSON",f=C(),h=E("button"),h.textContent="Export to GeoJSON",g=C(),m=E("br"),v=C(),_=E("div"),b=E("span"),M=X(y),R=X(" objects"),T=C(),A=E("button"),B=X("Clear all"),O(i,"type","text"),O(p,"type","file"),O(p,"id","load_geojson"),O(p,"class","svelte-lhyd1e"),O(c,"type","button"),O(h,"type","button"),O(h,"class","align-right svelte-lhyd1e"),O(A,"type","button"),O(A,"class","align-right svelte-lhyd1e"),A.disabled=D=r[0].features.length==0},m(P,J){w(P,e,J),S(e,t),S(t,n),S(t,i),Ne(i,r[0].scheme_name),w(P,o,J),w(P,s,J),w(P,a,J),w(P,l,J),S(l,u),S(u,p),S(u,d),S(u,c),S(l,f),S(l,h),w(P,g,J),w(P,m,J),w(P,v,J),w(P,_,J),S(_,b),S(b,M),S(b,R),S(_,T),S(_,A),S(A,B),G||(F=[U(i,"input",r[8]),U(p,"change",r[3]),U(c,"click",oa),U(h,"click",r[2]),U(A,"click",r[1])],G=!0)},p(P,[J]){J&1&&i.value!==P[0].scheme_name&&Ne(i,P[0].scheme_name),J&1&&y!==(y=P[0].features.length+"")&&xe(M,y),J&1&&D!==(D=P[0].features.length==0)&&(A.disabled=D)},i:H,o:H,d(P){P&&k(e),P&&k(o),P&&k(s),P&&k(a),P&&k(l),P&&k(g),P&&k(m),P&&k(v),P&&k(_),G=!1,Fe(F)}}}function ia(r,e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function oa(){document.getElementById("load_geojson").click()}function sa(r,e,t){let n;te(r,ne,h=>t(0,n=h));let{authorityName:i}=e,{schema:o}=e,s=i;o!="v1"&&(s+=`_${o}`);let a=!1;Kt(async()=>{let g=new URLSearchParams(window.location.search).get("geojsonUrl"),m=window.localStorage.getItem(s);if(g){console.log(`Loading GeoJSON from ${g}`);try{let _=await(await fetch(g)).text();ne.set(c(JSON.parse(_)))}catch(v){console.log(`Failed to load from URL: ${v}`)}}else if(m)try{ne.set(c(JSON.parse(m)))}catch(v){console.log(`Failed to load from local storage: ${v}`)}t(7,a=!0)});function l(){confirm("Do you want to clear the current scheme? (You should save it first!)")&&(ne.update(h=>(delete h.scheme_name,h.features=[],h)),$e.set(null),Ge.set(null),Jt.set(null),Yt.set(null))}function u(){const h=JSON.parse(JSON.stringify(n));for(let g of h.features)delete g.properties.hide_while_editing;return h}function p(){let h=u();var g=s;h.authority=i,h.origin="atip-v1",h.scheme_name&&(g+="_"+h.scheme_name),g+=".txt",ia(g,JSON.stringify(h,null,"  "))}function d(h){const g=new FileReader;g.onload=v=>{try{ne.set(c(JSON.parse(v.target.result)))}catch(_){window.alert(`Couldn't load scheme from a file: ${_}`)}};let m=h.target.files;g.readAsText(m[0])}function c(h){let g=1;for(let m of h.features)m.properties||(m.properties={name:"",description:"",intervention_type:"other"}),m.geometry.type=="LineString"&&!m.properties.length_meters&&(m.properties.length_meters=un(m,{units:"kilometers"})*1e3),m.id=g++;return h}function f(){n.scheme_name=this.value,ne.set(n)}return r.$$set=h=>{"authorityName"in h&&t(4,i=h.authorityName),"schema"in h&&t(5,o=h.schema)},r.$$.update=()=>{r.$$.dirty&193&&a&&n&&(console.log("GJ changed, saving to local storage"),window.localStorage.setItem(s,JSON.stringify(u())))},[n,l,p,d,i,o,s,a,f]}class la extends K{constructor(e){super(),Z(this,e,sa,ra,W,{authorityName:4,schema:5})}}const aa="/atip/streetview/assets/zoom_out_map-b2e1091a.svg";function ua(r){let e,t,n,i,o;return{c(){e=E("button"),t=E("img"),mn(t.src,n=aa)||O(t,"src",n),O(t,"alt","Zoom to show entire boundary"),O(e,"type","button"),O(e,"title","Zoom to show entire boundary"),O(e,"class","svelte-qzjsqo")},m(s,a){w(s,e,a),S(e,t),i||(o=U(e,"click",r[0]),i=!0)},p:H,i:H,o:H,d(s){s&&k(e),i=!1,o()}}}function fa(r,e,t){let n;te(r,Ie,s=>t(2,n=s));let{boundaryGeojson:i}=e;function o(){n.fitBounds(ur(i),{padding:20,animate:!0,duration:500})}return r.$$set=s=>{"boundaryGeojson"in s&&t(1,i=s.boundaryGeojson)},[o,i]}class ca extends K{constructor(e){super(),Z(this,e,fa,ua,W,{boundaryGeojson:1})}}function pa(r){let e,t,n,i,o,s,a;return{c(){e=E("div"),t=X(`Basemap:
  `),n=E("select"),i=E("option"),i.textContent="Streets",o=E("option"),o.textContent="Satellite",i.__value="streets",i.value=i.__value,o.__value="hybrid",o.value=o.__value,r[0]===void 0&&at(()=>r[2].call(n)),O(e,"class","svelte-1tbnm6i")},m(l,u){w(l,e,u),S(e,t),S(e,n),S(n,i),S(n,o),nt(n,r[0]),s||(a=[U(n,"change",r[2]),U(n,"change",r[1])],s=!0)},p(l,[u]){u&1&&nt(n,l[0])},i:H,o:H,d(l){l&&k(e),s=!1,Fe(a)}}}function da(r,e,t){let{style:n}=e;function i(){let s=new URLSearchParams(window.location.search);s.set("style",n);let a=`${window.location.pathname}?${s.toString()}${window.location.hash}`;window.location.href=a}function o(){n=Cn(this),t(0,n)}return r.$$set=s=>{"style"in s&&t(0,n=s.style)},[n,i,o]}class ha extends K{constructor(e){super(),Z(this,e,da,pa,W,{style:0})}}function ai(r){let e,t,n;const i=r[3].default,o=yt(i,r,r[2],null);return{c(){e=E("div"),o&&o.c()},m(s,a){w(s,e,a),o&&o.m(e,null),n=!0},p(s,a){o&&o.p&&(!n||a&4)&&wt(o,i,s,s[2],n?St(i,s[2],a,null):kt(s[2]),null)},i(s){n||($(o,s),at(()=>{t||(t=$t(e,Ot,{duration:100},!0)),t.run(1)}),n=!0)},o(s){L(o,s),t||(t=$t(e,Ot,{duration:100},!1)),t.run(0),n=!1},d(s){s&&k(e),o&&o.d(s),s&&t&&t.end()}}}function ma(r){let e,t,n,i,o,s,a,l,u,p,d=r[0]&&ai(r);return{c(){e=E("button"),t=_n("svg"),n=_n("path"),i=C(),o=X(r[1]),s=C(),d&&d.c(),a=de(),O(n,"d","M9 5l7 7-7 7"),O(t,"style","tran"),O(t,"width","20"),O(t,"height","20"),O(t,"fill","none"),O(t,"stroke-linecap","round"),O(t,"stroke-linejoin","round"),O(t,"stroke-width","2"),O(t,"viewBox","0 0 24 24"),O(t,"stroke","currentColor"),O(t,"class","svelte-una9lq"),O(e,"aria-expanded",r[0]),O(e,"class","svelte-una9lq")},m(c,f){w(c,e,f),S(e,t),S(t,n),S(e,i),S(e,o),w(c,s,f),d&&d.m(c,f),w(c,a,f),l=!0,u||(p=U(e,"click",r[4]),u=!0)},p(c,[f]){(!l||f&2)&&xe(o,c[1]),(!l||f&1)&&O(e,"aria-expanded",c[0]),c[0]?d?(d.p(c,f),f&1&&$(d,1)):(d=ai(c),d.c(),$(d,1),d.m(a.parentNode,a)):d&&(ae(),L(d,1,1,()=>{d=null}),ue())},i(c){l||($(d),l=!0)},o(c){L(d),l=!1},d(c){c&&k(e),c&&k(s),d&&d.d(c),c&&k(a),u=!1,p()}}}function _a(r,e,t){let{$$slots:n={},$$scope:i}=e,{label:o}=e,{open:s=!1}=e;const a=()=>t(0,s=!s);return r.$$set=l=>{"label"in l&&t(1,o=l.label),"open"in l&&t(0,s=l.open),"$$scope"in l&&t(2,i=l.$$scope)},[s,o,i,n,a]}class Fn extends K{constructor(e){super(),Z(this,e,_a,ma,W,{label:1,open:0})}}function ga(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,h,g;return{c(){e=E("li"),t=E("span"),n=X("Areas"),i=C(),o=E("li"),s=E("span"),a=X("Routes"),l=C(),u=E("li"),p=E("span"),d=X("Crossings"),c=C(),f=E("li"),h=E("span"),g=X("Other"),O(t,"class","svelte-l42ea0"),le(t,"background",pe.area),O(s,"class","svelte-l42ea0"),le(s,"background",pe.route),O(p,"class","svelte-l42ea0"),le(p,"background",pe.crossing),O(h,"class","svelte-l42ea0"),le(h,"background",pe.other)},m(m,v){w(m,e,v),S(e,t),S(e,n),w(m,i,v),w(m,o,v),S(o,s),S(o,a),w(m,l,v),w(m,u,v),S(u,p),S(u,d),w(m,c,v),w(m,f,v),S(f,h),S(f,g)},p:H,d(m){m&&k(e),m&&k(i),m&&k(o),m&&k(l),m&&k(u),m&&k(c),m&&k(f)}}}function ba(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,h,g;return{c(){e=E("li"),t=E("span"),n=X("Preapp"),i=C(),o=E("li"),s=E("span"),a=X("Outline"),l=C(),u=E("li"),p=E("span"),d=X("Reserved matters"),c=C(),f=E("li"),h=E("span"),g=X("Local plan"),O(t,"class","svelte-l42ea0"),le(t,"background",pe.preapp),O(s,"class","svelte-l42ea0"),le(s,"background",pe.outline),O(p,"class","svelte-l42ea0"),le(p,"background",pe["reserved matters"]),O(h,"class","svelte-l42ea0"),le(h,"background",pe["local plan"])},m(m,v){w(m,e,v),S(e,t),S(e,n),w(m,i,v),w(m,o,v),S(o,s),S(o,a),w(m,l,v),w(m,u,v),S(u,p),S(u,d),w(m,c,v),w(m,f,v),S(f,h),S(f,g)},p:H,d(m){m&&k(e),m&&k(i),m&&k(o),m&&k(l),m&&k(u),m&&k(c),m&&k(f)}}}function va(r){let e;function t(o,s){return o[0]=="planning"?ba:ga}let n=t(r),i=n(r);return{c(){e=E("ul"),i.c()},m(o,s){w(o,e,s),i.m(e,null)},p(o,s){n===(n=t(o))&&i?i.p(o,s):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&k(e),i.d()}}}function ya(r){let e,t,n;return t=new Fn({props:{label:"Objects",open:!0,$$slots:{default:[va]},$$scope:{ctx:r}}}),{c(){e=E("div"),I(t.$$.fragment),O(e,"class","svelte-l42ea0")},m(i,o){w(i,e,o),N(t,e,null),n=!0},p(i,[o]){const s={};o&3&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){L(t.$$.fragment,i),n=!1},d(i){i&&k(e),x(t)}}}function wa(r,e,t){let{schema:n}=e;return r.$$set=i=>{"schema"in i&&t(0,n=i.schema)},[n]}class ka extends K{constructor(e){super(),Z(this,e,wa,ya,W,{schema:0})}}let dt="interventions";function Sa(r,e,t){let n,i;te(r,Ie,p=>t(1,n=p)),te(r,ne,p=>t(2,i=p));let{schema:o}=e;Xe(n,dt,i);const s=["match",["get","intervention_type"],"area",pe.area,"route",pe.route,"crossing",pe.crossing,"other",pe.other,"white"],a=["match",["get","reference_type",["get","planning"]],"preapp",pe.preapp,"outline",pe.outline,"reserved matters",pe["reserved matters"],"local plan",pe["local plan"],"white"],l=["!=","hide_while_editing",!0];return ke(n,{id:"interventions-points",source:dt,filter:["all",Rn,l,["!=","endpoint",!0]],...ut(s,Pn)}),ke(n,{id:"interventions-lines",source:dt,filter:["all",An,l],...Mt(s,Wt)}),ke(n,{id:"interventions-lines-endpoints",source:dt,filter:["==","endpoint",!0],type:"circle",paint:{"circle-radius":.5*Wt,"circle-opacity":0,"circle-stroke-color":pe.lineEndpointColor,"circle-stroke-width":2}}),ke(n,{id:"interventions-polygons",source:dt,filter:["all",Tn,l],...On(o=="planning"?a:s,.5)}),r.$$set=p=>{"schema"in p&&t(0,o=p.schema)},r.$$.update=()=>{if(r.$$.dirty&6){let p=JSON.parse(JSON.stringify(i)),d=[];for(let c of p.features)if(c.geometry.type=="LineString")for(let f of[c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])d.push({type:"Feature",properties:{endpoint:!0},geometry:{type:"Point",coordinates:f}});p.features=p.features.concat(d),n.getSource(dt).setData(p)}},[o,n,i]}class Ea extends K{constructor(e){super(),Z(this,e,Sa,null,W,{schema:0})}}let ht="hover";function Ma(r,e,t){let n,i,o,s,a;return te(r,Ie,l=>t(0,n=l)),te(r,ne,l=>t(1,i=l)),te(r,Jt,l=>t(2,o=l)),te(r,Ge,l=>t(3,s=l)),te(r,$e,l=>t(4,a=l)),Xe(n,ht,Pe()),ke(n,{id:"hover-polygons",source:ht,filter:Tn,...Mt(pe.hovering,.5*Wt,1)}),ke(n,{id:"hover-lines",source:ht,filter:An,...Mt(pe.hovering,1.5*Wt,1)}),ke(n,{id:"hover-points",source:ht,filter:Rn,...ut(pe.hovering,1.5*Pn,1)}),r.$$.update=()=>{if(r.$$.dirty&31){let l=a||s||o;l!=null?n.getSource(ht).setData(i.features.find(u=>u.id==l)):n.getSource(ht).setData(Pe())}},[n,i,o,s,a]}class $a extends K{constructor(e){super(),Z(this,e,Ma,null,W,{})}}class hr{constructor(e,t){re(this,"owner");re(this,"map");re(this,"mapHandlers",{});re(this,"documentHandlers",{});this.owner=e,this.map=t,this.mapHandlers={},this.documentHandlers={}}mapHandler(e,t){let n=t.bind(this.owner);this.mapHandlers[e]=n,this.map.on(e,n)}documentHandler(e,t){let n=t.bind(this.owner);this.documentHandlers[e]=n,document.addEventListener(e,n)}tearDown(){for(let[e,t]of Object.entries(this.mapHandlers))this.map.off(e,t);this.mapHandlers={};for(let[e,t]of Object.entries(this.documentHandlers))document.removeEventListener(e,t);this.documentHandlers={}}}const nn="edit-point-mode";class La{constructor(e){re(this,"map");re(this,"active");re(this,"eventListenersSuccess");re(this,"eventListenersFailure");re(this,"cursor");re(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.cursor=null,this.events=new hr(this,e),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousemove",this.onMouseMove),Xe(e,nn,Pe()),ke(e,{id:"edit-point-mode",source:nn,...ut(pe.hovering,Pn,1)})}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){this.active&&(this.cursor=Oa(e.lngLat.toArray()),this.redraw())}onClick(){if(this.active&&this.cursor){for(let e of this.eventListenersSuccess)e(this.cursor);this.stop()}}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-point-mode"),this.map.removeSource(nn),this.events.tearDown()}start(){this.active=!0}stop(){this.cursor=null,this.active=!1,this.redraw()}redraw(){let e=Pe();this.cursor&&e.features.push(this.cursor),this.map.getSource(nn).setData(e)}}function Oa(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function Wi(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Ca(r,e);var n=tt(r),i=tt(e),o=De(n[0]),s=De(i[0]),a=De(n[1]),l=De(i[1]),u=Math.sin(s-o)*Math.cos(l),p=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return Jn(Math.atan2(u,p))}function Ca(r,e){var t=Wi(e,r);return t=(t+180)%360,t}function ui(r,e,t,n){n===void 0&&(n={});var i=tt(r),o=De(i[0]),s=De(i[1]),a=De(t),l=$o(e,n.units),u=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a)),p=o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(u)),d=Jn(p),c=Jn(u);return Et([d,c],n.properties)}function rr(r){if(!r)throw new Error("geojson is required");var e=[];return fr(r,function(t){Ra(t,e)}),et(e)}function Ra(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=He(n);break;case"LineString":t=[He(n)]}t.forEach(function(i){var o=Aa(i,r.properties);o.forEach(function(s){s.id=e.length,e.push(s)})})}}function Aa(r,e){var t=[];return r.reduce(function(n,i){var o=Lt([n,i],e);return o.bbox=Ta(n,i),t.push(o),i}),t}function Ta(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],s=t<i?t:i,a=n<o?n:o,l=t>i?t:i,u=n>o?n:o;return[s,a,l,u]}var Ct={},Pa={get exports(){return Ct},set exports(r){Ct=r}},ir={},Fa={get exports(){return ir},set exports(r){ir=r}};(function(r,e){(function(t,n){r.exports=n()})(Lo,function(){function t(_,b,y,M,R){(function T(A,B,D,G,F){for(;G>D;){if(G-D>600){var P=G-D+1,J=B-D+1,ie=Math.log(P),Ae=.5*Math.exp(2*ie/3),Le=.5*Math.sqrt(ie*Ae*(P-Ae)/P)*(J-P/2<0?-1:1),Se=Math.max(D,Math.floor(B-J*Ae/P+Le)),Te=Math.min(G,Math.floor(B+(P-J)*Ae/P+Le));T(A,B,Se,Te,F)}var Ee=A[B],Me=D,ge=G;for(n(A,D,B),F(A[G],Ee)>0&&n(A,D,G);Me<ge;){for(n(A,Me,ge),Me++,ge--;F(A[Me],Ee)<0;)Me++;for(;F(A[ge],Ee)>0;)ge--}F(A[D],Ee)===0?n(A,D,ge):n(A,++ge,G),ge<=B&&(D=ge+1),B<=ge&&(G=ge-1)}})(_,b,y||0,M||_.length-1,R||i)}function n(_,b,y){var M=_[b];_[b]=_[y],_[y]=M}function i(_,b){return _<b?-1:_>b?1:0}var o=function(_){_===void 0&&(_=9),this._maxEntries=Math.max(4,_),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(_,b,y){if(!y)return b.indexOf(_);for(var M=0;M<b.length;M++)if(y(_,b[M]))return M;return-1}function a(_,b){l(_,0,_.children.length,b,_)}function l(_,b,y,M,R){R||(R=m(null)),R.minX=1/0,R.minY=1/0,R.maxX=-1/0,R.maxY=-1/0;for(var T=b;T<y;T++){var A=_.children[T];u(R,_.leaf?M(A):A)}return R}function u(_,b){return _.minX=Math.min(_.minX,b.minX),_.minY=Math.min(_.minY,b.minY),_.maxX=Math.max(_.maxX,b.maxX),_.maxY=Math.max(_.maxY,b.maxY),_}function p(_,b){return _.minX-b.minX}function d(_,b){return _.minY-b.minY}function c(_){return(_.maxX-_.minX)*(_.maxY-_.minY)}function f(_){return _.maxX-_.minX+(_.maxY-_.minY)}function h(_,b){return _.minX<=b.minX&&_.minY<=b.minY&&b.maxX<=_.maxX&&b.maxY<=_.maxY}function g(_,b){return b.minX<=_.maxX&&b.minY<=_.maxY&&b.maxX>=_.minX&&b.maxY>=_.minY}function m(_){return{children:_,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(_,b,y,M,R){for(var T=[b,y];T.length;)if(!((y=T.pop())-(b=T.pop())<=M)){var A=b+Math.ceil((y-b)/M/2)*M;t(_,A,b,y,R),T.push(b,A,A,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(_){var b=this.data,y=[];if(!g(_,b))return y;for(var M=this.toBBox,R=[];b;){for(var T=0;T<b.children.length;T++){var A=b.children[T],B=b.leaf?M(A):A;g(_,B)&&(b.leaf?y.push(A):h(_,B)?this._all(A,y):R.push(A))}b=R.pop()}return y},o.prototype.collides=function(_){var b=this.data;if(!g(_,b))return!1;for(var y=[];b;){for(var M=0;M<b.children.length;M++){var R=b.children[M],T=b.leaf?this.toBBox(R):R;if(g(_,T)){if(b.leaf||h(_,T))return!0;y.push(R)}}b=y.pop()}return!1},o.prototype.load=function(_){if(!_||!_.length)return this;if(_.length<this._minEntries){for(var b=0;b<_.length;b++)this.insert(_[b]);return this}var y=this._build(_.slice(),0,_.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var M=this.data;this.data=y,y=M}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(_){return _&&this._insert(_,this.data.height-1),this},o.prototype.clear=function(){return this.data=m([]),this},o.prototype.remove=function(_,b){if(!_)return this;for(var y,M,R,T=this.data,A=this.toBBox(_),B=[],D=[];T||B.length;){if(T||(T=B.pop(),M=B[B.length-1],y=D.pop(),R=!0),T.leaf){var G=s(_,T.children,b);if(G!==-1)return T.children.splice(G,1),B.push(T),this._condense(B),this}R||T.leaf||!h(T,A)?M?(y++,T=M.children[y],R=!1):T=null:(B.push(T),D.push(y),y=0,M=T,T=T.children[0])}return this},o.prototype.toBBox=function(_){return _},o.prototype.compareMinX=function(_,b){return _.minX-b.minX},o.prototype.compareMinY=function(_,b){return _.minY-b.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(_){return this.data=_,this},o.prototype._all=function(_,b){for(var y=[];_;)_.leaf?b.push.apply(b,_.children):y.push.apply(y,_.children),_=y.pop();return b},o.prototype._build=function(_,b,y,M){var R,T=y-b+1,A=this._maxEntries;if(T<=A)return a(R=m(_.slice(b,y+1)),this.toBBox),R;M||(M=Math.ceil(Math.log(T)/Math.log(A)),A=Math.ceil(T/Math.pow(A,M-1))),(R=m([])).leaf=!1,R.height=M;var B=Math.ceil(T/A),D=B*Math.ceil(Math.sqrt(A));v(_,b,y,D,this.compareMinX);for(var G=b;G<=y;G+=D){var F=Math.min(G+D-1,y);v(_,G,F,B,this.compareMinY);for(var P=G;P<=F;P+=B){var J=Math.min(P+B-1,F);R.children.push(this._build(_,P,J,M-1))}}return a(R,this.toBBox),R},o.prototype._chooseSubtree=function(_,b,y,M){for(;M.push(b),!b.leaf&&M.length-1!==y;){for(var R=1/0,T=1/0,A=void 0,B=0;B<b.children.length;B++){var D=b.children[B],G=c(D),F=(P=_,J=D,(Math.max(J.maxX,P.maxX)-Math.min(J.minX,P.minX))*(Math.max(J.maxY,P.maxY)-Math.min(J.minY,P.minY))-G);F<T?(T=F,R=G<R?G:R,A=D):F===T&&G<R&&(R=G,A=D)}b=A||b.children[0]}var P,J;return b},o.prototype._insert=function(_,b,y){var M=y?_:this.toBBox(_),R=[],T=this._chooseSubtree(M,this.data,b,R);for(T.children.push(_),u(T,M);b>=0&&R[b].children.length>this._maxEntries;)this._split(R,b),b--;this._adjustParentBBoxes(M,R,b)},o.prototype._split=function(_,b){var y=_[b],M=y.children.length,R=this._minEntries;this._chooseSplitAxis(y,R,M);var T=this._chooseSplitIndex(y,R,M),A=m(y.children.splice(T,y.children.length-T));A.height=y.height,A.leaf=y.leaf,a(y,this.toBBox),a(A,this.toBBox),b?_[b-1].children.push(A):this._splitRoot(y,A)},o.prototype._splitRoot=function(_,b){this.data=m([_,b]),this.data.height=_.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(_,b,y){for(var M,R,T,A,B,D,G,F=1/0,P=1/0,J=b;J<=y-b;J++){var ie=l(_,0,J,this.toBBox),Ae=l(_,J,y,this.toBBox),Le=(R=ie,T=Ae,A=void 0,B=void 0,D=void 0,G=void 0,A=Math.max(R.minX,T.minX),B=Math.max(R.minY,T.minY),D=Math.min(R.maxX,T.maxX),G=Math.min(R.maxY,T.maxY),Math.max(0,D-A)*Math.max(0,G-B)),Se=c(ie)+c(Ae);Le<F?(F=Le,M=J,P=Se<P?Se:P):Le===F&&Se<P&&(P=Se,M=J)}return M||y-b},o.prototype._chooseSplitAxis=function(_,b,y){var M=_.leaf?this.compareMinX:p,R=_.leaf?this.compareMinY:d;this._allDistMargin(_,b,y,M)<this._allDistMargin(_,b,y,R)&&_.children.sort(M)},o.prototype._allDistMargin=function(_,b,y,M){_.children.sort(M);for(var R=this.toBBox,T=l(_,0,b,R),A=l(_,y-b,y,R),B=f(T)+f(A),D=b;D<y-b;D++){var G=_.children[D];u(T,_.leaf?R(G):G),B+=f(T)}for(var F=y-b-1;F>=b;F--){var P=_.children[F];u(A,_.leaf?R(P):P),B+=f(A)}return B},o.prototype._adjustParentBBoxes=function(_,b,y){for(var M=y;M>=0;M--)u(b[M],_)},o.prototype._condense=function(_){for(var b=_.length-1,y=void 0;b>=0;b--)_[b].children.length===0?b>0?(y=_[b-1].children).splice(y.indexOf(_[b]),1):this.clear():a(_[b],this.toBBox)},o})})(Fa);const Ia=cr(Oo),Na=cr(Co),xa=cr(Ro);var qe=ir,Vi=Ia,Ki=Na,mt=xa.default,Ba=Ki.featureEach;Ki.coordEach;Vi.polygon;var fi=Vi.featureCollection;function Zi(r){var e=new qe(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:mt(t),qe.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:mt(i),n.push(i)}):Ba(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:mt(i),n.push(i)}),qe.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:mt(t),qe.prototype.remove.call(this,t,n)},e.clear=function(){return qe.prototype.clear.call(this)},e.search=function(t){var n=qe.prototype.search.call(this,this.toBBox(t));return fi(n)},e.collides=function(t){return qe.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=qe.prototype.all.call(this);return fi(t)},e.toJSON=function(){return qe.prototype.toJSON.call(this)},e.fromJSON=function(t){return qe.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=mt(t);else if(t.type==="FeatureCollection")n=mt(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Pa.exports=Zi;Ct.default=Zi;function Qi(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Or(r)),e.type==="LineString"&&(e=Or(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=ci(r,e);return i&&n.push(i),et(n)}var o=Ct();return o.load(rr(e)),gn(rr(r),function(s){gn(o.search(s),function(a){var l=ci(s,a);if(l){var u=He(l).join(",");t[u]||(t[u]=!0,n.push(l))}})}),et(n)}function ci(r,e){var t=He(r),n=He(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],s=t[1][0],a=t[1][1],l=n[0][0],u=n[0][1],p=n[1][0],d=n[1][1],c=(d-u)*(s-i)-(p-l)*(a-o),f=(p-l)*(o-u)-(d-u)*(i-l),h=(s-i)*(o-u)-(a-o)*(i-l);if(c===0)return f===0&&h===0,null;var g=f/c,m=h/c;if(g>=0&&g<=1&&m>=0&&m<=1){var v=i+g*(s-i),_=o+g*(a-o);return Et([v,_])}return null}function Vt(r,e,t){t===void 0&&(t={});var n=Et([1/0,1/0],{dist:1/0}),i=0;return fr(r,function(o){for(var s=He(o),a=0;a<s.length-1;a++){var l=Et(s[a]);l.properties.dist=Ve(e,l,t);var u=Et(s[a+1]);u.properties.dist=Ve(e,u,t);var p=Ve(l,u,t),d=Math.max(l.properties.dist,u.properties.dist),c=Wi(l,u),f=ui(e,d,c+90,t),h=ui(e,d,c-90,t),g=Qi(Lt([f.geometry.coordinates,h.geometry.coordinates]),Lt([l.geometry.coordinates,u.geometry.coordinates])),m=null;g.features.length>0&&(m=g.features[0],m.properties.dist=Ve(e,m,t),m.properties.location=i+Ve(l,m,t)),l.properties.dist<n.properties.dist&&(n=l,n.properties.index=a,n.properties.location=i),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=a+1,n.properties.location=i+p),m&&m.properties.dist<n.properties.dist&&(n=m,n.properties.index=a),i+=p}}),n}const _t="edit-polygon-mode";class Da{constructor(e){re(this,"map");re(this,"active");re(this,"eventListenersSuccess");re(this,"eventListenersFailure");re(this,"points");re(this,"cursor");re(this,"hover");re(this,"dragFrom");re(this,"events");this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.events=new hr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("mousedown",this.onMouseDown),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeypress),Xe(e,_t,Pe()),ke(e,{id:"edit-polygon-fill",source:_t,filter:Tn,...On("red",["case",["boolean",["get","hover"],"false"],1,.5])}),ke(e,{id:"edit-polygon-lines",source:_t,filter:An,...Mt("black",8,.5)}),ke(e,{id:"edit-polygon-vertices",source:_t,filter:Rn,...ut(pe.hovering,Pn,["case",["boolean",["get","hover"],"false"],1,.5])})}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove(e){if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}}onClick(e){if(this.active&&this.cursor){let t=[];if(di(this.points).forEach((n,i)=>{t.push([i+1,Vt(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.recalculateHovering(e))}onMouseDown(e){this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray())}onMouseUp(){this.active&&this.dragFrom&&(this.dragFrom=null)}onKeypress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}tearDown(){this.map.removeLayer("edit-polygon-vertices"),this.map.removeLayer("edit-polygon-fill"),this.map.removeLayer("edit-polygon-lines"),this.map.removeSource(_t),this.events.tearDown()}startNew(){this.active=!0}editExisting(e){this.active=!0,this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.redraw()}redraw(){let e=Pe();this.points.forEach((n,i)=>{let o=pi(n);o.properties.hover=this.hover==i,o.properties.idx=i,e.features.push(o)}),this.cursor&&e.features.push(this.cursor),e.features=e.features.concat(di(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),this.map.getSource(_t).setData(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=pi(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=[JSON.parse(JSON.stringify(this.points))];return e[0].push(JSON.parse(JSON.stringify(e[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:{}}}}function pi(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function di(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}let Q;const Ye=new Array(32).fill(void 0);Ye.push(void 0,null,!0,!1);function V(r){return Ye[r]}let Ut=Ye.length;function ja(r){r<36||(Ye[r]=Ut,Ut=r)}function or(r){const e=V(r);return ja(r),e}const eo=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});eo.decode();let fn=new Uint8Array;function Gt(){return fn.byteLength===0&&(fn=new Uint8Array(Q.memory.buffer)),fn}function bt(r,e){return eo.decode(Gt().subarray(r,r+e))}function ye(r){Ut===Ye.length&&Ye.push(Ye.length+1);const e=Ut;return Ut=Ye[e],Ye[e]=r,e}function qn(r){return r==null}let cn=new Float64Array;function qa(){return cn.byteLength===0&&(cn=new Float64Array(Q.memory.buffer)),cn}let pn=new Int32Array;function we(){return pn.byteLength===0&&(pn=new Int32Array(Q.memory.buffer)),pn}let Qe=0;const dn=new TextEncoder("utf-8"),Ua=typeof dn.encodeInto=="function"?function(r,e){return dn.encodeInto(r,e)}:function(r,e){const t=dn.encode(r);return e.set(t),{read:r.length,written:t.length}};function rn(r,e,t){if(t===void 0){const a=dn.encode(r),l=e(a.length);return Gt().subarray(l,l+a.length).set(a),Qe=a.length,l}let n=r.length,i=e(n);const o=Gt();let s=0;for(;s<n;s++){const a=r.charCodeAt(s);if(a>127)break;o[i+s]=a}if(s!==n){s!==0&&(r=r.slice(s)),i=t(i,n,n=s+r.length*3);const a=Gt().subarray(i+s,i+n),l=Ua(r,a);s+=l.written}return Qe=s,i}function sr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=sr(r[0]));for(let s=1;s<i;s++)o+=", "+sr(r[s]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ga(r,e){const t=e(r.length*1);return Gt().set(r,t/1),Qe=r.length,t}function Un(r,e){try{return r.apply(this,e)}catch(t){Q.__wbindgen_exn_store(ye(t))}}class En{static __wrap(e){const t=Object.create(En.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Q.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=Q.__wbindgen_add_to_stack_pointer(-16),s=Ga(e,Q.__wbindgen_malloc),a=Qe;Q.jsroutesnapper_new(o,s,a);var t=we()[o/4+0],n=we()[o/4+1],i=we()[o/4+2];if(i)throw or(n);return En.__wrap(t)}finally{Q.__wbindgen_add_to_stack_pointer(16)}}setConfig(e){Q.jsroutesnapper_setConfig(this.ptr,ye(e))}toFinalFeature(){try{const n=Q.__wbindgen_add_to_stack_pointer(-16);Q.jsroutesnapper_toFinalFeature(n,this.ptr);var e=we()[n/4+0],t=we()[n/4+1];let i;return e!==0&&(i=bt(e,t).slice(),Q.__wbindgen_free(e,t*1)),i}finally{Q.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){try{const n=Q.__wbindgen_add_to_stack_pointer(-16);Q.jsroutesnapper_renderGeojson(n,this.ptr);var e=we()[n/4+0],t=we()[n/4+1];return bt(e,t)}finally{Q.__wbindgen_add_to_stack_pointer(16),Q.__wbindgen_free(e,t)}}setSnapMode(e){Q.jsroutesnapper_setSnapMode(this.ptr,e)}onMouseMove(e,t,n){return Q.jsroutesnapper_onMouseMove(this.ptr,e,t,n)!==0}onClick(){Q.jsroutesnapper_onClick(this.ptr)}onDragStart(){return Q.jsroutesnapper_onDragStart(this.ptr)!==0}onMouseUp(){return Q.jsroutesnapper_onMouseUp(this.ptr)!==0}clearState(){Q.jsroutesnapper_clearState(this.ptr)}editExisting(e){try{const i=Q.__wbindgen_add_to_stack_pointer(-16);Q.jsroutesnapper_editExisting(i,this.ptr,ye(e));var t=we()[i/4+0],n=we()[i/4+1];if(n)throw or(t)}finally{Q.__wbindgen_add_to_stack_pointer(16)}}}async function Ha(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function za(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){or(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=V(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(bt(e,t));return ye(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=bt(e,t);return ye(n)},r.wbg.__wbindgen_is_object=function(e){const t=V(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return V(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return V(e)in V(t)},r.wbg.__wbindgen_number_get=function(e,t){const n=V(t),i=typeof n=="number"?n:void 0;qa()[e/8+1]=qn(i)?0:i,we()[e/4+0]=!qn(i)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return V(e)==V(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=V(t),i=typeof n=="string"?n:void 0;var o=qn(i)?0:rn(i,Q.__wbindgen_malloc,Q.__wbindgen_realloc),s=Qe;we()[e/4+1]=s,we()[e/4+0]=o},r.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const n=String(V(t)),i=rn(n,Q.__wbindgen_malloc,Q.__wbindgen_realloc),o=Qe;we()[e/4+1]=o,we()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=V(e);return ye(t)},r.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,t){const n=V(e)[V(t)];return ye(n)},r.wbg.__wbg_debug_f15cb542ea509609=function(e){console.debug(V(e))},r.wbg.__wbg_error_ef9a0be47931175f=function(e){console.error(V(e))},r.wbg.__wbg_info_2874fdd5393f35ce=function(e){console.info(V(e))},r.wbg.__wbg_log_4b5638ad60bdc54a=function(e){console.log(V(e))},r.wbg.__wbg_warn_58110c4a199df084=function(e){console.warn(V(e))},r.wbg.__wbg_get_57245cc7d7c7619d=function(e,t){const n=V(e)[t>>>0];return ye(n)},r.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return V(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof V(e)=="function"},r.wbg.__wbg_next_579e583d33566a86=function(e){const t=V(e).next;return ye(t)},r.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Un(function(e){const t=V(e).next();return ye(t)},arguments)},r.wbg.__wbg_done_1b73b0672e15f234=function(e){return V(e).done},r.wbg.__wbg_value_1ccc36bc03462d71=function(e){const t=V(e).value;return ye(t)},r.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return ye(Symbol.iterator)},r.wbg.__wbg_get_765201544a2b6869=function(){return Un(function(e,t){const n=Reflect.get(V(e),V(t));return ye(n)},arguments)},r.wbg.__wbg_call_97ae9d8645dc388b=function(){return Un(function(e,t){const n=V(e).call(V(t));return ye(n)},arguments)},r.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(V(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let t;try{t=V(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const t=V(e).buffer;return ye(t)},r.wbg.__wbg_new_8c3f0052272a457a=function(e){const t=new Uint8Array(V(e));return ye(t)},r.wbg.__wbg_set_83db9690f9353e79=function(e,t,n){V(e).set(V(t),n>>>0)},r.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return V(e).length},r.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let t;try{t=V(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ye(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=V(t).stack,i=rn(n,Q.__wbindgen_malloc,Q.__wbindgen_realloc),o=Qe;we()[e/4+1]=o,we()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){try{console.error(bt(e,t))}finally{Q.__wbindgen_free(e,t)}},r.wbg.__wbindgen_debug_string=function(e,t){const n=sr(V(t)),i=rn(n,Q.__wbindgen_malloc,Q.__wbindgen_realloc),o=Qe;we()[e/4+1]=o,we()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(bt(e,t))},r.wbg.__wbindgen_memory=function(){const e=Q.memory;return ye(e)},r}function Ja(r,e){return Q=r.exports,to.__wbindgen_wasm_module=e,cn=new Float64Array,pn=new Int32Array,fn=new Uint8Array,Q}async function to(r){typeof r>"u"&&(r="/atip/streetview/assets/route_snapper_bg.wasm");const e=za();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Ha(await r,e);return Ja(t,n)}const Pt="route-snapper",hi=10,Ya=30;class Xa{constructor(e,t){re(this,"map");re(this,"inner");re(this,"active");re(this,"eventListenersSuccessRoute");re(this,"eventListenersSuccessArea");re(this,"eventListenersFailure");re(this,"events");this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new En(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccessRoute=[],this.eventListenersSuccessArea=[],this.eventListenersFailure=[],Xe(e,Pt,Pe()),ke(e,{id:"route-points",source:Pt,filter:Rn,...ut(["match",["get","type"],"hovered","green","important","red","black"],["match",["get","type"],"unimportant",hi/2,hi])}),ke(e,{id:"route-lines",source:Pt,filter:An,...Mt("black",2.5)}),ke(e,{id:"route-polygons",source:Pt,filter:Tn,...On("black",.5)}),this.events=new hr(this,e),this.events.mapHandler("mousemove",this.onMouseMove),this.events.mapHandler("click",this.onClick),this.events.mapHandler("dragstart",this.onDragStart),this.events.mapHandler("mouseup",this.onMouseUp),this.events.documentHandler("keypress",this.onKeyPress),this.events.documentHandler("keydown",this.onKeyDown),this.events.documentHandler("keyup",this.onKeyUp)}onMouseMove(e){if(!this.active)return;const t=[e.point.x-Ya,e.point.y],n=this.map.unproject(e.point).distanceTo(this.map.unproject(t));this.inner.onMouseMove(e.lngLat.lng,e.lngLat.lat,n)&&this.redraw()}onClick(){this.active&&(this.inner.onClick(),this.redraw())}onDragStart(){this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()}onMouseUp(){this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()}onKeyPress(e){this.active&&e.key=="Enter"&&(e.preventDefault(),this.finish())}onKeyDown(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!1),this.redraw())}onKeyUp(e){this.active&&e.key=="Shift"&&(e.preventDefault(),this.inner.setSnapMode(!0),this.redraw())}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable())}startArea(){this.active||(this.inner.setConfig({avoid_doubling_back:!0,area_mode:!0}),this.active=!0,this.map.boxZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}tearDown(){this.map.removeLayer("route-points"),this.map.removeLayer("route-lines"),this.map.removeLayer("route-polygons"),this.map.removeSource("route-snapper"),this.events.tearDown()}addEventListenerSuccessRoute(e){this.eventListenersSuccessRoute.push(e)}addEventListenerSuccessArea(e){this.eventListenersSuccessArea.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)if(JSON.parse(e).geometry.type=="LineString")for(let n of this.eventListenersSuccessRoute)n(JSON.parse(e));else for(let n of this.eventListenersSuccessArea)n(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setConfig({...e,area_mode:!1}),this.redraw()}redraw(){this.map.getSource(Pt).setData(JSON.parse(this.inner.renderGeojson()))}}function Wa(r){let e,t,n,i,o,s,a,l;return{c(){e=E("button"),t=E("img"),i=C(),o=X(r[2]),mn(t.src,n=r[3])||O(t,"src",n),O(t,"alt",r[2]),O(t,"class","svelte-1vvpkg9"),O(e,"type","button"),e.disabled=s=r[0]==r[1],O(e,"class","svelte-1vvpkg9")},m(u,p){w(u,e,p),S(e,t),S(e,i),S(e,o),a||(l=U(e,"click",r[5]),a=!0)},p(u,[p]){p&8&&!mn(t.src,n=u[3])&&O(t,"src",n),p&4&&O(t,"alt",u[2]),p&4&&xe(o,u[2]),p&3&&s!==(s=u[0]==u[1])&&(e.disabled=s)},i:H,o:H,d(u){u&&k(e),a=!1,l()}}}function Va(r,e,t){let{mode:n}=e,{thisMode:i}=e,{label:o}=e,{icon:s}=e,{changeMode:a}=e;const l=()=>a(i);return r.$$set=u=>{"mode"in u&&t(0,n=u.mode),"thisMode"in u&&t(1,i=u.thisMode),"label"in u&&t(2,o=u.label),"icon"in u&&t(3,s=u.icon),"changeMode"in u&&t(4,a=u.changeMode)},[n,i,o,s,a,l]}class Ke extends K{constructor(e){super(),Z(this,e,Va,Wa,W,{mode:0,thisMode:1,label:2,icon:3,changeMode:4})}}function mi(r){let e;function t(o,s){return o[1]?Za:Ka}let n=t(r),i=n(r);return{c(){i.c(),e=de()},m(o,s){i.m(o,s),w(o,e,s)},p(o,s){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){i.d(o),o&&k(e)}}}function Ka(r){let e;return{c(){e=E("p"),e.textContent="Click an object to fill out its attributes"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Za(r){let e;return{c(){e=E("p"),e.textContent="Edit attributes to the left, or click another object"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function Qa(r){let e,t=r[0]==vt&&mi(r);return{c(){t&&t.c(),e=de()},m(n,i){t&&t.m(n,i),w(n,e,i)},p(n,[i]){n[0]==vt?t?t.p(n,i):(t=mi(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:H,o:H,d(n){t&&t.d(n),n&&k(e)}}}const vt="edit-attribute";function no(){}function eu(r,e,t){let n,i,o,s;te(r,Ie,f=>t(5,n=f)),te(r,ne,f=>t(6,i=f)),te(r,Yt,f=>t(7,o=f)),te(r,$e,f=>t(1,s=f));let{mode:a}=e,{changeMode:l}=e;function u(){$e.set(null)}n.on("mousemove",p),n.on("mouseout",d),n.on("click",c),it(()=>{n.off("mousemove",p),n.off("mouseout",d),n.off("click",c)});function p(f){var h;if(a==vt){let g=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ge.set(((h=g[0])==null?void 0:h.id)||null)}}function d(){a==vt&&Ge.set(null)}function c(f){if(a==vt){let h=n.queryRenderedFeatures(f.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});h.length>0?$e.set(h[0].id):$e.set(null)}}return r.$$set=f=>{"mode"in f&&t(0,a=f.mode),"changeMode"in f&&t(2,l=f.changeMode)},r.$$.update=()=>{if(r.$$.dirty&228){let f=o;if(f){let h=i.features.find(g=>g.id==f);h.geometry.type=="Point"?n.flyTo({center:h.geometry.coordinates,duration:500}):n.fitBounds(ur(h),{padding:200,duration:500}),l(vt)}}},[a,s,l,no,u,n,i,o]}class tu extends K{constructor(e){super(),Z(this,e,eu,Qa,W,{mode:0,changeMode:2,start:3,stop:4})}get start(){return no}get stop(){return this.$$.ctx[4]}}function nu(r){let e,t;return{c:H,m(n,i){e||(t=U(window,"keydown",r[0]),e=!0)},p:H,i:H,o:H,d(n){e=!1,t()}}}function ru(r,e,t){let{tool:n}=e;function i(o){o.key=="Escape"&&(n.cancel(),o.preventDefault())}return r.$$set=o=>{"tool"in o&&t(1,n=o.tool)},[i,n]}class In extends K{constructor(e){super(),Z(this,e,ru,nu,W,{tool:1})}}function iu(r){let e;return{c(){e=E("li"),e.textContent="Click to add a new point"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function ou(r){let e;return{c(){e=E("li"),e.textContent="Click to move the point here"},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function su(r){let e,t,n,i,o,s,a,l,u,p;function d(h,g){return h[1]?ou:iu}let c=d(r),f=c(r);return a=new In({props:{tool:r[0]}}),{c(){e=E("ul"),f.c(),t=C(),n=E("li"),n.innerHTML="Press <b>Escape</b> to cancel",i=C(),o=E("button"),o.textContent="Cancel",s=C(),I(a.$$.fragment),O(o,"type","button")},m(h,g){w(h,e,g),f.m(e,null),S(e,t),S(e,n),w(h,i,g),w(h,o,g),w(h,s,g),N(a,h,g),l=!0,u||(p=U(o,"click",r[2]),u=!0)},p(h,[g]){c!==(c=d(h))&&(f.d(1),f=c(h),f&&(f.c(),f.m(e,t)));const m={};g&1&&(m.tool=h[0]),a.$set(m)},i(h){l||($(a.$$.fragment,h),l=!0)},o(h){L(a.$$.fragment,h),l=!1},d(h){h&&k(e),f.d(),h&&k(i),h&&k(o),h&&k(s),x(a,h),u=!1,p()}}}function lu(r,e,t){let{pointTool:n}=e,{editingExisting:i}=e;const o=()=>n.cancel();return r.$$set=s=>{"pointTool"in s&&t(0,n=s.pointTool),"editingExisting"in s&&t(1,i=s.editingExisting)},[n,i,o]}class ro extends K{constructor(e){super(),Z(this,e,lu,su,W,{pointTool:0,editingExisting:1})}}function au(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> the map to add a vertex</li> 
    <li><b>Click</b> a vertex to delete it</li> 
    <li><b>Drag</b> a vertex or the polygon to move it</li> 
    <li>Press <b>Enter</b> to finish</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function uu(r){let e,t,n,i,o,s,a,l,u,p,d;return e=new Fn({props:{label:"Help",$$slots:{default:[au]},$$scope:{ctx:r}}}),l=new In({props:{tool:r[0]}}),{c(){I(e.$$.fragment),t=C(),n=E("div"),i=E("button"),i.textContent="Finish",o=C(),s=E("button"),s.textContent="Cancel",a=C(),I(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),le(n,"display","flex"),le(n,"justify-content","space-between")},m(c,f){N(e,c,f),w(c,t,f),w(c,n,f),S(n,i),S(n,o),S(n,s),w(c,a,f),N(l,c,f),u=!0,p||(d=[U(i,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const h={};f&8&&(h.$$scope={dirty:f,ctx:c}),e.$set(h);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){L(e.$$.fragment,c),L(l.$$.fragment,c),u=!1},d(c){x(e,c),c&&k(t),c&&k(n),c&&k(a),x(l,c),p=!1,Fe(d)}}}function fu(r,e,t){let{polygonTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"polygonTool"in s&&t(0,n=s.polygonTool)},[n,i,o]}class io extends K{constructor(e){super(),Z(this,e,fu,uu,W,{polygonTool:0})}}function cu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish area</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function pu(r){let e,t,n,i,o,s,a,l,u,p,d;return e=new Fn({props:{label:"Help",$$slots:{default:[cu]},$$scope:{ctx:r}}}),l=new In({props:{tool:r[0]}}),{c(){I(e.$$.fragment),t=C(),n=E("div"),i=E("button"),i.textContent="Finish",o=C(),s=E("button"),s.textContent="Cancel",a=C(),I(l.$$.fragment),O(i,"type","button"),O(s,"type","button"),le(n,"display","flex"),le(n,"justify-content","space-between")},m(c,f){N(e,c,f),w(c,t,f),w(c,n,f),S(n,i),S(n,o),S(n,s),w(c,a,f),N(l,c,f),u=!0,p||(d=[U(i,"click",r[1]),U(s,"click",r[2])],p=!0)},p(c,[f]){const h={};f&8&&(h.$$scope={dirty:f,ctx:c}),e.$set(h);const g={};f&1&&(g.tool=c[0]),l.$set(g)},i(c){u||($(e.$$.fragment,c),$(l.$$.fragment,c),u=!0)},o(c){L(e.$$.fragment,c),L(l.$$.fragment,c),u=!1},d(c){x(e,c),c&&k(t),c&&k(n),c&&k(a),x(l,c),p=!1,Fe(d)}}}function du(r,e,t){let{routeTool:n}=e;const i=()=>n.finish(),o=()=>n.cancel();return r.$$set=s=>{"routeTool"in s&&t(0,n=s.routeTool)},[n,i,o]}class oo extends K{constructor(e){super(),Z(this,e,du,pu,W,{routeTool:0})}}function hu(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> green points on the transport network to create snapped routes</li> 
    <li>Hold <b>Shift</b> to draw a point anywhere</li> 
    <li><b>Click and drag</b> any point to move it</li> 
    <li><b>Click</b> a red waypoint to delete it</li> 
    <li>Press <b>Enter</b> to finish route</li> 
    <li>Press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},p:H,d(t){t&&k(e)}}}function mu(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,h,g;return e=new Fn({props:{label:"Help",$$slots:{default:[hu]},$$scope:{ctx:r}}}),c=new In({props:{tool:r[0]}}),{c(){I(e.$$.fragment),t=C(),n=E("label"),i=E("input"),o=X(`
  Avoid doubling back`),s=C(),a=E("div"),l=E("button"),l.textContent="Finish",u=C(),p=E("button"),p.textContent="Cancel",d=C(),I(c.$$.fragment),O(i,"type","checkbox"),O(l,"type","button"),O(p,"type","button"),le(a,"display","flex"),le(a,"justify-content","space-between")},m(m,v){N(e,m,v),w(m,t,v),w(m,n,v),S(n,i),i.checked=r[1],S(n,o),w(m,s,v),w(m,a,v),S(a,l),S(a,u),S(a,p),w(m,d,v),N(c,m,v),f=!0,h||(g=[U(i,"change",r[2]),U(l,"click",r[3]),U(p,"click",r[4])],h=!0)},p(m,[v]){const _={};v&32&&(_.$$scope={dirty:v,ctx:m}),e.$set(_),v&2&&(i.checked=m[1]);const b={};v&1&&(b.tool=m[0]),c.$set(b)},i(m){f||($(e.$$.fragment,m),$(c.$$.fragment,m),f=!0)},o(m){L(e.$$.fragment,m),L(c.$$.fragment,m),f=!1},d(m){x(e,m),m&&k(t),m&&k(n),m&&k(s),m&&k(a),m&&k(d),x(c,m),h=!1,Fe(g)}}}function _u(r,e,t){let{routeTool:n}=e,i=!1;function o(){i=this.checked,t(1,i)}const s=()=>n.finish(),a=()=>n.cancel();return r.$$set=l=>{"routeTool"in l&&t(0,n=l.routeTool)},r.$$.update=()=>{r.$$.dirty&3&&n.setRouteConfig({avoid_doubling_back:i})},[n,i,o,s,a]}class so extends K{constructor(e){super(),Z(this,e,_u,mu,W,{routeTool:0})}}function _i(r){let e,t,n,i;const o=[wu,yu,vu,bu,gu],s=[];function a(l,u){return l[4]=="point"?0:l[4]=="free-polygon"?1:l[4]=="snap-polygon"?2:l[4]=="route"?3:4}return e=a(r),t=s[e]=o[e](r),{c(){t.c(),n=de()},m(l,u){s[e].m(l,u),w(l,n,u),i=!0},p(l,u){let p=e;e=a(l),e===p?s[e].p(l,u):(ae(),L(s[p],1,1,()=>{s[p]=null}),ue(),t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n))},i(l){i||($(t),i=!0)},o(l){L(t),i=!1},d(l){s[e].d(l),l&&k(n)}}}function gu(r){let e;return{c(){e=E("p"),e.textContent="Click an object to edit its geometry"},m(t,n){w(t,e,n)},p:H,i:H,o:H,d(t){t&&k(e)}}}function bu(r){let e,t;return e=new so({props:{routeTool:r[3]}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function vu(r){let e,t;return e=new oo({props:{routeTool:r[3]}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.routeTool=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function yu(r){let e,t;return e=new io({props:{polygonTool:r[2]}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&4&&(o.polygonTool=n[2]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function wu(r){let e,t;return e=new ro({props:{pointTool:r[1],editingExisting:!0}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function ku(r){let e,t,n=r[0]==ze&&_i(r);return{c(){n&&n.c(),e=de()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==ze?n?(n.p(i,o),o&1&&$(n,1)):(n=_i(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ae(),L(n,1,1,()=>{n=null}),ue())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const ze="edit-geometry";function lo(){}function Su(r,e,t){let n;te(r,Ie,g=>t(8,n=g));let{mode:i}=e,{pointTool:o}=e,{polygonTool:s}=e,{routeTool:a}=e,l=null,u=null;function p(){l&&(o.stop(),s.stop(),a.stop(),ne.update(g=>{let m=g.features.find(v=>v.id==l);return delete m.properties.hide_while_editing,g})),l=null,t(4,u=null),Ge.set(null)}n.on("mousemove",d),n.on("mouseout",c),n.on("click",f),it(()=>{n.off("mousemove",d),n.off("mouseout",c),n.off("click",f)}),a.addEventListenerSuccessRoute(g=>{i==ze&&(ne.update(m=>{let v=m.features.find(_=>_.id==l);return v.properties.length_meters=g.properties.length_meters,v.properties.waypoints=g.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=g.geometry,m}),l=null,t(4,u=null))}),a.addEventListenerSuccessArea(g=>{i==ze&&(ne.update(m=>{let v=m.features.find(_=>_.id==l);return v.properties.waypoints=g.properties.waypoints,delete v.properties.hide_while_editing,v.geometry=g.geometry,m}),l=null,t(4,u=null))});for(let g of[o,s])g.addEventListenerSuccess(m=>{i==ze&&(ne.update(v=>{let _=v.features.find(b=>b.id==l);return _.geometry=m.geometry,delete _.properties.hide_while_editing,v}),l=null,t(4,u=null))});for(let g of[o,s,a])g.addEventListenerFailure(()=>{i==ze&&(ne.update(m=>{let v=m.features.find(_=>_.id==l);return delete v.properties.hide_while_editing,m}),l=null,t(4,u=null))});function d(g){var m;if(i==ze&&l==null){let v=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});Ge.set(((m=v[0])==null?void 0:m.id)||null)}}function c(){i==ze&&l==null&&Ge.set(null)}function f(g){if(i==ze&&l==null){let m=n.queryRenderedFeatures(g.point,{layers:["interventions-points","interventions-lines","interventions-polygons"]});m.length>0&&h(m[0].id)}}function h(g){Ge.set(null);let m=null;ne.update(_=>(m=_.features.find(b=>b.id==g),m.properties.hide_while_editing=!0,_));let v=m;l=g,v.geometry.type=="LineString"?(a.editExistingRoute(v),t(4,u="route")):v.geometry.type=="Polygon"?v.properties.waypoints?(a.editExistingArea(v),t(4,u="snap-polygon")):(s.editExisting(v),t(4,u="free-polygon")):v.geometry.type=="Point"&&(o.start(),t(4,u="point"))}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"pointTool"in g&&t(1,o=g.pointTool),"polygonTool"in g&&t(2,s=g.polygonTool),"routeTool"in g&&t(3,a=g.routeTool)},[i,o,s,a,u,lo,p]}class Eu extends K{constructor(e){super(),Z(this,e,Su,ku,W,{mode:0,pointTool:1,polygonTool:2,routeTool:3,start:5,stop:6})}get start(){return lo}get stop(){return this.$$.ctx[6]}}async function Mu(r,e){const t=await fetch(r),n=t.body.getReader(),i=t.headers.get("Content-Length");let o=0,s=[];for(;;){const{done:u,value:p}=await n.read();if(u)break;s.push(p),o+=p.length;const d=100*o/i;e.style=`background: linear-gradient(to right, red ${d}%, transparent 0);`}let a=new Uint8Array(o),l=0;for(let u of s)a.set(u,l),l+=u.length;return a}function $u(r){let e,t;return e=new so({props:{routeTool:r[0]}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.routeTool=n[0]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function Lu(r){let e;return{c(){e=E("div"),e.textContent="Route tool loading..."},m(t,n){w(t,e,n),r[7](e)},p:H,i:H,o:H,d(t){t&&k(e),r[7](null)}}}function Ou(r){let e,t,n,i;const o=[Lu,$u],s=[];function a(l,u){return l[0]?l[1]==lr?1:-1:0}return~(e=a(r))&&(t=s[e]=o[e](r)),{c(){t&&t.c(),n=de()},m(l,u){~e&&s[e].m(l,u),w(l,n,u),i=!0},p(l,[u]){let p=e;e=a(l),e===p?~e&&s[e].p(l,u):(t&&(ae(),L(s[p],1,1,()=>{s[p]=null}),ue()),~e?(t=s[e],t?t.p(l,u):(t=s[e]=o[e](l),t.c()),$(t,1),t.m(n.parentNode,n)):t=null)},i(l){i||($(t),i=!0)},o(l){L(t),i=!1},d(l){~e&&s[e].d(l),l&&k(n)}}}const lr="route";function Cu(r,e,t){let n;te(r,Ie,c=>t(8,n=c));let{mode:i}=e,{changeMode:o}=e,{url:s}=e,a,{routeTool:l}=e;function u(){l.isActive()||l.startRoute()}function p(){l==null||l.stop()}Kt(async()=>{await to(),console.log(`Grabbing ${s}`);try{const c=await Mu(s,a);t(0,l=new Xa(n,c))}catch(c){console.log(`Route tool broke: ${c}`),t(2,a.innerHTML="Failed to load",a);return}l.addEventListenerFailure(()=>{i==lr&&o("edit-attribute")}),l.addEventListenerSuccessRoute(c=>{i==lr&&(ne.update(f=>(c.id=Zt(f),c.properties.intervention_type="route",f.features.push(c),f)),o("edit-attribute"),$e.set(c.id))})});function d(c){oe[c?"unshift":"push"](()=>{a=c,t(2,a)})}return r.$$set=c=>{"mode"in c&&t(1,i=c.mode),"changeMode"in c&&t(3,o=c.changeMode),"url"in c&&t(4,s=c.url),"routeTool"in c&&t(0,l=c.routeTool)},[l,i,a,o,s,u,p,d]}class Ru extends K{constructor(e){super(),Z(this,e,Cu,Ou,W,{mode:1,changeMode:3,url:4,routeTool:0,start:5,stop:6})}get start(){return this.$$.ctx[5]}get stop(){return this.$$.ctx[6]}}function gi(r){let e,t;return e=new ro({props:{pointTool:r[1],editingExisting:!1}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.pointTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function Au(r){let e,t,n=r[0]==Mn&&gi(r);return{c(){n&&n.c(),e=de()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==Mn?n?(n.p(i,o),o&1&&$(n,1)):(n=gi(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ae(),L(n,1,1,()=>{n=null}),ue())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const Mn="point";function Tu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{pointTool:o}=e;function s(){o.start()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==Mn&&(ne.update(u=>(l.id=Zt(u),l.properties.intervention_type="other",u.features.push(l),u)),i("edit-attribute"),$e.set(l.id))}),o.addEventListenerFailure(()=>{n==Mn&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"pointTool"in l&&t(1,o=l.pointTool)},[n,o,i,s,a]}class Pu extends K{constructor(e){super(),Z(this,e,Tu,Au,W,{mode:0,changeMode:2,pointTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function bi(r){let e,t;return e=new io({props:{polygonTool:r[1]}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.polygonTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function Fu(r){let e,t,n=r[0]==$n&&bi(r);return{c(){n&&n.c(),e=de()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==$n?n?(n.p(i,o),o&1&&$(n,1)):(n=bi(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ae(),L(n,1,1,()=>{n=null}),ue())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const $n="free-polygon";function Iu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{polygonTool:o}=e;function s(){o.startNew()}function a(){o.stop()}return o.addEventListenerSuccess(l=>{n==$n&&(ne.update(u=>(l.id=Zt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),$e.set(l.id))}),o.addEventListenerFailure(()=>{n==$n&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"polygonTool"in l&&t(1,o=l.polygonTool)},[n,o,i,s,a]}class Nu extends K{constructor(e){super(),Z(this,e,Iu,Fu,W,{mode:0,changeMode:2,polygonTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function vi(r){let e,t;return e=new oo({props:{routeTool:r[1]}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.routeTool=n[1]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function xu(r){let e,t,n=r[0]==Ln&&vi(r);return{c(){n&&n.c(),e=de()},m(i,o){n&&n.m(i,o),w(i,e,o),t=!0},p(i,[o]){i[0]==Ln?n?(n.p(i,o),o&1&&$(n,1)):(n=vi(i),n.c(),$(n,1),n.m(e.parentNode,e)):n&&(ae(),L(n,1,1,()=>{n=null}),ue())},i(i){t||($(n),t=!0)},o(i){L(n),t=!1},d(i){n&&n.d(i),i&&k(e)}}}const Ln="snap-polygon";function Bu(r,e,t){let{mode:n}=e,{changeMode:i}=e,{routeTool:o}=e;function s(){o.startArea()}function a(){o.stop()}return o.addEventListenerSuccessArea(l=>{n==Ln&&(ne.update(u=>(l.id=Zt(u),l.properties.intervention_type="area",u.features.push(l),u)),i("edit-attribute"),$e.set(l.id))}),o.addEventListenerFailure(()=>{n==Ln&&i("edit-attribute")}),r.$$set=l=>{"mode"in l&&t(0,n=l.mode),"changeMode"in l&&t(2,i=l.changeMode),"routeTool"in l&&t(1,o=l.routeTool)},[n,o,i,s,a]}class Du extends K{constructor(e){super(),Z(this,e,Bu,xu,W,{mode:0,changeMode:2,routeTool:1,start:3,stop:4})}get start(){return this.$$.ctx[3]}get stop(){return this.$$.ctx[4]}}function ju(r){var e=r[0],t=r[1],n=r[2],i=r[3],o=Ve(r.slice(0,2),[n,t]),s=Ve(r.slice(0,2),[e,i]);if(o>=s){var a=(t+i)/2;return[e,a-(n-e)/2,n,a+(n-e)/2]}else{var l=(e+n)/2;return[l-(i-t)/2,t,l+(i-t)/2,i]}}function qu(r,e){e===void 0&&(e={});var t=e.precision,n=e.coordinates,i=e.mutate;if(t=t==null||isNaN(t)?6:t,n=n==null||isNaN(n)?3:n,!r)throw new Error("<geojson> is required");if(typeof t!="number")throw new Error("<precision> must be a number");if(typeof n!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(r=JSON.parse(JSON.stringify(r)));var o=Math.pow(10,t);return Ao(r,function(s){Uu(s,o,n)}),r}function Uu(r,e,t){r.length>t&&r.splice(t,r.length);for(var n=0;n<r.length;n++)r[n]=Math.round(r[n]*e)/e;return r}function Gu(r,e){if(!r)throw new Error("line is required");if(!e)throw new Error("splitter is required");var t=nr(r),n=nr(e);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=qu(e,{precision:7});switch(n){case"Point":return ar(r,i);case"MultiPoint":return yi(r,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return yi(r,Qi(r,i))}}function yi(r,e){var t=[],n=Ct();return fr(e,function(i){if(t.forEach(function(a,l){a.id=l}),!t.length)t=ar(r,i).features,t.forEach(function(a){a.bbox||(a.bbox=ju(To(a)))}),n.load(et(t));else{var o=n.search(i);if(o.features.length){var s=ao(i,o);t=t.filter(function(a){return a.id!==s.id}),n.remove(s),gn(ar(s,i),function(a){t.push(a),n.insert(a)})}}}),et(t)}function ar(r,e){var t=[],n=He(r)[0],i=He(r)[r.geometry.coordinates.length-1];if(Gn(n,tt(e))||Gn(i,tt(e)))return et([r]);var o=Ct(),s=rr(r);o.load(s);var a=o.search(e);if(!a.features.length)return et([r]);var l=ao(e,a),u=[n],p=Po(s,function(d,c,f){var h=He(c)[1],g=tt(e);return f===l.id?(d.push(g),t.push(Lt(d)),Gn(g,h)?[g]:[g,h]):(d.push(h),d)},u);return p.length>1&&t.push(Lt(p)),et(t)}function ao(r,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var t,n=1/0;return gn(e,function(i){var o=Vt(i,r),s=o.properties.dist;s<n&&(t=i,n=s)}),t}function Gn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Hu(r,e,t){var n=He(t);if(nr(t)!=="LineString")throw new Error("line must be a LineString");var i=Vt(t,r),o=Vt(t,e),s;i.properties.index<=o.properties.index?s=[i,o]:s=[o,i];for(var a=[s[0].geometry.coordinates],l=s[0].properties.index+1;l<s[1].properties.index+1;l++)a.push(n[l]);return a.push(s[1].geometry.coordinates),Lt(a,t.properties)}function wi(r){let e;return{c(){e=E("ul"),e.innerHTML=`<li><b>Click</b> near a route to split it</li> 
    <li><b>Click</b> on the map or press <b>Escape</b> to cancel</li>`},m(t,n){w(t,e,n)},d(t){t&&k(e)}}}function zu(r){let e,t,n,i=r[0]==Ht&&wi();return{c(){i&&i.c(),e=de()},m(o,s){i&&i.m(o,s),w(o,e,s),t||(n=U(window,"keydown",r[1]),t=!0)},p(o,[s]){o[0]==Ht?i||(i=wi(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:H,o:H,d(o){i&&i.d(o),o&&k(e),t=!1,n()}}}const Ht="split-route",Ju=10,Yu=30;let Hn="split-route";function uo(){}function ki(r,e){return{type:"Feature",properties:{snapped:e},geometry:{type:"Point",coordinates:r}}}function Xu(r,e,t){let n,i;te(r,ne,g=>t(8,n=g)),te(r,Ie,g=>t(6,i=g));let{mode:o}=e,{changeMode:s}=e;function a(){t(5,l=null),u=null}let l=null,u=null;i.on("mousemove",p),i.on("click",d),it(()=>{i.off("mousemove",p),i.off("click",d)}),Xe(i,Hn,Pe()),ke(i,{id:"draw-split-route",source:Hn,...ut("black",Ju,["case",["==",["get","snapped"],!0],1,.5])});function p(g){if(o!=Ht)return;t(5,l=ki(g.lngLat.toArray(),!1)),u=null;const m=[g.point.x-Yu,g.point.y],v=i.unproject(g.point).distanceTo(i.unproject(m))/1e3;let _=[];for(let[b,y]of n.features.entries())if(y.geometry.type=="LineString"){let M=Vt(y.geometry,l,{units:"kilometers"});M.properties.dist!=null&&M.properties.dist<=v&&_.push([b,M.geometry.coordinates,M.properties.dist])}_.sort((b,y)=>b[2]-y[2]),_.length>0&&(t(5,l=ki(_[0][1],!0)),u=_[0][0])}function d(){if(o==Ht)if(u==null)s("edit-attribute");else{let g=Gu(n.features[u],l);if(g.features.length==2){let m=g.features[0],v=g.features[1];ne.update(_=>(m.id=_.features[u].id,v.id=Zt(_),m.properties=JSON.parse(JSON.stringify(_.features[u].properties)),v.properties=JSON.parse(JSON.stringify(m.properties)),c(_.features[u],m,v,l),_.features.splice(u,1,m,v),_))}a()}}function c(g,m,v,_){m.properties.length_meters=un(m,{units:"kilometers"})*1e3,v.properties.length_meters=un(v,{units:"kilometers"})*1e3,m.properties.waypoints=[],v.properties.waypoints=[];let b=f(g,_),y=!0,M=0;for(let R of g.properties.waypoints){let T=f(g,Et([R.lon,R.lat]));if(y)if(T<b)m.properties.waypoints.push(R);else{let A=R.snapped&&g.properties.waypoints[M-1].snapped;m.properties.waypoints.push({lon:_.geometry.coordinates[0],lat:_.geometry.coordinates[1],snapped:A}),y=!1,v.properties.waypoints.push({lon:_.geometry.coordinates[0],lat:_.geometry.coordinates[1],snapped:A}),v.properties.waypoints.push(R)}else v.properties.waypoints.push(R);M++}}function f(g,m){let v=g.geometry.coordinates[0],_=Hu(v,m,g);return un(_,{units:"kilometers"})*1e3}function h(g){o==Ht&&g.key=="Escape"&&(s("edit-attribute"),g.preventDefault())}return r.$$set=g=>{"mode"in g&&t(0,o=g.mode),"changeMode"in g&&t(2,s=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&96){let g=Pe();l&&g.features.push(l),i.getSource(Hn).setData(g)}},[o,h,s,uo,a,l,i]}class Wu extends K{constructor(e){super(),Z(this,e,Xu,zu,W,{mode:0,changeMode:2,start:3,stop:4})}get start(){return uo}get stop(){return this.$$.ctx[4]}}const{window:Vu}=Fo;function Si(r){let e,t,n,i,o,s,a,l,u,p,d,c,f;return{c(){e=E("label"),t=E("input"),n=X(`
    Google Street View`),i=C(),o=E("br"),s=C(),a=E("label"),l=E("input"),u=X(`
    Bing Streetside`),p=C(),d=E("ul"),d.innerHTML=`<li><b>Click</b> on the map to open imagery</li> 
    <li>Press <b>Escape</b> to cancel</li>`,O(t,"type","radio"),t.__value="google",t.value=t.__value,r[9][0].push(t),O(l,"type","radio"),l.__value="bing",l.value=l.__value,r[9][0].push(l)},m(h,g){w(h,e,g),S(e,t),t.checked=t.__value===r[1],S(e,n),w(h,i,g),w(h,o,g),w(h,s,g),w(h,a,g),S(a,l),l.checked=l.__value===r[1],S(a,u),w(h,p,g),w(h,d,g),c||(f=[U(t,"change",r[8]),U(l,"change",r[10])],c=!0)},p(h,g){g&2&&(t.checked=t.__value===h[1]),g&2&&(l.checked=l.__value===h[1])},d(h){h&&k(e),r[9][0].splice(r[9][0].indexOf(t),1),h&&k(i),h&&k(o),h&&k(s),h&&k(a),r[9][0].splice(r[9][0].indexOf(l),1),h&&k(p),h&&k(d),c=!1,Fe(f)}}}function Ku(r){let e,t,n,i=r[0]==zt&&Si(r);return{c(){i&&i.c(),e=de()},m(o,s){i&&i.m(o,s),w(o,e,s),t||(n=U(Vu,"keydown",r[2]),t=!0)},p(o,[s]){o[0]==zt?i?i.p(o,s):(i=Si(o),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:H,o:H,d(o){i&&i.d(o),o&&k(e),t=!1,n()}}}const zt="street-view",Zu=10;let zn="street-view";function fo(){}function Qu(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:r}}}function ef(r,e,t){let n;te(r,Ie,g=>t(7,n=g));let{mode:i}=e,{changeMode:o}=e,s="google";function a(){t(6,l=null)}let l=null;n.on("mousemove",u),n.on("click",p),it(()=>{n.off("mousemove",u),n.off("click",p)}),Xe(n,zn,Pe()),ke(n,{id:"draw-street-view",source:zn,...ut("black",Zu,1)});function u(g){i==zt&&t(6,l=Qu(g.lngLat.toArray()))}function p(){if(i!=zt)return;let[g,m]=l.geometry.coordinates;s=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${m},${g}&cbp=11,0,0,0,0`,"_blank"):window.open(`https://www.bing.com/maps?cp=${m}~${g}&style=x`,"_blank")}function d(g){i==zt&&g.key=="Escape"&&(o("edit-attribute"),g.preventDefault())}const c=[[]];function f(){s=this.__value,t(1,s)}function h(){s=this.__value,t(1,s)}return r.$$set=g=>{"mode"in g&&t(0,i=g.mode),"changeMode"in g&&t(3,o=g.changeMode)},r.$$.update=()=>{if(r.$$.dirty&192){let g=Pe();l&&g.features.push(l),n.getSource(zn).setData(g)}},[i,s,d,o,fo,a,l,n,f,c,h]}class tf extends K{constructor(e){super(),Z(this,e,ef,Ku,W,{mode:0,changeMode:3,start:4,stop:5})}get start(){return fo}get stop(){return this.$$.ctx[5]}}const nf="/atip/streetview/assets/edit_attributes-29b396e1.svg",rf="/atip/streetview/assets/edit_geometry-02dad294.svg",of="/atip/streetview/assets/point-276f4055.svg",sf="/atip/streetview/assets/polygon_snapped-18efbbea.svg",lf="/atip/streetview/assets/polygon_freehand-cf965967.svg",af="/atip/streetview/assets/route-d3c0ebad.svg",uf="/atip/streetview/assets/split_route-9e0ea2da.svg",ff="/atip/streetview/assets/street_view-48580b6a.svg";function Ei(r){let e,t,n={mode:r[3],pointTool:r[12],polygonTool:r[13],routeTool:r[2]};return e=new Eu({props:n}),r[16](e),{c(){I(e.$$.fragment)},m(i,o){N(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){r[16](null),x(e,i)}}}function Mi(r){let e,t;return e=new Ke({props:{mode:r[3],thisMode:"point",label:"New point",icon:of,changeMode:r[14]}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function $i(r){let e,t,n={mode:r[3],changeMode:r[14],routeTool:r[2]};return e=new Du({props:n}),r[19](e),{c(){I(e.$$.fragment)},m(i,o){N(e,i,o),t=!0},p(i,o){const s={};o&8&&(s.mode=i[3]),o&4&&(s.routeTool=i[2]),e.$set(s)},i(i){t||($(e.$$.fragment,i),t=!0)},o(i){L(e.$$.fragment,i),t=!1},d(i){r[19](null),x(e,i)}}}function Li(r){let e,t;return e=new Ke({props:{mode:r[3],thisMode:"route",label:"New route",icon:af,changeMode:r[14]}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function Oi(r){let e,t;return e=new Ke({props:{mode:r[3],thisMode:"split-route",label:"Split route",icon:uf,changeMode:r[14]}}),{c(){I(e.$$.fragment)},m(n,i){N(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.mode=n[3]),e.$set(o)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){x(e,n)}}}function cf(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,h,g,m,v,_,b,y,M,R,T,A,B,D,G,F,P,J,ie,Ae,Le,Se,Te,Ee,Me;n=new Ke({props:{mode:r[3],thisMode:"edit-attribute",label:"Edit attributes",icon:nf,changeMode:r[14]}});let ge={mode:r[3],changeMode:r[14]};o=new tu({props:ge}),r[15](o),l=new Ke({props:{mode:r[3],thisMode:"edit-geometry",label:"Edit geometry",icon:rf,changeMode:r[14]}});let ce=r[2]&&Ei(r),he=r[1]!="planning"&&Mi(r),_e={mode:r[3],changeMode:r[14],pointTool:r[12]};f=new Pu({props:_e}),r[17](f),m=new Ke({props:{mode:r[3],thisMode:"free-polygon",label:"New polygon (freehand)",icon:lf,changeMode:r[14]}});let j={mode:r[3],changeMode:r[14],polygonTool:r[13]};_=new Nu({props:j}),r[18](_),M=new Ke({props:{mode:r[3],thisMode:"snap-polygon",label:"New polygon (snapped)",icon:sf,changeMode:r[14]}});let z=r[2]&&$i(r),be=r[1]!="planning"&&Li(r);function co(q){r[21](q)}let mr={mode:r[3],changeMode:r[14],url:r[0]};r[2]!==void 0&&(mr.routeTool=r[2]),D=new Ru({props:mr}),r[20](D),oe.push(()=>Oe(D,"routeTool",co,r[2]));let ve=r[1]!="planning"&&Oi(r),po={mode:r[3],changeMode:r[14]};ie=new Wu({props:po}),r[22](ie),Se=new Ke({props:{mode:r[3],thisMode:"street-view",label:"Street View",icon:ff,changeMode:r[14]}});let ho={mode:r[3],changeMode:r[14]};return Ee=new tf({props:ho}),r[23](Ee),{c(){e=E("div"),t=E("div"),I(n.$$.fragment),i=C(),I(o.$$.fragment),s=C(),a=E("div"),I(l.$$.fragment),u=C(),ce&&ce.c(),p=C(),d=E("div"),he&&he.c(),c=C(),I(f.$$.fragment),h=C(),g=E("div"),I(m.$$.fragment),v=C(),I(_.$$.fragment),b=C(),y=E("div"),I(M.$$.fragment),R=C(),z&&z.c(),T=C(),A=E("div"),be&&be.c(),B=C(),I(D.$$.fragment),F=C(),P=E("div"),ve&&ve.c(),J=C(),I(ie.$$.fragment),Ae=C(),Le=E("div"),I(Se.$$.fragment),Te=C(),I(Ee.$$.fragment),O(e,"class","toolbox svelte-4s4d3o")},m(q,se){w(q,e,se),S(e,t),N(n,t,null),S(t,i),N(o,t,null),S(e,s),S(e,a),N(l,a,null),S(a,u),ce&&ce.m(a,null),S(e,p),S(e,d),he&&he.m(d,null),S(d,c),N(f,d,null),S(e,h),S(e,g),N(m,g,null),S(g,v),N(_,g,null),S(e,b),S(e,y),N(M,y,null),S(y,R),z&&z.m(y,null),S(e,T),S(e,A),be&&be.m(A,null),S(A,B),N(D,A,null),S(e,F),S(e,P),ve&&ve.m(P,null),S(P,J),N(ie,P,null),S(e,Ae),S(e,Le),N(Se,Le,null),S(Le,Te),N(Ee,Le,null),Me=!0},p(q,[se]){const _r={};se&8&&(_r.mode=q[3]),n.$set(_r);const gr={};se&8&&(gr.mode=q[3]),o.$set(gr);const br={};se&8&&(br.mode=q[3]),l.$set(br),q[2]?ce?(ce.p(q,se),se&4&&$(ce,1)):(ce=Ei(q),ce.c(),$(ce,1),ce.m(a,null)):ce&&(ae(),L(ce,1,1,()=>{ce=null}),ue()),q[1]!="planning"?he?(he.p(q,se),se&2&&$(he,1)):(he=Mi(q),he.c(),$(he,1),he.m(d,c)):he&&(ae(),L(he,1,1,()=>{he=null}),ue());const vr={};se&8&&(vr.mode=q[3]),f.$set(vr);const yr={};se&8&&(yr.mode=q[3]),m.$set(yr);const wr={};se&8&&(wr.mode=q[3]),_.$set(wr);const kr={};se&8&&(kr.mode=q[3]),M.$set(kr),q[2]?z?(z.p(q,se),se&4&&$(z,1)):(z=$i(q),z.c(),$(z,1),z.m(y,null)):z&&(ae(),L(z,1,1,()=>{z=null}),ue()),q[1]!="planning"?be?(be.p(q,se),se&2&&$(be,1)):(be=Li(q),be.c(),$(be,1),be.m(A,B)):be&&(ae(),L(be,1,1,()=>{be=null}),ue());const en={};se&8&&(en.mode=q[3]),se&1&&(en.url=q[0]),!G&&se&4&&(G=!0,en.routeTool=q[2],Ce(()=>G=!1)),D.$set(en),q[1]!="planning"?ve?(ve.p(q,se),se&2&&$(ve,1)):(ve=Oi(q),ve.c(),$(ve,1),ve.m(P,J)):ve&&(ae(),L(ve,1,1,()=>{ve=null}),ue());const Sr={};se&8&&(Sr.mode=q[3]),ie.$set(Sr);const Er={};se&8&&(Er.mode=q[3]),Se.$set(Er);const Mr={};se&8&&(Mr.mode=q[3]),Ee.$set(Mr)},i(q){Me||($(n.$$.fragment,q),$(o.$$.fragment,q),$(l.$$.fragment,q),$(ce),$(he),$(f.$$.fragment,q),$(m.$$.fragment,q),$(_.$$.fragment,q),$(M.$$.fragment,q),$(z),$(be),$(D.$$.fragment,q),$(ve),$(ie.$$.fragment,q),$(Se.$$.fragment,q),$(Ee.$$.fragment,q),Me=!0)},o(q){L(n.$$.fragment,q),L(o.$$.fragment,q),L(l.$$.fragment,q),L(ce),L(he),L(f.$$.fragment,q),L(m.$$.fragment,q),L(_.$$.fragment,q),L(M.$$.fragment,q),L(z),L(be),L(D.$$.fragment,q),L(ve),L(ie.$$.fragment,q),L(Se.$$.fragment,q),L(Ee.$$.fragment,q),Me=!1},d(q){q&&k(e),x(n),r[15](null),x(o),x(l),ce&&ce.d(),he&&he.d(),r[17](null),x(f),x(m),r[18](null),x(_),x(M),z&&z.d(),be&&be.d(),r[20](null),x(D),ve&&ve.d(),r[22](null),x(ie),x(Se),r[23](null),x(Ee)}}}function pf(r,e,t){let n;te(r,Ie,F=>t(24,n=F));let{routeSnapperUrl:i}=e,{schema:o}=e,s,a=new La(n),l=new Da(n),u="edit-attribute",p,d,c,f,h,g,m,v;function _(F){let P={"edit-attribute":p,"edit-geometry":d,route:c,point:f,"free-polygon":h,"snap-polygon":g,"split-route":m,"street-view":v};if(u==F){console.log(`Mode is already ${u}, not changing`);return}console.log(`Stopping old mode ${u}`),P[u].stop(),t(3,u=F),console.log(`Starting new mode ${u}`),P[u].start()}it(()=>{a==null||a.tearDown(),l==null||l.tearDown(),s==null||s.tearDown()});function b(F){oe[F?"unshift":"push"](()=>{p=F,t(4,p)})}function y(F){oe[F?"unshift":"push"](()=>{d=F,t(5,d)})}function M(F){oe[F?"unshift":"push"](()=>{f=F,t(7,f)})}function R(F){oe[F?"unshift":"push"](()=>{h=F,t(8,h)})}function T(F){oe[F?"unshift":"push"](()=>{g=F,t(9,g)})}function A(F){oe[F?"unshift":"push"](()=>{c=F,t(6,c)})}function B(F){s=F,t(2,s)}function D(F){oe[F?"unshift":"push"](()=>{m=F,t(10,m)})}function G(F){oe[F?"unshift":"push"](()=>{v=F,t(11,v)})}return r.$$set=F=>{"routeSnapperUrl"in F&&t(0,i=F.routeSnapperUrl),"schema"in F&&t(1,o=F.schema)},[i,o,s,u,p,d,c,f,h,g,m,v,a,l,_,b,y,M,R,T,A,B,D,G]}class df extends K{constructor(e){super(),Z(this,e,pf,cf,W,{routeSnapperUrl:0,schema:1})}}function hf(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,h,g,m,v,_,b;return{c(){e=E("div"),t=E("div"),n=E("button"),n.textContent="Home",i=C(),o=E("button"),o.textContent="About",s=C(),a=E("button"),a.textContent="Instructions",l=C(),u=E("br"),p=C(),d=E("label"),c=X(`ATIP schema:
      `),f=E("select"),h=E("option"),h.textContent="v1",g=E("option"),g.textContent="v2",m=E("option"),m.textContent="Housing developments",v=E("option"),v.textContent="Critical issues",O(n,"type","button"),O(o,"type","button"),O(a,"type","button"),h.__value="v1",h.value=h.__value,g.__value="v2",g.value=g.__value,m.__value="planning",m.value=m.__value,v.__value="criticals",v.value=v.__value,r[2]===void 0&&at(()=>r[11].call(f)),O(e,"slot","nav")},m(y,M){w(y,e,M),S(e,t),S(t,n),S(t,i),S(t,o),S(t,s),S(t,a),S(e,l),S(e,u),S(e,p),S(e,d),S(d,c),S(d,f),S(f,h),S(f,g),S(f,m),S(f,v),nt(f,r[2]),_||(b=[U(n,"click",r[10]),U(o,"click",r[7]),U(a,"click",r[8]),U(f,"change",r[11]),U(f,"change",r[9])],_=!0)},p(y,M){M&4&&nt(f,y[2])},d(y){y&&k(e),_=!1,Fe(b)}}}function mf(r){let e,t,n,i,o,s,a,l,u,p,d,c,f,h,g,m;return o=new ca({props:{boundaryGeojson:r[4]}}),a=new la({props:{authorityName:r[5],schema:r[2]}}),d=new Ql({props:{schema:r[2]}}),g=new na({}),{c(){e=E("div"),t=E("h1"),n=X(r[5]),i=C(),I(o.$$.fragment),s=C(),I(a.$$.fragment),l=C(),u=E("br"),p=C(),I(d.$$.fragment),c=C(),f=E("hr"),h=C(),I(g.$$.fragment),O(e,"slot","sidebar")},m(v,_){w(v,e,_),S(e,t),S(t,n),S(t,i),N(o,t,null),S(e,s),N(a,e,null),S(e,l),S(e,u),S(e,p),N(d,e,null),S(e,c),S(e,f),S(e,h),N(g,e,null),m=!0},p(v,_){const b={};_&16&&(b.boundaryGeojson=v[4]),o.$set(b);const y={};_&4&&(y.schema=v[2]),a.$set(y);const M={};_&4&&(M.schema=v[2]),d.$set(M)},i(v){m||($(o.$$.fragment,v),$(a.$$.fragment,v),$(d.$$.fragment,v),$(g.$$.fragment,v),m=!0)},o(v){L(o.$$.fragment,v),L(a.$$.fragment,v),L(d.$$.fragment,v),L(g.$$.fragment,v),m=!1},d(v){v&&k(e),x(o),x(a),x(d),x(g)}}}function _f(r){let e,t,n,i,o,s,a,l,u,p,d,c;return e=new Hs({props:{boundaryGeojson:r[4]}}),n=new Ea({props:{schema:r[2]}}),o=new $a({}),a=new df({props:{routeSnapperUrl:r[3],schema:r[2]}}),u=new ha({props:{style:r[6]}}),d=new ka({props:{schema:r[2]}}),{c(){I(e.$$.fragment),t=C(),I(n.$$.fragment),i=C(),I(o.$$.fragment),s=C(),I(a.$$.fragment),l=C(),I(u.$$.fragment),p=C(),I(d.$$.fragment)},m(f,h){N(e,f,h),w(f,t,h),N(n,f,h),w(f,i,h),N(o,f,h),w(f,s,h),N(a,f,h),w(f,l,h),N(u,f,h),w(f,p,h),N(d,f,h),c=!0},p(f,h){const g={};h&16&&(g.boundaryGeojson=f[4]),e.$set(g);const m={};h&4&&(m.schema=f[2]),n.$set(m);const v={};h&8&&(v.routeSnapperUrl=f[3]),h&4&&(v.schema=f[2]),a.$set(v);const _={};h&4&&(_.schema=f[2]),d.$set(_)},i(f){c||($(e.$$.fragment,f),$(n.$$.fragment,f),$(o.$$.fragment,f),$(a.$$.fragment,f),$(u.$$.fragment,f),$(d.$$.fragment,f),c=!0)},o(f){L(e.$$.fragment,f),L(n.$$.fragment,f),L(o.$$.fragment,f),L(a.$$.fragment,f),L(u.$$.fragment,f),L(d.$$.fragment,f),c=!1},d(f){x(e,f),f&&k(t),x(n,f),f&&k(i),x(o,f),f&&k(s),x(a,f),f&&k(l),x(u,f),f&&k(p),x(d,f)}}}function gf(r){let e,t,n;return t=new cs({props:{style:r[6],$$slots:{default:[_f]},$$scope:{ctx:r}}}),{c(){e=E("div"),I(t.$$.fragment),O(e,"slot","main")},m(i,o){w(i,e,o),N(t,e,null),n=!0},p(i,o){const s={};o&524316&&(s.$$scope={dirty:o,ctx:i}),t.$set(s)},i(i){n||($(t.$$.fragment,i),n=!0)},o(i){L(t.$$.fragment,i),n=!1},d(i){i&&k(e),x(t)}}}function bf(r){let e,t,n,i,o,s,a,l;e=new gs({props:{$$slots:{main:[gf],sidebar:[mf],nav:[hf]},$$scope:{ctx:r}}});function u(f){r[12](f)}let p={};r[0]!==void 0&&(p.open=r[0]),n=new Io({props:p}),oe.push(()=>Oe(n,"open",u,r[0]));function d(f){r[13](f)}let c={};return r[1]!==void 0&&(c.open=r[1]),s=new as({props:c}),oe.push(()=>Oe(s,"open",d,r[1])),{c(){I(e.$$.fragment),t=C(),I(n.$$.fragment),o=C(),I(s.$$.fragment)},m(f,h){N(e,f,h),w(f,t,h),N(n,f,h),w(f,o,h),N(s,f,h),l=!0},p(f,[h]){const g={};h&524316&&(g.$$scope={dirty:h,ctx:f}),e.$set(g);const m={};!i&&h&1&&(i=!0,m.open=f[0],Ce(()=>i=!1)),n.$set(m);const v={};!a&&h&2&&(a=!0,v.open=f[1],Ce(()=>a=!1)),s.$set(v)},i(f){l||($(e.$$.fragment,f),$(n.$$.fragment,f),$(s.$$.fragment,f),l=!0)},o(f){L(e.$$.fragment,f),L(n.$$.fragment,f),L(s.$$.fragment,f),l=!1},d(f){x(e,f),f&&k(t),x(n,f),f&&k(o),x(s,f)}}}function vf(r,e,t){let n;te(r,bn,R=>t(15,n=R));let i=!1,o=!1,s=window.location.hostname.includes("atip.uk");const a=new URLSearchParams(window.location.search);let l=a.get("authority"),u=a.get("style")||"streets",p=a.get("schema")||"v1";var d=`https://atip.uk/route-snappers/${l}.bin`,c=`https://atip.uk/route-info/${l}.bin`;s||(d=`https://atip.uk/route-snappers-dev/${l}.bin`,c=`https://atip.uk/route-info-dev/${l}.bin`);function f(){t(0,i=!i),t(1,o=!1)}function h(){t(1,o=!o),t(0,i=!1)}let g;Kt(async()=>{t(4,g=await m());const R=Fi(new Wo);bn.set(await new R),await n.loadFile(c)});async function m(){const T=await(await fetch(No)).text(),A=JSON.parse(T);return A.features=A.features.filter(B=>{var D;return((D=B.properties)==null?void 0:D.name)==l}),A}function v(){let R=new URLSearchParams(window.location.search);R.set("schema",p);let T=`${window.location.pathname}?${R.toString()}${window.location.hash}`;window.location.href=T}const _=()=>window.open("index.html");function b(){p=Cn(this),t(2,p)}function y(R){i=R,t(0,i)}function M(R){o=R,t(1,o)}return[i,o,p,d,g,l,u,f,h,v,_,b,y,M]}class yf extends K{constructor(e){super(),Z(this,e,vf,bf,W,{})}}new yf({target:document.getElementById("app")});
