import{S as ce,i as me,s as pe,c as re,m as de,a as be,b as we,d as ge,o as he,e as $e,L as ke,f as Le,E as ae,F as Ae,R as Se,g as U,h as se,j as C,k as y,l as Ee,n as L,p as T,q as O,r as c,t as A,u as ie,v as w,w as k,x as Me,y as J,z as S,A as ye,B as le,C as Fe,D as Ce,G as Te,H as Ie,I as De,J as Be,K as je}from"./index-3ec9c09a.js";import{D as He}from"./DefaultButton-b2a1fe5a.js";import{A as Oe}from"./About-d5fcbbcd.js";import{F as Je}from"./FileInput-a5f92696.js";function Ne(n,t,e){let o,f;re(n,de,a=>e(6,o=a)),re(n,be,a=>e(7,f=a));const E=we();let{layer:s}=t,{clickable:i}=t,{tooltip:v=null}=t,{show:g=!0}=t,{ignoreHigherLayers:b=[]}=t,{hoveredFeature:l=null}=t,M=new ge.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"none"});he(()=>{o.on("mousemove",s,$),o.on("mouseleave",s,I),i&&o.on("click",s,j)}),$e(()=>{o.off("mousemove",s,$),o.off("mouseleave",s,I),i&&o.off("click",s,j),_(),M.remove()});function $(a){if(!f)return;let u=a.features??[];if(u.length!=0){if(u[0].id||console.log(`Features in the ${s} layer don't have IDs; InteractiveLayer won't work`),H(a)){I();return}if((l==null?void 0:l.id)!=u[0].id){if(_(),e(0,l=u[0]),o.setFeatureState(l,{hover:!0}),v){let m=`<div class="govuk-prose">${v(l)}</div>`;M.setLngLat(a.lngLat).setHTML(m).addTo(o)}i&&(o.getCanvas().style.cursor="pointer")}else v&&M.setLngLat(a.lngLat)}}function I(){f&&(_(),e(0,l=null),M.remove(),i&&(o.getCanvas().style.cursor="inherit"))}function _(){l&&o.setFeatureState(l,{hover:!1})}function j(a){if(!f)return;let u=a.features??[];if(u.length>0){if(H(a))return;E("click",u[0])}}function H(a){for(let u of o.queryRenderedFeatures(a.point)){if(u.layer.id==s)return!1;if(!b.includes(u.layer.id))return!0}return!1}return n.$$set=a=>{"layer"in a&&e(1,s=a.layer),"clickable"in a&&e(2,i=a.clickable),"tooltip"in a&&e(3,v=a.tooltip),"show"in a&&e(4,g=a.show),"ignoreHigherLayers"in a&&e(5,b=a.ignoreHigherLayers),"hoveredFeature"in a&&e(0,l=a.hoveredFeature)},n.$$.update=()=>{n.$$.dirty&82&&o.getLayer(s)&&o.setLayoutProperty(s,"visibility",g?"visible":"none")},[l,s,i,v,g,b,o]}class Pe extends ce{constructor(t){super(),me(this,t,Ne,null,pe,{layer:1,clickable:2,tooltip:3,show:4,ignoreHigherLayers:5,hoveredFeature:0})}}function Re(n){let t;return{c(){t=ye("About")},m(e,o){O(e,t,o)},d(e){e&&J(t)}}}function qe(n){let t,e,o,f,E;return{c(){t=C("input"),e=y(),o=C("datalist"),T(t,"class","govuk-input govuk-input--width-20"),T(t,"id","inputValue"),T(t,"data-testid","transport-authority"),T(t,"list","authorities-list"),T(o,"id","authorities-list")},m(s,i){O(s,t,i),le(t,n[0]),O(s,e,i),O(s,o,i),n[12](o),f||(E=Fe(t,"input",n[11]),f=!0)},p(s,i){i&1&&t.value!==s[0]&&le(t,s[0])},d(s){s&&(J(t),J(e),J(o)),n[12](null),f=!1,E()}}}function Ge(n){let t;return{c(){t=ye("Start")},m(e,o){O(e,t,o)},d(e){e&&J(t)}}}function ue(n){let t,e;return t=new Pe({props:{layer:z,clickable:!0,tooltip:Ke}}),t.$on("click",ze),{c(){L(t.$$.fragment)},m(o,f){A(t,o,f),e=!0},p:Ce,i(o){e||(w(t.$$.fragment,o),e=!0)},o(o){k(t.$$.fragment,o),e=!1},d(o){S(t,o)}}}function Ve(n){let t,e,o,f,E,s,i,v,g,b,l,M,$,I,_,j,H,a,u,m,p,D,F,N,K,P,Z,R,Q,G,B,V,q;i=new ke({}),g=new Le({props:{$$slots:{default:[Re]},$$scope:{ctx:n}}}),g.$on("click",n[10]),l=new ae({props:{errorMessage:n[2]}}),$=new Ae({props:{label:"Select Transport Authority or Local Authority District",id:"inputValue",$$slots:{default:[qe]},$$scope:{ctx:n}}}),_=new He({props:{disabled:!n[6],$$slots:{default:[Ge]},$$scope:{ctx:n}}}),_.$on("click",n[9]);function _e(r){n[13](r)}let X={legend:"Or pick from the map",id:"showBoundaries",choices:[["TA","Transport Authorities"],["LAD","Local Authority Districts"]],inlineSmall:!0};n[5]!==void 0&&(X.value=n[5]),u=new Se({props:X}),U.push(()=>se(u,"value",_e)),u.$on("change",n[7]),N=new ae({props:{errorMessage:We}}),P=new Je({props:{label:"Or upload an ATIP GeoJSON file",loadFile:n[8],id:"load-geojson"}});let d=n[4]&&ue();function ve(r){n[14](r)}let Y={};return n[1]!==void 0&&(Y.open=n[1]),B=new Oe({props:Y}),U.push(()=>se(B,"open",ve)),{c(){t=C("div"),e=C("div"),o=C("h1"),o.textContent="Welcome to ATIP v2",f=y(),E=C("p"),E.textContent=`App version: ${Ee()}`,s=y(),L(i.$$.fragment),v=y(),L(g.$$.fragment),b=y(),L(l.$$.fragment),M=y(),L($.$$.fragment),I=y(),L(_.$$.fragment),j=y(),H=C("hr"),a=y(),L(u.$$.fragment),p=y(),D=C("hr"),F=y(),L(N.$$.fragment),K=y(),L(P.$$.fragment),Z=y(),R=C("div"),R.innerHTML='<div id="map" class="svelte-lyn11h"></div>',Q=y(),d&&d.c(),G=y(),L(B.$$.fragment),T(o,"class","govuk-heading-l"),T(e,"class","govuk-grid-column-one-half left svelte-lyn11h"),T(R,"class","govuk-grid-column-one-half"),T(t,"class","govuk-grid-row")},m(r,h){O(r,t,h),c(t,e),c(e,o),c(e,f),c(e,E),c(e,s),A(i,e,null),c(e,v),A(g,e,null),c(e,b),A(l,e,null),c(e,M),A($,e,null),c(e,I),A(_,e,null),c(e,j),c(e,H),c(e,a),A(u,e,null),c(e,p),c(e,D),c(e,F),A(N,e,null),c(e,K),A(P,e,null),c(t,Z),c(t,R),c(t,Q),d&&d.m(t,null),O(r,G,h),A(B,r,h),q=!0},p(r,[h]){const x={};h&131072&&(x.$$scope={dirty:h,ctx:r}),g.$set(x);const ee={};h&4&&(ee.errorMessage=r[2]),l.$set(ee);const te={};h&131081&&(te.$$scope={dirty:h,ctx:r}),$.$set(te);const W={};h&64&&(W.disabled=!r[6]),h&131072&&(W.$$scope={dirty:h,ctx:r}),_.$set(W);const ne={};!m&&h&32&&(m=!0,ne.value=r[5],ie(()=>m=!1)),u.$set(ne),r[4]?d?(d.p(r,h),h&16&&w(d,1)):(d=ue(),d.c(),w(d,1),d.m(t,null)):d&&(Te(),k(d,1,1,()=>{d=null}),Me());const oe={};!V&&h&2&&(V=!0,oe.open=r[1],ie(()=>V=!1)),B.$set(oe)},i(r){q||(w(i.$$.fragment,r),w(g.$$.fragment,r),w(l.$$.fragment,r),w($.$$.fragment,r),w(_.$$.fragment,r),w(u.$$.fragment,r),w(N.$$.fragment,r),w(P.$$.fragment,r),w(d),w(B.$$.fragment,r),q=!0)},o(r){k(i.$$.fragment,r),k(g.$$.fragment,r),k(l.$$.fragment,r),k($.$$.fragment,r),k(_.$$.fragment,r),k(u.$$.fragment,r),k(N.$$.fragment,r),k(P.$$.fragment,r),k(d),k(B.$$.fragment,r),q=!1},d(r){r&&(J(t),J(G)),S(i),S(g),S(l),S($),S(_),S(u),S(N),S(P),d&&d.d(),S(B,r)}}}let We="",fe="boundary",z="boundary-layer";function Ue(n){if(n.features.length>0){let t=n.features[0].properties;for(let e of["planning","v2","criticals"])if(t&&e in t)return e}return"v1"}function ze(n){window.location.href=`scheme.html?authority=${n.detail.properties.name}`}function Ke(n){return`<p>${n.properties.name}</p>`}function Ze(n,t,e){let o,f=!1,s=new URLSearchParams(window.location.search).get("error")||"",i,v,g=new Set,b=null,l="TA";function M(){b==null||b.setFilter(z,["==",["get","level"],l])}he(async()=>{Ie();const m=await De();for(let D of m.features){let F=document.createElement("option");F.value=D.properties.name,v.appendChild(F),g.add(D.properties.name)}let p=new ge.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});e(4,b=p),de.set(b),p.on("load",function(){p.fitBounds(Be(m),{padding:20,animate:!1}),p.addSource(fe,{type:"geojson",data:m,generateId:!0}),p.addLayer({id:z,source:fe,filter:["==",["get","level"],l],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":je(.8,.4)}})})});function $(m){try{let p=JSON.parse(m);if(!p.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!g.has(p.authority))throw new Error(`Unknown authority ${p.authority}`);let D=p.authority,F=Ue(p);F!="v1"&&(D+=`_${F}`),window.localStorage.setItem(D,JSON.stringify(p)),window.location.href=`scheme.html?authority=${p.authority}&schema=${F}`}catch(p){e(2,s=`Couldn't load scheme from a file: ${p}`)}}function I(){window.location.href=`scheme.html?authority=${i}`}const _=()=>e(1,f=!f);function j(){i=this.value,e(0,i)}function H(m){U[m?"unshift":"push"](()=>{v=m,e(3,v)})}function a(m){l=m,e(5,l)}function u(m){f=m,e(1,f)}return n.$$.update=()=>{n.$$.dirty&1&&e(6,o=g.has(i))},[i,f,s,v,b,l,o,M,$,I,_,j,H,a,u]}class Qe extends ce{constructor(t){super(),me(this,t,Ze,Ve,pe,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new Qe({target:document.getElementById("app")});
