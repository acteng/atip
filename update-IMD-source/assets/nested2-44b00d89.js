import{S as ce,i as he,s as fe,G as Le,f as P,h as E,C as ae,j as R,v as se,k as L,x as X,H as qe,I as le,q as W,J as Kn,K as Vn,L as Qn,M as er,c as I,m as x,l as T,N as Bt,O as Zl,P as cs,Q as Gl,R as Hl,T as de,E as hs,o as vt,e as D,t as q,a as z,d as U,b as re,g as B,A as je,U as qt,V as Yl,W as Xl,X as ql,Y as Ve,Z as We,r as we,u as Se,w as Pe,_ as vr,$ as wr,a0 as jt,a1 as hi,a2 as yr,a3 as hn,a4 as tt,a5 as Ye,a6 as _t,y as jn,a7 as Jl,a8 as Wl,a9 as dn,aa as ke,ab as Fr,ac as ao,ad as Jt,ae as _n,af as $e,ag as zr,ah as Bi,ai as Pt,aj as ji,ak as Kl,al as so,am as nt,an as di,ao as Vl,ap as Ql,aq as Ke,ar as Ar,as as lo,at as St,au as ds,av as Wt,aw as fo,F as _s,ax as ef,ay as uo,B as tf,n as nf,D as rf,az as of}from"./index-5530d5ab.js";import{H as af,E as sf}from"./Header-d053ff40.js";import{s as lf,b as ff,g as ps,h as uf,e as Fe,u as gs,o as ms}from"./files-52ca36c8.js";import{b as cf,c as Et}from"./config-ec6e75b7.js";import{S as Ue,B as bs}from"./SecondaryButton-ebdfc1b1.js";import{m as Ze,l as ge,C as hf,M as co,a as df,S as _f}from"./Modal-b8e2e3f7.js";import{g as Qe,a as et}from"./spread-8a54911c.js";import{b as vs,M as Ht,e as it,i as Rn,a as _i,c as pi,C as Rr,d as pf,f as gf,S as mf,H as wn,g as bf,W as vf,B as wf,G as yf}from"./WarningIcon-57c256ce.js";import{g as ws,u as $f,r as kf,b as Sf,c as Ef,d as Mf,G as It,F as Ui,a as xt,P as Zi,e as Dr,f as Gi,M as Af,L as Rf}from"./MapLibreMap-4f18277f.js";import{D as wt}from"./DefaultButton-1a7dd6be.js";import{a as Pf,E as tr,F as Lf}from"./Radio-2208f479.js";import{W as Br}from"./WarningButton-4077ad9d.js";function ho(t){let n=t[0],e,r,i=_o(t);return{c(){i.c(),e=Le()},m(o,a){i.m(o,a),P(o,e,a),r=!0},p(o,a){a&1&&fe(n,n=o[0])?(ae(),R(i,1,1,W),se(),i=_o(o),i.c(),E(i,1),i.m(e.parentNode,e)):i.p(o,a)},i(o){r||(E(i),r=!0)},o(o){R(i),r=!1},d(o){o&&L(e),i.d(o)}}}function _o(t){let n;const e=t[10].default,r=Kn(e,t,t[9],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),n=!0},p(i,o){r&&r.p&&(!n||o&512)&&Vn(r,e,i,i[9],n?er(e,i[9],o,null):Qn(i[9]),null)},i(i){n||(E(r,i),n=!0)},o(i){R(r,i),n=!1},d(i){r&&r.d(i)}}}function Nf(t){let n,e,r=t[0]&&ho(t);return{c(){r&&r.c(),n=Le()},m(i,o){r&&r.m(i,o),P(i,n,o),e=!0},p(i,[o]){i[0]?r?(r.p(i,o),o&1&&E(r,1)):(r=ho(i),r.c(),E(r,1),r.m(n.parentNode,n)):r&&(ae(),R(r,1,1,()=>{r=null}),se())},i(i){e||(E(r),e=!0)},o(i){R(r),e=!1},d(i){i&&L(n),r&&r.d(i)}}}function Cf(t,n,e){let r,i,{$$slots:o={},$$scope:a}=n,{id:s=ws("image")}=n,{url:f}=n,{coordinates:l}=n;const{map:u,self:c}=$f();X(t,u,d=>e(8,i=d)),X(t,c,d=>e(0,r=d));let h,_=!0;return qe(()=>{r&&i&&(kf(u,r,h),le(c,r=null,r),e(6,h=void 0))}),t.$$set=d=>{"id"in d&&e(3,s=d.id),"url"in d&&e(4,f=d.url),"coordinates"in d&&e(5,l=d.coordinates),"$$scope"in d&&e(9,a=d.$$scope)},t.$$.update=()=>{t.$$.dirty&313&&i&&r!==s&&(le(c,r=s,r),Sf(i,r,Ef({type:"image",url:f,coordinates:l}),d=>i&&d===r,()=>{r&&(e(6,h=i==null?void 0:i.getSource(r)),e(7,_=!0))})),t.$$.dirty&264&&(i==null||i.on("style.load",()=>{e(6,h=i==null?void 0:i.getSource(s))})),t.$$.dirty&224&&h&&(_?e(7,_=!1):h.setCoordinates(l))},[r,u,c,s,f,l,h,_,i,a,o]}class Of extends ce{constructor(n){super(),he(this,n,Cf,Nf,fe,{id:3,url:4,coordinates:5})}}function If(t){let n;const e=t[8].default,r=Kn(e,t,t[15],null);return{c(){r&&r.c()},m(i,o){r&&r.m(i,o),n=!0},p(i,o){r&&r.p&&(!n||o&32768)&&Vn(r,e,i,i[15],n?er(e,i[15],o,null):Qn(i[15]),null)},i(i){n||(E(r,i),n=!0)},o(i){R(r,i),n=!1},d(i){r&&r.d(i)}}}function xf(t){let n,e;return n=new Mf({props:{id:t[0],type:"raster",source:t[1],beforeId:t[2],beforeLayerType:t[3],paint:t[4],layout:t[5],minzoom:t[6],maxzoom:t[7],$$slots:{default:[If]},$$scope:{ctx:t}}}),n.$on("click",t[9]),n.$on("dblclick",t[10]),n.$on("contextmenu",t[11]),n.$on("mouseenter",t[12]),n.$on("mousemove",t[13]),n.$on("mouseleave",t[14]),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,[i]){const o={};i&1&&(o.id=r[0]),i&2&&(o.source=r[1]),i&4&&(o.beforeId=r[2]),i&8&&(o.beforeLayerType=r[3]),i&16&&(o.paint=r[4]),i&32&&(o.layout=r[5]),i&64&&(o.minzoom=r[6]),i&128&&(o.maxzoom=r[7]),i&32768&&(o.$$scope={dirty:i,ctx:r}),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Tf(t,n,e){let{$$slots:r={},$$scope:i}=n,{id:o=ws("raster-layer")}=n,{source:a=void 0}=n,{beforeId:s=void 0}=n,{beforeLayerType:f=void 0}=n,{paint:l}=n,{layout:u=void 0}=n,{minzoom:c=void 0}=n,{maxzoom:h=void 0}=n;function _(p){Bt.call(this,t,p)}function d(p){Bt.call(this,t,p)}function g(p){Bt.call(this,t,p)}function w(p){Bt.call(this,t,p)}function k(p){Bt.call(this,t,p)}function b(p){Bt.call(this,t,p)}return t.$$set=p=>{"id"in p&&e(0,o=p.id),"source"in p&&e(1,a=p.source),"beforeId"in p&&e(2,s=p.beforeId),"beforeLayerType"in p&&e(3,f=p.beforeLayerType),"paint"in p&&e(4,l=p.paint),"layout"in p&&e(5,u=p.layout),"minzoom"in p&&e(6,c=p.minzoom),"maxzoom"in p&&e(7,h=p.maxzoom),"$$scope"in p&&e(15,i=p.$$scope)},[o,a,s,f,l,u,c,h,r,_,d,g,w,k,b,i]}class Ff extends ce{constructor(n){super(),he(this,n,Tf,xf,fe,{id:0,source:1,beforeId:2,beforeLayerType:3,paint:4,layout:5,minzoom:6,maxzoom:7})}}let Y;const ys=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ys.decode();let Pn=null;function In(){return(Pn===null||Pn.byteLength===0)&&(Pn=new Uint8Array(Y.memory.buffer)),Pn}function Ge(t,n){return t=t>>>0,ys.decode(In().subarray(t,t+n))}const bt=new Array(128).fill(void 0);bt.push(void 0,null,!0,!1);let xn=bt.length;function pe(t){xn===bt.length&&bt.push(bt.length+1);const n=xn;return xn=bt[n],bt[n]=t,n}function ee(t){return bt[t]}function zf(t){t<132||(bt[t]=xn,xn=t)}function ln(t){const n=ee(t);return zf(t),n}function Yr(t){return t==null}let Ln=null;function Df(){return(Ln===null||Ln.byteLength===0)&&(Ln=new Float64Array(Y.memory.buffer)),Ln}let Nn=null;function te(){return(Nn===null||Nn.byteLength===0)&&(Nn=new Int32Array(Y.memory.buffer)),Nn}let Mt=0;const $r=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Bf=typeof $r.encodeInto=="function"?function(t,n){return $r.encodeInto(t,n)}:function(t,n){const e=$r.encode(t);return n.set(e),{read:t.length,written:e.length}};function lr(t,n,e){if(e===void 0){const s=$r.encode(t),f=n(s.length,1)>>>0;return In().subarray(f,f+s.length).set(s),Mt=s.length,f}let r=t.length,i=n(r,1)>>>0;const o=In();let a=0;for(;a<r;a++){const s=t.charCodeAt(a);if(s>127)break;o[i+a]=s}if(a!==r){a!==0&&(t=t.slice(a)),i=e(i,r,r=a+t.length*3,1)>>>0;const s=In().subarray(i+a,i+r),f=Bf(t,s);a+=f.written}return Mt=a,i}function gi(t){const n=typeof t;if(n=="number"||n=="boolean"||t==null)return`${t}`;if(n=="string")return`"${t}"`;if(n=="symbol"){const i=t.description;return i==null?"Symbol":`Symbol(${i})`}if(n=="function"){const i=t.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(t)){const i=t.length;let o="[";i>0&&(o+=gi(t[0]));for(let a=1;a<i;a++)o+=", "+gi(t[a]);return o+="]",o}const e=/\[object ([^\]]+)\]/.exec(toString.call(t));let r;if(e.length>1)r=e[1];else return toString.call(t);if(r=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:r}function jf(t,n){const e=n(t.length*1,1)>>>0;return In().set(t,e/1),Mt=t.length,e}function Xr(t,n){try{return t.apply(this,n)}catch(e){Y.__wbindgen_exn_store(pe(e))}}class Pr{static __wrap(n){n=n>>>0;const e=Object.create(Pr.prototype);return e.__wbg_ptr=n,e}__destroy_into_raw(){const n=this.__wbg_ptr;return this.__wbg_ptr=0,n}free(){const n=this.__destroy_into_raw();Y.__wbg_jsroutesnapper_free(n)}constructor(n){try{const o=Y.__wbindgen_add_to_stack_pointer(-16),a=jf(n,Y.__wbindgen_malloc),s=Mt;Y.jsroutesnapper_new(o,a,s);var e=te()[o/4+0],r=te()[o/4+1],i=te()[o/4+2];if(i)throw ln(r);return Pr.__wrap(e)}finally{Y.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(n){Y.jsroutesnapper_setRouteConfig(this.__wbg_ptr,pe(n))}setAreaMode(){Y.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let n,e;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_getConfig(o,this.__wbg_ptr);var r=te()[o/4+0],i=te()[o/4+1];return n=r,e=i,Ge(r,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(n,e,1)}}toFinalFeature(){try{const r=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_toFinalFeature(r,this.__wbg_ptr);var n=te()[r/4+0],e=te()[r/4+1];let i;return n!==0&&(i=Ge(n,e).slice(),Y.__wbindgen_free(n,e*1)),i}finally{Y.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let n,e;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var r=te()[o/4+0],i=te()[o/4+1];return n=r,e=i,Ge(r,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(n,e,1)}}toggleSnapMode(){Y.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(n,e,r){return Y.jsroutesnapper_onMouseMove(this.__wbg_ptr,n,e,r)!==0}onClick(){Y.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Y.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Y.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Y.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(n){try{const i=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_editExisting(i,this.__wbg_ptr,pe(n));var e=te()[i/4+0],r=te()[i/4+1];if(r)throw ln(e)}finally{Y.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let n,e;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var r=te()[o/4+0],i=te()[o/4+1];return n=r,e=i,Ge(r,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(n,e,1)}}debugSnappableNodes(){let n,e;try{const o=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var r=te()[o/4+0],i=te()[o/4+1];return n=r,e=i,Ge(r,i)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(n,e,1)}}routeNameForWaypoints(n){let e,r;try{const u=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_routeNameForWaypoints(u,this.__wbg_ptr,pe(n));var i=te()[u/4+0],o=te()[u/4+1],a=te()[u/4+2],s=te()[u/4+3],f=i,l=o;if(s)throw f=0,l=0,ln(a);return e=f,r=l,Ge(f,l)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,r,1)}}addSnappedWaypoint(n,e){Y.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,n,e)}undo(){Y.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(n){let e,r;try{const u=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_calculateRoute(u,this.__wbg_ptr,pe(n));var i=te()[u/4+0],o=te()[u/4+1],a=te()[u/4+2],s=te()[u/4+3],f=i,l=o;if(s)throw f=0,l=0,ln(a);return e=f,r=l,Ge(f,l)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(e,r,1)}}getExtraNodes(n,e){let r,i;try{const c=Y.__wbindgen_add_to_stack_pointer(-16);Y.jsroutesnapper_getExtraNodes(c,this.__wbg_ptr,pe(n),pe(e));var o=te()[c/4+0],a=te()[c/4+1],s=te()[c/4+2],f=te()[c/4+3],l=o,u=a;if(f)throw l=0,u=0,ln(s);return r=l,i=u,Ge(l,u)}finally{Y.__wbindgen_add_to_stack_pointer(16),Y.__wbindgen_free(r,i,1)}}}async function Uf(t,n){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,n)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const e=await t.arrayBuffer();return await WebAssembly.instantiate(e,n)}else{const e=await WebAssembly.instantiate(t,n);return e instanceof WebAssembly.Instance?{instance:e,module:t}:e}}function Zf(){const t={};return t.wbg={},t.wbg.__wbindgen_string_new=function(n,e){const r=Ge(n,e);return pe(r)},t.wbg.__wbindgen_object_drop_ref=function(n){ln(n)},t.wbg.__wbindgen_error_new=function(n,e){const r=new Error(Ge(n,e));return pe(r)},t.wbg.__wbindgen_number_get=function(n,e){const r=ee(e),i=typeof r=="number"?r:void 0;Df()[n/8+1]=Yr(i)?0:i,te()[n/4+0]=!Yr(i)},t.wbg.__wbindgen_is_object=function(n){const e=ee(n);return typeof e=="object"&&e!==null},t.wbg.__wbindgen_is_undefined=function(n){return ee(n)===void 0},t.wbg.__wbindgen_in=function(n,e){return ee(n)in ee(e)},t.wbg.__wbindgen_boolean_get=function(n){const e=ee(n);return typeof e=="boolean"?e?1:0:2},t.wbg.__wbindgen_jsval_loose_eq=function(n,e){return ee(n)==ee(e)},t.wbg.__wbindgen_string_get=function(n,e){const r=ee(e),i=typeof r=="string"?r:void 0;var o=Yr(i)?0:lr(i,Y.__wbindgen_malloc,Y.__wbindgen_realloc),a=Mt;te()[n/4+1]=a,te()[n/4+0]=o},t.wbg.__wbg_String_4370c5505c674d30=function(n,e){const r=String(ee(e)),i=lr(r,Y.__wbindgen_malloc,Y.__wbindgen_realloc),o=Mt;te()[n/4+1]=o,te()[n/4+0]=i},t.wbg.__wbindgen_object_clone_ref=function(n){const e=ee(n);return pe(e)},t.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(n,e){const r=ee(n)[ee(e)];return pe(r)},t.wbg.__wbg_new_abda76e883ba8a5f=function(){const n=new Error;return pe(n)},t.wbg.__wbg_stack_658279fe44541cf6=function(n,e){const r=ee(e).stack,i=lr(r,Y.__wbindgen_malloc,Y.__wbindgen_realloc),o=Mt;te()[n/4+1]=o,te()[n/4+0]=i},t.wbg.__wbg_error_f851667af71bcfc6=function(n,e){let r,i;try{r=n,i=e,console.error(Ge(n,e))}finally{Y.__wbindgen_free(r,i,1)}},t.wbg.__wbg_debug_9a6b3243fbbebb61=function(n){console.debug(ee(n))},t.wbg.__wbg_error_788ae33f81d3b84b=function(n){console.error(ee(n))},t.wbg.__wbg_info_2e30e8204b29d91d=function(n){console.info(ee(n))},t.wbg.__wbg_log_1d3ae0273d8f4f8a=function(n){console.log(ee(n))},t.wbg.__wbg_warn_d60e832f9882c1b2=function(n){console.warn(ee(n))},t.wbg.__wbg_get_44be0491f933a435=function(n,e){const r=ee(n)[e>>>0];return pe(r)},t.wbg.__wbg_length_fff51ee6522a1a18=function(n){return ee(n).length},t.wbg.__wbindgen_is_function=function(n){return typeof ee(n)=="function"},t.wbg.__wbg_next_526fc47e980da008=function(n){const e=ee(n).next;return pe(e)},t.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Xr(function(n){const e=ee(n).next();return pe(e)},arguments)},t.wbg.__wbg_done_5c1f01fb660d73b5=function(n){return ee(n).done},t.wbg.__wbg_value_1695675138684bd5=function(n){const e=ee(n).value;return pe(e)},t.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return pe(Symbol.iterator)},t.wbg.__wbg_get_97b561fb56f034b5=function(){return Xr(function(n,e){const r=Reflect.get(ee(n),ee(e));return pe(r)},arguments)},t.wbg.__wbg_call_cb65541d95d71282=function(){return Xr(function(n,e){const r=ee(n).call(ee(e));return pe(r)},arguments)},t.wbg.__wbg_isArray_4c24b343cb13cfb1=function(n){return Array.isArray(ee(n))},t.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(n){let e;try{e=ee(n)instanceof ArrayBuffer}catch{e=!1}return e},t.wbg.__wbg_buffer_085ec1f694018c4f=function(n){const e=ee(n).buffer;return pe(e)},t.wbg.__wbg_new_8125e318e6245eed=function(n){const e=new Uint8Array(ee(n));return pe(e)},t.wbg.__wbg_set_5cf90238115182c3=function(n,e,r){ee(n).set(ee(e),r>>>0)},t.wbg.__wbg_length_72e2208bbc0efc61=function(n){return ee(n).length},t.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(n){let e;try{e=ee(n)instanceof Uint8Array}catch{e=!1}return e},t.wbg.__wbindgen_debug_string=function(n,e){const r=gi(ee(e)),i=lr(r,Y.__wbindgen_malloc,Y.__wbindgen_realloc),o=Mt;te()[n/4+1]=o,te()[n/4+0]=i},t.wbg.__wbindgen_throw=function(n,e){throw new Error(Ge(n,e))},t.wbg.__wbindgen_memory=function(){const n=Y.memory;return pe(n)},t}function Gf(t,n){return Y=t.exports,$s.__wbindgen_wasm_module=n,Ln=null,Nn=null,Pn=null,Y}async function $s(t){if(Y!==void 0)return Y;typeof t>"u"&&(t="/atip/update-IMD-source/assets/route_snapper_bg.wasm");const n=Zf();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:e,module:r}=await Uf(await t,n);return Gf(e,r)}function Hf(t,n,e){e===void 0&&(e={});var r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=n||{},r.geometry=t,r}function Yf(t,n,e){if(e===void 0&&(e={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!po(t[0])||!po(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return Hf(r,n,e)}function po(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Lt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ct(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function mi(t,n){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}var Ie=63710088e-1,Xf={centimeters:Ie*100,centimetres:Ie*100,degrees:Ie/111325,feet:Ie*3.28084,inches:Ie*39.37,kilometers:Ie/1e3,kilometres:Ie/1e3,meters:Ie,metres:Ie,miles:Ie/1609.344,millimeters:Ie*1e3,millimetres:Ie*1e3,nauticalmiles:Ie/1852,radians:1,yards:Ie*1.0936};function qf(t,n){n===void 0&&(n="kilometers");var e=Xf[n];if(!e)throw new Error(n+" units is invalid");return t*e}function fr(t){var n=t%360;return n*Math.PI/180}function yt(t,n,e){e===void 0&&(e={});var r=Lt(t),i=Lt(n),o=fr(i[1]-r[1]),a=fr(i[0]-r[0]),s=fr(r[1]),f=fr(i[1]),l=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(f);return qf(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),e.units)}function Lr(t,n,e){e===void 0&&(e={});var r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=n||{},r.geometry=t,r}function nn(t,n,e){if(e===void 0&&(e={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!go(t[0])||!go(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return Lr(r,n,e)}function un(t,n,e){if(e===void 0&&(e={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:t};return Lr(r,n,e)}function go(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function ks(t){return!!t&&t.constructor===Object}function Kt(t,n,e){if(t!==null)for(var r,i,o,a,s,f,l,u=0,c=0,h,_=t.type,d=_==="FeatureCollection",g=_==="Feature",w=d?t.features.length:1,k=0;k<w;k++){l=d?t.features[k].geometry:g?t.geometry:t,h=l?l.type==="GeometryCollection":!1,s=h?l.geometries.length:1;for(var b=0;b<s;b++){var p=0,v=0;if(a=h?l.geometries[b]:l,a!==null){f=a.coordinates;var m=a.type;switch(u=e&&(m==="Polygon"||m==="MultiPolygon")?1:0,m){case null:break;case"Point":if(n(f,c,k,p,v)===!1)return!1;c++,p++;break;case"LineString":case"MultiPoint":for(r=0;r<f.length;r++){if(n(f[r],c,k,p,v)===!1)return!1;c++,m==="MultiPoint"&&p++}m==="LineString"&&p++;break;case"Polygon":case"MultiLineString":for(r=0;r<f.length;r++){for(i=0;i<f[r].length-u;i++){if(n(f[r][i],c,k,p,v)===!1)return!1;c++}m==="MultiLineString"&&p++,m==="Polygon"&&v++}m==="Polygon"&&p++;break;case"MultiPolygon":for(r=0;r<f.length;r++){for(v=0,i=0;i<f[r].length;i++){for(o=0;o<f[r][i].length-u;o++){if(n(f[r][i][o],c,k,p,v)===!1)return!1;c++}v++}p++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(Kt(a.geometries[r],n,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Jf(t,n,e,r){var i=e;return Kt(t,function(o,a,s,f,l){a===0&&e===void 0?i=o:i=n(i,o,a,s,f,l)},r),i}function Ss(t,n){var e;switch(t.type){case"FeatureCollection":for(e=0;e<t.features.length&&n(t.features[e].properties,e)!==!1;e++);break;case"Feature":n(t.properties,0);break}}function Wf(t,n,e){var r=e;return Ss(t,function(i,o){o===0&&e===void 0?r=i:r=n(r,i,o)}),r}function pn(t,n){if(t.type==="Feature")n(t,0);else if(t.type==="FeatureCollection")for(var e=0;e<t.features.length&&n(t.features[e],e)!==!1;e++);}function Es(t,n,e){var r=e;return pn(t,function(i,o){o===0&&e===void 0?r=i:r=n(r,i,o)}),r}function Kf(t){var n=[];return Kt(t,function(e){n.push(e)}),n}function Hi(t,n){var e,r,i,o,a,s,f,l,u,c,h=0,_=t.type==="FeatureCollection",d=t.type==="Feature",g=_?t.features.length:1;for(e=0;e<g;e++){for(s=_?t.features[e].geometry:d?t.geometry:t,l=_?t.features[e].properties:d?t.properties:{},u=_?t.features[e].bbox:d?t.bbox:void 0,c=_?t.features[e].id:d?t.id:void 0,f=s?s.type==="GeometryCollection":!1,a=f?s.geometries.length:1,i=0;i<a;i++){if(o=f?s.geometries[i]:s,o===null){if(n(null,h,l,u,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(o,h,l,u,c)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(n(o.geometries[r],h,l,u,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function Vf(t,n,e){var r=e;return Hi(t,function(i,o,a,s,f){o===0&&e===void 0?r=i:r=n(r,i,o,a,s,f)}),r}function Vt(t,n){Hi(t,function(e,r,i,o,a){var s=e===null?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return n(Lr(e,i,{bbox:o,id:a}),r,0)===!1?!1:void 0}var f;switch(s){case"MultiPoint":f="Point";break;case"MultiLineString":f="LineString";break;case"MultiPolygon":f="Polygon";break}for(var l=0;l<e.coordinates.length;l++){var u=e.coordinates[l],c={type:f,coordinates:u};if(n(Lr(c,i),r,l)===!1)return!1}})}function Qf(t,n,e){var r=e;return Vt(t,function(i,o,a){o===0&&a===0&&e===void 0?r=i:r=n(r,i,o,a)}),r}function Ms(t,n){Vt(t,function(e,r,i){var o=0;if(e.geometry){var a=e.geometry.type;if(!(a==="Point"||a==="MultiPoint")){var s,f=0,l=0,u=0;if(Kt(e,function(c,h,_,d,g){if(s===void 0||r>f||d>l||g>u){s=c,f=r,l=d,u=g,o=0;return}var w=un([s,c],e.properties);if(n(w,r,i,g,o)===!1)return!1;o++,s=c})===!1)return!1}}})}function As(t,n,e){var r=e,i=!1;return Ms(t,function(o,a,s,f,l){i===!1&&e===void 0?r=o:r=n(r,o,a,s,f,l),i=!0}),r}function Rs(t,n){if(!t)throw new Error("geojson is required");Vt(t,function(e,r,i){if(e.geometry!==null){var o=e.geometry.type,a=e.geometry.coordinates;switch(o){case"LineString":if(n(e,r,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(n(un(a[s],e.properties),r,i,s)===!1)return!1;break}}})}function eu(t,n,e){var r=e;return Rs(t,function(i,o,a,s){o===0&&e===void 0?r=i:r=n(r,i,o,a,s)}),r}function tu(t,n){if(n=n||{},!ks(n))throw new Error("options is invalid");var e=n.featureIndex||0,r=n.multiFeatureIndex||0,i=n.geometryIndex||0,o=n.segmentIndex||0,a=n.properties,s;switch(t.type){case"FeatureCollection":e<0&&(e=t.features.length+e),a=a||t.features[e].properties,s=t.features[e].geometry;break;case"Feature":a=a||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var f=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=f.length+o-1),un([f[o],f[o+1]],a,n);case"Polygon":return i<0&&(i=f.length+i),o<0&&(o=f[i].length+o-1),un([f[i][o],f[i][o+1]],a,n);case"MultiLineString":return r<0&&(r=f.length+r),o<0&&(o=f[r].length+o-1),un([f[r][o],f[r][o+1]],a,n);case"MultiPolygon":return r<0&&(r=f.length+r),i<0&&(i=f[r].length+i),o<0&&(o=f[r][i].length-o-1),un([f[r][i][o],f[r][i][o+1]],a,n)}throw new Error("geojson is invalid")}function nu(t,n){if(n=n||{},!ks(n))throw new Error("options is invalid");var e=n.featureIndex||0,r=n.multiFeatureIndex||0,i=n.geometryIndex||0,o=n.coordIndex||0,a=n.properties,s;switch(t.type){case"FeatureCollection":e<0&&(e=t.features.length+e),a=a||t.features[e].properties,s=t.features[e].geometry;break;case"Feature":a=a||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var f=s.coordinates;switch(s.type){case"Point":return nn(f,a,n);case"MultiPoint":return r<0&&(r=f.length+r),nn(f[r],a,n);case"LineString":return o<0&&(o=f.length+o),nn(f[o],a,n);case"Polygon":return i<0&&(i=f.length+i),o<0&&(o=f[i].length+o),nn(f[i][o],a,n);case"MultiLineString":return r<0&&(r=f.length+r),o<0&&(o=f[r].length+o),nn(f[r][o],a,n);case"MultiPolygon":return r<0&&(r=f.length+r),i<0&&(i=f[r].length+i),o<0&&(o=f[r][i].length-o),nn(f[r][i][o],a,n)}throw new Error("geojson is invalid")}const ru=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Kf,coordEach:Kt,coordReduce:Jf,featureEach:pn,featureReduce:Es,findPoint:nu,findSegment:tu,flattenEach:Vt,flattenReduce:Qf,geomEach:Hi,geomReduce:Vf,lineEach:Rs,lineReduce:eu,propEach:Ss,propReduce:Wf,segmentEach:Ms,segmentReduce:As},Symbol.toStringTag,{value:"Module"}));function bi(t,n){return n===void 0&&(n={}),As(t,function(e,r){var i=r.geometry.coordinates;return e+yt(i[0],i[1],n)},0)}function iu(t,n,e){e===void 0&&(e={});var r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=n||{},r.geometry=t,r}function ou(t,n,e){if(e===void 0&&(e={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:t};return iu(r,n,e)}function au(t){var n=t%(2*Math.PI);return n*180/Math.PI}function ur(t){var n=t%360;return n*Math.PI/180}function Ps(t,n,e){if(e===void 0&&(e={}),e.final===!0)return su(t,n);var r=Lt(t),i=Lt(n),o=ur(r[0]),a=ur(i[0]),s=ur(r[1]),f=ur(i[1]),l=Math.sin(a-o)*Math.cos(f),u=Math.cos(s)*Math.sin(f)-Math.sin(s)*Math.cos(f)*Math.cos(a-o);return au(Math.atan2(l,u))}function su(t,n){var e=Ps(n,t);return e=(e+180)%360,e}var xe=63710088e-1,lu={centimeters:xe*100,centimetres:xe*100,degrees:xe/111325,feet:xe*3.28084,inches:xe*39.37,kilometers:xe/1e3,kilometres:xe/1e3,meters:xe,metres:xe,miles:xe/1609.344,millimeters:xe*1e3,millimetres:xe*1e3,nauticalmiles:xe/1852,radians:1,yards:xe*1.0936};function fu(t,n,e){e===void 0&&(e={});var r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=n||{},r.geometry=t,r}function uu(t,n,e){if(e===void 0&&(e={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!bo(t[0])||!bo(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return fu(r,n,e)}function cu(t,n){n===void 0&&(n="kilometers");var e=lu[n];if(!e)throw new Error(n+" units is invalid");return t/e}function mo(t){var n=t%(2*Math.PI);return n*180/Math.PI}function qr(t){var n=t%360;return n*Math.PI/180}function bo(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function vo(t,n,e,r){r===void 0&&(r={});var i=Lt(t),o=qr(i[0]),a=qr(i[1]),s=qr(e),f=cu(n,r.units),l=Math.asin(Math.sin(a)*Math.cos(f)+Math.cos(a)*Math.sin(f)*Math.cos(s)),u=o+Math.atan2(Math.sin(s)*Math.sin(f)*Math.cos(a),Math.cos(f)-Math.sin(a)*Math.sin(l)),c=mo(u),h=mo(l);return uu([c,h],r.properties)}function vi(t,n,e){e===void 0&&(e={});var r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=n||{},r.geometry=t,r}function hu(t,n,e){if(e===void 0&&(e={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!yo(t[0])||!yo(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return vi(r,n,e)}function wo(t,n){n===void 0&&(n={});var e={type:"FeatureCollection"};return n.id&&(e.id=n.id),n.bbox&&(e.bbox=n.bbox),e.features=t,e}function yo(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function du(t,n,e){e===void 0&&(e={});var r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=n||{},r.geometry=t,r}function _u(t,n,e){if(e===void 0&&(e={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:t};return du(r,n,e)}function pu(t,n){n===void 0&&(n={});var e={type:"FeatureCollection"};return n.id&&(e.id=n.id),n.bbox&&(e.bbox=n.bbox),e.features=t,e}function wi(t){if(!t)throw new Error("geojson is required");var n=[];return Vt(t,function(e){gu(e,n)}),pu(n)}function gu(t,n){var e=[],r=t.geometry;if(r!==null){switch(r.type){case"Polygon":e=ct(r);break;case"LineString":e=[ct(r)]}e.forEach(function(i){var o=mu(i,t.properties);o.forEach(function(a){a.id=n.length,n.push(a)})})}}function mu(t,n){var e=[];return t.reduce(function(r,i){var o=_u([r,i],n);return o.bbox=bu(r,i),e.push(o),i}),e}function bu(t,n){var e=t[0],r=t[1],i=n[0],o=n[1],a=e<i?e:i,s=r<o?r:o,f=e>i?e:i,l=r>o?r:o;return[a,s,f,l]}var Yi={exports:{}},Ls={exports:{}};(function(t,n){(function(e,r){t.exports=r()})(Zl,function(){function e(b,p,v,m,A){(function $(O,F,N,S,M){for(;S>N;){if(S-N>600){var y=S-N+1,C=F-N+1,Z=Math.log(y),ie=.5*Math.exp(2*Z/3),ue=.5*Math.sqrt(Z*ie*(y-ie)/y)*(C-y/2<0?-1:1),J=Math.max(N,Math.floor(F-C*ie/y+ue)),me=Math.min(S,Math.floor(F+(y-C)*ie/y+ue));$(O,F,J,me,M)}var K=O[F],be=N,ve=S;for(r(O,N,F),M(O[S],K)>0&&r(O,N,S);be<ve;){for(r(O,be,ve),be++,ve--;M(O[be],K)<0;)be++;for(;M(O[ve],K)>0;)ve--}M(O[N],K)===0?r(O,N,ve):r(O,++ve,S),ve<=F&&(N=ve+1),F<=ve&&(S=ve-1)}})(b,p,v||0,m||b.length-1,A||i)}function r(b,p,v){var m=b[p];b[p]=b[v],b[v]=m}function i(b,p){return b<p?-1:b>p?1:0}var o=function(b){b===void 0&&(b=9),this._maxEntries=Math.max(4,b),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(b,p,v){if(!v)return p.indexOf(b);for(var m=0;m<p.length;m++)if(v(b,p[m]))return m;return-1}function s(b,p){f(b,0,b.children.length,p,b)}function f(b,p,v,m,A){A||(A=w(null)),A.minX=1/0,A.minY=1/0,A.maxX=-1/0,A.maxY=-1/0;for(var $=p;$<v;$++){var O=b.children[$];l(A,b.leaf?m(O):O)}return A}function l(b,p){return b.minX=Math.min(b.minX,p.minX),b.minY=Math.min(b.minY,p.minY),b.maxX=Math.max(b.maxX,p.maxX),b.maxY=Math.max(b.maxY,p.maxY),b}function u(b,p){return b.minX-p.minX}function c(b,p){return b.minY-p.minY}function h(b){return(b.maxX-b.minX)*(b.maxY-b.minY)}function _(b){return b.maxX-b.minX+(b.maxY-b.minY)}function d(b,p){return b.minX<=p.minX&&b.minY<=p.minY&&p.maxX<=b.maxX&&p.maxY<=b.maxY}function g(b,p){return p.minX<=b.maxX&&p.minY<=b.maxY&&p.maxX>=b.minX&&p.maxY>=b.minY}function w(b){return{children:b,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function k(b,p,v,m,A){for(var $=[p,v];$.length;)if(!((v=$.pop())-(p=$.pop())<=m)){var O=p+Math.ceil((v-p)/m/2)*m;e(b,O,p,v,A),$.push(p,O,O,v)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(b){var p=this.data,v=[];if(!g(b,p))return v;for(var m=this.toBBox,A=[];p;){for(var $=0;$<p.children.length;$++){var O=p.children[$],F=p.leaf?m(O):O;g(b,F)&&(p.leaf?v.push(O):d(b,F)?this._all(O,v):A.push(O))}p=A.pop()}return v},o.prototype.collides=function(b){var p=this.data;if(!g(b,p))return!1;for(var v=[];p;){for(var m=0;m<p.children.length;m++){var A=p.children[m],$=p.leaf?this.toBBox(A):A;if(g(b,$)){if(p.leaf||d(b,$))return!0;v.push(A)}}p=v.pop()}return!1},o.prototype.load=function(b){if(!b||!b.length)return this;if(b.length<this._minEntries){for(var p=0;p<b.length;p++)this.insert(b[p]);return this}var v=this._build(b.slice(),0,b.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var m=this.data;this.data=v,v=m}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},o.prototype.insert=function(b){return b&&this._insert(b,this.data.height-1),this},o.prototype.clear=function(){return this.data=w([]),this},o.prototype.remove=function(b,p){if(!b)return this;for(var v,m,A,$=this.data,O=this.toBBox(b),F=[],N=[];$||F.length;){if($||($=F.pop(),m=F[F.length-1],v=N.pop(),A=!0),$.leaf){var S=a(b,$.children,p);if(S!==-1)return $.children.splice(S,1),F.push($),this._condense(F),this}A||$.leaf||!d($,O)?m?(v++,$=m.children[v],A=!1):$=null:(F.push($),N.push(v),v=0,m=$,$=$.children[0])}return this},o.prototype.toBBox=function(b){return b},o.prototype.compareMinX=function(b,p){return b.minX-p.minX},o.prototype.compareMinY=function(b,p){return b.minY-p.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(b){return this.data=b,this},o.prototype._all=function(b,p){for(var v=[];b;)b.leaf?p.push.apply(p,b.children):v.push.apply(v,b.children),b=v.pop();return p},o.prototype._build=function(b,p,v,m){var A,$=v-p+1,O=this._maxEntries;if($<=O)return s(A=w(b.slice(p,v+1)),this.toBBox),A;m||(m=Math.ceil(Math.log($)/Math.log(O)),O=Math.ceil($/Math.pow(O,m-1))),(A=w([])).leaf=!1,A.height=m;var F=Math.ceil($/O),N=F*Math.ceil(Math.sqrt(O));k(b,p,v,N,this.compareMinX);for(var S=p;S<=v;S+=N){var M=Math.min(S+N-1,v);k(b,S,M,F,this.compareMinY);for(var y=S;y<=M;y+=F){var C=Math.min(y+F-1,M);A.children.push(this._build(b,y,C,m-1))}}return s(A,this.toBBox),A},o.prototype._chooseSubtree=function(b,p,v,m){for(;m.push(p),!p.leaf&&m.length-1!==v;){for(var A=1/0,$=1/0,O=void 0,F=0;F<p.children.length;F++){var N=p.children[F],S=h(N),M=(y=b,C=N,(Math.max(C.maxX,y.maxX)-Math.min(C.minX,y.minX))*(Math.max(C.maxY,y.maxY)-Math.min(C.minY,y.minY))-S);M<$?($=M,A=S<A?S:A,O=N):M===$&&S<A&&(A=S,O=N)}p=O||p.children[0]}var y,C;return p},o.prototype._insert=function(b,p,v){var m=v?b:this.toBBox(b),A=[],$=this._chooseSubtree(m,this.data,p,A);for($.children.push(b),l($,m);p>=0&&A[p].children.length>this._maxEntries;)this._split(A,p),p--;this._adjustParentBBoxes(m,A,p)},o.prototype._split=function(b,p){var v=b[p],m=v.children.length,A=this._minEntries;this._chooseSplitAxis(v,A,m);var $=this._chooseSplitIndex(v,A,m),O=w(v.children.splice($,v.children.length-$));O.height=v.height,O.leaf=v.leaf,s(v,this.toBBox),s(O,this.toBBox),p?b[p-1].children.push(O):this._splitRoot(v,O)},o.prototype._splitRoot=function(b,p){this.data=w([b,p]),this.data.height=b.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(b,p,v){for(var m,A,$,O,F,N,S,M=1/0,y=1/0,C=p;C<=v-p;C++){var Z=f(b,0,C,this.toBBox),ie=f(b,C,v,this.toBBox),ue=(A=Z,$=ie,O=void 0,F=void 0,N=void 0,S=void 0,O=Math.max(A.minX,$.minX),F=Math.max(A.minY,$.minY),N=Math.min(A.maxX,$.maxX),S=Math.min(A.maxY,$.maxY),Math.max(0,N-O)*Math.max(0,S-F)),J=h(Z)+h(ie);ue<M?(M=ue,m=C,y=J<y?J:y):ue===M&&J<y&&(y=J,m=C)}return m||v-p},o.prototype._chooseSplitAxis=function(b,p,v){var m=b.leaf?this.compareMinX:u,A=b.leaf?this.compareMinY:c;this._allDistMargin(b,p,v,m)<this._allDistMargin(b,p,v,A)&&b.children.sort(m)},o.prototype._allDistMargin=function(b,p,v,m){b.children.sort(m);for(var A=this.toBBox,$=f(b,0,p,A),O=f(b,v-p,v,A),F=_($)+_(O),N=p;N<v-p;N++){var S=b.children[N];l($,b.leaf?A(S):S),F+=_($)}for(var M=v-p-1;M>=p;M--){var y=b.children[M];l(O,b.leaf?A(y):y),F+=_(O)}return F},o.prototype._adjustParentBBoxes=function(b,p,v){for(var m=v;m>=0;m--)l(p[m],b)},o.prototype._condense=function(b){for(var p=b.length-1,v=void 0;p>=0;p--)b[p].children.length===0?p>0?(v=b[p-1].children).splice(v.indexOf(b[p]),1):this.clear():s(b[p],this.toBBox)},o})})(Ls);var vu=Ls.exports,Ns={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=63710088e-1,t.factors={centimeters:t.earthRadius*100,centimetres:t.earthRadius*100,degrees:t.earthRadius/111325,feet:t.earthRadius*3.28084,inches:t.earthRadius*39.37,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:t.earthRadius*1e3,millimetres:t.earthRadius*1e3,nauticalmiles:t.earthRadius/1852,radians:1,yards:t.earthRadius*1.0936},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function n(S,M,y){y===void 0&&(y={});var C={type:"Feature"};return(y.id===0||y.id)&&(C.id=y.id),y.bbox&&(C.bbox=y.bbox),C.properties=M||{},C.geometry=S,C}t.feature=n;function e(S,M,y){switch(S){case"Point":return r(M).geometry;case"LineString":return s(M).geometry;case"Polygon":return o(M).geometry;case"MultiPoint":return c(M).geometry;case"MultiLineString":return u(M).geometry;case"MultiPolygon":return h(M).geometry;default:throw new Error(S+" is invalid")}}t.geometry=e;function r(S,M,y){if(y===void 0&&(y={}),!S)throw new Error("coordinates is required");if(!Array.isArray(S))throw new Error("coordinates must be an Array");if(S.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!$(S[0])||!$(S[1]))throw new Error("coordinates must contain numbers");var C={type:"Point",coordinates:S};return n(C,M,y)}t.point=r;function i(S,M,y){return y===void 0&&(y={}),l(S.map(function(C){return r(C,M)}),y)}t.points=i;function o(S,M,y){y===void 0&&(y={});for(var C=0,Z=S;C<Z.length;C++){var ie=Z[C];if(ie.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var ue=0;ue<ie[ie.length-1].length;ue++)if(ie[ie.length-1][ue]!==ie[0][ue])throw new Error("First and last Position are not equivalent.")}var J={type:"Polygon",coordinates:S};return n(J,M,y)}t.polygon=o;function a(S,M,y){return y===void 0&&(y={}),l(S.map(function(C){return o(C,M)}),y)}t.polygons=a;function s(S,M,y){if(y===void 0&&(y={}),S.length<2)throw new Error("coordinates must be an array of two or more positions");var C={type:"LineString",coordinates:S};return n(C,M,y)}t.lineString=s;function f(S,M,y){return y===void 0&&(y={}),l(S.map(function(C){return s(C,M)}),y)}t.lineStrings=f;function l(S,M){M===void 0&&(M={});var y={type:"FeatureCollection"};return M.id&&(y.id=M.id),M.bbox&&(y.bbox=M.bbox),y.features=S,y}t.featureCollection=l;function u(S,M,y){y===void 0&&(y={});var C={type:"MultiLineString",coordinates:S};return n(C,M,y)}t.multiLineString=u;function c(S,M,y){y===void 0&&(y={});var C={type:"MultiPoint",coordinates:S};return n(C,M,y)}t.multiPoint=c;function h(S,M,y){y===void 0&&(y={});var C={type:"MultiPolygon",coordinates:S};return n(C,M,y)}t.multiPolygon=h;function _(S,M,y){y===void 0&&(y={});var C={type:"GeometryCollection",geometries:S};return n(C,M,y)}t.geometryCollection=_;function d(S,M){if(M===void 0&&(M=0),M&&!(M>=0))throw new Error("precision must be a positive number");var y=Math.pow(10,M||0);return Math.round(S*y)/y}t.round=d;function g(S,M){M===void 0&&(M="kilometers");var y=t.factors[M];if(!y)throw new Error(M+" units is invalid");return S*y}t.radiansToLength=g;function w(S,M){M===void 0&&(M="kilometers");var y=t.factors[M];if(!y)throw new Error(M+" units is invalid");return S/y}t.lengthToRadians=w;function k(S,M){return p(w(S,M))}t.lengthToDegrees=k;function b(S){var M=S%360;return M<0&&(M+=360),M}t.bearingToAzimuth=b;function p(S){var M=S%(2*Math.PI);return M*180/Math.PI}t.radiansToDegrees=p;function v(S){var M=S%360;return M*Math.PI/180}t.degreesToRadians=v;function m(S,M,y){if(M===void 0&&(M="kilometers"),y===void 0&&(y="kilometers"),!(S>=0))throw new Error("length must be a positive number");return g(w(S,M),y)}t.convertLength=m;function A(S,M,y){if(M===void 0&&(M="meters"),y===void 0&&(y="kilometers"),!(S>=0))throw new Error("area must be a positive number");var C=t.areaFactors[M];if(!C)throw new Error("invalid original units");var Z=t.areaFactors[y];if(!Z)throw new Error("invalid final units");return S/C*Z}t.convertArea=A;function $(S){return!isNaN(S)&&S!==null&&!Array.isArray(S)}t.isNumber=$;function O(S){return!!S&&S.constructor===Object}t.isObject=O;function F(S){if(!S)throw new Error("bbox is required");if(!Array.isArray(S))throw new Error("bbox must be an Array");if(S.length!==4&&S.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");S.forEach(function(M){if(!$(M))throw new Error("bbox must only contain numbers")})}t.validateBBox=F;function N(S){if(!S)throw new Error("id is required");if(["string","number"].indexOf(typeof S)===-1)throw new Error("id must be a number or a string")}t.validateId=N})(Ns);const wu=cs(ru),yu=cs(Gl);var st=vu,Cs=Ns,Os=wu,rn=yu.default,$u=Os.featureEach;Os.coordEach;Cs.polygon;var $o=Cs.featureCollection;function Is(t){var n=new st(t);return n.insert=function(e){if(e.type!=="Feature")throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:rn(e),st.prototype.insert.call(this,e)},n.load=function(e){var r=[];return Array.isArray(e)?e.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:rn(i),r.push(i)}):$u(e,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:rn(i),r.push(i)}),st.prototype.load.call(this,r)},n.remove=function(e,r){if(e.type!=="Feature")throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:rn(e),st.prototype.remove.call(this,e,r)},n.clear=function(){return st.prototype.clear.call(this)},n.search=function(e){var r=st.prototype.search.call(this,this.toBBox(e));return $o(r)},n.collides=function(e){return st.prototype.collides.call(this,this.toBBox(e))},n.all=function(){var e=st.prototype.all.call(this);return $o(e)},n.toJSON=function(){return st.prototype.toJSON.call(this)},n.fromJSON=function(e){return st.prototype.fromJSON.call(this,e)},n.toBBox=function(e){var r;if(e.bbox)r=e.bbox;else if(Array.isArray(e)&&e.length===4)r=e;else if(Array.isArray(e)&&e.length===6)r=[e[0],e[1],e[3],e[4]];else if(e.type==="Feature")r=rn(e);else if(e.type==="FeatureCollection")r=rn(e);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},n}Yi.exports=Is;Yi.exports.default=Is;var ku=Yi.exports;const Xi=Hl(ku);function xs(t,n){var e={},r=[];if(t.type==="LineString"&&(t=vi(t)),n.type==="LineString"&&(n=vi(n)),t.type==="Feature"&&n.type==="Feature"&&t.geometry!==null&&n.geometry!==null&&t.geometry.type==="LineString"&&n.geometry.type==="LineString"&&t.geometry.coordinates.length===2&&n.geometry.coordinates.length===2){var i=ko(t,n);return i&&r.push(i),wo(r)}var o=Xi();return o.load(wi(n)),pn(wi(t),function(a){pn(o.search(a),function(s){var f=ko(a,s);if(f){var l=ct(f).join(",");e[l]||(e[l]=!0,r.push(f))}})}),wo(r)}function ko(t,n){var e=ct(t),r=ct(n);if(e.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=e[0][0],o=e[0][1],a=e[1][0],s=e[1][1],f=r[0][0],l=r[0][1],u=r[1][0],c=r[1][1],h=(c-l)*(a-i)-(u-f)*(s-o),_=(u-f)*(o-l)-(c-l)*(i-f),d=(a-i)*(o-l)-(s-o)*(i-f);if(h===0)return null;var g=_/h,w=d/h;if(g>=0&&g<=1&&w>=0&&w<=1){var k=i+g*(a-i),b=o+g*(s-o);return hu([k,b])}return null}function Ts(t,n,e){e===void 0&&(e={});var r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=n||{},r.geometry=t,r}function Jr(t,n,e){if(e===void 0&&(e={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Eo(t[0])||!Eo(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return Ts(r,n,e)}function So(t,n,e){if(e===void 0&&(e={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:t};return Ts(r,n,e)}function Eo(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function yi(t,n,e){e===void 0&&(e={});var r=Jr([1/0,1/0],{dist:1/0}),i=0;return Vt(t,function(o){for(var a=ct(o),s=0;s<a.length-1;s++){var f=Jr(a[s]);f.properties.dist=yt(n,f,e);var l=Jr(a[s+1]);l.properties.dist=yt(n,l,e);var u=yt(f,l,e),c=Math.max(f.properties.dist,l.properties.dist),h=Ps(f,l),_=vo(n,c,h+90,e),d=vo(n,c,h-90,e),g=xs(So([_.geometry.coordinates,d.geometry.coordinates]),So([f.geometry.coordinates,l.geometry.coordinates])),w=null;g.features.length>0&&(w=g.features[0],w.properties.dist=yt(n,w,e),w.properties.location=i+yt(f,w,e)),f.properties.dist<r.properties.dist&&(r=f,r.properties.index=s,r.properties.location=i),l.properties.dist<r.properties.dist&&(r=l,r.properties.index=s+1,r.properties.location=i+u),w&&w.properties.dist<r.properties.dist&&(r=w,r.properties.index=s),i+=u}}),r}function Su(t,n,e){var r=ct(e);if(mi(e)!=="LineString")throw new Error("line must be a LineString");var i=yi(e,t),o=yi(e,n),a;i.properties.index<=o.properties.index?a=[i,o]:a=[o,i];for(var s=[a[0].geometry.coordinates],f=a[0].properties.index+1;f<a[1].properties.index+1;f++)s.push(r[f]);return s.push(a[1].geometry.coordinates),ou(s,e.properties)}function Eu(t){var n=t[0],e=t[1],r=t[2],i=t[3],o=yt(t.slice(0,2),[r,e]),a=yt(t.slice(0,2),[n,i]);if(o>=a){var s=(e+i)/2;return[n,s-(r-n)/2,r,s+(r-n)/2]}else{var f=(n+r)/2;return[f-(i-e)/2,e,f+(i-e)/2,i]}}function $i(t){var n=[1/0,1/0,-1/0,-1/0];return Kt(t,function(e){n[0]>e[0]&&(n[0]=e[0]),n[1]>e[1]&&(n[1]=e[1]),n[2]<e[0]&&(n[2]=e[0]),n[3]<e[1]&&(n[3]=e[1])}),n}$i.default=$i;function Mu(t,n){n===void 0&&(n={});var e=n.precision,r=n.coordinates,i=n.mutate;if(e=e==null||isNaN(e)?6:e,r=r==null||isNaN(r)?3:r,!t)throw new Error("<geojson> is required");if(typeof e!="number")throw new Error("<precision> must be a number");if(typeof r!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(t=JSON.parse(JSON.stringify(t)));var o=Math.pow(10,e);return Kt(t,function(a){Au(a,o,r)}),t}function Au(t,n,e){t.length>e&&t.splice(e,t.length);for(var r=0;r<t.length;r++)t[r]=Math.round(t[r]*n)/n;return t}function Ru(t,n,e){e===void 0&&(e={});var r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=n||{},r.geometry=t,r}function Mo(t,n,e){if(e===void 0&&(e={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:t};return Ru(r,n,e)}function Tn(t,n){n===void 0&&(n={});var e={type:"FeatureCollection"};return n.id&&(e.id=n.id),n.bbox&&(e.bbox=n.bbox),e.features=t,e}function Pu(t,n){if(!t)throw new Error("line is required");if(!n)throw new Error("splitter is required");var e=mi(t),r=mi(n);if(e!=="LineString")throw new Error("line must be LineString");if(r==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(r==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Mu(n,{precision:7});switch(r){case"Point":return ki(t,i);case"MultiPoint":return Ao(t,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Ao(t,xs(t,i))}}function Ao(t,n){var e=[],r=Xi();return Vt(n,function(i){if(e.forEach(function(s,f){s.id=f}),!e.length)e=ki(t,i).features,e.forEach(function(s){s.bbox||(s.bbox=Eu($i(s)))}),r.load(Tn(e));else{var o=r.search(i);if(o.features.length){var a=Fs(i,o);e=e.filter(function(s){return s.id!==a.id}),r.remove(a),pn(ki(a,i),function(s){e.push(s),r.insert(s)})}}}),Tn(e)}function ki(t,n){var e=[],r=ct(t)[0],i=ct(t)[t.geometry.coordinates.length-1];if(Wr(r,Lt(n))||Wr(i,Lt(n)))return Tn([t]);var o=Xi(),a=wi(t);o.load(a);var s=o.search(n);if(!s.features.length)return Tn([t]);var f=Fs(n,s),l=[r],u=Es(a,function(c,h,_){var d=ct(h)[1],g=Lt(n);return _===f.id?(c.push(g),e.push(Mo(c)),Wr(g,d)?[g]:[g,d]):(c.push(d),c)},l);return u.length>1&&e.push(Mo(u)),Tn(e)}function Fs(t,n){if(!n.features.length)throw new Error("lines must contain features");if(n.features.length===1)return n.features[0];var e,r=1/0;return pn(n,function(i){var o=yi(i,t),a=o.properties.dist;a<r&&(e=i,r=a)}),e}function Wr(t,n){return t[0]===n[0]&&t[1]===n[1]}function Lu(t,n){let e=Pu(t,n);if(e.features.length!=2)return null;let r=e.features[0],i=e.features[1];return r.geometry.coordinates=r.geometry.coordinates.map(Po),i.geometry.coordinates=i.geometry.coordinates.map(Po),r.properties=JSON.parse(JSON.stringify(t.properties)),i.properties=JSON.parse(JSON.stringify(t.properties)),Nu(t,r,i,n),[r,i]}function Nu(t,n,e,r){n.properties.length_meters=bi(n,{units:"kilometers"})*1e3,e.properties.length_meters=bi(e,{units:"kilometers"})*1e3,n.properties.waypoints=[],e.properties.waypoints=[];let i=Ro(t,r),o=!0,a=0;for(let s of t.properties.waypoints){let f=Ro(t,Yf([s.lon,s.lat]));if(o)if(f<i)n.properties.waypoints.push(s);else{let l=s.snapped&&t.properties.waypoints[a-1].snapped;n.properties.waypoints.push({lon:r.geometry.coordinates[0],lat:r.geometry.coordinates[1],snapped:l}),o=!1,e.properties.waypoints.push({lon:r.geometry.coordinates[0],lat:r.geometry.coordinates[1],snapped:l}),e.properties.waypoints.push(s)}else e.properties.waypoints.push(s);a++}}function Ro(t,n){let e=t.geometry.coordinates[0],r=Su(e,n,t);return bi(r,{units:"kilometers"})*1e3}function Po(t){return[Math.round(t[0]*1e7)/1e7,Math.round(t[1]*1e7)/1e7]}const Cu=30;class Lo{constructor(n,e,r,i,o){this.onMouseMove=a=>{if(!this.active)return;const s=[a.point.x-Cu,a.point.y],f=this.map.unproject(a.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(a.lngLat.lng,a.lngLat.lat,f)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=a=>{this.active&&(a.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=a=>{if(!this.active)return;let s=a.target.tagName;s=="INPUT"||s=="TEXTAREA"||a.key=="Escape"&&(a.stopPropagation(),this.cancel())},this.onKeyPress=a=>{if(!this.active)return;let s=a.target.tagName;s=="INPUT"||s=="TEXTAREA"||(a.key=="Enter"?(a.stopPropagation(),this.finish()):a.key=="s"||a.key=="S"?(a.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):a.key=="z"&&a.ctrlKey&&this.undo())},this.map=n,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Pr(e),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=r,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(n){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),n.properties.waypoints||(n.properties.waypoints=[{lon:n.geometry.coordinates[0][0],lat:n.geometry.coordinates[0][1],snapped:!0},{lon:n.geometry.coordinates[n.geometry.coordinates.length-1][0],lat:n.geometry.coordinates[n.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(n.properties.waypoints),this.redraw()}editExistingArea(n){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),n.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(n.properties.waypoints),this.redraw()}addEventListenerSuccess(n){this.eventListenersSuccess.push(n)}addEventListenerUpdated(n){this.eventListenersUpdated.push(n)}addEventListenerFailure(n){this.eventListenersFailure.push(n)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let n=this.inner.toFinalFeature();if(n)for(let e of this.eventListenersSuccess)e(JSON.parse(n));else for(let e of this.eventListenersFailure)e();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(n){this.inner.setRouteConfig(n),this.redraw()}addSnappedWaypoint(n){this.inner.addSnappedWaypoint(n[0],n[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let n=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(n),this.map.getCanvas().style.cursor=n.cursor,this.snapMode.set(n.snap_mode),this.undoLength.set(n.undo_length)}dataUpdated(){let n=this.inner.toFinalFeature();if(n)for(let e of this.eventListenersUpdated)e(JSON.parse(n))}}async function Ou(t,n){let e=await fetch(t),r=e.body.getReader(),i=e.headers.get("Content-Length");if(!i)throw new Error(`No Content-Length header from ${t}`);let o=parseInt(i),a=0,s=[];for(;;){let{done:u,value:c}=await r.read();if(u)break;c&&(s.push(c),a+=c.length,n(100*a/o))}let f=new Uint8Array(a),l=0;for(let u of s)f.set(u,l),l+=u.length;return f}function No(t){let n,e,r,i,o,a,s,f,l,u,c,h,_,d,g,w,k,b,p,v,m,A,$,O,F,N,S;return O=new Ue({props:{style:"margin-bottom: 8px",$$slots:{default:[Iu]},$$scope:{ctx:t}}}),O.$on("click",t[7]),{c(){n=D("nav"),e=D("ol"),r=D("li"),i=D("a"),o=q("Change area"),s=z(),f=D("li"),l=D("a"),u=q("Manage files"),h=z(),_=D("li"),_.textContent="Sketch",d=z(),g=D("div"),w=D("p"),k=D("b"),k.textContent="You are editing",b=z(),p=D("br"),v=z(),m=D("span"),A=q(t[2]),$=z(),I(O.$$.fragment),F=z(),N=D("a"),N.textContent="Open Scheme Browser",U(i,"class","govuk-breadcrumbs__link"),U(i,"href",a=`choose_area.html?scheme=${t[5]}`),U(r,"class","govuk-breadcrumbs__list-item"),U(l,"class","govuk-breadcrumbs__link"),U(l,"href",c="files.html?authority="+t[1]+"&schema="+t[5]),U(f,"class","govuk-breadcrumbs__list-item"),U(_,"class","govuk-breadcrumbs__list-item"),U(e,"class","govuk-breadcrumbs__list"),U(n,"class","govuk-breadcrumbs"),U(n,"aria-label","Breadcrumb"),re(g,"display","flex"),re(g,"justify-content","space-between"),U(N,"href","browse.html"),U(N,"target","_blank")},m(M,y){P(M,n,y),B(n,e),B(e,r),B(r,i),B(i,o),B(e,s),B(e,f),B(f,l),B(l,u),B(e,h),B(e,_),P(M,d,y),P(M,g,y),B(g,w),B(w,k),B(w,b),B(w,p),B(w,v),B(w,m),B(m,A),B(g,$),x(O,g,null),P(M,F,y),P(M,N,y),S=!0},p(M,y){(!S||y&32&&a!==(a=`choose_area.html?scheme=${M[5]}`))&&U(i,"href",a),(!S||y&34&&c!==(c="files.html?authority="+M[1]+"&schema="+M[5]))&&U(l,"href",c),(!S||y&4)&&je(A,M[2]);const C={};y&512&&(C.$$scope={dirty:y,ctx:M}),O.$set(C)},i(M){S||(E(O.$$.fragment,M),S=!0)},o(M){R(O.$$.fragment,M),S=!1},d(M){M&&(L(n),L(d),L(g),L(F),L(N)),T(O)}}}function Iu(t){let n;return{c(){n=q("Export")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function xu(t){let n,e,r=(t[4].mode=="list"||t[4].mode=="split-route"||t[4].mode=="set-image"||t[4].mode=="streetview")&&No(t);return{c(){r&&r.c(),n=Le()},m(i,o){r&&r.m(i,o),P(i,n,o),e=!0},p(i,[o]){i[4].mode=="list"||i[4].mode=="split-route"||i[4].mode=="set-image"||i[4].mode=="streetview"?r?(r.p(i,o),o&16&&E(r,1)):(r=No(i),r.c(),E(r,1),r.m(n.parentNode,n)):r&&(ae(),R(r,1,1,()=>{r=null}),se())},i(i){e||(E(r),e=!0)},o(i){R(r),e=!1},d(i){i&&L(n),r&&r.d(i)}}}function Tu(t,n,e){let r,i=W,o=()=>(i(),i=qt(f,d=>e(3,r=d)),f),a,s;X(t,de,d=>e(4,a=d)),X(t,hs,d=>e(5,s=d)),t.$$.on_destroy.push(()=>i());let{gjSchemes:f}=n;o();let{authority:l}=n,{filename:u}=n,c=ps(l,u),h=!1;vt(()=>{let d=window.localStorage.getItem(c);if(d!=null){try{let g=JSON.parse(d);f.set(cf(g))}catch(g){console.log(`Failed to load from local storage: ${g}`)}e(6,h=!0)}});const _=()=>uf(l,u,r);return t.$$set=d=>{"gjSchemes"in d&&o(e(0,f=d.gjSchemes)),"authority"in d&&e(1,l=d.authority),"filename"in d&&e(2,u=d.filename)},t.$$.update=()=>{t.$$.dirty&74&&h&&r&&(console.log("GJ changed, saving to local storage"),lf(c,JSON.stringify(ff(l,r))))},[f,l,u,r,a,s,h,_]}class Fu extends ce{constructor(n){super(),he(this,n,Tu,xu,fe,{gjSchemes:0,authority:1,filename:2})}}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function zu(t,n){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(u){return f([l,u])}}function f(l){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,i=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){e.label=l[1];break}if(l[0]===6&&e.label<o[1]){e.label=o[1],o=l;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(l);break}o[2]&&e.ops.pop(),e.trys.pop();continue}l=n.call(t,e)}catch(u){l=[6,u],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var Tt=function(){function t(n,e){this.next=null,this.key=n,this.data=e,this.left=null,this.right=null}return t}();function Du(t,n){return t>n?1:t<n?-1:0}function $t(t,n,e){for(var r=new Tt(null,null),i=r,o=r;;){var a=e(t,n.key);if(a<0){if(n.left===null)break;if(e(t,n.left.key)<0){var s=n.left;if(n.left=s.right,s.right=n,n=s,n.left===null)break}o.left=n,o=n,n=n.left}else if(a>0){if(n.right===null)break;if(e(t,n.right.key)>0){var s=n.right;if(n.right=s.left,s.left=n,n=s,n.right===null)break}i.right=n,i=n,n=n.right}else break}return i.right=n.left,o.left=n.right,n.left=r.right,n.right=r.left,n}function Kr(t,n,e,r){var i=new Tt(t,n);if(e===null)return i.left=i.right=null,i;e=$t(t,e,r);var o=r(t,e.key);return o<0?(i.left=e.left,i.right=e,e.left=null):o>=0&&(i.right=e.right,i.left=e,e.right=null),i}function Co(t,n,e){var r=null,i=null;if(n){n=$t(t,n,e);var o=e(n.key,t);o===0?(r=n.left,i=n.right):o<0?(i=n.right,n.right=null,r=n):(r=n.left,n.left=null,i=n)}return{left:r,right:i}}function Bu(t,n,e){return n===null?t:(t===null||(n=$t(t.key,n,e),n.left=t),n)}function Si(t,n,e,r,i){if(t){r(""+n+(e?"└── ":"├── ")+i(t)+`
`);var o=n+(e?"    ":"│   ");t.left&&Si(t.left,o,!1,r,i),t.right&&Si(t.right,o,!0,r,i)}}var qi=function(){function t(n){n===void 0&&(n=Du),this._root=null,this._size=0,this._comparator=n}return t.prototype.insert=function(n,e){return this._size++,this._root=Kr(n,e,this._root,this._comparator)},t.prototype.add=function(n,e){var r=new Tt(n,e);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,o=$t(n,this._root,i),a=i(n,o.key);return a===0?this._root=o:(a<0?(r.left=o.left,r.right=o,o.left=null):a>0&&(r.right=o.right,r.left=o,o.right=null),this._size++,this._root=r),this._root},t.prototype.remove=function(n){this._root=this._remove(n,this._root,this._comparator)},t.prototype._remove=function(n,e,r){var i;if(e===null)return null;e=$t(n,e,r);var o=r(n,e.key);return o===0?(e.left===null?i=e.right:(i=$t(n,e.left,r),i.right=e.right),this._size--,i):e},t.prototype.pop=function(){var n=this._root;if(n){for(;n.left;)n=n.left;return this._root=$t(n.key,this._root,this._comparator),this._root=this._remove(n.key,this._root,this._comparator),{key:n.key,data:n.data}}return null},t.prototype.findStatic=function(n){for(var e=this._root,r=this._comparator;e;){var i=r(n,e.key);if(i===0)return e;i<0?e=e.left:e=e.right}return null},t.prototype.find=function(n){return this._root&&(this._root=$t(n,this._root,this._comparator),this._comparator(n,this._root.key)!==0)?null:this._root},t.prototype.contains=function(n){for(var e=this._root,r=this._comparator;e;){var i=r(n,e.key);if(i===0)return!0;i<0?e=e.left:e=e.right}return!1},t.prototype.forEach=function(n,e){for(var r=this._root,i=[],o=!1;!o;)r!==null?(i.push(r),r=r.left):i.length!==0?(r=i.pop(),n.call(e,r),r=r.right):o=!0;return this},t.prototype.range=function(n,e,r,i){for(var o=[],a=this._comparator,s=this._root,f;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),f=a(s.key,e),f>0)break;if(a(s.key,n)>=0&&r.call(i,s))return this;s=s.right}return this},t.prototype.keys=function(){var n=[];return this.forEach(function(e){var r=e.key;return n.push(r)}),n},t.prototype.values=function(){var n=[];return this.forEach(function(e){var r=e.data;return n.push(r)}),n},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(n){if(n===void 0&&(n=this._root),n)for(;n.left;)n=n.left;return n},t.prototype.maxNode=function(n){if(n===void 0&&(n=this._root),n)for(;n.right;)n=n.right;return n},t.prototype.at=function(n){for(var e=this._root,r=!1,i=0,o=[];!r;)if(e)o.push(e),e=e.left;else if(o.length>0){if(e=o.pop(),i===n)return e;i++,e=e.right}else r=!0;return null},t.prototype.next=function(n){var e=this._root,r=null;if(n.right){for(r=n.right;r.left;)r=r.left;return r}for(var i=this._comparator;e;){var o=i(n.key,e.key);if(o===0)break;o<0?(r=e,e=e.left):e=e.right}return r},t.prototype.prev=function(n){var e=this._root,r=null;if(n.left!==null){for(r=n.left;r.right;)r=r.right;return r}for(var i=this._comparator;e;){var o=i(n.key,e.key);if(o===0)break;o<0?e=e.left:(r=e,e=e.right)}return r},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return Uu(this._root)},t.prototype.load=function(n,e,r){e===void 0&&(e=[]),r===void 0&&(r=!1);var i=n.length,o=this._comparator;if(r&&Ai(n,e,0,i-1,o),this._root===null)this._root=Ei(n,e,0,i),this._size=i;else{var a=Zu(this.toList(),ju(n,e),o);i=this._size+i,this._root=Mi({head:a},0,i)}return this},t.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(n){n===void 0&&(n=function(r){return String(r.key)});var e=[];return Si(this._root,"",!0,function(r){return e.push(r)},n),e.join("")},t.prototype.update=function(n,e,r){var i=this._comparator,o=Co(n,this._root,i),a=o.left,s=o.right;i(n,e)<0?s=Kr(e,r,s,i):a=Kr(e,r,a,i),this._root=Bu(a,s,i)},t.prototype.split=function(n){return Co(n,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var n;return zu(this,function(e){switch(e.label){case 0:n=this.minNode(),e.label=1;case 1:return n?[4,n]:[3,3];case 2:return e.sent(),n=this.next(n),[3,1];case 3:return[2]}})},t}();function Ei(t,n,e,r){var i=r-e;if(i>0){var o=e+Math.floor(i/2),a=t[o],s=n[o],f=new Tt(a,s);return f.left=Ei(t,n,e,o),f.right=Ei(t,n,o+1,r),f}return null}function ju(t,n){for(var e=new Tt(null,null),r=e,i=0;i<t.length;i++)r=r.next=new Tt(t[i],n[i]);return r.next=null,e.next}function Uu(t){for(var n=t,e=[],r=!1,i=new Tt(null,null),o=i;!r;)n?(e.push(n),n=n.left):e.length>0?(n=o=o.next=e.pop(),n=n.right):r=!0;return o.next=null,i.next}function Mi(t,n,e){var r=e-n;if(r>0){var i=n+Math.floor(r/2),o=Mi(t,n,i),a=t.head;return a.left=o,t.head=t.head.next,a.right=Mi(t,i+1,e),a}return null}function Zu(t,n,e){for(var r=new Tt(null,null),i=r,o=t,a=n;o!==null&&a!==null;)e(o.key,a.key)<0?(i.next=o,o=o.next):(i.next=a,a=a.next),i=i.next;return o!==null?i.next=o:a!==null&&(i.next=a),r.next}function Ai(t,n,e,r,i){if(!(e>=r)){for(var o=t[e+r>>1],a=e-1,s=r+1;;){do a++;while(i(t[a],o)<0);do s--;while(i(t[s],o)>0);if(a>=s)break;var f=t[a];t[a]=t[s],t[s]=f,f=n[a],n[a]=n[s],n[s]=f}Ai(t,n,e,s,i),Ai(t,n,s+1,r,i)}}function Je(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function Oo(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Oe(t,n,e){return n&&Oo(t.prototype,n),e&&Oo(t,e),t}var Mn=function(n,e){return n.ll.x<=e.x&&e.x<=n.ur.x&&n.ll.y<=e.y&&e.y<=n.ur.y},Ri=function(n,e){if(e.ur.x<n.ll.x||n.ur.x<e.ll.x||e.ur.y<n.ll.y||n.ur.y<e.ll.y)return null;var r=n.ll.x<e.ll.x?e.ll.x:n.ll.x,i=n.ur.x<e.ur.x?n.ur.x:e.ur.x,o=n.ll.y<e.ll.y?e.ll.y:n.ll.y,a=n.ur.y<e.ur.y?n.ur.y:e.ur.y;return{ll:{x:r,y:o},ur:{x:i,y:a}}},At=Number.EPSILON;At===void 0&&(At=Math.pow(2,-52));var Gu=At*At,Pi=function(n,e){if(-At<n&&n<At&&-At<e&&e<At)return 0;var r=n-e;return r*r<Gu*n*e?0:n<e?-1:1},Hu=function(){function t(){Je(this,t),this.reset()}return Oe(t,[{key:"reset",value:function(){this.xRounder=new Io,this.yRounder=new Io}},{key:"round",value:function(e,r){return{x:this.xRounder.round(e),y:this.yRounder.round(r)}}}]),t}(),Io=function(){function t(){Je(this,t),this.tree=new qi,this.round(0)}return Oe(t,[{key:"round",value:function(e){var r=this.tree.add(e),i=this.tree.prev(r);if(i!==null&&Pi(r.key,i.key)===0)return this.tree.remove(e),i.key;var o=this.tree.next(r);return o!==null&&Pi(r.key,o.key)===0?(this.tree.remove(e),o.key):e}}]),t}(),Un=new Hu,Fn=function(n,e){return n.x*e.y-n.y*e.x},zs=function(n,e){return n.x*e.x+n.y*e.y},xo=function(n,e,r){var i={x:e.x-n.x,y:e.y-n.y},o={x:r.x-n.x,y:r.y-n.y},a=Fn(i,o);return Pi(a,0)},Nr=function(n){return Math.sqrt(zs(n,n))},Yu=function(n,e,r){var i={x:e.x-n.x,y:e.y-n.y},o={x:r.x-n.x,y:r.y-n.y};return Fn(o,i)/Nr(o)/Nr(i)},Xu=function(n,e,r){var i={x:e.x-n.x,y:e.y-n.y},o={x:r.x-n.x,y:r.y-n.y};return zs(o,i)/Nr(o)/Nr(i)},To=function(n,e,r){return e.y===0?null:{x:n.x+e.x/e.y*(r-n.y),y:r}},Fo=function(n,e,r){return e.x===0?null:{x:r,y:n.y+e.y/e.x*(r-n.x)}},qu=function(n,e,r,i){if(e.x===0)return Fo(r,i,n.x);if(i.x===0)return Fo(n,e,r.x);if(e.y===0)return To(r,i,n.y);if(i.y===0)return To(n,e,r.y);var o=Fn(e,i);if(o==0)return null;var a={x:r.x-n.x,y:r.y-n.y},s=Fn(a,e)/o,f=Fn(a,i)/o,l=n.x+f*e.x,u=r.x+s*i.x,c=n.y+f*e.y,h=r.y+s*i.y,_=(l+u)/2,d=(c+h)/2;return{x:_,y:d}},ft=function(){Oe(t,null,[{key:"compare",value:function(e,r){var i=t.comparePoints(e.point,r.point);return i!==0?i:(e.point!==r.point&&e.link(r),e.isLeft!==r.isLeft?e.isLeft?1:-1:Cr.compare(e.segment,r.segment))}},{key:"comparePoints",value:function(e,r){return e.x<r.x?-1:e.x>r.x?1:e.y<r.y?-1:e.y>r.y?1:0}}]);function t(n,e){Je(this,t),n.events===void 0?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=e}return Oe(t,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var r=e.point.events,i=0,o=r.length;i<o;i++){var a=r[i];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,r=0;r<e;r++){var i=this.point.events[r];if(i.segment.consumedBy===void 0)for(var o=r+1;o<e;o++){var a=this.point.events[o];a.consumedBy===void 0&&i.otherSE.point.events===a.otherSE.point.events&&i.segment.consume(a.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],r=0,i=this.point.events.length;r<i;r++){var o=this.point.events[r];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&e.push(o)}return e}},{key:"getLeftmostComparator",value:function(e){var r=this,i=new Map,o=function(s){var f=s.otherSE;i.set(s,{sine:Yu(r.point,e.point,f.point),cosine:Xu(r.point,e.point,f.point)})};return function(a,s){i.has(a)||o(a),i.has(s)||o(s);var f=i.get(a),l=f.sine,u=f.cosine,c=i.get(s),h=c.sine,_=c.cosine;return l>=0&&h>=0?u<_?1:u>_?-1:0:l<0&&h<0?u<_?-1:u>_?1:0:h<l?-1:h>l?1:0}}}]),t}(),Ju=0,Cr=function(){Oe(t,null,[{key:"compare",value:function(e,r){var i=e.leftSE.point.x,o=r.leftSE.point.x,a=e.rightSE.point.x,s=r.rightSE.point.x;if(s<i)return 1;if(a<o)return-1;var f=e.leftSE.point.y,l=r.leftSE.point.y,u=e.rightSE.point.y,c=r.rightSE.point.y;if(i<o){if(l<f&&l<u)return 1;if(l>f&&l>u)return-1;var h=e.comparePoint(r.leftSE.point);if(h<0)return 1;if(h>0)return-1;var _=r.comparePoint(e.rightSE.point);return _!==0?_:-1}if(i>o){if(f<l&&f<c)return-1;if(f>l&&f>c)return 1;var d=r.comparePoint(e.leftSE.point);if(d!==0)return d;var g=e.comparePoint(r.rightSE.point);return g<0?1:g>0?-1:1}if(f<l)return-1;if(f>l)return 1;if(a<s){var w=r.comparePoint(e.rightSE.point);if(w!==0)return w}if(a>s){var k=e.comparePoint(r.rightSE.point);if(k<0)return 1;if(k>0)return-1}if(a!==s){var b=u-f,p=a-i,v=c-l,m=s-o;if(b>p&&v<m)return 1;if(b<p&&v>m)return-1}return a>s?1:a<s||u<c?-1:u>c?1:e.id<r.id?-1:e.id>r.id?1:0}}]);function t(n,e,r,i){Je(this,t),this.id=++Ju,this.leftSE=n,n.segment=this,n.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=n,this.rings=r,this.windings=i}return Oe(t,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<r?e:r},ur:{x:this.rightSE.point.x,y:e>r?e:r}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var r=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(r.x===i.x)return e.x===r.x?0:e.x<r.x?1:-1;var a=(e.y-r.y)/o.y,s=r.x+a*o.x;if(e.x===s)return 0;var f=(e.x-r.x)/o.x,l=r.y+f*o.y;return e.y===l?0:e.y<l?-1:1}},{key:"getIntersection",value:function(e){var r=this.bbox(),i=e.bbox(),o=Ri(r,i);if(o===null)return null;var a=this.leftSE.point,s=this.rightSE.point,f=e.leftSE.point,l=e.rightSE.point,u=Mn(r,f)&&this.comparePoint(f)===0,c=Mn(i,a)&&e.comparePoint(a)===0,h=Mn(r,l)&&this.comparePoint(l)===0,_=Mn(i,s)&&e.comparePoint(s)===0;if(c&&u)return _&&!h?s:!_&&h?l:null;if(c)return h&&a.x===l.x&&a.y===l.y?null:a;if(u)return _&&s.x===f.x&&s.y===f.y?null:f;if(_&&h)return null;if(_)return s;if(h)return l;var d=qu(a,this.vector(),f,e.vector());return d===null||!Mn(o,d)?null:Un.round(d.x,d.y)}},{key:"split",value:function(e){var r=[],i=e.events!==void 0,o=new ft(e,!0),a=new ft(e,!1),s=this.rightSE;this.replaceRightSE(a),r.push(a),r.push(o);var f=new t(o,s,this.rings.slice(),this.windings.slice());return ft.comparePoints(f.leftSE.point,f.rightSE.point)>0&&f.swapEvents(),ft.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),a.checkForConsuming()),r}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var r=0,i=this.windings.length;r<i;r++)this.windings[r]*=-1}},{key:"consume",value:function(e){for(var r=this,i=e;r.consumedBy;)r=r.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=t.compare(r,i);if(o!==0){if(o>0){var a=r;r=i,i=a}if(r.prev===i){var s=r;r=i,i=s}for(var f=0,l=i.rings.length;f<l;f++){var u=i.rings[f],c=i.windings[f],h=r.rings.indexOf(u);h===-1?(r.rings.push(u),r.windings.push(c)):r.windings[h]+=c}i.rings=null,i.windings=null,i.consumedBy=r,i.leftSE.consumedBy=r.leftSE,i.rightSE.consumedBy=r.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var r=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,a=0,s=this.rings.length;a<s;a++){var f=this.rings[a],l=this.windings[a],u=r.indexOf(f);u===-1?(r.push(f),i.push(l)):i[u]+=l}for(var c=[],h=[],_=0,d=r.length;_<d;_++)if(i[_]!==0){var g=r[_],w=g.poly;if(h.indexOf(w)===-1)if(g.isExterior)c.push(w);else{h.indexOf(w)===-1&&h.push(w);var k=c.indexOf(g.poly);k!==-1&&c.splice(k,1)}}for(var b=0,p=c.length;b<p;b++){var v=c[b].multiPoly;o.indexOf(v)===-1&&o.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var e=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(rt.type){case"union":{var i=e.length===0,o=r.length===0;this._isInResult=i!==o;break}case"intersection":{var a,s;e.length<r.length?(a=e.length,s=r.length):(a=r.length,s=e.length),this._isInResult=s===rt.numMultiPolys&&a<s;break}case"xor":{var f=Math.abs(e.length-r.length);this._isInResult=f%2===1;break}case"difference":{var l=function(c){return c.length===1&&c[0].isSubject};this._isInResult=l(e)!==l(r);break}default:throw new Error("Unrecognized operation type found ".concat(rt.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,r,i){var o,a,s,f=ft.comparePoints(e,r);if(f<0)o=e,a=r,s=1;else if(f>0)o=r,a=e,s=-1;else throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));var l=new ft(o,!0),u=new ft(a,!1);return new t(l,u,[i],[s])}}]),t}(),zo=function(){function t(n,e,r){if(Je(this,t),!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=r,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Un.round(n[0][0],n[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,a=1,s=n.length;a<s;a++){if(typeof n[a][0]!="number"||typeof n[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var f=Un.round(n[a][0],n[a][1]);f.x===o.x&&f.y===o.y||(this.segments.push(Cr.fromRing(o,f,this)),f.x<this.bbox.ll.x&&(this.bbox.ll.x=f.x),f.y<this.bbox.ll.y&&(this.bbox.ll.y=f.y),f.x>this.bbox.ur.x&&(this.bbox.ur.x=f.x),f.y>this.bbox.ur.y&&(this.bbox.ur.y=f.y),o=f)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Cr.fromRing(o,i,this))}return Oe(t,[{key:"getSweepEvents",value:function(){for(var e=[],r=0,i=this.segments.length;r<i;r++){var o=this.segments[r];e.push(o.leftSE),e.push(o.rightSE)}return e}}]),t}(),Wu=function(){function t(n,e){if(Je(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new zo(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=n.length;r<i;r++){var o=new zo(n[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=e}return Oe(t,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),r=0,i=this.interiorRings.length;r<i;r++)for(var o=this.interiorRings[r].getSweepEvents(),a=0,s=o.length;a<s;a++)e.push(o[a]);return e}}]),t}(),Do=function(){function t(n,e){if(Je(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=n.length;r<i;r++){var o=new Wu(n[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=e}return Oe(t,[{key:"getSweepEvents",value:function(){for(var e=[],r=0,i=this.polys.length;r<i;r++)for(var o=this.polys[r].getSweepEvents(),a=0,s=o.length;a<s;a++)e.push(o[a]);return e}}]),t}(),Ku=function(){Oe(t,null,[{key:"factory",value:function(e){for(var r=[],i=0,o=e.length;i<o;i++){var a=e[i];if(!(!a.isInResult()||a.ringOut)){for(var s=null,f=a.leftSE,l=a.rightSE,u=[f],c=f.point,h=[];s=f,f=l,u.push(f),f.point!==c;)for(;;){var _=f.getAvailableLinkedEvents();if(_.length===0){var d=u[0].point,g=u[u.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(_.length===1){l=_[0].otherSE;break}for(var w=null,k=0,b=h.length;k<b;k++)if(h[k].point===f.point){w=k;break}if(w!==null){var p=h.splice(w)[0],v=u.splice(p.index);v.unshift(v[0].otherSE),r.push(new t(v.reverse()));continue}h.push({index:u.length,point:f.point});var m=f.getLeftmostComparator(s);l=_.sort(m)[0].otherSE;break}r.push(new t(u))}}return r}}]);function t(n){Je(this,t),this.events=n;for(var e=0,r=n.length;e<r;e++)n[e].segment.ringOut=this;this.poly=null}return Oe(t,[{key:"getGeom",value:function(){for(var e=this.events[0].point,r=[e],i=1,o=this.events.length-1;i<o;i++){var a=this.events[i].point,s=this.events[i+1].point;xo(a,e,s)!==0&&(r.push(a),e=a)}if(r.length===1)return null;var f=r[0],l=r[1];xo(f,e,l)===0&&r.shift(),r.push(r[0]);for(var u=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:r.length-1,h=this.isExteriorRing()?r.length:-1,_=[],d=c;d!=h;d+=u)_.push([r[d].x,r[d].y]);return _}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],r=1,i=this.events.length;r<i;r++){var o=this.events[r];ft.compare(e,o)>0&&(e=o)}for(var a=e.segment.prevInResult(),s=a?a.prevInResult():null;;){if(!a)return null;if(!s)return a.ringOut;if(s.ringOut!==a.ringOut)return s.ringOut.enclosingRing()!==a.ringOut?a.ringOut:a.ringOut.enclosingRing();a=s.prevInResult(),s=a?a.prevInResult():null}}}]),t}(),Bo=function(){function t(n){Je(this,t),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}return Oe(t,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(var r=0,i=this.interiorRings.length;r<i;r++){var o=this.interiorRings[r].getGeom();o!==null&&e.push(o)}return e}}]),t}(),Vu=function(){function t(n){Je(this,t),this.rings=n,this.polys=this._composePolys(n)}return Oe(t,[{key:"getGeom",value:function(){for(var e=[],r=0,i=this.polys.length;r<i;r++){var o=this.polys[r].getGeom();o!==null&&e.push(o)}return e}},{key:"_composePolys",value:function(e){for(var r=[],i=0,o=e.length;i<o;i++){var a=e[i];if(!a.poly)if(a.isExteriorRing())r.push(new Bo(a));else{var s=a.enclosingRing();s.poly||r.push(new Bo(s)),s.poly.addInterior(a)}}return r}}]),t}(),Qu=function(){function t(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Cr.compare;Je(this,t),this.queue=n,this.tree=new qi(e),this.segments=[]}return Oe(t,[{key:"process",value:function(e){var r=e.segment,i=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(r),i;var o=e.isLeft?this.tree.insert(r):this.tree.find(r);if(!o)throw new Error("Unable to find segment #".concat(r.id," ")+"[".concat(r.leftSE.point.x,", ").concat(r.leftSE.point.y,"] -> ")+"[".concat(r.rightSE.point.x,", ").concat(r.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var a=o,s=o,f=void 0,l=void 0;f===void 0;)a=this.tree.prev(a),a===null?f=null:a.key.consumedBy===void 0&&(f=a.key);for(;l===void 0;)s=this.tree.next(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);if(e.isLeft){var u=null;if(f){var c=f.getIntersection(r);if(c!==null&&(r.isAnEndpoint(c)||(u=c),!f.isAnEndpoint(c)))for(var h=this._splitSafely(f,c),_=0,d=h.length;_<d;_++)i.push(h[_])}var g=null;if(l){var w=l.getIntersection(r);if(w!==null&&(r.isAnEndpoint(w)||(g=w),!l.isAnEndpoint(w)))for(var k=this._splitSafely(l,w),b=0,p=k.length;b<p;b++)i.push(k[b])}if(u!==null||g!==null){var v=null;if(u===null)v=g;else if(g===null)v=u;else{var m=ft.comparePoints(u,g);v=m<=0?u:g}this.queue.remove(r.rightSE),i.push(r.rightSE);for(var A=r.split(v),$=0,O=A.length;$<O;$++)i.push(A[$])}i.length>0?(this.tree.remove(r),i.push(e)):(this.segments.push(r),r.prev=f)}else{if(f&&l){var F=f.getIntersection(l);if(F!==null){if(!f.isAnEndpoint(F))for(var N=this._splitSafely(f,F),S=0,M=N.length;S<M;S++)i.push(N[S]);if(!l.isAnEndpoint(F))for(var y=this._splitSafely(l,F),C=0,Z=y.length;C<Z;C++)i.push(y[C])}}this.tree.remove(r)}return i}},{key:"_splitSafely",value:function(e,r){this.tree.remove(e);var i=e.rightSE;this.queue.remove(i);var o=e.split(r);return o.push(i),e.consumedBy===void 0&&this.tree.insert(e),o}}]),t}(),jo=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ec=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,tc=function(){function t(){Je(this,t)}return Oe(t,[{key:"run",value:function(e,r,i){rt.type=e,Un.reset();for(var o=[new Do(r,!0)],a=0,s=i.length;a<s;a++)o.push(new Do(i[a],!1));if(rt.numMultiPolys=o.length,rt.type==="difference")for(var f=o[0],l=1;l<o.length;)Ri(o[l].bbox,f.bbox)!==null?l++:o.splice(l,1);if(rt.type==="intersection"){for(var u=0,c=o.length;u<c;u++)for(var h=o[u],_=u+1,d=o.length;_<d;_++)if(Ri(h.bbox,o[_].bbox)===null)return[]}for(var g=new qi(ft.compare),w=0,k=o.length;w<k;w++)for(var b=o[w].getSweepEvents(),p=0,v=b.length;p<v;p++)if(g.insert(b[p]),g.size>jo)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var m=new Qu(g),A=g.size,$=g.pop();$;){var O=$.key;if(g.size===A){var F=O.segment;throw new Error("Unable to pop() ".concat(O.isLeft?"left":"right"," SweepEvent ")+"[".concat(O.point.x,", ").concat(O.point.y,"] from segment #").concat(F.id," ")+"[".concat(F.leftSE.point.x,", ").concat(F.leftSE.point.y,"] -> ")+"[".concat(F.rightSE.point.x,", ").concat(F.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>jo)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(m.segments.length>ec)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var N=m.process(O),S=0,M=N.length;S<M;S++){var y=N[S];y.consumedBy===void 0&&g.insert(y)}A=g.size,$=g.pop()}Un.reset();var C=Ku.factory(m.segments),Z=new Vu(C);return Z.getGeom()}}]),t}(),rt=new tc,nc=function(n){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return rt.run("union",n,r)},rc=function(n){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return rt.run("intersection",n,r)},ic=function(n){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return rt.run("xor",n,r)},oc=function(n){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return rt.run("difference",n,r)},kr={union:nc,intersection:rc,xor:ic,difference:oc},ac=Object.defineProperty,jr=(t,n)=>ac(t,"name",{value:n,configurable:!0});function Ds(t,n){var e=js(n),r=null;return t.type==="FeatureCollection"?r=Bs(t):r=Ji(kr.union(t.geometry.coordinates)),r.geometry.coordinates.forEach(function(i){e.geometry.coordinates.push(i[0])}),e}jr(Ds,"mask");function Bs(t){var n=t.features.length===2?kr.union(t.features[0].geometry.coordinates,t.features[1].geometry.coordinates):kr.union.apply(kr,t.features.map(function(e){return e.geometry.coordinates}));return Ji(n)}jr(Bs,"unionFc");function Ji(t){return Yl(t)}jr(Ji,"createGeomFromPolygonClippingOutput");function js(t){var n=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]],e=t&&t.geometry.coordinates||n;return Xl(e)}jr(js,"createMask");var Uo=Ds;function sc(t){let n,e;const r=[ge(t[0],"boundary"),{paint:{"fill-color":"black","fill-opacity":.5}}];let i={};for(let o=0;o<r.length;o+=1)i=Ve(i,r[o]);return n=new Ui({props:i}),{c(){I(n.$$.fragment)},m(o,a){x(n,o,a),e=!0},p(o,a){const s=a&1?Qe(r,[et(ge(o[0],"boundary")),r[1]]):{};n.$set(s)},i(o){e||(E(n.$$.fragment,o),e=!0)},o(o){R(n.$$.fragment,o),e=!1},d(o){T(n,o)}}}function lc(t){let n,e;return n=new It({props:{data:Uo(t[1]),$$slots:{default:[sc]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,[i]){const o={};i&2&&(o.data=Uo(r[1])),i&17&&(o.$$scope={dirty:i,ctx:r}),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function fc(t,n,e){let r;X(t,Ze,s=>e(3,r=s));let{cfg:i}=n,{boundaryGeojson:o}=n,{fitBoundsAtStart:a=!1}=n;return(ql("setCamera")||a)&&(r==null||r.fitBounds(vs(o),{padding:20,animate:!1})),t.$$set=s=>{"cfg"in s&&e(0,i=s.cfg),"boundaryGeojson"in s&&e(1,o=s.boundaryGeojson),"fitBoundsAtStart"in s&&e(2,a=s.fitBoundsAtStart)},[i,o,a]}class uc extends ce{constructor(n){super(),he(this,n,fc,lc,fe,{cfg:0,boundaryGeojson:1,fitBoundsAtStart:2})}}const Sr=We(null),Er=We(100);function Zo(t){let n,e;return n=new Of({props:{url:t[3],coordinates:[[t[1].lng,t[1].lat],[t[4].lng,t[1].lat],[t[4].lng,t[4].lat],[t[1].lng,t[4].lat]],$$slots:{default:[cc]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i&8&&(o.url=r[3]),i&18&&(o.coordinates=[[r[1].lng,r[1].lat],[r[4].lng,r[1].lat],[r[4].lng,r[4].lat],[r[1].lng,r[4].lat]]),i&545&&(o.$$scope={dirty:i,ctx:r}),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function cc(t){let n,e;const r=[ge(t[0],"georeferenced-image"),{paint:{"raster-fade-duration":0,"raster-opacity":t[5]/100}}];let i={};for(let o=0;o<r.length;o+=1)i=Ve(i,r[o]);return n=new Ff({props:i}),{c(){I(n.$$.fragment)},m(o,a){x(n,o,a),e=!0},p(o,a){const s=a&33?Qe(r,[a&1&&et(ge(o[0],"georeferenced-image")),a&32&&{paint:{"raster-fade-duration":0,"raster-opacity":o[5]/100}}]):{};n.$set(s)},i(o){e||(E(n.$$.fragment,o),e=!0)},o(o){R(n.$$.fragment,o),e=!1},d(o){T(n,o)}}}function Go(t){let n,e,r,i,o,a;function s(c){t[7](c)}let f={draggable:!0,$$slots:{default:[hc]},$$scope:{ctx:t}};t[1]!==void 0&&(f.lngLat=t[1]),n=new Ht({props:f}),we.push(()=>Se(n,"lngLat",s));function l(c){t[8](c)}let u={draggable:!0,$$slots:{default:[dc]},$$scope:{ctx:t}};return t[4]!==void 0&&(u.lngLat=t[4]),i=new Ht({props:u}),we.push(()=>Se(i,"lngLat",l)),{c(){I(n.$$.fragment),r=z(),I(i.$$.fragment)},m(c,h){x(n,c,h),P(c,r,h),x(i,c,h),a=!0},p(c,h){const _={};h&512&&(_.$$scope={dirty:h,ctx:c}),!e&&h&2&&(e=!0,_.lngLat=c[1],Pe(()=>e=!1)),n.$set(_);const d={};h&512&&(d.$$scope={dirty:h,ctx:c}),!o&&h&16&&(o=!0,d.lngLat=c[4],Pe(()=>o=!1)),i.$set(d)},i(c){a||(E(n.$$.fragment,c),E(i.$$.fragment,c),a=!0)},o(c){R(n.$$.fragment,c),R(i.$$.fragment,c),a=!1},d(c){c&&L(r),T(n,c),T(i,c)}}}function hc(t){let n;return{c(){n=D("span"),U(n,"class","dot svelte-1tmbx1c"),re(n,"background-color","red")},m(e,r){P(e,n,r)},p:W,d(e){e&&L(n)}}}function dc(t){let n;return{c(){n=D("span"),U(n,"class","dot svelte-1tmbx1c"),re(n,"background-color","blue")},m(e,r){P(e,n,r)},p:W,d(e){e&&L(n)}}}function _c(t){let n,e,r,i=t[3]&&Zo(t),o=t[3]&&t[2].mode=="set-image"&&Go(t);return{c(){i&&i.c(),n=z(),o&&o.c(),e=Le()},m(a,s){i&&i.m(a,s),P(a,n,s),o&&o.m(a,s),P(a,e,s),r=!0},p(a,[s]){a[3]?i?(i.p(a,s),s&8&&E(i,1)):(i=Zo(a),i.c(),E(i,1),i.m(n.parentNode,n)):i&&(ae(),R(i,1,1,()=>{i=null}),se()),a[3]&&a[2].mode=="set-image"?o?(o.p(a,s),s&12&&E(o,1)):(o=Go(a),o.c(),E(o,1),o.m(e.parentNode,e)):o&&(ae(),R(o,1,1,()=>{o=null}),se())},i(a){r||(E(i),E(o),r=!0)},o(a){R(i),R(o),r=!1},d(a){a&&(L(n),L(e)),i&&i.d(a),o&&o.d(a)}}}function pc(t,n,e){let r,i,o,a;X(t,Ze,h=>e(6,r=h)),X(t,de,h=>e(2,i=h)),X(t,Sr,h=>e(3,o=h)),X(t,Er,h=>e(5,a=h));let{cfg:s}=n,f={lng:0,lat:0},l={lng:0,lat:0};function u(h){f=h,e(1,f),e(6,r),e(3,o),e(2,i)}function c(h){l=h,e(4,l),e(6,r),e(3,o),e(2,i),e(1,f)}return t.$$set=h=>{"cfg"in h&&e(0,s=h.cfg)},t.$$.update=()=>{if(t.$$.dirty&78&&r&&o&&i.mode=="set-image"&&f.lng==0&&f.lat==0){let h=r.getBounds();e(1,f.lng=h.getWest()+.4*(h.getEast()-h.getWest()),f),e(4,l.lng=h.getWest()+.6*(h.getEast()-h.getWest()),l),e(1,f.lat=h.getNorth()+.4*(h.getSouth()-h.getNorth()),f),e(4,l.lat=h.getNorth()+.6*(h.getSouth()-h.getNorth()),l)}},[s,f,i,o,l,a,r,u,c]}class gc extends ce{constructor(n){super(),he(this,n,pc,_c,fe,{cfg:0})}}function mc(t){let n,e,r,i,o,a;const s=[ge(t[0],"hover-polygons"),{filter:Rn},{paint:{"line-color":wr.hovering,"line-width":.5*jt}}];let f={};for(let _=0;_<s.length;_+=1)f=Ve(f,s[_]);n=new xt({props:f});const l=[ge(t[0],"hover-lines"),{filter:_i},{paint:{"line-color":wr.hovering,"line-width":1.5*jt}}];let u={};for(let _=0;_<l.length;_+=1)u=Ve(u,l[_]);r=new xt({props:u});const c=[ge(t[0],"hover-points"),{filter:pi},{paint:{"circle-color":wr.hovering,"circle-radius":1.5*hi}}];let h={};for(let _=0;_<c.length;_+=1)h=Ve(h,c[_]);return o=new Rr({props:h}),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment),i=z(),I(o.$$.fragment)},m(_,d){x(n,_,d),P(_,e,d),x(r,_,d),P(_,i,d),x(o,_,d),a=!0},p(_,d){const g=d&1?Qe(s,[et(ge(_[0],"hover-polygons")),s[1],s[2]]):{};n.$set(g);const w=d&1?Qe(l,[et(ge(_[0],"hover-lines")),l[1],l[2]]):{};r.$set(w);const k=d&1?Qe(c,[et(ge(_[0],"hover-points")),c[1],c[2]]):{};o.$set(k)},i(_){a||(E(n.$$.fragment,_),E(r.$$.fragment,_),E(o.$$.fragment,_),a=!0)},o(_){R(n.$$.fragment,_),R(r.$$.fragment,_),R(o.$$.fragment,_),a=!1},d(_){_&&(L(e),L(i)),T(n,_),T(r,_),T(o,_)}}}function bc(t){let n,e;return n=new It({props:{data:t[2],$$slots:{default:[mc]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,[i]){const o={};i&4&&(o.data=r[2]),i&33&&(o.$$scope={dirty:i,ctx:r}),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function vc(t,n,e){let r,i,o,a=W,s=()=>(a(),a=qt(l,u=>e(4,o=u)),l);X(t,vr,u=>e(3,i=u)),t.$$.on_destroy.push(()=>a());let{cfg:f}=n,{gjSchemes:l}=n;return s(),t.$$set=u=>{"cfg"in u&&e(0,f=u.cfg),"gjSchemes"in u&&s(e(1,l=u.gjSchemes))},t.$$.update=()=>{t.$$.dirty&24&&e(2,r=i==null?it():o.features.find(u=>u.id==i))},[f,l,r,i,o]}class wc extends ce{constructor(n){super(),he(this,n,vc,bc,fe,{cfg:0,gjSchemes:1})}}function Ho(t){let n,e;return n=new Zi({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[yc,({features:r})=>({16:r}),({features:r})=>r?65536:0]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:r}),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function yc(t){let n,e,r=t[9](t[16])+"",i;return{c(){n=D("div"),e=D("p"),i=q(r),U(n,"class","govuk-prose")},m(o,a){P(o,n,a),B(n,e),B(e,i)},p(o,a){a&65536&&r!==(r=o[9](o[16])+"")&&je(i,r)},d(o){o&&L(n)}}}function $c(t){let n,e,r=t[4]&&Ho(t);return{c(){r&&r.c(),n=Le()},m(i,o){r&&r.m(i,o),P(i,n,o),e=!0},p(i,o){i[4]?r?(r.p(i,o),o&16&&E(r,1)):(r=Ho(i),r.c(),E(r,1),r.m(n.parentNode,n)):r&&(ae(),R(r,1,1,()=>{r=null}),se())},i(i){e||(E(r),e=!0)},o(i){R(r),e=!1},d(i){i&&L(n),r&&r.d(i)}}}function Yo(t){let n,e;return n=new Zi({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[kc,({features:r})=>({16:r}),({features:r})=>r?65536:0]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:r}),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function kc(t){let n,e,r=t[9](t[16])+"",i;return{c(){n=D("div"),e=D("p"),i=q(r),U(n,"class","govuk-prose")},m(o,a){P(o,n,a),B(n,e),B(e,i)},p(o,a){a&65536&&r!==(r=o[9](o[16])+"")&&je(i,r)},d(o){o&&L(n)}}}function Sc(t){let n,e,r=t[4]&&Yo(t);return{c(){r&&r.c(),n=Le()},m(i,o){r&&r.m(i,o),P(i,n,o),e=!0},p(i,o){i[4]?r?(r.p(i,o),o&16&&E(r,1)):(r=Yo(i),r.c(),E(r,1),r.m(n.parentNode,n)):r&&(ae(),R(r,1,1,()=>{r=null}),se())},i(i){e||(E(r),e=!0)},o(i){R(r),e=!1},d(i){i&&L(n),r&&r.d(i)}}}function Xo(t){let n,e;return n=new Zi({props:{openOn:"hover",openIfTopMost:!0,$$slots:{default:[Ec,({features:r})=>({16:r}),({features:r})=>r?65536:0]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:r}),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Ec(t){let n,e,r=t[9](t[16])+"",i;return{c(){n=D("div"),e=D("p"),i=q(r),U(n,"class","govuk-prose")},m(o,a){P(o,n,a),B(n,e),B(e,i)},p(o,a){a&65536&&r!==(r=o[9](o[16])+"")&&je(i,r)},d(o){o&&L(n)}}}function Mc(t){let n,e,r=t[4]&&Xo(t);return{c(){r&&r.c(),n=Le()},m(i,o){r&&r.m(i,o),P(i,n,o),e=!0},p(i,o){i[4]?r?(r.p(i,o),o&16&&E(r,1)):(r=Xo(i),r.c(),E(r,1),r.m(n.parentNode,n)):r&&(ae(),R(r,1,1,()=>{r=null}),se())},i(i){e||(E(r),e=!0)},o(i){R(r),e=!1},d(i){i&&L(n),r&&r.d(i)}}}function Ac(t){let n,e,r,i,o,a,s,f,l,u;const c=[ge(t[0],"interventions-points"),{filter:["all",pi,t[6],t[7],t[3]]},{paint:{"circle-color":t[2],"circle-radius":hi}},{hoverCursor:t[4]?"pointer":void 0},{manageHoverState:t[4]}];let h={$$slots:{default:[$c]},$$scope:{ctx:t}};for(let m=0;m<c.length;m+=1)h=Ve(h,c[m]);n=new Rr({props:h}),n.$on("click",t[8]);const _=[ge(t[0],"interventions-lines"),{filter:["all",_i,t[6],t[3]]},{paint:{"line-color":t[2],"line-width":jt}},{hoverCursor:t[4]?"pointer":void 0},{manageHoverState:t[4]}];let d={$$slots:{default:[Sc]},$$scope:{ctx:t}};for(let m=0;m<_.length;m+=1)d=Ve(d,_[m]);r=new xt({props:d}),r.$on("click",t[8]);const g=[ge(t[0],"interventions-lines-endpoints"),{filter:["all",["==",["get","endpoint"],!0],t[3]]},{paint:{"circle-radius":.5*jt,"circle-opacity":0,"circle-stroke-color":wr.lineEndpointColor,"circle-stroke-width":2}}];let w={};for(let m=0;m<g.length;m+=1)w=Ve(w,g[m]);o=new Rr({props:w});const k=[ge(t[0],"interventions-polygons"),{filter:["all",Rn,t[6],t[3]]},{paint:{"fill-color":t[2],"fill-opacity":.2}},{hoverCursor:t[4]?"pointer":void 0},{manageHoverState:t[4]}];let b={$$slots:{default:[Mc]},$$scope:{ctx:t}};for(let m=0;m<k.length;m+=1)b=Ve(b,k[m]);s=new Ui({props:b}),s.$on("click",t[8]);const p=[ge(t[0],"interventions-polygons-outlines"),{filter:["all",Rn,t[6],t[3]]},{paint:{"line-color":t[2],"line-opacity":.5,"line-width":.7*jt}}];let v={};for(let m=0;m<p.length;m+=1)v=Ve(v,p[m]);return l=new xt({props:v}),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment),i=z(),I(o.$$.fragment),a=z(),I(s.$$.fragment),f=z(),I(l.$$.fragment)},m(m,A){x(n,m,A),P(m,e,A),x(r,m,A),P(m,i,A),x(o,m,A),P(m,a,A),x(s,m,A),P(m,f,A),x(l,m,A),u=!0},p(m,A){const $=A&221?Qe(c,[A&1&&et(ge(m[0],"interventions-points")),A&200&&{filter:["all",pi,m[6],m[7],m[3]]},A&4&&{paint:{"circle-color":m[2],"circle-radius":hi}},A&16&&{hoverCursor:m[4]?"pointer":void 0},A&16&&{manageHoverState:m[4]}]):{};A&131088&&($.$$scope={dirty:A,ctx:m}),n.$set($);const O=A&93?Qe(_,[A&1&&et(ge(m[0],"interventions-lines")),A&72&&{filter:["all",_i,m[6],m[3]]},A&4&&{paint:{"line-color":m[2],"line-width":jt}},A&16&&{hoverCursor:m[4]?"pointer":void 0},A&16&&{manageHoverState:m[4]}]):{};A&131088&&(O.$$scope={dirty:A,ctx:m}),r.$set(O);const F=A&9?Qe(g,[A&1&&et(ge(m[0],"interventions-lines-endpoints")),A&8&&{filter:["all",["==",["get","endpoint"],!0],m[3]]},g[2]]):{};o.$set(F);const N=A&93?Qe(k,[A&1&&et(ge(m[0],"interventions-polygons")),A&72&&{filter:["all",Rn,m[6],m[3]]},A&4&&{paint:{"fill-color":m[2],"fill-opacity":.2}},A&16&&{hoverCursor:m[4]?"pointer":void 0},A&16&&{manageHoverState:m[4]}]):{};A&131088&&(N.$$scope={dirty:A,ctx:m}),s.$set(N);const S=A&77?Qe(p,[A&1&&et(ge(m[0],"interventions-polygons-outlines")),A&72&&{filter:["all",Rn,m[6],m[3]]},A&4&&{paint:{"line-color":m[2],"line-opacity":.5,"line-width":.7*jt}}]):{};l.$set(S)},i(m){u||(E(n.$$.fragment,m),E(r.$$.fragment,m),E(o.$$.fragment,m),E(s.$$.fragment,m),E(l.$$.fragment,m),u=!0)},o(m){R(n.$$.fragment,m),R(r.$$.fragment,m),R(o.$$.fragment,m),R(s.$$.fragment,m),R(l.$$.fragment,m),u=!1},d(m){m&&(L(e),L(i),L(a),L(f)),T(n,m),T(r,m),T(o,m),T(s,m),T(l,m)}}}function Rc(t){let n,e;return n=new It({props:{data:t[5],$$slots:{default:[Ac]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,[i]){const o={};i&32&&(o.data=r[5]),i&131101&&(o.$$scope={dirty:i,ctx:r}),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Pc(t){let n=["all"];for(let e of t.keys())n.push(["!=",["get","scheme_reference"],e]);return n}function Lc(t,n,e){let r,i,o,a,s,f=W,l=()=>(f(),f=qt(d,m=>e(11,s=m)),d),u,c,h;X(t,Ze,m=>e(14,u=m)),X(t,de,m=>e(12,c=m)),X(t,yr,m=>e(13,h=m)),t.$$.on_destroy.push(()=>f());let{cfg:_}=n,{gjSchemes:d}=n;l();const g=["!=",["get","hide_while_editing"],!0],w=["!=",["get","endpoint"],!0];let k;function b(m){return gf(["get","scheme_reference"],Object.fromEntries(Object.values(m.schemes).map(A=>[A.scheme_reference,A.color])),"black")}function p(m){c.mode!="list"||!u||m.detail.features[0]&&(u.getCanvas().style.cursor="inherit",de.set({mode:"edit",id:m.detail.features[0].id}))}function v(m){if(m){let A=m[0],$=_.interventionName(A),O=_.schemeName(s.schemes[A.properties.scheme_reference]);return`${$} (${O})`}return"Tooltip bug"}return t.$$set=m=>{"cfg"in m&&e(0,_=m.cfg),"gjSchemes"in m&&l(e(1,d=m.gjSchemes))},t.$$.update=()=>{if(t.$$.dirty&2048&&e(5,r=pf(s)),t.$$.dirty&4096&&e(4,i=c.mode=="list"),t.$$.dirty&8192&&e(3,o=Pc(h)),t.$$.dirty&2048&&e(10,a=b(s)),t.$$.dirty&5120){let m="grey";c.mode=="list"?e(2,k=a):c.mode=="split-route"?e(2,k=["case",["==","intervention_type","route"],a,m]):e(2,k=m)}},[_,d,k,o,i,r,g,w,p,v,a,s,c,h]}class Nc extends ce{constructor(n){super(),he(this,n,Lc,Rc,fe,{cfg:0,gjSchemes:1})}}function Cc(t){let n;return{c(){n=q("Finish")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function Oc(t){let n;return{c(){n=q("Cancel")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function Ic(t){let n,e,r,i,o,a,s,f,l,u;r=new wt({props:{$$slots:{default:[Cc]},$$scope:{ctx:t}}}),r.$on("click",t[5]),o=new Ue({props:{$$slots:{default:[Oc]},$$scope:{ctx:t}}}),o.$on("click",t[6]);function c(d){t[7](d)}var h=t[0].editFeatureForm;function _(d,g){let w={cfg:d[0],gjSchemes:d[1],id:null};return d[2]!==void 0&&(w.props=d[2]),{props:w}}return h&&(s=hn(h,_(t)),we.push(()=>Se(s,"props",c))),{c(){n=D("h2"),n.textContent="New intervention",e=z(),I(r.$$.fragment),i=z(),I(o.$$.fragment),a=z(),s&&I(s.$$.fragment),l=Le()},m(d,g){P(d,n,g),P(d,e,g),x(r,d,g),P(d,i,g),x(o,d,g),P(d,a,g),s&&x(s,d,g),P(d,l,g),u=!0},p(d,[g]){const w={};g&256&&(w.$$scope={dirty:g,ctx:d}),r.$set(w);const k={};if(g&256&&(k.$$scope={dirty:g,ctx:d}),o.$set(k),g&1&&h!==(h=d[0].editFeatureForm)){if(s){ae();const b=s;R(b.$$.fragment,1,0,()=>{T(b,1)}),se()}h?(s=hn(h,_(d)),we.push(()=>Se(s,"props",c)),I(s.$$.fragment),E(s.$$.fragment,1),x(s,l.parentNode,l)):s=null}else if(h){const b={};g&1&&(b.cfg=d[0]),g&2&&(b.gjSchemes=d[1]),!f&&g&4&&(f=!0,b.props=d[2],Pe(()=>f=!1)),s.$set(b)}},i(d){u||(E(r.$$.fragment,d),E(o.$$.fragment,d),s&&E(s.$$.fragment,d),u=!0)},o(d){R(r.$$.fragment,d),R(o.$$.fragment,d),s&&R(s.$$.fragment,d),u=!1},d(d){d&&(L(n),L(e),L(i),L(a),L(l)),T(r,d),T(o,d),s&&T(s,d)}}}function xc(t,n,e){let r,i,o;X(t,tt,c=>e(2,r=c)),X(t,Ye,c=>e(3,i=c)),X(t,_t,c=>e(4,o=c));let{cfg:a}=n,{gjSchemes:s}=n;le(tt,r={},r),qe(()=>{le(tt,r={},r)});const f=()=>{i()},l=()=>{o()};function u(c){r=c,tt.set(r)}return t.$$set=c=>{"cfg"in c&&e(0,a=c.cfg),"gjSchemes"in c&&e(1,s=c.gjSchemes)},[a,s,r,i,o,f,l,u]}class Tc extends ce{constructor(n){super(),he(this,n,xc,Ic,fe,{cfg:0,gjSchemes:1})}}function Fc(t){let n,e;const r=t[1].default,i=Kn(r,t,t[0],null);return{c(){n=D("div"),i&&i.c(),U(n,"class","govuk-button-group"),re(n,"margin-right","0")},m(o,a){P(o,n,a),i&&i.m(n,null),e=!0},p(o,[a]){i&&i.p&&(!e||a&1)&&Vn(i,r,o,o[0],e?er(r,o[0],a,null):Qn(o[0]),null)},i(o){e||(E(i,o),e=!0)},o(o){R(i,o),e=!1},d(o){o&&L(n),i&&i.d(o)}}}function zc(t,n,e){let{$$slots:r={},$$scope:i}=n;return t.$$set=o=>{"$$scope"in o&&e(0,i=o.$$scope)},[i,r]}class yn extends ce{constructor(n){super(),he(this,n,zc,Fc,fe,{})}}function qo(t,n,e){const r=t.slice();return r[7]=n[e][0],r[8]=n[e][1],r}function Jo(t){let n,e,r,i,o=!1,a,s,f=t[8]+"",l,u,c,h,_,d;return h=Wl(t[6][0]),{c(){n=D("div"),e=D("input"),a=z(),s=D("label"),l=q(f),c=z(),U(e,"class","govuk-radios__input"),U(e,"id",r=t[3]+t[7]),U(e,"type","radio"),e.__value=i=t[7],dn(e,e.__value),U(s,"class","govuk-label govuk-radios__label"),U(s,"for",u=t[3]+t[7]),re(s,"max-width","100%"),U(n,"class","govuk-radios__item"),h.p(e)},m(g,w){P(g,n,w),B(n,e),e.checked=e.__value===t[0],B(n,a),B(n,s),B(s,l),B(n,c),_||(d=[ke(e,"change",t[5]),ke(e,"change",t[4])],_=!0)},p(g,w){w&2&&r!==(r=g[3]+g[7])&&U(e,"id",r),w&2&&i!==(i=g[7])&&(e.__value=i,dn(e,e.__value),o=!0),(o||w&3)&&(e.checked=e.__value===g[0]),w&2&&f!==(f=g[8]+"")&&je(l,f),w&2&&u!==(u=g[3]+g[7])&&U(s,"for",u)},d(g){g&&L(n),h.r(),_=!1,Fr(d)}}}function Dc(t){let n,e=Fe(t[1]),r=[];for(let i=0;i<e.length;i+=1)r[i]=Jo(qo(t,e,i));return{c(){n=D("div");for(let i=0;i<r.length;i+=1)r[i].c();U(n,"class","govuk-radios govuk-radios--inline govuk-radios--small"),U(n,"data-module","govuk-radios"),U(n,"style",t[2])},m(i,o){P(i,n,o);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(n,null)},p(i,[o]){if(o&11){e=Fe(i[1]);let a;for(a=0;a<e.length;a+=1){const s=qo(i,e,a);r[a]?r[a].p(s,o):(r[a]=Jo(s),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=e.length}o&4&&U(n,"style",i[2])},i:W,o:W,d(i){i&&L(n),jn(r,i)}}}function Bc(t,n,e){let{choices:r}=n,{style:i=""}=n,{value:o}=n,a=Jl();const s=[[]];function f(u){Bt.call(this,t,u)}function l(){o=this.__value,e(0,o)}return t.$$set=u=>{"choices"in u&&e(1,r=u.choices),"style"in u&&e(2,i=u.style),"value"in u&&e(0,o=u.value)},[o,r,i,a,f,l,s]}class Or extends ce{constructor(n){super(),he(this,n,Bc,Dc,fe,{choices:1,style:2,value:0})}}function jc(t){let n;return{c(){n=q("Finish")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function Uc(t){let n,e;return n=new bf({}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Zc(t){let n,e,r,i;return n=new wt({props:{style:"margin-bottom: 0px",$$slots:{default:[jc]},$$scope:{ctx:t}}}),n.$on("click",t[6]),r=new wn({props:{$$slots:{default:[Uc]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment)},m(o,a){x(n,o,a),P(o,e,a),x(r,o,a),i=!0},p(o,a){const s={};a&128&&(s.$$scope={dirty:a,ctx:o}),n.$set(s);const f={};a&128&&(f.$$scope={dirty:a,ctx:o}),r.$set(f)},i(o){i||(E(n.$$.fragment,o),E(r.$$.fragment,o),i=!0)},o(o){R(n.$$.fragment,o),R(r.$$.fragment,o),i=!1},d(o){o&&L(e),T(n,o),T(r,o)}}}function Gc(t){let n,e,r,i,o,a,s,f,l,u;function c(g){t[4](g)}let h={cfg:t[0],map:t[2],showControls:!1};t[1]!==void 0&&(h.enabled=t[1]),n=new mf({props:h}),we.push(()=>Se(n,"enabled",c));function _(g){t[5](g)}let d={choices:[["google","Google Street View"],["bing","Bing Streetside"]]};return t[3].streetViewImagery!==void 0&&(d.value=t[3].streetViewImagery),o=new Or({props:d}),we.push(()=>Se(o,"value",_)),l=new yn({props:{$$slots:{default:[Zc]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment),r=z(),i=D("div"),I(o.$$.fragment),s=z(),f=D("div"),I(l.$$.fragment),re(f,"margin-left","auto"),re(i,"display","flex")},m(g,w){x(n,g,w),P(g,r,w),P(g,i,w),x(o,i,null),B(i,s),B(i,f),x(l,f,null),u=!0},p(g,[w]){const k={};w&1&&(k.cfg=g[0]),w&4&&(k.map=g[2]),!e&&w&2&&(e=!0,k.enabled=g[1],Pe(()=>e=!1)),n.$set(k);const b={};!a&&w&8&&(a=!0,b.value=g[3].streetViewImagery,Pe(()=>a=!1)),o.$set(b);const p={};w&130&&(p.$$scope={dirty:w,ctx:g}),l.$set(p)},i(g){u||(E(n.$$.fragment,g),E(o.$$.fragment,g),E(l.$$.fragment,g),u=!0)},o(g){R(n.$$.fragment,g),R(o.$$.fragment,g),R(l.$$.fragment,g),u=!1},d(g){g&&(L(r),L(i)),T(n,g),T(o),T(l)}}}function Hc(t,n,e){let r,i;X(t,Ze,u=>e(2,r=u)),X(t,ao,u=>e(3,i=u));let{cfg:o}=n,a=!0;function s(u){a=u,e(1,a)}function f(u){t.$$.not_equal(i.streetViewImagery,u)&&(i.streetViewImagery=u,ao.set(i))}const l=()=>e(1,a=!1);return t.$$set=u=>{"cfg"in u&&e(0,o=u.cfg)},t.$$.update=()=>{t.$$.dirty&2&&(a||de.set({mode:"list"}))},[o,a,r,i,s,f,l]}class Yc extends ce{constructor(n){super(),he(this,n,Hc,Gc,fe,{cfg:0})}}const Xc="/atip/update-IMD-source/assets/area-cf965967.svg",qc="/atip/update-IMD-source/assets/image-3e3a13e8.svg",Jc="/atip/update-IMD-source/assets/point-276f4055.svg",Wc="/atip/update-IMD-source/assets/route-d3c0ebad.svg",Us="/atip/update-IMD-source/assets/split_route-9e0ea2da.svg",Kc="/atip/update-IMD-source/assets/street_view-48580b6a.svg",Ne=We([]);function Wi(t,n){if(n.length<3)return JSON.parse(t.inner.calculateRoute(n));let e=JSON.parse(JSON.stringify(n));e.push(e[0]);let r=JSON.parse(t.inner.calculateRoute(e));return r.properties.waypoints.pop(),r.geometry.type="Polygon",r.geometry.coordinates=[r.geometry.coordinates],r}const{window:Vc}=Gi;function Wo(t,n,e){const r=t.slice();return r[38]=n[e],r[39]=n,r[40]=e,r}function Ko(t,n,e){const r=t.slice();return r[41]=n[e],r[42]=n,r[43]=e,r}function Qc(t){let n;return{c(){n=D("p"),n.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(e,r){P(e,n,r)},p:W,i:W,o:W,d(e){e&&L(n)}}}function eh(t){let n,e,r,i;return n=new Or({props:{style:"flex-direction: column; border-right: 1px solid black",choices:[["snap","Snap to roads"],["free","Draw anywhere"]],value:t[7]?"snap":"free"}}),n.$on("change",t[12]),{c(){I(n.$$.fragment),e=z(),r=D("p"),r.textContent="Click to add at least 3 points"},m(o,a){x(n,o,a),P(o,e,a),P(o,r,a),i=!0},p(o,a){const s={};a[0]&128&&(s.value=o[7]?"snap":"free"),n.$set(s)},i(o){i||(E(n.$$.fragment,o),i=!0)},o(o){R(n.$$.fragment,o),i=!1},d(o){o&&(L(e),L(r)),T(n,o)}}}function th(t){let n;return{c(){n=q("Finish")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function nh(t){let n,e=t[8].length+"",r,i;return{c(){n=q("Undo ("),r=q(e),i=q(")")},m(o,a){P(o,n,a),P(o,r,a),P(o,i,a)},p(o,a){a[0]&256&&e!==(e=o[8].length+"")&&je(r,e)},d(o){o&&(L(n),L(r),L(i))}}}function rh(t){let n;return{c(){n=q("Undo")},m(e,r){P(e,n,r)},p:W,d(e){e&&L(n)}}}function ih(t){let n;function e(o,a){return o[8].length==0?rh:nh}let r=e(t),i=r(t);return{c(){i.c(),n=Le()},m(o,a){i.m(o,a),P(o,n,a)},p(o,a){r===(r=e(o))&&i?i.p(o,a):(i.d(1),i=r(o),i&&(i.c(),i.m(n.parentNode,n)))},d(o){o&&L(n),i.d(o)}}}function oh(t){let n;return{c(){n=q("Cancel")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function ah(t){let n,e,r,i,o;return{c(){n=D("ul"),n.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,e=z(),r=D("p"),r.textContent="Keyboard shortcuts:",i=z(),o=D("ul"),o.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(a,s){P(a,n,s),P(a,e,s),P(a,r,s),P(a,i,s),P(a,o,s)},p:W,d(a){a&&(L(n),L(e),L(r),L(i),L(o))}}}function sh(t){let n,e,r,i,o,a,s,f;return n=new wt({props:{disabled:t[5].length<3,style:"margin-bottom: 0px",$$slots:{default:[th]},$$scope:{ctx:t}}}),n.$on("click",function(){_n(t[0])&&t[0].apply(this,arguments)}),r=new Ue({props:{disabled:t[8].length==0,noBottomMargin:!0,$$slots:{default:[ih]},$$scope:{ctx:t}}}),r.$on("click",t[11]),o=new Ue({props:{noBottomMargin:!0,$$slots:{default:[oh]},$$scope:{ctx:t}}}),o.$on("click",function(){_n(t[1])&&t[1].apply(this,arguments)}),s=new wn({props:{$$slots:{default:[ah]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment),i=z(),I(o.$$.fragment),a=z(),I(s.$$.fragment)},m(l,u){x(n,l,u),P(l,e,u),x(r,l,u),P(l,i,u),x(o,l,u),P(l,a,u),x(s,l,u),f=!0},p(l,u){t=l;const c={};u[0]&32&&(c.disabled=t[5].length<3),u[1]&8192&&(c.$$scope={dirty:u,ctx:t}),n.$set(c);const h={};u[0]&256&&(h.disabled=t[8].length==0),u[0]&256|u[1]&8192&&(h.$$scope={dirty:u,ctx:t}),r.$set(h);const _={};u[1]&8192&&(_.$$scope={dirty:u,ctx:t}),o.$set(_);const d={};u[1]&8192&&(d.$$scope={dirty:u,ctx:t}),s.$set(d)},i(l){f||(E(n.$$.fragment,l),E(r.$$.fragment,l),E(o.$$.fragment,l),E(s.$$.fragment,l),f=!0)},o(l){R(n.$$.fragment,l),R(r.$$.fragment,l),R(o.$$.fragment,l),R(s.$$.fragment,l),f=!1},d(l){l&&(L(e),L(i),L(a)),T(n,l),T(r,l),T(o,l),T(s,l)}}}function lh(t){let n;return{c(){n=D("span"),U(n,"class","dot svelte-1cj4rwq"),$e(n,"snapped-node",t[41].snapped),$e(n,"free-node",!t[41].snapped),$e(n,"hide",t[4])},m(e,r){P(e,n,r)},p(e,r){r[0]&512&&$e(n,"snapped-node",e[41].snapped),r[0]&512&&$e(n,"free-node",!e[41].snapped),r[0]&16&&$e(n,"hide",e[4])},d(e){e&&L(n)}}}function Vo(t){let n,e,r;function i(f){t[24](f,t[41])}function o(){return t[25](t[41])}function a(){return t[26](t[41])}let s={draggable:!0,zIndex:0,$$slots:{default:[lh]},$$scope:{ctx:t}};return t[41].point!==void 0&&(s.lngLat=t[41].point),n=new Ht({props:s}),we.push(()=>Se(n,"lngLat",i)),n.$on("dragstart",o),n.$on("drag",a),n.$on("dragend",t[20]),{c(){I(n.$$.fragment)},m(f,l){x(n,f,l),r=!0},p(f,l){t=f;const u={};l[0]&528|l[1]&8192&&(u.$$scope={dirty:l,ctx:t}),!e&&l[0]&512&&(e=!0,u.lngLat=t[41].point,Pe(()=>e=!1)),n.$set(u)},i(f){r||(E(n.$$.fragment,f),r=!0)},o(f){R(n.$$.fragment,f),r=!1},d(f){T(n,f)}}}function fh(t){let n;return{c(){n=D("span"),n.textContent=`${t[40]+1}`,U(n,"class","dot svelte-1cj4rwq"),$e(n,"snapped",t[38].snapped)},m(e,r){P(e,n,r)},p(e,r){r[0]&32&&$e(n,"snapped",e[38].snapped)},d(e){e&&L(n)}}}function Qo(t){let n,e,r;function i(f){t[27](f,t[38])}function o(){return t[28](t[40])}function a(){return t[29](t[40])}let s={draggable:!0,zIndex:1,$$slots:{default:[fh]},$$scope:{ctx:t}};return t[38].point!==void 0&&(s.lngLat=t[38].point),n=new Ht({props:s}),we.push(()=>Se(n,"lngLat",i)),n.$on("click",o),n.$on("contextmenu",a),n.$on("mouseenter",t[30]),n.$on("mouseleave",t[31]),n.$on("dragstart",t[22]),n.$on("dragend",t[32]),{c(){I(n.$$.fragment)},m(f,l){x(n,f,l),r=!0},p(f,l){t=f;const u={};l[0]&32|l[1]&8192&&(u.$$scope={dirty:l,ctx:t}),!e&&l[0]&32&&(e=!0,u.lngLat=t[38].point,Pe(()=>e=!1)),n.$set(u)},i(f){r||(E(n.$$.fragment,f),r=!0)},o(f){R(n.$$.fragment,f),r=!1},d(f){T(n,f)}}}function uh(t){let n,e,r,i;return n=new xt({props:{paint:{"line-color":"black","line-width":10}}}),r=new Ui({props:{paint:{"fill-color":"grey","fill-opacity":.5}}}),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment)},m(o,a){x(n,o,a),P(o,e,a),x(r,o,a),i=!0},p:W,i(o){i||(E(n.$$.fragment,o),E(r.$$.fragment,o),i=!0)},o(o){R(n.$$.fragment,o),R(r.$$.fragment,o),i=!1},d(o){o&&L(e),T(n,o),T(r,o)}}}function ch(t){let n,e;return n=new xt({props:{paint:{"line-color":"black","line-width":3}}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function hh(t){let n,e,r,i,o,a,s,f,l,u,c,h,_,d,g,w,k,b;const p=[eh,Qc],v=[];function m(M,y){return M[5].length<3?0:1}r=m(t),i=v[r]=p[r](t),s=new yn({props:{$$slots:{default:[sh]},$$scope:{ctx:t}}}),l=new Dr({}),l.$on("click",t[13]),l.$on("mousemove",t[14]);let A=Fe(t[9]),$=[];for(let M=0;M<A.length;M+=1)$[M]=Vo(Ko(t,A,M));const O=M=>R($[M],1,1,()=>{$[M]=null});let F=Fe(t[5]),N=[];for(let M=0;M<F.length;M+=1)N[M]=Qo(Wo(t,F,M));const S=M=>R(N[M],1,1,()=>{N[M]=null});return _=new It({props:{data:t[17](t[6],t[5]),generateId:!0,$$slots:{default:[uh]},$$scope:{ctx:t}}}),g=new It({props:{data:t[10],$$slots:{default:[ch]},$$scope:{ctx:t}}}),{c(){n=D("div"),e=D("div"),i.c(),o=z(),a=D("div"),I(s.$$.fragment),f=z(),I(l.$$.fragment),u=z();for(let M=0;M<$.length;M+=1)$[M].c();c=z();for(let M=0;M<N.length;M+=1)N[M].c();h=z(),I(_.$$.fragment),d=z(),I(g.$$.fragment),re(e,"display","flex"),re(e,"flex-direction","row"),re(a,"margin-left","auto"),re(n,"display","flex")},m(M,y){P(M,n,y),B(n,e),v[r].m(e,null),B(n,o),B(n,a),x(s,a,null),P(M,f,y),x(l,M,y),P(M,u,y);for(let C=0;C<$.length;C+=1)$[C]&&$[C].m(M,y);P(M,c,y);for(let C=0;C<N.length;C+=1)N[C]&&N[C].m(M,y);P(M,h,y),x(_,M,y),P(M,d,y),x(g,M,y),w=!0,k||(b=ke(Vc,"keydown",t[21]),k=!0)},p(M,y){let C=r;r=m(M),r===C?v[r].p(M,y):(ae(),R(v[C],1,1,()=>{v[C]=null}),se(),i=v[r],i?i.p(M,y):(i=v[r]=p[r](M),i.c()),E(i,1),i.m(e,null));const Z={};if(y[0]&291|y[1]&8192&&(Z.$$scope={dirty:y,ctx:M}),s.$set(Z),y[0]&1835536){A=Fe(M[9]);let J;for(J=0;J<A.length;J+=1){const me=Ko(M,A,J);$[J]?($[J].p(me,y),E($[J],1)):($[J]=Vo(me),$[J].c(),E($[J],1),$[J].m(c.parentNode,c))}for(ae(),J=A.length;J<$.length;J+=1)O(J);se()}if(y[0]&4292652){F=Fe(M[5]);let J;for(J=0;J<F.length;J+=1){const me=Wo(M,F,J);N[J]?(N[J].p(me,y),E(N[J],1)):(N[J]=Qo(me),N[J].c(),E(N[J],1),N[J].m(h.parentNode,h))}for(ae(),J=F.length;J<N.length;J+=1)S(J);se()}const ie={};y[0]&96&&(ie.data=M[17](M[6],M[5])),y[1]&8192&&(ie.$$scope={dirty:y,ctx:M}),_.$set(ie);const ue={};y[0]&1024&&(ue.data=M[10]),y[1]&8192&&(ue.$$scope={dirty:y,ctx:M}),g.$set(ue)},i(M){if(!w){E(i),E(s.$$.fragment,M),E(l.$$.fragment,M);for(let y=0;y<A.length;y+=1)E($[y]);for(let y=0;y<F.length;y+=1)E(N[y]);E(_.$$.fragment,M),E(g.$$.fragment,M),w=!0}},o(M){R(i),R(s.$$.fragment,M),R(l.$$.fragment,M),$=$.filter(Boolean);for(let y=0;y<$.length;y+=1)R($[y]);N=N.filter(Boolean);for(let y=0;y<N.length;y+=1)R(N[y]);R(_.$$.fragment,M),R(g.$$.fragment,M),w=!1},d(M){M&&(L(n),L(f),L(u),L(c),L(h),L(d)),v[r].d(),T(s),T(l,M),jn($,M),jn(N,M),T(_,M),T(g,M),k=!1,b()}}}function dh(t,n,e){let r,i,o,a;X(t,Ne,H=>e(5,i=H)),X(t,Ze,H=>e(33,o=H)),X(t,Jt,H=>e(6,a=H));let{finish:s}=n,{cancel:f}=n;qe(()=>{le(Ne,i=[],i),a==null||a.stop(),o&&(o.getCanvas().style.cursor="inherit")});let l=!0,u=[],c=[],h=null,_=!1,d=!1,g=!1;function w(H){let Q=H.length==0?"crosshair":"inherit";o&&(o.getCanvas().style.cursor=Q)}function k(){let H=u.pop();e(8,u),H&&le(Ne,i=H,i)}function b(){u.length==100&&u.shift(),e(8,u=[...u,JSON.parse(JSON.stringify(i))])}function p(){e(7,l=!l),h&&e(23,h.snapped=l,h)}function v(H){i.length>=3||(b(),Ne.update(Q=>(Q.push({point:H.detail.lngLat.toArray(),snapped:l}),Q)))}function m(H){e(23,h={point:H.detail.lngLat.toArray(),snapped:l})}function A(H){b(),Ne.update(Q=>(Q[H].snapped=!Q[H].snapped,Q))}function $(H){b(),Ne.update(Q=>(Q.splice(H,1),Q)),e(2,_=!1)}function O(H,Q){try{if(H)return Wi(H,Q)}catch{}return it()}function F(H,Q,ot,j){if(j||Q.length>=3)return it();try{if(H&&Q.length>0&&ot)return JSON.parse(H.inner.calculateRoute([Q[Q.length-1],ot]))}catch{}return it()}function N(H,Q,ot){if(ot)return;if(!H||Q.length<3){e(9,c=[]);return}let j=[],V=1,Ee=JSON.parse(JSON.stringify(Q));Ee.push(Ee[0]);for(let at=0;at<Ee.length-1;at++){let en=JSON.parse(H.inner.getExtraNodes(Ee[at],Ee[at+1]));for(let[En,tn,Hr]of en)j.push({point:[En,tn],snapped:Hr,insertIdx:V});V++}e(9,c=j)}function S(H){b(),Ne.update(Q=>(Q.splice(H.insertIdx,0,{point:H.point,snapped:H.snapped}),Q)),e(4,g=!0)}function M(H){Ne.update(Q=>(Q[H.insertIdx].point=H.point,Q))}function y(){e(4,g=!1)}function C(H){let Q=H.target.tagName,ot=Q=="INPUT"||Q=="TEXTAREA";H.key=="Enter"&&!ot||H.key=="Escape"?(H.stopPropagation(),i.length>=3?s():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):H.key=="s"&&!ot?p():H.key=="z"&&H.ctrlKey&&(H.stopPropagation(),k())}function Z(){b(),e(3,d=!0)}function ie(H,Q){t.$$.not_equal(Q.point,H)&&(Q.point=H,e(9,c))}const ue=H=>S(H),J=H=>M(H);function me(H,Q){t.$$.not_equal(Q.point,H)&&(Q.point=H,Ne.set(i))}const K=H=>A(H),be=H=>$(H),ve=()=>e(2,_=!0),G=()=>e(2,_=!1),Re=()=>e(3,d=!1);return t.$$set=H=>{"finish"in H&&e(0,s=H.finish),"cancel"in H&&e(1,f=H.cancel)},t.$$.update=()=>{t.$$.dirty[0]&112&&N(a,i,g),t.$$.dirty[0]&8388716&&e(10,r=F(a,i,h,_||d)),t.$$.dirty[0]&32&&w(i)},[s,f,_,d,g,i,a,l,u,c,r,k,p,v,m,A,$,O,S,M,y,C,Z,h,ie,ue,J,me,K,be,ve,G,Re]}class Zs extends ce{constructor(n){super(),he(this,n,dh,hh,fe,{finish:0,cancel:1},null,[-1,-1])}}function _h(t){let n,e;return n=new Zs({props:{finish:t[1],cancel:t[0]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function ph(t,n,e){let r,i,o;X(t,Ne,c=>e(4,r=c)),X(t,Jt,c=>e(5,i=c)),X(t,tt,c=>e(6,o=c));let{cfg:a}=n,{gjSchemes:s}=n;vt(()=>{le(Ne,r=[],r),Ye.set(u),_t.set(l)}),qe(()=>{Ye.set(()=>{}),_t.set(()=>{})});function f(c){let h=c;h.properties={...h.properties,...o},s.update(_=>{var d;return h.id=zr(_),(d=h.properties).scheme_reference||(d.scheme_reference=Bi(_)),a.newPolygonFeature(h),_.features.push(h),_}),de.set({mode:"list"})}function l(){de.set({mode:"list"})}function u(){if(!(!i||r.length<3))try{f(Wi(i,r))}catch(c){console.warn(`Finishing area failed: ${c}`)}}return t.$$set=c=>{"cfg"in c&&e(2,a=c.cfg),"gjSchemes"in c&&e(3,s=c.gjSchemes)},[l,u,a,s]}class gh extends ce{constructor(n){super(),he(this,n,ph,_h,fe,{cfg:2,gjSchemes:3})}}const{window:mh}=Gi;function ea(t){let n,e,r;function i(a){t[6](a)}let o={draggable:!0,$$slots:{default:[bh]},$$scope:{ctx:t}};return t[2]!==void 0&&(o.lngLat=t[2]),n=new Ht({props:o}),we.push(()=>Se(n,"lngLat",i)),{c(){I(n.$$.fragment)},m(a,s){x(n,a,s),r=!0},p(a,s){const f={};s&256&&(f.$$scope={dirty:s,ctx:a}),!e&&s&4&&(e=!0,f.lngLat=a[2],Pe(()=>e=!1)),n.$set(f)},i(a){r||(E(n.$$.fragment,a),r=!0)},o(a){R(n.$$.fragment,a),r=!1},d(a){T(n,a)}}}function bh(t){let n;return{c(){n=D("span"),U(n,"class","dot svelte-1tzt432")},m(e,r){P(e,n,r)},p:W,d(e){e&&L(n)}}}function vh(t){let n;return{c(){n=q("Finish")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function wh(t){let n;return{c(){n=q("Cancel")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function yh(t){let n;return{c(){n=D("li"),n.textContent="Click the map to add a point"},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function $h(t){let n;return{c(){n=D("li"),n.textContent="Click and drag the point to move it"},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function kh(t){let n,e,r,i,o,a,s;function f(c,h){return c[2]?$h:yh}let l=f(t),u=l(t);return{c(){n=D("ul"),u.c(),e=z(),r=D("li"),r.innerHTML=`<b>Double click</b>
          the map to finish or press
          <b>Escape</b>
          to cancel`,i=z(),o=D("p"),o.textContent="Keyboard shortcuts:",a=z(),s=D("ul"),s.innerHTML=`<li>From the main mode, <b>1</b>
          to draw a new point</li>`},m(c,h){P(c,n,h),u.m(n,null),B(n,e),B(n,r),P(c,i,h),P(c,o,h),P(c,a,h),P(c,s,h)},p(c,h){l!==(l=f(c))&&(u.d(1),u=l(c),u&&(u.c(),u.m(n,e)))},d(c){c&&(L(n),L(i),L(o),L(a),L(s)),u.d()}}}function Sh(t){let n,e,r,i,o,a;return n=new wt({props:{style:"margin-bottom: 0px",$$slots:{default:[vh]},$$scope:{ctx:t}}}),n.$on("click",function(){_n(t[0])&&t[0].apply(this,arguments)}),r=new Ue({props:{noBottomMargin:!0,$$slots:{default:[wh]},$$scope:{ctx:t}}}),r.$on("click",function(){_n(t[1])&&t[1].apply(this,arguments)}),o=new wn({props:{$$slots:{default:[kh]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment),i=z(),I(o.$$.fragment)},m(s,f){x(n,s,f),P(s,e,f),x(r,s,f),P(s,i,f),x(o,s,f),a=!0},p(s,f){t=s;const l={};f&256&&(l.$$scope={dirty:f,ctx:t}),n.$set(l);const u={};f&256&&(u.$$scope={dirty:f,ctx:t}),r.$set(u);const c={};f&260&&(c.$$scope={dirty:f,ctx:t}),o.$set(c)},i(s){a||(E(n.$$.fragment,s),E(r.$$.fragment,s),E(o.$$.fragment,s),a=!0)},o(s){R(n.$$.fragment,s),R(r.$$.fragment,s),R(o.$$.fragment,s),a=!1},d(s){s&&(L(e),L(i)),T(n,s),T(r,s),T(o,s)}}}function Eh(t){let n,e,r,i,o,a,s,f;n=new Dr({}),n.$on("click",t[3]),n.$on("dblclick",t[4]);let l=t[2]&&ea(t);return o=new yn({props:{$$slots:{default:[Sh]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment),e=z(),l&&l.c(),r=z(),i=D("div"),I(o.$$.fragment),re(i,"float","right")},m(u,c){x(n,u,c),P(u,e,c),l&&l.m(u,c),P(u,r,c),P(u,i,c),x(o,i,null),a=!0,s||(f=ke(mh,"keydown",t[5]),s=!0)},p(u,[c]){u[2]?l?(l.p(u,c),c&4&&E(l,1)):(l=ea(u),l.c(),E(l,1),l.m(r.parentNode,r)):l&&(ae(),R(l,1,1,()=>{l=null}),se());const h={};c&263&&(h.$$scope={dirty:c,ctx:u}),o.$set(h)},i(u){a||(E(n.$$.fragment,u),E(l),E(o.$$.fragment,u),a=!0)},o(u){R(n.$$.fragment,u),R(l),R(o.$$.fragment,u),a=!1},d(u){u&&(L(e),L(r),L(i)),T(n,u),l&&l.d(u),T(o),s=!1,f()}}}function Mh(t,n,e){let r,i;X(t,Pt,c=>e(2,r=c)),X(t,Ze,c=>e(7,i=c));let{finish:o}=n,{cancel:a}=n;vt(()=>{i&&i.doubleClickZoom.disable()}),qe(()=>{i&&i.doubleClickZoom.enable()});function s(c){r||le(Pt,r=c.detail.lngLat.toArray(),r)}function f(){o()}function l(c){c.key=="Escape"&&(c.stopPropagation(),r?o():window.alert("You can't save this point until you place it on the map. Press 'Cancel' to discard these changes."))}function u(c){r=c,Pt.set(r)}return t.$$set=c=>{"finish"in c&&e(0,o=c.finish),"cancel"in c&&e(1,a=c.cancel)},[o,a,r,s,f,l,u]}class Gs extends ce{constructor(n){super(),he(this,n,Mh,Eh,fe,{finish:0,cancel:1})}}const Te=We([]);const{window:Ah}=Gi;function ta(t,n,e){const r=t.slice();return r[41]=n[e],r[42]=n,r[43]=e,r}function na(t,n,e){const r=t.slice();return r[44]=n[e],r[45]=n,r[46]=e,r}function Rh(t){let n;return{c(){n=q("Finish")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function Ph(t){let n,e=t[9].length+"",r,i;return{c(){n=q("Undo ("),r=q(e),i=q(")")},m(o,a){P(o,n,a),P(o,r,a),P(o,i,a)},p(o,a){a[0]&512&&e!==(e=o[9].length+"")&&je(r,e)},d(o){o&&(L(n),L(r),L(i))}}}function Lh(t){let n;return{c(){n=q("Undo")},m(e,r){P(e,n,r)},p:W,d(e){e&&L(n)}}}function Nh(t){let n;function e(o,a){return o[9].length==0?Lh:Ph}let r=e(t),i=r(t);return{c(){i.c(),n=Le()},m(o,a){i.m(o,a),P(o,n,a)},p(o,a){r===(r=e(o))&&i?i.p(o,a):(i.d(1),i=r(o),i&&(i.c(),i.m(n.parentNode,n)))},d(o){o&&L(n),i.d(o)}}}function Ch(t){let n;return{c(){n=q("Cancel")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function Oh(t){let n,e,r,i,o;return{c(){n=D("ul"),n.innerHTML=`<li><b>Click</b>
            the map to add new points, while extending from the start or end</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,e=z(),r=D("p"),r.textContent="Keyboard shortcuts:",i=z(),o=D("ul"),o.innerHTML=`<li><b>1</b>
            to extend from start</li> <li><b>2</b>
            to extend from end</li> <li><b>3</b>
            to drag middle points</li> <li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>2</b>
            to draw a new route</li>`},m(a,s){P(a,n,s),P(a,e,s),P(a,r,s),P(a,i,s),P(a,o,s)},p:W,d(a){a&&(L(n),L(e),L(r),L(i),L(o))}}}function Ih(t){let n,e,r,i,o,a,s,f;return n=new wt({props:{disabled:t[6].length<2,style:"margin-bottom: 0px",$$slots:{default:[Rh]},$$scope:{ctx:t}}}),n.$on("click",function(){_n(t[0])&&t[0].apply(this,arguments)}),r=new Ue({props:{disabled:t[9].length==0,noBottomMargin:!0,$$slots:{default:[Nh]},$$scope:{ctx:t}}}),r.$on("click",t[12]),o=new Ue({props:{noBottomMargin:!0,$$slots:{default:[Ch]},$$scope:{ctx:t}}}),o.$on("click",function(){_n(t[1])&&t[1].apply(this,arguments)}),s=new wn({props:{$$slots:{default:[Oh]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment),i=z(),I(o.$$.fragment),a=z(),I(s.$$.fragment)},m(l,u){x(n,l,u),P(l,e,u),x(r,l,u),P(l,i,u),x(o,l,u),P(l,a,u),x(s,l,u),f=!0},p(l,u){t=l;const c={};u[0]&64&&(c.disabled=t[6].length<2),u[1]&65536&&(c.$$scope={dirty:u,ctx:t}),n.$set(c);const h={};u[0]&512&&(h.disabled=t[9].length==0),u[0]&512|u[1]&65536&&(h.$$scope={dirty:u,ctx:t}),r.$set(h);const _={};u[1]&65536&&(_.$$scope={dirty:u,ctx:t}),o.$set(_);const d={};u[1]&65536&&(d.$$scope={dirty:u,ctx:t}),s.$set(d)},i(l){f||(E(n.$$.fragment,l),E(r.$$.fragment,l),E(o.$$.fragment,l),E(s.$$.fragment,l),f=!0)},o(l){R(n.$$.fragment,l),R(r.$$.fragment,l),R(o.$$.fragment,l),R(s.$$.fragment,l),f=!1},d(l){l&&(L(e),L(i),L(a)),T(n,l),T(r,l),T(o,l),T(s,l)}}}function xh(t){let n;return{c(){n=D("span"),U(n,"class","dot svelte-1cj4rwq"),$e(n,"snapped-node",t[44].snapped),$e(n,"free-node",!t[44].snapped),$e(n,"hide",t[5])},m(e,r){P(e,n,r)},p(e,r){r[0]&1024&&$e(n,"snapped-node",e[44].snapped),r[0]&1024&&$e(n,"free-node",!e[44].snapped),r[0]&32&&$e(n,"hide",e[5])},d(e){e&&L(n)}}}function ra(t){let n,e,r;function i(f){t[27](f,t[44])}function o(){return t[28](t[44])}function a(){return t[29](t[44])}let s={draggable:!0,zIndex:0,$$slots:{default:[xh]},$$scope:{ctx:t}};return t[44].point!==void 0&&(s.lngLat=t[44].point),n=new Ht({props:s}),we.push(()=>Se(n,"lngLat",i)),n.$on("dragstart",o),n.$on("drag",a),n.$on("dragend",t[21]),{c(){I(n.$$.fragment)},m(f,l){x(n,f,l),r=!0},p(f,l){t=f;const u={};l[0]&1056|l[1]&65536&&(u.$$scope={dirty:l,ctx:t}),!e&&l[0]&1024&&(e=!0,u.lngLat=t[44].point,Pe(()=>e=!1)),n.$set(u)},i(f){r||(E(n.$$.fragment,f),r=!0)},o(f){R(n.$$.fragment,f),r=!1},d(f){T(n,f)}}}function Th(t){let n;return{c(){n=D("span"),n.textContent=`${t[43]+1}`,U(n,"class","dot svelte-1cj4rwq"),$e(n,"snapped",t[41].snapped)},m(e,r){P(e,n,r)},p(e,r){r[0]&64&&$e(n,"snapped",e[41].snapped)},d(e){e&&L(n)}}}function ia(t){let n,e,r;function i(f){t[30](f,t[41])}function o(){return t[31](t[43])}function a(){return t[32](t[43])}let s={draggable:!0,zIndex:1,$$slots:{default:[Th]},$$scope:{ctx:t}};return t[41].point!==void 0&&(s.lngLat=t[41].point),n=new Ht({props:s}),we.push(()=>Se(n,"lngLat",i)),n.$on("click",o),n.$on("contextmenu",a),n.$on("mouseenter",t[33]),n.$on("mouseleave",t[34]),n.$on("dragstart",t[23]),n.$on("dragend",t[35]),{c(){I(n.$$.fragment)},m(f,l){x(n,f,l),r=!0},p(f,l){t=f;const u={};l[0]&64|l[1]&65536&&(u.$$scope={dirty:l,ctx:t}),!e&&l[0]&64&&(e=!0,u.lngLat=t[41].point,Pe(()=>e=!1)),n.$set(u)},i(f){r||(E(n.$$.fragment,f),r=!0)},o(f){R(n.$$.fragment,f),r=!1},d(f){T(n,f)}}}function Fh(t){let n,e;return n=new xt({props:{paint:{"line-color":"black","line-width":10}}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function zh(t){let n,e;return n=new xt({props:{paint:{"line-color":"black","line-width":3}}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Dh(t){let n,e,r,i,o,a,s,f,l,u,c,h,_,d,g,w,k,b,p,v;r=new Or({props:{style:"flex-direction: column; border-right: 1px solid black",choices:[["snap","Snap to roads"],["free","Draw anywhere"]],value:t[8]?"snap":"free"}}),r.$on("change",t[13]);function m(y){t[26](y)}let A={style:"flex-direction: column; margin-left: 8px",choices:[["append-start","Extend from start"],["append-end","Extend from end"],["adjust","Adjust middle points"]]};t[2]!==void 0&&(A.value=t[2]),o=new Or({props:A}),we.push(()=>Se(o,"value",m)),l=new yn({props:{$$slots:{default:[Ih]},$$scope:{ctx:t}}}),c=new Dr({}),c.$on("click",t[14]),c.$on("mousemove",t[15]);let $=Fe(t[10]),O=[];for(let y=0;y<$.length;y+=1)O[y]=ra(na(t,$,y));const F=y=>R(O[y],1,1,()=>{O[y]=null});let N=Fe(t[6]),S=[];for(let y=0;y<N.length;y+=1)S[y]=ia(ta(t,N,y));const M=y=>R(S[y],1,1,()=>{S[y]=null});return g=new It({props:{data:t[18](t[7],t[6]),generateId:!0,$$slots:{default:[Fh]},$$scope:{ctx:t}}}),k=new It({props:{data:t[11],$$slots:{default:[zh]},$$scope:{ctx:t}}}),{c(){n=D("div"),e=D("div"),I(r.$$.fragment),i=z(),I(o.$$.fragment),s=z(),f=D("div"),I(l.$$.fragment),u=z(),I(c.$$.fragment),h=z();for(let y=0;y<O.length;y+=1)O[y].c();_=z();for(let y=0;y<S.length;y+=1)S[y].c();d=z(),I(g.$$.fragment),w=z(),I(k.$$.fragment),re(e,"display","flex"),re(e,"flex-direction","row"),re(f,"margin-left","auto"),re(n,"display","flex")},m(y,C){P(y,n,C),B(n,e),x(r,e,null),B(e,i),x(o,e,null),B(n,s),B(n,f),x(l,f,null),P(y,u,C),x(c,y,C),P(y,h,C);for(let Z=0;Z<O.length;Z+=1)O[Z]&&O[Z].m(y,C);P(y,_,C);for(let Z=0;Z<S.length;Z+=1)S[Z]&&S[Z].m(y,C);P(y,d,C),x(g,y,C),P(y,w,C),x(k,y,C),b=!0,p||(v=ke(Ah,"keydown",t[22]),p=!0)},p(y,C){const Z={};C[0]&256&&(Z.value=y[8]?"snap":"free"),r.$set(Z);const ie={};!a&&C[0]&4&&(a=!0,ie.value=y[2],Pe(()=>a=!1)),o.$set(ie);const ue={};if(C[0]&579|C[1]&65536&&(ue.$$scope={dirty:C,ctx:y}),l.$set(ue),C[0]&3671072){$=Fe(y[10]);let K;for(K=0;K<$.length;K+=1){const be=na(y,$,K);O[K]?(O[K].p(be,C),E(O[K],1)):(O[K]=ra(be),O[K].c(),E(O[K],1),O[K].m(_.parentNode,_))}for(ae(),K=$.length;K<O.length;K+=1)F(K);se()}if(C[0]&8585304){N=Fe(y[6]);let K;for(K=0;K<N.length;K+=1){const be=ta(y,N,K);S[K]?(S[K].p(be,C),E(S[K],1)):(S[K]=ia(be),S[K].c(),E(S[K],1),S[K].m(d.parentNode,d))}for(ae(),K=N.length;K<S.length;K+=1)M(K);se()}const J={};C[0]&192&&(J.data=y[18](y[7],y[6])),C[1]&65536&&(J.$$scope={dirty:C,ctx:y}),g.$set(J);const me={};C[0]&2048&&(me.data=y[11]),C[1]&65536&&(me.$$scope={dirty:C,ctx:y}),k.$set(me)},i(y){if(!b){E(r.$$.fragment,y),E(o.$$.fragment,y),E(l.$$.fragment,y),E(c.$$.fragment,y);for(let C=0;C<$.length;C+=1)E(O[C]);for(let C=0;C<N.length;C+=1)E(S[C]);E(g.$$.fragment,y),E(k.$$.fragment,y),b=!0}},o(y){R(r.$$.fragment,y),R(o.$$.fragment,y),R(l.$$.fragment,y),R(c.$$.fragment,y),O=O.filter(Boolean);for(let C=0;C<O.length;C+=1)R(O[C]);S=S.filter(Boolean);for(let C=0;C<S.length;C+=1)R(S[C]);R(g.$$.fragment,y),R(k.$$.fragment,y),b=!1},d(y){y&&(L(n),L(u),L(h),L(_),L(d),L(w)),T(r),T(o),T(l),T(c,y),jn(O,y),jn(S,y),T(g,y),T(k,y),p=!1,v()}}}function Bh(t,n,e){let r,i,o,a;X(t,Te,j=>e(6,i=j)),X(t,Ze,j=>e(36,o=j)),X(t,Jt,j=>e(7,a=j));let{finish:s}=n,{cancel:f}=n,{editingExisting:l}=n;qe(()=>{le(Te,i=[],i),a==null||a.stop(),o&&(o.getCanvas().style.cursor="inherit")});let u=l?"adjust":"append-end",c=!0,h=[],_=[],d=null,g=!1,w=!1,k=!1;function b(j){let V=j.length==0?"crosshair":"inherit";o&&(o.getCanvas().style.cursor=V)}function p(){let j=h.pop();e(9,h),j&&le(Te,i=j,i)}function v(){h.length==100&&h.shift(),e(9,h=[...h,JSON.parse(JSON.stringify(i))])}function m(){e(8,c=!c),d&&e(25,d.snapped=c,d)}function A(j){v(),Te.update(V=>(u=="append-start"?V.splice(0,0,{point:j.detail.lngLat.toArray(),snapped:c}):u=="append-end"&&V.push({point:j.detail.lngLat.toArray(),snapped:c}),V))}function $(j){e(25,d={point:j.detail.lngLat.toArray(),snapped:c})}function O(j){v(),Te.update(V=>(V[j].snapped=!V[j].snapped,V))}function F(j){v(),Te.update(V=>(V.splice(j,1),V)),e(3,g=!1)}function N(j,V){try{if(j)return JSON.parse(j.inner.calculateRoute(V))}catch{}return it()}function S(j,V,Ee,at,en){if(en)return it();try{if(j&&V.length>0&&at){if(Ee=="append-start")return JSON.parse(j.inner.calculateRoute([at,V[0]]));if(Ee=="append-end")return JSON.parse(j.inner.calculateRoute([V[V.length-1],at]))}}catch{}return it()}function M(j,V,Ee,at){if(at)return;if(!j||Ee!="adjust"){e(10,_=[]);return}let en=[],En=1;for(let tn=0;tn<V.length-1;tn++){let Hr=JSON.parse(j.inner.getExtraNodes(V[tn],V[tn+1]));for(let[Bl,jl,Ul]of Hr)en.push({point:[Bl,jl],snapped:Ul,insertIdx:En});En++}e(10,_=en)}function y(j){v(),Te.update(V=>(V.splice(j.insertIdx,0,{point:j.point,snapped:j.snapped}),V)),e(5,k=!0)}function C(j){Te.update(V=>(V[j.insertIdx].point=j.point,V))}function Z(){e(5,k=!1)}function ie(j){let V=j.target.tagName,Ee=V=="INPUT"||V=="TEXTAREA";j.key=="Enter"&&!Ee||j.key=="Escape"?(j.stopPropagation(),i.length>=2?s():window.alert("You can't save this route unless it has at least two points. Press 'Cancel' to discard these changes.")):j.key=="s"&&!Ee?m():j.key=="1"&&!Ee?e(2,u="append-start"):j.key=="2"&&!Ee?e(2,u="append-end"):j.key=="3"&&!Ee?e(2,u="adjust"):j.key=="z"&&j.ctrlKey&&(j.stopPropagation(),p())}function ue(){v(),e(4,w=!0)}function J(j){u=j,e(2,u)}function me(j,V){t.$$.not_equal(V.point,j)&&(V.point=j,e(10,_))}const K=j=>y(j),be=j=>C(j);function ve(j,V){t.$$.not_equal(V.point,j)&&(V.point=j,Te.set(i))}const G=j=>O(j),Re=j=>F(j),H=()=>e(3,g=!0),Q=()=>e(3,g=!1),ot=()=>e(4,w=!1);return t.$$set=j=>{"finish"in j&&e(0,s=j.finish),"cancel"in j&&e(1,f=j.cancel),"editingExisting"in j&&e(24,l=j.editingExisting)},t.$$.update=()=>{t.$$.dirty[0]&228&&M(a,i,u,k),t.$$.dirty[0]&33554652&&e(11,r=S(a,i,u,d,g||w)),t.$$.dirty[0]&64&&b(i)},[s,f,u,g,w,k,i,a,c,h,_,r,p,m,A,$,O,F,N,y,C,Z,ie,ue,l,d,J,me,K,be,ve,G,Re,H,Q,ot]}class Hs extends ce{constructor(n){super(),he(this,n,Bh,Dh,fe,{finish:0,cancel:1,editingExisting:24},null,[-1,-1])}}function jh(t){let n,e;return n=new Zs({props:{finish:t[3],cancel:t[4]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Uh(t){let n,e;return n=new Hs({props:{finish:t[2],cancel:t[4],editingExisting:!0}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Zh(t){let n,e;return n=new Gs({props:{finish:t[1],cancel:t[4]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Gh(t){let n,e,r,i;const o=[Zh,Uh,jh],a=[];function s(f,l){return f[0]=="point"?0:f[0]=="route"?1:f[0]=="area"?2:-1}return~(n=s(t))&&(e=a[n]=o[n](t)),{c(){e&&e.c(),r=Le()},m(f,l){~n&&a[n].m(f,l),P(f,r,l),i=!0},p(f,[l]){let u=n;n=s(f),n===u?~n&&a[n].p(f,l):(e&&(ae(),R(a[u],1,1,()=>{a[u]=null}),se()),~n?(e=a[n],e?e.p(f,l):(e=a[n]=o[n](f),e.c()),E(e,1),e.m(r.parentNode,r)):e=null)},i(f){i||(E(e),i=!0)},o(f){R(e),i=!1},d(f){f&&L(r),~n&&a[n].d(f)}}}function Hh(t,n,e){let r,i,o,a,s;X(t,Ne,p=>e(10,r=p)),X(t,Jt,p=>e(11,i=p)),X(t,Te,p=>e(12,o=p)),X(t,tt,p=>e(13,a=p)),X(t,Pt,p=>e(8,s=p));let{cfg:f}=n,{gjSchemes:l}=n,{id:u}=n,c="",h=null;vt(()=>{let p=null;l.update(m=>(p=m.features.find(A=>A.id==u),p.properties.hide_while_editing=!0,m));let v=p;h=JSON.parse(JSON.stringify(v)),_t.set(b),v.geometry.type=="LineString"?(v.properties.waypoints?le(Te,o=v.properties.waypoints.map(m=>({point:[m.lon,m.lat],snapped:m.snapped})),o):le(Te,o=v.geometry.coordinates.map(m=>({point:JSON.parse(JSON.stringify(m)),snapped:!1})),o),e(0,c="route"),Ye.set(w)):v.geometry.type=="Polygon"?(v.properties.waypoints?le(Ne,r=v.properties.waypoints.map(m=>({point:[m.lon,m.lat],snapped:m.snapped})),r):(le(Ne,r=v.geometry.coordinates[0].map(m=>({point:JSON.parse(JSON.stringify(m)),snapped:!1})),r),r.pop(),Ne.set(r)),e(0,c="area"),Ye.set(k)):v.geometry.type=="Point"&&(le(Pt,s=JSON.parse(JSON.stringify(v.geometry.coordinates)),s),e(0,c="point"),Ye.set(g))}),qe(()=>{le(Pt,s=null,s),Ye.set(()=>{}),_t.set(()=>{}),i==null||i.stop(),i==null||i.clearEventListeners(),l.update(p=>{let v=p.features.find(m=>m.id==u);return v&&(delete v.properties.hide_while_editing,h&&d(v,h)),p})});function _(p){(h==null?void 0:h.geometry.type)=="Point"&&p&&(h.geometry.coordinates=ji(p))}function d(p,v){p.geometry=v.geometry,p.properties={...a},v.properties.length_meters&&(p.properties.length_meters=v.properties.length_meters),v.properties.waypoints&&(p.properties.waypoints=v.properties.waypoints),f.updateFeature(p,v)}function g(){de.set({mode:"list"})}function w(){if(i)try{let p=i.inner.calculateRoute(o);h=JSON.parse(p)}catch(p){console.warn(`Finishing route failed: ${p}`)}g()}function k(){if(i&&r.length>=3)try{h=Wi(i,r)}catch(p){console.warn(`Finishing area failed: ${p}`)}g()}function b(){h=null,de.set({mode:"list"})}return t.$$set=p=>{"cfg"in p&&e(5,f=p.cfg),"gjSchemes"in p&&e(6,l=p.gjSchemes),"id"in p&&e(7,u=p.id)},t.$$.update=()=>{t.$$.dirty&256&&_(s)},[c,g,w,k,b,f,l,u,s]}class Yh extends ce{constructor(n){super(),he(this,n,Hh,Gh,fe,{cfg:5,gjSchemes:6,id:7})}}function Xh(t){let n,e,r;return{c(){n=D("input"),U(n,"class","govuk-file-upload"),U(n,"id","load-image"),U(n,"type","file")},m(i,o){P(i,n,o),t[6](n),e||(r=ke(n,"change",t[3]),e=!0)},p:W,d(i){i&&L(n),t[6](null),e=!1,r()}}}function oa(t){let n,e,r,i,o,a,s,f,l,u;return{c(){n=D("div"),e=D("label"),r=D("input"),i=z(),o=D("br"),a=q(`
        Opacity: `),s=q(t[1]),f=q("%"),U(r,"type","range"),U(r,"min","0"),U(r,"max","100")},m(c,h){P(c,n,h),B(n,e),B(e,r),dn(r,t[1]),B(e,i),B(e,o),B(e,a),B(e,s),B(e,f),l||(u=[ke(r,"change",t[7]),ke(r,"input",t[7])],l=!0)},p(c,h){h&2&&dn(r,c[1]),h&2&&je(s,c[1])},d(c){c&&L(n),l=!1,Fr(u)}}}function qh(t){let n;return{c(){n=q("Save")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function Jh(t){let n;return{c(){n=q("Delete")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function Wh(t){let n;return{c(){n=D("p"),n.textContent=`Note this image isn't saved as part of this scheme. When you close
          this page, it'll be lost.`},m(e,r){P(e,n,r)},p:W,d(e){e&&L(n)}}}function Kh(t){let n,e,r,i,o,a;return n=new wt({props:{$$slots:{default:[qh]},$$scope:{ctx:t}}}),n.$on("click",t[8]),r=new Br({props:{disabled:!t[2],$$slots:{default:[Jh]},$$scope:{ctx:t}}}),r.$on("click",t[4]),o=new wn({props:{$$slots:{default:[Wh]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment),i=z(),I(o.$$.fragment)},m(s,f){x(n,s,f),P(s,e,f),x(r,s,f),P(s,i,f),x(o,s,f),a=!0},p(s,f){const l={};f&512&&(l.$$scope={dirty:f,ctx:s}),n.$set(l);const u={};f&4&&(u.disabled=!s[2]),f&512&&(u.$$scope={dirty:f,ctx:s}),r.$set(u);const c={};f&512&&(c.$$scope={dirty:f,ctx:s}),o.$set(c)},i(s){a||(E(n.$$.fragment,s),E(r.$$.fragment,s),E(o.$$.fragment,s),a=!0)},o(s){R(n.$$.fragment,s),R(r.$$.fragment,s),R(o.$$.fragment,s),a=!1},d(s){s&&(L(e),L(i)),T(n,s),T(r,s),T(o,s)}}}function Vh(t){let n,e,r,i,o,a,s,f,l;e=new Pf({props:{label:"Load an image",id:"load-image",$$slots:{default:[Xh]},$$scope:{ctx:t}}});let u=t[2]&&oa(t);return a=new yn({props:{$$slots:{default:[Kh]},$$scope:{ctx:t}}}),{c(){n=D("div"),I(e.$$.fragment),r=z(),u&&u.c(),i=z(),o=D("div"),I(a.$$.fragment),re(o,"margin-left","auto"),re(n,"display","flex")},m(c,h){P(c,n,h),x(e,n,null),B(n,r),u&&u.m(n,null),B(n,i),B(n,o),x(a,o,null),s=!0,f||(l=ke(window,"keydown",t[5]),f=!0)},p(c,[h]){const _={};h&513&&(_.$$scope={dirty:h,ctx:c}),e.$set(_),c[2]?u?u.p(c,h):(u=oa(c),u.c(),u.m(n,i)):u&&(u.d(1),u=null);const d={};h&516&&(d.$$scope={dirty:h,ctx:c}),a.$set(d)},i(c){s||(E(e.$$.fragment,c),E(a.$$.fragment,c),s=!0)},o(c){R(e.$$.fragment,c),R(a.$$.fragment,c),s=!1},d(c){c&&L(n),T(e),u&&u.d(),T(a),f=!1,l()}}}function Qh(t,n,e){let r,i;X(t,Er,h=>e(1,r=h)),X(t,Sr,h=>e(2,i=h));let o;async function a(h){let _=await o.files[0].arrayBuffer(),d=new Blob([new Uint8Array(_)]);le(Sr,i=URL.createObjectURL(d),i)}function s(){le(Sr,i=null,i),le(Er,r=100,r)}function f(h){h.key=="Escape"&&(h.stopPropagation(),de.set({mode:"list"}))}function l(h){we[h?"unshift":"push"](()=>{o=h,e(0,o)})}function u(){r=Kl(this.value),Er.set(r)}return[o,r,i,a,s,f,l,u,()=>de.set({mode:"list"})]}class ed extends ce{constructor(n){super(),he(this,n,Qh,Vh,fe,{})}}function td(t){let n,e;return n=new Gs({props:{finish:t[0],cancel:t[1]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function nd(t,n,e){let r,i,o;X(t,tt,u=>e(6,r=u)),X(t,Pt,u=>e(4,i=u)),X(t,Ze,u=>e(5,o=u));let{cfg:a}=n,{gjSchemes:s}=n;vt(()=>{o&&(o.getCanvas().style.cursor="crosshair"),Ye.set(f),_t.set(l)}),qe(()=>{le(Pt,i=null,i),_t.set(()=>{}),Ye.set(()=>{}),o&&(o.getCanvas().style.cursor="inherit")});function f(){if(!i)return;let u={type:"Feature",geometry:{type:"Point",coordinates:ji(i)},properties:{...r}};s.update(c=>{var h;return u.id=zr(c),(h=u.properties).scheme_reference||(h.scheme_reference=Bi(c)),a.newPointFeature(u),c.features.push(u),c}),de.set({mode:"list"})}function l(){de.set({mode:"list"})}return t.$$set=u=>{"cfg"in u&&e(2,a=u.cfg),"gjSchemes"in u&&e(3,s=u.gjSchemes)},t.$$.update=()=>{t.$$.dirty&48&&i&&o&&(o.getCanvas().style.cursor="inherit")},[f,l,a,s,i,o]}class rd extends ce{constructor(n){super(),he(this,n,nd,td,fe,{cfg:2,gjSchemes:3})}}function id(t){let n,e;return n=new Hs({props:{finish:t[1],cancel:t[0],editingExisting:!1}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function od(t,n,e){let r,i,o;X(t,Te,c=>e(4,r=c)),X(t,Jt,c=>e(5,i=c)),X(t,tt,c=>e(6,o=c));let{cfg:a}=n,{gjSchemes:s}=n;vt(()=>{le(Te,r=[],r),_t.set(l),Ye.set(u)}),qe(()=>{_t.set(()=>{}),Ye.set(()=>{})});function f(c){let h=c;h.properties={...h.properties,...o},s.update(_=>{var d;return h.id=zr(_),(d=h.properties).scheme_reference||(d.scheme_reference=Bi(_)),a.newLineStringFeature(h),_.features.push(h),_}),de.set({mode:"list"})}function l(){de.set({mode:"list"})}function u(){if(i)try{let c=i.inner.calculateRoute(r);f(JSON.parse(c))}catch(c){console.warn(`Finishing route failed: ${c}`)}}return t.$$set=c=>{"cfg"in c&&e(2,a=c.cfg),"gjSchemes"in c&&e(3,s=c.gjSchemes)},[l,u,a,s]}class ad extends ce{constructor(n){super(),he(this,n,od,id,fe,{cfg:2,gjSchemes:3})}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const sd=4,aa=0,sa=1,ld=2;function $n(t){let n=t.length;for(;--n>=0;)t[n]=0}const fd=0,Ys=1,ud=2,cd=3,hd=258,Ki=29,nr=256,Zn=nr+1+Ki,cn=30,Vi=19,Xs=2*Zn+1,Ut=15,Vr=16,dd=7,Qi=256,qs=16,Js=17,Ws=18,Li=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Mr=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),_d=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Ks=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pd=512,gt=new Array((Zn+2)*2);$n(gt);const zn=new Array(cn*2);$n(zn);const Gn=new Array(pd);$n(Gn);const Hn=new Array(hd-cd+1);$n(Hn);const eo=new Array(Ki);$n(eo);const Ir=new Array(cn);$n(Ir);function Qr(t,n,e,r,i){this.static_tree=t,this.extra_bits=n,this.extra_base=e,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let Vs,Qs,el;function ei(t,n){this.dyn_tree=t,this.max_code=0,this.stat_desc=n}const tl=t=>t<256?Gn[t]:Gn[256+(t>>>7)],Yn=(t,n)=>{t.pending_buf[t.pending++]=n&255,t.pending_buf[t.pending++]=n>>>8&255},ze=(t,n,e)=>{t.bi_valid>Vr-e?(t.bi_buf|=n<<t.bi_valid&65535,Yn(t,t.bi_buf),t.bi_buf=n>>Vr-t.bi_valid,t.bi_valid+=e-Vr):(t.bi_buf|=n<<t.bi_valid&65535,t.bi_valid+=e)},ut=(t,n,e)=>{ze(t,e[n*2],e[n*2+1])},nl=(t,n)=>{let e=0;do e|=t&1,t>>>=1,e<<=1;while(--n>0);return e>>>1},gd=t=>{t.bi_valid===16?(Yn(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},md=(t,n)=>{const e=n.dyn_tree,r=n.max_code,i=n.stat_desc.static_tree,o=n.stat_desc.has_stree,a=n.stat_desc.extra_bits,s=n.stat_desc.extra_base,f=n.stat_desc.max_length;let l,u,c,h,_,d,g=0;for(h=0;h<=Ut;h++)t.bl_count[h]=0;for(e[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<Xs;l++)u=t.heap[l],h=e[e[u*2+1]*2+1]+1,h>f&&(h=f,g++),e[u*2+1]=h,!(u>r)&&(t.bl_count[h]++,_=0,u>=s&&(_=a[u-s]),d=e[u*2],t.opt_len+=d*(h+_),o&&(t.static_len+=d*(i[u*2+1]+_)));if(g!==0){do{for(h=f-1;t.bl_count[h]===0;)h--;t.bl_count[h]--,t.bl_count[h+1]+=2,t.bl_count[f]--,g-=2}while(g>0);for(h=f;h!==0;h--)for(u=t.bl_count[h];u!==0;)c=t.heap[--l],!(c>r)&&(e[c*2+1]!==h&&(t.opt_len+=(h-e[c*2+1])*e[c*2],e[c*2+1]=h),u--)}},rl=(t,n,e)=>{const r=new Array(Ut+1);let i=0,o,a;for(o=1;o<=Ut;o++)i=i+e[o-1]<<1,r[o]=i;for(a=0;a<=n;a++){let s=t[a*2+1];s!==0&&(t[a*2]=nl(r[s]++,s))}},bd=()=>{let t,n,e,r,i;const o=new Array(Ut+1);for(e=0,r=0;r<Ki-1;r++)for(eo[r]=e,t=0;t<1<<Li[r];t++)Hn[e++]=r;for(Hn[e-1]=r,i=0,r=0;r<16;r++)for(Ir[r]=i,t=0;t<1<<Mr[r];t++)Gn[i++]=r;for(i>>=7;r<cn;r++)for(Ir[r]=i<<7,t=0;t<1<<Mr[r]-7;t++)Gn[256+i++]=r;for(n=0;n<=Ut;n++)o[n]=0;for(t=0;t<=143;)gt[t*2+1]=8,t++,o[8]++;for(;t<=255;)gt[t*2+1]=9,t++,o[9]++;for(;t<=279;)gt[t*2+1]=7,t++,o[7]++;for(;t<=287;)gt[t*2+1]=8,t++,o[8]++;for(rl(gt,Zn+1,o),t=0;t<cn;t++)zn[t*2+1]=5,zn[t*2]=nl(t,5);Vs=new Qr(gt,Li,nr+1,Zn,Ut),Qs=new Qr(zn,Mr,0,cn,Ut),el=new Qr(new Array(0),_d,0,Vi,dd)},il=t=>{let n;for(n=0;n<Zn;n++)t.dyn_ltree[n*2]=0;for(n=0;n<cn;n++)t.dyn_dtree[n*2]=0;for(n=0;n<Vi;n++)t.bl_tree[n*2]=0;t.dyn_ltree[Qi*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},ol=t=>{t.bi_valid>8?Yn(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},la=(t,n,e,r)=>{const i=n*2,o=e*2;return t[i]<t[o]||t[i]===t[o]&&r[n]<=r[e]},ti=(t,n,e)=>{const r=t.heap[e];let i=e<<1;for(;i<=t.heap_len&&(i<t.heap_len&&la(n,t.heap[i+1],t.heap[i],t.depth)&&i++,!la(n,r,t.heap[i],t.depth));)t.heap[e]=t.heap[i],e=i,i<<=1;t.heap[e]=r},fa=(t,n,e)=>{let r,i,o=0,a,s;if(t.sym_next!==0)do r=t.pending_buf[t.sym_buf+o++]&255,r+=(t.pending_buf[t.sym_buf+o++]&255)<<8,i=t.pending_buf[t.sym_buf+o++],r===0?ut(t,i,n):(a=Hn[i],ut(t,a+nr+1,n),s=Li[a],s!==0&&(i-=eo[a],ze(t,i,s)),r--,a=tl(r),ut(t,a,e),s=Mr[a],s!==0&&(r-=Ir[a],ze(t,r,s)));while(o<t.sym_next);ut(t,Qi,n)},Ni=(t,n)=>{const e=n.dyn_tree,r=n.stat_desc.static_tree,i=n.stat_desc.has_stree,o=n.stat_desc.elems;let a,s,f=-1,l;for(t.heap_len=0,t.heap_max=Xs,a=0;a<o;a++)e[a*2]!==0?(t.heap[++t.heap_len]=f=a,t.depth[a]=0):e[a*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=f<2?++f:0,e[l*2]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=r[l*2+1]);for(n.max_code=f,a=t.heap_len>>1;a>=1;a--)ti(t,e,a);l=o;do a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],ti(t,e,1),s=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=s,e[l*2]=e[a*2]+e[s*2],t.depth[l]=(t.depth[a]>=t.depth[s]?t.depth[a]:t.depth[s])+1,e[a*2+1]=e[s*2+1]=l,t.heap[1]=l++,ti(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],md(t,n),rl(e,f,t.bl_count)},ua=(t,n,e)=>{let r,i=-1,o,a=n[0*2+1],s=0,f=7,l=4;for(a===0&&(f=138,l=3),n[(e+1)*2+1]=65535,r=0;r<=e;r++)o=a,a=n[(r+1)*2+1],!(++s<f&&o===a)&&(s<l?t.bl_tree[o*2]+=s:o!==0?(o!==i&&t.bl_tree[o*2]++,t.bl_tree[qs*2]++):s<=10?t.bl_tree[Js*2]++:t.bl_tree[Ws*2]++,s=0,i=o,a===0?(f=138,l=3):o===a?(f=6,l=3):(f=7,l=4))},ca=(t,n,e)=>{let r,i=-1,o,a=n[0*2+1],s=0,f=7,l=4;for(a===0&&(f=138,l=3),r=0;r<=e;r++)if(o=a,a=n[(r+1)*2+1],!(++s<f&&o===a)){if(s<l)do ut(t,o,t.bl_tree);while(--s!==0);else o!==0?(o!==i&&(ut(t,o,t.bl_tree),s--),ut(t,qs,t.bl_tree),ze(t,s-3,2)):s<=10?(ut(t,Js,t.bl_tree),ze(t,s-3,3)):(ut(t,Ws,t.bl_tree),ze(t,s-11,7));s=0,i=o,a===0?(f=138,l=3):o===a?(f=6,l=3):(f=7,l=4)}},vd=t=>{let n;for(ua(t,t.dyn_ltree,t.l_desc.max_code),ua(t,t.dyn_dtree,t.d_desc.max_code),Ni(t,t.bl_desc),n=Vi-1;n>=3&&t.bl_tree[Ks[n]*2+1]===0;n--);return t.opt_len+=3*(n+1)+5+5+4,n},wd=(t,n,e,r)=>{let i;for(ze(t,n-257,5),ze(t,e-1,5),ze(t,r-4,4),i=0;i<r;i++)ze(t,t.bl_tree[Ks[i]*2+1],3);ca(t,t.dyn_ltree,n-1),ca(t,t.dyn_dtree,e-1)},yd=t=>{let n=4093624447,e;for(e=0;e<=31;e++,n>>>=1)if(n&1&&t.dyn_ltree[e*2]!==0)return aa;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return sa;for(e=32;e<nr;e++)if(t.dyn_ltree[e*2]!==0)return sa;return aa};let ha=!1;const $d=t=>{ha||(bd(),ha=!0),t.l_desc=new ei(t.dyn_ltree,Vs),t.d_desc=new ei(t.dyn_dtree,Qs),t.bl_desc=new ei(t.bl_tree,el),t.bi_buf=0,t.bi_valid=0,il(t)},al=(t,n,e,r)=>{ze(t,(fd<<1)+(r?1:0),3),ol(t),Yn(t,e),Yn(t,~e),e&&t.pending_buf.set(t.window.subarray(n,n+e),t.pending),t.pending+=e},kd=t=>{ze(t,Ys<<1,3),ut(t,Qi,gt),gd(t)},Sd=(t,n,e,r)=>{let i,o,a=0;t.level>0?(t.strm.data_type===ld&&(t.strm.data_type=yd(t)),Ni(t,t.l_desc),Ni(t,t.d_desc),a=vd(t),i=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=i&&(i=o)):i=o=e+5,e+4<=i&&n!==-1?al(t,n,e,r):t.strategy===sd||o===i?(ze(t,(Ys<<1)+(r?1:0),3),fa(t,gt,zn)):(ze(t,(ud<<1)+(r?1:0),3),wd(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),fa(t,t.dyn_ltree,t.dyn_dtree)),il(t),r&&ol(t)},Ed=(t,n,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=n,t.pending_buf[t.sym_buf+t.sym_next++]=n>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,n===0?t.dyn_ltree[e*2]++:(t.matches++,n--,t.dyn_ltree[(Hn[e]+nr+1)*2]++,t.dyn_dtree[tl(n)*2]++),t.sym_next===t.sym_end);var Md=$d,Ad=al,Rd=Sd,Pd=Ed,Ld=kd,Nd={_tr_init:Md,_tr_stored_block:Ad,_tr_flush_block:Rd,_tr_tally:Pd,_tr_align:Ld};const Cd=(t,n,e,r)=>{let i=t&65535|0,o=t>>>16&65535|0,a=0;for(;e!==0;){a=e>2e3?2e3:e,e-=a;do i=i+n[r++]|0,o=o+i|0;while(--a);i%=65521,o%=65521}return i|o<<16|0};var Xn=Cd;const Od=()=>{let t,n=[];for(var e=0;e<256;e++){t=e;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;n[e]=t}return n},Id=new Uint32Array(Od()),xd=(t,n,e,r)=>{const i=Id,o=r+e;t^=-1;for(let a=r;a<o;a++)t=t>>>8^i[(t^n[a])&255];return t^-1};var ye=xd,gn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},rr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Td,_tr_stored_block:Ci,_tr_flush_block:Fd,_tr_tally:Nt,_tr_align:zd}=Nd,{Z_NO_FLUSH:Ct,Z_PARTIAL_FLUSH:Dd,Z_FULL_FLUSH:Bd,Z_FINISH:He,Z_BLOCK:da,Z_OK:Me,Z_STREAM_END:_a,Z_STREAM_ERROR:ht,Z_DATA_ERROR:jd,Z_BUF_ERROR:ni,Z_DEFAULT_COMPRESSION:Ud,Z_FILTERED:Zd,Z_HUFFMAN_ONLY:cr,Z_RLE:Gd,Z_FIXED:Hd,Z_DEFAULT_STRATEGY:Yd,Z_UNKNOWN:Xd,Z_DEFLATED:Ur}=rr,qd=9,Jd=15,Wd=8,Kd=29,Vd=256,Oi=Vd+1+Kd,Qd=30,e_=19,t_=2*Oi+1,n_=15,ne=3,Rt=258,dt=Rt+ne+1,r_=32,mn=42,to=57,Ii=69,xi=73,Ti=91,Fi=103,Zt=113,Cn=666,Ce=1,kn=2,Yt=3,Sn=4,i_=3,Gt=(t,n)=>(t.msg=gn[n],n),pa=t=>t*2-(t>4?9:0),kt=t=>{let n=t.length;for(;--n>=0;)t[n]=0},o_=t=>{let n,e,r,i=t.w_size;n=t.hash_size,r=n;do e=t.head[--r],t.head[r]=e>=i?e-i:0;while(--n);n=i,r=n;do e=t.prev[--r],t.prev[r]=e>=i?e-i:0;while(--n)};let a_=(t,n,e)=>(n<<t.hash_shift^e)&t.hash_mask,Ot=a_;const De=t=>{const n=t.state;let e=n.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+e),t.next_out),t.next_out+=e,n.pending_out+=e,t.total_out+=e,t.avail_out-=e,n.pending-=e,n.pending===0&&(n.pending_out=0))},Be=(t,n)=>{Fd(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,n),t.block_start=t.strstart,De(t.strm)},oe=(t,n)=>{t.pending_buf[t.pending++]=n},An=(t,n)=>{t.pending_buf[t.pending++]=n>>>8&255,t.pending_buf[t.pending++]=n&255},zi=(t,n,e,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,n.set(t.input.subarray(t.next_in,t.next_in+i),e),t.state.wrap===1?t.adler=Xn(t.adler,n,i,e):t.state.wrap===2&&(t.adler=ye(t.adler,n,i,e)),t.next_in+=i,t.total_in+=i,i)},sl=(t,n)=>{let e=t.max_chain_length,r=t.strstart,i,o,a=t.prev_length,s=t.nice_match;const f=t.strstart>t.w_size-dt?t.strstart-(t.w_size-dt):0,l=t.window,u=t.w_mask,c=t.prev,h=t.strstart+Rt;let _=l[r+a-1],d=l[r+a];t.prev_length>=t.good_match&&(e>>=2),s>t.lookahead&&(s=t.lookahead);do if(i=n,!(l[i+a]!==d||l[i+a-1]!==_||l[i]!==l[r]||l[++i]!==l[r+1])){r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<h);if(o=Rt-(h-r),r=h-Rt,o>a){if(t.match_start=n,a=o,o>=s)break;_=l[r+a-1],d=l[r+a]}}while((n=c[n&u])>f&&--e!==0);return a<=t.lookahead?a:t.lookahead},bn=t=>{const n=t.w_size;let e,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=n+(n-dt)&&(t.window.set(t.window.subarray(n,n+n-r),0),t.match_start-=n,t.strstart-=n,t.block_start-=n,t.insert>t.strstart&&(t.insert=t.strstart),o_(t),r+=n),t.strm.avail_in===0)break;if(e=zi(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=e,t.lookahead+t.insert>=ne)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Ot(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Ot(t,t.ins_h,t.window[i+ne-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<ne)););}while(t.lookahead<dt&&t.strm.avail_in!==0)},ll=(t,n)=>{let e=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r,i,o,a=0,s=t.strm.avail_in;do{if(r=65535,o=t.bi_valid+42>>3,t.strm.avail_out<o||(o=t.strm.avail_out-o,i=t.strstart-t.block_start,r>i+t.strm.avail_in&&(r=i+t.strm.avail_in),r>o&&(r=o),r<e&&(r===0&&n!==He||n===Ct||r!==i+t.strm.avail_in)))break;a=n===He&&r===i+t.strm.avail_in?1:0,Ci(t,0,0,a),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,De(t.strm),i&&(i>r&&(i=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,r-=i),r&&(zi(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(a===0);return s-=t.strm.avail_in,s&&(s>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=s&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-s,t.strm.next_in),t.strstart),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),a?Sn:n!==Ct&&n!==He&&t.strm.avail_in===0&&t.strstart===t.block_start?kn:(o=t.window_size-t.strstart,t.strm.avail_in>o&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,o+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),o>t.strm.avail_in&&(o=t.strm.avail_in),o&&(zi(t.strm,t.window,t.strstart,o),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.high_water<t.strstart&&(t.high_water=t.strstart),o=t.bi_valid+42>>3,o=t.pending_buf_size-o>65535?65535:t.pending_buf_size-o,e=o>t.w_size?t.w_size:o,i=t.strstart-t.block_start,(i>=e||(i||n===He)&&n!==Ct&&t.strm.avail_in===0&&i<=o)&&(r=i>o?o:i,a=n===He&&t.strm.avail_in===0&&r===i?1:0,Ci(t,t.block_start,r,a),t.block_start+=r,De(t.strm)),a?Yt:Ce)},ri=(t,n)=>{let e,r;for(;;){if(t.lookahead<dt){if(bn(t),t.lookahead<dt&&n===Ct)return Ce;if(t.lookahead===0)break}if(e=0,t.lookahead>=ne&&(t.ins_h=Ot(t,t.ins_h,t.window[t.strstart+ne-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-dt&&(t.match_length=sl(t,e)),t.match_length>=ne)if(r=Nt(t,t.strstart-t.match_start,t.match_length-ne),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=ne){t.match_length--;do t.strstart++,t.ins_h=Ot(t,t.ins_h,t.window[t.strstart+ne-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Ot(t,t.ins_h,t.window[t.strstart+1]);else r=Nt(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Be(t,!1),t.strm.avail_out===0))return Ce}return t.insert=t.strstart<ne-1?t.strstart:ne-1,n===He?(Be(t,!0),t.strm.avail_out===0?Yt:Sn):t.sym_next&&(Be(t,!1),t.strm.avail_out===0)?Ce:kn},on=(t,n)=>{let e,r,i;for(;;){if(t.lookahead<dt){if(bn(t),t.lookahead<dt&&n===Ct)return Ce;if(t.lookahead===0)break}if(e=0,t.lookahead>=ne&&(t.ins_h=Ot(t,t.ins_h,t.window[t.strstart+ne-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=ne-1,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-dt&&(t.match_length=sl(t,e),t.match_length<=5&&(t.strategy===Zd||t.match_length===ne&&t.strstart-t.match_start>4096)&&(t.match_length=ne-1)),t.prev_length>=ne&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-ne,r=Nt(t,t.strstart-1-t.prev_match,t.prev_length-ne),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Ot(t,t.ins_h,t.window[t.strstart+ne-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=ne-1,t.strstart++,r&&(Be(t,!1),t.strm.avail_out===0))return Ce}else if(t.match_available){if(r=Nt(t,0,t.window[t.strstart-1]),r&&Be(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return Ce}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Nt(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<ne-1?t.strstart:ne-1,n===He?(Be(t,!0),t.strm.avail_out===0?Yt:Sn):t.sym_next&&(Be(t,!1),t.strm.avail_out===0)?Ce:kn},s_=(t,n)=>{let e,r,i,o;const a=t.window;for(;;){if(t.lookahead<=Rt){if(bn(t),t.lookahead<=Rt&&n===Ct)return Ce;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=ne&&t.strstart>0&&(i=t.strstart-1,r=a[i],r===a[++i]&&r===a[++i]&&r===a[++i])){o=t.strstart+Rt;do;while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<o);t.match_length=Rt-(o-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=ne?(e=Nt(t,1,t.match_length-ne),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(e=Nt(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),e&&(Be(t,!1),t.strm.avail_out===0))return Ce}return t.insert=0,n===He?(Be(t,!0),t.strm.avail_out===0?Yt:Sn):t.sym_next&&(Be(t,!1),t.strm.avail_out===0)?Ce:kn},l_=(t,n)=>{let e;for(;;){if(t.lookahead===0&&(bn(t),t.lookahead===0)){if(n===Ct)return Ce;break}if(t.match_length=0,e=Nt(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,e&&(Be(t,!1),t.strm.avail_out===0))return Ce}return t.insert=0,n===He?(Be(t,!0),t.strm.avail_out===0?Yt:Sn):t.sym_next&&(Be(t,!1),t.strm.avail_out===0)?Ce:kn};function lt(t,n,e,r,i){this.good_length=t,this.max_lazy=n,this.nice_length=e,this.max_chain=r,this.func=i}const On=[new lt(0,0,0,0,ll),new lt(4,4,8,4,ri),new lt(4,5,16,8,ri),new lt(4,6,32,32,ri),new lt(4,4,16,16,on),new lt(8,16,32,32,on),new lt(8,16,128,128,on),new lt(8,32,128,256,on),new lt(32,128,258,1024,on),new lt(32,258,258,4096,on)],f_=t=>{t.window_size=2*t.w_size,kt(t.head),t.max_lazy_match=On[t.level].max_lazy,t.good_match=On[t.level].good_length,t.nice_match=On[t.level].nice_length,t.max_chain_length=On[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=ne-1,t.match_available=0,t.ins_h=0};function u_(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ur,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(t_*2),this.dyn_dtree=new Uint16Array((2*Qd+1)*2),this.bl_tree=new Uint16Array((2*e_+1)*2),kt(this.dyn_ltree),kt(this.dyn_dtree),kt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(n_+1),this.heap=new Uint16Array(2*Oi+1),kt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Oi+1),kt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ir=t=>{if(!t)return 1;const n=t.state;return!n||n.strm!==t||n.status!==mn&&n.status!==to&&n.status!==Ii&&n.status!==xi&&n.status!==Ti&&n.status!==Fi&&n.status!==Zt&&n.status!==Cn?1:0},fl=t=>{if(ir(t))return Gt(t,ht);t.total_in=t.total_out=0,t.data_type=Xd;const n=t.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap===2?to:n.wrap?mn:Zt,t.adler=n.wrap===2?0:1,n.last_flush=-2,Td(n),Me},ul=t=>{const n=fl(t);return n===Me&&f_(t.state),n},c_=(t,n)=>ir(t)||t.state.wrap!==2?ht:(t.state.gzhead=n,Me),cl=(t,n,e,r,i,o)=>{if(!t)return ht;let a=1;if(n===Ud&&(n=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>qd||e!==Ur||r<8||r>15||n<0||n>9||o<0||o>Hd||r===8&&a!==1)return Gt(t,ht);r===8&&(r=9);const s=new u_;return t.state=s,s.strm=t,s.status=mn,s.wrap=a,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+ne-1)/ne),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=(s.lit_bufsize-1)*3,s.level=n,s.strategy=o,s.method=e,ul(t)},h_=(t,n)=>cl(t,n,Ur,Jd,Wd,Yd),d_=(t,n)=>{if(ir(t)||n>da||n<0)return t?Gt(t,ht):ht;const e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===Cn&&n!==He)return Gt(t,t.avail_out===0?ni:ht);const r=e.last_flush;if(e.last_flush=n,e.pending!==0){if(De(t),t.avail_out===0)return e.last_flush=-1,Me}else if(t.avail_in===0&&pa(n)<=pa(r)&&n!==He)return Gt(t,ni);if(e.status===Cn&&t.avail_in!==0)return Gt(t,ni);if(e.status===mn&&e.wrap===0&&(e.status=Zt),e.status===mn){let i=Ur+(e.w_bits-8<<4)<<8,o=-1;if(e.strategy>=cr||e.level<2?o=0:e.level<6?o=1:e.level===6?o=2:o=3,i|=o<<6,e.strstart!==0&&(i|=r_),i+=31-i%31,An(e,i),e.strstart!==0&&(An(e,t.adler>>>16),An(e,t.adler&65535)),t.adler=1,e.status=Zt,De(t),e.pending!==0)return e.last_flush=-1,Me}if(e.status===to){if(t.adler=0,oe(e,31),oe(e,139),oe(e,8),e.gzhead)oe(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),oe(e,e.gzhead.time&255),oe(e,e.gzhead.time>>8&255),oe(e,e.gzhead.time>>16&255),oe(e,e.gzhead.time>>24&255),oe(e,e.level===9?2:e.strategy>=cr||e.level<2?4:0),oe(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(oe(e,e.gzhead.extra.length&255),oe(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=ye(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=Ii;else if(oe(e,0),oe(e,0),oe(e,0),oe(e,0),oe(e,0),oe(e,e.level===9?2:e.strategy>=cr||e.level<2?4:0),oe(e,i_),e.status=Zt,De(t),e.pending!==0)return e.last_flush=-1,Me}if(e.status===Ii){if(e.gzhead.extra){let i=e.pending,o=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+o>e.pending_buf_size;){let s=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+s),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>i&&(t.adler=ye(t.adler,e.pending_buf,e.pending-i,i)),e.gzindex+=s,De(t),e.pending!==0)return e.last_flush=-1,Me;i=0,o-=s}let a=new Uint8Array(e.gzhead.extra);e.pending_buf.set(a.subarray(e.gzindex,e.gzindex+o),e.pending),e.pending+=o,e.gzhead.hcrc&&e.pending>i&&(t.adler=ye(t.adler,e.pending_buf,e.pending-i,i)),e.gzindex=0}e.status=xi}if(e.status===xi){if(e.gzhead.name){let i=e.pending,o;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>i&&(t.adler=ye(t.adler,e.pending_buf,e.pending-i,i)),De(t),e.pending!==0)return e.last_flush=-1,Me;i=0}e.gzindex<e.gzhead.name.length?o=e.gzhead.name.charCodeAt(e.gzindex++)&255:o=0,oe(e,o)}while(o!==0);e.gzhead.hcrc&&e.pending>i&&(t.adler=ye(t.adler,e.pending_buf,e.pending-i,i)),e.gzindex=0}e.status=Ti}if(e.status===Ti){if(e.gzhead.comment){let i=e.pending,o;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>i&&(t.adler=ye(t.adler,e.pending_buf,e.pending-i,i)),De(t),e.pending!==0)return e.last_flush=-1,Me;i=0}e.gzindex<e.gzhead.comment.length?o=e.gzhead.comment.charCodeAt(e.gzindex++)&255:o=0,oe(e,o)}while(o!==0);e.gzhead.hcrc&&e.pending>i&&(t.adler=ye(t.adler,e.pending_buf,e.pending-i,i))}e.status=Fi}if(e.status===Fi){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(De(t),e.pending!==0))return e.last_flush=-1,Me;oe(e,t.adler&255),oe(e,t.adler>>8&255),t.adler=0}if(e.status=Zt,De(t),e.pending!==0)return e.last_flush=-1,Me}if(t.avail_in!==0||e.lookahead!==0||n!==Ct&&e.status!==Cn){let i=e.level===0?ll(e,n):e.strategy===cr?l_(e,n):e.strategy===Gd?s_(e,n):On[e.level].func(e,n);if((i===Yt||i===Sn)&&(e.status=Cn),i===Ce||i===Yt)return t.avail_out===0&&(e.last_flush=-1),Me;if(i===kn&&(n===Dd?zd(e):n!==da&&(Ci(e,0,0,!1),n===Bd&&(kt(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),De(t),t.avail_out===0))return e.last_flush=-1,Me}return n!==He?Me:e.wrap<=0?_a:(e.wrap===2?(oe(e,t.adler&255),oe(e,t.adler>>8&255),oe(e,t.adler>>16&255),oe(e,t.adler>>24&255),oe(e,t.total_in&255),oe(e,t.total_in>>8&255),oe(e,t.total_in>>16&255),oe(e,t.total_in>>24&255)):(An(e,t.adler>>>16),An(e,t.adler&65535)),De(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?Me:_a)},__=t=>{if(ir(t))return ht;const n=t.state.status;return t.state=null,n===Zt?Gt(t,jd):Me},p_=(t,n)=>{let e=n.length;if(ir(t))return ht;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==mn||r.lookahead)return ht;if(i===1&&(t.adler=Xn(t.adler,n,e,0)),r.wrap=0,e>=r.w_size){i===0&&(kt(r.head),r.strstart=0,r.block_start=0,r.insert=0);let f=new Uint8Array(r.w_size);f.set(n.subarray(e-r.w_size,e),0),n=f,e=r.w_size}const o=t.avail_in,a=t.next_in,s=t.input;for(t.avail_in=e,t.next_in=0,t.input=n,bn(r);r.lookahead>=ne;){let f=r.strstart,l=r.lookahead-(ne-1);do r.ins_h=Ot(r,r.ins_h,r.window[f+ne-1]),r.prev[f&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=f,f++;while(--l);r.strstart=f,r.lookahead=ne-1,bn(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=ne-1,r.match_available=0,t.next_in=a,t.input=s,t.avail_in=o,r.wrap=i,Me};var g_=h_,m_=cl,b_=ul,v_=fl,w_=c_,y_=d_,$_=__,k_=p_,S_="pako deflate (from Nodeca project)",Dn={deflateInit:g_,deflateInit2:m_,deflateReset:b_,deflateResetKeep:v_,deflateSetHeader:w_,deflate:y_,deflateEnd:$_,deflateSetDictionary:k_,deflateInfo:S_};const E_=(t,n)=>Object.prototype.hasOwnProperty.call(t,n);var M_=function(t){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const e=n.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const r in e)E_(e,r)&&(t[r]=e[r])}}return t},A_=t=>{let n=0;for(let r=0,i=t.length;r<i;r++)n+=t[r].length;const e=new Uint8Array(n);for(let r=0,i=0,o=t.length;r<o;r++){let a=t[r];e.set(a,i),i+=a.length}return e},Zr={assign:M_,flattenChunks:A_};let hl=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{hl=!1}const qn=new Uint8Array(256);for(let t=0;t<256;t++)qn[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;qn[254]=qn[254]=1;var R_=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let n,e,r,i,o,a=t.length,s=0;for(i=0;i<a;i++)e=t.charCodeAt(i),(e&64512)===55296&&i+1<a&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(e=65536+(e-55296<<10)+(r-56320),i++)),s+=e<128?1:e<2048?2:e<65536?3:4;for(n=new Uint8Array(s),o=0,i=0;o<s;i++)e=t.charCodeAt(i),(e&64512)===55296&&i+1<a&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(e=65536+(e-55296<<10)+(r-56320),i++)),e<128?n[o++]=e:e<2048?(n[o++]=192|e>>>6,n[o++]=128|e&63):e<65536?(n[o++]=224|e>>>12,n[o++]=128|e>>>6&63,n[o++]=128|e&63):(n[o++]=240|e>>>18,n[o++]=128|e>>>12&63,n[o++]=128|e>>>6&63,n[o++]=128|e&63);return n};const P_=(t,n)=>{if(n<65534&&t.subarray&&hl)return String.fromCharCode.apply(null,t.length===n?t:t.subarray(0,n));let e="";for(let r=0;r<n;r++)e+=String.fromCharCode(t[r]);return e};var L_=(t,n)=>{const e=n||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,n));let r,i;const o=new Array(e*2);for(i=0,r=0;r<e;){let a=t[r++];if(a<128){o[i++]=a;continue}let s=qn[a];if(s>4){o[i++]=65533,r+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&r<e;)a=a<<6|t[r++]&63,s--;if(s>1){o[i++]=65533;continue}a<65536?o[i++]=a:(a-=65536,o[i++]=55296|a>>10&1023,o[i++]=56320|a&1023)}return P_(o,i)},N_=(t,n)=>{n=n||t.length,n>t.length&&(n=t.length);let e=n-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?n:e+qn[t[e]]>n?e:n},Jn={string2buf:R_,buf2string:L_,utf8border:N_};function C_(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var dl=C_;const _l=Object.prototype.toString,{Z_NO_FLUSH:O_,Z_SYNC_FLUSH:I_,Z_FULL_FLUSH:x_,Z_FINISH:T_,Z_OK:xr,Z_STREAM_END:F_,Z_DEFAULT_COMPRESSION:z_,Z_DEFAULT_STRATEGY:D_,Z_DEFLATED:B_}=rr;function no(t){this.options=Zr.assign({level:z_,method:B_,chunkSize:16384,windowBits:15,memLevel:8,strategy:D_},t||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dl,this.strm.avail_out=0;let e=Dn.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(e!==xr)throw new Error(gn[e]);if(n.header&&Dn.deflateSetHeader(this.strm,n.header),n.dictionary){let r;if(typeof n.dictionary=="string"?r=Jn.string2buf(n.dictionary):_l.call(n.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(n.dictionary):r=n.dictionary,e=Dn.deflateSetDictionary(this.strm,r),e!==xr)throw new Error(gn[e]);this._dict_set=!0}}no.prototype.push=function(t,n){const e=this.strm,r=this.options.chunkSize;let i,o;if(this.ended)return!1;for(n===~~n?o=n:o=n===!0?T_:O_,typeof t=="string"?e.input=Jn.string2buf(t):_l.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),(o===I_||o===x_)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(i=Dn.deflate(e,o),i===F_)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),i=Dn.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===xr;if(e.avail_out===0){this.onData(e.output);continue}if(o>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};no.prototype.onData=function(t){this.chunks.push(t)};no.prototype.onEnd=function(t){t===xr&&(this.result=Zr.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};const hr=16209,j_=16191;var U_=function(n,e){let r,i,o,a,s,f,l,u,c,h,_,d,g,w,k,b,p,v,m,A,$,O,F,N;const S=n.state;r=n.next_in,F=n.input,i=r+(n.avail_in-5),o=n.next_out,N=n.output,a=o-(e-n.avail_out),s=o+(n.avail_out-257),f=S.dmax,l=S.wsize,u=S.whave,c=S.wnext,h=S.window,_=S.hold,d=S.bits,g=S.lencode,w=S.distcode,k=(1<<S.lenbits)-1,b=(1<<S.distbits)-1;e:do{d<15&&(_+=F[r++]<<d,d+=8,_+=F[r++]<<d,d+=8),p=g[_&k];t:for(;;){if(v=p>>>24,_>>>=v,d-=v,v=p>>>16&255,v===0)N[o++]=p&65535;else if(v&16){m=p&65535,v&=15,v&&(d<v&&(_+=F[r++]<<d,d+=8),m+=_&(1<<v)-1,_>>>=v,d-=v),d<15&&(_+=F[r++]<<d,d+=8,_+=F[r++]<<d,d+=8),p=w[_&b];n:for(;;){if(v=p>>>24,_>>>=v,d-=v,v=p>>>16&255,v&16){if(A=p&65535,v&=15,d<v&&(_+=F[r++]<<d,d+=8,d<v&&(_+=F[r++]<<d,d+=8)),A+=_&(1<<v)-1,A>f){n.msg="invalid distance too far back",S.mode=hr;break e}if(_>>>=v,d-=v,v=o-a,A>v){if(v=A-v,v>u&&S.sane){n.msg="invalid distance too far back",S.mode=hr;break e}if($=0,O=h,c===0){if($+=l-v,v<m){m-=v;do N[o++]=h[$++];while(--v);$=o-A,O=N}}else if(c<v){if($+=l+c-v,v-=c,v<m){m-=v;do N[o++]=h[$++];while(--v);if($=0,c<m){v=c,m-=v;do N[o++]=h[$++];while(--v);$=o-A,O=N}}}else if($+=c-v,v<m){m-=v;do N[o++]=h[$++];while(--v);$=o-A,O=N}for(;m>2;)N[o++]=O[$++],N[o++]=O[$++],N[o++]=O[$++],m-=3;m&&(N[o++]=O[$++],m>1&&(N[o++]=O[$++]))}else{$=o-A;do N[o++]=N[$++],N[o++]=N[$++],N[o++]=N[$++],m-=3;while(m>2);m&&(N[o++]=N[$++],m>1&&(N[o++]=N[$++]))}}else if(v&64){n.msg="invalid distance code",S.mode=hr;break e}else{p=w[(p&65535)+(_&(1<<v)-1)];continue n}break}}else if(v&64)if(v&32){S.mode=j_;break e}else{n.msg="invalid literal/length code",S.mode=hr;break e}else{p=g[(p&65535)+(_&(1<<v)-1)];continue t}break}}while(r<i&&o<s);m=d>>3,r-=m,d-=m<<3,_&=(1<<d)-1,n.next_in=r,n.next_out=o,n.avail_in=r<i?5+(i-r):5-(r-i),n.avail_out=o<s?257+(s-o):257-(o-s),S.hold=_,S.bits=d};const an=15,ga=852,ma=592,ba=0,ii=1,va=2,Z_=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),G_=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),H_=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Y_=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),X_=(t,n,e,r,i,o,a,s)=>{const f=s.bits;let l=0,u=0,c=0,h=0,_=0,d=0,g=0,w=0,k=0,b=0,p,v,m,A,$,O=null,F;const N=new Uint16Array(an+1),S=new Uint16Array(an+1);let M=null,y,C,Z;for(l=0;l<=an;l++)N[l]=0;for(u=0;u<r;u++)N[n[e+u]]++;for(_=f,h=an;h>=1&&N[h]===0;h--);if(_>h&&(_=h),h===0)return i[o++]=1<<24|64<<16|0,i[o++]=1<<24|64<<16|0,s.bits=1,0;for(c=1;c<h&&N[c]===0;c++);for(_<c&&(_=c),w=1,l=1;l<=an;l++)if(w<<=1,w-=N[l],w<0)return-1;if(w>0&&(t===ba||h!==1))return-1;for(S[1]=0,l=1;l<an;l++)S[l+1]=S[l]+N[l];for(u=0;u<r;u++)n[e+u]!==0&&(a[S[n[e+u]]++]=u);if(t===ba?(O=M=a,F=20):t===ii?(O=Z_,M=G_,F=257):(O=H_,M=Y_,F=0),b=0,u=0,l=c,$=o,d=_,g=0,m=-1,k=1<<_,A=k-1,t===ii&&k>ga||t===va&&k>ma)return 1;for(;;){y=l-g,a[u]+1<F?(C=0,Z=a[u]):a[u]>=F?(C=M[a[u]-F],Z=O[a[u]-F]):(C=32+64,Z=0),p=1<<l-g,v=1<<d,c=v;do v-=p,i[$+(b>>g)+v]=y<<24|C<<16|Z|0;while(v!==0);for(p=1<<l-1;b&p;)p>>=1;if(p!==0?(b&=p-1,b+=p):b=0,u++,--N[l]===0){if(l===h)break;l=n[e+a[u]]}if(l>_&&(b&A)!==m){for(g===0&&(g=_),$+=c,d=l-g,w=1<<d;d+g<h&&(w-=N[d+g],!(w<=0));)d++,w<<=1;if(k+=1<<d,t===ii&&k>ga||t===va&&k>ma)return 1;m=b&A,i[m]=_<<24|d<<16|$-o|0}}return b!==0&&(i[$+b]=l-g<<24|64<<16|0),s.bits=_,0};var Bn=X_;const q_=0,pl=1,gl=2,{Z_FINISH:wa,Z_BLOCK:J_,Z_TREES:dr,Z_OK:Xt,Z_STREAM_END:W_,Z_NEED_DICT:K_,Z_STREAM_ERROR:Xe,Z_DATA_ERROR:ml,Z_MEM_ERROR:bl,Z_BUF_ERROR:V_,Z_DEFLATED:ya}=rr,Gr=16180,$a=16181,ka=16182,Sa=16183,Ea=16184,Ma=16185,Aa=16186,Ra=16187,Pa=16188,La=16189,Tr=16190,pt=16191,oi=16192,Na=16193,ai=16194,Ca=16195,Oa=16196,Ia=16197,xa=16198,_r=16199,pr=16200,Ta=16201,Fa=16202,za=16203,Da=16204,Ba=16205,si=16206,ja=16207,Ua=16208,_e=16209,vl=16210,wl=16211,Q_=852,ep=592,tp=15,np=tp,Za=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function rp(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Qt=t=>{if(!t)return 1;const n=t.state;return!n||n.strm!==t||n.mode<Gr||n.mode>wl?1:0},yl=t=>{if(Qt(t))return Xe;const n=t.state;return t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=n.wrap&1),n.mode=Gr,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(Q_),n.distcode=n.distdyn=new Int32Array(ep),n.sane=1,n.back=-1,Xt},$l=t=>{if(Qt(t))return Xe;const n=t.state;return n.wsize=0,n.whave=0,n.wnext=0,yl(t)},kl=(t,n)=>{let e;if(Qt(t))return Xe;const r=t.state;return n<0?(e=0,n=-n):(e=(n>>4)+5,n<48&&(n&=15)),n&&(n<8||n>15)?Xe:(r.window!==null&&r.wbits!==n&&(r.window=null),r.wrap=e,r.wbits=n,$l(t))},Sl=(t,n)=>{if(!t)return Xe;const e=new rp;t.state=e,e.strm=t,e.window=null,e.mode=Gr;const r=kl(t,n);return r!==Xt&&(t.state=null),r},ip=t=>Sl(t,np);let Ga=!0,li,fi;const op=t=>{if(Ga){li=new Int32Array(512),fi=new Int32Array(32);let n=0;for(;n<144;)t.lens[n++]=8;for(;n<256;)t.lens[n++]=9;for(;n<280;)t.lens[n++]=7;for(;n<288;)t.lens[n++]=8;for(Bn(pl,t.lens,0,288,li,0,t.work,{bits:9}),n=0;n<32;)t.lens[n++]=5;Bn(gl,t.lens,0,32,fi,0,t.work,{bits:5}),Ga=!1}t.lencode=li,t.lenbits=9,t.distcode=fi,t.distbits=5},El=(t,n,e,r)=>{let i;const o=t.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(n.subarray(e-o.wsize,e),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>r&&(i=r),o.window.set(n.subarray(e-r,e-r+i),o.wnext),r-=i,r?(o.window.set(n.subarray(e-r,e),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0},ap=(t,n)=>{let e,r,i,o,a,s,f,l,u,c,h,_,d,g,w=0,k,b,p,v,m,A,$,O;const F=new Uint8Array(4);let N,S;const M=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Qt(t)||!t.output||!t.input&&t.avail_in!==0)return Xe;e=t.state,e.mode===pt&&(e.mode=oi),a=t.next_out,i=t.output,f=t.avail_out,o=t.next_in,r=t.input,s=t.avail_in,l=e.hold,u=e.bits,c=s,h=f,O=Xt;e:for(;;)switch(e.mode){case Gr:if(e.wrap===0){e.mode=oi;break}for(;u<16;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}if(e.wrap&2&&l===35615){e.wbits===0&&(e.wbits=15),e.check=0,F[0]=l&255,F[1]=l>>>8&255,e.check=ye(e.check,F,2,0),l=0,u=0,e.mode=$a;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",e.mode=_e;break}if((l&15)!==ya){t.msg="unknown compression method",e.mode=_e;break}if(l>>>=4,u-=4,$=(l&15)+8,e.wbits===0&&(e.wbits=$),$>15||$>e.wbits){t.msg="invalid window size",e.mode=_e;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=l&512?La:pt,l=0,u=0;break;case $a:for(;u<16;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}if(e.flags=l,(e.flags&255)!==ya){t.msg="unknown compression method",e.mode=_e;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=_e;break}e.head&&(e.head.text=l>>8&1),e.flags&512&&e.wrap&4&&(F[0]=l&255,F[1]=l>>>8&255,e.check=ye(e.check,F,2,0)),l=0,u=0,e.mode=ka;case ka:for(;u<32;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}e.head&&(e.head.time=l),e.flags&512&&e.wrap&4&&(F[0]=l&255,F[1]=l>>>8&255,F[2]=l>>>16&255,F[3]=l>>>24&255,e.check=ye(e.check,F,4,0)),l=0,u=0,e.mode=Sa;case Sa:for(;u<16;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}e.head&&(e.head.xflags=l&255,e.head.os=l>>8),e.flags&512&&e.wrap&4&&(F[0]=l&255,F[1]=l>>>8&255,e.check=ye(e.check,F,2,0)),l=0,u=0,e.mode=Ea;case Ea:if(e.flags&1024){for(;u<16;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}e.length=l,e.head&&(e.head.extra_len=l),e.flags&512&&e.wrap&4&&(F[0]=l&255,F[1]=l>>>8&255,e.check=ye(e.check,F,2,0)),l=0,u=0}else e.head&&(e.head.extra=null);e.mode=Ma;case Ma:if(e.flags&1024&&(_=e.length,_>s&&(_=s),_&&(e.head&&($=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(r.subarray(o,o+_),$)),e.flags&512&&e.wrap&4&&(e.check=ye(e.check,r,_,o)),s-=_,o+=_,e.length-=_),e.length))break e;e.length=0,e.mode=Aa;case Aa:if(e.flags&2048){if(s===0)break e;_=0;do $=r[o+_++],e.head&&$&&e.length<65536&&(e.head.name+=String.fromCharCode($));while($&&_<s);if(e.flags&512&&e.wrap&4&&(e.check=ye(e.check,r,_,o)),s-=_,o+=_,$)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Ra;case Ra:if(e.flags&4096){if(s===0)break e;_=0;do $=r[o+_++],e.head&&$&&e.length<65536&&(e.head.comment+=String.fromCharCode($));while($&&_<s);if(e.flags&512&&e.wrap&4&&(e.check=ye(e.check,r,_,o)),s-=_,o+=_,$)break e}else e.head&&(e.head.comment=null);e.mode=Pa;case Pa:if(e.flags&512){for(;u<16;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}if(e.wrap&4&&l!==(e.check&65535)){t.msg="header crc mismatch",e.mode=_e;break}l=0,u=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=pt;break;case La:for(;u<32;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}t.adler=e.check=Za(l),l=0,u=0,e.mode=Tr;case Tr:if(e.havedict===0)return t.next_out=a,t.avail_out=f,t.next_in=o,t.avail_in=s,e.hold=l,e.bits=u,K_;t.adler=e.check=1,e.mode=pt;case pt:if(n===J_||n===dr)break e;case oi:if(e.last){l>>>=u&7,u-=u&7,e.mode=si;break}for(;u<3;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}switch(e.last=l&1,l>>>=1,u-=1,l&3){case 0:e.mode=Na;break;case 1:if(op(e),e.mode=_r,n===dr){l>>>=2,u-=2;break e}break;case 2:e.mode=Oa;break;case 3:t.msg="invalid block type",e.mode=_e}l>>>=2,u-=2;break;case Na:for(l>>>=u&7,u-=u&7;u<32;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",e.mode=_e;break}if(e.length=l&65535,l=0,u=0,e.mode=ai,n===dr)break e;case ai:e.mode=Ca;case Ca:if(_=e.length,_){if(_>s&&(_=s),_>f&&(_=f),_===0)break e;i.set(r.subarray(o,o+_),a),s-=_,o+=_,f-=_,a+=_,e.length-=_;break}e.mode=pt;break;case Oa:for(;u<14;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}if(e.nlen=(l&31)+257,l>>>=5,u-=5,e.ndist=(l&31)+1,l>>>=5,u-=5,e.ncode=(l&15)+4,l>>>=4,u-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=_e;break}e.have=0,e.mode=Ia;case Ia:for(;e.have<e.ncode;){for(;u<3;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}e.lens[M[e.have++]]=l&7,l>>>=3,u-=3}for(;e.have<19;)e.lens[M[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,N={bits:e.lenbits},O=Bn(q_,e.lens,0,19,e.lencode,0,e.work,N),e.lenbits=N.bits,O){t.msg="invalid code lengths set",e.mode=_e;break}e.have=0,e.mode=xa;case xa:for(;e.have<e.nlen+e.ndist;){for(;w=e.lencode[l&(1<<e.lenbits)-1],k=w>>>24,b=w>>>16&255,p=w&65535,!(k<=u);){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}if(p<16)l>>>=k,u-=k,e.lens[e.have++]=p;else{if(p===16){for(S=k+2;u<S;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}if(l>>>=k,u-=k,e.have===0){t.msg="invalid bit length repeat",e.mode=_e;break}$=e.lens[e.have-1],_=3+(l&3),l>>>=2,u-=2}else if(p===17){for(S=k+3;u<S;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}l>>>=k,u-=k,$=0,_=3+(l&7),l>>>=3,u-=3}else{for(S=k+7;u<S;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}l>>>=k,u-=k,$=0,_=11+(l&127),l>>>=7,u-=7}if(e.have+_>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=_e;break}for(;_--;)e.lens[e.have++]=$}}if(e.mode===_e)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=_e;break}if(e.lenbits=9,N={bits:e.lenbits},O=Bn(pl,e.lens,0,e.nlen,e.lencode,0,e.work,N),e.lenbits=N.bits,O){t.msg="invalid literal/lengths set",e.mode=_e;break}if(e.distbits=6,e.distcode=e.distdyn,N={bits:e.distbits},O=Bn(gl,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,N),e.distbits=N.bits,O){t.msg="invalid distances set",e.mode=_e;break}if(e.mode=_r,n===dr)break e;case _r:e.mode=pr;case pr:if(s>=6&&f>=258){t.next_out=a,t.avail_out=f,t.next_in=o,t.avail_in=s,e.hold=l,e.bits=u,U_(t,h),a=t.next_out,i=t.output,f=t.avail_out,o=t.next_in,r=t.input,s=t.avail_in,l=e.hold,u=e.bits,e.mode===pt&&(e.back=-1);break}for(e.back=0;w=e.lencode[l&(1<<e.lenbits)-1],k=w>>>24,b=w>>>16&255,p=w&65535,!(k<=u);){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}if(b&&!(b&240)){for(v=k,m=b,A=p;w=e.lencode[A+((l&(1<<v+m)-1)>>v)],k=w>>>24,b=w>>>16&255,p=w&65535,!(v+k<=u);){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}l>>>=v,u-=v,e.back+=v}if(l>>>=k,u-=k,e.back+=k,e.length=p,b===0){e.mode=Ba;break}if(b&32){e.back=-1,e.mode=pt;break}if(b&64){t.msg="invalid literal/length code",e.mode=_e;break}e.extra=b&15,e.mode=Ta;case Ta:if(e.extra){for(S=e.extra;u<S;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}e.length+=l&(1<<e.extra)-1,l>>>=e.extra,u-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Fa;case Fa:for(;w=e.distcode[l&(1<<e.distbits)-1],k=w>>>24,b=w>>>16&255,p=w&65535,!(k<=u);){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}if(!(b&240)){for(v=k,m=b,A=p;w=e.distcode[A+((l&(1<<v+m)-1)>>v)],k=w>>>24,b=w>>>16&255,p=w&65535,!(v+k<=u);){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}l>>>=v,u-=v,e.back+=v}if(l>>>=k,u-=k,e.back+=k,b&64){t.msg="invalid distance code",e.mode=_e;break}e.offset=p,e.extra=b&15,e.mode=za;case za:if(e.extra){for(S=e.extra;u<S;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}e.offset+=l&(1<<e.extra)-1,l>>>=e.extra,u-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=_e;break}e.mode=Da;case Da:if(f===0)break e;if(_=h-f,e.offset>_){if(_=e.offset-_,_>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=_e;break}_>e.wnext?(_-=e.wnext,d=e.wsize-_):d=e.wnext-_,_>e.length&&(_=e.length),g=e.window}else g=i,d=a-e.offset,_=e.length;_>f&&(_=f),f-=_,e.length-=_;do i[a++]=g[d++];while(--_);e.length===0&&(e.mode=pr);break;case Ba:if(f===0)break e;i[a++]=e.length,f--,e.mode=pr;break;case si:if(e.wrap){for(;u<32;){if(s===0)break e;s--,l|=r[o++]<<u,u+=8}if(h-=f,t.total_out+=h,e.total+=h,e.wrap&4&&h&&(t.adler=e.check=e.flags?ye(e.check,i,h,a-h):Xn(e.check,i,h,a-h)),h=f,e.wrap&4&&(e.flags?l:Za(l))!==e.check){t.msg="incorrect data check",e.mode=_e;break}l=0,u=0}e.mode=ja;case ja:if(e.wrap&&e.flags){for(;u<32;){if(s===0)break e;s--,l+=r[o++]<<u,u+=8}if(e.wrap&4&&l!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=_e;break}l=0,u=0}e.mode=Ua;case Ua:O=W_;break e;case _e:O=ml;break e;case vl:return bl;case wl:default:return Xe}return t.next_out=a,t.avail_out=f,t.next_in=o,t.avail_in=s,e.hold=l,e.bits=u,(e.wsize||h!==t.avail_out&&e.mode<_e&&(e.mode<si||n!==wa))&&El(t,t.output,t.next_out,h-t.avail_out),c-=t.avail_in,h-=t.avail_out,t.total_in+=c,t.total_out+=h,e.total+=h,e.wrap&4&&h&&(t.adler=e.check=e.flags?ye(e.check,i,h,t.next_out-h):Xn(e.check,i,h,t.next_out-h)),t.data_type=e.bits+(e.last?64:0)+(e.mode===pt?128:0)+(e.mode===_r||e.mode===ai?256:0),(c===0&&h===0||n===wa)&&O===Xt&&(O=V_),O},sp=t=>{if(Qt(t))return Xe;let n=t.state;return n.window&&(n.window=null),t.state=null,Xt},lp=(t,n)=>{if(Qt(t))return Xe;const e=t.state;return e.wrap&2?(e.head=n,n.done=!1,Xt):Xe},fp=(t,n)=>{const e=n.length;let r,i,o;return Qt(t)||(r=t.state,r.wrap!==0&&r.mode!==Tr)?Xe:r.mode===Tr&&(i=1,i=Xn(i,n,e,0),i!==r.check)?ml:(o=El(t,n,e,e),o?(r.mode=vl,bl):(r.havedict=1,Xt))};var up=$l,cp=kl,hp=yl,dp=ip,_p=Sl,pp=ap,gp=sp,mp=lp,bp=fp,vp="pako inflate (from Nodeca project)",mt={inflateReset:up,inflateReset2:cp,inflateResetKeep:hp,inflateInit:dp,inflateInit2:_p,inflate:pp,inflateEnd:gp,inflateGetHeader:mp,inflateSetDictionary:bp,inflateInfo:vp};function wp(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var yp=wp;const Ml=Object.prototype.toString,{Z_NO_FLUSH:$p,Z_FINISH:kp,Z_OK:Wn,Z_STREAM_END:ui,Z_NEED_DICT:ci,Z_STREAM_ERROR:Sp,Z_DATA_ERROR:Ha,Z_MEM_ERROR:Ep}=rr;function or(t){this.options=Zr.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),n.windowBits>=0&&n.windowBits<16&&!(t&&t.windowBits)&&(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(n.windowBits&15||(n.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dl,this.strm.avail_out=0;let e=mt.inflateInit2(this.strm,n.windowBits);if(e!==Wn)throw new Error(gn[e]);if(this.header=new yp,mt.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=Jn.string2buf(n.dictionary):Ml.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(e=mt.inflateSetDictionary(this.strm,n.dictionary),e!==Wn)))throw new Error(gn[e])}or.prototype.push=function(t,n){const e=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let o,a,s;if(this.ended)return!1;for(n===~~n?a=n:a=n===!0?kp:$p,Ml.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),o=mt.inflate(e,a),o===ci&&i&&(o=mt.inflateSetDictionary(e,i),o===Wn?o=mt.inflate(e,a):o===Ha&&(o=ci));e.avail_in>0&&o===ui&&e.state.wrap>0&&t[e.next_in]!==0;)mt.inflateReset(e),o=mt.inflate(e,a);switch(o){case Sp:case Ha:case ci:case Ep:return this.onEnd(o),this.ended=!0,!1}if(s=e.avail_out,e.next_out&&(e.avail_out===0||o===ui))if(this.options.to==="string"){let f=Jn.utf8border(e.output,e.next_out),l=e.next_out-f,u=Jn.buf2string(e.output,f);e.next_out=l,e.avail_out=r-l,l&&e.output.set(e.output.subarray(f,f+l),0),this.onData(u)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(o===Wn&&s===0)){if(o===ui)return o=mt.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};or.prototype.onData=function(t){this.chunks.push(t)};or.prototype.onEnd=function(t){t===Wn&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Zr.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function ro(t,n){const e=new or(n);if(e.push(t),e.err)throw e.msg||gn[e.err];return e.result}function Mp(t,n){return n=n||{},n.raw=!0,ro(t,n)}var Ap=or,Rp=ro,Pp=Mp,Lp=ro,Np=rr,Cp={Inflate:Ap,inflate:Rp,inflateRaw:Pp,ungzip:Lp,constants:Np};const{Inflate:Jm,inflate:Op,inflateRaw:Wm,ungzip:Km}=Cp;var Ip=Op;function xp(t){let n,e;return n=new tr({props:{errorMessage:"Failed to load route snapper"}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Tp(t){let n,e,r;return{c(){n=D("label"),n.textContent="Route data unpacking",e=z(),r=D("progress"),U(n,"for","route-unpacking"),U(r,"id","route-unpacking"),U(r,"class","svelte-q3473n")},m(i,o){P(i,n,o),P(i,e,o),P(i,r,o)},p:W,i:W,o:W,d(i){i&&(L(n),L(e),L(r))}}}function Fp(t){let n,e,r;return{c(){n=D("label"),n.textContent="Route tool loading",e=z(),r=D("progress"),U(n,"for","route-loading"),U(r,"id","route-loading"),r.value=t[0],U(r,"class","svelte-q3473n")},m(i,o){P(i,n,o),P(i,e,o),P(i,r,o)},p(i,o){o&1&&(r.value=i[0])},i:W,o:W,d(i){i&&(L(n),L(e),L(r))}}}function zp(t){let n,e,r,i;const o=[Fp,Tp,xp],a=[];function s(f,l){return!f[1]&&!f[2]&&!f[3]?0:f[3]&&!f[1]&&!f[2]?1:f[2]?2:-1}return~(n=s(t))&&(e=a[n]=o[n](t)),{c(){e&&e.c(),r=Le()},m(f,l){~n&&a[n].m(f,l),P(f,r,l),i=!0},p(f,[l]){let u=n;n=s(f),n===u?~n&&a[n].p(f,l):(e&&(ae(),R(a[u],1,1,()=>{a[u]=null}),se()),~n?(e=a[n],e?e.p(f,l):(e=a[n]=o[n](f),e.c()),E(e,1),e.m(r.parentNode,r)):e=null)},i(f){i||(E(e),i=!0)},o(f){R(e),i=!1},d(f){f&&L(r),~n&&a[n].d(f)}}}function Dp(t,n,e){let r,{map:i}=n,{url:o}=n,a=0,s=!1,f=!1;vt(async()=>{await $s(),console.log(`Grabbing ${o}`);try{const u=await Ou(o,c=>{e(0,a=c)});Jt.set(l(u)),e(0,a=100),e(1,s=!0)}catch(u){console.log(`Route tool broke: ${u}`),e(2,f=!0)}});function l(u){try{return new Lo(i,u,We(it()),We(!0),We(0))}catch(c){console.log(`Failed to set the route snapper up (${c}). Trying to decompress first.`);let h=Ip(u);return console.log("Decompression worked, trying to set up the route snapper again"),new Lo(i,h,We(it()),We(!0),We(0))}}return t.$$set=u=>{"map"in u&&e(4,i=u.map),"url"in u&&e(5,o=u.url)},t.$$.update=()=>{t.$$.dirty&1&&e(3,r=a>=100)},[a,s,f,r,i,o]}class Bp extends ce{constructor(n){super(),he(this,n,Dp,zp,fe,{map:4,url:5})}}var jp=Object.defineProperty,Ft=(t,n)=>jp(t,"name",{value:n,configurable:!0});function vn(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}Ft(vn,"getCoord");function Al(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}Ft(Al,"getCoords");function Rl(t){if(t.length>1&&so(t[0])&&so(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Rl(t[0]);throw new Error("coordinates must only contain numbers")}Ft(Rl,"containsNumber");function Up(t,n,e){if(!n||!e)throw new Error("type and name required");if(!t||t.type!==n)throw new Error("Invalid input to "+e+": must be a "+n+", given "+t.type)}Ft(Up,"geojsonType");function Zp(t,n,e){if(!t)throw new Error("No feature passed");if(!e)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+e+", Feature with geometry required");if(!t.geometry||t.geometry.type!==n)throw new Error("Invalid input to "+e+": must be a "+n+", given "+t.geometry.type)}Ft(Zp,"featureOf");function Gp(t,n,e){if(!t)throw new Error("No featureCollection passed");if(!e)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+e+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+e+", Feature with geometry required");if(!r.geometry||r.geometry.type!==n)throw new Error("Invalid input to "+e+": must be a "+n+", given "+r.geometry.type)}}Ft(Gp,"collectionOf");function Hp(t){return t.type==="Feature"?t.geometry:t}Ft(Hp,"getGeom");function Yp(t,n){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}Ft(Yp,"getType");var Xp=Object.defineProperty,Pl=(t,n)=>Xp(t,"name",{value:n,configurable:!0});function io(t,n,e={}){if(e.final===!0)return Ll(t,n);const r=vn(t),i=vn(n),o=nt(r[0]),a=nt(i[0]),s=nt(r[1]),f=nt(i[1]),l=Math.sin(a-o)*Math.cos(f),u=Math.cos(s)*Math.sin(f)-Math.sin(s)*Math.cos(f)*Math.cos(a-o);return di(Math.atan2(l,u))}Pl(io,"bearing");function Ll(t,n){let e=io(n,t);return e=(e+180)%360,e}Pl(Ll,"calculateFinalBearing");var qp=Object.defineProperty,Jp=(t,n)=>qp(t,"name",{value:n,configurable:!0});function fn(t,n,e={}){var r=vn(t),i=vn(n),o=nt(i[1]-r[1]),a=nt(i[0]-r[0]),s=nt(r[1]),f=nt(i[1]),l=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(f);return Vl(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),e.units)}Jp(fn,"distance");var Wp=Object.defineProperty,Kp=(t,n)=>Wp(t,"name",{value:n,configurable:!0});function Di(t,n,e,r={}){const i=vn(t),o=nt(i[0]),a=nt(i[1]),s=nt(e),f=Ql(n,r.units),l=Math.asin(Math.sin(a)*Math.cos(f)+Math.cos(a)*Math.sin(f)*Math.cos(s)),u=o+Math.atan2(Math.sin(s)*Math.sin(f)*Math.cos(a),Math.cos(f)-Math.sin(a)*Math.sin(l)),c=di(u),h=di(l);return Ke([c,h],r.properties)}Kp(Di,"destination");class Nl{constructor(n=[],e=Vp){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:r}=this,i=e[n];for(;n>0;){const o=n-1>>1,a=e[o];if(r(i,a)>=0)break;e[n]=a,n=o}e[n]=i}_down(n){const{data:e,compare:r}=this,i=this.length>>1,o=e[n];for(;n<i;){let a=(n<<1)+1,s=e[a];const f=a+1;if(f<this.length&&r(e[f],s)<0&&(a=f,s=e[f]),r(s,o)>=0)break;e[n]=s,n=a}e[n]=o}}function Vp(t,n){return t<n?-1:t>n?1:0}function Cl(t,n){return t.p.x>n.p.x?1:t.p.x<n.p.x?-1:t.p.y!==n.p.y?t.p.y>n.p.y?1:-1:1}function Qp(t,n){return t.rightSweepEvent.p.x>n.rightSweepEvent.p.x?1:t.rightSweepEvent.p.x<n.rightSweepEvent.p.x?-1:t.rightSweepEvent.p.y!==n.rightSweepEvent.p.y?t.rightSweepEvent.p.y<n.rightSweepEvent.p.y?1:-1:1}class Ya{constructor(n,e,r,i){this.p={x:n[0],y:n[1]},this.featureId=e,this.ringId=r,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(n){return this.p.x===n.p.x&&this.p.y===n.p.y}}function eg(t,n){if(t.type==="FeatureCollection"){const e=t.features;for(let r=0;r<e.length;r++)Xa(e[r],n)}else Xa(t,n)}let gr=0,mr=0,br=0;function Xa(t,n){const e=t.type==="Feature"?t.geometry:t;let r=e.coordinates;(e.type==="Polygon"||e.type==="MultiLineString")&&(r=[r]),e.type==="LineString"&&(r=[[r]]);for(let i=0;i<r.length;i++)for(let o=0;o<r[i].length;o++){let a=r[i][o][0],s=null;mr=mr+1;for(let f=0;f<r[i][o].length-1;f++){s=r[i][o][f+1];const l=new Ya(a,gr,mr,br),u=new Ya(s,gr,mr,br+1);l.otherEvent=u,u.otherEvent=l,Cl(l,u)>0?(u.isLeftEndpoint=!0,l.isLeftEndpoint=!1):(l.isLeftEndpoint=!0,u.isLeftEndpoint=!1),n.push(l),n.push(u),a=s,br=br+1}}gr=gr+1}class tg{constructor(n){this.leftSweepEvent=n,this.rightSweepEvent=n.otherEvent}}function ng(t,n){if(t===null||n===null||t.leftSweepEvent.ringId===n.leftSweepEvent.ringId&&(t.rightSweepEvent.isSamePoint(n.leftSweepEvent)||t.rightSweepEvent.isSamePoint(n.leftSweepEvent)||t.rightSweepEvent.isSamePoint(n.rightSweepEvent)||t.leftSweepEvent.isSamePoint(n.leftSweepEvent)||t.leftSweepEvent.isSamePoint(n.rightSweepEvent)))return!1;const e=t.leftSweepEvent.p.x,r=t.leftSweepEvent.p.y,i=t.rightSweepEvent.p.x,o=t.rightSweepEvent.p.y,a=n.leftSweepEvent.p.x,s=n.leftSweepEvent.p.y,f=n.rightSweepEvent.p.x,l=n.rightSweepEvent.p.y,u=(l-s)*(i-e)-(f-a)*(o-r),c=(f-a)*(r-s)-(l-s)*(e-a),h=(i-e)*(r-s)-(o-r)*(e-a);if(u===0)return!1;const _=c/u,d=h/u;if(_>=0&&_<=1&&d>=0&&d<=1){const g=e+_*(i-e),w=r+_*(o-r);return[g,w]}return!1}function rg(t,n){n=n||!1;const e=[],r=new Nl([],Qp);for(;t.length;){const i=t.pop();if(i.isLeftEndpoint){const o=new tg(i);for(let a=0;a<r.data.length;a++){const s=r.data[a];if(n&&s.leftSweepEvent.featureId===i.featureId)continue;const f=ng(o,s);f!==!1&&e.push(f)}r.push(o)}else i.isLeftEndpoint===!1&&r.pop()}return e}function ig(t,n){const e=new Nl([],Cl);return eg(t,e),rg(e,n)}var og=Object.defineProperty,ag=(t,n)=>og(t,"name",{value:n,configurable:!0}),sg=ig;function Ol(t,n,e={}){const{removeDuplicates:r=!0,ignoreSelfIntersections:i=!1}=e;let o=[];t.type==="FeatureCollection"?o=o.concat(t.features):t.type==="Feature"?o.push(t):(t.type==="LineString"||t.type==="Polygon"||t.type==="MultiLineString"||t.type==="MultiPolygon")&&o.push(Ar(t)),n.type==="FeatureCollection"?o=o.concat(n.features):n.type==="Feature"?o.push(n):(n.type==="LineString"||n.type==="Polygon"||n.type==="MultiLineString"||n.type==="MultiPolygon")&&o.push(Ar(n));const a=sg(lo(o),i);let s=[];if(r){const f={};a.forEach(l=>{const u=l.join(",");f[u]||(f[u]=!0,s.push(l))})}else s=a;return lo(s.map(f=>Ke(f)))}ag(Ol,"lineIntersect");var lg=Object.defineProperty,Ae=(t,n)=>lg(t,"name",{value:n,configurable:!0});function ar(t,n,e){if(t!==null)for(var r,i,o,a,s,f,l,u=0,c=0,h,_=t.type,d=_==="FeatureCollection",g=_==="Feature",w=d?t.features.length:1,k=0;k<w;k++){l=d?t.features[k].geometry:g?t.geometry:t,h=l?l.type==="GeometryCollection":!1,s=h?l.geometries.length:1;for(var b=0;b<s;b++){var p=0,v=0;if(a=h?l.geometries[b]:l,a!==null){f=a.coordinates;var m=a.type;switch(u=e&&(m==="Polygon"||m==="MultiPolygon")?1:0,m){case null:break;case"Point":if(n(f,c,k,p,v)===!1)return!1;c++,p++;break;case"LineString":case"MultiPoint":for(r=0;r<f.length;r++){if(n(f[r],c,k,p,v)===!1)return!1;c++,m==="MultiPoint"&&p++}m==="LineString"&&p++;break;case"Polygon":case"MultiLineString":for(r=0;r<f.length;r++){for(i=0;i<f[r].length-u;i++){if(n(f[r][i],c,k,p,v)===!1)return!1;c++}m==="MultiLineString"&&p++,m==="Polygon"&&v++}m==="Polygon"&&p++;break;case"MultiPolygon":for(r=0;r<f.length;r++){for(v=0,i=0;i<f[r].length;i++){for(o=0;o<f[r][i].length-u;o++){if(n(f[r][i][o],c,k,p,v)===!1)return!1;c++}v++}p++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(ar(a.geometries[r],n,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}Ae(ar,"coordEach");function fg(t,n,e,r){var i=e;return ar(t,function(o,a,s,f,l){a===0&&e===void 0?i=o:i=n(i,o,a,s,f,l)},r),i}Ae(fg,"coordReduce");function Il(t,n){var e;switch(t.type){case"FeatureCollection":for(e=0;e<t.features.length&&n(t.features[e].properties,e)!==!1;e++);break;case"Feature":n(t.properties,0);break}}Ae(Il,"propEach");function ug(t,n,e){var r=e;return Il(t,function(i,o){o===0&&e===void 0?r=i:r=n(r,i,o)}),r}Ae(ug,"propReduce");function xl(t,n){if(t.type==="Feature")n(t,0);else if(t.type==="FeatureCollection")for(var e=0;e<t.features.length&&n(t.features[e],e)!==!1;e++);}Ae(xl,"featureEach");function cg(t,n,e){var r=e;return xl(t,function(i,o){o===0&&e===void 0?r=i:r=n(r,i,o)}),r}Ae(cg,"featureReduce");function hg(t){var n=[];return ar(t,function(e){n.push(e)}),n}Ae(hg,"coordAll");function oo(t,n){var e,r,i,o,a,s,f,l,u,c,h=0,_=t.type==="FeatureCollection",d=t.type==="Feature",g=_?t.features.length:1;for(e=0;e<g;e++){for(s=_?t.features[e].geometry:d?t.geometry:t,l=_?t.features[e].properties:d?t.properties:{},u=_?t.features[e].bbox:d?t.bbox:void 0,c=_?t.features[e].id:d?t.id:void 0,f=s?s.type==="GeometryCollection":!1,a=f?s.geometries.length:1,i=0;i<a;i++){if(o=f?s.geometries[i]:s,o===null){if(n(null,h,l,u,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(o,h,l,u,c)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(n(o.geometries[r],h,l,u,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}Ae(oo,"geomEach");function dg(t,n,e){var r=e;return oo(t,function(i,o,a,s,f){o===0&&e===void 0?r=i:r=n(r,i,o,a,s,f)}),r}Ae(dg,"geomReduce");function sr(t,n){oo(t,function(e,r,i,o,a){var s=e===null?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return n(Ar(e,i,{bbox:o,id:a}),r,0)===!1?!1:void 0}var f;switch(s){case"MultiPoint":f="Point";break;case"MultiLineString":f="LineString";break;case"MultiPolygon":f="Polygon";break}for(var l=0;l<e.coordinates.length;l++){var u=e.coordinates[l],c={type:f,coordinates:u};if(n(Ar(c,i),r,l)===!1)return!1}})}Ae(sr,"flattenEach");function _g(t,n,e){var r=e;return sr(t,function(i,o,a){o===0&&a===0&&e===void 0?r=i:r=n(r,i,o,a)}),r}Ae(_g,"flattenReduce");function Tl(t,n){sr(t,function(e,r,i){var o=0;if(e.geometry){var a=e.geometry.type;if(!(a==="Point"||a==="MultiPoint")){var s,f=0,l=0,u=0;if(ar(e,function(c,h,_,d,g){if(s===void 0||r>f||d>l||g>u){s=c,f=r,l=d,u=g,o=0;return}var w=St([s,c],e.properties);if(n(w,r,i,g,o)===!1)return!1;o++,s=c})===!1)return!1}}})}Ae(Tl,"segmentEach");function pg(t,n,e){var r=e,i=!1;return Tl(t,function(o,a,s,f,l){i===!1&&e===void 0?r=o:r=n(r,o,a,s,f,l),i=!0}),r}Ae(pg,"segmentReduce");function Fl(t,n){if(!t)throw new Error("geojson is required");sr(t,function(e,r,i){if(e.geometry!==null){var o=e.geometry.type,a=e.geometry.coordinates;switch(o){case"LineString":if(n(e,r,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(n(St(a[s],e.properties),r,i,s)===!1)return!1;break}}})}Ae(Fl,"lineEach");function gg(t,n,e){var r=e;return Fl(t,function(i,o,a,s){o===0&&e===void 0?r=i:r=n(r,i,o,a,s)}),r}Ae(gg,"lineReduce");function mg(t,n){if(n=n||{},!ds(n))throw new Error("options is invalid");var e=n.featureIndex||0,r=n.multiFeatureIndex||0,i=n.geometryIndex||0,o=n.segmentIndex||0,a=n.properties,s;switch(t.type){case"FeatureCollection":e<0&&(e=t.features.length+e),a=a||t.features[e].properties,s=t.features[e].geometry;break;case"Feature":a=a||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var f=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=f.length+o-1),St([f[o],f[o+1]],a,n);case"Polygon":return i<0&&(i=f.length+i),o<0&&(o=f[i].length+o-1),St([f[i][o],f[i][o+1]],a,n);case"MultiLineString":return r<0&&(r=f.length+r),o<0&&(o=f[r].length+o-1),St([f[r][o],f[r][o+1]],a,n);case"MultiPolygon":return r<0&&(r=f.length+r),i<0&&(i=f[r].length+i),o<0&&(o=f[r][i].length-o-1),St([f[r][i][o],f[r][i][o+1]],a,n)}throw new Error("geojson is invalid")}Ae(mg,"findSegment");function bg(t,n){if(n=n||{},!ds(n))throw new Error("options is invalid");var e=n.featureIndex||0,r=n.multiFeatureIndex||0,i=n.geometryIndex||0,o=n.coordIndex||0,a=n.properties,s;switch(t.type){case"FeatureCollection":e<0&&(e=t.features.length+e),a=a||t.features[e].properties,s=t.features[e].geometry;break;case"Feature":a=a||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var f=s.coordinates;switch(s.type){case"Point":return Ke(f,a,n);case"MultiPoint":return r<0&&(r=f.length+r),Ke(f[r],a,n);case"LineString":return o<0&&(o=f.length+o),Ke(f[o],a,n);case"Polygon":return i<0&&(i=f.length+i),o<0&&(o=f[i].length+o),Ke(f[i][o],a,n);case"MultiLineString":return r<0&&(r=f.length+r),o<0&&(o=f[r].length+o),Ke(f[r][o],a,n);case"MultiPolygon":return r<0&&(r=f.length+r),i<0&&(i=f[r].length+i),o<0&&(o=f[r][i].length-o),Ke(f[r][i][o],a,n)}throw new Error("geojson is invalid")}Ae(bg,"findPoint");var zl=Object.defineProperty,vg=Object.defineProperties,wg=Object.getOwnPropertyDescriptors,qa=Object.getOwnPropertySymbols,yg=Object.prototype.hasOwnProperty,$g=Object.prototype.propertyIsEnumerable,Ja=(t,n,e)=>n in t?zl(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,zt=(t,n)=>{for(var e in n||(n={}))yg.call(n,e)&&Ja(t,e,n[e]);if(qa)for(var e of qa(n))$g.call(n,e)&&Ja(t,e,n[e]);return t},Dt=(t,n)=>vg(t,wg(n)),kg=(t,n)=>zl(t,"name",{value:n,configurable:!0});function Dl(t,n,e={}){if(!t||!n)throw new Error("lines and pt are required arguments");let r=Ke([1/0,1/0],{dist:1/0,index:-1,location:-1}),i=0;return sr(t,function(o){const a=Al(o);for(let s=0;s<a.length-1;s++){const f=Ke(a[s]);f.properties.dist=fn(n,f,e);const l=Ke(a[s+1]);l.properties.dist=fn(n,l,e);const u=fn(f,l,e),c=Math.max(f.properties.dist,l.properties.dist),h=io(f,l),_=Di(n,c,h+90,e),d=Di(n,c,h-90,e),g=Ol(St([_.geometry.coordinates,d.geometry.coordinates]),St([f.geometry.coordinates,l.geometry.coordinates]));let w;g.features.length>0&&g.features[0]&&(w=Dt(zt({},g.features[0]),{properties:{dist:fn(n,g.features[0],e),location:i+fn(f,g.features[0],e)}})),f.properties.dist<r.properties.dist&&(r=Dt(zt({},f),{properties:Dt(zt({},f.properties),{index:s,location:i})})),l.properties.dist<r.properties.dist&&(r=Dt(zt({},l),{properties:Dt(zt({},l.properties),{index:s+1,location:i+u})})),w&&w.properties.dist<r.properties.dist&&(r=Dt(zt({},w),{properties:Dt(zt({},w.properties),{index:s})})),i+=u}}),r}kg(Dl,"nearestPointOnLine");var Sg=Dl;function Eg(t){let n,e;const r=[ge(t[0],"draw-split-route"),{paint:{"circle-color":"black","circle-radius":Wa}}];let i={};for(let o=0;o<r.length;o+=1)i=Ve(i,r[o]);return n=new Rr({props:i}),{c(){I(n.$$.fragment)},m(o,a){x(n,o,a),e=!0},p(o,a){const s=a&1?Qe(r,[a&1&&et(ge(o[0],"draw-split-route")),a&0&&{paint:{"circle-color":"black","circle-radius":Wa}}]):{};n.$set(s)},i(o){e||(E(n.$$.fragment,o),e=!0)},o(o){R(n.$$.fragment,o),e=!1},d(o){T(n,o)}}}function Mg(t){let n;return{c(){n=q("Finish")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function Ag(t){let n;return{c(){n=D("ul"),n.innerHTML=`<li><b>Click</b>
          on a route to split it</li> <li><b>Click</b>
          on the map or press
          <b>Escape</b>
          to cancel</li>`},m(e,r){P(e,n,r)},p:W,d(e){e&&L(n)}}}function Rg(t){let n,e,r,i;return n=new wt({props:{style:"margin-bottom: 0px",$$slots:{default:[Mg]},$$scope:{ctx:t}}}),n.$on("click",t[7]),r=new wn({props:{$$slots:{default:[Ag]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment)},m(o,a){x(n,o,a),P(o,e,a),x(r,o,a),i=!0},p(o,a){const s={};a&4096&&(s.$$scope={dirty:a,ctx:o}),n.$set(s);const f={};a&4096&&(f.$$scope={dirty:a,ctx:o}),r.$set(f)},i(o){i||(E(n.$$.fragment,o),E(r.$$.fragment,o),i=!0)},o(o){R(n.$$.fragment,o),R(r.$$.fragment,o),i=!1},d(o){o&&L(e),T(n,o),T(r,o)}}}function Pg(t){let n,e,r,i,o,a,s,f,l;return n=new Dr({}),n.$on("mousemove",t[3]),n.$on("click",t[4]),r=new It({props:{data:t[2],$$slots:{default:[Eg]},$$scope:{ctx:t}}}),a=new yn({props:{$$slots:{default:[Rg]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment),i=z(),o=D("div"),I(a.$$.fragment),re(o,"float","right")},m(u,c){x(n,u,c),P(u,e,c),x(r,u,c),P(u,i,c),P(u,o,c),x(a,o,null),s=!0,f||(l=ke(window,"keydown",t[5]),f=!0)},p(u,[c]){const h={};c&4&&(h.data=u[2]),c&4097&&(h.$$scope={dirty:c,ctx:u}),r.$set(h);const _={};c&4096&&(_.$$scope={dirty:c,ctx:u}),a.$set(_)},i(u){s||(E(n.$$.fragment,u),E(r.$$.fragment,u),E(a.$$.fragment,u),s=!0)},o(u){R(n.$$.fragment,u),R(r.$$.fragment,u),R(a.$$.fragment,u),s=!1},d(u){u&&(L(e),L(i),L(o)),T(n,u),T(r,u),T(a),f=!1,l()}}}const Wa=10,Lg=30;function Ng(t,n,e){let r,i=W,o=()=>(i(),i=qt(f,k=>e(9,r=k)),f),a;X(t,Ze,k=>e(10,a=k)),t.$$.on_destroy.push(()=>i());let{cfg:s}=n,{gjSchemes:f}=n;o(),vt(()=>{a&&(a.getCanvas().style.cursor=`url(${Us}), crosshair`)}),qe(()=>{a&&(a.getCanvas().style.cursor="inherit")});let l=null,u=null,c=it();function h(k){if(!a)return;e(6,l=null),u=null;let b=g(k.detail.lngLat.toArray());const p=[k.detail.point.x-Lg,k.detail.point.y],v=a.unproject(k.detail.point).distanceTo(a.unproject(p))/1e3;let m=[];for(let[A,$]of r.features.entries())if($.geometry.type=="LineString"){let O=Sg($.geometry,b,{units:"kilometers"});O.properties.dist!=null&&O.properties.dist<=v&&m.push([A,O.geometry.coordinates,O.properties.dist])}m.sort((A,$)=>A[2]-$[2]),m.length>0&&(e(6,l=g(m[0][1])),u=m[0][0])}function _(){if(u==null){de.set({mode:"list"});return}let k=Lu(r.features[u],l);if(k!=null){let[b,p]=k;f.update(v=>(b.id=v.features[u].id,p.id=zr(v),v.features.splice(u,1,b,p),v))}e(6,l=null),u=null}function d(k){k.key=="Escape"&&(k.stopPropagation(),de.set({mode:"list"}))}function g(k){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:ji(k)}}}const w=()=>de.set({mode:"list"});return t.$$set=k=>{"cfg"in k&&e(0,s=k.cfg),"gjSchemes"in k&&o(e(1,f=k.gjSchemes))},t.$$.update=()=>{if(t.$$.dirty&64){let k=it();l&&k.features.push(l),e(2,c=k)}},[s,f,c,h,_,d,l,w]}class Cg extends ce{constructor(n){super(),he(this,n,Ng,Pg,fe,{cfg:0,gjSchemes:1})}}function Og(t){let n,e,r,i,o;const a=t[4].default,s=Kn(a,t,t[3],null);return{c(){n=D("button"),s&&s.c(),U(n,"type","button"),U(n,"class","govuk-button govuk-button--secondary svelte-qdk410"),U(n,"data-module","govuk-button"),n.disabled=e=t[1]||t[2].mode!="list",$e(n,"focused",t[2].mode==t[0].mode),re(n,"margin-bottom",t[2].mode=="list"?"0px":"8px")},m(f,l){P(f,n,l),s&&s.m(n,null),r=!0,i||(o=ke(n,"click",t[5]),i=!0)},p(f,[l]){s&&s.p&&(!r||l&8)&&Vn(s,a,f,f[3],r?er(a,f[3],l,null):Qn(f[3]),null),(!r||l&6&&e!==(e=f[1]||f[2].mode!="list"))&&(n.disabled=e),(!r||l&5)&&$e(n,"focused",f[2].mode==f[0].mode),l&4&&re(n,"margin-bottom",f[2].mode=="list"?"0px":"8px")},i(f){r||(E(s,f),r=!0)},o(f){R(s,f),r=!1},d(f){f&&L(n),s&&s.d(f),i=!1,o()}}}function Ig(t,n,e){let r;X(t,de,l=>e(2,r=l));let{$$slots:i={},$$scope:o}=n,{setMode:a}=n,{disabled:s=!1}=n;const f=()=>de.set(a);return t.$$set=l=>{"setMode"in l&&e(0,a=l.setMode),"disabled"in l&&e(1,s=l.disabled),"$$scope"in l&&e(3,o=l.$$scope)},[a,s,r,o,i,f]}class sn extends ce{constructor(n){super(),he(this,n,Ig,Og,fe,{setMode:0,disabled:1})}}function Ka(t){let n,e;return n=new Bp({props:{map:t[5],url:t[2]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i&32&&(o.map=r[5]),i&4&&(o.url=r[2]),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function xg(t){let n,e,r;return{c(){n=D("img"),r=q(`
      New point`),Wt(n.src,e=Jc)||U(n,"src",e),U(n,"alt","New point")},m(i,o){P(i,n,o),P(i,r,o)},p:W,d(i){i&&(L(n),L(r))}}}function Tg(t){let n,e,r;return{c(){n=D("img"),r=q(`
      New route`),Wt(n.src,e=Wc)||U(n,"src",e),U(n,"alt","New route")},m(i,o){P(i,n,o),P(i,r,o)},p:W,d(i){i&&(L(n),L(r))}}}function Fg(t){let n,e,r;return{c(){n=D("img"),r=q(`
      New area`),Wt(n.src,e=Xc)||U(n,"src",e),U(n,"alt","New area")},m(i,o){P(i,n,o),P(i,r,o)},p:W,d(i){i&&(L(n),L(r))}}}function zg(t){let n,e,r;return{c(){n=D("img"),r=q(`
      Split route`),Wt(n.src,e=Us)||U(n,"src",e),U(n,"alt","Split route")},m(i,o){P(i,n,o),P(i,r,o)},p:W,d(i){i&&(L(n),L(r))}}}function Dg(t){let n,e,r;return{c(){n=D("img"),r=q(`
      Georeference image`),Wt(n.src,e=qc)||U(n,"src",e),U(n,"alt","Georeference image")},m(i,o){P(i,n,o),P(i,r,o)},p:W,d(i){i&&(L(n),L(r))}}}function Bg(t){let n,e,r;return{c(){n=D("img"),r=q(`
      StreetView`),Wt(n.src,e=Kc)||U(n,"src",e),U(n,"alt","StreetView")},m(i,o){P(i,n,o),P(i,r,o)},p:W,d(i){i&&(L(n),L(r))}}}function Va(t){let n;return{c(){n=D("div"),re(n,"height","1em")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function jg(t){let n,e;return n=new Yc({props:{cfg:t[0]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i&1&&(o.cfg=r[0]),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Ug(t){let n,e;return n=new ed({}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Zg(t){let n,e;return n=new Cg({props:{cfg:t[0],gjSchemes:t[1]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i&1&&(o.cfg=r[0]),i&2&&(o.gjSchemes=r[1]),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Gg(t){let n,e;return n=new gh({props:{cfg:t[0],gjSchemes:t[1]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i&1&&(o.cfg=r[0]),i&2&&(o.gjSchemes=r[1]),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Hg(t){let n,e;return n=new ad({props:{cfg:t[0],gjSchemes:t[1]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i&1&&(o.cfg=r[0]),i&2&&(o.gjSchemes=r[1]),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Yg(t){let n,e;return n=new rd({props:{cfg:t[0],gjSchemes:t[1]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i&1&&(o.cfg=r[0]),i&2&&(o.gjSchemes=r[1]),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Xg(t){let n,e;return n=new Yh({props:{cfg:t[0],gjSchemes:t[1],id:t[3].id}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i&1&&(o.cfg=r[0]),i&2&&(o.gjSchemes=r[1]),i&8&&(o.id=r[3].id),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function qg(t){let n,e,r,i,o,a,s,f,l,u,c,h,_,d,g,w,k,b,p,v,m,A,$,O;n=new wc({props:{cfg:t[0],gjSchemes:t[1]}});let F=t[5]&&Ka(t);s=new sn({props:{setMode:{mode:"new-point"},$$slots:{default:[xg]},$$scope:{ctx:t}}}),l=new sn({props:{setMode:{mode:"new-route"},disabled:!t[4],$$slots:{default:[Tg]},$$scope:{ctx:t}}}),c=new sn({props:{setMode:{mode:"new-area"},disabled:!t[4],$$slots:{default:[Fg]},$$scope:{ctx:t}}}),_=new sn({props:{setMode:{mode:"split-route"},$$slots:{default:[zg]},$$scope:{ctx:t}}}),g=new sn({props:{setMode:{mode:"set-image"},$$slots:{default:[Dg]},$$scope:{ctx:t}}}),k=new sn({props:{setMode:{mode:"streetview"},$$slots:{default:[Bg]},$$scope:{ctx:t}}});let N=t[3].mode!="list"&&Va();const S=[Xg,Yg,Hg,Gg,Zg,Ug,jg],M=[];function y(C,Z){return C[3].mode=="edit"?0:C[3].mode=="new-point"?1:C[3].mode=="new-route"?2:C[3].mode=="new-area"?3:C[3].mode=="split-route"?4:C[3].mode=="set-image"?5:C[3].mode=="streetview"?6:-1}return~(v=y(t))&&(m=M[v]=S[v](t)),{c(){I(n.$$.fragment),e=z(),r=D("div"),i=D("div"),F&&F.c(),o=z(),a=D("div"),I(s.$$.fragment),f=z(),I(l.$$.fragment),u=z(),I(c.$$.fragment),h=z(),I(_.$$.fragment),d=z(),I(g.$$.fragment),w=z(),I(k.$$.fragment),b=z(),N&&N.c(),p=z(),m&&m.c(),re(i,"visibility",t[3].mode=="list"?"visible":"hidden"),U(a,"class","toolbar svelte-ovanu5"),U(r,"class","top govuk-prose svelte-ovanu5")},m(C,Z){x(n,C,Z),P(C,e,Z),P(C,r,Z),B(r,i),F&&F.m(i,null),B(r,o),B(r,a),x(s,a,null),B(a,f),x(l,a,null),B(a,u),x(c,a,null),B(a,h),x(_,a,null),B(a,d),x(g,a,null),B(a,w),x(k,a,null),B(r,b),N&&N.m(r,null),B(r,p),~v&&M[v].m(r,null),A=!0,$||(O=ke(window,"keydown",t[6]),$=!0)},p(C,[Z]){const ie={};Z&1&&(ie.cfg=C[0]),Z&2&&(ie.gjSchemes=C[1]),n.$set(ie),C[5]?F?(F.p(C,Z),Z&32&&E(F,1)):(F=Ka(C),F.c(),E(F,1),F.m(i,null)):F&&(ae(),R(F,1,1,()=>{F=null}),se()),Z&8&&re(i,"visibility",C[3].mode=="list"?"visible":"hidden");const ue={};Z&128&&(ue.$$scope={dirty:Z,ctx:C}),s.$set(ue);const J={};Z&16&&(J.disabled=!C[4]),Z&128&&(J.$$scope={dirty:Z,ctx:C}),l.$set(J);const me={};Z&16&&(me.disabled=!C[4]),Z&128&&(me.$$scope={dirty:Z,ctx:C}),c.$set(me);const K={};Z&128&&(K.$$scope={dirty:Z,ctx:C}),_.$set(K);const be={};Z&128&&(be.$$scope={dirty:Z,ctx:C}),g.$set(be);const ve={};Z&128&&(ve.$$scope={dirty:Z,ctx:C}),k.$set(ve),C[3].mode!="list"?N||(N=Va(),N.c(),N.m(r,p)):N&&(N.d(1),N=null);let G=v;v=y(C),v===G?~v&&M[v].p(C,Z):(m&&(ae(),R(M[G],1,1,()=>{M[G]=null}),se()),~v?(m=M[v],m?m.p(C,Z):(m=M[v]=S[v](C),m.c()),E(m,1),m.m(r,null)):m=null)},i(C){A||(E(n.$$.fragment,C),E(F),E(s.$$.fragment,C),E(l.$$.fragment,C),E(c.$$.fragment,C),E(_.$$.fragment,C),E(g.$$.fragment,C),E(k.$$.fragment,C),E(m),A=!0)},o(C){R(n.$$.fragment,C),R(F),R(s.$$.fragment,C),R(l.$$.fragment,C),R(c.$$.fragment,C),R(_.$$.fragment,C),R(g.$$.fragment,C),R(k.$$.fragment,C),R(m),A=!1},d(C){C&&(L(e),L(r)),T(n,C),F&&F.d(),T(s),T(l),T(c),T(_),T(g),T(k),N&&N.d(),~v&&M[v].d(),$=!1,O()}}}function Jg(t,n,e){let r,i,o;X(t,de,u=>e(3,r=u)),X(t,Jt,u=>e(4,i=u)),X(t,Ze,u=>e(5,o=u));let{cfg:a}=n,{gjSchemes:s}=n,{routeSnapperUrl:f}=n;qe(()=>{i==null||i.tearDown()});function l(u){r.mode=="list"&&(u.key=="1"?le(de,r={mode:"new-point"},r):u.key=="2"&&i?le(de,r={mode:"new-route"},r):u.key=="3"&&i&&le(de,r={mode:"new-area"},r))}return t.$$set=u=>{"cfg"in u&&e(0,a=u.cfg),"gjSchemes"in u&&e(1,s=u.gjSchemes),"routeSnapperUrl"in u&&e(2,f=u.routeSnapperUrl)},[a,s,f,r,i,o,l]}class Wg extends ce{constructor(n){super(),he(this,n,Jg,qg,fe,{cfg:0,gjSchemes:1,routeSnapperUrl:2})}}function Kg(t){let n;return{c(){n=q("Finish")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function Vg(t){let n;return{c(){n=q("Cancel")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function Qg(t){let n;return{c(){n=q("Delete")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function em(t){let n,e,r=t[0].interventionName(t[6])+"",i,o,a,s,f,l,u,c,h,_,d,g,w,k,b,p;a=new wt({props:{$$slots:{default:[Kg]},$$scope:{ctx:t}}}),a.$on("click",t[8]),f=new Ue({props:{$$slots:{default:[Vg]},$$scope:{ctx:t}}}),f.$on("click",t[9]),u=new Br({props:{$$slots:{default:[Qg]},$$scope:{ctx:t}}}),u.$on("click",t[10]),h=new tr({props:{errorMessage:t[0].interventionWarning(t[3])}});function v($){t[11]($)}var m=t[0].editFeatureForm;function A($,O){let F={cfg:$[0],gjSchemes:$[1],id:$[2]};return $[3]!==void 0&&(F.props=$[3]),{props:F}}return m&&(d=hn(m,A(t)),we.push(()=>Se(d,"props",v))),{c(){n=D("h2"),e=q("Editing "),i=q(r),o=z(),I(a.$$.fragment),s=z(),I(f.$$.fragment),l=z(),I(u.$$.fragment),c=z(),I(h.$$.fragment),_=z(),d&&I(d.$$.fragment),w=Le()},m($,O){P($,n,O),B(n,e),B(n,i),P($,o,O),x(a,$,O),P($,s,O),x(f,$,O),P($,l,O),x(u,$,O),P($,c,O),x(h,$,O),P($,_,O),d&&x(d,$,O),P($,w,O),k=!0,b||(p=ke(window,"keydown",t[7]),b=!0)},p($,[O]){(!k||O&1)&&r!==(r=$[0].interventionName($[6])+"")&&je(i,r);const F={};O&8192&&(F.$$scope={dirty:O,ctx:$}),a.$set(F);const N={};O&8192&&(N.$$scope={dirty:O,ctx:$}),f.$set(N);const S={};O&8192&&(S.$$scope={dirty:O,ctx:$}),u.$set(S);const M={};if(O&9&&(M.errorMessage=$[0].interventionWarning($[3])),h.$set(M),O&1&&m!==(m=$[0].editFeatureForm)){if(d){ae();const y=d;R(y.$$.fragment,1,0,()=>{T(y,1)}),se()}m?(d=hn(m,A($)),we.push(()=>Se(d,"props",v)),I(d.$$.fragment),E(d.$$.fragment,1),x(d,w.parentNode,w)):d=null}else if(m){const y={};O&1&&(y.cfg=$[0]),O&2&&(y.gjSchemes=$[1]),O&4&&(y.id=$[2]),!g&&O&8&&(g=!0,y.props=$[3],Pe(()=>g=!1)),d.$set(y)}},i($){k||(E(a.$$.fragment,$),E(f.$$.fragment,$),E(u.$$.fragment,$),E(h.$$.fragment,$),d&&E(d.$$.fragment,$),k=!0)},o($){R(a.$$.fragment,$),R(f.$$.fragment,$),R(u.$$.fragment,$),R(h.$$.fragment,$),d&&R(d.$$.fragment,$),k=!1},d($){$&&(L(n),L(o),L(s),L(l),L(c),L(_),L(w)),T(a,$),T(f,$),T(u,$),T(h,$),d&&T(d,$),b=!1,p()}}}function tm(t,n,e){let r,i,o=W,a=()=>(o(),o=qt(u,b=>e(12,i=b)),u),s,f;X(t,tt,b=>e(3,r=b)),X(t,Ye,b=>e(4,s=b)),X(t,_t,b=>e(5,f=b)),t.$$.on_destroy.push(()=>o());let{cfg:l}=n,{gjSchemes:u}=n;a();let{id:c}=n,h=i.features.find(b=>b.id==c);le(tt,r=JSON.parse(JSON.stringify(h.properties)),r);function _(b){if(b.key=="Delete"){const p=b.target.tagName;if(p=="INPUT"||p=="TEXTAREA")return;b.stopPropagation(),fo(u,c)}}const d=()=>{s()},g=()=>{f()},w=()=>fo(u,c);function k(b){r=b,tt.set(r)}return t.$$set=b=>{"cfg"in b&&e(0,l=b.cfg),"gjSchemes"in b&&a(e(1,u=b.gjSchemes)),"id"in b&&e(2,c=b.id)},[l,u,c,r,s,f,h,_,d,g,w,k]}class nm extends ce{constructor(n){super(),he(this,n,tm,em,fe,{cfg:0,gjSchemes:1,id:2})}}const rm="/atip/update-IMD-source/assets/delete-3c023172.svg";function Qa(t,n,e){const r=t.slice();r[34]=n[e];const i=r[0].interventionWarning(r[34].properties);return r[35]=i,r}function im(t){let n,e=t[0].schemeName(t[3].schemes[t[2]])+"",r;return{c(){n=D("b"),r=q(e)},m(i,o){P(i,n,o),B(n,r)},p(i,o){o[0]&13&&e!==(e=i[0].schemeName(i[3].schemes[i[2]])+"")&&je(r,e)},d(i){i&&L(n)}}}function om(t){let n,e,r;function i(a){t[18](a)}let o={$$slots:{default:[im]},$$scope:{ctx:t}};return t[7]!==void 0&&(o.checked=t[7]),n=new df({props:o}),we.push(()=>Se(n,"checked",i)),n.$on("change",t[15]),{c(){I(n.$$.fragment)},m(a,s){x(n,a,s),r=!0},p(a,s){const f={};s[0]&13|s[1]&1&&(f.$$scope={dirty:s,ctx:a}),!e&&s[0]&128&&(e=!0,f.checked=a[7],Pe(()=>e=!1)),n.$set(f)},i(a){r||(E(n.$$.fragment,a),r=!0)},o(a){R(n.$$.fragment,a),r=!1},d(a){T(n,a)}}}function am(t){let n;return{c(){n=q("Edit")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function es(t){let n,e,r,i,o,a=[],s=new Map,f;const l=[lm,sm],u=[];function c(g,w){return g[9]==1?0:g[9]>0?1:-1}~(n=c(t))&&(e=u[n]=l[n](t));let h=t[8]==0&&ts(),_=Fe(t[3].features.filter(t[21]));const d=g=>g[34].id;for(let g=0;g<_.length;g+=1){let w=Qa(t,_,g),k=d(w);s.set(k,a[g]=rs(k,w))}return{c(){e&&e.c(),r=z(),h&&h.c(),i=z(),o=D("ol");for(let g=0;g<a.length;g+=1)a[g].c();U(o,"class","govuk-list govuk-list--number")},m(g,w){~n&&u[n].m(g,w),P(g,r,w),h&&h.m(g,w),P(g,i,w),P(g,o,w);for(let k=0;k<a.length;k+=1)a[k]&&a[k].m(o,null);f=!0},p(g,w){let k=n;n=c(g),n===k?~n&&u[n].p(g,w):(e&&(ae(),R(u[k],1,1,()=>{u[k]=null}),se()),~n?(e=u[n],e?e.p(g,w):(e=u[n]=l[n](g),e.c()),E(e,1),e.m(r.parentNode,r)):e=null),g[8]==0?h||(h=ts(),h.c(),h.m(i.parentNode,i)):h&&(h.d(1),h=null),w[0]&3085&&(_=Fe(g[3].features.filter(g[21])),ae(),a=gs(a,w,d,1,g,_,s,o,ms,rs,null,Qa),se())},i(g){if(!f){E(e);for(let w=0;w<_.length;w+=1)E(a[w]);f=!0}},o(g){R(e);for(let w=0;w<a.length;w+=1)R(a[w]);f=!1},d(g){g&&(L(r),L(i),L(o)),~n&&u[n].d(g),h&&h.d(g);for(let w=0;w<a.length;w+=1)a[w].d()}}}function sm(t){let n,e;return n=new tr({props:{errorMessage:"There's a problem with "+t[9]+" interventions below"}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i[0]&512&&(o.errorMessage="There's a problem with "+r[9]+" interventions below"),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function lm(t){let n,e;return n=new tr({props:{errorMessage:"There's a problem with one intervention below"}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function ts(t){let n;return{c(){n=D("p"),n.textContent="There are no interventions in this scheme"},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function ns(t){let n,e;return n=new vf({props:{text:t[35]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i[0]&13&&(o.text=r[35]),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function rs(t,n){let e,r,i,o=n[0].interventionName(n[34])+"",a,s,f,l,u,c=n[35]&&ns(n);function h(...g){return n[22](n[34],...g)}function _(){return n[23](n[34])}function d(){return n[24](n[34])}return{key:t,first:null,c(){e=D("li"),r=D("a"),c&&c.c(),i=z(),a=q(o),s=z(),U(r,"href","#"),this.first=e},m(g,w){P(g,e,w),B(e,r),c&&c.m(r,null),B(r,i),B(r,a),B(e,s),f=!0,l||(u=[ke(r,"click",h),ke(r,"mouseenter",_),ke(r,"mouseleave",d)],l=!0)},p(g,w){n=g,n[35]?c?(c.p(n,w),w[0]&13&&E(c,1)):(c=ns(n),c.c(),E(c,1),c.m(r,i)):c&&(ae(),R(c,1,1,()=>{c=null}),se()),(!f||w[0]&13)&&o!==(o=n[0].interventionName(n[34])+"")&&je(a,o)},i(g){f||(E(c),f=!0)},o(g){R(c),f=!1},d(g){g&&L(e),c&&c.d(),l=!1,Fr(u)}}}function is(t){let n,e,r;var i=t[0].editSchemeForm;function o(a,s){return{props:{gjSchemes:a[1],scheme_reference:a[2]}}}return i&&(n=hn(i,o(t))),{c(){n&&I(n.$$.fragment),e=Le()},m(a,s){n&&x(n,a,s),P(a,e,s),r=!0},p(a,s){if(s[0]&1&&i!==(i=a[0].editSchemeForm)){if(n){ae();const f=n;R(f.$$.fragment,1,0,()=>{T(f,1)}),se()}i?(n=hn(i,o(a)),I(n.$$.fragment),E(n.$$.fragment,1),x(n,e.parentNode,e)):n=null}else if(i){const f={};s[0]&2&&(f.gjSchemes=a[1]),s[0]&4&&(f.scheme_reference=a[2]),n.$set(f)}},i(a){r||(n&&E(n.$$.fragment,a),r=!0)},o(a){n&&R(n.$$.fragment,a),r=!1},d(a){a&&L(e),n&&T(n,a)}}}function fm(t){let n;return{c(){n=q("Save changes")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function um(t){let n,e,r;return{c(){n=D("img"),r=q(`
      Delete`),Wt(n.src,e=rm)||U(n,"src",e),U(n,"alt","Delete scheme")},m(i,o){P(i,n,o),P(i,r,o)},p:W,d(i){i&&(L(n),L(r))}}}function cm(t){let n,e,r,i;return n=new wt({props:{$$slots:{default:[fm]},$$scope:{ctx:t}}}),n.$on("click",t[25]),r=new Br({props:{$$slots:{default:[um]},$$scope:{ctx:t}}}),r.$on("click",t[26]),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment)},m(o,a){x(n,o,a),P(o,e,a),x(r,o,a),i=!0},p(o,a){const s={};a[1]&1&&(s.$$scope={dirty:a,ctx:o}),n.$set(s);const f={};a[1]&1&&(f.$$scope={dirty:a,ctx:o}),r.$set(f)},i(o){i||(E(n.$$.fragment,o),E(r.$$.fragment,o),i=!0)},o(o){R(n.$$.fragment,o),R(r.$$.fragment,o),i=!1},d(o){o&&L(e),T(n,o),T(r,o)}}}function hm(t){let n,e,r,i=t[4]&&is(t);return e=new bs({props:{$$slots:{default:[cm]},$$scope:{ctx:t}}}),{c(){i&&i.c(),n=z(),I(e.$$.fragment)},m(o,a){i&&i.m(o,a),P(o,n,a),x(e,o,a),r=!0},p(o,a){o[4]?i?(i.p(o,a),a[0]&16&&E(i,1)):(i=is(o),i.c(),E(i,1),i.m(n.parentNode,n)):i&&(ae(),R(i,1,1,()=>{i=null}),se());const s={};a[0]&48|a[1]&1&&(s.$$scope={dirty:a,ctx:o}),e.$set(s)},i(o){r||(E(i),E(e.$$.fragment,o),r=!0)},o(o){R(i),R(e.$$.fragment,o),r=!1},d(o){o&&L(n),i&&i.d(o),T(e,o)}}}function os(t){let n,e,r,i,o=t[8]==1?"intervention":"interventions",a,s,f,l,u,c;function h(d){t[28](d)}let _={label:"Move interventions to another scheme",choices:t[14]()};return t[6]!==void 0&&(_.value=t[6]),l=new _f({props:_}),we.push(()=>Se(l,"value",h)),l.$on("change",t[13]),{c(){n=D("p"),e=q("Do you want to first move "),r=q(t[8]),i=z(),a=q(o),s=q(" to another scheme?"),f=z(),I(l.$$.fragment)},m(d,g){P(d,n,g),B(n,e),B(n,r),B(n,i),B(n,a),B(n,s),P(d,f,g),x(l,d,g),c=!0},p(d,g){(!c||g[0]&256)&&je(r,d[8]),(!c||g[0]&256)&&o!==(o=d[8]==1?"intervention":"interventions")&&je(a,o);const w={};!u&&g[0]&64&&(u=!0,w.value=d[6],Pe(()=>u=!1)),l.$set(w)},i(d){c||(E(l.$$.fragment,d),c=!0)},o(d){R(l.$$.fragment,d),c=!1},d(d){d&&(L(n),L(f)),T(l,d)}}}function dm(t){let n;return{c(){n=q("Delete scheme")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function _m(t){let n;return{c(){n=q("Cancel")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function pm(t){let n,e,r,i;return n=new Br({props:{$$slots:{default:[dm]},$$scope:{ctx:t}}}),n.$on("click",t[12]),r=new Ue({props:{$$slots:{default:[_m]},$$scope:{ctx:t}}}),r.$on("click",t[29]),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment)},m(o,a){x(n,o,a),P(o,e,a),x(r,o,a),i=!0},p(o,a){const s={};a[1]&1&&(s.$$scope={dirty:a,ctx:o}),n.$set(s);const f={};a[1]&1&&(f.$$scope={dirty:a,ctx:o}),r.$set(f)},i(o){i||(E(n.$$.fragment,o),E(r.$$.fragment,o),i=!0)},o(o){R(n.$$.fragment,o),R(r.$$.fragment,o),i=!1},d(o){o&&L(e),T(n,o),T(r,o)}}}function gm(t){let n=t[8]>0&&t[14]().length>0,e,r,i,o=n&&os(t);return r=new bs({props:{$$slots:{default:[pm]},$$scope:{ctx:t}}}),{c(){o&&o.c(),e=z(),I(r.$$.fragment)},m(a,s){o&&o.m(a,s),P(a,e,s),x(r,a,s),i=!0},p(a,s){s[0]&256&&(n=a[8]>0&&a[14]().length>0),n?o?(o.p(a,s),s[0]&256&&E(o,1)):(o=os(a),o.c(),E(o,1),o.m(e.parentNode,e)):o&&(ae(),R(o,1,1,()=>{o=null}),se());const f={};s[0]&32|s[1]&1&&(f.$$scope={dirty:s,ctx:a}),r.$set(f)},i(a){i||(E(o),E(r.$$.fragment,a),i=!0)},o(a){R(o),R(r.$$.fragment,a),i=!1},d(a){a&&L(e),o&&o.d(a),T(r,a)}}}function mm(t){let n,e,r,i,o,a,s,f,l,u,c,h,_,d,g,w,k,b;n=new hf({props:{small:!0,$$slots:{default:[om]},$$scope:{ctx:t}}});const p=t[17].default,v=Kn(p,t,t[31],null);f=new Ue({props:{noBottomMargin:!0,$$slots:{default:[am]},$$scope:{ctx:t}}}),f.$on("click",t[20]);let m=t[7]&&es(t);function A(N){t[27](N)}let $={title:"Edit scheme",$$slots:{default:[hm]},$$scope:{ctx:t}};t[4]!==void 0&&($.open=t[4]),c=new co({props:$}),we.push(()=>Se(c,"open",A));function O(N){t[30](N)}let F={title:"Delete this scheme?",displayEscapeButton:!1,$$slots:{default:[gm]},$$scope:{ctx:t}};return t[5]!==void 0&&(F.open=t[5]),d=new co({props:F}),we.push(()=>Se(d,"open",O)),{c(){I(n.$$.fragment),e=z(),r=D("div"),i=D("input"),o=z(),a=D("div"),v&&v.c(),s=z(),I(f.$$.fragment),l=z(),m&&m.c(),u=z(),I(c.$$.fragment),_=z(),I(d.$$.fragment),U(i,"type","color"),re(r,"display","flex"),re(r,"justify-content","space-between")},m(N,S){x(n,N,S),P(N,e,S),P(N,r,S),B(r,i),dn(i,t[3].schemes[t[2]].color),B(r,o),B(r,a),v&&v.m(a,null),B(a,s),x(f,a,null),P(N,l,S),m&&m.m(N,S),P(N,u,S),x(c,N,S),P(N,_,S),x(d,N,S),w=!0,k||(b=[ke(window,"keydown",t[16]),ke(i,"input",t[19])],k=!0)},p(N,S){const M={};S[0]&141|S[1]&1&&(M.$$scope={dirty:S,ctx:N}),n.$set(M),S[0]&12&&dn(i,N[3].schemes[N[2]].color),v&&v.p&&(!w||S[1]&1)&&Vn(v,p,N,N[31],w?er(p,N[31],S,null):Qn(N[31]),null);const y={};S[1]&1&&(y.$$scope={dirty:S,ctx:N}),f.$set(y),N[7]?m?(m.p(N,S),S[0]&128&&E(m,1)):(m=es(N),m.c(),E(m,1),m.m(u.parentNode,u)):m&&(ae(),R(m,1,1,()=>{m=null}),se());const C={};S[0]&55|S[1]&1&&(C.$$scope={dirty:S,ctx:N}),!h&&S[0]&16&&(h=!0,C.open=N[4],Pe(()=>h=!1)),c.$set(C);const Z={};S[0]&352|S[1]&1&&(Z.$$scope={dirty:S,ctx:N}),!g&&S[0]&32&&(g=!0,Z.open=N[5],Pe(()=>g=!1)),d.$set(Z)},i(N){w||(E(n.$$.fragment,N),E(v,N),E(f.$$.fragment,N),E(m),E(c.$$.fragment,N),E(d.$$.fragment,N),w=!0)},o(N){R(n.$$.fragment,N),R(v,N),R(f.$$.fragment,N),R(m),R(c.$$.fragment,N),R(d.$$.fragment,N),w=!1},d(N){N&&(L(e),L(r),L(l),L(u),L(_)),T(n,N),v&&v.d(N),T(f),m&&m.d(N),T(c,N),T(d,N),k=!1,Fr(b)}}}function bm(t,n,e){let r,i,o,a,s=W,f=()=>(s(),s=qt(_,G=>e(3,a=G)),_),l;X(t,yr,G=>e(32,o=G)),X(t,Ze,G=>e(33,l=G)),t.$$.on_destroy.push(()=>s());let{$$slots:u={},$$scope:c}=n,{cfg:h}=n,{gjSchemes:_}=n;f();let{scheme_reference:d}=n,g=!1,w=!1;qe(()=>{vr.set(null)});function k(G,Re){G.preventDefault();let H=a.features.find(Q=>Q.id==Re);H.geometry.type=="Point"?l==null||l.flyTo({center:H.geometry.coordinates,duration:500}):l==null||l.fitBounds(vs(H),{padding:200,duration:500}),de.set({mode:"edit",id:Re})}function b(G){vr.update(Re=>Re==G?null:Re)}function p(){_.update(G=>(G.features=G.features.filter(Re=>Re.properties.scheme_reference!=d),delete G.schemes[d],Object.keys(G.schemes).length==0&&(G=_s(h)),G)),yr.update(G=>(G.delete(d),G)),e(5,w=!1)}let v="";function m(){v&&_.update(G=>{for(let Re of G.features)Re.properties.scheme_reference==d&&(Re.properties.scheme_reference=v);return G})}function A(){return Object.values(a.schemes).filter(G=>G.scheme_reference!=d).map(G=>[G.scheme_reference,h.schemeName(G)])}let $=!o.has(d);function O(){yr.update(G=>($?G.delete(d):G.add(d),G))}function F(G){g&&G.key=="Escape"&&(G.stopPropagation(),e(4,g=!1))}function N(G){$=G,e(7,$)}function S(){a.schemes[d].color=this.value,_.set(a)}const M=()=>e(4,g=!0),y=G=>G.properties.scheme_reference==d,C=(G,Re)=>k(Re,G.id),Z=G=>vr.set(G.id),ie=G=>b(G.id),ue=()=>e(4,g=!1),J=()=>{e(4,g=!1),e(5,w=!0)};function me(G){g=G,e(4,g)}function K(G){v=G,e(6,v)}const be=()=>e(5,w=!1);function ve(G){w=G,e(5,w)}return t.$$set=G=>{"cfg"in G&&e(0,h=G.cfg),"gjSchemes"in G&&f(e(1,_=G.gjSchemes)),"scheme_reference"in G&&e(2,d=G.scheme_reference),"$$scope"in G&&e(31,c=G.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&13&&e(9,r=a.features.filter(G=>G.properties.scheme_reference==d&&h.interventionWarning(G.properties)!=null).length),t.$$.dirty[0]&12&&e(8,i=a.features.filter(G=>G.properties.scheme_reference==d).length)},[h,_,d,a,g,w,v,$,i,r,k,b,p,m,A,O,F,u,N,S,M,y,C,Z,ie,ue,J,me,K,be,ve,c]}class vm extends ce{constructor(n){super(),he(this,n,bm,mm,fe,{cfg:0,gjSchemes:1,scheme_reference:2},null,[-1,-1])}}function as(t,n,e){const r=t.slice();return r[9]=n[e],r[11]=e,r}function wm(t){let n;return{c(){n=q("Add blank scheme")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function ym(t){let n;return{c(){n=q("↑")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function $m(t){let n;return{c(){n=q("↓")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function km(t){let n,e,r,i;function o(){return t[7](t[9])}n=new Ue({props:{disabled:t[11]==0,noBottomMargin:!0,$$slots:{default:[ym]},$$scope:{ctx:t}}}),n.$on("click",o);function a(){return t[8](t[9])}return r=new Ue({props:{disabled:t[11]==Object.keys(t[3].schemes).length-1,noBottomMargin:!0,$$slots:{default:[$m]},$$scope:{ctx:t}}}),r.$on("click",a),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment)},m(s,f){x(n,s,f),P(s,e,f),x(r,s,f),i=!0},p(s,f){t=s;const l={};f&8&&(l.disabled=t[11]==0),f&4096&&(l.$$scope={dirty:f,ctx:t}),n.$set(l);const u={};f&8&&(u.disabled=t[11]==Object.keys(t[3].schemes).length-1),f&4096&&(u.$$scope={dirty:f,ctx:t}),r.$set(u)},i(s){i||(E(n.$$.fragment,s),E(r.$$.fragment,s),i=!0)},o(s){R(n.$$.fragment,s),R(r.$$.fragment,s),i=!1},d(s){s&&L(e),T(n,s),T(r,s)}}}function ss(t,n){let e,r,i,o,a;return r=new vm({props:{cfg:n[0],gjSchemes:n[1],scheme_reference:n[9],$$slots:{default:[km]},$$scope:{ctx:n}}}),{key:t,first:null,c(){e=Le(),I(r.$$.fragment),i=z(),o=D("hr"),this.first=e},m(s,f){P(s,e,f),x(r,s,f),P(s,i,f),P(s,o,f),a=!0},p(s,f){n=s;const l={};f&1&&(l.cfg=n[0]),f&2&&(l.gjSchemes=n[1]),f&8&&(l.scheme_reference=n[9]),f&4104&&(l.$$scope={dirty:f,ctx:n}),r.$set(l)},i(s){a||(E(r.$$.fragment,s),a=!0)},o(s){R(r.$$.fragment,s),a=!1},d(s){s&&(L(e),L(i),L(o)),T(r,s)}}}function Sm(t){let n,e,r,i,o,a,s,f,l,u,c=[],h=new Map,_;r=new Ue({props:{$$slots:{default:[wm]},$$scope:{ctx:t}}}),r.$on("click",t[4]),o=new Lf({props:{label:"Add scheme from file",onLoad:t[5]}}),s=new tr({props:{errorMessage:t[2]}});let d=Fe(Object.keys(t[3].schemes));const g=w=>w[9];for(let w=0;w<d.length;w+=1){let k=as(t,d,w),b=g(k);h.set(b,c[w]=ss(b,k))}return{c(){n=D("div"),e=D("div"),I(r.$$.fragment),i=z(),I(o.$$.fragment),a=z(),I(s.$$.fragment),f=z(),l=D("hr"),u=z();for(let w=0;w<c.length;w+=1)c[w].c();re(e,"display","flex"),re(e,"justify-content","space-between"),re(n,"border","1px solid black"),re(n,"padding","8px")},m(w,k){P(w,n,k),B(n,e),x(r,e,null),B(e,i),x(o,e,null),B(n,a),x(s,n,null),B(n,f),B(n,l),B(n,u);for(let b=0;b<c.length;b+=1)c[b]&&c[b].m(n,null);_=!0},p(w,[k]){const b={};k&4096&&(b.$$scope={dirty:k,ctx:w}),r.$set(b);const p={};k&4&&(p.errorMessage=w[2]),s.$set(p),k&75&&(d=Fe(Object.keys(w[3].schemes)),ae(),c=gs(c,k,g,1,w,d,h,n,ms,ss,null,as),se())},i(w){if(!_){E(r.$$.fragment,w),E(o.$$.fragment,w),E(s.$$.fragment,w);for(let k=0;k<d.length;k+=1)E(c[k]);_=!0}},o(w){R(r.$$.fragment,w),R(o.$$.fragment,w),R(s.$$.fragment,w);for(let k=0;k<c.length;k+=1)R(c[k]);_=!1},d(w){w&&L(n),T(r),T(o),T(s);for(let k=0;k<c.length;k+=1)c[k].d()}}}function Em(t,n,e){[t[n],t[e]]=[t[e],t[n]]}function Mm(t,n){const e={};return t.forEach(r=>{e[r]=n[r]}),e}function Am(t,n,e){let r,i=W,o=()=>(i(),i=qt(s,d=>e(3,r=d)),s);t.$$.on_destroy.push(()=>i());let{cfg:a}=n,{gjSchemes:s}=n;o();function f(){ef(a,r),s.set(r)}let l="";function u(d,g){try{let w=a.backfill(JSON.parse(g));for(let b of Object.values(w.schemes)){if(b.scheme_reference in r.schemes)throw new Error("The file you're loading seems to contain duplicate data. Are you merging in the same file accidentally?");le(s,r.schemes[b.scheme_reference]=b,r)}le(s,r.features=r.features.concat(w.features),r);let k=1;r.features.forEach(b=>{b.id=k++}),s.set(r),e(2,l="")}catch(w){e(2,l=`Couldn't load scheme from a file: ${w}`)}}function c(d,g){const w=JSON.parse(JSON.stringify(Object.keys(r.schemes))),k=w.indexOf(d);if(k+g>=0&&k+g<w.length){Em(w,k,k+g);const b=Mm(w,r.schemes);le(s,r.schemes=b,r),s.set(r)}}const h=d=>c(d,-1),_=d=>c(d,1);return t.$$set=d=>{"cfg"in d&&e(0,a=d.cfg),"gjSchemes"in d&&o(e(1,s=d.gjSchemes))},[a,s,l,r,f,u,c,h,_]}class Rm extends ce{constructor(n){super(),he(this,n,Am,Sm,fe,{cfg:0,gjSchemes:1})}}function ls(t){let n,e,r,i,o,a,s,f,l;return n=new tf({}),i=new Rf({}),f=new sf({props:{href:"https://www.youtube.com/watch?v=6u2lK8xzQfM",$$slots:{default:[Pm]},$$scope:{ctx:t}}}),{c(){I(n.$$.fragment),e=z(),r=D("div"),I(i.$$.fragment),o=z(),a=D("h2"),a.textContent="Scheme Sketcher",s=z(),I(f.$$.fragment),re(r,"border-bottom","1px solid #b1b4b6"),U(r,"class","svelte-1750ds5"),re(a,"margin-bottom","0px"),U(a,"class","svelte-1750ds5")},m(u,c){x(n,u,c),P(u,e,c),P(u,r,c),x(i,r,null),P(u,o,c),P(u,a,c),P(u,s,c),x(f,u,c),l=!0},i(u){l||(E(n.$$.fragment,u),E(i.$$.fragment,u),E(f.$$.fragment,u),l=!0)},o(u){R(n.$$.fragment,u),R(i.$$.fragment,u),R(f.$$.fragment,u),l=!1},d(u){u&&(L(e),L(r),L(o),L(a),L(s)),T(n,u),T(i),T(f,u)}}}function Pm(t){let n;return{c(){n=q("Tutorial")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function Lm(t){let n,e;return n=new nm({props:{cfg:Et,gjSchemes:t[4],id:t[1].id}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p(r,i){const o={};i&2&&(o.id=r[1].id),n.$set(o)},i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Nm(t){let n,e;return n=new Tc({props:{cfg:Et,gjSchemes:t[4]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function Cm(t){let n,e;return n=new Rm({props:{cfg:Et,gjSchemes:t[4]}}),{c(){I(n.$$.fragment)},m(r,i){x(n,r,i),e=!0},p:W,i(r){e||(E(n.$$.fragment,r),e=!0)},o(r){R(n.$$.fragment,r),e=!1},d(r){T(n,r)}}}function fs(t){let n;return{c(){n=D("hr"),U(n,"class","svelte-1750ds5")},m(e,r){P(e,n,r)},d(e){e&&L(n)}}}function us(t){let n,e,r,i,o,a,s,f;return n=new uc({props:{cfg:Et,boundaryGeojson:t[0]}}),r=new Nc({props:{cfg:Et,gjSchemes:t[4]}}),o=new gc({props:{cfg:Et}}),s=new Wg({props:{cfg:Et,gjSchemes:t[4],routeSnapperUrl:t[7]}}),{c(){I(n.$$.fragment),e=z(),I(r.$$.fragment),i=z(),I(o.$$.fragment),a=z(),I(s.$$.fragment)},m(l,u){x(n,l,u),P(l,e,u),x(r,l,u),P(l,i,u),x(o,l,u),P(l,a,u),x(s,l,u),f=!0},p(l,u){const c={};u&1&&(c.boundaryGeojson=l[0]),n.$set(c)},i(l){f||(E(n.$$.fragment,l),E(r.$$.fragment,l),E(o.$$.fragment,l),E(s.$$.fragment,l),f=!0)},o(l){R(n.$$.fragment,l),R(r.$$.fragment,l),R(o.$$.fragment,l),R(s.$$.fragment,l),f=!1},d(l){l&&(L(e),L(i),L(a)),T(n,l),T(r,l),T(o,l),T(s,l)}}}function Om(t){let n,e,r,i;n=new yf({props:{position:"top-right"}});let o=t[3]&&us(t);return{c(){I(n.$$.fragment),e=z(),o&&o.c(),r=Le()},m(a,s){x(n,a,s),P(a,e,s),o&&o.m(a,s),P(a,r,s),i=!0},p(a,s){a[3]?o?(o.p(a,s),s&8&&E(o,1)):(o=us(a),o.c(),E(o,1),o.m(r.parentNode,r)):o&&(ae(),R(o,1,1,()=>{o=null}),se())},i(a){i||(E(n.$$.fragment,a),E(o),i=!0)},o(a){R(n.$$.fragment,a),R(o),i=!1},d(a){a&&(L(e),L(r)),T(n,a),o&&o.d(a)}}}function Im(t){let n,e,r,i,o,a,s,f,l,u,c,h,_,d,g,w;r=new af({});let k=(t[1].mode=="list"||t[1].mode=="split-route"||t[1].mode=="set-image"||t[1].mode=="streetview")&&ls(t);a=new Fu({props:{gjSchemes:t[4],authority:t[5],filename:t[6]}});const b=[Cm,Nm,Lm],p=[];function v(A,$){return A[1].mode=="list"||A[1].mode=="split-route"||A[1].mode=="set-image"||A[1].mode=="streetview"?0:A[1].mode=="new-point"||A[1].mode=="new-area"||A[1].mode=="new-route"?1:A[1].mode=="edit"?2:-1}~(f=v(t))&&(l=p[f]=b[f](t));let m=t[1].mode!="list"&&fs();return h=new wf({}),g=new Af({props:{style:t[2],$$slots:{default:[Om]},$$scope:{ctx:t}}}),{c(){n=D("div"),e=D("div"),I(r.$$.fragment),i=z(),k&&k.c(),o=z(),I(a.$$.fragment),s=z(),l&&l.c(),u=z(),m&&m.c(),c=z(),I(h.$$.fragment),_=z(),d=D("div"),I(g.$$.fragment),U(e,"class","sidebar govuk-prose svelte-1750ds5"),U(d,"class","main svelte-1750ds5"),U(n,"class","overall-layout svelte-1750ds5")},m(A,$){P(A,n,$),B(n,e),x(r,e,null),B(e,i),k&&k.m(e,null),B(e,o),x(a,e,null),B(e,s),~f&&p[f].m(e,null),B(e,u),m&&m.m(e,null),B(e,c),x(h,e,null),B(n,_),B(n,d),x(g,d,null),w=!0},p(A,[$]){A[1].mode=="list"||A[1].mode=="split-route"||A[1].mode=="set-image"||A[1].mode=="streetview"?k?$&2&&E(k,1):(k=ls(A),k.c(),E(k,1),k.m(e,o)):k&&(ae(),R(k,1,1,()=>{k=null}),se());let O=f;f=v(A),f===O?~f&&p[f].p(A,$):(l&&(ae(),R(p[O],1,1,()=>{p[O]=null}),se()),~f?(l=p[f],l?l.p(A,$):(l=p[f]=b[f](A),l.c()),E(l,1),l.m(e,u)):l=null),A[1].mode!="list"?m||(m=fs(),m.c(),m.m(e,c)):m&&(m.d(1),m=null);const F={};$&4&&(F.style=A[2]),$&4105&&(F.$$scope={dirty:$,ctx:A}),g.$set(F)},i(A){w||(E(r.$$.fragment,A),E(k),E(a.$$.fragment,A),E(l),E(h.$$.fragment,A),E(g.$$.fragment,A),w=!0)},o(A){R(r.$$.fragment,A),R(k),R(a.$$.fragment,A),R(l),R(h.$$.fragment,A),R(g.$$.fragment,A),w=!1},d(A){A&&L(n),T(r),k&&k.d(),T(a),~f&&p[f].d(),m&&m.d(),T(h),T(g)}}}function xm(t,n,e){let r,i,o,a,s;X(t,of,g=>e(8,r=g)),X(t,hs,g=>e(9,i=g)),X(t,de,g=>e(1,o=g)),X(t,uo,g=>e(2,a=g)),X(t,Ze,g=>e(3,s=g));let f=We(_s(Et)),l=new URLSearchParams(window.location.search),u=l.get("authority")||"",c=decodeURIComponent(l.get("file")||"");window.localStorage.getItem(ps(u,c))==null&&(window.location.href=`choose_area.html?schema=${i}&error=File ${encodeURIComponent(c)} in authority ${u} not found`),uo.set(l.get("style")||"streets");let h=`https://atip.uk/route-snappers/v3/${u}.bin.gz`,_;vt(async()=>{nf(),e(0,_=await d())});async function d(){let g=await rf();return g.features=g.features.filter(w=>w.properties.full_name==u),g.features.length===0&&(window.location.href=`choose_area.html?schema=${i}&error=Authority name not found: ${u}`),g}return t.$$.update=()=>{t.$$.dirty&256&&r&&Ze.set(r)},[_,o,a,s,f,u,c,h,r]}class Tm extends ce{constructor(n){super(),he(this,n,xm,Im,fe,{})}}document.body.className+=" js-enabled"+("noModule"in HTMLScriptElement.prototype?" govuk-frontend-supported":"");new Tm({target:document.getElementById("app")});
