import{S as pe,i as fe,s as de,F as ce,b as re,a as he,e as i,c as h,t as H,d as te,f as v,g as U,h as me,j,k as t,l as ne,m as le,n as E,o as _e,p as ae,q as oe,r as B,u as ie,v as be,w as ye,x as ve,y as ge,z as we,A as Ae}from"./maplibre_helpers-818d46c3.js";import{A as Se,a as ke}from"./About-074a6557.js";function se(n){let e,o;return{c(){e=i("i"),o=H(n[4])},m(m,s){j(m,e,s),t(e,o)},p(m,s){s&16&&ve(o,m[4])},d(m){m&&B(e)}}}function Ce(n){let e,o,m,s,w,A,I,a,f,J,S,L,y,D,T,N,P,M,p,d,r,u,g,_,C,K,Q,W,X,q,z,F,R,k,V,$,Z,Y,c=n[4]&&se(n);q=new ce({props:{label:"Upload ATIP GeoJSON file",uniqueId:"load-geojson",loadFile:n[7]}});function ue(l){n[13](l)}let x={};return n[1]!==void 0&&(x.open=n[1]),k=new Se({props:x}),re.push(()=>he(k,"open",ue)),{c(){e=i("div"),o=i("h1"),o.textContent="Welcome to ATIP v2",m=h(),s=i("button"),s.textContent="About",w=h(),A=i("p"),A.textContent="Select Transport Authority or Local Authority District:",I=h(),a=i("div"),f=i("input"),J=h(),S=i("datalist"),L=h(),y=i("button"),D=H("Start"),N=h(),P=i("hr"),M=h(),p=i("label"),d=H(`Or pick from the map:
    `),r=i("select"),u=i("option"),u.textContent="Transport Authorities",g=i("option"),g.textContent="Local Authority District",_=h(),c&&c.c(),C=h(),K=i("hr"),Q=h(),W=i("p"),W.textContent="Or upload an ATIP file:",X=h(),te(q.$$.fragment),z=h(),F=i("div"),R=h(),te(k.$$.fragment),v(s,"type","button"),v(s,"class","svelte-ynp6gq"),v(f,"data-testid","transport-authority"),v(f,"list","authorities-list"),v(S,"id","authorities-list"),v(y,"type","button"),y.disabled=T=!n[5],v(y,"class","svelte-ynp6gq"),u.__value="TA",U(u,u.__value),g.__value="LAD",U(g,g.__value),n[3]===void 0&&me(()=>n[12].call(r)),v(e,"class","left svelte-ynp6gq"),v(F,"id","map"),v(F,"class","svelte-ynp6gq")},m(l,b){j(l,e,b),t(e,o),t(e,m),t(e,s),t(e,w),t(e,A),t(e,I),t(e,a),t(a,f),U(f,n[0]),t(a,J),t(a,S),n[11](S),t(a,L),t(a,y),t(y,D),t(e,N),t(e,P),t(e,M),t(e,p),t(p,d),t(p,r),t(r,u),t(r,g),ne(r,n[3],!0),t(p,_),c&&c.m(p,null),t(e,C),t(e,K),t(e,Q),t(e,W),t(e,X),le(q,e,null),j(l,z,b),j(l,F,b),j(l,R,b),le(k,l,b),$=!0,Z||(Y=[E(s,"click",n[9]),E(f,"input",n[10]),E(y,"click",n[8]),E(r,"change",n[12]),E(r,"change",n[6])],Z=!0)},p(l,[b]){b&1&&f.value!==l[0]&&U(f,l[0]),(!$||b&32&&T!==(T=!l[5]))&&(y.disabled=T),b&8&&ne(r,l[3]),l[4]?c?c.p(l,b):(c=se(l),c.c(),c.m(p,null)):c&&(c.d(1),c=null);const ee={};!V&&b&2&&(V=!0,ee.open=l[1],_e(()=>V=!1)),k.$set(ee)},i(l){$||(ae(q.$$.fragment,l),ae(k.$$.fragment,l),$=!0)},o(l){oe(q.$$.fragment,l),oe(k.$$.fragment,l),$=!1},d(l){l&&(B(e),B(z),B(F),B(R)),n[11](null),c&&c.d(),ie(q),ie(k,l),Z=!1,be(Y)}}}let G="boundary",O="boundary-layer";function Ie(n){if(n.features.length>0){let e=n.features[0].properties;for(let o of["planning","v2","criticals"])if(e&&o in e)return o}return"v1"}function Te(n,e,o){let m,s=!1,w,A,I=new Set,a=null,f="TA";function J(){a==null||a.setFilter(O,["==",["get","level"],f])}let S=null;ye(async()=>{const d=await(await fetch(ke)).text(),r=JSON.parse(d);for(let _ of r.features){let C=document.createElement("option");C.value=_.properties.name,A.appendChild(C),I.add(_.properties.name)}a=new ge.Map({container:"map",style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo"});let u=null;function g(){u!==null&&a.setFeatureState({source:G,id:u},{hover:!1})}a.on("load",function(){a.fitBounds(we(r),{padding:20,animate:!1}),a.addSource(G,{type:"geojson",data:r,generateId:!0}),a.addLayer({id:O,source:G,filter:["==",["get","level"],f],type:"fill",paint:{"fill-color":"rgb(200, 100, 240)","fill-outline-color":"rgb(200, 100, 240)","fill-opacity":["case",["boolean",["feature-state","hover"],!1],.8,.4]}}),a.on("mousemove",O,_=>{_.features.length>0&&(g(),u=_.features[0].id,o(4,S=_.features[0].properties.name),a.setFeatureState({source:G,id:u},{hover:!0}))}),a.on("mouseleave",O,()=>{g(),u=null,o(4,S=null)}),a.on("click",O,function(_){let C=_.features[0].properties.name;window.location.href=`scheme.html?authority=${C}`})})});function L(p){try{let d=JSON.parse(p);if(!d.authority)throw new Error("File doesn't have an authority set; is it an ATIP file?");if(!I.has(d.authority))throw new Error(`Unknown authority ${d.authority}`);let r=d.authority,u=Ie(d);u!="v1"&&(r+=`_${u}`),window.localStorage.setItem(r,JSON.stringify(d)),window.location.href=`scheme.html?authority=${d.authority}&schema=${u}`}catch(d){window.alert(`Couldn't load scheme from a file: ${d}`)}}function y(){window.location.href=`scheme.html?authority=${w}`}const D=()=>o(1,s=!s);function T(){w=this.value,o(0,w)}function N(p){re[p?"unshift":"push"](()=>{A=p,o(2,A)})}function P(){f=Ae(this),o(3,f)}function M(p){s=p,o(1,s)}return n.$$.update=()=>{n.$$.dirty&1&&o(5,m=I.has(w))},[w,s,A,f,S,m,J,L,y,D,T,N,P,M]}class qe extends pe{constructor(e){super(),fe(this,e,Te,Ce,de,{})}}new qe({target:document.getElementById("app")});
