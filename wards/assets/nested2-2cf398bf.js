import{S as R,i as K,s as G,g as y,f as B,e as P,u as L,m as b,j as h,k as U,U as te,t as $,l as d,p as g,q as k,_ as X,a2 as me,r as Ie,b as ne,c as re,F as Pt,o as se,a as be,h as V,v as Ye,w as zt,I as ie,C as le,aW as Le,a1 as Fe,G as Te,H as Ot,L as Nt,M as It,N as Ft,aV as Y,az as jt,a7 as je,x as Ve,D as pt,aX as Qe,ag as mt,d as Vt,X as et,y as de,n as _e,z as xt,A as Ht,a9 as Zt,aP as Rt,E as Kt,V as tt,W as Gt,ad as qt}from"./data_getter-3118b7fa.js";import{C as xe,S as ze,d as Se,j as De,H as Ce,h as Wt,i as nt,g as $t,L as Jt,Z as Xt,M as Yt,I as Qt,b as en,B as tn}from"./Map-26d36898.js";function nn(r){let e=new Map;for(let[t,s]of Object.entries(r.schemes))e.set(t,{scheme_reference:t,num_features:0,authority_or_region:s.authority_or_region,capital_scheme_id:s.capital_scheme_id,funding_programme:s.funding_programme});let n=1;for(let t of r.features){let s=e.get(t.properties.scheme_reference);s.num_features++,t.properties.funding_programme=s.funding_programme,t.id=n++}return e}function rn(r){let e;return{c(){e=L("Clear")},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function sn(r){let e,n,t,s,o,l;return t=new be({props:{$$slots:{default:[rn]},$$scope:{ctx:r}}}),t.$on("click",r[11]),{c(){e=P("input"),n=B(),y(t.$$.fragment),V(e,"type","text"),V(e,"class","govuk-input govuk-input--width-10"),V(e,"id","filterText")},m(u,i){h(u,e,i),Ye(e,r[0]),h(u,n,i),b(t,u,i),s=!0,o||(l=zt(e,"input",r[10]),o=!0)},p(u,i){i&1&&e.value!==u[0]&&Ye(e,u[0]);const c={};i&16384&&(c.$$scope={dirty:i,ctx:u}),t.$set(c)},i(u){s||($(t.$$.fragment,u),s=!0)},o(u){d(t.$$.fragment,u),s=!1},d(u){u&&(g(e),g(n)),k(t,u),o=!1,l()}}}function on(r){let e,n,t,s,o,l,u,i;function c(p){r[8](p)}let f={label:"Authority or region",id:"filterAuthority",choices:r[4],emptyOption:!0};r[2]!==void 0&&(f.value=r[2]),e=new ze({props:f}),ne.push(()=>re(e,"value",c));function a(p){r[9](p)}let m={label:"Funding programme",id:"filterFundingProgramme",choices:r[5],emptyOption:!0};return r[3]!==void 0&&(m.value=r[3]),s=new ze({props:m}),ne.push(()=>re(s,"value",a)),u=new Pt({props:{label:"Intervention name or description",id:"filterText",$$slots:{default:[sn]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment),l=B(),y(u.$$.fragment)},m(p,_){b(e,p,_),h(p,t,_),b(s,p,_),h(p,l,_),b(u,p,_),i=!0},p(p,_){const T={};_&16&&(T.choices=p[4]),!n&&_&4&&(n=!0,T.value=p[2],se(()=>n=!1)),e.$set(T);const C={};_&32&&(C.choices=p[5]),!o&&_&8&&(o=!0,C.value=p[3],se(()=>o=!1)),s.$set(C);const w={};_&16385&&(w.$$scope={dirty:_,ctx:p}),u.$set(w)},i(p){i||($(e.$$.fragment,p),$(s.$$.fragment,p),$(u.$$.fragment,p),i=!0)},o(p){d(e.$$.fragment,p),d(s.$$.fragment,p),d(u.$$.fragment,p),i=!1},d(p){p&&(g(t),g(l)),k(e,p),k(s,p),k(u,p)}}}function ln(r){let e,n,t,s,o=r[1].size+"",l,u,i=r[6].route+"",c,f,a=r[6].area+"",m,p,_=r[6].crossing+"",T,C,w=r[6].other+"",v,S,M;return e=new xe({props:{label:"Filters",$$slots:{default:[on]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment),n=B(),t=P("p"),s=L("Showing "),l=L(o),u=L(" schemes ("),c=L(i),f=L(" routes, "),m=L(a),p=L(` areas,
  `),T=L(_),C=L(" crossings, "),v=L(w),S=L(" other)")},m(D,E){b(e,D,E),h(D,n,E),h(D,t,E),U(t,s),U(t,l),U(t,u),U(t,c),U(t,f),U(t,m),U(t,p),U(t,T),U(t,C),U(t,v),U(t,S),M=!0},p(D,[E]){const z={};E&16445&&(z.$$scope={dirty:E,ctx:D}),e.$set(z),(!M||E&2)&&o!==(o=D[1].size+"")&&te(l,o),(!M||E&64)&&i!==(i=D[6].route+"")&&te(c,i),(!M||E&64)&&a!==(a=D[6].area+"")&&te(m,a),(!M||E&64)&&_!==(_=D[6].crossing+"")&&te(T,_),(!M||E&64)&&w!==(w=D[6].other+"")&&te(v,w)},i(D){M||($(e.$$.fragment,D),M=!0)},o(D){d(e.$$.fragment,D),M=!1},d(D){D&&(g(n),g(t)),k(e,D)}}}function an(r,e,n){let t;X(r,me,w=>n(12,t=w));let{schemes:s}=e,{schemesToBeShown:o=new Set}=e,{filterText:l=""}=e,u=[],i="",c=[],f="",a={area:0,route:0,crossing:0,other:0};Ie(()=>{let w=new Set,v=new Set;for(let S of s.values())S.authority_or_region&&w.add(S.authority_or_region),S.funding_programme&&v.add(S.funding_programme);n(4,u=Array.from(w.entries())),u.sort(),n(5,c=Array.from(v.entries())),c.sort()});function m(w,v,S){let M=w.toLowerCase(),D=z=>{var O,Q;if(M&&!((O=z.properties.name)!=null&&O.toLowerCase().includes(M))&&!((Q=z.properties.description)!=null&&Q.toLowerCase().includes(M)))return!1;if(v||S){let N=s.get(z.properties.scheme_reference);if(v&&N.authority_or_region!=v||S&&N.funding_programme!=S)return!1}return!0};n(1,o=new Set(t.features.filter(D).map(z=>z.properties.scheme_reference))),n(6,a={area:0,route:0,crossing:0,other:0});let E=z=>{var O,Q;return!(!o.has(z.properties.scheme_reference)||M&&!((O=z.properties.name)!=null&&O.toLowerCase().includes(M))&&!((Q=z.properties.description)!=null&&Q.toLowerCase().includes(M)))};me.update(z=>{for(let O of z.features)E(O)?(delete O.properties.hide_while_editing,n(6,a[O.properties.intervention_type]++,a)):O.properties.hide_while_editing=!0;return z}),n(6,a)}function p(w){i=w,n(2,i)}function _(w){f=w,n(3,f)}function T(){l=this.value,n(0,l)}const C=()=>n(0,l="");return r.$$set=w=>{"schemes"in w&&n(7,s=w.schemes),"schemesToBeShown"in w&&n(1,o=w.schemesToBeShown),"filterText"in w&&n(0,l=w.filterText)},r.$$.update=()=>{r.$$.dirty&13&&m(l,i,f)},[l,o,i,f,u,c,a,s,p,_,T,C]}class fn extends R{constructor(e){super(),K(this,e,an,ln,G,{schemes:7,schemesToBeShown:1,filterText:0})}}const J={schools:"#007DBB",hospitals:"#B73D25",mrn:"#006478",parliamentary_constituencies:"#006E59",wards:"purple",atf2:"#00AFFF",atf3:"#FF62DC",atf4:"#FFD833"};function un(r){let e,n,t,s;return e=new De({props:{color:r[3]}}),{c(){y(e.$$.fragment),n=B(),t=L(r[1])},m(o,l){b(e,o,l),h(o,n,l),h(o,t,l),s=!0},p(o,l){(!s||l&2)&&te(t,o[1])},i(o){s||($(e.$$.fragment,o),s=!0)},o(o){d(e.$$.fragment,o),s=!1},d(o){o&&(g(n),g(t)),k(e,o)}}}function cn(r){let e;const n=r[6].default,t=Ot(n,r,r[8],null);return{c(){t&&t.c()},m(s,o){t&&t.m(s,o),e=!0},p(s,o){t&&t.p&&(!e||o&256)&&Nt(t,n,s,s[8],e?Ft(n,s[8],o,null):It(s[8]),null)},i(s){e||($(t,s),e=!0)},o(s){d(t,s),e=!1},d(s){t&&t.d(s)}}}function pn(r){let e,n,t;return n=new Ce({props:{$$slots:{default:[cn]},$$scope:{ctx:r}}}),{c(){e=P("span"),y(n.$$.fragment),V(e,"slot","right")},m(s,o){h(s,e,o),b(n,e,null),t=!0},p(s,o){const l={};o&256&&(l.$$scope={dirty:o,ctx:s}),n.$set(l)},i(s){t||($(n.$$.fragment,s),t=!0)},o(s){d(n.$$.fragment,s),t=!1},d(s){s&&g(e),k(n)}}}function mn(r){let e,n,t,s,o;function l(i){r[7](i)}let u={id:r[0],$$slots:{right:[pn],default:[un]},$$scope:{ctx:r}};return r[2]!==void 0&&(u.checked=r[2]),e=new Se({props:u}),ne.push(()=>re(e,"checked",l)),s=new ie({props:{layer:r[0],tooltip:r[4],show:r[2]}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,c){b(e,i,c),h(i,t,c),b(s,i,c),o=!0},p(i,[c]){const f={};c&1&&(f.id=i[0]),c&258&&(f.$$scope={dirty:c,ctx:i}),!n&&c&4&&(n=!0,f.checked=i[2],se(()=>n=!1)),e.$set(f);const a={};c&1&&(a.layer=i[0]),c&4&&(a.show=i[2]),s.$set(a)},i(i){o||($(e.$$.fragment,i),$(s.$$.fragment,i),o=!0)},o(i){d(e.$$.fragment,i),d(s.$$.fragment,i),o=!1},d(i){i&&g(t),k(e,i),k(s,i)}}}function $n(r,e,n){let t;X(r,le,p=>n(9,t=p));let{$$slots:s={},$$scope:o}=e,{name:l}=e,{singularNoun:u}=e,{pluralNoun:i}=e,c=J[l];Le(t,l,`https://atip.uk/layers/v1/${l}.pmtiles`),Fe(t,{id:l,source:l,sourceLayer:l,color:c,opacity:Te(1,.7)});let f=!1;function a(p){return`<p>${p.properties.name??`Unnamed ${u}`}</p>`}function m(p){f=p,n(2,f)}return r.$$set=p=>{"name"in p&&n(0,l=p.name),"singularNoun"in p&&n(5,u=p.singularNoun),"pluralNoun"in p&&n(1,i=p.pluralNoun),"$$scope"in p&&n(8,o=p.$$scope)},[l,i,f,c,a,u,s,m,o]}class ht extends R{constructor(e){super(),K(this,e,$n,mn,G,{name:0,singularNoun:5,pluralNoun:1})}}function hn(r){let e;return{c(){e=L("hospital")},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function gn(r){let e;return{c(){e=L("Open Data Commons Open Database License")},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function dn(r){let e,n,t,s,o,l,u,i,c;return t=new Y({props:{href:"https://wiki.openstreetmap.org/wiki/Tag:amenity%3Dhospital",$$slots:{default:[hn]},$$scope:{ctx:r}}}),i=new Y({props:{href:"https://www.openstreetmap.org/copyright",$$slots:{default:[gn]},$$scope:{ctx:r}}}),{c(){e=P("p"),n=L("This shows "),y(t.$$.fragment),s=L(` data from OpenStreetMap. It doesn't include outpatient clinics
    or individual doctor's offices.`),o=B(),l=P("p"),u=L("License: "),y(i.$$.fragment)},m(f,a){h(f,e,a),U(e,n),b(t,e,null),U(e,s),h(f,o,a),h(f,l,a),U(l,u),b(i,l,null),c=!0},p(f,a){const m={};a&1&&(m.$$scope={dirty:a,ctx:f}),t.$set(m);const p={};a&1&&(p.$$scope={dirty:a,ctx:f}),i.$set(p)},i(f){c||($(t.$$.fragment,f),$(i.$$.fragment,f),c=!0)},o(f){d(t.$$.fragment,f),d(i.$$.fragment,f),c=!1},d(f){f&&(g(e),g(o),g(l)),k(t),k(i)}}}function _n(r){let e,n;return e=new ht({props:{name:"hospitals",singularNoun:"hospital",pluralNoun:"Hospitals",$$slots:{default:[dn]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),n=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){d(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}class wn extends R{constructor(e){super(),K(this,e,null,_n,G,{})}}function vn(r){let e,n,t,s,o;function l(i){r[3](i)}let u={label:"Color interventions",id:"colorInterventions",choices:[["interventionType","By intervention type"],["fundingProgramme","By funding programme"]]};return r[0]!==void 0&&(u.value=r[0]),e=new ze({props:u}),ne.push(()=>re(e,"value",l)),e.$on("change",r[2]),s=new Wt({props:{rows:r[1]}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,c){b(e,i,c),h(i,t,c),b(s,i,c),o=!0},p(i,[c]){const f={};!n&&c&1&&(n=!0,f.value=i[0],se(()=>n=!1)),e.$set(f);const a={};c&2&&(a.rows=i[1]),s.$set(a)},i(i){o||($(e.$$.fragment,i),$(s.$$.fragment,i),o=!0)},o(i){d(e.$$.fragment,i),d(s.$$.fragment,i),o=!1},d(i){i&&g(t),k(e,i),k(s,i)}}}function yn(r,e,n){let t;X(r,le,i=>n(4,t=i));let s="interventionType",o=nt("v1");function l(){let i;s=="interventionType"?(i=$t("v1"),n(1,o=nt("v1"))):(i=jt(["get","funding_programme"],{ATF2:J.atf2,ATF3:J.atf3,ATF4:J.atf4},"grey"),n(1,o=[["ATF2",J.atf2],["ATF3",J.atf3],["ATF4",J.atf4]])),t.setPaintProperty("interventions-points","circle-color",i),t.setPaintProperty("interventions-lines","line-color",i),t.setPaintProperty("interventions-polygons","fill-color",i),t.setPaintProperty("interventions-polygon-outlines","line-color",i)}function u(i){s=i,n(0,s)}return[s,o,l,u]}class bn extends R{constructor(e){super(),K(this,e,yn,vn,G,{})}}function kn(r){let e,n,t;return e=new De({props:{color:r[1]}}),{c(){y(e.$$.fragment),n=L(`
  MRN`)},m(s,o){b(e,s,o),h(s,n,o),t=!0},p:Ve,i(s){t||($(e.$$.fragment,s),t=!0)},o(s){d(e.$$.fragment,s),t=!1},d(s){s&&g(n),k(e,s)}}}function Ln(r){let e;return{c(){e=L(`Major Road Network
        `)},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function Tn(r){let e;return{c(){e=L("Open Government License")},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function Sn(r){let e,n,t,s,o,l,u,i,c;return t=new Y({props:{href:"https://maps.dft.gov.uk/major-road-network/index.html",$$slots:{default:[Ln]},$$scope:{ctx:r}}}),i=new Y({props:{href:"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/",$$slots:{default:[Tn]},$$scope:{ctx:r}}}),{c(){e=P("p"),n=L("Data from the "),y(t.$$.fragment),s=L("."),o=B(),l=P("p"),u=L("License: "),y(i.$$.fragment)},m(f,a){h(f,e,a),U(e,n),b(t,e,null),U(e,s),h(f,o,a),h(f,l,a),U(l,u),b(i,l,null),c=!0},p(f,a){const m={};a&16&&(m.$$scope={dirty:a,ctx:f}),t.$set(m);const p={};a&16&&(p.$$scope={dirty:a,ctx:f}),i.$set(p)},i(f){c||($(t.$$.fragment,f),$(i.$$.fragment,f),c=!0)},o(f){d(t.$$.fragment,f),d(i.$$.fragment,f),c=!1},d(f){f&&(g(e),g(o),g(l)),k(t),k(i)}}}function Dn(r){let e,n,t;return n=new Ce({props:{$$slots:{default:[Sn]},$$scope:{ctx:r}}}),{c(){e=P("span"),y(n.$$.fragment),V(e,"slot","right")},m(s,o){h(s,e,o),b(n,e,null),t=!0},p(s,o){const l={};o&16&&(l.$$scope={dirty:o,ctx:s}),n.$set(l)},i(s){t||($(n.$$.fragment,s),t=!0)},o(s){d(n.$$.fragment,s),t=!1},d(s){s&&g(e),k(n)}}}function Cn(r){let e,n,t,s,o;function l(i){r[2](i)}let u={id:oe,$$slots:{right:[Dn],default:[kn]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.checked=r[0]),e=new Se({props:u}),ne.push(()=>re(e,"checked",l)),s=new ie({props:{layer:oe,tooltip:Un,show:r[0]}}),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,c){b(e,i,c),h(i,t,c),b(s,i,c),o=!0},p(i,[c]){const f={};c&16&&(f.$$scope={dirty:c,ctx:i}),!n&&c&1&&(n=!0,f.checked=i[0],se(()=>n=!1)),e.$set(f);const a={};c&1&&(a.show=i[0]),s.$set(a)},i(i){o||($(e.$$.fragment,i),$(s.$$.fragment,i),o=!0)},o(i){d(e.$$.fragment,i),d(s.$$.fragment,i),o=!1},d(i){i&&g(t),k(e,i),k(s,i)}}}let oe="mrn";function Un(r){return`<p>${r.properties.name??"Unknown MRN road"}</p>`}function Mn(r,e,n){let t;X(r,le,u=>n(3,t=u));let s=J.mrn;Le(t,oe,`https://atip.uk/layers/v1/${oe}.pmtiles`),je(t,{id:oe,source:oe,sourceLayer:oe,color:s,width:7,opacity:Te(.5,1)});let o=!1;function l(u){o=u,n(0,o)}return[o,s,l]}class Bn extends R{constructor(e){super(),K(this,e,Mn,Cn,G,{})}}function En(r){let e,n,t;return e=new De({props:{color:r[1]}}),{c(){y(e.$$.fragment),n=L(`
  Parliamentary constituencies`)},m(s,o){b(e,s,o),h(s,n,o),t=!0},p:Ve,i(s){t||($(e.$$.fragment,s),t=!0)},o(s){d(e.$$.fragment,s),t=!1},d(s){s&&g(n),k(e,s)}}}function An(r){let e;return{c(){e=L(`Ordnance Survey Boundary-Line
        `)},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function Pn(r){let e;return{c(){e=L("Open Government License")},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function zn(r){let e,n,t,s,o,l,u,i,c;return t=new Y({props:{href:"https://www.ordnancesurvey.co.uk/products/boundary-line",$$slots:{default:[An]},$$scope:{ctx:r}}}),i=new Y({props:{href:"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/",$$slots:{default:[Pn]},$$scope:{ctx:r}}}),{c(){e=P("p"),n=L("Data from "),y(t.$$.fragment),s=L("."),o=B(),l=P("p"),u=L("License: "),y(i.$$.fragment)},m(f,a){h(f,e,a),U(e,n),b(t,e,null),U(e,s),h(f,o,a),h(f,l,a),U(l,u),b(i,l,null),c=!0},p(f,a){const m={};a&32&&(m.$$scope={dirty:a,ctx:f}),t.$set(m);const p={};a&32&&(p.$$scope={dirty:a,ctx:f}),i.$set(p)},i(f){c||($(t.$$.fragment,f),$(i.$$.fragment,f),c=!0)},o(f){d(t.$$.fragment,f),d(i.$$.fragment,f),c=!1},d(f){f&&(g(e),g(o),g(l)),k(t),k(i)}}}function On(r){let e,n,t;return n=new Ce({props:{$$slots:{default:[zn]},$$scope:{ctx:r}}}),{c(){e=P("span"),y(n.$$.fragment),V(e,"slot","right")},m(s,o){h(s,e,o),b(n,e,null),t=!0},p(s,o){const l={};o&32&&(l.$$scope={dirty:o,ctx:s}),n.$set(l)},i(s){t||($(n.$$.fragment,s),t=!0)},o(s){d(n.$$.fragment,s),t=!1},d(s){s&&g(e),k(n)}}}function Nn(r){let e,n,t,s,o;function l(i){r[3](i)}let u={id:q,$$slots:{right:[On],default:[En]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.checked=r[0]),e=new Se({props:u}),ne.push(()=>re(e,"checked",l)),s=new ie({props:{layer:q,tooltip:In,show:r[0]}}),s.$on("click",Fn),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,c){b(e,i,c),h(i,t,c),b(s,i,c),o=!0},p(i,[c]){const f={};c&32&&(f.$$scope={dirty:c,ctx:i}),!n&&c&1&&(n=!0,f.checked=i[0],se(()=>n=!1)),e.$set(f);const a={};c&1&&(a.show=i[0]),s.$set(a)},i(i){o||($(e.$$.fragment,i),$(s.$$.fragment,i),o=!0)},o(i){d(e.$$.fragment,i),d(s.$$.fragment,i),o=!1},d(i){i&&g(t),k(e,i),k(s,i)}}}let q="parliamentary_constituencies";function In(r){return`<p>${r.properties.Name}</p>`}function Fn(r){let e=r.detail.properties.Name;e=e.replace(/ Boro Const$/,""),e=e.replace(/ Co Const$/,""),e=encodeURIComponent(e),window.open(`https://members.parliament.uk/members/Commons?SearchText=${e}`,"_blank")}function jn(r,e,n){let t;X(r,le,i=>n(2,t=i));let s=J.parliamentary_constituencies,o=`${q}-outline`;Le(t,q,`https://atip.uk/layers/v1/${q}.pmtiles`),Fe(t,{id:q,source:q,sourceLayer:q,color:s,opacity:Te(.5,.1)}),je(t,{id:o,source:q,sourceLayer:q,color:s,width:5});let l=!1;function u(i){l=i,n(0,l)}return r.$$.update=()=>{r.$$.dirty&5&&t.getLayer(o)&&t.setLayoutProperty(o,"visibility",l?"visible":"none")},[l,s,t,u]}class Vn extends R{constructor(e){super(),K(this,e,jn,Nn,G,{})}}function xn(r){let e;return{c(){e=L("Show on map")},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function Hn(r){let e;return{c(){e=L("Edit scheme locally")},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function Zn(r){let e,n,t=r[0].authority_or_region+"",s,o,l,u,i=r[0].capital_scheme_id+"",c,f,a,m,p=r[0].funding_programme+"",_,T,C,w,v,S,M;return w=new be({props:{$$slots:{default:[xn]},$$scope:{ctx:r}}}),w.$on("click",r[3]),S=new be({props:{disabled:r[1],title:r[2],$$slots:{default:[Hn]},$$scope:{ctx:r}}}),S.$on("click",r[4]),{c(){e=P("p"),n=L("Authority or region: "),s=L(t),o=B(),l=P("p"),u=L("Capital scheme ID: "),c=L(i),f=B(),a=P("p"),m=L("Funding programme: "),_=L(p),T=B(),C=P("div"),y(w.$$.fragment),v=B(),y(S.$$.fragment),V(C,"class","govuk-button-group")},m(D,E){h(D,e,E),U(e,n),U(e,s),h(D,o,E),h(D,l,E),U(l,u),U(l,c),h(D,f,E),h(D,a,E),U(a,m),U(a,_),h(D,T,E),h(D,C,E),b(w,C,null),U(C,v),b(S,C,null),M=!0},p(D,E){(!M||E&1)&&t!==(t=D[0].authority_or_region+"")&&te(s,t),(!M||E&1)&&i!==(i=D[0].capital_scheme_id+"")&&te(c,i),(!M||E&1)&&p!==(p=D[0].funding_programme+"")&&te(_,p);const z={};E&256&&(z.$$scope={dirty:E,ctx:D}),w.$set(z);const O={};E&256&&(O.$$scope={dirty:E,ctx:D}),S.$set(O)},i(D){M||($(w.$$.fragment,D),$(S.$$.fragment,D),M=!0)},o(D){d(w.$$.fragment,D),d(S.$$.fragment,D),M=!1},d(D){D&&(g(e),g(o),g(l),g(f),g(a),g(T),g(C)),k(w),k(S)}}}function Rn(r){let e,n;return e=new xe({props:{label:`${r[0].scheme_reference}: ${r[0].num_features} features`,$$slots:{default:[Zn]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),n=!0},p(t,[s]){const o={};s&1&&(o.label=`${t[0].scheme_reference}: ${t[0].num_features} features`),s&257&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){d(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}function Kn(r,e,n){let t,s;X(r,me,a=>n(6,t=a)),X(r,le,a=>n(7,s=a));let{scheme:o}=e,{authorityNames:l}=e,u=!l.has(o.authority_or_region),i=u?"This scheme doesn't have an authority specified correctly, so you can't edit this scheme. We're working to fix this problem.":void 0;function c(){let a={type:"FeatureCollection",features:t.features.filter(m=>m.properties.scheme_reference==o.scheme_reference)};s==null||s.fitBounds(pt(a),{padding:20,animate:!1})}function f(){let a={type:"FeatureCollection",features:t.features.filter(p=>p.properties.scheme_reference==o.scheme_reference)},m=o.authority_or_region;window.localStorage.setItem(m,JSON.stringify(a)),window.open(`scheme.html?authority=${o.authority_or_region}`,"_blank")}return r.$$set=a=>{"scheme"in a&&n(0,o=a.scheme),"authorityNames"in a&&n(5,l=a.authorityNames)},[o,u,i,c,f,l]}class Gn extends R{constructor(e){super(),K(this,e,Kn,Rn,G,{scheme:0,authorityNames:5})}}function qn(r){let e;return{c(){e=L("primary and secondary schools")},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function Wn(r){let e;return{c(){e=L("Open Data Commons Open Database License")},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function Jn(r){let e,n,t,s,o,l,u,i,c;return t=new Y({props:{href:"https://wiki.openstreetmap.org/wiki/Tag:amenity%3Dschool",$$slots:{default:[qn]},$$scope:{ctx:r}}}),i=new Y({props:{href:"https://www.openstreetmap.org/copyright",$$slots:{default:[Wn]},$$scope:{ctx:r}}}),{c(){e=P("p"),n=L("This shows "),y(t.$$.fragment),s=L(` from OpenStreetMap. It doesn't include kindergartens, colleges,
    universities, or other training schools.`),o=B(),l=P("p"),u=L("License: "),y(i.$$.fragment)},m(f,a){h(f,e,a),U(e,n),b(t,e,null),U(e,s),h(f,o,a),h(f,l,a),U(l,u),b(i,l,null),c=!0},p(f,a){const m={};a&1&&(m.$$scope={dirty:a,ctx:f}),t.$set(m);const p={};a&1&&(p.$$scope={dirty:a,ctx:f}),i.$set(p)},i(f){c||($(t.$$.fragment,f),$(i.$$.fragment,f),c=!0)},o(f){d(t.$$.fragment,f),d(i.$$.fragment,f),c=!1},d(f){f&&(g(e),g(o),g(l)),k(t),k(i)}}}function Xn(r){let e,n;return e=new ht({props:{name:"schools",singularNoun:"school",pluralNoun:"Schools",$$slots:{default:[Jn]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),n=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){d(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}class Yn extends R{constructor(e){super(),K(this,e,null,Xn,G,{})}}function Qn(r){let e,n,t;return e=new De({props:{color:r[1]}}),{c(){y(e.$$.fragment),n=L(`
  Wards`)},m(s,o){b(e,s,o),h(s,n,o),t=!0},p:Ve,i(s){t||($(e.$$.fragment,s),t=!0)},o(s){d(e.$$.fragment,s),t=!1},d(s){s&&g(n),k(e,s)}}}function er(r){let e;return{c(){e=L(`ONS Geography
        `)},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function tr(r){let e;return{c(){e=L(`Open Government License
        `)},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function nr(r){let e,n,t,s,o,l,u,i,c,f;return t=new Y({props:{href:"https://geoportal.statistics.gov.uk/datasets/ons::wards-may-2023-boundaries-uk-bgc/explore",$$slots:{default:[er]},$$scope:{ctx:r}}}),i=new Y({props:{href:"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/",$$slots:{default:[tr]},$$scope:{ctx:r}}}),{c(){e=P("p"),n=L("Data from "),y(t.$$.fragment),s=L(", as of May 2023."),o=B(),l=P("p"),u=L("License: "),y(i.$$.fragment),c=L(`. Contains OS data © Crown copyright and database
        right 2023.`)},m(a,m){h(a,e,m),U(e,n),b(t,e,null),U(e,s),h(a,o,m),h(a,l,m),U(l,u),b(i,l,null),U(l,c),f=!0},p(a,m){const p={};m&32&&(p.$$scope={dirty:m,ctx:a}),t.$set(p);const _={};m&32&&(_.$$scope={dirty:m,ctx:a}),i.$set(_)},i(a){f||($(t.$$.fragment,a),$(i.$$.fragment,a),f=!0)},o(a){d(t.$$.fragment,a),d(i.$$.fragment,a),f=!1},d(a){a&&(g(e),g(o),g(l)),k(t),k(i)}}}function rr(r){let e,n,t;return n=new Ce({props:{$$slots:{default:[nr]},$$scope:{ctx:r}}}),{c(){e=P("span"),y(n.$$.fragment),V(e,"slot","right")},m(s,o){h(s,e,o),b(n,e,null),t=!0},p(s,o){const l={};o&32&&(l.$$scope={dirty:o,ctx:s}),n.$set(l)},i(s){t||($(n.$$.fragment,s),t=!0)},o(s){d(n.$$.fragment,s),t=!1},d(s){s&&g(e),k(n)}}}function sr(r){let e,n,t,s,o;function l(i){r[3](i)}let u={id:W,$$slots:{right:[rr],default:[Qn]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.checked=r[0]),e=new Se({props:u}),ne.push(()=>re(e,"checked",l)),s=new ie({props:{layer:W,tooltip:or,show:r[0]}}),s.$on("click",ir),{c(){y(e.$$.fragment),t=B(),y(s.$$.fragment)},m(i,c){b(e,i,c),h(i,t,c),b(s,i,c),o=!0},p(i,[c]){const f={};c&32&&(f.$$scope={dirty:c,ctx:i}),!n&&c&1&&(n=!0,f.checked=i[0],se(()=>n=!1)),e.$set(f);const a={};c&1&&(a.show=i[0]),s.$set(a)},i(i){o||($(e.$$.fragment,i),$(s.$$.fragment,i),o=!0)},o(i){d(e.$$.fragment,i),d(s.$$.fragment,i),o=!1},d(i){i&&g(t),k(e,i),k(s,i)}}}let W="wards";function or(r){return`<p>${r.properties.name}</p>`}function ir(r){let e=encodeURIComponent(r.detail.properties.name);window.open(`https://www.google.com/search?q=${e}+councillor`,"_blank")}function lr(r,e,n){let t;X(r,le,i=>n(2,t=i));let s=J.wards,o=`${W}-outline`;Le(t,W,`https://atip.uk/layers/v1/${W}.pmtiles`),Fe(t,{id:W,source:W,sourceLayer:W,color:s,opacity:Te(.5,.1)}),je(t,{id:o,source:W,sourceLayer:W,color:s,width:2.5});let l=!1;function u(i){l=i,n(0,l)}return r.$$.update=()=>{r.$$.dirty&5&&t.getLayer(o)&&t.setLayoutProperty(o,"visibility",l?"visible":"none")},[l,s,t,u]}class ar extends R{constructor(e){super(),K(this,e,lr,sr,G,{})}}var I=(r,e,n)=>new Promise((t,s)=>{var o=i=>{try{u(n.next(i))}catch(c){s(c)}},l=i=>{try{u(n.throw(i))}catch(c){s(c)}},u=i=>i.done?t(i.value):Promise.resolve(i.value).then(o,l);u((n=n.apply(r,e)).next())}),j=Uint8Array,ce=Uint16Array,fr=Int32Array,gt=new j([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),dt=new j([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ur=new j([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_t=function(r,e){for(var n=new ce(31),t=0;t<31;++t)n[t]=e+=1<<r[t-1];for(var s=new fr(n[30]),t=1;t<30;++t)for(var o=n[t];o<n[t+1];++o)s[o]=o-n[t]<<5|t;return{b:n,r:s}},wt=_t(gt,2),vt=wt.b,cr=wt.r;vt[28]=258,cr[258]=28;var pr=_t(dt,0),mr=pr.b,Oe=new ce(32768);for(A=0;A<32768;++A)ee=(A&43690)>>1|(A&21845)<<1,ee=(ee&52428)>>2|(ee&13107)<<2,ee=(ee&61680)>>4|(ee&3855)<<4,Oe[A]=((ee&65280)>>8|(ee&255)<<8)>>1;var ee,A,we=function(r,e,n){for(var t=r.length,s=0,o=new ce(e);s<t;++s)r[s]&&++o[r[s]-1];var l=new ce(e);for(s=1;s<e;++s)l[s]=l[s-1]+o[s-1]<<1;var u;if(n){u=new ce(1<<e);var i=15-e;for(s=0;s<t;++s)if(r[s])for(var c=s<<4|r[s],f=e-r[s],a=l[r[s]-1]++<<f,m=a|(1<<f)-1;a<=m;++a)u[Oe[a]>>i]=c}else for(u=new ce(t),s=0;s<t;++s)r[s]&&(u[s]=Oe[l[r[s]-1]++]>>15-r[s]);return u},ve=new j(288);for(A=0;A<144;++A)ve[A]=8;var A;for(A=144;A<256;++A)ve[A]=9;var A;for(A=256;A<280;++A)ve[A]=7;var A;for(A=280;A<288;++A)ve[A]=8;var A,yt=new j(32);for(A=0;A<32;++A)yt[A]=5;var A,$r=we(ve,9,1),hr=we(yt,5,1),Ae=function(r){for(var e=r[0],n=1;n<r.length;++n)r[n]>e&&(e=r[n]);return e},H=function(r,e,n){var t=e/8|0;return(r[t]|r[t+1]<<8)>>(e&7)&n},Pe=function(r,e){var n=e/8|0;return(r[n]|r[n+1]<<8|r[n+2]<<16)>>(e&7)},gr=function(r){return(r+7)/8|0},dr=function(r,e,n){(e==null||e<0)&&(e=0),(n==null||n>r.length)&&(n=r.length);var t=new j(n-e);return t.set(r.subarray(e,n)),t},_r=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],F=function(r,e,n){var t=new Error(e||_r[r]);if(t.code=r,Error.captureStackTrace&&Error.captureStackTrace(t,F),!n)throw t;return t},He=function(r,e,n,t){var s=r.length,o=t?t.length:0;if(!s||e.f&&!e.l)return n||new j(0);var l=!n||e.i!=2,u=e.i;n||(n=new j(s*3));var i=function(We){var Je=n.length;if(We>Je){var Xe=new j(Math.max(Je*2,We));Xe.set(n),n=Xe}},c=e.f||0,f=e.p||0,a=e.b||0,m=e.l,p=e.d,_=e.m,T=e.n,C=s*8;do{if(!m){c=H(r,f,1);var w=H(r,f+1,3);if(f+=3,w)if(w==1)m=$r,p=hr,_=9,T=5;else if(w==2){var D=H(r,f,31)+257,E=H(r,f+10,15)+4,z=D+H(r,f+5,31)+1;f+=14;for(var O=new j(z),Q=new j(19),N=0;N<E;++N)Q[ur[N]]=H(r,f+N*3,7);f+=E*3;for(var Ze=Ae(Q),Ut=(1<<Ze)-1,Mt=we(Q,Ze,1),N=0;N<z;){var Re=Mt[H(r,f,Ut)];f+=Re&15;var v=Re>>4;if(v<16)O[N++]=v;else{var ae=0,ye=0;for(v==16?(ye=3+H(r,f,3),f+=2,ae=O[N-1]):v==17?(ye=3+H(r,f,7),f+=3):v==18&&(ye=11+H(r,f,127),f+=7);ye--;)O[N++]=ae}}var Ke=O.subarray(0,D),x=O.subarray(D);_=Ae(Ke),T=Ae(x),m=we(Ke,_,1),p=we(x,T,1)}else F(1);else{var v=gr(f)+4,S=r[v-4]|r[v-3]<<8,M=v+S;if(M>s){u&&F(0);break}l&&i(a+S),n.set(r.subarray(v,M),a),e.b=a+=S,e.p=f=M*8,e.f=c;continue}if(f>C){u&&F(0);break}}l&&i(a+131072);for(var Bt=(1<<_)-1,Et=(1<<T)-1,Ue=f;;Ue=f){var ae=m[Pe(r,f)&Bt],fe=ae>>4;if(f+=ae&15,f>C){u&&F(0);break}if(ae||F(2),fe<256)n[a++]=fe;else if(fe==256){Ue=f,m=null;break}else{var Ge=fe-254;if(fe>264){var N=fe-257,$e=gt[N];Ge=H(r,f,(1<<$e)-1)+vt[N],f+=$e}var Me=p[Pe(r,f)&Et],Be=Me>>4;Me||F(3),f+=Me&15;var x=mr[Be];if(Be>3){var $e=dt[Be];x+=Pe(r,f)&(1<<$e)-1,f+=$e}if(f>C){u&&F(0);break}l&&i(a+131072);var Ee=a+Ge;if(a<x){var qe=o-x,At=Math.min(x,Ee);for(qe+a<0&&F(3);a<At;++a)n[a]=t[qe+a]}for(;a<Ee;a+=4)n[a]=n[a-x],n[a+1]=n[a+1-x],n[a+2]=n[a+2-x],n[a+3]=n[a+3-x];a=Ee}}e.l=m,e.p=Ue,e.b=a,e.f=c,m&&(c=1,e.m=_,e.d=p,e.n=T)}while(!c);return a==n.length?n:dr(n,0,a)},wr=new j(0),vr=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&F(6,"invalid gzip data");var e=r[3],n=10;e&4&&(n+=(r[10]|r[11]<<8)+2);for(var t=(e>>3&1)+(e>>4&1);t>0;t-=!r[n++]);return n+(e&2)},yr=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},br=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&F(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&F(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function kr(r,e){return He(r,{i:2},e&&e.out,e&&e.dictionary)}function Lr(r,e){var n=vr(r);return n+8>r.length&&F(6,"invalid gzip data"),He(r.subarray(n,-8),{i:2},e&&e.out||new j(yr(r)),e&&e.dictionary)}function Tr(r,e){return He(r.subarray(br(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Ne(r,e){return r[0]==31&&r[1]==139&&r[2]==8?Lr(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?kr(r,e):Tr(r,e)}var Sr=typeof TextDecoder<"u"&&new TextDecoder,Dr=0;try{Sr.decode(wr,{stream:!0}),Dr=1}catch{}var bt=(r,e)=>r*Math.pow(2,e),he=(r,e)=>Math.floor(r/Math.pow(2,e)),ke=(r,e)=>bt(r.getUint16(e+1,!0),8)+r.getUint8(e),kt=(r,e)=>bt(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),Cr=(r,e,n,t,s)=>{if(r!=t.getUint8(s))return r-t.getUint8(s);const o=ke(t,s+1);if(e!=o)return e-o;const l=ke(t,s+4);return n!=l?n-l:0},Ur=(r,e,n,t)=>{const s=Lt(r,e|128,n,t);return s?{z:e,x:n,y:t,offset:s[0],length:s[1],is_dir:!0}:null},rt=(r,e,n,t)=>{const s=Lt(r,e,n,t);return s?{z:e,x:n,y:t,offset:s[0],length:s[1],is_dir:!1}:null},Lt=(r,e,n,t)=>{let s=0,o=r.byteLength/17-1;for(;s<=o;){const l=o+s>>1,u=Cr(e,n,t,r,l*17);if(u>0)s=l+1;else if(u<0)o=l-1;else return[kt(r,l*17+7),r.getUint32(l*17+13,!0)]}return null},Mr=(r,e)=>r.is_dir&&!e.is_dir?1:!r.is_dir&&e.is_dir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,Tt=(r,e)=>{const n=r.getUint8(e*17);return{z:n&127,x:ke(r,e*17+1),y:ke(r,e*17+4),offset:kt(r,e*17+7),length:r.getUint32(e*17+13,!0),is_dir:n>>7===1}},st=r=>{const e=[],n=new DataView(r);for(let t=0;t<n.byteLength/17;t++)e.push(Tt(n,t));return Br(e)},Br=r=>{r.sort(Mr);const e=new ArrayBuffer(17*r.length),n=new Uint8Array(e);for(let t=0;t<r.length;t++){const s=r[t];let o=s.z;s.is_dir&&(o=o|128),n[t*17]=o,n[t*17+1]=s.x&255,n[t*17+2]=s.x>>8&255,n[t*17+3]=s.x>>16&255,n[t*17+4]=s.y&255,n[t*17+5]=s.y>>8&255,n[t*17+6]=s.y>>16&255,n[t*17+7]=s.offset&255,n[t*17+8]=he(s.offset,8)&255,n[t*17+9]=he(s.offset,16)&255,n[t*17+10]=he(s.offset,24)&255,n[t*17+11]=he(s.offset,32)&255,n[t*17+12]=he(s.offset,48)&255,n[t*17+13]=s.length&255,n[t*17+14]=s.length>>8&255,n[t*17+15]=s.length>>16&255,n[t*17+16]=s.length>>24&255}return e},Er=(r,e)=>{if(r.byteLength<17)return null;const n=r.byteLength/17,t=Tt(r,n-1);if(t.is_dir){const s=t.z,o=e.z-s,l=Math.trunc(e.x/(1<<o)),u=Math.trunc(e.y/(1<<o));return{z:s,x:l,y:u}}return null};function Ar(r){return I(this,null,function*(){const e=yield r.getBytes(0,512e3),n=new DataView(e.data),t=n.getUint32(4,!0),s=n.getUint16(8,!0),o=new TextDecoder("utf-8"),l=JSON.parse(o.decode(new DataView(e.data,10,t)));let u=0;l.compression==="gzip"&&(u=2);let i=0;"minzoom"in l&&(i=+l.minzoom);let c=0;"maxzoom"in l&&(c=+l.maxzoom);let f=0,a=0,m=0,p=-180,_=-85,T=180,C=85;if(l.bounds){const v=l.bounds.split(",");p=+v[0],_=+v[1],T=+v[2],C=+v[3]}if(l.center){const v=l.center.split(",");f=+v[0],a=+v[1],m=+v[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+t,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:t,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:u,tileType:1,minZoom:i,maxZoom:c,minLon:p,minLat:_,maxLon:T,maxLat:C,centerZoom:m,centerLon:f,centerLat:a,etag:e.etag}})}function Pr(r,e,n,t,s,o,l){return I(this,null,function*(){let u=yield n.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(u=st(u));const i=rt(new DataView(u),t,s,o);if(i){let a=(yield e.getBytes(i.offset,i.length,l)).data;const m=new DataView(a);return m.getUint8(0)==31&&m.getUint8(1)==139&&(a=Ne(new Uint8Array(a))),{data:a}}const c=Er(new DataView(u),{z:t,x:s,y:o});if(c){const f=Ur(new DataView(u),c.z,c.x,c.y);if(f){let a=yield n.getArrayBuffer(e,f.offset,f.length,r);r.specVersion===1&&(a=st(a));const m=rt(new DataView(a),t,s,o);if(m){let _=(yield e.getBytes(m.offset,m.length,l)).data;const T=new DataView(_);return T.getUint8(0)==31&&T.getUint8(1)==139&&(_=Ne(new Uint8Array(_))),{data:_}}}}})}var St={getHeader:Ar,getZxy:Pr},zr=class{constructor(){this.tile=(r,e)=>{if(r.type=="json"){const n=r.url.substr(10);let t=this.tiles.get(n);return t||(t=new ot(n),this.tiles.set(n,t)),t.getHeader().then(s=>{const o={tiles:[r.url+"/{z}/{x}/{y}"],minzoom:s.minZoom,maxzoom:s.maxZoom,bounds:[s.minLon,s.minLat,s.maxLon,s.maxLat]};e(null,o,null,null)}).catch(s=>{e(s,null,null,null)}),{cancel:()=>{}}}else{const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),t=r.url.match(n);if(!t)throw new Error("Invalid PMTiles protocol URL");const s=t[1];let o=this.tiles.get(s);o||(o=new ot(s),this.tiles.set(s,o));const l=t[2],u=t[3],i=t[4],c=new AbortController,f=c.signal;let a=()=>{c.abort()};return o.getHeader().then(m=>{o.getZxy(+l,+u,+i,f).then(p=>{p?e(null,new Uint8Array(p.data),p.cacheControl,p.expires):m.tileType==1?e(null,new Uint8Array,null,null):e(null,null,null,null)}).catch(p=>{p.name!=="AbortError"&&e(p,null,null,null)})}),{cancel:a}}},this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function ue(r,e){return(e>>>0)*4294967296+(r>>>0)}function Or(r,e){const n=e.buf;let t,s;if(s=n[e.pos++],t=(s&112)>>4,s<128||(s=n[e.pos++],t|=(s&127)<<3,s<128)||(s=n[e.pos++],t|=(s&127)<<10,s<128)||(s=n[e.pos++],t|=(s&127)<<17,s<128)||(s=n[e.pos++],t|=(s&127)<<24,s<128)||(s=n[e.pos++],t|=(s&1)<<31,s<128))return ue(r,t);throw new Error("Expected varint not more than 10 bytes")}function ge(r){const e=r.buf;let n,t;return t=e[r.pos++],n=t&127,t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,Or(n,r))}function Nr(r,e,n,t){if(t==0){n==1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}var Ir=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Fr(r,e,n){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,r)-1||n>Math.pow(2,r)-1)throw Error("tile x/y outside zoom level bounds");const t=Ir[r],s=Math.pow(2,r);let o=0,l=0,u=0;const i=[e,n];let c=s/2;for(;c>0;)o=(i[0]&c)>0?1:0,l=(i[1]&c)>0?1:0,u+=c*c*(3*o^l),Nr(c,i,o,l),c=c/2;return t+u}function Dt(r,e){return I(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Ne(new Uint8Array(r));{let t=new Response(r).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(t).arrayBuffer()}}else throw Error("Compression method not supported")})}var jr=127;function Vr(r,e){let n=0,t=r.length-1;for(;n<=t;){const s=t+n>>1,o=e-r[s].tileId;if(o>0)n=s+1;else if(o<0)t=s-1;else return r[s]}return t>=0&&(r[t].runLength===0||e-r[t].tileId<r[t].runLength)?r[t]:null}var xr=class{constructor(r){this.url=r}getKey(){return this.url}getBytes(r,e,n){return I(this,null,function*(){let t;n||(t=new AbortController,n=t.signal);let s=yield fetch(this.url,{signal:n,headers:{Range:"bytes="+r+"-"+(r+e-1)}});if(s.status===416&&r===0){const u=s.headers.get("Content-Range");if(!u||!u.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const i=+u.substr(8);s=yield fetch(this.url,{signal:n,headers:{Range:"bytes=0-"+(i-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw t&&t.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function Z(r,e){const n=r.getUint32(e+4,!0),t=r.getUint32(e+0,!0);return n*Math.pow(2,32)+t}function Hr(r,e){const n=new DataView(r),t=n.getUint8(7);if(t>3)throw Error(`Archive is spec version ${t} but this library supports up to spec version 3`);return{specVersion:t,rootDirectoryOffset:Z(n,8),rootDirectoryLength:Z(n,16),jsonMetadataOffset:Z(n,24),jsonMetadataLength:Z(n,32),leafDirectoryOffset:Z(n,40),leafDirectoryLength:Z(n,48),tileDataOffset:Z(n,56),tileDataLength:Z(n,64),numAddressedTiles:Z(n,72),numTileEntries:Z(n,80),numTileContents:Z(n,88),clustered:n.getUint8(96)===1,internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:e}}function Ct(r){const e={buf:new Uint8Array(r),pos:0},n=ge(e),t=[];let s=0;for(let o=0;o<n;o++){const l=ge(e);t.push({tileId:s+l,offset:0,length:0,runLength:1}),s+=l}for(let o=0;o<n;o++)t[o].runLength=ge(e);for(let o=0;o<n;o++)t[o].length=ge(e);for(let o=0;o<n;o++){const l=ge(e);l===0&&o>0?t[o].offset=t[o-1].offset+t[o-1].length:t[o].offset=l-1}return t}function Zr(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var pe=class extends Error{};function Rr(r,e,n,t){return I(this,null,function*(){const s=yield r.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Zr(s.data)<3)return[yield St.getHeader(r)];const l=s.data.slice(0,jr);let u=s.etag;t&&s.etag!=t&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+r.getKey()),u=void 0);const i=Hr(l,u);if(n){const c=s.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),f=r.getKey()+"|"+(i.etag||"")+"|"+i.rootDirectoryOffset+"|"+i.rootDirectoryLength,a=Ct(yield e(c,i.internalCompression));return[i,[f,a.length,a]]}return[i,void 0]})}function Kr(r,e,n,t,s){return I(this,null,function*(){const o=yield r.getBytes(n,t);if(s.etag&&s.etag!==o.etag)throw new pe(o.etag);const l=yield e(o.data,s.internalCompression),u=Ct(l);if(u.length===0)throw new Error("Empty directory is invalid");return u})}var Gr=class{constructor(r=100,e=!0,n=Dt){this.cache=new Map,this.maxCacheEntries=r,this.counter=1,this.prefetch=e,this.decompress=n}getHeader(r,e){return I(this,null,function*(){const n=r.getKey();if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const t=new Promise((s,o)=>{Rr(r,this.decompress,this.prefetch,e).then(l=>{l[1]&&this.cache.set(l[1][0],{lastUsed:this.counter++,data:Promise.resolve(l[1][2])}),s(l[0]),this.prune()}).catch(l=>{o(l)})});return this.cache.set(n,{lastUsed:this.counter++,data:t}),t})}getDirectory(r,e,n,t){return I(this,null,function*(){const s=r.getKey()+"|"+(t.etag||"")+"|"+e+"|"+n;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((l,u)=>{Kr(r,this.decompress,e,n,t).then(i=>{l(i),this.prune()}).catch(i=>{u(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}getArrayBuffer(r,e,n,t){return I(this,null,function*(){const s=r.getKey()+"|"+(t.etag||"")+"|"+e+"|"+n;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const o=new Promise((l,u)=>{r.getBytes(e,n).then(i=>{if(t.etag&&t.etag!==i.etag)throw new pe(i.etag);l(i.data),this.cache.has(s),this.prune()}).catch(i=>{u(i)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((n,t)=>{n.lastUsed<r&&(r=n.lastUsed,e=t)}),e&&this.cache.delete(e)}}invalidate(r,e){return I(this,null,function*(){this.cache.delete(r.getKey()),yield this.getHeader(r,e)})}},ot=class{constructor(r,e,n){typeof r=="string"?this.source=new xr(r):this.source=r,n?this.decompress=n:this.decompress=Dt,e?this.cache=e:this.cache=new Gr}getHeader(){return I(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,n,t){return I(this,null,function*(){const s=Fr(r,e,n),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return St.getZxy(o,this.source,this.cache,r,e,n,t);if(r<o.minZoom||r>o.maxZoom)return;let l=o.rootDirectoryOffset,u=o.rootDirectoryLength;for(let i=0;i<=3;i++){const c=yield this.cache.getDirectory(this.source,l,u,o),f=Vr(c,s);if(f)if(f.runLength>0){const a=yield this.source.getBytes(o.tileDataOffset+f.offset,f.length,t);if(o.etag&&o.etag!==a.etag)throw new pe(a.etag);return{data:yield this.decompress(a.data,o.tileCompression),cacheControl:a.cacheControl,expires:a.expires}}else l=o.leafDirectoryOffset+f.offset,u=f.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,n,t){return I(this,null,function*(){try{return yield this.getZxyAttempt(r,e,n,t)}catch(s){if(s instanceof pe)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(r,e,n,t);throw s}})}getMetadataAttempt(){return I(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength);if(r.etag&&r.etag!==e.etag)throw new pe(e.etag);const n=yield this.decompress(e.data,r.internalCompression),t=new TextDecoder("utf-8");return JSON.parse(t.decode(n))})}getMetadata(){return I(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof pe)return this.cache.invalidate(this.source,r.message),yield this.getMetadataAttempt();throw r}})}};function qr(r){return Ie(()=>{let e=new zr;Qe.addProtocol("pmtiles",e.tile)}),mt(()=>{Qe.removeProtocol("pmtiles")}),[]}class Wr extends R{constructor(e){super(),K(this,e,qr,null,G,{})}}function it(r,e,n){const t=r.slice();return t[15]=e[n],t}function Jr(r){let e;return{c(){e=L("Home")},m(n,t){h(n,e,t)},d(n){n&&g(e)}}}function lt(r){let e,n;return e=new Kt({props:{errorMessage:r[1]}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),n=!0},p(t,s){const o={};s&2&&(o.errorMessage=t[1]),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){d(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}function at(r){let e,n,t,s;function o(i){r[10](i)}function l(i){r[11](i)}let u={schemes:r[2]};return r[3]!==void 0&&(u.schemesToBeShown=r[3]),r[4]!==void 0&&(u.filterText=r[4]),e=new fn({props:u}),ne.push(()=>re(e,"schemesToBeShown",o)),ne.push(()=>re(e,"filterText",l)),{c(){y(e.$$.fragment)},m(i,c){b(e,i,c),s=!0},p(i,c){const f={};c&4&&(f.schemes=i[2]),!n&&c&8&&(n=!0,f.schemesToBeShown=i[3],se(()=>n=!1)),!t&&c&16&&(t=!0,f.filterText=i[4],se(()=>t=!1)),e.$set(f)},i(i){s||($(e.$$.fragment,i),s=!0)},o(i){d(e.$$.fragment,i),s=!1},d(i){k(e,i)}}}function ft(r){let e,n,t=tt(r[2].values()),s=[];for(let l=0;l<t.length;l+=1)s[l]=ct(it(r,t,l));const o=l=>d(s[l],1,1,()=>{s[l]=null});return{c(){e=P("ul");for(let l=0;l<s.length;l+=1)s[l].c()},m(l,u){h(l,e,u);for(let i=0;i<s.length;i+=1)s[i]&&s[i].m(e,null);n=!0},p(l,u){if(u&13){t=tt(l[2].values());let i;for(i=0;i<t.length;i+=1){const c=it(l,t,i);s[i]?(s[i].p(c,u),$(s[i],1)):(s[i]=ct(c),s[i].c(),$(s[i],1),s[i].m(e,null))}for(de(),i=t.length;i<s.length;i+=1)o(i);_e()}},i(l){if(!n){for(let u=0;u<t.length;u+=1)$(s[u]);n=!0}},o(l){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)d(s[u]);n=!1},d(l){l&&g(e),Gt(s,l)}}}function ut(r){let e,n;return e=new Gn({props:{scheme:r[15],authorityNames:r[0]}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),n=!0},p(t,s){const o={};s&4&&(o.scheme=t[15]),s&1&&(o.authorityNames=t[0]),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){d(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}function ct(r){let e=r[3].has(r[15].scheme_reference),n,t,s=e&&ut(r);return{c(){s&&s.c(),n=qt()},m(o,l){s&&s.m(o,l),h(o,n,l),t=!0},p(o,l){l&12&&(e=o[3].has(o[15].scheme_reference)),e?s?(s.p(o,l),l&12&&$(s,1)):(s=ut(o),s.c(),$(s,1),s.m(n.parentNode,n)):s&&(de(),d(s,1,1,()=>{s=null}),_e())},i(o){t||($(s),t=!0)},o(o){d(s),t=!1},d(o){o&&g(n),s&&s.d(o)}}}function Xr(r){let e,n,t,s,o,l,u,i,c,f,a,m,p;n=new be({props:{$$slots:{default:[Jr]},$$scope:{ctx:r}}}),n.$on("click",r[9]),u=new Xt({props:{boundaryGeojson:r[5]}});let _=r[1]&&lt(r);f=new Vt({props:{label:"Load from GeoJSON",id:"load-geojson",loadFile:r[7]}});let T=r[2].size>0&&at(r),C=r[0]&&ft(r);return{c(){e=P("div"),y(n.$$.fragment),t=B(),s=P("div"),o=P("h1"),o.textContent="Browse schemes",l=B(),y(u.$$.fragment),i=B(),_&&_.c(),c=B(),y(f.$$.fragment),a=B(),T&&T.c(),m=B(),C&&C.c(),et(s,"display","flex"),et(s,"justify-content","space-between"),V(e,"slot","sidebar"),V(e,"class","govuk-prose")},m(w,v){h(w,e,v),b(n,e,null),U(e,t),U(e,s),U(s,o),U(s,l),b(u,s,null),U(e,i),_&&_.m(e,null),U(e,c),b(f,e,null),U(e,a),T&&T.m(e,null),U(e,m),C&&C.m(e,null),p=!0},p(w,v){const S={};v&262144&&(S.$$scope={dirty:v,ctx:w}),n.$set(S);const M={};v&32&&(M.boundaryGeojson=w[5]),u.$set(M),w[1]?_?(_.p(w,v),v&2&&$(_,1)):(_=lt(w),_.c(),$(_,1),_.m(e,c)):_&&(de(),d(_,1,1,()=>{_=null}),_e()),w[2].size>0?T?(T.p(w,v),v&4&&$(T,1)):(T=at(w),T.c(),$(T,1),T.m(e,m)):T&&(de(),d(T,1,1,()=>{T=null}),_e()),w[0]?C?(C.p(w,v),v&1&&$(C,1)):(C=ft(w),C.c(),$(C,1),C.m(e,null)):C&&(de(),d(C,1,1,()=>{C=null}),_e())},i(w){p||($(n.$$.fragment,w),$(u.$$.fragment,w),$(_),$(f.$$.fragment,w),$(T),$(C),p=!0)},o(w){d(n.$$.fragment,w),d(u.$$.fragment,w),d(_),d(f.$$.fragment,w),d(T),d(C),p=!1},d(w){w&&g(e),k(n),k(u),_&&_.d(),k(f),T&&T.d(),C&&C.d()}}}function Yr(r){let e,n,t,s,o,l,u,i,c,f;return e=new Yn({}),t=new wn({}),o=new Bn({}),u=new Vn({}),c=new ar({}),{c(){y(e.$$.fragment),n=B(),y(t.$$.fragment),s=B(),y(o.$$.fragment),l=B(),y(u.$$.fragment),i=B(),y(c.$$.fragment)},m(a,m){b(e,a,m),h(a,n,m),b(t,a,m),h(a,s,m),b(o,a,m),h(a,l,m),b(u,a,m),h(a,i,m),b(c,a,m),f=!0},i(a){f||($(e.$$.fragment,a),$(t.$$.fragment,a),$(o.$$.fragment,a),$(u.$$.fragment,a),$(c.$$.fragment,a),f=!0)},o(a){d(e.$$.fragment,a),d(t.$$.fragment,a),d(o.$$.fragment,a),d(u.$$.fragment,a),d(c.$$.fragment,a),f=!1},d(a){a&&(g(n),g(s),g(l),g(i)),k(e,a),k(t,a),k(o,a),k(u,a),k(c,a)}}}function Qr(r){let e,n,t,s,o,l,u,i;return e=new bn({}),o=new en({props:{small:!0,$$slots:{default:[Yr]},$$scope:{ctx:r}}}),u=new tn({props:{style:r[6]}}),{c(){y(e.$$.fragment),n=B(),t=P("hr"),s=B(),y(o.$$.fragment),l=B(),y(u.$$.fragment)},m(c,f){b(e,c,f),h(c,n,f),h(c,t,f),h(c,s,f),b(o,c,f),h(c,l,f),b(u,c,f),i=!0},p(c,f){const a={};f&262144&&(a.$$scope={dirty:f,ctx:c}),o.$set(a)},i(c){i||($(e.$$.fragment,c),$(o.$$.fragment,c),$(u.$$.fragment,c),i=!0)},o(c){d(e.$$.fragment,c),d(o.$$.fragment,c),d(u.$$.fragment,c),i=!1},d(c){c&&(g(n),g(t),g(s),g(l)),k(e,c),k(o,c),k(u,c)}}}function es(r){let e,n,t,s,o,l,u,i,c,f,a;return e=new Qt({props:{colorInterventions:$t("v1")}}),t=new ie({props:{layer:"interventions-points",tooltip:r[8]}}),o=new ie({props:{layer:"interventions-lines",tooltip:r[8]}}),u=new ie({props:{layer:"interventions-polygons",tooltip:r[8]}}),f=new xe({props:{label:"Layers",open:!0,$$slots:{default:[Qr]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment),n=B(),y(t.$$.fragment),s=B(),y(o.$$.fragment),l=B(),y(u.$$.fragment),i=B(),c=P("div"),y(f.$$.fragment),V(c,"class","top-right svelte-nlvvhu")},m(m,p){b(e,m,p),h(m,n,p),b(t,m,p),h(m,s,p),b(o,m,p),h(m,l,p),b(u,m,p),h(m,i,p),h(m,c,p),b(f,c,null),a=!0},p(m,p){const _={};p&262144&&(_.$$scope={dirty:p,ctx:m}),f.$set(_)},i(m){a||($(e.$$.fragment,m),$(t.$$.fragment,m),$(o.$$.fragment,m),$(u.$$.fragment,m),$(f.$$.fragment,m),a=!0)},o(m){d(e.$$.fragment,m),d(t.$$.fragment,m),d(o.$$.fragment,m),d(u.$$.fragment,m),d(f.$$.fragment,m),a=!1},d(m){m&&(g(n),g(s),g(l),g(i),g(c)),k(e,m),k(t,m),k(o,m),k(u,m),k(f)}}}function ts(r){let e,n,t,s,o;return n=new Wr({}),s=new Yt({props:{style:r[6],$$slots:{default:[es]},$$scope:{ctx:r}}}),{c(){e=P("div"),y(n.$$.fragment),t=B(),y(s.$$.fragment),V(e,"slot","main")},m(l,u){h(l,e,u),b(n,e,null),U(e,t),b(s,e,null),o=!0},p(l,u){const i={};u&262144&&(i.$$scope={dirty:u,ctx:l}),s.$set(i)},i(l){o||($(n.$$.fragment,l),$(s.$$.fragment,l),o=!0)},o(l){d(n.$$.fragment,l),d(s.$$.fragment,l),o=!1},d(l){l&&g(e),k(n),k(s)}}}function ns(r){let e,n;return e=new Jt({props:{$$slots:{main:[ts],sidebar:[Xr]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment)},m(t,s){b(e,t,s),n=!0},p(t,[s]){const o={};s&262207&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){d(e.$$.fragment,t),n=!1},d(t){k(e,t)}}}function rs(r,e,n){let t,s;X(r,le,v=>n(12,t=v)),X(r,me,v=>n(5,s=v));let o=null;Ie(async()=>{xt();let v=await Ht();n(0,o=new Set(v.features.map(S=>S.properties.name)))});let u=new URLSearchParams(window.location.search).get("style")||"dataviz",i="",c=new Map,f=new Set,a="";mt(()=>{me.set(Zt())});function m(v){try{let S=JSON.parse(v);n(2,c=nn(S)),me.set(S),n(1,i=""),t==null||t.fitBounds(pt(S),{padding:20,animate:!1})}catch(S){n(1,i=`Couldn't load schemes from a file: ${S}`)}}function p(v){let S=v.properties;var M='<div style="max-width: 30vw;">';return M+=`<h2>${_(S.name)} (${S.intervention_type})</h2>`,M+=`<p>Scheme reference: ${S.scheme_reference}</p>`,S.length_meters&&(M+=`<p>Length: ${Rt(S.length_meters)}</p>`),S.description&&(M+=`<p>${_(S.description)}</p>`),M+="</div>",M}function _(v){return a?v.replace(new RegExp(a,"gi"),S=>`<mark>${S}</mark>`):v}const T=()=>window.open("index.html");function C(v){f=v,n(3,f)}function w(v){a=v,n(4,a)}return[o,i,c,f,a,s,u,m,p,T,C,w]}class ss extends R{constructor(e){super(),K(this,e,rs,ns,G,{})}}document.body.className=document.body.className?document.body.className+" js-enabled":"js-enabled";new ss({target:document.getElementById("app")});
